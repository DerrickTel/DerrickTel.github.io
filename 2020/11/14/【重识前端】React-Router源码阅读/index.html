<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>ã€é‡è¯†å‰ç«¯ã€‘React-Routeræºç é˜…è¯» | Derrick</title><meta name="description" content="ã€é‡è¯†å‰ç«¯ã€‘React-Routeræºç é˜…è¯»"><meta name="keywords" content="React,æºç é˜…è¯»"><meta name="author" content="Derrick"><meta name="copyright" content="Derrick"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="ã€é‡è¯†å‰ç«¯ã€‘React-Routeræºç é˜…è¯»"><meta name="twitter:description" content="ã€é‡è¯†å‰ç«¯ã€‘React-Routeræºç é˜…è¯»"><meta name="twitter:image" content="http://derricktel.github.io/image/cover/web.jpeg"><meta property="og:type" content="article"><meta property="og:title" content="ã€é‡è¯†å‰ç«¯ã€‘React-Routeræºç é˜…è¯»"><meta property="og:url" content="http://derricktel.github.io/2020/11/14/%E3%80%90%E9%87%8D%E8%AF%86%E5%89%8D%E7%AB%AF%E3%80%91React-Router%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/"><meta property="og:site_name" content="Derrick"><meta property="og:description" content="ã€é‡è¯†å‰ç«¯ã€‘React-Routeræºç é˜…è¯»"><meta property="og:image" content="http://derricktel.github.io/image/cover/web.jpeg"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://derricktel.github.io/2020/11/14/%E3%80%90%E9%87%8D%E8%AF%86%E5%89%8D%E7%AB%AF%E3%80%91React-Router%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/"><link rel="prev" title="ã€Œå¦‚ä½•ç»™å¼€æºåº“æä¸€ä¸ªPRã€" href="http://derricktel.github.io/2021/01/22/%E3%80%8C%E5%A6%82%E4%BD%95%E7%BB%99github%E6%8F%90%E4%B8%80%E4%B8%AAPR%E3%80%8D/"><link rel="next" title="ã€é¢ç»ã€‘2å¹´å‰ç«¯æ­å·é¢è¯•é›†åˆ" href="http://derricktel.github.io/2020/10/28/%E3%80%90%E9%9D%A2%E7%BB%8F%E3%80%912%E5%B9%B4%E5%89%8D%E7%AB%AF%E6%9D%AD%E5%B7%9E%E9%9D%A2%E8%AF%95%E9%9B%86%E5%90%88/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç°¡"},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  bookmark: {
    message_prev: 'æŒ‰',
    message_next: 'é”®å°†æœ¬é¡µåŠ å…¥ä¹¦ç­¾'
  },
  runtime_unit: 'å¤©',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length_num">38</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length_num">43</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length_num">19</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-about"></i><span> å…³äºæˆ‘</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">ç›®å½•</div><div class="sidebar-toc__progress"><span class="progress-notice">ä½ å·²ç»è¯»äº†</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#å‰è¨€"><span class="toc-number">1.</span> <span class="toc-text">å‰è¨€</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#å­¦å‰å°çŸ¥è¯†"><span class="toc-number">2.</span> <span class="toc-text">å­¦å‰å°çŸ¥è¯†</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ç®€å•ç¤ºä¾‹"><span class="toc-number">3.</span> <span class="toc-text">ç®€å•ç¤ºä¾‹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#react-routerå’Œreact-router-domçš„åŒºåˆ«ã€‚"><span class="toc-number">3.1.</span> <span class="toc-text">react-routerå’Œreact-router-domçš„åŒºåˆ«ã€‚</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#å…ˆçœ‹æä¾›çš„API"><span class="toc-number">3.1.1.</span> <span class="toc-text">å…ˆçœ‹æä¾›çš„API</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#React-router"><span class="toc-number">3.1.1.1.</span> <span class="toc-text">React-router</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#React-router-dom"><span class="toc-number">3.1.1.2.</span> <span class="toc-text">React-router-dom</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ç®€å•ä¿®æ”¹"><span class="toc-number">3.2.</span> <span class="toc-text">ç®€å•ä¿®æ”¹</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SPAçš„æ ¸å¿ƒæ€æƒ³"><span class="toc-number">4.</span> <span class="toc-text">SPAçš„æ ¸å¿ƒæ€æƒ³</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#æºç æ”»è¯»"><span class="toc-number">5.</span> <span class="toc-text">æºç æ”»è¯»</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#BrowserRouter"><span class="toc-number">5.1.</span> <span class="toc-text">BrowserRouter</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#react-router"><span class="toc-number">5.2.</span> <span class="toc-text">react-router</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#æ„é€ å‡½æ•°"><span class="toc-number">5.2.1.</span> <span class="toc-text">æ„é€ å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#componentWillUnmount"><span class="toc-number">5.2.2.</span> <span class="toc-text">componentWillUnmount</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#componentDidUnmount"><span class="toc-number">5.2.3.</span> <span class="toc-text">componentDidUnmount</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#render"><span class="toc-number">5.2.4.</span> <span class="toc-text">render</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ€»ç»“"><span class="toc-number">5.2.5.</span> <span class="toc-text">æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#history"><span class="toc-number">5.3.</span> <span class="toc-text">history</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#createBrowserHistory"><span class="toc-number">5.3.1.</span> <span class="toc-text">createBrowserHistory</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#è¿”å›çš„å†…å®¹"><span class="toc-number">5.3.1.1.</span> <span class="toc-text">è¿”å›çš„å†…å®¹</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#go"><span class="toc-number">5.3.1.1.1.</span> <span class="toc-text">go</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#createHref"><span class="toc-number">5.3.1.1.2.</span> <span class="toc-text">createHref</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#push"><span class="toc-number">5.3.1.1.3.</span> <span class="toc-text">push</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#replace"><span class="toc-number">5.3.1.1.4.</span> <span class="toc-text">replace</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#listen"><span class="toc-number">5.3.1.1.5.</span> <span class="toc-text">listen</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#createEvents"><span class="toc-number">5.3.1.1.6.</span> <span class="toc-text">createEvents</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#block"><span class="toc-number">5.3.1.1.7.</span> <span class="toc-text">block</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#æ€»ç»“-1"><span class="toc-number">5.3.1.1.8.</span> <span class="toc-text">æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#å…·ä½“æ ¸å¿ƒåŸç†"><span class="toc-number">5.3.1.2.</span> <span class="toc-text">å…·ä½“æ ¸å¿ƒåŸç†</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#createHashHistory"><span class="toc-number">5.3.2.</span> <span class="toc-text">createHashHistory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#scrollIntoView"><span class="toc-number">5.3.3.</span> <span class="toc-text">scrollIntoView</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#scrollTop"><span class="toc-number">5.3.4.</span> <span class="toc-text">scrollTop</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#react-anchor-without-hash"><span class="toc-number">5.4.</span> <span class="toc-text">react-anchor-without-hash</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#å…·ä½“æ ¸å¿ƒåŸç†-1"><span class="toc-number">5.4.0.1.</span> <span class="toc-text">å…·ä½“æ ¸å¿ƒåŸç†</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#æ ¸å¿ƒAPI"><span class="toc-number">6.</span> <span class="toc-text">æ ¸å¿ƒAPI</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Switch"><span class="toc-number">6.1.</span> <span class="toc-text">Switch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ‘˜è‡ªå®˜ç½‘"><span class="toc-number">6.2.</span> <span class="toc-text">æ‘˜è‡ªå®˜ç½‘</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#location-object"><span class="toc-number">6.3.</span> <span class="toc-text">location: object</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#matchPath"><span class="toc-number">6.3.1.</span> <span class="toc-text">matchPath</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Route"><span class="toc-number">6.4.</span> <span class="toc-text">Route</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#component"><span class="toc-number">6.4.1.</span> <span class="toc-text">component</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#children"><span class="toc-number">6.4.2.</span> <span class="toc-text">children</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#render-1"><span class="toc-number">6.4.3.</span> <span class="toc-text">render</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exact-amp-strict-amp-sensitive"><span class="toc-number">6.4.4.</span> <span class="toc-text">exact &amp; strict &amp; sensitive</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#location"><span class="toc-number">6.4.5.</span> <span class="toc-text">location</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Prompt"><span class="toc-number">6.5.</span> <span class="toc-text">Prompt</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redirect"><span class="toc-number">6.6.</span> <span class="toc-text">Redirect</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#æ€»ç»“-2"><span class="toc-number">7.</span> <span class="toc-text">æ€»ç»“</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#æµç¨‹"><span class="toc-number">7.1.</span> <span class="toc-text">æµç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ä¿®æ”¹url"><span class="toc-number">7.1.1.</span> <span class="toc-text">ä¿®æ”¹url</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(/image/cover/web.jpeg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Derrick</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-about"></i><span> å…³äºæˆ‘</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">ã€é‡è¯†å‰ç«¯ã€‘React-Routeræºç é˜…è¯»</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="å‘è¡¨äº 2020-11-14 20:29:17"><i class="fa fa-calendar" aria-hidden="true"></i> å‘è¡¨äº 2020-11-14</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="æ›´æ–°äº 2021-06-29 11:10:08"><i class="fa fa-history" aria-hidden="true"></i> æ›´æ–°äº 2021-06-29</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E9%87%8D%E6%8B%BE%E5%89%8D%E7%AB%AF/">é‡æ‹¾å‰ç«¯</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="article-container"><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æ­¤å¤„ä»‹ç»ä¸€ä¸‹React-Routerçš„æ ¸å¿ƒåŸç†ã€‚ç‰¹åˆ«ç»†è‡´çš„æ ‡ç‚¹ç¬¦å·çš„ä¸äºˆè®¨è®ºã€‚</p>
<h1 id="å­¦å‰å°çŸ¥è¯†"><a href="#å­¦å‰å°çŸ¥è¯†" class="headerlink" title="å­¦å‰å°çŸ¥è¯†"></a>å­¦å‰å°çŸ¥è¯†</h1><p><code>React-Router</code>å…¶å®æœ€æ ¸å¿ƒçš„ä¸œè¥¿æ˜¯<code>Route</code>ç»„ä»¶å’Œç”±ç»Ÿä¸€ä½œè€…å¼€å‘çš„<code>History</code>åº“æ¥å»ºç«‹çš„ã€‚æ¥ä¸‹æ¥è·Ÿç€é•œå¤´ä¸€èµ·èµ°è¿›ç¥ç§˜çš„<code>ÃŸReact-Router</code>ä¸–ç•Œå§ã€‚</p>
<p>å·²ç»çŸ¥é“æ€ä¹ˆä½¿ç”¨çš„ç›´æ¥è·³è¿‡ï¼Œåˆ°ä¸‹é¢çš„æºç åˆ†æå»â”—|ï½€Oâ€²|â”› å—·~~</p>
<h1 id="ç®€å•ç¤ºä¾‹"><a href="#ç®€å•ç¤ºä¾‹" class="headerlink" title="ç®€å•ç¤ºä¾‹"></a>ç®€å•ç¤ºä¾‹</h1><p>ä¸€èµ·å»ºä¸€ä¸ªç®€å•çš„ç¤ºä¾‹å§ã€‚å…ˆç”¨<code>react</code>å®˜ç½‘çš„<code>create-react-app</code>è„šæ‰‹æ¶å¼„ä¸ª<code>react</code>å‡ºæ¥ã€‚</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npx create-react-app my-app</span><br><span class="line"><span class="built_in">cd</span> my-app</span><br><span class="line">npm start</span><br></pre></td></tr></table></figure>

<p>å®‰è£…<a href="https://reactrouter.com/web/guides/quick-start" target="_blank" rel="noopener">react-router-dom</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install react-router-dom</span><br></pre></td></tr></table></figure>

<p>åœ¨å¤§å®¶å®‰è£…ä¹‹ä½™ï¼Œæˆ‘ç®€ç­”çš„ä»‹ç»ä¸€ä¸‹<code>react-router</code>å’Œ<code>react-router-dom</code>çš„åŒºåˆ«ã€‚</p>
<h2 id="react-routerå’Œreact-router-domçš„åŒºåˆ«ã€‚"><a href="#react-routerå’Œreact-router-domçš„åŒºåˆ«ã€‚" class="headerlink" title="react-routerå’Œreact-router-domçš„åŒºåˆ«ã€‚"></a>react-routerå’Œreact-router-domçš„åŒºåˆ«ã€‚</h2><h3 id="å…ˆçœ‹æä¾›çš„API"><a href="#å…ˆçœ‹æä¾›çš„API" class="headerlink" title="å…ˆçœ‹æä¾›çš„API"></a>å…ˆçœ‹æä¾›çš„API</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Switch, Route, Router &#125; <span class="keyword">from</span> <span class="string">'react-router'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; Swtich, Route, BrowserRouter, HashHistory, Link &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br></pre></td></tr></table></figure>

<h4 id="React-router"><a href="#React-router" class="headerlink" title="React-router"></a>React-router</h4><p>æä¾›äº†è·¯ç”±çš„æ ¸å¿ƒapiã€‚å¦‚Routerã€Routeã€Switchç­‰ï¼Œä½†æ²¡æœ‰æä¾›æœ‰å…³domæ“ä½œè¿›è¡Œè·¯ç”±è·³è½¬çš„apiï¼›</p>
<h4 id="React-router-dom"><a href="#React-router-dom" class="headerlink" title="React-router-dom"></a>React-router-dom</h4><p>æä¾›äº†<code>BrowserRouter</code>ã€<code>Route</code>ã€<code>Link</code>ç­‰apiï¼Œå¯ä»¥é€šè¿‡domæ“ä½œè§¦å‘äº‹ä»¶æ§åˆ¶è·¯ç”±ã€‚</p>
<p><code>Link</code>ç»„ä»¶ï¼Œä¼šæ¸²æŸ“ä¸€ä¸ªaæ ‡ç­¾ï¼›<code>BrowserRouter</code>å’Œ<code>HashRouter</code>ç»„ä»¶ï¼Œå‰è€…ä½¿ç”¨<code>pushState</code>å’Œ<code>popState</code>äº‹ä»¶æ„å»ºè·¯ç”±ï¼Œåè€…ä½¿ç”¨<code>hash</code>å’Œ <code>hashchange</code>äº‹ä»¶æ„å»ºè·¯ç”±ã€‚</p>
<p><code>react-router-dom</code>åœ¨<code>react-router</code>çš„åŸºç¡€ä¸Šæ‰©å±•äº†å¯æ“ä½œ<code>dom</code>çš„<code>api</code>ã€‚</p>
<p><code>Swtich</code> å’Œ <code>Route</code> éƒ½æ˜¯ä»<code>react-router</code>ä¸­å¯¼å…¥äº†ç›¸åº”çš„ç»„ä»¶å¹¶é‡æ–°å¯¼å‡ºï¼Œæ²¡åšä»€ä¹ˆç‰¹æ®Šå¤„ç†ã€‚</p>
<p><code>react-router-dom</code>ä¸­<code>package.json</code>ä¾èµ–ä¸­å­˜åœ¨å¯¹<code>react-router</code>çš„ä¾èµ–ï¼Œæ•…æ­¤ï¼Œä¸éœ€è¦<code>npm</code>å®‰è£…<code>react-router</code>ã€‚</p>
<blockquote>
<ul>
<li>å¯ç›´æ¥ npm å®‰è£… react-router-domï¼Œä½¿ç”¨å…¶apiã€‚</li>
</ul>
</blockquote>
<h2 id="ç®€å•ä¿®æ”¹"><a href="#ç®€å•ä¿®æ”¹" class="headerlink" title="ç®€å•ä¿®æ”¹"></a>ç®€å•ä¿®æ”¹</h2><p>ğŸ‘Œï¼Œå¤§å®¶ğŸ”¥åº”è¯¥å·²ç»å®‰è£…å®Œäº†å§ï¼Ÿæ¥ä¸‹æ¥ç®€å•çš„ä¿®æ”¹ä¸€ä¸‹è„šæ‰‹æ¶é‡Œé¢çš„å†…å®¹ã€‚ä¸»è¦æ˜¯ä¸ºäº†ç†Ÿæ‚‰å¯¹æ‰‹ï¼ŒçŸ¥å·±çŸ¥å½¼ç™¾æˆ˜ç™¾èƒœã€‚</p>
<p><img src="/" class="lazyload" data-src="/image/router/demo.gif"  alt="demo"></p>
<p>ä¿®æ”¹ä¸€ä¸‹<code>src/app.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  BrowserRouter <span class="keyword">as</span> Router,</span><br><span class="line">  Switch,</span><br><span class="line">  Route,</span><br><span class="line">  Link,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Home</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;h1&gt;é¦–é¡µ&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Link to="/</span>login<span class="string">"&gt;ç™»å½•&lt;/Link&gt;</span></span><br><span class="line"><span class="string">    &lt;/&gt;</span></span><br><span class="line"><span class="string">  )</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function Login() &#123;</span></span><br><span class="line"><span class="string">  return (</span></span><br><span class="line"><span class="string">    &lt;&gt;</span></span><br><span class="line"><span class="string">      &lt;h1&gt;ç™»å½•é¡µ&lt;/h1&gt;</span></span><br><span class="line"><span class="string">      &lt;Link to="</span>/<span class="string">"&gt;å›é¦–é¡µ&lt;/Link&gt;</span></span><br><span class="line"><span class="string">    &lt;/&gt;</span></span><br><span class="line"><span class="string">  );</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function App() &#123;</span></span><br><span class="line"><span class="string">  return (</span></span><br><span class="line"><span class="string">    &lt;Router&gt;</span></span><br><span class="line"><span class="string">      &lt;Switch&gt;</span></span><br><span class="line"><span class="string">        &lt;Route path="</span>/login<span class="string">" component=&#123;Login&#125;/&gt;</span></span><br><span class="line"><span class="string">        &lt;Route path="</span>/<span class="string">" component=&#123;Home&#125;/&gt;</span></span><br><span class="line"><span class="string">      &lt;/Switch&gt;</span></span><br><span class="line"><span class="string">    &lt;/Router&gt;</span></span><br><span class="line"><span class="string">  );</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default App;</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±å®Œæˆäº†ä¸€ä¸ªæœ€ç®€å•çš„ç¤ºä¾‹äº†ã€‚</p>
<h1 id="SPAçš„æ ¸å¿ƒæ€æƒ³"><a href="#SPAçš„æ ¸å¿ƒæ€æƒ³" class="headerlink" title="SPAçš„æ ¸å¿ƒæ€æƒ³"></a>SPAçš„æ ¸å¿ƒæ€æƒ³</h1><ul>
<li>ç›‘å¬<code>URL</code>çš„å˜åŒ–</li>
<li>æ”¹å˜æŸäº›<code>context</code>çš„å€¼</li>
<li>è·å–å¯¹åº”çš„é¡µé¢ç»„ä»¶</li>
<li><code>render</code>æ–°çš„é¡µé¢</li>
</ul>
<h1 id="æºç æ”»è¯»"><a href="#æºç æ”»è¯»" class="headerlink" title="æºç æ”»è¯»"></a>æºç æ”»è¯»</h1><h2 id="BrowserRouter"><a href="#BrowserRouter" class="headerlink" title="BrowserRouter"></a>BrowserRouter</h2><p>ä»å‰é¢çš„ç®€å•ç¤ºä¾‹ä¸­æˆ‘ä»¬ï¼Œå‘ç°æœ‰ä¸€ä¸ªæœ€å¤–å±‚çš„ä¼™è®¡ï¼Œå«<code>BrowserRouter</code>ã€‚æˆ‘ä»¬ç›´æ¥å¹²åˆ°ä»–çš„githubæºç å»ç…ç…ã€‚</p>
<p>é“¾æ¥ï¼š<a href="https://github.com/ReactTraining/react-router/blob/master/packages/react-router-dom/modules/BrowserRouter.js" target="_blank" rel="noopener">https://github.com/ReactTraining/react-router/blob/master/packages/react-router-dom/modules/BrowserRouter.js</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Router &#125; <span class="keyword">from</span> <span class="string">"react-router"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createBrowserHistory <span class="keyword">as</span> createHistory &#125; <span class="keyword">from</span> <span class="string">"history"</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">"prop-types"</span>;</span><br><span class="line"><span class="keyword">import</span> warning <span class="keyword">from</span> <span class="string">"tiny-warning"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The public API for a &lt;Router&gt; that uses HTML5 history.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BrowserRouter</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  history = createHistory(<span class="keyword">this</span>.props);</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Router</span> <span class="attr">history</span>=<span class="string">&#123;this.history&#125;</span> <span class="attr">children</span>=<span class="string">&#123;this.props.children&#125;</span> /&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">  BrowserRouter.propTypes = &#123;</span><br><span class="line">    basename: PropTypes.string,</span><br><span class="line">    children: PropTypes.node,</span><br><span class="line">    forceRefresh: PropTypes.bool,</span><br><span class="line">    getUserConfirmation: PropTypes.func,</span><br><span class="line">    keyLength: PropTypes.number</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  BrowserRouter.prototype.componentDidMount = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    warning(</span><br><span class="line">      !<span class="keyword">this</span>.props.history,</span><br><span class="line">      <span class="string">"&lt;BrowserRouter&gt; ignores the history prop. To use a custom history, "</span> +</span><br><span class="line">        <span class="string">"use `import &#123; Router &#125;` instead of `import &#123; BrowserRouter as Router &#125;`."</span></span><br><span class="line">    );</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> BrowserRouter;</span><br></pre></td></tr></table></figure>

<p>æŠ›å¼€ä¸€äº›ä¸ƒä¸ƒå…«å…«çš„åˆ¤æ–­ã€‚é‡æ–°çœ‹ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Router &#125; <span class="keyword">from</span> <span class="string">"react-router"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createBrowserHistory <span class="keyword">as</span> createHistory &#125; <span class="keyword">from</span> <span class="string">"history"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BrowserRouter</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  history = createHistory(<span class="keyword">this</span>.props);</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Router</span> <span class="attr">history</span>=<span class="string">&#123;this.history&#125;</span> <span class="attr">children</span>=<span class="string">&#123;this.props.children&#125;</span> /&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†™ç€å‡ ä¸ªå¤§å­—ï¼šã€Šç“œå­äºŒæ‰‹è½¦ã€‹ä»–åªæ˜¯ä¸€ä¸ªä¸­é—´å•†ï¼Œä»–åœ¨èµšå·®ä»·ã€‚ï¼ˆæ‰“é’±ï¼</p>
<p><code>BrowserRouter</code>æ˜¯ä¾èµ–äºä¸¤ä¸ªåº“ï¼šåˆ†åˆ«ä¸º<code>history</code>å’Œ<code>react-router</code>ã€‚okï¼Œæˆ‘ä»¬ä¸€æ¢ç©¶ç«Ÿã€‚</p>
<h2 id="react-router"><a href="#react-router" class="headerlink" title="react-router"></a>react-router</h2><p>æºç é“¾æ¥ï¼š<a href="https://github.com/ReactTraining/react-router/blob/master/packages/react-router/modules/Router.js" target="_blank" rel="noopener">https://github.com/ReactTraining/react-router/blob/master/packages/react-router/modules/Router.js</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> HistoryContext <span class="keyword">from</span> <span class="string">"./HistoryContext.js"</span>;</span><br><span class="line"><span class="keyword">import</span> RouterContext <span class="keyword">from</span> <span class="string">"./RouterContext.js"</span>;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸¤ä¸ªä¸œè¥¿å…¶å®å¾ˆç®€å•ï¼Œéƒ½æ˜¯å¼•ç”¨äº†ä¸€ä¸ªå«åš<code>createContext</code>ï¼Œç›®çš„ä¹Ÿå¾ˆç®€å•ï¼Œè¿™é‡Œå…¶å®å°±æ˜¯åˆ›å»ºçš„æ™®é€šcontextï¼Œåªä¸è¿‡æ‹¥æœ‰ç‰¹å®šçš„åç§°è€Œå·²ã€‚æºç å¦‚ä¸‹ã€‚å°±å‡ è¡Œã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> Replace with React.createContext once we can assume React 16+</span></span><br><span class="line"><span class="keyword">import</span> createContext <span class="keyword">from</span> <span class="string">"mini-create-react-context"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> createNamedContext = <span class="function"><span class="params">name</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> context = createContext();</span><br><span class="line">  context.displayName = name;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> context;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> createNamedContext;</span><br></pre></td></tr></table></figure>

<p>OKï¼Œé‡ç‚¹æ˜¯æ¥ä¸‹æ¥ï¼ŒæŠ›å¼€contextä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨çš„ä¸œè¥¿ã€‚æˆ‘æ•´ç†ä¸€ä¸‹ã€‚</p>
<p>å…ˆçœ‹æ„é€ å‡½æ•°</p>
<h3 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">  <span class="keyword">super</span>(props);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.state = &#123;</span><br><span class="line">    location: props.history.location</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// This is a bit of a hack. We have to start listening for location</span></span><br><span class="line">  <span class="comment">// changes here in the constructor in case there are any &lt;Redirect&gt;s</span></span><br><span class="line">  <span class="comment">// on the initial render. If there are, they will replace/push when</span></span><br><span class="line">  <span class="comment">// they mount and since cDM fires in children before parents, we may</span></span><br><span class="line">  <span class="comment">// get a new location before the &lt;Router&gt; is mounted.</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// _isMounted è¡¨ç¤ºç»„ä»¶æ˜¯å¦åŠ è½½å®Œæˆ</span></span><br><span class="line">  <span class="keyword">this</span>._isMounted = <span class="literal">false</span>;</span><br><span class="line">  <span class="comment">// ç»„ä»¶æœªåŠ è½½å®Œæ¯•ï¼Œä½†æ˜¯ location å‘ç”Ÿçš„å˜åŒ–ï¼Œæš‚å­˜åœ¨ _pendingLocation å­—æ®µä¸­</span></span><br><span class="line">  <span class="keyword">this</span>._pendingLocation = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ²¡æœ‰ staticContext å±æ€§ï¼Œè¡¨ç¤ºæ˜¯ HashRouter æˆ–æ˜¯ BrowserRouter</span></span><br><span class="line">  <span class="keyword">if</span> (!props.staticContext) &#123;</span><br><span class="line">    <span class="keyword">this</span>.unlisten = props.history.listen(<span class="function"><span class="params">location</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>._isMounted) &#123;</span><br><span class="line">        <span class="comment">// ç»„ä»¶åŠ è½½å®Œæ¯•ï¼Œå°†å˜åŒ–çš„ location æ–¹æ³• state ä¸­</span></span><br><span class="line">        <span class="keyword">this</span>.setState(&#123; location &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>._pendingLocation = location;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ‰ä¸¤ä¸ªå€¼â˜<code>_isMounted</code>å’Œ<code>_pendingLocation</code></p>
<p>åˆ†åˆ«æ˜¯  æ˜¯å¦æŒ‚è½½   å¾…å®š</p>
<p>å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªlocationï¼Œé»˜è®¤å€¼æ˜¯ç”±å¤–é¢ä¼ å…¥çš„historyï¼Œæˆ‘æ‰¾åˆ°ä¼ å…¥çš„åœ°æ–¹ã€‚</p>
<p>å…¶å®å°±æ˜¯ä¹‹å‰çœ‹åˆ°çš„<code>BrowserRouter</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Router &#125; <span class="keyword">from</span> <span class="string">"react-router"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createBrowserHistory <span class="keyword">as</span> createHistory &#125; <span class="keyword">from</span> <span class="string">"history"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BrowserRouter</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  history = createHistory(<span class="keyword">this</span>.props);</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Router</span> <span class="attr">history</span>=<span class="string">&#123;this.history&#125;</span> <span class="attr">children</span>=<span class="string">&#123;this.props.children&#125;</span> /&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸éš¾å‘ç°ï¼Œhistoryçš„é»˜è®¤å€¼å°±æ˜¯ç”±historyè¿™ä¸ªåº“æ¥æä¾›çš„ï¼Œè¿™ä¸ªåé¢ä¼šæåˆ°ï¼Œæˆ‘ä»¬ç»§ç»­çœ‹ã€‚</p>
<p>å…ˆç®€å•çœ‹ä¸€ä¸‹æ³¨é‡Šçš„ç¿»è¯‘(è°·æ­Œç¿»è¯‘)</p>
<blockquote>
<p>è¿™æœ‰ç‚¹hackã€‚ æˆ‘ä»¬å¿…é¡»å¼€å§‹åœ¨æ„é€ å‡½æ•°ä¸­ç›‘å¬ä½ç½®æ›´æ”¹ï¼Œä»¥é˜²åˆå§‹æ¸²æŸ“ä¸­å­˜åœ¨ä»»ä½•<Redirect>ã€‚ å¦‚æœæœ‰çš„è¯ï¼Œå®ƒä»¬å°†åœ¨å®‰è£…æ—¶æ›¿æ¢/æ¨åŠ¨ï¼Œå¹¶ä¸”ç”±äºcDMåœ¨çˆ¶çº§ä¹‹å‰åœ¨å­çº§ä¸­è§¦å‘ï¼Œå› æ­¤åœ¨å®‰è£…<Router>ä¹‹å‰ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šè·å¾—ä¸€ä¸ªæ–°ä½ç½®ã€‚ </p>
</blockquote>
<p>ä»€ä¹ˆæ„æ€å‘¢ï¼Œæˆ‘ç®€å•æè¿°ä¸€ä¸‹ï¼š</p>
<blockquote>
<p>å› ä¸ºå­ç»„ä»¶ä¼šæ¯”çˆ¶ç»„ä»¶æ›´æ—©æ¸²æŸ“å®Œæˆ, ä»¥åŠ<code>&lt;Redirect&gt;</code>çš„å­˜åœ¨, è‹¥æ˜¯åœ¨<code>&lt;Router&gt;</code>çš„<code>componentDidMount</code>ç”Ÿå‘½å‘¨æœŸä¸­å¯¹<code>history.location</code>è¿›è¡Œç›‘å¬, åˆ™æœ‰å¯èƒ½åœ¨ç›‘å¬äº‹ä»¶æ³¨å†Œä¹‹å‰, <code>history.location</code>å·²ç»ç”±äº<code>&lt;Redirect&gt;</code>å‘ç”Ÿäº†å¤šæ¬¡æ”¹å˜, å› æ­¤æˆ‘ä»¬éœ€è¦åœ¨<code>&lt;Router&gt;</code>çš„<code>constructor</code>ä¸­å°±æ³¨å†Œç›‘å¬äº‹ä»¶</p>
</blockquote>
<p>æ”¶å›æ¥ï¼Œè¿›å…¥<code>if</code>ç»§ç»­çœ‹ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.unlisten = props.history.listen(<span class="function"><span class="params">location</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>._isMounted) &#123;</span><br><span class="line">  	<span class="keyword">this</span>.setState(&#123; location &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  	<span class="keyword">this</span>._pendingLocation = location;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>å°±æ˜¯è°ƒç”¨äº†<code>history</code>çš„<code>listen</code>æ–¹æ³•ã€‚ä»ä»£ç ä¸­å¯ä»¥å¤§è‡´äº†è§£åˆ°å°±æ˜¯å¯¹<code>history</code>è¿›è¡Œç›‘å¬ï¼Œç„¶åè¿›è¡Œä¸€äº›æ“ä½œã€‚</p>
<h3 id="componentWillUnmount"><a href="#componentWillUnmount" class="headerlink" title="componentWillUnmount"></a>componentWillUnmount</h3><p>é‚£ä¹ˆè¿™ä¸ª<code>unlisten</code>ä»€ä¹ˆæ—¶å€™æ‰§è¡Œå‘¢ï¼Ÿ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">componentWillUnmount() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.unlisten) &#123;</span><br><span class="line">      <span class="keyword">this</span>.unlisten();</span><br><span class="line">      <span class="keyword">this</span>._isMounted = <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">this</span>._pendingLocation = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨<code>Router</code>è¿™ä¸ªç»„ä»¶å¸è½½çš„æ—¶å€™å°±æ‰§è¡Œå•¦ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå–æ¶ˆäº†å¯¹<code>history</code>çš„ç›‘å¬ã€‚</p>
<h3 id="componentDidUnmount"><a href="#componentDidUnmount" class="headerlink" title="componentDidUnmount"></a>componentDidUnmount</h3><p>ç„¶åçœ‹ä¸€ä¸‹<code>conponentDidMount</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">this</span>._isMounted = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>._pendingLocation) &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123; <span class="attr">location</span>: <span class="keyword">this</span>._pendingLocation &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯ä¿®æ”¹ä¸€ä¸‹æ˜¯å¦æŒ‚è½½çš„å€¼ï¼Œä»¥åŠç»§ç»­ä¹‹å‰åœ¨æ„é€ å‡½æ•°é‡Œé¢çš„åˆ¤æ–­ã€‚å¦‚æœæš‚å­˜æ•°æ®æœ‰çš„è¯å°±æŠŠä»–å­˜ä¸‹æ¥ã€‚</p>
<h3 id="render"><a href="#render" class="headerlink" title="render"></a>render</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;RouterContext.Provider</span><br><span class="line">        value&#x3D;&#123;&#123;</span><br><span class="line">          &#x2F;&#x2F; æ ¹æ® HashRouter è¿˜æ˜¯ BrowserRouterï¼Œå¯åˆ¤æ–­ history ç±»å‹</span><br><span class="line">          history: this.props.history,</span><br><span class="line">          &#x2F;&#x2F; è¿™ä¸ª location å°±æ˜¯ç›‘å¬ history å˜åŒ–å¾—åˆ°çš„ location</span><br><span class="line">          location: this.state.location,</span><br><span class="line">          &#x2F;&#x2F; path url params isExact å››ä¸ªå±æ€§</span><br><span class="line">          match: Router.computeRootMatch(this.state.location.pathname),</span><br><span class="line">          &#x2F;&#x2F; åªæœ‰ StaticRouter ä¼šä¼  staticContext</span><br><span class="line">          &#x2F;&#x2F; HashRouter å’Œ BrowserRouter éƒ½æ˜¯ null</span><br><span class="line">          staticContext: this.props.staticContext</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;HistoryContext.Provider</span><br><span class="line">          children&#x3D;&#123;this.props.children || null&#125;</span><br><span class="line">          value&#x3D;&#123;this.props.history&#125;</span><br><span class="line">        &#x2F;&gt;</span><br><span class="line">      &lt;&#x2F;RouterContext.Provider&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>Routerè¿™ä¸ªç»„ä»¶ä¸»è¦å°±æ˜¯å°†ä¸€äº›æ•°æ®è¿›è¡Œå­˜å‚¨ã€‚å­˜åˆ°<code>Context</code>ï¼Œä¹‹é—´ä¸ä¹ä¸€äº›ç‰¹æ®Šæƒ…å†µçš„åˆ¤æ–­ï¼Œæ¯”å¦‚å­ç»„ä»¶æ¸²æŸ“æ¯”çˆ¶ç»„ä»¶æ—©ï¼Œä»¥åŠ<code>Redirect</code>çš„æƒ…å†µçš„å¤„ç†ã€‚åœ¨å¸è½½çš„æ—¶å€™è¦ç§»é™¤å¯¹<code>history</code>çš„ç›‘å¬ã€‚</p>
<p>å­ç»„ä»¶ä½œä¸ºæ¶ˆè´¹è€…ï¼Œå°±å¯ä»¥å¯¹é¡µé¢è¿›è¡Œä¿®æ”¹ï¼Œè·³è½¬ï¼Œè·å–è¿™äº›æ•°å€¼ã€‚</p>
<h2 id="history"><a href="#history" class="headerlink" title="history"></a>history</h2><h3 id="createBrowserHistory"><a href="#createBrowserHistory" class="headerlink" title="createBrowserHistory"></a>createBrowserHistory</h3><h4 id="è¿”å›çš„å†…å®¹"><a href="#è¿”å›çš„å†…å®¹" class="headerlink" title="è¿”å›çš„å†…å®¹"></a>è¿”å›çš„å†…å®¹</h4><p>ä¹‹å‰ä¸€ç›´æœ‰ä¸æ–­æåˆ°çš„<code>history</code>ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹å®ƒæ˜¯è°</p>
<p>æºç è¿æ¥ï¼š<a href="https://github.com/ReactTraining/history/blob/master/packages/history/index.ts" target="_blank" rel="noopener">https://github.com/ReactTraining/history/blob/master/packages/history/index.ts</a></p>
<p>æˆ‘ä»¬ä¹‹å‰ç”¨åˆ°çš„<code>createBrowserHistory</code>ï¼Œä»–å…¶å®æ˜¯è¿”å›çš„ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡é‡Œé¢æœ‰æˆ‘ä»¬å¸¸ç”¨çš„ä¸€äº›æ–¹æ³•ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> history: BrowserHistory = &#123;</span><br><span class="line">    <span class="keyword">get</span> action() &#123;</span><br><span class="line">      <span class="keyword">return</span> action;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">get</span> location() &#123;</span><br><span class="line">      <span class="keyword">return</span> location;</span><br><span class="line">    &#125;,</span><br><span class="line">    createHref,</span><br><span class="line">    push,</span><br><span class="line">    replace,</span><br><span class="line">    go,</span><br><span class="line">    back() &#123;</span><br><span class="line">      go(<span class="number">-1</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    forward() &#123;</span><br><span class="line">      go(<span class="number">1</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    listen(listener) &#123;</span><br><span class="line">      <span class="keyword">return</span> listeners.push(listener);</span><br><span class="line">    &#125;,</span><br><span class="line">    block(blocker) &#123;</span><br><span class="line">      <span class="keyword">let</span> unblock = blockers.push(blocker);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (blockers.length === <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">window</span>.addEventListener(BeforeUnloadEventType, promptBeforeUnload);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        unblock();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Remove the beforeunload listener so the document may</span></span><br><span class="line">        <span class="comment">// still be salvageable in the pagehide event.</span></span><br><span class="line">        <span class="comment">// See https://html.spec.whatwg.org/#unloading-documents</span></span><br><span class="line">        <span class="keyword">if</span> (!blockers.length) &#123;</span><br><span class="line">          <span class="built_in">window</span>.removeEventListener(BeforeUnloadEventType, promptBeforeUnload);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> history;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¤§éƒ¨åˆ†ç²¾é«“å°±æ˜¯è¿™é‡Œã€‚å‘ç°æœ‰å¤šç†Ÿæ‚‰çš„ä¼™ä¼´ï¼ =&gt; <code>push</code>ã€<code>replace</code>ã€<code>go</code>ç­‰ç­‰ã€‚æœ‰äº›å…¶å®éƒ½æ˜¯<code>window</code>æä¾›çš„ã€‚</p>
<p>æœ‰äº›ç›´æ¥çœ‹ä»£ç å°±å¯ä»¥æ˜ç™½çš„å°±ä¸è§£é‡Šäº†ï¼Œæ¯”å¦‚<code>forward</code>ï¼Œ<code>back</code>ã€‚</p>
<h5 id="go"><a href="#go" class="headerlink" title="go"></a>go</h5><p>æ¯”å¦‚ä¸Šé¢æåˆ°çš„<code>go</code>æ–¹æ³•ï¼Œæˆªå–éƒ¨åˆ†æºç ã€‚</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> globalHistory = <span class="built_in">window</span>.history;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">go</span>(<span class="params">delta: <span class="built_in">number</span></span>) </span>&#123;</span><br><span class="line">    globalHistory.go(delta);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



<h5 id="createHref"><a href="#createHref" class="headerlink" title="createHref"></a>createHref</h5><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›ä¸€ä¸ªå®Œæ•´çš„url</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createPath</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  pathname = '/',</span></span></span><br><span class="line"><span class="function"><span class="params">  search = '',</span></span></span><br><span class="line"><span class="function"><span class="params">  hash = ''</span></span></span><br><span class="line"><span class="function"><span class="params">&#125;: PartialPath</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> pathname + search + hash;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›ä¸€ä¸ªurl</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createHref</span>(<span class="params">to: To</span>) </span>&#123;</span><br><span class="line">  	<span class="comment">// çœ‹ä¸Šé¢</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">typeof</span> to === <span class="string">'string'</span> ? to : createPath(to);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



<h5 id="push"><a href="#push" class="headerlink" title="push"></a>push</h5><p><code>push</code>çš„æºç ï¼Œé‡Œé¢é™„å¸¦äº†ä¸€äº›ä¼šç”¨åˆ°çš„å‡½æ•°ã€‚</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°±æ˜¯ç®€å•å¤„ç†ä¸€ä¸‹è¿”å›å€¼ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getNextLocation</span>(<span class="params">to: To, state: State = <span class="literal">null</span></span>): <span class="title">Location</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> readOnly&lt;Location&gt;(&#123;</span><br><span class="line">    ...location,</span><br><span class="line">    ...(<span class="keyword">typeof</span> to === <span class="string">'string'</span> ? parsePath(to) : to),</span><br><span class="line">    state,</span><br><span class="line">    key: createKey()</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿›è¡Œåˆ¤æ–­</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">allowTx</span>(<span class="params">action: Action, location: Location, retry: () =&gt; <span class="built_in">void</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="comment">// é•¿åº¦ä¸º0å°±è¿”å›trueï¼Œé•¿åº¦å¤§äº0å°±è°ƒç”¨å‡½æ•°ï¼Œå¹¶ä¼ å…¥å‚æ•°ã€‚è¿™ä¸ªblockersç­‰ä¸€ä¸‹ä»”ç»†æ¢è®¨ä¸€ä¸‹</span></span><br><span class="line">      !blockers.length || (blockers.call(&#123; action, location, retry &#125;), <span class="literal">false</span>)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// é¡¾åæ€ä¹‰è·å–stateå’Œurl</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getHistoryStateAndUrl</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    nextLocation: Location,</span></span></span><br><span class="line"><span class="function"><span class="params">    index: <span class="built_in">number</span></span></span></span><br><span class="line"><span class="function"><span class="params">  </span>): [<span class="title">HistoryState</span>, <span class="title">string</span>] </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">      &#123;</span><br><span class="line">        usr: nextLocation.state,</span><br><span class="line">        key: nextLocation.key,</span><br><span class="line">        idx: index</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// çœ‹ä¸Šé¢ æœ‰ä¸“é—¨ä»‹ç»</span></span><br><span class="line">      createHref(nextLocation)</span><br><span class="line">    ];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›ä¸€äº›å…³äºlocationçš„ä¿¡æ¯</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getIndexAndLocation</span>(<span class="params"></span>): [<span class="title">number</span>, <span class="title">Location</span>] </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; pathname, search, hash &#125; = <span class="built_in">window</span>.location;</span><br><span class="line">    <span class="keyword">let</span> state = globalHistory.state || &#123;&#125;;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">      state.idx,</span><br><span class="line">      readOnly&lt;Location&gt;(&#123;</span><br><span class="line">        pathname,</span><br><span class="line">        search,</span><br><span class="line">        hash,</span><br><span class="line">        state: state.usr || <span class="literal">null</span>,</span><br><span class="line">        key: state.key || <span class="string">'default'</span></span><br><span class="line">      &#125;)</span><br><span class="line">    ];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œlistenerså†…éƒ¨çš„ä¸€äº›å‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯è·³è½¬ï¼‰ï¼Œåé¢ä¹Ÿä¼šè¯¦ç»†è§£è¯»</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">applyTx</span>(<span class="params">nextAction: Action</span>) </span>&#123;</span><br><span class="line">    action = nextAction;</span><br><span class="line">    [index, location] = getIndexAndLocation();</span><br><span class="line">    listeners.call(&#123; action, location &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">push</span>(<span class="params">to: To, state?: State</span>) </span>&#123;</span><br><span class="line">  	<span class="comment">// è¿™é‡Œæ˜¯ä¸€ä¸ªæšä¸¾å€¼</span></span><br><span class="line">    <span class="keyword">let</span> nextAction = Action.Push;</span><br><span class="line">  	</span><br><span class="line">    <span class="keyword">let</span> nextLocation = getNextLocation(to, state);</span><br><span class="line">  	<span class="comment">// é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å†æ¥ä¸€æ¬¡</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">retry</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      push(to, state);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (allowTx(nextAction, nextLocation, retry)) &#123;</span><br><span class="line">      <span class="keyword">let</span> [historyState, url] = getHistoryStateAndUrl(nextLocation, index + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// <span class="doctag">TODO:</span> Support forced reloading</span></span><br><span class="line">      <span class="comment">// try...catch because iOS limits us to 100 pushState calls :/</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// MDNçš„åœ°å€: https://developer.mozilla.org/zh-CN/docs/Web/API/History/pushState</span></span><br><span class="line">        globalHistory.pushState(historyState, <span class="string">''</span>, url);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="comment">// They are going to lose state here, but there is no real</span></span><br><span class="line">        <span class="comment">// way to warn them about it since the page will refresh...</span></span><br><span class="line">        <span class="comment">// MDNçš„åœ°å€: https://developer.mozilla.org/zh-CN/docs/Web/API/Location/assign</span></span><br><span class="line">        <span class="built_in">window</span>.location.assign(url);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      applyTx(nextAction);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘åœ¨æ³¨é‡Šé‡Œé¢å·²ç»è¿›è¡Œéå¸¸è¯¦ç»†çš„è§£è¯»äº†ï¼Œç”¨åˆ°çš„æ¯ä¸ªå‡½æ•°éƒ½æœ‰è§£é‡Šæˆ–è€…å®˜æ–¹æƒå¨çš„urlã€‚</p>
<p>æ€»ç»“ä¸€ä¸‹ï¼š<code>history.push</code>çš„ä¸€ä¸ªå®Œæ•´æµç¨‹</p>
<ul>
<li>è°ƒç”¨<code>history.pushState</code><ul>
<li>é”™è¯¯ç”±<code>window.location.assign</code>æ¥å¤„ç†</li>
</ul>
</li>
<li>æ‰§è¡Œä¸€ä¸‹<code>listeners</code>é‡Œé¢çš„å‡½æ•°</li>
</ul>
<p>æ˜¯çš„ï¼Œä½ æ²¡æœ‰çœ‹é”™ï¼Œå°±è¿™ä¹ˆç®€å•ï¼Œåªæ˜¯é‡Œé¢æœ‰å¾ˆå¤šè°ƒç”¨çš„å‡½æ•°ï¼Œæˆ‘éƒ½æˆªå–å‡ºæ¥ä¸€ä¸€è§£é‡Šï¼Œåšåˆ°æ¯è¡Œä»£ç éƒ½ç†è§£ï¼Œæ‰€ä»¥æ˜¾å¾—æ¯”è¾ƒé•¿ï¼Œæ¦‚æ‹¬æ¥è¯´å°±æ˜¯è¿™ä¹ˆç®€å•ã€‚</p>
<p>é‡ç‚¹æ¥çœ‹ä¸€ä¸‹<code>listen</code>å’Œè¢«è°ƒç”¨çš„<code>createBrowserHistory</code></p>
<h5 id="replace"><a href="#replace" class="headerlink" title="replace"></a>replace</h5><p>è¿™é‡Œé¢ç”¨çš„å‡½æ•°ï¼Œåœ¨å‰é¢çš„pushéƒ½æœ‰è§£æï¼Œå¯ä»¥å¾€ä¸Šé¢å»æ‰¾æ‰¾ï¼Œå°±ä¸å¤šèµ˜è¿°äº†ã€‚</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">replace</span>(<span class="params">to: To, state?: State</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> nextAction = Action.Replace;</span><br><span class="line">    <span class="keyword">let</span> nextLocation = getNextLocation(to, state);</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">retry</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      replace(to, state);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (allowTx(nextAction, nextLocation, retry)) &#123;</span><br><span class="line">      <span class="keyword">let</span> [historyState, url] = getHistoryStateAndUrl(nextLocation, index);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// <span class="doctag">TODO:</span> Support forced reloading</span></span><br><span class="line">      globalHistory.replaceState(historyState, <span class="string">''</span>, url);</span><br><span class="line"></span><br><span class="line">      applyTx(nextAction);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



<h5 id="listen"><a href="#listen" class="headerlink" title="listen"></a>listen</h5><p>åœ¨<code>history</code>è¿”å›çš„<code>listen</code>æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°æˆ‘ä»¬ä¹‹å‰åœ¨react-routerçš„æºç ä¸­å‘ç°ï¼Œä»–æ˜¯åœ¨æ„é€ å‡½æ•°å’Œå¸è½½çš„æ—¶å€™ä¼šç”¨åˆ°ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">listen(listener) &#123;</span><br><span class="line">      <span class="keyword">return</span> listeners.push(listener);</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<p>ä»”ç»†çœ‹çœ‹ï¼Œè¿™ä¸ª<code>listeners</code>æ˜¯åœ¨åšäº›ä»€ä¹ˆã€‚</p>
<h5 id="createEvents"><a href="#createEvents" class="headerlink" title="createEvents"></a>createEvents</h5><p>è¿™ä¸ªå‡½æ•°åé¢çš„blockersä¹Ÿä¼šç”¨åˆ°</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> listeners = createEvents&lt;Listener&gt;();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createEvents</span>&lt;<span class="title">F</span> <span class="title">extends</span> <span class="title">Function</span>&gt;(<span class="params"></span>): <span class="title">Events</span>&lt;<span class="title">F</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> handlers: F[] = [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> length() &#123;</span><br><span class="line">      <span class="keyword">return</span> handlers.length;</span><br><span class="line">    &#125;,</span><br><span class="line">    push(fn: F) &#123;</span><br><span class="line">      handlers.push(fn);</span><br><span class="line">      <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        handlers = handlers.filter(<span class="function"><span class="params">handler</span> =&gt;</span> handler !== fn);</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    call(arg) &#123;</span><br><span class="line">      handlers.forEach(<span class="function"><span class="params">fn</span> =&gt;</span> fn &amp;&amp; fn(arg));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ–¹æ³•ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯åˆ›å»ºäº‹ä»¶ã€‚å®šä¹‰äº†ä¸€ä¸ªå˜é‡ <code>handlers</code> æ•°ç»„ï¼Œç”¨äºå­˜æ”¾è¦å¤„ç†çš„å›è°ƒå‡½æ•°äº‹ä»¶ã€‚</p>
<p>ç„¶åè¿”å›äº†ä¸€ä¸ªå¯¹è±¡ã€‚</p>
<p><code>push</code> æ–¹æ³•å°±æ˜¯å¾€ <code>handlers</code> ä¸­æ·»åŠ è¦æ‰§è¡Œçš„å‡½æ•°ã€‚</p>
<p>è¿™å—ä¸»è¦åœ¨ <code>history.listen()</code> ä¸­ä½¿ç”¨ï¼Œå¯ä»¥ç¿»åˆ°å¼€å¤´çœ‹ä¸‹ <code>history</code> ä¸­è¿”å›äº† <code>listen()</code> æ–¹æ³•ï¼Œå°±æ˜¯è°ƒç”¨äº†<code>listeners.push(listener)</code> ã€‚</p>
<p>æœ€å <code>call()</code> æ–¹æ³•å°±æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œå°±æ˜¯å–å‡º <code>handlers</code> é‡Œé¢çš„å›è°ƒå‡½æ•°å¹¶é€ä¸ªæ‰§è¡Œã€‚</p>
<p>æ€»ç»“ä¸€ä¸‹ï¼Œå°±æ˜¯å­˜å‚¨ä¸€ä¸‹<code>push</code>è¿›æ¥çš„å‡½æ•°ï¼Œå¹¶è¿›è¡Œè¿‡æ»¤ã€‚ä¹‹åè°ƒç”¨çš„æ—¶å€™ä¼šä¾æ¬¡æ‰§è¡Œã€‚<code>length</code>å°±æ˜¯å½“å‰æ‹¥æœ‰çš„å‡½æ•°æ•°é‡ã€‚</p>
<p>å†åˆ‡å›å»ï¼Œå°±ä¼šå‘ç°ï¼Œæ¯æ¬¡è°ƒç”¨è¿™ä¸ª<code>listen</code>å°±ç›¸å½“äº<code>push</code>ä¸€ä¸ªå‡½æ•°åˆ°å†…éƒ¨çš„ä¸€ä¸ªå˜é‡<code>handlers</code>ä¸­ã€‚</p>
<h5 id="block"><a href="#block" class="headerlink" title="block"></a>block</h5><p>å’Œ<code>listeners</code>ä¸€æ ·ï¼Œä¹Ÿæ˜¯ç”¨<code>createEvents</code>åˆ›å»ºçš„ï¼Œå°±ä¸å¤šè¯´å•¦ã€‚è¯´ä¸€ä¸‹å“ªé‡Œä¼šç”¨åˆ°è¿™ä¸ªå§ã€‚</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> blockers = createEvents&lt;Blocker&gt;();</span><br></pre></td></tr></table></figure>

<ul>
<li><code>block(prompt)</code> - (function) Prevents navigation (see <a href="https://github.com/ReactTraining/history/blob/master/docs/blocking-transitions.md" target="_blank" rel="noopener">the history docs</a>)</li>
</ul>
<p>è¿™ä¸ªæ˜¯<code>react-router</code>å®˜ç½‘çš„è§£é‡Šã€‚</p>
<p>æˆ‘è¿™é‡Œç®€å•æ¦‚æ‹¬ä¸€ä¸‹ï¼Œå°±æ˜¯ç”¨äºå…³é—­æˆ–è€…å›é€€æµè§ˆå™¨çš„è¯¯æ“ä½œä¼šç”¨åˆ°çš„ã€‚è¯¦ç»†çš„å¯ä»¥çœ‹ç‚¹å‡»è¿›å»æŸ¥çœ‹ã€‚</p>
<h5 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h5><p>è‡³æ­¤ï¼Œæˆ‘ä»¬è°ƒç”¨çš„<code>createBrowserHistory</code>æ‰€è¿”å›çš„ä¸€äº›å±æ€§çš„æºç éƒ½å·²ç»äº†å¦‚æŒ‡æŒäº†ã€‚ä½†æ˜¯å…·ä½“æ˜¯æ€ä¹ˆå·¥ä½œè¿˜æ˜¯ä¸€çŸ¥åŠè§£ã€‚</p>
<h4 id="å…·ä½“æ ¸å¿ƒåŸç†"><a href="#å…·ä½“æ ¸å¿ƒåŸç†" class="headerlink" title="å…·ä½“æ ¸å¿ƒåŸç†"></a>å…·ä½“æ ¸å¿ƒåŸç†</h4><p>å…ˆç§€ä¸€ä¸‹æºç ã€‚historyçš„æ ¸å¿ƒåŸç†å°±æ˜¯è¿™ä¸ªã€‚å…ˆåˆ«è¢«è¿™ä¹ˆå¤šè¡Œä»£ç å”¬åˆ°äº†ï¼Œå¾ˆå¤šéƒ½æ˜¯æˆ‘ä»¬åœ¨ä¹‹å‰çš„pushé‡Œé¢æœ‰è§£é‡Šçš„</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> PopStateEventType = <span class="string">'popstate'</span>;</span><br><span class="line"><span class="keyword">let</span> blockedPopTx: Transition | <span class="literal">null</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handlePop</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å¦‚æœæœ‰</span></span><br><span class="line">  <span class="keyword">if</span> (blockedPopTx) &#123;</span><br><span class="line">    blockers.call(blockedPopTx);</span><br><span class="line">    blockedPopTx = <span class="literal">null</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> nextAction = Action.Pop;</span><br><span class="line">    <span class="keyword">let</span> [nextIndex, nextLocation] = getIndexAndLocation();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (blockers.length) &#123;</span><br><span class="line">      <span class="keyword">if</span> (nextIndex != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> delta = index - nextIndex;</span><br><span class="line">        <span class="keyword">if</span> (delta) &#123;</span><br><span class="line">          <span class="comment">// Revert the POP</span></span><br><span class="line">          blockedPopTx = &#123;</span><br><span class="line">            action: nextAction,</span><br><span class="line">            location: nextLocation,</span><br><span class="line">            retry() &#123;</span><br><span class="line">              go(delta * <span class="number">-1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;;</span><br><span class="line"></span><br><span class="line">          go(delta);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Trying to POP to a location with no index. We did not create</span></span><br><span class="line">        <span class="comment">// this location, so we can't effectively block the navigation.</span></span><br><span class="line">        warning(</span><br><span class="line">          <span class="literal">false</span>,</span><br><span class="line">          <span class="comment">// <span class="doctag">TODO:</span> Write up a doc that explains our blocking strategy in</span></span><br><span class="line">          <span class="comment">// detail and link to it here so people can understand better what</span></span><br><span class="line">          <span class="comment">// is going on and how to avoid it.</span></span><br><span class="line">          <span class="string">`You are trying to block a POP navigation to a location that was not `</span> +</span><br><span class="line">          <span class="string">`created by the history library. The block will fail silently in `</span> +</span><br><span class="line">          <span class="string">`production, but in general you should do all navigation with the `</span> +</span><br><span class="line">          <span class="string">`history library (instead of using window.history.pushState directly) `</span> +</span><br><span class="line">          <span class="string">`to avoid this situation.`</span></span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      applyTx(nextAction);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.addEventListener(PopStateEventType, handlePop);</span><br></pre></td></tr></table></figure>

<p>é‡ç‚¹è¯´ä¸€ä¸‹<code>window.addEventListener(PopStateEventType, handlePop)</code></p>
<p>MDNåœ°å€ï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/popstate_event" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/API/Window/popstate_event</a></p>
<p>å…¶å®å°±æ˜¯ç›‘å¬è·¯ç”±çš„å˜åŒ–ç„¶åï¼Œæ‰§è¡Œå›è°ƒå‡½æ•°</p>
<h3 id="createHashHistory"><a href="#createHashHistory" class="headerlink" title="createHashHistory"></a>createHashHistory</h3><p>è¿™ä¸ªå¤§ä½“ä¸Šä¸æ™®é€šè·¯ç”±ä¸€è‡´ã€‚è¿™é‡Œæˆ‘æƒ³å¼ºè°ƒä¸€äº›é—®é¢˜ã€‚</p>
<blockquote>
<p>æ¯”å¦‚å“ˆå¸Œè·¯ç”±çš„é”šç‚¹é—®é¢˜ï¼Œæˆ‘è‡ªå·±å·²çŸ¥çš„å‡ ä¸ªæ–¹æ¡ˆ</p>
<ul>
<li><h3 id="scrollIntoView"><a href="#scrollIntoView" class="headerlink" title="scrollIntoView"></a><a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollIntoView" target="_blank" rel="noopener">scrollIntoView</a></h3></li>
<li><h3 id="scrollTop"><a href="#scrollTop" class="headerlink" title="scrollTop"></a><a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollTop" target="_blank" rel="noopener">scrollTop</a></h3></li>
<li><h2 id="react-anchor-without-hash"><a href="#react-anchor-without-hash" class="headerlink" title="react-anchor-without-hash"></a><a href="https://github.com/kwzm/react-anchor-without-hash" target="_blank" rel="noopener">react-anchor-without-hash</a></h2></li>
</ul>
</blockquote>
<p>æ„Ÿå…´è¶£çš„è‡ªå·±æŸ¥è¯¢ä¸€ä¸‹ï¼Œè¿™ä¸ªä¸åœ¨æœ¬æ¬¡çš„è®¨è®ºèŒƒå›´å†…ã€‚</p>
<h4 id="å…·ä½“æ ¸å¿ƒåŸç†-1"><a href="#å…·ä½“æ ¸å¿ƒåŸç†-1" class="headerlink" title="å…·ä½“æ ¸å¿ƒåŸç†"></a>å…·ä½“æ ¸å¿ƒåŸç†</h4><p>ä¹‹å‰è¯´çš„åˆ°ï¼Œ<code>history</code>è·¯ç”±çš„æ ¸å¿ƒæ˜¯<code>window.addEventListener(PopStateEventType, handlePop);</code></p>
<p>è€Œå“ˆå¸Œè·¯ç”±çš„æ ¸å¿ƒä¹Ÿæ˜¯ç›‘å¬è·¯ç”±çš„å˜åŒ–ï¼Œåªæ˜¯å‚æ•°ä¸åŒã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'hashchange'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">    <span class="comment">/* ç›‘å¬æ”¹å˜ */</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>è€Œå¯¹è·¯ç”±çš„æ”¹å˜ã€‚<code>history</code>è·¯ç”±æ˜¯ï¼š<code>history.pushState</code>ï¼Œ<code>history.replaceState</code>ã€‚</p>
<p>å“ˆå¸Œè·¯ç”±æ˜¯ï¼š</p>
<p><code>window.location.hash</code></p>
<p>é€šè¿‡<code>window.location.hash</code>å±æ€§è·å–å’Œè®¾ç½® <code>hash</code>å€¼ã€‚</p>
<p>å…·ä½“çš„è¯å¾ˆå·®ä¸å¤šï¼Œå…³å¿ƒç»†èŠ‚çš„ä¼™ä¼´å¯ä»¥å»çœ‹å…¶æºç å“¦ã€‚</p>
<h1 id="æ ¸å¿ƒAPI"><a href="#æ ¸å¿ƒAPI" class="headerlink" title="æ ¸å¿ƒAPI"></a>æ ¸å¿ƒAPI</h1><p>ä¹‹å‰æˆ‘ä»¬çœ‹äº†BrowserRouterã€‚æˆ‘ä»¬å›è¿‡å¤´æ¥çœ‹çœ‹ï¼Œdemoä¸­çš„å®ä¾‹ä»£ç è¿˜æœ‰å¤šå°‘æ²¡æœ‰è§£å†³ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">import React from &#39;react&#39;;</span><br><span class="line">import &#123;</span><br><span class="line">  BrowserRouter as Router,</span><br><span class="line">  Switch,</span><br><span class="line">  Route,</span><br><span class="line">  Link,</span><br><span class="line">&#125; from &quot;react-router-dom&quot;;</span><br><span class="line"></span><br><span class="line">function Home() &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;h1&gt;é¦–é¡µ&lt;&#x2F;h1&gt;</span><br><span class="line">      &lt;Link to&#x3D;&quot;&#x2F;login&quot;&gt;ç™»å½•&lt;&#x2F;Link&gt;</span><br><span class="line">    &lt;&#x2F;&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Login() &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;h1&gt;ç™»å½•é¡µ&lt;&#x2F;h1&gt;</span><br><span class="line">      &lt;Link to&#x3D;&quot;&#x2F;&quot;&gt;å›é¦–é¡µ&lt;&#x2F;Link&gt;</span><br><span class="line">    &lt;&#x2F;&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function App() &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;Router&gt;</span><br><span class="line">      &lt;Switch&gt;</span><br><span class="line">        &lt;Route path&#x3D;&quot;&#x2F;login&quot; component&#x3D;&#123;Login&#125;&#x2F;&gt;</span><br><span class="line">        &lt;Route path&#x3D;&quot;&#x2F;&quot; component&#x3D;&#123;Home&#125;&#x2F;&gt;</span><br><span class="line">      &lt;&#x2F;Switch&gt;</span><br><span class="line">    &lt;&#x2F;Router&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default App;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å·²ç»çœ‹å®Œäº†<code>BrowserRouter</code>ï¼ˆ<code>Router</code>ã€‚ä¸‹é¢è¿˜æœ‰<code>Switch</code>å’Œ<code>Route</code>ã€‚</p>
<h2 id="Switch"><a href="#Switch" class="headerlink" title="Switch"></a>Switch</h2><p>å…ˆä¸Šæºç ã€‚æˆ‘æ‘˜å–æœ€æ ¸å¿ƒçš„ä¸€éƒ¨åˆ†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">class Switch extends React.Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;RouterContext.Consumer&gt;</span><br><span class="line">        &#123;context &#x3D;&gt; &#123;</span><br><span class="line">          invariant(context, &quot;You should not use &lt;Switch&gt; outside a &lt;Router&gt;&quot;);</span><br><span class="line"></span><br><span class="line">          &#x2F;&#x2F; é»˜è®¤ä½¿ç”¨context.locationï¼Œå¦‚æœæœ‰ç‰¹æ®Šå®šåˆ¶çš„locationæ‰ä¼šä½¿ç”¨ã€‚</span><br><span class="line">          &#x2F;&#x2F; ä¸‹é¢æœ‰ä»‹ç»</span><br><span class="line">          const location &#x3D; this.props.location || context.location;</span><br><span class="line"></span><br><span class="line">          let element, match;</span><br><span class="line"></span><br><span class="line">          &#x2F;&#x2F; We use React.Children.forEach instead of React.Children.toArray().find()</span><br><span class="line">          &#x2F;&#x2F; here because toArray adds keys to all child elements and we do not want</span><br><span class="line">          &#x2F;&#x2F; to trigger an unmount&#x2F;remount for two &lt;Route&gt;s that render the same</span><br><span class="line">          &#x2F;&#x2F; component at different URLs.</span><br><span class="line">          &#x2F;&#x2F; React.Children.forEach å¯¹å­å…ƒç´ åšéå†</span><br><span class="line">          React.Children.forEach(this.props.children, child &#x3D;&gt; &#123;</span><br><span class="line">            &#x2F;&#x2F; åªè¦æ‰¾åˆ°ä¸€ä¸ª matchï¼Œé‚£ä¹ˆå°±ä¸ä¼šå†è¿›æ¥äº†</span><br><span class="line">            if (match &#x3D;&#x3D; null &amp;&amp; React.isValidElement(child)) &#123;</span><br><span class="line">              element &#x3D; child;</span><br><span class="line"></span><br><span class="line">              &#x2F;&#x2F; child.props.path å°±ä¸å¤šè®²äº†ï¼Œ Route çš„æ ‡å‡†å†™æ³•</span><br><span class="line">              &#x2F;&#x2F; éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ from ä¹Ÿä¼šè¢«åŒ¹é…åˆ°</span><br><span class="line">              &#x2F;&#x2F; ä»»ä½•ç»„ä»¶ï¼Œåªè¦åœ¨ Switch ä¸‹ï¼Œæœ‰ from å±æ€§ï¼Œå¹¶ä¸”å’Œå½“å‰è·¯å¾„åŒ¹é…ï¼Œå°±ä¼šè¢«æ¸²æŸ“</span><br><span class="line">              &#x2F;&#x2F; fromå…·ä½“æ˜¯ç»™&lt;Redirect&gt;ä½¿ç”¨çš„ï¼Œåé¢ä¼šè¯´åˆ°</span><br><span class="line">              const path &#x3D; child.props.path || child.props.from;</span><br><span class="line"></span><br><span class="line">              &#x2F;&#x2F; åˆ¤æ–­ç»„ä»¶æ˜¯å¦åŒ¹é…</span><br><span class="line">              match &#x3D; path</span><br><span class="line">              &#x2F;&#x2F; ä¸‹é¢æœ‰ä¸“å±çš„ä»‹ç»è¿™ä¸ªå‡½æ•°</span><br><span class="line">                ? matchPath(location.pathname, &#123; ...child.props, path &#125;)</span><br><span class="line">                : context.match;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line"></span><br><span class="line">          return match</span><br><span class="line">            ? React.cloneElement(element, &#123; location, computedMatch: match &#125;)</span><br><span class="line">            : null;</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      &lt;&#x2F;RouterContext.Consumer&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Switchä¸­çš„locationè¿™ä¸ªpropsæ€ä¹ˆç”¨ï¼Ÿä»€ä¹ˆç”¨ï¼Ÿ</p>
<blockquote>
<h2 id="æ‘˜è‡ªå®˜ç½‘"><a href="#æ‘˜è‡ªå®˜ç½‘" class="headerlink" title="æ‘˜è‡ªå®˜ç½‘"></a>æ‘˜è‡ªå®˜ç½‘</h2><h2 id="location-object"><a href="#location-object" class="headerlink" title="location: object"></a><a href="https://reactrouter.com/web/api/Switch/location-object" target="_blank" rel="noopener">location: object</a></h2><p>A <a href="https://reactrouter.com/web/api/location" target="_blank" rel="noopener"><code>location</code></a> object to be used for matching children elements instead of the current history location (usually the current browser URL).</p>
<p>è°·æ­Œç¿»è¯‘ï¼šç”¨äºåŒ¹é…å­å…ƒç´ çš„ä½ç½®å¯¹è±¡ï¼Œè€Œä¸æ˜¯å½“å‰å†å²è®°å½•ä½ç½®ï¼ˆé€šå¸¸æ˜¯å½“å‰æµè§ˆå™¨URLï¼‰ã€‚</p>
</blockquote>
<h3 id="matchPath"><a href="#matchPath" class="headerlink" title="matchPath"></a>matchPath</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">matchPath</span>(<span class="params">pathname, options = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è§„èŒƒç»“æ„ä½“</span></span><br><span class="line">  <span class="comment">// å¦‚æœ options ä¼ çš„æ˜¯ä¸ª stringï¼Œé‚£é»˜è®¤è¿™ä¸ª string ä»£è¡¨ path</span></span><br><span class="line">  <span class="comment">// å¦‚æœ options ä¼ çš„æ˜¯ä¸ª æ•°ç»„ï¼Œé‚£åªè¦æœ‰ä¸€ä¸ªåŒ¹é…ï¼Œå°±è®¤ä¸ºåŒ¹é…</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> options === <span class="string">"string"</span> || <span class="built_in">Array</span>.isArray(options)) &#123;</span><br><span class="line">    options = &#123; <span class="attr">path</span>: options &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; path, exact = <span class="literal">false</span>, strict = <span class="literal">false</span>, sensitive = <span class="literal">false</span> &#125; = options;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è½¬åŒ–æˆæ•°ç»„è¿›è¡Œåˆ¤æ–­</span></span><br><span class="line">  <span class="keyword">const</span> paths = [].concat(path);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// éƒ½æ˜¯å¾ˆç®€å•çš„å†…å®¹ï¼Œéš¾ç‚¹å°±åœ¨è¿™ä¸ªreduceï¼Œè¿™ä¸ªå¾ˆæœ‰æ„æ€ï¼Œæ„Ÿå…´è¶£æˆ–è€…ä¸äº†è§£çš„èµ¶ç´§å»MDNäº†è§£ä¸€ä¸‹ï¼ï¼ï¼</span></span><br><span class="line">  <span class="keyword">return</span> paths.reduce(<span class="function">(<span class="params">matched, path</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!path &amp;&amp; path !== <span class="string">""</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// åªè¦æœ‰ä¸€ä¸ª matchï¼Œç›´æ¥è¿”å›ï¼Œè®¤ä¸ºæ˜¯ match</span></span><br><span class="line">    <span class="keyword">if</span> (matched) <span class="keyword">return</span> matched;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// regexp æ˜¯æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class="line">    <span class="comment">// keys æ˜¯åˆ‡å‰²å‡ºæ¥çš„å¾— key çš„å€¼</span></span><br><span class="line">    <span class="keyword">const</span> &#123; regexp, keys &#125; = compilePath(path, &#123;</span><br><span class="line">      end: exact,</span><br><span class="line">      strict,</span><br><span class="line">      sensitive</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// exec() è¯¥æ–¹æ³•å¦‚æœæ‰¾åˆ°äº†åŒ¹é…çš„æ–‡æœ¬çš„è¯ï¼Œåˆ™ä¼šè¿”å›ä¸€ä¸ªç»“æœæ•°ç»„ï¼Œå¦åˆ™çš„è¯ï¼Œä¼šè¿”å›ä¸€ä¸ª</span></span><br><span class="line">    <span class="keyword">const</span> match = regexp.exec(pathname);</span><br><span class="line">    <span class="comment">/* åŒ¹é…ä¸æˆåŠŸï¼Œè¿”å›null */</span></span><br><span class="line">    <span class="keyword">if</span> (!match) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// url è¡¨ç¤ºåŒ¹é…åˆ°çš„éƒ¨åˆ†</span></span><br><span class="line">    <span class="keyword">const</span> [url, ...values] = match;</span><br><span class="line">    <span class="comment">// pathname === url è¡¨ç¤ºå®Œå…¨åŒ¹é…</span></span><br><span class="line">    <span class="keyword">const</span> isExact = pathname === url;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (exact &amp;&amp; !isExact) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      path, <span class="comment">// the path used to match</span></span><br><span class="line">      url: path === <span class="string">"/"</span> &amp;&amp; url === <span class="string">""</span> ? <span class="string">"/"</span> : url, <span class="comment">// the matched portion of the URL</span></span><br><span class="line">      isExact, <span class="comment">// whether or not we matched exactly</span></span><br><span class="line">      params: keys.reduce(<span class="function">(<span class="params">memo, key, index</span>) =&gt;</span> &#123;</span><br><span class="line">        memo[key.name] = values[index];</span><br><span class="line">        <span class="keyword">return</span> memo;</span><br><span class="line">      &#125;, &#123;&#125;)</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, <span class="literal">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>matchPath å‡½æ•°ä¹Ÿæ˜¯ç”± react-router export å‡ºå»çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ¥è·å¾—æŸä¸ª url ä¸­çš„æŒ‡å®šçš„å‚æ•°ã€‚</p>
<h2 id="Route"><a href="#Route" class="headerlink" title="Route"></a>Route</h2><p>Route æ˜¯ç”¨äºå£°æ˜è·¯ç”±æ˜ å°„åˆ°åº”ç”¨ç¨‹åºçš„ç»„ä»¶å±‚ã€‚</p>
<p>Route æœ‰ä¸‰ç§æ¸²æŸ“çš„æ–¹æ³•ï¼Œå½“ç„¶ï¼Œéƒ½é…ç½®çš„è¯åªæœ‰ä¸€ä¸ªä¼šç”Ÿæ•ˆï¼Œä¼˜å…ˆçº§æ˜¯ children &gt; component &gt; render</p>
<p>\1. <Route component><br>\2. <Route render><br>\3. <Route children></p>
<p>æ¯ä¸ªåœ¨ä¸åŒçš„æƒ…å†µä¸‹éƒ½æœ‰ç”¨ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¼šä½¿ç”¨ componentã€‚</p>
<h3 id="component"><a href="#component" class="headerlink" title="component"></a>component</h3><p>component è¡¨ç¤ºåªæœ‰å½“ä½ç½®åŒ¹é…æ—¶æ‰ä¼šæ¸²æŸ“çš„ React ç»„ä»¶ã€‚ä½¿ç”¨ componentï¼ˆè€Œä¸æ˜¯ render æˆ– children ï¼‰Route ä½¿ç”¨ä»ç»™å®šç»„ä»¶ React.createElement(element, props) åˆ›å»ºæ–°çš„ React elementã€‚è¿™æ„å‘³ç€ï¼Œä½¿ç”¨ component åˆ›å»ºçš„ç»„ä»¶èƒ½è·å¾— router ä¸­çš„ propsã€‚</p>
<h3 id="children"><a href="#children" class="headerlink" title="children"></a>children</h3><p>ä»æºç ä¸­å¯ä»¥çœ‹å‡ºï¼Œchildren çš„ä¼˜å…ˆçº§æ˜¯é«˜äº componentï¼Œè€Œä¸”å¯ä»¥æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œchildren æ²¡æœ‰è·å¾— router çš„ propsã€‚</p>
<p>children æœ‰ä¸€ä¸ªéå¸¸ç‰¹æ®Šçš„åœ°æ–¹åœ¨äºï¼Œå½“è·¯ç”±ä¸åŒ¹é…ä¸” children æ˜¯ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œ children æ–¹æ³•ï¼Œè¿™å°±ç»™äº†è®¾è®¡å¾ˆå¤§çš„çµæ´»æ€§ã€‚</p>
<h3 id="render-1"><a href="#render-1" class="headerlink" title="render"></a>render</h3><p>render å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¼˜å…ˆçº§æ˜¯æœ€ä½çš„ï¼Œå½“åŒ¹é…æˆåŠŸçš„æ—¶å€™ï¼Œæ‰§è¡Œè¿™ä¸ªå‡½æ•°ã€‚</p>
<h3 id="exact-amp-strict-amp-sensitive"><a href="#exact-amp-strict-amp-sensitive" class="headerlink" title="exact &amp; strict &amp; sensitive"></a>exact &amp; strict &amp; sensitive</h3><p>è¿™ä¸‰è€…éƒ½æ˜¯ä½¿ç”¨ path-to-regexp åšè·¯å¾„åŒ¹é…éœ€è¦çš„ä¸‰ä¸ªå‚æ•°ã€‚</p>
<ol>
<li>exact: å¦‚æœä¸º trueï¼Œåˆ™åªæœ‰åœ¨è·¯å¾„å®Œå…¨åŒ¹é… location.pathname æ—¶æ‰åŒ¹é…ã€‚</li>
<li>strict: åœ¨ç¡®å®šä¸ºä½ç½®æ˜¯å¦ä¸å½“å‰ URL åŒ¹é…æ—¶ï¼Œå°†è€ƒè™‘ä½ç½® pathname åçš„æ–œçº¿ã€‚</li>
<li>sensitive: å¦‚æœè·¯å¾„åŒºåˆ†å¤§å°å†™ï¼Œåˆ™ä¸º true ï¼Œåˆ™åŒ¹é…ã€‚</li>
</ol>
<h3 id="location"><a href="#location" class="headerlink" title="location"></a>location</h3><p>Route å…ƒç´ å°è¯•å…¶åŒ¹é… path åˆ°å½“å‰æµè§ˆå™¨ URLï¼Œä½†æ˜¯ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ location å®ç°ä¸å½“å‰æµè§ˆå™¨ä½ç½®ä»¥å¤–çš„ä½ç½®ç›¸åŒ¹é…ã€‚</p>
<p>ä¸‹é¢åˆ—å‡º Route æºç ï¼Œå¹¶ä¸”åˆ å»äº† dev éƒ¨åˆ†ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isValidElementType &#125; <span class="keyword">from</span> <span class="string">"react-is"</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">"prop-types"</span>;</span><br><span class="line"><span class="keyword">import</span> invariant <span class="keyword">from</span> <span class="string">"tiny-invariant"</span>;</span><br><span class="line"><span class="keyword">import</span> warning <span class="keyword">from</span> <span class="string">"tiny-warning"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> RouterContext <span class="keyword">from</span> <span class="string">"./RouterContext.js"</span>;</span><br><span class="line"><span class="keyword">import</span> matchPath <span class="keyword">from</span> <span class="string">"./matchPath.js"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The public API for matching a single path and rendering.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Route</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;RouterContext.Consumer&gt;</span><br><span class="line">        &#123;context =&gt; &#123;</span><br><span class="line">          invariant(context, <span class="string">"You should not use &lt;Route&gt; outside a &lt;Router&gt;"</span>);</span><br><span class="line"></span><br><span class="line">          <span class="comment">// å¯ä»¥çœ‹å‡ºï¼Œç”¨æˆ·ä¼ çš„ location è¦†ç›–æ‰äº† context ä¸­çš„ location</span></span><br><span class="line">          <span class="keyword">const</span> location = <span class="keyword">this</span>.props.location || context.location;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// å¦‚æœæœ‰ computedMatch å°±ç”¨ computedMatch ä½œä¸ºç»“æœ</span></span><br><span class="line">          <span class="comment">// å¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ¤æ–­æ˜¯å¦æœ‰ path ä¼ å‚</span></span><br><span class="line">          <span class="comment">// matchPath æ˜¯è°ƒç”¨ path-to-regexp åˆ¤æ–­æ˜¯å¦åŒ¹é…</span></span><br><span class="line">          <span class="comment">// path-to-regexp éœ€è¦ä¸‰ä¸ªå‚æ•°</span></span><br><span class="line">          <span class="comment">// exact: å¦‚æœä¸º trueï¼Œåˆ™åªæœ‰åœ¨è·¯å¾„å®Œå…¨åŒ¹é… location.pathname æ—¶æ‰åŒ¹é…</span></span><br><span class="line">          <span class="comment">// strict: å¦‚æœä¸º true å½“çœŸå®çš„è·¯å¾„å…·æœ‰ä¸€ä¸ªæ–œçº¿å°†åªåŒ¹é…ä¸€ä¸ªæ–œçº¿location.pathname</span></span><br><span class="line">          <span class="comment">// sensitive: å¦‚æœè·¯å¾„åŒºåˆ†å¤§å°å†™ï¼Œåˆ™ä¸º true ï¼Œåˆ™åŒ¹é…</span></span><br><span class="line">          <span class="keyword">const</span> match = <span class="keyword">this</span>.props.computedMatch</span><br><span class="line">            ? <span class="keyword">this</span>.props.computedMatch <span class="comment">// &lt;Switch&gt; already computed the match for us</span></span><br><span class="line">            : <span class="keyword">this</span>.props.path</span><br><span class="line">            ? matchPath(location.pathname, <span class="keyword">this</span>.props)</span><br><span class="line">            : context.match;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// props å°±æ˜¯æ›´æ–°åçš„ context</span></span><br><span class="line">          <span class="comment">// location åšäº†æ›´æ–°ï¼ˆæœ‰å¯èƒ½æ˜¯ç”¨æˆ·ä¼ å…¥çš„locationï¼‰</span></span><br><span class="line">          <span class="comment">// match åšäº†æ›´æ–°</span></span><br><span class="line">          <span class="keyword">const</span> props = &#123; ...context, location, match &#125;;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// ä¸‰ç§æ¸²æŸ“æ–¹å¼</span></span><br><span class="line">          <span class="keyword">let</span> &#123; children, component, render &#125; = <span class="keyword">this</span>.props;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// Preact uses an empty array as children by</span></span><br><span class="line">          <span class="comment">// default, so use null if that's the case.</span></span><br><span class="line">          <span class="comment">// children é»˜è®¤æ˜¯ä¸ªç©ºæ•°ç»„ï¼Œå¦‚æœæ˜¯é»˜è®¤æƒ…å†µï¼Œç½®ä¸º null</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(children) &amp;&amp; children.length === <span class="number">0</span>) &#123;</span><br><span class="line">            children = <span class="literal">null</span>;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">return</span> (</span><br><span class="line">            <span class="comment">// RouterContext ä¸­æ›´æ–°äº† location, match</span></span><br><span class="line">            &lt;RouterContext.Provider value=&#123;props&#125;&gt;</span><br><span class="line">              &#123;props.match</span><br><span class="line">              <span class="comment">// é¦–å…ˆåˆ¤æ–­çš„æ˜¯æœ‰æ—  children</span></span><br><span class="line">                ? children</span><br><span class="line">                  <span class="comment">// å¦‚æœ children æ˜¯ä¸ªå‡½æ•°ï¼Œæ‰§è¡Œï¼Œå¦åˆ™ç›´æ¥è¿”å› children</span></span><br><span class="line">                  ? <span class="keyword">typeof</span> children === <span class="string">"function"</span></span><br><span class="line">                  : children(props)</span><br><span class="line">                  : children</span><br><span class="line">                  <span class="comment">// å¦‚æœæ²¡æœ‰ childrenï¼Œåˆ¤æ–­æœ‰æ—  component</span></span><br><span class="line">                : component</span><br><span class="line">                  <span class="comment">// æœ‰ componentï¼Œé‡æ–°æ–°å»ºä¸€ä¸ª component</span></span><br><span class="line">                  ? React.createElement(component, props)</span><br><span class="line">                  <span class="comment">// æ²¡æœ‰ componentï¼Œåˆ¤æ–­æœ‰æ—  render</span></span><br><span class="line">                  : render</span><br><span class="line">                  <span class="comment">// æœ‰ renderï¼Œæ‰§è¡Œ render æ–¹æ³•</span></span><br><span class="line">                  ? render(props)</span><br><span class="line">                  <span class="comment">// æ²¡æœ‰è¿”å› null</span></span><br><span class="line">                  : <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// è¿™é‡Œæ˜¯ä¸ match çš„æƒ…å†µï¼Œåˆ¤æ–­ children æ˜¯å¦å‡½æ•°</span></span><br><span class="line">                : <span class="keyword">typeof</span> children === <span class="string">"function"</span></span><br><span class="line">                <span class="comment">// æ˜¯çš„è¯æ‰§è¡Œ</span></span><br><span class="line">                ? children(props)</span><br><span class="line">                : <span class="literal">null</span>&#125;</span><br><span class="line">            &lt;<span class="regexp">/RouterContext.Provider&gt;</span></span><br><span class="line"><span class="regexp">          );</span></span><br><span class="line"><span class="regexp">        &#125;&#125;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>RouterContext.Consumer&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Route;</span><br></pre></td></tr></table></figure>

<p>Route ç»„ä»¶æ ¹æ®è‡ªèº«çš„ä¼ å‚ï¼Œå¯¹ä¸Šå±‚ RouterContext ä¸­çš„éƒ¨åˆ†å±æ€§ï¼ˆlocation å’Œ matchï¼‰è¿›è¡Œäº†æ›´æ–°ï¼Œå¹¶ä¸”å¦‚æœå½“å‰è·¯å¾„å’Œé…ç½®çš„ path è·¯å¾„ matchï¼Œåˆ™æ¸²æŸ“è¯¥ç»„ä»¶ï¼Œæ¸²æŸ“çš„æ–¹å¼æœ‰ childrenï¼Œcomponentï¼Œrender ä¸‰ç§æ–¹å¼ï¼Œæˆ‘ä»¬æœ€å¸¸ç”¨çš„å°±æ˜¯ component æ–¹å¼ï¼Œæ³¨æ„æ¯ç§æ–¹å¼çš„åŒºåˆ«ã€‚</p>
<h2 id="Prompt"><a href="#Prompt" class="headerlink" title="Prompt"></a>Prompt</h2><p>Prompt ç”¨äºè·¯ç”±åˆ‡æ¢æç¤ºã€‚è¿™åœ¨æŸäº›åœºæ™¯ä¸‹æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œæ¯”å¦‚ç”¨æˆ·åœ¨æŸä¸ªé¡µé¢ä¿®æ”¹æ•°æ®ï¼Œç¦»å¼€æ—¶ï¼Œæç¤ºç”¨æˆ·æ˜¯å¦ä¿å­˜ï¼ŒPrompt ç»„ä»¶æœ‰ä¿©ä¸ªå±æ€§ï¼š</p>
<ol>
<li>messageï¼šç”¨äºæ˜¾ç¤ºæç¤ºçš„æ–‡æœ¬ä¿¡æ¯ã€‚</li>
<li>whenï¼šä¼ é€’å¸ƒå°”å€¼ï¼Œç›¸å½“äºæ ‡ç­¾çš„å¼€å…³ï¼Œé»˜è®¤æ˜¯ trueï¼Œè®¾ç½®æˆ false æ—¶ï¼Œå¤±æ•ˆã€‚</li>
</ol>
<p>Prompt çš„æœ¬è´¨æ˜¯åœ¨ when ä¸º true çš„æ—¶å€™ï¼Œè°ƒç”¨ context.history.block æ–¹æ³•ï¼Œä¸ºå…¨å±€æ³¨å†Œè·¯ç”±ç›‘å¬ï¼Œblock çš„åŸç†çœ‹ä¹‹å‰çš„ history ç›¸å…³æ–‡ç« ã€‚è·¯æœ‰å˜åŒ–çš„æ—¶å€™ï¼Œé»˜è®¤ä½¿ç”¨ window.confirm è¿›è¡Œç¡®è®¤ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ confirm çš„å½¢å¼ï¼Œå°±æ˜¯åœ¨ BrowserRouter æˆ–è€… HashRouter ä¼ å…¥ getUserConfirmation è¿™ä¸ªå‚æ•°ï¼Œä¼šæ›¿æ¢æ‰ window.confirmã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">import React from &quot;react&quot;;</span><br><span class="line">import PropTypes from &quot;prop-types&quot;;</span><br><span class="line">import invariant from &quot;tiny-invariant&quot;;</span><br><span class="line"></span><br><span class="line">import Lifecycle from &quot;.&#x2F;Lifecycle.js&quot;;</span><br><span class="line">import RouterContext from &quot;.&#x2F;RouterContext.js&quot;;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * The public API for prompting the user before navigating away from a screen.</span><br><span class="line"> *&#x2F;</span><br><span class="line">function Prompt(&#123; message, when &#x3D; true &#125;) &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;RouterContext.Consumer&gt;</span><br><span class="line">      &#123;context &#x3D;&gt; &#123;</span><br><span class="line">        invariant(context, &quot;You should not use &lt;Prompt&gt; outside a &lt;Router&gt;&quot;);</span><br><span class="line"></span><br><span class="line">        if (!when || context.staticContext) return null;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; è°ƒç”¨äº† history.block æ–¹æ³•</span><br><span class="line">        const method &#x3D; context.history.block;</span><br><span class="line"></span><br><span class="line">        return (</span><br><span class="line">          &lt;Lifecycle</span><br><span class="line">            onMount&#x3D;&#123;self &#x3D;&gt; &#123;</span><br><span class="line">              self.release &#x3D; method(message);</span><br><span class="line">            &#125;&#125;</span><br><span class="line">            onUpdate&#x3D;&#123;(self, prevProps) &#x3D;&gt; &#123;</span><br><span class="line">              if (prevProps.message !&#x3D;&#x3D; message) &#123;</span><br><span class="line">                self.release();</span><br><span class="line">                self.release &#x3D; method(message);</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;&#125;</span><br><span class="line">            onUnmount&#x3D;&#123;self &#x3D;&gt; &#123;</span><br><span class="line">              self.release();</span><br><span class="line">            &#125;&#125;</span><br><span class="line">            message&#x3D;&#123;message&#125;</span><br><span class="line">          &#x2F;&gt;</span><br><span class="line">        );</span><br><span class="line">      &#125;&#125;</span><br><span class="line">    &lt;&#x2F;RouterContext.Consumer&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default Prompt;</span><br></pre></td></tr></table></figure>

<h2 id="Redirect"><a href="#Redirect" class="headerlink" title="Redirect"></a>Redirect</h2><p>Redirect ä¸å…¶è¯´æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œä¸å¦‚è¯´æ˜¯æœ‰ç»„ä»¶å°è£…çš„ä¸€ç»„æ–¹æ³•ï¼Œè¯¥ç»„ä»¶åœ¨ componentDidMount ç”Ÿå‘½å‘¨æœŸå†…ï¼Œé€šè¿‡è°ƒç”¨ history API è·³è½¬åˆ°åˆ°æ–°ä½ç½®ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ–°ä½ç½®å°†è¦†ç›–å†å²å †æ ˆä¸­çš„å½“å‰ä½ç½®ã€‚</p>
<p><Redirect to="/somewhere/else"/> to è¡¨ç¤ºè¦é‡å®šå‘åˆ°çš„ç½‘å€ã€‚to ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª location å¯¹è±¡</p>
<p><Redirect push to="/somewhere/else"/> push ä¸º true æ—¶ï¼Œé‡å®šå‘ä¼šå°†æ–°æ¡ç›®æ¨å…¥å†å²è®°å½•ï¼Œè€Œä¸æ˜¯æ›¿æ¢å½“å‰æ¡ç›®ã€‚</p>
<p>ç»“åˆ Switch å’Œ Redirect æºç çœ‹ï¼Œå¦‚æœ Redirect ä¸­æœ‰ from å±æ€§ï¼Œä¼šè¢« Switch è·å¾—ï¼Œå½“ from å’Œå½“å‰è·¯å¾„åŒ¹é…çš„æ—¶å€™ï¼Œå°±ä¼šæ¸²æŸ“ Redirect ç»„ä»¶ï¼Œæ‰§è¡Œè·³è½¬ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">"prop-types"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createLocation, locationsAreEqual &#125; <span class="keyword">from</span> <span class="string">"history"</span>;</span><br><span class="line"><span class="keyword">import</span> invariant <span class="keyword">from</span> <span class="string">"tiny-invariant"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Lifecycle <span class="keyword">from</span> <span class="string">"./Lifecycle.js"</span>;</span><br><span class="line"><span class="keyword">import</span> RouterContext <span class="keyword">from</span> <span class="string">"./RouterContext.js"</span>;</span><br><span class="line"><span class="keyword">import</span> generatePath <span class="keyword">from</span> <span class="string">"./generatePath.js"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The public API for navigating programmatically with a component.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Redirect</span>(<span class="params">&#123; computedMatch, to, push = false &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="comment">// å•¥éƒ½æœ‰çš„å¤§å“¥ RouterContext</span></span><br><span class="line">    &lt;RouterContext.Consumer&gt;</span><br><span class="line">      &#123;context =&gt; &#123;</span><br><span class="line">        invariant(context, <span class="string">"You should not use &lt;Redirect&gt; outside a &lt;Router&gt;"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> &#123; history, staticContext &#125; = context;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸€èˆ¬æ¥è¯´ï¼ŒRedirect æ“ä½œéƒ½ä¸éœ€è¦ç•™æœ‰ historyï¼Œæ‰€ä»¥é€‰æ‹©é€‰æ‹© history.replace</span></span><br><span class="line">        <span class="keyword">const</span> method = push ? history.push : history.replace;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> location = createLocation(</span><br><span class="line">          <span class="comment">// computedMatch å°±æ˜¯çœ‹çœ‹ switch æœ‰æ²¡æœ‰å¤šç®¡é—²äº‹</span></span><br><span class="line">          computedMatch</span><br><span class="line">            ? <span class="keyword">typeof</span> to === <span class="string">"string"</span></span><br><span class="line">              ? generatePath(to, computedMatch.params)</span><br><span class="line">              : &#123;</span><br><span class="line">                  ...to,</span><br><span class="line">                  pathname: generatePath(to.pathname, computedMatch.params)</span><br><span class="line">                &#125;</span><br><span class="line">            : to</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// When rendering in a static context,</span></span><br><span class="line">        <span class="comment">// set the new location immediately.</span></span><br><span class="line">        <span class="comment">// staticRouter ä¸“ç”¨</span></span><br><span class="line">        <span class="keyword">if</span> (staticContext) &#123;</span><br><span class="line">          method(location);</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">          &lt;Lifecycle</span><br><span class="line">            onMount=&#123;() =&gt; &#123;</span><br><span class="line">              <span class="comment">// componentDidMount çš„æ—¶å€™æ‰§è¡Œ method(location)ï¼Œä¹Ÿå°±æ˜¯ history.replace æ“ä½œ</span></span><br><span class="line">              method(location);</span><br><span class="line">            &#125;&#125;</span><br><span class="line">            onUpdate=&#123;(self, prevProps) =&gt; &#123;</span><br><span class="line">              <span class="comment">// componentDidUpdate æ—¶å€™åˆ¤æ–­å½“å‰ location å’Œä¸Šä¸€ä¸ª location æ˜¯å¦å‘ç”Ÿå˜åŒ–</span></span><br><span class="line">              <span class="comment">// åªè¦å‘ç”Ÿå˜åŒ–ï¼Œè°ƒç”¨ method(location)</span></span><br><span class="line">              <span class="comment">// ä¸€èˆ¬æ¥è®²ï¼Œåœ¨ componentDidMount çš„æ—¶å€™å°±è·³èµ°äº†ï¼Œä¸ä¼šç­‰åˆ° componentDidUpdate</span></span><br><span class="line">              <span class="keyword">const</span> prevLocation = createLocation(prevProps.to);</span><br><span class="line">              <span class="keyword">if</span> (</span><br><span class="line">                !locationsAreEqual(prevLocation, &#123;</span><br><span class="line">                  ...location,</span><br><span class="line">                  key: prevLocation.key</span><br><span class="line">                &#125;)</span><br><span class="line">              ) &#123;</span><br><span class="line">                method(location);</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;&#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ— æ•ˆ</span></span><br><span class="line">            to=&#123;to&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        );</span><br><span class="line">      &#125;&#125;</span><br><span class="line">    &lt;<span class="regexp">/RouterContext.Consumer&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Redirect;</span></span><br></pre></td></tr></table></figure>

<p>Lifecycle ä¸ render ä»»ä½•é¡µé¢ï¼Œåªæœ‰ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼ŒLifecycle æä¾›äº† onMountï¼Œ onUpdateï¼Œ onUnmount ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Lifecycle</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.props.onMount) <span class="keyword">this</span>.props.onMount.call(<span class="keyword">this</span>, <span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidUpdate(prevProps) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.props.onUpdate) <span class="keyword">this</span>.props.onUpdate.call(<span class="keyword">this</span>, <span class="keyword">this</span>, prevProps);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentWillUnmount() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.props.onUnmount) <span class="keyword">this</span>.props.onUnmount.call(<span class="keyword">this</span>, <span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Lifecycle;</span><br></pre></td></tr></table></figure>

<h1 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ•´ä¸ª<code>react-router</code>æ˜¯ç”±<code>createBrowserHistory</code>æˆ–è€…<code>createHashHistory</code>æ¥ç‰µå¤´ï¼Œä¸æˆ‘ä»¬çš„<code>React</code>ç»„ä»¶ç»‘å®šåœ¨ä¸€èµ·ï¼Œç„¶åä¼ é€’äº†ä¸€äº›å±äº<code>history</code>è¿™ä¸ªåº“çš„æ–¹æ³•ä»¥åŠæ•°å€¼ã€‚å½“ç„¶ï¼Œè¿˜æœ‰è·¯ç”±çš„åŒ¹é…å’Œæ¸²æŸ“ã€‚</p>
<p>åœ¨<code>history</code>è¿™ä¸ªåº“é‡Œé¢åˆæœ‰å¯¹äºè·¯ç”±çš„ç›‘å¬ï¼Œæ”¹å˜ç­‰ç­‰ã€‚</p>
<h2 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h2><p>ä»¥<code>history</code>æ¨¡å¼åšå‚è€ƒï¼ˆä¹Ÿæ˜¯æˆ‘ä»¬é‡ç‚¹é˜…è¯»çš„ã€‚</p>
<h3 id="ä¿®æ”¹url"><a href="#ä¿®æ”¹url" class="headerlink" title="ä¿®æ”¹url"></a>ä¿®æ”¹url</h3><p>å½“<code>url</code>æ”¹å˜çš„æ—¶å€™ï¼Œä¼šè§¦å‘å†™åœ¨<code>window</code>ä¸Šé¢çš„ç›‘å¬<code>window.addEventListener(&#39;popstate&#39;, handlePop)</code>ã€‚</p>
<p>è°ƒç”¨äº†æˆ‘ä»¬çš„å‡½æ•°<code>handlePop</code></p>
<p>å‡½æ•°å†…éƒ¨æˆ‘ä»¬<code>setState</code>ï¼Œä¿®æ”¹äº†<code>location</code>ï¼Œæ–¹ä¾¿ä¼ é€’æ­£ç¡®çš„å€¼ä¸‹å»ï¼Œå¹¶é€šè¿‡äº†<code>Switch</code>æ‰¾å‡ºåŒ¹é…çš„<code>Route</code>ç»„ä»¶ã€‚</p>
<p>è§¦å‘äº†ç»„ä»¶çš„æ¸²æŸ“ã€‚</p>
<blockquote>
<p>å½“ç„¶ä¹ŸåŒ…æ‹¬æˆ‘ä»¬æ‰€è°“çš„history.pushï¼Œhistory.repalceç­‰ç­‰è¿™äº›æ–¹æ³•ï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¿®æ”¹urlï¼Œç„¶åå°±æ˜¯é‡å¤ä¸Šé¢çš„æ­¥éª¤</p>
</blockquote>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="mailto:undefined">Derrick</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="http://derricktel.github.io/2020/11/14/%E3%80%90%E9%87%8D%E8%AF%86%E5%89%8D%E7%AB%AF%E3%80%91React-Router%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/">http://derricktel.github.io/2020/11/14/%E3%80%90%E9%87%8D%E8%AF%86%E5%89%8D%E7%AB%AF%E3%80%91React-Router%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="http://derricktel.github.io" target="_blank">Derrick</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/React/">React</a><a class="post-meta__tags" href="/tags/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/">æºç é˜…è¯»</a></div><div class="post_share"><div class="social-share" data-image="/image/cover/react.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> æ‰“èµ<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/DerrickWechat.png" alt="å¾®ä¿¡"/><div class="post-qr-code__desc">å¾®ä¿¡</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/DerrickAlipay.jpg" alt="æ”¯ä»˜å¯¶"/><div class="post-qr-code__desc">æ”¯ä»˜å¯¶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2021/01/22/%E3%80%8C%E5%A6%82%E4%BD%95%E7%BB%99github%E6%8F%90%E4%B8%80%E4%B8%AAPR%E3%80%8D/"><img class="prev_cover lazyload" data-src="/image/cover/github.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">ã€Œå¦‚ä½•ç»™å¼€æºåº“æä¸€ä¸ªPRã€</div></div></a></div><div class="next-post pull_right"><a href="/2020/10/28/%E3%80%90%E9%9D%A2%E7%BB%8F%E3%80%912%E5%B9%B4%E5%89%8D%E7%AB%AF%E6%9D%AD%E5%B7%9E%E9%9D%A2%E8%AF%95%E9%9B%86%E5%90%88/"><img class="next_cover lazyload" data-src="/image/cover/bg.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">ã€é¢ç»ã€‘2å¹´å‰ç«¯æ­å·é¢è¯•é›†åˆ</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> ç›¸å…³æ¨è</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/09/11/ã€é‡è¯†å‰ç«¯ã€‘reduxæºç é˜…è¯»/" title="ã€é‡è¯†å‰ç«¯ã€‘reduxæºç é˜…è¯»"><img class="relatedPosts_cover lazyload"data-src="/image/cover/web.jpeg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-09-11</div><div class="relatedPosts_title">ã€é‡è¯†å‰ç«¯ã€‘reduxæºç é˜…è¯»</div></div></a></div><div class="relatedPosts_item"><a href="/2019/07/30/React-Hook-å€’è®¡æ—¶/" title="React Hook å€’è®¡æ—¶"><img class="relatedPosts_cover lazyload"data-src="/image/cover/React.jpeg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-07-30</div><div class="relatedPosts_title">React Hook å€’è®¡æ—¶</div></div></a></div><div class="relatedPosts_item"><a href="/2019/06/19/React-Stateè¯¦è§£/" title="React-Stateè¯¦è§£"><img class="relatedPosts_cover lazyload"data-src="/image/cover/React.jpeg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-06-19</div><div class="relatedPosts_title">React-Stateè¯¦è§£</div></div></a></div><div class="relatedPosts_item"><a href="/2020/05/20/ä½ çœŸçš„æ‡‚React-Hookå—/" title="ä½ çœŸçš„æ‡‚React Hookå—ï¼Ÿ"><img class="relatedPosts_cover lazyload"data-src="/image/cover/React.jpeg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-05-20</div><div class="relatedPosts_title">ä½ çœŸçš„æ‡‚React Hookå—ï¼Ÿ</div></div></a></div><div class="relatedPosts_item"><a href="/2019/09/15/è£…é¥°å™¨(Decorator)å’ŒReacté«˜é˜¶ç»„ä»¶(HOC)/" title="è£…é¥°å™¨(Decorator)å’ŒReacté«˜é˜¶ç»„ä»¶(HOC)"><img class="relatedPosts_cover lazyload"data-src="/image/cover/decorator.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-09-15</div><div class="relatedPosts_title">è£…é¥°å™¨(Decorator)å’ŒReacté«˜é˜¶ç»„ä»¶(HOC)</div></div></a></div></div><div class="clear_both"></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Derrick</div><div class="framework-info"><span>é©±åŠ¨ </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="é˜…è¯»æ¨¡å¼"></i><i class="fa fa-plus" id="font_plus" title="æ”¾å¤§å­—ä½“"></i><i class="fa fa-minus" id="font_minus" title="ç¼©å°å­—ä½“"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="ç®€ç¹è½¬æ¢" target="_self">ç¹</a><i class="darkmode fa fa-moon-o" id="darkmode" title="å¤œé—´æ¨¡å¼"></i></div><div id="rightside-config-show"><div id="rightside_config" title="è®¾ç½®"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="ç›®å½•" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="å›åˆ°é¡¶éƒ¨" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script></body></html>