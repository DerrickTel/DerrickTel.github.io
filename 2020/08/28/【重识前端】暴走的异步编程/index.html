<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>ã€é‡è¯†å‰ç«¯ã€‘æš´èµ°çš„å¼‚æ­¥ç¼–ç¨‹ | Derrick</title><meta name="description" content="ã€é‡è¯†å‰ç«¯ã€‘æš´èµ°çš„å¼‚æ­¥ç¼–ç¨‹"><meta name="keywords" content="JavaScript"><meta name="author" content="Derrick"><meta name="copyright" content="Derrick"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="ã€é‡è¯†å‰ç«¯ã€‘æš´èµ°çš„å¼‚æ­¥ç¼–ç¨‹"><meta name="twitter:description" content="ã€é‡è¯†å‰ç«¯ã€‘æš´èµ°çš„å¼‚æ­¥ç¼–ç¨‹"><meta name="twitter:image" content="http://derricktel.github.io/image/cover/web.jpeg"><meta property="og:type" content="article"><meta property="og:title" content="ã€é‡è¯†å‰ç«¯ã€‘æš´èµ°çš„å¼‚æ­¥ç¼–ç¨‹"><meta property="og:url" content="http://derricktel.github.io/2020/08/28/%E3%80%90%E9%87%8D%E8%AF%86%E5%89%8D%E7%AB%AF%E3%80%91%E6%9A%B4%E8%B5%B0%E7%9A%84%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/"><meta property="og:site_name" content="Derrick"><meta property="og:description" content="ã€é‡è¯†å‰ç«¯ã€‘æš´èµ°çš„å¼‚æ­¥ç¼–ç¨‹"><meta property="og:image" content="http://derricktel.github.io/image/cover/web.jpeg"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://derricktel.github.io/2020/08/28/%E3%80%90%E9%87%8D%E8%AF%86%E5%89%8D%E7%AB%AF%E3%80%91%E6%9A%B4%E8%B5%B0%E7%9A%84%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/"><link rel="prev" title="ã€é‡è¯†å‰ç«¯ã€‘reduxæºç é˜…è¯»" href="http://derricktel.github.io/2020/09/11/%E3%80%90%E9%87%8D%E8%AF%86%E5%89%8D%E7%AB%AF%E3%80%91redux%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/"><link rel="next" title="ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ" href="http://derricktel.github.io/2020/08/25/%E3%80%90%E9%87%8D%E8%AF%86%E5%89%8D%E7%AB%AF%E3%80%91%E6%B7%B1%E5%85%A5%E5%86%85%E5%AD%98%E4%B8%96%E7%95%8C/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç°¡"},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  bookmark: {
    message_prev: 'æŒ‰',
    message_next: 'é”®å°†æœ¬é¡µåŠ å…¥ä¹¦ç­¾'
  },
  runtime_unit: 'å¤©',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length_num">31</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length_num">42</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length_num">18</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-about"></i><span> å…³äºæˆ‘</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">ç›®å½•</div><div class="sidebar-toc__progress"><span class="progress-notice">ä½ å·²ç»è¯»äº†</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#å‰è¨€"><span class="toc-number">1.</span> <span class="toc-text">å‰è¨€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å¼‚æ­¥callback"><span class="toc-number">2.</span> <span class="toc-text">å¼‚æ­¥callback</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å‘å¸ƒ-è®¢é˜…æ¨¡å¼"><span class="toc-number">3.</span> <span class="toc-text">å‘å¸ƒ-è®¢é˜…æ¨¡å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Promise"><span class="toc-number">4.</span> <span class="toc-text">Promise</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#å›è°ƒæ•‘æ˜Ÿ"><span class="toc-number">4.1.</span> <span class="toc-text">å›è°ƒæ•‘æ˜Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ¶‰åŠé¢è¯•é¢˜"><span class="toc-number">4.2.</span> <span class="toc-text">æ¶‰åŠé¢è¯•é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#promiseæ˜¯ä»€ä¹ˆï¼Ÿ"><span class="toc-number">4.2.1.</span> <span class="toc-text">promiseæ˜¯ä»€ä¹ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#promiseè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><span class="toc-number">4.2.2.</span> <span class="toc-text">promiseè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#å¯è¯»æ€§"><span class="toc-number">4.2.2.1.</span> <span class="toc-text">å¯è¯»æ€§</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ä¿¡ä»»é—®é¢˜"><span class="toc-number">4.2.2.2.</span> <span class="toc-text">ä¿¡ä»»é—®é¢˜</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#æ‰‹æ’•A-è§„èŒƒçš„promise"><span class="toc-number">4.3.</span> <span class="toc-text">æ‰‹æ’•A+è§„èŒƒçš„promise</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#æ”¯æŒå¼‚æ­¥"><span class="toc-number">4.3.1.</span> <span class="toc-text">æ”¯æŒå¼‚æ­¥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#é“¾å¼è°ƒç”¨then"><span class="toc-number">4.3.2.</span> <span class="toc-text">é“¾å¼è°ƒç”¨then</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Generator"><span class="toc-number">5.</span> <span class="toc-text">Generator</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#async-await"><span class="toc-number">6.</span> <span class="toc-text">async&#x2F;await</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#æ³¨æ„"><span class="toc-number">6.1.</span> <span class="toc-text">æ³¨æ„</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reference"><span class="toc-number">7.</span> <span class="toc-text">Reference</span></a></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(/image/cover/web.jpeg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Derrick</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-about"></i><span> å…³äºæˆ‘</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">ã€é‡è¯†å‰ç«¯ã€‘æš´èµ°çš„å¼‚æ­¥ç¼–ç¨‹</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="å‘è¡¨äº 2020-08-28 22:47:09"><i class="fa fa-calendar" aria-hidden="true"></i> å‘è¡¨äº 2020-08-28</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="æ›´æ–°äº 2020-09-02 17:12:43"><i class="fa fa-history" aria-hidden="true"></i> æ›´æ–°äº 2020-09-02</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E9%87%8D%E6%8B%BE%E5%89%8D%E7%AB%AF/">é‡æ‹¾å‰ç«¯</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div id="article-container"><p>æœ€è¿‘åœ¨å†™ã€é‡æ‹¾å‰ç«¯ã€‘ç³»åˆ—ï¼Œä¸‹é¢æœ‰å‡ ä¸ªå¿«é€Ÿé€šé“ï¼Œå¤§å®¶è‡ªå–</p>
<p><a href="https://juejin.im/post/6850418113944420359" target="_blank" rel="noopener">ã€é‡è¯†å‰ç«¯ã€‘åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿</a></p>
<p><a href="https://juejin.im/post/6850418117508759566" target="_blank" rel="noopener">ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—</a></p>
<p><a href="https://juejin.im/post/6854573215658803208" target="_blank" rel="noopener">ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this</a></p>
<p><a href="https://juejin.im/post/6859911609633767438" target="_blank" rel="noopener">ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šJavaScriptçš„æ‰§è¡Œæœºåˆ¶</a></p>
<p><a href="https://juejin.im/post/6860375101322461198" target="_blank" rel="noopener">ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC</a></p>
<p><a href="https://juejin.im/post/6865204092877144077" target="_blank" rel="noopener">ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ</a></p>
<p><a href="https://juejin.im/post/6867814019055484942" target="_blank" rel="noopener">ã€é‡è¯†å‰ç«¯ã€‘æš´èµ°çš„å¼‚æ­¥ç¼–ç¨‹</a></p>
<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è€è§„çŸ©ï¼Œè¿˜æ˜¯å…ˆäº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯å¼‚æ­¥ã€‚å¼‚æ­¥å…¶å®æ˜¯ä¸€ä¸ªç›¸å¯¹æ¯”è¾ƒé«˜çº§çš„ä¸€ä¸ªæ¦‚å¿µã€‚</p>
<p>é€šå¸¸æ¥è¯´ï¼Œç¨‹åºéƒ½æ˜¯é¡ºåºæ‰§è¡Œï¼ŒåŒä¸€æ—¶åˆ»åªä¼šå‘ç”Ÿä¸€ä»¶äº‹ã€‚å¦‚æœä¸€ä¸ªå‡½æ•°ä¾èµ–äºå¦ä¸€ä¸ªå‡½æ•°çš„ç»“æœï¼Œå®ƒåªèƒ½ç­‰å¾…é‚£ä¸ªå‡½æ•°ç»“æŸæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œä»ç”¨æˆ·çš„è§’åº¦æ¥è¯´ï¼Œæ•´ä¸ªç¨‹åºæ‰ç®—è¿è¡Œå®Œæ¯•.</p>
<p>å¦‚æœè¯´ä¸€ä¸ªäº‹æƒ…éœ€è¦ç­‰å¾…ä¸Šä¸€ä»¶äº‹æƒ…åšå®Œæ‰èƒ½åšï¼Œä½†æ˜¯ä»–ä»¬ä¹‹å‰åˆæ²¡æœ‰å¼ºè€¦åˆå…³ç³»ã€‚è¿™æ ·å°±åœ¨é‚£é‡Œå¹²ç­‰å°±æ¯«æ— æ„ä¹‰ã€‚ç‰¹åˆ«æ˜¯ç°åœ¨è®¡ç®—æœºæ™®ééƒ½æœ‰å¤šæ ¸CPUçš„æ—¶ä»£ã€‚</p>
<p>ä¸¾ä¸€ä¸ªå½¢è±¡çš„ğŸŒ°ã€‚</p>
<p>æˆ‘ä»¬ç°åœ¨è¦å»åƒæµ·åº•æï¼ˆæµ·åº•ææ‰“é’±ï¼ï¼‰ï¼Œæˆ‘ä»¬å‘ç°è¦æ’é˜Ÿï¼Œéœ€è¦æ’2ä¸ªå°æ—¶å·¦å³ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¦å¹²å˜›ï¼Ÿéš¾é“æ˜¯å¹²ç­‰å—ï¼Ÿè‚¯å®šä¸æ˜¯ï¼é‚£æ ·è ¢è ¢çš„ç¡¬ç­‰å¾ˆå‘†ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæ‹¿å‡ºæ‰‹æœºåˆ·åˆ·æœ‹å‹åœˆï¼Œæˆ–è€…ç©ä¸€æŠŠç´§å¼ åˆºæ¿€çš„ç‹è€…è£è€€åˆæˆ–è€…å»çœ‹ä¸€åœºç”µå½±ç­‰ç­‰â€¦.åœ¨æˆ‘ä»¬åšè¿™äº›äº‹æƒ…çš„æ—¶å€™æˆ‘ä»¬çš„æ’é˜Ÿå¹¶æ²¡æœ‰è¢«è€½è¯¯ï¼Œç”šè‡³å¯ä»¥å’ŒæœåŠ¡å‘˜è¯´å¿«åˆ°äº†æ‰“ä¸ªç”µè¯ç»™æˆ‘ï¼ˆè¿™ä¸ªæ˜¯å¸¸è§çš„callbackæ–¹æ³•ï¼Œå¾…ä¼šè®¨è®ºï¼‰</p>
<blockquote>
<p>è¿™æ ·ä½ å¯ä»¥åŒæ—¶å®Œæˆå…¶ä»–å·¥ä½œï¼Œè¿™å°±æ˜¯<strong>å¼‚æ­¥ç¼–ç¨‹</strong>çš„å‡ºå‘ç‚¹ã€‚</p>
</blockquote>
<p>æœ¬æ–‡æ€»ç»“äº†å‡ ä¸ªå¼‚æ­¥çš„æ–¹æ¡ˆï¼Œç†è§£å®ƒä»¬å¯ä»¥è®©ä½ å†™å‡ºç»“æ„æ›´åˆç†ã€æ€§èƒ½æ›´å‡ºè‰²ã€ç»´æŠ¤æ›´æ–¹ä¾¿çš„Javascriptç¨‹åºã€‚</p>
<h2 id="å¼‚æ­¥callback"><a href="#å¼‚æ­¥callback" class="headerlink" title="å¼‚æ­¥callback"></a>å¼‚æ­¥callback</h2><p>ä¸Šæ¥å°±æ˜¯ä¸€ä¸ªè‹±ä¿Šçš„ä¾‹å­</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> response = fetch(<span class="string">'myImage.png'</span>);</span><br><span class="line"><span class="keyword">var</span> blob = response.blob();</span><br></pre></td></tr></table></figure>

<p>æ²¡æœ‰äººå¯ä»¥å®Œç¾é¢„æµ‹åˆ°æ¯ç§ç½‘ç»œæƒ…å†µä¸‹è¿™ä¸ªresponseï¼Œæ˜¯å¦å¯ä»¥å®Œç¾è·å¾—fetchè·å¾—çš„å†…å®¹ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šæŠ¥é”™ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬çš„callbackå°±âœ¨bu ling bu lingçš„ç™»åœºå•¦ã€‚</p>
<p>æœ‰äº›å°ä¼™ä¼´å¯èƒ½è§‰å¾—callbackä¼¼ä¹å’Œè‡ªå·±æ²¡æœ‰å¤ªå¤§å…³ç³»ã€‚ã€‚ã€‚emmmmâ€¦.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">btn.addEventListener(<span class="string">'click'</span>, () =&gt; &#123;</span><br><span class="line">  alert(<span class="string">'You clicked me!'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å‘¢ï¼Ÿæœ‰æ²¡æœ‰æ„Ÿè§‰æœ‰ç‚¹å„¿ç†Ÿæ‚‰äº†ï¼Œå…¶ä»–è¿™ä¸ªå°±ç›¸å½“äºreactä¸­çš„</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onclick</span>=<span class="string">&#123;()</span> =&gt;</span>&#123;alert('You clicked me!');&#125;&#125;&gt;</span><br><span class="line">	ç‚¹æˆ‘  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œè¿™ä¸ªå…¶å®å°±æ˜¯æœ€å¸¸è§çš„callbackï¼ˆå›è°ƒå‡½æ•°ï¼‰ã€‚</p>
<p>åˆæˆ–è€…æ¯”è¾ƒå¸¸è§çš„</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">	alert(<span class="string">'You clicked me!'</span>);</span><br><span class="line">&#125;ï¼Œ<span class="number">2000</span>)</span><br></pre></td></tr></table></figure>

<p>å¾ˆå¸¸è§ï¼Œå¤§è‡´æ„æ€å°±æ˜¯2ç§’é’Ÿä¹‹åä¼šå›è°ƒä¸€ä¸‹è¿™ä¸ªåŒ¿åå‡½æ•°ï¼Œè™½ç„¶ä¸ä¸€å®šä¼šå‡†ç¡®æ‰§è¡Œï¼Œè¿™ä¸ªæ¶‰åŠåˆ°äº‹ä»¶å¾ªç¯ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å»æ‰¾ä¸€ä¸‹æˆ‘å‰é˜µå­å†™çš„äº‹ä»¶å¾ªç¯ğŸ˜Šã€‚</p>
<h2 id="å‘å¸ƒ-è®¢é˜…æ¨¡å¼"><a href="#å‘å¸ƒ-è®¢é˜…æ¨¡å¼" class="headerlink" title="å‘å¸ƒ-è®¢é˜…æ¨¡å¼"></a>å‘å¸ƒ-è®¢é˜…æ¨¡å¼</h2><p>å‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼šåˆç§°ä¸ºè§‚å¯Ÿè€…æ¨¡å¼ï¼Œå®ƒå®šä¹‰å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€æ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å°†å¾—åˆ°é€šçŸ¥ã€‚</p>
<p>åœ¨å†™Reactçš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªéå¸¸éå¸¸éå¸¸å¸¸è§çš„ğŸŒ°ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;useState, useEffect&#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">const</span> test = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [derrick, setDerrick] = useState(<span class="number">0</span>)</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span>=&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(derrick)</span><br><span class="line">  &#125;, [derrick])</span><br><span class="line">  <span class="keyword">return</span>(</span><br><span class="line">    &lt;button onClick=&#123;() =&gt; &#123;setDerrick(derrick+<span class="number">1</span>)&#125;&#125;&gt;ç‚¹æˆ‘&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<p>useEffectè®¢é˜…äº†derrickè¿™ä¸ªå˜é‡çš„å˜åŒ–ï¼Œç„¶åç›‘å¬åˆ°å˜åŒ–ä¹‹åå°±ä¼šè¿›è¡Œä¸€æ¬¡logï¼Œæ‰“å°å‡ºderrickå˜é‡çš„å€¼ã€‚</p>
<h2 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h2><h3 id="å›è°ƒæ•‘æ˜Ÿ"><a href="#å›è°ƒæ•‘æ˜Ÿ" class="headerlink" title="å›è°ƒæ•‘æ˜Ÿ"></a>å›è°ƒæ•‘æ˜Ÿ</h3><p>ä¹‹å‰ä»‹ç»è¿‡å›è°ƒå‡½æ•°è¿™ç§å¼‚æ­¥ç¼–ç¨‹ã€‚</p>
<p>åŠ å…¥æˆ‘å¸Œæœ›åœ¨Aæ‰§è¡Œå®Œä¹‹åæ‰§è¡ŒBï¼Œç„¶åæ‰§è¡ŒCï¼Œç„¶åæ‰§è¡ŒDâ€¦.æœ€åæ‰§è¡ŒZ</p>
<p>å†™å‡ºæ¥çš„ä»£ç å¯èƒ½æ˜¯è¿™æ ·çš„</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sayhello = <span class="function"><span class="keyword">function</span> (<span class="params">name, callback</span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name);</span><br><span class="line">    callback();</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line">sayhello(<span class="string">"first"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  sayhello(<span class="string">"second"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    sayhello(<span class="string">"third"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"end"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>åƒæœ¬ä¾‹ä¸€æ ·åµŒå¥—å¤šä¸ªæ–¹æ³•è°ƒç”¨ä¼šåˆ›å»ºé”™ç»¼å¤æ‚çš„ä»£ç ï¼Œä¼šéš¾ä»¥ç†è§£ä¸è°ƒè¯•ã€‚å½“æƒ³è¦å®ç°æ›´å¤ æ‚çš„åŠŸèƒ½æ—¶ï¼Œå›è°ƒå‡½æ•°ä¹Ÿä¼šå­˜åœ¨é—®é¢˜:è‹¥æƒ³è®©ä¸¤ä¸ªå¼‚æ­¥æ“ä½œå¹¶è¡Œè¿è¡Œï¼Œå¹¶ä¸”åœ¨å®ƒä»¬éƒ½ç»“æŸå æé†’ä½ ï¼Œé‚£è¯¥æ€ä¹ˆåš?è‹¥æƒ³åŒæ—¶å¯åŠ¨ä¸¤ä¸ªå¼‚æ­¥æ“ä½œï¼Œä½†åªé‡‡ç”¨é¦–ä¸ªç»“æŸçš„ç»“æœï¼Œé‚£åˆè¯¥æ€ä¹ˆ åš?</p>
<p>åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œä½ éœ€è¦è¿½è¸ªå¤šä¸ªå›è°ƒå‡½æ•°å¹¶åšæ¸…ç†æ“ä½œï¼Œ ä¸è¿‡å¥½åœ¨promiseæ¨ªç©ºå‡ºä¸–æ‹¯æ•‘äº†ä¸–ç•Œã€‚</p>
<h3 id="æ¶‰åŠé¢è¯•é¢˜"><a href="#æ¶‰åŠé¢è¯•é¢˜" class="headerlink" title="æ¶‰åŠé¢è¯•é¢˜"></a>æ¶‰åŠé¢è¯•é¢˜</h3><blockquote>
<p>promiseç”¨è¿‡å—ï¼Ÿè¯·ä½ ä»‹ç»ä¸€ä¸‹promiseã€‚</p>
</blockquote>
<p>å…¶å®è¿™é‡Œå¾ˆå¤šåŒå­¦å¯èƒ½å°±ä¸çŸ¥é“æ€ä¹ˆä»‹ç»äº†ï¼Œå¯èƒ½åªåœç•™åœ¨æ€ä¹ˆç”¨ã€‚æˆ‘ä»¬å¯ä»¥ä»å‡ ä¸ªæ–¹é¢æ¥ä»‹ç»ã€‚</p>
<ul>
<li>promiseæ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li>promiseè§£å†³äº†ä»€ä¹ˆé—®é¢˜</li>
<li>promiseçš„ä¼˜ç¼ºç‚¹</li>
</ul>
<h4 id="promiseæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#promiseæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="promiseæ˜¯ä»€ä¹ˆï¼Ÿ"></a>promiseæ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>æ‰€è°“<code>Promise</code>ï¼Œç®€å•è¯´å°±æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œé‡Œé¢ä¿å­˜ç€æŸä¸ªæœªæ¥æ‰ä¼šç»“æŸçš„äº‹ä»¶ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼‰çš„ç»“æœã€‚ä»è¯­æ³•ä¸Šè¯´ï¼ŒPromise æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä»å®ƒå¯ä»¥è·å–å¼‚æ­¥æ“ä½œçš„æ¶ˆæ¯ã€‚Promise æä¾›ç»Ÿä¸€çš„ APIï¼Œå„ç§å¼‚æ­¥æ“ä½œéƒ½å¯ä»¥ç”¨åŒæ ·çš„æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚</p>
<h4 id="promiseè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><a href="#promiseè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="promiseè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ"></a>promiseè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h4><ol>
<li>è§£å†³å¯è¯»æ€§çš„é—®é¢˜</li>
<li>è§£å†³ä¿¡ä»»é—®é¢˜</li>
</ol>
<h5 id="å¯è¯»æ€§"><a href="#å¯è¯»æ€§" class="headerlink" title="å¯è¯»æ€§"></a>å¯è¯»æ€§</h5><p>å¯è¯»æ€§ï¼Œä¹‹å‰çš„å›è°ƒåœ°ç‹±promiseå°±å¯ä»¥ä¼˜é›…çš„è§£å†³ã€‚(è¿˜æœ‰æ›´åŠ ä¼˜é›…çš„ï¼Œå¾…ä¼šä¼šä»‹ç»ã€‚)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sayhello = <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(name);</span><br><span class="line">      resolve();ã€€ã€€<span class="comment">//åœ¨å¼‚æ­¥æ“ä½œæ‰§è¡Œå®Œåæ‰§è¡Œ resolve() å‡½æ•°</span></span><br><span class="line">    &#125;, <span class="number">10000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line">sayhello(<span class="string">"first"</span>).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> sayhello(<span class="string">"second"</span>);ã€€ã€€<span class="comment">//ä»ç„¶è¿”å›ä¸€ä¸ª Promise å¯¹è±¡</span></span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> sayhello(<span class="string">"third"</span>);</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'end'</span>);</span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h5 id="ä¿¡ä»»é—®é¢˜"><a href="#ä¿¡ä»»é—®é¢˜" class="headerlink" title="ä¿¡ä»»é—®é¢˜"></a>ä¿¡ä»»é—®é¢˜</h5><p>è¿™ä¸ªé—®é¢˜å¯ä»¥ç”¨promiseçš„å‡ ä¸ªç‰¹ç‚¹æ¥è§£é‡Šï¼š</p>
<blockquote>
<p>ï¼ˆ1ï¼‰å¯¹è±¡çš„çŠ¶æ€ä¸å—å¤–ç•Œå½±å“ã€‚<code>Promise</code>å¯¹è±¡ä»£è¡¨ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œæœ‰ä¸‰ç§çŠ¶æ€ï¼š<code>pending</code>ï¼ˆè¿›è¡Œä¸­ï¼‰ã€<code>fulfilled</code>ï¼ˆå·²æˆåŠŸï¼‰å’Œ<code>rejected</code>ï¼ˆå·²å¤±è´¥ï¼‰ã€‚åªæœ‰å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œå¯ä»¥å†³å®šå½“å‰æ˜¯å“ªä¸€ç§çŠ¶æ€ï¼Œä»»ä½•å…¶ä»–æ“ä½œéƒ½æ— æ³•æ”¹å˜è¿™ä¸ªçŠ¶æ€ã€‚è¿™ä¹Ÿæ˜¯<code>Promise</code>è¿™ä¸ªåå­—çš„ç”±æ¥ï¼Œå®ƒçš„è‹±è¯­æ„æ€å°±æ˜¯â€œæ‰¿è¯ºâ€ï¼Œè¡¨ç¤ºå…¶ä»–æ‰‹æ®µæ— æ³•æ”¹å˜ã€‚</p>
<p>ï¼ˆ2ï¼‰ä¸€æ—¦çŠ¶æ€æ”¹å˜ï¼Œå°±ä¸ä¼šå†å˜ï¼Œä»»ä½•æ—¶å€™éƒ½å¯ä»¥å¾—åˆ°è¿™ä¸ªç»“æœã€‚<code>Promise</code>å¯¹è±¡çš„çŠ¶æ€æ”¹å˜ï¼Œåªæœ‰ä¸¤ç§å¯èƒ½ï¼šä»<code>pending</code>å˜ä¸º<code>fulfilled</code>å’Œä»<code>pending</code>å˜ä¸º<code>rejected</code>ã€‚åªè¦è¿™ä¸¤ç§æƒ…å†µå‘ç”Ÿï¼ŒçŠ¶æ€å°±å‡å›ºäº†ï¼Œä¸ä¼šå†å˜äº†ï¼Œä¼šä¸€ç›´ä¿æŒè¿™ä¸ªç»“æœï¼Œè¿™æ—¶å°±ç§°ä¸º resolvedï¼ˆå·²å®šå‹ï¼‰ã€‚å¦‚æœæ”¹å˜å·²ç»å‘ç”Ÿäº†ï¼Œä½ å†å¯¹<code>Promise</code>å¯¹è±¡æ·»åŠ å›è°ƒå‡½æ•°ï¼Œä¹Ÿä¼šç«‹å³å¾—åˆ°è¿™ä¸ªç»“æœã€‚è¿™ä¸äº‹ä»¶ï¼ˆEventï¼‰å®Œå…¨ä¸åŒï¼Œäº‹ä»¶çš„ç‰¹ç‚¹æ˜¯ï¼Œå¦‚æœä½ é”™è¿‡äº†å®ƒï¼Œå†å»ç›‘å¬ï¼Œæ˜¯å¾—ä¸åˆ°ç»“æœçš„ã€‚</p>
</blockquote>
<p>ç”±äºPromiseåªèƒ½è¢«å†³è®®ä¸€æ¬¡ï¼Œä¸”å†³è®®ä¹‹åæ— æ³•æ”¹å˜ï¼Œæ‰€ä»¥ï¼Œå³ä¾¿æ˜¯å¤šæ¬¡å›è°ƒï¼Œä¹Ÿä¸ä¼šå½±å“ç»“æœï¼Œå†³è®®ä¹‹åçš„è°ƒç”¨éƒ½ä¼šè¢«å¿½ç•¥ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¿¡ä»»é—®é¢˜æ¼”ç¤º</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å›è°ƒ</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">method</span>(<span class="params">cb</span>)</span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        cb &amp;&amp; cb();</span><br><span class="line">        <span class="comment">//å› ä¸ºæŸäº›bugå¯¼è‡´æŸä¸ªå‡½æ•°å¤šæ‰§è¡Œäº†ä¸€æ¬¡</span></span><br><span class="line">        cb &amp;&amp; cb();</span><br><span class="line">    &#125;,<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//promise</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">method2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span>=&gt;</span>&#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            resolve();</span><br><span class="line">            <span class="comment">//resolveæˆåŠŸè°ƒç”¨ä¸€æ¬¡ä¹‹åï¼Œåé¢çš„ä¸ä¼šå†æ‰§è¡Œ</span></span><br><span class="line">            resolve();</span><br><span class="line">        &#125;,<span class="number">1000</span>);        </span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ§åˆ¶åè½¬ã€‚ä½“ç°åœ¨å¯¹äºå‡½æ•°çš„æŠŠæ§ï¼Œæ¯”å¦‚thisç­‰ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å›è°ƒ</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">method</span>(<span class="params">cb</span>)</span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        cb &amp;&amp; cb.call(&#123;<span class="attr">a</span>:<span class="number">1</span>,<span class="attr">b</span>:<span class="number">2</span>&#125;);<span class="comment">//æ‰§è¡Œå›è°ƒï¼Œä½†æ˜¯æ·»æ²¹åŠ é†‹</span></span><br><span class="line">    &#125;,<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//promise</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">method2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span>=&gt;</span>&#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            resolve();<span class="comment">//è°ƒç”¨çš„resolveéƒ½æ˜¯è‡ªå·±å†™çš„ï¼Œæ”¹å–„äº†æ§åˆ¶åè½¬çš„é—®é¢˜</span></span><br><span class="line">        &#125;,<span class="number">1000</span>);        </span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ‰‹æ’•A-è§„èŒƒçš„promise"><a href="#æ‰‹æ’•A-è§„èŒƒçš„promise" class="headerlink" title="æ‰‹æ’•A+è§„èŒƒçš„promise"></a>æ‰‹æ’•A+è§„èŒƒçš„promise</h3><blockquote>
<p>é¢è¯•é¢˜ï¼šä½ çŸ¥é“promiseçš„A+è§„èŒƒå—ï¼Ÿï¼ˆæœ¬äººåœ¨æµ©é²¸ç§‘æŠ€è¢«é—®åˆ°çš„ï¼Œå½“æ—¶ç­”çš„æ”¯æ”¯å¾å¾ã€‚ã€‚ã€‚ï¼‰</p>
</blockquote>
<p>æˆ‘ä½•æ­¢æ˜¯çŸ¥é“ï¼Œæˆ‘ç”šè‡³å¯ä»¥æ‰‹å†™ä¸€ä¸ªç¬¦åˆA+è§„èŒƒçš„promiseï¼</p>
<p>A+è§„èŒƒå¿«é€Ÿå…¥å£ï¼Œ<a href="https://promisesaplus.com/" target="_blank" rel="noopener">ç‚¹æˆ‘</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyPromise</span>(<span class="params">executor</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚</span></span><br><span class="line">  <span class="keyword">let</span> self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="comment">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class="line">  self.status = <span class="string">'pending'</span>;</span><br><span class="line">  <span class="comment">// å­˜å‚¨æˆåŠŸçš„å€¼</span></span><br><span class="line">  self.value = <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">// å­˜å‚¨å¤±è´¥çš„å€¼</span></span><br><span class="line">  self.reason = <span class="literal">null</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class="line">    <span class="keyword">if</span>(self.status === <span class="string">'pending'</span>) &#123;</span><br><span class="line">      <span class="comment">// å­˜ä¸‹æˆåŠŸçš„å€¼</span></span><br><span class="line">      self.value = value</span><br><span class="line">      self.status = <span class="string">'fulfilled'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">reject</span>(<span class="params">reason</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class="line">    <span class="keyword">if</span>(self.status === <span class="string">'pending'</span>) &#123;</span><br><span class="line">      <span class="comment">// å­˜ä¸‹å¤±è´¥çš„å€¼</span></span><br><span class="line">      self.reason = reason</span><br><span class="line">      self.status = <span class="string">'rejected'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  executor(resolve, reject);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>promiseé‡Œé¢æœ€éš¾çš„å°±æ˜¯thenäº†ï¼Œæˆ‘ä»¬å¿…é¡»å°†è¿™ä¸ªæ–¹æ³•å†™åœ¨ä»–çš„åŸå‹é“¾ä¸Šé¢ï¼Œå¹¶ä¸”ä»–æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯æˆåŠŸçš„å›è°ƒï¼Œä¸€ä¸ªæ˜¯å¤±è´¥çš„å›è°ƒã€‚</p>
<p>åºŸè¯ä¸å¤šè¯´ï¼Œå¼€å†²ï¼</p>
<h4 id="æ”¯æŒå¼‚æ­¥"><a href="#æ”¯æŒå¼‚æ­¥" class="headerlink" title="æ”¯æŒå¼‚æ­¥"></a>æ”¯æŒå¼‚æ­¥</h4><p>åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åŠ ä¸¤ä¸ªå˜é‡ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyPromise</span>(<span class="params">executor</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚</span></span><br><span class="line">  <span class="keyword">let</span> self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="comment">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class="line">  self.status = <span class="string">'pending'</span>;</span><br><span class="line">  <span class="comment">// å­˜å‚¨æˆåŠŸçš„å€¼</span></span><br><span class="line">  self.value = <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">// å­˜å‚¨å¤±è´¥çš„å€¼</span></span><br><span class="line">  self.reason = <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">// å­˜å‚¨æˆåŠŸçš„å›è°ƒ</span></span><br><span class="line">  self.onResolved = [];</span><br><span class="line">  <span class="comment">// å­˜å‚¨å¤±è´¥çš„å›è°ƒ</span></span><br><span class="line">  self.onRejected = [];</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class="line">    <span class="keyword">if</span>(self.status === <span class="string">'pending'</span>) &#123;</span><br><span class="line">      <span class="comment">// å­˜ä¸‹æˆåŠŸçš„å€¼</span></span><br><span class="line">      self.value = value</span><br><span class="line">      self.status = <span class="string">'fulfilled'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">reject</span>(<span class="params">reason</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class="line">    <span class="keyword">if</span>(self.status === <span class="string">'pending'</span>) &#123;</span><br><span class="line">      <span class="comment">// å­˜ä¸‹å¤±è´¥çš„å€¼</span></span><br><span class="line">      self.reason = reason</span><br><span class="line">      self.status = <span class="string">'rejected'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  executor(resolve, reject);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¢œå€¼é«˜åˆç»†å¿ƒçš„åŒå­¦ä¼šå‘ç°ï¼Œæˆ‘å¤šåŠ äº†ä¸¤ä¸ªå˜é‡ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å­˜å‚¨æˆåŠŸçš„å›è°ƒ</span></span><br><span class="line">self.onResolved = [];</span><br><span class="line"><span class="comment">// å­˜å‚¨å¤±è´¥çš„å›è°ƒ</span></span><br><span class="line">self.onRejected = [];</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸¤ä¸ªå˜é‡å‘¢ï¼Œä¹Ÿéå¸¸å¥½ç†è§£ï¼Œå°±æ˜¯å­˜å‚¨å›è°ƒçš„ã€‚é‚£ä¹ˆæœ‰ä¸€ä¸ªéå¸¸éå¸¸é‡è¦çš„é—®é¢˜ï¼Œæˆ‘å†™çš„æ—¶å€™ä¹Ÿå›°æ‰°äº†å¥½ä¹…ï¼Œä¸ºä»€ä¹ˆä¸€å®šè¦æ˜¯ä¸€ä¸ªæ•°ç»„å‘¢ï¼Ÿæˆ‘å­˜å‚¨ä¸ºä¸€ä¸ªå‡½æ•°ä¸è¡Œå—ï¼Ÿåˆ°æ—¶å€™æ‰§è¡Œå°±è¡Œå•¦ã€‚ã€‚ã€‚</p>
<p>qsï¼Œå’Œæˆ‘æƒ³ä¸€æ ·çš„å¸…å“¥é“å¥³å¯èƒ½æ¯”è¾ƒå¤šã€‚è¿™é‡Œæˆ‘ç»Ÿä¸€å›å¤ï¼š</p>
<p>å‡å¦‚è¯´ã€‚ä»¥ä¸‹çš„æƒ…å†µå‡ºç°çš„è¯ï¼Œå’‹åŠã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>)=&gt;</span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        resolve(<span class="number">4</span>)</span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line">p.then(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//4 res</span></span><br><span class="line">    <span class="built_in">console</span>.log(res, <span class="string">'res'</span>)</span><br><span class="line">&#125;)</span><br><span class="line">p.then(<span class="function">(<span class="params">res1</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//4 res1</span></span><br><span class="line">    <span class="built_in">console</span>.log(res1, <span class="string">'res1'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>è¿™ç§æƒ…å†µå‡ºç°ï¼Œå¦‚æœæˆ‘ä»¬åªæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„<code>console.log(res, &#39;res&#39;)</code>è¿™è¾ˆå­éƒ½æ— æ³•é—®ä¸–ï¼Œä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºè¢«åé—¨çš„<code>console.log(res1, &#39;res&#39;)</code>ç»™è¦†ç›–äº†å‘€ã€‚å¯¹ä¸å¯¹ï¼Œå¦‚æœè¯´è¿™ä¸ª<code>resolve</code>ä»–å»¶è¿Ÿæ‰§è¡Œï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦åšçš„æ˜¯æŠŠ<code>then</code>å‡½æ•°ç»™ä¿å­˜ä¸‹æ¥ï¼Œç­‰åˆ°<code>resolve</code>è¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œä¾æ¬¡æ‰§è¡Œæˆ‘ä»¬æ‰€æœ‰åˆ›å»ºçš„<code>then</code>é‡Œé¢çš„å›è°ƒå‡½æ•°ã€‚</p>
<p>å¬æ‡‚æŒå£°ï¼</p>
<p>æ²¡å¬æ‡‚çš„æ¥ç€å¾€ä¸‹çœ‹ï¼Œæˆ‘ä»¬æŠŠå‰©ä½™å·¥ä½œåšå®Œï¼Œç„¶åä¸¾ä¸€ä¸ªä¾‹å­ã€‚é©¬ä¸Šå°±èƒ½æ˜ç™½äº†ã€‚</p>
<p>åˆšåˆšè¯´åˆ°ï¼Œæˆ‘ä»¬è¡¥å……ä¸¤ä¸ªå˜é‡ï¼Œç„¶åå†™ä¸‹æˆ‘ä»¬çš„<code>then</code>å‡½æ•°ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">MyPromise.prototype.then = <span class="function"><span class="keyword">function</span>(<span class="params">onFulfilled, onRejected</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="comment">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class="line">  <span class="keyword">if</span>(self.status === <span class="string">'fulfilled'</span>) &#123;</span><br><span class="line">    onFulfilled(self.value);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class="line">  <span class="keyword">if</span>(self.status === <span class="string">'rejected'</span>) &#123;</span><br><span class="line">    onRejected(self.reason);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¦‚æœæ˜¯pendingåº”è¯¥å­˜å‚¨å½“å‰çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">  <span class="keyword">if</span>(self.status === <span class="string">'pending'</span>) &#123;</span><br><span class="line">    self.onResolved.push(<span class="function"><span class="params">()</span> =&gt;</span> &#123;onFulfilled(self.value)&#125;)</span><br><span class="line">    self.onRejected.push(<span class="function"><span class="params">()</span> =&gt;</span> &#123;onRejected(self.reason)&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬è¿˜éœ€è¦åœ¨<code>resolve</code>æˆ–è€…<code>reject</code>çš„æ—¶å€™æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨èµ·æ¥çš„è¿™äº›å‡½æ•°ã€‚</p>
<p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyPromise</span>(<span class="params">executor</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚</span></span><br><span class="line">  <span class="keyword">let</span> self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="comment">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class="line">  self.status = <span class="string">'pending'</span>;</span><br><span class="line">  <span class="comment">// å­˜å‚¨æˆåŠŸçš„å€¼</span></span><br><span class="line">  self.value = <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">// å­˜å‚¨å¤±è´¥çš„å€¼</span></span><br><span class="line">  self.reason = <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">// å­˜å‚¨æˆåŠŸçš„å›è°ƒ</span></span><br><span class="line">  self.onResolved = [];</span><br><span class="line">  <span class="comment">// å­˜å‚¨å¤±è´¥çš„å›è°ƒ</span></span><br><span class="line">  self.onRejected = [];</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class="line">    <span class="keyword">if</span>(self.status === <span class="string">'pending'</span>) &#123;</span><br><span class="line">      <span class="comment">// å­˜ä¸‹æˆåŠŸçš„å€¼</span></span><br><span class="line">      self.value = value</span><br><span class="line">      self.status = <span class="string">'fulfilled'</span>;</span><br><span class="line">      <span class="comment">// æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;</span></span><br><span class="line">      self.onResolved.forEach(<span class="function"><span class="params">fn</span> =&gt;</span> fn())</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">reject</span>(<span class="params">reason</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class="line">    <span class="keyword">if</span>(self.status === <span class="string">'pending'</span>) &#123;</span><br><span class="line">      <span class="comment">// å­˜ä¸‹å¤±è´¥çš„å€¼</span></span><br><span class="line">      self.reason = reason</span><br><span class="line">      self.status = <span class="string">'rejected'</span>;</span><br><span class="line">      <span class="comment">// æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;</span></span><br><span class="line">      self.onRejected.forEach(<span class="function"><span class="params">fn</span> =&gt;</span> fn())</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  executor(resolve, reject);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MyPromise.prototype.then = <span class="function"><span class="keyword">function</span>(<span class="params">onFulfilled, onRejected</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="comment">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class="line">  <span class="keyword">if</span>(self.status === <span class="string">'fulfilled'</span>) &#123;</span><br><span class="line">    onFulfilled(self.value);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class="line">  <span class="keyword">if</span>(self.status === <span class="string">'rejected'</span>) &#123;</span><br><span class="line">    onRejected(self.reason);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¦‚æœæ˜¯pendingåº”è¯¥å­˜å‚¨å½“å‰çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">  <span class="keyword">if</span>(self.status === <span class="string">'pending'</span>) &#123;</span><br><span class="line">    self.onResolved.push(<span class="function"><span class="params">()</span> =&gt;</span> &#123;onFulfilled(self.value)&#125;)</span><br><span class="line">    self.onRejected.push(<span class="function"><span class="params">()</span> =&gt;</span> &#123;onRejected(self.reason)&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>OKã€‚æˆ‘ä»¬å…ˆè¯•è¯•æˆ‘ä»¬è‡ªå·±å†™çš„promiseã€‚è·‘ä¸€ä¸‹demoå§ã€‚ä¸ºäº†ç»™æ‡’åŒå­¦ä¾¿æ·çš„è°ƒè¯•ï¼Œç›´æ¥CVä¸‹é¢å°±å¥½å•¦ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyPromise</span>(<span class="params">executor</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚</span></span><br><span class="line">  <span class="keyword">let</span> self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="comment">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class="line">  self.status = <span class="string">'pending'</span>;</span><br><span class="line">  <span class="comment">// å­˜å‚¨æˆåŠŸçš„å€¼</span></span><br><span class="line">  self.value = <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">// å­˜å‚¨å¤±è´¥çš„å€¼</span></span><br><span class="line">  self.reason = <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">// å­˜å‚¨æˆåŠŸçš„å›è°ƒ</span></span><br><span class="line">  self.onResolved = [];</span><br><span class="line">  <span class="comment">// å­˜å‚¨å¤±è´¥çš„å›è°ƒ</span></span><br><span class="line">  self.onRejected = [];</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class="line">    <span class="keyword">if</span>(self.status === <span class="string">'pending'</span>) &#123;</span><br><span class="line">      <span class="comment">// å­˜ä¸‹æˆåŠŸçš„å€¼</span></span><br><span class="line">      self.value = value</span><br><span class="line">      self.status = <span class="string">'fulfilled'</span>;</span><br><span class="line">      <span class="comment">// æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;</span></span><br><span class="line">      self.onResolved.forEach(<span class="function"><span class="params">fn</span> =&gt;</span> fn())</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">reject</span>(<span class="params">reason</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class="line">    <span class="keyword">if</span>(self.status === <span class="string">'pending'</span>) &#123;</span><br><span class="line">      <span class="comment">// å­˜ä¸‹å¤±è´¥çš„å€¼</span></span><br><span class="line">      self.reason = reason</span><br><span class="line">      self.status = <span class="string">'rejected'</span>;</span><br><span class="line">      <span class="comment">// æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;</span></span><br><span class="line">      self.onRejected.forEach(<span class="function"><span class="params">fn</span> =&gt;</span> fn())</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  executor(resolve, reject);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MyPromise.prototype.then = <span class="function"><span class="keyword">function</span>(<span class="params">onFulfilled, onRejected</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="comment">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class="line">  <span class="keyword">if</span>(self.status === <span class="string">'fulfilled'</span>) &#123;</span><br><span class="line">    onFulfilled(self.value);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class="line">  <span class="keyword">if</span>(self.status === <span class="string">'rejected'</span>) &#123;</span><br><span class="line">    onRejected(self.reason);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¦‚æœæ˜¯pendingåº”è¯¥å­˜å‚¨å½“å‰çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">  <span class="keyword">if</span>(self.status === <span class="string">'pending'</span>) &#123;</span><br><span class="line">    self.onResolved.push(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      onFulfilled(self.value)</span><br><span class="line">    &#125;)</span><br><span class="line">    self.onRejected.push(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      onRejected(self.reason)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> MyPromise(<span class="function">(<span class="params">resolve, reject</span>)=&gt;</span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    resolve(<span class="number">4</span>)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line">p.then(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">//4 res</span></span><br><span class="line">  <span class="built_in">console</span>.log(res, <span class="string">'res'</span>)</span><br><span class="line">&#125;)</span><br><span class="line">p.then(<span class="function">(<span class="params">res1</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">//4 res1</span></span><br><span class="line">  <span class="built_in">console</span>.log(res1, <span class="string">'res1'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>å—¯~å¦‚æ„¿è¾“å‡ºäº†ï¼Œé‚£å›åˆ°åˆšåˆšçš„é—®é¢˜ã€‚æˆ‘ä»¬æŠŠå›è°ƒçš„åœ°æ–¹ä¸è¦ç”¨æ•°ç»„è€Œç”¨å‡½æ•°å‘¢ï¼Ÿä¸ç”¨åŒå­¦ä»¬æ‰“å­—äº†ï¼Œç›´æ¥CVğŸ‘‡çš„ä»£ç å°±å¥½äº†ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyPromise</span>(<span class="params">executor</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚</span></span><br><span class="line">  <span class="keyword">let</span> self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="comment">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class="line">  self.status = <span class="string">'pending'</span>;</span><br><span class="line">  <span class="comment">// å­˜å‚¨æˆåŠŸçš„å€¼</span></span><br><span class="line">  self.value = <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">// å­˜å‚¨å¤±è´¥çš„å€¼</span></span><br><span class="line">  self.reason = <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">// å­˜å‚¨æˆåŠŸçš„å›è°ƒ</span></span><br><span class="line">  self.onResolved = [];</span><br><span class="line">  <span class="comment">// å­˜å‚¨å¤±è´¥çš„å›è°ƒ</span></span><br><span class="line">  self.onRejected = [];</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class="line">    <span class="keyword">if</span>(self.status === <span class="string">'pending'</span>) &#123;</span><br><span class="line">      <span class="comment">// å­˜ä¸‹æˆåŠŸçš„å€¼</span></span><br><span class="line">      self.value = value</span><br><span class="line">      self.status = <span class="string">'fulfilled'</span>;</span><br><span class="line">      <span class="comment">// æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;</span></span><br><span class="line">      self.onResolved.forEach(<span class="function"><span class="params">fn</span> =&gt;</span> fn())</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">reject</span>(<span class="params">reason</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class="line">    <span class="keyword">if</span>(self.status === <span class="string">'pending'</span>) &#123;</span><br><span class="line">      <span class="comment">// å­˜ä¸‹å¤±è´¥çš„å€¼</span></span><br><span class="line">      self.reason = reason</span><br><span class="line">      self.status = <span class="string">'rejected'</span>;</span><br><span class="line">      <span class="comment">// æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;</span></span><br><span class="line">      self.onRejected.forEach(<span class="function"><span class="params">fn</span> =&gt;</span> fn())</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  executor(resolve, reject);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MyPromise.prototype.then = <span class="function"><span class="keyword">function</span>(<span class="params">onFulfilled, onRejected</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="comment">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class="line">  <span class="keyword">if</span>(self.status === <span class="string">'fulfilled'</span>) &#123;</span><br><span class="line">    onFulfilled(self.value);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class="line">  <span class="keyword">if</span>(self.status === <span class="string">'rejected'</span>) &#123;</span><br><span class="line">    onRejected(self.reason);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¦‚æœæ˜¯pendingåº”è¯¥å­˜å‚¨å½“å‰çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">  <span class="keyword">if</span>(self.status === <span class="string">'pending'</span>) &#123;</span><br><span class="line">    self.onResolved.push(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      onFulfilled(self.value)</span><br><span class="line">    &#125;)</span><br><span class="line">    self.onRejected.push(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      onRejected(self.reason)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> MyPromise(<span class="function">(<span class="params">resolve, reject</span>)=&gt;</span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    resolve(<span class="number">4</span>)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line">p.then(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">//4 res</span></span><br><span class="line">  <span class="built_in">console</span>.log(res, <span class="string">'res'</span>)</span><br><span class="line">&#125;)</span><br><span class="line">p.then(<span class="function">(<span class="params">res1</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">//4 res1</span></span><br><span class="line">  <span class="built_in">console</span>.log(res1, <span class="string">'res1'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>æ˜¯ä¸æ˜¯åªæœ‰<code>console.log(res1, &#39;res1&#39;)</code>å•¦ï¼Ÿå› ä¸ºæ‰§è¡Œ<code>then</code>çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„resolveè¿˜æœ‰æ²¡æœ‰è¢«è°ƒç”¨ï¼Œå¦‚æœæˆ‘ä»¬æœ‰å¤šä¸ª<code>then</code>çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦æŠŠä»–ä»¬å­˜å‚¨èµ·æ¥ï¼Œç„¶åä¾æ¬¡è°ƒç”¨ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨åˆ°æ•°ç»„ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ˜¯åˆ«çš„æ–¹æ³•ï¼Œæ ¸å¿ƒæ€æƒ³å°±æ˜¯æŠŠä»–ä»¬å­˜èµ·æ¥ï¼Œåœ¨éœ€è¦è°ƒç”¨çš„æ—¶å€™è°ƒç”¨ã€‚</p>
<p>æ˜¯ä¸æ˜¯å¾ˆå¥½ç†è§£ï¼Ÿï¼ï¼</p>
<p>å¬æ‡‚æŒå£°ï¼</p>
<p>è€Œä¸”A+ä¹Ÿè¦æ±‚äº†ã€‚</p>
<blockquote>
<p><code>2.2.6:then</code> may be called multiple times on the same promise.</p>
<p>ï¼ˆpromise çš„ <code>then</code> å¯ä»¥é“¾å¼è°ƒç”¨å¤šæ¬¡ï¼‰</p>
<p>2.2.6.1ï¼šIf/when <code>promise</code> is fulfilled, all respective <code>onFulfilled</code> callbacks must execute in the order of their originating calls to <code>then</code>.</p>
<p>ï¼ˆå¦‚æœæˆ–å½“ promise è½¬æ€æ˜¯ fulfilled æ—¶ï¼Œæ‰€æœ‰çš„ onFulfilled å›è°ƒå›ä»¥ä»–ä»¬æ³¨å†Œæ—¶çš„é¡ºåºä¾æ¬¡æ‰§è¡Œï¼‰</p>
<p>2.2.6.2ï¼šIf/when <code>promise</code> is rejected, all respective <code>onRejected</code> callbacks must execute in the order of their originating calls to <code>then</code>.</p>
<p>ï¼ˆå¦‚æœæˆ–å½“ promise è½¬æ€æ˜¯ rejected æ—¶ï¼Œæ‰€æœ‰çš„ onRejected å›è°ƒå›ä»¥ä»–ä»¬æ³¨å†Œæ—¶çš„é¡ºåºä¾æ¬¡æ‰§è¡Œï¼‰</p>
</blockquote>
<p>æˆ‘ä»¬å¯¹promiseçš„ç†è§£æ›´è¿›ä¸€æ­¥äº†ã€‚è®°å¾—æŠŠä»£ç æ”¹å›å»ï¼Œç»§ç»­å¾€ä¸‹èµ°ã€‚</p>
<p>åˆšåˆšæˆ‘ä»¬çš„demoè¿˜ä¸å¤Ÿé²æ£’ï¼Œè€Œä¸”æˆ‘ä»¬çš„æµ‹è¯•ç”¨ä¾‹éƒ½æ˜¯å®Œç¾æƒ…å†µä¸‹ã€‚</p>
<p>æ¥ä¸‹æ¥è¦å‰‘èµ°åé”‹äº†ã€‚</p>
<blockquote>
<p>A+:</p>
<p>2.2.1ï¼šBoth <code>onFulfilled</code> and <code>onRejected</code> are optional arguments:</p>
<p>ï¼ˆonFulfilled å’Œ onRejected éƒ½æ˜¯å¯é€‰å‚æ•°ï¼šï¼‰</p>
<p>2.2.1.1 If <code>onFulfilled</code> is not a function, it must be ignored.</p>
<p>ï¼ˆå¦‚æœ onFulfilled ä¸æ˜¯å‡½æ•°ï¼Œå®ƒä¼šè¢«å¿½ç•¥ï¼‰</p>
<p>2.2.1.2 If <code>onRejected</code> is not a function, it must be ignored.</p>
<p>ï¼ˆå¦‚æœ onRejected ä¸æ˜¯å‡½æ•°ï¼Œå®ƒä¼šè¢«å¿½ç•¥ï¼‰</p>
<p>2.2.7.2: If either <code>onFulfilled</code> or <code>onRejected</code> throws an exception <code>e</code>, <code>promise2</code> must be rejected with <code>e</code> as the reason.</p>
<p>ï¼ˆå¦‚æœ onFulfilled æˆ– onRejected é‡ŒæŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸ï¼Œé‚£ä¹ˆ promise2 å¿…é¡»æ•è·è¿™ä¸ªé”™è¯¯ï¼ˆæ¥å—ä¸€ä¸ª reason å‚æ•°ï¼‰ï¼‰</p>
</blockquote>
<p>æ‰€ä»¥æˆ‘ä»¬é¦–å…ˆè¦åšçš„å°±æ˜¯ï¼ŒæŠŠé”™è¯¯ç»™æå‰æ•è·ï¼Œç„¶åä¸¢ç»™<code>reject</code></p>
<p>emmmâ€¦.æ¥ä¸‹æˆ‘è´´ä»£ç éƒ½æ˜¯ä¸€èµ·è´´äº†ï¼Œå› ä¸ºæˆ‘æ€•æœ‰åŒå­¦ä¼šæ‰é˜Ÿï¼Œé‡Œé¢ä¹Ÿä¼šæœ‰ç›¸åº”çš„æ³¨é‡Šå¸®åŠ©ä¼šèµ°ç¥çš„åŒå­¦è·Ÿç´§è¿™è¾†äº”è±å®å…‰ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyPromise</span>(<span class="params">executor</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚</span></span><br><span class="line">  <span class="keyword">let</span> self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="comment">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class="line">  self.status = <span class="string">'pending'</span>;</span><br><span class="line">  <span class="comment">// å­˜å‚¨æˆåŠŸçš„å€¼</span></span><br><span class="line">  self.value = <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">// å­˜å‚¨å¤±è´¥çš„å€¼</span></span><br><span class="line">  self.reason = <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">// å­˜å‚¨æˆåŠŸçš„å›è°ƒ</span></span><br><span class="line">  self.onResolved = [];</span><br><span class="line">  <span class="comment">// å­˜å‚¨å¤±è´¥çš„å›è°ƒ</span></span><br><span class="line">  self.onRejected = [];</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class="line">    <span class="keyword">if</span>(self.status === <span class="string">'pending'</span>) &#123;</span><br><span class="line">      <span class="comment">// å­˜ä¸‹æˆåŠŸçš„å€¼</span></span><br><span class="line">      self.value = value</span><br><span class="line">      self.status = <span class="string">'fulfilled'</span>;</span><br><span class="line">      <span class="comment">// æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;</span></span><br><span class="line">      self.onResolved.forEach(<span class="function"><span class="params">fn</span> =&gt;</span> fn())</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">reject</span>(<span class="params">reason</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class="line">    <span class="keyword">if</span>(self.status === <span class="string">'pending'</span>) &#123;</span><br><span class="line">      <span class="comment">// å­˜ä¸‹å¤±è´¥çš„å€¼</span></span><br><span class="line">      self.reason = reason</span><br><span class="line">      self.status = <span class="string">'rejected'</span>;</span><br><span class="line">      <span class="comment">// æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;</span></span><br><span class="line">      self.onRejected.forEach(<span class="function"><span class="params">fn</span> =&gt;</span> fn())</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æ•è·é”™è¯¯ä¼ ç»™rejectã€‚æ³•å¾‹è§„å®šï¼</span></span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">  	executor(resolve, reject);</span><br><span class="line">  &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">    reject(e);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MyPromise.prototype.then = <span class="function"><span class="keyword">function</span>(<span class="params">onFulfilled, onRejected</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="comment">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class="line">  <span class="comment">// å¦‚æœä¸æ˜¯å‡½æ•°å°±å¿½ç•¥ 2.2.1.1</span></span><br><span class="line">  <span class="keyword">if</span>(self.status === <span class="string">'fulfilled'</span>) &#123;</span><br><span class="line">    <span class="keyword">typeof</span> onFulfilled === <span class="string">'function'</span> &amp;&amp; onFulfilled(self.value);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class="line">  <span class="keyword">if</span>(self.status === <span class="string">'rejected'</span>) &#123;</span><br><span class="line">    <span class="keyword">typeof</span> onFulfilled === <span class="string">'function'</span> &amp;&amp; onRejected(self.reason);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¦‚æœæ˜¯pendingåº”è¯¥å­˜å‚¨å½“å‰çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">  <span class="comment">// å¦‚æœä¸æ˜¯å‡½æ•°å°±å¿½ç•¥ 2.2.1.2</span></span><br><span class="line">  <span class="keyword">if</span>(self.status === <span class="string">'pending'</span>) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœä¸æ˜¯å‡½æ•°å°±å¿½ç•¥ 2.2.1.1</span></span><br><span class="line">    <span class="keyword">typeof</span> onFulfilled === <span class="string">'function'</span> &amp;&amp; self.onResolved.push(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      onFulfilled(self.value)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// å¦‚æœä¸æ˜¯å‡½æ•°å°±å¿½ç•¥ 2.2.1.2</span></span><br><span class="line">    <span class="keyword">typeof</span> onFulfilled === <span class="string">'function'</span> &amp;&amp; self.onRejected.push(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      onRejected(self.reason)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="é“¾å¼è°ƒç”¨then"><a href="#é“¾å¼è°ƒç”¨then" class="headerlink" title="é“¾å¼è°ƒç”¨then"></a>é“¾å¼è°ƒç”¨then</h4><p>å¼€å§‹å‡†å¤‡è¿›å…¥promiseçš„éš¾ç‚¹ä»¥åŠæ ¸å¿ƒç‚¹ï¼šé“¾å¼è°ƒç”¨ã€‚</p>
<blockquote>
<p>2.2.7ï¼š<code>then</code> must return a promise</p>
<p>ï¼ˆthen æ–¹æ³•ä¸€å®šè¿”å›ä¸€ä¸ª promiseï¼‰</p>
</blockquote>
<p>æˆ‘ä»¬éœ€è¦è¿”å›æ–°çš„promiseçš„è¯ï¼Œå¯ä»¥ç®€å•å®ç°ï¼Œå¿«é€Ÿè¿­ä»£ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.prototype.then = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled, onRejected</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> promise2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>)=&gt;</span>&#123;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> promise2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>2.2.7.1ï¼šIf either <code>onFulfilled</code> or <code>onRejected</code> returns a value <code>x</code>, run the Promise Resolution Procedure <code>[[Resolve]](promise2, x)</code>.</p>
<p>ï¼ˆå¦‚æœ onFulfilled æˆ– onRejected è¿”å›çš„æ˜¯ä¸€ä¸ª xï¼Œé‚£ä¹ˆå®ƒä¼šä»¥[[Resolve]](promise2, x)` å¤„ç†è§£æï¼‰</p>
<p>2.2.7.2ï¼šIf either <code>onFulfilled</code> or <code>onRejected</code> throws an exception <code>e</code>, <code>promise2</code> must be rejected with <code>e</code> as the reason.</p>
<p>ï¼ˆå¦‚æœ onFulfilled æˆ– onRejected é‡ŒæŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸ï¼Œé‚£ä¹ˆ promise2 å¿…é¡»æ•è·è¿™ä¸ªé”™è¯¯ï¼ˆæ¥å—ä¸€ä¸ª reason å‚æ•°ï¼‰ï¼‰</p>
<p>2.2.7.3ï¼šIf <code>onFulfilled</code> is not a function and <code>promise1</code> is fulfilled, <code>promise2</code> must be fulfilled with the same value as <code>promise1</code>.</p>
<p>ï¼ˆå¦‚æœ onFulfilled ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸” promise1 çŠ¶æ€æ˜¯ fulfilledï¼Œé‚£ä¹ˆ promise2 ä¸€å®šä¼šæ¥å—åˆ°ä¸ promse1 ä¸€æ ·çš„å€¼ valueï¼‰</p>
<p>2.2.7.4ï¼šIf <code>onRejected</code> is not a function and <code>promise1</code> is rejected, <code>promise2</code> must be rejected with the same reason as <code>promise1</code>.</p>
<p>ï¼ˆå¦‚æœ onRejected ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸” promise1 çŠ¶æ€æ˜¯ rejectedï¼Œpromise2 ä¸€å®šä¼šæ¥å—åˆ°ä¸ promise1 ä¸€æ ·çš„å€¼ reasonï¼‰</p>
</blockquote>
<p>æˆ‘ä»¬éœ€è¦å°†è¿”å›å†…å®¹promiseåŒ–ï¼Œéœ€è¦å¯¹onFulfilledå’ŒonRejectedè¿›è¡Œé”™è¯¯å¤„ç†ï¼Œè¿™ä¸ªæˆ‘ä»¬ä¹‹å‰å°±å¤„ç†è¿‡äº†ï¼Œå¦‚æœonFulfilledå’ŒonRejectedæ²¡æœ‰ä¼ å‚å°±ç»§ç»­ä¼ é€’ï¼ŒåŸç”ŸğŸŒ°æ¥ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>)</span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        resolve(<span class="number">3</span>)</span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;);</span><br><span class="line">p.then(<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">.then(<span class="string">''</span>,<span class="string">''</span>)</span><br><span class="line">.then()</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//3</span></span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¸ç®¡onFulfilledå’ŒonRejectedä¼ ä»€ä¹ˆå€¼ï¼Œåªè¦ä¸æ˜¯å‡½æ•°ï¼Œå°±ç»§ç»­å‘ä¸‹ä¼ å…¥ï¼Œç›´åˆ°æœ‰å‡½æ•°è¿›è¡Œæ¥æ”¶ï¼›è¦åšçš„äº‹æƒ…å¤ªå¤šäº†ï¼Œä¸å½“å½“æ˜¯åˆ¤æ–­å‡½æ•°è¿™ç§ç®€å•çš„åˆ¤æ–­äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æŠ½ç¦»ä¸€ä¸ªæ–°çš„å‡½æ•°æ¥å¤ç”¨ç»Ÿä¸€å¤„ç†ã€‚å› æ­¤æˆ‘ä»¬è¿›è¡Œå¦‚ä¸‹å®Œå–„ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyPromise</span>(<span class="params">executor</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚</span></span><br><span class="line">  <span class="keyword">let</span> self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="comment">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class="line">  self.status = <span class="string">'pending'</span>;</span><br><span class="line">  <span class="comment">// å­˜å‚¨æˆåŠŸçš„å€¼</span></span><br><span class="line">  self.value = <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">// å­˜å‚¨å¤±è´¥çš„å€¼</span></span><br><span class="line">  self.reason = <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">// å­˜å‚¨æˆåŠŸçš„å›è°ƒ</span></span><br><span class="line">  self.onResolved = [];</span><br><span class="line">  <span class="comment">// å­˜å‚¨å¤±è´¥çš„å›è°ƒ</span></span><br><span class="line">  self.onRejected = [];</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class="line">    <span class="keyword">if</span>(self.status === <span class="string">'pending'</span>) &#123;</span><br><span class="line">      <span class="comment">// å­˜ä¸‹æˆåŠŸçš„å€¼</span></span><br><span class="line">      self.value = value</span><br><span class="line">      self.status = <span class="string">'fulfilled'</span>;</span><br><span class="line">      <span class="comment">// æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;</span></span><br><span class="line">      self.onResolved.forEach(<span class="function"><span class="params">fn</span> =&gt;</span> fn())</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">reject</span>(<span class="params">reason</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class="line">    <span class="keyword">if</span>(self.status === <span class="string">'pending'</span>) &#123;</span><br><span class="line">      <span class="comment">// å­˜ä¸‹å¤±è´¥çš„å€¼</span></span><br><span class="line">      self.reason = reason</span><br><span class="line">      self.status = <span class="string">'rejected'</span>;</span><br><span class="line">      <span class="comment">// æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;</span></span><br><span class="line">      self.onRejected.forEach(<span class="function"><span class="params">fn</span> =&gt;</span> fn())</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// æ•è·é”™è¯¯ä¼ ç»™rejectã€‚æ³•å¾‹è§„å®šï¼</span></span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">  	executor(resolve, reject);</span><br><span class="line">  &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">    reject(e);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolvePromise</span>(<span class="params">promise2, res, resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å¦‚æœpromise2å’Œç»“æœç›¸åŒï¼Œå°±è‡ªå·±æ— é™å¾ªç¯è°ƒç”¨è‡ªå·±çš„thenäº†ï¼Œæ­»äº¡å¾ªç¯ã€‚</span></span><br><span class="line">  <span class="comment">// ä¸¾ä¸ªğŸŒ°ï¼švar a = function()&#123;return a&#125;ï¼Œè¿™ä¸ªthenåˆä¼šè‡ªå·±æ— é™è§¦å‘ã€‚æ‰€ä»¥å°±ç©å®Œäº†ã€‚</span></span><br><span class="line">  <span class="keyword">if</span>(promise2 === res) &#123;</span><br><span class="line">    <span class="keyword">return</span> reject(<span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'å¾ªç¯å¼•ç”¨'</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(</span><br><span class="line">    res !== <span class="literal">null</span> </span><br><span class="line">    &amp;&amp; (<span class="keyword">typeof</span> res === <span class="string">'object'</span>) || <span class="keyword">typeof</span> res === <span class="string">'function'</span>)</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// ä¿å­˜æ˜¯å¦å·²ç»è°ƒç”¨è¿‡å‡½æ•°ã€‚</span></span><br><span class="line">      <span class="comment">// 2.3.3.3.3 If both resolvePromise and rejectPromise are called, or multiple calls to the same argument are made, the first call takes precedence, and any further calls are ignored.(å¦‚æœ resolvePromise å’Œ rejectPromise å·²ç»è¢«è°ƒç”¨æˆ–ä»¥ç›¸åŒçš„å‚æ•°å¤šæ¬¡è°ƒç”¨çš„è¯å—ï¼Œä¼˜å…ˆç¬¬ä¸€æ¬¡çš„è°ƒç”¨ï¼Œå¹¶ä¸”ä¹‹åçš„è°ƒç”¨å…¨éƒ¨è¢«å¿½ç•¥ï¼ˆé¿å…å¤šæ¬¡è°ƒç”¨ï¼‰)</span></span><br><span class="line">      <span class="keyword">let</span> used = <span class="literal">false</span>;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 2.3.3.1ï¼šLet then be x.then. [3.5](æŠŠ x.then èµ‹å€¼ç»™ then å˜é‡)</span></span><br><span class="line">      <span class="comment">// å¯ä»¥æé˜²æœ‰äººæ¶æã€‚åƒğŸ‘‡</span></span><br><span class="line">      <span class="comment">// Object.defineProperty(Promise, 'then', &#123;</span></span><br><span class="line">      <span class="comment">//    get: function()&#123;</span></span><br><span class="line">      <span class="comment">//        throw Error('error')</span></span><br><span class="line">      <span class="comment">//    &#125;</span></span><br><span class="line">      <span class="comment">// &#125;)</span></span><br><span class="line">      <span class="comment">// è¿™æ ·çš„è¯æˆ‘ä»¬å–å€¼å°±ä¼šæŠ¥é”™ã€‚</span></span><br><span class="line">      <span class="keyword">let</span> then = res.then;</span><br><span class="line">      <span class="comment">// å¦‚æœthenæ˜¯å‡½æ•°ï¼Œå°±é»˜è®¤æ˜¯promiseäº†   </span></span><br><span class="line">      <span class="keyword">if</span>(<span class="keyword">typeof</span> then === <span class="string">'function'</span>) &#123;</span><br><span class="line">        then.call(</span><br><span class="line">          res, </span><br><span class="line">          value =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span>(used) &#123;</span><br><span class="line">              <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            used = <span class="literal">true</span>;</span><br><span class="line">            <span class="comment">// é€’å½’è§£æï¼Œç›´åˆ°ä¸æ˜¯ä¸€ä¸ªpromiseä¸ºæ­¢</span></span><br><span class="line">            resolvePromise(promise2, value, resolve, reject);</span><br><span class="line">        	&#125;,</span><br><span class="line">          reason =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span>(used) &#123;</span><br><span class="line">              <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            used = <span class="literal">true</span>;</span><br><span class="line">            reject(reason);</span><br><span class="line">          &#125;</span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">if</span>(used) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      used = <span class="literal">true</span>;</span><br><span class="line">      reject(e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœä¸æ˜¯å‡½æ•°æˆ–è€…å¯¹è±¡ä¹Ÿä¸ä¸ºç©ºå°±ç›´æ¥ç»§ç»­ä¼ é€’è¿™ä¸ªå€¼ã€‚</span></span><br><span class="line">	  resolve(res);  </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MyPromise.prototype.then = <span class="function"><span class="keyword">function</span>(<span class="params">onFulfilled, onRejected</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="comment">// åªæœ‰promiseæ‰å¯ä»¥æŒç»­çš„é“¾å¼è°ƒç”¨then,æ‰€ä»¥è¿™é‡Œå¼„äº†ä¸€ä¸ªæ–°çš„promise</span></span><br><span class="line">  <span class="keyword">let</span> promise2 = <span class="keyword">new</span> MyPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class="line">    <span class="keyword">if</span>(self.status === <span class="string">'fulfilled'</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> res = onFulfilled(self.value);</span><br><span class="line">      resolvePromise(promise2, res, resolve, reject);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class="line">    <span class="keyword">if</span>(self.status === <span class="string">'rejected'</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> res = onRejected(self.reason);</span><br><span class="line">      resolvePromise(promise2, res, resolve, reject);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯pendingåº”è¯¥å­˜å‚¨å½“å‰çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">    <span class="keyword">if</span>(self.status === <span class="string">'pending'</span>) &#123;</span><br><span class="line">      self.onResolved.push(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> res = onFulfilled(self.value);</span><br><span class="line">      resolvePromise(promise2, res, resolve, reject);</span><br><span class="line">      &#125;)</span><br><span class="line">      self.onRejected.push(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> res = onRejected(self.reason);</span><br><span class="line">      resolvePromise(promise2, res, resolve, reject);</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šå°±æ˜¯ç¬¦åˆ Promise/A+ è§„èŒƒçš„å®ç°äº†ï¼Œå¦‚æœä½ å¯¹äºè¿™éƒ¨åˆ†ä»£ç å°šæœ‰ç–‘é—®ï¼Œæ¬¢è¿åœ¨è¯„è®ºä¸­ä¸æˆ‘äº’åŠ¨ã€‚</p>
<h2 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a>Generator</h2><blockquote>
<p>é¢è¯•é¢˜ï¼šä»‹ç»ä¸€ä¸‹generatorå§ã€‚</p>
</blockquote>
<p>å¾ˆå¤šå°ä¼™ä¼´å¯èƒ½å’Œæˆ‘ä¸€æ ·ï¼Œåªæ˜¯ä¼šç”¨ï¼Œä½†æ˜¯ä½ ç¡¬è¦æˆ‘ä»‹ç»ï¼Œé‚£æˆ‘å’‹æï¼Ÿgeneratorçš„æ‹¼å†™æ˜¯g e n e r a t o rï¼Ÿ</p>
<p>â€œå“”â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€</p>
<p>å…¶å®æˆ‘é‡æ¸©äº†ä¸€ä¸‹é˜®è€å¸ˆçš„es6è¯¾ç¨‹ï¼Œå‘ç°å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ¥ä»‹ç»ã€‚</p>
<ul>
<li>å½¢å¼ä¸Š<ul>
<li>generatorå’Œæ™®é€šçš„å‡½æ•°ä¸åŒç‚¹åœ¨äºï¼Œå¯¹ä¸€ä¸ª<code>*</code>å·ï¼Œå‡½æ•°å†…éƒ¨ä½¿ç”¨äº†yieldè¡¨è¾¾å¼</li>
</ul>
</li>
<li>è¯­æ³•ä¸Š<ul>
<li>Generatorå‡½æ•°å°è£…äº†å¤šä¸ªå†…éƒ¨çŠ¶æ€(é€šè¿‡yieldè¡¨è¾¾å¼å®šä¹‰å†…éƒ¨çŠ¶æ€)ã€‚æ‰§è¡ŒGeneratorå‡½æ•°æ—¶ä¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡(Iteratorå¯¹è±¡)ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒGeneratoræ˜¯éå†å™¨å¯¹è±¡ç”Ÿæˆå‡½æ•°ï¼Œå‡½æ•°å†…éƒ¨å°è£…äº†å¤šä¸ªçŠ¶æ€ã€‚é€šè¿‡è¿”å›çš„Iteratorå¯¹è±¡ï¼Œå¯ä»¥ä¾æ¬¡éå†(è°ƒç”¨nextæ–¹æ³•)Generatorå‡½æ•°çš„æ¯ä¸ªå†…éƒ¨çŠ¶æ€ã€‚</li>
</ul>
</li>
<li>è°ƒç”¨ä¸Š<ul>
<li>æ™®é€šå‡½æ•°åœ¨è°ƒç”¨ä¹‹åä¼šç«‹å³æ‰§è¡Œï¼Œè€ŒGeneratorå‡½æ•°è°ƒç”¨ä¹‹åä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯ä¼šè¿”å›éå†å™¨å¯¹è±¡(Iteratorå¯¹è±¡)ã€‚é€šè¿‡Iteratorå¯¹è±¡çš„nextæ–¹æ³•æ¥éå†å†…éƒ¨yieldè¡¨è¾¾å¼å®šä¹‰çš„æ¯ä¸€ä¸ªçŠ¶æ€ã€‚</li>
</ul>
</li>
</ul>
<p>å…¶å®æˆ‘è§‰å¾—ï¼Œå¦‚æœèƒ½æŠŠä¸‹é¢çš„è¿™ä¸ªæ¡ˆä¾‹å¼„æ¸…æ¥šï¼Œgeneratorå°±ç®—è¿‡å…³äº†ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">foo</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> y = <span class="number">2</span> * (<span class="keyword">yield</span> (x + <span class="number">1</span>))</span><br><span class="line">  <span class="keyword">let</span> z = <span class="keyword">yield</span> (y / <span class="number">3</span>)</span><br><span class="line">  <span class="keyword">return</span> (x + y + z)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> it = foo(<span class="number">5</span>)</span><br><span class="line"><span class="built_in">console</span>.log(it.next())   <span class="comment">// =&gt; &#123;value: 6, done: false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(it.next(<span class="number">12</span>)) <span class="comment">// =&gt; &#123;value: 8, done: false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(it.next(<span class="number">13</span>)) <span class="comment">// =&gt; &#123;value: 42, done: true&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>é¦–å…ˆ <code>Generator</code> å‡½æ•°è°ƒç”¨å’Œæ™®é€šå‡½æ•°ä¸åŒï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªè¿­ä»£å™¨</li>
<li>å½“æ‰§è¡Œç¬¬ä¸€æ¬¡ <code>next</code> æ—¶ï¼Œä¼ å‚ä¼šè¢«å¿½ç•¥ï¼Œå¹¶ä¸”å‡½æ•°æš‚åœåœ¨ <code>yield (x + 1)</code> å¤„ï¼Œæ‰€ä»¥è¿”å› <code>5 + 1 = 6</code></li>
<li>å½“æ‰§è¡Œç¬¬äºŒæ¬¡ <code>next</code> æ—¶ï¼Œä¼ å…¥çš„å‚æ•°ç­‰äºä¸Šä¸€ä¸ª <code>yield</code> çš„è¿”å›å€¼ï¼Œå¦‚æœä½ ä¸ä¼ å‚ï¼Œ<code>yield</code> æ°¸è¿œè¿”å› <code>undefined</code>ã€‚æ­¤æ—¶ <code>let y = 2 * 12</code>ï¼Œæ‰€ä»¥ç¬¬äºŒä¸ª <code>yield</code> ç­‰äº <code>2 * 12 / 3 = 8</code></li>
<li>å½“æ‰§è¡Œç¬¬ä¸‰æ¬¡ <code>next</code> æ—¶ï¼Œä¼ å…¥çš„å‚æ•°ä¼šä¼ é€’ç»™ <code>z</code>ï¼Œæ‰€ä»¥ <code>z = 13, x = 5, y = 24</code>ï¼Œç›¸åŠ ç­‰äº <code>42</code></li>
</ul>
<h2 id="async-await"><a href="#async-await" class="headerlink" title="async/await"></a>async/await</h2><blockquote>
<p>ä»€ä¹ˆæ˜¯async/awaitï¼Ÿ</p>
</blockquote>
<p>å…¶å®å°±ä¸€å¥è¯ï¼š<strong>async å‡½æ•°å°±æ˜¯ Generator å‡½æ•°çš„è¯­æ³•ç³–ã€‚</strong></p>
<p>generatorï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gen = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> f1 = <span class="keyword">yield</span> readFile(<span class="string">'/etc/fstab'</span>);</span><br><span class="line">  <span class="keyword">var</span> f2 = <span class="keyword">yield</span> readFile(<span class="string">'/etc/shells'</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(f1.toString());</span><br><span class="line">  <span class="built_in">console</span>.log(f2.toString());</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Async:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> asyncReadFile = <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> f1 = <span class="keyword">await</span> readFile(<span class="string">'/etc/fstab'</span>);</span><br><span class="line">  <span class="keyword">var</span> f2 = <span class="keyword">await</span> readFile(<span class="string">'/etc/shells'</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(f1.toString());</span><br><span class="line">  <span class="built_in">console</span>.log(f2.toString());</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ä¸€æ¯”è¾ƒå°±ä¼šå‘ç°ï¼Œasync å‡½æ•°å°±æ˜¯å°† Generator å‡½æ•°çš„æ˜Ÿå·ï¼ˆ*ï¼‰æ›¿æ¢æˆ asyncï¼Œå°† yield æ›¿æ¢æˆ awaitï¼Œä»…æ­¤è€Œå·²ã€‚</p>
<p>asyncå¯¹generatorè¿›è¡Œäº†ä»¥ä¸‹ä¸‰ç‚¹çš„æ”¹è¿›ï¼š</p>
<ol>
<li><strong>å†…ç½®æ‰§è¡Œå™¨ã€‚</strong> Generator å‡½æ•°çš„æ‰§è¡Œå¿…é¡»é æ‰§è¡Œå™¨ï¼Œæ‰€ä»¥æ‰æœ‰äº† co å‡½æ•°åº“ï¼Œè€Œ async å‡½æ•°è‡ªå¸¦æ‰§è¡Œå™¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œasync å‡½æ•°çš„æ‰§è¡Œï¼Œä¸æ™®é€šå‡½æ•°ä¸€æ¨¡ä¸€æ ·ï¼Œåªè¦ä¸€è¡Œã€‚</li>
<li><strong>æ›´å¥½çš„è¯­ä¹‰ã€‚</strong> async å’Œ awaitï¼Œæ¯”èµ·æ˜Ÿå·å’Œ yieldï¼Œè¯­ä¹‰æ›´æ¸…æ¥šäº†ã€‚async è¡¨ç¤ºå‡½æ•°é‡Œæœ‰å¼‚æ­¥æ“ä½œï¼Œawait è¡¨ç¤ºç´§è·Ÿåœ¨åé¢çš„è¡¨è¾¾å¼éœ€è¦ç­‰å¾…ç»“æœã€‚</li>
<li><strong>æ›´å¹¿çš„é€‚ç”¨æ€§ã€‚</strong> co å‡½æ•°åº“çº¦å®šï¼Œyield å‘½ä»¤åé¢åªèƒ½æ˜¯ Thunk å‡½æ•°æˆ– Promise å¯¹è±¡ï¼Œè€Œ async å‡½æ•°çš„ await å‘½ä»¤åé¢ï¼Œå¯ä»¥è·Ÿ Promise å¯¹è±¡å’ŒåŸå§‹ç±»å‹çš„å€¼ï¼ˆæ•°å€¼ã€å­—ç¬¦ä¸²å’Œå¸ƒå°”å€¼ï¼Œä½†è¿™æ—¶ç­‰åŒäºåŒæ­¥æ“ä½œï¼‰ã€‚</li>
</ol>
<p>ä¸€ä¸ªå‡½æ•°å¦‚æœåŠ ä¸Šäº†asyncï¼Œé‚£ä¹ˆå°±ä¼šé»˜è®¤è¿”å›ä¸€ä¸ªpromise</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">args</span>)</span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰åŒäº</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">args</span>)</span>&#123; </span><br><span class="line">  <span class="keyword">return</span> spawn(<span class="function"><span class="keyword">function</span>*(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h3><p>await å‘½ä»¤åé¢çš„ Promise å¯¹è±¡ï¼Œè¿è¡Œç»“æœå¯èƒ½æ˜¯ rejectedï¼Œæ‰€ä»¥æœ€å¥½æŠŠ await å‘½ä»¤æ”¾åœ¨ tryâ€¦catch ä»£ç å—ä¸­ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">myFunction</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> somethingThatReturnsAPromise();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦ä¸€ç§å†™æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">myFunction</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">await</span> somethingThatReturnsAPromise().catch(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>await å‘½ä»¤åªèƒ½ç”¨åœ¨ async å‡½æ•°ä¹‹ä¸­ï¼Œå¦‚æœç”¨åœ¨æ™®é€šå‡½æ•°ï¼Œå°±ä¼šæŠ¥é”™ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">dbFuc</span>(<span class="params">db</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> docs = [&#123;&#125;, &#123;&#125;, &#123;&#125;];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æŠ¥é”™</span></span><br><span class="line">  docs.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">doc</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">await</span> db.post(doc);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><blockquote>
<p><a href="https://es6.ruanyifeng.com/#docs/generator" target="_blank" rel="noopener">https://es6.ruanyifeng.com/#docs/generator</a></p>
</blockquote>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="mailto:undefined">Derrick</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="http://derricktel.github.io/2020/08/28/%E3%80%90%E9%87%8D%E8%AF%86%E5%89%8D%E7%AB%AF%E3%80%91%E6%9A%B4%E8%B5%B0%E7%9A%84%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/">http://derricktel.github.io/2020/08/28/%E3%80%90%E9%87%8D%E8%AF%86%E5%89%8D%E7%AB%AF%E3%80%91%E6%9A%B4%E8%B5%B0%E7%9A%84%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="http://derricktel.github.io" target="_blank">Derrick</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/JavaScript/">JavaScript</a></div><div class="post_share"><div class="social-share" data-image="/image/cover/github.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> æ‰“èµ<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/DerrickWechat.png" alt="å¾®ä¿¡"/><div class="post-qr-code__desc">å¾®ä¿¡</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/DerrickAlipay.jpg" alt="æ”¯ä»˜å¯¶"/><div class="post-qr-code__desc">æ”¯ä»˜å¯¶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/09/11/%E3%80%90%E9%87%8D%E8%AF%86%E5%89%8D%E7%AB%AF%E3%80%91redux%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/"><img class="prev_cover lazyload" data-src="/image/cover/web.jpeg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">ã€é‡è¯†å‰ç«¯ã€‘reduxæºç é˜…è¯»</div></div></a></div><div class="next-post pull_right"><a href="/2020/08/25/%E3%80%90%E9%87%8D%E8%AF%86%E5%89%8D%E7%AB%AF%E3%80%91%E6%B7%B1%E5%85%A5%E5%86%85%E5%AD%98%E4%B8%96%E7%95%8C/"><img class="next_cover lazyload" data-src="/image/cover/web.jpeg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> ç›¸å…³æ¨è</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2019/06/19/window-history-back-ç¼“å­˜-è¿”å›ä¸Šçº§é¡µé¢ä¸åˆ·æ–°æ•°æ®/" title="window.history.back(); ç¼“å­˜ è¿”å›ä¸Šçº§é¡µé¢ä¸åˆ·æ–°æ•°æ®"><img class="relatedPosts_cover lazyload"data-src="/image/cover/history.jpeg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-06-19</div><div class="relatedPosts_title">window.history.back(); ç¼“å­˜ è¿”å›ä¸Šçº§é¡µé¢ä¸åˆ·æ–°æ•°æ®</div></div></a></div><div class="relatedPosts_item"><a href="/2020/08/10/ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šäº‹ä»¶å¾ªç¯/" title="ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šJavaScriptçš„æ‰§è¡Œæœºåˆ¶"><img class="relatedPosts_cover lazyload"data-src="/image/cover/web.jpeg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-08-10</div><div class="relatedPosts_title">ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šJavaScriptçš„æ‰§è¡Œæœºåˆ¶</div></div></a></div><div class="relatedPosts_item"><a href="/2020/07/16/ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this/" title="ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this"><img class="relatedPosts_cover lazyload"data-src="/image/cover/web.jpeg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-07-16</div><div class="relatedPosts_title">ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this</div></div></a></div><div class="relatedPosts_item"><a href="/2020/07/15/ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—/" title="ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—"><img class="relatedPosts_cover lazyload"data-src="/image/cover/web.jpeg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-07-15</div><div class="relatedPosts_title">ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—</div></div></a></div><div class="relatedPosts_item"><a href="/2020/07/13/ã€é‡è¯†å‰ç«¯ã€‘åŸå‹åŸå‹é“¾å’Œç»§æ‰¿/" title="ã€é‡è¯†å‰ç«¯ã€‘åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿"><img class="relatedPosts_cover lazyload"data-src="/image/cover/web.jpeg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-07-13</div><div class="relatedPosts_title">ã€é‡è¯†å‰ç«¯ã€‘åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿</div></div></a></div><div class="relatedPosts_item"><a href="/2020/08/25/ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ/" title="ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ"><img class="relatedPosts_cover lazyload"data-src="/image/cover/web.jpeg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-08-25</div><div class="relatedPosts_title">ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ</div></div></a></div></div><div class="clear_both"></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Derrick</div><div class="framework-info"><span>é©±åŠ¨ </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="é˜…è¯»æ¨¡å¼"></i><i class="fa fa-plus" id="font_plus" title="æ”¾å¤§å­—ä½“"></i><i class="fa fa-minus" id="font_minus" title="ç¼©å°å­—ä½“"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="ç®€ç¹è½¬æ¢" target="_self">ç¹</a><i class="darkmode fa fa-moon-o" id="darkmode" title="å¤œé—´æ¨¡å¼"></i></div><div id="rightside-config-show"><div id="rightside_config" title="è®¾ç½®"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="ç›®å½•" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="å›åˆ°é¡¶éƒ¨" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script></body></html>