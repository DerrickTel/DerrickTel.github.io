{"meta":{"version":1,"warehouse":"3.0.2"},"models":{"Asset":[{"_id":"source/image/AntDesignFormæ€»ç»“/modal.png","path":"image/AntDesignFormæ€»ç»“/modal.png","modified":1,"renderable":0},{"_id":"source/image/AntDesignProæ¢ç´¢/20190312150929439.png","path":"image/AntDesignProæ¢ç´¢/20190312150929439.png","modified":1,"renderable":0},{"_id":"source/image/AntDesignProæ¢ç´¢/20190312150742764.png","path":"image/AntDesignProæ¢ç´¢/20190312150742764.png","modified":1,"renderable":0},{"_id":"source/image/AntDesignProæ¢ç´¢/20190312151053807.png","path":"image/AntDesignProæ¢ç´¢/20190312151053807.png","modified":1,"renderable":0},{"_id":"source/image/AntDesignProæ¢ç´¢/2019031215140926.png","path":"image/AntDesignProæ¢ç´¢/2019031215140926.png","modified":1,"renderable":0},{"_id":"source/image/AntDesignProæ¢ç´¢/20190312151839845.png","path":"image/AntDesignProæ¢ç´¢/20190312151839845.png","modified":1,"renderable":0},{"_id":"source/image/AntDesignProæ¢ç´¢/20190312152011733.png","path":"image/AntDesignProæ¢ç´¢/20190312152011733.png","modified":1,"renderable":0},{"_id":"source/image/CSSModulesè­¦å‘Š/aHR0cDovL2kxLmZ1aW1nLmNvbS82OTE2NDMvZWIwYzBmODU2NDE0OGZjMC5wbmc.jpeg","path":"image/CSSModulesè­¦å‘Š/aHR0cDovL2kxLmZ1aW1nLmNvbS82OTE2NDMvZWIwYzBmODU2NDE0OGZjMC5wbmc.jpeg","modified":1,"renderable":0},{"_id":"source/image/CSSModulesè­¦å‘Š/aHR0cDovL2kxLmZ1aW1nLmNvbS82OTE2NDMvODU2M2ZjOGJhZTU1ODI3Yy5wbmc.jpeg","path":"image/CSSModulesè­¦å‘Š/aHR0cDovL2kxLmZ1aW1nLmNvbS82OTE2NDMvODU2M2ZjOGJhZTU1ODI3Yy5wbmc.jpeg","modified":1,"renderable":0},{"_id":"source/image/CSSModulesè­¦å‘Š/aHR0cDovL2kxLmZ1aW1nLmNvbS82OTE2NDMvYTkxMmI1YzhlNTk3YTYzYy5wbmc.jpeg","path":"image/CSSModulesè­¦å‘Š/aHR0cDovL2kxLmZ1aW1nLmNvbS82OTE2NDMvYTkxMmI1YzhlNTk3YTYzYy5wbmc.jpeg","modified":1,"renderable":0},{"_id":"source/image/Reactå…¥é—¨/20181123111537542.png","path":"image/Reactå…¥é—¨/20181123111537542.png","modified":1,"renderable":0},{"_id":"source/image/Reactå…¥é—¨/20181123143905811.png","path":"image/Reactå…¥é—¨/20181123143905811.png","modified":1,"renderable":0},{"_id":"source/image/SpringBootè·¨åŸŸ/20190311105909443.png","path":"image/SpringBootè·¨åŸŸ/20190311105909443.png","modified":1,"renderable":0},{"_id":"source/image/Reactå…¥é—¨/20181123134126335.png","path":"image/Reactå…¥é—¨/20181123134126335.png","modified":1,"renderable":0},{"_id":"source/image/SpringBootè·¨åŸŸ/20190311110735834.png","path":"image/SpringBootè·¨åŸŸ/20190311110735834.png","modified":1,"renderable":0},{"_id":"source/image/WebpackCleanWebpackPlugin/20190622155123842.png","path":"image/WebpackCleanWebpackPlugin/20190622155123842.png","modified":1,"renderable":0},{"_id":"source/image/cover/JWT.png","path":"image/cover/JWT.png","modified":1,"renderable":0},{"_id":"source/image/cover/ANTD.png","path":"image/cover/ANTD.png","modified":1,"renderable":0},{"_id":"source/image/cover/HEXO.png","path":"image/cover/HEXO.png","modified":1,"renderable":0},{"_id":"source/image/cover/KDpgvguMpGfqaHPjicRK.svg","path":"image/cover/KDpgvguMpGfqaHPjicRK.svg","modified":1,"renderable":0},{"_id":"source/image/cover/React.jpeg","path":"image/cover/React.jpeg","modified":1,"renderable":0},{"_id":"source/image/cover/antdP.png","path":"image/cover/antdP.png","modified":1,"renderable":0},{"_id":"source/image/cover/JavaScript.png","path":"image/cover/JavaScript.png","modified":1,"renderable":0},{"_id":"source/image/cover/css.png","path":"image/cover/css.png","modified":1,"renderable":0},{"_id":"source/image/cover/decorator.png","path":"image/cover/decorator.png","modified":1,"renderable":0},{"_id":"source/image/cover/http.png","path":"image/cover/http.png","modified":1,"renderable":0},{"_id":"source/image/cover/history.jpeg","path":"image/cover/history.jpeg","modified":1,"renderable":0},{"_id":"source/image/cover/github.jpg","path":"image/cover/github.jpg","modified":1,"renderable":0},{"_id":"source/image/cover/react.png","path":"image/cover/react.png","modified":1,"renderable":0},{"_id":"source/image/cover/webpack.png","path":"image/cover/webpack.png","modified":1,"renderable":0},{"_id":"source/image/cover/springboot.png","path":"image/cover/springboot.png","modified":1,"renderable":0},{"_id":"source/image/historyBackå‡½æ•°/20190318092239845.png","path":"image/historyBackå‡½æ•°/20190318092239845.png","modified":1,"renderable":0},{"_id":"source/image/cover/web.jpeg","path":"image/cover/web.jpeg","modified":1,"renderable":0},{"_id":"source/image/httpHttps/15fc2525666dc96e.jpg","path":"image/httpHttps/15fc2525666dc96e.jpg","modified":1,"renderable":0},{"_id":"source/image/pr/title.png","path":"image/pr/title.png","modified":1,"renderable":0},{"_id":"source/image/pr/pornhub.jpg","path":"image/pr/pornhub.jpg","modified":1,"renderable":0},{"_id":"source/image/react1/console.png","path":"image/react1/console.png","modified":1,"renderable":0},{"_id":"source/image/router/demo.gif","path":"image/router/demo.gif","modified":1,"renderable":0},{"_id":"source/image/åœ°å€æ /woshou.png","path":"image/åœ°å€æ /woshou.png","modified":1,"renderable":0},{"_id":"source/image/æ·±æ‹·è´æµ…æ‹·è´/20190428204522836.png","path":"image/æ·±æ‹·è´æµ…æ‹·è´/20190428204522836.png","modified":1,"renderable":0},{"_id":"source/image/æ·±å…¥å†…å­˜ä¸–ç•Œ/3.png","path":"image/æ·±å…¥å†…å­˜ä¸–ç•Œ/3.png","modified":1,"renderable":0},{"_id":"source/image/æ·±æ‹·è´æµ…æ‹·è´/20190428205243797.png","path":"image/æ·±æ‹·è´æµ…æ‹·è´/20190428205243797.png","modified":1,"renderable":0},{"_id":"source/image/æ·±æ‹·è´æµ…æ‹·è´/20190428204904611.png","path":"image/æ·±æ‹·è´æµ…æ‹·è´/20190428204904611.png","modified":1,"renderable":0},{"_id":"source/image/æ·±æ‹·è´æµ…æ‹·è´/20190428205853748.png","path":"image/æ·±æ‹·è´æµ…æ‹·è´/20190428205853748.png","modified":1,"renderable":0},{"_id":"source/image/æ·±æ‹·è´æµ…æ‹·è´/20190428205350562.png","path":"image/æ·±æ‹·è´æµ…æ‹·è´/20190428205350562.png","modified":1,"renderable":0},{"_id":"themes/Butterfly/source/css/index.styl","path":"css/index.styl","modified":1,"renderable":1},{"_id":"themes/Butterfly/source/css/var.styl","path":"css/var.styl","modified":1,"renderable":1},{"_id":"themes/Butterfly/source/img/404.jpg","path":"img/404.jpg","modified":1,"renderable":1},{"_id":"themes/Butterfly/source/img/DerrickAlipay.jpg","path":"img/DerrickAlipay.jpg","modified":1,"renderable":1},{"_id":"themes/Butterfly/source/img/avatar.png","path":"img/avatar.png","modified":1,"renderable":1},{"_id":"themes/Butterfly/source/img/algolia.svg","path":"img/algolia.svg","modified":1,"renderable":1},{"_id":"themes/Butterfly/source/img/favicon.ico","path":"img/favicon.ico","modified":1,"renderable":1},{"_id":"themes/Butterfly/source/img/DerrickWechat.png","path":"img/DerrickWechat.png","modified":1,"renderable":1},{"_id":"themes/Butterfly/source/img/comment_bg.png","path":"img/comment_bg.png","modified":1,"renderable":1},{"_id":"themes/Butterfly/source/img/icp.png","path":"img/icp.png","modified":1,"renderable":1},{"_id":"themes/Butterfly/source/img/friend_404.gif","path":"img/friend_404.gif","modified":1,"renderable":1},{"_id":"themes/Butterfly/source/img/post.jpg","path":"img/post.jpg","modified":1,"renderable":1},{"_id":"themes/Butterfly/source/img/loading.gif","path":"img/loading.gif","modified":1,"renderable":1},{"_id":"themes/Butterfly/source/js/main.js","path":"js/main.js","modified":1,"renderable":1},{"_id":"themes/Butterfly/source/img/post_loadding.svg","path":"img/post_loadding.svg","modified":1,"renderable":1},{"_id":"themes/Butterfly/source/js/tw_cn.js","path":"js/tw_cn.js","modified":1,"renderable":1},{"_id":"themes/Butterfly/source/js/utils.js","path":"js/utils.js","modified":1,"renderable":1},{"_id":"source/image/AntDesignProæ¢ç´¢/2019031215120430.png","path":"image/AntDesignProæ¢ç´¢/2019031215120430.png","modified":1,"renderable":0},{"_id":"source/image/CSSModulesè­¦å‘Š/aHR0cDovL2kyLnRpaW1nLmNvbS82OTE2NDMvMmVmODNhMzcxNjA4OWEwZS5wbmc.jpeg","path":"image/CSSModulesè­¦å‘Š/aHR0cDovL2kyLnRpaW1nLmNvbS82OTE2NDMvMmVmODNhMzcxNjA4OWEwZS5wbmc.jpeg","modified":1,"renderable":0},{"_id":"source/image/SpringBootJWT/20190325103836546.png","path":"image/SpringBootJWT/20190325103836546.png","modified":1,"renderable":0},{"_id":"source/image/SpringBootè·¨åŸŸ/20190311110721789.png","path":"image/SpringBootè·¨åŸŸ/20190311110721789.png","modified":1,"renderable":0},{"_id":"source/image/react1/stats.png","path":"image/react1/stats.png","modified":1,"renderable":0},{"_id":"source/image/åœ°å€æ /dns.png","path":"image/åœ°å€æ /dns.png","modified":1,"renderable":0},{"_id":"source/image/åœ°å€æ /huishou.png","path":"image/åœ°å€æ /huishou.png","modified":1,"renderable":0},{"_id":"themes/Butterfly/source/img/1avatar.png","path":"img/1avatar.png","modified":1,"renderable":1},{"_id":"source/image/CSSModulesè­¦å‘Š/aHR0cDovL2kxLmZ1aW1nLmNvbS82OTE2NDMvMGM4ZDhiNjZlMGNmZTY0Ny5wbmc.jpeg","path":"image/CSSModulesè­¦å‘Š/aHR0cDovL2kxLmZ1aW1nLmNvbS82OTE2NDMvMGM4ZDhiNjZlMGNmZTY0Ny5wbmc.jpeg","modified":1,"renderable":0},{"_id":"source/image/react1/offer.png","path":"image/react1/offer.png","modified":1,"renderable":0},{"_id":"source/image/ä½ çœŸçš„æ‡‚ReactHookå—/2019081821194714.png","path":"image/ä½ çœŸçš„æ‡‚ReactHookå—/2019081821194714.png","modified":1,"renderable":0},{"_id":"themes/Butterfly/source/js/search/local-search.js","path":"js/search/local-search.js","modified":1,"renderable":1},{"_id":"themes/Butterfly/source/js/third-party/activate-power-mode.js","path":"js/third-party/activate-power-mode.js","modified":1,"renderable":1},{"_id":"themes/Butterfly/source/js/search/algolia.js","path":"js/search/algolia.js","modified":1,"renderable":1},{"_id":"themes/Butterfly/source/js/third-party/ClickShowText.js","path":"js/third-party/ClickShowText.js","modified":1,"renderable":1},{"_id":"themes/Butterfly/source/js/third-party/fireworks.js","path":"js/third-party/fireworks.js","modified":1,"renderable":1},{"_id":"themes/Butterfly/source/js/third-party/canvas-nest.js","path":"js/third-party/canvas-nest.js","modified":1,"renderable":1},{"_id":"themes/Butterfly/source/js/third-party/piao.js","path":"js/third-party/piao.js","modified":1,"renderable":1},{"_id":"themes/Butterfly/source/js/third-party/canvas-ribbon.js","path":"js/third-party/canvas-ribbon.js","modified":1,"renderable":1},{"_id":"source/image/BFC/1.png","path":"image/BFC/1.png","modified":1,"renderable":0},{"_id":"themes/Butterfly/source/js/third-party/click_heart.js","path":"js/third-party/click_heart.js","modified":1,"renderable":1},{"_id":"source/image/pr/commit.png","path":"image/pr/commit.png","modified":1,"renderable":0},{"_id":"source/image/react1/bebel.png","path":"image/react1/bebel.png","modified":1,"renderable":0},{"_id":"source/image/react1/download.jpg","path":"image/react1/download.jpg","modified":1,"renderable":0},{"_id":"source/image/ä½ çœŸçš„æ‡‚ReactHookå—/20190818212347571.png","path":"image/ä½ çœŸçš„æ‡‚ReactHookå—/20190818212347571.png","modified":1,"renderable":0},{"_id":"themes/Butterfly/source/img/index.jpg","path":"img/index.jpg","modified":1,"renderable":1},{"_id":"source/image/BFC/2.png","path":"image/BFC/2.png","modified":1,"renderable":0},{"_id":"source/image/WebpackCleanWebpackPlugin/20190622155255789.png","path":"image/WebpackCleanWebpackPlugin/20190622155255789.png","modified":1,"renderable":0},{"_id":"source/image/cover/bg.jpg","path":"image/cover/bg.jpg","modified":1,"renderable":0},{"_id":"source/image/pr/pr.png","path":"image/pr/pr.png","modified":1,"renderable":0},{"_id":"source/image/react1/element.png","path":"image/react1/element.png","modified":1,"renderable":0},{"_id":"source/image/reactDebugger/console.png","path":"image/reactDebugger/console.png","modified":1,"renderable":0},{"_id":"source/image/æ·±å…¥å†…å­˜ä¸–ç•Œ/2.png","path":"image/æ·±å…¥å†…å­˜ä¸–ç•Œ/2.png","modified":1,"renderable":0},{"_id":"source/image/pr/create.png","path":"image/pr/create.png","modified":1,"renderable":0},{"_id":"source/image/pr/push.png","path":"image/pr/push.png","modified":1,"renderable":0},{"_id":"source/image/AntDesignProæ¢ç´¢/2019031215175956.png","path":"image/AntDesignProæ¢ç´¢/2019031215175956.png","modified":1,"renderable":0},{"_id":"source/image/Webå‰ç«¯å­¦ä¹ è·¯çº¿/20190328205449472.png","path":"image/Webå‰ç«¯å­¦ä¹ è·¯çº¿/20190328205449472.png","modified":1,"renderable":0},{"_id":"source/image/æ·±å…¥å†…å­˜ä¸–ç•Œ/1.jpeg","path":"image/æ·±å…¥å†…å­˜ä¸–ç•Œ/1.jpeg","modified":1,"renderable":0}],"Cache":[{"_id":"themes/Butterfly/_config.yml","hash":"973b5c3d12c834b2dafed42f43f946ccefeac616","modified":1624543206992},{"_id":"themes/Butterfly/package.json","hash":"65bcf567dea408eb6969a02be629e2a27ee595d8","modified":1624543207006},{"_id":"source/_posts/5åˆ†é’Ÿå¿«é€Ÿç²¾é€šAnt-Design-Form-1åˆ†é’Ÿå¿«é€Ÿæ„å»ºå¤æ‚Ant-Design-Formè¡¨å•.md","hash":"91deac5787b52428e5d0fdc089b4fb37330f1f0c","modified":1624543206846},{"_id":"source/_posts/HTTPHTTPSåè®®.md","hash":"08fde324fc97689baa9f33e9dfa1c6000e3eed0b","modified":1624543206846},{"_id":"source/_posts/Hexo+GitHubæ„å»ºä½ çš„åšå®¢.md","hash":"3dd2f41843adfc5faaefb02debbd2dcb3d26cc06","modified":1624543206846},{"_id":"source/_posts/JWT-spring-boot-JAVA-ä½¿ç”¨æ­¥éª¤-spring-boot2-0.md","hash":"1f973e5ec964f230c749ffa5eae147ff4153b141","modified":1624543206846},{"_id":"source/_posts/React-Stateè¯¦è§£.md","hash":"ce1479b01f34645271ee96028b09880ec13e0aaa","modified":1624543206847},{"_id":"source/_posts/React-Hook-å€’è®¡æ—¶.md","hash":"e5f8fa722df5eb954673adb677b87f866a95b36b","modified":1624543206847},{"_id":"source/_posts/JavaScript-æµ…æ‹·è´-æ·±æ‹·è´-èµ‹å€¼-å¼•ç”¨-JS.md","hash":"c67207f101fab56091b779280bc4a6f327c22028","modified":1624543206847},{"_id":"source/_posts/Webpack-CleanWebpackPlugin-is-not-a-constructor.md","hash":"82aeac58b3b4e60c57292e560d62b9ccea4d730f","modified":1624543206847},{"_id":"source/_posts/Webå‰ç«¯-å­¦ä¹ ç›®å½•-å­¦ä¹ æ¡†æ¶-ç³»ç»Ÿæ€§çš„å­¦ä¹ Webå‰ç«¯.md","hash":"b651177fb9f06900a656928cde3077c78f1d6f28","modified":1624543206848},{"_id":"source/_posts/ant-design-Form-ç»„ä»¶æ€»ç»“-ç»“åˆModal-è‡ªå®šä¹‰Modalçš„å®ç°-ï¼ˆUpload-Input-Select-DatePicker-Cascaderï¼‰.md","hash":"ea5e4aace155c758dc3c49263897567c12426c97","modified":1624543206848},{"_id":"source/_posts/chunk-0-mini-css-extract-plugin-è§£å†³-CSS-Modules-è­¦å‘Š.md","hash":"f24800bf6aee56b774ea2a705daf1b95101f1895","modified":1624543206848},{"_id":"source/_posts/ant-design-pro-2-0-æ–°é¡µé¢æ¢ç´¢-umi-é¡µé¢404-react.md","hash":"592163a84bbb6abd70321ec740b07c1ff8754690","modified":1624543206848},{"_id":"source/_posts/sessionå’Œcookieçš„ç†è§£.md","hash":"6aed9a0b5941d486322bdc7f7933b7c307f86086","modified":1624543206849},{"_id":"source/_posts/sprng-boot-è·¨åŸŸ-è¿‡æ»¤å™¨-fetch-react-Response-to-preflight-request-doesn-t-pass-access-control-check.md","hash":"66eca3e07adf7e0a981fd9f9e4f33b1224cd399c","modified":1624543206849},{"_id":"source/_posts/ã€Œå¦‚ä½•ç»™githubæä¸€ä¸ªPRã€.md","hash":"3c41c6f9e2ff2237b76ce1e69ce7abcb34ad74f9","modified":1624543206849},{"_id":"source/_posts/window-history-back-ç¼“å­˜-è¿”å›ä¸Šçº§é¡µé¢ä¸åˆ·æ–°æ•°æ®.md","hash":"72096bf30df0c6e0afc1bc52d6c25b9d71e11938","modified":1624543206849},{"_id":"source/_posts/ã€é‡è¯†å‰ç«¯ã€‘Reactæºç é˜…è¯»ï¼ˆä¸€ï¼‰jsx.md","hash":"a524adec19dcf8e4fe6abfeffd717c08f0ef45ab","modified":1624779141936},{"_id":"source/_posts/ã€é‡è¯†å‰ç«¯ã€‘React-Routeræºç é˜…è¯».md","hash":"96dc9cbfb11dd4ccf2e12960542a2619789833bb","modified":1624779194178},{"_id":"source/_posts/ã€é‡è¯†å‰ç«¯ã€‘Reactæºç é˜…è¯»ï¼ˆäºŒï¼‰2000å­—å‘Šè¯‰ä½ Fiberè®¾è®¡åŠ¨æœº.md","hash":"0ff0f7dddd47a7f7f659d5f4b874fb7d1c950cca","modified":1624543206850},{"_id":"source/_posts/ã€é‡è¯†å‰ç«¯ã€‘Reactæºç é˜…è¯»ï¼ˆä¸‰ï¼‰Fiber åˆå§‹åŒ–.md","hash":"e47569aa18e837f2d7c2dc85b2fe7a6462faa9d0","modified":1624543206850},{"_id":"source/_posts/ã€é‡è¯†å‰ç«¯ã€‘Reactæºç é˜…è¯»ï¼ˆå››ï¼‰.md","hash":"581820f745a8aba4d4621e15e4c8a84d587bec36","modified":1624543206851},{"_id":"source/_posts/ã€é‡è¯†å‰ç«¯ã€‘reduxæºç é˜…è¯».md","hash":"cd507291004834cb9655c964de7a6dd5210a802f","modified":1624543206851},{"_id":"source/_posts/ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šäº‹ä»¶å¾ªç¯.md","hash":"4044bfc1c930fb5b77c865a43776ceb9da3754e9","modified":1624543206851},{"_id":"source/_posts/ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this.md","hash":"b177e172617c042b7b216ab5141d100268c02fc8","modified":1624543206852},{"_id":"source/_posts/ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC.md","hash":"d6e52bcca302ebac90408d92d41687ba09336e1b","modified":1624543206851},{"_id":"source/_posts/ã€é‡è¯†å‰ç«¯ã€‘åŸå‹åŸå‹é“¾å’Œç»§æ‰¿.md","hash":"5c4349cad27489cb3762a43f782282dbb968cc8c","modified":1624543206852},{"_id":"source/_posts/ã€é‡è¯†å‰ç«¯ã€‘åœ°å€æ ä¸­è¾“å…¥ç½‘å€å.md","hash":"c56762a207f0c559b3be2b0b603e9c30902eb5c7","modified":1624543206852},{"_id":"source/_posts/ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ.md","hash":"4622907255a88e7354474abe3709daf0f7b14796","modified":1624543206853},{"_id":"source/_posts/ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—.md","hash":"1e7c74db46f4def8536e3bcca413baacf30a1031","modified":1624543206853},{"_id":"source/_posts/ã€é¢ç»ã€‘2å¹´å‰ç«¯æ­å·é¢è¯•é›†åˆ.md","hash":"628ecf46e82d30b0ed1e8bb47e3a454c03aee686","modified":1624543206854},{"_id":"source/_posts/ã€é‡è¯†å‰ç«¯ã€‘æš´èµ°çš„å¼‚æ­¥ç¼–ç¨‹.md","hash":"b6b4cb256c8274b438f2724f59b89266aea7d5b8","modified":1624543206853},{"_id":"source/_posts/ä½ çœŸçš„æ‡‚React-Hookå—.md","hash":"ee436c5f20af784a00889dab69b74237e6ef9cb6","modified":1624543206855},{"_id":"source/_posts/å…¨ç½‘æœ€å…¨Reactæºç è°ƒè¯•æ•™ç¨‹.md","hash":"c056d321a8795b140a1d1d8b539f4f61255bb8b0","modified":1624543206855},{"_id":"source/_posts/ä»é›¶é…ç½®ä½ çš„Webpack.md","hash":"33b05e1c9d9f533e181ff6fb679ebc680b5a4a7a","modified":1624543206854},{"_id":"source/_posts/å‰ç«¯è¿›é˜¶-é…ç½®ä½ è‡ªå·±çš„è„šæ‰‹æ¶.md","hash":"9a305ee244406bed8773cae6670bec9382684ec9","modified":1624543206855},{"_id":"source/_posts/è£…é¥°å™¨(Decorator)å’ŒReacté«˜é˜¶ç»„ä»¶(HOC).md","hash":"47ef35dc535eb6305f4d2ebdeeb673b4e05fab53","modified":1624543206855},{"_id":"source/_posts/é¢è¯•å®˜ï¼šå¬è¯´ä½ å¯¹package-jsonå¾ˆç†Ÿï¼Ÿ.md","hash":"26d751f569cc73211fcc97bc5d651bb4082ef34d","modified":1624543206855},{"_id":"source/about/index.md","hash":"d5c881255a4c077e4237da19209318bb28278fa9","modified":1624543206855},{"_id":"source/clean/index.md","hash":"59ec9db1320839dccfa150b794ea8d672c8d8efd","modified":1624543206855},{"_id":"themes/Butterfly/.github/stale.yml","hash":"70467ce772e68de57a4bf2ac285f1c0b122f25f5","modified":1624543206992},{"_id":"themes/Butterfly/.github/ISSUE_TEMPLATE.md","hash":"9a4f2daa73108fbd48a6af565d53230eef163bee","modified":1624543206992},{"_id":"themes/Butterfly/LICENSE","hash":"e7e7b7677bb19563a9013e936486bdefeb761d07","modified":1624543206992},{"_id":"themes/Butterfly/README_CN.md","hash":"c8c348065dc2113d52f2930f0b13b438e31c1172","modified":1624543206992},{"_id":"themes/Butterfly/README.md","hash":"8ce70d7d0facbb4cbe08dc59b03d3dfc5861fe4a","modified":1624543206992},{"_id":"themes/Butterfly/languages/default.yml","hash":"c6156fed37fa10c5704bf3780cd58c9ce1dc58dd","modified":1624543206993},{"_id":"themes/Butterfly/languages/zh-TW.yml","hash":"5890f7257a5165e19851a7ee805ef0c98bc69f12","modified":1624543206993},{"_id":"themes/Butterfly/languages/en.yml","hash":"c6156fed37fa10c5704bf3780cd58c9ce1dc58dd","modified":1624543206993},{"_id":"themes/Butterfly/languages/zh-CN.yml","hash":"0f029273acc3d945d1e784e142b61089ca318b06","modified":1624543206993},{"_id":"themes/Butterfly/layout/archive.pug","hash":"2d5bf4b1755f89898c579c18d601be83d2bc8ebd","modified":1624543206993},{"_id":"themes/Butterfly/layout/category.pug","hash":"e42b321de7b2ebdb3a499395d1559bb927eba7b4","modified":1624543206993},{"_id":"themes/Butterfly/layout/404.pug","hash":"a6413aa10bafd4492d912245f632321bd60b0b8d","modified":1624543206993},{"_id":"themes/Butterfly/layout/flink.pug","hash":"490c23ea939eab6a0bdc4d436219cc03799f208c","modified":1624543206993},{"_id":"themes/Butterfly/layout/tag.pug","hash":"6e18889daf0f6288fbacb5f589bdfb5e05c9c8f8","modified":1624543207006},{"_id":"themes/Butterfly/layout/post.pug","hash":"78b408d1557f79e0829af0df0e5bd66a35608309","modified":1624543207006},{"_id":"themes/Butterfly/layout/page.pug","hash":"70511837da68cb733395ff071b8be429737c559d","modified":1624543207006},{"_id":"themes/Butterfly/layout/page-tags.pug","hash":"f07502030375047b48e7e1db26be8f10b15a6562","modified":1624543207006},{"_id":"themes/Butterfly/layout/index.pug","hash":"131879062ce9afd20743f60dc9bf34d2e2e781aa","modified":1624543207006},{"_id":"source/image/AntDesignFormæ€»ç»“/modal.png","hash":"e2e06c1d4221e0d58ddf05bf54d3baf18770b7a8","modified":1624543206856},{"_id":"source/image/AntDesignProæ¢ç´¢/20190312150929439.png","hash":"95ea643ebfccad9d3dd13d32f2b3125d1dfc083d","modified":1624543206857},{"_id":"source/image/AntDesignProæ¢ç´¢/20190312150742764.png","hash":"7195c4a5006d0eae1be5a292557b450f65c6c911","modified":1624543206856},{"_id":"source/image/AntDesignProæ¢ç´¢/20190312151053807.png","hash":"71de09ee4a2571fe6f15bfb0ab72f57fecdff0ed","modified":1624543206857},{"_id":"source/image/AntDesignProæ¢ç´¢/2019031215140926.png","hash":"aea2d3b14caffc9a8705c54fb054970b2ab76cee","modified":1624543206858},{"_id":"source/image/AntDesignProæ¢ç´¢/20190312151839845.png","hash":"2fdadb1ef8077f5479c3b7f54e7fde29e7115686","modified":1624543206872},{"_id":"source/image/AntDesignProæ¢ç´¢/20190312152011733.png","hash":"5ebfaa1f282713b2fad33b230bbcd661cac4059f","modified":1624543206873},{"_id":"source/image/CSSModulesè­¦å‘Š/aHR0cDovL2kxLmZ1aW1nLmNvbS82OTE2NDMvZWIwYzBmODU2NDE0OGZjMC5wbmc.jpeg","hash":"6b84d92b26daaa7d70b6f275456a65495819e23b","modified":1624543206879},{"_id":"source/image/CSSModulesè­¦å‘Š/aHR0cDovL2kxLmZ1aW1nLmNvbS82OTE2NDMvODU2M2ZjOGJhZTU1ODI3Yy5wbmc.jpeg","hash":"5adc2f974658dcdcb1d2c5cf4d4946e551c5021e","modified":1624543206878},{"_id":"source/image/CSSModulesè­¦å‘Š/aHR0cDovL2kxLmZ1aW1nLmNvbS82OTE2NDMvYTkxMmI1YzhlNTk3YTYzYy5wbmc.jpeg","hash":"124651411d1258ae1ca253eea3eecad3a47a3997","modified":1624543206879},{"_id":"source/image/Reactå…¥é—¨/20181123111537542.png","hash":"c35997a4f68255b834c654fa46a03879c79a9e8a","modified":1624543206881},{"_id":"source/image/Reactå…¥é—¨/20181123143905811.png","hash":"bfd5e05a8109dc65f49e30e7e043e8220ffacd53","modified":1624543206881},{"_id":"source/image/SpringBootè·¨åŸŸ/20190311105909443.png","hash":"597ceaa3d51037162b08d1e5ce90e17d61a003e8","modified":1624543206883},{"_id":"source/image/Reactå…¥é—¨/20181123134126335.png","hash":"9c0a1f31428bcfd09f5540989ec0ceec23e52020","modified":1624543206881},{"_id":"source/image/SpringBootè·¨åŸŸ/20190311110735834.png","hash":"1be7071509aad1e8b57968699800f771b96e5865","modified":1624543206883},{"_id":"source/image/WebpackCleanWebpackPlugin/20190622155123842.png","hash":"51a6b66753f63d1160b83ce9c819dc5931ef474f","modified":1624543206884},{"_id":"source/image/cover/JWT.png","hash":"54e734ffae7e5a15498be8006003dac36d104c5b","modified":1624543206912},{"_id":"source/image/cover/ANTD.png","hash":"898d9e3bc115706f2df19d89d34c786b20bea4e8","modified":1624543206911},{"_id":"source/image/cover/HEXO.png","hash":"c2c59b2d8b9c2f91be92d0b01bce3acd68921065","modified":1624543206911},{"_id":"source/image/cover/KDpgvguMpGfqaHPjicRK.svg","hash":"6ecaeecec62d077e011e8c69a633fddb366b4d19","modified":1624543206912},{"_id":"source/image/cover/React.jpeg","hash":"dc18c45077ecfaffaffd735900e9bb58d6cfd03f","modified":1624543206912},{"_id":"source/image/cover/antdP.png","hash":"e51856b14c5ba11da682c462541a1ae9f179f1fb","modified":1624543206913},{"_id":"source/image/cover/JavaScript.png","hash":"d051bd5987e275b1ebb32ddc841322d87f5f146a","modified":1624543206912},{"_id":"source/image/cover/css.png","hash":"052b66320dfb67fe6758555be7bfba9d96ab01fc","modified":1624543206917},{"_id":"source/image/cover/decorator.png","hash":"8a8cf27d287b3b02adc4a95db40430a1a6269613","modified":1624543206918},{"_id":"source/image/cover/http.png","hash":"c42bfcc7b07d40e89cafd721baed7c4b275fa551","modified":1624543206918},{"_id":"source/image/cover/history.jpeg","hash":"9d3cbcea80f59224e85021ecd695d355dfddb525","modified":1624543206918},{"_id":"source/image/cover/github.jpg","hash":"82d9e06e9bc1c7416f1408772210a8def27801b2","modified":1624543206918},{"_id":"source/image/cover/react.png","hash":"56effb8587fa0d3f273044aef82cf7889613f68c","modified":1624543206918},{"_id":"source/image/cover/webpack.png","hash":"7886cc0dfb91faf4b35652b67919d59ade7b74ae","modified":1624543206919},{"_id":"source/image/cover/springboot.png","hash":"dc2c4b7dc46f2dfaec66c6d6c596caebbf86c83f","modified":1624543206918},{"_id":"source/image/historyBackå‡½æ•°/20190318092239845.png","hash":"50b0bad4ccea97e01be0b4a5b9bc900ce703ae10","modified":1624543206920},{"_id":"source/image/cover/web.jpeg","hash":"d2bcd938948a48679ddb81531b38bec32c3c0f1c","modified":1624543206919},{"_id":"source/image/httpHttps/15fc2525666dc96e.jpg","hash":"57028340f40d6959e5cdf702c5c2d74c90a42f33","modified":1624543206921},{"_id":"source/image/pr/title.png","hash":"b4c16571881858b9ba5b68663a36c1ed2535724d","modified":1624543206931},{"_id":"source/image/pr/pornhub.jpg","hash":"d6f09aaba7c0dcff4f1d230e6480042fc4686faa","modified":1624543206924},{"_id":"source/image/react1/console.png","hash":"b4b1d198c39c92bbc056ffc7c8e65a858de96532","modified":1624543206934},{"_id":"source/image/router/demo.gif","hash":"188070a202ae35488a1ec158718e23eaf10d1ab2","modified":1624543206942},{"_id":"source/image/åœ°å€æ /woshou.png","hash":"4e19a237cd2864a1b7a37bb3751742c2d364e1e6","modified":1624543206948},{"_id":"source/image/æ·±æ‹·è´æµ…æ‹·è´/20190428204522836.png","hash":"33e1d52e178309724c364a23e2600fd8dadd5c54","modified":1624543206977},{"_id":"source/image/æ·±å…¥å†…å­˜ä¸–ç•Œ/3.png","hash":"d27f3b1a0540385b5ee02e699e18819dbb025aea","modified":1624543206977},{"_id":"source/image/æ·±æ‹·è´æµ…æ‹·è´/20190428205243797.png","hash":"6a69ed4fdcab7d20174a95b0a8006d419440c049","modified":1624543206978},{"_id":"source/image/æ·±æ‹·è´æµ…æ‹·è´/20190428204904611.png","hash":"7caef4b8f9872e6d80d21f807c93ba6a4c9ceb21","modified":1624543206978},{"_id":"themes/Butterfly/layout/includes/additional-js.pug","hash":"dac1c58da936086264361dc487602bacbd50dbba","modified":1624543206994},{"_id":"themes/Butterfly/layout/includes/head.pug","hash":"5a979181e297962cc8eadecd6e0c3c255cc604c7","modified":1624543206996},{"_id":"source/image/æ·±æ‹·è´æµ…æ‹·è´/20190428205853748.png","hash":"f31ac1cc377d72e17d69a227b66567d207538e86","modified":1624543206978},{"_id":"source/image/æ·±æ‹·è´æµ…æ‹·è´/20190428205350562.png","hash":"1a81ad3e621d51556a56bee13d2d5885c77f1475","modified":1624543206978},{"_id":"themes/Butterfly/layout/includes/footer.pug","hash":"9d98c38f1634987ef22a3cdb391b1f9fa2f806d2","modified":1624543206995},{"_id":"themes/Butterfly/layout/includes/layout.pug","hash":"4655e8d32f9d1e58cbf53592dd51ca75eef5d2af","modified":1624543206999},{"_id":"themes/Butterfly/scripts/events/404.js","hash":"25ea63d6fc384a9a3248b8d7960baec813e25829","modified":1624543207007},{"_id":"themes/Butterfly/scripts/events/replace-config.js","hash":"5eee75eaa56f81344b5a6b8aa4bdf38dfcb70370","modified":1624543207007},{"_id":"themes/Butterfly/scripts/filters/hide-post.js","hash":"ad211cab96bf3f7abd4fe2a0abf87dbdccbf57f4","modified":1624543207007},{"_id":"themes/Butterfly/scripts/filters/post-lazyload.js","hash":"e3c8300250d8b6b0754656dd2d366d6e4afc5508","modified":1624543207007},{"_id":"themes/Butterfly/scripts/helpers/list-archives.js","hash":"e1d17ec106b0eca5077449592cc79baf00f37a59","modified":1624543207007},{"_id":"themes/Butterfly/scripts/helpers/related-post.js","hash":"658d5a6434d570cd03f30e2a99ba8c78c98c1f40","modified":1624543207008},{"_id":"themes/Butterfly/scripts/filters/random-cover.js","hash":"f42b6fc333e74198dcad1f4ed76260744cf8c3cc","modified":1624543207007},{"_id":"themes/Butterfly/scripts/tags/gallery.js","hash":"1fff288f686859458226ba1fb3789b8575ea7ddb","modified":1624543207008},{"_id":"themes/Butterfly/scripts/tags/note.js","hash":"d3e50e577e805f890ba823f367d33b2f21954b4a","modified":1624543207008},{"_id":"themes/Butterfly/scripts/tags/hide.js","hash":"87dd8af711545ac79ef386f1aa6dcc8e4516ebc1","modified":1624543207008},{"_id":"themes/Butterfly/scripts/tags/mermaid.js","hash":"0257868bd269a577f0d139a2ecfac2605750820f","modified":1624543207008},{"_id":"themes/Butterfly/source/css/index.styl","hash":"8bc1990ba957831fe9dc1041b5af589248eb96d8","modified":1624543207016},{"_id":"themes/Butterfly/layout/includes/pagination.pug","hash":"22a7daf3ef6c7ba0edbda7bd7dffd21cabd95471","modified":1624543207001},{"_id":"themes/Butterfly/layout/includes/sidebar.pug","hash":"3981532dfffb57d00e3ebf5f590a2094d426898a","modified":1624543207003},{"_id":"themes/Butterfly/source/css/var.styl","hash":"f43a4bad4478e1f7686bbdb76fee9528a5edd134","modified":1624543207016},{"_id":"themes/Butterfly/layout/includes/recent-posts.pug","hash":"17708d099c8f90c220e9ab913f90f2f079479351","modified":1624543207001},{"_id":"themes/Butterfly/layout/includes/rightside.pug","hash":"418349c6a31f246d91aab53640ded1ae674463aa","modified":1624543207002},{"_id":"themes/Butterfly/source/img/404.jpg","hash":"fb4489bc1d30c93d28f7332158c1c6c1416148de","modified":1624543207018},{"_id":"themes/Butterfly/source/img/DerrickAlipay.jpg","hash":"97d102cc0d00683d45b78ba3cb141d75d77b3613","modified":1624543207018},{"_id":"themes/Butterfly/source/img/avatar.png","hash":"92434097d199cec038f7aa9a25e32054b0d49f21","modified":1624543207019},{"_id":"themes/Butterfly/source/img/algolia.svg","hash":"45eeea0b5fba833e21e38ea10ed5ab385ceb4f01","modified":1624543207018},{"_id":"themes/Butterfly/source/img/favicon.ico","hash":"47877628a0f0e0f06430845b0e3a75e0ba1361ce","modified":1624543207020},{"_id":"themes/Butterfly/source/img/DerrickWechat.png","hash":"a3d80cbd61d52c93fe2dbdfd4240d96648e5c114","modified":1624543207018},{"_id":"themes/Butterfly/source/img/comment_bg.png","hash":"1adfc4ee925fb4f922c24d7774e7c46d940fe31b","modified":1624543207020},{"_id":"themes/Butterfly/source/img/icp.png","hash":"cb1fd69b38ec23ce8366668ddffbbd0160de0104","modified":1624543207021},{"_id":"themes/Butterfly/source/img/friend_404.gif","hash":"8d2d0ebef70a8eb07329f57e645889b0e420fa48","modified":1624543207021},{"_id":"themes/Butterfly/source/img/post.jpg","hash":"554584218db9279874e48559f9a8e86b9ecca94b","modified":1624543207024},{"_id":"themes/Butterfly/source/img/loading.gif","hash":"5f0287fb8fb98872fe1998c6f781111819e71806","modified":1624543207024},{"_id":"themes/Butterfly/source/js/main.js","hash":"a7a5ad472b33ae14fb86a8a4878a67f853ccc2c5","modified":1624543207025},{"_id":"themes/Butterfly/source/img/post_loadding.svg","hash":"549c58cd09dbeefd573ce10646c49ded8bcc48ec","modified":1624543207024},{"_id":"themes/Butterfly/source/js/tw_cn.js","hash":"0a48ec7f2b01f2ea3f86a12af63a7399cbfaccd6","modified":1624543207027},{"_id":"themes/Butterfly/source/js/utils.js","hash":"24ab72ca8a3010b4a75c80bbbae614b4e8e309c7","modified":1624543207028},{"_id":"source/image/AntDesignProæ¢ç´¢/2019031215120430.png","hash":"88420cbdf879904742f5a838e0693f8ae19d566c","modified":1624543206858},{"_id":"source/image/CSSModulesè­¦å‘Š/aHR0cDovL2kyLnRpaW1nLmNvbS82OTE2NDMvMmVmODNhMzcxNjA4OWEwZS5wbmc.jpeg","hash":"89a001fc84f439c824224e0ae3696bd587d2186b","modified":1624543206880},{"_id":"source/image/SpringBootJWT/20190325103836546.png","hash":"66340b232074dc97c15b299a763926432aa90d74","modified":1624543206882},{"_id":"source/image/SpringBootè·¨åŸŸ/20190311110721789.png","hash":"fe87a2484bf20c0568bfda200d8b776ad0bedd74","modified":1624543206883},{"_id":"source/image/react1/stats.png","hash":"c7898a05b1e9b30456e1c3da2cb7c504235bcdb4","modified":1624543206939},{"_id":"source/image/åœ°å€æ /dns.png","hash":"254378373e7133d0a2248ef6014577698a9371b4","modified":1624543206946},{"_id":"source/image/åœ°å€æ /huishou.png","hash":"0a69a39b7d487a686dc92fbbbdb7b85002aee47b","modified":1624543206947},{"_id":"themes/Butterfly/source/img/1avatar.png","hash":"77f00530b5f24207d00f3e92f9821cc1d4eb3d40","modified":1624543207017},{"_id":"source/image/CSSModulesè­¦å‘Š/aHR0cDovL2kxLmZ1aW1nLmNvbS82OTE2NDMvMGM4ZDhiNjZlMGNmZTY0Ny5wbmc.jpeg","hash":"42a16835031c841f79dd4bcac8101cc079c06310","modified":1624543206878},{"_id":"source/image/react1/offer.png","hash":"3b73122f741118500b02119976e167701fe4e394","modified":1624543206938},{"_id":"source/image/ä½ çœŸçš„æ‡‚ReactHookå—/2019081821194714.png","hash":"f383076a180704e8bb080c5da414486d5a6c2567","modified":1624543206943},{"_id":"themes/Butterfly/layout/includes/header/social.pug","hash":"0758817464c300f785384ea21bf096f5010c4f96","modified":1624543206999},{"_id":"themes/Butterfly/layout/includes/comments/disqus.pug","hash":"5ae50a271fe5a49f4012555657db028b7113612b","modified":1624543206994},{"_id":"themes/Butterfly/layout/includes/comments/disqusjs.pug","hash":"e96dd925a1d17cfb4fe5ac13561982c9b13d6b53","modified":1624543206994},{"_id":"themes/Butterfly/layout/includes/header/menu_item.pug","hash":"86b8e1df78277d519ea6577c877194821e811c9d","modified":1624543206999},{"_id":"themes/Butterfly/layout/includes/header/header.pug","hash":"0cff3caa687c7edd4eeabd5f9e4cfd95e8106734","modified":1624543206999},{"_id":"themes/Butterfly/layout/includes/comments/gitalk.pug","hash":"bb4de1b40ae07b27dda4e3e529687f6c1a9196ca","modified":1624543206994},{"_id":"themes/Butterfly/layout/includes/comments/index.pug","hash":"5ca6a00615f963c48ae5fb27baf23dc18b30890d","modified":1624543206994},{"_id":"themes/Butterfly/layout/includes/comments/laibili.pug","hash":"1d5d1b2cf17271cc6d69071f6df11fe477ae8bb3","modified":1624543206995},{"_id":"themes/Butterfly/layout/includes/comments/utterances.pug","hash":"8ef3dc1a27c19645ac054e30594ed1930b1c56f0","modified":1624543206995},{"_id":"themes/Butterfly/layout/includes/head/config.pug","hash":"388c45fa45d339090678c76c0ae9ab1e2711ed71","modified":1624543206997},{"_id":"themes/Butterfly/layout/includes/head/Open_Graph.pug","hash":"fe4750521c9b4f83c3dbca81395464838b915d11","modified":1624543206996},{"_id":"themes/Butterfly/layout/includes/comments/valine.pug","hash":"98feae7f019dc1fa8b5145deea07bfa6ad5a4550","modified":1624543206995},{"_id":"themes/Butterfly/layout/includes/head/google_adsense.pug","hash":"393e641a35174f26318b8724eddaf1a0b1386636","modified":1624543206998},{"_id":"themes/Butterfly/layout/includes/head/comment.pug","hash":"dae7d56c6ee85432e6cb29820a6c652190d2a3b8","modified":1624543206997},{"_id":"themes/Butterfly/layout/includes/head/dns_prefetch.pug","hash":"bfcf9e01cffbaddfd450aa4488cc6152f37f853a","modified":1624543206998},{"_id":"themes/Butterfly/layout/includes/head/config_site.pug","hash":"4dea5574fa33f688a2a80d4e070e6c0ba9a62480","modified":1624543206997},{"_id":"themes/Butterfly/layout/includes/header/post-info.pug","hash":"46c6c1e122e841d1563f82ff39880b776151772a","modified":1624543206999},{"_id":"themes/Butterfly/layout/includes/header/index.pug","hash":"5a9ec6dc058feff4897870ea25e94c5746f04816","modified":1624543206999},{"_id":"themes/Butterfly/layout/includes/head/noscript.pug","hash":"a84dac02e9d30c9c8e7ed895214d46cf2d2af3db","modified":1624543206998},{"_id":"themes/Butterfly/layout/includes/head/pwa.pug","hash":"e4fb9e5c72ca05d595f0959893c2fe03b8f478e2","modified":1624543206998},{"_id":"themes/Butterfly/layout/includes/head/site_verification.pug","hash":"2d267fcc926505fcc5ebc9f59146555b32654c7e","modified":1624543206998},{"_id":"themes/Butterfly/layout/includes/head/darkmode.pug","hash":"e44d63ee21b7ee247927f0189a783ffa9ba075fd","modified":1624543206997},{"_id":"themes/Butterfly/layout/includes/mobile-sidebar/index.pug","hash":"e9eacd936c259d8f10e1becdd6e3ca129ea0e942","modified":1624543207001},{"_id":"themes/Butterfly/layout/includes/head/analytics.pug","hash":"036213b05df9e51250c2734854de7a096a9ed8c2","modified":1624543206996},{"_id":"themes/Butterfly/layout/includes/head/subtitle.pug","hash":"7750b7e9a051499e117bfcff734c1e88479eb1fc","modified":1624543206998},{"_id":"themes/Butterfly/layout/includes/math/index.pug","hash":"403601a903d02ef0a103d18909a6eb0b088fcb4c","modified":1624543207000},{"_id":"themes/Butterfly/layout/includes/mobile-sidebar/mobile-menus.pug","hash":"171ac3fbbfd631b4a6ef0e304fa15254193c4727","modified":1624543207001},{"_id":"themes/Butterfly/layout/includes/mixins/article-sort.pug","hash":"55135cbe7086704d445a9cb828b58635f7d271df","modified":1624543207001},{"_id":"themes/Butterfly/layout/includes/mixins/UI.pug","hash":"e0182e4e91820b2c35ccf067a314c393205ea0d8","modified":1624543207000},{"_id":"themes/Butterfly/layout/includes/math/katex.pug","hash":"60bd18e051a442d5ce25325a55982922ab15be04","modified":1624543207000},{"_id":"themes/Butterfly/layout/includes/math/mermaid.pug","hash":"41f6c6c9d753ed97ab2adef47f13595f8aebb464","modified":1624543207000},{"_id":"themes/Butterfly/layout/includes/post/reward.pug","hash":"0f7db3dfab5250ef3af1f8966222bfab26fd9204","modified":1624543207001},{"_id":"themes/Butterfly/layout/includes/search/index.pug","hash":"66b4f4e8119e987cd3f9907298689a1408a05859","modified":1624543207002},{"_id":"themes/Butterfly/layout/includes/search/algolia.pug","hash":"3d2b2de0e199ab1fb151f41f2bbaac909f3d3d12","modified":1624543207002},{"_id":"themes/Butterfly/layout/includes/share/addtoany.pug","hash":"4108ab6b91461254901f19ed3e5e082e437324aa","modified":1624543207002},{"_id":"themes/Butterfly/layout/includes/share/share-js.pug","hash":"a3c4bb20d0d7c81673a3ff6e94216999e0470571","modified":1624543207002},{"_id":"themes/Butterfly/layout/includes/share/add-this.pug","hash":"8b4034e53ca5bf85097f681a6e76a53ce685c205","modified":1624543207002},{"_id":"themes/Butterfly/layout/includes/third-party/canvas-nest.pug","hash":"3d7a3654ae03fd2665ea355ee9eac48af0ee82af","modified":1624543207003},{"_id":"themes/Butterfly/layout/includes/share/index.pug","hash":"af2f09d374a55983d1ac695848ccfae50629f439","modified":1624543207002},{"_id":"themes/Butterfly/layout/includes/third-party/canvas-ribbon-piao.pug","hash":"001f28c633d2ec2d5ef9ca047fb1fe61ffefd66f","modified":1624543207003},{"_id":"themes/Butterfly/layout/includes/third-party/pangu.pug","hash":"2ea7c6070fc0f028b59c6ac4fbc80b4c3f36ced1","modified":1624543207004},{"_id":"themes/Butterfly/layout/includes/widget/card_ad.pug","hash":"44af3c7a67b86f048deacb451dd454b088631374","modified":1624543207004},{"_id":"themes/Butterfly/layout/includes/third-party/canvas-ribbon.pug","hash":"74fc2a62e125f28947ec9cd60f968023da766adb","modified":1624543207004},{"_id":"themes/Butterfly/layout/includes/widget/card_announcement.pug","hash":"2c6841dd502f8b26984554023da4e597cac4288a","modified":1624543207004},{"_id":"themes/Butterfly/layout/includes/math/mathjax.pug","hash":"9f10622c73c2c87d3502660eb933af654d2600b4","modified":1624543207000},{"_id":"themes/Butterfly/layout/includes/search/local-search.pug","hash":"e24b08e7253e78d3088d7267188a1ca18b6b5315","modified":1624543207002},{"_id":"themes/Butterfly/layout/includes/post/post-copyright.pug","hash":"547a2737cd3ac45272a75561f5b5438d72d10f6d","modified":1624543207001},{"_id":"themes/Butterfly/layout/includes/widget/card_archives.pug","hash":"ae608179a5a40b08847a28b24b6aba65feebf74b","modified":1624543207004},{"_id":"themes/Butterfly/layout/includes/widget/card_categories.pug","hash":"9705ac9dd87075ec1f8e05eb01c0ca5276aa3bc7","modified":1624543207004},{"_id":"themes/Butterfly/source/css/_global/index.styl","hash":"24468cdca3538875426f5e193518de924fecd1d5","modified":1624543207009},{"_id":"themes/Butterfly/layout/includes/widget/card_tags.pug","hash":"876c54fda6f9cbf5485586f1fad94b82488ad6ac","modified":1624543207005},{"_id":"themes/Butterfly/layout/includes/widget/card_author.pug","hash":"12c40bfa22bda631fe4d0ab02dc71e3e0c99204d","modified":1624543207004},{"_id":"themes/Butterfly/source/css/_highlight/diff.styl","hash":"bb83b379954dc2e7f5a9915e5ed50da7223e3efa","modified":1624543207009},{"_id":"themes/Butterfly/source/css/_highlight/theme.styl","hash":"32b94940c8288020bb4245941ca587c8aad7c14c","modified":1624543207009},{"_id":"themes/Butterfly/layout/includes/widget/card_recent_post.pug","hash":"063630aea319d4fbf7ec6e11d6e082e56780d1a9","modified":1624543207005},{"_id":"themes/Butterfly/layout/includes/widget/card_webinfo.pug","hash":"b31f88fff690ec8efbbb8163eb01abed98a6ae0f","modified":1624543207005},{"_id":"themes/Butterfly/layout/includes/widget/index.pug","hash":"2f454c991365ac88fdb171c86d6404dad7963c45","modified":1624543207005},{"_id":"themes/Butterfly/source/css/_layout/404.styl","hash":"f5875982abf021213e1274f615b812b29b5fee56","modified":1624543207009},{"_id":"themes/Butterfly/source/css/_highlight/highlight.styl","hash":"de83e03d960028ffb0727ebba672048352a47869","modified":1624543207009},{"_id":"themes/Butterfly/source/css/_layout/flink.styl","hash":"926d4ff56a0b19ae7d3d7ea39212aeb5d0f1841d","modified":1624543207010},{"_id":"themes/Butterfly/source/css/_mode/darkmode.styl","hash":"87775163a58217964ce66be33067b34327f67d2a","modified":1624543207015},{"_id":"themes/Butterfly/source/css/_mode/readmode.styl","hash":"6cdcbaeca64576a2e6713898eef87f117755af24","modified":1624543207015},{"_id":"themes/Butterfly/source/css/_layout/aside.styl","hash":"85f8695cb5672db2136f30a7e4c7176f17dd9207","modified":1624543207009},{"_id":"themes/Butterfly/source/css/_layout/gallery.styl","hash":"df07b7eae8a1a1f50c2c0a10833f7e67d77f8f8e","modified":1624543207010},{"_id":"themes/Butterfly/source/css/_layout/category.styl","hash":"b5bca389c3185b2794939f0f5dd889e1ed72f6cc","modified":1624543207010},{"_id":"themes/Butterfly/source/css/_layout/footer.styl","hash":"2dace492e6da44e39ad5cc7eae8bc8bb5a34aaae","modified":1624543207010},{"_id":"themes/Butterfly/source/css/_layout/mobile-sidebar.styl","hash":"9f614d995f1e74bb23f1fac7b6136bc63d8792c8","modified":1624543207011},{"_id":"themes/Butterfly/source/css/_layout/head.styl","hash":"7867299d5dc00c3e1d8a33ea71270eb47caabd7c","modified":1624543207011},{"_id":"themes/Butterfly/source/css/_layout/note.styl","hash":"b522d071c320c0aa52fd56f30b0bc9cf923e46d7","modified":1624543207011},{"_id":"themes/Butterfly/source/css/_layout/pagination.styl","hash":"9181061f214ed8e2b48c203e1d3d524edc4b56e7","modified":1624543207012},{"_id":"themes/Butterfly/source/css/_layout/page.styl","hash":"da195674ba8836b8a96a2d264da97f8b312815f4","modified":1624543207011},{"_id":"themes/Butterfly/source/css/_layout/post.styl","hash":"86b4813db1776a14f98e443123e8f8b22e35d7dc","modified":1624543207012},{"_id":"themes/Butterfly/source/css/_layout/reward.styl","hash":"0df33f37f7339df71b68a6b781c068e5a344c9cc","modified":1624543207014},{"_id":"themes/Butterfly/source/css/_layout/sidebar.styl","hash":"d1ad6bbdedf8bead2b0b18519629c731afbab49d","modified":1624543207014},{"_id":"themes/Butterfly/source/css/_layout/rightside.styl","hash":"4c27911ff1432870f328934cf6b171ecb16db1ce","modified":1624543207014},{"_id":"themes/Butterfly/source/css/_layout/relatedposts.styl","hash":"1799a33e3f7cdc543227be833d59ef84bb038124","modified":1624543207014},{"_id":"themes/Butterfly/source/css/_search/algolia.styl","hash":"42d636b01e0b41934425cf4716adcb01aff2ab44","modified":1624543207015},{"_id":"themes/Butterfly/source/css/_search/index.styl","hash":"e79af6f332e1334a1c54fcf1850df37a9cb5e363","modified":1624543207015},{"_id":"themes/Butterfly/source/css/_layout/third-party.styl","hash":"ce20d0e71586ce7094074bd1b474e1fa40c6d29f","modified":1624543207015},{"_id":"themes/Butterfly/source/css/_third-party/normalize.min.css","hash":"001bd6d68a9b9af5dd0158fe116889434f36b1fd","modified":1624543207016},{"_id":"themes/Butterfly/source/css/_search/local-search.styl","hash":"772b9397eabe165b76b7fe7a429a03314a041275","modified":1624543207015},{"_id":"themes/Butterfly/source/js/search/local-search.js","hash":"8c6b33f0fbd7fd3ee7c9149a20423dc44a7cc4ed","modified":1624543207025},{"_id":"themes/Butterfly/source/js/third-party/activate-power-mode.js","hash":"2c4ab494225b7d04eed934efc43a43791e596f4a","modified":1624543207026},{"_id":"themes/Butterfly/source/js/search/algolia.js","hash":"a4aa32db60e5cc12bbe3b3a82209379bf8ab62ce","modified":1624543207025},{"_id":"themes/Butterfly/source/js/third-party/ClickShowText.js","hash":"2af6ddbabdd36979cc9c05b117452a1534702c6d","modified":1624543207026},{"_id":"themes/Butterfly/source/js/third-party/fireworks.js","hash":"75b3d7025c01947f3d425e592e910458393ee621","modified":1624543207027},{"_id":"themes/Butterfly/source/js/third-party/canvas-nest.js","hash":"ed2a7dedc314eb1047d030be2e95d0d5679bc577","modified":1624543207026},{"_id":"themes/Butterfly/source/js/third-party/piao.js","hash":"bc3d3f2afeefea55d9d6ba8dfa798435e1eb1062","modified":1624543207027},{"_id":"themes/Butterfly/source/js/third-party/canvas-ribbon.js","hash":"7cc7eb304403f4d504ba0b0824976ab86650c415","modified":1624543207026},{"_id":"source/image/BFC/1.png","hash":"540328be121a88237b66f1d73540de94ccad591b","modified":1624543206875},{"_id":"themes/Butterfly/source/js/third-party/click_heart.js","hash":"7295ee03e9ae40f855d0c494a9b84e76a36ffe20","modified":1624543207026},{"_id":"source/image/pr/commit.png","hash":"ffebdcd0e8d00099c2d64bf00b723d44c59536ee","modified":1624543206922},{"_id":"source/image/react1/bebel.png","hash":"9dc3cf33345745bce1fa8a866bf43708882d4c67","modified":1624543206933},{"_id":"source/image/react1/download.jpg","hash":"8da8d23163705f36e165f45ecd743726b7068a90","modified":1624543206935},{"_id":"source/image/ä½ çœŸçš„æ‡‚ReactHookå—/20190818212347571.png","hash":"9c1d608da7f8ed64f1923dda1ce43ad2ebbebec3","modified":1624543206945},{"_id":"themes/Butterfly/source/img/index.jpg","hash":"d79fc7faf6d37b088bd638ceef641dd33beb353f","modified":1624543207023},{"_id":"source/image/BFC/2.png","hash":"3ece8accca4992b9b7f91c4e03ede39d6a0902a5","modified":1624543206876},{"_id":"source/image/WebpackCleanWebpackPlugin/20190622155255789.png","hash":"5a9b0df917450afb2d036131b4a78ea9f44fcd5f","modified":1624543206886},{"_id":"source/image/cover/bg.jpg","hash":"e4af8ffeb55d0095eec7a79d9929f3eba168be41","modified":1624543206917},{"_id":"source/image/pr/pr.png","hash":"c115b00a0b9a472420144d5b9ece833536ad85c1","modified":1624543206927},{"_id":"source/image/react1/element.png","hash":"ec3e6ade030c3fd6f4c8fd17e3ae297eab738c5d","modified":1624543206937},{"_id":"source/image/reactDebugger/console.png","hash":"f7af90daf93c1942f7aa6d65b25694716c5ac915","modified":1624543206941},{"_id":"source/image/æ·±å…¥å†…å­˜ä¸–ç•Œ/2.png","hash":"f59706eeafcff03d4b973aaa3cb9ade0a0a4678e","modified":1624543206976},{"_id":"source/image/pr/create.png","hash":"c4582990440ad66a2ae4c91215758b22d6311a00","modified":1624543206924},{"_id":"source/image/pr/push.png","hash":"433a7e6d6b42f74e95f22b8c52b59673512f486e","modified":1624543206931},{"_id":"source/image/AntDesignProæ¢ç´¢/2019031215175956.png","hash":"342395e4f6eda6e2288a8554341f7df2ba3d3427","modified":1624543206871},{"_id":"source/image/Webå‰ç«¯å­¦ä¹ è·¯çº¿/20190328205449472.png","hash":"e03d1580df71c0abd46cf5eb1d12887408f3180d","modified":1624543206910},{"_id":"source/image/æ·±å…¥å†…å­˜ä¸–ç•Œ/1.jpeg","hash":"04b62b1c23324009613d5c89505fbdff95021f6e","modified":1624543206974}],"Category":[{"name":"Ant-Design","_id":"ckqevra7m0004lwrd4z7p40hq"},{"name":"HTTP","_id":"ckqevra7q0009lwrdh0asfxf0"},{"name":"åšå®¢","_id":"ckqevra7t000elwrd5ew61qzx"},{"name":"React","_id":"ckqevra7w000llwrd8dde8pef"},{"name":"Java","_id":"ckqevra7z000rlwrd77hu6tem"},{"name":"WebPack","_id":"ckqevra850014lwrdhxf18gmk"},{"name":"JavaScript","_id":"ckqevra87001alwrd7fjtfq0q"},{"name":"Webå‰ç«¯","_id":"ckqevra8f001hlwrd7igc71fx"},{"name":"JavaScript","parent":"ckqevra7m0004lwrd4z7p40hq","_id":"ckqevra8i001mlwrdg43lfecp"},{"name":"Ant-Design-Pro","_id":"ckqevra8m001slwrdaen1ft73"},{"name":"CSS","_id":"ckqevra8q001zlwrd6rke3ay6"},{"name":"Spring-Boot","parent":"ckqevra7z000rlwrd77hu6tem","_id":"ckqevra8t0026lwrdhoxh17vv"},{"name":"github","_id":"ckqevra8v002blwrd31nmdmg0"},{"name":"é‡æ‹¾å‰ç«¯","_id":"ckqevra90002rlwrdh877dsjl"},{"name":"é¢ç»","_id":"ckqevra9g004ilwrd8ygh3lue"},{"name":"Webpack","_id":"ckqevra9h004mlwrda22k7e2y"},{"name":"react","_id":"ckqevra9i004qlwrdbc9r4088"},{"name":"å‰ç«¯","_id":"ckqevra9j004vlwrdhrv06f50"},{"name":"ES6","_id":"ckqevra9k004zlwrd4hxi70vh"}],"Data":[],"Page":[{"title":"å…³äºæˆ‘","date":"2020-04-11T13:41:09.000Z","_content":"\n> Never put off till tomorrow what you can do today.\n> â€”â€” Thomas Jefferson\n\n- å§“å: Derrick\n- åœ°ç‚¹: æ­å·\n- å¹´é¾„: 1995\n- æ€§åˆ«: ç”·\n- çˆ±å¥½: å¥èº«, ğŸ“–\n\n","source":"about/index.md","raw":"---\ntitle: å…³äºæˆ‘\ndate: 2020-04-11 21:41:09\n---\n\n> Never put off till tomorrow what you can do today.\n> â€”â€” Thomas Jefferson\n\n- å§“å: Derrick\n- åœ°ç‚¹: æ­å·\n- å¹´é¾„: 1995\n- æ€§åˆ«: ç”·\n- çˆ±å¥½: å¥èº«, ğŸ“–\n\n","updated":"2021-06-24T14:00:06.855Z","path":"about/index.html","comments":1,"layout":"page","_id":"ckqevra7i0001lwrd4vhc90as","content":"<blockquote>\n<p>Never put off till tomorrow what you can do today.<br>â€”â€” Thomas Jefferson</p>\n</blockquote>\n<ul>\n<li>å§“å: Derrick</li>\n<li>åœ°ç‚¹: æ­å·</li>\n<li>å¹´é¾„: 1995</li>\n<li>æ€§åˆ«: ç”·</li>\n<li>çˆ±å¥½: å¥èº«, ğŸ“–</li>\n</ul>\n","site":{"data":{}},"cover":"/img/post.jpg","excerpt":"","more":"<blockquote>\n<p>Never put off till tomorrow what you can do today.<br>â€”â€” Thomas Jefferson</p>\n</blockquote>\n<ul>\n<li>å§“å: Derrick</li>\n<li>åœ°ç‚¹: æ­å·</li>\n<li>å¹´é¾„: 1995</li>\n<li>æ€§åˆ«: ç”·</li>\n<li>çˆ±å¥½: å¥èº«, ğŸ“–</li>\n</ul>\n"},{"title":"clean","date":"2020-04-11T14:34:16.000Z","_content":"","source":"clean/index.md","raw":"---\ntitle: clean\ndate: 2020-04-11 22:34:16\n---\n","updated":"2021-06-24T14:00:06.855Z","path":"clean/index.html","comments":1,"layout":"page","_id":"ckqevra7l0003lwrdbsjfd4ho","content":"","site":{"data":{}},"cover":"/img/post.jpg","excerpt":"","more":""}],"Post":[{"title":"5åˆ†é’Ÿå¿«é€Ÿç²¾é€šAnt Design Form 1åˆ†é’Ÿå¿«é€Ÿæ„å»ºå¤æ‚Ant Design Formè¡¨å•","date":"2019-07-28T12:05:56.000Z","cover":"/image/cover/ANTD.png","_content":"## Ant Design Form\nAntd è¡¨å•çš„æ ¸å¿ƒæ— éæ˜¯ä»¥ä¸‹ä¸¤ç‚¹\n\n 1. è¡¨å•åˆ›å»ºï¼ˆ`Form.create`ï¼‰åœ¨`this.props`å†™å…¥`form`å±æ€§\n 2. è¡¨å•ä¸ç»„ä»¶çš„åŒå‘ç»‘å®šï¼ˆ`this.props.form.getFieldDecorator`ï¼‰\n 3. è¡¨å•çš„å–å€¼ï¼ˆ`this.props.form.validateFields / this.props.form.validateFieldsAndScroll`ï¼‰\n\n#### è¡¨å•åˆ›å»º\n`Form.create`è¿™æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œä¼ å…¥çš„æ˜¯reactç»„ä»¶ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„reactç»„ä»¶ï¼Œåœ¨å‡½æ•°å†…éƒ¨ä¼šå¯¹ä¼ å…¥ç»„ä»¶è¿›è¡Œæ”¹é€ ï¼Œæ·»åŠ ä¸Šä¸€å®šçš„æ–¹æ³•ç”¨äºè¿›è¡Œä¸€äº›ç§˜å¯†æ“ä½œ ï¼Œè¿™é‡Œä¸å¤šåšè§£é‡Šï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥ä¸Šå®˜ç½‘æŸ¥çœ‹ã€‚\n\n[æˆ‘æ˜¯é£æœºç¥¨ï¼ˆReact-é«˜é˜¶ç»„ä»¶ï¼‰ï¼Œç‚¹æˆ‘](https://react.docschina.org/docs/higher-order-components.html)\nä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š\n\n```\nclass CustomizedForm extends React.Component { ... }\n\n// use wrappedComponentRef\nconst EnhancedForm =  Form.create()(CustomizedForm);\n```\næˆ–è€…\n```\n@Form.create()\nclass CustomizedForm extends React.Component { ... }\n```\n#### è¡¨å•ä¸ç»„ä»¶çš„åŒå‘ç»‘å®š\nä»–çš„ç›®çš„æ˜¯å°†è¡¨å•çš„ç»„ä»¶çš„å€¼ä¸è¡¨å•ç»‘å®šã€‚æœ€åè¡¨å•å¯ä»¥ç›´æ¥å–åˆ°æŸæŸç»„ä»¶çš„å€¼ã€‚\n\n```\n<!-- è¡¨å•æ•°æ®ç»‘å®š -->\n<Form.Item {...formItemLayout} label={'åç§°'}>\n\t{getFieldDecorator('searchName')(\n\t\t<Input placeholder={'è¯·è¾“å…¥åç§°'} />\n\t)}\n</Form.Item>\n```\nè¿™ä¸ªæ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„ç»‘å®šï¼Œç»„ä»¶inputçš„å€¼éƒ½ä¼šç”±'searchName'è¿™ä¸ªå±æ€§æ”¶çº³ã€‚\nå¯ä»¥ç›´æ¥å–å€¼ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åŠ å…¥è‡ªå·±çš„æ ¡éªŒè§„åˆ™ï¼Œç­‰ç­‰ã€‚è¿™é‡Œä¸å¤šåšè§£é‡Šï¼Œè¿™äº›éƒ½æ˜¯é™„åŠ çš„è¿›é˜¶åŠŸèƒ½ï¼Œè¿™é‡Œä¸å¤šåšæè¿°ã€‚\n\n[æˆ‘æ˜¯é£æœºç¥¨ï¼ˆè¡¨å•è¿›é˜¶ï¼‰ï¼Œç‚¹æˆ‘ï¼](https://ant.design/components/form-cn/)\n\n#### è¡¨å•çš„å–å€¼\n\n```\nthis.props.form.validateFields((err, values) => {\n      if (!err) { // è¿™é‡Œä¹Ÿå¯ä»¥ä¸è¦ï¼Œæ˜¯ç”¨äºæ ¡éªŒçš„ã€‚\n        console.log('Received values of form: ', values);\n      }\n    });\n```\nè¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„å–å€¼ï¼Œå½“ç„¶å¯ä»¥å®šåˆ¶çš„å–å€¼ï¼Œæˆ–è€…å®šåˆ¶çš„æ ¡éªŒï¼Œæ¯”å¦‚ï¼Œåœ¨è·å–éªŒè¯ç çš„æ—¶å€™ï¼Œä¸éœ€è¦æ ¡éªŒå¯†ç æ˜¯å¦è¾“å…¥æˆ–è€…ç¬¦åˆä½ çš„è§„åˆ™ï¼Œå°±å¯ä»¥åªæ ¡éªŒæ‰‹æœºå·ï¼Œç­‰ç­‰ã€‚è¿™é‡Œä¸å¤šåšè§£é‡Šï¼Œè¿™äº›éƒ½æ˜¯é™„åŠ çš„è¿›é˜¶åŠŸèƒ½ï¼Œè¿™é‡Œä¸å¤šåšæè¿°ã€‚\n\n[æˆ‘æ˜¯é£æœºç¥¨ï¼ˆè¡¨å•è¿›é˜¶ï¼‰ï¼Œç‚¹æˆ‘ï¼](https://ant.design/components/form-cn/)\n\nåŸºæœ¬ä¸Šä½ æŒæ¡äº†è¿™äº›å°±å¯ä»¥è¾ƒä¸ºçµæ´»çš„ä½¿ç”¨Ant Design Formäº†ã€‚\n\n## ä½†æ˜¯ï¼åˆ’é‡ç‚¹äº†ï¼\nå¦‚æœæœ‰ä¸€äº›æ›´åŠ è¿›é˜¶çš„æƒ³æ³•ã€‚è¯·çœ‹ï¼\n\n[è¡¨å•çš„è¿›é˜¶ä½¿ç”¨](https://blog.csdn.net/cuandeqin2083/article/details/89643390)\n\n# é‡ä¸­ä¹‹é‡\nå¦‚æœä½ è§‰å¾—è‡ªå·±æ„å»ºè¡¨å•éå¸¸éº»çƒ¦ï¼Œæˆ–è€…å¯¹è¡¨å•çš„ç†è§£è¿˜æ˜¯å¤Ÿé€å½»ï¼Œæƒ³ä¸€æ­¥åˆ°ä½æ„ä»¶è¡¨å•ï¼Œæ¨èæœ¬äººè‡ªç”¨è‡ªåˆ›ç»„ä»¶\nant-design-form\n\nä¸Šé¢çš„æ–‡æ¡£éå¸¸è¯¦ç»†ï¼Œå¦‚æœæœ‰é—®é¢˜éšæ—¶å¯ä»¥ç»™æˆ‘æissuesã€‚å¦‚æœå–œæ¬¢çš„è¯éº»çƒ¦ç‚¹ä¸ªstart~\n\n[æˆ‘æ˜¯ant-design-fromçš„é£æœºç¥¨ï¼Œç‚¹æˆ‘ç‚¹æˆ‘ï¼ï¼](https://github.com/DerrickTel/ant-design-form)","source":"_posts/5åˆ†é’Ÿå¿«é€Ÿç²¾é€šAnt-Design-Form-1åˆ†é’Ÿå¿«é€Ÿæ„å»ºå¤æ‚Ant-Design-Formè¡¨å•.md","raw":"---\ntitle: 5åˆ†é’Ÿå¿«é€Ÿç²¾é€šAnt Design Form 1åˆ†é’Ÿå¿«é€Ÿæ„å»ºå¤æ‚Ant Design Formè¡¨å•\ndate: 2019-07-28 20:05:56\ntags: [Ant-Design-Form, Ant-Design]\ncategory: [Ant-Design]\ncover: /image/cover/ANTD.png\n---\n## Ant Design Form\nAntd è¡¨å•çš„æ ¸å¿ƒæ— éæ˜¯ä»¥ä¸‹ä¸¤ç‚¹\n\n 1. è¡¨å•åˆ›å»ºï¼ˆ`Form.create`ï¼‰åœ¨`this.props`å†™å…¥`form`å±æ€§\n 2. è¡¨å•ä¸ç»„ä»¶çš„åŒå‘ç»‘å®šï¼ˆ`this.props.form.getFieldDecorator`ï¼‰\n 3. è¡¨å•çš„å–å€¼ï¼ˆ`this.props.form.validateFields / this.props.form.validateFieldsAndScroll`ï¼‰\n\n#### è¡¨å•åˆ›å»º\n`Form.create`è¿™æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œä¼ å…¥çš„æ˜¯reactç»„ä»¶ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„reactç»„ä»¶ï¼Œåœ¨å‡½æ•°å†…éƒ¨ä¼šå¯¹ä¼ å…¥ç»„ä»¶è¿›è¡Œæ”¹é€ ï¼Œæ·»åŠ ä¸Šä¸€å®šçš„æ–¹æ³•ç”¨äºè¿›è¡Œä¸€äº›ç§˜å¯†æ“ä½œ ï¼Œè¿™é‡Œä¸å¤šåšè§£é‡Šï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥ä¸Šå®˜ç½‘æŸ¥çœ‹ã€‚\n\n[æˆ‘æ˜¯é£æœºç¥¨ï¼ˆReact-é«˜é˜¶ç»„ä»¶ï¼‰ï¼Œç‚¹æˆ‘](https://react.docschina.org/docs/higher-order-components.html)\nä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š\n\n```\nclass CustomizedForm extends React.Component { ... }\n\n// use wrappedComponentRef\nconst EnhancedForm =  Form.create()(CustomizedForm);\n```\næˆ–è€…\n```\n@Form.create()\nclass CustomizedForm extends React.Component { ... }\n```\n#### è¡¨å•ä¸ç»„ä»¶çš„åŒå‘ç»‘å®š\nä»–çš„ç›®çš„æ˜¯å°†è¡¨å•çš„ç»„ä»¶çš„å€¼ä¸è¡¨å•ç»‘å®šã€‚æœ€åè¡¨å•å¯ä»¥ç›´æ¥å–åˆ°æŸæŸç»„ä»¶çš„å€¼ã€‚\n\n```\n<!-- è¡¨å•æ•°æ®ç»‘å®š -->\n<Form.Item {...formItemLayout} label={'åç§°'}>\n\t{getFieldDecorator('searchName')(\n\t\t<Input placeholder={'è¯·è¾“å…¥åç§°'} />\n\t)}\n</Form.Item>\n```\nè¿™ä¸ªæ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„ç»‘å®šï¼Œç»„ä»¶inputçš„å€¼éƒ½ä¼šç”±'searchName'è¿™ä¸ªå±æ€§æ”¶çº³ã€‚\nå¯ä»¥ç›´æ¥å–å€¼ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åŠ å…¥è‡ªå·±çš„æ ¡éªŒè§„åˆ™ï¼Œç­‰ç­‰ã€‚è¿™é‡Œä¸å¤šåšè§£é‡Šï¼Œè¿™äº›éƒ½æ˜¯é™„åŠ çš„è¿›é˜¶åŠŸèƒ½ï¼Œè¿™é‡Œä¸å¤šåšæè¿°ã€‚\n\n[æˆ‘æ˜¯é£æœºç¥¨ï¼ˆè¡¨å•è¿›é˜¶ï¼‰ï¼Œç‚¹æˆ‘ï¼](https://ant.design/components/form-cn/)\n\n#### è¡¨å•çš„å–å€¼\n\n```\nthis.props.form.validateFields((err, values) => {\n      if (!err) { // è¿™é‡Œä¹Ÿå¯ä»¥ä¸è¦ï¼Œæ˜¯ç”¨äºæ ¡éªŒçš„ã€‚\n        console.log('Received values of form: ', values);\n      }\n    });\n```\nè¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„å–å€¼ï¼Œå½“ç„¶å¯ä»¥å®šåˆ¶çš„å–å€¼ï¼Œæˆ–è€…å®šåˆ¶çš„æ ¡éªŒï¼Œæ¯”å¦‚ï¼Œåœ¨è·å–éªŒè¯ç çš„æ—¶å€™ï¼Œä¸éœ€è¦æ ¡éªŒå¯†ç æ˜¯å¦è¾“å…¥æˆ–è€…ç¬¦åˆä½ çš„è§„åˆ™ï¼Œå°±å¯ä»¥åªæ ¡éªŒæ‰‹æœºå·ï¼Œç­‰ç­‰ã€‚è¿™é‡Œä¸å¤šåšè§£é‡Šï¼Œè¿™äº›éƒ½æ˜¯é™„åŠ çš„è¿›é˜¶åŠŸèƒ½ï¼Œè¿™é‡Œä¸å¤šåšæè¿°ã€‚\n\n[æˆ‘æ˜¯é£æœºç¥¨ï¼ˆè¡¨å•è¿›é˜¶ï¼‰ï¼Œç‚¹æˆ‘ï¼](https://ant.design/components/form-cn/)\n\nåŸºæœ¬ä¸Šä½ æŒæ¡äº†è¿™äº›å°±å¯ä»¥è¾ƒä¸ºçµæ´»çš„ä½¿ç”¨Ant Design Formäº†ã€‚\n\n## ä½†æ˜¯ï¼åˆ’é‡ç‚¹äº†ï¼\nå¦‚æœæœ‰ä¸€äº›æ›´åŠ è¿›é˜¶çš„æƒ³æ³•ã€‚è¯·çœ‹ï¼\n\n[è¡¨å•çš„è¿›é˜¶ä½¿ç”¨](https://blog.csdn.net/cuandeqin2083/article/details/89643390)\n\n# é‡ä¸­ä¹‹é‡\nå¦‚æœä½ è§‰å¾—è‡ªå·±æ„å»ºè¡¨å•éå¸¸éº»çƒ¦ï¼Œæˆ–è€…å¯¹è¡¨å•çš„ç†è§£è¿˜æ˜¯å¤Ÿé€å½»ï¼Œæƒ³ä¸€æ­¥åˆ°ä½æ„ä»¶è¡¨å•ï¼Œæ¨èæœ¬äººè‡ªç”¨è‡ªåˆ›ç»„ä»¶\nant-design-form\n\nä¸Šé¢çš„æ–‡æ¡£éå¸¸è¯¦ç»†ï¼Œå¦‚æœæœ‰é—®é¢˜éšæ—¶å¯ä»¥ç»™æˆ‘æissuesã€‚å¦‚æœå–œæ¬¢çš„è¯éº»çƒ¦ç‚¹ä¸ªstart~\n\n[æˆ‘æ˜¯ant-design-fromçš„é£æœºç¥¨ï¼Œç‚¹æˆ‘ç‚¹æˆ‘ï¼ï¼](https://github.com/DerrickTel/ant-design-form)","slug":"5åˆ†é’Ÿå¿«é€Ÿç²¾é€šAnt-Design-Form-1åˆ†é’Ÿå¿«é€Ÿæ„å»ºå¤æ‚Ant-Design-Formè¡¨å•","published":1,"updated":"2021-06-24T14:00:06.846Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra7e0000lwrdf9vb6x2s","content":"<h2 id=\"Ant-Design-Form\"><a href=\"#Ant-Design-Form\" class=\"headerlink\" title=\"Ant Design Form\"></a>Ant Design Form</h2><p>Antd è¡¨å•çš„æ ¸å¿ƒæ— éæ˜¯ä»¥ä¸‹ä¸¤ç‚¹</p>\n<ol>\n<li>è¡¨å•åˆ›å»ºï¼ˆ<code>Form.create</code>ï¼‰åœ¨<code>this.props</code>å†™å…¥<code>form</code>å±æ€§</li>\n<li>è¡¨å•ä¸ç»„ä»¶çš„åŒå‘ç»‘å®šï¼ˆ<code>this.props.form.getFieldDecorator</code>ï¼‰</li>\n<li>è¡¨å•çš„å–å€¼ï¼ˆ<code>this.props.form.validateFields / this.props.form.validateFieldsAndScroll</code>ï¼‰</li>\n</ol>\n<h4 id=\"è¡¨å•åˆ›å»º\"><a href=\"#è¡¨å•åˆ›å»º\" class=\"headerlink\" title=\"è¡¨å•åˆ›å»º\"></a>è¡¨å•åˆ›å»º</h4><p><code>Form.create</code>è¿™æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œä¼ å…¥çš„æ˜¯reactç»„ä»¶ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„reactç»„ä»¶ï¼Œåœ¨å‡½æ•°å†…éƒ¨ä¼šå¯¹ä¼ å…¥ç»„ä»¶è¿›è¡Œæ”¹é€ ï¼Œæ·»åŠ ä¸Šä¸€å®šçš„æ–¹æ³•ç”¨äºè¿›è¡Œä¸€äº›ç§˜å¯†æ“ä½œ ï¼Œè¿™é‡Œä¸å¤šåšè§£é‡Šï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥ä¸Šå®˜ç½‘æŸ¥çœ‹ã€‚</p>\n<p><a href=\"https://react.docschina.org/docs/higher-order-components.html\" target=\"_blank\" rel=\"noopener\">æˆ‘æ˜¯é£æœºç¥¨ï¼ˆReact-é«˜é˜¶ç»„ä»¶ï¼‰ï¼Œç‚¹æˆ‘</a><br>ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class CustomizedForm extends React.Component &#123; ... &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; use wrappedComponentRef</span><br><span class=\"line\">const EnhancedForm &#x3D;  Form.create()(CustomizedForm);</span><br></pre></td></tr></table></figure>\n<p>æˆ–è€…</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Form.create()</span><br><span class=\"line\">class CustomizedForm extends React.Component &#123; ... &#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"è¡¨å•ä¸ç»„ä»¶çš„åŒå‘ç»‘å®š\"><a href=\"#è¡¨å•ä¸ç»„ä»¶çš„åŒå‘ç»‘å®š\" class=\"headerlink\" title=\"è¡¨å•ä¸ç»„ä»¶çš„åŒå‘ç»‘å®š\"></a>è¡¨å•ä¸ç»„ä»¶çš„åŒå‘ç»‘å®š</h4><p>ä»–çš„ç›®çš„æ˜¯å°†è¡¨å•çš„ç»„ä»¶çš„å€¼ä¸è¡¨å•ç»‘å®šã€‚æœ€åè¡¨å•å¯ä»¥ç›´æ¥å–åˆ°æŸæŸç»„ä»¶çš„å€¼ã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!-- è¡¨å•æ•°æ®ç»‘å®š --&gt;</span><br><span class=\"line\">&lt;Form.Item &#123;...formItemLayout&#125; label&#x3D;&#123;&#39;åç§°&#39;&#125;&gt;</span><br><span class=\"line\">\t&#123;getFieldDecorator(&#39;searchName&#39;)(</span><br><span class=\"line\">\t\t&lt;Input placeholder&#x3D;&#123;&#39;è¯·è¾“å…¥åç§°&#39;&#125; &#x2F;&gt;</span><br><span class=\"line\">\t)&#125;</span><br><span class=\"line\">&lt;&#x2F;Form.Item&gt;</span><br></pre></td></tr></table></figure>\n<p>è¿™ä¸ªæ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„ç»‘å®šï¼Œç»„ä»¶inputçš„å€¼éƒ½ä¼šç”±â€™searchNameâ€™è¿™ä¸ªå±æ€§æ”¶çº³ã€‚<br>å¯ä»¥ç›´æ¥å–å€¼ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åŠ å…¥è‡ªå·±çš„æ ¡éªŒè§„åˆ™ï¼Œç­‰ç­‰ã€‚è¿™é‡Œä¸å¤šåšè§£é‡Šï¼Œè¿™äº›éƒ½æ˜¯é™„åŠ çš„è¿›é˜¶åŠŸèƒ½ï¼Œè¿™é‡Œä¸å¤šåšæè¿°ã€‚</p>\n<p><a href=\"https://ant.design/components/form-cn/\" target=\"_blank\" rel=\"noopener\">æˆ‘æ˜¯é£æœºç¥¨ï¼ˆè¡¨å•è¿›é˜¶ï¼‰ï¼Œç‚¹æˆ‘ï¼</a></p>\n<h4 id=\"è¡¨å•çš„å–å€¼\"><a href=\"#è¡¨å•çš„å–å€¼\" class=\"headerlink\" title=\"è¡¨å•çš„å–å€¼\"></a>è¡¨å•çš„å–å€¼</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">this.props.form.validateFields((err, values) &#x3D;&gt; &#123;</span><br><span class=\"line\">      if (!err) &#123; &#x2F;&#x2F; è¿™é‡Œä¹Ÿå¯ä»¥ä¸è¦ï¼Œæ˜¯ç”¨äºæ ¡éªŒçš„ã€‚</span><br><span class=\"line\">        console.log(&#39;Received values of form: &#39;, values);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br></pre></td></tr></table></figure>\n<p>è¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„å–å€¼ï¼Œå½“ç„¶å¯ä»¥å®šåˆ¶çš„å–å€¼ï¼Œæˆ–è€…å®šåˆ¶çš„æ ¡éªŒï¼Œæ¯”å¦‚ï¼Œåœ¨è·å–éªŒè¯ç çš„æ—¶å€™ï¼Œä¸éœ€è¦æ ¡éªŒå¯†ç æ˜¯å¦è¾“å…¥æˆ–è€…ç¬¦åˆä½ çš„è§„åˆ™ï¼Œå°±å¯ä»¥åªæ ¡éªŒæ‰‹æœºå·ï¼Œç­‰ç­‰ã€‚è¿™é‡Œä¸å¤šåšè§£é‡Šï¼Œè¿™äº›éƒ½æ˜¯é™„åŠ çš„è¿›é˜¶åŠŸèƒ½ï¼Œè¿™é‡Œä¸å¤šåšæè¿°ã€‚</p>\n<p><a href=\"https://ant.design/components/form-cn/\" target=\"_blank\" rel=\"noopener\">æˆ‘æ˜¯é£æœºç¥¨ï¼ˆè¡¨å•è¿›é˜¶ï¼‰ï¼Œç‚¹æˆ‘ï¼</a></p>\n<p>åŸºæœ¬ä¸Šä½ æŒæ¡äº†è¿™äº›å°±å¯ä»¥è¾ƒä¸ºçµæ´»çš„ä½¿ç”¨Ant Design Formäº†ã€‚</p>\n<h2 id=\"ä½†æ˜¯ï¼åˆ’é‡ç‚¹äº†ï¼\"><a href=\"#ä½†æ˜¯ï¼åˆ’é‡ç‚¹äº†ï¼\" class=\"headerlink\" title=\"ä½†æ˜¯ï¼åˆ’é‡ç‚¹äº†ï¼\"></a>ä½†æ˜¯ï¼åˆ’é‡ç‚¹äº†ï¼</h2><p>å¦‚æœæœ‰ä¸€äº›æ›´åŠ è¿›é˜¶çš„æƒ³æ³•ã€‚è¯·çœ‹ï¼</p>\n<p><a href=\"https://blog.csdn.net/cuandeqin2083/article/details/89643390\" target=\"_blank\" rel=\"noopener\">è¡¨å•çš„è¿›é˜¶ä½¿ç”¨</a></p>\n<h1 id=\"é‡ä¸­ä¹‹é‡\"><a href=\"#é‡ä¸­ä¹‹é‡\" class=\"headerlink\" title=\"é‡ä¸­ä¹‹é‡\"></a>é‡ä¸­ä¹‹é‡</h1><p>å¦‚æœä½ è§‰å¾—è‡ªå·±æ„å»ºè¡¨å•éå¸¸éº»çƒ¦ï¼Œæˆ–è€…å¯¹è¡¨å•çš„ç†è§£è¿˜æ˜¯å¤Ÿé€å½»ï¼Œæƒ³ä¸€æ­¥åˆ°ä½æ„ä»¶è¡¨å•ï¼Œæ¨èæœ¬äººè‡ªç”¨è‡ªåˆ›ç»„ä»¶<br>ant-design-form</p>\n<p>ä¸Šé¢çš„æ–‡æ¡£éå¸¸è¯¦ç»†ï¼Œå¦‚æœæœ‰é—®é¢˜éšæ—¶å¯ä»¥ç»™æˆ‘æissuesã€‚å¦‚æœå–œæ¬¢çš„è¯éº»çƒ¦ç‚¹ä¸ªstart~</p>\n<p><a href=\"https://github.com/DerrickTel/ant-design-form\" target=\"_blank\" rel=\"noopener\">æˆ‘æ˜¯ant-design-fromçš„é£æœºç¥¨ï¼Œç‚¹æˆ‘ç‚¹æˆ‘ï¼ï¼</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Ant-Design-Form\"><a href=\"#Ant-Design-Form\" class=\"headerlink\" title=\"Ant Design Form\"></a>Ant Design Form</h2><p>Antd è¡¨å•çš„æ ¸å¿ƒæ— éæ˜¯ä»¥ä¸‹ä¸¤ç‚¹</p>\n<ol>\n<li>è¡¨å•åˆ›å»ºï¼ˆ<code>Form.create</code>ï¼‰åœ¨<code>this.props</code>å†™å…¥<code>form</code>å±æ€§</li>\n<li>è¡¨å•ä¸ç»„ä»¶çš„åŒå‘ç»‘å®šï¼ˆ<code>this.props.form.getFieldDecorator</code>ï¼‰</li>\n<li>è¡¨å•çš„å–å€¼ï¼ˆ<code>this.props.form.validateFields / this.props.form.validateFieldsAndScroll</code>ï¼‰</li>\n</ol>\n<h4 id=\"è¡¨å•åˆ›å»º\"><a href=\"#è¡¨å•åˆ›å»º\" class=\"headerlink\" title=\"è¡¨å•åˆ›å»º\"></a>è¡¨å•åˆ›å»º</h4><p><code>Form.create</code>è¿™æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œä¼ å…¥çš„æ˜¯reactç»„ä»¶ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„reactç»„ä»¶ï¼Œåœ¨å‡½æ•°å†…éƒ¨ä¼šå¯¹ä¼ å…¥ç»„ä»¶è¿›è¡Œæ”¹é€ ï¼Œæ·»åŠ ä¸Šä¸€å®šçš„æ–¹æ³•ç”¨äºè¿›è¡Œä¸€äº›ç§˜å¯†æ“ä½œ ï¼Œè¿™é‡Œä¸å¤šåšè§£é‡Šï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥ä¸Šå®˜ç½‘æŸ¥çœ‹ã€‚</p>\n<p><a href=\"https://react.docschina.org/docs/higher-order-components.html\" target=\"_blank\" rel=\"noopener\">æˆ‘æ˜¯é£æœºç¥¨ï¼ˆReact-é«˜é˜¶ç»„ä»¶ï¼‰ï¼Œç‚¹æˆ‘</a><br>ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class CustomizedForm extends React.Component &#123; ... &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; use wrappedComponentRef</span><br><span class=\"line\">const EnhancedForm &#x3D;  Form.create()(CustomizedForm);</span><br></pre></td></tr></table></figure>\n<p>æˆ–è€…</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Form.create()</span><br><span class=\"line\">class CustomizedForm extends React.Component &#123; ... &#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"è¡¨å•ä¸ç»„ä»¶çš„åŒå‘ç»‘å®š\"><a href=\"#è¡¨å•ä¸ç»„ä»¶çš„åŒå‘ç»‘å®š\" class=\"headerlink\" title=\"è¡¨å•ä¸ç»„ä»¶çš„åŒå‘ç»‘å®š\"></a>è¡¨å•ä¸ç»„ä»¶çš„åŒå‘ç»‘å®š</h4><p>ä»–çš„ç›®çš„æ˜¯å°†è¡¨å•çš„ç»„ä»¶çš„å€¼ä¸è¡¨å•ç»‘å®šã€‚æœ€åè¡¨å•å¯ä»¥ç›´æ¥å–åˆ°æŸæŸç»„ä»¶çš„å€¼ã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!-- è¡¨å•æ•°æ®ç»‘å®š --&gt;</span><br><span class=\"line\">&lt;Form.Item &#123;...formItemLayout&#125; label&#x3D;&#123;&#39;åç§°&#39;&#125;&gt;</span><br><span class=\"line\">\t&#123;getFieldDecorator(&#39;searchName&#39;)(</span><br><span class=\"line\">\t\t&lt;Input placeholder&#x3D;&#123;&#39;è¯·è¾“å…¥åç§°&#39;&#125; &#x2F;&gt;</span><br><span class=\"line\">\t)&#125;</span><br><span class=\"line\">&lt;&#x2F;Form.Item&gt;</span><br></pre></td></tr></table></figure>\n<p>è¿™ä¸ªæ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„ç»‘å®šï¼Œç»„ä»¶inputçš„å€¼éƒ½ä¼šç”±â€™searchNameâ€™è¿™ä¸ªå±æ€§æ”¶çº³ã€‚<br>å¯ä»¥ç›´æ¥å–å€¼ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åŠ å…¥è‡ªå·±çš„æ ¡éªŒè§„åˆ™ï¼Œç­‰ç­‰ã€‚è¿™é‡Œä¸å¤šåšè§£é‡Šï¼Œè¿™äº›éƒ½æ˜¯é™„åŠ çš„è¿›é˜¶åŠŸèƒ½ï¼Œè¿™é‡Œä¸å¤šåšæè¿°ã€‚</p>\n<p><a href=\"https://ant.design/components/form-cn/\" target=\"_blank\" rel=\"noopener\">æˆ‘æ˜¯é£æœºç¥¨ï¼ˆè¡¨å•è¿›é˜¶ï¼‰ï¼Œç‚¹æˆ‘ï¼</a></p>\n<h4 id=\"è¡¨å•çš„å–å€¼\"><a href=\"#è¡¨å•çš„å–å€¼\" class=\"headerlink\" title=\"è¡¨å•çš„å–å€¼\"></a>è¡¨å•çš„å–å€¼</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">this.props.form.validateFields((err, values) &#x3D;&gt; &#123;</span><br><span class=\"line\">      if (!err) &#123; &#x2F;&#x2F; è¿™é‡Œä¹Ÿå¯ä»¥ä¸è¦ï¼Œæ˜¯ç”¨äºæ ¡éªŒçš„ã€‚</span><br><span class=\"line\">        console.log(&#39;Received values of form: &#39;, values);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br></pre></td></tr></table></figure>\n<p>è¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„å–å€¼ï¼Œå½“ç„¶å¯ä»¥å®šåˆ¶çš„å–å€¼ï¼Œæˆ–è€…å®šåˆ¶çš„æ ¡éªŒï¼Œæ¯”å¦‚ï¼Œåœ¨è·å–éªŒè¯ç çš„æ—¶å€™ï¼Œä¸éœ€è¦æ ¡éªŒå¯†ç æ˜¯å¦è¾“å…¥æˆ–è€…ç¬¦åˆä½ çš„è§„åˆ™ï¼Œå°±å¯ä»¥åªæ ¡éªŒæ‰‹æœºå·ï¼Œç­‰ç­‰ã€‚è¿™é‡Œä¸å¤šåšè§£é‡Šï¼Œè¿™äº›éƒ½æ˜¯é™„åŠ çš„è¿›é˜¶åŠŸèƒ½ï¼Œè¿™é‡Œä¸å¤šåšæè¿°ã€‚</p>\n<p><a href=\"https://ant.design/components/form-cn/\" target=\"_blank\" rel=\"noopener\">æˆ‘æ˜¯é£æœºç¥¨ï¼ˆè¡¨å•è¿›é˜¶ï¼‰ï¼Œç‚¹æˆ‘ï¼</a></p>\n<p>åŸºæœ¬ä¸Šä½ æŒæ¡äº†è¿™äº›å°±å¯ä»¥è¾ƒä¸ºçµæ´»çš„ä½¿ç”¨Ant Design Formäº†ã€‚</p>\n<h2 id=\"ä½†æ˜¯ï¼åˆ’é‡ç‚¹äº†ï¼\"><a href=\"#ä½†æ˜¯ï¼åˆ’é‡ç‚¹äº†ï¼\" class=\"headerlink\" title=\"ä½†æ˜¯ï¼åˆ’é‡ç‚¹äº†ï¼\"></a>ä½†æ˜¯ï¼åˆ’é‡ç‚¹äº†ï¼</h2><p>å¦‚æœæœ‰ä¸€äº›æ›´åŠ è¿›é˜¶çš„æƒ³æ³•ã€‚è¯·çœ‹ï¼</p>\n<p><a href=\"https://blog.csdn.net/cuandeqin2083/article/details/89643390\" target=\"_blank\" rel=\"noopener\">è¡¨å•çš„è¿›é˜¶ä½¿ç”¨</a></p>\n<h1 id=\"é‡ä¸­ä¹‹é‡\"><a href=\"#é‡ä¸­ä¹‹é‡\" class=\"headerlink\" title=\"é‡ä¸­ä¹‹é‡\"></a>é‡ä¸­ä¹‹é‡</h1><p>å¦‚æœä½ è§‰å¾—è‡ªå·±æ„å»ºè¡¨å•éå¸¸éº»çƒ¦ï¼Œæˆ–è€…å¯¹è¡¨å•çš„ç†è§£è¿˜æ˜¯å¤Ÿé€å½»ï¼Œæƒ³ä¸€æ­¥åˆ°ä½æ„ä»¶è¡¨å•ï¼Œæ¨èæœ¬äººè‡ªç”¨è‡ªåˆ›ç»„ä»¶<br>ant-design-form</p>\n<p>ä¸Šé¢çš„æ–‡æ¡£éå¸¸è¯¦ç»†ï¼Œå¦‚æœæœ‰é—®é¢˜éšæ—¶å¯ä»¥ç»™æˆ‘æissuesã€‚å¦‚æœå–œæ¬¢çš„è¯éº»çƒ¦ç‚¹ä¸ªstart~</p>\n<p><a href=\"https://github.com/DerrickTel/ant-design-form\" target=\"_blank\" rel=\"noopener\">æˆ‘æ˜¯ant-design-fromçš„é£æœºç¥¨ï¼Œç‚¹æˆ‘ç‚¹æˆ‘ï¼ï¼</a></p>\n"},{"title":"HTTPH/TTPSåè®®","date":"2019-08-24T11:02:25.000Z","cover":"/image/cover/http.png","_content":"\n## åè®®\n\nç½‘ç»œåè®®æ˜¯è®¡ç®—æœºä¹‹é—´ä¸ºäº†å®ç°ç½‘ç»œé€šä¿¡è€Œè¾¾æˆçš„ä¸€ç§â€œçº¦å®šâ€æˆ–è€…â€è§„åˆ™â€œï¼Œæœ‰äº†è¿™ç§â€çº¦å®šâ€œï¼Œä¸åŒå‚å•†çš„ç”Ÿäº§è®¾å¤‡ï¼Œä»¥åŠä¸åŒæ“ä½œç³»ç»Ÿç»„æˆçš„è®¡ç®—æœºä¹‹é—´ï¼Œå°±å¯ä»¥å®ç°é€šä¿¡ã€‚\n\n### HTTPåè®®\nHTTPåè®®æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®çš„ç¼©å†™ï¼Œè‹±æ–‡æ˜¯Hyper Text Transfer Protocolã€‚å®ƒæ˜¯ä»WEBæœåŠ¡å™¨ä¼ è¾“è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€(HTML)åˆ°æœ¬åœ°æµè§ˆå™¨çš„ä¼ é€åè®®ã€‚\n\nè®¾è®¡HTTPæœ€åˆçš„ç›®çš„æ˜¯ä¸ºäº†æä¾›ä¸€ç§å‘å¸ƒå’Œæ¥æ”¶HTMLé¡µé¢çš„æ–¹æ³•ã€‚\n\nHTPPæœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œç›®å‰å¹¿æ³›ä½¿ç”¨çš„æ˜¯HTTP/1.1ç‰ˆæœ¬ã€‚\n\n## HTTP\nHTTP å…¨ç§°æ˜¯ HyperText Transfer Protocal ï¼Œå³ï¼šè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œä» 1990 å¹´å¼€å§‹å°±åœ¨ WWW ä¸Šå¹¿æ³›åº”ç”¨ï¼Œæ˜¯ç°ä»Šåœ¨ WWW ä¸Šåº”ç”¨æœ€å¤šçš„åè®®ï¼ŒHTTP æ˜¯åº”ç”¨å±‚åè®®ï¼Œå½“ä½ ä¸Šç½‘æµè§ˆç½‘é¡µçš„æ—¶å€™ï¼Œæµè§ˆå™¨å’Œ web æœåŠ¡å™¨ä¹‹é—´å°±ä¼šé€šè¿‡ HTTP åœ¨ Internet ä¸Šè¿›è¡Œæ•°æ®çš„å‘é€å’Œæ¥æ”¶ã€‚HTTP æ˜¯ä¸€ä¸ªåŸºäºè¯·æ±‚/å“åº”æ¨¡å¼çš„ã€æ— çŠ¶æ€çš„åè®®ã€‚å³æˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„ Request/Response\n\n### HTTPåŸç†\n\nHTTPæ˜¯ä¸€ä¸ªåŸºäºTCP/IPé€šä¿¡åè®®æ¥ä¼ é€’æ•°æ®çš„åè®®ï¼Œä¼ è¾“çš„æ•°æ®ç±»å‹ä¸ºHTML æ–‡ä»¶,ã€å›¾ç‰‡æ–‡ä»¶, æŸ¥è¯¢ç»“æœç­‰ã€‚\n\nHTTPåè®®ä¸€èˆ¬ç”¨äºB/Sæ¶æ„ï¼ˆï¼‰ã€‚æµè§ˆå™¨ä½œä¸ºHTTPå®¢æˆ·ç«¯é€šè¿‡URLå‘HTTPæœåŠ¡ç«¯å³WEBæœåŠ¡å™¨å‘é€æ‰€æœ‰è¯·æ±‚ã€‚\n\n### HTTPåè®®\n\nHTTPåè®®æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®çš„ç¼©å†™ï¼Œè‹±æ–‡æ˜¯Hyper Text Transfer Protocolã€‚å®ƒæ˜¯ä»WEBæœåŠ¡å™¨ä¼ è¾“è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€(HTML)åˆ°æœ¬åœ°æµè§ˆå™¨çš„ä¼ é€åè®®ã€‚\n\nè®¾è®¡HTTPæœ€åˆçš„ç›®çš„æ˜¯ä¸ºäº†æä¾›ä¸€ç§å‘å¸ƒå’Œæ¥æ”¶HTMLé¡µé¢çš„æ–¹æ³•ã€‚\n\nHTPPæœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œç›®å‰å¹¿æ³›ä½¿ç”¨çš„æ˜¯HTTP/1.1ç‰ˆæœ¬ã€‚\n\n### HTTPç‰¹ç‚¹\n\n - æ”¯æŒå®¢æˆ·ç«¯/æœåŠ¡å™¨æ¨¡å¼\n - ç®€å•å¿«é€Ÿï¼šå®¢æˆ·å‘æœåŠ¡å™¨è¯·æ±‚æœåŠ¡æ—¶ï¼Œåªéœ€ä¼ é€è¯·æ±‚æ–¹æ³•å’Œè·¯å¾„ã€‚ç”±äº HTTP åè®®ç®€å•ï¼Œä½¿å¾— HTTP æœåŠ¡å™¨çš„ç¨‹åºè§„æ¨¡å°ï¼Œå› è€Œé€šä¿¡é€Ÿåº¦å¾ˆå¿«\n - çµæ´»ï¼šHTTP å…è®¸ä¼ è¾“ä»»æ„ç±»å‹çš„æ•°æ®å¯¹è±¡ã€‚æ­£åœ¨ä¼ è¾“çš„ç±»å‹ç”± Content-Type åŠ ä»¥æ ‡è®°\n - æ— è¿æ¥ï¼šæ— è¿æ¥çš„å«ä¹‰æ˜¯é™åˆ¶æ¯æ¬¡é“¾æ¥åªå¤„ç†ä¸€ä¸ªè¯·æ±‚ã€‚æœåŠ¡å™¨å¤„ç†å®Œå®¢æˆ·çš„è¯·æ±‚ï¼Œå¹¶æ”¶åˆ°å®¢æˆ·çš„åº”ç­”åï¼Œå³æ–­å¼€é“¾æ¥ï¼Œé‡‡ç”¨è¿™ç§æ–¹å¼å¯ä»¥èŠ‚çœä¼ è¾“æ—¶é—´\n - æ— çŠ¶æ€ï¼šHTTP åè®®æ˜¯æ— çŠ¶æ€åè®®ã€‚æ— çŠ¶æ€æ˜¯æŒ‡åè®®å¯¹äºäº‹ç‰©å¤„ç†æ²¡æœ‰è®°å¿†èƒ½åŠ›ã€‚ç¼ºå°‘çŠ¶æ€æ„å‘³ç€å¦‚æœåç»­å¤„ç†éœ€è¦å‰é¢çš„ä¿¡æ¯ï¼Œåˆ™å®ƒå¿…é¡»é‡ä¼ ï¼Œè¿™æ ·å¯èƒ½ä¼šå¯¼è‡´æ¯æ¬¡è¿æ¥ä¼ é€çš„æ•°æ®é‡å¢å¤§ã€‚å¦ä¸€æ–¹é¢ï¼Œåœ¨æœåŠ¡å™¨ä¸éœ€è¦å…ˆå‰ä¿¡æ¯æ—¶å®ƒçš„åº”ç­”å°±æ¯”è¾ƒå¿«\n\n## HTTPS\nHTTPS åè®®ï¼ˆHyperText Transfer Protocol over Secure Socket Layerï¼‰ï¼šä¸€èˆ¬ç†è§£ä¸ºHTTP+SSL/TLSï¼Œé€šè¿‡ SSLè¯ä¹¦æ¥éªŒè¯æœåŠ¡å™¨çš„èº«ä»½ï¼Œå¹¶ä¸ºæµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡è¿›è¡ŒåŠ å¯†ã€‚\n\nè§£å†³HTTPçš„ä¸€äº›é—®é¢˜\n - è¯·æ±‚ä¿¡æ¯æ˜æ–‡ä¼ è¾“ï¼Œå®¹æ˜“è¢«çªƒå¬æˆªå–ã€‚\n - æ•°æ®çš„å®Œæ•´æ€§æœªæ ¡éªŒï¼Œå®¹æ˜“è¢«ç¯¡æ”¹\n - æ²¡æœ‰éªŒè¯å¯¹æ–¹èº«ä»½ï¼Œå­˜åœ¨å†’å……å±é™©\n\n\n## æ€»ç»“HTTPSå’ŒHTTPçš„åŒºåˆ«\n\n - HTTPSæ˜¯HTTPåè®®çš„å®‰å…¨ç‰ˆæœ¬ï¼ŒHTTPåè®®çš„æ•°æ®ä¼ è¾“æ˜¯æ˜æ–‡çš„ï¼Œæ˜¯ä¸å®‰å…¨çš„ï¼ŒHTTPSä½¿ç”¨äº†SSL/TLSåè®®è¿›è¡Œäº†åŠ å¯†å¤„ç†ã€‚\n - httpå’Œhttpsä½¿ç”¨è¿æ¥æ–¹å¼ä¸åŒï¼Œé»˜è®¤ç«¯å£ä¹Ÿä¸ä¸€æ ·ï¼Œhttpæ˜¯80ï¼Œhttpsæ˜¯443ã€‚\n\n## URLè¯¦è§£\n\nURLï¼ˆUniform Resource Locatorï¼‰æ˜¯ç»Ÿä¸€èµ„æºå®šä½ç¬¦çš„ç®€ç§°ï¼Œæœ‰æ—¶å€™ä¹Ÿè¢«ä¿—ç§°ä¸ºç½‘é¡µåœ°å€ï¼ˆç½‘å€ï¼‰ï¼Œå¦‚åŒæ˜¯ç½‘ç»œä¸Šçš„é—¨ç‰Œï¼Œæ˜¯å› ç‰¹ç½‘ä¸Šæ ‡å‡†çš„èµ„æºçš„åœ°å€\n\n### åŸºæœ¬ç»„æˆ\n\n| åç§°         | åŠŸèƒ½                                                         |\n| ------------ | ------------------------------------------------------------ |\n| scheme       | è®¿é—®æœåŠ¡å™¨ä»¥è·å–èµ„æºæ—¶è¦ä½¿ç”¨å“ªç§åè®®ï¼Œæ¯”å¦‚ï¼Œhttpï¼Œhttps å’Œ FTP ç­‰ |\n| host         | HTTP æœåŠ¡å™¨çš„ IP åœ°å€æˆ–åŸŸå                                  |\n| port#        | HTTP æœåŠ¡å™¨çš„é»˜è®¤ç«¯å£æ˜¯ 80ï¼Œè¿™ç§æƒ…å†µä¸‹ç«¯å£å·å¯ä»¥çœç•¥ï¼Œå¦‚æœä½¿ç”¨äº†åˆ«çš„ç«¯å£ï¼Œå¿…é¡»æŒ‡æ˜ï¼Œä¾‹å¦‚www.cnblogs.comï¼š8080 |\n| path         | è®¿é—®èµ„æºçš„è·¯å¾„                                               |\n| query-string | å‘ç»™ http æœåŠ¡å™¨çš„æ•°æ®                                       |\n| anchor       | é”š                                                           |\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/httpHttps/15fc2525666dc96e.jpg)\n\n## HTTPè¯·æ±‚\n### ç±»å‹\n| åç§°    | åŠŸèƒ½                                                         |\n| ------- | ------------------------------------------------------------ |\n| GET     | å‘æŒ‡å®šçš„èµ„æºå‘å‡ºâ€œæ˜¾ç¤ºâ€è¯·æ±‚ï¼Œä½¿ç”¨ GET æ–¹æ³•åº”è¯¥åªç”¨åœ¨è¯»å–æ•°æ®ä¸Šï¼Œè€Œä¸åº”è¯¥ç”¨äºäº§ç”Ÿâ€œå‰¯ä½œç”¨â€çš„æ“ä½œä¸­ |\n| POST    | æŒ‡å®šèµ„æºæäº¤æ•°æ®ï¼Œè¯·æ±‚æœåŠ¡å™¨è¿›è¡Œå¤„ç†ï¼ˆä¾‹å¦‚æäº¤è¡¨å•æˆ–è€…ä¸Šä¼ æ–‡ä»¶ï¼‰ã€‚æ•°æ®è¢«åŒ…å«åœ¨è¯·æ±‚æ–‡æœ¬ä¸­ã€‚è¿™ä¸ªè¯·æ±‚å¯èƒ½ä¼šåˆ›å»ºæ–°çš„èµ„æºæˆ–è€…ä¿®æ”¹ç°æœ‰èµ„æºï¼Œæˆ–ä¸¤è€…çš†æœ‰ã€‚ |\n| PUT     | å‘æŒ‡å®šèµ„æºä½ç½®ä¸Šä¼ å…¶æœ€æ–°å†…å®¹                                 |\n| DELETE  | è¯·æ±‚æœåŠ¡å™¨åˆ é™¤ Request-URI æ‰€æ ‡è¯†çš„èµ„æº                      |\n| OPTIONS | ä½¿æœåŠ¡å™¨ä¼ å›è¯¥èµ„æºæ‰€æ”¯æŒçš„æ‰€æœ‰HTTPè¯·æ±‚æ–¹æ³•ã€‚ç”¨*æ¥ä»£æ›¿èµ„æºåç§°ï¼Œå‘ Web æœåŠ¡å™¨å‘é€ OPTIONS è¯·æ±‚ï¼Œå¯ä»¥æµ‹è¯•æœåŠ¡å™¨åŠŸèƒ½æ˜¯å¦æ­£å¸¸è¿ä½œ |\n| HEAD    | ä¸ GET æ–¹æ³•ä¸€æ ·ï¼Œéƒ½æ˜¯å‘æœåŠ¡å™¨å‘å‡ºæŒ‡å®šèµ„æºçš„è¯·æ±‚ï¼Œåªä¸è¿‡æœåŠ¡å™¨å°†ä¸ä¼ å›èµ„æºçš„æœ¬æ–‡éƒ¨åˆ†ï¼Œå®ƒçš„å¥½å¤„åœ¨äºï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥åœ¨ä¸å¿…ä¼ è¾“å…¨éƒ¨å†…å®¹çš„æƒ…å†µä¸‹ï¼Œå°±å¯ä»¥è·å–å…¶ä¸­å…³äºè¯¥èµ„æºçš„ä¿¡æ¯ï¼ˆåŸä¿¡æ¯æˆ–ç§°å…ƒæ•°æ®ï¼‰ |\n| TRACE   | æ˜¾ç¤ºæœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚ï¼Œä¸»è¦ç”¨äºæµ‹è¯•æˆ–è¯Šæ–­                     |\n| CONNECT | HTTP/1.1 ä¸­é¢„ç•™ç»™èƒ½å¤Ÿå°†è¿æ¥æ”¹ä¸ºé€šé“æ–¹å¼çš„ä»£ç†æœåŠ¡å™¨ã€‚é€šå¸¸ç”¨äº SSL åŠ å¯†æœåŠ¡å™¨çš„é“¾æ¥ï¼ˆç»ç”±éåŠ å¯†çš„ HTTP ä»£ç†æœåŠ¡å™¨ï¼‰ |\n\nå…¶ä¸­ï¼Œæœ€å¸¸è§çš„æ˜¯ GET å’Œ POST æ–¹æ³•ï¼Œå¦‚æœæ˜¯ RESful æ¥å£çš„è¯ä¸€èˆ¬ä¼šç”¨åˆ° PUTã€DELETEã€GETã€POSTï¼ˆåˆ†åˆ«å¯¹åº”å¢åˆ æŸ¥æ”¹\n\n### è¯·æ±‚å¤´\n| åç§°              | åŠŸèƒ½                                                         |\n| ----------------- | ------------------------------------------------------------ |\n| Authorization     | ç”¨äºè®¾ç½®èº«ä»½è®¤è¯ä¿¡æ¯                                         |\n| User-Agent        | ç”¨æˆ·æ ‡è¯†ï¼Œå¦‚ï¼šOS å’Œæµè§ˆå™¨çš„ç±»å‹å’Œç‰ˆæœ¬                        |\n| If-Modified-Since | å€¼ä¸ºä¸Šä¸€æ¬¡æœåŠ¡å™¨è¿”å›çš„Last-Modifiedå€¼ï¼Œç”¨äºç¡®å®šæŸä¸ªèµ„æºæ˜¯å¦è¢«æ›´æ”¹è¿‡ï¼Œæ²¡æœ‰æ›´æ”¹è¿‡å°±ä»ç¼“å­˜ä¸­è¯»å– |\n| If-None-Match     | å€¼ä¸ºä¸Šä¸€æ¬¡æœåŠ¡å™¨è¿”å›çš„ ETag å€¼ï¼Œä¸€èˆ¬ä¼šå’ŒIf-Modified-Since    |\n| Cookie            | å·²æœ‰çš„Cookie                                                 |\n| Referer           | æ ‡è¯†è¯·æ±‚å¼•ç”¨è‡ªå“ªä¸ªåœ°å€ï¼Œæ¯”å¦‚ä½ ä»é¡µé¢ A è·³è½¬åˆ°é¡µé¢ B æ—¶ï¼Œå€¼ä¸ºé¡µé¢ A çš„åœ°å€ |\n| Host              | è¯·æ±‚çš„ä¸»æœºå’Œç«¯å£å·                                           |\n\n### çŠ¶æ€ç \n| çŠ¶æ€ç  | å¯¹åº”çš„ä¿¡æ¯                                                   |\n| ------ | ------------------------------------------------------------ |\n| 1XX    | æç¤ºä¿¡æ¯â€”è¡¨ç¤ºè¯·æ±‚å·²æ¥æ”¶ï¼Œç»§ç»­å¤„ç†                            |\n| 2XX    | ç”¨äºè¡¨ç¤ºè¯·æ±‚å·²è¢«æˆåŠŸæ¥æ”¶ã€ç†è§£ã€æ¥æ”¶                         |\n| 3XX    | ç”¨äºè¡¨ç¤ºèµ„æºï¼ˆç½‘é¡µç­‰ï¼‰è¢«æ°¸ä¹…è½¬ç§»åˆ°å…¶å®ƒ URLï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„é‡å®šå‘ |\n| 4XX    | å®¢æˆ·ç«¯é”™è¯¯â€”è¯·æ±‚æœ‰è¯­æ³•é”™è¯¯æˆ–è€…è¯·æ±‚æ— æ³•å®ç°                    |\n| 5XX    | æœåŠ¡å™¨ç«¯é”™è¯¯â€”æœåŠ¡å™¨æœªèƒ½å®ç°åˆæ³•çš„è¯·æ±‚                        |\n\n### å“åº”å¤´\n| åç§°              | åŠŸèƒ½                                                         |\n| ----------------- | ------------------------------------------------------------ |\n| Date              | æœåŠ¡å™¨çš„æ—¥æœŸ                                                 |\n| Last-Modified     | è¯¥èµ„æºæœ€åè¢«ä¿®æ”¹çš„æ—¶é—´                                       |\n| Transfer-Encoding | å–å€¼ä¸€èˆ¬ä¸º chunkedï¼Œå‡ºç°åœ¨ Content-Length ä¸èƒ½ç¡®å®šçš„æƒ…å†µä¸‹ï¼Œè¡¨ç¤ºæœåŠ¡å™¨ä¸çŸ¥é“å“åº”æ¿ä½“çš„æ•°æ®å¤§å°ï¼Œä¸€èˆ¬åŒæ—¶å‡ºç°Content-Encodingå“åº”å¤´ |\n| Set-Cookie        | è®¾ç½® Cookie                                                  |\n| Location          | é‡å®šå‘åˆ°å¦ä¸€ä¸ª URLï¼Œå¦‚è¾“å…¥æµè§ˆå™¨å°±è¾“å…¥ baidu.com å›è½¦ï¼Œä¼šè‡ªåŠ¨è·³è½¬åˆ°www.baidu.com å°±æ˜¯é€šè¿‡è¿™ä¸ªå“åº”å¤´æ§åˆ¶çš„ |\n| Server            | åå°æœåŠ¡å™¨                                                   |\n\n>  Reference \n>  https://zhuanlan.zhihu.com/p/72616216\n>  https://juejin.im/post/5a0ce1d95188253e24708454","source":"_posts/HTTPHTTPSåè®®.md","raw":"---\ntitle: HTTPH/TTPSåè®®\ndate: 2019-08-24 19:02:25\ntags: [HTTP]\ncategories: [HTTP]\ncover: /image/cover/http.png\n---\n\n## åè®®\n\nç½‘ç»œåè®®æ˜¯è®¡ç®—æœºä¹‹é—´ä¸ºäº†å®ç°ç½‘ç»œé€šä¿¡è€Œè¾¾æˆçš„ä¸€ç§â€œçº¦å®šâ€æˆ–è€…â€è§„åˆ™â€œï¼Œæœ‰äº†è¿™ç§â€çº¦å®šâ€œï¼Œä¸åŒå‚å•†çš„ç”Ÿäº§è®¾å¤‡ï¼Œä»¥åŠä¸åŒæ“ä½œç³»ç»Ÿç»„æˆçš„è®¡ç®—æœºä¹‹é—´ï¼Œå°±å¯ä»¥å®ç°é€šä¿¡ã€‚\n\n### HTTPåè®®\nHTTPåè®®æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®çš„ç¼©å†™ï¼Œè‹±æ–‡æ˜¯Hyper Text Transfer Protocolã€‚å®ƒæ˜¯ä»WEBæœåŠ¡å™¨ä¼ è¾“è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€(HTML)åˆ°æœ¬åœ°æµè§ˆå™¨çš„ä¼ é€åè®®ã€‚\n\nè®¾è®¡HTTPæœ€åˆçš„ç›®çš„æ˜¯ä¸ºäº†æä¾›ä¸€ç§å‘å¸ƒå’Œæ¥æ”¶HTMLé¡µé¢çš„æ–¹æ³•ã€‚\n\nHTPPæœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œç›®å‰å¹¿æ³›ä½¿ç”¨çš„æ˜¯HTTP/1.1ç‰ˆæœ¬ã€‚\n\n## HTTP\nHTTP å…¨ç§°æ˜¯ HyperText Transfer Protocal ï¼Œå³ï¼šè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œä» 1990 å¹´å¼€å§‹å°±åœ¨ WWW ä¸Šå¹¿æ³›åº”ç”¨ï¼Œæ˜¯ç°ä»Šåœ¨ WWW ä¸Šåº”ç”¨æœ€å¤šçš„åè®®ï¼ŒHTTP æ˜¯åº”ç”¨å±‚åè®®ï¼Œå½“ä½ ä¸Šç½‘æµè§ˆç½‘é¡µçš„æ—¶å€™ï¼Œæµè§ˆå™¨å’Œ web æœåŠ¡å™¨ä¹‹é—´å°±ä¼šé€šè¿‡ HTTP åœ¨ Internet ä¸Šè¿›è¡Œæ•°æ®çš„å‘é€å’Œæ¥æ”¶ã€‚HTTP æ˜¯ä¸€ä¸ªåŸºäºè¯·æ±‚/å“åº”æ¨¡å¼çš„ã€æ— çŠ¶æ€çš„åè®®ã€‚å³æˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„ Request/Response\n\n### HTTPåŸç†\n\nHTTPæ˜¯ä¸€ä¸ªåŸºäºTCP/IPé€šä¿¡åè®®æ¥ä¼ é€’æ•°æ®çš„åè®®ï¼Œä¼ è¾“çš„æ•°æ®ç±»å‹ä¸ºHTML æ–‡ä»¶,ã€å›¾ç‰‡æ–‡ä»¶, æŸ¥è¯¢ç»“æœç­‰ã€‚\n\nHTTPåè®®ä¸€èˆ¬ç”¨äºB/Sæ¶æ„ï¼ˆï¼‰ã€‚æµè§ˆå™¨ä½œä¸ºHTTPå®¢æˆ·ç«¯é€šè¿‡URLå‘HTTPæœåŠ¡ç«¯å³WEBæœåŠ¡å™¨å‘é€æ‰€æœ‰è¯·æ±‚ã€‚\n\n### HTTPåè®®\n\nHTTPåè®®æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®çš„ç¼©å†™ï¼Œè‹±æ–‡æ˜¯Hyper Text Transfer Protocolã€‚å®ƒæ˜¯ä»WEBæœåŠ¡å™¨ä¼ è¾“è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€(HTML)åˆ°æœ¬åœ°æµè§ˆå™¨çš„ä¼ é€åè®®ã€‚\n\nè®¾è®¡HTTPæœ€åˆçš„ç›®çš„æ˜¯ä¸ºäº†æä¾›ä¸€ç§å‘å¸ƒå’Œæ¥æ”¶HTMLé¡µé¢çš„æ–¹æ³•ã€‚\n\nHTPPæœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œç›®å‰å¹¿æ³›ä½¿ç”¨çš„æ˜¯HTTP/1.1ç‰ˆæœ¬ã€‚\n\n### HTTPç‰¹ç‚¹\n\n - æ”¯æŒå®¢æˆ·ç«¯/æœåŠ¡å™¨æ¨¡å¼\n - ç®€å•å¿«é€Ÿï¼šå®¢æˆ·å‘æœåŠ¡å™¨è¯·æ±‚æœåŠ¡æ—¶ï¼Œåªéœ€ä¼ é€è¯·æ±‚æ–¹æ³•å’Œè·¯å¾„ã€‚ç”±äº HTTP åè®®ç®€å•ï¼Œä½¿å¾— HTTP æœåŠ¡å™¨çš„ç¨‹åºè§„æ¨¡å°ï¼Œå› è€Œé€šä¿¡é€Ÿåº¦å¾ˆå¿«\n - çµæ´»ï¼šHTTP å…è®¸ä¼ è¾“ä»»æ„ç±»å‹çš„æ•°æ®å¯¹è±¡ã€‚æ­£åœ¨ä¼ è¾“çš„ç±»å‹ç”± Content-Type åŠ ä»¥æ ‡è®°\n - æ— è¿æ¥ï¼šæ— è¿æ¥çš„å«ä¹‰æ˜¯é™åˆ¶æ¯æ¬¡é“¾æ¥åªå¤„ç†ä¸€ä¸ªè¯·æ±‚ã€‚æœåŠ¡å™¨å¤„ç†å®Œå®¢æˆ·çš„è¯·æ±‚ï¼Œå¹¶æ”¶åˆ°å®¢æˆ·çš„åº”ç­”åï¼Œå³æ–­å¼€é“¾æ¥ï¼Œé‡‡ç”¨è¿™ç§æ–¹å¼å¯ä»¥èŠ‚çœä¼ è¾“æ—¶é—´\n - æ— çŠ¶æ€ï¼šHTTP åè®®æ˜¯æ— çŠ¶æ€åè®®ã€‚æ— çŠ¶æ€æ˜¯æŒ‡åè®®å¯¹äºäº‹ç‰©å¤„ç†æ²¡æœ‰è®°å¿†èƒ½åŠ›ã€‚ç¼ºå°‘çŠ¶æ€æ„å‘³ç€å¦‚æœåç»­å¤„ç†éœ€è¦å‰é¢çš„ä¿¡æ¯ï¼Œåˆ™å®ƒå¿…é¡»é‡ä¼ ï¼Œè¿™æ ·å¯èƒ½ä¼šå¯¼è‡´æ¯æ¬¡è¿æ¥ä¼ é€çš„æ•°æ®é‡å¢å¤§ã€‚å¦ä¸€æ–¹é¢ï¼Œåœ¨æœåŠ¡å™¨ä¸éœ€è¦å…ˆå‰ä¿¡æ¯æ—¶å®ƒçš„åº”ç­”å°±æ¯”è¾ƒå¿«\n\n## HTTPS\nHTTPS åè®®ï¼ˆHyperText Transfer Protocol over Secure Socket Layerï¼‰ï¼šä¸€èˆ¬ç†è§£ä¸ºHTTP+SSL/TLSï¼Œé€šè¿‡ SSLè¯ä¹¦æ¥éªŒè¯æœåŠ¡å™¨çš„èº«ä»½ï¼Œå¹¶ä¸ºæµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡è¿›è¡ŒåŠ å¯†ã€‚\n\nè§£å†³HTTPçš„ä¸€äº›é—®é¢˜\n - è¯·æ±‚ä¿¡æ¯æ˜æ–‡ä¼ è¾“ï¼Œå®¹æ˜“è¢«çªƒå¬æˆªå–ã€‚\n - æ•°æ®çš„å®Œæ•´æ€§æœªæ ¡éªŒï¼Œå®¹æ˜“è¢«ç¯¡æ”¹\n - æ²¡æœ‰éªŒè¯å¯¹æ–¹èº«ä»½ï¼Œå­˜åœ¨å†’å……å±é™©\n\n\n## æ€»ç»“HTTPSå’ŒHTTPçš„åŒºåˆ«\n\n - HTTPSæ˜¯HTTPåè®®çš„å®‰å…¨ç‰ˆæœ¬ï¼ŒHTTPåè®®çš„æ•°æ®ä¼ è¾“æ˜¯æ˜æ–‡çš„ï¼Œæ˜¯ä¸å®‰å…¨çš„ï¼ŒHTTPSä½¿ç”¨äº†SSL/TLSåè®®è¿›è¡Œäº†åŠ å¯†å¤„ç†ã€‚\n - httpå’Œhttpsä½¿ç”¨è¿æ¥æ–¹å¼ä¸åŒï¼Œé»˜è®¤ç«¯å£ä¹Ÿä¸ä¸€æ ·ï¼Œhttpæ˜¯80ï¼Œhttpsæ˜¯443ã€‚\n\n## URLè¯¦è§£\n\nURLï¼ˆUniform Resource Locatorï¼‰æ˜¯ç»Ÿä¸€èµ„æºå®šä½ç¬¦çš„ç®€ç§°ï¼Œæœ‰æ—¶å€™ä¹Ÿè¢«ä¿—ç§°ä¸ºç½‘é¡µåœ°å€ï¼ˆç½‘å€ï¼‰ï¼Œå¦‚åŒæ˜¯ç½‘ç»œä¸Šçš„é—¨ç‰Œï¼Œæ˜¯å› ç‰¹ç½‘ä¸Šæ ‡å‡†çš„èµ„æºçš„åœ°å€\n\n### åŸºæœ¬ç»„æˆ\n\n| åç§°         | åŠŸèƒ½                                                         |\n| ------------ | ------------------------------------------------------------ |\n| scheme       | è®¿é—®æœåŠ¡å™¨ä»¥è·å–èµ„æºæ—¶è¦ä½¿ç”¨å“ªç§åè®®ï¼Œæ¯”å¦‚ï¼Œhttpï¼Œhttps å’Œ FTP ç­‰ |\n| host         | HTTP æœåŠ¡å™¨çš„ IP åœ°å€æˆ–åŸŸå                                  |\n| port#        | HTTP æœåŠ¡å™¨çš„é»˜è®¤ç«¯å£æ˜¯ 80ï¼Œè¿™ç§æƒ…å†µä¸‹ç«¯å£å·å¯ä»¥çœç•¥ï¼Œå¦‚æœä½¿ç”¨äº†åˆ«çš„ç«¯å£ï¼Œå¿…é¡»æŒ‡æ˜ï¼Œä¾‹å¦‚www.cnblogs.comï¼š8080 |\n| path         | è®¿é—®èµ„æºçš„è·¯å¾„                                               |\n| query-string | å‘ç»™ http æœåŠ¡å™¨çš„æ•°æ®                                       |\n| anchor       | é”š                                                           |\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/httpHttps/15fc2525666dc96e.jpg)\n\n## HTTPè¯·æ±‚\n### ç±»å‹\n| åç§°    | åŠŸèƒ½                                                         |\n| ------- | ------------------------------------------------------------ |\n| GET     | å‘æŒ‡å®šçš„èµ„æºå‘å‡ºâ€œæ˜¾ç¤ºâ€è¯·æ±‚ï¼Œä½¿ç”¨ GET æ–¹æ³•åº”è¯¥åªç”¨åœ¨è¯»å–æ•°æ®ä¸Šï¼Œè€Œä¸åº”è¯¥ç”¨äºäº§ç”Ÿâ€œå‰¯ä½œç”¨â€çš„æ“ä½œä¸­ |\n| POST    | æŒ‡å®šèµ„æºæäº¤æ•°æ®ï¼Œè¯·æ±‚æœåŠ¡å™¨è¿›è¡Œå¤„ç†ï¼ˆä¾‹å¦‚æäº¤è¡¨å•æˆ–è€…ä¸Šä¼ æ–‡ä»¶ï¼‰ã€‚æ•°æ®è¢«åŒ…å«åœ¨è¯·æ±‚æ–‡æœ¬ä¸­ã€‚è¿™ä¸ªè¯·æ±‚å¯èƒ½ä¼šåˆ›å»ºæ–°çš„èµ„æºæˆ–è€…ä¿®æ”¹ç°æœ‰èµ„æºï¼Œæˆ–ä¸¤è€…çš†æœ‰ã€‚ |\n| PUT     | å‘æŒ‡å®šèµ„æºä½ç½®ä¸Šä¼ å…¶æœ€æ–°å†…å®¹                                 |\n| DELETE  | è¯·æ±‚æœåŠ¡å™¨åˆ é™¤ Request-URI æ‰€æ ‡è¯†çš„èµ„æº                      |\n| OPTIONS | ä½¿æœåŠ¡å™¨ä¼ å›è¯¥èµ„æºæ‰€æ”¯æŒçš„æ‰€æœ‰HTTPè¯·æ±‚æ–¹æ³•ã€‚ç”¨*æ¥ä»£æ›¿èµ„æºåç§°ï¼Œå‘ Web æœåŠ¡å™¨å‘é€ OPTIONS è¯·æ±‚ï¼Œå¯ä»¥æµ‹è¯•æœåŠ¡å™¨åŠŸèƒ½æ˜¯å¦æ­£å¸¸è¿ä½œ |\n| HEAD    | ä¸ GET æ–¹æ³•ä¸€æ ·ï¼Œéƒ½æ˜¯å‘æœåŠ¡å™¨å‘å‡ºæŒ‡å®šèµ„æºçš„è¯·æ±‚ï¼Œåªä¸è¿‡æœåŠ¡å™¨å°†ä¸ä¼ å›èµ„æºçš„æœ¬æ–‡éƒ¨åˆ†ï¼Œå®ƒçš„å¥½å¤„åœ¨äºï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥åœ¨ä¸å¿…ä¼ è¾“å…¨éƒ¨å†…å®¹çš„æƒ…å†µä¸‹ï¼Œå°±å¯ä»¥è·å–å…¶ä¸­å…³äºè¯¥èµ„æºçš„ä¿¡æ¯ï¼ˆåŸä¿¡æ¯æˆ–ç§°å…ƒæ•°æ®ï¼‰ |\n| TRACE   | æ˜¾ç¤ºæœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚ï¼Œä¸»è¦ç”¨äºæµ‹è¯•æˆ–è¯Šæ–­                     |\n| CONNECT | HTTP/1.1 ä¸­é¢„ç•™ç»™èƒ½å¤Ÿå°†è¿æ¥æ”¹ä¸ºé€šé“æ–¹å¼çš„ä»£ç†æœåŠ¡å™¨ã€‚é€šå¸¸ç”¨äº SSL åŠ å¯†æœåŠ¡å™¨çš„é“¾æ¥ï¼ˆç»ç”±éåŠ å¯†çš„ HTTP ä»£ç†æœåŠ¡å™¨ï¼‰ |\n\nå…¶ä¸­ï¼Œæœ€å¸¸è§çš„æ˜¯ GET å’Œ POST æ–¹æ³•ï¼Œå¦‚æœæ˜¯ RESful æ¥å£çš„è¯ä¸€èˆ¬ä¼šç”¨åˆ° PUTã€DELETEã€GETã€POSTï¼ˆåˆ†åˆ«å¯¹åº”å¢åˆ æŸ¥æ”¹\n\n### è¯·æ±‚å¤´\n| åç§°              | åŠŸèƒ½                                                         |\n| ----------------- | ------------------------------------------------------------ |\n| Authorization     | ç”¨äºè®¾ç½®èº«ä»½è®¤è¯ä¿¡æ¯                                         |\n| User-Agent        | ç”¨æˆ·æ ‡è¯†ï¼Œå¦‚ï¼šOS å’Œæµè§ˆå™¨çš„ç±»å‹å’Œç‰ˆæœ¬                        |\n| If-Modified-Since | å€¼ä¸ºä¸Šä¸€æ¬¡æœåŠ¡å™¨è¿”å›çš„Last-Modifiedå€¼ï¼Œç”¨äºç¡®å®šæŸä¸ªèµ„æºæ˜¯å¦è¢«æ›´æ”¹è¿‡ï¼Œæ²¡æœ‰æ›´æ”¹è¿‡å°±ä»ç¼“å­˜ä¸­è¯»å– |\n| If-None-Match     | å€¼ä¸ºä¸Šä¸€æ¬¡æœåŠ¡å™¨è¿”å›çš„ ETag å€¼ï¼Œä¸€èˆ¬ä¼šå’ŒIf-Modified-Since    |\n| Cookie            | å·²æœ‰çš„Cookie                                                 |\n| Referer           | æ ‡è¯†è¯·æ±‚å¼•ç”¨è‡ªå“ªä¸ªåœ°å€ï¼Œæ¯”å¦‚ä½ ä»é¡µé¢ A è·³è½¬åˆ°é¡µé¢ B æ—¶ï¼Œå€¼ä¸ºé¡µé¢ A çš„åœ°å€ |\n| Host              | è¯·æ±‚çš„ä¸»æœºå’Œç«¯å£å·                                           |\n\n### çŠ¶æ€ç \n| çŠ¶æ€ç  | å¯¹åº”çš„ä¿¡æ¯                                                   |\n| ------ | ------------------------------------------------------------ |\n| 1XX    | æç¤ºä¿¡æ¯â€”è¡¨ç¤ºè¯·æ±‚å·²æ¥æ”¶ï¼Œç»§ç»­å¤„ç†                            |\n| 2XX    | ç”¨äºè¡¨ç¤ºè¯·æ±‚å·²è¢«æˆåŠŸæ¥æ”¶ã€ç†è§£ã€æ¥æ”¶                         |\n| 3XX    | ç”¨äºè¡¨ç¤ºèµ„æºï¼ˆç½‘é¡µç­‰ï¼‰è¢«æ°¸ä¹…è½¬ç§»åˆ°å…¶å®ƒ URLï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„é‡å®šå‘ |\n| 4XX    | å®¢æˆ·ç«¯é”™è¯¯â€”è¯·æ±‚æœ‰è¯­æ³•é”™è¯¯æˆ–è€…è¯·æ±‚æ— æ³•å®ç°                    |\n| 5XX    | æœåŠ¡å™¨ç«¯é”™è¯¯â€”æœåŠ¡å™¨æœªèƒ½å®ç°åˆæ³•çš„è¯·æ±‚                        |\n\n### å“åº”å¤´\n| åç§°              | åŠŸèƒ½                                                         |\n| ----------------- | ------------------------------------------------------------ |\n| Date              | æœåŠ¡å™¨çš„æ—¥æœŸ                                                 |\n| Last-Modified     | è¯¥èµ„æºæœ€åè¢«ä¿®æ”¹çš„æ—¶é—´                                       |\n| Transfer-Encoding | å–å€¼ä¸€èˆ¬ä¸º chunkedï¼Œå‡ºç°åœ¨ Content-Length ä¸èƒ½ç¡®å®šçš„æƒ…å†µä¸‹ï¼Œè¡¨ç¤ºæœåŠ¡å™¨ä¸çŸ¥é“å“åº”æ¿ä½“çš„æ•°æ®å¤§å°ï¼Œä¸€èˆ¬åŒæ—¶å‡ºç°Content-Encodingå“åº”å¤´ |\n| Set-Cookie        | è®¾ç½® Cookie                                                  |\n| Location          | é‡å®šå‘åˆ°å¦ä¸€ä¸ª URLï¼Œå¦‚è¾“å…¥æµè§ˆå™¨å°±è¾“å…¥ baidu.com å›è½¦ï¼Œä¼šè‡ªåŠ¨è·³è½¬åˆ°www.baidu.com å°±æ˜¯é€šè¿‡è¿™ä¸ªå“åº”å¤´æ§åˆ¶çš„ |\n| Server            | åå°æœåŠ¡å™¨                                                   |\n\n>  Reference \n>  https://zhuanlan.zhihu.com/p/72616216\n>  https://juejin.im/post/5a0ce1d95188253e24708454","slug":"HTTPHTTPSåè®®","published":1,"updated":"2021-06-24T14:00:06.846Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra7k0002lwrd4m6jawuv","content":"<h2 id=\"åè®®\"><a href=\"#åè®®\" class=\"headerlink\" title=\"åè®®\"></a>åè®®</h2><p>ç½‘ç»œåè®®æ˜¯è®¡ç®—æœºä¹‹é—´ä¸ºäº†å®ç°ç½‘ç»œé€šä¿¡è€Œè¾¾æˆçš„ä¸€ç§â€œçº¦å®šâ€æˆ–è€…â€è§„åˆ™â€œï¼Œæœ‰äº†è¿™ç§â€çº¦å®šâ€œï¼Œä¸åŒå‚å•†çš„ç”Ÿäº§è®¾å¤‡ï¼Œä»¥åŠä¸åŒæ“ä½œç³»ç»Ÿç»„æˆçš„è®¡ç®—æœºä¹‹é—´ï¼Œå°±å¯ä»¥å®ç°é€šä¿¡ã€‚</p>\n<h3 id=\"HTTPåè®®\"><a href=\"#HTTPåè®®\" class=\"headerlink\" title=\"HTTPåè®®\"></a>HTTPåè®®</h3><p>HTTPåè®®æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®çš„ç¼©å†™ï¼Œè‹±æ–‡æ˜¯Hyper Text Transfer Protocolã€‚å®ƒæ˜¯ä»WEBæœåŠ¡å™¨ä¼ è¾“è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€(HTML)åˆ°æœ¬åœ°æµè§ˆå™¨çš„ä¼ é€åè®®ã€‚</p>\n<p>è®¾è®¡HTTPæœ€åˆçš„ç›®çš„æ˜¯ä¸ºäº†æä¾›ä¸€ç§å‘å¸ƒå’Œæ¥æ”¶HTMLé¡µé¢çš„æ–¹æ³•ã€‚</p>\n<p>HTPPæœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œç›®å‰å¹¿æ³›ä½¿ç”¨çš„æ˜¯HTTP/1.1ç‰ˆæœ¬ã€‚</p>\n<h2 id=\"HTTP\"><a href=\"#HTTP\" class=\"headerlink\" title=\"HTTP\"></a>HTTP</h2><p>HTTP å…¨ç§°æ˜¯ HyperText Transfer Protocal ï¼Œå³ï¼šè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œä» 1990 å¹´å¼€å§‹å°±åœ¨ WWW ä¸Šå¹¿æ³›åº”ç”¨ï¼Œæ˜¯ç°ä»Šåœ¨ WWW ä¸Šåº”ç”¨æœ€å¤šçš„åè®®ï¼ŒHTTP æ˜¯åº”ç”¨å±‚åè®®ï¼Œå½“ä½ ä¸Šç½‘æµè§ˆç½‘é¡µçš„æ—¶å€™ï¼Œæµè§ˆå™¨å’Œ web æœåŠ¡å™¨ä¹‹é—´å°±ä¼šé€šè¿‡ HTTP åœ¨ Internet ä¸Šè¿›è¡Œæ•°æ®çš„å‘é€å’Œæ¥æ”¶ã€‚HTTP æ˜¯ä¸€ä¸ªåŸºäºè¯·æ±‚/å“åº”æ¨¡å¼çš„ã€æ— çŠ¶æ€çš„åè®®ã€‚å³æˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„ Request/Response</p>\n<h3 id=\"HTTPåŸç†\"><a href=\"#HTTPåŸç†\" class=\"headerlink\" title=\"HTTPåŸç†\"></a>HTTPåŸç†</h3><p>HTTPæ˜¯ä¸€ä¸ªåŸºäºTCP/IPé€šä¿¡åè®®æ¥ä¼ é€’æ•°æ®çš„åè®®ï¼Œä¼ è¾“çš„æ•°æ®ç±»å‹ä¸ºHTML æ–‡ä»¶,ã€å›¾ç‰‡æ–‡ä»¶, æŸ¥è¯¢ç»“æœç­‰ã€‚</p>\n<p>HTTPåè®®ä¸€èˆ¬ç”¨äºB/Sæ¶æ„ï¼ˆï¼‰ã€‚æµè§ˆå™¨ä½œä¸ºHTTPå®¢æˆ·ç«¯é€šè¿‡URLå‘HTTPæœåŠ¡ç«¯å³WEBæœåŠ¡å™¨å‘é€æ‰€æœ‰è¯·æ±‚ã€‚</p>\n<h3 id=\"HTTPåè®®-1\"><a href=\"#HTTPåè®®-1\" class=\"headerlink\" title=\"HTTPåè®®\"></a>HTTPåè®®</h3><p>HTTPåè®®æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®çš„ç¼©å†™ï¼Œè‹±æ–‡æ˜¯Hyper Text Transfer Protocolã€‚å®ƒæ˜¯ä»WEBæœåŠ¡å™¨ä¼ è¾“è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€(HTML)åˆ°æœ¬åœ°æµè§ˆå™¨çš„ä¼ é€åè®®ã€‚</p>\n<p>è®¾è®¡HTTPæœ€åˆçš„ç›®çš„æ˜¯ä¸ºäº†æä¾›ä¸€ç§å‘å¸ƒå’Œæ¥æ”¶HTMLé¡µé¢çš„æ–¹æ³•ã€‚</p>\n<p>HTPPæœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œç›®å‰å¹¿æ³›ä½¿ç”¨çš„æ˜¯HTTP/1.1ç‰ˆæœ¬ã€‚</p>\n<h3 id=\"HTTPç‰¹ç‚¹\"><a href=\"#HTTPç‰¹ç‚¹\" class=\"headerlink\" title=\"HTTPç‰¹ç‚¹\"></a>HTTPç‰¹ç‚¹</h3><ul>\n<li>æ”¯æŒå®¢æˆ·ç«¯/æœåŠ¡å™¨æ¨¡å¼</li>\n<li>ç®€å•å¿«é€Ÿï¼šå®¢æˆ·å‘æœåŠ¡å™¨è¯·æ±‚æœåŠ¡æ—¶ï¼Œåªéœ€ä¼ é€è¯·æ±‚æ–¹æ³•å’Œè·¯å¾„ã€‚ç”±äº HTTP åè®®ç®€å•ï¼Œä½¿å¾— HTTP æœåŠ¡å™¨çš„ç¨‹åºè§„æ¨¡å°ï¼Œå› è€Œé€šä¿¡é€Ÿåº¦å¾ˆå¿«</li>\n<li>çµæ´»ï¼šHTTP å…è®¸ä¼ è¾“ä»»æ„ç±»å‹çš„æ•°æ®å¯¹è±¡ã€‚æ­£åœ¨ä¼ è¾“çš„ç±»å‹ç”± Content-Type åŠ ä»¥æ ‡è®°</li>\n<li>æ— è¿æ¥ï¼šæ— è¿æ¥çš„å«ä¹‰æ˜¯é™åˆ¶æ¯æ¬¡é“¾æ¥åªå¤„ç†ä¸€ä¸ªè¯·æ±‚ã€‚æœåŠ¡å™¨å¤„ç†å®Œå®¢æˆ·çš„è¯·æ±‚ï¼Œå¹¶æ”¶åˆ°å®¢æˆ·çš„åº”ç­”åï¼Œå³æ–­å¼€é“¾æ¥ï¼Œé‡‡ç”¨è¿™ç§æ–¹å¼å¯ä»¥èŠ‚çœä¼ è¾“æ—¶é—´</li>\n<li>æ— çŠ¶æ€ï¼šHTTP åè®®æ˜¯æ— çŠ¶æ€åè®®ã€‚æ— çŠ¶æ€æ˜¯æŒ‡åè®®å¯¹äºäº‹ç‰©å¤„ç†æ²¡æœ‰è®°å¿†èƒ½åŠ›ã€‚ç¼ºå°‘çŠ¶æ€æ„å‘³ç€å¦‚æœåç»­å¤„ç†éœ€è¦å‰é¢çš„ä¿¡æ¯ï¼Œåˆ™å®ƒå¿…é¡»é‡ä¼ ï¼Œè¿™æ ·å¯èƒ½ä¼šå¯¼è‡´æ¯æ¬¡è¿æ¥ä¼ é€çš„æ•°æ®é‡å¢å¤§ã€‚å¦ä¸€æ–¹é¢ï¼Œåœ¨æœåŠ¡å™¨ä¸éœ€è¦å…ˆå‰ä¿¡æ¯æ—¶å®ƒçš„åº”ç­”å°±æ¯”è¾ƒå¿«</li>\n</ul>\n<h2 id=\"HTTPS\"><a href=\"#HTTPS\" class=\"headerlink\" title=\"HTTPS\"></a>HTTPS</h2><p>HTTPS åè®®ï¼ˆHyperText Transfer Protocol over Secure Socket Layerï¼‰ï¼šä¸€èˆ¬ç†è§£ä¸ºHTTP+SSL/TLSï¼Œé€šè¿‡ SSLè¯ä¹¦æ¥éªŒè¯æœåŠ¡å™¨çš„èº«ä»½ï¼Œå¹¶ä¸ºæµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡è¿›è¡ŒåŠ å¯†ã€‚</p>\n<p>è§£å†³HTTPçš„ä¸€äº›é—®é¢˜</p>\n<ul>\n<li>è¯·æ±‚ä¿¡æ¯æ˜æ–‡ä¼ è¾“ï¼Œå®¹æ˜“è¢«çªƒå¬æˆªå–ã€‚</li>\n<li>æ•°æ®çš„å®Œæ•´æ€§æœªæ ¡éªŒï¼Œå®¹æ˜“è¢«ç¯¡æ”¹</li>\n<li>æ²¡æœ‰éªŒè¯å¯¹æ–¹èº«ä»½ï¼Œå­˜åœ¨å†’å……å±é™©</li>\n</ul>\n<h2 id=\"æ€»ç»“HTTPSå’ŒHTTPçš„åŒºåˆ«\"><a href=\"#æ€»ç»“HTTPSå’ŒHTTPçš„åŒºåˆ«\" class=\"headerlink\" title=\"æ€»ç»“HTTPSå’ŒHTTPçš„åŒºåˆ«\"></a>æ€»ç»“HTTPSå’ŒHTTPçš„åŒºåˆ«</h2><ul>\n<li>HTTPSæ˜¯HTTPåè®®çš„å®‰å…¨ç‰ˆæœ¬ï¼ŒHTTPåè®®çš„æ•°æ®ä¼ è¾“æ˜¯æ˜æ–‡çš„ï¼Œæ˜¯ä¸å®‰å…¨çš„ï¼ŒHTTPSä½¿ç”¨äº†SSL/TLSåè®®è¿›è¡Œäº†åŠ å¯†å¤„ç†ã€‚</li>\n<li>httpå’Œhttpsä½¿ç”¨è¿æ¥æ–¹å¼ä¸åŒï¼Œé»˜è®¤ç«¯å£ä¹Ÿä¸ä¸€æ ·ï¼Œhttpæ˜¯80ï¼Œhttpsæ˜¯443ã€‚</li>\n</ul>\n<h2 id=\"URLè¯¦è§£\"><a href=\"#URLè¯¦è§£\" class=\"headerlink\" title=\"URLè¯¦è§£\"></a>URLè¯¦è§£</h2><p>URLï¼ˆUniform Resource Locatorï¼‰æ˜¯ç»Ÿä¸€èµ„æºå®šä½ç¬¦çš„ç®€ç§°ï¼Œæœ‰æ—¶å€™ä¹Ÿè¢«ä¿—ç§°ä¸ºç½‘é¡µåœ°å€ï¼ˆç½‘å€ï¼‰ï¼Œå¦‚åŒæ˜¯ç½‘ç»œä¸Šçš„é—¨ç‰Œï¼Œæ˜¯å› ç‰¹ç½‘ä¸Šæ ‡å‡†çš„èµ„æºçš„åœ°å€</p>\n<h3 id=\"åŸºæœ¬ç»„æˆ\"><a href=\"#åŸºæœ¬ç»„æˆ\" class=\"headerlink\" title=\"åŸºæœ¬ç»„æˆ\"></a>åŸºæœ¬ç»„æˆ</h3><table>\n<thead>\n<tr>\n<th>åç§°</th>\n<th>åŠŸèƒ½</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>scheme</td>\n<td>è®¿é—®æœåŠ¡å™¨ä»¥è·å–èµ„æºæ—¶è¦ä½¿ç”¨å“ªç§åè®®ï¼Œæ¯”å¦‚ï¼Œhttpï¼Œhttps å’Œ FTP ç­‰</td>\n</tr>\n<tr>\n<td>host</td>\n<td>HTTP æœåŠ¡å™¨çš„ IP åœ°å€æˆ–åŸŸå</td>\n</tr>\n<tr>\n<td>port#</td>\n<td>HTTP æœåŠ¡å™¨çš„é»˜è®¤ç«¯å£æ˜¯ 80ï¼Œè¿™ç§æƒ…å†µä¸‹ç«¯å£å·å¯ä»¥çœç•¥ï¼Œå¦‚æœä½¿ç”¨äº†åˆ«çš„ç«¯å£ï¼Œå¿…é¡»æŒ‡æ˜ï¼Œä¾‹å¦‚<a href=\"http://www.cnblogs.comï¼š8080\">www.cnblogs.comï¼š8080</a></td>\n</tr>\n<tr>\n<td>path</td>\n<td>è®¿é—®èµ„æºçš„è·¯å¾„</td>\n</tr>\n<tr>\n<td>query-string</td>\n<td>å‘ç»™ http æœåŠ¡å™¨çš„æ•°æ®</td>\n</tr>\n<tr>\n<td>anchor</td>\n<td>é”š</td>\n</tr>\n</tbody></table>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/httpHttps/15fc2525666dc96e.jpg\"  alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<h2 id=\"HTTPè¯·æ±‚\"><a href=\"#HTTPè¯·æ±‚\" class=\"headerlink\" title=\"HTTPè¯·æ±‚\"></a>HTTPè¯·æ±‚</h2><h3 id=\"ç±»å‹\"><a href=\"#ç±»å‹\" class=\"headerlink\" title=\"ç±»å‹\"></a>ç±»å‹</h3><table>\n<thead>\n<tr>\n<th>åç§°</th>\n<th>åŠŸèƒ½</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>GET</td>\n<td>å‘æŒ‡å®šçš„èµ„æºå‘å‡ºâ€œæ˜¾ç¤ºâ€è¯·æ±‚ï¼Œä½¿ç”¨ GET æ–¹æ³•åº”è¯¥åªç”¨åœ¨è¯»å–æ•°æ®ä¸Šï¼Œè€Œä¸åº”è¯¥ç”¨äºäº§ç”Ÿâ€œå‰¯ä½œç”¨â€çš„æ“ä½œä¸­</td>\n</tr>\n<tr>\n<td>POST</td>\n<td>æŒ‡å®šèµ„æºæäº¤æ•°æ®ï¼Œè¯·æ±‚æœåŠ¡å™¨è¿›è¡Œå¤„ç†ï¼ˆä¾‹å¦‚æäº¤è¡¨å•æˆ–è€…ä¸Šä¼ æ–‡ä»¶ï¼‰ã€‚æ•°æ®è¢«åŒ…å«åœ¨è¯·æ±‚æ–‡æœ¬ä¸­ã€‚è¿™ä¸ªè¯·æ±‚å¯èƒ½ä¼šåˆ›å»ºæ–°çš„èµ„æºæˆ–è€…ä¿®æ”¹ç°æœ‰èµ„æºï¼Œæˆ–ä¸¤è€…çš†æœ‰ã€‚</td>\n</tr>\n<tr>\n<td>PUT</td>\n<td>å‘æŒ‡å®šèµ„æºä½ç½®ä¸Šä¼ å…¶æœ€æ–°å†…å®¹</td>\n</tr>\n<tr>\n<td>DELETE</td>\n<td>è¯·æ±‚æœåŠ¡å™¨åˆ é™¤ Request-URI æ‰€æ ‡è¯†çš„èµ„æº</td>\n</tr>\n<tr>\n<td>OPTIONS</td>\n<td>ä½¿æœåŠ¡å™¨ä¼ å›è¯¥èµ„æºæ‰€æ”¯æŒçš„æ‰€æœ‰HTTPè¯·æ±‚æ–¹æ³•ã€‚ç”¨*æ¥ä»£æ›¿èµ„æºåç§°ï¼Œå‘ Web æœåŠ¡å™¨å‘é€ OPTIONS è¯·æ±‚ï¼Œå¯ä»¥æµ‹è¯•æœåŠ¡å™¨åŠŸèƒ½æ˜¯å¦æ­£å¸¸è¿ä½œ</td>\n</tr>\n<tr>\n<td>HEAD</td>\n<td>ä¸ GET æ–¹æ³•ä¸€æ ·ï¼Œéƒ½æ˜¯å‘æœåŠ¡å™¨å‘å‡ºæŒ‡å®šèµ„æºçš„è¯·æ±‚ï¼Œåªä¸è¿‡æœåŠ¡å™¨å°†ä¸ä¼ å›èµ„æºçš„æœ¬æ–‡éƒ¨åˆ†ï¼Œå®ƒçš„å¥½å¤„åœ¨äºï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥åœ¨ä¸å¿…ä¼ è¾“å…¨éƒ¨å†…å®¹çš„æƒ…å†µä¸‹ï¼Œå°±å¯ä»¥è·å–å…¶ä¸­å…³äºè¯¥èµ„æºçš„ä¿¡æ¯ï¼ˆåŸä¿¡æ¯æˆ–ç§°å…ƒæ•°æ®ï¼‰</td>\n</tr>\n<tr>\n<td>TRACE</td>\n<td>æ˜¾ç¤ºæœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚ï¼Œä¸»è¦ç”¨äºæµ‹è¯•æˆ–è¯Šæ–­</td>\n</tr>\n<tr>\n<td>CONNECT</td>\n<td>HTTP/1.1 ä¸­é¢„ç•™ç»™èƒ½å¤Ÿå°†è¿æ¥æ”¹ä¸ºé€šé“æ–¹å¼çš„ä»£ç†æœåŠ¡å™¨ã€‚é€šå¸¸ç”¨äº SSL åŠ å¯†æœåŠ¡å™¨çš„é“¾æ¥ï¼ˆç»ç”±éåŠ å¯†çš„ HTTP ä»£ç†æœåŠ¡å™¨ï¼‰</td>\n</tr>\n</tbody></table>\n<p>å…¶ä¸­ï¼Œæœ€å¸¸è§çš„æ˜¯ GET å’Œ POST æ–¹æ³•ï¼Œå¦‚æœæ˜¯ RESful æ¥å£çš„è¯ä¸€èˆ¬ä¼šç”¨åˆ° PUTã€DELETEã€GETã€POSTï¼ˆåˆ†åˆ«å¯¹åº”å¢åˆ æŸ¥æ”¹</p>\n<h3 id=\"è¯·æ±‚å¤´\"><a href=\"#è¯·æ±‚å¤´\" class=\"headerlink\" title=\"è¯·æ±‚å¤´\"></a>è¯·æ±‚å¤´</h3><table>\n<thead>\n<tr>\n<th>åç§°</th>\n<th>åŠŸèƒ½</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Authorization</td>\n<td>ç”¨äºè®¾ç½®èº«ä»½è®¤è¯ä¿¡æ¯</td>\n</tr>\n<tr>\n<td>User-Agent</td>\n<td>ç”¨æˆ·æ ‡è¯†ï¼Œå¦‚ï¼šOS å’Œæµè§ˆå™¨çš„ç±»å‹å’Œç‰ˆæœ¬</td>\n</tr>\n<tr>\n<td>If-Modified-Since</td>\n<td>å€¼ä¸ºä¸Šä¸€æ¬¡æœåŠ¡å™¨è¿”å›çš„Last-Modifiedå€¼ï¼Œç”¨äºç¡®å®šæŸä¸ªèµ„æºæ˜¯å¦è¢«æ›´æ”¹è¿‡ï¼Œæ²¡æœ‰æ›´æ”¹è¿‡å°±ä»ç¼“å­˜ä¸­è¯»å–</td>\n</tr>\n<tr>\n<td>If-None-Match</td>\n<td>å€¼ä¸ºä¸Šä¸€æ¬¡æœåŠ¡å™¨è¿”å›çš„ ETag å€¼ï¼Œä¸€èˆ¬ä¼šå’ŒIf-Modified-Since</td>\n</tr>\n<tr>\n<td>Cookie</td>\n<td>å·²æœ‰çš„Cookie</td>\n</tr>\n<tr>\n<td>Referer</td>\n<td>æ ‡è¯†è¯·æ±‚å¼•ç”¨è‡ªå“ªä¸ªåœ°å€ï¼Œæ¯”å¦‚ä½ ä»é¡µé¢ A è·³è½¬åˆ°é¡µé¢ B æ—¶ï¼Œå€¼ä¸ºé¡µé¢ A çš„åœ°å€</td>\n</tr>\n<tr>\n<td>Host</td>\n<td>è¯·æ±‚çš„ä¸»æœºå’Œç«¯å£å·</td>\n</tr>\n</tbody></table>\n<h3 id=\"çŠ¶æ€ç \"><a href=\"#çŠ¶æ€ç \" class=\"headerlink\" title=\"çŠ¶æ€ç \"></a>çŠ¶æ€ç </h3><table>\n<thead>\n<tr>\n<th>çŠ¶æ€ç </th>\n<th>å¯¹åº”çš„ä¿¡æ¯</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1XX</td>\n<td>æç¤ºä¿¡æ¯â€”è¡¨ç¤ºè¯·æ±‚å·²æ¥æ”¶ï¼Œç»§ç»­å¤„ç†</td>\n</tr>\n<tr>\n<td>2XX</td>\n<td>ç”¨äºè¡¨ç¤ºè¯·æ±‚å·²è¢«æˆåŠŸæ¥æ”¶ã€ç†è§£ã€æ¥æ”¶</td>\n</tr>\n<tr>\n<td>3XX</td>\n<td>ç”¨äºè¡¨ç¤ºèµ„æºï¼ˆç½‘é¡µç­‰ï¼‰è¢«æ°¸ä¹…è½¬ç§»åˆ°å…¶å®ƒ URLï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„é‡å®šå‘</td>\n</tr>\n<tr>\n<td>4XX</td>\n<td>å®¢æˆ·ç«¯é”™è¯¯â€”è¯·æ±‚æœ‰è¯­æ³•é”™è¯¯æˆ–è€…è¯·æ±‚æ— æ³•å®ç°</td>\n</tr>\n<tr>\n<td>5XX</td>\n<td>æœåŠ¡å™¨ç«¯é”™è¯¯â€”æœåŠ¡å™¨æœªèƒ½å®ç°åˆæ³•çš„è¯·æ±‚</td>\n</tr>\n</tbody></table>\n<h3 id=\"å“åº”å¤´\"><a href=\"#å“åº”å¤´\" class=\"headerlink\" title=\"å“åº”å¤´\"></a>å“åº”å¤´</h3><table>\n<thead>\n<tr>\n<th>åç§°</th>\n<th>åŠŸèƒ½</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Date</td>\n<td>æœåŠ¡å™¨çš„æ—¥æœŸ</td>\n</tr>\n<tr>\n<td>Last-Modified</td>\n<td>è¯¥èµ„æºæœ€åè¢«ä¿®æ”¹çš„æ—¶é—´</td>\n</tr>\n<tr>\n<td>Transfer-Encoding</td>\n<td>å–å€¼ä¸€èˆ¬ä¸º chunkedï¼Œå‡ºç°åœ¨ Content-Length ä¸èƒ½ç¡®å®šçš„æƒ…å†µä¸‹ï¼Œè¡¨ç¤ºæœåŠ¡å™¨ä¸çŸ¥é“å“åº”æ¿ä½“çš„æ•°æ®å¤§å°ï¼Œä¸€èˆ¬åŒæ—¶å‡ºç°Content-Encodingå“åº”å¤´</td>\n</tr>\n<tr>\n<td>Set-Cookie</td>\n<td>è®¾ç½® Cookie</td>\n</tr>\n<tr>\n<td>Location</td>\n<td>é‡å®šå‘åˆ°å¦ä¸€ä¸ª URLï¼Œå¦‚è¾“å…¥æµè§ˆå™¨å°±è¾“å…¥ baidu.com å›è½¦ï¼Œä¼šè‡ªåŠ¨è·³è½¬åˆ°<a href=\"http://www.baidu.com\" target=\"_blank\" rel=\"noopener\">www.baidu.com</a> å°±æ˜¯é€šè¿‡è¿™ä¸ªå“åº”å¤´æ§åˆ¶çš„</td>\n</tr>\n<tr>\n<td>Server</td>\n<td>åå°æœåŠ¡å™¨</td>\n</tr>\n</tbody></table>\n<blockquote>\n<p> Reference<br> <a href=\"https://zhuanlan.zhihu.com/p/72616216\" target=\"_blank\" rel=\"noopener\">https://zhuanlan.zhihu.com/p/72616216</a><br> <a href=\"https://juejin.im/post/5a0ce1d95188253e24708454\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/5a0ce1d95188253e24708454</a></p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"åè®®\"><a href=\"#åè®®\" class=\"headerlink\" title=\"åè®®\"></a>åè®®</h2><p>ç½‘ç»œåè®®æ˜¯è®¡ç®—æœºä¹‹é—´ä¸ºäº†å®ç°ç½‘ç»œé€šä¿¡è€Œè¾¾æˆçš„ä¸€ç§â€œçº¦å®šâ€æˆ–è€…â€è§„åˆ™â€œï¼Œæœ‰äº†è¿™ç§â€çº¦å®šâ€œï¼Œä¸åŒå‚å•†çš„ç”Ÿäº§è®¾å¤‡ï¼Œä»¥åŠä¸åŒæ“ä½œç³»ç»Ÿç»„æˆçš„è®¡ç®—æœºä¹‹é—´ï¼Œå°±å¯ä»¥å®ç°é€šä¿¡ã€‚</p>\n<h3 id=\"HTTPåè®®\"><a href=\"#HTTPåè®®\" class=\"headerlink\" title=\"HTTPåè®®\"></a>HTTPåè®®</h3><p>HTTPåè®®æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®çš„ç¼©å†™ï¼Œè‹±æ–‡æ˜¯Hyper Text Transfer Protocolã€‚å®ƒæ˜¯ä»WEBæœåŠ¡å™¨ä¼ è¾“è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€(HTML)åˆ°æœ¬åœ°æµè§ˆå™¨çš„ä¼ é€åè®®ã€‚</p>\n<p>è®¾è®¡HTTPæœ€åˆçš„ç›®çš„æ˜¯ä¸ºäº†æä¾›ä¸€ç§å‘å¸ƒå’Œæ¥æ”¶HTMLé¡µé¢çš„æ–¹æ³•ã€‚</p>\n<p>HTPPæœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œç›®å‰å¹¿æ³›ä½¿ç”¨çš„æ˜¯HTTP/1.1ç‰ˆæœ¬ã€‚</p>\n<h2 id=\"HTTP\"><a href=\"#HTTP\" class=\"headerlink\" title=\"HTTP\"></a>HTTP</h2><p>HTTP å…¨ç§°æ˜¯ HyperText Transfer Protocal ï¼Œå³ï¼šè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œä» 1990 å¹´å¼€å§‹å°±åœ¨ WWW ä¸Šå¹¿æ³›åº”ç”¨ï¼Œæ˜¯ç°ä»Šåœ¨ WWW ä¸Šåº”ç”¨æœ€å¤šçš„åè®®ï¼ŒHTTP æ˜¯åº”ç”¨å±‚åè®®ï¼Œå½“ä½ ä¸Šç½‘æµè§ˆç½‘é¡µçš„æ—¶å€™ï¼Œæµè§ˆå™¨å’Œ web æœåŠ¡å™¨ä¹‹é—´å°±ä¼šé€šè¿‡ HTTP åœ¨ Internet ä¸Šè¿›è¡Œæ•°æ®çš„å‘é€å’Œæ¥æ”¶ã€‚HTTP æ˜¯ä¸€ä¸ªåŸºäºè¯·æ±‚/å“åº”æ¨¡å¼çš„ã€æ— çŠ¶æ€çš„åè®®ã€‚å³æˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„ Request/Response</p>\n<h3 id=\"HTTPåŸç†\"><a href=\"#HTTPåŸç†\" class=\"headerlink\" title=\"HTTPåŸç†\"></a>HTTPåŸç†</h3><p>HTTPæ˜¯ä¸€ä¸ªåŸºäºTCP/IPé€šä¿¡åè®®æ¥ä¼ é€’æ•°æ®çš„åè®®ï¼Œä¼ è¾“çš„æ•°æ®ç±»å‹ä¸ºHTML æ–‡ä»¶,ã€å›¾ç‰‡æ–‡ä»¶, æŸ¥è¯¢ç»“æœç­‰ã€‚</p>\n<p>HTTPåè®®ä¸€èˆ¬ç”¨äºB/Sæ¶æ„ï¼ˆï¼‰ã€‚æµè§ˆå™¨ä½œä¸ºHTTPå®¢æˆ·ç«¯é€šè¿‡URLå‘HTTPæœåŠ¡ç«¯å³WEBæœåŠ¡å™¨å‘é€æ‰€æœ‰è¯·æ±‚ã€‚</p>\n<h3 id=\"HTTPåè®®-1\"><a href=\"#HTTPåè®®-1\" class=\"headerlink\" title=\"HTTPåè®®\"></a>HTTPåè®®</h3><p>HTTPåè®®æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®çš„ç¼©å†™ï¼Œè‹±æ–‡æ˜¯Hyper Text Transfer Protocolã€‚å®ƒæ˜¯ä»WEBæœåŠ¡å™¨ä¼ è¾“è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€(HTML)åˆ°æœ¬åœ°æµè§ˆå™¨çš„ä¼ é€åè®®ã€‚</p>\n<p>è®¾è®¡HTTPæœ€åˆçš„ç›®çš„æ˜¯ä¸ºäº†æä¾›ä¸€ç§å‘å¸ƒå’Œæ¥æ”¶HTMLé¡µé¢çš„æ–¹æ³•ã€‚</p>\n<p>HTPPæœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œç›®å‰å¹¿æ³›ä½¿ç”¨çš„æ˜¯HTTP/1.1ç‰ˆæœ¬ã€‚</p>\n<h3 id=\"HTTPç‰¹ç‚¹\"><a href=\"#HTTPç‰¹ç‚¹\" class=\"headerlink\" title=\"HTTPç‰¹ç‚¹\"></a>HTTPç‰¹ç‚¹</h3><ul>\n<li>æ”¯æŒå®¢æˆ·ç«¯/æœåŠ¡å™¨æ¨¡å¼</li>\n<li>ç®€å•å¿«é€Ÿï¼šå®¢æˆ·å‘æœåŠ¡å™¨è¯·æ±‚æœåŠ¡æ—¶ï¼Œåªéœ€ä¼ é€è¯·æ±‚æ–¹æ³•å’Œè·¯å¾„ã€‚ç”±äº HTTP åè®®ç®€å•ï¼Œä½¿å¾— HTTP æœåŠ¡å™¨çš„ç¨‹åºè§„æ¨¡å°ï¼Œå› è€Œé€šä¿¡é€Ÿåº¦å¾ˆå¿«</li>\n<li>çµæ´»ï¼šHTTP å…è®¸ä¼ è¾“ä»»æ„ç±»å‹çš„æ•°æ®å¯¹è±¡ã€‚æ­£åœ¨ä¼ è¾“çš„ç±»å‹ç”± Content-Type åŠ ä»¥æ ‡è®°</li>\n<li>æ— è¿æ¥ï¼šæ— è¿æ¥çš„å«ä¹‰æ˜¯é™åˆ¶æ¯æ¬¡é“¾æ¥åªå¤„ç†ä¸€ä¸ªè¯·æ±‚ã€‚æœåŠ¡å™¨å¤„ç†å®Œå®¢æˆ·çš„è¯·æ±‚ï¼Œå¹¶æ”¶åˆ°å®¢æˆ·çš„åº”ç­”åï¼Œå³æ–­å¼€é“¾æ¥ï¼Œé‡‡ç”¨è¿™ç§æ–¹å¼å¯ä»¥èŠ‚çœä¼ è¾“æ—¶é—´</li>\n<li>æ— çŠ¶æ€ï¼šHTTP åè®®æ˜¯æ— çŠ¶æ€åè®®ã€‚æ— çŠ¶æ€æ˜¯æŒ‡åè®®å¯¹äºäº‹ç‰©å¤„ç†æ²¡æœ‰è®°å¿†èƒ½åŠ›ã€‚ç¼ºå°‘çŠ¶æ€æ„å‘³ç€å¦‚æœåç»­å¤„ç†éœ€è¦å‰é¢çš„ä¿¡æ¯ï¼Œåˆ™å®ƒå¿…é¡»é‡ä¼ ï¼Œè¿™æ ·å¯èƒ½ä¼šå¯¼è‡´æ¯æ¬¡è¿æ¥ä¼ é€çš„æ•°æ®é‡å¢å¤§ã€‚å¦ä¸€æ–¹é¢ï¼Œåœ¨æœåŠ¡å™¨ä¸éœ€è¦å…ˆå‰ä¿¡æ¯æ—¶å®ƒçš„åº”ç­”å°±æ¯”è¾ƒå¿«</li>\n</ul>\n<h2 id=\"HTTPS\"><a href=\"#HTTPS\" class=\"headerlink\" title=\"HTTPS\"></a>HTTPS</h2><p>HTTPS åè®®ï¼ˆHyperText Transfer Protocol over Secure Socket Layerï¼‰ï¼šä¸€èˆ¬ç†è§£ä¸ºHTTP+SSL/TLSï¼Œé€šè¿‡ SSLè¯ä¹¦æ¥éªŒè¯æœåŠ¡å™¨çš„èº«ä»½ï¼Œå¹¶ä¸ºæµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡è¿›è¡ŒåŠ å¯†ã€‚</p>\n<p>è§£å†³HTTPçš„ä¸€äº›é—®é¢˜</p>\n<ul>\n<li>è¯·æ±‚ä¿¡æ¯æ˜æ–‡ä¼ è¾“ï¼Œå®¹æ˜“è¢«çªƒå¬æˆªå–ã€‚</li>\n<li>æ•°æ®çš„å®Œæ•´æ€§æœªæ ¡éªŒï¼Œå®¹æ˜“è¢«ç¯¡æ”¹</li>\n<li>æ²¡æœ‰éªŒè¯å¯¹æ–¹èº«ä»½ï¼Œå­˜åœ¨å†’å……å±é™©</li>\n</ul>\n<h2 id=\"æ€»ç»“HTTPSå’ŒHTTPçš„åŒºåˆ«\"><a href=\"#æ€»ç»“HTTPSå’ŒHTTPçš„åŒºåˆ«\" class=\"headerlink\" title=\"æ€»ç»“HTTPSå’ŒHTTPçš„åŒºåˆ«\"></a>æ€»ç»“HTTPSå’ŒHTTPçš„åŒºåˆ«</h2><ul>\n<li>HTTPSæ˜¯HTTPåè®®çš„å®‰å…¨ç‰ˆæœ¬ï¼ŒHTTPåè®®çš„æ•°æ®ä¼ è¾“æ˜¯æ˜æ–‡çš„ï¼Œæ˜¯ä¸å®‰å…¨çš„ï¼ŒHTTPSä½¿ç”¨äº†SSL/TLSåè®®è¿›è¡Œäº†åŠ å¯†å¤„ç†ã€‚</li>\n<li>httpå’Œhttpsä½¿ç”¨è¿æ¥æ–¹å¼ä¸åŒï¼Œé»˜è®¤ç«¯å£ä¹Ÿä¸ä¸€æ ·ï¼Œhttpæ˜¯80ï¼Œhttpsæ˜¯443ã€‚</li>\n</ul>\n<h2 id=\"URLè¯¦è§£\"><a href=\"#URLè¯¦è§£\" class=\"headerlink\" title=\"URLè¯¦è§£\"></a>URLè¯¦è§£</h2><p>URLï¼ˆUniform Resource Locatorï¼‰æ˜¯ç»Ÿä¸€èµ„æºå®šä½ç¬¦çš„ç®€ç§°ï¼Œæœ‰æ—¶å€™ä¹Ÿè¢«ä¿—ç§°ä¸ºç½‘é¡µåœ°å€ï¼ˆç½‘å€ï¼‰ï¼Œå¦‚åŒæ˜¯ç½‘ç»œä¸Šçš„é—¨ç‰Œï¼Œæ˜¯å› ç‰¹ç½‘ä¸Šæ ‡å‡†çš„èµ„æºçš„åœ°å€</p>\n<h3 id=\"åŸºæœ¬ç»„æˆ\"><a href=\"#åŸºæœ¬ç»„æˆ\" class=\"headerlink\" title=\"åŸºæœ¬ç»„æˆ\"></a>åŸºæœ¬ç»„æˆ</h3><table>\n<thead>\n<tr>\n<th>åç§°</th>\n<th>åŠŸèƒ½</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>scheme</td>\n<td>è®¿é—®æœåŠ¡å™¨ä»¥è·å–èµ„æºæ—¶è¦ä½¿ç”¨å“ªç§åè®®ï¼Œæ¯”å¦‚ï¼Œhttpï¼Œhttps å’Œ FTP ç­‰</td>\n</tr>\n<tr>\n<td>host</td>\n<td>HTTP æœåŠ¡å™¨çš„ IP åœ°å€æˆ–åŸŸå</td>\n</tr>\n<tr>\n<td>port#</td>\n<td>HTTP æœåŠ¡å™¨çš„é»˜è®¤ç«¯å£æ˜¯ 80ï¼Œè¿™ç§æƒ…å†µä¸‹ç«¯å£å·å¯ä»¥çœç•¥ï¼Œå¦‚æœä½¿ç”¨äº†åˆ«çš„ç«¯å£ï¼Œå¿…é¡»æŒ‡æ˜ï¼Œä¾‹å¦‚<a href=\"http://www.cnblogs.comï¼š8080\">www.cnblogs.comï¼š8080</a></td>\n</tr>\n<tr>\n<td>path</td>\n<td>è®¿é—®èµ„æºçš„è·¯å¾„</td>\n</tr>\n<tr>\n<td>query-string</td>\n<td>å‘ç»™ http æœåŠ¡å™¨çš„æ•°æ®</td>\n</tr>\n<tr>\n<td>anchor</td>\n<td>é”š</td>\n</tr>\n</tbody></table>\n<p><img src=\"/image/httpHttps/15fc2525666dc96e.jpg\" alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<h2 id=\"HTTPè¯·æ±‚\"><a href=\"#HTTPè¯·æ±‚\" class=\"headerlink\" title=\"HTTPè¯·æ±‚\"></a>HTTPè¯·æ±‚</h2><h3 id=\"ç±»å‹\"><a href=\"#ç±»å‹\" class=\"headerlink\" title=\"ç±»å‹\"></a>ç±»å‹</h3><table>\n<thead>\n<tr>\n<th>åç§°</th>\n<th>åŠŸèƒ½</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>GET</td>\n<td>å‘æŒ‡å®šçš„èµ„æºå‘å‡ºâ€œæ˜¾ç¤ºâ€è¯·æ±‚ï¼Œä½¿ç”¨ GET æ–¹æ³•åº”è¯¥åªç”¨åœ¨è¯»å–æ•°æ®ä¸Šï¼Œè€Œä¸åº”è¯¥ç”¨äºäº§ç”Ÿâ€œå‰¯ä½œç”¨â€çš„æ“ä½œä¸­</td>\n</tr>\n<tr>\n<td>POST</td>\n<td>æŒ‡å®šèµ„æºæäº¤æ•°æ®ï¼Œè¯·æ±‚æœåŠ¡å™¨è¿›è¡Œå¤„ç†ï¼ˆä¾‹å¦‚æäº¤è¡¨å•æˆ–è€…ä¸Šä¼ æ–‡ä»¶ï¼‰ã€‚æ•°æ®è¢«åŒ…å«åœ¨è¯·æ±‚æ–‡æœ¬ä¸­ã€‚è¿™ä¸ªè¯·æ±‚å¯èƒ½ä¼šåˆ›å»ºæ–°çš„èµ„æºæˆ–è€…ä¿®æ”¹ç°æœ‰èµ„æºï¼Œæˆ–ä¸¤è€…çš†æœ‰ã€‚</td>\n</tr>\n<tr>\n<td>PUT</td>\n<td>å‘æŒ‡å®šèµ„æºä½ç½®ä¸Šä¼ å…¶æœ€æ–°å†…å®¹</td>\n</tr>\n<tr>\n<td>DELETE</td>\n<td>è¯·æ±‚æœåŠ¡å™¨åˆ é™¤ Request-URI æ‰€æ ‡è¯†çš„èµ„æº</td>\n</tr>\n<tr>\n<td>OPTIONS</td>\n<td>ä½¿æœåŠ¡å™¨ä¼ å›è¯¥èµ„æºæ‰€æ”¯æŒçš„æ‰€æœ‰HTTPè¯·æ±‚æ–¹æ³•ã€‚ç”¨*æ¥ä»£æ›¿èµ„æºåç§°ï¼Œå‘ Web æœåŠ¡å™¨å‘é€ OPTIONS è¯·æ±‚ï¼Œå¯ä»¥æµ‹è¯•æœåŠ¡å™¨åŠŸèƒ½æ˜¯å¦æ­£å¸¸è¿ä½œ</td>\n</tr>\n<tr>\n<td>HEAD</td>\n<td>ä¸ GET æ–¹æ³•ä¸€æ ·ï¼Œéƒ½æ˜¯å‘æœåŠ¡å™¨å‘å‡ºæŒ‡å®šèµ„æºçš„è¯·æ±‚ï¼Œåªä¸è¿‡æœåŠ¡å™¨å°†ä¸ä¼ å›èµ„æºçš„æœ¬æ–‡éƒ¨åˆ†ï¼Œå®ƒçš„å¥½å¤„åœ¨äºï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥åœ¨ä¸å¿…ä¼ è¾“å…¨éƒ¨å†…å®¹çš„æƒ…å†µä¸‹ï¼Œå°±å¯ä»¥è·å–å…¶ä¸­å…³äºè¯¥èµ„æºçš„ä¿¡æ¯ï¼ˆåŸä¿¡æ¯æˆ–ç§°å…ƒæ•°æ®ï¼‰</td>\n</tr>\n<tr>\n<td>TRACE</td>\n<td>æ˜¾ç¤ºæœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚ï¼Œä¸»è¦ç”¨äºæµ‹è¯•æˆ–è¯Šæ–­</td>\n</tr>\n<tr>\n<td>CONNECT</td>\n<td>HTTP/1.1 ä¸­é¢„ç•™ç»™èƒ½å¤Ÿå°†è¿æ¥æ”¹ä¸ºé€šé“æ–¹å¼çš„ä»£ç†æœåŠ¡å™¨ã€‚é€šå¸¸ç”¨äº SSL åŠ å¯†æœåŠ¡å™¨çš„é“¾æ¥ï¼ˆç»ç”±éåŠ å¯†çš„ HTTP ä»£ç†æœåŠ¡å™¨ï¼‰</td>\n</tr>\n</tbody></table>\n<p>å…¶ä¸­ï¼Œæœ€å¸¸è§çš„æ˜¯ GET å’Œ POST æ–¹æ³•ï¼Œå¦‚æœæ˜¯ RESful æ¥å£çš„è¯ä¸€èˆ¬ä¼šç”¨åˆ° PUTã€DELETEã€GETã€POSTï¼ˆåˆ†åˆ«å¯¹åº”å¢åˆ æŸ¥æ”¹</p>\n<h3 id=\"è¯·æ±‚å¤´\"><a href=\"#è¯·æ±‚å¤´\" class=\"headerlink\" title=\"è¯·æ±‚å¤´\"></a>è¯·æ±‚å¤´</h3><table>\n<thead>\n<tr>\n<th>åç§°</th>\n<th>åŠŸèƒ½</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Authorization</td>\n<td>ç”¨äºè®¾ç½®èº«ä»½è®¤è¯ä¿¡æ¯</td>\n</tr>\n<tr>\n<td>User-Agent</td>\n<td>ç”¨æˆ·æ ‡è¯†ï¼Œå¦‚ï¼šOS å’Œæµè§ˆå™¨çš„ç±»å‹å’Œç‰ˆæœ¬</td>\n</tr>\n<tr>\n<td>If-Modified-Since</td>\n<td>å€¼ä¸ºä¸Šä¸€æ¬¡æœåŠ¡å™¨è¿”å›çš„Last-Modifiedå€¼ï¼Œç”¨äºç¡®å®šæŸä¸ªèµ„æºæ˜¯å¦è¢«æ›´æ”¹è¿‡ï¼Œæ²¡æœ‰æ›´æ”¹è¿‡å°±ä»ç¼“å­˜ä¸­è¯»å–</td>\n</tr>\n<tr>\n<td>If-None-Match</td>\n<td>å€¼ä¸ºä¸Šä¸€æ¬¡æœåŠ¡å™¨è¿”å›çš„ ETag å€¼ï¼Œä¸€èˆ¬ä¼šå’ŒIf-Modified-Since</td>\n</tr>\n<tr>\n<td>Cookie</td>\n<td>å·²æœ‰çš„Cookie</td>\n</tr>\n<tr>\n<td>Referer</td>\n<td>æ ‡è¯†è¯·æ±‚å¼•ç”¨è‡ªå“ªä¸ªåœ°å€ï¼Œæ¯”å¦‚ä½ ä»é¡µé¢ A è·³è½¬åˆ°é¡µé¢ B æ—¶ï¼Œå€¼ä¸ºé¡µé¢ A çš„åœ°å€</td>\n</tr>\n<tr>\n<td>Host</td>\n<td>è¯·æ±‚çš„ä¸»æœºå’Œç«¯å£å·</td>\n</tr>\n</tbody></table>\n<h3 id=\"çŠ¶æ€ç \"><a href=\"#çŠ¶æ€ç \" class=\"headerlink\" title=\"çŠ¶æ€ç \"></a>çŠ¶æ€ç </h3><table>\n<thead>\n<tr>\n<th>çŠ¶æ€ç </th>\n<th>å¯¹åº”çš„ä¿¡æ¯</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1XX</td>\n<td>æç¤ºä¿¡æ¯â€”è¡¨ç¤ºè¯·æ±‚å·²æ¥æ”¶ï¼Œç»§ç»­å¤„ç†</td>\n</tr>\n<tr>\n<td>2XX</td>\n<td>ç”¨äºè¡¨ç¤ºè¯·æ±‚å·²è¢«æˆåŠŸæ¥æ”¶ã€ç†è§£ã€æ¥æ”¶</td>\n</tr>\n<tr>\n<td>3XX</td>\n<td>ç”¨äºè¡¨ç¤ºèµ„æºï¼ˆç½‘é¡µç­‰ï¼‰è¢«æ°¸ä¹…è½¬ç§»åˆ°å…¶å®ƒ URLï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„é‡å®šå‘</td>\n</tr>\n<tr>\n<td>4XX</td>\n<td>å®¢æˆ·ç«¯é”™è¯¯â€”è¯·æ±‚æœ‰è¯­æ³•é”™è¯¯æˆ–è€…è¯·æ±‚æ— æ³•å®ç°</td>\n</tr>\n<tr>\n<td>5XX</td>\n<td>æœåŠ¡å™¨ç«¯é”™è¯¯â€”æœåŠ¡å™¨æœªèƒ½å®ç°åˆæ³•çš„è¯·æ±‚</td>\n</tr>\n</tbody></table>\n<h3 id=\"å“åº”å¤´\"><a href=\"#å“åº”å¤´\" class=\"headerlink\" title=\"å“åº”å¤´\"></a>å“åº”å¤´</h3><table>\n<thead>\n<tr>\n<th>åç§°</th>\n<th>åŠŸèƒ½</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Date</td>\n<td>æœåŠ¡å™¨çš„æ—¥æœŸ</td>\n</tr>\n<tr>\n<td>Last-Modified</td>\n<td>è¯¥èµ„æºæœ€åè¢«ä¿®æ”¹çš„æ—¶é—´</td>\n</tr>\n<tr>\n<td>Transfer-Encoding</td>\n<td>å–å€¼ä¸€èˆ¬ä¸º chunkedï¼Œå‡ºç°åœ¨ Content-Length ä¸èƒ½ç¡®å®šçš„æƒ…å†µä¸‹ï¼Œè¡¨ç¤ºæœåŠ¡å™¨ä¸çŸ¥é“å“åº”æ¿ä½“çš„æ•°æ®å¤§å°ï¼Œä¸€èˆ¬åŒæ—¶å‡ºç°Content-Encodingå“åº”å¤´</td>\n</tr>\n<tr>\n<td>Set-Cookie</td>\n<td>è®¾ç½® Cookie</td>\n</tr>\n<tr>\n<td>Location</td>\n<td>é‡å®šå‘åˆ°å¦ä¸€ä¸ª URLï¼Œå¦‚è¾“å…¥æµè§ˆå™¨å°±è¾“å…¥ baidu.com å›è½¦ï¼Œä¼šè‡ªåŠ¨è·³è½¬åˆ°<a href=\"http://www.baidu.com\" target=\"_blank\" rel=\"noopener\">www.baidu.com</a> å°±æ˜¯é€šè¿‡è¿™ä¸ªå“åº”å¤´æ§åˆ¶çš„</td>\n</tr>\n<tr>\n<td>Server</td>\n<td>åå°æœåŠ¡å™¨</td>\n</tr>\n</tbody></table>\n<blockquote>\n<p> Reference<br> <a href=\"https://zhuanlan.zhihu.com/p/72616216\" target=\"_blank\" rel=\"noopener\">https://zhuanlan.zhihu.com/p/72616216</a><br> <a href=\"https://juejin.im/post/5a0ce1d95188253e24708454\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/5a0ce1d95188253e24708454</a></p>\n</blockquote>\n"},{"title":"Hexo+GitHubæ„å»ºä½ çš„åšå®¢","date":"2019-06-17T11:17:25.000Z","cover":"/image/cover/HEXO.png","_content":"\n\nhttps://blog.csdn.net/cuandeqin2083/article/details/92791433\n\n","source":"_posts/Hexo+GitHubæ„å»ºä½ çš„åšå®¢.md","raw":"---\ntitle: Hexo+GitHubæ„å»ºä½ çš„åšå®¢\ndate: 2019-06-17 19:17:25\ntags: [Hexo, GitHub]\ncategories: [åšå®¢]\ncover: /image/cover/HEXO.png\n---\n\n\nhttps://blog.csdn.net/cuandeqin2083/article/details/92791433\n\n","slug":"Hexo+GitHubæ„å»ºä½ çš„åšå®¢","published":1,"updated":"2021-06-24T14:00:06.846Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra7n0006lwrd9h667myh","content":"<p><a href=\"https://blog.csdn.net/cuandeqin2083/article/details/92791433\" target=\"_blank\" rel=\"noopener\">https://blog.csdn.net/cuandeqin2083/article/details/92791433</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"https://blog.csdn.net/cuandeqin2083/article/details/92791433\" target=\"_blank\" rel=\"noopener\">https://blog.csdn.net/cuandeqin2083/article/details/92791433</a></p>\n"},{"date":"2019-06-19T03:22:03.000Z","cover":"/image/cover/React.jpeg","_content":"\n@[TOC](Reactå…¥é—¨ï¼ˆä¸€ï¼‰ Stateè¯¦è§£)\n\n# Reactå…¥é—¨ï¼ˆä¸€ï¼‰ Stateè¯¦è§£\n\næˆ‘ä»¬éƒ½æ˜¯ç¨‹åºå‘˜ï¼ŒåºŸè¯ä¸å¤šè¯´é©¬ä¸Šå¼€å§‹ï¼\n\n## ä¸€ã€ Demoåˆ›å»º/ä¸‹è½½\n\nä¸¤ç§æ–¹æ³•åˆ›å»ºæ–°çš„React APP\n\n### 1. githubä¸‹è½½\n\n- ä¸‹è½½[gitåœ°å€](https://github.com/DerrickTel/ReactDemo1.git).\n - è§£å‹-æ‰“å¼€\n  - npm install\n  - npm start \n  - ![å¦‚æœæœ‰è¯¢é—®](/image/Reactå…¥é—¨/20181123111537542.png)\n  - yï¼ˆ3000ç«¯å£ä»»åŠ¡åœ¨è¿è¡Œæ˜¯å¦æ„¿æ„è¿è¡Œåœ¨åˆ«çš„ç«¯å£ä¸Šï¼Ÿï¼‰\n\n\n\n### 2. è‡ªå·±çš„å‘½ä»¤è¡Œåˆ›å»º\n- æ‰¾åˆ°è‡ªå·±**å¿ƒä»ªçš„æ–‡ä»¶å¤¹**   *ï¼ˆå…¨è‹±æ–‡ï¼‰*\n - ç”¨å‘½ä»¤è¡Œæ‰“å¼€å¹¶æŠµè¾¾**å¿ƒä»ªæ–‡ä»¶å¤¹**\n  - npx create-react-app my-app\n  - cd my-app\n  - npm start\n> **æ³¨æ„**\n> npxåœ¨ç¬¬ä¸€è¡Œä¸æ˜¯ä¸€ä¸ªé”™å­— - å®ƒæ˜¯ä¸€ä¸ªåŒ…è½¬å‘å·¥å…·ï¼Œé™„å¸¦npm 5.2+ã€‚\n> åˆ›å»ºçš„æ—¶å€™å·²ç»é»˜è®¤è¿è¡Œè¿‡ï¼ˆnpm install ï¼‰å¯ä»¥ç›´æ¥start\n\nç„¶åæŠŠ src/app.jsçš„æ–‡ä»¶å†…å®¹å…ˆæ”¹ä¸€ä¸‹\n\n```javascript\nimport React, { Component } from 'react';\nimport logo from './logo.svg';\nimport './App.css';\n\nclass App extends Component {\n  render() {\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <img src={logo} className=\"App-logo\" alt=\"logo\" />\n          <p>\n            Edit <code>src/App.js</code> and save to reload.\n          </p>\n          <p>\n            ä¿®æ”¹æ–‡ä»¶å¤¹ <code>src/App.js</code> ä¿å­˜æ—¶å€™ä¹‹åè‡ªåŠ¨åŠ è½½.\n          </p>\n        </header>\n      </div>\n    );\n  }\n}\n\nexport default App;\n\n```\nCtrl + C \n\nCtrl + V\n\n## äºŒã€Stateæ˜¯ä»€ä¹ˆï¼Ÿ\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/Reactå…¥é—¨/20181123134126335.png)\n\nè‹±æ–‡ç¿»è¯‘æ˜¯çŠ¶æ€ã€‚\n\nå…¶å®ä¹Ÿå¯ä»¥ç†è§£ä¸ºçŠ¶æ€ï¼Œä¸€æ®µæ–‡å­—ä¸­çš„æŸä¸ªå€¼æ”¹å˜äº†ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºçŠ¶æ€æ”¹å˜äº†ã€‚\nçœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­\n\n\næŠŠ src/app.jsçš„æ–‡ä»¶å†…å®¹å…ˆæ”¹ä¸€ä¸‹\n\n```javascript\nimport React, { Component } from 'react';\nimport logo from './logo.svg';\nimport './App.css';\n\nclass App extends Component {\n  state={Text:'æˆ‘æ˜¯state'}\n  render() {\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <img src={logo} className=\"App-logo\" alt=\"logo\" />\n          <p>\n            Stateè¾“å‡ºï¼š{this.state.Text}\n          </p>\n        </header>\n      </div>\n    );\n  }\n}\n\nexport default App;\n```\n```javascript\n  state={Text:'æˆ‘æ˜¯state'}\n```\n\nè¿™é‡Œçš„stateæ˜¯ç»™stateè®¾ç½®åˆå€¼ï¼Œä¸ç„¶ä¼šæŠ¥é”™ã€‚ä¸ç›¸ä¿¡çš„è¯è‡ªå·±å¯ä»¥è¯•ä¸€ä¸‹ã€‚*ï¼ˆå› ä¸ºstateæ˜¯undefinedï¼Œæ‰€ä»¥ä»–é‡Œé¢å–ä¸åˆ°Textï¼‰*\n\né€šè¿‡ä¸Šé¢çš„ä¾‹å­å¯ä»¥çŸ¥é“stateé‡Œé¢æ”¾çš„æ˜¯XXçš„çŠ¶æ€\n\nkey valueå¯¹åº”çš„\n\nthis.state.xxå°±å¯ä»¥å–åˆ°å¯¹åº”keyçš„**çŠ¶æ€**çš„*å€¼*\n\n\n## ä¸‰ã€Stateå¦‚ä½•æ”¹å˜ï¼Ÿ\n\né€šå¸¸åœ¨JSé‡Œé¢ï¼Œæˆ‘ä»¬è¦æ”¹å˜æŸä¸€ä¸ªå€¼å¯èƒ½å°±åªéœ€è¦  X = XX; å°±å¯ä»¥ã€‚\n\n\nè¿™é‡Œçš„stateæ˜¯ä¸€ä¸ªçŠ¶æ€ã€‚çŠ¶æ€æ”¹å˜äº†ï¼Œé¡µé¢ä¼šè‡ªåŠ¨åˆ·æ–°ä¸ºæœ€æ–°çš„é¡µé¢ç”¨æœ€æ–°çš„çŠ¶æ€æ˜¾ç¤ºã€‚\nä¸‹é¢æˆ‘ä»¬åšä¸€ä¸ªå°å®éªŒã€‚\n\n\næŠŠ src/app.jsçš„æ–‡ä»¶å†…å®¹å…ˆæ”¹ä¸€ä¸‹\n\n```javascript\nimport React, { Component } from 'react';\nimport logo from './logo.svg';\nimport './App.css';\n\nclass App extends Component {\n  state={Text:'æˆ‘æ˜¯state'}\n  render() {\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <img src={logo} className=\"App-logo\" alt=\"logo\" />\n          <p>\n            Stateè¾“å‡ºï¼š{this.state.Text}\n          </p>\n          <button onClick={()=>{\n            this.state.Text = 'æˆ‘æ˜¯é€šè¿‡this.state.Textæ”¹å˜çš„State';\n            alert(this.state.Text);\n          }}>\n            æŒ‰æˆ‘æ”¹å˜state\n          </button>\n        </header>\n      </div>\n    );\n  }\n}\n\nexport default App;\n```\n\nï¼ˆä¸è¦åœ¨æ„ç»†èŠ‚ï¼ï¼ï¼æˆ‘ä»¬æ˜¯æµ‹è¯•æŒ‰é’®çš„æ ·å¼ä¸é‡è¦ï¼ï¼ï¼ï¼‰\n\nç‚¹å‡»æŒ‰é’®ä¹‹åï¼Œæˆ‘ä»¬å‘ç°ï¼Œstateçš„å€¼æ˜¯æ”¹å˜äº†ï¼Œä½†æ˜¯é¡µé¢ä¸Šé¢æ˜¾ç¤ºçš„å€¼ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„å•Šã€‚\n\n\n\né‚£æˆ‘è¦æ€ä¹ˆæ‰å¯ä»¥åˆ·æ–°é¡µé¢å‡ºç°æˆ‘æƒ³è¦çš„stateçš„å€¼å‘¢ï¼Ÿ\n\nå®˜æ–¹æä¾›çš„æ–¹æ³•\n\nsetState(updater, [callback])\n\n\nå¯ä»¥è¿™ä¹ˆç†è§£ï¼Œé’ˆå¯¹ä¸Šé¢çš„ä¾‹å­\n\n\n```javascript\nthis.setState({Text:'æˆ‘æ˜¯é€šè¿‡this.state.Textæ”¹å˜çš„State'}, function(){})\n```\n\nåé¢çš„functionï¼Œå¯ä»¥æœ‰ï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰ã€‚ä¸éœ€è¦çš„è¯å°±å¯ä»¥ä¸ç”¨å†™-----------ç¨åä¼šè¯´\n\næ‰€ä»¥åªéœ€è¦\n\n```javascript\nthis.setState({Text:'æˆ‘æ˜¯é€šè¿‡this.state.Textæ”¹å˜çš„State'})\n```\n\n\næŠŠ src/app.jsçš„æ–‡ä»¶å†…å®¹å…ˆæ”¹ä¸€ä¸‹\n\n```javascript\nimport React, { Component } from 'react';\nimport logo from './logo.svg';\nimport './App.css';\n\nclass App extends Component {\n  state={Text:'æˆ‘æ˜¯state'}\n  render() {\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <img src={logo} className=\"App-logo\" alt=\"logo\" />\n          <p>\n            Stateè¾“å‡ºï¼š{this.state.Text}\n          </p>\n          <button onClick={()=>{\n            this.setState({Text:'æˆ‘æ˜¯é€šè¿‡this.state.Textæ”¹å˜çš„State'})\n            alert(this.state.Text);\n          }}>\n            æŒ‰æˆ‘æ”¹å˜state\n          </button>\n        </header>\n      </div>\n    );\n  }\n}\n\nexport default App;\n```\nä¿å­˜-çƒ­åŠ è½½\nä¹‹åæˆ‘ä»¬å‘ç°ï¼ŒçŠ¶æ€æ˜¯æ”¹å˜äº†ï¼Œå¯æ˜¯alertçš„å€¼ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œè¿˜æ˜¯è€çš„å€¼ï¼ˆçŠ¶æ€ï¼‰çš„ã€‚\n\nå¯èƒ½ä½ ä¸çŸ¥é“æˆ‘åœ¨è¯´ä»€ä¹ˆ\n\né€šè¿‡ä¸€ä¸ªå°ä¾‹å­æˆ‘ä»¬ä»”ç»†æ„Ÿå—ä¸€ä¸‹ã€‚å®˜æ–¹çš„setStateç©¶ç«Ÿåœ¨å¹²ä»€ä¹ˆã€‚\n\næŠŠ src/app.jsçš„æ–‡ä»¶å†…å®¹å…ˆæ”¹ä¸€ä¸‹\n\n```javascript\nimport React, { Component } from 'react';\nimport logo from './logo.svg';\nimport './App.css';\n\nclass App extends Component {\n  state={\n    Text:'å¤§å®¶ä¸€èµ·çœ‹logå§ï¼Œæˆ‘è¿™æ¬¡å•¥ä¹Ÿä¸åš',\n    conut:0,\n  }\n  render() {\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <img src={logo} className=\"App-logo\" alt=\"logo\" />\n          <p>\n            Stateè¾“å‡ºï¼š{this.state.Text}\n          </p>\n          <button onClick={()=>{\n            console.log(this.state.conut);\n            this.setState({conut: this.state.conut + 1});\n            console.log(this.state.conut);\n          }}>\n            æŒ‰æˆ‘æ”¹å˜state\n          </button>\n        </header>\n      </div>\n    );\n  }\n}\n\nexport default App;\n```\n\næ‰“å¼€æˆ‘ä»¬çš„reacté¡µé¢\næŒ‰Ctrl + Shift + I\nçœ‹log\nç„¶åæŒ‰é’®\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/Reactå…¥é—¨/20181123143905811.png)\n\nè¯¶ï¼Œæˆ‘ä¸æ˜¯setStateäº†å—ï¼Œä¸ºä»€ä¹ˆå€¼æ²¡æœ‰æ”¹å˜è¿˜æ˜¯åˆå€¼å‘¢ï¼Ÿ\n\næˆ‘ä»¬æ¢ä¸€ä¸ªæ–¹æ³•è¯•ä¸€ä¸‹\n```javascript\nimport React, { Component } from 'react';\nimport logo from './logo.svg';\nimport './App.css';\n\nclass App extends Component {\n  state={\n    Text:'å¤§å®¶ä¸€èµ·çœ‹logå§ï¼Œæˆ‘è¿™æ¬¡å•¥ä¹Ÿä¸åš',\n    conut:0,\n  }\n  render() {\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <img src={logo} className=\"App-logo\" alt=\"logo\" />\n          <p>\n            Stateè¾“å‡ºï¼š{this.state.Text}\n          </p>\n          <button onClick={()=>{\n            console.log(this.state.conut);\n            this.setState({conut: this.state.conut + 1})\n            setTimeout(()=>{\n              console.log(this.state.conut);\n            },1000);\n          }}>\n            æŒ‰æˆ‘æ”¹å˜state\n          </button>\n        </header>\n      </div>\n    );\n  }\n}\n\nexport default App;\n```\n\n\né‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥è®¤ä¸ºsetStateä¸æ˜¯ä¸€ä¸ªç«‹åˆ»ç”Ÿæ•ˆçš„å‡½æ•°ã€‚\n\næœ‰ç‚¹ç±»ä¼¼å¼‚æ­¥çš„ç½‘ç»œè¯·æ±‚ã€‚\n\n\n\nè¿™æ˜¯ä¸€ä¸ªå‘ï¼Œå¾ˆå¤šæ–°æ‰‹éƒ½ä¼šé‡åˆ°çš„å‘ã€‚æˆ‘æ›¾ç»ä¹Ÿé‡åˆ°æ‰€ä»¥å†™å‡ºæ¥ã€‚\n\né‚£æ—¢ç„¶æ˜¯ç±»ä¼¼å¼‚æ­¥çš„ç½‘ç»œè¯·æ±‚è‚¯å®šä¹Ÿæœ‰callbackå’¯ï¼Ÿ\n\næ˜¯çš„ï¼\n\næˆ‘ä»¬æŠŠconsole.logæ”¾åˆ°åˆšåˆšæˆ‘ä»¬æ²¡æœ‰å†™functioné‡Œé¢ã€‚\n\n```javascript\nimport React, { Component } from 'react';\nimport logo from './logo.svg';\nimport './App.css';\n\nclass App extends Component {\n  state={\n    Text:'å¤§å®¶ä¸€èµ·çœ‹logå§ï¼Œæˆ‘è¿™æ¬¡å•¥ä¹Ÿä¸åš',\n    conut:0,\n  }\n  render() {\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <img src={logo} className=\"App-logo\" alt=\"logo\" />\n          <p>\n            Stateè¾“å‡ºï¼š{this.state.Text}\n          </p>\n          <button onClick={()=>{\n            console.log(this.state.conut);\n            this.setState({conut: this.state.conut + 1}, ()=>{\n              console.log(this.state.conut);\n            })\n            \n          }}>\n            æŒ‰æˆ‘æ”¹å˜state\n          </button>\n        </header>\n      </div>\n    );\n  }\n}\n\nexport default App;\n```\n\nè¿™æ ·çš„å¥½å¤„æˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨çš„æ§åˆ¶ç­‰å¾…æ—¶é—´çš„å¤§å°ï¼Œå› ä¸ºæ ¹æ®è®¾å¤‡çš„ä¸åŒè¿™ä¸ªæ—¶é—´å¯èƒ½ä¼šå¤ªå¤šæˆ–è€…å¤ªå°‘ã€‚\n\næœ¬äººReactå°èœï¼Œæœ‰è¯´çš„ä¸å¯¹çš„åœ°æ–¹è¿˜è¯·å¤§ç¥æŒ‡å‡ºã€‚\n","source":"_posts/React-Stateè¯¦è§£.md","raw":"---\n#æˆå¹´äººçš„å´©æºƒå¾€å¾€å°±åœ¨ä¸€ç¬é—´title: Reactå…¥é—¨ï¼ˆä¸€ï¼‰ Stateè¯¦è§£\ndate: 2019-06-19 11:22:03\ntags: [React, State]\ncategory: [React]\ncover: /image/cover/React.jpeg\n---\n\n@[TOC](Reactå…¥é—¨ï¼ˆä¸€ï¼‰ Stateè¯¦è§£)\n\n# Reactå…¥é—¨ï¼ˆä¸€ï¼‰ Stateè¯¦è§£\n\næˆ‘ä»¬éƒ½æ˜¯ç¨‹åºå‘˜ï¼ŒåºŸè¯ä¸å¤šè¯´é©¬ä¸Šå¼€å§‹ï¼\n\n## ä¸€ã€ Demoåˆ›å»º/ä¸‹è½½\n\nä¸¤ç§æ–¹æ³•åˆ›å»ºæ–°çš„React APP\n\n### 1. githubä¸‹è½½\n\n- ä¸‹è½½[gitåœ°å€](https://github.com/DerrickTel/ReactDemo1.git).\n - è§£å‹-æ‰“å¼€\n  - npm install\n  - npm start \n  - ![å¦‚æœæœ‰è¯¢é—®](/image/Reactå…¥é—¨/20181123111537542.png)\n  - yï¼ˆ3000ç«¯å£ä»»åŠ¡åœ¨è¿è¡Œæ˜¯å¦æ„¿æ„è¿è¡Œåœ¨åˆ«çš„ç«¯å£ä¸Šï¼Ÿï¼‰\n\n\n\n### 2. è‡ªå·±çš„å‘½ä»¤è¡Œåˆ›å»º\n- æ‰¾åˆ°è‡ªå·±**å¿ƒä»ªçš„æ–‡ä»¶å¤¹**   *ï¼ˆå…¨è‹±æ–‡ï¼‰*\n - ç”¨å‘½ä»¤è¡Œæ‰“å¼€å¹¶æŠµè¾¾**å¿ƒä»ªæ–‡ä»¶å¤¹**\n  - npx create-react-app my-app\n  - cd my-app\n  - npm start\n> **æ³¨æ„**\n> npxåœ¨ç¬¬ä¸€è¡Œä¸æ˜¯ä¸€ä¸ªé”™å­— - å®ƒæ˜¯ä¸€ä¸ªåŒ…è½¬å‘å·¥å…·ï¼Œé™„å¸¦npm 5.2+ã€‚\n> åˆ›å»ºçš„æ—¶å€™å·²ç»é»˜è®¤è¿è¡Œè¿‡ï¼ˆnpm install ï¼‰å¯ä»¥ç›´æ¥start\n\nç„¶åæŠŠ src/app.jsçš„æ–‡ä»¶å†…å®¹å…ˆæ”¹ä¸€ä¸‹\n\n```javascript\nimport React, { Component } from 'react';\nimport logo from './logo.svg';\nimport './App.css';\n\nclass App extends Component {\n  render() {\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <img src={logo} className=\"App-logo\" alt=\"logo\" />\n          <p>\n            Edit <code>src/App.js</code> and save to reload.\n          </p>\n          <p>\n            ä¿®æ”¹æ–‡ä»¶å¤¹ <code>src/App.js</code> ä¿å­˜æ—¶å€™ä¹‹åè‡ªåŠ¨åŠ è½½.\n          </p>\n        </header>\n      </div>\n    );\n  }\n}\n\nexport default App;\n\n```\nCtrl + C \n\nCtrl + V\n\n## äºŒã€Stateæ˜¯ä»€ä¹ˆï¼Ÿ\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/Reactå…¥é—¨/20181123134126335.png)\n\nè‹±æ–‡ç¿»è¯‘æ˜¯çŠ¶æ€ã€‚\n\nå…¶å®ä¹Ÿå¯ä»¥ç†è§£ä¸ºçŠ¶æ€ï¼Œä¸€æ®µæ–‡å­—ä¸­çš„æŸä¸ªå€¼æ”¹å˜äº†ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºçŠ¶æ€æ”¹å˜äº†ã€‚\nçœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­\n\n\næŠŠ src/app.jsçš„æ–‡ä»¶å†…å®¹å…ˆæ”¹ä¸€ä¸‹\n\n```javascript\nimport React, { Component } from 'react';\nimport logo from './logo.svg';\nimport './App.css';\n\nclass App extends Component {\n  state={Text:'æˆ‘æ˜¯state'}\n  render() {\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <img src={logo} className=\"App-logo\" alt=\"logo\" />\n          <p>\n            Stateè¾“å‡ºï¼š{this.state.Text}\n          </p>\n        </header>\n      </div>\n    );\n  }\n}\n\nexport default App;\n```\n```javascript\n  state={Text:'æˆ‘æ˜¯state'}\n```\n\nè¿™é‡Œçš„stateæ˜¯ç»™stateè®¾ç½®åˆå€¼ï¼Œä¸ç„¶ä¼šæŠ¥é”™ã€‚ä¸ç›¸ä¿¡çš„è¯è‡ªå·±å¯ä»¥è¯•ä¸€ä¸‹ã€‚*ï¼ˆå› ä¸ºstateæ˜¯undefinedï¼Œæ‰€ä»¥ä»–é‡Œé¢å–ä¸åˆ°Textï¼‰*\n\né€šè¿‡ä¸Šé¢çš„ä¾‹å­å¯ä»¥çŸ¥é“stateé‡Œé¢æ”¾çš„æ˜¯XXçš„çŠ¶æ€\n\nkey valueå¯¹åº”çš„\n\nthis.state.xxå°±å¯ä»¥å–åˆ°å¯¹åº”keyçš„**çŠ¶æ€**çš„*å€¼*\n\n\n## ä¸‰ã€Stateå¦‚ä½•æ”¹å˜ï¼Ÿ\n\né€šå¸¸åœ¨JSé‡Œé¢ï¼Œæˆ‘ä»¬è¦æ”¹å˜æŸä¸€ä¸ªå€¼å¯èƒ½å°±åªéœ€è¦  X = XX; å°±å¯ä»¥ã€‚\n\n\nè¿™é‡Œçš„stateæ˜¯ä¸€ä¸ªçŠ¶æ€ã€‚çŠ¶æ€æ”¹å˜äº†ï¼Œé¡µé¢ä¼šè‡ªåŠ¨åˆ·æ–°ä¸ºæœ€æ–°çš„é¡µé¢ç”¨æœ€æ–°çš„çŠ¶æ€æ˜¾ç¤ºã€‚\nä¸‹é¢æˆ‘ä»¬åšä¸€ä¸ªå°å®éªŒã€‚\n\n\næŠŠ src/app.jsçš„æ–‡ä»¶å†…å®¹å…ˆæ”¹ä¸€ä¸‹\n\n```javascript\nimport React, { Component } from 'react';\nimport logo from './logo.svg';\nimport './App.css';\n\nclass App extends Component {\n  state={Text:'æˆ‘æ˜¯state'}\n  render() {\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <img src={logo} className=\"App-logo\" alt=\"logo\" />\n          <p>\n            Stateè¾“å‡ºï¼š{this.state.Text}\n          </p>\n          <button onClick={()=>{\n            this.state.Text = 'æˆ‘æ˜¯é€šè¿‡this.state.Textæ”¹å˜çš„State';\n            alert(this.state.Text);\n          }}>\n            æŒ‰æˆ‘æ”¹å˜state\n          </button>\n        </header>\n      </div>\n    );\n  }\n}\n\nexport default App;\n```\n\nï¼ˆä¸è¦åœ¨æ„ç»†èŠ‚ï¼ï¼ï¼æˆ‘ä»¬æ˜¯æµ‹è¯•æŒ‰é’®çš„æ ·å¼ä¸é‡è¦ï¼ï¼ï¼ï¼‰\n\nç‚¹å‡»æŒ‰é’®ä¹‹åï¼Œæˆ‘ä»¬å‘ç°ï¼Œstateçš„å€¼æ˜¯æ”¹å˜äº†ï¼Œä½†æ˜¯é¡µé¢ä¸Šé¢æ˜¾ç¤ºçš„å€¼ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„å•Šã€‚\n\n\n\né‚£æˆ‘è¦æ€ä¹ˆæ‰å¯ä»¥åˆ·æ–°é¡µé¢å‡ºç°æˆ‘æƒ³è¦çš„stateçš„å€¼å‘¢ï¼Ÿ\n\nå®˜æ–¹æä¾›çš„æ–¹æ³•\n\nsetState(updater, [callback])\n\n\nå¯ä»¥è¿™ä¹ˆç†è§£ï¼Œé’ˆå¯¹ä¸Šé¢çš„ä¾‹å­\n\n\n```javascript\nthis.setState({Text:'æˆ‘æ˜¯é€šè¿‡this.state.Textæ”¹å˜çš„State'}, function(){})\n```\n\nåé¢çš„functionï¼Œå¯ä»¥æœ‰ï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰ã€‚ä¸éœ€è¦çš„è¯å°±å¯ä»¥ä¸ç”¨å†™-----------ç¨åä¼šè¯´\n\næ‰€ä»¥åªéœ€è¦\n\n```javascript\nthis.setState({Text:'æˆ‘æ˜¯é€šè¿‡this.state.Textæ”¹å˜çš„State'})\n```\n\n\næŠŠ src/app.jsçš„æ–‡ä»¶å†…å®¹å…ˆæ”¹ä¸€ä¸‹\n\n```javascript\nimport React, { Component } from 'react';\nimport logo from './logo.svg';\nimport './App.css';\n\nclass App extends Component {\n  state={Text:'æˆ‘æ˜¯state'}\n  render() {\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <img src={logo} className=\"App-logo\" alt=\"logo\" />\n          <p>\n            Stateè¾“å‡ºï¼š{this.state.Text}\n          </p>\n          <button onClick={()=>{\n            this.setState({Text:'æˆ‘æ˜¯é€šè¿‡this.state.Textæ”¹å˜çš„State'})\n            alert(this.state.Text);\n          }}>\n            æŒ‰æˆ‘æ”¹å˜state\n          </button>\n        </header>\n      </div>\n    );\n  }\n}\n\nexport default App;\n```\nä¿å­˜-çƒ­åŠ è½½\nä¹‹åæˆ‘ä»¬å‘ç°ï¼ŒçŠ¶æ€æ˜¯æ”¹å˜äº†ï¼Œå¯æ˜¯alertçš„å€¼ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œè¿˜æ˜¯è€çš„å€¼ï¼ˆçŠ¶æ€ï¼‰çš„ã€‚\n\nå¯èƒ½ä½ ä¸çŸ¥é“æˆ‘åœ¨è¯´ä»€ä¹ˆ\n\né€šè¿‡ä¸€ä¸ªå°ä¾‹å­æˆ‘ä»¬ä»”ç»†æ„Ÿå—ä¸€ä¸‹ã€‚å®˜æ–¹çš„setStateç©¶ç«Ÿåœ¨å¹²ä»€ä¹ˆã€‚\n\næŠŠ src/app.jsçš„æ–‡ä»¶å†…å®¹å…ˆæ”¹ä¸€ä¸‹\n\n```javascript\nimport React, { Component } from 'react';\nimport logo from './logo.svg';\nimport './App.css';\n\nclass App extends Component {\n  state={\n    Text:'å¤§å®¶ä¸€èµ·çœ‹logå§ï¼Œæˆ‘è¿™æ¬¡å•¥ä¹Ÿä¸åš',\n    conut:0,\n  }\n  render() {\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <img src={logo} className=\"App-logo\" alt=\"logo\" />\n          <p>\n            Stateè¾“å‡ºï¼š{this.state.Text}\n          </p>\n          <button onClick={()=>{\n            console.log(this.state.conut);\n            this.setState({conut: this.state.conut + 1});\n            console.log(this.state.conut);\n          }}>\n            æŒ‰æˆ‘æ”¹å˜state\n          </button>\n        </header>\n      </div>\n    );\n  }\n}\n\nexport default App;\n```\n\næ‰“å¼€æˆ‘ä»¬çš„reacté¡µé¢\næŒ‰Ctrl + Shift + I\nçœ‹log\nç„¶åæŒ‰é’®\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/Reactå…¥é—¨/20181123143905811.png)\n\nè¯¶ï¼Œæˆ‘ä¸æ˜¯setStateäº†å—ï¼Œä¸ºä»€ä¹ˆå€¼æ²¡æœ‰æ”¹å˜è¿˜æ˜¯åˆå€¼å‘¢ï¼Ÿ\n\næˆ‘ä»¬æ¢ä¸€ä¸ªæ–¹æ³•è¯•ä¸€ä¸‹\n```javascript\nimport React, { Component } from 'react';\nimport logo from './logo.svg';\nimport './App.css';\n\nclass App extends Component {\n  state={\n    Text:'å¤§å®¶ä¸€èµ·çœ‹logå§ï¼Œæˆ‘è¿™æ¬¡å•¥ä¹Ÿä¸åš',\n    conut:0,\n  }\n  render() {\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <img src={logo} className=\"App-logo\" alt=\"logo\" />\n          <p>\n            Stateè¾“å‡ºï¼š{this.state.Text}\n          </p>\n          <button onClick={()=>{\n            console.log(this.state.conut);\n            this.setState({conut: this.state.conut + 1})\n            setTimeout(()=>{\n              console.log(this.state.conut);\n            },1000);\n          }}>\n            æŒ‰æˆ‘æ”¹å˜state\n          </button>\n        </header>\n      </div>\n    );\n  }\n}\n\nexport default App;\n```\n\n\né‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥è®¤ä¸ºsetStateä¸æ˜¯ä¸€ä¸ªç«‹åˆ»ç”Ÿæ•ˆçš„å‡½æ•°ã€‚\n\næœ‰ç‚¹ç±»ä¼¼å¼‚æ­¥çš„ç½‘ç»œè¯·æ±‚ã€‚\n\n\n\nè¿™æ˜¯ä¸€ä¸ªå‘ï¼Œå¾ˆå¤šæ–°æ‰‹éƒ½ä¼šé‡åˆ°çš„å‘ã€‚æˆ‘æ›¾ç»ä¹Ÿé‡åˆ°æ‰€ä»¥å†™å‡ºæ¥ã€‚\n\né‚£æ—¢ç„¶æ˜¯ç±»ä¼¼å¼‚æ­¥çš„ç½‘ç»œè¯·æ±‚è‚¯å®šä¹Ÿæœ‰callbackå’¯ï¼Ÿ\n\næ˜¯çš„ï¼\n\næˆ‘ä»¬æŠŠconsole.logæ”¾åˆ°åˆšåˆšæˆ‘ä»¬æ²¡æœ‰å†™functioné‡Œé¢ã€‚\n\n```javascript\nimport React, { Component } from 'react';\nimport logo from './logo.svg';\nimport './App.css';\n\nclass App extends Component {\n  state={\n    Text:'å¤§å®¶ä¸€èµ·çœ‹logå§ï¼Œæˆ‘è¿™æ¬¡å•¥ä¹Ÿä¸åš',\n    conut:0,\n  }\n  render() {\n    return (\n      <div className=\"App\">\n        <header className=\"App-header\">\n          <img src={logo} className=\"App-logo\" alt=\"logo\" />\n          <p>\n            Stateè¾“å‡ºï¼š{this.state.Text}\n          </p>\n          <button onClick={()=>{\n            console.log(this.state.conut);\n            this.setState({conut: this.state.conut + 1}, ()=>{\n              console.log(this.state.conut);\n            })\n            \n          }}>\n            æŒ‰æˆ‘æ”¹å˜state\n          </button>\n        </header>\n      </div>\n    );\n  }\n}\n\nexport default App;\n```\n\nè¿™æ ·çš„å¥½å¤„æˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨çš„æ§åˆ¶ç­‰å¾…æ—¶é—´çš„å¤§å°ï¼Œå› ä¸ºæ ¹æ®è®¾å¤‡çš„ä¸åŒè¿™ä¸ªæ—¶é—´å¯èƒ½ä¼šå¤ªå¤šæˆ–è€…å¤ªå°‘ã€‚\n\næœ¬äººReactå°èœï¼Œæœ‰è¯´çš„ä¸å¯¹çš„åœ°æ–¹è¿˜è¯·å¤§ç¥æŒ‡å‡ºã€‚\n","slug":"React-Stateè¯¦è§£","published":1,"updated":"2021-06-24T14:00:06.847Z","title":"React-Stateè¯¦è§£","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra7p0007lwrdgy43c737","content":"<p>@[TOC](Reactå…¥é—¨ï¼ˆä¸€ï¼‰ Stateè¯¦è§£)</p>\n<h1 id=\"Reactå…¥é—¨ï¼ˆä¸€ï¼‰-Stateè¯¦è§£\"><a href=\"#Reactå…¥é—¨ï¼ˆä¸€ï¼‰-Stateè¯¦è§£\" class=\"headerlink\" title=\"Reactå…¥é—¨ï¼ˆä¸€ï¼‰ Stateè¯¦è§£\"></a>Reactå…¥é—¨ï¼ˆä¸€ï¼‰ Stateè¯¦è§£</h1><p>æˆ‘ä»¬éƒ½æ˜¯ç¨‹åºå‘˜ï¼ŒåºŸè¯ä¸å¤šè¯´é©¬ä¸Šå¼€å§‹ï¼</p>\n<h2 id=\"ä¸€ã€-Demoåˆ›å»º-ä¸‹è½½\"><a href=\"#ä¸€ã€-Demoåˆ›å»º-ä¸‹è½½\" class=\"headerlink\" title=\"ä¸€ã€ Demoåˆ›å»º/ä¸‹è½½\"></a>ä¸€ã€ Demoåˆ›å»º/ä¸‹è½½</h2><p>ä¸¤ç§æ–¹æ³•åˆ›å»ºæ–°çš„React APP</p>\n<h3 id=\"1-githubä¸‹è½½\"><a href=\"#1-githubä¸‹è½½\" class=\"headerlink\" title=\"1. githubä¸‹è½½\"></a>1. githubä¸‹è½½</h3><ul>\n<li>ä¸‹è½½<a href=\"https://github.com/DerrickTel/ReactDemo1.git\" target=\"_blank\" rel=\"noopener\">gitåœ°å€</a>.<ul>\n<li>è§£å‹-æ‰“å¼€</li>\n<li>npm install</li>\n<li>npm start </li>\n<li><img src=\"/\" class=\"lazyload\" data-src=\"/image/React%E5%85%A5%E9%97%A8/20181123111537542.png\"  alt=\"å¦‚æœæœ‰è¯¢é—®\"></li>\n<li>yï¼ˆ3000ç«¯å£ä»»åŠ¡åœ¨è¿è¡Œæ˜¯å¦æ„¿æ„è¿è¡Œåœ¨åˆ«çš„ç«¯å£ä¸Šï¼Ÿï¼‰</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"2-è‡ªå·±çš„å‘½ä»¤è¡Œåˆ›å»º\"><a href=\"#2-è‡ªå·±çš„å‘½ä»¤è¡Œåˆ›å»º\" class=\"headerlink\" title=\"2. è‡ªå·±çš„å‘½ä»¤è¡Œåˆ›å»º\"></a>2. è‡ªå·±çš„å‘½ä»¤è¡Œåˆ›å»º</h3><ul>\n<li>æ‰¾åˆ°è‡ªå·±<strong>å¿ƒä»ªçš„æ–‡ä»¶å¤¹</strong>   <em>ï¼ˆå…¨è‹±æ–‡ï¼‰</em><ul>\n<li>ç”¨å‘½ä»¤è¡Œæ‰“å¼€å¹¶æŠµè¾¾<strong>å¿ƒä»ªæ–‡ä»¶å¤¹</strong></li>\n<li>npx create-react-app my-app</li>\n<li>cd my-app</li>\n<li>npm start<blockquote>\n<p><strong>æ³¨æ„</strong><br>npxåœ¨ç¬¬ä¸€è¡Œä¸æ˜¯ä¸€ä¸ªé”™å­— - å®ƒæ˜¯ä¸€ä¸ªåŒ…è½¬å‘å·¥å…·ï¼Œé™„å¸¦npm 5.2+ã€‚<br>åˆ›å»ºçš„æ—¶å€™å·²ç»é»˜è®¤è¿è¡Œè¿‡ï¼ˆnpm install ï¼‰å¯ä»¥ç›´æ¥start</p>\n</blockquote>\n</li>\n</ul>\n</li>\n</ul>\n<p>ç„¶åæŠŠ src/app.jsçš„æ–‡ä»¶å†…å®¹å…ˆæ”¹ä¸€ä¸‹</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; Component &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> logo <span class=\"keyword\">from</span> <span class=\"string\">'./logo.svg'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'./App.css'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">App</span> <span class=\"keyword\">extends</span> <span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;div className=<span class=\"string\">\"App\"</span>&gt;</span><br><span class=\"line\">        &lt;header className=<span class=\"string\">\"App-header\"</span>&gt;</span><br><span class=\"line\">          &lt;img src=&#123;logo&#125; className=<span class=\"string\">\"App-logo\"</span> alt=<span class=\"string\">\"logo\"</span> /&gt;</span><br><span class=\"line\">          &lt;p&gt;</span><br><span class=\"line\">            Edit &lt;code&gt;src/App.js&lt;<span class=\"regexp\">/code&gt; and save to reload.</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;/</span>p&gt;</span><br><span class=\"line\">          &lt;p&gt;</span><br><span class=\"line\">            ä¿®æ”¹æ–‡ä»¶å¤¹ &lt;code&gt;src/App.js&lt;<span class=\"regexp\">/code&gt; ä¿å­˜æ—¶å€™ä¹‹åè‡ªåŠ¨åŠ è½½.</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;/</span>p&gt;</span><br><span class=\"line\">        &lt;<span class=\"regexp\">/header&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;/</span>div&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> App;</span><br></pre></td></tr></table></figure>\n<p>Ctrl + C </p>\n<p>Ctrl + V</p>\n<h2 id=\"äºŒã€Stateæ˜¯ä»€ä¹ˆï¼Ÿ\"><a href=\"#äºŒã€Stateæ˜¯ä»€ä¹ˆï¼Ÿ\" class=\"headerlink\" title=\"äºŒã€Stateæ˜¯ä»€ä¹ˆï¼Ÿ\"></a>äºŒã€Stateæ˜¯ä»€ä¹ˆï¼Ÿ</h2><p><img src=\"/\" class=\"lazyload\" data-src=\"/image/React%E5%85%A5%E9%97%A8/20181123134126335.png\"  alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<p>è‹±æ–‡ç¿»è¯‘æ˜¯çŠ¶æ€ã€‚</p>\n<p>å…¶å®ä¹Ÿå¯ä»¥ç†è§£ä¸ºçŠ¶æ€ï¼Œä¸€æ®µæ–‡å­—ä¸­çš„æŸä¸ªå€¼æ”¹å˜äº†ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºçŠ¶æ€æ”¹å˜äº†ã€‚<br>çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­</p>\n<p>æŠŠ src/app.jsçš„æ–‡ä»¶å†…å®¹å…ˆæ”¹ä¸€ä¸‹</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; Component &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> logo <span class=\"keyword\">from</span> <span class=\"string\">'./logo.svg'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'./App.css'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">App</span> <span class=\"keyword\">extends</span> <span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  state=&#123;<span class=\"attr\">Text</span>:<span class=\"string\">'æˆ‘æ˜¯state'</span>&#125;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;div className=<span class=\"string\">\"App\"</span>&gt;</span><br><span class=\"line\">        &lt;header className=<span class=\"string\">\"App-header\"</span>&gt;</span><br><span class=\"line\">          &lt;img src=&#123;logo&#125; className=<span class=\"string\">\"App-logo\"</span> alt=<span class=\"string\">\"logo\"</span> /&gt;</span><br><span class=\"line\">          &lt;p&gt;</span><br><span class=\"line\">            Stateè¾“å‡ºï¼š&#123;<span class=\"keyword\">this</span>.state.Text&#125;</span><br><span class=\"line\">          &lt;<span class=\"regexp\">/p&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        &lt;/</span>header&gt;</span><br><span class=\"line\">      &lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    );</span></span><br><span class=\"line\"><span class=\"regexp\">  &#125;</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">export default App;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">state=&#123;<span class=\"attr\">Text</span>:<span class=\"string\">'æˆ‘æ˜¯state'</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>è¿™é‡Œçš„stateæ˜¯ç»™stateè®¾ç½®åˆå€¼ï¼Œä¸ç„¶ä¼šæŠ¥é”™ã€‚ä¸ç›¸ä¿¡çš„è¯è‡ªå·±å¯ä»¥è¯•ä¸€ä¸‹ã€‚<em>ï¼ˆå› ä¸ºstateæ˜¯undefinedï¼Œæ‰€ä»¥ä»–é‡Œé¢å–ä¸åˆ°Textï¼‰</em></p>\n<p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­å¯ä»¥çŸ¥é“stateé‡Œé¢æ”¾çš„æ˜¯XXçš„çŠ¶æ€</p>\n<p>key valueå¯¹åº”çš„</p>\n<p>this.state.xxå°±å¯ä»¥å–åˆ°å¯¹åº”keyçš„<strong>çŠ¶æ€</strong>çš„<em>å€¼</em></p>\n<h2 id=\"ä¸‰ã€Stateå¦‚ä½•æ”¹å˜ï¼Ÿ\"><a href=\"#ä¸‰ã€Stateå¦‚ä½•æ”¹å˜ï¼Ÿ\" class=\"headerlink\" title=\"ä¸‰ã€Stateå¦‚ä½•æ”¹å˜ï¼Ÿ\"></a>ä¸‰ã€Stateå¦‚ä½•æ”¹å˜ï¼Ÿ</h2><p>é€šå¸¸åœ¨JSé‡Œé¢ï¼Œæˆ‘ä»¬è¦æ”¹å˜æŸä¸€ä¸ªå€¼å¯èƒ½å°±åªéœ€è¦  X = XX; å°±å¯ä»¥ã€‚</p>\n<p>è¿™é‡Œçš„stateæ˜¯ä¸€ä¸ªçŠ¶æ€ã€‚çŠ¶æ€æ”¹å˜äº†ï¼Œé¡µé¢ä¼šè‡ªåŠ¨åˆ·æ–°ä¸ºæœ€æ–°çš„é¡µé¢ç”¨æœ€æ–°çš„çŠ¶æ€æ˜¾ç¤ºã€‚<br>ä¸‹é¢æˆ‘ä»¬åšä¸€ä¸ªå°å®éªŒã€‚</p>\n<p>æŠŠ src/app.jsçš„æ–‡ä»¶å†…å®¹å…ˆæ”¹ä¸€ä¸‹</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; Component &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> logo <span class=\"keyword\">from</span> <span class=\"string\">'./logo.svg'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'./App.css'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">App</span> <span class=\"keyword\">extends</span> <span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  state=&#123;<span class=\"attr\">Text</span>:<span class=\"string\">'æˆ‘æ˜¯state'</span>&#125;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;div className=<span class=\"string\">\"App\"</span>&gt;</span><br><span class=\"line\">        &lt;header className=<span class=\"string\">\"App-header\"</span>&gt;</span><br><span class=\"line\">          &lt;img src=&#123;logo&#125; className=<span class=\"string\">\"App-logo\"</span> alt=<span class=\"string\">\"logo\"</span> /&gt;</span><br><span class=\"line\">          &lt;p&gt;</span><br><span class=\"line\">            Stateè¾“å‡ºï¼š&#123;<span class=\"keyword\">this</span>.state.Text&#125;</span><br><span class=\"line\">          &lt;<span class=\"regexp\">/p&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;button onClick=&#123;()=&gt;&#123;</span></span><br><span class=\"line\"><span class=\"regexp\">            this.state.Text = 'æˆ‘æ˜¯é€šè¿‡this.state.Textæ”¹å˜çš„State';</span></span><br><span class=\"line\"><span class=\"regexp\">            alert(this.state.Text);</span></span><br><span class=\"line\"><span class=\"regexp\">          &#125;&#125;&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">            æŒ‰æˆ‘æ”¹å˜state</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;/</span>button&gt;</span><br><span class=\"line\">        &lt;<span class=\"regexp\">/header&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;/</span>div&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> App;</span><br></pre></td></tr></table></figure>\n\n<p>ï¼ˆä¸è¦åœ¨æ„ç»†èŠ‚ï¼ï¼ï¼æˆ‘ä»¬æ˜¯æµ‹è¯•æŒ‰é’®çš„æ ·å¼ä¸é‡è¦ï¼ï¼ï¼ï¼‰</p>\n<p>ç‚¹å‡»æŒ‰é’®ä¹‹åï¼Œæˆ‘ä»¬å‘ç°ï¼Œstateçš„å€¼æ˜¯æ”¹å˜äº†ï¼Œä½†æ˜¯é¡µé¢ä¸Šé¢æ˜¾ç¤ºçš„å€¼ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„å•Šã€‚</p>\n<p>é‚£æˆ‘è¦æ€ä¹ˆæ‰å¯ä»¥åˆ·æ–°é¡µé¢å‡ºç°æˆ‘æƒ³è¦çš„stateçš„å€¼å‘¢ï¼Ÿ</p>\n<p>å®˜æ–¹æä¾›çš„æ–¹æ³•</p>\n<p>setState(updater, [callback])</p>\n<p>å¯ä»¥è¿™ä¹ˆç†è§£ï¼Œé’ˆå¯¹ä¸Šé¢çš„ä¾‹å­</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">this</span>.setState(&#123;<span class=\"attr\">Text</span>:<span class=\"string\">'æˆ‘æ˜¯é€šè¿‡this.state.Textæ”¹å˜çš„State'</span>&#125;, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>åé¢çš„functionï¼Œå¯ä»¥æœ‰ï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰ã€‚ä¸éœ€è¦çš„è¯å°±å¯ä»¥ä¸ç”¨å†™â€”â€”â€”â€“ç¨åä¼šè¯´</p>\n<p>æ‰€ä»¥åªéœ€è¦</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">this</span>.setState(&#123;<span class=\"attr\">Text</span>:<span class=\"string\">'æˆ‘æ˜¯é€šè¿‡this.state.Textæ”¹å˜çš„State'</span>&#125;)</span><br></pre></td></tr></table></figure>\n\n\n<p>æŠŠ src/app.jsçš„æ–‡ä»¶å†…å®¹å…ˆæ”¹ä¸€ä¸‹</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; Component &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> logo <span class=\"keyword\">from</span> <span class=\"string\">'./logo.svg'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'./App.css'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">App</span> <span class=\"keyword\">extends</span> <span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  state=&#123;<span class=\"attr\">Text</span>:<span class=\"string\">'æˆ‘æ˜¯state'</span>&#125;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;div className=<span class=\"string\">\"App\"</span>&gt;</span><br><span class=\"line\">        &lt;header className=<span class=\"string\">\"App-header\"</span>&gt;</span><br><span class=\"line\">          &lt;img src=&#123;logo&#125; className=<span class=\"string\">\"App-logo\"</span> alt=<span class=\"string\">\"logo\"</span> /&gt;</span><br><span class=\"line\">          &lt;p&gt;</span><br><span class=\"line\">            Stateè¾“å‡ºï¼š&#123;<span class=\"keyword\">this</span>.state.Text&#125;</span><br><span class=\"line\">          &lt;<span class=\"regexp\">/p&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;button onClick=&#123;()=&gt;&#123;</span></span><br><span class=\"line\"><span class=\"regexp\">            this.setState(&#123;Text:'æˆ‘æ˜¯é€šè¿‡this.state.Textæ”¹å˜çš„State'&#125;)</span></span><br><span class=\"line\"><span class=\"regexp\">            alert(this.state.Text);</span></span><br><span class=\"line\"><span class=\"regexp\">          &#125;&#125;&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">            æŒ‰æˆ‘æ”¹å˜state</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;/</span>button&gt;</span><br><span class=\"line\">        &lt;<span class=\"regexp\">/header&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;/</span>div&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> App;</span><br></pre></td></tr></table></figure>\n<p>ä¿å­˜-çƒ­åŠ è½½<br>ä¹‹åæˆ‘ä»¬å‘ç°ï¼ŒçŠ¶æ€æ˜¯æ”¹å˜äº†ï¼Œå¯æ˜¯alertçš„å€¼ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œè¿˜æ˜¯è€çš„å€¼ï¼ˆçŠ¶æ€ï¼‰çš„ã€‚</p>\n<p>å¯èƒ½ä½ ä¸çŸ¥é“æˆ‘åœ¨è¯´ä»€ä¹ˆ</p>\n<p>é€šè¿‡ä¸€ä¸ªå°ä¾‹å­æˆ‘ä»¬ä»”ç»†æ„Ÿå—ä¸€ä¸‹ã€‚å®˜æ–¹çš„setStateç©¶ç«Ÿåœ¨å¹²ä»€ä¹ˆã€‚</p>\n<p>æŠŠ src/app.jsçš„æ–‡ä»¶å†…å®¹å…ˆæ”¹ä¸€ä¸‹</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; Component &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> logo <span class=\"keyword\">from</span> <span class=\"string\">'./logo.svg'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'./App.css'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">App</span> <span class=\"keyword\">extends</span> <span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  state=&#123;</span><br><span class=\"line\">    Text:<span class=\"string\">'å¤§å®¶ä¸€èµ·çœ‹logå§ï¼Œæˆ‘è¿™æ¬¡å•¥ä¹Ÿä¸åš'</span>,</span><br><span class=\"line\">    conut:<span class=\"number\">0</span>,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;div className=<span class=\"string\">\"App\"</span>&gt;</span><br><span class=\"line\">        &lt;header className=<span class=\"string\">\"App-header\"</span>&gt;</span><br><span class=\"line\">          &lt;img src=&#123;logo&#125; className=<span class=\"string\">\"App-logo\"</span> alt=<span class=\"string\">\"logo\"</span> /&gt;</span><br><span class=\"line\">          &lt;p&gt;</span><br><span class=\"line\">            Stateè¾“å‡ºï¼š&#123;<span class=\"keyword\">this</span>.state.Text&#125;</span><br><span class=\"line\">          &lt;<span class=\"regexp\">/p&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;button onClick=&#123;()=&gt;&#123;</span></span><br><span class=\"line\"><span class=\"regexp\">            console.log(this.state.conut);</span></span><br><span class=\"line\"><span class=\"regexp\">            this.setState(&#123;conut: this.state.conut + 1&#125;);</span></span><br><span class=\"line\"><span class=\"regexp\">            console.log(this.state.conut);</span></span><br><span class=\"line\"><span class=\"regexp\">          &#125;&#125;&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">            æŒ‰æˆ‘æ”¹å˜state</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;/</span>button&gt;</span><br><span class=\"line\">        &lt;<span class=\"regexp\">/header&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;/</span>div&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> App;</span><br></pre></td></tr></table></figure>\n\n<p>æ‰“å¼€æˆ‘ä»¬çš„reacté¡µé¢<br>æŒ‰Ctrl + Shift + I<br>çœ‹log<br>ç„¶åæŒ‰é’®</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/React%E5%85%A5%E9%97%A8/20181123143905811.png\"  alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<p>è¯¶ï¼Œæˆ‘ä¸æ˜¯setStateäº†å—ï¼Œä¸ºä»€ä¹ˆå€¼æ²¡æœ‰æ”¹å˜è¿˜æ˜¯åˆå€¼å‘¢ï¼Ÿ</p>\n<p>æˆ‘ä»¬æ¢ä¸€ä¸ªæ–¹æ³•è¯•ä¸€ä¸‹</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; Component &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> logo <span class=\"keyword\">from</span> <span class=\"string\">'./logo.svg'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'./App.css'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">App</span> <span class=\"keyword\">extends</span> <span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  state=&#123;</span><br><span class=\"line\">    Text:<span class=\"string\">'å¤§å®¶ä¸€èµ·çœ‹logå§ï¼Œæˆ‘è¿™æ¬¡å•¥ä¹Ÿä¸åš'</span>,</span><br><span class=\"line\">    conut:<span class=\"number\">0</span>,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;div className=<span class=\"string\">\"App\"</span>&gt;</span><br><span class=\"line\">        &lt;header className=<span class=\"string\">\"App-header\"</span>&gt;</span><br><span class=\"line\">          &lt;img src=&#123;logo&#125; className=<span class=\"string\">\"App-logo\"</span> alt=<span class=\"string\">\"logo\"</span> /&gt;</span><br><span class=\"line\">          &lt;p&gt;</span><br><span class=\"line\">            Stateè¾“å‡ºï¼š&#123;<span class=\"keyword\">this</span>.state.Text&#125;</span><br><span class=\"line\">          &lt;<span class=\"regexp\">/p&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;button onClick=&#123;()=&gt;&#123;</span></span><br><span class=\"line\"><span class=\"regexp\">            console.log(this.state.conut);</span></span><br><span class=\"line\"><span class=\"regexp\">            this.setState(&#123;conut: this.state.conut + 1&#125;)</span></span><br><span class=\"line\"><span class=\"regexp\">            setTimeout(()=&gt;&#123;</span></span><br><span class=\"line\"><span class=\"regexp\">              console.log(this.state.conut);</span></span><br><span class=\"line\"><span class=\"regexp\">            &#125;,1000);</span></span><br><span class=\"line\"><span class=\"regexp\">          &#125;&#125;&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">            æŒ‰æˆ‘æ”¹å˜state</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;/</span>button&gt;</span><br><span class=\"line\">        &lt;<span class=\"regexp\">/header&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;/</span>div&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> App;</span><br></pre></td></tr></table></figure>\n\n\n<p>é‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥è®¤ä¸ºsetStateä¸æ˜¯ä¸€ä¸ªç«‹åˆ»ç”Ÿæ•ˆçš„å‡½æ•°ã€‚</p>\n<p>æœ‰ç‚¹ç±»ä¼¼å¼‚æ­¥çš„ç½‘ç»œè¯·æ±‚ã€‚</p>\n<p>è¿™æ˜¯ä¸€ä¸ªå‘ï¼Œå¾ˆå¤šæ–°æ‰‹éƒ½ä¼šé‡åˆ°çš„å‘ã€‚æˆ‘æ›¾ç»ä¹Ÿé‡åˆ°æ‰€ä»¥å†™å‡ºæ¥ã€‚</p>\n<p>é‚£æ—¢ç„¶æ˜¯ç±»ä¼¼å¼‚æ­¥çš„ç½‘ç»œè¯·æ±‚è‚¯å®šä¹Ÿæœ‰callbackå’¯ï¼Ÿ</p>\n<p>æ˜¯çš„ï¼</p>\n<p>æˆ‘ä»¬æŠŠconsole.logæ”¾åˆ°åˆšåˆšæˆ‘ä»¬æ²¡æœ‰å†™functioné‡Œé¢ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; Component &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> logo <span class=\"keyword\">from</span> <span class=\"string\">'./logo.svg'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'./App.css'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">App</span> <span class=\"keyword\">extends</span> <span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  state=&#123;</span><br><span class=\"line\">    Text:<span class=\"string\">'å¤§å®¶ä¸€èµ·çœ‹logå§ï¼Œæˆ‘è¿™æ¬¡å•¥ä¹Ÿä¸åš'</span>,</span><br><span class=\"line\">    conut:<span class=\"number\">0</span>,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;div className=<span class=\"string\">\"App\"</span>&gt;</span><br><span class=\"line\">        &lt;header className=<span class=\"string\">\"App-header\"</span>&gt;</span><br><span class=\"line\">          &lt;img src=&#123;logo&#125; className=<span class=\"string\">\"App-logo\"</span> alt=<span class=\"string\">\"logo\"</span> /&gt;</span><br><span class=\"line\">          &lt;p&gt;</span><br><span class=\"line\">            Stateè¾“å‡ºï¼š&#123;<span class=\"keyword\">this</span>.state.Text&#125;</span><br><span class=\"line\">          &lt;<span class=\"regexp\">/p&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;button onClick=&#123;()=&gt;&#123;</span></span><br><span class=\"line\"><span class=\"regexp\">            console.log(this.state.conut);</span></span><br><span class=\"line\"><span class=\"regexp\">            this.setState(&#123;conut: this.state.conut + 1&#125;, ()=&gt;&#123;</span></span><br><span class=\"line\"><span class=\"regexp\">              console.log(this.state.conut);</span></span><br><span class=\"line\"><span class=\"regexp\">            &#125;)</span></span><br><span class=\"line\"><span class=\"regexp\">            </span></span><br><span class=\"line\"><span class=\"regexp\">          &#125;&#125;&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">            æŒ‰æˆ‘æ”¹å˜state</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;/</span>button&gt;</span><br><span class=\"line\">        &lt;<span class=\"regexp\">/header&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;/</span>div&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> App;</span><br></pre></td></tr></table></figure>\n\n<p>è¿™æ ·çš„å¥½å¤„æˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨çš„æ§åˆ¶ç­‰å¾…æ—¶é—´çš„å¤§å°ï¼Œå› ä¸ºæ ¹æ®è®¾å¤‡çš„ä¸åŒè¿™ä¸ªæ—¶é—´å¯èƒ½ä¼šå¤ªå¤šæˆ–è€…å¤ªå°‘ã€‚</p>\n<p>æœ¬äººReactå°èœï¼Œæœ‰è¯´çš„ä¸å¯¹çš„åœ°æ–¹è¿˜è¯·å¤§ç¥æŒ‡å‡ºã€‚</p>\n","site":{"data":{}},"excerpt":"","more":"<p>@[TOC](Reactå…¥é—¨ï¼ˆä¸€ï¼‰ Stateè¯¦è§£)</p>\n<h1 id=\"Reactå…¥é—¨ï¼ˆä¸€ï¼‰-Stateè¯¦è§£\"><a href=\"#Reactå…¥é—¨ï¼ˆä¸€ï¼‰-Stateè¯¦è§£\" class=\"headerlink\" title=\"Reactå…¥é—¨ï¼ˆä¸€ï¼‰ Stateè¯¦è§£\"></a>Reactå…¥é—¨ï¼ˆä¸€ï¼‰ Stateè¯¦è§£</h1><p>æˆ‘ä»¬éƒ½æ˜¯ç¨‹åºå‘˜ï¼ŒåºŸè¯ä¸å¤šè¯´é©¬ä¸Šå¼€å§‹ï¼</p>\n<h2 id=\"ä¸€ã€-Demoåˆ›å»º-ä¸‹è½½\"><a href=\"#ä¸€ã€-Demoåˆ›å»º-ä¸‹è½½\" class=\"headerlink\" title=\"ä¸€ã€ Demoåˆ›å»º/ä¸‹è½½\"></a>ä¸€ã€ Demoåˆ›å»º/ä¸‹è½½</h2><p>ä¸¤ç§æ–¹æ³•åˆ›å»ºæ–°çš„React APP</p>\n<h3 id=\"1-githubä¸‹è½½\"><a href=\"#1-githubä¸‹è½½\" class=\"headerlink\" title=\"1. githubä¸‹è½½\"></a>1. githubä¸‹è½½</h3><ul>\n<li>ä¸‹è½½<a href=\"https://github.com/DerrickTel/ReactDemo1.git\" target=\"_blank\" rel=\"noopener\">gitåœ°å€</a>.<ul>\n<li>è§£å‹-æ‰“å¼€</li>\n<li>npm install</li>\n<li>npm start </li>\n<li><img src=\"/image/React%E5%85%A5%E9%97%A8/20181123111537542.png\" alt=\"å¦‚æœæœ‰è¯¢é—®\"></li>\n<li>yï¼ˆ3000ç«¯å£ä»»åŠ¡åœ¨è¿è¡Œæ˜¯å¦æ„¿æ„è¿è¡Œåœ¨åˆ«çš„ç«¯å£ä¸Šï¼Ÿï¼‰</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"2-è‡ªå·±çš„å‘½ä»¤è¡Œåˆ›å»º\"><a href=\"#2-è‡ªå·±çš„å‘½ä»¤è¡Œåˆ›å»º\" class=\"headerlink\" title=\"2. è‡ªå·±çš„å‘½ä»¤è¡Œåˆ›å»º\"></a>2. è‡ªå·±çš„å‘½ä»¤è¡Œåˆ›å»º</h3><ul>\n<li>æ‰¾åˆ°è‡ªå·±<strong>å¿ƒä»ªçš„æ–‡ä»¶å¤¹</strong>   <em>ï¼ˆå…¨è‹±æ–‡ï¼‰</em><ul>\n<li>ç”¨å‘½ä»¤è¡Œæ‰“å¼€å¹¶æŠµè¾¾<strong>å¿ƒä»ªæ–‡ä»¶å¤¹</strong></li>\n<li>npx create-react-app my-app</li>\n<li>cd my-app</li>\n<li>npm start<blockquote>\n<p><strong>æ³¨æ„</strong><br>npxåœ¨ç¬¬ä¸€è¡Œä¸æ˜¯ä¸€ä¸ªé”™å­— - å®ƒæ˜¯ä¸€ä¸ªåŒ…è½¬å‘å·¥å…·ï¼Œé™„å¸¦npm 5.2+ã€‚<br>åˆ›å»ºçš„æ—¶å€™å·²ç»é»˜è®¤è¿è¡Œè¿‡ï¼ˆnpm install ï¼‰å¯ä»¥ç›´æ¥start</p>\n</blockquote>\n</li>\n</ul>\n</li>\n</ul>\n<p>ç„¶åæŠŠ src/app.jsçš„æ–‡ä»¶å†…å®¹å…ˆæ”¹ä¸€ä¸‹</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; Component &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> logo <span class=\"keyword\">from</span> <span class=\"string\">'./logo.svg'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'./App.css'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">App</span> <span class=\"keyword\">extends</span> <span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;div className=<span class=\"string\">\"App\"</span>&gt;</span><br><span class=\"line\">        &lt;header className=<span class=\"string\">\"App-header\"</span>&gt;</span><br><span class=\"line\">          &lt;img src=&#123;logo&#125; className=<span class=\"string\">\"App-logo\"</span> alt=<span class=\"string\">\"logo\"</span> /&gt;</span><br><span class=\"line\">          &lt;p&gt;</span><br><span class=\"line\">            Edit &lt;code&gt;src/App.js&lt;<span class=\"regexp\">/code&gt; and save to reload.</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;/</span>p&gt;</span><br><span class=\"line\">          &lt;p&gt;</span><br><span class=\"line\">            ä¿®æ”¹æ–‡ä»¶å¤¹ &lt;code&gt;src/App.js&lt;<span class=\"regexp\">/code&gt; ä¿å­˜æ—¶å€™ä¹‹åè‡ªåŠ¨åŠ è½½.</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;/</span>p&gt;</span><br><span class=\"line\">        &lt;<span class=\"regexp\">/header&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;/</span>div&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> App;</span><br></pre></td></tr></table></figure>\n<p>Ctrl + C </p>\n<p>Ctrl + V</p>\n<h2 id=\"äºŒã€Stateæ˜¯ä»€ä¹ˆï¼Ÿ\"><a href=\"#äºŒã€Stateæ˜¯ä»€ä¹ˆï¼Ÿ\" class=\"headerlink\" title=\"äºŒã€Stateæ˜¯ä»€ä¹ˆï¼Ÿ\"></a>äºŒã€Stateæ˜¯ä»€ä¹ˆï¼Ÿ</h2><p><img src=\"/image/React%E5%85%A5%E9%97%A8/20181123134126335.png\" alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<p>è‹±æ–‡ç¿»è¯‘æ˜¯çŠ¶æ€ã€‚</p>\n<p>å…¶å®ä¹Ÿå¯ä»¥ç†è§£ä¸ºçŠ¶æ€ï¼Œä¸€æ®µæ–‡å­—ä¸­çš„æŸä¸ªå€¼æ”¹å˜äº†ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºçŠ¶æ€æ”¹å˜äº†ã€‚<br>çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­</p>\n<p>æŠŠ src/app.jsçš„æ–‡ä»¶å†…å®¹å…ˆæ”¹ä¸€ä¸‹</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; Component &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> logo <span class=\"keyword\">from</span> <span class=\"string\">'./logo.svg'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'./App.css'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">App</span> <span class=\"keyword\">extends</span> <span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  state=&#123;<span class=\"attr\">Text</span>:<span class=\"string\">'æˆ‘æ˜¯state'</span>&#125;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;div className=<span class=\"string\">\"App\"</span>&gt;</span><br><span class=\"line\">        &lt;header className=<span class=\"string\">\"App-header\"</span>&gt;</span><br><span class=\"line\">          &lt;img src=&#123;logo&#125; className=<span class=\"string\">\"App-logo\"</span> alt=<span class=\"string\">\"logo\"</span> /&gt;</span><br><span class=\"line\">          &lt;p&gt;</span><br><span class=\"line\">            Stateè¾“å‡ºï¼š&#123;<span class=\"keyword\">this</span>.state.Text&#125;</span><br><span class=\"line\">          &lt;<span class=\"regexp\">/p&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        &lt;/</span>header&gt;</span><br><span class=\"line\">      &lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    );</span></span><br><span class=\"line\"><span class=\"regexp\">  &#125;</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">export default App;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">state=&#123;<span class=\"attr\">Text</span>:<span class=\"string\">'æˆ‘æ˜¯state'</span>&#125;</span><br></pre></td></tr></table></figure>\n\n<p>è¿™é‡Œçš„stateæ˜¯ç»™stateè®¾ç½®åˆå€¼ï¼Œä¸ç„¶ä¼šæŠ¥é”™ã€‚ä¸ç›¸ä¿¡çš„è¯è‡ªå·±å¯ä»¥è¯•ä¸€ä¸‹ã€‚<em>ï¼ˆå› ä¸ºstateæ˜¯undefinedï¼Œæ‰€ä»¥ä»–é‡Œé¢å–ä¸åˆ°Textï¼‰</em></p>\n<p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­å¯ä»¥çŸ¥é“stateé‡Œé¢æ”¾çš„æ˜¯XXçš„çŠ¶æ€</p>\n<p>key valueå¯¹åº”çš„</p>\n<p>this.state.xxå°±å¯ä»¥å–åˆ°å¯¹åº”keyçš„<strong>çŠ¶æ€</strong>çš„<em>å€¼</em></p>\n<h2 id=\"ä¸‰ã€Stateå¦‚ä½•æ”¹å˜ï¼Ÿ\"><a href=\"#ä¸‰ã€Stateå¦‚ä½•æ”¹å˜ï¼Ÿ\" class=\"headerlink\" title=\"ä¸‰ã€Stateå¦‚ä½•æ”¹å˜ï¼Ÿ\"></a>ä¸‰ã€Stateå¦‚ä½•æ”¹å˜ï¼Ÿ</h2><p>é€šå¸¸åœ¨JSé‡Œé¢ï¼Œæˆ‘ä»¬è¦æ”¹å˜æŸä¸€ä¸ªå€¼å¯èƒ½å°±åªéœ€è¦  X = XX; å°±å¯ä»¥ã€‚</p>\n<p>è¿™é‡Œçš„stateæ˜¯ä¸€ä¸ªçŠ¶æ€ã€‚çŠ¶æ€æ”¹å˜äº†ï¼Œé¡µé¢ä¼šè‡ªåŠ¨åˆ·æ–°ä¸ºæœ€æ–°çš„é¡µé¢ç”¨æœ€æ–°çš„çŠ¶æ€æ˜¾ç¤ºã€‚<br>ä¸‹é¢æˆ‘ä»¬åšä¸€ä¸ªå°å®éªŒã€‚</p>\n<p>æŠŠ src/app.jsçš„æ–‡ä»¶å†…å®¹å…ˆæ”¹ä¸€ä¸‹</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; Component &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> logo <span class=\"keyword\">from</span> <span class=\"string\">'./logo.svg'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'./App.css'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">App</span> <span class=\"keyword\">extends</span> <span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  state=&#123;<span class=\"attr\">Text</span>:<span class=\"string\">'æˆ‘æ˜¯state'</span>&#125;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;div className=<span class=\"string\">\"App\"</span>&gt;</span><br><span class=\"line\">        &lt;header className=<span class=\"string\">\"App-header\"</span>&gt;</span><br><span class=\"line\">          &lt;img src=&#123;logo&#125; className=<span class=\"string\">\"App-logo\"</span> alt=<span class=\"string\">\"logo\"</span> /&gt;</span><br><span class=\"line\">          &lt;p&gt;</span><br><span class=\"line\">            Stateè¾“å‡ºï¼š&#123;<span class=\"keyword\">this</span>.state.Text&#125;</span><br><span class=\"line\">          &lt;<span class=\"regexp\">/p&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;button onClick=&#123;()=&gt;&#123;</span></span><br><span class=\"line\"><span class=\"regexp\">            this.state.Text = 'æˆ‘æ˜¯é€šè¿‡this.state.Textæ”¹å˜çš„State';</span></span><br><span class=\"line\"><span class=\"regexp\">            alert(this.state.Text);</span></span><br><span class=\"line\"><span class=\"regexp\">          &#125;&#125;&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">            æŒ‰æˆ‘æ”¹å˜state</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;/</span>button&gt;</span><br><span class=\"line\">        &lt;<span class=\"regexp\">/header&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;/</span>div&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> App;</span><br></pre></td></tr></table></figure>\n\n<p>ï¼ˆä¸è¦åœ¨æ„ç»†èŠ‚ï¼ï¼ï¼æˆ‘ä»¬æ˜¯æµ‹è¯•æŒ‰é’®çš„æ ·å¼ä¸é‡è¦ï¼ï¼ï¼ï¼‰</p>\n<p>ç‚¹å‡»æŒ‰é’®ä¹‹åï¼Œæˆ‘ä»¬å‘ç°ï¼Œstateçš„å€¼æ˜¯æ”¹å˜äº†ï¼Œä½†æ˜¯é¡µé¢ä¸Šé¢æ˜¾ç¤ºçš„å€¼ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„å•Šã€‚</p>\n<p>é‚£æˆ‘è¦æ€ä¹ˆæ‰å¯ä»¥åˆ·æ–°é¡µé¢å‡ºç°æˆ‘æƒ³è¦çš„stateçš„å€¼å‘¢ï¼Ÿ</p>\n<p>å®˜æ–¹æä¾›çš„æ–¹æ³•</p>\n<p>setState(updater, [callback])</p>\n<p>å¯ä»¥è¿™ä¹ˆç†è§£ï¼Œé’ˆå¯¹ä¸Šé¢çš„ä¾‹å­</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">this</span>.setState(&#123;<span class=\"attr\">Text</span>:<span class=\"string\">'æˆ‘æ˜¯é€šè¿‡this.state.Textæ”¹å˜çš„State'</span>&#125;, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>åé¢çš„functionï¼Œå¯ä»¥æœ‰ï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰ã€‚ä¸éœ€è¦çš„è¯å°±å¯ä»¥ä¸ç”¨å†™â€”â€”â€”â€“ç¨åä¼šè¯´</p>\n<p>æ‰€ä»¥åªéœ€è¦</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">this</span>.setState(&#123;<span class=\"attr\">Text</span>:<span class=\"string\">'æˆ‘æ˜¯é€šè¿‡this.state.Textæ”¹å˜çš„State'</span>&#125;)</span><br></pre></td></tr></table></figure>\n\n\n<p>æŠŠ src/app.jsçš„æ–‡ä»¶å†…å®¹å…ˆæ”¹ä¸€ä¸‹</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; Component &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> logo <span class=\"keyword\">from</span> <span class=\"string\">'./logo.svg'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'./App.css'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">App</span> <span class=\"keyword\">extends</span> <span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  state=&#123;<span class=\"attr\">Text</span>:<span class=\"string\">'æˆ‘æ˜¯state'</span>&#125;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;div className=<span class=\"string\">\"App\"</span>&gt;</span><br><span class=\"line\">        &lt;header className=<span class=\"string\">\"App-header\"</span>&gt;</span><br><span class=\"line\">          &lt;img src=&#123;logo&#125; className=<span class=\"string\">\"App-logo\"</span> alt=<span class=\"string\">\"logo\"</span> /&gt;</span><br><span class=\"line\">          &lt;p&gt;</span><br><span class=\"line\">            Stateè¾“å‡ºï¼š&#123;<span class=\"keyword\">this</span>.state.Text&#125;</span><br><span class=\"line\">          &lt;<span class=\"regexp\">/p&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;button onClick=&#123;()=&gt;&#123;</span></span><br><span class=\"line\"><span class=\"regexp\">            this.setState(&#123;Text:'æˆ‘æ˜¯é€šè¿‡this.state.Textæ”¹å˜çš„State'&#125;)</span></span><br><span class=\"line\"><span class=\"regexp\">            alert(this.state.Text);</span></span><br><span class=\"line\"><span class=\"regexp\">          &#125;&#125;&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">            æŒ‰æˆ‘æ”¹å˜state</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;/</span>button&gt;</span><br><span class=\"line\">        &lt;<span class=\"regexp\">/header&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;/</span>div&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> App;</span><br></pre></td></tr></table></figure>\n<p>ä¿å­˜-çƒ­åŠ è½½<br>ä¹‹åæˆ‘ä»¬å‘ç°ï¼ŒçŠ¶æ€æ˜¯æ”¹å˜äº†ï¼Œå¯æ˜¯alertçš„å€¼ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œè¿˜æ˜¯è€çš„å€¼ï¼ˆçŠ¶æ€ï¼‰çš„ã€‚</p>\n<p>å¯èƒ½ä½ ä¸çŸ¥é“æˆ‘åœ¨è¯´ä»€ä¹ˆ</p>\n<p>é€šè¿‡ä¸€ä¸ªå°ä¾‹å­æˆ‘ä»¬ä»”ç»†æ„Ÿå—ä¸€ä¸‹ã€‚å®˜æ–¹çš„setStateç©¶ç«Ÿåœ¨å¹²ä»€ä¹ˆã€‚</p>\n<p>æŠŠ src/app.jsçš„æ–‡ä»¶å†…å®¹å…ˆæ”¹ä¸€ä¸‹</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; Component &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> logo <span class=\"keyword\">from</span> <span class=\"string\">'./logo.svg'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'./App.css'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">App</span> <span class=\"keyword\">extends</span> <span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  state=&#123;</span><br><span class=\"line\">    Text:<span class=\"string\">'å¤§å®¶ä¸€èµ·çœ‹logå§ï¼Œæˆ‘è¿™æ¬¡å•¥ä¹Ÿä¸åš'</span>,</span><br><span class=\"line\">    conut:<span class=\"number\">0</span>,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;div className=<span class=\"string\">\"App\"</span>&gt;</span><br><span class=\"line\">        &lt;header className=<span class=\"string\">\"App-header\"</span>&gt;</span><br><span class=\"line\">          &lt;img src=&#123;logo&#125; className=<span class=\"string\">\"App-logo\"</span> alt=<span class=\"string\">\"logo\"</span> /&gt;</span><br><span class=\"line\">          &lt;p&gt;</span><br><span class=\"line\">            Stateè¾“å‡ºï¼š&#123;<span class=\"keyword\">this</span>.state.Text&#125;</span><br><span class=\"line\">          &lt;<span class=\"regexp\">/p&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;button onClick=&#123;()=&gt;&#123;</span></span><br><span class=\"line\"><span class=\"regexp\">            console.log(this.state.conut);</span></span><br><span class=\"line\"><span class=\"regexp\">            this.setState(&#123;conut: this.state.conut + 1&#125;);</span></span><br><span class=\"line\"><span class=\"regexp\">            console.log(this.state.conut);</span></span><br><span class=\"line\"><span class=\"regexp\">          &#125;&#125;&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">            æŒ‰æˆ‘æ”¹å˜state</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;/</span>button&gt;</span><br><span class=\"line\">        &lt;<span class=\"regexp\">/header&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;/</span>div&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> App;</span><br></pre></td></tr></table></figure>\n\n<p>æ‰“å¼€æˆ‘ä»¬çš„reacté¡µé¢<br>æŒ‰Ctrl + Shift + I<br>çœ‹log<br>ç„¶åæŒ‰é’®</p>\n<p><img src=\"/image/React%E5%85%A5%E9%97%A8/20181123143905811.png\" alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<p>è¯¶ï¼Œæˆ‘ä¸æ˜¯setStateäº†å—ï¼Œä¸ºä»€ä¹ˆå€¼æ²¡æœ‰æ”¹å˜è¿˜æ˜¯åˆå€¼å‘¢ï¼Ÿ</p>\n<p>æˆ‘ä»¬æ¢ä¸€ä¸ªæ–¹æ³•è¯•ä¸€ä¸‹</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; Component &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> logo <span class=\"keyword\">from</span> <span class=\"string\">'./logo.svg'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'./App.css'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">App</span> <span class=\"keyword\">extends</span> <span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  state=&#123;</span><br><span class=\"line\">    Text:<span class=\"string\">'å¤§å®¶ä¸€èµ·çœ‹logå§ï¼Œæˆ‘è¿™æ¬¡å•¥ä¹Ÿä¸åš'</span>,</span><br><span class=\"line\">    conut:<span class=\"number\">0</span>,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;div className=<span class=\"string\">\"App\"</span>&gt;</span><br><span class=\"line\">        &lt;header className=<span class=\"string\">\"App-header\"</span>&gt;</span><br><span class=\"line\">          &lt;img src=&#123;logo&#125; className=<span class=\"string\">\"App-logo\"</span> alt=<span class=\"string\">\"logo\"</span> /&gt;</span><br><span class=\"line\">          &lt;p&gt;</span><br><span class=\"line\">            Stateè¾“å‡ºï¼š&#123;<span class=\"keyword\">this</span>.state.Text&#125;</span><br><span class=\"line\">          &lt;<span class=\"regexp\">/p&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;button onClick=&#123;()=&gt;&#123;</span></span><br><span class=\"line\"><span class=\"regexp\">            console.log(this.state.conut);</span></span><br><span class=\"line\"><span class=\"regexp\">            this.setState(&#123;conut: this.state.conut + 1&#125;)</span></span><br><span class=\"line\"><span class=\"regexp\">            setTimeout(()=&gt;&#123;</span></span><br><span class=\"line\"><span class=\"regexp\">              console.log(this.state.conut);</span></span><br><span class=\"line\"><span class=\"regexp\">            &#125;,1000);</span></span><br><span class=\"line\"><span class=\"regexp\">          &#125;&#125;&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">            æŒ‰æˆ‘æ”¹å˜state</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;/</span>button&gt;</span><br><span class=\"line\">        &lt;<span class=\"regexp\">/header&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;/</span>div&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> App;</span><br></pre></td></tr></table></figure>\n\n\n<p>é‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥è®¤ä¸ºsetStateä¸æ˜¯ä¸€ä¸ªç«‹åˆ»ç”Ÿæ•ˆçš„å‡½æ•°ã€‚</p>\n<p>æœ‰ç‚¹ç±»ä¼¼å¼‚æ­¥çš„ç½‘ç»œè¯·æ±‚ã€‚</p>\n<p>è¿™æ˜¯ä¸€ä¸ªå‘ï¼Œå¾ˆå¤šæ–°æ‰‹éƒ½ä¼šé‡åˆ°çš„å‘ã€‚æˆ‘æ›¾ç»ä¹Ÿé‡åˆ°æ‰€ä»¥å†™å‡ºæ¥ã€‚</p>\n<p>é‚£æ—¢ç„¶æ˜¯ç±»ä¼¼å¼‚æ­¥çš„ç½‘ç»œè¯·æ±‚è‚¯å®šä¹Ÿæœ‰callbackå’¯ï¼Ÿ</p>\n<p>æ˜¯çš„ï¼</p>\n<p>æˆ‘ä»¬æŠŠconsole.logæ”¾åˆ°åˆšåˆšæˆ‘ä»¬æ²¡æœ‰å†™functioné‡Œé¢ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; Component &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> logo <span class=\"keyword\">from</span> <span class=\"string\">'./logo.svg'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'./App.css'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">App</span> <span class=\"keyword\">extends</span> <span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  state=&#123;</span><br><span class=\"line\">    Text:<span class=\"string\">'å¤§å®¶ä¸€èµ·çœ‹logå§ï¼Œæˆ‘è¿™æ¬¡å•¥ä¹Ÿä¸åš'</span>,</span><br><span class=\"line\">    conut:<span class=\"number\">0</span>,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;div className=<span class=\"string\">\"App\"</span>&gt;</span><br><span class=\"line\">        &lt;header className=<span class=\"string\">\"App-header\"</span>&gt;</span><br><span class=\"line\">          &lt;img src=&#123;logo&#125; className=<span class=\"string\">\"App-logo\"</span> alt=<span class=\"string\">\"logo\"</span> /&gt;</span><br><span class=\"line\">          &lt;p&gt;</span><br><span class=\"line\">            Stateè¾“å‡ºï¼š&#123;<span class=\"keyword\">this</span>.state.Text&#125;</span><br><span class=\"line\">          &lt;<span class=\"regexp\">/p&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;button onClick=&#123;()=&gt;&#123;</span></span><br><span class=\"line\"><span class=\"regexp\">            console.log(this.state.conut);</span></span><br><span class=\"line\"><span class=\"regexp\">            this.setState(&#123;conut: this.state.conut + 1&#125;, ()=&gt;&#123;</span></span><br><span class=\"line\"><span class=\"regexp\">              console.log(this.state.conut);</span></span><br><span class=\"line\"><span class=\"regexp\">            &#125;)</span></span><br><span class=\"line\"><span class=\"regexp\">            </span></span><br><span class=\"line\"><span class=\"regexp\">          &#125;&#125;&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">            æŒ‰æˆ‘æ”¹å˜state</span></span><br><span class=\"line\"><span class=\"regexp\">          &lt;/</span>button&gt;</span><br><span class=\"line\">        &lt;<span class=\"regexp\">/header&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;/</span>div&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> App;</span><br></pre></td></tr></table></figure>\n\n<p>è¿™æ ·çš„å¥½å¤„æˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨çš„æ§åˆ¶ç­‰å¾…æ—¶é—´çš„å¤§å°ï¼Œå› ä¸ºæ ¹æ®è®¾å¤‡çš„ä¸åŒè¿™ä¸ªæ—¶é—´å¯èƒ½ä¼šå¤ªå¤šæˆ–è€…å¤ªå°‘ã€‚</p>\n<p>æœ¬äººReactå°èœï¼Œæœ‰è¯´çš„ä¸å¯¹çš„åœ°æ–¹è¿˜è¯·å¤§ç¥æŒ‡å‡ºã€‚</p>\n"},{"title":"JWT spring boot JAVA ä½¿ç”¨æ­¥éª¤ spring boot2.0","date":"2019-06-19T02:58:33.000Z","cover":"/image/cover/JWT.png","_content":"\n## å‰è¨€\nJWTæ˜¯json web tokenç¼©å†™ã€‚å®ƒå°†ç”¨æˆ·ä¿¡æ¯åŠ å¯†åˆ°tokené‡Œï¼ŒæœåŠ¡å™¨ä¸ä¿å­˜ä»»ä½•ç”¨æˆ·ä¿¡æ¯ã€‚æœåŠ¡å™¨é€šè¿‡ä½¿ç”¨ä¿å­˜çš„å¯†é’¥éªŒè¯tokençš„æ­£ç¡®æ€§ï¼Œåªè¦æ­£ç¡®å³é€šè¿‡éªŒè¯ã€‚\n\nï¼ˆ1ï¼‰JWT é»˜è®¤æ˜¯ä¸åŠ å¯†ï¼Œä½†ä¹Ÿæ˜¯å¯ä»¥åŠ å¯†çš„ã€‚ç”ŸæˆåŸå§‹ Token ä»¥åï¼Œå¯ä»¥ç”¨å¯†é’¥å†åŠ å¯†ä¸€æ¬¡ã€‚\n\nï¼ˆ2ï¼‰JWT ä¸åŠ å¯†çš„æƒ…å†µä¸‹ï¼Œä¸èƒ½å°†ç§˜å¯†æ•°æ®å†™å…¥ JWTã€‚\n\nï¼ˆ3ï¼‰JWT ä¸ä»…å¯ä»¥ç”¨äºè®¤è¯ï¼Œä¹Ÿå¯ä»¥ç”¨äºäº¤æ¢ä¿¡æ¯ã€‚æœ‰æ•ˆä½¿ç”¨ JWTï¼Œå¯ä»¥é™ä½æœåŠ¡å™¨æŸ¥è¯¢æ•°æ®åº“çš„æ¬¡æ•°ã€‚\n\nï¼ˆ4ï¼‰JWT çš„æœ€å¤§ç¼ºç‚¹æ˜¯ï¼Œç”±äºæœåŠ¡å™¨ä¸ä¿å­˜ session çŠ¶æ€ï¼Œå› æ­¤æ— æ³•åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­åºŸæ­¢æŸä¸ª tokenï¼Œæˆ–è€…æ›´æ”¹ token çš„æƒé™ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦ JWT ç­¾å‘äº†ï¼Œåœ¨åˆ°æœŸä¹‹å‰å°±ä¼šå§‹ç»ˆæœ‰æ•ˆï¼Œé™¤éæœåŠ¡å™¨éƒ¨ç½²é¢å¤–çš„é€»è¾‘ã€‚\n\nï¼ˆ5ï¼‰JWT æœ¬èº«åŒ…å«äº†è®¤è¯ä¿¡æ¯ï¼Œä¸€æ—¦æ³„éœ²ï¼Œä»»ä½•äººéƒ½å¯ä»¥è·å¾—è¯¥ä»¤ç‰Œçš„æ‰€æœ‰æƒé™ã€‚ä¸ºäº†å‡å°‘ç›—ç”¨ï¼ŒJWT çš„æœ‰æ•ˆæœŸåº”è¯¥è®¾ç½®å¾—æ¯”è¾ƒçŸ­ã€‚å¯¹äºä¸€äº›æ¯”è¾ƒé‡è¦çš„æƒé™ï¼Œä½¿ç”¨æ—¶åº”è¯¥å†æ¬¡å¯¹ç”¨æˆ·è¿›è¡Œè®¤è¯ã€‚\n\nï¼ˆ6ï¼‰ä¸ºäº†å‡å°‘ç›—ç”¨ï¼ŒJWT ä¸åº”è¯¥ä½¿ç”¨ HTTP åè®®æ˜ç ä¼ è¾“ï¼Œè¦ä½¿ç”¨ HTTPS åè®®ä¼ è¾“ã€‚\n## ä½¿ç”¨\n\n - æ·»åŠ ä¾èµ–\nhttps://jwt.io/\né€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬\n - ä½¿ç”¨\n\n```\nimport java.util.Calendar;\nimport java.util.Date;\nimport java.util.HashMap;\nimport java.util.Map;\n\nimport com.auth0.jwt.JWT;\nimport com.auth0.jwt.JWTVerifier;\nimport com.auth0.jwt.algorithms.Algorithm;\nimport com.auth0.jwt.interfaces.Claim;\nimport com.auth0.jwt.interfaces.DecodedJWT;\nimport org.springframework.util.StringUtils;\n\npublic class TokenConfig {\n    /** tokenç§˜é’¥ï¼Œè¯·å‹¿æ³„éœ²ï¼Œè¯·å‹¿éšä¾¿ä¿®æ”¹ backups:JKKLJOoasdlfj */\n    public static final String SECRET = \"JKKLJOoasdlfj\";\n    /** token è¿‡æœŸæ—¶é—´: 10å¤© */\n    public static final int calendarField = Calendar.DATE;\n    public static final int calendarInterval = 10;\n\n    /**\n     * JWTç”ŸæˆToken.<br/>\n     *\n     * JWTæ„æˆ: header, payload, signature\n     *\n     * @param user_id\n     *            ç™»å½•æˆåŠŸåç”¨æˆ·user_id, å‚æ•°user_idä¸å¯ä¼ ç©º\n     */\n    public static String createToken(Long user_id) throws Exception {\n        Date iatDate = new Date();\n        // expire time\n        Calendar nowTime = Calendar.getInstance();\n        nowTime.add(calendarField, calendarInterval);\n        Date expiresDate = nowTime.getTime();\n\n        // header Map\n        Map<String, Object> map = new HashMap<>();\n        map.put(\"alg\", \"HS256\");\n        map.put(\"typ\", \"JWT\");\n\n        // build token\n        // param backups {iss:Service, aud:APP}\n        String token = JWT.create().withHeader(map) // header\n                .withClaim(\"iss\", \"Service\") // payload\n                .withClaim(\"aud\", \"APP\").withClaim(\"user_id\", null == user_id ? null : user_id.toString())\n                .withIssuedAt(iatDate) // sign time\n                .withExpiresAt(expiresDate) // expire time\n                .sign(Algorithm.HMAC256(SECRET)); // signature\n\n        return token;\n    }\n\n    /**\n     * è§£å¯†Token\n     *\n     * @param token\n     * @return\n     * @throws Exception\n     */\n    public static Map<String, Claim> verifyToken(String token) {\n        DecodedJWT jwt = null;\n        try {\n            JWTVerifier verifier = JWT.require(Algorithm.HMAC256(SECRET)).build();\n            jwt = verifier.verify(token);\n        } catch (Exception e) {\n            // e.printStackTrace();\n            // token æ ¡éªŒå¤±è´¥, æŠ›å‡ºTokenéªŒè¯éæ³•å¼‚å¸¸\n        }\n        return jwt.getClaims();\n    }\n\n    /**\n     * æ ¹æ®Tokenè·å–user_id\n     *\n     * @param token\n     * @return user_id\n     */\n    public static Long getAppUID(String token) {\n        Map<String, Claim> claims = verifyToken(token);\n        Claim user_id_claim = claims.get(\"user_id\");\n        if (null == user_id_claim || StringUtils.isEmpty(user_id_claim.asString())) {\n            // token æ ¡éªŒå¤±è´¥, æŠ›å‡ºTokenéªŒè¯éæ³•å¼‚å¸¸\n        }\n        return Long.valueOf(user_id_claim.asString());\n    }\n}\n```\n\n## æ¦‚å¿µè§£æ\nJWT çš„ä¸‰ä¸ªéƒ¨åˆ†ä¾æ¬¡å¦‚ä¸‹ã€‚\n\n - Headerï¼ˆå¤´éƒ¨ï¼‰\n - Payloadï¼ˆè´Ÿè½½ï¼‰\n - Signatureï¼ˆç­¾åï¼‰\n\n\nå†™æˆä¸€è¡Œï¼Œå°±æ˜¯ä¸‹é¢çš„æ ·å­ã€‚\n\n\n![https://www.wangbase.com/blogimg/asset/201807/bg2018072303.jpg](/image/SpringBootJWT/20190325103836546.png)\n","source":"_posts/JWT-spring-boot-JAVA-ä½¿ç”¨æ­¥éª¤-spring-boot2-0.md","raw":"---\ntitle: JWT spring boot JAVA ä½¿ç”¨æ­¥éª¤ spring boot2.0\ndate: 2019-06-19 10:58:33\ntags: [Spring-Boot-2.0, Java, JWT]\ncategory: [Java, Spring-Boot]\ncover: /image/cover/JWT.png\n---\n\n## å‰è¨€\nJWTæ˜¯json web tokenç¼©å†™ã€‚å®ƒå°†ç”¨æˆ·ä¿¡æ¯åŠ å¯†åˆ°tokené‡Œï¼ŒæœåŠ¡å™¨ä¸ä¿å­˜ä»»ä½•ç”¨æˆ·ä¿¡æ¯ã€‚æœåŠ¡å™¨é€šè¿‡ä½¿ç”¨ä¿å­˜çš„å¯†é’¥éªŒè¯tokençš„æ­£ç¡®æ€§ï¼Œåªè¦æ­£ç¡®å³é€šè¿‡éªŒè¯ã€‚\n\nï¼ˆ1ï¼‰JWT é»˜è®¤æ˜¯ä¸åŠ å¯†ï¼Œä½†ä¹Ÿæ˜¯å¯ä»¥åŠ å¯†çš„ã€‚ç”ŸæˆåŸå§‹ Token ä»¥åï¼Œå¯ä»¥ç”¨å¯†é’¥å†åŠ å¯†ä¸€æ¬¡ã€‚\n\nï¼ˆ2ï¼‰JWT ä¸åŠ å¯†çš„æƒ…å†µä¸‹ï¼Œä¸èƒ½å°†ç§˜å¯†æ•°æ®å†™å…¥ JWTã€‚\n\nï¼ˆ3ï¼‰JWT ä¸ä»…å¯ä»¥ç”¨äºè®¤è¯ï¼Œä¹Ÿå¯ä»¥ç”¨äºäº¤æ¢ä¿¡æ¯ã€‚æœ‰æ•ˆä½¿ç”¨ JWTï¼Œå¯ä»¥é™ä½æœåŠ¡å™¨æŸ¥è¯¢æ•°æ®åº“çš„æ¬¡æ•°ã€‚\n\nï¼ˆ4ï¼‰JWT çš„æœ€å¤§ç¼ºç‚¹æ˜¯ï¼Œç”±äºæœåŠ¡å™¨ä¸ä¿å­˜ session çŠ¶æ€ï¼Œå› æ­¤æ— æ³•åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­åºŸæ­¢æŸä¸ª tokenï¼Œæˆ–è€…æ›´æ”¹ token çš„æƒé™ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦ JWT ç­¾å‘äº†ï¼Œåœ¨åˆ°æœŸä¹‹å‰å°±ä¼šå§‹ç»ˆæœ‰æ•ˆï¼Œé™¤éæœåŠ¡å™¨éƒ¨ç½²é¢å¤–çš„é€»è¾‘ã€‚\n\nï¼ˆ5ï¼‰JWT æœ¬èº«åŒ…å«äº†è®¤è¯ä¿¡æ¯ï¼Œä¸€æ—¦æ³„éœ²ï¼Œä»»ä½•äººéƒ½å¯ä»¥è·å¾—è¯¥ä»¤ç‰Œçš„æ‰€æœ‰æƒé™ã€‚ä¸ºäº†å‡å°‘ç›—ç”¨ï¼ŒJWT çš„æœ‰æ•ˆæœŸåº”è¯¥è®¾ç½®å¾—æ¯”è¾ƒçŸ­ã€‚å¯¹äºä¸€äº›æ¯”è¾ƒé‡è¦çš„æƒé™ï¼Œä½¿ç”¨æ—¶åº”è¯¥å†æ¬¡å¯¹ç”¨æˆ·è¿›è¡Œè®¤è¯ã€‚\n\nï¼ˆ6ï¼‰ä¸ºäº†å‡å°‘ç›—ç”¨ï¼ŒJWT ä¸åº”è¯¥ä½¿ç”¨ HTTP åè®®æ˜ç ä¼ è¾“ï¼Œè¦ä½¿ç”¨ HTTPS åè®®ä¼ è¾“ã€‚\n## ä½¿ç”¨\n\n - æ·»åŠ ä¾èµ–\nhttps://jwt.io/\né€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬\n - ä½¿ç”¨\n\n```\nimport java.util.Calendar;\nimport java.util.Date;\nimport java.util.HashMap;\nimport java.util.Map;\n\nimport com.auth0.jwt.JWT;\nimport com.auth0.jwt.JWTVerifier;\nimport com.auth0.jwt.algorithms.Algorithm;\nimport com.auth0.jwt.interfaces.Claim;\nimport com.auth0.jwt.interfaces.DecodedJWT;\nimport org.springframework.util.StringUtils;\n\npublic class TokenConfig {\n    /** tokenç§˜é’¥ï¼Œè¯·å‹¿æ³„éœ²ï¼Œè¯·å‹¿éšä¾¿ä¿®æ”¹ backups:JKKLJOoasdlfj */\n    public static final String SECRET = \"JKKLJOoasdlfj\";\n    /** token è¿‡æœŸæ—¶é—´: 10å¤© */\n    public static final int calendarField = Calendar.DATE;\n    public static final int calendarInterval = 10;\n\n    /**\n     * JWTç”ŸæˆToken.<br/>\n     *\n     * JWTæ„æˆ: header, payload, signature\n     *\n     * @param user_id\n     *            ç™»å½•æˆåŠŸåç”¨æˆ·user_id, å‚æ•°user_idä¸å¯ä¼ ç©º\n     */\n    public static String createToken(Long user_id) throws Exception {\n        Date iatDate = new Date();\n        // expire time\n        Calendar nowTime = Calendar.getInstance();\n        nowTime.add(calendarField, calendarInterval);\n        Date expiresDate = nowTime.getTime();\n\n        // header Map\n        Map<String, Object> map = new HashMap<>();\n        map.put(\"alg\", \"HS256\");\n        map.put(\"typ\", \"JWT\");\n\n        // build token\n        // param backups {iss:Service, aud:APP}\n        String token = JWT.create().withHeader(map) // header\n                .withClaim(\"iss\", \"Service\") // payload\n                .withClaim(\"aud\", \"APP\").withClaim(\"user_id\", null == user_id ? null : user_id.toString())\n                .withIssuedAt(iatDate) // sign time\n                .withExpiresAt(expiresDate) // expire time\n                .sign(Algorithm.HMAC256(SECRET)); // signature\n\n        return token;\n    }\n\n    /**\n     * è§£å¯†Token\n     *\n     * @param token\n     * @return\n     * @throws Exception\n     */\n    public static Map<String, Claim> verifyToken(String token) {\n        DecodedJWT jwt = null;\n        try {\n            JWTVerifier verifier = JWT.require(Algorithm.HMAC256(SECRET)).build();\n            jwt = verifier.verify(token);\n        } catch (Exception e) {\n            // e.printStackTrace();\n            // token æ ¡éªŒå¤±è´¥, æŠ›å‡ºTokenéªŒè¯éæ³•å¼‚å¸¸\n        }\n        return jwt.getClaims();\n    }\n\n    /**\n     * æ ¹æ®Tokenè·å–user_id\n     *\n     * @param token\n     * @return user_id\n     */\n    public static Long getAppUID(String token) {\n        Map<String, Claim> claims = verifyToken(token);\n        Claim user_id_claim = claims.get(\"user_id\");\n        if (null == user_id_claim || StringUtils.isEmpty(user_id_claim.asString())) {\n            // token æ ¡éªŒå¤±è´¥, æŠ›å‡ºTokenéªŒè¯éæ³•å¼‚å¸¸\n        }\n        return Long.valueOf(user_id_claim.asString());\n    }\n}\n```\n\n## æ¦‚å¿µè§£æ\nJWT çš„ä¸‰ä¸ªéƒ¨åˆ†ä¾æ¬¡å¦‚ä¸‹ã€‚\n\n - Headerï¼ˆå¤´éƒ¨ï¼‰\n - Payloadï¼ˆè´Ÿè½½ï¼‰\n - Signatureï¼ˆç­¾åï¼‰\n\n\nå†™æˆä¸€è¡Œï¼Œå°±æ˜¯ä¸‹é¢çš„æ ·å­ã€‚\n\n\n![https://www.wangbase.com/blogimg/asset/201807/bg2018072303.jpg](/image/SpringBootJWT/20190325103836546.png)\n","slug":"JWT-spring-boot-JAVA-ä½¿ç”¨æ­¥éª¤-spring-boot2-0","published":1,"updated":"2021-06-24T14:00:06.846Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra7p0008lwrd58in9g5h","content":"<h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><p>JWTæ˜¯json web tokenç¼©å†™ã€‚å®ƒå°†ç”¨æˆ·ä¿¡æ¯åŠ å¯†åˆ°tokené‡Œï¼ŒæœåŠ¡å™¨ä¸ä¿å­˜ä»»ä½•ç”¨æˆ·ä¿¡æ¯ã€‚æœåŠ¡å™¨é€šè¿‡ä½¿ç”¨ä¿å­˜çš„å¯†é’¥éªŒè¯tokençš„æ­£ç¡®æ€§ï¼Œåªè¦æ­£ç¡®å³é€šè¿‡éªŒè¯ã€‚</p>\n<p>ï¼ˆ1ï¼‰JWT é»˜è®¤æ˜¯ä¸åŠ å¯†ï¼Œä½†ä¹Ÿæ˜¯å¯ä»¥åŠ å¯†çš„ã€‚ç”ŸæˆåŸå§‹ Token ä»¥åï¼Œå¯ä»¥ç”¨å¯†é’¥å†åŠ å¯†ä¸€æ¬¡ã€‚</p>\n<p>ï¼ˆ2ï¼‰JWT ä¸åŠ å¯†çš„æƒ…å†µä¸‹ï¼Œä¸èƒ½å°†ç§˜å¯†æ•°æ®å†™å…¥ JWTã€‚</p>\n<p>ï¼ˆ3ï¼‰JWT ä¸ä»…å¯ä»¥ç”¨äºè®¤è¯ï¼Œä¹Ÿå¯ä»¥ç”¨äºäº¤æ¢ä¿¡æ¯ã€‚æœ‰æ•ˆä½¿ç”¨ JWTï¼Œå¯ä»¥é™ä½æœåŠ¡å™¨æŸ¥è¯¢æ•°æ®åº“çš„æ¬¡æ•°ã€‚</p>\n<p>ï¼ˆ4ï¼‰JWT çš„æœ€å¤§ç¼ºç‚¹æ˜¯ï¼Œç”±äºæœåŠ¡å™¨ä¸ä¿å­˜ session çŠ¶æ€ï¼Œå› æ­¤æ— æ³•åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­åºŸæ­¢æŸä¸ª tokenï¼Œæˆ–è€…æ›´æ”¹ token çš„æƒé™ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦ JWT ç­¾å‘äº†ï¼Œåœ¨åˆ°æœŸä¹‹å‰å°±ä¼šå§‹ç»ˆæœ‰æ•ˆï¼Œé™¤éæœåŠ¡å™¨éƒ¨ç½²é¢å¤–çš„é€»è¾‘ã€‚</p>\n<p>ï¼ˆ5ï¼‰JWT æœ¬èº«åŒ…å«äº†è®¤è¯ä¿¡æ¯ï¼Œä¸€æ—¦æ³„éœ²ï¼Œä»»ä½•äººéƒ½å¯ä»¥è·å¾—è¯¥ä»¤ç‰Œçš„æ‰€æœ‰æƒé™ã€‚ä¸ºäº†å‡å°‘ç›—ç”¨ï¼ŒJWT çš„æœ‰æ•ˆæœŸåº”è¯¥è®¾ç½®å¾—æ¯”è¾ƒçŸ­ã€‚å¯¹äºä¸€äº›æ¯”è¾ƒé‡è¦çš„æƒé™ï¼Œä½¿ç”¨æ—¶åº”è¯¥å†æ¬¡å¯¹ç”¨æˆ·è¿›è¡Œè®¤è¯ã€‚</p>\n<p>ï¼ˆ6ï¼‰ä¸ºäº†å‡å°‘ç›—ç”¨ï¼ŒJWT ä¸åº”è¯¥ä½¿ç”¨ HTTP åè®®æ˜ç ä¼ è¾“ï¼Œè¦ä½¿ç”¨ HTTPS åè®®ä¼ è¾“ã€‚</p>\n<h2 id=\"ä½¿ç”¨\"><a href=\"#ä½¿ç”¨\" class=\"headerlink\" title=\"ä½¿ç”¨\"></a>ä½¿ç”¨</h2><ul>\n<li>æ·»åŠ ä¾èµ–<br><a href=\"https://jwt.io/\" target=\"_blank\" rel=\"noopener\">https://jwt.io/</a><br>é€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬</li>\n<li>ä½¿ç”¨</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import java.util.Calendar;</span><br><span class=\"line\">import java.util.Date;</span><br><span class=\"line\">import java.util.HashMap;</span><br><span class=\"line\">import java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\">import com.auth0.jwt.JWT;</span><br><span class=\"line\">import com.auth0.jwt.JWTVerifier;</span><br><span class=\"line\">import com.auth0.jwt.algorithms.Algorithm;</span><br><span class=\"line\">import com.auth0.jwt.interfaces.Claim;</span><br><span class=\"line\">import com.auth0.jwt.interfaces.DecodedJWT;</span><br><span class=\"line\">import org.springframework.util.StringUtils;</span><br><span class=\"line\"></span><br><span class=\"line\">public class TokenConfig &#123;</span><br><span class=\"line\">    &#x2F;** tokenç§˜é’¥ï¼Œè¯·å‹¿æ³„éœ²ï¼Œè¯·å‹¿éšä¾¿ä¿®æ”¹ backups:JKKLJOoasdlfj *&#x2F;</span><br><span class=\"line\">    public static final String SECRET &#x3D; &quot;JKKLJOoasdlfj&quot;;</span><br><span class=\"line\">    &#x2F;** token è¿‡æœŸæ—¶é—´: 10å¤© *&#x2F;</span><br><span class=\"line\">    public static final int calendarField &#x3D; Calendar.DATE;</span><br><span class=\"line\">    public static final int calendarInterval &#x3D; 10;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;**</span><br><span class=\"line\">     * JWTç”ŸæˆToken.&lt;br&#x2F;&gt;</span><br><span class=\"line\">     *</span><br><span class=\"line\">     * JWTæ„æˆ: header, payload, signature</span><br><span class=\"line\">     *</span><br><span class=\"line\">     * @param user_id</span><br><span class=\"line\">     *            ç™»å½•æˆåŠŸåç”¨æˆ·user_id, å‚æ•°user_idä¸å¯ä¼ ç©º</span><br><span class=\"line\">     *&#x2F;</span><br><span class=\"line\">    public static String createToken(Long user_id) throws Exception &#123;</span><br><span class=\"line\">        Date iatDate &#x3D; new Date();</span><br><span class=\"line\">        &#x2F;&#x2F; expire time</span><br><span class=\"line\">        Calendar nowTime &#x3D; Calendar.getInstance();</span><br><span class=\"line\">        nowTime.add(calendarField, calendarInterval);</span><br><span class=\"line\">        Date expiresDate &#x3D; nowTime.getTime();</span><br><span class=\"line\"></span><br><span class=\"line\">        &#x2F;&#x2F; header Map</span><br><span class=\"line\">        Map&lt;String, Object&gt; map &#x3D; new HashMap&lt;&gt;();</span><br><span class=\"line\">        map.put(&quot;alg&quot;, &quot;HS256&quot;);</span><br><span class=\"line\">        map.put(&quot;typ&quot;, &quot;JWT&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">        &#x2F;&#x2F; build token</span><br><span class=\"line\">        &#x2F;&#x2F; param backups &#123;iss:Service, aud:APP&#125;</span><br><span class=\"line\">        String token &#x3D; JWT.create().withHeader(map) &#x2F;&#x2F; header</span><br><span class=\"line\">                .withClaim(&quot;iss&quot;, &quot;Service&quot;) &#x2F;&#x2F; payload</span><br><span class=\"line\">                .withClaim(&quot;aud&quot;, &quot;APP&quot;).withClaim(&quot;user_id&quot;, null &#x3D;&#x3D; user_id ? null : user_id.toString())</span><br><span class=\"line\">                .withIssuedAt(iatDate) &#x2F;&#x2F; sign time</span><br><span class=\"line\">                .withExpiresAt(expiresDate) &#x2F;&#x2F; expire time</span><br><span class=\"line\">                .sign(Algorithm.HMAC256(SECRET)); &#x2F;&#x2F; signature</span><br><span class=\"line\"></span><br><span class=\"line\">        return token;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;**</span><br><span class=\"line\">     * è§£å¯†Token</span><br><span class=\"line\">     *</span><br><span class=\"line\">     * @param token</span><br><span class=\"line\">     * @return</span><br><span class=\"line\">     * @throws Exception</span><br><span class=\"line\">     *&#x2F;</span><br><span class=\"line\">    public static Map&lt;String, Claim&gt; verifyToken(String token) &#123;</span><br><span class=\"line\">        DecodedJWT jwt &#x3D; null;</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            JWTVerifier verifier &#x3D; JWT.require(Algorithm.HMAC256(SECRET)).build();</span><br><span class=\"line\">            jwt &#x3D; verifier.verify(token);</span><br><span class=\"line\">        &#125; catch (Exception e) &#123;</span><br><span class=\"line\">            &#x2F;&#x2F; e.printStackTrace();</span><br><span class=\"line\">            &#x2F;&#x2F; token æ ¡éªŒå¤±è´¥, æŠ›å‡ºTokenéªŒè¯éæ³•å¼‚å¸¸</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return jwt.getClaims();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;**</span><br><span class=\"line\">     * æ ¹æ®Tokenè·å–user_id</span><br><span class=\"line\">     *</span><br><span class=\"line\">     * @param token</span><br><span class=\"line\">     * @return user_id</span><br><span class=\"line\">     *&#x2F;</span><br><span class=\"line\">    public static Long getAppUID(String token) &#123;</span><br><span class=\"line\">        Map&lt;String, Claim&gt; claims &#x3D; verifyToken(token);</span><br><span class=\"line\">        Claim user_id_claim &#x3D; claims.get(&quot;user_id&quot;);</span><br><span class=\"line\">        if (null &#x3D;&#x3D; user_id_claim || StringUtils.isEmpty(user_id_claim.asString())) &#123;</span><br><span class=\"line\">            &#x2F;&#x2F; token æ ¡éªŒå¤±è´¥, æŠ›å‡ºTokenéªŒè¯éæ³•å¼‚å¸¸</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return Long.valueOf(user_id_claim.asString());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"æ¦‚å¿µè§£æ\"><a href=\"#æ¦‚å¿µè§£æ\" class=\"headerlink\" title=\"æ¦‚å¿µè§£æ\"></a>æ¦‚å¿µè§£æ</h2><p>JWT çš„ä¸‰ä¸ªéƒ¨åˆ†ä¾æ¬¡å¦‚ä¸‹ã€‚</p>\n<ul>\n<li>Headerï¼ˆå¤´éƒ¨ï¼‰</li>\n<li>Payloadï¼ˆè´Ÿè½½ï¼‰</li>\n<li>Signatureï¼ˆç­¾åï¼‰</li>\n</ul>\n<p>å†™æˆä¸€è¡Œï¼Œå°±æ˜¯ä¸‹é¢çš„æ ·å­ã€‚</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/SpringBootJWT/20190325103836546.png\"  alt=\"https://www.wangbase.com/blogimg/asset/201807/bg2018072303.jpg\"></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><p>JWTæ˜¯json web tokenç¼©å†™ã€‚å®ƒå°†ç”¨æˆ·ä¿¡æ¯åŠ å¯†åˆ°tokené‡Œï¼ŒæœåŠ¡å™¨ä¸ä¿å­˜ä»»ä½•ç”¨æˆ·ä¿¡æ¯ã€‚æœåŠ¡å™¨é€šè¿‡ä½¿ç”¨ä¿å­˜çš„å¯†é’¥éªŒè¯tokençš„æ­£ç¡®æ€§ï¼Œåªè¦æ­£ç¡®å³é€šè¿‡éªŒè¯ã€‚</p>\n<p>ï¼ˆ1ï¼‰JWT é»˜è®¤æ˜¯ä¸åŠ å¯†ï¼Œä½†ä¹Ÿæ˜¯å¯ä»¥åŠ å¯†çš„ã€‚ç”ŸæˆåŸå§‹ Token ä»¥åï¼Œå¯ä»¥ç”¨å¯†é’¥å†åŠ å¯†ä¸€æ¬¡ã€‚</p>\n<p>ï¼ˆ2ï¼‰JWT ä¸åŠ å¯†çš„æƒ…å†µä¸‹ï¼Œä¸èƒ½å°†ç§˜å¯†æ•°æ®å†™å…¥ JWTã€‚</p>\n<p>ï¼ˆ3ï¼‰JWT ä¸ä»…å¯ä»¥ç”¨äºè®¤è¯ï¼Œä¹Ÿå¯ä»¥ç”¨äºäº¤æ¢ä¿¡æ¯ã€‚æœ‰æ•ˆä½¿ç”¨ JWTï¼Œå¯ä»¥é™ä½æœåŠ¡å™¨æŸ¥è¯¢æ•°æ®åº“çš„æ¬¡æ•°ã€‚</p>\n<p>ï¼ˆ4ï¼‰JWT çš„æœ€å¤§ç¼ºç‚¹æ˜¯ï¼Œç”±äºæœåŠ¡å™¨ä¸ä¿å­˜ session çŠ¶æ€ï¼Œå› æ­¤æ— æ³•åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­åºŸæ­¢æŸä¸ª tokenï¼Œæˆ–è€…æ›´æ”¹ token çš„æƒé™ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦ JWT ç­¾å‘äº†ï¼Œåœ¨åˆ°æœŸä¹‹å‰å°±ä¼šå§‹ç»ˆæœ‰æ•ˆï¼Œé™¤éæœåŠ¡å™¨éƒ¨ç½²é¢å¤–çš„é€»è¾‘ã€‚</p>\n<p>ï¼ˆ5ï¼‰JWT æœ¬èº«åŒ…å«äº†è®¤è¯ä¿¡æ¯ï¼Œä¸€æ—¦æ³„éœ²ï¼Œä»»ä½•äººéƒ½å¯ä»¥è·å¾—è¯¥ä»¤ç‰Œçš„æ‰€æœ‰æƒé™ã€‚ä¸ºäº†å‡å°‘ç›—ç”¨ï¼ŒJWT çš„æœ‰æ•ˆæœŸåº”è¯¥è®¾ç½®å¾—æ¯”è¾ƒçŸ­ã€‚å¯¹äºä¸€äº›æ¯”è¾ƒé‡è¦çš„æƒé™ï¼Œä½¿ç”¨æ—¶åº”è¯¥å†æ¬¡å¯¹ç”¨æˆ·è¿›è¡Œè®¤è¯ã€‚</p>\n<p>ï¼ˆ6ï¼‰ä¸ºäº†å‡å°‘ç›—ç”¨ï¼ŒJWT ä¸åº”è¯¥ä½¿ç”¨ HTTP åè®®æ˜ç ä¼ è¾“ï¼Œè¦ä½¿ç”¨ HTTPS åè®®ä¼ è¾“ã€‚</p>\n<h2 id=\"ä½¿ç”¨\"><a href=\"#ä½¿ç”¨\" class=\"headerlink\" title=\"ä½¿ç”¨\"></a>ä½¿ç”¨</h2><ul>\n<li>æ·»åŠ ä¾èµ–<br><a href=\"https://jwt.io/\" target=\"_blank\" rel=\"noopener\">https://jwt.io/</a><br>é€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬</li>\n<li>ä½¿ç”¨</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import java.util.Calendar;</span><br><span class=\"line\">import java.util.Date;</span><br><span class=\"line\">import java.util.HashMap;</span><br><span class=\"line\">import java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\">import com.auth0.jwt.JWT;</span><br><span class=\"line\">import com.auth0.jwt.JWTVerifier;</span><br><span class=\"line\">import com.auth0.jwt.algorithms.Algorithm;</span><br><span class=\"line\">import com.auth0.jwt.interfaces.Claim;</span><br><span class=\"line\">import com.auth0.jwt.interfaces.DecodedJWT;</span><br><span class=\"line\">import org.springframework.util.StringUtils;</span><br><span class=\"line\"></span><br><span class=\"line\">public class TokenConfig &#123;</span><br><span class=\"line\">    &#x2F;** tokenç§˜é’¥ï¼Œè¯·å‹¿æ³„éœ²ï¼Œè¯·å‹¿éšä¾¿ä¿®æ”¹ backups:JKKLJOoasdlfj *&#x2F;</span><br><span class=\"line\">    public static final String SECRET &#x3D; &quot;JKKLJOoasdlfj&quot;;</span><br><span class=\"line\">    &#x2F;** token è¿‡æœŸæ—¶é—´: 10å¤© *&#x2F;</span><br><span class=\"line\">    public static final int calendarField &#x3D; Calendar.DATE;</span><br><span class=\"line\">    public static final int calendarInterval &#x3D; 10;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;**</span><br><span class=\"line\">     * JWTç”ŸæˆToken.&lt;br&#x2F;&gt;</span><br><span class=\"line\">     *</span><br><span class=\"line\">     * JWTæ„æˆ: header, payload, signature</span><br><span class=\"line\">     *</span><br><span class=\"line\">     * @param user_id</span><br><span class=\"line\">     *            ç™»å½•æˆåŠŸåç”¨æˆ·user_id, å‚æ•°user_idä¸å¯ä¼ ç©º</span><br><span class=\"line\">     *&#x2F;</span><br><span class=\"line\">    public static String createToken(Long user_id) throws Exception &#123;</span><br><span class=\"line\">        Date iatDate &#x3D; new Date();</span><br><span class=\"line\">        &#x2F;&#x2F; expire time</span><br><span class=\"line\">        Calendar nowTime &#x3D; Calendar.getInstance();</span><br><span class=\"line\">        nowTime.add(calendarField, calendarInterval);</span><br><span class=\"line\">        Date expiresDate &#x3D; nowTime.getTime();</span><br><span class=\"line\"></span><br><span class=\"line\">        &#x2F;&#x2F; header Map</span><br><span class=\"line\">        Map&lt;String, Object&gt; map &#x3D; new HashMap&lt;&gt;();</span><br><span class=\"line\">        map.put(&quot;alg&quot;, &quot;HS256&quot;);</span><br><span class=\"line\">        map.put(&quot;typ&quot;, &quot;JWT&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">        &#x2F;&#x2F; build token</span><br><span class=\"line\">        &#x2F;&#x2F; param backups &#123;iss:Service, aud:APP&#125;</span><br><span class=\"line\">        String token &#x3D; JWT.create().withHeader(map) &#x2F;&#x2F; header</span><br><span class=\"line\">                .withClaim(&quot;iss&quot;, &quot;Service&quot;) &#x2F;&#x2F; payload</span><br><span class=\"line\">                .withClaim(&quot;aud&quot;, &quot;APP&quot;).withClaim(&quot;user_id&quot;, null &#x3D;&#x3D; user_id ? null : user_id.toString())</span><br><span class=\"line\">                .withIssuedAt(iatDate) &#x2F;&#x2F; sign time</span><br><span class=\"line\">                .withExpiresAt(expiresDate) &#x2F;&#x2F; expire time</span><br><span class=\"line\">                .sign(Algorithm.HMAC256(SECRET)); &#x2F;&#x2F; signature</span><br><span class=\"line\"></span><br><span class=\"line\">        return token;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;**</span><br><span class=\"line\">     * è§£å¯†Token</span><br><span class=\"line\">     *</span><br><span class=\"line\">     * @param token</span><br><span class=\"line\">     * @return</span><br><span class=\"line\">     * @throws Exception</span><br><span class=\"line\">     *&#x2F;</span><br><span class=\"line\">    public static Map&lt;String, Claim&gt; verifyToken(String token) &#123;</span><br><span class=\"line\">        DecodedJWT jwt &#x3D; null;</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            JWTVerifier verifier &#x3D; JWT.require(Algorithm.HMAC256(SECRET)).build();</span><br><span class=\"line\">            jwt &#x3D; verifier.verify(token);</span><br><span class=\"line\">        &#125; catch (Exception e) &#123;</span><br><span class=\"line\">            &#x2F;&#x2F; e.printStackTrace();</span><br><span class=\"line\">            &#x2F;&#x2F; token æ ¡éªŒå¤±è´¥, æŠ›å‡ºTokenéªŒè¯éæ³•å¼‚å¸¸</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return jwt.getClaims();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;**</span><br><span class=\"line\">     * æ ¹æ®Tokenè·å–user_id</span><br><span class=\"line\">     *</span><br><span class=\"line\">     * @param token</span><br><span class=\"line\">     * @return user_id</span><br><span class=\"line\">     *&#x2F;</span><br><span class=\"line\">    public static Long getAppUID(String token) &#123;</span><br><span class=\"line\">        Map&lt;String, Claim&gt; claims &#x3D; verifyToken(token);</span><br><span class=\"line\">        Claim user_id_claim &#x3D; claims.get(&quot;user_id&quot;);</span><br><span class=\"line\">        if (null &#x3D;&#x3D; user_id_claim || StringUtils.isEmpty(user_id_claim.asString())) &#123;</span><br><span class=\"line\">            &#x2F;&#x2F; token æ ¡éªŒå¤±è´¥, æŠ›å‡ºTokenéªŒè¯éæ³•å¼‚å¸¸</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return Long.valueOf(user_id_claim.asString());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"æ¦‚å¿µè§£æ\"><a href=\"#æ¦‚å¿µè§£æ\" class=\"headerlink\" title=\"æ¦‚å¿µè§£æ\"></a>æ¦‚å¿µè§£æ</h2><p>JWT çš„ä¸‰ä¸ªéƒ¨åˆ†ä¾æ¬¡å¦‚ä¸‹ã€‚</p>\n<ul>\n<li>Headerï¼ˆå¤´éƒ¨ï¼‰</li>\n<li>Payloadï¼ˆè´Ÿè½½ï¼‰</li>\n<li>Signatureï¼ˆç­¾åï¼‰</li>\n</ul>\n<p>å†™æˆä¸€è¡Œï¼Œå°±æ˜¯ä¸‹é¢çš„æ ·å­ã€‚</p>\n<p><img src=\"/image/SpringBootJWT/20190325103836546.png\" alt=\"https://www.wangbase.com/blogimg/asset/201807/bg2018072303.jpg\"></p>\n"},{"title":"React Hook å€’è®¡æ—¶","date":"2019-07-30T13:01:24.000Z","cover":"/image/cover/React.jpeg","_content":"\n```\nuseEffect(() => {\n    setTimeout(() => {\n      if (count > 0) {\n        setCount((c: number) => c - 1); // âœ… åœ¨è¿™ä¸ä¾èµ–äºå¤–éƒ¨çš„ `count` å˜é‡\n      }\n    }, 1000);\n  }, [count]); // âœ… æˆ‘ä»¬çš„ effect ä¸é€‚ç”¨ç»„ä»¶ä½œç”¨åŸŸä¸­çš„ä»»ä½•å˜é‡\n```\n\n```\n<button onClick={() => setCount(60)} >ç‚¹æˆ‘</button>\n```\n\n","source":"_posts/React-Hook-å€’è®¡æ—¶.md","raw":"---\ntitle: React Hook å€’è®¡æ—¶\ndate: 2019-07-30 21:01:24\ntags: [ReactHook, React, å€’è®¡æ—¶]\ncategory: [React]\ncover: /image/cover/React.jpeg\n---\n\n```\nuseEffect(() => {\n    setTimeout(() => {\n      if (count > 0) {\n        setCount((c: number) => c - 1); // âœ… åœ¨è¿™ä¸ä¾èµ–äºå¤–éƒ¨çš„ `count` å˜é‡\n      }\n    }, 1000);\n  }, [count]); // âœ… æˆ‘ä»¬çš„ effect ä¸é€‚ç”¨ç»„ä»¶ä½œç”¨åŸŸä¸­çš„ä»»ä½•å˜é‡\n```\n\n```\n<button onClick={() => setCount(60)} >ç‚¹æˆ‘</button>\n```\n\n","slug":"React-Hook-å€’è®¡æ—¶","published":1,"updated":"2021-06-24T14:00:06.847Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra7r000blwrd9ucsbdrj","content":"<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useEffect(() &#x3D;&gt; &#123;</span><br><span class=\"line\">    setTimeout(() &#x3D;&gt; &#123;</span><br><span class=\"line\">      if (count &gt; 0) &#123;</span><br><span class=\"line\">        setCount((c: number) &#x3D;&gt; c - 1); &#x2F;&#x2F; âœ… åœ¨è¿™ä¸ä¾èµ–äºå¤–éƒ¨çš„ &#96;count&#96; å˜é‡</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;, 1000);</span><br><span class=\"line\">  &#125;, [count]); &#x2F;&#x2F; âœ… æˆ‘ä»¬çš„ effect ä¸é€‚ç”¨ç»„ä»¶ä½œç”¨åŸŸä¸­çš„ä»»ä½•å˜é‡</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;button onClick&#x3D;&#123;() &#x3D;&gt; setCount(60)&#125; &gt;ç‚¹æˆ‘&lt;&#x2F;button&gt;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useEffect(() &#x3D;&gt; &#123;</span><br><span class=\"line\">    setTimeout(() &#x3D;&gt; &#123;</span><br><span class=\"line\">      if (count &gt; 0) &#123;</span><br><span class=\"line\">        setCount((c: number) &#x3D;&gt; c - 1); &#x2F;&#x2F; âœ… åœ¨è¿™ä¸ä¾èµ–äºå¤–éƒ¨çš„ &#96;count&#96; å˜é‡</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;, 1000);</span><br><span class=\"line\">  &#125;, [count]); &#x2F;&#x2F; âœ… æˆ‘ä»¬çš„ effect ä¸é€‚ç”¨ç»„ä»¶ä½œç”¨åŸŸä¸­çš„ä»»ä½•å˜é‡</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;button onClick&#x3D;&#123;() &#x3D;&gt; setCount(60)&#125; &gt;ç‚¹æˆ‘&lt;&#x2F;button&gt;</span><br></pre></td></tr></table></figure>\n\n"},{"title":"Webpack CleanWebpackPlugin is not a constructor","date":"2019-06-22T07:55:56.000Z","cover":"/image/cover/webpack.png","_content":"\n## å‰è¨€\nä»Šå¤©è‡ªå·±è·Ÿç€webpackå®˜ç½‘çš„demoä¸€æ­¥æ­¥èµ°ä¸‹æ¥ã€‚å‘ç°äº†è¿™ä¸ªé—®é¢˜ã€‚\n\n![](/image/WebpackCleanWebpackPlugin/20190622155255789.png)\n\næŸ¥äº†ä¸€åœˆã€‚å‘ç°äº†è¿™ä¸ªåšä¸»ã€‚niceï¼\n```\n// webpackç‰ˆæœ¬ï¼š4.34.0\n \n// æŠ›é”™åŸå†™æ³•\nconst CleanWebpackPlugin = require(\"clean-webpack-plugin\");\n \n...\n \nplugins: [\n    new CleanWebpackPlugin(['dist'])\n]\n \n...\n \n// å¦ä¸€ç§é”™è¯¯å†™æ³•\n \nconst CleanWebpackPlugin = require(\"clean-webpack-plugin\");\n \n...\n \nplugins: [\n    new CleanWebpackPlugin(['dist'], {\n        root: path.resolve(__dirname, '../'),   //æ ¹ç›®å½•\n    })\n]\n \n...\n \n// =============================åˆ†å‰²çº¿==============================\n \n// æ­£ç¡®å†™æ³•\n \nconst { CleanWebpackPlugin } = require(\"clean-webpack-plugin\");\n \n...\n \nplugins: [\n    new CleanWebpackPlugin()\n]\n \n```\n\n ç°åœ¨çš„ç‰ˆæœ¬ä¸ç”¨æŒ‡å®šæ–‡ä»¶è·¯å¾„äº†ï¼Œç›´æ¥è°ƒç”¨new CleanWebpackPlugin()\n ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/WebpackCleanWebpackPlugin/20190622155123842.png)\nç´¢å¼•ï¼šhttps://blog.csdn.net/qq_36242361/article/details/90709258\n\n","source":"_posts/Webpack-CleanWebpackPlugin-is-not-a-constructor.md","raw":"---\ntitle: Webpack CleanWebpackPlugin is not a constructor\ndate: 2019-06-22 15:55:56\ntags: [WebPack, clean-webpack-plugin]\ncategory: [WebPack]\ncover: /image/cover/webpack.png\n---\n\n## å‰è¨€\nä»Šå¤©è‡ªå·±è·Ÿç€webpackå®˜ç½‘çš„demoä¸€æ­¥æ­¥èµ°ä¸‹æ¥ã€‚å‘ç°äº†è¿™ä¸ªé—®é¢˜ã€‚\n\n![](/image/WebpackCleanWebpackPlugin/20190622155255789.png)\n\næŸ¥äº†ä¸€åœˆã€‚å‘ç°äº†è¿™ä¸ªåšä¸»ã€‚niceï¼\n```\n// webpackç‰ˆæœ¬ï¼š4.34.0\n \n// æŠ›é”™åŸå†™æ³•\nconst CleanWebpackPlugin = require(\"clean-webpack-plugin\");\n \n...\n \nplugins: [\n    new CleanWebpackPlugin(['dist'])\n]\n \n...\n \n// å¦ä¸€ç§é”™è¯¯å†™æ³•\n \nconst CleanWebpackPlugin = require(\"clean-webpack-plugin\");\n \n...\n \nplugins: [\n    new CleanWebpackPlugin(['dist'], {\n        root: path.resolve(__dirname, '../'),   //æ ¹ç›®å½•\n    })\n]\n \n...\n \n// =============================åˆ†å‰²çº¿==============================\n \n// æ­£ç¡®å†™æ³•\n \nconst { CleanWebpackPlugin } = require(\"clean-webpack-plugin\");\n \n...\n \nplugins: [\n    new CleanWebpackPlugin()\n]\n \n```\n\n ç°åœ¨çš„ç‰ˆæœ¬ä¸ç”¨æŒ‡å®šæ–‡ä»¶è·¯å¾„äº†ï¼Œç›´æ¥è°ƒç”¨new CleanWebpackPlugin()\n ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/WebpackCleanWebpackPlugin/20190622155123842.png)\nç´¢å¼•ï¼šhttps://blog.csdn.net/qq_36242361/article/details/90709258\n\n","slug":"Webpack-CleanWebpackPlugin-is-not-a-constructor","published":1,"updated":"2021-06-24T14:00:06.847Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra7s000clwrdh53d8rtq","content":"<h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><p>ä»Šå¤©è‡ªå·±è·Ÿç€webpackå®˜ç½‘çš„demoä¸€æ­¥æ­¥èµ°ä¸‹æ¥ã€‚å‘ç°äº†è¿™ä¸ªé—®é¢˜ã€‚</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/WebpackCleanWebpackPlugin/20190622155255789.png\"  alt=\"\"></p>\n<p>æŸ¥äº†ä¸€åœˆã€‚å‘ç°äº†è¿™ä¸ªåšä¸»ã€‚niceï¼</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; webpackç‰ˆæœ¬ï¼š4.34.0</span><br><span class=\"line\"> </span><br><span class=\"line\">&#x2F;&#x2F; æŠ›é”™åŸå†™æ³•</span><br><span class=\"line\">const CleanWebpackPlugin &#x3D; require(&quot;clean-webpack-plugin&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">...</span><br><span class=\"line\"> </span><br><span class=\"line\">plugins: [</span><br><span class=\"line\">    new CleanWebpackPlugin([&#39;dist&#39;])</span><br><span class=\"line\">]</span><br><span class=\"line\"> </span><br><span class=\"line\">...</span><br><span class=\"line\"> </span><br><span class=\"line\">&#x2F;&#x2F; å¦ä¸€ç§é”™è¯¯å†™æ³•</span><br><span class=\"line\"> </span><br><span class=\"line\">const CleanWebpackPlugin &#x3D; require(&quot;clean-webpack-plugin&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">...</span><br><span class=\"line\"> </span><br><span class=\"line\">plugins: [</span><br><span class=\"line\">    new CleanWebpackPlugin([&#39;dist&#39;], &#123;</span><br><span class=\"line\">        root: path.resolve(__dirname, &#39;..&#x2F;&#39;),   &#x2F;&#x2F;æ ¹ç›®å½•</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">]</span><br><span class=\"line\"> </span><br><span class=\"line\">...</span><br><span class=\"line\"> </span><br><span class=\"line\">&#x2F;&#x2F; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;åˆ†å‰²çº¿&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\"> </span><br><span class=\"line\">&#x2F;&#x2F; æ­£ç¡®å†™æ³•</span><br><span class=\"line\"> </span><br><span class=\"line\">const &#123; CleanWebpackPlugin &#125; &#x3D; require(&quot;clean-webpack-plugin&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">...</span><br><span class=\"line\"> </span><br><span class=\"line\">plugins: [</span><br><span class=\"line\">    new CleanWebpackPlugin()</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p> ç°åœ¨çš„ç‰ˆæœ¬ä¸ç”¨æŒ‡å®šæ–‡ä»¶è·¯å¾„äº†ï¼Œç›´æ¥è°ƒç”¨new CleanWebpackPlugin()<br> <img src=\"/\" class=\"lazyload\" data-src=\"/image/WebpackCleanWebpackPlugin/20190622155123842.png\"  alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"><br>ç´¢å¼•ï¼š<a href=\"https://blog.csdn.net/qq_36242361/article/details/90709258\" target=\"_blank\" rel=\"noopener\">https://blog.csdn.net/qq_36242361/article/details/90709258</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><p>ä»Šå¤©è‡ªå·±è·Ÿç€webpackå®˜ç½‘çš„demoä¸€æ­¥æ­¥èµ°ä¸‹æ¥ã€‚å‘ç°äº†è¿™ä¸ªé—®é¢˜ã€‚</p>\n<p><img src=\"/image/WebpackCleanWebpackPlugin/20190622155255789.png\" alt=\"\"></p>\n<p>æŸ¥äº†ä¸€åœˆã€‚å‘ç°äº†è¿™ä¸ªåšä¸»ã€‚niceï¼</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; webpackç‰ˆæœ¬ï¼š4.34.0</span><br><span class=\"line\"> </span><br><span class=\"line\">&#x2F;&#x2F; æŠ›é”™åŸå†™æ³•</span><br><span class=\"line\">const CleanWebpackPlugin &#x3D; require(&quot;clean-webpack-plugin&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">...</span><br><span class=\"line\"> </span><br><span class=\"line\">plugins: [</span><br><span class=\"line\">    new CleanWebpackPlugin([&#39;dist&#39;])</span><br><span class=\"line\">]</span><br><span class=\"line\"> </span><br><span class=\"line\">...</span><br><span class=\"line\"> </span><br><span class=\"line\">&#x2F;&#x2F; å¦ä¸€ç§é”™è¯¯å†™æ³•</span><br><span class=\"line\"> </span><br><span class=\"line\">const CleanWebpackPlugin &#x3D; require(&quot;clean-webpack-plugin&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">...</span><br><span class=\"line\"> </span><br><span class=\"line\">plugins: [</span><br><span class=\"line\">    new CleanWebpackPlugin([&#39;dist&#39;], &#123;</span><br><span class=\"line\">        root: path.resolve(__dirname, &#39;..&#x2F;&#39;),   &#x2F;&#x2F;æ ¹ç›®å½•</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">]</span><br><span class=\"line\"> </span><br><span class=\"line\">...</span><br><span class=\"line\"> </span><br><span class=\"line\">&#x2F;&#x2F; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;åˆ†å‰²çº¿&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\"> </span><br><span class=\"line\">&#x2F;&#x2F; æ­£ç¡®å†™æ³•</span><br><span class=\"line\"> </span><br><span class=\"line\">const &#123; CleanWebpackPlugin &#125; &#x3D; require(&quot;clean-webpack-plugin&quot;);</span><br><span class=\"line\"> </span><br><span class=\"line\">...</span><br><span class=\"line\"> </span><br><span class=\"line\">plugins: [</span><br><span class=\"line\">    new CleanWebpackPlugin()</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p> ç°åœ¨çš„ç‰ˆæœ¬ä¸ç”¨æŒ‡å®šæ–‡ä»¶è·¯å¾„äº†ï¼Œç›´æ¥è°ƒç”¨new CleanWebpackPlugin()<br> <img src=\"/image/WebpackCleanWebpackPlugin/20190622155123842.png\" alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"><br>ç´¢å¼•ï¼š<a href=\"https://blog.csdn.net/qq_36242361/article/details/90709258\" target=\"_blank\" rel=\"noopener\">https://blog.csdn.net/qq_36242361/article/details/90709258</a></p>\n"},{"title":"JavaScript æµ…æ‹·è´ æ·±æ‹·è´ èµ‹å€¼ å¼•ç”¨ JS","date":"2019-06-19T02:10:59.000Z","cover":"/image/cover/JavaScript.png","_content":"\n## å‰è¨€\nè¿™ä¸ªé—®é¢˜è¯´ä¸¥é‡ä¹Ÿä¸ä¸¥é‡ï¼Œè¯´ä¸å°ä¹Ÿä¸å°ã€‚\nå¦‚æœä½ ä¹Ÿåˆšåˆšå¥½ç¢°åˆ°äº†è¿™ä¸ªé—®é¢˜ã€‚å°±è·Ÿç€æˆ‘ä¸€èµ·äº†è§£ä¸€ä¸‹å§ï¼\n\n## åŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹\n\n \n\n - **åŸºæœ¬ç±»å‹**\n\nåŸºæœ¬ç±»å‹ä¹Ÿç§°å€¼ç±»å‹ï¼Œæ•°å€¼ç±»å‹ã€‚\nåŒ…æ‹¬äº†\n\n  1. String\n 2. Number\n 3. Boolean\n 4. Null\n 5. Undefined\n 6. Symbolï¼ˆES6æ–°å¢ï¼Œè¡¨ç¤ºç‹¬ä¸€æ— äºŒçš„ä¸€ä¸ªå€¼ã€‚[MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Symbol)ï¼‰\n\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/æ·±æ‹·è´æµ…æ‹·è´/20190428204522836.png)\n\nåŸºæœ¬ç±»å‹çš„æ˜¯æ”¾åœ¨æ ˆåŒºçš„ï¼Œè®¿é—®çš„æ—¶å€™ä¹Ÿæ˜¯æŒ‰å€¼è®¿é—®ï¼Œå°±æ˜¯æ­£å¸¸çš„ç†è§£çš„èµ‹å€¼ã€‚\n\n - **å¼•ç”¨ç±»å‹å’Œæµ…æ‹·è´**\n\n\nå¼•ç”¨ç±»å‹ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯å¼•ç”¨æ¥è®¿é—®çš„ã€‚\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/æ·±æ‹·è´æµ…æ‹·è´/20190428204904611.png)\n\nåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ“ä½œçš„æ˜¯**q**ã€‚ä¸ºä»€ä¹ˆ**w**ä¹Ÿæ”¹å˜äº†å‘¢ï¼Ÿ\n\nå› ä¸º**w**ä¸æ˜¯çœŸçš„ç»™ä»–èµ‹å€¼äº†[1, 2]ã€‚\n\nè€Œæ˜¯èµ‹å€¼ç»™äº†**q**æ‰€æŒ‡å‘çš„åœ°å€çš„æŒ‡é’ˆã€‚\n\næœ‰ç‚¹ç»•ï¼Œå…¶å®è¯´ç™½äº†å°±æ˜¯ q æ˜¯æŒ‡å‘åœ°å€ A çš„ã€‚\n\nw = q ï¼Œåªæ˜¯æŠŠ q æŒ‡å‘ åœ°å€ A çš„è¿™ä¸ªæŒ‡é’ˆèµ‹å€¼ç»™äº† w ã€‚\n\nw å’Œ q éƒ½å¯ä»¥æ“ä½œè¿™ä¸ªåœ°å€çš„å†…å®¹ã€‚\n\næ‰€ä»¥ï¼Œå½“æˆ‘ä»¬ç”¨ q æ¥æ“ä½œè¿™ä¸ªåœ°å€å†…å®¹çš„æ—¶å€™ï¼Œåœ°å€å†…å®¹å°±å˜äº†ã€‚å½“ w å»å–å€¼çš„æ—¶å€™ï¼Œå†…å®¹å·²ç»å˜äº†ã€‚\n\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/æ·±æ‹·è´æµ…æ‹·è´/20190428205243797.png)\n\n\nw å’Œ q éƒ½å¯ä»¥æ“ä½œè¿™ä¸ªåœ°å€å†…å®¹ã€‚\n\né‚£ä¹ˆå¼•ç”¨ç±»å‹æœ‰é‚£äº›å‘¢ï¼Ÿ\n\n\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/æ·±æ‹·è´æµ…æ‹·è´/20190428205350562.png)\n\nè¿™æ ·ç®€å•çš„å¼•ç”¨èµ‹å€¼ä¹Ÿå«åšæµ…æ‹·è´ã€‚\n\nå¯èƒ½ä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚:\n\nAå’ŒBéƒ½æ˜¯æ•°ç»„ï¼›\n\næˆ‘åªæ˜¯æ‡’å¾—ç»™Bèµ‹å€¼å’ŒAä¸€æ¨¡ä¸€æ ·çš„ï¼›\n\næ‰€ä»¥æˆ‘ç›´æ¥B = Aï¼›\n\næˆ‘åœ¨æ“ä½œå®ŒBä¹‹åæˆ‘åˆæƒ³å»å–å€¼Açš„å€¼çš„æ—¶å€™ï¼Œå‘ç°Aå·²ç»å˜äº†ã€‚\n\nåœ¨reactä¸­ä¹Ÿæœ‰å¯¹stateæµ…æ‹·è´åˆ¤æ–­çš„ï¼ˆPureComponentï¼‰\n\n\n - **æ·±æ‹·è´**\n\n ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/æ·±æ‹·è´æµ…æ‹·è´/20190428205853748.png)\n\nè¿™ä¸ªå°±å«åšæ·±æ‹·è´ã€‚\n\nå°†ä»–çš„å†…å®¹åˆ†è§£å‡ºæ¥è¿›è¡Œè§£æã€‚\n\nä½†æ˜¯è¿™æ ·ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ã€‚\n\néº»çƒ¦ï¼\n\næ¯”å¦‚\n\nlet A = [ {a: [1, 2]}, {b: [1, 2]} ]ã€‚\n\nè¿™ä¸ªæ—¶å€™è¦æ·±æ‹·è´ç»™Bçš„è¯ã€‚\n\nè¦ä¸€ç›´ç»“æ„åˆ°å¾ˆæ·±å¤„ã€‚\n\næœ‰å‡ ä¸ªä¸ªåŠæ³•å¯ä»¥è§£å†³ã€‚\n\n1.å«åš**åºåˆ—åŒ–**\n\n - JSON.stringify()\n\n - JSON.parse()\n\n ä½†æ˜¯è¿™æ ·éå¸¸æµªè´¹èµ„æº\n\n2.Object.assign()æ‹·è´\n\n - å½“å¯¹è±¡ä¸­åªæœ‰ä¸€çº§å±æ€§ï¼Œæ²¡æœ‰äºŒçº§å±æ€§çš„æ—¶å€™ï¼Œæ­¤æ–¹æ³•ä¸ºæ·±æ‹·è´ï¼Œä½†æ˜¯å¯¹è±¡ä¸­æœ‰å¯¹è±¡çš„æ—¶å€™ï¼Œæ­¤æ–¹æ³•ï¼Œåœ¨äºŒçº§å±æ€§ä»¥åå°±æ˜¯æµ…æ‹·è´ã€‚\n\n 3.ä½¿ç”¨é€’å½’çš„æ–¹å¼å®ç°æ·±æ‹·è´\n\n```\n //ä½¿ç”¨é€’å½’çš„æ–¹å¼å®ç°æ•°ç»„ã€å¯¹è±¡çš„æ·±æ‹·è´\nfunction deepClone1(obj) {\n  //åˆ¤æ–­æ‹·è´çš„è¦è¿›è¡Œæ·±æ‹·è´çš„æ˜¯æ•°ç»„è¿˜æ˜¯å¯¹è±¡ï¼Œæ˜¯æ•°ç»„çš„è¯è¿›è¡Œæ•°ç»„æ‹·è´ï¼Œå¯¹è±¡çš„è¯è¿›è¡Œå¯¹è±¡æ‹·è´\n  var objClone = Array.isArray(obj) ? [] : {};\n  //è¿›è¡Œæ·±æ‹·è´çš„ä¸èƒ½ä¸ºç©ºï¼Œå¹¶ä¸”æ˜¯å¯¹è±¡æˆ–è€…æ˜¯\n  if (obj && typeof obj === \"object\") {\n    for (key in obj) {\n      if (obj.hasOwnProperty(key)) {\n        if (obj[key] && typeof obj[key] === \"object\") {\n          objClone[key] = deepClone1(obj[key]);\n        } else {\n          objClone[key] = obj[key];\n        }\n      }\n    }\n  }\n  return objClone;\n}\n```\n\n5.lodashå‡½æ•°åº“å®ç°æ·±æ‹·è´\n\nlodashå¾ˆçƒ­é—¨çš„å‡½æ•°åº“ï¼Œæä¾›äº† lodash.cloneDeep()å®ç°æ·±æ‹·è´\n","source":"_posts/JavaScript-æµ…æ‹·è´-æ·±æ‹·è´-èµ‹å€¼-å¼•ç”¨-JS.md","raw":"---\ntitle: JavaScript æµ…æ‹·è´ æ·±æ‹·è´ èµ‹å€¼ å¼•ç”¨ JS\ndate: 2019-06-19 10:10:59\ntags: [æ·±æ‹·è´, æµ…æ‹·è´]\ncategory: [JavaScript]\ncover: /image/cover/JavaScript.png\n---\n\n## å‰è¨€\nè¿™ä¸ªé—®é¢˜è¯´ä¸¥é‡ä¹Ÿä¸ä¸¥é‡ï¼Œè¯´ä¸å°ä¹Ÿä¸å°ã€‚\nå¦‚æœä½ ä¹Ÿåˆšåˆšå¥½ç¢°åˆ°äº†è¿™ä¸ªé—®é¢˜ã€‚å°±è·Ÿç€æˆ‘ä¸€èµ·äº†è§£ä¸€ä¸‹å§ï¼\n\n## åŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹\n\n \n\n - **åŸºæœ¬ç±»å‹**\n\nåŸºæœ¬ç±»å‹ä¹Ÿç§°å€¼ç±»å‹ï¼Œæ•°å€¼ç±»å‹ã€‚\nåŒ…æ‹¬äº†\n\n  1. String\n 2. Number\n 3. Boolean\n 4. Null\n 5. Undefined\n 6. Symbolï¼ˆES6æ–°å¢ï¼Œè¡¨ç¤ºç‹¬ä¸€æ— äºŒçš„ä¸€ä¸ªå€¼ã€‚[MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Symbol)ï¼‰\n\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/æ·±æ‹·è´æµ…æ‹·è´/20190428204522836.png)\n\nåŸºæœ¬ç±»å‹çš„æ˜¯æ”¾åœ¨æ ˆåŒºçš„ï¼Œè®¿é—®çš„æ—¶å€™ä¹Ÿæ˜¯æŒ‰å€¼è®¿é—®ï¼Œå°±æ˜¯æ­£å¸¸çš„ç†è§£çš„èµ‹å€¼ã€‚\n\n - **å¼•ç”¨ç±»å‹å’Œæµ…æ‹·è´**\n\n\nå¼•ç”¨ç±»å‹ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯å¼•ç”¨æ¥è®¿é—®çš„ã€‚\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/æ·±æ‹·è´æµ…æ‹·è´/20190428204904611.png)\n\nåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ“ä½œçš„æ˜¯**q**ã€‚ä¸ºä»€ä¹ˆ**w**ä¹Ÿæ”¹å˜äº†å‘¢ï¼Ÿ\n\nå› ä¸º**w**ä¸æ˜¯çœŸçš„ç»™ä»–èµ‹å€¼äº†[1, 2]ã€‚\n\nè€Œæ˜¯èµ‹å€¼ç»™äº†**q**æ‰€æŒ‡å‘çš„åœ°å€çš„æŒ‡é’ˆã€‚\n\næœ‰ç‚¹ç»•ï¼Œå…¶å®è¯´ç™½äº†å°±æ˜¯ q æ˜¯æŒ‡å‘åœ°å€ A çš„ã€‚\n\nw = q ï¼Œåªæ˜¯æŠŠ q æŒ‡å‘ åœ°å€ A çš„è¿™ä¸ªæŒ‡é’ˆèµ‹å€¼ç»™äº† w ã€‚\n\nw å’Œ q éƒ½å¯ä»¥æ“ä½œè¿™ä¸ªåœ°å€çš„å†…å®¹ã€‚\n\næ‰€ä»¥ï¼Œå½“æˆ‘ä»¬ç”¨ q æ¥æ“ä½œè¿™ä¸ªåœ°å€å†…å®¹çš„æ—¶å€™ï¼Œåœ°å€å†…å®¹å°±å˜äº†ã€‚å½“ w å»å–å€¼çš„æ—¶å€™ï¼Œå†…å®¹å·²ç»å˜äº†ã€‚\n\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/æ·±æ‹·è´æµ…æ‹·è´/20190428205243797.png)\n\n\nw å’Œ q éƒ½å¯ä»¥æ“ä½œè¿™ä¸ªåœ°å€å†…å®¹ã€‚\n\né‚£ä¹ˆå¼•ç”¨ç±»å‹æœ‰é‚£äº›å‘¢ï¼Ÿ\n\n\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/æ·±æ‹·è´æµ…æ‹·è´/20190428205350562.png)\n\nè¿™æ ·ç®€å•çš„å¼•ç”¨èµ‹å€¼ä¹Ÿå«åšæµ…æ‹·è´ã€‚\n\nå¯èƒ½ä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚:\n\nAå’ŒBéƒ½æ˜¯æ•°ç»„ï¼›\n\næˆ‘åªæ˜¯æ‡’å¾—ç»™Bèµ‹å€¼å’ŒAä¸€æ¨¡ä¸€æ ·çš„ï¼›\n\næ‰€ä»¥æˆ‘ç›´æ¥B = Aï¼›\n\næˆ‘åœ¨æ“ä½œå®ŒBä¹‹åæˆ‘åˆæƒ³å»å–å€¼Açš„å€¼çš„æ—¶å€™ï¼Œå‘ç°Aå·²ç»å˜äº†ã€‚\n\nåœ¨reactä¸­ä¹Ÿæœ‰å¯¹stateæµ…æ‹·è´åˆ¤æ–­çš„ï¼ˆPureComponentï¼‰\n\n\n - **æ·±æ‹·è´**\n\n ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/æ·±æ‹·è´æµ…æ‹·è´/20190428205853748.png)\n\nè¿™ä¸ªå°±å«åšæ·±æ‹·è´ã€‚\n\nå°†ä»–çš„å†…å®¹åˆ†è§£å‡ºæ¥è¿›è¡Œè§£æã€‚\n\nä½†æ˜¯è¿™æ ·ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ã€‚\n\néº»çƒ¦ï¼\n\næ¯”å¦‚\n\nlet A = [ {a: [1, 2]}, {b: [1, 2]} ]ã€‚\n\nè¿™ä¸ªæ—¶å€™è¦æ·±æ‹·è´ç»™Bçš„è¯ã€‚\n\nè¦ä¸€ç›´ç»“æ„åˆ°å¾ˆæ·±å¤„ã€‚\n\næœ‰å‡ ä¸ªä¸ªåŠæ³•å¯ä»¥è§£å†³ã€‚\n\n1.å«åš**åºåˆ—åŒ–**\n\n - JSON.stringify()\n\n - JSON.parse()\n\n ä½†æ˜¯è¿™æ ·éå¸¸æµªè´¹èµ„æº\n\n2.Object.assign()æ‹·è´\n\n - å½“å¯¹è±¡ä¸­åªæœ‰ä¸€çº§å±æ€§ï¼Œæ²¡æœ‰äºŒçº§å±æ€§çš„æ—¶å€™ï¼Œæ­¤æ–¹æ³•ä¸ºæ·±æ‹·è´ï¼Œä½†æ˜¯å¯¹è±¡ä¸­æœ‰å¯¹è±¡çš„æ—¶å€™ï¼Œæ­¤æ–¹æ³•ï¼Œåœ¨äºŒçº§å±æ€§ä»¥åå°±æ˜¯æµ…æ‹·è´ã€‚\n\n 3.ä½¿ç”¨é€’å½’çš„æ–¹å¼å®ç°æ·±æ‹·è´\n\n```\n //ä½¿ç”¨é€’å½’çš„æ–¹å¼å®ç°æ•°ç»„ã€å¯¹è±¡çš„æ·±æ‹·è´\nfunction deepClone1(obj) {\n  //åˆ¤æ–­æ‹·è´çš„è¦è¿›è¡Œæ·±æ‹·è´çš„æ˜¯æ•°ç»„è¿˜æ˜¯å¯¹è±¡ï¼Œæ˜¯æ•°ç»„çš„è¯è¿›è¡Œæ•°ç»„æ‹·è´ï¼Œå¯¹è±¡çš„è¯è¿›è¡Œå¯¹è±¡æ‹·è´\n  var objClone = Array.isArray(obj) ? [] : {};\n  //è¿›è¡Œæ·±æ‹·è´çš„ä¸èƒ½ä¸ºç©ºï¼Œå¹¶ä¸”æ˜¯å¯¹è±¡æˆ–è€…æ˜¯\n  if (obj && typeof obj === \"object\") {\n    for (key in obj) {\n      if (obj.hasOwnProperty(key)) {\n        if (obj[key] && typeof obj[key] === \"object\") {\n          objClone[key] = deepClone1(obj[key]);\n        } else {\n          objClone[key] = obj[key];\n        }\n      }\n    }\n  }\n  return objClone;\n}\n```\n\n5.lodashå‡½æ•°åº“å®ç°æ·±æ‹·è´\n\nlodashå¾ˆçƒ­é—¨çš„å‡½æ•°åº“ï¼Œæä¾›äº† lodash.cloneDeep()å®ç°æ·±æ‹·è´\n","slug":"JavaScript-æµ…æ‹·è´-æ·±æ‹·è´-èµ‹å€¼-å¼•ç”¨-JS","published":1,"updated":"2021-06-24T14:00:06.847Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra7u000glwrd6ddk4m07","content":"<h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><p>è¿™ä¸ªé—®é¢˜è¯´ä¸¥é‡ä¹Ÿä¸ä¸¥é‡ï¼Œè¯´ä¸å°ä¹Ÿä¸å°ã€‚<br>å¦‚æœä½ ä¹Ÿåˆšåˆšå¥½ç¢°åˆ°äº†è¿™ä¸ªé—®é¢˜ã€‚å°±è·Ÿç€æˆ‘ä¸€èµ·äº†è§£ä¸€ä¸‹å§ï¼</p>\n<h2 id=\"åŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹\"><a href=\"#åŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹\" class=\"headerlink\" title=\"åŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹\"></a>åŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹</h2><ul>\n<li><strong>åŸºæœ¬ç±»å‹</strong></li>\n</ul>\n<p>åŸºæœ¬ç±»å‹ä¹Ÿç§°å€¼ç±»å‹ï¼Œæ•°å€¼ç±»å‹ã€‚<br>åŒ…æ‹¬äº†</p>\n<ol>\n<li>String<ol start=\"2\">\n<li>Number</li>\n<li>Boolean</li>\n<li>Null</li>\n<li>Undefined</li>\n<li>Symbolï¼ˆES6æ–°å¢ï¼Œè¡¨ç¤ºç‹¬ä¸€æ— äºŒçš„ä¸€ä¸ªå€¼ã€‚<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Symbol\" target=\"_blank\" rel=\"noopener\">MDN</a>ï¼‰</li>\n</ol>\n</li>\n</ol>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/%E6%B7%B1%E6%8B%B7%E8%B4%9D%E6%B5%85%E6%8B%B7%E8%B4%9D/20190428204522836.png\"  alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<p>åŸºæœ¬ç±»å‹çš„æ˜¯æ”¾åœ¨æ ˆåŒºçš„ï¼Œè®¿é—®çš„æ—¶å€™ä¹Ÿæ˜¯æŒ‰å€¼è®¿é—®ï¼Œå°±æ˜¯æ­£å¸¸çš„ç†è§£çš„èµ‹å€¼ã€‚</p>\n<ul>\n<li><strong>å¼•ç”¨ç±»å‹å’Œæµ…æ‹·è´</strong></li>\n</ul>\n<p>å¼•ç”¨ç±»å‹ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯å¼•ç”¨æ¥è®¿é—®çš„ã€‚</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/%E6%B7%B1%E6%8B%B7%E8%B4%9D%E6%B5%85%E6%8B%B7%E8%B4%9D/20190428204904611.png\"  alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ“ä½œçš„æ˜¯<strong>q</strong>ã€‚ä¸ºä»€ä¹ˆ<strong>w</strong>ä¹Ÿæ”¹å˜äº†å‘¢ï¼Ÿ</p>\n<p>å› ä¸º<strong>w</strong>ä¸æ˜¯çœŸçš„ç»™ä»–èµ‹å€¼äº†[1, 2]ã€‚</p>\n<p>è€Œæ˜¯èµ‹å€¼ç»™äº†<strong>q</strong>æ‰€æŒ‡å‘çš„åœ°å€çš„æŒ‡é’ˆã€‚</p>\n<p>æœ‰ç‚¹ç»•ï¼Œå…¶å®è¯´ç™½äº†å°±æ˜¯ q æ˜¯æŒ‡å‘åœ°å€ A çš„ã€‚</p>\n<p>w = q ï¼Œåªæ˜¯æŠŠ q æŒ‡å‘ åœ°å€ A çš„è¿™ä¸ªæŒ‡é’ˆèµ‹å€¼ç»™äº† w ã€‚</p>\n<p>w å’Œ q éƒ½å¯ä»¥æ“ä½œè¿™ä¸ªåœ°å€çš„å†…å®¹ã€‚</p>\n<p>æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬ç”¨ q æ¥æ“ä½œè¿™ä¸ªåœ°å€å†…å®¹çš„æ—¶å€™ï¼Œåœ°å€å†…å®¹å°±å˜äº†ã€‚å½“ w å»å–å€¼çš„æ—¶å€™ï¼Œå†…å®¹å·²ç»å˜äº†ã€‚</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/%E6%B7%B1%E6%8B%B7%E8%B4%9D%E6%B5%85%E6%8B%B7%E8%B4%9D/20190428205243797.png\"  alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<p>w å’Œ q éƒ½å¯ä»¥æ“ä½œè¿™ä¸ªåœ°å€å†…å®¹ã€‚</p>\n<p>é‚£ä¹ˆå¼•ç”¨ç±»å‹æœ‰é‚£äº›å‘¢ï¼Ÿ</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/%E6%B7%B1%E6%8B%B7%E8%B4%9D%E6%B5%85%E6%8B%B7%E8%B4%9D/20190428205350562.png\"  alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<p>è¿™æ ·ç®€å•çš„å¼•ç”¨èµ‹å€¼ä¹Ÿå«åšæµ…æ‹·è´ã€‚</p>\n<p>å¯èƒ½ä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚:</p>\n<p>Aå’ŒBéƒ½æ˜¯æ•°ç»„ï¼›</p>\n<p>æˆ‘åªæ˜¯æ‡’å¾—ç»™Bèµ‹å€¼å’ŒAä¸€æ¨¡ä¸€æ ·çš„ï¼›</p>\n<p>æ‰€ä»¥æˆ‘ç›´æ¥B = Aï¼›</p>\n<p>æˆ‘åœ¨æ“ä½œå®ŒBä¹‹åæˆ‘åˆæƒ³å»å–å€¼Açš„å€¼çš„æ—¶å€™ï¼Œå‘ç°Aå·²ç»å˜äº†ã€‚</p>\n<p>åœ¨reactä¸­ä¹Ÿæœ‰å¯¹stateæµ…æ‹·è´åˆ¤æ–­çš„ï¼ˆPureComponentï¼‰</p>\n<ul>\n<li><p><strong>æ·±æ‹·è´</strong></p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/%E6%B7%B1%E6%8B%B7%E8%B4%9D%E6%B5%85%E6%8B%B7%E8%B4%9D/20190428205853748.png\"  alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n</li>\n</ul>\n<p>è¿™ä¸ªå°±å«åšæ·±æ‹·è´ã€‚</p>\n<p>å°†ä»–çš„å†…å®¹åˆ†è§£å‡ºæ¥è¿›è¡Œè§£æã€‚</p>\n<p>ä½†æ˜¯è¿™æ ·ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ã€‚</p>\n<p>éº»çƒ¦ï¼</p>\n<p>æ¯”å¦‚</p>\n<p>let A = [ {a: [1, 2]}, {b: [1, 2]} ]ã€‚</p>\n<p>è¿™ä¸ªæ—¶å€™è¦æ·±æ‹·è´ç»™Bçš„è¯ã€‚</p>\n<p>è¦ä¸€ç›´ç»“æ„åˆ°å¾ˆæ·±å¤„ã€‚</p>\n<p>æœ‰å‡ ä¸ªä¸ªåŠæ³•å¯ä»¥è§£å†³ã€‚</p>\n<p>1.å«åš<strong>åºåˆ—åŒ–</strong></p>\n<ul>\n<li><p>JSON.stringify()</p>\n</li>\n<li><p>JSON.parse()</p>\n<p>ä½†æ˜¯è¿™æ ·éå¸¸æµªè´¹èµ„æº</p>\n</li>\n</ul>\n<p>2.Object.assign()æ‹·è´</p>\n<ul>\n<li>å½“å¯¹è±¡ä¸­åªæœ‰ä¸€çº§å±æ€§ï¼Œæ²¡æœ‰äºŒçº§å±æ€§çš„æ—¶å€™ï¼Œæ­¤æ–¹æ³•ä¸ºæ·±æ‹·è´ï¼Œä½†æ˜¯å¯¹è±¡ä¸­æœ‰å¯¹è±¡çš„æ—¶å€™ï¼Œæ­¤æ–¹æ³•ï¼Œåœ¨äºŒçº§å±æ€§ä»¥åå°±æ˜¯æµ…æ‹·è´ã€‚</li>\n</ul>\n<p> 3.ä½¿ç”¨é€’å½’çš„æ–¹å¼å®ç°æ·±æ‹·è´</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> &#x2F;&#x2F;ä½¿ç”¨é€’å½’çš„æ–¹å¼å®ç°æ•°ç»„ã€å¯¹è±¡çš„æ·±æ‹·è´</span><br><span class=\"line\">function deepClone1(obj) &#123;</span><br><span class=\"line\">  &#x2F;&#x2F;åˆ¤æ–­æ‹·è´çš„è¦è¿›è¡Œæ·±æ‹·è´çš„æ˜¯æ•°ç»„è¿˜æ˜¯å¯¹è±¡ï¼Œæ˜¯æ•°ç»„çš„è¯è¿›è¡Œæ•°ç»„æ‹·è´ï¼Œå¯¹è±¡çš„è¯è¿›è¡Œå¯¹è±¡æ‹·è´</span><br><span class=\"line\">  var objClone &#x3D; Array.isArray(obj) ? [] : &#123;&#125;;</span><br><span class=\"line\">  &#x2F;&#x2F;è¿›è¡Œæ·±æ‹·è´çš„ä¸èƒ½ä¸ºç©ºï¼Œå¹¶ä¸”æ˜¯å¯¹è±¡æˆ–è€…æ˜¯</span><br><span class=\"line\">  if (obj &amp;&amp; typeof obj &#x3D;&#x3D;&#x3D; &quot;object&quot;) &#123;</span><br><span class=\"line\">    for (key in obj) &#123;</span><br><span class=\"line\">      if (obj.hasOwnProperty(key)) &#123;</span><br><span class=\"line\">        if (obj[key] &amp;&amp; typeof obj[key] &#x3D;&#x3D;&#x3D; &quot;object&quot;) &#123;</span><br><span class=\"line\">          objClone[key] &#x3D; deepClone1(obj[key]);</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">          objClone[key] &#x3D; obj[key];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  return objClone;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>5.lodashå‡½æ•°åº“å®ç°æ·±æ‹·è´</p>\n<p>lodashå¾ˆçƒ­é—¨çš„å‡½æ•°åº“ï¼Œæä¾›äº† lodash.cloneDeep()å®ç°æ·±æ‹·è´</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><p>è¿™ä¸ªé—®é¢˜è¯´ä¸¥é‡ä¹Ÿä¸ä¸¥é‡ï¼Œè¯´ä¸å°ä¹Ÿä¸å°ã€‚<br>å¦‚æœä½ ä¹Ÿåˆšåˆšå¥½ç¢°åˆ°äº†è¿™ä¸ªé—®é¢˜ã€‚å°±è·Ÿç€æˆ‘ä¸€èµ·äº†è§£ä¸€ä¸‹å§ï¼</p>\n<h2 id=\"åŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹\"><a href=\"#åŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹\" class=\"headerlink\" title=\"åŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹\"></a>åŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹</h2><ul>\n<li><strong>åŸºæœ¬ç±»å‹</strong></li>\n</ul>\n<p>åŸºæœ¬ç±»å‹ä¹Ÿç§°å€¼ç±»å‹ï¼Œæ•°å€¼ç±»å‹ã€‚<br>åŒ…æ‹¬äº†</p>\n<ol>\n<li>String<ol start=\"2\">\n<li>Number</li>\n<li>Boolean</li>\n<li>Null</li>\n<li>Undefined</li>\n<li>Symbolï¼ˆES6æ–°å¢ï¼Œè¡¨ç¤ºç‹¬ä¸€æ— äºŒçš„ä¸€ä¸ªå€¼ã€‚<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Symbol\" target=\"_blank\" rel=\"noopener\">MDN</a>ï¼‰</li>\n</ol>\n</li>\n</ol>\n<p><img src=\"/image/%E6%B7%B1%E6%8B%B7%E8%B4%9D%E6%B5%85%E6%8B%B7%E8%B4%9D/20190428204522836.png\" alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<p>åŸºæœ¬ç±»å‹çš„æ˜¯æ”¾åœ¨æ ˆåŒºçš„ï¼Œè®¿é—®çš„æ—¶å€™ä¹Ÿæ˜¯æŒ‰å€¼è®¿é—®ï¼Œå°±æ˜¯æ­£å¸¸çš„ç†è§£çš„èµ‹å€¼ã€‚</p>\n<ul>\n<li><strong>å¼•ç”¨ç±»å‹å’Œæµ…æ‹·è´</strong></li>\n</ul>\n<p>å¼•ç”¨ç±»å‹ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯å¼•ç”¨æ¥è®¿é—®çš„ã€‚</p>\n<p><img src=\"/image/%E6%B7%B1%E6%8B%B7%E8%B4%9D%E6%B5%85%E6%8B%B7%E8%B4%9D/20190428204904611.png\" alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ“ä½œçš„æ˜¯<strong>q</strong>ã€‚ä¸ºä»€ä¹ˆ<strong>w</strong>ä¹Ÿæ”¹å˜äº†å‘¢ï¼Ÿ</p>\n<p>å› ä¸º<strong>w</strong>ä¸æ˜¯çœŸçš„ç»™ä»–èµ‹å€¼äº†[1, 2]ã€‚</p>\n<p>è€Œæ˜¯èµ‹å€¼ç»™äº†<strong>q</strong>æ‰€æŒ‡å‘çš„åœ°å€çš„æŒ‡é’ˆã€‚</p>\n<p>æœ‰ç‚¹ç»•ï¼Œå…¶å®è¯´ç™½äº†å°±æ˜¯ q æ˜¯æŒ‡å‘åœ°å€ A çš„ã€‚</p>\n<p>w = q ï¼Œåªæ˜¯æŠŠ q æŒ‡å‘ åœ°å€ A çš„è¿™ä¸ªæŒ‡é’ˆèµ‹å€¼ç»™äº† w ã€‚</p>\n<p>w å’Œ q éƒ½å¯ä»¥æ“ä½œè¿™ä¸ªåœ°å€çš„å†…å®¹ã€‚</p>\n<p>æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬ç”¨ q æ¥æ“ä½œè¿™ä¸ªåœ°å€å†…å®¹çš„æ—¶å€™ï¼Œåœ°å€å†…å®¹å°±å˜äº†ã€‚å½“ w å»å–å€¼çš„æ—¶å€™ï¼Œå†…å®¹å·²ç»å˜äº†ã€‚</p>\n<p><img src=\"/image/%E6%B7%B1%E6%8B%B7%E8%B4%9D%E6%B5%85%E6%8B%B7%E8%B4%9D/20190428205243797.png\" alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<p>w å’Œ q éƒ½å¯ä»¥æ“ä½œè¿™ä¸ªåœ°å€å†…å®¹ã€‚</p>\n<p>é‚£ä¹ˆå¼•ç”¨ç±»å‹æœ‰é‚£äº›å‘¢ï¼Ÿ</p>\n<p><img src=\"/image/%E6%B7%B1%E6%8B%B7%E8%B4%9D%E6%B5%85%E6%8B%B7%E8%B4%9D/20190428205350562.png\" alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<p>è¿™æ ·ç®€å•çš„å¼•ç”¨èµ‹å€¼ä¹Ÿå«åšæµ…æ‹·è´ã€‚</p>\n<p>å¯èƒ½ä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚:</p>\n<p>Aå’ŒBéƒ½æ˜¯æ•°ç»„ï¼›</p>\n<p>æˆ‘åªæ˜¯æ‡’å¾—ç»™Bèµ‹å€¼å’ŒAä¸€æ¨¡ä¸€æ ·çš„ï¼›</p>\n<p>æ‰€ä»¥æˆ‘ç›´æ¥B = Aï¼›</p>\n<p>æˆ‘åœ¨æ“ä½œå®ŒBä¹‹åæˆ‘åˆæƒ³å»å–å€¼Açš„å€¼çš„æ—¶å€™ï¼Œå‘ç°Aå·²ç»å˜äº†ã€‚</p>\n<p>åœ¨reactä¸­ä¹Ÿæœ‰å¯¹stateæµ…æ‹·è´åˆ¤æ–­çš„ï¼ˆPureComponentï¼‰</p>\n<ul>\n<li><p><strong>æ·±æ‹·è´</strong></p>\n<p><img src=\"/image/%E6%B7%B1%E6%8B%B7%E8%B4%9D%E6%B5%85%E6%8B%B7%E8%B4%9D/20190428205853748.png\" alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n</li>\n</ul>\n<p>è¿™ä¸ªå°±å«åšæ·±æ‹·è´ã€‚</p>\n<p>å°†ä»–çš„å†…å®¹åˆ†è§£å‡ºæ¥è¿›è¡Œè§£æã€‚</p>\n<p>ä½†æ˜¯è¿™æ ·ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ã€‚</p>\n<p>éº»çƒ¦ï¼</p>\n<p>æ¯”å¦‚</p>\n<p>let A = [ {a: [1, 2]}, {b: [1, 2]} ]ã€‚</p>\n<p>è¿™ä¸ªæ—¶å€™è¦æ·±æ‹·è´ç»™Bçš„è¯ã€‚</p>\n<p>è¦ä¸€ç›´ç»“æ„åˆ°å¾ˆæ·±å¤„ã€‚</p>\n<p>æœ‰å‡ ä¸ªä¸ªåŠæ³•å¯ä»¥è§£å†³ã€‚</p>\n<p>1.å«åš<strong>åºåˆ—åŒ–</strong></p>\n<ul>\n<li><p>JSON.stringify()</p>\n</li>\n<li><p>JSON.parse()</p>\n<p>ä½†æ˜¯è¿™æ ·éå¸¸æµªè´¹èµ„æº</p>\n</li>\n</ul>\n<p>2.Object.assign()æ‹·è´</p>\n<ul>\n<li>å½“å¯¹è±¡ä¸­åªæœ‰ä¸€çº§å±æ€§ï¼Œæ²¡æœ‰äºŒçº§å±æ€§çš„æ—¶å€™ï¼Œæ­¤æ–¹æ³•ä¸ºæ·±æ‹·è´ï¼Œä½†æ˜¯å¯¹è±¡ä¸­æœ‰å¯¹è±¡çš„æ—¶å€™ï¼Œæ­¤æ–¹æ³•ï¼Œåœ¨äºŒçº§å±æ€§ä»¥åå°±æ˜¯æµ…æ‹·è´ã€‚</li>\n</ul>\n<p> 3.ä½¿ç”¨é€’å½’çš„æ–¹å¼å®ç°æ·±æ‹·è´</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> &#x2F;&#x2F;ä½¿ç”¨é€’å½’çš„æ–¹å¼å®ç°æ•°ç»„ã€å¯¹è±¡çš„æ·±æ‹·è´</span><br><span class=\"line\">function deepClone1(obj) &#123;</span><br><span class=\"line\">  &#x2F;&#x2F;åˆ¤æ–­æ‹·è´çš„è¦è¿›è¡Œæ·±æ‹·è´çš„æ˜¯æ•°ç»„è¿˜æ˜¯å¯¹è±¡ï¼Œæ˜¯æ•°ç»„çš„è¯è¿›è¡Œæ•°ç»„æ‹·è´ï¼Œå¯¹è±¡çš„è¯è¿›è¡Œå¯¹è±¡æ‹·è´</span><br><span class=\"line\">  var objClone &#x3D; Array.isArray(obj) ? [] : &#123;&#125;;</span><br><span class=\"line\">  &#x2F;&#x2F;è¿›è¡Œæ·±æ‹·è´çš„ä¸èƒ½ä¸ºç©ºï¼Œå¹¶ä¸”æ˜¯å¯¹è±¡æˆ–è€…æ˜¯</span><br><span class=\"line\">  if (obj &amp;&amp; typeof obj &#x3D;&#x3D;&#x3D; &quot;object&quot;) &#123;</span><br><span class=\"line\">    for (key in obj) &#123;</span><br><span class=\"line\">      if (obj.hasOwnProperty(key)) &#123;</span><br><span class=\"line\">        if (obj[key] &amp;&amp; typeof obj[key] &#x3D;&#x3D;&#x3D; &quot;object&quot;) &#123;</span><br><span class=\"line\">          objClone[key] &#x3D; deepClone1(obj[key]);</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">          objClone[key] &#x3D; obj[key];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  return objClone;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>5.lodashå‡½æ•°åº“å®ç°æ·±æ‹·è´</p>\n<p>lodashå¾ˆçƒ­é—¨çš„å‡½æ•°åº“ï¼Œæä¾›äº† lodash.cloneDeep()å®ç°æ·±æ‹·è´</p>\n"},{"title":"Webå‰ç«¯ å­¦ä¹ ç›®å½• å­¦ä¹ æ¡†æ¶ ç³»ç»Ÿæ€§çš„å­¦ä¹ Webå‰ç«¯","date":"2019-06-19T02:28:50.000Z","cover":"/image/cover/web.jpeg","_content":"\n## å‰è¨€\n\n\nè¿™ä¸ªæ˜¯ç›®å‰ä»ç½‘ä¸Šå·æ¥çš„ï¼Œè‡ªå·±å­¦ä¹ Webå‰ç«¯å¯èƒ½ä¼šç”¨å¾—åˆ°ï¼Œç‰¹æ­¤è®°å½•ä¸€ä¸‹\n\n\n> æ¯ä¸ª JavaScript å·¥ç¨‹å¸ˆéƒ½åº”æ‡‚çš„33ä¸ªæ¦‚å¿µ @leonardomso\n\nhttps://github.com/stephentian/33-js-concepts\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/Webå‰ç«¯å­¦ä¹ è·¯çº¿/20190328205449472.png)\n\n","source":"_posts/Webå‰ç«¯-å­¦ä¹ ç›®å½•-å­¦ä¹ æ¡†æ¶-ç³»ç»Ÿæ€§çš„å­¦ä¹ Webå‰ç«¯.md","raw":"---\ntitle: Webå‰ç«¯ å­¦ä¹ ç›®å½• å­¦ä¹ æ¡†æ¶ ç³»ç»Ÿæ€§çš„å­¦ä¹ Webå‰ç«¯\ndate: 2019-06-19 10:28:50\ntags: [ç³»ç»Ÿæ€§çš„å­¦ä¹ , å­¦ä¹ ç›®å½•, Webå‰ç«¯, å­¦ä¹ æ¡†æ¶]\ncategory: [Webå‰ç«¯]\ncover: /image/cover/web.jpeg\n---\n\n## å‰è¨€\n\n\nè¿™ä¸ªæ˜¯ç›®å‰ä»ç½‘ä¸Šå·æ¥çš„ï¼Œè‡ªå·±å­¦ä¹ Webå‰ç«¯å¯èƒ½ä¼šç”¨å¾—åˆ°ï¼Œç‰¹æ­¤è®°å½•ä¸€ä¸‹\n\n\n> æ¯ä¸ª JavaScript å·¥ç¨‹å¸ˆéƒ½åº”æ‡‚çš„33ä¸ªæ¦‚å¿µ @leonardomso\n\nhttps://github.com/stephentian/33-js-concepts\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/Webå‰ç«¯å­¦ä¹ è·¯çº¿/20190328205449472.png)\n\n","slug":"Webå‰ç«¯-å­¦ä¹ ç›®å½•-å­¦ä¹ æ¡†æ¶-ç³»ç»Ÿæ€§çš„å­¦ä¹ Webå‰ç«¯","published":1,"updated":"2021-06-24T14:00:06.848Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra7v000ilwrd3xfv52el","content":"<h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><p>è¿™ä¸ªæ˜¯ç›®å‰ä»ç½‘ä¸Šå·æ¥çš„ï¼Œè‡ªå·±å­¦ä¹ Webå‰ç«¯å¯èƒ½ä¼šç”¨å¾—åˆ°ï¼Œç‰¹æ­¤è®°å½•ä¸€ä¸‹</p>\n<blockquote>\n<p>æ¯ä¸ª JavaScript å·¥ç¨‹å¸ˆéƒ½åº”æ‡‚çš„33ä¸ªæ¦‚å¿µ @leonardomso</p>\n</blockquote>\n<p><a href=\"https://github.com/stephentian/33-js-concepts\" target=\"_blank\" rel=\"noopener\">https://github.com/stephentian/33-js-concepts</a></p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/Web%E5%89%8D%E7%AB%AF%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/20190328205449472.png\"  alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><p>è¿™ä¸ªæ˜¯ç›®å‰ä»ç½‘ä¸Šå·æ¥çš„ï¼Œè‡ªå·±å­¦ä¹ Webå‰ç«¯å¯èƒ½ä¼šç”¨å¾—åˆ°ï¼Œç‰¹æ­¤è®°å½•ä¸€ä¸‹</p>\n<blockquote>\n<p>æ¯ä¸ª JavaScript å·¥ç¨‹å¸ˆéƒ½åº”æ‡‚çš„33ä¸ªæ¦‚å¿µ @leonardomso</p>\n</blockquote>\n<p><a href=\"https://github.com/stephentian/33-js-concepts\" target=\"_blank\" rel=\"noopener\">https://github.com/stephentian/33-js-concepts</a></p>\n<p><img src=\"/image/Web%E5%89%8D%E7%AB%AF%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/20190328205449472.png\" alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n"},{"title":"Ant Design Form ç»„ä»¶æ€»ç»“ ç»“åˆModal è‡ªå®šä¹‰Modalçš„å®ç° ï¼ˆUpload Input Select DatePicker Cascaderï¼‰","date":"2019-06-19T02:24:07.000Z","cover":"/image/cover/ANTD.png","_content":"\n## èµ·æº\n\næœ€è¿‘åœ¨é¡¹ç›®ä¸­å‘ç°è¦å†™å¤šä¸ªå¼¹æ¡†ï¼ˆç”¨äºæŸ¥çœ‹ã€ç¼–è¾‘ã€æ–°å»ºXXä¿¡æ¯ï¼‰ï¼Œå¦‚ä¸‹å›¾ã€‚\n\n![æµ‹è¯•å›¾ç‰‡](/image/AntDesignFormæ€»ç»“/modal.png)\n\nåƒè¿™æ ·èŠ±é‡Œèƒ¡å“¨çš„å¼¹æ¡†åœ¨ä¸€ä¸ªå¤§å‹çš„ä¸­å°ç®¡ç†ç³»ç»Ÿä¸­ï¼Œå¯èƒ½è¦å†™ä¸Šå¥½å‡ éçš„Modal\nä½†æ˜¯å…¶å®ä»–ä»¬å¤§åŒå°å¼‚ã€‚\n\né¦–å…ˆï¼Œä»–ä»¬çš„titleæ˜¯å›ºå®šçš„ï¼ˆå¢ã€æ”¹ã€æŸ¥ï¼‰\n\nåº•ä¸‹çš„å†…å®¹ä¹Ÿæ˜¯å›ºå®šçš„ï¼Œæ— éå°±æ˜¯Upload Input Select DatePicker Cascader\n\nï¼ˆå†™ä¸äº†<>ã€‚å…¶å®åº”è¯¥æ˜¯ant design çš„ç»„ä»¶ï¼‰\n\n\n## æ”¹è¿›\n\næ‰€ä»¥æˆ‘æƒ³è‡ªå·±å†™ä¸€ä¸ªModalViewçš„ç»„ä»¶ã€‚åªéœ€è¦ä¼ å…¥è¿™ä¸Šé¢çš„æ•°æ®ç±»å‹ï¼Œtitleä¹‹ç±»çš„æ•°æ®å°±å¯ä»¥å®Œæˆæ¸²æŸ“ã€‚\n\nå¦‚ä¸‹ï¼Œè¿™ä¸ªæ˜¯æˆ‘é¡¹ç›®ä¸­çš„ä¸€ä¸ªä¾‹å­\n\n\n```\n<ModalView \n          onOk={this.edit}     // ç‚¹å‡»Modalç¡®å®šæ—¶çš„å›è°ƒ\n          onCancel={this.hideModal}   // ç‚¹å‡»Modalå–æ¶ˆï¼Œæˆ–è€…ç‚¹å‡»maskæ—¶çš„å›è°ƒ\n          show={visible}        // Modalçš„æ˜¾éš\n          category={category}      // Modalçš„titleï¼Œé€šè¿‡categoryæ¥åˆ¤æ–­ï¼ˆç›®å‰åªæœ‰æŸ¥çœ‹ã€ç¼–è¾‘ã€æ–°å¢ï¼‰\n          data={fStaffManage}     // è‡ªå®šä¹‰Modalçš„æ ¸å¿ƒï¼Œæ•´ä¸ªModalçš„æ¸²æŸ“\n          showData={showData}    // ç‚¹å‡»æŸ¥çœ‹å’Œç¼–è¾‘æ—¶çš„é»˜è®¤æ•°æ®\n/>\n```\n\n\næ¥ä¸‹æ¥æ˜¯fStaffManageçš„æ•°æ®ç»“æ„\n\n\n```\nexport const fStaffManage = [\n  {\n    label: 'å‘˜å·¥ç¼–å·ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰',\n    key: 'id',\n    type: 'input',\n    Message: 'è¯·è¾“å…¥å‘˜å·¥ç¼–å·',\n    disabled: true,\n  },\n  {\n    label: 'é—¨åº—',\n    key: 'storeNo',\n    type: 'select',\n    Message: 'è¯·é€‰æ‹©é—¨åº—',\n    option: [],\n  },\n  {\n    label: 'å‘˜å·¥å§“å',\n    key: 'userName',\n    type: 'input',\n    Message: 'è¯·è¾“å…¥å‘˜å·¥å§“å',\n  },\n  {\n    label: 'è§’è‰²ç±»å‹',\n    key: 'roleCodes',\n    type: 'select',\n    Message: 'è¯·é€‰æ‹©è§’è‰²ç±»å‹',\n    option: [{ severKey: 'åº—å‘˜', showValue: 'åº—å‘˜' }, { severKey: 'åº—é•¿', showValue: 'åº—é•¿' }],\n  },\n  {\n    label: 'è”ç³»ç”µè¯',\n    key: 'mobile',\n    type: 'input',\n    Message: 'è¯·è¾“å…¥è”ç³»ç”µè¯',\n    pattern: '^1[34578]\\\\d{9}$',\n  },\n  {\n    label: 'æµ‹è¯•ä¸Šä¼ å›¾ç‰‡',\n    key: 'testImgUpload',\n    type: 'imageUpload',\n    Message: 'è¯·ä¸Šä¼ å›¾ç‰‡',\n  },\n];\n```\n**Message**  æ˜¯ç”¨äºFormè¡¨å•çš„æç¤ºç”¨äºä»¥åŠplaceholder\n\n**label**   æ˜¯ç”¨äºFormçš„label\n\n**key**   æ˜¯ç”¨äºmapå¾ªç¯æ—¶çš„keyï¼ˆé˜²æ­¢warningå’Œæå‡æ•ˆç‡ï¼‰\n\n**type**   æ˜¯ç”¨äºæ˜¾ç¤ºé‚£ç§ç±»å‹çš„ç»„ä»¶\n\n**pattern**   æ˜¯ç”¨äºFormè¡¨å•æ£€æµ‹çš„æ­£åˆ™è¡¨è¾¾å¼\n\n\n```\n/*\n * @Author: Derrick\n * @Date: 2019-04-04 16:53:05\n * @Last Modified by: Derrick\n * @Last Modified time: 2019-04-28 15:48:04\n */\nimport React, { PureComponent } from 'react';\nimport { Modal, Form, Button, Table, Upload, message, Row, Select } from 'antd';\nimport { connect } from 'dva';\nimport PropTypes from 'prop-types';\nimport componentAuth from '@/common/ComponentAuth';\nimport FormSelect from '@/common/FormItems/FormSelect';\nimport FormInput from '@/common/FormItems/FormInput';\nimport FormDataPicker from '@/common/FormItems/FormDataPicker';\nimport FormCascader from '@/common/FormItems/FormCascader';\nimport FormTextArea from '@/common/FormItems/FormTextArea';\nimport FormImageUpload from '@/common/FormItems/FormImageUpload';\nimport { HEADER_BASE, SEVER_URL_BASE } from '@/utils/constant';\nimport Col from 'antd/es/col';\n\nconst formItemLayout = {\n  labelCol: {\n    xs: { span: 24 },\n    sm: { span: 5 },\n  },\n  wrapperCol: {\n    xs: { span: 24 },\n    sm: { span: 16 },\n  },\n};\nconst { Item } = Form;\nconst { Option } = Select;\n\n@connect(({ mIdentifyCenter }) => ({\n  mIdentifyCenter\n}))\nclass ModalView extends PureComponent {\n  state = {\n    data: [],\n    storeId: '',\n  };\n\n  // è¿”å›title\n  caseCategory = category => {\n    switch (category) {\n      case 'check':\n        return { title: 'æŸ¥çœ‹' };\n      case 'import':\n        return { title: 'å¯¼å…¥', import: true };\n      case 'create':\n        return { title: 'æ–°å¢' };\n      case 'edit':\n        return { title: 'ç¼–è¾‘' };\n      default:\n        return { title: 'æŸ¥çœ‹' };\n    }\n  };\n\n  showLabel = (type, label) => {\n    const { category } = this.props;\n\n    if (category === 'search') {\n      if (type !== 'datePicker') {\n        return undefined;\n      }\n      return label;\n    }\n    return label;\n  };\n\n  showRequire = disabled => {\n    const { category } = this.props;\n    if (category === 'search') {\n      return false;\n    }\n    if (disabled) {\n      return false;\n    }\n    return true;\n  };\n\n  form = () => {\n    const {\n      form: { getFieldDecorator },\n      data,\n      showData,\n      category,\n    } = this.props;\n\n    let ShowType;\n\n    return data.map(value => {\n      const { label, key, type, Message, option, disabled, pattern } = value;\n      if (!value) {\n        return null;\n      }\n      switch (type) {\n        case 'input':\n          ShowType = FormInput;\n          break;\n        case 'select':\n          ShowType = FormSelect;\n          break;\n        case 'datePicker':\n          ShowType = FormDataPicker;\n          break;\n        case 'cascader':\n          ShowType = FormCascader;\n          showData.region = [showData.provinceId, showData.cityId, showData.countyId];\n          break;\n        case 'textArea':\n          ShowType = FormTextArea;\n          break;\n        case 'imageUpload':\n          ShowType = FormImageUpload;\n          break;\n        default:\n          ShowType = null;\n      }\n      return (\n        <Item label={this.showLabel(type, label)} key={key}>\n          {getFieldDecorator(key, {\n            rules: [\n              {\n                required: this.showRequire(disabled),\n                message: Message,\n                pattern: pattern || undefined,\n                type: type === 'cascader' ? 'array' : 'string',\n              },\n            ],\n            initialValue: showData[key] ? showData[key] : undefined,\n          })(\n            <ShowType\n              option={option}\n              message={Message}\n              disabled={!!(disabled || category === 'check')}\n            />\n          )}\n        </Item>\n      );\n    });\n  };\n\n  checkOk = () => {\n    const { onOk, form } = this.props;\n    form.validateFields((err, fieldsValue) => {\n      if (!err) {\n        onOk(fieldsValue);\n      }\n    });\n  };\n  \n  closeModal = () => {\n    const { onCancel, form: { resetFields } } = this.props;\n    resetFields();\n    onCancel();\n  }\n\n  render() {\n    const { data } = this.state;\n    const { show, category = '', importColums, downloadUrl } = this.props;\n    const modalData = this.caseCategory(category);\n    return (\n      <Modal\n        visible={show}\n        onCancel={this.closeModal}\n        onOk={category === 'import' ? this.importOk : this.checkOk}\n        title={modalData.title}\n        width=\"70%\"\n        footer={modalData.title === 'æŸ¥çœ‹' ? null : undefined}\n      >\n          <Form style={{ paddingTop: '20px' }} {...formItemLayout}>\n            {this.form()}\n          </Form>\n      </Modal>\n    );\n  }\n}\n\nModalView.propTypes = {\n  onOk: PropTypes.func.isRequired, // å¼¹æ¡†ç‚¹å‡»ç¡®å®š\n  onCancel: PropTypes.func.isRequired, // éšè—å¼¹æ¡†\n  show: PropTypes.bool, // æ˜¯å¦æ˜¾ç¤ºå¼¹çª—\n  category: PropTypes.string, // å¼¹æ¡†çš„ç±»å‹ï¼ˆtitleæ˜¾ç¤º\n  data: PropTypes.arrayOf(PropTypes.object).isRequired, // æ•°æ®ç±»å‹; ä½ç½®:'@/common/constant/sormView.js' è®°å¾—å†™æ³¨é‡Š; æ ¼å¼: `s${æ–‡ä»¶å}`\n  showData: PropTypes.object, // æŸ¥çœ‹æˆ–è€…ç¼–è¾‘æ—¶çš„é»˜è®¤æ•°æ®\n  importCallBack: PropTypes.func, // å¯¼å…¥ä¹‹åï¼Œç‚¹å‡»ç¡®å®šçš„å›è°ƒå‡½æ•°\n  importColums: PropTypes.array, // å¯¼å…¥æ—¶å€™æ˜¾ç¤ºè¡¨æ ¼çš„è¡¨å¤´\n  downloadUrl: PropTypes.string, // ä¸‹è½½çš„æ¨¡æ¿çš„æ–‡ä»¶å\n};\n\nModalView.defaultProps = {\n  show: false,\n  category: 'check',\n  showData: {},\n  importCallBack: () => {},\n  importColums: [],\n  downloadUrl: '',\n};\n\nexport default Form.create()(ModalView);\n```\n\n - **FormCascader**\n\n```\n/*\n * @Author: Derrick \n * @Date: 2019-04-11 09:57:54 \n * @Last Modified by: Derrick\n * @Last Modified time: 2019-04-28 16:52:57\n */\nimport React, { Component } from 'react';\nimport { Cascader } from 'antd';\nimport PropTypes from 'prop-types';\nimport regionData from '@/constant/regionData'\n\nclass FormCascader extends Component {\n\n  change = (e) => {\n    const {onChange} = this.props;\n    onChange(e)\n  }\n\n  render() {\n    const {value, disabled, message} = this.props;\n    return (\n      <Cascader placeholder={message} options={regionData} disabled={disabled} value={value} onChange={this.change} />\n    );\n  }\n}\n\nFormCascader.propsType = {\n  disabled: PropTypes.bool, // æ˜¯å¦ä¸å¯é€‰\n  message: PropTypes.string, // é»˜è®¤æ–‡å­—ï¼ˆplaceholder\n}\n\nFormCascader.defalutProps = {\n  disabled: false,\n  message: '',\n}\n\nexport default FormCascader;\n```\n\n - **FormDataPicker**\n\n```\n/*\n * @Author: Derrick \n * @Date: 2019-04-10 10:57:08 \n * @Last Modified by: Derrick\n * @Last Modified time: 2019-04-15 14:28:40\n */\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { DatePicker } from 'antd';\n\nclass FormDataPicker extends Component {\n\n  change = (e) => {\n    const {onChange} = this.props\n    onChange(e)\n  }\n\n  render() {\n    const {value, disabled} = this.props;\n    return (\n      <DatePicker disabled={disabled} value={value} onChange={this.change} />\n      );\n  }\n}\n\nFormDataPicker.propsType = {\n  disabled: PropTypes.bool, // æ˜¯å¦ä¸å¯é€‰\n}\n\nFormDataPicker.defalutProps = {\n  disabled: false,\n}\n\nexport default FormDataPicker;\n```\n\n - **FormImageUpload**\n\n```\n/*\n * @Author: Derrick \n * @Date: 2019-04-26 14:20:20 \n * @Last Modified by: Derrick\n * @Last Modified time: 2019-04-28 18:11:44\n */\nimport React, { PureComponent } from 'react';\nimport { Upload, Icon, message } from 'antd';\nimport { PICTURE_UPLOAD, HEADER_BASE } from '@/utils/constant';\n\nclass FormImageUpload extends PureComponent {\n\n  state = {\n    loading: false,\n  };\n\n  uploadButton = () => {\n    const { loading } = this.state;\n    return (\n      <div>\n        <Icon type={loading ? 'loading' : 'plus'} />\n        <div className=\"ant-upload-text\">Upload</div>\n      </div>\n    )\n  }\n\n  handleChange = (info) => {\n    if (info.file.status === 'uploading') {\n      this.setState({ loading: true });\n      return;\n    }\n    if (info.file.status === 'done') {\n      const {onChange} = this.props\n      this.setState({imageUrl: info.file.response.data[0], loading: false,})\n      onChange(info.file.response.data[0])\n    }\n  }\n\n  beforeUpload = (file) => {\n    const isJPG = file.type === 'image/jpeg';\n    if (!isJPG) {\n      message.error('åªèƒ½ä¸Šä¼ JPGçš„å›¾ç‰‡!');\n    }\n    const isLt2M = file.size / 1024 / 1024 < 2;\n    if (!isLt2M) {\n      message.error('å›¾ç‰‡å¤§å°ä¸èƒ½å¤§äº2MB!');\n    }\n    return isJPG && isLt2M;\n  }\n\n  upLoadProps = () => {\n    HEADER_BASE.user_id = window.sessionStorage.getItem('userId');\n    HEADER_BASE.token_id = window.sessionStorage.getItem('tokenId');\n    const props = {\n      name: 'file',\n      action: PICTURE_UPLOAD,\n      headers: HEADER_BASE,\n      onChange: this.handleChange,\n      showUploadList: false,\n      beforeUpload: this.beforeUpload,\n    };\n    return props;\n  };\n\n  render() {\n    \n    const { imageUrl } = this.state;\n\n    return (\n      <Upload\n        listType=\"picture-card\"\n        {...this.upLoadProps()}\n\n      >\n        {imageUrl ? <img src={imageUrl} alt=\"avatar\" /> : this.uploadButton()}\n      </Upload>\n    )\n  }\n}\n\nexport default FormImageUpload;\n```\n\n - **FormInput**\n\n```\n/*\n * @Author: Derrick \n * @Date: 2019-04-10 10:57:08 \n * @Last Modified by: Derrick\n * @Last Modified time: 2019-04-15 14:46:23\n */\nimport React, { Component } from 'react';\nimport { Input } from 'antd';\nimport PropTypes from 'prop-types';\n\nclass FormInput extends Component {\n\n  change = (e) => {\n    const {onChange} = this.props;\n    onChange(e)\n  }\n\n  render() {\n    const {message, value, disabled} = this.props;\n    return (\n      <Input disabled={disabled} placeholder={message} value={value} onChange={this.change} />\n      );\n  }\n}\n\nFormInput.propsType = {\n  disabled: PropTypes.bool, // æ˜¯å¦ä¸å¯é€‰\n  message: PropTypes.string, // é»˜è®¤æ–‡å­—ï¼ˆplaceholder\n}\n\nFormInput.defalutProps = {\n  disabled: false,\n  message: '',\n}\n\nexport default FormInput;\n```\n\n\n - **FormSelect**\n\n\n```\n/*\n * @Author: Derrick \n * @Date: 2019-04-10 10:13:58 \n * @Last Modified by: Derrick\n * @Last Modified time: 2019-04-28 15:59:22\n */\nimport React, { Component } from 'react';\nimport { Select } from 'antd';\nimport PropTypes, { object } from 'prop-types';\n\nconst { Option } = Select;\nclass FormSelect extends Component {\n\n  option = () => {\n    const {option = []} = this.props;\n    return option.map((v) => {\n      const {showValue, severKey} = v;\n      return <Option value={severKey} key={severKey}>{showValue}</Option>\n    })\n  }\n\n  selectCurrency = (e) => {\n    const {onChange} = this.props\n    onChange(e)\n  }\n\n  render() {\n    const {message, value, disabled} = this.props;\n    return (\n      <Select disabled={disabled} value={value} placeholder={message} style={{width: '170px'}} onSelect={this.selectCurrency}>\n        {this.option()}\n      </Select>    \n      );\n  }\n}\n\nFormSelect.propsType = {\n  disabled: PropTypes.bool, // æ˜¯å¦ä¸å¯é€‰\n  message: PropTypes.string, // é»˜è®¤æ–‡å­—ï¼ˆplaceholder\n  option: PropTypes.arrayOf(object), // é€‰æ‹©æ¡†çš„é€‰é¡¹\n}\n\nFormSelect.defalutProps = {\n  disabled: false,\n  message: '',\n  option: [],\n}\n\nexport default FormSelect;\n```\n\n - **FormTextArea**\n\n```\n/*\n * @Author: Derrick \n * @Date: 2019-04-23 10:20:36 \n * @Last Modified by: Derrick\n * @Last Modified time: 2019-04-23 10:21:33\n */\nimport React, { Component } from 'react';\nimport { Input } from 'antd';\nimport PropTypes from 'prop-types';\n\nconst { TextArea } = Input;\nclass FormTextArea extends Component {\n\n  change = (e) => {\n    const {onChange} = this.props;\n    onChange(e)\n  }\n\n  render() {\n    const {message, value, disabled} = this.props;\n    return (\n      <TextArea rows={4} disabled={disabled} placeholder={message} value={value} onChange={this.change} />\n      );\n  }\n}\n\nFormTextArea.propsType = {\n  disabled: PropTypes.bool, // æ˜¯å¦ä¸å¯é€‰\n  message: PropTypes.string, // é»˜è®¤æ–‡å­—ï¼ˆplaceholder\n}\n\nFormTextArea.defalutProps = {\n  disabled: false,\n  message: '',\n}\n\nexport default FormTextArea;\n```\n\n\n## æ ¸å¿ƒ\n\n\n```\nconst {onChange} = this.props;\nonChange(XX)\n```\n\n\nè¿™ä¸ªonChangeæ˜¯å¯ä»¥ç›´æ¥æ”¹å˜FormItemçš„å€¼ã€‚\n\næ¥ä¸‹æ¥å¯ä»¥åŠ å…¥æ‚¨è‡ªå·±å–œæ¬¢çš„ç»„ä»¶ï¼Œéƒ½æ˜¯å¤§åŒå°å¼‚ï¼ŒåŸºæœ¬ä¸Šéƒ½ç¦»ä¸å¼€è¿™ä¸ªonChangeã€‚\n\n\nä»¥ä¸Šå°±æ˜¯æœ¬äººæœ€è¿‘å°è£…çš„ä¸€ä¸ªç»„ä»¶ï¼Œæˆ‘æ„Ÿè§‰å¾ˆå¥½ç”¨æ‰€ä»¥æƒ³åˆ†äº«å‡ºæ¥ã€‚\n","source":"_posts/ant-design-Form-ç»„ä»¶æ€»ç»“-ç»“åˆModal-è‡ªå®šä¹‰Modalçš„å®ç°-ï¼ˆUpload-Input-Select-DatePicker-Cascaderï¼‰.md","raw":"---\ntitle: >-\n  Ant Design Form ç»„ä»¶æ€»ç»“ ç»“åˆModal è‡ªå®šä¹‰Modalçš„å®ç° ï¼ˆUpload Input Select DatePicker\n  Cascaderï¼‰\ndate: 2019-06-19 10:24:07\ntags: [Ant-Design-Form, Ant-Designç»„ä»¶åˆé›†]\ncategory: [Ant-Design, JavaScript]\ncover: /image/cover/ANTD.png\n---\n\n## èµ·æº\n\næœ€è¿‘åœ¨é¡¹ç›®ä¸­å‘ç°è¦å†™å¤šä¸ªå¼¹æ¡†ï¼ˆç”¨äºæŸ¥çœ‹ã€ç¼–è¾‘ã€æ–°å»ºXXä¿¡æ¯ï¼‰ï¼Œå¦‚ä¸‹å›¾ã€‚\n\n![æµ‹è¯•å›¾ç‰‡](/image/AntDesignFormæ€»ç»“/modal.png)\n\nåƒè¿™æ ·èŠ±é‡Œèƒ¡å“¨çš„å¼¹æ¡†åœ¨ä¸€ä¸ªå¤§å‹çš„ä¸­å°ç®¡ç†ç³»ç»Ÿä¸­ï¼Œå¯èƒ½è¦å†™ä¸Šå¥½å‡ éçš„Modal\nä½†æ˜¯å…¶å®ä»–ä»¬å¤§åŒå°å¼‚ã€‚\n\né¦–å…ˆï¼Œä»–ä»¬çš„titleæ˜¯å›ºå®šçš„ï¼ˆå¢ã€æ”¹ã€æŸ¥ï¼‰\n\nåº•ä¸‹çš„å†…å®¹ä¹Ÿæ˜¯å›ºå®šçš„ï¼Œæ— éå°±æ˜¯Upload Input Select DatePicker Cascader\n\nï¼ˆå†™ä¸äº†<>ã€‚å…¶å®åº”è¯¥æ˜¯ant design çš„ç»„ä»¶ï¼‰\n\n\n## æ”¹è¿›\n\næ‰€ä»¥æˆ‘æƒ³è‡ªå·±å†™ä¸€ä¸ªModalViewçš„ç»„ä»¶ã€‚åªéœ€è¦ä¼ å…¥è¿™ä¸Šé¢çš„æ•°æ®ç±»å‹ï¼Œtitleä¹‹ç±»çš„æ•°æ®å°±å¯ä»¥å®Œæˆæ¸²æŸ“ã€‚\n\nå¦‚ä¸‹ï¼Œè¿™ä¸ªæ˜¯æˆ‘é¡¹ç›®ä¸­çš„ä¸€ä¸ªä¾‹å­\n\n\n```\n<ModalView \n          onOk={this.edit}     // ç‚¹å‡»Modalç¡®å®šæ—¶çš„å›è°ƒ\n          onCancel={this.hideModal}   // ç‚¹å‡»Modalå–æ¶ˆï¼Œæˆ–è€…ç‚¹å‡»maskæ—¶çš„å›è°ƒ\n          show={visible}        // Modalçš„æ˜¾éš\n          category={category}      // Modalçš„titleï¼Œé€šè¿‡categoryæ¥åˆ¤æ–­ï¼ˆç›®å‰åªæœ‰æŸ¥çœ‹ã€ç¼–è¾‘ã€æ–°å¢ï¼‰\n          data={fStaffManage}     // è‡ªå®šä¹‰Modalçš„æ ¸å¿ƒï¼Œæ•´ä¸ªModalçš„æ¸²æŸ“\n          showData={showData}    // ç‚¹å‡»æŸ¥çœ‹å’Œç¼–è¾‘æ—¶çš„é»˜è®¤æ•°æ®\n/>\n```\n\n\næ¥ä¸‹æ¥æ˜¯fStaffManageçš„æ•°æ®ç»“æ„\n\n\n```\nexport const fStaffManage = [\n  {\n    label: 'å‘˜å·¥ç¼–å·ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰',\n    key: 'id',\n    type: 'input',\n    Message: 'è¯·è¾“å…¥å‘˜å·¥ç¼–å·',\n    disabled: true,\n  },\n  {\n    label: 'é—¨åº—',\n    key: 'storeNo',\n    type: 'select',\n    Message: 'è¯·é€‰æ‹©é—¨åº—',\n    option: [],\n  },\n  {\n    label: 'å‘˜å·¥å§“å',\n    key: 'userName',\n    type: 'input',\n    Message: 'è¯·è¾“å…¥å‘˜å·¥å§“å',\n  },\n  {\n    label: 'è§’è‰²ç±»å‹',\n    key: 'roleCodes',\n    type: 'select',\n    Message: 'è¯·é€‰æ‹©è§’è‰²ç±»å‹',\n    option: [{ severKey: 'åº—å‘˜', showValue: 'åº—å‘˜' }, { severKey: 'åº—é•¿', showValue: 'åº—é•¿' }],\n  },\n  {\n    label: 'è”ç³»ç”µè¯',\n    key: 'mobile',\n    type: 'input',\n    Message: 'è¯·è¾“å…¥è”ç³»ç”µè¯',\n    pattern: '^1[34578]\\\\d{9}$',\n  },\n  {\n    label: 'æµ‹è¯•ä¸Šä¼ å›¾ç‰‡',\n    key: 'testImgUpload',\n    type: 'imageUpload',\n    Message: 'è¯·ä¸Šä¼ å›¾ç‰‡',\n  },\n];\n```\n**Message**  æ˜¯ç”¨äºFormè¡¨å•çš„æç¤ºç”¨äºä»¥åŠplaceholder\n\n**label**   æ˜¯ç”¨äºFormçš„label\n\n**key**   æ˜¯ç”¨äºmapå¾ªç¯æ—¶çš„keyï¼ˆé˜²æ­¢warningå’Œæå‡æ•ˆç‡ï¼‰\n\n**type**   æ˜¯ç”¨äºæ˜¾ç¤ºé‚£ç§ç±»å‹çš„ç»„ä»¶\n\n**pattern**   æ˜¯ç”¨äºFormè¡¨å•æ£€æµ‹çš„æ­£åˆ™è¡¨è¾¾å¼\n\n\n```\n/*\n * @Author: Derrick\n * @Date: 2019-04-04 16:53:05\n * @Last Modified by: Derrick\n * @Last Modified time: 2019-04-28 15:48:04\n */\nimport React, { PureComponent } from 'react';\nimport { Modal, Form, Button, Table, Upload, message, Row, Select } from 'antd';\nimport { connect } from 'dva';\nimport PropTypes from 'prop-types';\nimport componentAuth from '@/common/ComponentAuth';\nimport FormSelect from '@/common/FormItems/FormSelect';\nimport FormInput from '@/common/FormItems/FormInput';\nimport FormDataPicker from '@/common/FormItems/FormDataPicker';\nimport FormCascader from '@/common/FormItems/FormCascader';\nimport FormTextArea from '@/common/FormItems/FormTextArea';\nimport FormImageUpload from '@/common/FormItems/FormImageUpload';\nimport { HEADER_BASE, SEVER_URL_BASE } from '@/utils/constant';\nimport Col from 'antd/es/col';\n\nconst formItemLayout = {\n  labelCol: {\n    xs: { span: 24 },\n    sm: { span: 5 },\n  },\n  wrapperCol: {\n    xs: { span: 24 },\n    sm: { span: 16 },\n  },\n};\nconst { Item } = Form;\nconst { Option } = Select;\n\n@connect(({ mIdentifyCenter }) => ({\n  mIdentifyCenter\n}))\nclass ModalView extends PureComponent {\n  state = {\n    data: [],\n    storeId: '',\n  };\n\n  // è¿”å›title\n  caseCategory = category => {\n    switch (category) {\n      case 'check':\n        return { title: 'æŸ¥çœ‹' };\n      case 'import':\n        return { title: 'å¯¼å…¥', import: true };\n      case 'create':\n        return { title: 'æ–°å¢' };\n      case 'edit':\n        return { title: 'ç¼–è¾‘' };\n      default:\n        return { title: 'æŸ¥çœ‹' };\n    }\n  };\n\n  showLabel = (type, label) => {\n    const { category } = this.props;\n\n    if (category === 'search') {\n      if (type !== 'datePicker') {\n        return undefined;\n      }\n      return label;\n    }\n    return label;\n  };\n\n  showRequire = disabled => {\n    const { category } = this.props;\n    if (category === 'search') {\n      return false;\n    }\n    if (disabled) {\n      return false;\n    }\n    return true;\n  };\n\n  form = () => {\n    const {\n      form: { getFieldDecorator },\n      data,\n      showData,\n      category,\n    } = this.props;\n\n    let ShowType;\n\n    return data.map(value => {\n      const { label, key, type, Message, option, disabled, pattern } = value;\n      if (!value) {\n        return null;\n      }\n      switch (type) {\n        case 'input':\n          ShowType = FormInput;\n          break;\n        case 'select':\n          ShowType = FormSelect;\n          break;\n        case 'datePicker':\n          ShowType = FormDataPicker;\n          break;\n        case 'cascader':\n          ShowType = FormCascader;\n          showData.region = [showData.provinceId, showData.cityId, showData.countyId];\n          break;\n        case 'textArea':\n          ShowType = FormTextArea;\n          break;\n        case 'imageUpload':\n          ShowType = FormImageUpload;\n          break;\n        default:\n          ShowType = null;\n      }\n      return (\n        <Item label={this.showLabel(type, label)} key={key}>\n          {getFieldDecorator(key, {\n            rules: [\n              {\n                required: this.showRequire(disabled),\n                message: Message,\n                pattern: pattern || undefined,\n                type: type === 'cascader' ? 'array' : 'string',\n              },\n            ],\n            initialValue: showData[key] ? showData[key] : undefined,\n          })(\n            <ShowType\n              option={option}\n              message={Message}\n              disabled={!!(disabled || category === 'check')}\n            />\n          )}\n        </Item>\n      );\n    });\n  };\n\n  checkOk = () => {\n    const { onOk, form } = this.props;\n    form.validateFields((err, fieldsValue) => {\n      if (!err) {\n        onOk(fieldsValue);\n      }\n    });\n  };\n  \n  closeModal = () => {\n    const { onCancel, form: { resetFields } } = this.props;\n    resetFields();\n    onCancel();\n  }\n\n  render() {\n    const { data } = this.state;\n    const { show, category = '', importColums, downloadUrl } = this.props;\n    const modalData = this.caseCategory(category);\n    return (\n      <Modal\n        visible={show}\n        onCancel={this.closeModal}\n        onOk={category === 'import' ? this.importOk : this.checkOk}\n        title={modalData.title}\n        width=\"70%\"\n        footer={modalData.title === 'æŸ¥çœ‹' ? null : undefined}\n      >\n          <Form style={{ paddingTop: '20px' }} {...formItemLayout}>\n            {this.form()}\n          </Form>\n      </Modal>\n    );\n  }\n}\n\nModalView.propTypes = {\n  onOk: PropTypes.func.isRequired, // å¼¹æ¡†ç‚¹å‡»ç¡®å®š\n  onCancel: PropTypes.func.isRequired, // éšè—å¼¹æ¡†\n  show: PropTypes.bool, // æ˜¯å¦æ˜¾ç¤ºå¼¹çª—\n  category: PropTypes.string, // å¼¹æ¡†çš„ç±»å‹ï¼ˆtitleæ˜¾ç¤º\n  data: PropTypes.arrayOf(PropTypes.object).isRequired, // æ•°æ®ç±»å‹; ä½ç½®:'@/common/constant/sormView.js' è®°å¾—å†™æ³¨é‡Š; æ ¼å¼: `s${æ–‡ä»¶å}`\n  showData: PropTypes.object, // æŸ¥çœ‹æˆ–è€…ç¼–è¾‘æ—¶çš„é»˜è®¤æ•°æ®\n  importCallBack: PropTypes.func, // å¯¼å…¥ä¹‹åï¼Œç‚¹å‡»ç¡®å®šçš„å›è°ƒå‡½æ•°\n  importColums: PropTypes.array, // å¯¼å…¥æ—¶å€™æ˜¾ç¤ºè¡¨æ ¼çš„è¡¨å¤´\n  downloadUrl: PropTypes.string, // ä¸‹è½½çš„æ¨¡æ¿çš„æ–‡ä»¶å\n};\n\nModalView.defaultProps = {\n  show: false,\n  category: 'check',\n  showData: {},\n  importCallBack: () => {},\n  importColums: [],\n  downloadUrl: '',\n};\n\nexport default Form.create()(ModalView);\n```\n\n - **FormCascader**\n\n```\n/*\n * @Author: Derrick \n * @Date: 2019-04-11 09:57:54 \n * @Last Modified by: Derrick\n * @Last Modified time: 2019-04-28 16:52:57\n */\nimport React, { Component } from 'react';\nimport { Cascader } from 'antd';\nimport PropTypes from 'prop-types';\nimport regionData from '@/constant/regionData'\n\nclass FormCascader extends Component {\n\n  change = (e) => {\n    const {onChange} = this.props;\n    onChange(e)\n  }\n\n  render() {\n    const {value, disabled, message} = this.props;\n    return (\n      <Cascader placeholder={message} options={regionData} disabled={disabled} value={value} onChange={this.change} />\n    );\n  }\n}\n\nFormCascader.propsType = {\n  disabled: PropTypes.bool, // æ˜¯å¦ä¸å¯é€‰\n  message: PropTypes.string, // é»˜è®¤æ–‡å­—ï¼ˆplaceholder\n}\n\nFormCascader.defalutProps = {\n  disabled: false,\n  message: '',\n}\n\nexport default FormCascader;\n```\n\n - **FormDataPicker**\n\n```\n/*\n * @Author: Derrick \n * @Date: 2019-04-10 10:57:08 \n * @Last Modified by: Derrick\n * @Last Modified time: 2019-04-15 14:28:40\n */\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { DatePicker } from 'antd';\n\nclass FormDataPicker extends Component {\n\n  change = (e) => {\n    const {onChange} = this.props\n    onChange(e)\n  }\n\n  render() {\n    const {value, disabled} = this.props;\n    return (\n      <DatePicker disabled={disabled} value={value} onChange={this.change} />\n      );\n  }\n}\n\nFormDataPicker.propsType = {\n  disabled: PropTypes.bool, // æ˜¯å¦ä¸å¯é€‰\n}\n\nFormDataPicker.defalutProps = {\n  disabled: false,\n}\n\nexport default FormDataPicker;\n```\n\n - **FormImageUpload**\n\n```\n/*\n * @Author: Derrick \n * @Date: 2019-04-26 14:20:20 \n * @Last Modified by: Derrick\n * @Last Modified time: 2019-04-28 18:11:44\n */\nimport React, { PureComponent } from 'react';\nimport { Upload, Icon, message } from 'antd';\nimport { PICTURE_UPLOAD, HEADER_BASE } from '@/utils/constant';\n\nclass FormImageUpload extends PureComponent {\n\n  state = {\n    loading: false,\n  };\n\n  uploadButton = () => {\n    const { loading } = this.state;\n    return (\n      <div>\n        <Icon type={loading ? 'loading' : 'plus'} />\n        <div className=\"ant-upload-text\">Upload</div>\n      </div>\n    )\n  }\n\n  handleChange = (info) => {\n    if (info.file.status === 'uploading') {\n      this.setState({ loading: true });\n      return;\n    }\n    if (info.file.status === 'done') {\n      const {onChange} = this.props\n      this.setState({imageUrl: info.file.response.data[0], loading: false,})\n      onChange(info.file.response.data[0])\n    }\n  }\n\n  beforeUpload = (file) => {\n    const isJPG = file.type === 'image/jpeg';\n    if (!isJPG) {\n      message.error('åªèƒ½ä¸Šä¼ JPGçš„å›¾ç‰‡!');\n    }\n    const isLt2M = file.size / 1024 / 1024 < 2;\n    if (!isLt2M) {\n      message.error('å›¾ç‰‡å¤§å°ä¸èƒ½å¤§äº2MB!');\n    }\n    return isJPG && isLt2M;\n  }\n\n  upLoadProps = () => {\n    HEADER_BASE.user_id = window.sessionStorage.getItem('userId');\n    HEADER_BASE.token_id = window.sessionStorage.getItem('tokenId');\n    const props = {\n      name: 'file',\n      action: PICTURE_UPLOAD,\n      headers: HEADER_BASE,\n      onChange: this.handleChange,\n      showUploadList: false,\n      beforeUpload: this.beforeUpload,\n    };\n    return props;\n  };\n\n  render() {\n    \n    const { imageUrl } = this.state;\n\n    return (\n      <Upload\n        listType=\"picture-card\"\n        {...this.upLoadProps()}\n\n      >\n        {imageUrl ? <img src={imageUrl} alt=\"avatar\" /> : this.uploadButton()}\n      </Upload>\n    )\n  }\n}\n\nexport default FormImageUpload;\n```\n\n - **FormInput**\n\n```\n/*\n * @Author: Derrick \n * @Date: 2019-04-10 10:57:08 \n * @Last Modified by: Derrick\n * @Last Modified time: 2019-04-15 14:46:23\n */\nimport React, { Component } from 'react';\nimport { Input } from 'antd';\nimport PropTypes from 'prop-types';\n\nclass FormInput extends Component {\n\n  change = (e) => {\n    const {onChange} = this.props;\n    onChange(e)\n  }\n\n  render() {\n    const {message, value, disabled} = this.props;\n    return (\n      <Input disabled={disabled} placeholder={message} value={value} onChange={this.change} />\n      );\n  }\n}\n\nFormInput.propsType = {\n  disabled: PropTypes.bool, // æ˜¯å¦ä¸å¯é€‰\n  message: PropTypes.string, // é»˜è®¤æ–‡å­—ï¼ˆplaceholder\n}\n\nFormInput.defalutProps = {\n  disabled: false,\n  message: '',\n}\n\nexport default FormInput;\n```\n\n\n - **FormSelect**\n\n\n```\n/*\n * @Author: Derrick \n * @Date: 2019-04-10 10:13:58 \n * @Last Modified by: Derrick\n * @Last Modified time: 2019-04-28 15:59:22\n */\nimport React, { Component } from 'react';\nimport { Select } from 'antd';\nimport PropTypes, { object } from 'prop-types';\n\nconst { Option } = Select;\nclass FormSelect extends Component {\n\n  option = () => {\n    const {option = []} = this.props;\n    return option.map((v) => {\n      const {showValue, severKey} = v;\n      return <Option value={severKey} key={severKey}>{showValue}</Option>\n    })\n  }\n\n  selectCurrency = (e) => {\n    const {onChange} = this.props\n    onChange(e)\n  }\n\n  render() {\n    const {message, value, disabled} = this.props;\n    return (\n      <Select disabled={disabled} value={value} placeholder={message} style={{width: '170px'}} onSelect={this.selectCurrency}>\n        {this.option()}\n      </Select>    \n      );\n  }\n}\n\nFormSelect.propsType = {\n  disabled: PropTypes.bool, // æ˜¯å¦ä¸å¯é€‰\n  message: PropTypes.string, // é»˜è®¤æ–‡å­—ï¼ˆplaceholder\n  option: PropTypes.arrayOf(object), // é€‰æ‹©æ¡†çš„é€‰é¡¹\n}\n\nFormSelect.defalutProps = {\n  disabled: false,\n  message: '',\n  option: [],\n}\n\nexport default FormSelect;\n```\n\n - **FormTextArea**\n\n```\n/*\n * @Author: Derrick \n * @Date: 2019-04-23 10:20:36 \n * @Last Modified by: Derrick\n * @Last Modified time: 2019-04-23 10:21:33\n */\nimport React, { Component } from 'react';\nimport { Input } from 'antd';\nimport PropTypes from 'prop-types';\n\nconst { TextArea } = Input;\nclass FormTextArea extends Component {\n\n  change = (e) => {\n    const {onChange} = this.props;\n    onChange(e)\n  }\n\n  render() {\n    const {message, value, disabled} = this.props;\n    return (\n      <TextArea rows={4} disabled={disabled} placeholder={message} value={value} onChange={this.change} />\n      );\n  }\n}\n\nFormTextArea.propsType = {\n  disabled: PropTypes.bool, // æ˜¯å¦ä¸å¯é€‰\n  message: PropTypes.string, // é»˜è®¤æ–‡å­—ï¼ˆplaceholder\n}\n\nFormTextArea.defalutProps = {\n  disabled: false,\n  message: '',\n}\n\nexport default FormTextArea;\n```\n\n\n## æ ¸å¿ƒ\n\n\n```\nconst {onChange} = this.props;\nonChange(XX)\n```\n\n\nè¿™ä¸ªonChangeæ˜¯å¯ä»¥ç›´æ¥æ”¹å˜FormItemçš„å€¼ã€‚\n\næ¥ä¸‹æ¥å¯ä»¥åŠ å…¥æ‚¨è‡ªå·±å–œæ¬¢çš„ç»„ä»¶ï¼Œéƒ½æ˜¯å¤§åŒå°å¼‚ï¼ŒåŸºæœ¬ä¸Šéƒ½ç¦»ä¸å¼€è¿™ä¸ªonChangeã€‚\n\n\nä»¥ä¸Šå°±æ˜¯æœ¬äººæœ€è¿‘å°è£…çš„ä¸€ä¸ªç»„ä»¶ï¼Œæˆ‘æ„Ÿè§‰å¾ˆå¥½ç”¨æ‰€ä»¥æƒ³åˆ†äº«å‡ºæ¥ã€‚\n","slug":"ant-design-Form-ç»„ä»¶æ€»ç»“-ç»“åˆModal-è‡ªå®šä¹‰Modalçš„å®ç°-ï¼ˆUpload-Input-Select-DatePicker-Cascaderï¼‰","published":1,"updated":"2021-06-24T14:00:06.848Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra7w000nlwrd3s5pdwt1","content":"<h2 id=\"èµ·æº\"><a href=\"#èµ·æº\" class=\"headerlink\" title=\"èµ·æº\"></a>èµ·æº</h2><p>æœ€è¿‘åœ¨é¡¹ç›®ä¸­å‘ç°è¦å†™å¤šä¸ªå¼¹æ¡†ï¼ˆç”¨äºæŸ¥çœ‹ã€ç¼–è¾‘ã€æ–°å»ºXXä¿¡æ¯ï¼‰ï¼Œå¦‚ä¸‹å›¾ã€‚</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/AntDesignForm%E6%80%BB%E7%BB%93/modal.png\"  alt=\"æµ‹è¯•å›¾ç‰‡\"></p>\n<p>åƒè¿™æ ·èŠ±é‡Œèƒ¡å“¨çš„å¼¹æ¡†åœ¨ä¸€ä¸ªå¤§å‹çš„ä¸­å°ç®¡ç†ç³»ç»Ÿä¸­ï¼Œå¯èƒ½è¦å†™ä¸Šå¥½å‡ éçš„Modal<br>ä½†æ˜¯å…¶å®ä»–ä»¬å¤§åŒå°å¼‚ã€‚</p>\n<p>é¦–å…ˆï¼Œä»–ä»¬çš„titleæ˜¯å›ºå®šçš„ï¼ˆå¢ã€æ”¹ã€æŸ¥ï¼‰</p>\n<p>åº•ä¸‹çš„å†…å®¹ä¹Ÿæ˜¯å›ºå®šçš„ï¼Œæ— éå°±æ˜¯Upload Input Select DatePicker Cascader</p>\n<p>ï¼ˆå†™ä¸äº†&lt;&gt;ã€‚å…¶å®åº”è¯¥æ˜¯ant design çš„ç»„ä»¶ï¼‰</p>\n<h2 id=\"æ”¹è¿›\"><a href=\"#æ”¹è¿›\" class=\"headerlink\" title=\"æ”¹è¿›\"></a>æ”¹è¿›</h2><p>æ‰€ä»¥æˆ‘æƒ³è‡ªå·±å†™ä¸€ä¸ªModalViewçš„ç»„ä»¶ã€‚åªéœ€è¦ä¼ å…¥è¿™ä¸Šé¢çš„æ•°æ®ç±»å‹ï¼Œtitleä¹‹ç±»çš„æ•°æ®å°±å¯ä»¥å®Œæˆæ¸²æŸ“ã€‚</p>\n<p>å¦‚ä¸‹ï¼Œè¿™ä¸ªæ˜¯æˆ‘é¡¹ç›®ä¸­çš„ä¸€ä¸ªä¾‹å­</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;ModalView </span><br><span class=\"line\">          onOk&#x3D;&#123;this.edit&#125;     &#x2F;&#x2F; ç‚¹å‡»Modalç¡®å®šæ—¶çš„å›è°ƒ</span><br><span class=\"line\">          onCancel&#x3D;&#123;this.hideModal&#125;   &#x2F;&#x2F; ç‚¹å‡»Modalå–æ¶ˆï¼Œæˆ–è€…ç‚¹å‡»maskæ—¶çš„å›è°ƒ</span><br><span class=\"line\">          show&#x3D;&#123;visible&#125;        &#x2F;&#x2F; Modalçš„æ˜¾éš</span><br><span class=\"line\">          category&#x3D;&#123;category&#125;      &#x2F;&#x2F; Modalçš„titleï¼Œé€šè¿‡categoryæ¥åˆ¤æ–­ï¼ˆç›®å‰åªæœ‰æŸ¥çœ‹ã€ç¼–è¾‘ã€æ–°å¢ï¼‰</span><br><span class=\"line\">          data&#x3D;&#123;fStaffManage&#125;     &#x2F;&#x2F; è‡ªå®šä¹‰Modalçš„æ ¸å¿ƒï¼Œæ•´ä¸ªModalçš„æ¸²æŸ“</span><br><span class=\"line\">          showData&#x3D;&#123;showData&#125;    &#x2F;&#x2F; ç‚¹å‡»æŸ¥çœ‹å’Œç¼–è¾‘æ—¶çš„é»˜è®¤æ•°æ®</span><br><span class=\"line\">&#x2F;&gt;</span><br></pre></td></tr></table></figure>\n\n\n<p>æ¥ä¸‹æ¥æ˜¯fStaffManageçš„æ•°æ®ç»“æ„</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export const fStaffManage &#x3D; [</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    label: &#39;å‘˜å·¥ç¼–å·ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰&#39;,</span><br><span class=\"line\">    key: &#39;id&#39;,</span><br><span class=\"line\">    type: &#39;input&#39;,</span><br><span class=\"line\">    Message: &#39;è¯·è¾“å…¥å‘˜å·¥ç¼–å·&#39;,</span><br><span class=\"line\">    disabled: true,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    label: &#39;é—¨åº—&#39;,</span><br><span class=\"line\">    key: &#39;storeNo&#39;,</span><br><span class=\"line\">    type: &#39;select&#39;,</span><br><span class=\"line\">    Message: &#39;è¯·é€‰æ‹©é—¨åº—&#39;,</span><br><span class=\"line\">    option: [],</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    label: &#39;å‘˜å·¥å§“å&#39;,</span><br><span class=\"line\">    key: &#39;userName&#39;,</span><br><span class=\"line\">    type: &#39;input&#39;,</span><br><span class=\"line\">    Message: &#39;è¯·è¾“å…¥å‘˜å·¥å§“å&#39;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    label: &#39;è§’è‰²ç±»å‹&#39;,</span><br><span class=\"line\">    key: &#39;roleCodes&#39;,</span><br><span class=\"line\">    type: &#39;select&#39;,</span><br><span class=\"line\">    Message: &#39;è¯·é€‰æ‹©è§’è‰²ç±»å‹&#39;,</span><br><span class=\"line\">    option: [&#123; severKey: &#39;åº—å‘˜&#39;, showValue: &#39;åº—å‘˜&#39; &#125;, &#123; severKey: &#39;åº—é•¿&#39;, showValue: &#39;åº—é•¿&#39; &#125;],</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    label: &#39;è”ç³»ç”µè¯&#39;,</span><br><span class=\"line\">    key: &#39;mobile&#39;,</span><br><span class=\"line\">    type: &#39;input&#39;,</span><br><span class=\"line\">    Message: &#39;è¯·è¾“å…¥è”ç³»ç”µè¯&#39;,</span><br><span class=\"line\">    pattern: &#39;^1[34578]\\\\d&#123;9&#125;$&#39;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    label: &#39;æµ‹è¯•ä¸Šä¼ å›¾ç‰‡&#39;,</span><br><span class=\"line\">    key: &#39;testImgUpload&#39;,</span><br><span class=\"line\">    type: &#39;imageUpload&#39;,</span><br><span class=\"line\">    Message: &#39;è¯·ä¸Šä¼ å›¾ç‰‡&#39;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">];</span><br></pre></td></tr></table></figure>\n<p><strong>Message</strong>  æ˜¯ç”¨äºFormè¡¨å•çš„æç¤ºç”¨äºä»¥åŠplaceholder</p>\n<p><strong>label</strong>   æ˜¯ç”¨äºFormçš„label</p>\n<p><strong>key</strong>   æ˜¯ç”¨äºmapå¾ªç¯æ—¶çš„keyï¼ˆé˜²æ­¢warningå’Œæå‡æ•ˆç‡ï¼‰</p>\n<p><strong>type</strong>   æ˜¯ç”¨äºæ˜¾ç¤ºé‚£ç§ç±»å‹çš„ç»„ä»¶</p>\n<p><strong>pattern</strong>   æ˜¯ç”¨äºFormè¡¨å•æ£€æµ‹çš„æ­£åˆ™è¡¨è¾¾å¼</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;*</span><br><span class=\"line\"> * @Author: Derrick</span><br><span class=\"line\"> * @Date: 2019-04-04 16:53:05</span><br><span class=\"line\"> * @Last Modified by: Derrick</span><br><span class=\"line\"> * @Last Modified time: 2019-04-28 15:48:04</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">import React, &#123; PureComponent &#125; from &#39;react&#39;;</span><br><span class=\"line\">import &#123; Modal, Form, Button, Table, Upload, message, Row, Select &#125; from &#39;antd&#39;;</span><br><span class=\"line\">import &#123; connect &#125; from &#39;dva&#39;;</span><br><span class=\"line\">import PropTypes from &#39;prop-types&#39;;</span><br><span class=\"line\">import componentAuth from &#39;@&#x2F;common&#x2F;ComponentAuth&#39;;</span><br><span class=\"line\">import FormSelect from &#39;@&#x2F;common&#x2F;FormItems&#x2F;FormSelect&#39;;</span><br><span class=\"line\">import FormInput from &#39;@&#x2F;common&#x2F;FormItems&#x2F;FormInput&#39;;</span><br><span class=\"line\">import FormDataPicker from &#39;@&#x2F;common&#x2F;FormItems&#x2F;FormDataPicker&#39;;</span><br><span class=\"line\">import FormCascader from &#39;@&#x2F;common&#x2F;FormItems&#x2F;FormCascader&#39;;</span><br><span class=\"line\">import FormTextArea from &#39;@&#x2F;common&#x2F;FormItems&#x2F;FormTextArea&#39;;</span><br><span class=\"line\">import FormImageUpload from &#39;@&#x2F;common&#x2F;FormItems&#x2F;FormImageUpload&#39;;</span><br><span class=\"line\">import &#123; HEADER_BASE, SEVER_URL_BASE &#125; from &#39;@&#x2F;utils&#x2F;constant&#39;;</span><br><span class=\"line\">import Col from &#39;antd&#x2F;es&#x2F;col&#39;;</span><br><span class=\"line\"></span><br><span class=\"line\">const formItemLayout &#x3D; &#123;</span><br><span class=\"line\">  labelCol: &#123;</span><br><span class=\"line\">    xs: &#123; span: 24 &#125;,</span><br><span class=\"line\">    sm: &#123; span: 5 &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  wrapperCol: &#123;</span><br><span class=\"line\">    xs: &#123; span: 24 &#125;,</span><br><span class=\"line\">    sm: &#123; span: 16 &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">const &#123; Item &#125; &#x3D; Form;</span><br><span class=\"line\">const &#123; Option &#125; &#x3D; Select;</span><br><span class=\"line\"></span><br><span class=\"line\">@connect((&#123; mIdentifyCenter &#125;) &#x3D;&gt; (&#123;</span><br><span class=\"line\">  mIdentifyCenter</span><br><span class=\"line\">&#125;))</span><br><span class=\"line\">class ModalView extends PureComponent &#123;</span><br><span class=\"line\">  state &#x3D; &#123;</span><br><span class=\"line\">    data: [],</span><br><span class=\"line\">    storeId: &#39;&#39;,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  &#x2F;&#x2F; è¿”å›title</span><br><span class=\"line\">  caseCategory &#x3D; category &#x3D;&gt; &#123;</span><br><span class=\"line\">    switch (category) &#123;</span><br><span class=\"line\">      case &#39;check&#39;:</span><br><span class=\"line\">        return &#123; title: &#39;æŸ¥çœ‹&#39; &#125;;</span><br><span class=\"line\">      case &#39;import&#39;:</span><br><span class=\"line\">        return &#123; title: &#39;å¯¼å…¥&#39;, import: true &#125;;</span><br><span class=\"line\">      case &#39;create&#39;:</span><br><span class=\"line\">        return &#123; title: &#39;æ–°å¢&#39; &#125;;</span><br><span class=\"line\">      case &#39;edit&#39;:</span><br><span class=\"line\">        return &#123; title: &#39;ç¼–è¾‘&#39; &#125;;</span><br><span class=\"line\">      default:</span><br><span class=\"line\">        return &#123; title: &#39;æŸ¥çœ‹&#39; &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  showLabel &#x3D; (type, label) &#x3D;&gt; &#123;</span><br><span class=\"line\">    const &#123; category &#125; &#x3D; this.props;</span><br><span class=\"line\"></span><br><span class=\"line\">    if (category &#x3D;&#x3D;&#x3D; &#39;search&#39;) &#123;</span><br><span class=\"line\">      if (type !&#x3D;&#x3D; &#39;datePicker&#39;) &#123;</span><br><span class=\"line\">        return undefined;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      return label;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return label;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  showRequire &#x3D; disabled &#x3D;&gt; &#123;</span><br><span class=\"line\">    const &#123; category &#125; &#x3D; this.props;</span><br><span class=\"line\">    if (category &#x3D;&#x3D;&#x3D; &#39;search&#39;) &#123;</span><br><span class=\"line\">      return false;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    if (disabled) &#123;</span><br><span class=\"line\">      return false;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return true;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  form &#x3D; () &#x3D;&gt; &#123;</span><br><span class=\"line\">    const &#123;</span><br><span class=\"line\">      form: &#123; getFieldDecorator &#125;,</span><br><span class=\"line\">      data,</span><br><span class=\"line\">      showData,</span><br><span class=\"line\">      category,</span><br><span class=\"line\">    &#125; &#x3D; this.props;</span><br><span class=\"line\"></span><br><span class=\"line\">    let ShowType;</span><br><span class=\"line\"></span><br><span class=\"line\">    return data.map(value &#x3D;&gt; &#123;</span><br><span class=\"line\">      const &#123; label, key, type, Message, option, disabled, pattern &#125; &#x3D; value;</span><br><span class=\"line\">      if (!value) &#123;</span><br><span class=\"line\">        return null;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      switch (type) &#123;</span><br><span class=\"line\">        case &#39;input&#39;:</span><br><span class=\"line\">          ShowType &#x3D; FormInput;</span><br><span class=\"line\">          break;</span><br><span class=\"line\">        case &#39;select&#39;:</span><br><span class=\"line\">          ShowType &#x3D; FormSelect;</span><br><span class=\"line\">          break;</span><br><span class=\"line\">        case &#39;datePicker&#39;:</span><br><span class=\"line\">          ShowType &#x3D; FormDataPicker;</span><br><span class=\"line\">          break;</span><br><span class=\"line\">        case &#39;cascader&#39;:</span><br><span class=\"line\">          ShowType &#x3D; FormCascader;</span><br><span class=\"line\">          showData.region &#x3D; [showData.provinceId, showData.cityId, showData.countyId];</span><br><span class=\"line\">          break;</span><br><span class=\"line\">        case &#39;textArea&#39;:</span><br><span class=\"line\">          ShowType &#x3D; FormTextArea;</span><br><span class=\"line\">          break;</span><br><span class=\"line\">        case &#39;imageUpload&#39;:</span><br><span class=\"line\">          ShowType &#x3D; FormImageUpload;</span><br><span class=\"line\">          break;</span><br><span class=\"line\">        default:</span><br><span class=\"line\">          ShowType &#x3D; null;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      return (</span><br><span class=\"line\">        &lt;Item label&#x3D;&#123;this.showLabel(type, label)&#125; key&#x3D;&#123;key&#125;&gt;</span><br><span class=\"line\">          &#123;getFieldDecorator(key, &#123;</span><br><span class=\"line\">            rules: [</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                required: this.showRequire(disabled),</span><br><span class=\"line\">                message: Message,</span><br><span class=\"line\">                pattern: pattern || undefined,</span><br><span class=\"line\">                type: type &#x3D;&#x3D;&#x3D; &#39;cascader&#39; ? &#39;array&#39; : &#39;string&#39;,</span><br><span class=\"line\">              &#125;,</span><br><span class=\"line\">            ],</span><br><span class=\"line\">            initialValue: showData[key] ? showData[key] : undefined,</span><br><span class=\"line\">          &#125;)(</span><br><span class=\"line\">            &lt;ShowType</span><br><span class=\"line\">              option&#x3D;&#123;option&#125;</span><br><span class=\"line\">              message&#x3D;&#123;Message&#125;</span><br><span class=\"line\">              disabled&#x3D;&#123;!!(disabled || category &#x3D;&#x3D;&#x3D; &#39;check&#39;)&#125;</span><br><span class=\"line\">            &#x2F;&gt;</span><br><span class=\"line\">          )&#125;</span><br><span class=\"line\">        &lt;&#x2F;Item&gt;</span><br><span class=\"line\">      );</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  checkOk &#x3D; () &#x3D;&gt; &#123;</span><br><span class=\"line\">    const &#123; onOk, form &#125; &#x3D; this.props;</span><br><span class=\"line\">    form.validateFields((err, fieldsValue) &#x3D;&gt; &#123;</span><br><span class=\"line\">      if (!err) &#123;</span><br><span class=\"line\">        onOk(fieldsValue);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  </span><br><span class=\"line\">  closeModal &#x3D; () &#x3D;&gt; &#123;</span><br><span class=\"line\">    const &#123; onCancel, form: &#123; resetFields &#125; &#125; &#x3D; this.props;</span><br><span class=\"line\">    resetFields();</span><br><span class=\"line\">    onCancel();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    const &#123; data &#125; &#x3D; this.state;</span><br><span class=\"line\">    const &#123; show, category &#x3D; &#39;&#39;, importColums, downloadUrl &#125; &#x3D; this.props;</span><br><span class=\"line\">    const modalData &#x3D; this.caseCategory(category);</span><br><span class=\"line\">    return (</span><br><span class=\"line\">      &lt;Modal</span><br><span class=\"line\">        visible&#x3D;&#123;show&#125;</span><br><span class=\"line\">        onCancel&#x3D;&#123;this.closeModal&#125;</span><br><span class=\"line\">        onOk&#x3D;&#123;category &#x3D;&#x3D;&#x3D; &#39;import&#39; ? this.importOk : this.checkOk&#125;</span><br><span class=\"line\">        title&#x3D;&#123;modalData.title&#125;</span><br><span class=\"line\">        width&#x3D;&quot;70%&quot;</span><br><span class=\"line\">        footer&#x3D;&#123;modalData.title &#x3D;&#x3D;&#x3D; &#39;æŸ¥çœ‹&#39; ? null : undefined&#125;</span><br><span class=\"line\">      &gt;</span><br><span class=\"line\">          &lt;Form style&#x3D;&#123;&#123; paddingTop: &#39;20px&#39; &#125;&#125; &#123;...formItemLayout&#125;&gt;</span><br><span class=\"line\">            &#123;this.form()&#125;</span><br><span class=\"line\">          &lt;&#x2F;Form&gt;</span><br><span class=\"line\">      &lt;&#x2F;Modal&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">ModalView.propTypes &#x3D; &#123;</span><br><span class=\"line\">  onOk: PropTypes.func.isRequired, &#x2F;&#x2F; å¼¹æ¡†ç‚¹å‡»ç¡®å®š</span><br><span class=\"line\">  onCancel: PropTypes.func.isRequired, &#x2F;&#x2F; éšè—å¼¹æ¡†</span><br><span class=\"line\">  show: PropTypes.bool, &#x2F;&#x2F; æ˜¯å¦æ˜¾ç¤ºå¼¹çª—</span><br><span class=\"line\">  category: PropTypes.string, &#x2F;&#x2F; å¼¹æ¡†çš„ç±»å‹ï¼ˆtitleæ˜¾ç¤º</span><br><span class=\"line\">  data: PropTypes.arrayOf(PropTypes.object).isRequired, &#x2F;&#x2F; æ•°æ®ç±»å‹; ä½ç½®:&#39;@&#x2F;common&#x2F;constant&#x2F;sormView.js&#39; è®°å¾—å†™æ³¨é‡Š; æ ¼å¼: &#96;s$&#123;æ–‡ä»¶å&#125;&#96;</span><br><span class=\"line\">  showData: PropTypes.object, &#x2F;&#x2F; æŸ¥çœ‹æˆ–è€…ç¼–è¾‘æ—¶çš„é»˜è®¤æ•°æ®</span><br><span class=\"line\">  importCallBack: PropTypes.func, &#x2F;&#x2F; å¯¼å…¥ä¹‹åï¼Œç‚¹å‡»ç¡®å®šçš„å›è°ƒå‡½æ•°</span><br><span class=\"line\">  importColums: PropTypes.array, &#x2F;&#x2F; å¯¼å…¥æ—¶å€™æ˜¾ç¤ºè¡¨æ ¼çš„è¡¨å¤´</span><br><span class=\"line\">  downloadUrl: PropTypes.string, &#x2F;&#x2F; ä¸‹è½½çš„æ¨¡æ¿çš„æ–‡ä»¶å</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">ModalView.defaultProps &#x3D; &#123;</span><br><span class=\"line\">  show: false,</span><br><span class=\"line\">  category: &#39;check&#39;,</span><br><span class=\"line\">  showData: &#123;&#125;,</span><br><span class=\"line\">  importCallBack: () &#x3D;&gt; &#123;&#125;,</span><br><span class=\"line\">  importColums: [],</span><br><span class=\"line\">  downloadUrl: &#39;&#39;,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">export default Form.create()(ModalView);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>FormCascader</strong></li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;*</span><br><span class=\"line\"> * @Author: Derrick </span><br><span class=\"line\"> * @Date: 2019-04-11 09:57:54 </span><br><span class=\"line\"> * @Last Modified by: Derrick</span><br><span class=\"line\"> * @Last Modified time: 2019-04-28 16:52:57</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">import React, &#123; Component &#125; from &#39;react&#39;;</span><br><span class=\"line\">import &#123; Cascader &#125; from &#39;antd&#39;;</span><br><span class=\"line\">import PropTypes from &#39;prop-types&#39;;</span><br><span class=\"line\">import regionData from &#39;@&#x2F;constant&#x2F;regionData&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">class FormCascader extends Component &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  change &#x3D; (e) &#x3D;&gt; &#123;</span><br><span class=\"line\">    const &#123;onChange&#125; &#x3D; this.props;</span><br><span class=\"line\">    onChange(e)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    const &#123;value, disabled, message&#125; &#x3D; this.props;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">      &lt;Cascader placeholder&#x3D;&#123;message&#125; options&#x3D;&#123;regionData&#125; disabled&#x3D;&#123;disabled&#125; value&#x3D;&#123;value&#125; onChange&#x3D;&#123;this.change&#125; &#x2F;&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">FormCascader.propsType &#x3D; &#123;</span><br><span class=\"line\">  disabled: PropTypes.bool, &#x2F;&#x2F; æ˜¯å¦ä¸å¯é€‰</span><br><span class=\"line\">  message: PropTypes.string, &#x2F;&#x2F; é»˜è®¤æ–‡å­—ï¼ˆplaceholder</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">FormCascader.defalutProps &#x3D; &#123;</span><br><span class=\"line\">  disabled: false,</span><br><span class=\"line\">  message: &#39;&#39;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default FormCascader;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>FormDataPicker</strong></li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;*</span><br><span class=\"line\"> * @Author: Derrick </span><br><span class=\"line\"> * @Date: 2019-04-10 10:57:08 </span><br><span class=\"line\"> * @Last Modified by: Derrick</span><br><span class=\"line\"> * @Last Modified time: 2019-04-15 14:28:40</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">import React, &#123; Component &#125; from &#39;react&#39;;</span><br><span class=\"line\">import PropTypes from &#39;prop-types&#39;;</span><br><span class=\"line\">import &#123; DatePicker &#125; from &#39;antd&#39;;</span><br><span class=\"line\"></span><br><span class=\"line\">class FormDataPicker extends Component &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  change &#x3D; (e) &#x3D;&gt; &#123;</span><br><span class=\"line\">    const &#123;onChange&#125; &#x3D; this.props</span><br><span class=\"line\">    onChange(e)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    const &#123;value, disabled&#125; &#x3D; this.props;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">      &lt;DatePicker disabled&#x3D;&#123;disabled&#125; value&#x3D;&#123;value&#125; onChange&#x3D;&#123;this.change&#125; &#x2F;&gt;</span><br><span class=\"line\">      );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">FormDataPicker.propsType &#x3D; &#123;</span><br><span class=\"line\">  disabled: PropTypes.bool, &#x2F;&#x2F; æ˜¯å¦ä¸å¯é€‰</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">FormDataPicker.defalutProps &#x3D; &#123;</span><br><span class=\"line\">  disabled: false,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default FormDataPicker;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>FormImageUpload</strong></li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;*</span><br><span class=\"line\"> * @Author: Derrick </span><br><span class=\"line\"> * @Date: 2019-04-26 14:20:20 </span><br><span class=\"line\"> * @Last Modified by: Derrick</span><br><span class=\"line\"> * @Last Modified time: 2019-04-28 18:11:44</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">import React, &#123; PureComponent &#125; from &#39;react&#39;;</span><br><span class=\"line\">import &#123; Upload, Icon, message &#125; from &#39;antd&#39;;</span><br><span class=\"line\">import &#123; PICTURE_UPLOAD, HEADER_BASE &#125; from &#39;@&#x2F;utils&#x2F;constant&#39;;</span><br><span class=\"line\"></span><br><span class=\"line\">class FormImageUpload extends PureComponent &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  state &#x3D; &#123;</span><br><span class=\"line\">    loading: false,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  uploadButton &#x3D; () &#x3D;&gt; &#123;</span><br><span class=\"line\">    const &#123; loading &#125; &#x3D; this.state;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">      &lt;div&gt;</span><br><span class=\"line\">        &lt;Icon type&#x3D;&#123;loading ? &#39;loading&#39; : &#39;plus&#39;&#125; &#x2F;&gt;</span><br><span class=\"line\">        &lt;div className&#x3D;&quot;ant-upload-text&quot;&gt;Upload&lt;&#x2F;div&gt;</span><br><span class=\"line\">      &lt;&#x2F;div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  handleChange &#x3D; (info) &#x3D;&gt; &#123;</span><br><span class=\"line\">    if (info.file.status &#x3D;&#x3D;&#x3D; &#39;uploading&#39;) &#123;</span><br><span class=\"line\">      this.setState(&#123; loading: true &#125;);</span><br><span class=\"line\">      return;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    if (info.file.status &#x3D;&#x3D;&#x3D; &#39;done&#39;) &#123;</span><br><span class=\"line\">      const &#123;onChange&#125; &#x3D; this.props</span><br><span class=\"line\">      this.setState(&#123;imageUrl: info.file.response.data[0], loading: false,&#125;)</span><br><span class=\"line\">      onChange(info.file.response.data[0])</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  beforeUpload &#x3D; (file) &#x3D;&gt; &#123;</span><br><span class=\"line\">    const isJPG &#x3D; file.type &#x3D;&#x3D;&#x3D; &#39;image&#x2F;jpeg&#39;;</span><br><span class=\"line\">    if (!isJPG) &#123;</span><br><span class=\"line\">      message.error(&#39;åªèƒ½ä¸Šä¼ JPGçš„å›¾ç‰‡!&#39;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    const isLt2M &#x3D; file.size &#x2F; 1024 &#x2F; 1024 &lt; 2;</span><br><span class=\"line\">    if (!isLt2M) &#123;</span><br><span class=\"line\">      message.error(&#39;å›¾ç‰‡å¤§å°ä¸èƒ½å¤§äº2MB!&#39;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return isJPG &amp;&amp; isLt2M;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  upLoadProps &#x3D; () &#x3D;&gt; &#123;</span><br><span class=\"line\">    HEADER_BASE.user_id &#x3D; window.sessionStorage.getItem(&#39;userId&#39;);</span><br><span class=\"line\">    HEADER_BASE.token_id &#x3D; window.sessionStorage.getItem(&#39;tokenId&#39;);</span><br><span class=\"line\">    const props &#x3D; &#123;</span><br><span class=\"line\">      name: &#39;file&#39;,</span><br><span class=\"line\">      action: PICTURE_UPLOAD,</span><br><span class=\"line\">      headers: HEADER_BASE,</span><br><span class=\"line\">      onChange: this.handleChange,</span><br><span class=\"line\">      showUploadList: false,</span><br><span class=\"line\">      beforeUpload: this.beforeUpload,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    return props;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    const &#123; imageUrl &#125; &#x3D; this.state;</span><br><span class=\"line\"></span><br><span class=\"line\">    return (</span><br><span class=\"line\">      &lt;Upload</span><br><span class=\"line\">        listType&#x3D;&quot;picture-card&quot;</span><br><span class=\"line\">        &#123;...this.upLoadProps()&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      &gt;</span><br><span class=\"line\">        &#123;imageUrl ? &lt;img src&#x3D;&#123;imageUrl&#125; alt&#x3D;&quot;avatar&quot; &#x2F;&gt; : this.uploadButton()&#125;</span><br><span class=\"line\">      &lt;&#x2F;Upload&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default FormImageUpload;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>FormInput</strong></li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;*</span><br><span class=\"line\"> * @Author: Derrick </span><br><span class=\"line\"> * @Date: 2019-04-10 10:57:08 </span><br><span class=\"line\"> * @Last Modified by: Derrick</span><br><span class=\"line\"> * @Last Modified time: 2019-04-15 14:46:23</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">import React, &#123; Component &#125; from &#39;react&#39;;</span><br><span class=\"line\">import &#123; Input &#125; from &#39;antd&#39;;</span><br><span class=\"line\">import PropTypes from &#39;prop-types&#39;;</span><br><span class=\"line\"></span><br><span class=\"line\">class FormInput extends Component &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  change &#x3D; (e) &#x3D;&gt; &#123;</span><br><span class=\"line\">    const &#123;onChange&#125; &#x3D; this.props;</span><br><span class=\"line\">    onChange(e)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    const &#123;message, value, disabled&#125; &#x3D; this.props;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">      &lt;Input disabled&#x3D;&#123;disabled&#125; placeholder&#x3D;&#123;message&#125; value&#x3D;&#123;value&#125; onChange&#x3D;&#123;this.change&#125; &#x2F;&gt;</span><br><span class=\"line\">      );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">FormInput.propsType &#x3D; &#123;</span><br><span class=\"line\">  disabled: PropTypes.bool, &#x2F;&#x2F; æ˜¯å¦ä¸å¯é€‰</span><br><span class=\"line\">  message: PropTypes.string, &#x2F;&#x2F; é»˜è®¤æ–‡å­—ï¼ˆplaceholder</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">FormInput.defalutProps &#x3D; &#123;</span><br><span class=\"line\">  disabled: false,</span><br><span class=\"line\">  message: &#39;&#39;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default FormInput;</span><br></pre></td></tr></table></figure>\n\n\n<ul>\n<li><strong>FormSelect</strong></li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;*</span><br><span class=\"line\"> * @Author: Derrick </span><br><span class=\"line\"> * @Date: 2019-04-10 10:13:58 </span><br><span class=\"line\"> * @Last Modified by: Derrick</span><br><span class=\"line\"> * @Last Modified time: 2019-04-28 15:59:22</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">import React, &#123; Component &#125; from &#39;react&#39;;</span><br><span class=\"line\">import &#123; Select &#125; from &#39;antd&#39;;</span><br><span class=\"line\">import PropTypes, &#123; object &#125; from &#39;prop-types&#39;;</span><br><span class=\"line\"></span><br><span class=\"line\">const &#123; Option &#125; &#x3D; Select;</span><br><span class=\"line\">class FormSelect extends Component &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  option &#x3D; () &#x3D;&gt; &#123;</span><br><span class=\"line\">    const &#123;option &#x3D; []&#125; &#x3D; this.props;</span><br><span class=\"line\">    return option.map((v) &#x3D;&gt; &#123;</span><br><span class=\"line\">      const &#123;showValue, severKey&#125; &#x3D; v;</span><br><span class=\"line\">      return &lt;Option value&#x3D;&#123;severKey&#125; key&#x3D;&#123;severKey&#125;&gt;&#123;showValue&#125;&lt;&#x2F;Option&gt;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  selectCurrency &#x3D; (e) &#x3D;&gt; &#123;</span><br><span class=\"line\">    const &#123;onChange&#125; &#x3D; this.props</span><br><span class=\"line\">    onChange(e)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    const &#123;message, value, disabled&#125; &#x3D; this.props;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">      &lt;Select disabled&#x3D;&#123;disabled&#125; value&#x3D;&#123;value&#125; placeholder&#x3D;&#123;message&#125; style&#x3D;&#123;&#123;width: &#39;170px&#39;&#125;&#125; onSelect&#x3D;&#123;this.selectCurrency&#125;&gt;</span><br><span class=\"line\">        &#123;this.option()&#125;</span><br><span class=\"line\">      &lt;&#x2F;Select&gt;    </span><br><span class=\"line\">      );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">FormSelect.propsType &#x3D; &#123;</span><br><span class=\"line\">  disabled: PropTypes.bool, &#x2F;&#x2F; æ˜¯å¦ä¸å¯é€‰</span><br><span class=\"line\">  message: PropTypes.string, &#x2F;&#x2F; é»˜è®¤æ–‡å­—ï¼ˆplaceholder</span><br><span class=\"line\">  option: PropTypes.arrayOf(object), &#x2F;&#x2F; é€‰æ‹©æ¡†çš„é€‰é¡¹</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">FormSelect.defalutProps &#x3D; &#123;</span><br><span class=\"line\">  disabled: false,</span><br><span class=\"line\">  message: &#39;&#39;,</span><br><span class=\"line\">  option: [],</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default FormSelect;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>FormTextArea</strong></li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;*</span><br><span class=\"line\"> * @Author: Derrick </span><br><span class=\"line\"> * @Date: 2019-04-23 10:20:36 </span><br><span class=\"line\"> * @Last Modified by: Derrick</span><br><span class=\"line\"> * @Last Modified time: 2019-04-23 10:21:33</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">import React, &#123; Component &#125; from &#39;react&#39;;</span><br><span class=\"line\">import &#123; Input &#125; from &#39;antd&#39;;</span><br><span class=\"line\">import PropTypes from &#39;prop-types&#39;;</span><br><span class=\"line\"></span><br><span class=\"line\">const &#123; TextArea &#125; &#x3D; Input;</span><br><span class=\"line\">class FormTextArea extends Component &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  change &#x3D; (e) &#x3D;&gt; &#123;</span><br><span class=\"line\">    const &#123;onChange&#125; &#x3D; this.props;</span><br><span class=\"line\">    onChange(e)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    const &#123;message, value, disabled&#125; &#x3D; this.props;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">      &lt;TextArea rows&#x3D;&#123;4&#125; disabled&#x3D;&#123;disabled&#125; placeholder&#x3D;&#123;message&#125; value&#x3D;&#123;value&#125; onChange&#x3D;&#123;this.change&#125; &#x2F;&gt;</span><br><span class=\"line\">      );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">FormTextArea.propsType &#x3D; &#123;</span><br><span class=\"line\">  disabled: PropTypes.bool, &#x2F;&#x2F; æ˜¯å¦ä¸å¯é€‰</span><br><span class=\"line\">  message: PropTypes.string, &#x2F;&#x2F; é»˜è®¤æ–‡å­—ï¼ˆplaceholder</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">FormTextArea.defalutProps &#x3D; &#123;</span><br><span class=\"line\">  disabled: false,</span><br><span class=\"line\">  message: &#39;&#39;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default FormTextArea;</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"æ ¸å¿ƒ\"><a href=\"#æ ¸å¿ƒ\" class=\"headerlink\" title=\"æ ¸å¿ƒ\"></a>æ ¸å¿ƒ</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const &#123;onChange&#125; &#x3D; this.props;</span><br><span class=\"line\">onChange(XX)</span><br></pre></td></tr></table></figure>\n\n\n<p>è¿™ä¸ªonChangeæ˜¯å¯ä»¥ç›´æ¥æ”¹å˜FormItemçš„å€¼ã€‚</p>\n<p>æ¥ä¸‹æ¥å¯ä»¥åŠ å…¥æ‚¨è‡ªå·±å–œæ¬¢çš„ç»„ä»¶ï¼Œéƒ½æ˜¯å¤§åŒå°å¼‚ï¼ŒåŸºæœ¬ä¸Šéƒ½ç¦»ä¸å¼€è¿™ä¸ªonChangeã€‚</p>\n<p>ä»¥ä¸Šå°±æ˜¯æœ¬äººæœ€è¿‘å°è£…çš„ä¸€ä¸ªç»„ä»¶ï¼Œæˆ‘æ„Ÿè§‰å¾ˆå¥½ç”¨æ‰€ä»¥æƒ³åˆ†äº«å‡ºæ¥ã€‚</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"èµ·æº\"><a href=\"#èµ·æº\" class=\"headerlink\" title=\"èµ·æº\"></a>èµ·æº</h2><p>æœ€è¿‘åœ¨é¡¹ç›®ä¸­å‘ç°è¦å†™å¤šä¸ªå¼¹æ¡†ï¼ˆç”¨äºæŸ¥çœ‹ã€ç¼–è¾‘ã€æ–°å»ºXXä¿¡æ¯ï¼‰ï¼Œå¦‚ä¸‹å›¾ã€‚</p>\n<p><img src=\"/image/AntDesignForm%E6%80%BB%E7%BB%93/modal.png\" alt=\"æµ‹è¯•å›¾ç‰‡\"></p>\n<p>åƒè¿™æ ·èŠ±é‡Œèƒ¡å“¨çš„å¼¹æ¡†åœ¨ä¸€ä¸ªå¤§å‹çš„ä¸­å°ç®¡ç†ç³»ç»Ÿä¸­ï¼Œå¯èƒ½è¦å†™ä¸Šå¥½å‡ éçš„Modal<br>ä½†æ˜¯å…¶å®ä»–ä»¬å¤§åŒå°å¼‚ã€‚</p>\n<p>é¦–å…ˆï¼Œä»–ä»¬çš„titleæ˜¯å›ºå®šçš„ï¼ˆå¢ã€æ”¹ã€æŸ¥ï¼‰</p>\n<p>åº•ä¸‹çš„å†…å®¹ä¹Ÿæ˜¯å›ºå®šçš„ï¼Œæ— éå°±æ˜¯Upload Input Select DatePicker Cascader</p>\n<p>ï¼ˆå†™ä¸äº†&lt;&gt;ã€‚å…¶å®åº”è¯¥æ˜¯ant design çš„ç»„ä»¶ï¼‰</p>\n<h2 id=\"æ”¹è¿›\"><a href=\"#æ”¹è¿›\" class=\"headerlink\" title=\"æ”¹è¿›\"></a>æ”¹è¿›</h2><p>æ‰€ä»¥æˆ‘æƒ³è‡ªå·±å†™ä¸€ä¸ªModalViewçš„ç»„ä»¶ã€‚åªéœ€è¦ä¼ å…¥è¿™ä¸Šé¢çš„æ•°æ®ç±»å‹ï¼Œtitleä¹‹ç±»çš„æ•°æ®å°±å¯ä»¥å®Œæˆæ¸²æŸ“ã€‚</p>\n<p>å¦‚ä¸‹ï¼Œè¿™ä¸ªæ˜¯æˆ‘é¡¹ç›®ä¸­çš„ä¸€ä¸ªä¾‹å­</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;ModalView </span><br><span class=\"line\">          onOk&#x3D;&#123;this.edit&#125;     &#x2F;&#x2F; ç‚¹å‡»Modalç¡®å®šæ—¶çš„å›è°ƒ</span><br><span class=\"line\">          onCancel&#x3D;&#123;this.hideModal&#125;   &#x2F;&#x2F; ç‚¹å‡»Modalå–æ¶ˆï¼Œæˆ–è€…ç‚¹å‡»maskæ—¶çš„å›è°ƒ</span><br><span class=\"line\">          show&#x3D;&#123;visible&#125;        &#x2F;&#x2F; Modalçš„æ˜¾éš</span><br><span class=\"line\">          category&#x3D;&#123;category&#125;      &#x2F;&#x2F; Modalçš„titleï¼Œé€šè¿‡categoryæ¥åˆ¤æ–­ï¼ˆç›®å‰åªæœ‰æŸ¥çœ‹ã€ç¼–è¾‘ã€æ–°å¢ï¼‰</span><br><span class=\"line\">          data&#x3D;&#123;fStaffManage&#125;     &#x2F;&#x2F; è‡ªå®šä¹‰Modalçš„æ ¸å¿ƒï¼Œæ•´ä¸ªModalçš„æ¸²æŸ“</span><br><span class=\"line\">          showData&#x3D;&#123;showData&#125;    &#x2F;&#x2F; ç‚¹å‡»æŸ¥çœ‹å’Œç¼–è¾‘æ—¶çš„é»˜è®¤æ•°æ®</span><br><span class=\"line\">&#x2F;&gt;</span><br></pre></td></tr></table></figure>\n\n\n<p>æ¥ä¸‹æ¥æ˜¯fStaffManageçš„æ•°æ®ç»“æ„</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export const fStaffManage &#x3D; [</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    label: &#39;å‘˜å·¥ç¼–å·ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰&#39;,</span><br><span class=\"line\">    key: &#39;id&#39;,</span><br><span class=\"line\">    type: &#39;input&#39;,</span><br><span class=\"line\">    Message: &#39;è¯·è¾“å…¥å‘˜å·¥ç¼–å·&#39;,</span><br><span class=\"line\">    disabled: true,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    label: &#39;é—¨åº—&#39;,</span><br><span class=\"line\">    key: &#39;storeNo&#39;,</span><br><span class=\"line\">    type: &#39;select&#39;,</span><br><span class=\"line\">    Message: &#39;è¯·é€‰æ‹©é—¨åº—&#39;,</span><br><span class=\"line\">    option: [],</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    label: &#39;å‘˜å·¥å§“å&#39;,</span><br><span class=\"line\">    key: &#39;userName&#39;,</span><br><span class=\"line\">    type: &#39;input&#39;,</span><br><span class=\"line\">    Message: &#39;è¯·è¾“å…¥å‘˜å·¥å§“å&#39;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    label: &#39;è§’è‰²ç±»å‹&#39;,</span><br><span class=\"line\">    key: &#39;roleCodes&#39;,</span><br><span class=\"line\">    type: &#39;select&#39;,</span><br><span class=\"line\">    Message: &#39;è¯·é€‰æ‹©è§’è‰²ç±»å‹&#39;,</span><br><span class=\"line\">    option: [&#123; severKey: &#39;åº—å‘˜&#39;, showValue: &#39;åº—å‘˜&#39; &#125;, &#123; severKey: &#39;åº—é•¿&#39;, showValue: &#39;åº—é•¿&#39; &#125;],</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    label: &#39;è”ç³»ç”µè¯&#39;,</span><br><span class=\"line\">    key: &#39;mobile&#39;,</span><br><span class=\"line\">    type: &#39;input&#39;,</span><br><span class=\"line\">    Message: &#39;è¯·è¾“å…¥è”ç³»ç”µè¯&#39;,</span><br><span class=\"line\">    pattern: &#39;^1[34578]\\\\d&#123;9&#125;$&#39;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    label: &#39;æµ‹è¯•ä¸Šä¼ å›¾ç‰‡&#39;,</span><br><span class=\"line\">    key: &#39;testImgUpload&#39;,</span><br><span class=\"line\">    type: &#39;imageUpload&#39;,</span><br><span class=\"line\">    Message: &#39;è¯·ä¸Šä¼ å›¾ç‰‡&#39;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">];</span><br></pre></td></tr></table></figure>\n<p><strong>Message</strong>  æ˜¯ç”¨äºFormè¡¨å•çš„æç¤ºç”¨äºä»¥åŠplaceholder</p>\n<p><strong>label</strong>   æ˜¯ç”¨äºFormçš„label</p>\n<p><strong>key</strong>   æ˜¯ç”¨äºmapå¾ªç¯æ—¶çš„keyï¼ˆé˜²æ­¢warningå’Œæå‡æ•ˆç‡ï¼‰</p>\n<p><strong>type</strong>   æ˜¯ç”¨äºæ˜¾ç¤ºé‚£ç§ç±»å‹çš„ç»„ä»¶</p>\n<p><strong>pattern</strong>   æ˜¯ç”¨äºFormè¡¨å•æ£€æµ‹çš„æ­£åˆ™è¡¨è¾¾å¼</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;*</span><br><span class=\"line\"> * @Author: Derrick</span><br><span class=\"line\"> * @Date: 2019-04-04 16:53:05</span><br><span class=\"line\"> * @Last Modified by: Derrick</span><br><span class=\"line\"> * @Last Modified time: 2019-04-28 15:48:04</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">import React, &#123; PureComponent &#125; from &#39;react&#39;;</span><br><span class=\"line\">import &#123; Modal, Form, Button, Table, Upload, message, Row, Select &#125; from &#39;antd&#39;;</span><br><span class=\"line\">import &#123; connect &#125; from &#39;dva&#39;;</span><br><span class=\"line\">import PropTypes from &#39;prop-types&#39;;</span><br><span class=\"line\">import componentAuth from &#39;@&#x2F;common&#x2F;ComponentAuth&#39;;</span><br><span class=\"line\">import FormSelect from &#39;@&#x2F;common&#x2F;FormItems&#x2F;FormSelect&#39;;</span><br><span class=\"line\">import FormInput from &#39;@&#x2F;common&#x2F;FormItems&#x2F;FormInput&#39;;</span><br><span class=\"line\">import FormDataPicker from &#39;@&#x2F;common&#x2F;FormItems&#x2F;FormDataPicker&#39;;</span><br><span class=\"line\">import FormCascader from &#39;@&#x2F;common&#x2F;FormItems&#x2F;FormCascader&#39;;</span><br><span class=\"line\">import FormTextArea from &#39;@&#x2F;common&#x2F;FormItems&#x2F;FormTextArea&#39;;</span><br><span class=\"line\">import FormImageUpload from &#39;@&#x2F;common&#x2F;FormItems&#x2F;FormImageUpload&#39;;</span><br><span class=\"line\">import &#123; HEADER_BASE, SEVER_URL_BASE &#125; from &#39;@&#x2F;utils&#x2F;constant&#39;;</span><br><span class=\"line\">import Col from &#39;antd&#x2F;es&#x2F;col&#39;;</span><br><span class=\"line\"></span><br><span class=\"line\">const formItemLayout &#x3D; &#123;</span><br><span class=\"line\">  labelCol: &#123;</span><br><span class=\"line\">    xs: &#123; span: 24 &#125;,</span><br><span class=\"line\">    sm: &#123; span: 5 &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  wrapperCol: &#123;</span><br><span class=\"line\">    xs: &#123; span: 24 &#125;,</span><br><span class=\"line\">    sm: &#123; span: 16 &#125;,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">const &#123; Item &#125; &#x3D; Form;</span><br><span class=\"line\">const &#123; Option &#125; &#x3D; Select;</span><br><span class=\"line\"></span><br><span class=\"line\">@connect((&#123; mIdentifyCenter &#125;) &#x3D;&gt; (&#123;</span><br><span class=\"line\">  mIdentifyCenter</span><br><span class=\"line\">&#125;))</span><br><span class=\"line\">class ModalView extends PureComponent &#123;</span><br><span class=\"line\">  state &#x3D; &#123;</span><br><span class=\"line\">    data: [],</span><br><span class=\"line\">    storeId: &#39;&#39;,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  &#x2F;&#x2F; è¿”å›title</span><br><span class=\"line\">  caseCategory &#x3D; category &#x3D;&gt; &#123;</span><br><span class=\"line\">    switch (category) &#123;</span><br><span class=\"line\">      case &#39;check&#39;:</span><br><span class=\"line\">        return &#123; title: &#39;æŸ¥çœ‹&#39; &#125;;</span><br><span class=\"line\">      case &#39;import&#39;:</span><br><span class=\"line\">        return &#123; title: &#39;å¯¼å…¥&#39;, import: true &#125;;</span><br><span class=\"line\">      case &#39;create&#39;:</span><br><span class=\"line\">        return &#123; title: &#39;æ–°å¢&#39; &#125;;</span><br><span class=\"line\">      case &#39;edit&#39;:</span><br><span class=\"line\">        return &#123; title: &#39;ç¼–è¾‘&#39; &#125;;</span><br><span class=\"line\">      default:</span><br><span class=\"line\">        return &#123; title: &#39;æŸ¥çœ‹&#39; &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  showLabel &#x3D; (type, label) &#x3D;&gt; &#123;</span><br><span class=\"line\">    const &#123; category &#125; &#x3D; this.props;</span><br><span class=\"line\"></span><br><span class=\"line\">    if (category &#x3D;&#x3D;&#x3D; &#39;search&#39;) &#123;</span><br><span class=\"line\">      if (type !&#x3D;&#x3D; &#39;datePicker&#39;) &#123;</span><br><span class=\"line\">        return undefined;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      return label;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return label;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  showRequire &#x3D; disabled &#x3D;&gt; &#123;</span><br><span class=\"line\">    const &#123; category &#125; &#x3D; this.props;</span><br><span class=\"line\">    if (category &#x3D;&#x3D;&#x3D; &#39;search&#39;) &#123;</span><br><span class=\"line\">      return false;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    if (disabled) &#123;</span><br><span class=\"line\">      return false;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return true;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  form &#x3D; () &#x3D;&gt; &#123;</span><br><span class=\"line\">    const &#123;</span><br><span class=\"line\">      form: &#123; getFieldDecorator &#125;,</span><br><span class=\"line\">      data,</span><br><span class=\"line\">      showData,</span><br><span class=\"line\">      category,</span><br><span class=\"line\">    &#125; &#x3D; this.props;</span><br><span class=\"line\"></span><br><span class=\"line\">    let ShowType;</span><br><span class=\"line\"></span><br><span class=\"line\">    return data.map(value &#x3D;&gt; &#123;</span><br><span class=\"line\">      const &#123; label, key, type, Message, option, disabled, pattern &#125; &#x3D; value;</span><br><span class=\"line\">      if (!value) &#123;</span><br><span class=\"line\">        return null;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      switch (type) &#123;</span><br><span class=\"line\">        case &#39;input&#39;:</span><br><span class=\"line\">          ShowType &#x3D; FormInput;</span><br><span class=\"line\">          break;</span><br><span class=\"line\">        case &#39;select&#39;:</span><br><span class=\"line\">          ShowType &#x3D; FormSelect;</span><br><span class=\"line\">          break;</span><br><span class=\"line\">        case &#39;datePicker&#39;:</span><br><span class=\"line\">          ShowType &#x3D; FormDataPicker;</span><br><span class=\"line\">          break;</span><br><span class=\"line\">        case &#39;cascader&#39;:</span><br><span class=\"line\">          ShowType &#x3D; FormCascader;</span><br><span class=\"line\">          showData.region &#x3D; [showData.provinceId, showData.cityId, showData.countyId];</span><br><span class=\"line\">          break;</span><br><span class=\"line\">        case &#39;textArea&#39;:</span><br><span class=\"line\">          ShowType &#x3D; FormTextArea;</span><br><span class=\"line\">          break;</span><br><span class=\"line\">        case &#39;imageUpload&#39;:</span><br><span class=\"line\">          ShowType &#x3D; FormImageUpload;</span><br><span class=\"line\">          break;</span><br><span class=\"line\">        default:</span><br><span class=\"line\">          ShowType &#x3D; null;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      return (</span><br><span class=\"line\">        &lt;Item label&#x3D;&#123;this.showLabel(type, label)&#125; key&#x3D;&#123;key&#125;&gt;</span><br><span class=\"line\">          &#123;getFieldDecorator(key, &#123;</span><br><span class=\"line\">            rules: [</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                required: this.showRequire(disabled),</span><br><span class=\"line\">                message: Message,</span><br><span class=\"line\">                pattern: pattern || undefined,</span><br><span class=\"line\">                type: type &#x3D;&#x3D;&#x3D; &#39;cascader&#39; ? &#39;array&#39; : &#39;string&#39;,</span><br><span class=\"line\">              &#125;,</span><br><span class=\"line\">            ],</span><br><span class=\"line\">            initialValue: showData[key] ? showData[key] : undefined,</span><br><span class=\"line\">          &#125;)(</span><br><span class=\"line\">            &lt;ShowType</span><br><span class=\"line\">              option&#x3D;&#123;option&#125;</span><br><span class=\"line\">              message&#x3D;&#123;Message&#125;</span><br><span class=\"line\">              disabled&#x3D;&#123;!!(disabled || category &#x3D;&#x3D;&#x3D; &#39;check&#39;)&#125;</span><br><span class=\"line\">            &#x2F;&gt;</span><br><span class=\"line\">          )&#125;</span><br><span class=\"line\">        &lt;&#x2F;Item&gt;</span><br><span class=\"line\">      );</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  checkOk &#x3D; () &#x3D;&gt; &#123;</span><br><span class=\"line\">    const &#123; onOk, form &#125; &#x3D; this.props;</span><br><span class=\"line\">    form.validateFields((err, fieldsValue) &#x3D;&gt; &#123;</span><br><span class=\"line\">      if (!err) &#123;</span><br><span class=\"line\">        onOk(fieldsValue);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  </span><br><span class=\"line\">  closeModal &#x3D; () &#x3D;&gt; &#123;</span><br><span class=\"line\">    const &#123; onCancel, form: &#123; resetFields &#125; &#125; &#x3D; this.props;</span><br><span class=\"line\">    resetFields();</span><br><span class=\"line\">    onCancel();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    const &#123; data &#125; &#x3D; this.state;</span><br><span class=\"line\">    const &#123; show, category &#x3D; &#39;&#39;, importColums, downloadUrl &#125; &#x3D; this.props;</span><br><span class=\"line\">    const modalData &#x3D; this.caseCategory(category);</span><br><span class=\"line\">    return (</span><br><span class=\"line\">      &lt;Modal</span><br><span class=\"line\">        visible&#x3D;&#123;show&#125;</span><br><span class=\"line\">        onCancel&#x3D;&#123;this.closeModal&#125;</span><br><span class=\"line\">        onOk&#x3D;&#123;category &#x3D;&#x3D;&#x3D; &#39;import&#39; ? this.importOk : this.checkOk&#125;</span><br><span class=\"line\">        title&#x3D;&#123;modalData.title&#125;</span><br><span class=\"line\">        width&#x3D;&quot;70%&quot;</span><br><span class=\"line\">        footer&#x3D;&#123;modalData.title &#x3D;&#x3D;&#x3D; &#39;æŸ¥çœ‹&#39; ? null : undefined&#125;</span><br><span class=\"line\">      &gt;</span><br><span class=\"line\">          &lt;Form style&#x3D;&#123;&#123; paddingTop: &#39;20px&#39; &#125;&#125; &#123;...formItemLayout&#125;&gt;</span><br><span class=\"line\">            &#123;this.form()&#125;</span><br><span class=\"line\">          &lt;&#x2F;Form&gt;</span><br><span class=\"line\">      &lt;&#x2F;Modal&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">ModalView.propTypes &#x3D; &#123;</span><br><span class=\"line\">  onOk: PropTypes.func.isRequired, &#x2F;&#x2F; å¼¹æ¡†ç‚¹å‡»ç¡®å®š</span><br><span class=\"line\">  onCancel: PropTypes.func.isRequired, &#x2F;&#x2F; éšè—å¼¹æ¡†</span><br><span class=\"line\">  show: PropTypes.bool, &#x2F;&#x2F; æ˜¯å¦æ˜¾ç¤ºå¼¹çª—</span><br><span class=\"line\">  category: PropTypes.string, &#x2F;&#x2F; å¼¹æ¡†çš„ç±»å‹ï¼ˆtitleæ˜¾ç¤º</span><br><span class=\"line\">  data: PropTypes.arrayOf(PropTypes.object).isRequired, &#x2F;&#x2F; æ•°æ®ç±»å‹; ä½ç½®:&#39;@&#x2F;common&#x2F;constant&#x2F;sormView.js&#39; è®°å¾—å†™æ³¨é‡Š; æ ¼å¼: &#96;s$&#123;æ–‡ä»¶å&#125;&#96;</span><br><span class=\"line\">  showData: PropTypes.object, &#x2F;&#x2F; æŸ¥çœ‹æˆ–è€…ç¼–è¾‘æ—¶çš„é»˜è®¤æ•°æ®</span><br><span class=\"line\">  importCallBack: PropTypes.func, &#x2F;&#x2F; å¯¼å…¥ä¹‹åï¼Œç‚¹å‡»ç¡®å®šçš„å›è°ƒå‡½æ•°</span><br><span class=\"line\">  importColums: PropTypes.array, &#x2F;&#x2F; å¯¼å…¥æ—¶å€™æ˜¾ç¤ºè¡¨æ ¼çš„è¡¨å¤´</span><br><span class=\"line\">  downloadUrl: PropTypes.string, &#x2F;&#x2F; ä¸‹è½½çš„æ¨¡æ¿çš„æ–‡ä»¶å</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">ModalView.defaultProps &#x3D; &#123;</span><br><span class=\"line\">  show: false,</span><br><span class=\"line\">  category: &#39;check&#39;,</span><br><span class=\"line\">  showData: &#123;&#125;,</span><br><span class=\"line\">  importCallBack: () &#x3D;&gt; &#123;&#125;,</span><br><span class=\"line\">  importColums: [],</span><br><span class=\"line\">  downloadUrl: &#39;&#39;,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">export default Form.create()(ModalView);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>FormCascader</strong></li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;*</span><br><span class=\"line\"> * @Author: Derrick </span><br><span class=\"line\"> * @Date: 2019-04-11 09:57:54 </span><br><span class=\"line\"> * @Last Modified by: Derrick</span><br><span class=\"line\"> * @Last Modified time: 2019-04-28 16:52:57</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">import React, &#123; Component &#125; from &#39;react&#39;;</span><br><span class=\"line\">import &#123; Cascader &#125; from &#39;antd&#39;;</span><br><span class=\"line\">import PropTypes from &#39;prop-types&#39;;</span><br><span class=\"line\">import regionData from &#39;@&#x2F;constant&#x2F;regionData&#39;</span><br><span class=\"line\"></span><br><span class=\"line\">class FormCascader extends Component &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  change &#x3D; (e) &#x3D;&gt; &#123;</span><br><span class=\"line\">    const &#123;onChange&#125; &#x3D; this.props;</span><br><span class=\"line\">    onChange(e)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    const &#123;value, disabled, message&#125; &#x3D; this.props;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">      &lt;Cascader placeholder&#x3D;&#123;message&#125; options&#x3D;&#123;regionData&#125; disabled&#x3D;&#123;disabled&#125; value&#x3D;&#123;value&#125; onChange&#x3D;&#123;this.change&#125; &#x2F;&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">FormCascader.propsType &#x3D; &#123;</span><br><span class=\"line\">  disabled: PropTypes.bool, &#x2F;&#x2F; æ˜¯å¦ä¸å¯é€‰</span><br><span class=\"line\">  message: PropTypes.string, &#x2F;&#x2F; é»˜è®¤æ–‡å­—ï¼ˆplaceholder</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">FormCascader.defalutProps &#x3D; &#123;</span><br><span class=\"line\">  disabled: false,</span><br><span class=\"line\">  message: &#39;&#39;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default FormCascader;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>FormDataPicker</strong></li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;*</span><br><span class=\"line\"> * @Author: Derrick </span><br><span class=\"line\"> * @Date: 2019-04-10 10:57:08 </span><br><span class=\"line\"> * @Last Modified by: Derrick</span><br><span class=\"line\"> * @Last Modified time: 2019-04-15 14:28:40</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">import React, &#123; Component &#125; from &#39;react&#39;;</span><br><span class=\"line\">import PropTypes from &#39;prop-types&#39;;</span><br><span class=\"line\">import &#123; DatePicker &#125; from &#39;antd&#39;;</span><br><span class=\"line\"></span><br><span class=\"line\">class FormDataPicker extends Component &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  change &#x3D; (e) &#x3D;&gt; &#123;</span><br><span class=\"line\">    const &#123;onChange&#125; &#x3D; this.props</span><br><span class=\"line\">    onChange(e)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    const &#123;value, disabled&#125; &#x3D; this.props;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">      &lt;DatePicker disabled&#x3D;&#123;disabled&#125; value&#x3D;&#123;value&#125; onChange&#x3D;&#123;this.change&#125; &#x2F;&gt;</span><br><span class=\"line\">      );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">FormDataPicker.propsType &#x3D; &#123;</span><br><span class=\"line\">  disabled: PropTypes.bool, &#x2F;&#x2F; æ˜¯å¦ä¸å¯é€‰</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">FormDataPicker.defalutProps &#x3D; &#123;</span><br><span class=\"line\">  disabled: false,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default FormDataPicker;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>FormImageUpload</strong></li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;*</span><br><span class=\"line\"> * @Author: Derrick </span><br><span class=\"line\"> * @Date: 2019-04-26 14:20:20 </span><br><span class=\"line\"> * @Last Modified by: Derrick</span><br><span class=\"line\"> * @Last Modified time: 2019-04-28 18:11:44</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">import React, &#123; PureComponent &#125; from &#39;react&#39;;</span><br><span class=\"line\">import &#123; Upload, Icon, message &#125; from &#39;antd&#39;;</span><br><span class=\"line\">import &#123; PICTURE_UPLOAD, HEADER_BASE &#125; from &#39;@&#x2F;utils&#x2F;constant&#39;;</span><br><span class=\"line\"></span><br><span class=\"line\">class FormImageUpload extends PureComponent &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  state &#x3D; &#123;</span><br><span class=\"line\">    loading: false,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  uploadButton &#x3D; () &#x3D;&gt; &#123;</span><br><span class=\"line\">    const &#123; loading &#125; &#x3D; this.state;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">      &lt;div&gt;</span><br><span class=\"line\">        &lt;Icon type&#x3D;&#123;loading ? &#39;loading&#39; : &#39;plus&#39;&#125; &#x2F;&gt;</span><br><span class=\"line\">        &lt;div className&#x3D;&quot;ant-upload-text&quot;&gt;Upload&lt;&#x2F;div&gt;</span><br><span class=\"line\">      &lt;&#x2F;div&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  handleChange &#x3D; (info) &#x3D;&gt; &#123;</span><br><span class=\"line\">    if (info.file.status &#x3D;&#x3D;&#x3D; &#39;uploading&#39;) &#123;</span><br><span class=\"line\">      this.setState(&#123; loading: true &#125;);</span><br><span class=\"line\">      return;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    if (info.file.status &#x3D;&#x3D;&#x3D; &#39;done&#39;) &#123;</span><br><span class=\"line\">      const &#123;onChange&#125; &#x3D; this.props</span><br><span class=\"line\">      this.setState(&#123;imageUrl: info.file.response.data[0], loading: false,&#125;)</span><br><span class=\"line\">      onChange(info.file.response.data[0])</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  beforeUpload &#x3D; (file) &#x3D;&gt; &#123;</span><br><span class=\"line\">    const isJPG &#x3D; file.type &#x3D;&#x3D;&#x3D; &#39;image&#x2F;jpeg&#39;;</span><br><span class=\"line\">    if (!isJPG) &#123;</span><br><span class=\"line\">      message.error(&#39;åªèƒ½ä¸Šä¼ JPGçš„å›¾ç‰‡!&#39;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    const isLt2M &#x3D; file.size &#x2F; 1024 &#x2F; 1024 &lt; 2;</span><br><span class=\"line\">    if (!isLt2M) &#123;</span><br><span class=\"line\">      message.error(&#39;å›¾ç‰‡å¤§å°ä¸èƒ½å¤§äº2MB!&#39;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return isJPG &amp;&amp; isLt2M;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  upLoadProps &#x3D; () &#x3D;&gt; &#123;</span><br><span class=\"line\">    HEADER_BASE.user_id &#x3D; window.sessionStorage.getItem(&#39;userId&#39;);</span><br><span class=\"line\">    HEADER_BASE.token_id &#x3D; window.sessionStorage.getItem(&#39;tokenId&#39;);</span><br><span class=\"line\">    const props &#x3D; &#123;</span><br><span class=\"line\">      name: &#39;file&#39;,</span><br><span class=\"line\">      action: PICTURE_UPLOAD,</span><br><span class=\"line\">      headers: HEADER_BASE,</span><br><span class=\"line\">      onChange: this.handleChange,</span><br><span class=\"line\">      showUploadList: false,</span><br><span class=\"line\">      beforeUpload: this.beforeUpload,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    return props;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    const &#123; imageUrl &#125; &#x3D; this.state;</span><br><span class=\"line\"></span><br><span class=\"line\">    return (</span><br><span class=\"line\">      &lt;Upload</span><br><span class=\"line\">        listType&#x3D;&quot;picture-card&quot;</span><br><span class=\"line\">        &#123;...this.upLoadProps()&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      &gt;</span><br><span class=\"line\">        &#123;imageUrl ? &lt;img src&#x3D;&#123;imageUrl&#125; alt&#x3D;&quot;avatar&quot; &#x2F;&gt; : this.uploadButton()&#125;</span><br><span class=\"line\">      &lt;&#x2F;Upload&gt;</span><br><span class=\"line\">    )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default FormImageUpload;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>FormInput</strong></li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;*</span><br><span class=\"line\"> * @Author: Derrick </span><br><span class=\"line\"> * @Date: 2019-04-10 10:57:08 </span><br><span class=\"line\"> * @Last Modified by: Derrick</span><br><span class=\"line\"> * @Last Modified time: 2019-04-15 14:46:23</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">import React, &#123; Component &#125; from &#39;react&#39;;</span><br><span class=\"line\">import &#123; Input &#125; from &#39;antd&#39;;</span><br><span class=\"line\">import PropTypes from &#39;prop-types&#39;;</span><br><span class=\"line\"></span><br><span class=\"line\">class FormInput extends Component &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  change &#x3D; (e) &#x3D;&gt; &#123;</span><br><span class=\"line\">    const &#123;onChange&#125; &#x3D; this.props;</span><br><span class=\"line\">    onChange(e)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    const &#123;message, value, disabled&#125; &#x3D; this.props;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">      &lt;Input disabled&#x3D;&#123;disabled&#125; placeholder&#x3D;&#123;message&#125; value&#x3D;&#123;value&#125; onChange&#x3D;&#123;this.change&#125; &#x2F;&gt;</span><br><span class=\"line\">      );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">FormInput.propsType &#x3D; &#123;</span><br><span class=\"line\">  disabled: PropTypes.bool, &#x2F;&#x2F; æ˜¯å¦ä¸å¯é€‰</span><br><span class=\"line\">  message: PropTypes.string, &#x2F;&#x2F; é»˜è®¤æ–‡å­—ï¼ˆplaceholder</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">FormInput.defalutProps &#x3D; &#123;</span><br><span class=\"line\">  disabled: false,</span><br><span class=\"line\">  message: &#39;&#39;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default FormInput;</span><br></pre></td></tr></table></figure>\n\n\n<ul>\n<li><strong>FormSelect</strong></li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;*</span><br><span class=\"line\"> * @Author: Derrick </span><br><span class=\"line\"> * @Date: 2019-04-10 10:13:58 </span><br><span class=\"line\"> * @Last Modified by: Derrick</span><br><span class=\"line\"> * @Last Modified time: 2019-04-28 15:59:22</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">import React, &#123; Component &#125; from &#39;react&#39;;</span><br><span class=\"line\">import &#123; Select &#125; from &#39;antd&#39;;</span><br><span class=\"line\">import PropTypes, &#123; object &#125; from &#39;prop-types&#39;;</span><br><span class=\"line\"></span><br><span class=\"line\">const &#123; Option &#125; &#x3D; Select;</span><br><span class=\"line\">class FormSelect extends Component &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  option &#x3D; () &#x3D;&gt; &#123;</span><br><span class=\"line\">    const &#123;option &#x3D; []&#125; &#x3D; this.props;</span><br><span class=\"line\">    return option.map((v) &#x3D;&gt; &#123;</span><br><span class=\"line\">      const &#123;showValue, severKey&#125; &#x3D; v;</span><br><span class=\"line\">      return &lt;Option value&#x3D;&#123;severKey&#125; key&#x3D;&#123;severKey&#125;&gt;&#123;showValue&#125;&lt;&#x2F;Option&gt;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  selectCurrency &#x3D; (e) &#x3D;&gt; &#123;</span><br><span class=\"line\">    const &#123;onChange&#125; &#x3D; this.props</span><br><span class=\"line\">    onChange(e)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    const &#123;message, value, disabled&#125; &#x3D; this.props;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">      &lt;Select disabled&#x3D;&#123;disabled&#125; value&#x3D;&#123;value&#125; placeholder&#x3D;&#123;message&#125; style&#x3D;&#123;&#123;width: &#39;170px&#39;&#125;&#125; onSelect&#x3D;&#123;this.selectCurrency&#125;&gt;</span><br><span class=\"line\">        &#123;this.option()&#125;</span><br><span class=\"line\">      &lt;&#x2F;Select&gt;    </span><br><span class=\"line\">      );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">FormSelect.propsType &#x3D; &#123;</span><br><span class=\"line\">  disabled: PropTypes.bool, &#x2F;&#x2F; æ˜¯å¦ä¸å¯é€‰</span><br><span class=\"line\">  message: PropTypes.string, &#x2F;&#x2F; é»˜è®¤æ–‡å­—ï¼ˆplaceholder</span><br><span class=\"line\">  option: PropTypes.arrayOf(object), &#x2F;&#x2F; é€‰æ‹©æ¡†çš„é€‰é¡¹</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">FormSelect.defalutProps &#x3D; &#123;</span><br><span class=\"line\">  disabled: false,</span><br><span class=\"line\">  message: &#39;&#39;,</span><br><span class=\"line\">  option: [],</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default FormSelect;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>FormTextArea</strong></li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;*</span><br><span class=\"line\"> * @Author: Derrick </span><br><span class=\"line\"> * @Date: 2019-04-23 10:20:36 </span><br><span class=\"line\"> * @Last Modified by: Derrick</span><br><span class=\"line\"> * @Last Modified time: 2019-04-23 10:21:33</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">import React, &#123; Component &#125; from &#39;react&#39;;</span><br><span class=\"line\">import &#123; Input &#125; from &#39;antd&#39;;</span><br><span class=\"line\">import PropTypes from &#39;prop-types&#39;;</span><br><span class=\"line\"></span><br><span class=\"line\">const &#123; TextArea &#125; &#x3D; Input;</span><br><span class=\"line\">class FormTextArea extends Component &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  change &#x3D; (e) &#x3D;&gt; &#123;</span><br><span class=\"line\">    const &#123;onChange&#125; &#x3D; this.props;</span><br><span class=\"line\">    onChange(e)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    const &#123;message, value, disabled&#125; &#x3D; this.props;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">      &lt;TextArea rows&#x3D;&#123;4&#125; disabled&#x3D;&#123;disabled&#125; placeholder&#x3D;&#123;message&#125; value&#x3D;&#123;value&#125; onChange&#x3D;&#123;this.change&#125; &#x2F;&gt;</span><br><span class=\"line\">      );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">FormTextArea.propsType &#x3D; &#123;</span><br><span class=\"line\">  disabled: PropTypes.bool, &#x2F;&#x2F; æ˜¯å¦ä¸å¯é€‰</span><br><span class=\"line\">  message: PropTypes.string, &#x2F;&#x2F; é»˜è®¤æ–‡å­—ï¼ˆplaceholder</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">FormTextArea.defalutProps &#x3D; &#123;</span><br><span class=\"line\">  disabled: false,</span><br><span class=\"line\">  message: &#39;&#39;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default FormTextArea;</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"æ ¸å¿ƒ\"><a href=\"#æ ¸å¿ƒ\" class=\"headerlink\" title=\"æ ¸å¿ƒ\"></a>æ ¸å¿ƒ</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const &#123;onChange&#125; &#x3D; this.props;</span><br><span class=\"line\">onChange(XX)</span><br></pre></td></tr></table></figure>\n\n\n<p>è¿™ä¸ªonChangeæ˜¯å¯ä»¥ç›´æ¥æ”¹å˜FormItemçš„å€¼ã€‚</p>\n<p>æ¥ä¸‹æ¥å¯ä»¥åŠ å…¥æ‚¨è‡ªå·±å–œæ¬¢çš„ç»„ä»¶ï¼Œéƒ½æ˜¯å¤§åŒå°å¼‚ï¼ŒåŸºæœ¬ä¸Šéƒ½ç¦»ä¸å¼€è¿™ä¸ªonChangeã€‚</p>\n<p>ä»¥ä¸Šå°±æ˜¯æœ¬äººæœ€è¿‘å°è£…çš„ä¸€ä¸ªç»„ä»¶ï¼Œæˆ‘æ„Ÿè§‰å¾ˆå¥½ç”¨æ‰€ä»¥æƒ³åˆ†äº«å‡ºæ¥ã€‚</p>\n"},{"title":"ant design pro 2.0 æ–°é¡µé¢æ¢ç´¢ umi é¡µé¢404 react","date":"2019-06-19T03:16:30.000Z","cover":"/image/cover/antdP.png","_content":"\n## å‰è¨€\n\n\t\tant design pro 2.0å‘å¸ƒäº†\n\t\n\t\tä½¿ç”¨umiä½œä¸ºè·¯ç”±é…ç½®ï¼Œå…¨è‡ªåŠ¨åŒ–ã€‚\n\n## å¼€å§‹\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/AntDesignProæ¢ç´¢/20190312150742764.png)\n\nè¿™ä¸ªæ˜¯å®˜æ–¹çš„ä»‹ç»ã€‚æ ¹æ®æç¤ºæˆ‘å¼€å§‹åŠ å…¥æˆ‘çš„è·¯ç”±\n\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/AntDesignProæ¢ç´¢/20190312151053807.png)\n\næˆ‘åœ¨æœ€åé¢å¦èµ·ä¸€è¡Œï¼ŒåŠ å…¥äº†æˆ‘çš„æ–°çš„è·¯ç”±ã€‚åå­—å«åšTestã€‚\n\ncomponentæ˜¯ä½ å…·ä½“è·¯ç”±çš„å®é™…ä½ç½®ï¼ˆæ ¹è·¯å¾„æ˜¯pagesï¼‰\n\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/AntDesignProæ¢ç´¢/20190312150929439.png)\n\nCtrl + S\n\nçœ‹æ•ˆæœï¼\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/AntDesignProæ¢ç´¢/2019031215120430.png)\n\n - èœå•æ˜¯å‡ºæ¥äº†\n - ä¸ºä»€ä¹ˆ404ï¼ï¼\n\n é€šè¿‡4ä¸ªå¤šå°æ—¶çš„googleï¼Œåœ¨è¿™ä½å…„å°çš„æŒ‡ç‚¹ä¸‹ã€‚æˆ‘çŸ¥é“äº†ã€‚\n\n\næ–°é¡µé¢è¦å†™åœ¨404ä¹‹å‰ã€‚\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/AntDesignProæ¢ç´¢/2019031215140926.png)\n\næ­£å¸¸çš„æ–°æ‰‹ï¼Œéƒ½æ˜¯åœ¨æœ€ååŠ å…¥ä¸€ä¸ªæ–°çš„è·¯ç”±ã€‚ã€‚ã€‚ä¸çŸ¥é“è¿™ä¸ªå‘çˆ¹çš„é—®é¢˜æ˜¯ä¸ºä»€ä¹ˆã€‚æˆ‘é©¬ä¸Šå»è´¨é—®äº†ä¸€ä¸‹ant design proçš„ä½œè€…ä¹‹ä¸€ã€‚å¾—åˆ°äº†è§£ç­”ï¼ï¼ï¼éå¸¸çš„æ¿€åŠ¨ï¼ï¼\n\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/AntDesignProæ¢ç´¢/2019031215175956.png)\n\n\næ‰€ä»¥æˆ‘ä»¬åªè¦åœ¨404ä¹‹å‰æ·»åŠ æ–°çš„é¡µé¢å°±å¯ä»¥äº†\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/AntDesignProæ¢ç´¢/20190312151839845.png)\n\n\nè¡¥å……ï¼š\næ˜¯å› ä¸ºReact-Routerè§„å®šçš„ã€‚","source":"_posts/ant-design-pro-2-0-æ–°é¡µé¢æ¢ç´¢-umi-é¡µé¢404-react.md","raw":"---\ntitle: ant design pro 2.0 æ–°é¡µé¢æ¢ç´¢ umi é¡µé¢404 react\ndate: 2019-06-19 11:16:30\ntags: [React-Router, UMI, Ant-Design-Pro]\ncategory: [Ant-Design-Pro]\ncover: /image/cover/antdP.png\n---\n\n## å‰è¨€\n\n\t\tant design pro 2.0å‘å¸ƒäº†\n\t\n\t\tä½¿ç”¨umiä½œä¸ºè·¯ç”±é…ç½®ï¼Œå…¨è‡ªåŠ¨åŒ–ã€‚\n\n## å¼€å§‹\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/AntDesignProæ¢ç´¢/20190312150742764.png)\n\nè¿™ä¸ªæ˜¯å®˜æ–¹çš„ä»‹ç»ã€‚æ ¹æ®æç¤ºæˆ‘å¼€å§‹åŠ å…¥æˆ‘çš„è·¯ç”±\n\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/AntDesignProæ¢ç´¢/20190312151053807.png)\n\næˆ‘åœ¨æœ€åé¢å¦èµ·ä¸€è¡Œï¼ŒåŠ å…¥äº†æˆ‘çš„æ–°çš„è·¯ç”±ã€‚åå­—å«åšTestã€‚\n\ncomponentæ˜¯ä½ å…·ä½“è·¯ç”±çš„å®é™…ä½ç½®ï¼ˆæ ¹è·¯å¾„æ˜¯pagesï¼‰\n\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/AntDesignProæ¢ç´¢/20190312150929439.png)\n\nCtrl + S\n\nçœ‹æ•ˆæœï¼\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/AntDesignProæ¢ç´¢/2019031215120430.png)\n\n - èœå•æ˜¯å‡ºæ¥äº†\n - ä¸ºä»€ä¹ˆ404ï¼ï¼\n\n é€šè¿‡4ä¸ªå¤šå°æ—¶çš„googleï¼Œåœ¨è¿™ä½å…„å°çš„æŒ‡ç‚¹ä¸‹ã€‚æˆ‘çŸ¥é“äº†ã€‚\n\n\næ–°é¡µé¢è¦å†™åœ¨404ä¹‹å‰ã€‚\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/AntDesignProæ¢ç´¢/2019031215140926.png)\n\næ­£å¸¸çš„æ–°æ‰‹ï¼Œéƒ½æ˜¯åœ¨æœ€ååŠ å…¥ä¸€ä¸ªæ–°çš„è·¯ç”±ã€‚ã€‚ã€‚ä¸çŸ¥é“è¿™ä¸ªå‘çˆ¹çš„é—®é¢˜æ˜¯ä¸ºä»€ä¹ˆã€‚æˆ‘é©¬ä¸Šå»è´¨é—®äº†ä¸€ä¸‹ant design proçš„ä½œè€…ä¹‹ä¸€ã€‚å¾—åˆ°äº†è§£ç­”ï¼ï¼ï¼éå¸¸çš„æ¿€åŠ¨ï¼ï¼\n\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/AntDesignProæ¢ç´¢/2019031215175956.png)\n\n\næ‰€ä»¥æˆ‘ä»¬åªè¦åœ¨404ä¹‹å‰æ·»åŠ æ–°çš„é¡µé¢å°±å¯ä»¥äº†\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/AntDesignProæ¢ç´¢/20190312151839845.png)\n\n\nè¡¥å……ï¼š\næ˜¯å› ä¸ºReact-Routerè§„å®šçš„ã€‚","slug":"ant-design-pro-2-0-æ–°é¡µé¢æ¢ç´¢-umi-é¡µé¢404-react","published":1,"updated":"2021-06-24T14:00:06.848Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra7y000plwrd3tbg7sno","content":"<h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><pre><code>ant design pro 2.0å‘å¸ƒäº†\n\nä½¿ç”¨umiä½œä¸ºè·¯ç”±é…ç½®ï¼Œå…¨è‡ªåŠ¨åŒ–ã€‚</code></pre><h2 id=\"å¼€å§‹\"><a href=\"#å¼€å§‹\" class=\"headerlink\" title=\"å¼€å§‹\"></a>å¼€å§‹</h2><p><img src=\"/\" class=\"lazyload\" data-src=\"/image/AntDesignPro%E6%8E%A2%E7%B4%A2/20190312150742764.png\"  alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<p>è¿™ä¸ªæ˜¯å®˜æ–¹çš„ä»‹ç»ã€‚æ ¹æ®æç¤ºæˆ‘å¼€å§‹åŠ å…¥æˆ‘çš„è·¯ç”±</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/AntDesignPro%E6%8E%A2%E7%B4%A2/20190312151053807.png\"  alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<p>æˆ‘åœ¨æœ€åé¢å¦èµ·ä¸€è¡Œï¼ŒåŠ å…¥äº†æˆ‘çš„æ–°çš„è·¯ç”±ã€‚åå­—å«åšTestã€‚</p>\n<p>componentæ˜¯ä½ å…·ä½“è·¯ç”±çš„å®é™…ä½ç½®ï¼ˆæ ¹è·¯å¾„æ˜¯pagesï¼‰</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/AntDesignPro%E6%8E%A2%E7%B4%A2/20190312150929439.png\"  alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<p>Ctrl + S</p>\n<p>çœ‹æ•ˆæœï¼</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/AntDesignPro%E6%8E%A2%E7%B4%A2/2019031215120430.png\"  alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<ul>\n<li><p>èœå•æ˜¯å‡ºæ¥äº†</p>\n</li>\n<li><p>ä¸ºä»€ä¹ˆ404ï¼ï¼</p>\n<p>é€šè¿‡4ä¸ªå¤šå°æ—¶çš„googleï¼Œåœ¨è¿™ä½å…„å°çš„æŒ‡ç‚¹ä¸‹ã€‚æˆ‘çŸ¥é“äº†ã€‚</p>\n</li>\n</ul>\n<p>æ–°é¡µé¢è¦å†™åœ¨404ä¹‹å‰ã€‚</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/AntDesignPro%E6%8E%A2%E7%B4%A2/2019031215140926.png\"  alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<p>æ­£å¸¸çš„æ–°æ‰‹ï¼Œéƒ½æ˜¯åœ¨æœ€ååŠ å…¥ä¸€ä¸ªæ–°çš„è·¯ç”±ã€‚ã€‚ã€‚ä¸çŸ¥é“è¿™ä¸ªå‘çˆ¹çš„é—®é¢˜æ˜¯ä¸ºä»€ä¹ˆã€‚æˆ‘é©¬ä¸Šå»è´¨é—®äº†ä¸€ä¸‹ant design proçš„ä½œè€…ä¹‹ä¸€ã€‚å¾—åˆ°äº†è§£ç­”ï¼ï¼ï¼éå¸¸çš„æ¿€åŠ¨ï¼ï¼</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/AntDesignPro%E6%8E%A2%E7%B4%A2/2019031215175956.png\"  alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<p>æ‰€ä»¥æˆ‘ä»¬åªè¦åœ¨404ä¹‹å‰æ·»åŠ æ–°çš„é¡µé¢å°±å¯ä»¥äº†</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/AntDesignPro%E6%8E%A2%E7%B4%A2/20190312151839845.png\"  alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<p>è¡¥å……ï¼š<br>æ˜¯å› ä¸ºReact-Routerè§„å®šçš„ã€‚</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><pre><code>ant design pro 2.0å‘å¸ƒäº†\n\nä½¿ç”¨umiä½œä¸ºè·¯ç”±é…ç½®ï¼Œå…¨è‡ªåŠ¨åŒ–ã€‚</code></pre><h2 id=\"å¼€å§‹\"><a href=\"#å¼€å§‹\" class=\"headerlink\" title=\"å¼€å§‹\"></a>å¼€å§‹</h2><p><img src=\"/image/AntDesignPro%E6%8E%A2%E7%B4%A2/20190312150742764.png\" alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<p>è¿™ä¸ªæ˜¯å®˜æ–¹çš„ä»‹ç»ã€‚æ ¹æ®æç¤ºæˆ‘å¼€å§‹åŠ å…¥æˆ‘çš„è·¯ç”±</p>\n<p><img src=\"/image/AntDesignPro%E6%8E%A2%E7%B4%A2/20190312151053807.png\" alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<p>æˆ‘åœ¨æœ€åé¢å¦èµ·ä¸€è¡Œï¼ŒåŠ å…¥äº†æˆ‘çš„æ–°çš„è·¯ç”±ã€‚åå­—å«åšTestã€‚</p>\n<p>componentæ˜¯ä½ å…·ä½“è·¯ç”±çš„å®é™…ä½ç½®ï¼ˆæ ¹è·¯å¾„æ˜¯pagesï¼‰</p>\n<p><img src=\"/image/AntDesignPro%E6%8E%A2%E7%B4%A2/20190312150929439.png\" alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<p>Ctrl + S</p>\n<p>çœ‹æ•ˆæœï¼</p>\n<p><img src=\"/image/AntDesignPro%E6%8E%A2%E7%B4%A2/2019031215120430.png\" alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<ul>\n<li><p>èœå•æ˜¯å‡ºæ¥äº†</p>\n</li>\n<li><p>ä¸ºä»€ä¹ˆ404ï¼ï¼</p>\n<p>é€šè¿‡4ä¸ªå¤šå°æ—¶çš„googleï¼Œåœ¨è¿™ä½å…„å°çš„æŒ‡ç‚¹ä¸‹ã€‚æˆ‘çŸ¥é“äº†ã€‚</p>\n</li>\n</ul>\n<p>æ–°é¡µé¢è¦å†™åœ¨404ä¹‹å‰ã€‚</p>\n<p><img src=\"/image/AntDesignPro%E6%8E%A2%E7%B4%A2/2019031215140926.png\" alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<p>æ­£å¸¸çš„æ–°æ‰‹ï¼Œéƒ½æ˜¯åœ¨æœ€ååŠ å…¥ä¸€ä¸ªæ–°çš„è·¯ç”±ã€‚ã€‚ã€‚ä¸çŸ¥é“è¿™ä¸ªå‘çˆ¹çš„é—®é¢˜æ˜¯ä¸ºä»€ä¹ˆã€‚æˆ‘é©¬ä¸Šå»è´¨é—®äº†ä¸€ä¸‹ant design proçš„ä½œè€…ä¹‹ä¸€ã€‚å¾—åˆ°äº†è§£ç­”ï¼ï¼ï¼éå¸¸çš„æ¿€åŠ¨ï¼ï¼</p>\n<p><img src=\"/image/AntDesignPro%E6%8E%A2%E7%B4%A2/2019031215175956.png\" alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<p>æ‰€ä»¥æˆ‘ä»¬åªè¦åœ¨404ä¹‹å‰æ·»åŠ æ–°çš„é¡µé¢å°±å¯ä»¥äº†</p>\n<p><img src=\"/image/AntDesignPro%E6%8E%A2%E7%B4%A2/20190312151839845.png\" alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<p>è¡¥å……ï¼š<br>æ˜¯å› ä¸ºReact-Routerè§„å®šçš„ã€‚</p>\n"},{"title":"chunk 0 [mini-css-extract-plugin] è§£å†³ CSS Modules è­¦å‘Š","date":"2019-06-29T02:38:06.000Z","cover":"/image/cover/css.png","_content":"\n## å‰è¨€\nå‰ä¸¤å‘¨ï¼Œç”¨å…¬å¸çš„CIéƒ¨ç½²çš„æ—¶å€™ï¼Œå‘ç°![](/image/CSSModulesè­¦å‘Š/aHR0cDovL2kyLnRpaW1nLmNvbS82OTE2NDMvMmVmODNhMzcxNjA4OWEwZS5wbmc.jpeg)\nå¾ˆé²œæ˜çš„ERRï¼\nå…¶å®è¿™ä¸ªè¿™ä¸ªåªæ˜¯ä¸€ä¸ªwarningã€‚ä½†æ˜¯ç”±äºç¯å¢ƒå˜é‡ï¼ˆprocess.env.ci === trueï¼‰ã€‚æ‰€ä»¥è¿™ä¸ªwarningè¢«è½¬åŒ–æˆäº†errorï¼Œå¯¼è‡´äº†ç¼–è¯‘å¤±è´¥ã€‚ä¸€èˆ¬çš„CIæœåŠ¡å™¨ä¼šè‡ªåŠ¨å°†è¿™ä¸ªè¿™è®¾ç½®ä¸ºtrueã€‚\n\n## è§£å†³æ–¹æ¡ˆ\nå› ä¸ºçŸ¥é“äº†åŸå› ï¼Œæ‰€ä»¥è§£å†³æ–¹æ¡ˆæœ‰ä»¥ä¸‹ä¸¤ä¸ª\n\n - ä¿®å¤è¿™ä¸ªwarningã€‚\n - è®©è¿ç»´å°å“¥å“¥å¸®å¿™æŠŠè¿™ä¸ªç¯å¢ƒå˜é‡è®¾ç½®ä¸ºfalseã€‚\n\næœ¬ç€æ¢å¯»çš„å¿ƒã€‚æˆ‘å¼€å§‹äº†googleï¼Œbaiduã€‚\næˆ‘æŸ¥äº†æ•´æ•´ä¸¤å¤©ã€‚\n\nå…¶å®è¿™äº›ä¸œè¥¿å¯èƒ½ä½¿ç”¨webpackçš„ä¸€äº›é…ç½®å°±æ”¹å®Œäº†ã€‚ä½†æ˜¯ç”±äºæˆ‘ä½¿ç”¨çš„æ˜¯`react-app-rewired`ã€‚\n[ant design mobile](https://mobile.ant.design/docs/react/use-with-create-react-app-cn)\nå…·ä½“æƒ³äº†è§£çš„å¯ä»¥è‡ªå·±å»äº†è§£ã€‚æˆ‘ä»¬è¨€å½’æ­£ä¼ ã€‚\n\n## æ¢ç´¢\næˆ‘å¼€å§‹æ‰¾å„ç§â€œäººâ€çš„æ¯›ç—…\n`lessï¼Œsassï¼Œless-loaderï¼Œnode-sassï¼Œpostcss-px2rem` ç­‰ç­‰ã€‚æˆ‘å‡ ä¹å§package.jsoné‡Œé¢çš„ä¸œè¥¿éƒ½è¯•äº†ä¸€éï¼Œä¸ç®¡æ˜¯æœ€æ–°çš„ï¼Œæˆ–è€…æ˜¯æˆ‘æŸ¥è¯¢çš„è¿‡ç¨‹ä¸­æœ‰æåˆ°äº†ï¼Œæˆ‘å‡çº§æˆ–è€…é™çº§ä¸ºå›ºå®šç‰ˆæœ¬ã€‚\næ— æœï¼\n\n![ä¸€ä¸ªissue](/image/CSSModulesè­¦å‘Š/aHR0cDovL2kxLmZ1aW1nLmNvbS82OTE2NDMvMGM4ZDhiNjZlMGNmZTY0Ny5wbmc.jpeg)\n\nä»–çš„å¤§è‡´æ„æ€æ˜¯ï¼ŒCSSæ›´åŠ å…³æ³¨åŠ è½½é¡ºåºï¼ŒOK\næˆ‘æŠŠæˆ‘çš„é¡¹ç›®æ‰€æœ‰çš„CSSåŠ è½½é¡ºåºæ”¹æˆäº†ä¸€è‡´ï¼ˆå…¶å®æ ¹æœ¬æ²¡æœ‰åŠ è½½ä¸¤ä¸ªä»¥ä¸ŠCSSçš„åœ°æ–¹ï¼Œæˆ‘åªæ˜¯æŠŠä»–ä»¬éƒ½æ”¾åˆ°æœ€åä¸€è¡Œimportï¼‰\n\n\nè¿˜æ˜¯ç¿»è½¦äº†ã€‚ä½†æ˜¯ç»™äº†æˆ‘å¾ˆå¤§çš„å¯å‘ã€‚\n\næˆ‘å¼€å§‹å…³æ³¨åŸç†ã€‚çœ‹æŠ¥é”™çš„å†…å®¹ã€‚\n\nå‡ ä¹éƒ½æ˜¯å’ŒAnt Design Mobilç›¸å…³çš„ã€‚\n\næˆ‘æƒ³åˆ°äº†æˆ‘å‡ ä¹æ‰€æœ‰çš„é¡µé¢éƒ½æ˜¯å‡ ä¹ä¸€ä¸ªæˆ‘è‡ªå·±å†™çš„ç»„ä»¶`<PageContainer>`\n\n![PageContainer](/image/CSSModulesè­¦å‘Š/aHR0cDovL2kxLmZ1aW1nLmNvbS82OTE2NDMvZWIwYzBmODU2NDE0OGZjMC5wbmc.jpeg)\n\nåœ¨è¿™é‡Œæˆ‘ç”¨åˆ°äº†Ant Design Mobileçš„ç»„ä»¶ã€‚\næˆ‘å°è¯•æŠŠè¿™é‡Œçš„ç»„ä»¶å…¨éƒ¨åˆ é™¤ã€‚ç„¶ååœ¨æœ¬åœ°buildã€‚\n\nç«Ÿç„¶æˆåŠŸäº†ï¼\n\nå¾ˆæ˜æ˜¾ï¼Œé—®é¢˜å‡ºåœ¨äº†æˆ‘è¿™ä¸ªå…±ç”¨ç»„ä»¶å¤´ä¸Šã€‚æˆ‘å¼€å§‹ç ”ç©¶ä»–ã€‚\n\næœ€åæˆ‘å‘ç°ï¼Œåªè¦åœ¨æˆ‘çš„è¿™ä¸ªç»„ä»¶é‡Œé¢çš„ç»„ä»¶ç›´æ¥ç”¨åˆ°äº†Ant Design Mobileçš„ç»„ä»¶å°±ä¼šæŠ¥å‡ºCSS Moduleçš„è­¦å‘Šã€‚\n\nåœ¨Ant Design çš„issuesé‡Œé¢æˆ‘å‘ç°ï¼Œä¹Ÿæœ‰äººæœ‰è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯ä¹Ÿæœ‰äººè¯´æ˜äº†åŸå› ã€‚\n\næˆ‘ä¸ªäººçš„ç†è§£æ˜¯è¿™æ ·çš„ï¼šå› ä¸ºAnt Design å†…éƒ¨ä¹Ÿåšäº†CSSçš„æŒ‰éœ€åŠ è½½ã€‚å¯¼è‡´æˆ‘ä»¬å¼•ç”¨ç»„ä»¶çš„æ—¶å€™ï¼Œå¾ˆå®¹æ˜“é€ æˆCSSå¼•å…¥é¡ºåºçš„ä¸ä¸€è‡´ã€‚\n\nç„¶åæˆ‘æƒ³å‡ºäº†è§£å†³æ–¹æ¡ˆï¼Œå°†æˆ‘æ‰€æœ‰çš„ç»„ä»¶ï¼Œæˆ–è€…è¯´å­ç»„ä»¶ï¼Œå…¨éƒ¨å°è£…åˆ°å­™å­ç»„ä»¶ä¸­ã€‚å°±å¯ä»¥è§£å†³äº†\n\n![å­ç»„ä»¶](/image/CSSModulesè­¦å‘Š/aHR0cDovL2kxLmZ1aW1nLmNvbS82OTE2NDMvODU2M2ZjOGJhZTU1ODI3Yy5wbmc.jpeg)\n\næœ€åï¼Œé¢„çº¦çš„çœ‹åˆ°äº†\n\n![ç¼–è¯‘æˆåŠŸ](/image/CSSModulesè­¦å‘Š/aHR0cDovL2kxLmZ1aW1nLmNvbS82OTE2NDMvYTkxMmI1YzhlNTk3YTYzYy5wbmc.jpeg)","source":"_posts/chunk-0-mini-css-extract-plugin-è§£å†³-CSS-Modules-è­¦å‘Š.md","raw":"---\ntitle: 'chunk 0 [mini-css-extract-plugin] è§£å†³ CSS Modules è­¦å‘Š'\ndate: 2019-06-29 10:38:06\ntags: [CSS-Module]\ncategory: [CSS]\ncover: /image/cover/css.png\n---\n\n## å‰è¨€\nå‰ä¸¤å‘¨ï¼Œç”¨å…¬å¸çš„CIéƒ¨ç½²çš„æ—¶å€™ï¼Œå‘ç°![](/image/CSSModulesè­¦å‘Š/aHR0cDovL2kyLnRpaW1nLmNvbS82OTE2NDMvMmVmODNhMzcxNjA4OWEwZS5wbmc.jpeg)\nå¾ˆé²œæ˜çš„ERRï¼\nå…¶å®è¿™ä¸ªè¿™ä¸ªåªæ˜¯ä¸€ä¸ªwarningã€‚ä½†æ˜¯ç”±äºç¯å¢ƒå˜é‡ï¼ˆprocess.env.ci === trueï¼‰ã€‚æ‰€ä»¥è¿™ä¸ªwarningè¢«è½¬åŒ–æˆäº†errorï¼Œå¯¼è‡´äº†ç¼–è¯‘å¤±è´¥ã€‚ä¸€èˆ¬çš„CIæœåŠ¡å™¨ä¼šè‡ªåŠ¨å°†è¿™ä¸ªè¿™è®¾ç½®ä¸ºtrueã€‚\n\n## è§£å†³æ–¹æ¡ˆ\nå› ä¸ºçŸ¥é“äº†åŸå› ï¼Œæ‰€ä»¥è§£å†³æ–¹æ¡ˆæœ‰ä»¥ä¸‹ä¸¤ä¸ª\n\n - ä¿®å¤è¿™ä¸ªwarningã€‚\n - è®©è¿ç»´å°å“¥å“¥å¸®å¿™æŠŠè¿™ä¸ªç¯å¢ƒå˜é‡è®¾ç½®ä¸ºfalseã€‚\n\næœ¬ç€æ¢å¯»çš„å¿ƒã€‚æˆ‘å¼€å§‹äº†googleï¼Œbaiduã€‚\næˆ‘æŸ¥äº†æ•´æ•´ä¸¤å¤©ã€‚\n\nå…¶å®è¿™äº›ä¸œè¥¿å¯èƒ½ä½¿ç”¨webpackçš„ä¸€äº›é…ç½®å°±æ”¹å®Œäº†ã€‚ä½†æ˜¯ç”±äºæˆ‘ä½¿ç”¨çš„æ˜¯`react-app-rewired`ã€‚\n[ant design mobile](https://mobile.ant.design/docs/react/use-with-create-react-app-cn)\nå…·ä½“æƒ³äº†è§£çš„å¯ä»¥è‡ªå·±å»äº†è§£ã€‚æˆ‘ä»¬è¨€å½’æ­£ä¼ ã€‚\n\n## æ¢ç´¢\næˆ‘å¼€å§‹æ‰¾å„ç§â€œäººâ€çš„æ¯›ç—…\n`lessï¼Œsassï¼Œless-loaderï¼Œnode-sassï¼Œpostcss-px2rem` ç­‰ç­‰ã€‚æˆ‘å‡ ä¹å§package.jsoné‡Œé¢çš„ä¸œè¥¿éƒ½è¯•äº†ä¸€éï¼Œä¸ç®¡æ˜¯æœ€æ–°çš„ï¼Œæˆ–è€…æ˜¯æˆ‘æŸ¥è¯¢çš„è¿‡ç¨‹ä¸­æœ‰æåˆ°äº†ï¼Œæˆ‘å‡çº§æˆ–è€…é™çº§ä¸ºå›ºå®šç‰ˆæœ¬ã€‚\næ— æœï¼\n\n![ä¸€ä¸ªissue](/image/CSSModulesè­¦å‘Š/aHR0cDovL2kxLmZ1aW1nLmNvbS82OTE2NDMvMGM4ZDhiNjZlMGNmZTY0Ny5wbmc.jpeg)\n\nä»–çš„å¤§è‡´æ„æ€æ˜¯ï¼ŒCSSæ›´åŠ å…³æ³¨åŠ è½½é¡ºåºï¼ŒOK\næˆ‘æŠŠæˆ‘çš„é¡¹ç›®æ‰€æœ‰çš„CSSåŠ è½½é¡ºåºæ”¹æˆäº†ä¸€è‡´ï¼ˆå…¶å®æ ¹æœ¬æ²¡æœ‰åŠ è½½ä¸¤ä¸ªä»¥ä¸ŠCSSçš„åœ°æ–¹ï¼Œæˆ‘åªæ˜¯æŠŠä»–ä»¬éƒ½æ”¾åˆ°æœ€åä¸€è¡Œimportï¼‰\n\n\nè¿˜æ˜¯ç¿»è½¦äº†ã€‚ä½†æ˜¯ç»™äº†æˆ‘å¾ˆå¤§çš„å¯å‘ã€‚\n\næˆ‘å¼€å§‹å…³æ³¨åŸç†ã€‚çœ‹æŠ¥é”™çš„å†…å®¹ã€‚\n\nå‡ ä¹éƒ½æ˜¯å’ŒAnt Design Mobilç›¸å…³çš„ã€‚\n\næˆ‘æƒ³åˆ°äº†æˆ‘å‡ ä¹æ‰€æœ‰çš„é¡µé¢éƒ½æ˜¯å‡ ä¹ä¸€ä¸ªæˆ‘è‡ªå·±å†™çš„ç»„ä»¶`<PageContainer>`\n\n![PageContainer](/image/CSSModulesè­¦å‘Š/aHR0cDovL2kxLmZ1aW1nLmNvbS82OTE2NDMvZWIwYzBmODU2NDE0OGZjMC5wbmc.jpeg)\n\nåœ¨è¿™é‡Œæˆ‘ç”¨åˆ°äº†Ant Design Mobileçš„ç»„ä»¶ã€‚\næˆ‘å°è¯•æŠŠè¿™é‡Œçš„ç»„ä»¶å…¨éƒ¨åˆ é™¤ã€‚ç„¶ååœ¨æœ¬åœ°buildã€‚\n\nç«Ÿç„¶æˆåŠŸäº†ï¼\n\nå¾ˆæ˜æ˜¾ï¼Œé—®é¢˜å‡ºåœ¨äº†æˆ‘è¿™ä¸ªå…±ç”¨ç»„ä»¶å¤´ä¸Šã€‚æˆ‘å¼€å§‹ç ”ç©¶ä»–ã€‚\n\næœ€åæˆ‘å‘ç°ï¼Œåªè¦åœ¨æˆ‘çš„è¿™ä¸ªç»„ä»¶é‡Œé¢çš„ç»„ä»¶ç›´æ¥ç”¨åˆ°äº†Ant Design Mobileçš„ç»„ä»¶å°±ä¼šæŠ¥å‡ºCSS Moduleçš„è­¦å‘Šã€‚\n\nåœ¨Ant Design çš„issuesé‡Œé¢æˆ‘å‘ç°ï¼Œä¹Ÿæœ‰äººæœ‰è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯ä¹Ÿæœ‰äººè¯´æ˜äº†åŸå› ã€‚\n\næˆ‘ä¸ªäººçš„ç†è§£æ˜¯è¿™æ ·çš„ï¼šå› ä¸ºAnt Design å†…éƒ¨ä¹Ÿåšäº†CSSçš„æŒ‰éœ€åŠ è½½ã€‚å¯¼è‡´æˆ‘ä»¬å¼•ç”¨ç»„ä»¶çš„æ—¶å€™ï¼Œå¾ˆå®¹æ˜“é€ æˆCSSå¼•å…¥é¡ºåºçš„ä¸ä¸€è‡´ã€‚\n\nç„¶åæˆ‘æƒ³å‡ºäº†è§£å†³æ–¹æ¡ˆï¼Œå°†æˆ‘æ‰€æœ‰çš„ç»„ä»¶ï¼Œæˆ–è€…è¯´å­ç»„ä»¶ï¼Œå…¨éƒ¨å°è£…åˆ°å­™å­ç»„ä»¶ä¸­ã€‚å°±å¯ä»¥è§£å†³äº†\n\n![å­ç»„ä»¶](/image/CSSModulesè­¦å‘Š/aHR0cDovL2kxLmZ1aW1nLmNvbS82OTE2NDMvODU2M2ZjOGJhZTU1ODI3Yy5wbmc.jpeg)\n\næœ€åï¼Œé¢„çº¦çš„çœ‹åˆ°äº†\n\n![ç¼–è¯‘æˆåŠŸ](/image/CSSModulesè­¦å‘Š/aHR0cDovL2kxLmZ1aW1nLmNvbS82OTE2NDMvYTkxMmI1YzhlNTk3YTYzYy5wbmc.jpeg)","slug":"chunk-0-mini-css-extract-plugin-è§£å†³-CSS-Modules-è­¦å‘Š","published":1,"updated":"2021-06-24T14:00:06.848Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra7z000tlwrd4qd2htwb","content":"<h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><p>å‰ä¸¤å‘¨ï¼Œç”¨å…¬å¸çš„CIéƒ¨ç½²çš„æ—¶å€™ï¼Œå‘ç°<img src=\"/\" class=\"lazyload\" data-src=\"/image/CSSModules%E8%AD%A6%E5%91%8A/aHR0cDovL2kyLnRpaW1nLmNvbS82OTE2NDMvMmVmODNhMzcxNjA4OWEwZS5wbmc.jpeg\"  alt=\"\"><br>å¾ˆé²œæ˜çš„ERRï¼<br>å…¶å®è¿™ä¸ªè¿™ä¸ªåªæ˜¯ä¸€ä¸ªwarningã€‚ä½†æ˜¯ç”±äºç¯å¢ƒå˜é‡ï¼ˆprocess.env.ci === trueï¼‰ã€‚æ‰€ä»¥è¿™ä¸ªwarningè¢«è½¬åŒ–æˆäº†errorï¼Œå¯¼è‡´äº†ç¼–è¯‘å¤±è´¥ã€‚ä¸€èˆ¬çš„CIæœåŠ¡å™¨ä¼šè‡ªåŠ¨å°†è¿™ä¸ªè¿™è®¾ç½®ä¸ºtrueã€‚</p>\n<h2 id=\"è§£å†³æ–¹æ¡ˆ\"><a href=\"#è§£å†³æ–¹æ¡ˆ\" class=\"headerlink\" title=\"è§£å†³æ–¹æ¡ˆ\"></a>è§£å†³æ–¹æ¡ˆ</h2><p>å› ä¸ºçŸ¥é“äº†åŸå› ï¼Œæ‰€ä»¥è§£å†³æ–¹æ¡ˆæœ‰ä»¥ä¸‹ä¸¤ä¸ª</p>\n<ul>\n<li>ä¿®å¤è¿™ä¸ªwarningã€‚</li>\n<li>è®©è¿ç»´å°å“¥å“¥å¸®å¿™æŠŠè¿™ä¸ªç¯å¢ƒå˜é‡è®¾ç½®ä¸ºfalseã€‚</li>\n</ul>\n<p>æœ¬ç€æ¢å¯»çš„å¿ƒã€‚æˆ‘å¼€å§‹äº†googleï¼Œbaiduã€‚<br>æˆ‘æŸ¥äº†æ•´æ•´ä¸¤å¤©ã€‚</p>\n<p>å…¶å®è¿™äº›ä¸œè¥¿å¯èƒ½ä½¿ç”¨webpackçš„ä¸€äº›é…ç½®å°±æ”¹å®Œäº†ã€‚ä½†æ˜¯ç”±äºæˆ‘ä½¿ç”¨çš„æ˜¯<code>react-app-rewired</code>ã€‚<br><a href=\"https://mobile.ant.design/docs/react/use-with-create-react-app-cn\" target=\"_blank\" rel=\"noopener\">ant design mobile</a><br>å…·ä½“æƒ³äº†è§£çš„å¯ä»¥è‡ªå·±å»äº†è§£ã€‚æˆ‘ä»¬è¨€å½’æ­£ä¼ ã€‚</p>\n<h2 id=\"æ¢ç´¢\"><a href=\"#æ¢ç´¢\" class=\"headerlink\" title=\"æ¢ç´¢\"></a>æ¢ç´¢</h2><p>æˆ‘å¼€å§‹æ‰¾å„ç§â€œäººâ€çš„æ¯›ç—…<br><code>lessï¼Œsassï¼Œless-loaderï¼Œnode-sassï¼Œpostcss-px2rem</code> ç­‰ç­‰ã€‚æˆ‘å‡ ä¹å§package.jsoné‡Œé¢çš„ä¸œè¥¿éƒ½è¯•äº†ä¸€éï¼Œä¸ç®¡æ˜¯æœ€æ–°çš„ï¼Œæˆ–è€…æ˜¯æˆ‘æŸ¥è¯¢çš„è¿‡ç¨‹ä¸­æœ‰æåˆ°äº†ï¼Œæˆ‘å‡çº§æˆ–è€…é™çº§ä¸ºå›ºå®šç‰ˆæœ¬ã€‚<br>æ— æœï¼</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/CSSModules%E8%AD%A6%E5%91%8A/aHR0cDovL2kxLmZ1aW1nLmNvbS82OTE2NDMvMGM4ZDhiNjZlMGNmZTY0Ny5wbmc.jpeg\"  alt=\"ä¸€ä¸ªissue\"></p>\n<p>ä»–çš„å¤§è‡´æ„æ€æ˜¯ï¼ŒCSSæ›´åŠ å…³æ³¨åŠ è½½é¡ºåºï¼ŒOK<br>æˆ‘æŠŠæˆ‘çš„é¡¹ç›®æ‰€æœ‰çš„CSSåŠ è½½é¡ºåºæ”¹æˆäº†ä¸€è‡´ï¼ˆå…¶å®æ ¹æœ¬æ²¡æœ‰åŠ è½½ä¸¤ä¸ªä»¥ä¸ŠCSSçš„åœ°æ–¹ï¼Œæˆ‘åªæ˜¯æŠŠä»–ä»¬éƒ½æ”¾åˆ°æœ€åä¸€è¡Œimportï¼‰</p>\n<p>è¿˜æ˜¯ç¿»è½¦äº†ã€‚ä½†æ˜¯ç»™äº†æˆ‘å¾ˆå¤§çš„å¯å‘ã€‚</p>\n<p>æˆ‘å¼€å§‹å…³æ³¨åŸç†ã€‚çœ‹æŠ¥é”™çš„å†…å®¹ã€‚</p>\n<p>å‡ ä¹éƒ½æ˜¯å’ŒAnt Design Mobilç›¸å…³çš„ã€‚</p>\n<p>æˆ‘æƒ³åˆ°äº†æˆ‘å‡ ä¹æ‰€æœ‰çš„é¡µé¢éƒ½æ˜¯å‡ ä¹ä¸€ä¸ªæˆ‘è‡ªå·±å†™çš„ç»„ä»¶<code>&lt;PageContainer&gt;</code></p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/CSSModules%E8%AD%A6%E5%91%8A/aHR0cDovL2kxLmZ1aW1nLmNvbS82OTE2NDMvZWIwYzBmODU2NDE0OGZjMC5wbmc.jpeg\"  alt=\"PageContainer\"></p>\n<p>åœ¨è¿™é‡Œæˆ‘ç”¨åˆ°äº†Ant Design Mobileçš„ç»„ä»¶ã€‚<br>æˆ‘å°è¯•æŠŠè¿™é‡Œçš„ç»„ä»¶å…¨éƒ¨åˆ é™¤ã€‚ç„¶ååœ¨æœ¬åœ°buildã€‚</p>\n<p>ç«Ÿç„¶æˆåŠŸäº†ï¼</p>\n<p>å¾ˆæ˜æ˜¾ï¼Œé—®é¢˜å‡ºåœ¨äº†æˆ‘è¿™ä¸ªå…±ç”¨ç»„ä»¶å¤´ä¸Šã€‚æˆ‘å¼€å§‹ç ”ç©¶ä»–ã€‚</p>\n<p>æœ€åæˆ‘å‘ç°ï¼Œåªè¦åœ¨æˆ‘çš„è¿™ä¸ªç»„ä»¶é‡Œé¢çš„ç»„ä»¶ç›´æ¥ç”¨åˆ°äº†Ant Design Mobileçš„ç»„ä»¶å°±ä¼šæŠ¥å‡ºCSS Moduleçš„è­¦å‘Šã€‚</p>\n<p>åœ¨Ant Design çš„issuesé‡Œé¢æˆ‘å‘ç°ï¼Œä¹Ÿæœ‰äººæœ‰è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯ä¹Ÿæœ‰äººè¯´æ˜äº†åŸå› ã€‚</p>\n<p>æˆ‘ä¸ªäººçš„ç†è§£æ˜¯è¿™æ ·çš„ï¼šå› ä¸ºAnt Design å†…éƒ¨ä¹Ÿåšäº†CSSçš„æŒ‰éœ€åŠ è½½ã€‚å¯¼è‡´æˆ‘ä»¬å¼•ç”¨ç»„ä»¶çš„æ—¶å€™ï¼Œå¾ˆå®¹æ˜“é€ æˆCSSå¼•å…¥é¡ºåºçš„ä¸ä¸€è‡´ã€‚</p>\n<p>ç„¶åæˆ‘æƒ³å‡ºäº†è§£å†³æ–¹æ¡ˆï¼Œå°†æˆ‘æ‰€æœ‰çš„ç»„ä»¶ï¼Œæˆ–è€…è¯´å­ç»„ä»¶ï¼Œå…¨éƒ¨å°è£…åˆ°å­™å­ç»„ä»¶ä¸­ã€‚å°±å¯ä»¥è§£å†³äº†</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/CSSModules%E8%AD%A6%E5%91%8A/aHR0cDovL2kxLmZ1aW1nLmNvbS82OTE2NDMvODU2M2ZjOGJhZTU1ODI3Yy5wbmc.jpeg\"  alt=\"å­ç»„ä»¶\"></p>\n<p>æœ€åï¼Œé¢„çº¦çš„çœ‹åˆ°äº†</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/CSSModules%E8%AD%A6%E5%91%8A/aHR0cDovL2kxLmZ1aW1nLmNvbS82OTE2NDMvYTkxMmI1YzhlNTk3YTYzYy5wbmc.jpeg\"  alt=\"ç¼–è¯‘æˆåŠŸ\"></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><p>å‰ä¸¤å‘¨ï¼Œç”¨å…¬å¸çš„CIéƒ¨ç½²çš„æ—¶å€™ï¼Œå‘ç°<img src=\"/image/CSSModules%E8%AD%A6%E5%91%8A/aHR0cDovL2kyLnRpaW1nLmNvbS82OTE2NDMvMmVmODNhMzcxNjA4OWEwZS5wbmc.jpeg\" alt=\"\"><br>å¾ˆé²œæ˜çš„ERRï¼<br>å…¶å®è¿™ä¸ªè¿™ä¸ªåªæ˜¯ä¸€ä¸ªwarningã€‚ä½†æ˜¯ç”±äºç¯å¢ƒå˜é‡ï¼ˆprocess.env.ci === trueï¼‰ã€‚æ‰€ä»¥è¿™ä¸ªwarningè¢«è½¬åŒ–æˆäº†errorï¼Œå¯¼è‡´äº†ç¼–è¯‘å¤±è´¥ã€‚ä¸€èˆ¬çš„CIæœåŠ¡å™¨ä¼šè‡ªåŠ¨å°†è¿™ä¸ªè¿™è®¾ç½®ä¸ºtrueã€‚</p>\n<h2 id=\"è§£å†³æ–¹æ¡ˆ\"><a href=\"#è§£å†³æ–¹æ¡ˆ\" class=\"headerlink\" title=\"è§£å†³æ–¹æ¡ˆ\"></a>è§£å†³æ–¹æ¡ˆ</h2><p>å› ä¸ºçŸ¥é“äº†åŸå› ï¼Œæ‰€ä»¥è§£å†³æ–¹æ¡ˆæœ‰ä»¥ä¸‹ä¸¤ä¸ª</p>\n<ul>\n<li>ä¿®å¤è¿™ä¸ªwarningã€‚</li>\n<li>è®©è¿ç»´å°å“¥å“¥å¸®å¿™æŠŠè¿™ä¸ªç¯å¢ƒå˜é‡è®¾ç½®ä¸ºfalseã€‚</li>\n</ul>\n<p>æœ¬ç€æ¢å¯»çš„å¿ƒã€‚æˆ‘å¼€å§‹äº†googleï¼Œbaiduã€‚<br>æˆ‘æŸ¥äº†æ•´æ•´ä¸¤å¤©ã€‚</p>\n<p>å…¶å®è¿™äº›ä¸œè¥¿å¯èƒ½ä½¿ç”¨webpackçš„ä¸€äº›é…ç½®å°±æ”¹å®Œäº†ã€‚ä½†æ˜¯ç”±äºæˆ‘ä½¿ç”¨çš„æ˜¯<code>react-app-rewired</code>ã€‚<br><a href=\"https://mobile.ant.design/docs/react/use-with-create-react-app-cn\" target=\"_blank\" rel=\"noopener\">ant design mobile</a><br>å…·ä½“æƒ³äº†è§£çš„å¯ä»¥è‡ªå·±å»äº†è§£ã€‚æˆ‘ä»¬è¨€å½’æ­£ä¼ ã€‚</p>\n<h2 id=\"æ¢ç´¢\"><a href=\"#æ¢ç´¢\" class=\"headerlink\" title=\"æ¢ç´¢\"></a>æ¢ç´¢</h2><p>æˆ‘å¼€å§‹æ‰¾å„ç§â€œäººâ€çš„æ¯›ç—…<br><code>lessï¼Œsassï¼Œless-loaderï¼Œnode-sassï¼Œpostcss-px2rem</code> ç­‰ç­‰ã€‚æˆ‘å‡ ä¹å§package.jsoné‡Œé¢çš„ä¸œè¥¿éƒ½è¯•äº†ä¸€éï¼Œä¸ç®¡æ˜¯æœ€æ–°çš„ï¼Œæˆ–è€…æ˜¯æˆ‘æŸ¥è¯¢çš„è¿‡ç¨‹ä¸­æœ‰æåˆ°äº†ï¼Œæˆ‘å‡çº§æˆ–è€…é™çº§ä¸ºå›ºå®šç‰ˆæœ¬ã€‚<br>æ— æœï¼</p>\n<p><img src=\"/image/CSSModules%E8%AD%A6%E5%91%8A/aHR0cDovL2kxLmZ1aW1nLmNvbS82OTE2NDMvMGM4ZDhiNjZlMGNmZTY0Ny5wbmc.jpeg\" alt=\"ä¸€ä¸ªissue\"></p>\n<p>ä»–çš„å¤§è‡´æ„æ€æ˜¯ï¼ŒCSSæ›´åŠ å…³æ³¨åŠ è½½é¡ºåºï¼ŒOK<br>æˆ‘æŠŠæˆ‘çš„é¡¹ç›®æ‰€æœ‰çš„CSSåŠ è½½é¡ºåºæ”¹æˆäº†ä¸€è‡´ï¼ˆå…¶å®æ ¹æœ¬æ²¡æœ‰åŠ è½½ä¸¤ä¸ªä»¥ä¸ŠCSSçš„åœ°æ–¹ï¼Œæˆ‘åªæ˜¯æŠŠä»–ä»¬éƒ½æ”¾åˆ°æœ€åä¸€è¡Œimportï¼‰</p>\n<p>è¿˜æ˜¯ç¿»è½¦äº†ã€‚ä½†æ˜¯ç»™äº†æˆ‘å¾ˆå¤§çš„å¯å‘ã€‚</p>\n<p>æˆ‘å¼€å§‹å…³æ³¨åŸç†ã€‚çœ‹æŠ¥é”™çš„å†…å®¹ã€‚</p>\n<p>å‡ ä¹éƒ½æ˜¯å’ŒAnt Design Mobilç›¸å…³çš„ã€‚</p>\n<p>æˆ‘æƒ³åˆ°äº†æˆ‘å‡ ä¹æ‰€æœ‰çš„é¡µé¢éƒ½æ˜¯å‡ ä¹ä¸€ä¸ªæˆ‘è‡ªå·±å†™çš„ç»„ä»¶<code>&lt;PageContainer&gt;</code></p>\n<p><img src=\"/image/CSSModules%E8%AD%A6%E5%91%8A/aHR0cDovL2kxLmZ1aW1nLmNvbS82OTE2NDMvZWIwYzBmODU2NDE0OGZjMC5wbmc.jpeg\" alt=\"PageContainer\"></p>\n<p>åœ¨è¿™é‡Œæˆ‘ç”¨åˆ°äº†Ant Design Mobileçš„ç»„ä»¶ã€‚<br>æˆ‘å°è¯•æŠŠè¿™é‡Œçš„ç»„ä»¶å…¨éƒ¨åˆ é™¤ã€‚ç„¶ååœ¨æœ¬åœ°buildã€‚</p>\n<p>ç«Ÿç„¶æˆåŠŸäº†ï¼</p>\n<p>å¾ˆæ˜æ˜¾ï¼Œé—®é¢˜å‡ºåœ¨äº†æˆ‘è¿™ä¸ªå…±ç”¨ç»„ä»¶å¤´ä¸Šã€‚æˆ‘å¼€å§‹ç ”ç©¶ä»–ã€‚</p>\n<p>æœ€åæˆ‘å‘ç°ï¼Œåªè¦åœ¨æˆ‘çš„è¿™ä¸ªç»„ä»¶é‡Œé¢çš„ç»„ä»¶ç›´æ¥ç”¨åˆ°äº†Ant Design Mobileçš„ç»„ä»¶å°±ä¼šæŠ¥å‡ºCSS Moduleçš„è­¦å‘Šã€‚</p>\n<p>åœ¨Ant Design çš„issuesé‡Œé¢æˆ‘å‘ç°ï¼Œä¹Ÿæœ‰äººæœ‰è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯ä¹Ÿæœ‰äººè¯´æ˜äº†åŸå› ã€‚</p>\n<p>æˆ‘ä¸ªäººçš„ç†è§£æ˜¯è¿™æ ·çš„ï¼šå› ä¸ºAnt Design å†…éƒ¨ä¹Ÿåšäº†CSSçš„æŒ‰éœ€åŠ è½½ã€‚å¯¼è‡´æˆ‘ä»¬å¼•ç”¨ç»„ä»¶çš„æ—¶å€™ï¼Œå¾ˆå®¹æ˜“é€ æˆCSSå¼•å…¥é¡ºåºçš„ä¸ä¸€è‡´ã€‚</p>\n<p>ç„¶åæˆ‘æƒ³å‡ºäº†è§£å†³æ–¹æ¡ˆï¼Œå°†æˆ‘æ‰€æœ‰çš„ç»„ä»¶ï¼Œæˆ–è€…è¯´å­ç»„ä»¶ï¼Œå…¨éƒ¨å°è£…åˆ°å­™å­ç»„ä»¶ä¸­ã€‚å°±å¯ä»¥è§£å†³äº†</p>\n<p><img src=\"/image/CSSModules%E8%AD%A6%E5%91%8A/aHR0cDovL2kxLmZ1aW1nLmNvbS82OTE2NDMvODU2M2ZjOGJhZTU1ODI3Yy5wbmc.jpeg\" alt=\"å­ç»„ä»¶\"></p>\n<p>æœ€åï¼Œé¢„çº¦çš„çœ‹åˆ°äº†</p>\n<p><img src=\"/image/CSSModules%E8%AD%A6%E5%91%8A/aHR0cDovL2kxLmZ1aW1nLmNvbS82OTE2NDMvYTkxMmI1YzhlNTk3YTYzYy5wbmc.jpeg\" alt=\"ç¼–è¯‘æˆåŠŸ\"></p>\n"},{"title":"sessionå’Œcookieçš„ç†è§£","date":"2020-04-11T02:31:35.000Z","cover":"/image/cover/http.png","_content":"\n\n## æ›¾ç»çš„æˆ‘\n\ncookieæ˜¯æµè§ˆå™¨ä¸­ä¼ è¾“è‡ªå¸¦çš„; balabala...\n\nsessionæ˜¯å­˜åœ¨æœåŠ¡ç«¯çš„; å­˜ä¸€äº›ç”¨æˆ·ä¿¡æ¯.......balabala....\n\n## ç°åœ¨çš„æˆ‘\n\nä»ä»¥ä¸‹å‡ ä¸ªè§’åº¦å‡ºå‘\n\n### ä¸€. httpåè®®æ˜¯æ— çŠ¶æ€çš„;\n\nå½“æˆ‘ä»¬å¼€å‘ä¸€äº›å¯¹çŠ¶æ€æœ‰è¦æ±‚çš„æ¥å£æ—¶, cookieå’Œsessionå°±å¯ä»¥å¼¥è¡¥è¿™ä¸€å—çš„ä¸è¶³\n\n- å¯¹äºhttpåè®®, cookieåªæ˜¯è¯·æ±‚å¤´ä¸­çš„ä¸€ä¸ªå­—æ®µ, å’Œåˆ«çš„å­—æ®µå¹¶æ²¡æœ‰ç‰¹åˆ«å¤§çš„å·®åˆ«;\n- æµè§ˆå™¨å¯¹cookieåšäº†é»˜è®¤çš„æ”¯æŒ, ä½†æ˜¯ä¹Ÿé™åˆ¶äº†cookie; æ¯”å¦‚åŒæºç­–ç•¥;\n  - ä»€ä¹ˆæ˜¯åŒæºç­–ç•¥?\n    - åŒæºç­–ç•¥å°±æ˜¯åŸŸå, ç«¯å£, åè®®; å¿…é¡»éƒ½ç›¸åŒæ‰å¯ä»¥è®¿é—®cookieçš„å†…å®¹\n  - ä¸ºä»€ä¹ˆè¦åšåŒæºç­–ç•¥?\n    - åŒæºç­–ç•¥æ˜¯æµè§ˆå™¨åŸºäºå®‰å…¨çš„è§’åº¦çš„ä¸€ä¸ªæœºåˆ¶, é™åˆ¶äº†åªæœ‰åŒåŸŸæ‰å¯ä»¥è®¿é—®cookieçš„å†…å®¹\n\n### äºŒ.å½“æˆ‘ä»¬è¦åšå•ç‚¹ç™»å½•ssoåŠŸèƒ½çš„æ—¶å€™\n\n- ä»€ä¹ˆæ˜¯å•ç‚¹ç™»å½•å’Œsso?\n  - å•ç‚¹ç™»å½•ï¼ˆSingle Sign Onï¼‰ï¼Œç®€ç§°ä¸º SSOï¼Œæ˜¯æ¯”è¾ƒæµè¡Œçš„ä¼ä¸šä¸šåŠ¡æ•´åˆçš„è§£å†³æ–¹æ¡ˆä¹‹ä¸€ã€‚\n  - æœ€ç®€å•çš„ä¾‹å­å°±æ˜¯, æˆ‘ä»¬æ˜¯æ‰“å¼€æ·˜å®ç½‘çš„æ—¶å€™, æˆ‘ä»¬æ‰“å¼€ä¸€ä¸ªå•†å“è¯¦æƒ…é¡µæœ‰å¯èƒ½æ˜¯æ˜¯é‡æ–°æ‰“å¼€ä¸€ä¸ªé¡µé¢, é‚£æˆ‘ä»¬åˆšåˆšç™»å½•çš„ä¿¡æ¯å¯èƒ½å°±æ¶ˆå¤±äº†, è¦æ˜¯æ¯æ¬¡æ‰“å¼€ä¸€ä¸ªé¡µé¢éƒ½éœ€è¦ç™»å½•é‚£æ ·ä¼šéå¸¸çš„éº»çƒ¦\n    - è¿™æ ·æ—¶å€™, å°±éœ€è¦cookieçš„å¸®åŠ©äº†;æˆ‘ä»¬å¯ä»¥è€ƒè™‘å§åŸŸåç§åœ¨å¯ä»¥è®¿é—®çš„åŸŸåä¸‹, é€šå¸¸éƒ½æ˜¯äºŒçº§åŸŸå\n      - ä»€ä¹ˆæ˜¯ä¸€çº§, äºŒçº§, ä¸‰çº§....åŸŸå?\n      - ä¸¾ä¾‹: www.taobao.com\n        - ä¸€çº§åŸŸåæ˜¯æŒ‡com(åˆç§°é¡¶çº§åŸŸå; [ç»´åŸºç™¾ç§‘, ç‚¹æˆ‘!!](https://zh.wikipedia.org/wiki/åŸŸå)\n        - äºŒçº§åŸŸåå°±æ˜¯taobao\n        - æ‰€ä»¥ä¸‰çº§åŸŸåå°±æ˜¯www\n    - è¿™æ ·æˆ‘ä»¬åœ¨æ·˜å®è¿™ä¸ªåŸŸååº•ä¸‹çš„æ‰€æœ‰é¡µé¢éƒ½å¯ä»¥ç•…é€šæ— é˜»\n    - ä½†æ˜¯ä¹Ÿä¼šé¢ä¸´ä¿¡æ¯æ³„éœ²çš„å±é™©\n      - è™½ç„¶å¯ä»¥ç”¨æ—¶æ•ˆæ¥é™åˆ¶ä½†æ˜¯æ•ˆæœä¹Ÿä¸æ˜¯å¾ˆå¥½\n      - **Secure Cookieæœºåˆ¶**\n        - è®¾ç½®äº†cookieåªèƒ½åœ¨httpsä¸Šé¢ä¼ è¾“ä¸èƒ½åœ¨httpä¸Šä¼ è¾“\n        - ä½†æ˜¯ä¹Ÿä¸æ˜¯ä¸‡æ— ä¸€å¤±, å› ä¸ºè¿˜æ˜¯å¯ä»¥åœ¨å®¢æˆ·ç«¯, è¿›è¡Œè¯»å†™çš„;\n      - **HTTPOnlyå±æ€§**\n        - Cookieçš„HttpOnlyå±æ€§ï¼ŒæŒ‡æµè§ˆå™¨ä¸è¦åœ¨é™¤HTTPï¼ˆå’Œ HTTPS)è¯·æ±‚ä¹‹å¤–æš´éœ²Cookieã€‚\n        - è¿™æ ·å¯ä»¥é˜»æ­¢éhttpçš„æ”»å‡», å¦‚JavaScript\n      - **Same-Siteå±æ€§**\n        - Cookie çš„`SameSite`å±æ€§ç”¨æ¥é™åˆ¶ç¬¬ä¸‰æ–¹ Cookieï¼Œä»è€Œå‡å°‘å®‰å…¨é£é™©ã€‚\n          - ä¸»è¦æ˜¯ä¸ºäº†é™åˆ¶CSRFæ”»å‡»\n            - ä»€ä¹ˆæ˜¯CSRFæ”»å‡»?\n              - è·¨ç«™è¯·æ±‚æ”»å‡»ï¼Œç®€å•åœ°è¯´ï¼Œæ˜¯æ”»å‡»è€…é€šè¿‡ä¸€äº›æŠ€æœ¯æ‰‹æ®µæ¬ºéª—ç”¨æˆ·çš„æµè§ˆå™¨å»è®¿é—®ä¸€ä¸ªè‡ªå·±æ›¾ç»è®¤è¯è¿‡çš„ç½‘ç«™å¹¶è¿è¡Œä¸€äº›æ“ä½œï¼ˆå¦‚å‘é‚®ä»¶ï¼Œå‘æ¶ˆæ¯ï¼Œç”šè‡³è´¢äº§æ“ä½œå¦‚è½¬è´¦å’Œè´­ä¹°å•†å“ï¼‰ã€‚\n            - è¿˜å¯ä»¥ç”¨äºè·Ÿè¸ªç”¨æˆ·ä¿¡æ¯, æ¯”å¦‚åœ¨ä½ çš„ç½‘ç«™å†…éƒ¨æ”¾å…¥ä¸€ä¸ªä½ çœ‹ä¸è§çš„\n            - `<img src=\"facebook.com\" style=\"visibility:hidden;\">`\n            - è¿™æ ·å°±å¯ä»¥çŸ¥é“ä½ è®¿é—®äº†é‚£äº›ç½‘ç«™åšä¸€äº›ç›¸åº”çš„æ¨è\n            - é‚£ä¹ˆæœ‰äº›åŒå­¦å°±ä¼šè”æƒ³åˆ°; æ¯”å¦‚æˆ‘åœ¨æ‹¼å¤šå¤šçœ‹äº†iPhone11; å†å»çœ‹æœ‹å‹åœˆå¾ˆå¯èƒ½æœ‰å°±ç›¸åº”çš„æ¨è, è¿™äº›æˆ‘ä¸ªäººçŒœæµ‹å¯èƒ½æ˜¯pddç›´æ¥æŠŠä½ çš„ä¿¡æ¯å–ç»™äº†è…¾è®¯, æˆ–è€…åšäº†äº¤æ˜“(é€ƒ\n          - å…·ä½“çš„ä¸‰ä¸ªå€¼Strict; Lax; None;æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªå·±å»æŸ¥è¿™é‡Œå°±ä¸å±•å¼€äº†\n      - cookieåˆåˆ†ä¸ºæœ¬åœ°cookieå’Œå†…å­˜cookie\n        - æœ¬åœ°cookieä¸å†…å­˜cookieï¼ŒåŒºåˆ«åœ¨äºcookieè®¾ç½®çš„expireså­—æ®µã€‚å¦‚æœæ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå°±æ˜¯å†…å­˜cookieã€‚éšç€æµè§ˆå™¨çš„å…³é—­è€Œä»å†…å­˜ä¸­æ¶ˆå¤±ã€‚\n        - è¿˜æ˜¯ä¸€æ ·éƒ½ä¼šæ³„éœ²ç”¨æˆ·ä¿¡æ¯çš„é£é™©\n        - å“ªæ€•æ˜¯å†…å­˜cookieæ”»å‡»è€…å¯ä»¥è®¾ç½®æ—¶æ•ˆä½¿å…¶æˆä¸ºæœ¬åœ°cookie\n\n### ä¸‰.session\n\nsessionæ˜¯æœåŠ¡å™¨ä¸ºwebç”¨æˆ·ç‹¬ç«‹å¼€è¾Ÿçš„ä¸€ä¸ªç©ºé—´, é‡Œé¢å¯ä»¥æœ‰ç”¨æˆ·ä¸€äº›ä¿¡æ¯ç­‰ç­‰\n\n- å¦‚æœæ˜¯ä¸€ä¸ªæœåŠ¡å™¨å¯èƒ½è¿˜å¥½, ä½†æ˜¯å¦‚æœæ˜¯å¤šä¸ªæœåŠ¡å™¨æˆ–è€…è¯´å¤šå±‚è½¬å‘çš„è¯å°±ä¼šå¼•å‘ä¸€ä¸ªé—®é¢˜, sessionå‘½ä¸­é—®é¢˜; æ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠä¿¡æ¯å­˜åœ¨MySQLæˆ–è€…Redisé‡Œé¢\n\n### å››.token\n\né™¤äº†sessionå’Œcookieæ¥è¾…åŠ©httpè¿™ä¸ªæ— çŠ¶æ€è¯·æ±‚, è¿˜æœ‰ä»€ä¹ˆåŠæ³•? \n\n- token\n  - tokenåˆ†ä¸ºå¾ˆå¤šç§, å¸¸è§çš„æœ‰JWT, sessionId, macåœ°å€ç­‰ç­‰\n  - tokenå¯ä»¥å­˜å‚¨åœ¨å¾ˆå¤šåœ°æ–¹, æ¯”å¦‚æœ¬åœ°çš„localStorageæˆ–è€…sessionStorage, ç„¶ååœ¨è¯·æ±‚å¤´ä¸­æºå¸¦\n\n### äº”.sessionStorage\n\nåˆšåˆšè¯´åˆ°sessionStorage; ä¸‹é¢æ¥è¯´è¯´æˆ‘ç¢°åˆ°çš„ä¸€ä¸ªé—®é¢˜\n\n- sessionStorageå¦‚æœæ‰“å¼€ä¸€ä¸ªæ–°æ ‡ç­¾é¡µ, ä»–çš„sessionStorageæ˜¯å¦å…±äº«?\n- å¤§å®¶å…ˆæƒ³æƒ³å†çœ‹ç­”æ¡ˆ\n\nä»¥å‰çš„æˆ‘ä»¥ä¸ºæ˜¯å¯ä»¥å…±äº«çš„.å…¶å®æ˜¯åŠé”™åŠå¯¹çš„\n\nä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´?\n\nMDNæ˜¯è¿™ä¹ˆè¯´çš„\n\n> ...data stored in sessionStorage gets cleared when the page session ends...**Opening a page in a new tab or window will cause a new session to be initiated**, which differs from how session cookies work.\n\nå¤§å®¶å¯ä»¥åšä¸€ä¸ªå®éªŒ\n\n>1. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€è¿™ä¸ª index.htmlï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºæ ‡ç­¾é¡µ Aã€‚æ³¨æ„ï¼šéœ€è¦ç”¨ http åè®®æ‰“å¼€ï¼ä¾‹å¦‚ http://localhost/index.html\n>2. ç‚¹å‡»é¡µé¢ä¸Šçš„é“¾æ¥ï¼Œæ­¤æ—¶ä¼šå¼¹å‡ºæ¥æ ‡ç­¾é¡µ Bã€‚\n>3. åœ¨æ ‡ç­¾é¡µ B ä¸­æ‰“å¼€æ§åˆ¶å°å¹¶æ‰§è¡Œ `sessionStorage.getItem('j')`ï¼Œå¾—åˆ° `'s'`\n>4. æ–°å»ºä¸€ä¸ªæ–°æ ‡ç­¾é¡µ Dï¼Œç„¶ååœ¨åœ°å€æ å†…è¾“å…¥ http://localhost/index.html æ‰“å¼€åŒæ ·çš„é¡µé¢ï¼Œ ç„¶åæ‰§è¡Œ `sessionStorage.getItem('j')` ã€‚\n\næŒ‰ç…§æˆ‘çš„é¢„æœŸï¼Œæ ‡ç­¾é¡µ D å¾—åˆ°çš„åº”è¯¥è¿˜æ˜¯ `'s'`ï¼Œæ¯•ç«Ÿæˆ‘è®¤ä¸º sessionStorage çš„æ•°æ®æ˜¯åœ¨åŒä¸€ç½‘ç«™çš„å¤šä¸ªæ ‡ç­¾é¡µä¹‹é—´å…±äº«çš„ã€‚ä½†æ˜¯**æˆ‘é”™äº†**ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯ `null`ã€‚\n\nç»†å¿ƒçš„åŒå­¦å¯èƒ½å·²ç»å‘ç°äº†\n\nç»†å¿ƒçš„åŒå­¦å¯èƒ½å·²ç»å‘ç°äº†ï¼Œæ ‡ç­¾é¡µ B å’Œæ ‡ç­¾é¡µ D ä¹‹é—´å”¯ä¸€çš„ä¸åŒå°±æ˜¯å®ƒä»¬è¢«æ‰“å¼€çš„æ–¹å¼ï¼š**æ ‡ç­¾é¡µ B æ˜¯é€šè¿‡åœ¨æ ‡ç­¾é¡µ A ä¸­ç‚¹å‡»é“¾æ¥æ‰“å¼€çš„ï¼Œä½†æ ‡ç­¾é¡µ D æ˜¯åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥åœ°å€æ‰“å¼€çš„ã€‚**\n\næ‰€ä»¥ç°åœ¨æˆ‘æ˜ç™½äº†ï¼šé€šè¿‡ç‚¹å‡»é“¾æ¥ï¼ˆæˆ–è€…ç”¨äº† `window.open`ï¼‰æ‰“å¼€çš„æ–°æ ‡ç­¾é¡µä¹‹é—´æ˜¯å±äºåŒä¸€ä¸ª session çš„ï¼Œä½†æ–°å¼€ä¸€ä¸ªæ ‡ç­¾é¡µæ€»æ˜¯ä¼šåˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ sessionï¼Œå³ä½¿ç½‘ç«™æ˜¯ä¸€æ ·çš„ï¼Œå®ƒä»¬ä¹Ÿä¸å±äºåŒä¸€ä¸ª sessionã€‚\n\n","source":"_posts/sessionå’Œcookieçš„ç†è§£.md","raw":"---\ntitle: sessionå’Œcookieçš„ç†è§£\ndate: 2020-04-11 10:31:35\ntags: [HTTP]\ncategories: [HTTP]\ncover: /image/cover/http.png\n\n---\n\n\n## æ›¾ç»çš„æˆ‘\n\ncookieæ˜¯æµè§ˆå™¨ä¸­ä¼ è¾“è‡ªå¸¦çš„; balabala...\n\nsessionæ˜¯å­˜åœ¨æœåŠ¡ç«¯çš„; å­˜ä¸€äº›ç”¨æˆ·ä¿¡æ¯.......balabala....\n\n## ç°åœ¨çš„æˆ‘\n\nä»ä»¥ä¸‹å‡ ä¸ªè§’åº¦å‡ºå‘\n\n### ä¸€. httpåè®®æ˜¯æ— çŠ¶æ€çš„;\n\nå½“æˆ‘ä»¬å¼€å‘ä¸€äº›å¯¹çŠ¶æ€æœ‰è¦æ±‚çš„æ¥å£æ—¶, cookieå’Œsessionå°±å¯ä»¥å¼¥è¡¥è¿™ä¸€å—çš„ä¸è¶³\n\n- å¯¹äºhttpåè®®, cookieåªæ˜¯è¯·æ±‚å¤´ä¸­çš„ä¸€ä¸ªå­—æ®µ, å’Œåˆ«çš„å­—æ®µå¹¶æ²¡æœ‰ç‰¹åˆ«å¤§çš„å·®åˆ«;\n- æµè§ˆå™¨å¯¹cookieåšäº†é»˜è®¤çš„æ”¯æŒ, ä½†æ˜¯ä¹Ÿé™åˆ¶äº†cookie; æ¯”å¦‚åŒæºç­–ç•¥;\n  - ä»€ä¹ˆæ˜¯åŒæºç­–ç•¥?\n    - åŒæºç­–ç•¥å°±æ˜¯åŸŸå, ç«¯å£, åè®®; å¿…é¡»éƒ½ç›¸åŒæ‰å¯ä»¥è®¿é—®cookieçš„å†…å®¹\n  - ä¸ºä»€ä¹ˆè¦åšåŒæºç­–ç•¥?\n    - åŒæºç­–ç•¥æ˜¯æµè§ˆå™¨åŸºäºå®‰å…¨çš„è§’åº¦çš„ä¸€ä¸ªæœºåˆ¶, é™åˆ¶äº†åªæœ‰åŒåŸŸæ‰å¯ä»¥è®¿é—®cookieçš„å†…å®¹\n\n### äºŒ.å½“æˆ‘ä»¬è¦åšå•ç‚¹ç™»å½•ssoåŠŸèƒ½çš„æ—¶å€™\n\n- ä»€ä¹ˆæ˜¯å•ç‚¹ç™»å½•å’Œsso?\n  - å•ç‚¹ç™»å½•ï¼ˆSingle Sign Onï¼‰ï¼Œç®€ç§°ä¸º SSOï¼Œæ˜¯æ¯”è¾ƒæµè¡Œçš„ä¼ä¸šä¸šåŠ¡æ•´åˆçš„è§£å†³æ–¹æ¡ˆä¹‹ä¸€ã€‚\n  - æœ€ç®€å•çš„ä¾‹å­å°±æ˜¯, æˆ‘ä»¬æ˜¯æ‰“å¼€æ·˜å®ç½‘çš„æ—¶å€™, æˆ‘ä»¬æ‰“å¼€ä¸€ä¸ªå•†å“è¯¦æƒ…é¡µæœ‰å¯èƒ½æ˜¯æ˜¯é‡æ–°æ‰“å¼€ä¸€ä¸ªé¡µé¢, é‚£æˆ‘ä»¬åˆšåˆšç™»å½•çš„ä¿¡æ¯å¯èƒ½å°±æ¶ˆå¤±äº†, è¦æ˜¯æ¯æ¬¡æ‰“å¼€ä¸€ä¸ªé¡µé¢éƒ½éœ€è¦ç™»å½•é‚£æ ·ä¼šéå¸¸çš„éº»çƒ¦\n    - è¿™æ ·æ—¶å€™, å°±éœ€è¦cookieçš„å¸®åŠ©äº†;æˆ‘ä»¬å¯ä»¥è€ƒè™‘å§åŸŸåç§åœ¨å¯ä»¥è®¿é—®çš„åŸŸåä¸‹, é€šå¸¸éƒ½æ˜¯äºŒçº§åŸŸå\n      - ä»€ä¹ˆæ˜¯ä¸€çº§, äºŒçº§, ä¸‰çº§....åŸŸå?\n      - ä¸¾ä¾‹: www.taobao.com\n        - ä¸€çº§åŸŸåæ˜¯æŒ‡com(åˆç§°é¡¶çº§åŸŸå; [ç»´åŸºç™¾ç§‘, ç‚¹æˆ‘!!](https://zh.wikipedia.org/wiki/åŸŸå)\n        - äºŒçº§åŸŸåå°±æ˜¯taobao\n        - æ‰€ä»¥ä¸‰çº§åŸŸåå°±æ˜¯www\n    - è¿™æ ·æˆ‘ä»¬åœ¨æ·˜å®è¿™ä¸ªåŸŸååº•ä¸‹çš„æ‰€æœ‰é¡µé¢éƒ½å¯ä»¥ç•…é€šæ— é˜»\n    - ä½†æ˜¯ä¹Ÿä¼šé¢ä¸´ä¿¡æ¯æ³„éœ²çš„å±é™©\n      - è™½ç„¶å¯ä»¥ç”¨æ—¶æ•ˆæ¥é™åˆ¶ä½†æ˜¯æ•ˆæœä¹Ÿä¸æ˜¯å¾ˆå¥½\n      - **Secure Cookieæœºåˆ¶**\n        - è®¾ç½®äº†cookieåªèƒ½åœ¨httpsä¸Šé¢ä¼ è¾“ä¸èƒ½åœ¨httpä¸Šä¼ è¾“\n        - ä½†æ˜¯ä¹Ÿä¸æ˜¯ä¸‡æ— ä¸€å¤±, å› ä¸ºè¿˜æ˜¯å¯ä»¥åœ¨å®¢æˆ·ç«¯, è¿›è¡Œè¯»å†™çš„;\n      - **HTTPOnlyå±æ€§**\n        - Cookieçš„HttpOnlyå±æ€§ï¼ŒæŒ‡æµè§ˆå™¨ä¸è¦åœ¨é™¤HTTPï¼ˆå’Œ HTTPS)è¯·æ±‚ä¹‹å¤–æš´éœ²Cookieã€‚\n        - è¿™æ ·å¯ä»¥é˜»æ­¢éhttpçš„æ”»å‡», å¦‚JavaScript\n      - **Same-Siteå±æ€§**\n        - Cookie çš„`SameSite`å±æ€§ç”¨æ¥é™åˆ¶ç¬¬ä¸‰æ–¹ Cookieï¼Œä»è€Œå‡å°‘å®‰å…¨é£é™©ã€‚\n          - ä¸»è¦æ˜¯ä¸ºäº†é™åˆ¶CSRFæ”»å‡»\n            - ä»€ä¹ˆæ˜¯CSRFæ”»å‡»?\n              - è·¨ç«™è¯·æ±‚æ”»å‡»ï¼Œç®€å•åœ°è¯´ï¼Œæ˜¯æ”»å‡»è€…é€šè¿‡ä¸€äº›æŠ€æœ¯æ‰‹æ®µæ¬ºéª—ç”¨æˆ·çš„æµè§ˆå™¨å»è®¿é—®ä¸€ä¸ªè‡ªå·±æ›¾ç»è®¤è¯è¿‡çš„ç½‘ç«™å¹¶è¿è¡Œä¸€äº›æ“ä½œï¼ˆå¦‚å‘é‚®ä»¶ï¼Œå‘æ¶ˆæ¯ï¼Œç”šè‡³è´¢äº§æ“ä½œå¦‚è½¬è´¦å’Œè´­ä¹°å•†å“ï¼‰ã€‚\n            - è¿˜å¯ä»¥ç”¨äºè·Ÿè¸ªç”¨æˆ·ä¿¡æ¯, æ¯”å¦‚åœ¨ä½ çš„ç½‘ç«™å†…éƒ¨æ”¾å…¥ä¸€ä¸ªä½ çœ‹ä¸è§çš„\n            - `<img src=\"facebook.com\" style=\"visibility:hidden;\">`\n            - è¿™æ ·å°±å¯ä»¥çŸ¥é“ä½ è®¿é—®äº†é‚£äº›ç½‘ç«™åšä¸€äº›ç›¸åº”çš„æ¨è\n            - é‚£ä¹ˆæœ‰äº›åŒå­¦å°±ä¼šè”æƒ³åˆ°; æ¯”å¦‚æˆ‘åœ¨æ‹¼å¤šå¤šçœ‹äº†iPhone11; å†å»çœ‹æœ‹å‹åœˆå¾ˆå¯èƒ½æœ‰å°±ç›¸åº”çš„æ¨è, è¿™äº›æˆ‘ä¸ªäººçŒœæµ‹å¯èƒ½æ˜¯pddç›´æ¥æŠŠä½ çš„ä¿¡æ¯å–ç»™äº†è…¾è®¯, æˆ–è€…åšäº†äº¤æ˜“(é€ƒ\n          - å…·ä½“çš„ä¸‰ä¸ªå€¼Strict; Lax; None;æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªå·±å»æŸ¥è¿™é‡Œå°±ä¸å±•å¼€äº†\n      - cookieåˆåˆ†ä¸ºæœ¬åœ°cookieå’Œå†…å­˜cookie\n        - æœ¬åœ°cookieä¸å†…å­˜cookieï¼ŒåŒºåˆ«åœ¨äºcookieè®¾ç½®çš„expireså­—æ®µã€‚å¦‚æœæ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå°±æ˜¯å†…å­˜cookieã€‚éšç€æµè§ˆå™¨çš„å…³é—­è€Œä»å†…å­˜ä¸­æ¶ˆå¤±ã€‚\n        - è¿˜æ˜¯ä¸€æ ·éƒ½ä¼šæ³„éœ²ç”¨æˆ·ä¿¡æ¯çš„é£é™©\n        - å“ªæ€•æ˜¯å†…å­˜cookieæ”»å‡»è€…å¯ä»¥è®¾ç½®æ—¶æ•ˆä½¿å…¶æˆä¸ºæœ¬åœ°cookie\n\n### ä¸‰.session\n\nsessionæ˜¯æœåŠ¡å™¨ä¸ºwebç”¨æˆ·ç‹¬ç«‹å¼€è¾Ÿçš„ä¸€ä¸ªç©ºé—´, é‡Œé¢å¯ä»¥æœ‰ç”¨æˆ·ä¸€äº›ä¿¡æ¯ç­‰ç­‰\n\n- å¦‚æœæ˜¯ä¸€ä¸ªæœåŠ¡å™¨å¯èƒ½è¿˜å¥½, ä½†æ˜¯å¦‚æœæ˜¯å¤šä¸ªæœåŠ¡å™¨æˆ–è€…è¯´å¤šå±‚è½¬å‘çš„è¯å°±ä¼šå¼•å‘ä¸€ä¸ªé—®é¢˜, sessionå‘½ä¸­é—®é¢˜; æ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠä¿¡æ¯å­˜åœ¨MySQLæˆ–è€…Redisé‡Œé¢\n\n### å››.token\n\né™¤äº†sessionå’Œcookieæ¥è¾…åŠ©httpè¿™ä¸ªæ— çŠ¶æ€è¯·æ±‚, è¿˜æœ‰ä»€ä¹ˆåŠæ³•? \n\n- token\n  - tokenåˆ†ä¸ºå¾ˆå¤šç§, å¸¸è§çš„æœ‰JWT, sessionId, macåœ°å€ç­‰ç­‰\n  - tokenå¯ä»¥å­˜å‚¨åœ¨å¾ˆå¤šåœ°æ–¹, æ¯”å¦‚æœ¬åœ°çš„localStorageæˆ–è€…sessionStorage, ç„¶ååœ¨è¯·æ±‚å¤´ä¸­æºå¸¦\n\n### äº”.sessionStorage\n\nåˆšåˆšè¯´åˆ°sessionStorage; ä¸‹é¢æ¥è¯´è¯´æˆ‘ç¢°åˆ°çš„ä¸€ä¸ªé—®é¢˜\n\n- sessionStorageå¦‚æœæ‰“å¼€ä¸€ä¸ªæ–°æ ‡ç­¾é¡µ, ä»–çš„sessionStorageæ˜¯å¦å…±äº«?\n- å¤§å®¶å…ˆæƒ³æƒ³å†çœ‹ç­”æ¡ˆ\n\nä»¥å‰çš„æˆ‘ä»¥ä¸ºæ˜¯å¯ä»¥å…±äº«çš„.å…¶å®æ˜¯åŠé”™åŠå¯¹çš„\n\nä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´?\n\nMDNæ˜¯è¿™ä¹ˆè¯´çš„\n\n> ...data stored in sessionStorage gets cleared when the page session ends...**Opening a page in a new tab or window will cause a new session to be initiated**, which differs from how session cookies work.\n\nå¤§å®¶å¯ä»¥åšä¸€ä¸ªå®éªŒ\n\n>1. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€è¿™ä¸ª index.htmlï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºæ ‡ç­¾é¡µ Aã€‚æ³¨æ„ï¼šéœ€è¦ç”¨ http åè®®æ‰“å¼€ï¼ä¾‹å¦‚ http://localhost/index.html\n>2. ç‚¹å‡»é¡µé¢ä¸Šçš„é“¾æ¥ï¼Œæ­¤æ—¶ä¼šå¼¹å‡ºæ¥æ ‡ç­¾é¡µ Bã€‚\n>3. åœ¨æ ‡ç­¾é¡µ B ä¸­æ‰“å¼€æ§åˆ¶å°å¹¶æ‰§è¡Œ `sessionStorage.getItem('j')`ï¼Œå¾—åˆ° `'s'`\n>4. æ–°å»ºä¸€ä¸ªæ–°æ ‡ç­¾é¡µ Dï¼Œç„¶ååœ¨åœ°å€æ å†…è¾“å…¥ http://localhost/index.html æ‰“å¼€åŒæ ·çš„é¡µé¢ï¼Œ ç„¶åæ‰§è¡Œ `sessionStorage.getItem('j')` ã€‚\n\næŒ‰ç…§æˆ‘çš„é¢„æœŸï¼Œæ ‡ç­¾é¡µ D å¾—åˆ°çš„åº”è¯¥è¿˜æ˜¯ `'s'`ï¼Œæ¯•ç«Ÿæˆ‘è®¤ä¸º sessionStorage çš„æ•°æ®æ˜¯åœ¨åŒä¸€ç½‘ç«™çš„å¤šä¸ªæ ‡ç­¾é¡µä¹‹é—´å…±äº«çš„ã€‚ä½†æ˜¯**æˆ‘é”™äº†**ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯ `null`ã€‚\n\nç»†å¿ƒçš„åŒå­¦å¯èƒ½å·²ç»å‘ç°äº†\n\nç»†å¿ƒçš„åŒå­¦å¯èƒ½å·²ç»å‘ç°äº†ï¼Œæ ‡ç­¾é¡µ B å’Œæ ‡ç­¾é¡µ D ä¹‹é—´å”¯ä¸€çš„ä¸åŒå°±æ˜¯å®ƒä»¬è¢«æ‰“å¼€çš„æ–¹å¼ï¼š**æ ‡ç­¾é¡µ B æ˜¯é€šè¿‡åœ¨æ ‡ç­¾é¡µ A ä¸­ç‚¹å‡»é“¾æ¥æ‰“å¼€çš„ï¼Œä½†æ ‡ç­¾é¡µ D æ˜¯åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥åœ°å€æ‰“å¼€çš„ã€‚**\n\næ‰€ä»¥ç°åœ¨æˆ‘æ˜ç™½äº†ï¼šé€šè¿‡ç‚¹å‡»é“¾æ¥ï¼ˆæˆ–è€…ç”¨äº† `window.open`ï¼‰æ‰“å¼€çš„æ–°æ ‡ç­¾é¡µä¹‹é—´æ˜¯å±äºåŒä¸€ä¸ª session çš„ï¼Œä½†æ–°å¼€ä¸€ä¸ªæ ‡ç­¾é¡µæ€»æ˜¯ä¼šåˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ sessionï¼Œå³ä½¿ç½‘ç«™æ˜¯ä¸€æ ·çš„ï¼Œå®ƒä»¬ä¹Ÿä¸å±äºåŒä¸€ä¸ª sessionã€‚\n\n","slug":"sessionå’Œcookieçš„ç†è§£","published":1,"updated":"2021-06-24T14:00:06.849Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra80000ulwrd3uaf7bk4","content":"<h2 id=\"æ›¾ç»çš„æˆ‘\"><a href=\"#æ›¾ç»çš„æˆ‘\" class=\"headerlink\" title=\"æ›¾ç»çš„æˆ‘\"></a>æ›¾ç»çš„æˆ‘</h2><p>cookieæ˜¯æµè§ˆå™¨ä¸­ä¼ è¾“è‡ªå¸¦çš„; balabalaâ€¦</p>\n<p>sessionæ˜¯å­˜åœ¨æœåŠ¡ç«¯çš„; å­˜ä¸€äº›ç”¨æˆ·ä¿¡æ¯â€¦â€¦.balabalaâ€¦.</p>\n<h2 id=\"ç°åœ¨çš„æˆ‘\"><a href=\"#ç°åœ¨çš„æˆ‘\" class=\"headerlink\" title=\"ç°åœ¨çš„æˆ‘\"></a>ç°åœ¨çš„æˆ‘</h2><p>ä»ä»¥ä¸‹å‡ ä¸ªè§’åº¦å‡ºå‘</p>\n<h3 id=\"ä¸€-httpåè®®æ˜¯æ— çŠ¶æ€çš„\"><a href=\"#ä¸€-httpåè®®æ˜¯æ— çŠ¶æ€çš„\" class=\"headerlink\" title=\"ä¸€. httpåè®®æ˜¯æ— çŠ¶æ€çš„;\"></a>ä¸€. httpåè®®æ˜¯æ— çŠ¶æ€çš„;</h3><p>å½“æˆ‘ä»¬å¼€å‘ä¸€äº›å¯¹çŠ¶æ€æœ‰è¦æ±‚çš„æ¥å£æ—¶, cookieå’Œsessionå°±å¯ä»¥å¼¥è¡¥è¿™ä¸€å—çš„ä¸è¶³</p>\n<ul>\n<li>å¯¹äºhttpåè®®, cookieåªæ˜¯è¯·æ±‚å¤´ä¸­çš„ä¸€ä¸ªå­—æ®µ, å’Œåˆ«çš„å­—æ®µå¹¶æ²¡æœ‰ç‰¹åˆ«å¤§çš„å·®åˆ«;</li>\n<li>æµè§ˆå™¨å¯¹cookieåšäº†é»˜è®¤çš„æ”¯æŒ, ä½†æ˜¯ä¹Ÿé™åˆ¶äº†cookie; æ¯”å¦‚åŒæºç­–ç•¥;<ul>\n<li>ä»€ä¹ˆæ˜¯åŒæºç­–ç•¥?<ul>\n<li>åŒæºç­–ç•¥å°±æ˜¯åŸŸå, ç«¯å£, åè®®; å¿…é¡»éƒ½ç›¸åŒæ‰å¯ä»¥è®¿é—®cookieçš„å†…å®¹</li>\n</ul>\n</li>\n<li>ä¸ºä»€ä¹ˆè¦åšåŒæºç­–ç•¥?<ul>\n<li>åŒæºç­–ç•¥æ˜¯æµè§ˆå™¨åŸºäºå®‰å…¨çš„è§’åº¦çš„ä¸€ä¸ªæœºåˆ¶, é™åˆ¶äº†åªæœ‰åŒåŸŸæ‰å¯ä»¥è®¿é—®cookieçš„å†…å®¹</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"äºŒ-å½“æˆ‘ä»¬è¦åšå•ç‚¹ç™»å½•ssoåŠŸèƒ½çš„æ—¶å€™\"><a href=\"#äºŒ-å½“æˆ‘ä»¬è¦åšå•ç‚¹ç™»å½•ssoåŠŸèƒ½çš„æ—¶å€™\" class=\"headerlink\" title=\"äºŒ.å½“æˆ‘ä»¬è¦åšå•ç‚¹ç™»å½•ssoåŠŸèƒ½çš„æ—¶å€™\"></a>äºŒ.å½“æˆ‘ä»¬è¦åšå•ç‚¹ç™»å½•ssoåŠŸèƒ½çš„æ—¶å€™</h3><ul>\n<li>ä»€ä¹ˆæ˜¯å•ç‚¹ç™»å½•å’Œsso?<ul>\n<li>å•ç‚¹ç™»å½•ï¼ˆSingle Sign Onï¼‰ï¼Œç®€ç§°ä¸º SSOï¼Œæ˜¯æ¯”è¾ƒæµè¡Œçš„ä¼ä¸šä¸šåŠ¡æ•´åˆçš„è§£å†³æ–¹æ¡ˆä¹‹ä¸€ã€‚</li>\n<li>æœ€ç®€å•çš„ä¾‹å­å°±æ˜¯, æˆ‘ä»¬æ˜¯æ‰“å¼€æ·˜å®ç½‘çš„æ—¶å€™, æˆ‘ä»¬æ‰“å¼€ä¸€ä¸ªå•†å“è¯¦æƒ…é¡µæœ‰å¯èƒ½æ˜¯æ˜¯é‡æ–°æ‰“å¼€ä¸€ä¸ªé¡µé¢, é‚£æˆ‘ä»¬åˆšåˆšç™»å½•çš„ä¿¡æ¯å¯èƒ½å°±æ¶ˆå¤±äº†, è¦æ˜¯æ¯æ¬¡æ‰“å¼€ä¸€ä¸ªé¡µé¢éƒ½éœ€è¦ç™»å½•é‚£æ ·ä¼šéå¸¸çš„éº»çƒ¦<ul>\n<li>è¿™æ ·æ—¶å€™, å°±éœ€è¦cookieçš„å¸®åŠ©äº†;æˆ‘ä»¬å¯ä»¥è€ƒè™‘å§åŸŸåç§åœ¨å¯ä»¥è®¿é—®çš„åŸŸåä¸‹, é€šå¸¸éƒ½æ˜¯äºŒçº§åŸŸå<ul>\n<li>ä»€ä¹ˆæ˜¯ä¸€çº§, äºŒçº§, ä¸‰çº§â€¦.åŸŸå?</li>\n<li>ä¸¾ä¾‹: <a href=\"http://www.taobao.com\" target=\"_blank\" rel=\"noopener\">www.taobao.com</a><ul>\n<li>ä¸€çº§åŸŸåæ˜¯æŒ‡com(åˆç§°é¡¶çº§åŸŸå; <a href=\"https://zh.wikipedia.org/wiki/åŸŸå\" target=\"_blank\" rel=\"noopener\">ç»´åŸºç™¾ç§‘, ç‚¹æˆ‘!!</a></li>\n<li>äºŒçº§åŸŸåå°±æ˜¯taobao</li>\n<li>æ‰€ä»¥ä¸‰çº§åŸŸåå°±æ˜¯www</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>è¿™æ ·æˆ‘ä»¬åœ¨æ·˜å®è¿™ä¸ªåŸŸååº•ä¸‹çš„æ‰€æœ‰é¡µé¢éƒ½å¯ä»¥ç•…é€šæ— é˜»</li>\n<li>ä½†æ˜¯ä¹Ÿä¼šé¢ä¸´ä¿¡æ¯æ³„éœ²çš„å±é™©<ul>\n<li>è™½ç„¶å¯ä»¥ç”¨æ—¶æ•ˆæ¥é™åˆ¶ä½†æ˜¯æ•ˆæœä¹Ÿä¸æ˜¯å¾ˆå¥½</li>\n<li><strong>Secure Cookieæœºåˆ¶</strong><ul>\n<li>è®¾ç½®äº†cookieåªèƒ½åœ¨httpsä¸Šé¢ä¼ è¾“ä¸èƒ½åœ¨httpä¸Šä¼ è¾“</li>\n<li>ä½†æ˜¯ä¹Ÿä¸æ˜¯ä¸‡æ— ä¸€å¤±, å› ä¸ºè¿˜æ˜¯å¯ä»¥åœ¨å®¢æˆ·ç«¯, è¿›è¡Œè¯»å†™çš„;</li>\n</ul>\n</li>\n<li><strong>HTTPOnlyå±æ€§</strong><ul>\n<li>Cookieçš„HttpOnlyå±æ€§ï¼ŒæŒ‡æµè§ˆå™¨ä¸è¦åœ¨é™¤HTTPï¼ˆå’Œ HTTPS)è¯·æ±‚ä¹‹å¤–æš´éœ²Cookieã€‚</li>\n<li>è¿™æ ·å¯ä»¥é˜»æ­¢éhttpçš„æ”»å‡», å¦‚JavaScript</li>\n</ul>\n</li>\n<li><strong>Same-Siteå±æ€§</strong><ul>\n<li>Cookie çš„<code>SameSite</code>å±æ€§ç”¨æ¥é™åˆ¶ç¬¬ä¸‰æ–¹ Cookieï¼Œä»è€Œå‡å°‘å®‰å…¨é£é™©ã€‚<ul>\n<li>ä¸»è¦æ˜¯ä¸ºäº†é™åˆ¶CSRFæ”»å‡»<ul>\n<li>ä»€ä¹ˆæ˜¯CSRFæ”»å‡»?<ul>\n<li>è·¨ç«™è¯·æ±‚æ”»å‡»ï¼Œç®€å•åœ°è¯´ï¼Œæ˜¯æ”»å‡»è€…é€šè¿‡ä¸€äº›æŠ€æœ¯æ‰‹æ®µæ¬ºéª—ç”¨æˆ·çš„æµè§ˆå™¨å»è®¿é—®ä¸€ä¸ªè‡ªå·±æ›¾ç»è®¤è¯è¿‡çš„ç½‘ç«™å¹¶è¿è¡Œä¸€äº›æ“ä½œï¼ˆå¦‚å‘é‚®ä»¶ï¼Œå‘æ¶ˆæ¯ï¼Œç”šè‡³è´¢äº§æ“ä½œå¦‚è½¬è´¦å’Œè´­ä¹°å•†å“ï¼‰ã€‚</li>\n</ul>\n</li>\n<li>è¿˜å¯ä»¥ç”¨äºè·Ÿè¸ªç”¨æˆ·ä¿¡æ¯, æ¯”å¦‚åœ¨ä½ çš„ç½‘ç«™å†…éƒ¨æ”¾å…¥ä¸€ä¸ªä½ çœ‹ä¸è§çš„</li>\n<li><code>&lt;img src=&quot;facebook.com&quot; style=&quot;visibility:hidden;&quot;&gt;</code></li>\n<li>è¿™æ ·å°±å¯ä»¥çŸ¥é“ä½ è®¿é—®äº†é‚£äº›ç½‘ç«™åšä¸€äº›ç›¸åº”çš„æ¨è</li>\n<li>é‚£ä¹ˆæœ‰äº›åŒå­¦å°±ä¼šè”æƒ³åˆ°; æ¯”å¦‚æˆ‘åœ¨æ‹¼å¤šå¤šçœ‹äº†iPhone11; å†å»çœ‹æœ‹å‹åœˆå¾ˆå¯èƒ½æœ‰å°±ç›¸åº”çš„æ¨è, è¿™äº›æˆ‘ä¸ªäººçŒœæµ‹å¯èƒ½æ˜¯pddç›´æ¥æŠŠä½ çš„ä¿¡æ¯å–ç»™äº†è…¾è®¯, æˆ–è€…åšäº†äº¤æ˜“(é€ƒ</li>\n</ul>\n</li>\n<li>å…·ä½“çš„ä¸‰ä¸ªå€¼Strict; Lax; None;æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªå·±å»æŸ¥è¿™é‡Œå°±ä¸å±•å¼€äº†</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>cookieåˆåˆ†ä¸ºæœ¬åœ°cookieå’Œå†…å­˜cookie<ul>\n<li>æœ¬åœ°cookieä¸å†…å­˜cookieï¼ŒåŒºåˆ«åœ¨äºcookieè®¾ç½®çš„expireså­—æ®µã€‚å¦‚æœæ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå°±æ˜¯å†…å­˜cookieã€‚éšç€æµè§ˆå™¨çš„å…³é—­è€Œä»å†…å­˜ä¸­æ¶ˆå¤±ã€‚</li>\n<li>è¿˜æ˜¯ä¸€æ ·éƒ½ä¼šæ³„éœ²ç”¨æˆ·ä¿¡æ¯çš„é£é™©</li>\n<li>å“ªæ€•æ˜¯å†…å­˜cookieæ”»å‡»è€…å¯ä»¥è®¾ç½®æ—¶æ•ˆä½¿å…¶æˆä¸ºæœ¬åœ°cookie</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"ä¸‰-session\"><a href=\"#ä¸‰-session\" class=\"headerlink\" title=\"ä¸‰.session\"></a>ä¸‰.session</h3><p>sessionæ˜¯æœåŠ¡å™¨ä¸ºwebç”¨æˆ·ç‹¬ç«‹å¼€è¾Ÿçš„ä¸€ä¸ªç©ºé—´, é‡Œé¢å¯ä»¥æœ‰ç”¨æˆ·ä¸€äº›ä¿¡æ¯ç­‰ç­‰</p>\n<ul>\n<li>å¦‚æœæ˜¯ä¸€ä¸ªæœåŠ¡å™¨å¯èƒ½è¿˜å¥½, ä½†æ˜¯å¦‚æœæ˜¯å¤šä¸ªæœåŠ¡å™¨æˆ–è€…è¯´å¤šå±‚è½¬å‘çš„è¯å°±ä¼šå¼•å‘ä¸€ä¸ªé—®é¢˜, sessionå‘½ä¸­é—®é¢˜; æ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠä¿¡æ¯å­˜åœ¨MySQLæˆ–è€…Redisé‡Œé¢</li>\n</ul>\n<h3 id=\"å››-token\"><a href=\"#å››-token\" class=\"headerlink\" title=\"å››.token\"></a>å››.token</h3><p>é™¤äº†sessionå’Œcookieæ¥è¾…åŠ©httpè¿™ä¸ªæ— çŠ¶æ€è¯·æ±‚, è¿˜æœ‰ä»€ä¹ˆåŠæ³•? </p>\n<ul>\n<li>token<ul>\n<li>tokenåˆ†ä¸ºå¾ˆå¤šç§, å¸¸è§çš„æœ‰JWT, sessionId, macåœ°å€ç­‰ç­‰</li>\n<li>tokenå¯ä»¥å­˜å‚¨åœ¨å¾ˆå¤šåœ°æ–¹, æ¯”å¦‚æœ¬åœ°çš„localStorageæˆ–è€…sessionStorage, ç„¶ååœ¨è¯·æ±‚å¤´ä¸­æºå¸¦</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"äº”-sessionStorage\"><a href=\"#äº”-sessionStorage\" class=\"headerlink\" title=\"äº”.sessionStorage\"></a>äº”.sessionStorage</h3><p>åˆšåˆšè¯´åˆ°sessionStorage; ä¸‹é¢æ¥è¯´è¯´æˆ‘ç¢°åˆ°çš„ä¸€ä¸ªé—®é¢˜</p>\n<ul>\n<li>sessionStorageå¦‚æœæ‰“å¼€ä¸€ä¸ªæ–°æ ‡ç­¾é¡µ, ä»–çš„sessionStorageæ˜¯å¦å…±äº«?</li>\n<li>å¤§å®¶å…ˆæƒ³æƒ³å†çœ‹ç­”æ¡ˆ</li>\n</ul>\n<p>ä»¥å‰çš„æˆ‘ä»¥ä¸ºæ˜¯å¯ä»¥å…±äº«çš„.å…¶å®æ˜¯åŠé”™åŠå¯¹çš„</p>\n<p>ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´?</p>\n<p>MDNæ˜¯è¿™ä¹ˆè¯´çš„</p>\n<blockquote>\n<p>â€¦data stored in sessionStorage gets cleared when the page session endsâ€¦<strong>Opening a page in a new tab or window will cause a new session to be initiated</strong>, which differs from how session cookies work.</p>\n</blockquote>\n<p>å¤§å®¶å¯ä»¥åšä¸€ä¸ªå®éªŒ</p>\n<blockquote>\n<ol>\n<li>åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€è¿™ä¸ª index.htmlï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºæ ‡ç­¾é¡µ Aã€‚æ³¨æ„ï¼šéœ€è¦ç”¨ http åè®®æ‰“å¼€ï¼ä¾‹å¦‚ <a href=\"http://localhost/index.html\" target=\"_blank\" rel=\"noopener\">http://localhost/index.html</a></li>\n<li>ç‚¹å‡»é¡µé¢ä¸Šçš„é“¾æ¥ï¼Œæ­¤æ—¶ä¼šå¼¹å‡ºæ¥æ ‡ç­¾é¡µ Bã€‚</li>\n<li>åœ¨æ ‡ç­¾é¡µ B ä¸­æ‰“å¼€æ§åˆ¶å°å¹¶æ‰§è¡Œ <code>sessionStorage.getItem(&#39;j&#39;)</code>ï¼Œå¾—åˆ° <code>&#39;s&#39;</code></li>\n<li>æ–°å»ºä¸€ä¸ªæ–°æ ‡ç­¾é¡µ Dï¼Œç„¶ååœ¨åœ°å€æ å†…è¾“å…¥ <a href=\"http://localhost/index.html\" target=\"_blank\" rel=\"noopener\">http://localhost/index.html</a> æ‰“å¼€åŒæ ·çš„é¡µé¢ï¼Œ ç„¶åæ‰§è¡Œ <code>sessionStorage.getItem(&#39;j&#39;)</code> ã€‚</li>\n</ol>\n</blockquote>\n<p>æŒ‰ç…§æˆ‘çš„é¢„æœŸï¼Œæ ‡ç­¾é¡µ D å¾—åˆ°çš„åº”è¯¥è¿˜æ˜¯ <code>&#39;s&#39;</code>ï¼Œæ¯•ç«Ÿæˆ‘è®¤ä¸º sessionStorage çš„æ•°æ®æ˜¯åœ¨åŒä¸€ç½‘ç«™çš„å¤šä¸ªæ ‡ç­¾é¡µä¹‹é—´å…±äº«çš„ã€‚ä½†æ˜¯<strong>æˆ‘é”™äº†</strong>ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯ <code>null</code>ã€‚</p>\n<p>ç»†å¿ƒçš„åŒå­¦å¯èƒ½å·²ç»å‘ç°äº†</p>\n<p>ç»†å¿ƒçš„åŒå­¦å¯èƒ½å·²ç»å‘ç°äº†ï¼Œæ ‡ç­¾é¡µ B å’Œæ ‡ç­¾é¡µ D ä¹‹é—´å”¯ä¸€çš„ä¸åŒå°±æ˜¯å®ƒä»¬è¢«æ‰“å¼€çš„æ–¹å¼ï¼š<strong>æ ‡ç­¾é¡µ B æ˜¯é€šè¿‡åœ¨æ ‡ç­¾é¡µ A ä¸­ç‚¹å‡»é“¾æ¥æ‰“å¼€çš„ï¼Œä½†æ ‡ç­¾é¡µ D æ˜¯åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥åœ°å€æ‰“å¼€çš„ã€‚</strong></p>\n<p>æ‰€ä»¥ç°åœ¨æˆ‘æ˜ç™½äº†ï¼šé€šè¿‡ç‚¹å‡»é“¾æ¥ï¼ˆæˆ–è€…ç”¨äº† <code>window.open</code>ï¼‰æ‰“å¼€çš„æ–°æ ‡ç­¾é¡µä¹‹é—´æ˜¯å±äºåŒä¸€ä¸ª session çš„ï¼Œä½†æ–°å¼€ä¸€ä¸ªæ ‡ç­¾é¡µæ€»æ˜¯ä¼šåˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ sessionï¼Œå³ä½¿ç½‘ç«™æ˜¯ä¸€æ ·çš„ï¼Œå®ƒä»¬ä¹Ÿä¸å±äºåŒä¸€ä¸ª sessionã€‚</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"æ›¾ç»çš„æˆ‘\"><a href=\"#æ›¾ç»çš„æˆ‘\" class=\"headerlink\" title=\"æ›¾ç»çš„æˆ‘\"></a>æ›¾ç»çš„æˆ‘</h2><p>cookieæ˜¯æµè§ˆå™¨ä¸­ä¼ è¾“è‡ªå¸¦çš„; balabalaâ€¦</p>\n<p>sessionæ˜¯å­˜åœ¨æœåŠ¡ç«¯çš„; å­˜ä¸€äº›ç”¨æˆ·ä¿¡æ¯â€¦â€¦.balabalaâ€¦.</p>\n<h2 id=\"ç°åœ¨çš„æˆ‘\"><a href=\"#ç°åœ¨çš„æˆ‘\" class=\"headerlink\" title=\"ç°åœ¨çš„æˆ‘\"></a>ç°åœ¨çš„æˆ‘</h2><p>ä»ä»¥ä¸‹å‡ ä¸ªè§’åº¦å‡ºå‘</p>\n<h3 id=\"ä¸€-httpåè®®æ˜¯æ— çŠ¶æ€çš„\"><a href=\"#ä¸€-httpåè®®æ˜¯æ— çŠ¶æ€çš„\" class=\"headerlink\" title=\"ä¸€. httpåè®®æ˜¯æ— çŠ¶æ€çš„;\"></a>ä¸€. httpåè®®æ˜¯æ— çŠ¶æ€çš„;</h3><p>å½“æˆ‘ä»¬å¼€å‘ä¸€äº›å¯¹çŠ¶æ€æœ‰è¦æ±‚çš„æ¥å£æ—¶, cookieå’Œsessionå°±å¯ä»¥å¼¥è¡¥è¿™ä¸€å—çš„ä¸è¶³</p>\n<ul>\n<li>å¯¹äºhttpåè®®, cookieåªæ˜¯è¯·æ±‚å¤´ä¸­çš„ä¸€ä¸ªå­—æ®µ, å’Œåˆ«çš„å­—æ®µå¹¶æ²¡æœ‰ç‰¹åˆ«å¤§çš„å·®åˆ«;</li>\n<li>æµè§ˆå™¨å¯¹cookieåšäº†é»˜è®¤çš„æ”¯æŒ, ä½†æ˜¯ä¹Ÿé™åˆ¶äº†cookie; æ¯”å¦‚åŒæºç­–ç•¥;<ul>\n<li>ä»€ä¹ˆæ˜¯åŒæºç­–ç•¥?<ul>\n<li>åŒæºç­–ç•¥å°±æ˜¯åŸŸå, ç«¯å£, åè®®; å¿…é¡»éƒ½ç›¸åŒæ‰å¯ä»¥è®¿é—®cookieçš„å†…å®¹</li>\n</ul>\n</li>\n<li>ä¸ºä»€ä¹ˆè¦åšåŒæºç­–ç•¥?<ul>\n<li>åŒæºç­–ç•¥æ˜¯æµè§ˆå™¨åŸºäºå®‰å…¨çš„è§’åº¦çš„ä¸€ä¸ªæœºåˆ¶, é™åˆ¶äº†åªæœ‰åŒåŸŸæ‰å¯ä»¥è®¿é—®cookieçš„å†…å®¹</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"äºŒ-å½“æˆ‘ä»¬è¦åšå•ç‚¹ç™»å½•ssoåŠŸèƒ½çš„æ—¶å€™\"><a href=\"#äºŒ-å½“æˆ‘ä»¬è¦åšå•ç‚¹ç™»å½•ssoåŠŸèƒ½çš„æ—¶å€™\" class=\"headerlink\" title=\"äºŒ.å½“æˆ‘ä»¬è¦åšå•ç‚¹ç™»å½•ssoåŠŸèƒ½çš„æ—¶å€™\"></a>äºŒ.å½“æˆ‘ä»¬è¦åšå•ç‚¹ç™»å½•ssoåŠŸèƒ½çš„æ—¶å€™</h3><ul>\n<li>ä»€ä¹ˆæ˜¯å•ç‚¹ç™»å½•å’Œsso?<ul>\n<li>å•ç‚¹ç™»å½•ï¼ˆSingle Sign Onï¼‰ï¼Œç®€ç§°ä¸º SSOï¼Œæ˜¯æ¯”è¾ƒæµè¡Œçš„ä¼ä¸šä¸šåŠ¡æ•´åˆçš„è§£å†³æ–¹æ¡ˆä¹‹ä¸€ã€‚</li>\n<li>æœ€ç®€å•çš„ä¾‹å­å°±æ˜¯, æˆ‘ä»¬æ˜¯æ‰“å¼€æ·˜å®ç½‘çš„æ—¶å€™, æˆ‘ä»¬æ‰“å¼€ä¸€ä¸ªå•†å“è¯¦æƒ…é¡µæœ‰å¯èƒ½æ˜¯æ˜¯é‡æ–°æ‰“å¼€ä¸€ä¸ªé¡µé¢, é‚£æˆ‘ä»¬åˆšåˆšç™»å½•çš„ä¿¡æ¯å¯èƒ½å°±æ¶ˆå¤±äº†, è¦æ˜¯æ¯æ¬¡æ‰“å¼€ä¸€ä¸ªé¡µé¢éƒ½éœ€è¦ç™»å½•é‚£æ ·ä¼šéå¸¸çš„éº»çƒ¦<ul>\n<li>è¿™æ ·æ—¶å€™, å°±éœ€è¦cookieçš„å¸®åŠ©äº†;æˆ‘ä»¬å¯ä»¥è€ƒè™‘å§åŸŸåç§åœ¨å¯ä»¥è®¿é—®çš„åŸŸåä¸‹, é€šå¸¸éƒ½æ˜¯äºŒçº§åŸŸå<ul>\n<li>ä»€ä¹ˆæ˜¯ä¸€çº§, äºŒçº§, ä¸‰çº§â€¦.åŸŸå?</li>\n<li>ä¸¾ä¾‹: <a href=\"http://www.taobao.com\" target=\"_blank\" rel=\"noopener\">www.taobao.com</a><ul>\n<li>ä¸€çº§åŸŸåæ˜¯æŒ‡com(åˆç§°é¡¶çº§åŸŸå; <a href=\"https://zh.wikipedia.org/wiki/åŸŸå\" target=\"_blank\" rel=\"noopener\">ç»´åŸºç™¾ç§‘, ç‚¹æˆ‘!!</a></li>\n<li>äºŒçº§åŸŸåå°±æ˜¯taobao</li>\n<li>æ‰€ä»¥ä¸‰çº§åŸŸåå°±æ˜¯www</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>è¿™æ ·æˆ‘ä»¬åœ¨æ·˜å®è¿™ä¸ªåŸŸååº•ä¸‹çš„æ‰€æœ‰é¡µé¢éƒ½å¯ä»¥ç•…é€šæ— é˜»</li>\n<li>ä½†æ˜¯ä¹Ÿä¼šé¢ä¸´ä¿¡æ¯æ³„éœ²çš„å±é™©<ul>\n<li>è™½ç„¶å¯ä»¥ç”¨æ—¶æ•ˆæ¥é™åˆ¶ä½†æ˜¯æ•ˆæœä¹Ÿä¸æ˜¯å¾ˆå¥½</li>\n<li><strong>Secure Cookieæœºåˆ¶</strong><ul>\n<li>è®¾ç½®äº†cookieåªèƒ½åœ¨httpsä¸Šé¢ä¼ è¾“ä¸èƒ½åœ¨httpä¸Šä¼ è¾“</li>\n<li>ä½†æ˜¯ä¹Ÿä¸æ˜¯ä¸‡æ— ä¸€å¤±, å› ä¸ºè¿˜æ˜¯å¯ä»¥åœ¨å®¢æˆ·ç«¯, è¿›è¡Œè¯»å†™çš„;</li>\n</ul>\n</li>\n<li><strong>HTTPOnlyå±æ€§</strong><ul>\n<li>Cookieçš„HttpOnlyå±æ€§ï¼ŒæŒ‡æµè§ˆå™¨ä¸è¦åœ¨é™¤HTTPï¼ˆå’Œ HTTPS)è¯·æ±‚ä¹‹å¤–æš´éœ²Cookieã€‚</li>\n<li>è¿™æ ·å¯ä»¥é˜»æ­¢éhttpçš„æ”»å‡», å¦‚JavaScript</li>\n</ul>\n</li>\n<li><strong>Same-Siteå±æ€§</strong><ul>\n<li>Cookie çš„<code>SameSite</code>å±æ€§ç”¨æ¥é™åˆ¶ç¬¬ä¸‰æ–¹ Cookieï¼Œä»è€Œå‡å°‘å®‰å…¨é£é™©ã€‚<ul>\n<li>ä¸»è¦æ˜¯ä¸ºäº†é™åˆ¶CSRFæ”»å‡»<ul>\n<li>ä»€ä¹ˆæ˜¯CSRFæ”»å‡»?<ul>\n<li>è·¨ç«™è¯·æ±‚æ”»å‡»ï¼Œç®€å•åœ°è¯´ï¼Œæ˜¯æ”»å‡»è€…é€šè¿‡ä¸€äº›æŠ€æœ¯æ‰‹æ®µæ¬ºéª—ç”¨æˆ·çš„æµè§ˆå™¨å»è®¿é—®ä¸€ä¸ªè‡ªå·±æ›¾ç»è®¤è¯è¿‡çš„ç½‘ç«™å¹¶è¿è¡Œä¸€äº›æ“ä½œï¼ˆå¦‚å‘é‚®ä»¶ï¼Œå‘æ¶ˆæ¯ï¼Œç”šè‡³è´¢äº§æ“ä½œå¦‚è½¬è´¦å’Œè´­ä¹°å•†å“ï¼‰ã€‚</li>\n</ul>\n</li>\n<li>è¿˜å¯ä»¥ç”¨äºè·Ÿè¸ªç”¨æˆ·ä¿¡æ¯, æ¯”å¦‚åœ¨ä½ çš„ç½‘ç«™å†…éƒ¨æ”¾å…¥ä¸€ä¸ªä½ çœ‹ä¸è§çš„</li>\n<li><code>&lt;img src=&quot;facebook.com&quot; style=&quot;visibility:hidden;&quot;&gt;</code></li>\n<li>è¿™æ ·å°±å¯ä»¥çŸ¥é“ä½ è®¿é—®äº†é‚£äº›ç½‘ç«™åšä¸€äº›ç›¸åº”çš„æ¨è</li>\n<li>é‚£ä¹ˆæœ‰äº›åŒå­¦å°±ä¼šè”æƒ³åˆ°; æ¯”å¦‚æˆ‘åœ¨æ‹¼å¤šå¤šçœ‹äº†iPhone11; å†å»çœ‹æœ‹å‹åœˆå¾ˆå¯èƒ½æœ‰å°±ç›¸åº”çš„æ¨è, è¿™äº›æˆ‘ä¸ªäººçŒœæµ‹å¯èƒ½æ˜¯pddç›´æ¥æŠŠä½ çš„ä¿¡æ¯å–ç»™äº†è…¾è®¯, æˆ–è€…åšäº†äº¤æ˜“(é€ƒ</li>\n</ul>\n</li>\n<li>å…·ä½“çš„ä¸‰ä¸ªå€¼Strict; Lax; None;æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªå·±å»æŸ¥è¿™é‡Œå°±ä¸å±•å¼€äº†</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>cookieåˆåˆ†ä¸ºæœ¬åœ°cookieå’Œå†…å­˜cookie<ul>\n<li>æœ¬åœ°cookieä¸å†…å­˜cookieï¼ŒåŒºåˆ«åœ¨äºcookieè®¾ç½®çš„expireså­—æ®µã€‚å¦‚æœæ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå°±æ˜¯å†…å­˜cookieã€‚éšç€æµè§ˆå™¨çš„å…³é—­è€Œä»å†…å­˜ä¸­æ¶ˆå¤±ã€‚</li>\n<li>è¿˜æ˜¯ä¸€æ ·éƒ½ä¼šæ³„éœ²ç”¨æˆ·ä¿¡æ¯çš„é£é™©</li>\n<li>å“ªæ€•æ˜¯å†…å­˜cookieæ”»å‡»è€…å¯ä»¥è®¾ç½®æ—¶æ•ˆä½¿å…¶æˆä¸ºæœ¬åœ°cookie</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"ä¸‰-session\"><a href=\"#ä¸‰-session\" class=\"headerlink\" title=\"ä¸‰.session\"></a>ä¸‰.session</h3><p>sessionæ˜¯æœåŠ¡å™¨ä¸ºwebç”¨æˆ·ç‹¬ç«‹å¼€è¾Ÿçš„ä¸€ä¸ªç©ºé—´, é‡Œé¢å¯ä»¥æœ‰ç”¨æˆ·ä¸€äº›ä¿¡æ¯ç­‰ç­‰</p>\n<ul>\n<li>å¦‚æœæ˜¯ä¸€ä¸ªæœåŠ¡å™¨å¯èƒ½è¿˜å¥½, ä½†æ˜¯å¦‚æœæ˜¯å¤šä¸ªæœåŠ¡å™¨æˆ–è€…è¯´å¤šå±‚è½¬å‘çš„è¯å°±ä¼šå¼•å‘ä¸€ä¸ªé—®é¢˜, sessionå‘½ä¸­é—®é¢˜; æ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠä¿¡æ¯å­˜åœ¨MySQLæˆ–è€…Redisé‡Œé¢</li>\n</ul>\n<h3 id=\"å››-token\"><a href=\"#å››-token\" class=\"headerlink\" title=\"å››.token\"></a>å››.token</h3><p>é™¤äº†sessionå’Œcookieæ¥è¾…åŠ©httpè¿™ä¸ªæ— çŠ¶æ€è¯·æ±‚, è¿˜æœ‰ä»€ä¹ˆåŠæ³•? </p>\n<ul>\n<li>token<ul>\n<li>tokenåˆ†ä¸ºå¾ˆå¤šç§, å¸¸è§çš„æœ‰JWT, sessionId, macåœ°å€ç­‰ç­‰</li>\n<li>tokenå¯ä»¥å­˜å‚¨åœ¨å¾ˆå¤šåœ°æ–¹, æ¯”å¦‚æœ¬åœ°çš„localStorageæˆ–è€…sessionStorage, ç„¶ååœ¨è¯·æ±‚å¤´ä¸­æºå¸¦</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"äº”-sessionStorage\"><a href=\"#äº”-sessionStorage\" class=\"headerlink\" title=\"äº”.sessionStorage\"></a>äº”.sessionStorage</h3><p>åˆšåˆšè¯´åˆ°sessionStorage; ä¸‹é¢æ¥è¯´è¯´æˆ‘ç¢°åˆ°çš„ä¸€ä¸ªé—®é¢˜</p>\n<ul>\n<li>sessionStorageå¦‚æœæ‰“å¼€ä¸€ä¸ªæ–°æ ‡ç­¾é¡µ, ä»–çš„sessionStorageæ˜¯å¦å…±äº«?</li>\n<li>å¤§å®¶å…ˆæƒ³æƒ³å†çœ‹ç­”æ¡ˆ</li>\n</ul>\n<p>ä»¥å‰çš„æˆ‘ä»¥ä¸ºæ˜¯å¯ä»¥å…±äº«çš„.å…¶å®æ˜¯åŠé”™åŠå¯¹çš„</p>\n<p>ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´?</p>\n<p>MDNæ˜¯è¿™ä¹ˆè¯´çš„</p>\n<blockquote>\n<p>â€¦data stored in sessionStorage gets cleared when the page session endsâ€¦<strong>Opening a page in a new tab or window will cause a new session to be initiated</strong>, which differs from how session cookies work.</p>\n</blockquote>\n<p>å¤§å®¶å¯ä»¥åšä¸€ä¸ªå®éªŒ</p>\n<blockquote>\n<ol>\n<li>åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€è¿™ä¸ª index.htmlï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºæ ‡ç­¾é¡µ Aã€‚æ³¨æ„ï¼šéœ€è¦ç”¨ http åè®®æ‰“å¼€ï¼ä¾‹å¦‚ <a href=\"http://localhost/index.html\" target=\"_blank\" rel=\"noopener\">http://localhost/index.html</a></li>\n<li>ç‚¹å‡»é¡µé¢ä¸Šçš„é“¾æ¥ï¼Œæ­¤æ—¶ä¼šå¼¹å‡ºæ¥æ ‡ç­¾é¡µ Bã€‚</li>\n<li>åœ¨æ ‡ç­¾é¡µ B ä¸­æ‰“å¼€æ§åˆ¶å°å¹¶æ‰§è¡Œ <code>sessionStorage.getItem(&#39;j&#39;)</code>ï¼Œå¾—åˆ° <code>&#39;s&#39;</code></li>\n<li>æ–°å»ºä¸€ä¸ªæ–°æ ‡ç­¾é¡µ Dï¼Œç„¶ååœ¨åœ°å€æ å†…è¾“å…¥ <a href=\"http://localhost/index.html\" target=\"_blank\" rel=\"noopener\">http://localhost/index.html</a> æ‰“å¼€åŒæ ·çš„é¡µé¢ï¼Œ ç„¶åæ‰§è¡Œ <code>sessionStorage.getItem(&#39;j&#39;)</code> ã€‚</li>\n</ol>\n</blockquote>\n<p>æŒ‰ç…§æˆ‘çš„é¢„æœŸï¼Œæ ‡ç­¾é¡µ D å¾—åˆ°çš„åº”è¯¥è¿˜æ˜¯ <code>&#39;s&#39;</code>ï¼Œæ¯•ç«Ÿæˆ‘è®¤ä¸º sessionStorage çš„æ•°æ®æ˜¯åœ¨åŒä¸€ç½‘ç«™çš„å¤šä¸ªæ ‡ç­¾é¡µä¹‹é—´å…±äº«çš„ã€‚ä½†æ˜¯<strong>æˆ‘é”™äº†</strong>ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯ <code>null</code>ã€‚</p>\n<p>ç»†å¿ƒçš„åŒå­¦å¯èƒ½å·²ç»å‘ç°äº†</p>\n<p>ç»†å¿ƒçš„åŒå­¦å¯èƒ½å·²ç»å‘ç°äº†ï¼Œæ ‡ç­¾é¡µ B å’Œæ ‡ç­¾é¡µ D ä¹‹é—´å”¯ä¸€çš„ä¸åŒå°±æ˜¯å®ƒä»¬è¢«æ‰“å¼€çš„æ–¹å¼ï¼š<strong>æ ‡ç­¾é¡µ B æ˜¯é€šè¿‡åœ¨æ ‡ç­¾é¡µ A ä¸­ç‚¹å‡»é“¾æ¥æ‰“å¼€çš„ï¼Œä½†æ ‡ç­¾é¡µ D æ˜¯åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥åœ°å€æ‰“å¼€çš„ã€‚</strong></p>\n<p>æ‰€ä»¥ç°åœ¨æˆ‘æ˜ç™½äº†ï¼šé€šè¿‡ç‚¹å‡»é“¾æ¥ï¼ˆæˆ–è€…ç”¨äº† <code>window.open</code>ï¼‰æ‰“å¼€çš„æ–°æ ‡ç­¾é¡µä¹‹é—´æ˜¯å±äºåŒä¸€ä¸ª session çš„ï¼Œä½†æ–°å¼€ä¸€ä¸ªæ ‡ç­¾é¡µæ€»æ˜¯ä¼šåˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ sessionï¼Œå³ä½¿ç½‘ç«™æ˜¯ä¸€æ ·çš„ï¼Œå®ƒä»¬ä¹Ÿä¸å±äºåŒä¸€ä¸ª sessionã€‚</p>\n"},{"title":"ã€Œå¦‚ä½•ç»™å¼€æºåº“æä¸€ä¸ªPRã€","date":"2021-01-22T08:39:14.000Z","cover":"/image/cover/github.jpg","_content":"\n## å‰è¨€\n\nä¹‹å‰ä¸€ç›´æƒ³ç»™`github`ä¸Šé¢ä¼˜ç§€çš„é¡¹ç›®åšä¸€äº›åŠ›æ‰€èƒ½åŠçš„äº‹æƒ…ï¼Œæ¯”å¦‚è§£å†³ä¸€ä¸‹`issues`ï¼Œæˆ–è€…æä¸€ä¸ª`pr`ï¼Œä¿®æ”¹ä¸€ä¸‹`bug`ã€‚ä½†æ˜¯è‹¦äºä¸€ç›´ä¸çŸ¥é“æ€ä¹ˆæ­£ç¡®çš„å»åšè¿™ä»¶äº‹æƒ…ã€‚æ‰€ä»¥æç½®äº†ï¼Œåæ¥å‘ç°äº†[pro-components](https://github.com/ant-design/pro-components)è¿™ä¸ªé¡¹ç›®ï¼Œå’Œæˆ‘çš„ç†å¿µéå¸¸å¥‘åˆï¼Œå°±æ˜¯ä¸€ä¸ªåŒ…è£…ç‰ˆçš„[ant-design](https://github.com/ant-design/ant-design)ï¼Œå¯ä»¥æ›´å¿«æ›´å¥½çš„ä½¿ç”¨[ant-design](https://github.com/ant-design/ant-design)ã€‚\n\nå› ä¸ºä¸€ä¸ªæ¯”è¾ƒå‡ºåçš„é¡¹ç›®çš„`pr`ï¼Œå¯èƒ½åœ¨ç®€å†ç­›é€‰çš„æ—¶å€™ä¼šæ¯”è¾ƒåƒé¦™ï¼Œè¿™ä¸ªåº”è¯¥å¤§å®¶éƒ½çŸ¥é“ï¼Œè€Œä¸”è¿˜å¯ä»¥æ··ä¸ªè„¸ç†Ÿã€‚å“ˆå“ˆå“ˆã€‚\n\nä¸»è¦æ˜¯ä¸ºäº†è®°å½•è‡ªå·±çš„æ“ä½œè¿‡ç¨‹ï¼Œå’Œåˆ†äº«ã€‚\n\næ¥ä¸‹æ¥ä¼šæ¶‰åŠåˆ°å®é™…æ“ä½œï¼Œæ‰€ä»¥è¯·å¤§å®¶å…ˆç‚¹èµæ”¶è—å†çœ‹ã€‚\n\n## githubä¸‰ä¸ªæŒ‰é’®\n\næˆ‘ä»¬çŸ¥é“ï¼Œ`github`ä¸Šé¢çš„ä»£ç æ˜¯å¯ä»¥ç›´æ¥çœ‹çš„ï¼Œæ–¹å¼æœ‰ä»¥ä¸‹å‡ ç§ï¼š\n\n- ä¸‹è½½`zip`\n- `fork`åˆ°è‡ªå·±çš„é¡¹ç›®ä¸­ï¼Œç„¶åè‡ªå·±`clone`ä¸‹æ¥(é‡ç‚¹ä»‹ç»ï¼Œå’Œæ`pr`å¯†åˆ‡ç›¸å…³)\n- ç›´æ¥`clone`ä¸‹æ¥\n- åœ¨ç½‘é¡µä¸Šç›´æ¥è§‚çœ‹\n\n\n\næˆ‘ä»¬çœ‹åˆ°`github`é¡¹ç›®çš„æ—¶å€™ï¼Œå‘ç°ä¸ä»…æœ‰æˆ‘ä»¬éƒ½çŸ¥é“çš„`star`ï¼Œè¿˜æœ‰`watch`å’Œ`fork`ã€‚\n\n![pornhub](/image/pr/title.png)\n\n### Star\n\nè¿™é‡Œè¯´ç‚¹åºŸè¯ï¼Œå°ä¼™ä¼´æœ‰æ²¡æœ‰äººå’Œæˆ‘ä¸€æ ·è‹±è¯­ä¸å¥½ï¼Œç»å¸¸è®°æˆ`start`çš„ï¼ï¼ï¼\n\n`star` ç¿»è¯‘è¿‡æ¥åº”è¯¥æ˜¯æ˜Ÿæ˜Ÿï¼Œè¿™é‡Œè§£é‡Šä¸º`å…³æ³¨`æˆ–è€…`ç‚¹èµ`æ›´åˆé€‚\n\n`star`çš„è¯å°±ç›¸å½“äºæ˜¯æˆ‘ç»™è¿™ä¸ªé¡¹ç›®åšä¸€ä¸ªæ ‡è®°ï¼Œæˆ–è€…è¯´æ˜¯ç»™è¿™ä¸ªé¡¹ç›®ç‚¹äº†ä¸€ä¸ªã€Œå¥½è¯„ã€\n\né€šå¸¸æˆ‘ä»¬è®¤ä¸ºä¸€ä¸ªé¡¹ç›®çš„å—æ¬¢è¿ç¨‹åº¦åŸºæœ¬ä¸Šéƒ½æ˜¯ç”±staræ¥è¿›è¡Œè¯„åˆ¤çš„ã€‚ï¼ˆæ³¨æ„ï¼æ˜¯åŸºæœ¬ä¸Šï¼Œå½“ç„¶è¿˜æœ‰npmçš„ä¸‹è½½æ•°ï¼Œè¿™ä¸ªæœ‰ç‚¹ç±»å‹è§‚çœ‹æ•°\n\n![pornhub](/image/pr/pornhub.jpg)\n\næœ‰ç‚¹ç±»å‹ä¸Šå›¾çš„ï¼Œå–œæ¬¢æ•°ï¼ˆ`start`ï¼Œå’Œè§‚çœ‹æ¬¡æ•°ï¼ˆ`npm`ä¸‹è½½é‡\n\n\n\n### Watch\n\n`Watch`ç¿»è¯‘è¿‡æ¥å¯ä»¥ç§°ä¹‹ä¸ºè§‚å¯Ÿã€‚\n\né»˜è®¤æ¯ä¸€ä¸ªç”¨æˆ·éƒ½æ˜¯å¤„äº`Not watching`çš„çŠ¶æ€ï¼Œå½“ä½ é€‰æ‹©`Watching`ï¼Œè¡¨ç¤ºä½ ä»¥åä¼šå…³æ³¨è¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰åŠ¨æ€ï¼Œä»¥ååªè¦è¿™ä¸ªé¡¹ç›®å‘ç”Ÿå˜åŠ¨ï¼Œå¦‚è¢«åˆ«äººæäº¤äº†`pull request`ã€è¢«åˆ«äººå‘èµ·äº†`issue`ç­‰ç­‰æƒ…å†µï¼Œä½ éƒ½ä¼šåœ¨è‡ªå·±çš„ä¸ªäººé€šçŸ¥ä¸­å¿ƒï¼Œæ”¶åˆ°ä¸€æ¡é€šçŸ¥æ¶ˆæ¯ï¼Œå¦‚æœä½ è®¾ç½®äº†ä¸ªäººé‚®ç®±ï¼Œé‚£ä¹ˆä½ çš„é‚®ç®±ä¹Ÿå¯èƒ½æ”¶åˆ°ç›¸åº”çš„é‚®ä»¶ã€‚\n\nå¦‚æœä½ ä¸æƒ³æ¥å—è¿™äº›é€šçŸ¥ï¼Œé‚£ä¹ˆç‚¹å‡»` Not Watching` å³å¯ã€‚\n\n\n\n### Fork\n\nè¿™é‡Œè¦é‡ç‚¹è¯´ä¸€ä¸‹ï¼Œå› ä¸ºå’Œæˆ‘ä»¬ç°åœ¨çš„ä¸»é¢˜ï¼šRPï¼ˆPull Requestï¼‰æ¯æ¯ç›¸å…³ã€‚\n\n> æ¥ä¸‹æ¥è¦è¯´çš„prå°±æ˜¯pull request\n\nå½“é€‰æ‹©` fork`ï¼Œç›¸å½“äºä½ è‡ªå·±æœ‰äº†ä¸€ä»½åŸé¡¹ç›®çš„æ‹·è´ï¼Œå½“ç„¶è¿™ä¸ªæ‹·è´åªæ˜¯é’ˆå¯¹å½“æ—¶çš„é¡¹ç›®æ–‡ä»¶ï¼Œå¦‚æœåç»­åŸé¡¹ç›®æ–‡ä»¶å‘ç”Ÿæ”¹å˜ï¼Œä½ å¿…é¡»é€šè¿‡å…¶ä»–çš„æ–¹å¼å»åŒæ­¥ã€‚\n\nä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä½¿ç”¨` fork` è¿™ä¸ªåŠŸèƒ½ï¼Œè‡³å°‘æˆ‘ä¸€èˆ¬ä¸ä¼šç”¨ï¼Œé™¤éæœ‰ä¸€äº›é¡¹ç›®ï¼Œå¯èƒ½å­˜åœ¨` bug` æˆ–è€…å¯ä»¥ç»§ç»­ä¼˜åŒ–çš„åœ°æ–¹ï¼Œä½ æƒ³å¸®åŠ©åŸé¡¹ç›®ä½œè€…å»å®Œå–„è¿™ä¸ªé¡¹ç›®ï¼Œé‚£ä¹ˆä½ å¯ä»¥` fork `ä¸€ä»½é¡¹ç›®ä¸‹æ¥ï¼Œç„¶åè‡ªå·±å¯¹è¿™ä¸ªé¡¹ç›®è¿›è¡Œä¿®æ”¹å®Œå–„ï¼Œå½“ä½ è§‰å¾—é¡¹ç›®æ²¡é—®é¢˜äº†ï¼Œä½ å°±å¯ä»¥å°è¯•å‘èµ· `pull request`ç»™åŸé¡¹ç›®ä½œè€…äº†ï¼Œç„¶åå°±é™é™ç­‰å¾…ä»–çš„ `merge`ã€‚\n\nå½“å‰å¾ˆå¤šäººé”™è¯¯çš„åœ¨ä½¿ç”¨` fork`ã€‚å¾ˆå¤šäººæŠŠ` fork `å½“æˆäº†æ”¶è—ä¸€æ ·çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ä¸€å¼€å§‹ä½¿ç”¨ `github `çš„æˆ‘ï¼Œæ¯æ¬¡çœ‹åˆ°ä¸€ä¸ªå¥½çš„é¡¹ç›®å°±å…ˆ `fork`ï¼Œå› ä¸ºè¿™æ ·ï¼Œå°±å¯ä»¥æˆ‘çš„` repository`(ä»“åº“)åˆ—è¡¨ä¸‹æŸ¥çœ‹ `fork` çš„é¡¹ç›®äº†ã€‚\n\n> è€Œä¸”è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ä½ forkçš„æ˜¯å½“å‰ï¼Œæ­¤æ—¶æ­¤åˆ»çš„ä»£ç ï¼Œå‡å¦‚åç»­ä½œè€…æ›´æ–°äº†æ–°çš„å†…å®¹ï¼Œä½ forkçš„å°±ä¸ä¼šå˜ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªæ–¹å¼å¯ä»¥pullåˆ°æœ€æ–°çš„ä»£ç ï¼Œè¿™ä¸ªä¹Ÿæ˜¯å¾ˆé‡è¦çš„ï¼Œä¸å¦‚ä½ æäº¤ä½ çš„prçš„æ—¶å€™ï¼Œä¼šæœ‰å†²çª\n\næ€»å¾—æ¥è¯´ï¼Œ`fork`å°±æ˜¯ç»™æˆ‘ä»¬æ`pr`ä½¿ç”¨çš„ã€‚\n\n\n\n## å®æ“\n\n### forké¡¹ç›®åˆ°è‡ªå·±çš„ä»“åº“\n\næ‰¾åˆ°è‡ªå·±æƒ³è¦æprçš„é¡¹ç›®ï¼Œç„¶åç‚¹å‡»å›¾ä¸Šçš„ã€Œforkã€\n\n![pornhub](/image/pr/title.png)\n\nåŠ å…¥æœ‰Organizationsï¼ˆç»„ç»‡ï¼‰çš„åŒå­¦å¯èƒ½ä¼šéœ€è¦é€‰æ‹©æ˜¯è‡ªå·±ä¸ªäººçš„é¡¹ç›®è¿˜æ˜¯çš„Organizationsï¼ˆç»„ç»‡ï¼‰é¡¹ç›®ã€‚\n\né€‰æ‹©å®Œä¹‹åå°±ä¼šå‡ºç°åœ¨è‡ªå·±çš„é¡¹ç›®é‡Œé¢äº†ã€‚\n\n\n\n### cloneä»£ç åˆ°æœ¬åœ°\n\nåœ¨è‡ªå·±çš„` repository`(ä»“åº“)é‡Œé¢æ‰¾åˆ°åˆšåˆš`fork`çš„é¡¹ç›®ï¼Œé€šå¸¸æ˜¯åŒåçš„ï¼Œç„¶å`clone`åˆ°è‡ªå·±çš„æœºå™¨ä¸Šé¢ä¹‹åã€‚\n\n\n\n### æ–°å»ºåˆ†æ”¯\n\nè™½ç„¶ï¼Œå¯ä»¥ä¸ç”¨æ–°å»ºåˆ†æ”¯ï¼Œç›´æ¥åœ¨masteråˆ†æ”¯ä¸Šé¢commitå’Œpushï¼Œä½†æ˜¯ï¼ä¸ç¬¦åˆè§„èŒƒï¼Œå› ä¸ºmasteråˆ†æ”¯æˆ‘ä»¬æ¥ä¸‹æ¥å¯èƒ½è¦ç”¨ä½œäºä¸çœŸæ­£çš„è¦ä¿®æ”¹çš„é¡¹ç›®çš„masterè”é€šè¦ç”¨çš„ï¼Œæ‰€ä»¥ï¼Œæœ€å¥½æ˜¯å†å¼„ä¸€ä¸ªåˆ†æ”¯æ¥åŒºåˆ«å¼€æ¥ï¼Œä¹‹åæ“ä½œå®Œå¯ä»¥åˆ é™¤ã€‚\n\nç†è®ºä¸Šæˆ‘ä»¬è¿˜æ˜¯è¦ç¬¦åˆä¸€ä¸ªè¿‡ç¨‹åŒ–çš„è§„èŒƒçš„ï¼Œè™½ç„¶ä¹Ÿå¯ä»¥ä¸ç”¨è¿™æ ·ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥å­¦ä¹ åˆ«çš„ä¼˜ç§€çš„å¼€æºä»£ç çš„è§„èŒƒæ¥å‘½åï¼Œå¸®åŠ©è‡ªå·±æå‰æ„Ÿå—ä¸€ä¸‹å¤§ç¥çš„æ„Ÿè§‰ã€‚\n\næˆ‘ä»¬æ ¹æ®masteråˆ†æ”¯æ–°å»ºå®Œåˆ†æ”¯ï¼Œç„¶ååˆ‡æ¢åˆ†æ”¯ä¹‹åå°±å¯ä»¥å¼€å§‹ä¿®æ”¹ä»£ç äº†ã€‚\n\n\n\n### æäº¤ä»£ç \n\nè¿™é‡Œè¦è¯´ä¸€ä¸‹ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæ¯ä¸ªå¼€æºåº“éƒ½æœ‰è‡ªå·±çš„ä»£ç è§„èŒƒï¼Œæ¯”å¦‚æˆ‘æœ€è¿‘å‚ä¸çš„[pro-components](https://github.com/ant-design/pro-components)è¿™ä¸ªé¡¹ç›®ï¼Œåªéœ€è¦ç¬¦åˆä»–çš„eslintè§„èŒƒå°±å¥½äº†ã€‚åé¢å¯èƒ½è¿˜ä¼šæ¶‰åŠåˆ°ä¸€äº›å•å…ƒæµ‹è¯•çš„é—®é¢˜ï¼Œåé¢ä¼šè¯´åˆ°ã€‚\n\nä½ æ”¹å®Œä¹‹åï¼Œå°±éœ€è¦commitäº†ï¼Œæœ‰çš„é¡¹ç›®ä¼šè¦æ±‚ä½ æŒ‰è§„èŒƒå†™commit messageã€‚æ¯”å¦‚[pro-components](https://github.com/ant-design/pro-components)è¿™ä¸ªé¡¹ç›®ï¼Œå¦‚å›¾\n\n![pornhub](/image/pr/commit.png)\n\næ˜¯çš„ï¼Œä½ å‘ç°äº†ï¼Œå·¦ä¸‹è§’æœ‰ä¸€ä¸ªè·³è¿‡...æœ€å¥½è¿˜æ˜¯è¦ç¬¦åˆè§„èŒƒï¼Œæ¯•ç«Ÿåœ¨åˆ«äººçš„åœ°ç›˜åŠäº‹ï¼Œè€Œä¸”ä½ çš„æ‰€æœ‰è®°å½•éƒ½æ˜¯å¯ä»¥æŸ¥çš„å“¦ï¼Œä»¥åè¢«äººæŸ¥ä½ çš„prï¼Œä¼šå‘ç°ä½ æ˜¯ä¸€ä¸ªä¼šè§„èŒƒçš„äººå¾ˆåŠ åˆ†å“¦ï¼ï¼\n\n\n\n### å¼€å§‹æPR\n\nè·‘è¿œäº†ï¼Œåœ¨æˆ‘ä»¬æ­£å¸¸çš„`commit`ï¼Œ `pull `ï¼Œ`push`ä¹‹åï¼Œå°±å¯ä»¥æ‰“å¼€æˆ‘ä»¬æƒ³ä¿®æ”¹çš„é‚£ä¸ªä»“åº“ã€‚\n\nä¼šåœ¨å¤´é¡¶å‡ºç°ä¸€ä¸ªä¸œè¥¿ã€‚\n\n![pornhub](/image/pr/push.png)\n\næˆ‘ä»¬éœ€è¦ç‚¹å‡»å›¾ä¸­æ¡†èµ·æ¥çš„ã€ŒCompare & pull request ã€ï¼Œä¹‹åå°±ä¼šå‡ºç°å¦‚ä¸‹å›¾\n\n![pornhub](/image/pr/create.png)\n\né»˜è®¤ä¼šå¸®æˆ‘ä»¬é€‰å¥½åˆ†æ”¯çš„ï¼Œæˆ‘ä»¬åªéœ€è¦å®Œå–„å…¶ä¸­çš„ä¿¡æ¯ï¼Œè¿˜æœ‰æˆ‘ä»¬ä¹‹å‰æäº¤çš„messageä¹Ÿå¯ä»¥ä¿®æ”¹ã€‚æœ€å¥½å¯ä»¥ç”¨è‹±æ–‡æ¥è§£é‡Šï¼Œæœ¬æ¬¡æäº¤çš„å†…å®¹ã€‚\n\nç„¶åç‚¹å‡»æäº¤ä¹‹åå°±å¥½äº†ã€‚\n\n\n\n#### æ–¹æ³•äºŒ\n\næˆ‘ä»¬å¯ä»¥ç›´æ¥ç‚¹å‡»\n\n![pornhub](/image/pr/pr.png)\n\nç„¶åé€‰æ‹©å’Œä¹‹å‰ä¸€æ ·çš„ä¸œè¥¿å°±å¥½ï¼Œå…·ä½“æ˜¯é€‰æ‹©é¡¹ç›®ä»¥åŠè¦åˆå¹¶çš„åˆ†æ”¯ï¼Œç„¶åå†™å†…å®¹ã€‚ç‚¹å‡»æäº¤ã€‚\n\n\n\n### åç»­\n\nä¸€ä¸ªä¼˜ç§€é¡¹ç›®é€šå¸¸ä¼šæœ‰ä»£ç å®¡æ ¸ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä½ å¯èƒ½éœ€è¦ä¿®æ”¹ä¸€ä¸‹æµ‹è¯•ç”¨ä¾‹ï¼Œç„¶åæˆ‘ä»¬åªéœ€è¦åœ¨å‰é¢åˆ›å»ºçš„åˆ†æ”¯ä¸Šç»§ç»­`push`å°±å¥½äº†ã€‚å¯èƒ½è¿˜ä¼šæœ‰ä½œè€…ç»™ä½ çš„æ„è§ã€‚æ”¹å®Œä¹‹åç»§ç»­`push`\n\n\n\n### å¡«å‘\n\n\n\nå‰é¢è¯´çš„ï¼Œæˆ‘ä»¬forkçš„åªæ˜¯å½“æ—¶çš„ä»£ç ï¼Œåç»­ä½œè€…æ›´æ–°çš„æˆ‘ä»¬éœ€è¦é‡æ–°æ‹‰å–ï¼Œæ“ä½œå¦‚ä¸‹ï¼š\n\n#### æ·»åŠ \n\n```\n$ git remote add upstream https://github.com/xx/xx.git\n```\n\n#### æŸ¥çœ‹\n\n```\n$ git remote -v \n\norigin\tssh://xxx (fetch)\norigin\tssh://xxx (push)\nupstream\tssh://yyy (fetch)\nupstream\tssh://yyy (push)\n```\n\n#### å–æ¶ˆ\n\n```\n$ git branch --unset-upstream\n```\n\n#### æ‹‰å–\n\nè¦†ç›–æœ¬åœ°çš„ masterã€‚\n\n```\n$ git fetch upstream\n$ git checkout master\n$ git rebase upstream/master\n```\n\n\n\n### æœ€å\n\nåªéœ€è¦ç­‰å¾…ä½œè€…`merge`å•¦ã€‚ç„¶åç¥å¤§å®¶é¡ºåˆ©ï¼Œæœ‰ä»»ä½•é—®é¢˜éƒ½å¯ä»¥åœ¨è¯„è®ºåŒºæŒ‡å‡ºæˆ–è€…äºæˆ‘è®¨è®ºã€‚","source":"_posts/ã€Œå¦‚ä½•ç»™githubæä¸€ä¸ªPRã€.md","raw":"---\ntitle: ã€Œå¦‚ä½•ç»™å¼€æºåº“æä¸€ä¸ªPRã€\ndate: 2021-01-22 16:39:14\ntags: [github]\ncategories: [github]\ncover: /image/cover/github.jpg\n---\n\n## å‰è¨€\n\nä¹‹å‰ä¸€ç›´æƒ³ç»™`github`ä¸Šé¢ä¼˜ç§€çš„é¡¹ç›®åšä¸€äº›åŠ›æ‰€èƒ½åŠçš„äº‹æƒ…ï¼Œæ¯”å¦‚è§£å†³ä¸€ä¸‹`issues`ï¼Œæˆ–è€…æä¸€ä¸ª`pr`ï¼Œä¿®æ”¹ä¸€ä¸‹`bug`ã€‚ä½†æ˜¯è‹¦äºä¸€ç›´ä¸çŸ¥é“æ€ä¹ˆæ­£ç¡®çš„å»åšè¿™ä»¶äº‹æƒ…ã€‚æ‰€ä»¥æç½®äº†ï¼Œåæ¥å‘ç°äº†[pro-components](https://github.com/ant-design/pro-components)è¿™ä¸ªé¡¹ç›®ï¼Œå’Œæˆ‘çš„ç†å¿µéå¸¸å¥‘åˆï¼Œå°±æ˜¯ä¸€ä¸ªåŒ…è£…ç‰ˆçš„[ant-design](https://github.com/ant-design/ant-design)ï¼Œå¯ä»¥æ›´å¿«æ›´å¥½çš„ä½¿ç”¨[ant-design](https://github.com/ant-design/ant-design)ã€‚\n\nå› ä¸ºä¸€ä¸ªæ¯”è¾ƒå‡ºåçš„é¡¹ç›®çš„`pr`ï¼Œå¯èƒ½åœ¨ç®€å†ç­›é€‰çš„æ—¶å€™ä¼šæ¯”è¾ƒåƒé¦™ï¼Œè¿™ä¸ªåº”è¯¥å¤§å®¶éƒ½çŸ¥é“ï¼Œè€Œä¸”è¿˜å¯ä»¥æ··ä¸ªè„¸ç†Ÿã€‚å“ˆå“ˆå“ˆã€‚\n\nä¸»è¦æ˜¯ä¸ºäº†è®°å½•è‡ªå·±çš„æ“ä½œè¿‡ç¨‹ï¼Œå’Œåˆ†äº«ã€‚\n\næ¥ä¸‹æ¥ä¼šæ¶‰åŠåˆ°å®é™…æ“ä½œï¼Œæ‰€ä»¥è¯·å¤§å®¶å…ˆç‚¹èµæ”¶è—å†çœ‹ã€‚\n\n## githubä¸‰ä¸ªæŒ‰é’®\n\næˆ‘ä»¬çŸ¥é“ï¼Œ`github`ä¸Šé¢çš„ä»£ç æ˜¯å¯ä»¥ç›´æ¥çœ‹çš„ï¼Œæ–¹å¼æœ‰ä»¥ä¸‹å‡ ç§ï¼š\n\n- ä¸‹è½½`zip`\n- `fork`åˆ°è‡ªå·±çš„é¡¹ç›®ä¸­ï¼Œç„¶åè‡ªå·±`clone`ä¸‹æ¥(é‡ç‚¹ä»‹ç»ï¼Œå’Œæ`pr`å¯†åˆ‡ç›¸å…³)\n- ç›´æ¥`clone`ä¸‹æ¥\n- åœ¨ç½‘é¡µä¸Šç›´æ¥è§‚çœ‹\n\n\n\næˆ‘ä»¬çœ‹åˆ°`github`é¡¹ç›®çš„æ—¶å€™ï¼Œå‘ç°ä¸ä»…æœ‰æˆ‘ä»¬éƒ½çŸ¥é“çš„`star`ï¼Œè¿˜æœ‰`watch`å’Œ`fork`ã€‚\n\n![pornhub](/image/pr/title.png)\n\n### Star\n\nè¿™é‡Œè¯´ç‚¹åºŸè¯ï¼Œå°ä¼™ä¼´æœ‰æ²¡æœ‰äººå’Œæˆ‘ä¸€æ ·è‹±è¯­ä¸å¥½ï¼Œç»å¸¸è®°æˆ`start`çš„ï¼ï¼ï¼\n\n`star` ç¿»è¯‘è¿‡æ¥åº”è¯¥æ˜¯æ˜Ÿæ˜Ÿï¼Œè¿™é‡Œè§£é‡Šä¸º`å…³æ³¨`æˆ–è€…`ç‚¹èµ`æ›´åˆé€‚\n\n`star`çš„è¯å°±ç›¸å½“äºæ˜¯æˆ‘ç»™è¿™ä¸ªé¡¹ç›®åšä¸€ä¸ªæ ‡è®°ï¼Œæˆ–è€…è¯´æ˜¯ç»™è¿™ä¸ªé¡¹ç›®ç‚¹äº†ä¸€ä¸ªã€Œå¥½è¯„ã€\n\né€šå¸¸æˆ‘ä»¬è®¤ä¸ºä¸€ä¸ªé¡¹ç›®çš„å—æ¬¢è¿ç¨‹åº¦åŸºæœ¬ä¸Šéƒ½æ˜¯ç”±staræ¥è¿›è¡Œè¯„åˆ¤çš„ã€‚ï¼ˆæ³¨æ„ï¼æ˜¯åŸºæœ¬ä¸Šï¼Œå½“ç„¶è¿˜æœ‰npmçš„ä¸‹è½½æ•°ï¼Œè¿™ä¸ªæœ‰ç‚¹ç±»å‹è§‚çœ‹æ•°\n\n![pornhub](/image/pr/pornhub.jpg)\n\næœ‰ç‚¹ç±»å‹ä¸Šå›¾çš„ï¼Œå–œæ¬¢æ•°ï¼ˆ`start`ï¼Œå’Œè§‚çœ‹æ¬¡æ•°ï¼ˆ`npm`ä¸‹è½½é‡\n\n\n\n### Watch\n\n`Watch`ç¿»è¯‘è¿‡æ¥å¯ä»¥ç§°ä¹‹ä¸ºè§‚å¯Ÿã€‚\n\né»˜è®¤æ¯ä¸€ä¸ªç”¨æˆ·éƒ½æ˜¯å¤„äº`Not watching`çš„çŠ¶æ€ï¼Œå½“ä½ é€‰æ‹©`Watching`ï¼Œè¡¨ç¤ºä½ ä»¥åä¼šå…³æ³¨è¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰åŠ¨æ€ï¼Œä»¥ååªè¦è¿™ä¸ªé¡¹ç›®å‘ç”Ÿå˜åŠ¨ï¼Œå¦‚è¢«åˆ«äººæäº¤äº†`pull request`ã€è¢«åˆ«äººå‘èµ·äº†`issue`ç­‰ç­‰æƒ…å†µï¼Œä½ éƒ½ä¼šåœ¨è‡ªå·±çš„ä¸ªäººé€šçŸ¥ä¸­å¿ƒï¼Œæ”¶åˆ°ä¸€æ¡é€šçŸ¥æ¶ˆæ¯ï¼Œå¦‚æœä½ è®¾ç½®äº†ä¸ªäººé‚®ç®±ï¼Œé‚£ä¹ˆä½ çš„é‚®ç®±ä¹Ÿå¯èƒ½æ”¶åˆ°ç›¸åº”çš„é‚®ä»¶ã€‚\n\nå¦‚æœä½ ä¸æƒ³æ¥å—è¿™äº›é€šçŸ¥ï¼Œé‚£ä¹ˆç‚¹å‡»` Not Watching` å³å¯ã€‚\n\n\n\n### Fork\n\nè¿™é‡Œè¦é‡ç‚¹è¯´ä¸€ä¸‹ï¼Œå› ä¸ºå’Œæˆ‘ä»¬ç°åœ¨çš„ä¸»é¢˜ï¼šRPï¼ˆPull Requestï¼‰æ¯æ¯ç›¸å…³ã€‚\n\n> æ¥ä¸‹æ¥è¦è¯´çš„prå°±æ˜¯pull request\n\nå½“é€‰æ‹©` fork`ï¼Œç›¸å½“äºä½ è‡ªå·±æœ‰äº†ä¸€ä»½åŸé¡¹ç›®çš„æ‹·è´ï¼Œå½“ç„¶è¿™ä¸ªæ‹·è´åªæ˜¯é’ˆå¯¹å½“æ—¶çš„é¡¹ç›®æ–‡ä»¶ï¼Œå¦‚æœåç»­åŸé¡¹ç›®æ–‡ä»¶å‘ç”Ÿæ”¹å˜ï¼Œä½ å¿…é¡»é€šè¿‡å…¶ä»–çš„æ–¹å¼å»åŒæ­¥ã€‚\n\nä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä½¿ç”¨` fork` è¿™ä¸ªåŠŸèƒ½ï¼Œè‡³å°‘æˆ‘ä¸€èˆ¬ä¸ä¼šç”¨ï¼Œé™¤éæœ‰ä¸€äº›é¡¹ç›®ï¼Œå¯èƒ½å­˜åœ¨` bug` æˆ–è€…å¯ä»¥ç»§ç»­ä¼˜åŒ–çš„åœ°æ–¹ï¼Œä½ æƒ³å¸®åŠ©åŸé¡¹ç›®ä½œè€…å»å®Œå–„è¿™ä¸ªé¡¹ç›®ï¼Œé‚£ä¹ˆä½ å¯ä»¥` fork `ä¸€ä»½é¡¹ç›®ä¸‹æ¥ï¼Œç„¶åè‡ªå·±å¯¹è¿™ä¸ªé¡¹ç›®è¿›è¡Œä¿®æ”¹å®Œå–„ï¼Œå½“ä½ è§‰å¾—é¡¹ç›®æ²¡é—®é¢˜äº†ï¼Œä½ å°±å¯ä»¥å°è¯•å‘èµ· `pull request`ç»™åŸé¡¹ç›®ä½œè€…äº†ï¼Œç„¶åå°±é™é™ç­‰å¾…ä»–çš„ `merge`ã€‚\n\nå½“å‰å¾ˆå¤šäººé”™è¯¯çš„åœ¨ä½¿ç”¨` fork`ã€‚å¾ˆå¤šäººæŠŠ` fork `å½“æˆäº†æ”¶è—ä¸€æ ·çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ä¸€å¼€å§‹ä½¿ç”¨ `github `çš„æˆ‘ï¼Œæ¯æ¬¡çœ‹åˆ°ä¸€ä¸ªå¥½çš„é¡¹ç›®å°±å…ˆ `fork`ï¼Œå› ä¸ºè¿™æ ·ï¼Œå°±å¯ä»¥æˆ‘çš„` repository`(ä»“åº“)åˆ—è¡¨ä¸‹æŸ¥çœ‹ `fork` çš„é¡¹ç›®äº†ã€‚\n\n> è€Œä¸”è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ä½ forkçš„æ˜¯å½“å‰ï¼Œæ­¤æ—¶æ­¤åˆ»çš„ä»£ç ï¼Œå‡å¦‚åç»­ä½œè€…æ›´æ–°äº†æ–°çš„å†…å®¹ï¼Œä½ forkçš„å°±ä¸ä¼šå˜ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªæ–¹å¼å¯ä»¥pullåˆ°æœ€æ–°çš„ä»£ç ï¼Œè¿™ä¸ªä¹Ÿæ˜¯å¾ˆé‡è¦çš„ï¼Œä¸å¦‚ä½ æäº¤ä½ çš„prçš„æ—¶å€™ï¼Œä¼šæœ‰å†²çª\n\næ€»å¾—æ¥è¯´ï¼Œ`fork`å°±æ˜¯ç»™æˆ‘ä»¬æ`pr`ä½¿ç”¨çš„ã€‚\n\n\n\n## å®æ“\n\n### forké¡¹ç›®åˆ°è‡ªå·±çš„ä»“åº“\n\næ‰¾åˆ°è‡ªå·±æƒ³è¦æprçš„é¡¹ç›®ï¼Œç„¶åç‚¹å‡»å›¾ä¸Šçš„ã€Œforkã€\n\n![pornhub](/image/pr/title.png)\n\nåŠ å…¥æœ‰Organizationsï¼ˆç»„ç»‡ï¼‰çš„åŒå­¦å¯èƒ½ä¼šéœ€è¦é€‰æ‹©æ˜¯è‡ªå·±ä¸ªäººçš„é¡¹ç›®è¿˜æ˜¯çš„Organizationsï¼ˆç»„ç»‡ï¼‰é¡¹ç›®ã€‚\n\né€‰æ‹©å®Œä¹‹åå°±ä¼šå‡ºç°åœ¨è‡ªå·±çš„é¡¹ç›®é‡Œé¢äº†ã€‚\n\n\n\n### cloneä»£ç åˆ°æœ¬åœ°\n\nåœ¨è‡ªå·±çš„` repository`(ä»“åº“)é‡Œé¢æ‰¾åˆ°åˆšåˆš`fork`çš„é¡¹ç›®ï¼Œé€šå¸¸æ˜¯åŒåçš„ï¼Œç„¶å`clone`åˆ°è‡ªå·±çš„æœºå™¨ä¸Šé¢ä¹‹åã€‚\n\n\n\n### æ–°å»ºåˆ†æ”¯\n\nè™½ç„¶ï¼Œå¯ä»¥ä¸ç”¨æ–°å»ºåˆ†æ”¯ï¼Œç›´æ¥åœ¨masteråˆ†æ”¯ä¸Šé¢commitå’Œpushï¼Œä½†æ˜¯ï¼ä¸ç¬¦åˆè§„èŒƒï¼Œå› ä¸ºmasteråˆ†æ”¯æˆ‘ä»¬æ¥ä¸‹æ¥å¯èƒ½è¦ç”¨ä½œäºä¸çœŸæ­£çš„è¦ä¿®æ”¹çš„é¡¹ç›®çš„masterè”é€šè¦ç”¨çš„ï¼Œæ‰€ä»¥ï¼Œæœ€å¥½æ˜¯å†å¼„ä¸€ä¸ªåˆ†æ”¯æ¥åŒºåˆ«å¼€æ¥ï¼Œä¹‹åæ“ä½œå®Œå¯ä»¥åˆ é™¤ã€‚\n\nç†è®ºä¸Šæˆ‘ä»¬è¿˜æ˜¯è¦ç¬¦åˆä¸€ä¸ªè¿‡ç¨‹åŒ–çš„è§„èŒƒçš„ï¼Œè™½ç„¶ä¹Ÿå¯ä»¥ä¸ç”¨è¿™æ ·ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥å­¦ä¹ åˆ«çš„ä¼˜ç§€çš„å¼€æºä»£ç çš„è§„èŒƒæ¥å‘½åï¼Œå¸®åŠ©è‡ªå·±æå‰æ„Ÿå—ä¸€ä¸‹å¤§ç¥çš„æ„Ÿè§‰ã€‚\n\næˆ‘ä»¬æ ¹æ®masteråˆ†æ”¯æ–°å»ºå®Œåˆ†æ”¯ï¼Œç„¶ååˆ‡æ¢åˆ†æ”¯ä¹‹åå°±å¯ä»¥å¼€å§‹ä¿®æ”¹ä»£ç äº†ã€‚\n\n\n\n### æäº¤ä»£ç \n\nè¿™é‡Œè¦è¯´ä¸€ä¸‹ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæ¯ä¸ªå¼€æºåº“éƒ½æœ‰è‡ªå·±çš„ä»£ç è§„èŒƒï¼Œæ¯”å¦‚æˆ‘æœ€è¿‘å‚ä¸çš„[pro-components](https://github.com/ant-design/pro-components)è¿™ä¸ªé¡¹ç›®ï¼Œåªéœ€è¦ç¬¦åˆä»–çš„eslintè§„èŒƒå°±å¥½äº†ã€‚åé¢å¯èƒ½è¿˜ä¼šæ¶‰åŠåˆ°ä¸€äº›å•å…ƒæµ‹è¯•çš„é—®é¢˜ï¼Œåé¢ä¼šè¯´åˆ°ã€‚\n\nä½ æ”¹å®Œä¹‹åï¼Œå°±éœ€è¦commitäº†ï¼Œæœ‰çš„é¡¹ç›®ä¼šè¦æ±‚ä½ æŒ‰è§„èŒƒå†™commit messageã€‚æ¯”å¦‚[pro-components](https://github.com/ant-design/pro-components)è¿™ä¸ªé¡¹ç›®ï¼Œå¦‚å›¾\n\n![pornhub](/image/pr/commit.png)\n\næ˜¯çš„ï¼Œä½ å‘ç°äº†ï¼Œå·¦ä¸‹è§’æœ‰ä¸€ä¸ªè·³è¿‡...æœ€å¥½è¿˜æ˜¯è¦ç¬¦åˆè§„èŒƒï¼Œæ¯•ç«Ÿåœ¨åˆ«äººçš„åœ°ç›˜åŠäº‹ï¼Œè€Œä¸”ä½ çš„æ‰€æœ‰è®°å½•éƒ½æ˜¯å¯ä»¥æŸ¥çš„å“¦ï¼Œä»¥åè¢«äººæŸ¥ä½ çš„prï¼Œä¼šå‘ç°ä½ æ˜¯ä¸€ä¸ªä¼šè§„èŒƒçš„äººå¾ˆåŠ åˆ†å“¦ï¼ï¼\n\n\n\n### å¼€å§‹æPR\n\nè·‘è¿œäº†ï¼Œåœ¨æˆ‘ä»¬æ­£å¸¸çš„`commit`ï¼Œ `pull `ï¼Œ`push`ä¹‹åï¼Œå°±å¯ä»¥æ‰“å¼€æˆ‘ä»¬æƒ³ä¿®æ”¹çš„é‚£ä¸ªä»“åº“ã€‚\n\nä¼šåœ¨å¤´é¡¶å‡ºç°ä¸€ä¸ªä¸œè¥¿ã€‚\n\n![pornhub](/image/pr/push.png)\n\næˆ‘ä»¬éœ€è¦ç‚¹å‡»å›¾ä¸­æ¡†èµ·æ¥çš„ã€ŒCompare & pull request ã€ï¼Œä¹‹åå°±ä¼šå‡ºç°å¦‚ä¸‹å›¾\n\n![pornhub](/image/pr/create.png)\n\né»˜è®¤ä¼šå¸®æˆ‘ä»¬é€‰å¥½åˆ†æ”¯çš„ï¼Œæˆ‘ä»¬åªéœ€è¦å®Œå–„å…¶ä¸­çš„ä¿¡æ¯ï¼Œè¿˜æœ‰æˆ‘ä»¬ä¹‹å‰æäº¤çš„messageä¹Ÿå¯ä»¥ä¿®æ”¹ã€‚æœ€å¥½å¯ä»¥ç”¨è‹±æ–‡æ¥è§£é‡Šï¼Œæœ¬æ¬¡æäº¤çš„å†…å®¹ã€‚\n\nç„¶åç‚¹å‡»æäº¤ä¹‹åå°±å¥½äº†ã€‚\n\n\n\n#### æ–¹æ³•äºŒ\n\næˆ‘ä»¬å¯ä»¥ç›´æ¥ç‚¹å‡»\n\n![pornhub](/image/pr/pr.png)\n\nç„¶åé€‰æ‹©å’Œä¹‹å‰ä¸€æ ·çš„ä¸œè¥¿å°±å¥½ï¼Œå…·ä½“æ˜¯é€‰æ‹©é¡¹ç›®ä»¥åŠè¦åˆå¹¶çš„åˆ†æ”¯ï¼Œç„¶åå†™å†…å®¹ã€‚ç‚¹å‡»æäº¤ã€‚\n\n\n\n### åç»­\n\nä¸€ä¸ªä¼˜ç§€é¡¹ç›®é€šå¸¸ä¼šæœ‰ä»£ç å®¡æ ¸ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä½ å¯èƒ½éœ€è¦ä¿®æ”¹ä¸€ä¸‹æµ‹è¯•ç”¨ä¾‹ï¼Œç„¶åæˆ‘ä»¬åªéœ€è¦åœ¨å‰é¢åˆ›å»ºçš„åˆ†æ”¯ä¸Šç»§ç»­`push`å°±å¥½äº†ã€‚å¯èƒ½è¿˜ä¼šæœ‰ä½œè€…ç»™ä½ çš„æ„è§ã€‚æ”¹å®Œä¹‹åç»§ç»­`push`\n\n\n\n### å¡«å‘\n\n\n\nå‰é¢è¯´çš„ï¼Œæˆ‘ä»¬forkçš„åªæ˜¯å½“æ—¶çš„ä»£ç ï¼Œåç»­ä½œè€…æ›´æ–°çš„æˆ‘ä»¬éœ€è¦é‡æ–°æ‹‰å–ï¼Œæ“ä½œå¦‚ä¸‹ï¼š\n\n#### æ·»åŠ \n\n```\n$ git remote add upstream https://github.com/xx/xx.git\n```\n\n#### æŸ¥çœ‹\n\n```\n$ git remote -v \n\norigin\tssh://xxx (fetch)\norigin\tssh://xxx (push)\nupstream\tssh://yyy (fetch)\nupstream\tssh://yyy (push)\n```\n\n#### å–æ¶ˆ\n\n```\n$ git branch --unset-upstream\n```\n\n#### æ‹‰å–\n\nè¦†ç›–æœ¬åœ°çš„ masterã€‚\n\n```\n$ git fetch upstream\n$ git checkout master\n$ git rebase upstream/master\n```\n\n\n\n### æœ€å\n\nåªéœ€è¦ç­‰å¾…ä½œè€…`merge`å•¦ã€‚ç„¶åç¥å¤§å®¶é¡ºåˆ©ï¼Œæœ‰ä»»ä½•é—®é¢˜éƒ½å¯ä»¥åœ¨è¯„è®ºåŒºæŒ‡å‡ºæˆ–è€…äºæˆ‘è®¨è®ºã€‚","slug":"ã€Œå¦‚ä½•ç»™githubæä¸€ä¸ªPRã€","published":1,"updated":"2021-06-24T14:00:06.849Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra81000wlwrdbwstad04","content":"<h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><p>ä¹‹å‰ä¸€ç›´æƒ³ç»™<code>github</code>ä¸Šé¢ä¼˜ç§€çš„é¡¹ç›®åšä¸€äº›åŠ›æ‰€èƒ½åŠçš„äº‹æƒ…ï¼Œæ¯”å¦‚è§£å†³ä¸€ä¸‹<code>issues</code>ï¼Œæˆ–è€…æä¸€ä¸ª<code>pr</code>ï¼Œä¿®æ”¹ä¸€ä¸‹<code>bug</code>ã€‚ä½†æ˜¯è‹¦äºä¸€ç›´ä¸çŸ¥é“æ€ä¹ˆæ­£ç¡®çš„å»åšè¿™ä»¶äº‹æƒ…ã€‚æ‰€ä»¥æç½®äº†ï¼Œåæ¥å‘ç°äº†<a href=\"https://github.com/ant-design/pro-components\" target=\"_blank\" rel=\"noopener\">pro-components</a>è¿™ä¸ªé¡¹ç›®ï¼Œå’Œæˆ‘çš„ç†å¿µéå¸¸å¥‘åˆï¼Œå°±æ˜¯ä¸€ä¸ªåŒ…è£…ç‰ˆçš„<a href=\"https://github.com/ant-design/ant-design\" target=\"_blank\" rel=\"noopener\">ant-design</a>ï¼Œå¯ä»¥æ›´å¿«æ›´å¥½çš„ä½¿ç”¨<a href=\"https://github.com/ant-design/ant-design\" target=\"_blank\" rel=\"noopener\">ant-design</a>ã€‚</p>\n<p>å› ä¸ºä¸€ä¸ªæ¯”è¾ƒå‡ºåçš„é¡¹ç›®çš„<code>pr</code>ï¼Œå¯èƒ½åœ¨ç®€å†ç­›é€‰çš„æ—¶å€™ä¼šæ¯”è¾ƒåƒé¦™ï¼Œè¿™ä¸ªåº”è¯¥å¤§å®¶éƒ½çŸ¥é“ï¼Œè€Œä¸”è¿˜å¯ä»¥æ··ä¸ªè„¸ç†Ÿã€‚å“ˆå“ˆå“ˆã€‚</p>\n<p>ä¸»è¦æ˜¯ä¸ºäº†è®°å½•è‡ªå·±çš„æ“ä½œè¿‡ç¨‹ï¼Œå’Œåˆ†äº«ã€‚</p>\n<p>æ¥ä¸‹æ¥ä¼šæ¶‰åŠåˆ°å®é™…æ“ä½œï¼Œæ‰€ä»¥è¯·å¤§å®¶å…ˆç‚¹èµæ”¶è—å†çœ‹ã€‚</p>\n<h2 id=\"githubä¸‰ä¸ªæŒ‰é’®\"><a href=\"#githubä¸‰ä¸ªæŒ‰é’®\" class=\"headerlink\" title=\"githubä¸‰ä¸ªæŒ‰é’®\"></a>githubä¸‰ä¸ªæŒ‰é’®</h2><p>æˆ‘ä»¬çŸ¥é“ï¼Œ<code>github</code>ä¸Šé¢çš„ä»£ç æ˜¯å¯ä»¥ç›´æ¥çœ‹çš„ï¼Œæ–¹å¼æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>\n<ul>\n<li>ä¸‹è½½<code>zip</code></li>\n<li><code>fork</code>åˆ°è‡ªå·±çš„é¡¹ç›®ä¸­ï¼Œç„¶åè‡ªå·±<code>clone</code>ä¸‹æ¥(é‡ç‚¹ä»‹ç»ï¼Œå’Œæ<code>pr</code>å¯†åˆ‡ç›¸å…³)</li>\n<li>ç›´æ¥<code>clone</code>ä¸‹æ¥</li>\n<li>åœ¨ç½‘é¡µä¸Šç›´æ¥è§‚çœ‹</li>\n</ul>\n<p>æˆ‘ä»¬çœ‹åˆ°<code>github</code>é¡¹ç›®çš„æ—¶å€™ï¼Œå‘ç°ä¸ä»…æœ‰æˆ‘ä»¬éƒ½çŸ¥é“çš„<code>star</code>ï¼Œè¿˜æœ‰<code>watch</code>å’Œ<code>fork</code>ã€‚</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/pr/title.png\"  alt=\"pornhub\"></p>\n<h3 id=\"Star\"><a href=\"#Star\" class=\"headerlink\" title=\"Star\"></a>Star</h3><p>è¿™é‡Œè¯´ç‚¹åºŸè¯ï¼Œå°ä¼™ä¼´æœ‰æ²¡æœ‰äººå’Œæˆ‘ä¸€æ ·è‹±è¯­ä¸å¥½ï¼Œç»å¸¸è®°æˆ<code>start</code>çš„ï¼ï¼ï¼</p>\n<p><code>star</code> ç¿»è¯‘è¿‡æ¥åº”è¯¥æ˜¯æ˜Ÿæ˜Ÿï¼Œè¿™é‡Œè§£é‡Šä¸º<code>å…³æ³¨</code>æˆ–è€…<code>ç‚¹èµ</code>æ›´åˆé€‚</p>\n<p><code>star</code>çš„è¯å°±ç›¸å½“äºæ˜¯æˆ‘ç»™è¿™ä¸ªé¡¹ç›®åšä¸€ä¸ªæ ‡è®°ï¼Œæˆ–è€…è¯´æ˜¯ç»™è¿™ä¸ªé¡¹ç›®ç‚¹äº†ä¸€ä¸ªã€Œå¥½è¯„ã€</p>\n<p>é€šå¸¸æˆ‘ä»¬è®¤ä¸ºä¸€ä¸ªé¡¹ç›®çš„å—æ¬¢è¿ç¨‹åº¦åŸºæœ¬ä¸Šéƒ½æ˜¯ç”±staræ¥è¿›è¡Œè¯„åˆ¤çš„ã€‚ï¼ˆæ³¨æ„ï¼æ˜¯åŸºæœ¬ä¸Šï¼Œå½“ç„¶è¿˜æœ‰npmçš„ä¸‹è½½æ•°ï¼Œè¿™ä¸ªæœ‰ç‚¹ç±»å‹è§‚çœ‹æ•°</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/pr/pornhub.jpg\"  alt=\"pornhub\"></p>\n<p>æœ‰ç‚¹ç±»å‹ä¸Šå›¾çš„ï¼Œå–œæ¬¢æ•°ï¼ˆ<code>start</code>ï¼Œå’Œè§‚çœ‹æ¬¡æ•°ï¼ˆ<code>npm</code>ä¸‹è½½é‡</p>\n<h3 id=\"Watch\"><a href=\"#Watch\" class=\"headerlink\" title=\"Watch\"></a>Watch</h3><p><code>Watch</code>ç¿»è¯‘è¿‡æ¥å¯ä»¥ç§°ä¹‹ä¸ºè§‚å¯Ÿã€‚</p>\n<p>é»˜è®¤æ¯ä¸€ä¸ªç”¨æˆ·éƒ½æ˜¯å¤„äº<code>Not watching</code>çš„çŠ¶æ€ï¼Œå½“ä½ é€‰æ‹©<code>Watching</code>ï¼Œè¡¨ç¤ºä½ ä»¥åä¼šå…³æ³¨è¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰åŠ¨æ€ï¼Œä»¥ååªè¦è¿™ä¸ªé¡¹ç›®å‘ç”Ÿå˜åŠ¨ï¼Œå¦‚è¢«åˆ«äººæäº¤äº†<code>pull request</code>ã€è¢«åˆ«äººå‘èµ·äº†<code>issue</code>ç­‰ç­‰æƒ…å†µï¼Œä½ éƒ½ä¼šåœ¨è‡ªå·±çš„ä¸ªäººé€šçŸ¥ä¸­å¿ƒï¼Œæ”¶åˆ°ä¸€æ¡é€šçŸ¥æ¶ˆæ¯ï¼Œå¦‚æœä½ è®¾ç½®äº†ä¸ªäººé‚®ç®±ï¼Œé‚£ä¹ˆä½ çš„é‚®ç®±ä¹Ÿå¯èƒ½æ”¶åˆ°ç›¸åº”çš„é‚®ä»¶ã€‚</p>\n<p>å¦‚æœä½ ä¸æƒ³æ¥å—è¿™äº›é€šçŸ¥ï¼Œé‚£ä¹ˆç‚¹å‡»<code>Not Watching</code> å³å¯ã€‚</p>\n<h3 id=\"Fork\"><a href=\"#Fork\" class=\"headerlink\" title=\"Fork\"></a>Fork</h3><p>è¿™é‡Œè¦é‡ç‚¹è¯´ä¸€ä¸‹ï¼Œå› ä¸ºå’Œæˆ‘ä»¬ç°åœ¨çš„ä¸»é¢˜ï¼šRPï¼ˆPull Requestï¼‰æ¯æ¯ç›¸å…³ã€‚</p>\n<blockquote>\n<p>æ¥ä¸‹æ¥è¦è¯´çš„prå°±æ˜¯pull request</p>\n</blockquote>\n<p>å½“é€‰æ‹©<code>fork</code>ï¼Œç›¸å½“äºä½ è‡ªå·±æœ‰äº†ä¸€ä»½åŸé¡¹ç›®çš„æ‹·è´ï¼Œå½“ç„¶è¿™ä¸ªæ‹·è´åªæ˜¯é’ˆå¯¹å½“æ—¶çš„é¡¹ç›®æ–‡ä»¶ï¼Œå¦‚æœåç»­åŸé¡¹ç›®æ–‡ä»¶å‘ç”Ÿæ”¹å˜ï¼Œä½ å¿…é¡»é€šè¿‡å…¶ä»–çš„æ–¹å¼å»åŒæ­¥ã€‚</p>\n<p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä½¿ç”¨<code>fork</code> è¿™ä¸ªåŠŸèƒ½ï¼Œè‡³å°‘æˆ‘ä¸€èˆ¬ä¸ä¼šç”¨ï¼Œé™¤éæœ‰ä¸€äº›é¡¹ç›®ï¼Œå¯èƒ½å­˜åœ¨<code>bug</code> æˆ–è€…å¯ä»¥ç»§ç»­ä¼˜åŒ–çš„åœ°æ–¹ï¼Œä½ æƒ³å¸®åŠ©åŸé¡¹ç›®ä½œè€…å»å®Œå–„è¿™ä¸ªé¡¹ç›®ï¼Œé‚£ä¹ˆä½ å¯ä»¥<code>fork</code>ä¸€ä»½é¡¹ç›®ä¸‹æ¥ï¼Œç„¶åè‡ªå·±å¯¹è¿™ä¸ªé¡¹ç›®è¿›è¡Œä¿®æ”¹å®Œå–„ï¼Œå½“ä½ è§‰å¾—é¡¹ç›®æ²¡é—®é¢˜äº†ï¼Œä½ å°±å¯ä»¥å°è¯•å‘èµ· <code>pull request</code>ç»™åŸé¡¹ç›®ä½œè€…äº†ï¼Œç„¶åå°±é™é™ç­‰å¾…ä»–çš„ <code>merge</code>ã€‚</p>\n<p>å½“å‰å¾ˆå¤šäººé”™è¯¯çš„åœ¨ä½¿ç”¨<code>fork</code>ã€‚å¾ˆå¤šäººæŠŠ<code>fork</code>å½“æˆäº†æ”¶è—ä¸€æ ·çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ä¸€å¼€å§‹ä½¿ç”¨ <code>github</code>çš„æˆ‘ï¼Œæ¯æ¬¡çœ‹åˆ°ä¸€ä¸ªå¥½çš„é¡¹ç›®å°±å…ˆ <code>fork</code>ï¼Œå› ä¸ºè¿™æ ·ï¼Œå°±å¯ä»¥æˆ‘çš„<code>repository</code>(ä»“åº“)åˆ—è¡¨ä¸‹æŸ¥çœ‹ <code>fork</code> çš„é¡¹ç›®äº†ã€‚</p>\n<blockquote>\n<p>è€Œä¸”è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ä½ forkçš„æ˜¯å½“å‰ï¼Œæ­¤æ—¶æ­¤åˆ»çš„ä»£ç ï¼Œå‡å¦‚åç»­ä½œè€…æ›´æ–°äº†æ–°çš„å†…å®¹ï¼Œä½ forkçš„å°±ä¸ä¼šå˜ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªæ–¹å¼å¯ä»¥pullåˆ°æœ€æ–°çš„ä»£ç ï¼Œè¿™ä¸ªä¹Ÿæ˜¯å¾ˆé‡è¦çš„ï¼Œä¸å¦‚ä½ æäº¤ä½ çš„prçš„æ—¶å€™ï¼Œä¼šæœ‰å†²çª</p>\n</blockquote>\n<p>æ€»å¾—æ¥è¯´ï¼Œ<code>fork</code>å°±æ˜¯ç»™æˆ‘ä»¬æ<code>pr</code>ä½¿ç”¨çš„ã€‚</p>\n<h2 id=\"å®æ“\"><a href=\"#å®æ“\" class=\"headerlink\" title=\"å®æ“\"></a>å®æ“</h2><h3 id=\"forké¡¹ç›®åˆ°è‡ªå·±çš„ä»“åº“\"><a href=\"#forké¡¹ç›®åˆ°è‡ªå·±çš„ä»“åº“\" class=\"headerlink\" title=\"forké¡¹ç›®åˆ°è‡ªå·±çš„ä»“åº“\"></a>forké¡¹ç›®åˆ°è‡ªå·±çš„ä»“åº“</h3><p>æ‰¾åˆ°è‡ªå·±æƒ³è¦æprçš„é¡¹ç›®ï¼Œç„¶åç‚¹å‡»å›¾ä¸Šçš„ã€Œforkã€</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/pr/title.png\"  alt=\"pornhub\"></p>\n<p>åŠ å…¥æœ‰Organizationsï¼ˆç»„ç»‡ï¼‰çš„åŒå­¦å¯èƒ½ä¼šéœ€è¦é€‰æ‹©æ˜¯è‡ªå·±ä¸ªäººçš„é¡¹ç›®è¿˜æ˜¯çš„Organizationsï¼ˆç»„ç»‡ï¼‰é¡¹ç›®ã€‚</p>\n<p>é€‰æ‹©å®Œä¹‹åå°±ä¼šå‡ºç°åœ¨è‡ªå·±çš„é¡¹ç›®é‡Œé¢äº†ã€‚</p>\n<h3 id=\"cloneä»£ç åˆ°æœ¬åœ°\"><a href=\"#cloneä»£ç åˆ°æœ¬åœ°\" class=\"headerlink\" title=\"cloneä»£ç åˆ°æœ¬åœ°\"></a>cloneä»£ç åˆ°æœ¬åœ°</h3><p>åœ¨è‡ªå·±çš„<code>repository</code>(ä»“åº“)é‡Œé¢æ‰¾åˆ°åˆšåˆš<code>fork</code>çš„é¡¹ç›®ï¼Œé€šå¸¸æ˜¯åŒåçš„ï¼Œç„¶å<code>clone</code>åˆ°è‡ªå·±çš„æœºå™¨ä¸Šé¢ä¹‹åã€‚</p>\n<h3 id=\"æ–°å»ºåˆ†æ”¯\"><a href=\"#æ–°å»ºåˆ†æ”¯\" class=\"headerlink\" title=\"æ–°å»ºåˆ†æ”¯\"></a>æ–°å»ºåˆ†æ”¯</h3><p>è™½ç„¶ï¼Œå¯ä»¥ä¸ç”¨æ–°å»ºåˆ†æ”¯ï¼Œç›´æ¥åœ¨masteråˆ†æ”¯ä¸Šé¢commitå’Œpushï¼Œä½†æ˜¯ï¼ä¸ç¬¦åˆè§„èŒƒï¼Œå› ä¸ºmasteråˆ†æ”¯æˆ‘ä»¬æ¥ä¸‹æ¥å¯èƒ½è¦ç”¨ä½œäºä¸çœŸæ­£çš„è¦ä¿®æ”¹çš„é¡¹ç›®çš„masterè”é€šè¦ç”¨çš„ï¼Œæ‰€ä»¥ï¼Œæœ€å¥½æ˜¯å†å¼„ä¸€ä¸ªåˆ†æ”¯æ¥åŒºåˆ«å¼€æ¥ï¼Œä¹‹åæ“ä½œå®Œå¯ä»¥åˆ é™¤ã€‚</p>\n<p>ç†è®ºä¸Šæˆ‘ä»¬è¿˜æ˜¯è¦ç¬¦åˆä¸€ä¸ªè¿‡ç¨‹åŒ–çš„è§„èŒƒçš„ï¼Œè™½ç„¶ä¹Ÿå¯ä»¥ä¸ç”¨è¿™æ ·ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥å­¦ä¹ åˆ«çš„ä¼˜ç§€çš„å¼€æºä»£ç çš„è§„èŒƒæ¥å‘½åï¼Œå¸®åŠ©è‡ªå·±æå‰æ„Ÿå—ä¸€ä¸‹å¤§ç¥çš„æ„Ÿè§‰ã€‚</p>\n<p>æˆ‘ä»¬æ ¹æ®masteråˆ†æ”¯æ–°å»ºå®Œåˆ†æ”¯ï¼Œç„¶ååˆ‡æ¢åˆ†æ”¯ä¹‹åå°±å¯ä»¥å¼€å§‹ä¿®æ”¹ä»£ç äº†ã€‚</p>\n<h3 id=\"æäº¤ä»£ç \"><a href=\"#æäº¤ä»£ç \" class=\"headerlink\" title=\"æäº¤ä»£ç \"></a>æäº¤ä»£ç </h3><p>è¿™é‡Œè¦è¯´ä¸€ä¸‹ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæ¯ä¸ªå¼€æºåº“éƒ½æœ‰è‡ªå·±çš„ä»£ç è§„èŒƒï¼Œæ¯”å¦‚æˆ‘æœ€è¿‘å‚ä¸çš„<a href=\"https://github.com/ant-design/pro-components\" target=\"_blank\" rel=\"noopener\">pro-components</a>è¿™ä¸ªé¡¹ç›®ï¼Œåªéœ€è¦ç¬¦åˆä»–çš„eslintè§„èŒƒå°±å¥½äº†ã€‚åé¢å¯èƒ½è¿˜ä¼šæ¶‰åŠåˆ°ä¸€äº›å•å…ƒæµ‹è¯•çš„é—®é¢˜ï¼Œåé¢ä¼šè¯´åˆ°ã€‚</p>\n<p>ä½ æ”¹å®Œä¹‹åï¼Œå°±éœ€è¦commitäº†ï¼Œæœ‰çš„é¡¹ç›®ä¼šè¦æ±‚ä½ æŒ‰è§„èŒƒå†™commit messageã€‚æ¯”å¦‚<a href=\"https://github.com/ant-design/pro-components\" target=\"_blank\" rel=\"noopener\">pro-components</a>è¿™ä¸ªé¡¹ç›®ï¼Œå¦‚å›¾</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/pr/commit.png\"  alt=\"pornhub\"></p>\n<p>æ˜¯çš„ï¼Œä½ å‘ç°äº†ï¼Œå·¦ä¸‹è§’æœ‰ä¸€ä¸ªè·³è¿‡â€¦æœ€å¥½è¿˜æ˜¯è¦ç¬¦åˆè§„èŒƒï¼Œæ¯•ç«Ÿåœ¨åˆ«äººçš„åœ°ç›˜åŠäº‹ï¼Œè€Œä¸”ä½ çš„æ‰€æœ‰è®°å½•éƒ½æ˜¯å¯ä»¥æŸ¥çš„å“¦ï¼Œä»¥åè¢«äººæŸ¥ä½ çš„prï¼Œä¼šå‘ç°ä½ æ˜¯ä¸€ä¸ªä¼šè§„èŒƒçš„äººå¾ˆåŠ åˆ†å“¦ï¼ï¼</p>\n<h3 id=\"å¼€å§‹æPR\"><a href=\"#å¼€å§‹æPR\" class=\"headerlink\" title=\"å¼€å§‹æPR\"></a>å¼€å§‹æPR</h3><p>è·‘è¿œäº†ï¼Œåœ¨æˆ‘ä»¬æ­£å¸¸çš„<code>commit</code>ï¼Œ <code>pull</code>ï¼Œ<code>push</code>ä¹‹åï¼Œå°±å¯ä»¥æ‰“å¼€æˆ‘ä»¬æƒ³ä¿®æ”¹çš„é‚£ä¸ªä»“åº“ã€‚</p>\n<p>ä¼šåœ¨å¤´é¡¶å‡ºç°ä¸€ä¸ªä¸œè¥¿ã€‚</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/pr/push.png\"  alt=\"pornhub\"></p>\n<p>æˆ‘ä»¬éœ€è¦ç‚¹å‡»å›¾ä¸­æ¡†èµ·æ¥çš„ã€ŒCompare &amp; pull request ã€ï¼Œä¹‹åå°±ä¼šå‡ºç°å¦‚ä¸‹å›¾</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/pr/create.png\"  alt=\"pornhub\"></p>\n<p>é»˜è®¤ä¼šå¸®æˆ‘ä»¬é€‰å¥½åˆ†æ”¯çš„ï¼Œæˆ‘ä»¬åªéœ€è¦å®Œå–„å…¶ä¸­çš„ä¿¡æ¯ï¼Œè¿˜æœ‰æˆ‘ä»¬ä¹‹å‰æäº¤çš„messageä¹Ÿå¯ä»¥ä¿®æ”¹ã€‚æœ€å¥½å¯ä»¥ç”¨è‹±æ–‡æ¥è§£é‡Šï¼Œæœ¬æ¬¡æäº¤çš„å†…å®¹ã€‚</p>\n<p>ç„¶åç‚¹å‡»æäº¤ä¹‹åå°±å¥½äº†ã€‚</p>\n<h4 id=\"æ–¹æ³•äºŒ\"><a href=\"#æ–¹æ³•äºŒ\" class=\"headerlink\" title=\"æ–¹æ³•äºŒ\"></a>æ–¹æ³•äºŒ</h4><p>æˆ‘ä»¬å¯ä»¥ç›´æ¥ç‚¹å‡»</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/pr/pr.png\"  alt=\"pornhub\"></p>\n<p>ç„¶åé€‰æ‹©å’Œä¹‹å‰ä¸€æ ·çš„ä¸œè¥¿å°±å¥½ï¼Œå…·ä½“æ˜¯é€‰æ‹©é¡¹ç›®ä»¥åŠè¦åˆå¹¶çš„åˆ†æ”¯ï¼Œç„¶åå†™å†…å®¹ã€‚ç‚¹å‡»æäº¤ã€‚</p>\n<h3 id=\"åç»­\"><a href=\"#åç»­\" class=\"headerlink\" title=\"åç»­\"></a>åç»­</h3><p>ä¸€ä¸ªä¼˜ç§€é¡¹ç›®é€šå¸¸ä¼šæœ‰ä»£ç å®¡æ ¸ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä½ å¯èƒ½éœ€è¦ä¿®æ”¹ä¸€ä¸‹æµ‹è¯•ç”¨ä¾‹ï¼Œç„¶åæˆ‘ä»¬åªéœ€è¦åœ¨å‰é¢åˆ›å»ºçš„åˆ†æ”¯ä¸Šç»§ç»­<code>push</code>å°±å¥½äº†ã€‚å¯èƒ½è¿˜ä¼šæœ‰ä½œè€…ç»™ä½ çš„æ„è§ã€‚æ”¹å®Œä¹‹åç»§ç»­<code>push</code></p>\n<h3 id=\"å¡«å‘\"><a href=\"#å¡«å‘\" class=\"headerlink\" title=\"å¡«å‘\"></a>å¡«å‘</h3><p>å‰é¢è¯´çš„ï¼Œæˆ‘ä»¬forkçš„åªæ˜¯å½“æ—¶çš„ä»£ç ï¼Œåç»­ä½œè€…æ›´æ–°çš„æˆ‘ä»¬éœ€è¦é‡æ–°æ‹‰å–ï¼Œæ“ä½œå¦‚ä¸‹ï¼š</p>\n<h4 id=\"æ·»åŠ \"><a href=\"#æ·»åŠ \" class=\"headerlink\" title=\"æ·»åŠ \"></a>æ·»åŠ </h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git remote add upstream https:&#x2F;&#x2F;github.com&#x2F;xx&#x2F;xx.git</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"æŸ¥çœ‹\"><a href=\"#æŸ¥çœ‹\" class=\"headerlink\" title=\"æŸ¥çœ‹\"></a>æŸ¥çœ‹</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git remote -v </span><br><span class=\"line\"></span><br><span class=\"line\">origin\tssh:&#x2F;&#x2F;xxx (fetch)</span><br><span class=\"line\">origin\tssh:&#x2F;&#x2F;xxx (push)</span><br><span class=\"line\">upstream\tssh:&#x2F;&#x2F;yyy (fetch)</span><br><span class=\"line\">upstream\tssh:&#x2F;&#x2F;yyy (push)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"å–æ¶ˆ\"><a href=\"#å–æ¶ˆ\" class=\"headerlink\" title=\"å–æ¶ˆ\"></a>å–æ¶ˆ</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git branch --unset-upstream</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"æ‹‰å–\"><a href=\"#æ‹‰å–\" class=\"headerlink\" title=\"æ‹‰å–\"></a>æ‹‰å–</h4><p>è¦†ç›–æœ¬åœ°çš„ masterã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git fetch upstream</span><br><span class=\"line\">$ git checkout master</span><br><span class=\"line\">$ git rebase upstream&#x2F;master</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"æœ€å\"><a href=\"#æœ€å\" class=\"headerlink\" title=\"æœ€å\"></a>æœ€å</h3><p>åªéœ€è¦ç­‰å¾…ä½œè€…<code>merge</code>å•¦ã€‚ç„¶åç¥å¤§å®¶é¡ºåˆ©ï¼Œæœ‰ä»»ä½•é—®é¢˜éƒ½å¯ä»¥åœ¨è¯„è®ºåŒºæŒ‡å‡ºæˆ–è€…äºæˆ‘è®¨è®ºã€‚</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><p>ä¹‹å‰ä¸€ç›´æƒ³ç»™<code>github</code>ä¸Šé¢ä¼˜ç§€çš„é¡¹ç›®åšä¸€äº›åŠ›æ‰€èƒ½åŠçš„äº‹æƒ…ï¼Œæ¯”å¦‚è§£å†³ä¸€ä¸‹<code>issues</code>ï¼Œæˆ–è€…æä¸€ä¸ª<code>pr</code>ï¼Œä¿®æ”¹ä¸€ä¸‹<code>bug</code>ã€‚ä½†æ˜¯è‹¦äºä¸€ç›´ä¸çŸ¥é“æ€ä¹ˆæ­£ç¡®çš„å»åšè¿™ä»¶äº‹æƒ…ã€‚æ‰€ä»¥æç½®äº†ï¼Œåæ¥å‘ç°äº†<a href=\"https://github.com/ant-design/pro-components\" target=\"_blank\" rel=\"noopener\">pro-components</a>è¿™ä¸ªé¡¹ç›®ï¼Œå’Œæˆ‘çš„ç†å¿µéå¸¸å¥‘åˆï¼Œå°±æ˜¯ä¸€ä¸ªåŒ…è£…ç‰ˆçš„<a href=\"https://github.com/ant-design/ant-design\" target=\"_blank\" rel=\"noopener\">ant-design</a>ï¼Œå¯ä»¥æ›´å¿«æ›´å¥½çš„ä½¿ç”¨<a href=\"https://github.com/ant-design/ant-design\" target=\"_blank\" rel=\"noopener\">ant-design</a>ã€‚</p>\n<p>å› ä¸ºä¸€ä¸ªæ¯”è¾ƒå‡ºåçš„é¡¹ç›®çš„<code>pr</code>ï¼Œå¯èƒ½åœ¨ç®€å†ç­›é€‰çš„æ—¶å€™ä¼šæ¯”è¾ƒåƒé¦™ï¼Œè¿™ä¸ªåº”è¯¥å¤§å®¶éƒ½çŸ¥é“ï¼Œè€Œä¸”è¿˜å¯ä»¥æ··ä¸ªè„¸ç†Ÿã€‚å“ˆå“ˆå“ˆã€‚</p>\n<p>ä¸»è¦æ˜¯ä¸ºäº†è®°å½•è‡ªå·±çš„æ“ä½œè¿‡ç¨‹ï¼Œå’Œåˆ†äº«ã€‚</p>\n<p>æ¥ä¸‹æ¥ä¼šæ¶‰åŠåˆ°å®é™…æ“ä½œï¼Œæ‰€ä»¥è¯·å¤§å®¶å…ˆç‚¹èµæ”¶è—å†çœ‹ã€‚</p>\n<h2 id=\"githubä¸‰ä¸ªæŒ‰é’®\"><a href=\"#githubä¸‰ä¸ªæŒ‰é’®\" class=\"headerlink\" title=\"githubä¸‰ä¸ªæŒ‰é’®\"></a>githubä¸‰ä¸ªæŒ‰é’®</h2><p>æˆ‘ä»¬çŸ¥é“ï¼Œ<code>github</code>ä¸Šé¢çš„ä»£ç æ˜¯å¯ä»¥ç›´æ¥çœ‹çš„ï¼Œæ–¹å¼æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>\n<ul>\n<li>ä¸‹è½½<code>zip</code></li>\n<li><code>fork</code>åˆ°è‡ªå·±çš„é¡¹ç›®ä¸­ï¼Œç„¶åè‡ªå·±<code>clone</code>ä¸‹æ¥(é‡ç‚¹ä»‹ç»ï¼Œå’Œæ<code>pr</code>å¯†åˆ‡ç›¸å…³)</li>\n<li>ç›´æ¥<code>clone</code>ä¸‹æ¥</li>\n<li>åœ¨ç½‘é¡µä¸Šç›´æ¥è§‚çœ‹</li>\n</ul>\n<p>æˆ‘ä»¬çœ‹åˆ°<code>github</code>é¡¹ç›®çš„æ—¶å€™ï¼Œå‘ç°ä¸ä»…æœ‰æˆ‘ä»¬éƒ½çŸ¥é“çš„<code>star</code>ï¼Œè¿˜æœ‰<code>watch</code>å’Œ<code>fork</code>ã€‚</p>\n<p><img src=\"/image/pr/title.png\" alt=\"pornhub\"></p>\n<h3 id=\"Star\"><a href=\"#Star\" class=\"headerlink\" title=\"Star\"></a>Star</h3><p>è¿™é‡Œè¯´ç‚¹åºŸè¯ï¼Œå°ä¼™ä¼´æœ‰æ²¡æœ‰äººå’Œæˆ‘ä¸€æ ·è‹±è¯­ä¸å¥½ï¼Œç»å¸¸è®°æˆ<code>start</code>çš„ï¼ï¼ï¼</p>\n<p><code>star</code> ç¿»è¯‘è¿‡æ¥åº”è¯¥æ˜¯æ˜Ÿæ˜Ÿï¼Œè¿™é‡Œè§£é‡Šä¸º<code>å…³æ³¨</code>æˆ–è€…<code>ç‚¹èµ</code>æ›´åˆé€‚</p>\n<p><code>star</code>çš„è¯å°±ç›¸å½“äºæ˜¯æˆ‘ç»™è¿™ä¸ªé¡¹ç›®åšä¸€ä¸ªæ ‡è®°ï¼Œæˆ–è€…è¯´æ˜¯ç»™è¿™ä¸ªé¡¹ç›®ç‚¹äº†ä¸€ä¸ªã€Œå¥½è¯„ã€</p>\n<p>é€šå¸¸æˆ‘ä»¬è®¤ä¸ºä¸€ä¸ªé¡¹ç›®çš„å—æ¬¢è¿ç¨‹åº¦åŸºæœ¬ä¸Šéƒ½æ˜¯ç”±staræ¥è¿›è¡Œè¯„åˆ¤çš„ã€‚ï¼ˆæ³¨æ„ï¼æ˜¯åŸºæœ¬ä¸Šï¼Œå½“ç„¶è¿˜æœ‰npmçš„ä¸‹è½½æ•°ï¼Œè¿™ä¸ªæœ‰ç‚¹ç±»å‹è§‚çœ‹æ•°</p>\n<p><img src=\"/image/pr/pornhub.jpg\" alt=\"pornhub\"></p>\n<p>æœ‰ç‚¹ç±»å‹ä¸Šå›¾çš„ï¼Œå–œæ¬¢æ•°ï¼ˆ<code>start</code>ï¼Œå’Œè§‚çœ‹æ¬¡æ•°ï¼ˆ<code>npm</code>ä¸‹è½½é‡</p>\n<h3 id=\"Watch\"><a href=\"#Watch\" class=\"headerlink\" title=\"Watch\"></a>Watch</h3><p><code>Watch</code>ç¿»è¯‘è¿‡æ¥å¯ä»¥ç§°ä¹‹ä¸ºè§‚å¯Ÿã€‚</p>\n<p>é»˜è®¤æ¯ä¸€ä¸ªç”¨æˆ·éƒ½æ˜¯å¤„äº<code>Not watching</code>çš„çŠ¶æ€ï¼Œå½“ä½ é€‰æ‹©<code>Watching</code>ï¼Œè¡¨ç¤ºä½ ä»¥åä¼šå…³æ³¨è¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰åŠ¨æ€ï¼Œä»¥ååªè¦è¿™ä¸ªé¡¹ç›®å‘ç”Ÿå˜åŠ¨ï¼Œå¦‚è¢«åˆ«äººæäº¤äº†<code>pull request</code>ã€è¢«åˆ«äººå‘èµ·äº†<code>issue</code>ç­‰ç­‰æƒ…å†µï¼Œä½ éƒ½ä¼šåœ¨è‡ªå·±çš„ä¸ªäººé€šçŸ¥ä¸­å¿ƒï¼Œæ”¶åˆ°ä¸€æ¡é€šçŸ¥æ¶ˆæ¯ï¼Œå¦‚æœä½ è®¾ç½®äº†ä¸ªäººé‚®ç®±ï¼Œé‚£ä¹ˆä½ çš„é‚®ç®±ä¹Ÿå¯èƒ½æ”¶åˆ°ç›¸åº”çš„é‚®ä»¶ã€‚</p>\n<p>å¦‚æœä½ ä¸æƒ³æ¥å—è¿™äº›é€šçŸ¥ï¼Œé‚£ä¹ˆç‚¹å‡»<code>Not Watching</code> å³å¯ã€‚</p>\n<h3 id=\"Fork\"><a href=\"#Fork\" class=\"headerlink\" title=\"Fork\"></a>Fork</h3><p>è¿™é‡Œè¦é‡ç‚¹è¯´ä¸€ä¸‹ï¼Œå› ä¸ºå’Œæˆ‘ä»¬ç°åœ¨çš„ä¸»é¢˜ï¼šRPï¼ˆPull Requestï¼‰æ¯æ¯ç›¸å…³ã€‚</p>\n<blockquote>\n<p>æ¥ä¸‹æ¥è¦è¯´çš„prå°±æ˜¯pull request</p>\n</blockquote>\n<p>å½“é€‰æ‹©<code>fork</code>ï¼Œç›¸å½“äºä½ è‡ªå·±æœ‰äº†ä¸€ä»½åŸé¡¹ç›®çš„æ‹·è´ï¼Œå½“ç„¶è¿™ä¸ªæ‹·è´åªæ˜¯é’ˆå¯¹å½“æ—¶çš„é¡¹ç›®æ–‡ä»¶ï¼Œå¦‚æœåç»­åŸé¡¹ç›®æ–‡ä»¶å‘ç”Ÿæ”¹å˜ï¼Œä½ å¿…é¡»é€šè¿‡å…¶ä»–çš„æ–¹å¼å»åŒæ­¥ã€‚</p>\n<p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä½¿ç”¨<code>fork</code> è¿™ä¸ªåŠŸèƒ½ï¼Œè‡³å°‘æˆ‘ä¸€èˆ¬ä¸ä¼šç”¨ï¼Œé™¤éæœ‰ä¸€äº›é¡¹ç›®ï¼Œå¯èƒ½å­˜åœ¨<code>bug</code> æˆ–è€…å¯ä»¥ç»§ç»­ä¼˜åŒ–çš„åœ°æ–¹ï¼Œä½ æƒ³å¸®åŠ©åŸé¡¹ç›®ä½œè€…å»å®Œå–„è¿™ä¸ªé¡¹ç›®ï¼Œé‚£ä¹ˆä½ å¯ä»¥<code>fork</code>ä¸€ä»½é¡¹ç›®ä¸‹æ¥ï¼Œç„¶åè‡ªå·±å¯¹è¿™ä¸ªé¡¹ç›®è¿›è¡Œä¿®æ”¹å®Œå–„ï¼Œå½“ä½ è§‰å¾—é¡¹ç›®æ²¡é—®é¢˜äº†ï¼Œä½ å°±å¯ä»¥å°è¯•å‘èµ· <code>pull request</code>ç»™åŸé¡¹ç›®ä½œè€…äº†ï¼Œç„¶åå°±é™é™ç­‰å¾…ä»–çš„ <code>merge</code>ã€‚</p>\n<p>å½“å‰å¾ˆå¤šäººé”™è¯¯çš„åœ¨ä½¿ç”¨<code>fork</code>ã€‚å¾ˆå¤šäººæŠŠ<code>fork</code>å½“æˆäº†æ”¶è—ä¸€æ ·çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ä¸€å¼€å§‹ä½¿ç”¨ <code>github</code>çš„æˆ‘ï¼Œæ¯æ¬¡çœ‹åˆ°ä¸€ä¸ªå¥½çš„é¡¹ç›®å°±å…ˆ <code>fork</code>ï¼Œå› ä¸ºè¿™æ ·ï¼Œå°±å¯ä»¥æˆ‘çš„<code>repository</code>(ä»“åº“)åˆ—è¡¨ä¸‹æŸ¥çœ‹ <code>fork</code> çš„é¡¹ç›®äº†ã€‚</p>\n<blockquote>\n<p>è€Œä¸”è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ä½ forkçš„æ˜¯å½“å‰ï¼Œæ­¤æ—¶æ­¤åˆ»çš„ä»£ç ï¼Œå‡å¦‚åç»­ä½œè€…æ›´æ–°äº†æ–°çš„å†…å®¹ï¼Œä½ forkçš„å°±ä¸ä¼šå˜ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªæ–¹å¼å¯ä»¥pullåˆ°æœ€æ–°çš„ä»£ç ï¼Œè¿™ä¸ªä¹Ÿæ˜¯å¾ˆé‡è¦çš„ï¼Œä¸å¦‚ä½ æäº¤ä½ çš„prçš„æ—¶å€™ï¼Œä¼šæœ‰å†²çª</p>\n</blockquote>\n<p>æ€»å¾—æ¥è¯´ï¼Œ<code>fork</code>å°±æ˜¯ç»™æˆ‘ä»¬æ<code>pr</code>ä½¿ç”¨çš„ã€‚</p>\n<h2 id=\"å®æ“\"><a href=\"#å®æ“\" class=\"headerlink\" title=\"å®æ“\"></a>å®æ“</h2><h3 id=\"forké¡¹ç›®åˆ°è‡ªå·±çš„ä»“åº“\"><a href=\"#forké¡¹ç›®åˆ°è‡ªå·±çš„ä»“åº“\" class=\"headerlink\" title=\"forké¡¹ç›®åˆ°è‡ªå·±çš„ä»“åº“\"></a>forké¡¹ç›®åˆ°è‡ªå·±çš„ä»“åº“</h3><p>æ‰¾åˆ°è‡ªå·±æƒ³è¦æprçš„é¡¹ç›®ï¼Œç„¶åç‚¹å‡»å›¾ä¸Šçš„ã€Œforkã€</p>\n<p><img src=\"/image/pr/title.png\" alt=\"pornhub\"></p>\n<p>åŠ å…¥æœ‰Organizationsï¼ˆç»„ç»‡ï¼‰çš„åŒå­¦å¯èƒ½ä¼šéœ€è¦é€‰æ‹©æ˜¯è‡ªå·±ä¸ªäººçš„é¡¹ç›®è¿˜æ˜¯çš„Organizationsï¼ˆç»„ç»‡ï¼‰é¡¹ç›®ã€‚</p>\n<p>é€‰æ‹©å®Œä¹‹åå°±ä¼šå‡ºç°åœ¨è‡ªå·±çš„é¡¹ç›®é‡Œé¢äº†ã€‚</p>\n<h3 id=\"cloneä»£ç åˆ°æœ¬åœ°\"><a href=\"#cloneä»£ç åˆ°æœ¬åœ°\" class=\"headerlink\" title=\"cloneä»£ç åˆ°æœ¬åœ°\"></a>cloneä»£ç åˆ°æœ¬åœ°</h3><p>åœ¨è‡ªå·±çš„<code>repository</code>(ä»“åº“)é‡Œé¢æ‰¾åˆ°åˆšåˆš<code>fork</code>çš„é¡¹ç›®ï¼Œé€šå¸¸æ˜¯åŒåçš„ï¼Œç„¶å<code>clone</code>åˆ°è‡ªå·±çš„æœºå™¨ä¸Šé¢ä¹‹åã€‚</p>\n<h3 id=\"æ–°å»ºåˆ†æ”¯\"><a href=\"#æ–°å»ºåˆ†æ”¯\" class=\"headerlink\" title=\"æ–°å»ºåˆ†æ”¯\"></a>æ–°å»ºåˆ†æ”¯</h3><p>è™½ç„¶ï¼Œå¯ä»¥ä¸ç”¨æ–°å»ºåˆ†æ”¯ï¼Œç›´æ¥åœ¨masteråˆ†æ”¯ä¸Šé¢commitå’Œpushï¼Œä½†æ˜¯ï¼ä¸ç¬¦åˆè§„èŒƒï¼Œå› ä¸ºmasteråˆ†æ”¯æˆ‘ä»¬æ¥ä¸‹æ¥å¯èƒ½è¦ç”¨ä½œäºä¸çœŸæ­£çš„è¦ä¿®æ”¹çš„é¡¹ç›®çš„masterè”é€šè¦ç”¨çš„ï¼Œæ‰€ä»¥ï¼Œæœ€å¥½æ˜¯å†å¼„ä¸€ä¸ªåˆ†æ”¯æ¥åŒºåˆ«å¼€æ¥ï¼Œä¹‹åæ“ä½œå®Œå¯ä»¥åˆ é™¤ã€‚</p>\n<p>ç†è®ºä¸Šæˆ‘ä»¬è¿˜æ˜¯è¦ç¬¦åˆä¸€ä¸ªè¿‡ç¨‹åŒ–çš„è§„èŒƒçš„ï¼Œè™½ç„¶ä¹Ÿå¯ä»¥ä¸ç”¨è¿™æ ·ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥å­¦ä¹ åˆ«çš„ä¼˜ç§€çš„å¼€æºä»£ç çš„è§„èŒƒæ¥å‘½åï¼Œå¸®åŠ©è‡ªå·±æå‰æ„Ÿå—ä¸€ä¸‹å¤§ç¥çš„æ„Ÿè§‰ã€‚</p>\n<p>æˆ‘ä»¬æ ¹æ®masteråˆ†æ”¯æ–°å»ºå®Œåˆ†æ”¯ï¼Œç„¶ååˆ‡æ¢åˆ†æ”¯ä¹‹åå°±å¯ä»¥å¼€å§‹ä¿®æ”¹ä»£ç äº†ã€‚</p>\n<h3 id=\"æäº¤ä»£ç \"><a href=\"#æäº¤ä»£ç \" class=\"headerlink\" title=\"æäº¤ä»£ç \"></a>æäº¤ä»£ç </h3><p>è¿™é‡Œè¦è¯´ä¸€ä¸‹ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæ¯ä¸ªå¼€æºåº“éƒ½æœ‰è‡ªå·±çš„ä»£ç è§„èŒƒï¼Œæ¯”å¦‚æˆ‘æœ€è¿‘å‚ä¸çš„<a href=\"https://github.com/ant-design/pro-components\" target=\"_blank\" rel=\"noopener\">pro-components</a>è¿™ä¸ªé¡¹ç›®ï¼Œåªéœ€è¦ç¬¦åˆä»–çš„eslintè§„èŒƒå°±å¥½äº†ã€‚åé¢å¯èƒ½è¿˜ä¼šæ¶‰åŠåˆ°ä¸€äº›å•å…ƒæµ‹è¯•çš„é—®é¢˜ï¼Œåé¢ä¼šè¯´åˆ°ã€‚</p>\n<p>ä½ æ”¹å®Œä¹‹åï¼Œå°±éœ€è¦commitäº†ï¼Œæœ‰çš„é¡¹ç›®ä¼šè¦æ±‚ä½ æŒ‰è§„èŒƒå†™commit messageã€‚æ¯”å¦‚<a href=\"https://github.com/ant-design/pro-components\" target=\"_blank\" rel=\"noopener\">pro-components</a>è¿™ä¸ªé¡¹ç›®ï¼Œå¦‚å›¾</p>\n<p><img src=\"/image/pr/commit.png\" alt=\"pornhub\"></p>\n<p>æ˜¯çš„ï¼Œä½ å‘ç°äº†ï¼Œå·¦ä¸‹è§’æœ‰ä¸€ä¸ªè·³è¿‡â€¦æœ€å¥½è¿˜æ˜¯è¦ç¬¦åˆè§„èŒƒï¼Œæ¯•ç«Ÿåœ¨åˆ«äººçš„åœ°ç›˜åŠäº‹ï¼Œè€Œä¸”ä½ çš„æ‰€æœ‰è®°å½•éƒ½æ˜¯å¯ä»¥æŸ¥çš„å“¦ï¼Œä»¥åè¢«äººæŸ¥ä½ çš„prï¼Œä¼šå‘ç°ä½ æ˜¯ä¸€ä¸ªä¼šè§„èŒƒçš„äººå¾ˆåŠ åˆ†å“¦ï¼ï¼</p>\n<h3 id=\"å¼€å§‹æPR\"><a href=\"#å¼€å§‹æPR\" class=\"headerlink\" title=\"å¼€å§‹æPR\"></a>å¼€å§‹æPR</h3><p>è·‘è¿œäº†ï¼Œåœ¨æˆ‘ä»¬æ­£å¸¸çš„<code>commit</code>ï¼Œ <code>pull</code>ï¼Œ<code>push</code>ä¹‹åï¼Œå°±å¯ä»¥æ‰“å¼€æˆ‘ä»¬æƒ³ä¿®æ”¹çš„é‚£ä¸ªä»“åº“ã€‚</p>\n<p>ä¼šåœ¨å¤´é¡¶å‡ºç°ä¸€ä¸ªä¸œè¥¿ã€‚</p>\n<p><img src=\"/image/pr/push.png\" alt=\"pornhub\"></p>\n<p>æˆ‘ä»¬éœ€è¦ç‚¹å‡»å›¾ä¸­æ¡†èµ·æ¥çš„ã€ŒCompare &amp; pull request ã€ï¼Œä¹‹åå°±ä¼šå‡ºç°å¦‚ä¸‹å›¾</p>\n<p><img src=\"/image/pr/create.png\" alt=\"pornhub\"></p>\n<p>é»˜è®¤ä¼šå¸®æˆ‘ä»¬é€‰å¥½åˆ†æ”¯çš„ï¼Œæˆ‘ä»¬åªéœ€è¦å®Œå–„å…¶ä¸­çš„ä¿¡æ¯ï¼Œè¿˜æœ‰æˆ‘ä»¬ä¹‹å‰æäº¤çš„messageä¹Ÿå¯ä»¥ä¿®æ”¹ã€‚æœ€å¥½å¯ä»¥ç”¨è‹±æ–‡æ¥è§£é‡Šï¼Œæœ¬æ¬¡æäº¤çš„å†…å®¹ã€‚</p>\n<p>ç„¶åç‚¹å‡»æäº¤ä¹‹åå°±å¥½äº†ã€‚</p>\n<h4 id=\"æ–¹æ³•äºŒ\"><a href=\"#æ–¹æ³•äºŒ\" class=\"headerlink\" title=\"æ–¹æ³•äºŒ\"></a>æ–¹æ³•äºŒ</h4><p>æˆ‘ä»¬å¯ä»¥ç›´æ¥ç‚¹å‡»</p>\n<p><img src=\"/image/pr/pr.png\" alt=\"pornhub\"></p>\n<p>ç„¶åé€‰æ‹©å’Œä¹‹å‰ä¸€æ ·çš„ä¸œè¥¿å°±å¥½ï¼Œå…·ä½“æ˜¯é€‰æ‹©é¡¹ç›®ä»¥åŠè¦åˆå¹¶çš„åˆ†æ”¯ï¼Œç„¶åå†™å†…å®¹ã€‚ç‚¹å‡»æäº¤ã€‚</p>\n<h3 id=\"åç»­\"><a href=\"#åç»­\" class=\"headerlink\" title=\"åç»­\"></a>åç»­</h3><p>ä¸€ä¸ªä¼˜ç§€é¡¹ç›®é€šå¸¸ä¼šæœ‰ä»£ç å®¡æ ¸ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä½ å¯èƒ½éœ€è¦ä¿®æ”¹ä¸€ä¸‹æµ‹è¯•ç”¨ä¾‹ï¼Œç„¶åæˆ‘ä»¬åªéœ€è¦åœ¨å‰é¢åˆ›å»ºçš„åˆ†æ”¯ä¸Šç»§ç»­<code>push</code>å°±å¥½äº†ã€‚å¯èƒ½è¿˜ä¼šæœ‰ä½œè€…ç»™ä½ çš„æ„è§ã€‚æ”¹å®Œä¹‹åç»§ç»­<code>push</code></p>\n<h3 id=\"å¡«å‘\"><a href=\"#å¡«å‘\" class=\"headerlink\" title=\"å¡«å‘\"></a>å¡«å‘</h3><p>å‰é¢è¯´çš„ï¼Œæˆ‘ä»¬forkçš„åªæ˜¯å½“æ—¶çš„ä»£ç ï¼Œåç»­ä½œè€…æ›´æ–°çš„æˆ‘ä»¬éœ€è¦é‡æ–°æ‹‰å–ï¼Œæ“ä½œå¦‚ä¸‹ï¼š</p>\n<h4 id=\"æ·»åŠ \"><a href=\"#æ·»åŠ \" class=\"headerlink\" title=\"æ·»åŠ \"></a>æ·»åŠ </h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git remote add upstream https:&#x2F;&#x2F;github.com&#x2F;xx&#x2F;xx.git</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"æŸ¥çœ‹\"><a href=\"#æŸ¥çœ‹\" class=\"headerlink\" title=\"æŸ¥çœ‹\"></a>æŸ¥çœ‹</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git remote -v </span><br><span class=\"line\"></span><br><span class=\"line\">origin\tssh:&#x2F;&#x2F;xxx (fetch)</span><br><span class=\"line\">origin\tssh:&#x2F;&#x2F;xxx (push)</span><br><span class=\"line\">upstream\tssh:&#x2F;&#x2F;yyy (fetch)</span><br><span class=\"line\">upstream\tssh:&#x2F;&#x2F;yyy (push)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"å–æ¶ˆ\"><a href=\"#å–æ¶ˆ\" class=\"headerlink\" title=\"å–æ¶ˆ\"></a>å–æ¶ˆ</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git branch --unset-upstream</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"æ‹‰å–\"><a href=\"#æ‹‰å–\" class=\"headerlink\" title=\"æ‹‰å–\"></a>æ‹‰å–</h4><p>è¦†ç›–æœ¬åœ°çš„ masterã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git fetch upstream</span><br><span class=\"line\">$ git checkout master</span><br><span class=\"line\">$ git rebase upstream&#x2F;master</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"æœ€å\"><a href=\"#æœ€å\" class=\"headerlink\" title=\"æœ€å\"></a>æœ€å</h3><p>åªéœ€è¦ç­‰å¾…ä½œè€…<code>merge</code>å•¦ã€‚ç„¶åç¥å¤§å®¶é¡ºåˆ©ï¼Œæœ‰ä»»ä½•é—®é¢˜éƒ½å¯ä»¥åœ¨è¯„è®ºåŒºæŒ‡å‡ºæˆ–è€…äºæˆ‘è®¨è®ºã€‚</p>\n"},{"title":"sprng boot è·¨åŸŸ è¿‡æ»¤å™¨ fetch react Response to preflight request doesn't pass access control check","date":"2019-06-19T03:20:11.000Z","cover":"/image/cover/springboot.png","_content":"\n## å‰è¨€\næµè§ˆå™¨å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œé™åˆ¶äº†JSå‘èµ·è·¨ç«™è¯·æ±‚ï¼Œä½¿ç”¨XHRå¯¹è±¡å‘èµ·è¯·æ±‚å¿…é¡»éµå¾ªåŒæºç­–ç•¥ï¼ˆSOPï¼šSame Origin Policyï¼‰ï¼Œè·¨ç«™è¯·æ±‚ä¼šè¢«æµè§ˆå™¨é˜»æ­¢ï¼Œè¿™å¯¹å¼€å‘è€…æ¥è¯´æ˜¯å¾ˆç—›è‹¦çš„ä¸€ä»¶äº‹ï¼Œå°¤å…¶æ˜¯è¦å¼€å‘å‰åç«¯åˆ†ç¦»çš„åº”ç”¨æ—¶ã€‚\n\nåœ¨ç°ä»£åŒ–çš„Webå¼€å‘ä¸­ï¼Œä¸åŒç½‘ç»œç¯å¢ƒä¸‹çš„èµ„æºæ•°æ®å…±äº«è¶Šæ¥è¶Šæ™®éï¼ŒåŒæºç­–ç•¥å¯ä»¥è¯´æ˜¯åœ¨ä¸€å®šç¨‹åº¦ä¸Šé™åˆ¶äº†Web APIçš„å‘å±•ã€‚\n\nç®€å•çš„è¯´ï¼ŒCORSå°±æ˜¯ä¸ºäº†è¯·æ±‚èƒ½å¤Ÿå®‰å…¨è·¨åŸŸè€Œç”Ÿçš„ã€‚è‡³äºCORSçš„å®‰å…¨æ€§ç ”ç©¶ï¼Œæœ¬æ–‡ä¸åšæ¢è®¨ã€‚\n\n\n## CORSæµ…è¿°\nåè¯è§£é‡Šï¼šè·¨åŸŸèµ„æºå…±äº«ï¼ˆCross-Origin Resource Sharingï¼‰\n\næ¦‚å¿µï¼šæ˜¯ä¸€ç§è·¨åŸŸæœºåˆ¶ã€è§„èŒƒã€æ ‡å‡†ï¼Œæ€ä¹ˆå«éƒ½ä¸€æ ·ï¼Œä½†æ˜¯è¿™å¥—æ ‡å‡†æ˜¯é’ˆå¯¹æœåŠ¡ç«¯çš„ï¼Œè€Œæµè§ˆå™¨ç«¯åªè¦æ”¯æŒHTML5å³å¯ã€‚\n\nä½œç”¨ï¼šå¯ä»¥è®©æœåŠ¡ç«¯å†³å®šå“ªäº›è¯·æ±‚æºå¯ä»¥è¿›æ¥æ‹¿æ•°æ®ï¼Œæ‰€ä»¥æœåŠ¡ç«¯èµ·ä¸»å¯¼ä½œç”¨ï¼ˆæ‰€ä»¥å‡ºäº†äº‹æ‰¾åå°ç¨‹åºçŒ¿ï¼Œæ— å…³å‰ç«¯^ ^ï¼‰\n\nå¸¸ç”¨åœºæ™¯ï¼š\n\n - å‰åç«¯å®Œå…¨åˆ†ç¦»çš„åº”ç”¨\n\n## æœåŠ¡ç«¯æœªå…è®¸è·¨åŸŸ\n\n![æœåŠ¡ç«¯æœªå…è®¸è·¨åŸŸ](/image/SpringBootè·¨åŸŸ/20190311105909443.png?raw=true)\n\n## å¦‚ä½•è§£å†³\n\n```\npackage pers.yiji.YiJiClientServer.util;\n\nimport org.springframework.boot.web.servlet.FilterRegistrationBean;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.web.cors.CorsConfiguration;\nimport org.springframework.web.cors.UrlBasedCorsConfigurationSource;\nimport org.springframework.web.filter.CorsFilter;\n\n@Configuration\npublic class CorsConfig {\n\n    /**\n     * cors support\n     * @return\n     */\n    @Bean\n    public FilterRegistrationBean corsFilter() {\n        // æ³¨å†ŒCORSè¿‡æ»¤å™¨\n        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();\n        CorsConfiguration config = new CorsConfiguration();\n        config.setAllowCredentials(true); // æ˜¯å¦æ”¯æŒå®‰å…¨è¯ä¹¦\n        config.addAllowedOrigin(\"*\"); // å…è®¸ä»»ä½•åŸŸåä½¿ç”¨\n        config.addAllowedHeader(\"*\"); // å…è®¸ä»»ä½•å¤´\n        config.addAllowedMethod(\"*\"); // å…è®¸ä»»ä½•æ–¹æ³•ï¼ˆpostã€getç­‰ï¼‰\n        // é¢„æ£€è¯·æ±‚çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ã€‚\n        //        config.setMaxAge(3600L);\n\n        source.registerCorsConfiguration(\"/**\", config);\n        FilterRegistrationBean bean = new FilterRegistrationBean(new CorsFilter(source));\n        bean.setOrder(0);\n        return bean;\n    }\n}\n```\n\nå…·ä½“æ¯å¥è¯çš„æ„æ€åŸºæœ¬ä¸Šæ³¨é‡Šéƒ½æœ‰å†™ã€‚\n\nä¸»è¦å°±æ˜¯ä¸ºäº†æ³¨å†Œä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œè¿™é‡Œæ˜¯åŸºæœ¬ä¸Šå…è®¸æ‰€æœ‰çš„è¯·æ±‚ï¼Œåœ¨ç‰¹æ®Šçš„åœºæ™¯å¯ä»¥ä½¿ç”¨åŸŸåæ§åˆ¶ç­‰ã€‚\n\n```\nconfig.addAllowedOrigin(\"*\"); // å…è®¸ä»»ä½•åŸŸåä½¿ç”¨ï¼ˆ*å¯ä»¥æ¢æˆç‰¹å®šçš„åŸŸåï¼‰\n```\n\n\n## ç»“æœ\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/SpringBootè·¨åŸŸ/20190311110721789.png?raw=true)\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/SpringBootè·¨åŸŸ/20190311110735834.png?raw=true)\n","source":"_posts/sprng-boot-è·¨åŸŸ-è¿‡æ»¤å™¨-fetch-react-Response-to-preflight-request-doesn-t-pass-access-control-check.md","raw":"---\ntitle: >-\n  sprng boot è·¨åŸŸ è¿‡æ»¤å™¨ fetch react Response to preflight request doesn't pass\n  access control check\ndate: 2019-06-19 11:20:11\ntags: [Spring-Boot, è·¨åŸŸ, Java]\ncategory: [Java, Spring-Boot]\ncover: /image/cover/springboot.png\n---\n\n## å‰è¨€\næµè§ˆå™¨å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œé™åˆ¶äº†JSå‘èµ·è·¨ç«™è¯·æ±‚ï¼Œä½¿ç”¨XHRå¯¹è±¡å‘èµ·è¯·æ±‚å¿…é¡»éµå¾ªåŒæºç­–ç•¥ï¼ˆSOPï¼šSame Origin Policyï¼‰ï¼Œè·¨ç«™è¯·æ±‚ä¼šè¢«æµè§ˆå™¨é˜»æ­¢ï¼Œè¿™å¯¹å¼€å‘è€…æ¥è¯´æ˜¯å¾ˆç—›è‹¦çš„ä¸€ä»¶äº‹ï¼Œå°¤å…¶æ˜¯è¦å¼€å‘å‰åç«¯åˆ†ç¦»çš„åº”ç”¨æ—¶ã€‚\n\nåœ¨ç°ä»£åŒ–çš„Webå¼€å‘ä¸­ï¼Œä¸åŒç½‘ç»œç¯å¢ƒä¸‹çš„èµ„æºæ•°æ®å…±äº«è¶Šæ¥è¶Šæ™®éï¼ŒåŒæºç­–ç•¥å¯ä»¥è¯´æ˜¯åœ¨ä¸€å®šç¨‹åº¦ä¸Šé™åˆ¶äº†Web APIçš„å‘å±•ã€‚\n\nç®€å•çš„è¯´ï¼ŒCORSå°±æ˜¯ä¸ºäº†è¯·æ±‚èƒ½å¤Ÿå®‰å…¨è·¨åŸŸè€Œç”Ÿçš„ã€‚è‡³äºCORSçš„å®‰å…¨æ€§ç ”ç©¶ï¼Œæœ¬æ–‡ä¸åšæ¢è®¨ã€‚\n\n\n## CORSæµ…è¿°\nåè¯è§£é‡Šï¼šè·¨åŸŸèµ„æºå…±äº«ï¼ˆCross-Origin Resource Sharingï¼‰\n\næ¦‚å¿µï¼šæ˜¯ä¸€ç§è·¨åŸŸæœºåˆ¶ã€è§„èŒƒã€æ ‡å‡†ï¼Œæ€ä¹ˆå«éƒ½ä¸€æ ·ï¼Œä½†æ˜¯è¿™å¥—æ ‡å‡†æ˜¯é’ˆå¯¹æœåŠ¡ç«¯çš„ï¼Œè€Œæµè§ˆå™¨ç«¯åªè¦æ”¯æŒHTML5å³å¯ã€‚\n\nä½œç”¨ï¼šå¯ä»¥è®©æœåŠ¡ç«¯å†³å®šå“ªäº›è¯·æ±‚æºå¯ä»¥è¿›æ¥æ‹¿æ•°æ®ï¼Œæ‰€ä»¥æœåŠ¡ç«¯èµ·ä¸»å¯¼ä½œç”¨ï¼ˆæ‰€ä»¥å‡ºäº†äº‹æ‰¾åå°ç¨‹åºçŒ¿ï¼Œæ— å…³å‰ç«¯^ ^ï¼‰\n\nå¸¸ç”¨åœºæ™¯ï¼š\n\n - å‰åç«¯å®Œå…¨åˆ†ç¦»çš„åº”ç”¨\n\n## æœåŠ¡ç«¯æœªå…è®¸è·¨åŸŸ\n\n![æœåŠ¡ç«¯æœªå…è®¸è·¨åŸŸ](/image/SpringBootè·¨åŸŸ/20190311105909443.png?raw=true)\n\n## å¦‚ä½•è§£å†³\n\n```\npackage pers.yiji.YiJiClientServer.util;\n\nimport org.springframework.boot.web.servlet.FilterRegistrationBean;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.web.cors.CorsConfiguration;\nimport org.springframework.web.cors.UrlBasedCorsConfigurationSource;\nimport org.springframework.web.filter.CorsFilter;\n\n@Configuration\npublic class CorsConfig {\n\n    /**\n     * cors support\n     * @return\n     */\n    @Bean\n    public FilterRegistrationBean corsFilter() {\n        // æ³¨å†ŒCORSè¿‡æ»¤å™¨\n        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();\n        CorsConfiguration config = new CorsConfiguration();\n        config.setAllowCredentials(true); // æ˜¯å¦æ”¯æŒå®‰å…¨è¯ä¹¦\n        config.addAllowedOrigin(\"*\"); // å…è®¸ä»»ä½•åŸŸåä½¿ç”¨\n        config.addAllowedHeader(\"*\"); // å…è®¸ä»»ä½•å¤´\n        config.addAllowedMethod(\"*\"); // å…è®¸ä»»ä½•æ–¹æ³•ï¼ˆpostã€getç­‰ï¼‰\n        // é¢„æ£€è¯·æ±‚çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ã€‚\n        //        config.setMaxAge(3600L);\n\n        source.registerCorsConfiguration(\"/**\", config);\n        FilterRegistrationBean bean = new FilterRegistrationBean(new CorsFilter(source));\n        bean.setOrder(0);\n        return bean;\n    }\n}\n```\n\nå…·ä½“æ¯å¥è¯çš„æ„æ€åŸºæœ¬ä¸Šæ³¨é‡Šéƒ½æœ‰å†™ã€‚\n\nä¸»è¦å°±æ˜¯ä¸ºäº†æ³¨å†Œä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œè¿™é‡Œæ˜¯åŸºæœ¬ä¸Šå…è®¸æ‰€æœ‰çš„è¯·æ±‚ï¼Œåœ¨ç‰¹æ®Šçš„åœºæ™¯å¯ä»¥ä½¿ç”¨åŸŸåæ§åˆ¶ç­‰ã€‚\n\n```\nconfig.addAllowedOrigin(\"*\"); // å…è®¸ä»»ä½•åŸŸåä½¿ç”¨ï¼ˆ*å¯ä»¥æ¢æˆç‰¹å®šçš„åŸŸåï¼‰\n```\n\n\n## ç»“æœ\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/SpringBootè·¨åŸŸ/20190311110721789.png?raw=true)\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/SpringBootè·¨åŸŸ/20190311110735834.png?raw=true)\n","slug":"sprng-boot-è·¨åŸŸ-è¿‡æ»¤å™¨-fetch-react-Response-to-preflight-request-doesn-t-pass-access-control-check","published":1,"updated":"2021-06-24T14:00:06.849Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra830010lwrd3lxe3i50","content":"<h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><p>æµè§ˆå™¨å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œé™åˆ¶äº†JSå‘èµ·è·¨ç«™è¯·æ±‚ï¼Œä½¿ç”¨XHRå¯¹è±¡å‘èµ·è¯·æ±‚å¿…é¡»éµå¾ªåŒæºç­–ç•¥ï¼ˆSOPï¼šSame Origin Policyï¼‰ï¼Œè·¨ç«™è¯·æ±‚ä¼šè¢«æµè§ˆå™¨é˜»æ­¢ï¼Œè¿™å¯¹å¼€å‘è€…æ¥è¯´æ˜¯å¾ˆç—›è‹¦çš„ä¸€ä»¶äº‹ï¼Œå°¤å…¶æ˜¯è¦å¼€å‘å‰åç«¯åˆ†ç¦»çš„åº”ç”¨æ—¶ã€‚</p>\n<p>åœ¨ç°ä»£åŒ–çš„Webå¼€å‘ä¸­ï¼Œä¸åŒç½‘ç»œç¯å¢ƒä¸‹çš„èµ„æºæ•°æ®å…±äº«è¶Šæ¥è¶Šæ™®éï¼ŒåŒæºç­–ç•¥å¯ä»¥è¯´æ˜¯åœ¨ä¸€å®šç¨‹åº¦ä¸Šé™åˆ¶äº†Web APIçš„å‘å±•ã€‚</p>\n<p>ç®€å•çš„è¯´ï¼ŒCORSå°±æ˜¯ä¸ºäº†è¯·æ±‚èƒ½å¤Ÿå®‰å…¨è·¨åŸŸè€Œç”Ÿçš„ã€‚è‡³äºCORSçš„å®‰å…¨æ€§ç ”ç©¶ï¼Œæœ¬æ–‡ä¸åšæ¢è®¨ã€‚</p>\n<h2 id=\"CORSæµ…è¿°\"><a href=\"#CORSæµ…è¿°\" class=\"headerlink\" title=\"CORSæµ…è¿°\"></a>CORSæµ…è¿°</h2><p>åè¯è§£é‡Šï¼šè·¨åŸŸèµ„æºå…±äº«ï¼ˆCross-Origin Resource Sharingï¼‰</p>\n<p>æ¦‚å¿µï¼šæ˜¯ä¸€ç§è·¨åŸŸæœºåˆ¶ã€è§„èŒƒã€æ ‡å‡†ï¼Œæ€ä¹ˆå«éƒ½ä¸€æ ·ï¼Œä½†æ˜¯è¿™å¥—æ ‡å‡†æ˜¯é’ˆå¯¹æœåŠ¡ç«¯çš„ï¼Œè€Œæµè§ˆå™¨ç«¯åªè¦æ”¯æŒHTML5å³å¯ã€‚</p>\n<p>ä½œç”¨ï¼šå¯ä»¥è®©æœåŠ¡ç«¯å†³å®šå“ªäº›è¯·æ±‚æºå¯ä»¥è¿›æ¥æ‹¿æ•°æ®ï¼Œæ‰€ä»¥æœåŠ¡ç«¯èµ·ä¸»å¯¼ä½œç”¨ï¼ˆæ‰€ä»¥å‡ºäº†äº‹æ‰¾åå°ç¨‹åºçŒ¿ï¼Œæ— å…³å‰ç«¯^ ^ï¼‰</p>\n<p>å¸¸ç”¨åœºæ™¯ï¼š</p>\n<ul>\n<li>å‰åç«¯å®Œå…¨åˆ†ç¦»çš„åº”ç”¨</li>\n</ul>\n<h2 id=\"æœåŠ¡ç«¯æœªå…è®¸è·¨åŸŸ\"><a href=\"#æœåŠ¡ç«¯æœªå…è®¸è·¨åŸŸ\" class=\"headerlink\" title=\"æœåŠ¡ç«¯æœªå…è®¸è·¨åŸŸ\"></a>æœåŠ¡ç«¯æœªå…è®¸è·¨åŸŸ</h2><p><img src=\"/\" class=\"lazyload\" data-src=\"/image/SpringBoot%E8%B7%A8%E5%9F%9F/20190311105909443.png?raw=true\"  alt=\"æœåŠ¡ç«¯æœªå…è®¸è·¨åŸŸ\"></p>\n<h2 id=\"å¦‚ä½•è§£å†³\"><a href=\"#å¦‚ä½•è§£å†³\" class=\"headerlink\" title=\"å¦‚ä½•è§£å†³\"></a>å¦‚ä½•è§£å†³</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package pers.yiji.YiJiClientServer.util;</span><br><span class=\"line\"></span><br><span class=\"line\">import org.springframework.boot.web.servlet.FilterRegistrationBean;</span><br><span class=\"line\">import org.springframework.context.annotation.Bean;</span><br><span class=\"line\">import org.springframework.context.annotation.Configuration;</span><br><span class=\"line\">import org.springframework.web.cors.CorsConfiguration;</span><br><span class=\"line\">import org.springframework.web.cors.UrlBasedCorsConfigurationSource;</span><br><span class=\"line\">import org.springframework.web.filter.CorsFilter;</span><br><span class=\"line\"></span><br><span class=\"line\">@Configuration</span><br><span class=\"line\">public class CorsConfig &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;**</span><br><span class=\"line\">     * cors support</span><br><span class=\"line\">     * @return</span><br><span class=\"line\">     *&#x2F;</span><br><span class=\"line\">    @Bean</span><br><span class=\"line\">    public FilterRegistrationBean corsFilter() &#123;</span><br><span class=\"line\">        &#x2F;&#x2F; æ³¨å†ŒCORSè¿‡æ»¤å™¨</span><br><span class=\"line\">        UrlBasedCorsConfigurationSource source &#x3D; new UrlBasedCorsConfigurationSource();</span><br><span class=\"line\">        CorsConfiguration config &#x3D; new CorsConfiguration();</span><br><span class=\"line\">        config.setAllowCredentials(true); &#x2F;&#x2F; æ˜¯å¦æ”¯æŒå®‰å…¨è¯ä¹¦</span><br><span class=\"line\">        config.addAllowedOrigin(&quot;*&quot;); &#x2F;&#x2F; å…è®¸ä»»ä½•åŸŸåä½¿ç”¨</span><br><span class=\"line\">        config.addAllowedHeader(&quot;*&quot;); &#x2F;&#x2F; å…è®¸ä»»ä½•å¤´</span><br><span class=\"line\">        config.addAllowedMethod(&quot;*&quot;); &#x2F;&#x2F; å…è®¸ä»»ä½•æ–¹æ³•ï¼ˆpostã€getç­‰ï¼‰</span><br><span class=\"line\">        &#x2F;&#x2F; é¢„æ£€è¯·æ±‚çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ã€‚</span><br><span class=\"line\">        &#x2F;&#x2F;        config.setMaxAge(3600L);</span><br><span class=\"line\"></span><br><span class=\"line\">        source.registerCorsConfiguration(&quot;&#x2F;**&quot;, config);</span><br><span class=\"line\">        FilterRegistrationBean bean &#x3D; new FilterRegistrationBean(new CorsFilter(source));</span><br><span class=\"line\">        bean.setOrder(0);</span><br><span class=\"line\">        return bean;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å…·ä½“æ¯å¥è¯çš„æ„æ€åŸºæœ¬ä¸Šæ³¨é‡Šéƒ½æœ‰å†™ã€‚</p>\n<p>ä¸»è¦å°±æ˜¯ä¸ºäº†æ³¨å†Œä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œè¿™é‡Œæ˜¯åŸºæœ¬ä¸Šå…è®¸æ‰€æœ‰çš„è¯·æ±‚ï¼Œåœ¨ç‰¹æ®Šçš„åœºæ™¯å¯ä»¥ä½¿ç”¨åŸŸåæ§åˆ¶ç­‰ã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">config.addAllowedOrigin(&quot;*&quot;); &#x2F;&#x2F; å…è®¸ä»»ä½•åŸŸåä½¿ç”¨ï¼ˆ*å¯ä»¥æ¢æˆç‰¹å®šçš„åŸŸåï¼‰</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"ç»“æœ\"><a href=\"#ç»“æœ\" class=\"headerlink\" title=\"ç»“æœ\"></a>ç»“æœ</h2><p><img src=\"/\" class=\"lazyload\" data-src=\"/image/SpringBoot%E8%B7%A8%E5%9F%9F/20190311110721789.png?raw=true\"  alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/SpringBoot%E8%B7%A8%E5%9F%9F/20190311110735834.png?raw=true\"  alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><p>æµè§ˆå™¨å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œé™åˆ¶äº†JSå‘èµ·è·¨ç«™è¯·æ±‚ï¼Œä½¿ç”¨XHRå¯¹è±¡å‘èµ·è¯·æ±‚å¿…é¡»éµå¾ªåŒæºç­–ç•¥ï¼ˆSOPï¼šSame Origin Policyï¼‰ï¼Œè·¨ç«™è¯·æ±‚ä¼šè¢«æµè§ˆå™¨é˜»æ­¢ï¼Œè¿™å¯¹å¼€å‘è€…æ¥è¯´æ˜¯å¾ˆç—›è‹¦çš„ä¸€ä»¶äº‹ï¼Œå°¤å…¶æ˜¯è¦å¼€å‘å‰åç«¯åˆ†ç¦»çš„åº”ç”¨æ—¶ã€‚</p>\n<p>åœ¨ç°ä»£åŒ–çš„Webå¼€å‘ä¸­ï¼Œä¸åŒç½‘ç»œç¯å¢ƒä¸‹çš„èµ„æºæ•°æ®å…±äº«è¶Šæ¥è¶Šæ™®éï¼ŒåŒæºç­–ç•¥å¯ä»¥è¯´æ˜¯åœ¨ä¸€å®šç¨‹åº¦ä¸Šé™åˆ¶äº†Web APIçš„å‘å±•ã€‚</p>\n<p>ç®€å•çš„è¯´ï¼ŒCORSå°±æ˜¯ä¸ºäº†è¯·æ±‚èƒ½å¤Ÿå®‰å…¨è·¨åŸŸè€Œç”Ÿçš„ã€‚è‡³äºCORSçš„å®‰å…¨æ€§ç ”ç©¶ï¼Œæœ¬æ–‡ä¸åšæ¢è®¨ã€‚</p>\n<h2 id=\"CORSæµ…è¿°\"><a href=\"#CORSæµ…è¿°\" class=\"headerlink\" title=\"CORSæµ…è¿°\"></a>CORSæµ…è¿°</h2><p>åè¯è§£é‡Šï¼šè·¨åŸŸèµ„æºå…±äº«ï¼ˆCross-Origin Resource Sharingï¼‰</p>\n<p>æ¦‚å¿µï¼šæ˜¯ä¸€ç§è·¨åŸŸæœºåˆ¶ã€è§„èŒƒã€æ ‡å‡†ï¼Œæ€ä¹ˆå«éƒ½ä¸€æ ·ï¼Œä½†æ˜¯è¿™å¥—æ ‡å‡†æ˜¯é’ˆå¯¹æœåŠ¡ç«¯çš„ï¼Œè€Œæµè§ˆå™¨ç«¯åªè¦æ”¯æŒHTML5å³å¯ã€‚</p>\n<p>ä½œç”¨ï¼šå¯ä»¥è®©æœåŠ¡ç«¯å†³å®šå“ªäº›è¯·æ±‚æºå¯ä»¥è¿›æ¥æ‹¿æ•°æ®ï¼Œæ‰€ä»¥æœåŠ¡ç«¯èµ·ä¸»å¯¼ä½œç”¨ï¼ˆæ‰€ä»¥å‡ºäº†äº‹æ‰¾åå°ç¨‹åºçŒ¿ï¼Œæ— å…³å‰ç«¯^ ^ï¼‰</p>\n<p>å¸¸ç”¨åœºæ™¯ï¼š</p>\n<ul>\n<li>å‰åç«¯å®Œå…¨åˆ†ç¦»çš„åº”ç”¨</li>\n</ul>\n<h2 id=\"æœåŠ¡ç«¯æœªå…è®¸è·¨åŸŸ\"><a href=\"#æœåŠ¡ç«¯æœªå…è®¸è·¨åŸŸ\" class=\"headerlink\" title=\"æœåŠ¡ç«¯æœªå…è®¸è·¨åŸŸ\"></a>æœåŠ¡ç«¯æœªå…è®¸è·¨åŸŸ</h2><p><img src=\"/image/SpringBoot%E8%B7%A8%E5%9F%9F/20190311105909443.png?raw=true\" alt=\"æœåŠ¡ç«¯æœªå…è®¸è·¨åŸŸ\"></p>\n<h2 id=\"å¦‚ä½•è§£å†³\"><a href=\"#å¦‚ä½•è§£å†³\" class=\"headerlink\" title=\"å¦‚ä½•è§£å†³\"></a>å¦‚ä½•è§£å†³</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package pers.yiji.YiJiClientServer.util;</span><br><span class=\"line\"></span><br><span class=\"line\">import org.springframework.boot.web.servlet.FilterRegistrationBean;</span><br><span class=\"line\">import org.springframework.context.annotation.Bean;</span><br><span class=\"line\">import org.springframework.context.annotation.Configuration;</span><br><span class=\"line\">import org.springframework.web.cors.CorsConfiguration;</span><br><span class=\"line\">import org.springframework.web.cors.UrlBasedCorsConfigurationSource;</span><br><span class=\"line\">import org.springframework.web.filter.CorsFilter;</span><br><span class=\"line\"></span><br><span class=\"line\">@Configuration</span><br><span class=\"line\">public class CorsConfig &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#x2F;**</span><br><span class=\"line\">     * cors support</span><br><span class=\"line\">     * @return</span><br><span class=\"line\">     *&#x2F;</span><br><span class=\"line\">    @Bean</span><br><span class=\"line\">    public FilterRegistrationBean corsFilter() &#123;</span><br><span class=\"line\">        &#x2F;&#x2F; æ³¨å†ŒCORSè¿‡æ»¤å™¨</span><br><span class=\"line\">        UrlBasedCorsConfigurationSource source &#x3D; new UrlBasedCorsConfigurationSource();</span><br><span class=\"line\">        CorsConfiguration config &#x3D; new CorsConfiguration();</span><br><span class=\"line\">        config.setAllowCredentials(true); &#x2F;&#x2F; æ˜¯å¦æ”¯æŒå®‰å…¨è¯ä¹¦</span><br><span class=\"line\">        config.addAllowedOrigin(&quot;*&quot;); &#x2F;&#x2F; å…è®¸ä»»ä½•åŸŸåä½¿ç”¨</span><br><span class=\"line\">        config.addAllowedHeader(&quot;*&quot;); &#x2F;&#x2F; å…è®¸ä»»ä½•å¤´</span><br><span class=\"line\">        config.addAllowedMethod(&quot;*&quot;); &#x2F;&#x2F; å…è®¸ä»»ä½•æ–¹æ³•ï¼ˆpostã€getç­‰ï¼‰</span><br><span class=\"line\">        &#x2F;&#x2F; é¢„æ£€è¯·æ±‚çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ã€‚</span><br><span class=\"line\">        &#x2F;&#x2F;        config.setMaxAge(3600L);</span><br><span class=\"line\"></span><br><span class=\"line\">        source.registerCorsConfiguration(&quot;&#x2F;**&quot;, config);</span><br><span class=\"line\">        FilterRegistrationBean bean &#x3D; new FilterRegistrationBean(new CorsFilter(source));</span><br><span class=\"line\">        bean.setOrder(0);</span><br><span class=\"line\">        return bean;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å…·ä½“æ¯å¥è¯çš„æ„æ€åŸºæœ¬ä¸Šæ³¨é‡Šéƒ½æœ‰å†™ã€‚</p>\n<p>ä¸»è¦å°±æ˜¯ä¸ºäº†æ³¨å†Œä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œè¿™é‡Œæ˜¯åŸºæœ¬ä¸Šå…è®¸æ‰€æœ‰çš„è¯·æ±‚ï¼Œåœ¨ç‰¹æ®Šçš„åœºæ™¯å¯ä»¥ä½¿ç”¨åŸŸåæ§åˆ¶ç­‰ã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">config.addAllowedOrigin(&quot;*&quot;); &#x2F;&#x2F; å…è®¸ä»»ä½•åŸŸåä½¿ç”¨ï¼ˆ*å¯ä»¥æ¢æˆç‰¹å®šçš„åŸŸåï¼‰</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"ç»“æœ\"><a href=\"#ç»“æœ\" class=\"headerlink\" title=\"ç»“æœ\"></a>ç»“æœ</h2><p><img src=\"/image/SpringBoot%E8%B7%A8%E5%9F%9F/20190311110721789.png?raw=true\" alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<p><img src=\"/image/SpringBoot%E8%B7%A8%E5%9F%9F/20190311110735834.png?raw=true\" alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n"},{"date":"2021-03-29T02:08:31.000Z","cover":"/image/cover/react.png","_content":"\n# å‰è¨€\n\nä¸€äº›åºŸè¯å’Œä¸ªäººæ„Ÿæ‚Ÿï¼Œçœ‹å¹²è´§çš„ç›´æ¥è·³è¿‡....åˆ°`jsx`\n\né‡è¯†å‰ç«¯æ–­æ–­ç»­ç»­ä¹Ÿå†™äº†å¤§åŠå¹´äº†ã€‚é‡Œé¢åŸºæœ¬ä¸Šéƒ½æ˜¯ä¸ªäººæŠ€æœ¯æ ˆçš„ç§¯ç´¯ï¼Œä»¥åŠé¢è¯•é¢˜çš„å›ç­”ã€‚æ„Ÿå…´è¶£çš„ä¼™ä¼´å¯ä»¥ç‚¹åˆ°æˆ‘çš„ä¸»é¡µå»çœ‹ã€‚\n\nè¯´è¯´ä»Šå¤©çš„ä¸»è§’-`React`å§ã€‚`React`çš„æºç ä¹‹å‰ä¸€ç›´æƒ³è¦å»é˜…è¯»å­¦ä¹ çš„ï¼Œä¹Ÿç¡®ç¡®å®å®åœ¨çœ‹äº†ï¼Œä½†æ˜¯ç»å¸¸çœ‹ç€çœ‹ç€å°±å‘å›°ã€‚ç„¶åå°±å¼€å§‹å·æ‡’ï¼Œä»ä¸€äº›å‘¨è¾¹çš„å¼€å§‹é˜…è¯»ï¼Œæ¯”å¦‚`React-Router`ï¼Œ`React-Redux`ä¹‹ç±»çš„ã€‚ä¹‹å‰éƒ½æ˜¯çœ‹å®Œä¹‹åå†å¼€å§‹å†™æ–‡ç« ã€‚ç°åœ¨æƒ³ä¸€è¾¹çœ‹ä¸€è¾¹å†™ï¼Œæ¢ä¸ªæ–¹å¼çœ‹çœ‹ã€‚å¦‚æœæœ‰å†™é”™çš„åœ°æ–¹æ¬¢è¿å¤§å®¶è®¨è®ºï¼Œå¦‚æœè§‰å¾—è¿˜å¯ä»¥çš„è¯å¯ä»¥ç‚¹ä¸ªèµï¼Œè°¢è°¢ï¼\n\nä½œä¸ºä¸€å`React`çš„é‡åº¦ä½¿ç”¨è€…å’Œçˆ±å¥½è€…ã€‚æˆ‘å°†ä¼šå’Œå¤§å®¶ä¸€èµ·ä»ã€Œä½¿ç”¨è€…ã€åˆ°ã€Œäº†è§£è€…ã€è¿›æ­¥ï¼\n\n# Reactçš„ç›¸å…³ä¿¡æ¯\n\n## åŠŸåˆ©çš„è§’åº¦\n\næ‰“å¼€æ‹›è˜è½¯ä»¶ï¼Œç°åœ¨åŸºæœ¬ä¸Šçš„å¤§å‚ï¼Œç”šè‡³æ˜¯å¤–åŒ…å…¬å¸éƒ½æ™®éè¦æ±‚ä½ ä¼š`React`æˆ–è€…`Vue`ã€‚ç»™å‡ºçš„è–ªèµ„ä¹Ÿæ˜¯éå¸¸çš„è¯±äººã€‚\n\nï¼ˆå›¾ç‰‡æ¥è‡ªBossæŸè˜ï¼‰\n\n![offer](/image/react1/offer.png)\n\n\n\nä¸ºäº†å‘è´¢è¿™ä¸ªæœ´å®çš„æ¢¦æƒ³ä¹Ÿåº”è¯¥å­¦ä¹ ã€‚\n\n## å­¦ä¹ çš„è§’åº¦\n\nå¦‚ä»Šå‰ç«¯å¾¡ä¸‰å®¶ï¼š`Angular`ã€`React`ã€`Vue`ä¸‰åˆ†å¤©ä¸‹ã€‚å›½å†…æ›´é’ç`React`å’Œ`Vue`ã€‚æ‰€ä»¥ï¼Œä»å­¦ä¹ çš„è§’åº¦æ›´åº”è¯¥å­¦ä¹ `React`ã€‚\n\n\n\nhttps://www.npmtrends.com/react-vs-vue-vs-@angular/core\n\n\n\n![offer](/image/react1/download.jpg)\n\n\n\n![offer](/image/react1/stats)\n\n## ä¸ºä»€ä¹ˆéè¦å­¦ä¹ æºç \n\nè¿™ä¸ªé—®é¢˜æˆ‘ä¹‹å‰ä¹Ÿé—®è¿‡ï¼Œå‡ ä¹æ‰€æœ‰çš„é¢è¯•éƒ½æ˜¯é€ ç«ç®­ï¼Œå·¥ä½œæ‹§èºä¸ã€‚\n\næˆ‘è®¤ä¸ºä»ä¸¤ä¸ªè§’åº¦æ¥çœ‹è¿™ä¸ªé—®é¢˜ï¼š\n\n1. åº”è˜è€…\n   1. åƒé€`React`çš„æƒ…å†µä¸‹ï¼Œè§£å†³é—®é¢˜çš„ä¸Šé™è‚¯å®šæ˜¯æé«˜äº†\n   2. ä¸€ä¸ªä¼˜ç§€çš„æ¡†æ¶æ˜¯ä¸€ä½ä¼˜ç§€çš„è€å¸ˆ\n2. æ‹›è˜è€…ï¼Œæ—¢ç„¶éƒ½æ˜¯èƒ½å¹²æ´»çš„ï¼Œæˆ‘å°±æ‰¾ä¸€ä¸ªæ‡‚å¾—æ›´å¤šçš„äººæ¥å¹²è¿™ä¸ªæ´»\n\n\n\n# JSX\n\nåºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥å¼€å§‹ã€‚\n\nJSXï¼Œå†ç†Ÿæ‚‰ä¸è¿‡äº†ï¼Œæ—¥å¸¸ä½¿ç”¨Reactè¿‡ç¨‹ä¸­è‚¯å®šä¼šç”¨åˆ°çš„ã€‚ç»™ä¸€ä¸ªdemoï¼Œå¸®å¤§å®¶å›ä¸€ä¸‹ã€‚\n\n```react\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\n\nclass App extends React.Component {\n  render() {\n    const text = \"å“ˆå“ˆå“ˆ\"\n    return (\n      <div>\n        <p>{text}</p>\n      </div>\n    );\n  }\n}\n\nconst rootElement = document.getElementById(\"root\");\nReactDOM.render(<App />, rootElement);\n```\n\n\n\næˆ‘å…ˆé—®å‡ ä¸ªé—®é¢˜ï¼Œå¦‚æœèƒ½å¤Ÿæ¸…æ™°çš„å¿«é€Ÿç­”å‡ºæ¥ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼Œä½ çš„åŸºç¡€å¾ˆæ‰å®ï¼Œå¦‚æœä¸è¡Œï¼Œé‚£å°±ä¸€èµ·çœ‹çœ‹ï¼Œçœ‹å®Œä¹‹åå¯ä»¥æŠŠä½ çš„ç­”æ¡ˆå†™åœ¨è¯„è®ºåŒºï¼Œå’Œå¤§å®¶è®¨è®ºã€‚\n\n- ä»€ä¹ˆæ˜¯`JSX`ï¼Ÿ`JSX`å’Œ`JS`æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ\n- `JSX`çš„åº•å±‚åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ\n- ä¸ºä»€ä¹ˆ`React`è¦é€‰æ‹©`JSX`ï¼Ÿ\n\nå¸¦ç€é—®é¢˜ä¸€èµ·æ¥çœ‹ã€‚\n\n## ä»€ä¹ˆæ˜¯JSX\n\nå…ˆçœ‹çœ‹`React`å®˜ç½‘çš„ä¸€å¥è¯ã€‚\n\n> ```react\n> const element = <h1>Hello, world!</h1>;\n> ```\n>\n> å®ƒè¢«ç§°ä¸º JSXï¼Œæ˜¯ä¸€ä¸ª JavaScript çš„è¯­æ³•æ‰©å±•ã€‚\n\nè¯­æ³•æ‰©å±•ï¼Œæ„æ€å°±æ˜¯`JS`æœ‰çš„ä»–éƒ½æœ‰çš„æƒ…å†µä¸‹ï¼Œè¿˜æœ‰ä¸€äº›åˆ«çš„åŠŸèƒ½ã€‚å¯æ˜¯è¿™è´§ï¼Œæ˜æ˜¾åœ¨`JavaScript`å­¦ä¹ è¿‡ç¨‹ä¸­æ²¡è§è¿‡ä»–å‘€ã€‚ä»–èƒ½è¿è¡Œåœ¨`JavaScript`çš„ç¯å¢ƒä¸­å—ï¼Ÿæ‰“å¼€`Chrome`æ§åˆ¶å°ã€‚\n\n\n\n![console](/image/react/console.png)\n\n\n\nä¸Šæ¥å°±æ˜¯åŠˆå¤´ç›–è„¸çš„è¯­æ³•é”™è¯¯ï¼Œçœ‹æ ·å­è¿™éƒ¨åˆ†å°±æ˜¯å¤šå‡ºæ¥çš„åŠŸèƒ½äº†å‘—ã€‚é‚£å’‹è¿è¡Œå•Šï¼Ÿ\n\n\n\n```js\n{\n        test: /\\.(js|jsx)?$/,\n        // å¼€å¯ç¼“å­˜\n        options: { cacheDirectory: true },\n        loader: 'babel-loader',\n},\n```\n\næ€ä¹ˆæ ·ï¼Œç†Ÿæ‚‰ä¸ï¼Œæ„æ€æ˜¯å‘Šè¯‰`webpack`ï¼Œè§£æ`jsx`ç»“å°¾çš„ä»£ç ï¼Œéœ€è¦ç”¨åˆ°`babel`ã€‚okï¼Œä¹Ÿå°±æ˜¯è¯´è¦æƒ³è¿è¡Œ`jsx`ï¼Œå°±å¿…é¡»ç”¨`babel`è§£æã€‚é‚£å¥½ï¼Œä»€ä¹ˆæ˜¯babelï¼Ÿ\n\n### babel\n\næ‹‰ä¸€æ®µ`babel`å®˜ç½‘ä¸Šçš„ä¸€å¥è¯\n\n> ## Babel æ˜¯ä¸€ä¸ª JavaScript ç¼–è¯‘å™¨\n>\n> Babel æ˜¯ä¸€ä¸ªå·¥å…·é“¾ï¼Œä¸»è¦ç”¨äºå°† ECMAScript 2015+ ç‰ˆæœ¬çš„ä»£ç è½¬æ¢ä¸ºå‘åå…¼å®¹çš„ JavaScript è¯­æ³•ï¼Œä»¥ä¾¿èƒ½å¤Ÿè¿è¡Œåœ¨å½“å‰å’Œæ—§ç‰ˆæœ¬çš„æµè§ˆå™¨æˆ–å…¶ä»–ç¯å¢ƒä¸­ã€‚\n\n`babel`ï¼Œå…¶å®å°±æ˜¯å¸®æˆ‘ä»¬è§£ææˆ‘ä»¬å†™çš„ä»£ç ï¼Œç„¶åå˜æˆæµè§ˆå™¨èƒ½å¤Ÿè®¤è¯†æ ·å¼ã€‚æ¯”å¦‚`jsx`ï¼Œæ¯”å¦‚æ–°é²œçš„`es6`è¯­æ³•å¯ä»¥è¿è¡Œåœ¨è€ç‰ˆæœ¬çš„æµè§ˆå™¨ä¸Šï¼Œè®©è€ç‰ˆæœ¬çš„æµè§ˆå™¨èƒ½å¤Ÿè®¤è¯†ã€‚\n\né‚£é—®é¢˜åˆæ¥äº†ï¼Œjsxè¢«babelå˜æˆä»€ä¹ˆæ ·å­äº†ï¼Ÿ\n\nåœ¨çº¿è½¬æ¢ï¼šhttps://babeljs.io/repl\n\nå¤§å®¶å¯ä»¥æŠŠä¸Šé¢çš„å°demoï¼Œæ‰”è¿›å»ã€‚\n\n\n\n![bebel](/image/react/bebel.png)\n\n\n\nå‘ç°æ²¡æœ‰ã€‚æˆ‘ä»¬`return`å‡ºå»çš„ä¸œè¥¿å˜æˆäº†`React.createElement`ã€‚å“ˆå“ˆï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å³ä½¿æ²¡æœ‰ç”¨åˆ°`React`(è§£å†³äº†ä¸€åˆ°é¢è¯•é¢˜ï¼)ï¼Œä¹Ÿéœ€è¦åœ¨ä¸Šé¢`import`ï¼Œå› ä¸º`jsx`æœ€åæ˜¯ä¼šè¢«è½¬åŒ–ä¸º`React.createElement`ï¼Œä¼šç”¨åˆ°çš„ï¼ï¼ˆä¸è¿‡ç°åœ¨æœ€æ–°çš„å¥½åƒä¸éœ€è¦å¼•ç”¨ä¹Ÿä¸ä¼šæŠ¥é”™äº†ï¼Œå› ä¸ºä»–è‡ªå·±è¯†åˆ«äº†ã€‚\n\nå®˜ç½‘ä»‹ç»ï¼šhttps://zh-hans.reactjs.org/blog/2020/09/22/introducing-the-new-jsx-transform.html\n\n> ```\n> // ç”±ç¼–è¯‘å™¨å¼•å…¥ï¼ˆç¦æ­¢è‡ªå·±å¼•å…¥ï¼ï¼‰\n> import {jsx as _jsx} from 'react/jsx-runtime';\n> \n> function App() {\n>   return _jsx('h1', { children: 'Hello world' });\n> }\n> ```\n>\n> æ³¨æ„ï¼Œæ­¤æ—¶æºä»£ç **æ— éœ€å¼•å…¥ React** å³å¯ä½¿ç”¨ JSX äº†ï¼ï¼ˆä½†ä»éœ€å¼•å…¥ Reactï¼Œä»¥ä¾¿ä½¿ç”¨ React æä¾›çš„ Hook æˆ–å…¶ä»–å¯¼å‡ºã€‚ï¼‰\n\n\n\nå›åˆ°ä¹‹å‰`React`å®˜ç½‘æåˆ°çš„\n\n> å®ƒè¢«ç§°ä¸º JSXï¼Œæ˜¯ä¸€ä¸ª JavaScript çš„è¯­æ³•æ‰©å±•ã€‚\n\næœ‰æ²¡æœ‰å‘¼åº”èµ·æ¥äº†ï¼Œç¡®å®`js`ä»–éƒ½æœ‰ï¼Œä½†æ˜¯`js`æ²¡æœ‰çš„ï¼Œä»–è¿˜æœ‰æ¯”å¦‚è½¬åŒ–ä¸º`React.createElement`ã€‚\n\n\n\n## createElement\n\næˆ‘ä»¬æ˜¯æ¥è¯»æºç å­¦ä¹ çš„ï¼Œæˆ‘ä»¬æ—¢ç„¶çŸ¥é“äº†`jsx`çš„åº•å±‚æ˜¯è°ƒç”¨`react`çš„å‡½æ•°ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹è¿™ä¸ªå‡½æ•°æ˜¯ä¸ªä»€ä¹ˆæƒ…å†µã€‚\n\n```javascript\nexport function createElement(type, config, children) {\n  // propName å˜é‡ç”¨äºå‚¨å­˜åé¢éœ€è¦ç”¨åˆ°çš„å…ƒç´ å±æ€§\n  let propName; \n  // props å˜é‡ç”¨äºå‚¨å­˜å…ƒç´ å±æ€§çš„é”®å€¼å¯¹é›†åˆ\n  const props = {}; \n  // keyã€refã€selfã€source å‡ä¸º React å…ƒç´ çš„å±æ€§ï¼Œæ­¤å¤„ä¸å¿…æ·±ç©¶\n  let key = null;\n  let ref = null; \n  let self = null; \n  let source = null; \n\n  // config å¯¹è±¡ä¸­å­˜å‚¨çš„æ˜¯å…ƒç´ çš„å±æ€§\n  if (config != null) { \n    // è¿›æ¥ä¹‹ååšçš„ç¬¬ä¸€ä»¶äº‹ï¼Œæ˜¯ä¾æ¬¡å¯¹ refã€keyã€self å’Œ source å±æ€§èµ‹å€¼\n    if (hasValidRef(config)) {\n      ref = config.ref;\n    }\n    // æ­¤å¤„å°† key å€¼å­—ç¬¦ä¸²åŒ–\n    if (hasValidKey(config)) {\n      key = '' + config.key; \n    }\n    self = config.__self === undefined ? null : config.__self;\n    source = config.__source === undefined ? null : config.__source;\n    // æ¥ç€å°±æ˜¯è¦æŠŠ config é‡Œé¢çš„å±æ€§éƒ½ä¸€ä¸ªä¸€ä¸ªæŒªåˆ° props è¿™ä¸ªä¹‹å‰å£°æ˜å¥½çš„å¯¹è±¡é‡Œé¢\n    for (propName in config) {\n      if (\n        // ç­›é€‰å‡ºå¯ä»¥æè¿› props å¯¹è±¡é‡Œçš„å±æ€§\n        hasOwnProperty.call(config, propName) &&\n        !RESERVED_PROPS.hasOwnProperty(propName) \n      ) {\n        props[propName] = config[propName]; \n      }\n    }\n  }\n  // childrenLength æŒ‡çš„æ˜¯å½“å‰å…ƒç´ çš„å­å…ƒç´ çš„ä¸ªæ•°ï¼Œå‡å»çš„ 2 æ˜¯ type å’Œ config ä¸¤ä¸ªå‚æ•°å ç”¨çš„é•¿åº¦\n  const childrenLength = arguments.length - 2; \n  // å¦‚æœæŠ›å»typeå’Œconfigï¼Œå°±åªå‰©ä¸‹ä¸€ä¸ªå‚æ•°ï¼Œä¸€èˆ¬æ„å‘³ç€æ–‡æœ¬èŠ‚ç‚¹å‡ºç°äº†\n  if (childrenLength === 1) { \n    // ç›´æ¥æŠŠè¿™ä¸ªå‚æ•°çš„å€¼èµ‹ç»™props.children\n    props.children = children; \n    // å¤„ç†åµŒå¥—å¤šä¸ªå­å…ƒç´ çš„æƒ…å†µ\n  } else if (childrenLength > 1) { \n    // å£°æ˜ä¸€ä¸ªå­å…ƒç´ æ•°ç»„\n    const childArray = Array(childrenLength); \n    // æŠŠå­å…ƒç´ æ¨è¿›æ•°ç»„é‡Œ\n    for (let i = 0; i < childrenLength; i++) { \n      childArray[i] = arguments[i + 2];\n    }\n    // æœ€åæŠŠè¿™ä¸ªæ•°ç»„èµ‹å€¼ç»™props.children\n    props.children = childArray; \n  } \n\n  // å¤„ç† defaultProps\n  if (type && type.defaultProps) {\n    const defaultProps = type.defaultProps;\n    for (propName in defaultProps) { \n      if (props[propName] === undefined) {\n        props[propName] = defaultProps[propName];\n      }\n    }\n  }\n\n  // æœ€åè¿”å›ä¸€ä¸ªè°ƒç”¨ReactElementæ‰§è¡Œæ–¹æ³•ï¼Œå¹¶ä¼ å…¥åˆšæ‰å¤„ç†è¿‡çš„å‚æ•°\n  return ReactElement(\n    type,\n    key,\n    ref,\n    self,\n    source,\n    ReactCurrentOwner.current,\n    props,\n  );\n}\n```\n\n\n\nå…ˆä¸çœ‹å‚æ•°ï¼Œæˆ‘ä»¬å°±å…ˆçœ‹è¿”å›å€¼çš„åå­—å’Œè¿™ä¸ªå‡½æ•°çš„åå­—ã€‚æˆ‘ä»¬åˆæ­¥çŒœæµ‹ï¼Œ`jsx`æ˜¯é€šè¿‡`createElement`è¿™ä¸ªå‡½æ•°æ¥åˆ›å»ºä¸€ä¸ª`React`å…ƒç´ ï¼Œç„¶åç”±`ReactDOM.render`æ¥æ¸²æŸ“åˆ°æˆ‘ä»¬æŒ‡å®šåå­—çš„å…ƒç´ ä¸Šã€‚\n\n\n\n\n\nokï¼Œé‚£ä¹ˆæˆ‘ä»¬å¹³å¸¸å†™çš„jsxå…ƒç´ å°±æ˜¯`ReactElement`ç”Ÿæˆçš„ä¸œè¥¿ã€‚æˆ‘ä»¬çœ‹çœ‹`ReactElement`ç”Ÿæˆçš„æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ã€‚\n\næˆ‘ä»¬å…ˆæŠŠæˆ‘ä»¬å¹³å¸¸å†™çš„`jsx`ç»™æ‰“å°ä¸€ä¸‹ã€‚\n\n\n\n![element](/image/react/element.png)\n\n\n\nå‡­ç›´è§‰ï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰è¿™ä¸ªæ˜¯ä¸€ä¸ª`è™šæ‹ŸDOM`çš„èŠ‚ç‚¹ï¼Œä»–æœ‰ç±»å‹ç„¶ååˆæ˜¯`div`ï¼Œå¯¹åº”çš„ä¼šä¸ä¼šæ˜¯`html`çš„`div`æ ‡ç­¾ï¼Ÿè¿˜æœ‰`className`ï¼Œè¿™ä¸ªå¾ˆæ˜æ˜¾å°±æ˜¯å¯¹åº”`class`ã€‚æˆ‘ä»¬å»ä¸€çœ‹ç©¶ç«Ÿã€‚\n\n## ReactElement\n\n\n\n```javascript\nconst ReactElement = function(type, key, ref, self, source, owner, props) {\n  const element = {\n    // è¿™ä¸ªæ˜¯ä¸€ä¸ªReactç»“ç‚¹çš„æ ‡è¯†ç¬¦\n    $$typeof: REACT_ELEMENT_TYPE,\n\n    // å¾ˆæ˜æ˜¾å°±æ˜¯å¯¹åº”çš„htmlçš„æ ‡ç­¾\n    type: type,\n    key: key,\n    ref: ref,\n    props: props,\n\n    // è®°å½•ç”±è°åˆ›å»ºçš„ï¼Œæš‚æ—¶ä¹Ÿä¸çŸ¥é“ä»€ä¹ˆç”¨ã€‚å…ˆæŒ–ä¸ªå‘\n    _owner: owner,\n  };\n\n  // å¼€å‘ç¯å¢ƒä¸‹çš„é…ç½®ï¼Œä¸»è¦å°±æ˜¯Object.freezeï¼Œå¯ä»¥åœ¨MDNä¸Šé¢æŸ¥ä¸€ä¸‹ã€‚æˆ‘å°±ä¸å¤šä»‹ç»äº†\n  if (__DEV__) {\n    // The validation flag is currently mutative. We put it on\n    // an external backing store so that we can freeze the whole object.\n    // This can be replaced with a WeakMap once they are implemented in\n    // commonly used development environments.\n    element._store = {};\n\n    // To make comparing ReactElements easier for testing purposes, we make\n    // the validation flag non-enumerable (where possible, which should\n    // include every environment we run tests in), so the test framework\n    // ignores it.\n    Object.defineProperty(element._store, 'validated', {\n      configurable: false,\n      enumerable: false,\n      writable: true,\n      value: false,\n    });\n    // self and source are DEV only properties.\n    Object.defineProperty(element, '_self', {\n      configurable: false,\n      enumerable: false,\n      writable: false,\n      value: self,\n    });\n    // Two elements created in two different places should be considered\n    // equal for testing purposes and therefore we hide it from enumeration.\n    Object.defineProperty(element, '_source', {\n      configurable: false,\n      enumerable: false,\n      writable: false,\n      value: source,\n    });\n    if (Object.freeze) {\n      Object.freeze(element.props);\n      Object.freeze(element);\n    }\n  }\n\n  return element;\n};\n```\n\n\n\nçœ‹è¿‡ä¹‹åï¼Œæ˜¯ä¸æ˜¯å’Œæˆ‘ä»¬çœ‹åˆ°çš„èŠ‚ç‚¹ä¸€æ ·ï¼Œé¦–å…ˆï¼Œæ ‡æ³¨ä¸€ä¸‹`$$typeof`ä¸º`reactèŠ‚ç‚¹`ã€‚ç„¶åå°±æ˜¯æ­£å¸¸çš„ä¼ å‚ï¼Œæ¯”å¦‚`key`ï¼Œ`ref`ï¼Œ`props`ç­‰ç­‰ã€‚\n\n## ReactDOM.render\n\nè¿™ä¸ªå°±æ˜¯ReactèŠ‚ç‚¹æ¸²æŸ“ä¸ºçœŸæ˜¯èŠ‚ç‚¹çš„æ“ä½œã€‚è¯ä¸å¤šè¯´ï¼Œä¸Šæºç ï¼\n\n\n\n```javascript\nexport function isValidContainer(node: mixed): boolean {\n  return !!(\n    node &&\n    (node.nodeType === ELEMENT_NODE ||\n      node.nodeType === DOCUMENT_NODE ||\n      node.nodeType === DOCUMENT_FRAGMENT_NODE ||\n      (node.nodeType === COMMENT_NODE &&\n        (node: any).nodeValue === ' react-mount-point-unstable '))\n  );\n}\n\nexport function render(\n  element: React$Element<any>,\n  container: Container,\n  callback: ?Function,\n) {\n  // ç”¨äºæŠ›å‡ºé”™è¯¯çš„, å°±æ˜¯åˆ¤æ–­è¿™ä¸ªcontaineræ˜¯ä¸æ˜¯æ‰¾å¾—åˆ°\n  invariant(\n    isValidContainer(container),\n    'Target container is not a DOM element.',\n  );\n  if (__DEV__) {\n    const isModernRoot =\n      isContainerMarkedAsRoot(container) &&\n      container._reactRootContainer === undefined;\n    if (isModernRoot) {\n      console.error(\n        'You are calling ReactDOM.render() on a container that was previously ' +\n          'passed to ReactDOM.createRoot(). This is not supported. ' +\n          'Did you mean to call root.render(element)?',\n      );\n    }\n  }\n  \n  // è¿™é‡Œé¢æ¶‰åŠåˆ°äº†fiberçš„ä¸€äº›æ¶æ„ï¼Œæˆ‘æƒ³ä¹‹åå†è¯´ï¼Œå†æŒ–ä¸ªå‘\n  return legacyRenderSubtreeIntoContainer(\n    null,\n    element,\n    container,\n    false,\n    callback,\n  );\n}\n```\n\n\n\næœ‰æ²¡æœ‰æ„Ÿè§‰å¾ˆç®€å•ï¼Œå»é™¤`__DEV__`æƒ…å†µçš„è¯ã€‚ä¹Ÿæ˜¯è¿”å›ä¸€ä¸ªå‡½æ•°çš„ç»“æœã€‚ã€‚ã€‚\n\n\n\n## ReactDOM.hydrate\n\n\n\nè¿™ä¸ªå‡½æ•°æˆ‘å‘ç°å¾ˆæœ‰æ„æ€ï¼Œä¸ReactDOM.renderåªæœ‰ä¸€è¡Œä»£ç ä¸ä¸€æ ·\n\n```diff\nlegacyRenderSubtreeIntoContainer(\n    null,\n    element,\n    container,\n-   false,\n+   true,\n    callback,\n  );\n```\n\n\n\né¦–å…ˆï¼Œè¿™ä¸ª`hydrate`çš„æ„æ€æ˜¯æ³¨æ°´ã€‚å¤§è‡´çš„æ„æ€æ˜¯ç»™ä¸€ä¸ªç»“ç‚¹å¢åŠ æ°´åˆ†ï¼Œå¢æ·»è‰²å½©ã€‚ä¹‹å‰æ˜¯ç»™`SSR`è¿‡ç¨‹ä¸­æ·»åŠ ç‚¹å‡»äº‹ä»¶ä¹‹ç±»ä½¿ç”¨çš„ã€‚åœ¨`React17`ä¹‹åä¼šæ·˜æ±°æ‰`ReactDOM.Render`ï¼Œå…¨éƒ¨ç”¨`ReactDOM.hydrate`æ¥ä»£æ›¿ã€‚\n\nReactå®˜ç½‘çš„ä¸€å¥è¯\n\n> ä½¿ç”¨ `ReactDOM.render()` å¯¹æœåŠ¡ç«¯æ¸²æŸ“å®¹å™¨è¿›è¡Œ hydrate æ“ä½œçš„æ–¹å¼å·²ç»è¢«åºŸå¼ƒï¼Œå¹¶ä¸”ä¼šåœ¨ React 17 è¢«ç§»é™¤ã€‚ä½œä¸ºæ›¿ä»£ï¼Œè¯·ä½¿ç”¨ [`hydrate()`](https://zh-hans.reactjs.org/docs/react-dom.html#hydrate)ã€‚\n\n\n\n## ä¸ºä»€ä¹ˆè¦ä½¿ç”¨JSX\n\nè¿™é‡Œåˆ†äº«ä¸€ä¸ªè§£é¢˜çš„å°æŠ€å·§ã€‚ä¸ºä»€ä¹ˆè¦XXå…¶å®å°±æ˜¯è¦é—®ä½ ï¼ŒXXçš„å¥½å¤„ã€‚okï¼Œé‚£æ¥ä¸‹æ¥å°±å¾ˆå¥½å›ç­”äº†\n\né¦–å…ˆï¼Œå› ä¸ºå¦‚æœä¸ç”¨`jsx`ï¼Œæˆ‘ä»¬å°±è¦åœ¨ä»£ç é‡Œé¢å†™ä¸Šç™¾ä¸ª`React.crearteElement`ã€‚\n\nç¬¬äºŒï¼Œè¿™ä¸ªè¯­æ³•ç³–å¯ä»¥è®©å¼€å‘è€…ä½¿ç”¨ç†Ÿæ‚‰çš„`HTML`æ ‡ç­¾æ¥åˆ›å»º`è™šæ‹ŸDOM`ï¼Œé™ä½å­¦ä¹ æˆæœ¬ã€‚æå‡å¼€å‘æ•ˆç‡ä¸å¼€å‘ä½“éªŒ\n\n\n\n\n\n![bebel](/image/react/bebel.png)\n\n\n\n# å‰©ä½™çš„å‘\n\n- legacyRenderSubtreeIntoContainerï¼ˆæ¶‰åŠfiberæ¶æ„\n- _ownerï¼ˆåˆ›å»ºçš„æ—¶å€™ï¼Œè¿™ä¸ªå±æ€§æœ‰ä»€ä¹ˆç”¨\n\n# ç´¢å¼•\n\nhttps://zh-hans.reactjs.org/docs\n\nhttps://www.babeljs.cn/docs/\n\n\n\n\n\n\n\n","source":"_posts/ã€é‡è¯†å‰ç«¯ã€‘Reactæºç é˜…è¯»ï¼ˆä¸€ï¼‰jsx.md","raw":"---\n#æˆå¹´äººçš„å´©æºƒå¾€å¾€å°±åœ¨ä¸€ç¬é—´title: ã€é‡è¯†å‰ç«¯ã€‘Reactæºç é˜…è¯»ï¼ˆä¸€ï¼‰ä»€ä¹ˆæ˜¯jsx\ndate: 2021-03-29 10:08:31\ntags: [react]\ncategory: [é‡æ‹¾å‰ç«¯]\ncover: /image/cover/react.png\n---\n\n# å‰è¨€\n\nä¸€äº›åºŸè¯å’Œä¸ªäººæ„Ÿæ‚Ÿï¼Œçœ‹å¹²è´§çš„ç›´æ¥è·³è¿‡....åˆ°`jsx`\n\né‡è¯†å‰ç«¯æ–­æ–­ç»­ç»­ä¹Ÿå†™äº†å¤§åŠå¹´äº†ã€‚é‡Œé¢åŸºæœ¬ä¸Šéƒ½æ˜¯ä¸ªäººæŠ€æœ¯æ ˆçš„ç§¯ç´¯ï¼Œä»¥åŠé¢è¯•é¢˜çš„å›ç­”ã€‚æ„Ÿå…´è¶£çš„ä¼™ä¼´å¯ä»¥ç‚¹åˆ°æˆ‘çš„ä¸»é¡µå»çœ‹ã€‚\n\nè¯´è¯´ä»Šå¤©çš„ä¸»è§’-`React`å§ã€‚`React`çš„æºç ä¹‹å‰ä¸€ç›´æƒ³è¦å»é˜…è¯»å­¦ä¹ çš„ï¼Œä¹Ÿç¡®ç¡®å®å®åœ¨çœ‹äº†ï¼Œä½†æ˜¯ç»å¸¸çœ‹ç€çœ‹ç€å°±å‘å›°ã€‚ç„¶åå°±å¼€å§‹å·æ‡’ï¼Œä»ä¸€äº›å‘¨è¾¹çš„å¼€å§‹é˜…è¯»ï¼Œæ¯”å¦‚`React-Router`ï¼Œ`React-Redux`ä¹‹ç±»çš„ã€‚ä¹‹å‰éƒ½æ˜¯çœ‹å®Œä¹‹åå†å¼€å§‹å†™æ–‡ç« ã€‚ç°åœ¨æƒ³ä¸€è¾¹çœ‹ä¸€è¾¹å†™ï¼Œæ¢ä¸ªæ–¹å¼çœ‹çœ‹ã€‚å¦‚æœæœ‰å†™é”™çš„åœ°æ–¹æ¬¢è¿å¤§å®¶è®¨è®ºï¼Œå¦‚æœè§‰å¾—è¿˜å¯ä»¥çš„è¯å¯ä»¥ç‚¹ä¸ªèµï¼Œè°¢è°¢ï¼\n\nä½œä¸ºä¸€å`React`çš„é‡åº¦ä½¿ç”¨è€…å’Œçˆ±å¥½è€…ã€‚æˆ‘å°†ä¼šå’Œå¤§å®¶ä¸€èµ·ä»ã€Œä½¿ç”¨è€…ã€åˆ°ã€Œäº†è§£è€…ã€è¿›æ­¥ï¼\n\n# Reactçš„ç›¸å…³ä¿¡æ¯\n\n## åŠŸåˆ©çš„è§’åº¦\n\næ‰“å¼€æ‹›è˜è½¯ä»¶ï¼Œç°åœ¨åŸºæœ¬ä¸Šçš„å¤§å‚ï¼Œç”šè‡³æ˜¯å¤–åŒ…å…¬å¸éƒ½æ™®éè¦æ±‚ä½ ä¼š`React`æˆ–è€…`Vue`ã€‚ç»™å‡ºçš„è–ªèµ„ä¹Ÿæ˜¯éå¸¸çš„è¯±äººã€‚\n\nï¼ˆå›¾ç‰‡æ¥è‡ªBossæŸè˜ï¼‰\n\n![offer](/image/react1/offer.png)\n\n\n\nä¸ºäº†å‘è´¢è¿™ä¸ªæœ´å®çš„æ¢¦æƒ³ä¹Ÿåº”è¯¥å­¦ä¹ ã€‚\n\n## å­¦ä¹ çš„è§’åº¦\n\nå¦‚ä»Šå‰ç«¯å¾¡ä¸‰å®¶ï¼š`Angular`ã€`React`ã€`Vue`ä¸‰åˆ†å¤©ä¸‹ã€‚å›½å†…æ›´é’ç`React`å’Œ`Vue`ã€‚æ‰€ä»¥ï¼Œä»å­¦ä¹ çš„è§’åº¦æ›´åº”è¯¥å­¦ä¹ `React`ã€‚\n\n\n\nhttps://www.npmtrends.com/react-vs-vue-vs-@angular/core\n\n\n\n![offer](/image/react1/download.jpg)\n\n\n\n![offer](/image/react1/stats)\n\n## ä¸ºä»€ä¹ˆéè¦å­¦ä¹ æºç \n\nè¿™ä¸ªé—®é¢˜æˆ‘ä¹‹å‰ä¹Ÿé—®è¿‡ï¼Œå‡ ä¹æ‰€æœ‰çš„é¢è¯•éƒ½æ˜¯é€ ç«ç®­ï¼Œå·¥ä½œæ‹§èºä¸ã€‚\n\næˆ‘è®¤ä¸ºä»ä¸¤ä¸ªè§’åº¦æ¥çœ‹è¿™ä¸ªé—®é¢˜ï¼š\n\n1. åº”è˜è€…\n   1. åƒé€`React`çš„æƒ…å†µä¸‹ï¼Œè§£å†³é—®é¢˜çš„ä¸Šé™è‚¯å®šæ˜¯æé«˜äº†\n   2. ä¸€ä¸ªä¼˜ç§€çš„æ¡†æ¶æ˜¯ä¸€ä½ä¼˜ç§€çš„è€å¸ˆ\n2. æ‹›è˜è€…ï¼Œæ—¢ç„¶éƒ½æ˜¯èƒ½å¹²æ´»çš„ï¼Œæˆ‘å°±æ‰¾ä¸€ä¸ªæ‡‚å¾—æ›´å¤šçš„äººæ¥å¹²è¿™ä¸ªæ´»\n\n\n\n# JSX\n\nåºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥å¼€å§‹ã€‚\n\nJSXï¼Œå†ç†Ÿæ‚‰ä¸è¿‡äº†ï¼Œæ—¥å¸¸ä½¿ç”¨Reactè¿‡ç¨‹ä¸­è‚¯å®šä¼šç”¨åˆ°çš„ã€‚ç»™ä¸€ä¸ªdemoï¼Œå¸®å¤§å®¶å›ä¸€ä¸‹ã€‚\n\n```react\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\n\nclass App extends React.Component {\n  render() {\n    const text = \"å“ˆå“ˆå“ˆ\"\n    return (\n      <div>\n        <p>{text}</p>\n      </div>\n    );\n  }\n}\n\nconst rootElement = document.getElementById(\"root\");\nReactDOM.render(<App />, rootElement);\n```\n\n\n\næˆ‘å…ˆé—®å‡ ä¸ªé—®é¢˜ï¼Œå¦‚æœèƒ½å¤Ÿæ¸…æ™°çš„å¿«é€Ÿç­”å‡ºæ¥ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼Œä½ çš„åŸºç¡€å¾ˆæ‰å®ï¼Œå¦‚æœä¸è¡Œï¼Œé‚£å°±ä¸€èµ·çœ‹çœ‹ï¼Œçœ‹å®Œä¹‹åå¯ä»¥æŠŠä½ çš„ç­”æ¡ˆå†™åœ¨è¯„è®ºåŒºï¼Œå’Œå¤§å®¶è®¨è®ºã€‚\n\n- ä»€ä¹ˆæ˜¯`JSX`ï¼Ÿ`JSX`å’Œ`JS`æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ\n- `JSX`çš„åº•å±‚åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ\n- ä¸ºä»€ä¹ˆ`React`è¦é€‰æ‹©`JSX`ï¼Ÿ\n\nå¸¦ç€é—®é¢˜ä¸€èµ·æ¥çœ‹ã€‚\n\n## ä»€ä¹ˆæ˜¯JSX\n\nå…ˆçœ‹çœ‹`React`å®˜ç½‘çš„ä¸€å¥è¯ã€‚\n\n> ```react\n> const element = <h1>Hello, world!</h1>;\n> ```\n>\n> å®ƒè¢«ç§°ä¸º JSXï¼Œæ˜¯ä¸€ä¸ª JavaScript çš„è¯­æ³•æ‰©å±•ã€‚\n\nè¯­æ³•æ‰©å±•ï¼Œæ„æ€å°±æ˜¯`JS`æœ‰çš„ä»–éƒ½æœ‰çš„æƒ…å†µä¸‹ï¼Œè¿˜æœ‰ä¸€äº›åˆ«çš„åŠŸèƒ½ã€‚å¯æ˜¯è¿™è´§ï¼Œæ˜æ˜¾åœ¨`JavaScript`å­¦ä¹ è¿‡ç¨‹ä¸­æ²¡è§è¿‡ä»–å‘€ã€‚ä»–èƒ½è¿è¡Œåœ¨`JavaScript`çš„ç¯å¢ƒä¸­å—ï¼Ÿæ‰“å¼€`Chrome`æ§åˆ¶å°ã€‚\n\n\n\n![console](/image/react/console.png)\n\n\n\nä¸Šæ¥å°±æ˜¯åŠˆå¤´ç›–è„¸çš„è¯­æ³•é”™è¯¯ï¼Œçœ‹æ ·å­è¿™éƒ¨åˆ†å°±æ˜¯å¤šå‡ºæ¥çš„åŠŸèƒ½äº†å‘—ã€‚é‚£å’‹è¿è¡Œå•Šï¼Ÿ\n\n\n\n```js\n{\n        test: /\\.(js|jsx)?$/,\n        // å¼€å¯ç¼“å­˜\n        options: { cacheDirectory: true },\n        loader: 'babel-loader',\n},\n```\n\næ€ä¹ˆæ ·ï¼Œç†Ÿæ‚‰ä¸ï¼Œæ„æ€æ˜¯å‘Šè¯‰`webpack`ï¼Œè§£æ`jsx`ç»“å°¾çš„ä»£ç ï¼Œéœ€è¦ç”¨åˆ°`babel`ã€‚okï¼Œä¹Ÿå°±æ˜¯è¯´è¦æƒ³è¿è¡Œ`jsx`ï¼Œå°±å¿…é¡»ç”¨`babel`è§£æã€‚é‚£å¥½ï¼Œä»€ä¹ˆæ˜¯babelï¼Ÿ\n\n### babel\n\næ‹‰ä¸€æ®µ`babel`å®˜ç½‘ä¸Šçš„ä¸€å¥è¯\n\n> ## Babel æ˜¯ä¸€ä¸ª JavaScript ç¼–è¯‘å™¨\n>\n> Babel æ˜¯ä¸€ä¸ªå·¥å…·é“¾ï¼Œä¸»è¦ç”¨äºå°† ECMAScript 2015+ ç‰ˆæœ¬çš„ä»£ç è½¬æ¢ä¸ºå‘åå…¼å®¹çš„ JavaScript è¯­æ³•ï¼Œä»¥ä¾¿èƒ½å¤Ÿè¿è¡Œåœ¨å½“å‰å’Œæ—§ç‰ˆæœ¬çš„æµè§ˆå™¨æˆ–å…¶ä»–ç¯å¢ƒä¸­ã€‚\n\n`babel`ï¼Œå…¶å®å°±æ˜¯å¸®æˆ‘ä»¬è§£ææˆ‘ä»¬å†™çš„ä»£ç ï¼Œç„¶åå˜æˆæµè§ˆå™¨èƒ½å¤Ÿè®¤è¯†æ ·å¼ã€‚æ¯”å¦‚`jsx`ï¼Œæ¯”å¦‚æ–°é²œçš„`es6`è¯­æ³•å¯ä»¥è¿è¡Œåœ¨è€ç‰ˆæœ¬çš„æµè§ˆå™¨ä¸Šï¼Œè®©è€ç‰ˆæœ¬çš„æµè§ˆå™¨èƒ½å¤Ÿè®¤è¯†ã€‚\n\né‚£é—®é¢˜åˆæ¥äº†ï¼Œjsxè¢«babelå˜æˆä»€ä¹ˆæ ·å­äº†ï¼Ÿ\n\nåœ¨çº¿è½¬æ¢ï¼šhttps://babeljs.io/repl\n\nå¤§å®¶å¯ä»¥æŠŠä¸Šé¢çš„å°demoï¼Œæ‰”è¿›å»ã€‚\n\n\n\n![bebel](/image/react/bebel.png)\n\n\n\nå‘ç°æ²¡æœ‰ã€‚æˆ‘ä»¬`return`å‡ºå»çš„ä¸œè¥¿å˜æˆäº†`React.createElement`ã€‚å“ˆå“ˆï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å³ä½¿æ²¡æœ‰ç”¨åˆ°`React`(è§£å†³äº†ä¸€åˆ°é¢è¯•é¢˜ï¼)ï¼Œä¹Ÿéœ€è¦åœ¨ä¸Šé¢`import`ï¼Œå› ä¸º`jsx`æœ€åæ˜¯ä¼šè¢«è½¬åŒ–ä¸º`React.createElement`ï¼Œä¼šç”¨åˆ°çš„ï¼ï¼ˆä¸è¿‡ç°åœ¨æœ€æ–°çš„å¥½åƒä¸éœ€è¦å¼•ç”¨ä¹Ÿä¸ä¼šæŠ¥é”™äº†ï¼Œå› ä¸ºä»–è‡ªå·±è¯†åˆ«äº†ã€‚\n\nå®˜ç½‘ä»‹ç»ï¼šhttps://zh-hans.reactjs.org/blog/2020/09/22/introducing-the-new-jsx-transform.html\n\n> ```\n> // ç”±ç¼–è¯‘å™¨å¼•å…¥ï¼ˆç¦æ­¢è‡ªå·±å¼•å…¥ï¼ï¼‰\n> import {jsx as _jsx} from 'react/jsx-runtime';\n> \n> function App() {\n>   return _jsx('h1', { children: 'Hello world' });\n> }\n> ```\n>\n> æ³¨æ„ï¼Œæ­¤æ—¶æºä»£ç **æ— éœ€å¼•å…¥ React** å³å¯ä½¿ç”¨ JSX äº†ï¼ï¼ˆä½†ä»éœ€å¼•å…¥ Reactï¼Œä»¥ä¾¿ä½¿ç”¨ React æä¾›çš„ Hook æˆ–å…¶ä»–å¯¼å‡ºã€‚ï¼‰\n\n\n\nå›åˆ°ä¹‹å‰`React`å®˜ç½‘æåˆ°çš„\n\n> å®ƒè¢«ç§°ä¸º JSXï¼Œæ˜¯ä¸€ä¸ª JavaScript çš„è¯­æ³•æ‰©å±•ã€‚\n\næœ‰æ²¡æœ‰å‘¼åº”èµ·æ¥äº†ï¼Œç¡®å®`js`ä»–éƒ½æœ‰ï¼Œä½†æ˜¯`js`æ²¡æœ‰çš„ï¼Œä»–è¿˜æœ‰æ¯”å¦‚è½¬åŒ–ä¸º`React.createElement`ã€‚\n\n\n\n## createElement\n\næˆ‘ä»¬æ˜¯æ¥è¯»æºç å­¦ä¹ çš„ï¼Œæˆ‘ä»¬æ—¢ç„¶çŸ¥é“äº†`jsx`çš„åº•å±‚æ˜¯è°ƒç”¨`react`çš„å‡½æ•°ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹è¿™ä¸ªå‡½æ•°æ˜¯ä¸ªä»€ä¹ˆæƒ…å†µã€‚\n\n```javascript\nexport function createElement(type, config, children) {\n  // propName å˜é‡ç”¨äºå‚¨å­˜åé¢éœ€è¦ç”¨åˆ°çš„å…ƒç´ å±æ€§\n  let propName; \n  // props å˜é‡ç”¨äºå‚¨å­˜å…ƒç´ å±æ€§çš„é”®å€¼å¯¹é›†åˆ\n  const props = {}; \n  // keyã€refã€selfã€source å‡ä¸º React å…ƒç´ çš„å±æ€§ï¼Œæ­¤å¤„ä¸å¿…æ·±ç©¶\n  let key = null;\n  let ref = null; \n  let self = null; \n  let source = null; \n\n  // config å¯¹è±¡ä¸­å­˜å‚¨çš„æ˜¯å…ƒç´ çš„å±æ€§\n  if (config != null) { \n    // è¿›æ¥ä¹‹ååšçš„ç¬¬ä¸€ä»¶äº‹ï¼Œæ˜¯ä¾æ¬¡å¯¹ refã€keyã€self å’Œ source å±æ€§èµ‹å€¼\n    if (hasValidRef(config)) {\n      ref = config.ref;\n    }\n    // æ­¤å¤„å°† key å€¼å­—ç¬¦ä¸²åŒ–\n    if (hasValidKey(config)) {\n      key = '' + config.key; \n    }\n    self = config.__self === undefined ? null : config.__self;\n    source = config.__source === undefined ? null : config.__source;\n    // æ¥ç€å°±æ˜¯è¦æŠŠ config é‡Œé¢çš„å±æ€§éƒ½ä¸€ä¸ªä¸€ä¸ªæŒªåˆ° props è¿™ä¸ªä¹‹å‰å£°æ˜å¥½çš„å¯¹è±¡é‡Œé¢\n    for (propName in config) {\n      if (\n        // ç­›é€‰å‡ºå¯ä»¥æè¿› props å¯¹è±¡é‡Œçš„å±æ€§\n        hasOwnProperty.call(config, propName) &&\n        !RESERVED_PROPS.hasOwnProperty(propName) \n      ) {\n        props[propName] = config[propName]; \n      }\n    }\n  }\n  // childrenLength æŒ‡çš„æ˜¯å½“å‰å…ƒç´ çš„å­å…ƒç´ çš„ä¸ªæ•°ï¼Œå‡å»çš„ 2 æ˜¯ type å’Œ config ä¸¤ä¸ªå‚æ•°å ç”¨çš„é•¿åº¦\n  const childrenLength = arguments.length - 2; \n  // å¦‚æœæŠ›å»typeå’Œconfigï¼Œå°±åªå‰©ä¸‹ä¸€ä¸ªå‚æ•°ï¼Œä¸€èˆ¬æ„å‘³ç€æ–‡æœ¬èŠ‚ç‚¹å‡ºç°äº†\n  if (childrenLength === 1) { \n    // ç›´æ¥æŠŠè¿™ä¸ªå‚æ•°çš„å€¼èµ‹ç»™props.children\n    props.children = children; \n    // å¤„ç†åµŒå¥—å¤šä¸ªå­å…ƒç´ çš„æƒ…å†µ\n  } else if (childrenLength > 1) { \n    // å£°æ˜ä¸€ä¸ªå­å…ƒç´ æ•°ç»„\n    const childArray = Array(childrenLength); \n    // æŠŠå­å…ƒç´ æ¨è¿›æ•°ç»„é‡Œ\n    for (let i = 0; i < childrenLength; i++) { \n      childArray[i] = arguments[i + 2];\n    }\n    // æœ€åæŠŠè¿™ä¸ªæ•°ç»„èµ‹å€¼ç»™props.children\n    props.children = childArray; \n  } \n\n  // å¤„ç† defaultProps\n  if (type && type.defaultProps) {\n    const defaultProps = type.defaultProps;\n    for (propName in defaultProps) { \n      if (props[propName] === undefined) {\n        props[propName] = defaultProps[propName];\n      }\n    }\n  }\n\n  // æœ€åè¿”å›ä¸€ä¸ªè°ƒç”¨ReactElementæ‰§è¡Œæ–¹æ³•ï¼Œå¹¶ä¼ å…¥åˆšæ‰å¤„ç†è¿‡çš„å‚æ•°\n  return ReactElement(\n    type,\n    key,\n    ref,\n    self,\n    source,\n    ReactCurrentOwner.current,\n    props,\n  );\n}\n```\n\n\n\nå…ˆä¸çœ‹å‚æ•°ï¼Œæˆ‘ä»¬å°±å…ˆçœ‹è¿”å›å€¼çš„åå­—å’Œè¿™ä¸ªå‡½æ•°çš„åå­—ã€‚æˆ‘ä»¬åˆæ­¥çŒœæµ‹ï¼Œ`jsx`æ˜¯é€šè¿‡`createElement`è¿™ä¸ªå‡½æ•°æ¥åˆ›å»ºä¸€ä¸ª`React`å…ƒç´ ï¼Œç„¶åç”±`ReactDOM.render`æ¥æ¸²æŸ“åˆ°æˆ‘ä»¬æŒ‡å®šåå­—çš„å…ƒç´ ä¸Šã€‚\n\n\n\n\n\nokï¼Œé‚£ä¹ˆæˆ‘ä»¬å¹³å¸¸å†™çš„jsxå…ƒç´ å°±æ˜¯`ReactElement`ç”Ÿæˆçš„ä¸œè¥¿ã€‚æˆ‘ä»¬çœ‹çœ‹`ReactElement`ç”Ÿæˆçš„æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ã€‚\n\næˆ‘ä»¬å…ˆæŠŠæˆ‘ä»¬å¹³å¸¸å†™çš„`jsx`ç»™æ‰“å°ä¸€ä¸‹ã€‚\n\n\n\n![element](/image/react/element.png)\n\n\n\nå‡­ç›´è§‰ï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰è¿™ä¸ªæ˜¯ä¸€ä¸ª`è™šæ‹ŸDOM`çš„èŠ‚ç‚¹ï¼Œä»–æœ‰ç±»å‹ç„¶ååˆæ˜¯`div`ï¼Œå¯¹åº”çš„ä¼šä¸ä¼šæ˜¯`html`çš„`div`æ ‡ç­¾ï¼Ÿè¿˜æœ‰`className`ï¼Œè¿™ä¸ªå¾ˆæ˜æ˜¾å°±æ˜¯å¯¹åº”`class`ã€‚æˆ‘ä»¬å»ä¸€çœ‹ç©¶ç«Ÿã€‚\n\n## ReactElement\n\n\n\n```javascript\nconst ReactElement = function(type, key, ref, self, source, owner, props) {\n  const element = {\n    // è¿™ä¸ªæ˜¯ä¸€ä¸ªReactç»“ç‚¹çš„æ ‡è¯†ç¬¦\n    $$typeof: REACT_ELEMENT_TYPE,\n\n    // å¾ˆæ˜æ˜¾å°±æ˜¯å¯¹åº”çš„htmlçš„æ ‡ç­¾\n    type: type,\n    key: key,\n    ref: ref,\n    props: props,\n\n    // è®°å½•ç”±è°åˆ›å»ºçš„ï¼Œæš‚æ—¶ä¹Ÿä¸çŸ¥é“ä»€ä¹ˆç”¨ã€‚å…ˆæŒ–ä¸ªå‘\n    _owner: owner,\n  };\n\n  // å¼€å‘ç¯å¢ƒä¸‹çš„é…ç½®ï¼Œä¸»è¦å°±æ˜¯Object.freezeï¼Œå¯ä»¥åœ¨MDNä¸Šé¢æŸ¥ä¸€ä¸‹ã€‚æˆ‘å°±ä¸å¤šä»‹ç»äº†\n  if (__DEV__) {\n    // The validation flag is currently mutative. We put it on\n    // an external backing store so that we can freeze the whole object.\n    // This can be replaced with a WeakMap once they are implemented in\n    // commonly used development environments.\n    element._store = {};\n\n    // To make comparing ReactElements easier for testing purposes, we make\n    // the validation flag non-enumerable (where possible, which should\n    // include every environment we run tests in), so the test framework\n    // ignores it.\n    Object.defineProperty(element._store, 'validated', {\n      configurable: false,\n      enumerable: false,\n      writable: true,\n      value: false,\n    });\n    // self and source are DEV only properties.\n    Object.defineProperty(element, '_self', {\n      configurable: false,\n      enumerable: false,\n      writable: false,\n      value: self,\n    });\n    // Two elements created in two different places should be considered\n    // equal for testing purposes and therefore we hide it from enumeration.\n    Object.defineProperty(element, '_source', {\n      configurable: false,\n      enumerable: false,\n      writable: false,\n      value: source,\n    });\n    if (Object.freeze) {\n      Object.freeze(element.props);\n      Object.freeze(element);\n    }\n  }\n\n  return element;\n};\n```\n\n\n\nçœ‹è¿‡ä¹‹åï¼Œæ˜¯ä¸æ˜¯å’Œæˆ‘ä»¬çœ‹åˆ°çš„èŠ‚ç‚¹ä¸€æ ·ï¼Œé¦–å…ˆï¼Œæ ‡æ³¨ä¸€ä¸‹`$$typeof`ä¸º`reactèŠ‚ç‚¹`ã€‚ç„¶åå°±æ˜¯æ­£å¸¸çš„ä¼ å‚ï¼Œæ¯”å¦‚`key`ï¼Œ`ref`ï¼Œ`props`ç­‰ç­‰ã€‚\n\n## ReactDOM.render\n\nè¿™ä¸ªå°±æ˜¯ReactèŠ‚ç‚¹æ¸²æŸ“ä¸ºçœŸæ˜¯èŠ‚ç‚¹çš„æ“ä½œã€‚è¯ä¸å¤šè¯´ï¼Œä¸Šæºç ï¼\n\n\n\n```javascript\nexport function isValidContainer(node: mixed): boolean {\n  return !!(\n    node &&\n    (node.nodeType === ELEMENT_NODE ||\n      node.nodeType === DOCUMENT_NODE ||\n      node.nodeType === DOCUMENT_FRAGMENT_NODE ||\n      (node.nodeType === COMMENT_NODE &&\n        (node: any).nodeValue === ' react-mount-point-unstable '))\n  );\n}\n\nexport function render(\n  element: React$Element<any>,\n  container: Container,\n  callback: ?Function,\n) {\n  // ç”¨äºæŠ›å‡ºé”™è¯¯çš„, å°±æ˜¯åˆ¤æ–­è¿™ä¸ªcontaineræ˜¯ä¸æ˜¯æ‰¾å¾—åˆ°\n  invariant(\n    isValidContainer(container),\n    'Target container is not a DOM element.',\n  );\n  if (__DEV__) {\n    const isModernRoot =\n      isContainerMarkedAsRoot(container) &&\n      container._reactRootContainer === undefined;\n    if (isModernRoot) {\n      console.error(\n        'You are calling ReactDOM.render() on a container that was previously ' +\n          'passed to ReactDOM.createRoot(). This is not supported. ' +\n          'Did you mean to call root.render(element)?',\n      );\n    }\n  }\n  \n  // è¿™é‡Œé¢æ¶‰åŠåˆ°äº†fiberçš„ä¸€äº›æ¶æ„ï¼Œæˆ‘æƒ³ä¹‹åå†è¯´ï¼Œå†æŒ–ä¸ªå‘\n  return legacyRenderSubtreeIntoContainer(\n    null,\n    element,\n    container,\n    false,\n    callback,\n  );\n}\n```\n\n\n\næœ‰æ²¡æœ‰æ„Ÿè§‰å¾ˆç®€å•ï¼Œå»é™¤`__DEV__`æƒ…å†µçš„è¯ã€‚ä¹Ÿæ˜¯è¿”å›ä¸€ä¸ªå‡½æ•°çš„ç»“æœã€‚ã€‚ã€‚\n\n\n\n## ReactDOM.hydrate\n\n\n\nè¿™ä¸ªå‡½æ•°æˆ‘å‘ç°å¾ˆæœ‰æ„æ€ï¼Œä¸ReactDOM.renderåªæœ‰ä¸€è¡Œä»£ç ä¸ä¸€æ ·\n\n```diff\nlegacyRenderSubtreeIntoContainer(\n    null,\n    element,\n    container,\n-   false,\n+   true,\n    callback,\n  );\n```\n\n\n\né¦–å…ˆï¼Œè¿™ä¸ª`hydrate`çš„æ„æ€æ˜¯æ³¨æ°´ã€‚å¤§è‡´çš„æ„æ€æ˜¯ç»™ä¸€ä¸ªç»“ç‚¹å¢åŠ æ°´åˆ†ï¼Œå¢æ·»è‰²å½©ã€‚ä¹‹å‰æ˜¯ç»™`SSR`è¿‡ç¨‹ä¸­æ·»åŠ ç‚¹å‡»äº‹ä»¶ä¹‹ç±»ä½¿ç”¨çš„ã€‚åœ¨`React17`ä¹‹åä¼šæ·˜æ±°æ‰`ReactDOM.Render`ï¼Œå…¨éƒ¨ç”¨`ReactDOM.hydrate`æ¥ä»£æ›¿ã€‚\n\nReactå®˜ç½‘çš„ä¸€å¥è¯\n\n> ä½¿ç”¨ `ReactDOM.render()` å¯¹æœåŠ¡ç«¯æ¸²æŸ“å®¹å™¨è¿›è¡Œ hydrate æ“ä½œçš„æ–¹å¼å·²ç»è¢«åºŸå¼ƒï¼Œå¹¶ä¸”ä¼šåœ¨ React 17 è¢«ç§»é™¤ã€‚ä½œä¸ºæ›¿ä»£ï¼Œè¯·ä½¿ç”¨ [`hydrate()`](https://zh-hans.reactjs.org/docs/react-dom.html#hydrate)ã€‚\n\n\n\n## ä¸ºä»€ä¹ˆè¦ä½¿ç”¨JSX\n\nè¿™é‡Œåˆ†äº«ä¸€ä¸ªè§£é¢˜çš„å°æŠ€å·§ã€‚ä¸ºä»€ä¹ˆè¦XXå…¶å®å°±æ˜¯è¦é—®ä½ ï¼ŒXXçš„å¥½å¤„ã€‚okï¼Œé‚£æ¥ä¸‹æ¥å°±å¾ˆå¥½å›ç­”äº†\n\né¦–å…ˆï¼Œå› ä¸ºå¦‚æœä¸ç”¨`jsx`ï¼Œæˆ‘ä»¬å°±è¦åœ¨ä»£ç é‡Œé¢å†™ä¸Šç™¾ä¸ª`React.crearteElement`ã€‚\n\nç¬¬äºŒï¼Œè¿™ä¸ªè¯­æ³•ç³–å¯ä»¥è®©å¼€å‘è€…ä½¿ç”¨ç†Ÿæ‚‰çš„`HTML`æ ‡ç­¾æ¥åˆ›å»º`è™šæ‹ŸDOM`ï¼Œé™ä½å­¦ä¹ æˆæœ¬ã€‚æå‡å¼€å‘æ•ˆç‡ä¸å¼€å‘ä½“éªŒ\n\n\n\n\n\n![bebel](/image/react/bebel.png)\n\n\n\n# å‰©ä½™çš„å‘\n\n- legacyRenderSubtreeIntoContainerï¼ˆæ¶‰åŠfiberæ¶æ„\n- _ownerï¼ˆåˆ›å»ºçš„æ—¶å€™ï¼Œè¿™ä¸ªå±æ€§æœ‰ä»€ä¹ˆç”¨\n\n# ç´¢å¼•\n\nhttps://zh-hans.reactjs.org/docs\n\nhttps://www.babeljs.cn/docs/\n\n\n\n\n\n\n\n","slug":"ã€é‡è¯†å‰ç«¯ã€‘Reactæºç é˜…è¯»ï¼ˆä¸€ï¼‰jsx","published":1,"updated":"2021-06-27T07:32:21.936Z","title":"ã€é‡è¯†å‰ç«¯ã€‘Reactæºç é˜…è¯»ï¼ˆä¸€ï¼‰jsx","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra840012lwrd97u032an","content":"<h1 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h1><p>ä¸€äº›åºŸè¯å’Œä¸ªäººæ„Ÿæ‚Ÿï¼Œçœ‹å¹²è´§çš„ç›´æ¥è·³è¿‡â€¦.åˆ°<code>jsx</code></p>\n<p>é‡è¯†å‰ç«¯æ–­æ–­ç»­ç»­ä¹Ÿå†™äº†å¤§åŠå¹´äº†ã€‚é‡Œé¢åŸºæœ¬ä¸Šéƒ½æ˜¯ä¸ªäººæŠ€æœ¯æ ˆçš„ç§¯ç´¯ï¼Œä»¥åŠé¢è¯•é¢˜çš„å›ç­”ã€‚æ„Ÿå…´è¶£çš„ä¼™ä¼´å¯ä»¥ç‚¹åˆ°æˆ‘çš„ä¸»é¡µå»çœ‹ã€‚</p>\n<p>è¯´è¯´ä»Šå¤©çš„ä¸»è§’-<code>React</code>å§ã€‚<code>React</code>çš„æºç ä¹‹å‰ä¸€ç›´æƒ³è¦å»é˜…è¯»å­¦ä¹ çš„ï¼Œä¹Ÿç¡®ç¡®å®å®åœ¨çœ‹äº†ï¼Œä½†æ˜¯ç»å¸¸çœ‹ç€çœ‹ç€å°±å‘å›°ã€‚ç„¶åå°±å¼€å§‹å·æ‡’ï¼Œä»ä¸€äº›å‘¨è¾¹çš„å¼€å§‹é˜…è¯»ï¼Œæ¯”å¦‚<code>React-Router</code>ï¼Œ<code>React-Redux</code>ä¹‹ç±»çš„ã€‚ä¹‹å‰éƒ½æ˜¯çœ‹å®Œä¹‹åå†å¼€å§‹å†™æ–‡ç« ã€‚ç°åœ¨æƒ³ä¸€è¾¹çœ‹ä¸€è¾¹å†™ï¼Œæ¢ä¸ªæ–¹å¼çœ‹çœ‹ã€‚å¦‚æœæœ‰å†™é”™çš„åœ°æ–¹æ¬¢è¿å¤§å®¶è®¨è®ºï¼Œå¦‚æœè§‰å¾—è¿˜å¯ä»¥çš„è¯å¯ä»¥ç‚¹ä¸ªèµï¼Œè°¢è°¢ï¼</p>\n<p>ä½œä¸ºä¸€å<code>React</code>çš„é‡åº¦ä½¿ç”¨è€…å’Œçˆ±å¥½è€…ã€‚æˆ‘å°†ä¼šå’Œå¤§å®¶ä¸€èµ·ä»ã€Œä½¿ç”¨è€…ã€åˆ°ã€Œäº†è§£è€…ã€è¿›æ­¥ï¼</p>\n<h1 id=\"Reactçš„ç›¸å…³ä¿¡æ¯\"><a href=\"#Reactçš„ç›¸å…³ä¿¡æ¯\" class=\"headerlink\" title=\"Reactçš„ç›¸å…³ä¿¡æ¯\"></a>Reactçš„ç›¸å…³ä¿¡æ¯</h1><h2 id=\"åŠŸåˆ©çš„è§’åº¦\"><a href=\"#åŠŸåˆ©çš„è§’åº¦\" class=\"headerlink\" title=\"åŠŸåˆ©çš„è§’åº¦\"></a>åŠŸåˆ©çš„è§’åº¦</h2><p>æ‰“å¼€æ‹›è˜è½¯ä»¶ï¼Œç°åœ¨åŸºæœ¬ä¸Šçš„å¤§å‚ï¼Œç”šè‡³æ˜¯å¤–åŒ…å…¬å¸éƒ½æ™®éè¦æ±‚ä½ ä¼š<code>React</code>æˆ–è€…<code>Vue</code>ã€‚ç»™å‡ºçš„è–ªèµ„ä¹Ÿæ˜¯éå¸¸çš„è¯±äººã€‚</p>\n<p>ï¼ˆå›¾ç‰‡æ¥è‡ªBossæŸè˜ï¼‰</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/react1/offer.png\"  alt=\"offer\"></p>\n<p>ä¸ºäº†å‘è´¢è¿™ä¸ªæœ´å®çš„æ¢¦æƒ³ä¹Ÿåº”è¯¥å­¦ä¹ ã€‚</p>\n<h2 id=\"å­¦ä¹ çš„è§’åº¦\"><a href=\"#å­¦ä¹ çš„è§’åº¦\" class=\"headerlink\" title=\"å­¦ä¹ çš„è§’åº¦\"></a>å­¦ä¹ çš„è§’åº¦</h2><p>å¦‚ä»Šå‰ç«¯å¾¡ä¸‰å®¶ï¼š<code>Angular</code>ã€<code>React</code>ã€<code>Vue</code>ä¸‰åˆ†å¤©ä¸‹ã€‚å›½å†…æ›´é’ç<code>React</code>å’Œ<code>Vue</code>ã€‚æ‰€ä»¥ï¼Œä»å­¦ä¹ çš„è§’åº¦æ›´åº”è¯¥å­¦ä¹ <code>React</code>ã€‚</p>\n<p><a href=\"https://www.npmtrends.com/react-vs-vue-vs-@angular/core\" target=\"_blank\" rel=\"noopener\">https://www.npmtrends.com/react-vs-vue-vs-@angular/core</a></p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/react1/download.jpg\"  alt=\"offer\"></p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/react1/stats\"  alt=\"offer\"></p>\n<h2 id=\"ä¸ºä»€ä¹ˆéè¦å­¦ä¹ æºç \"><a href=\"#ä¸ºä»€ä¹ˆéè¦å­¦ä¹ æºç \" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆéè¦å­¦ä¹ æºç \"></a>ä¸ºä»€ä¹ˆéè¦å­¦ä¹ æºç </h2><p>è¿™ä¸ªé—®é¢˜æˆ‘ä¹‹å‰ä¹Ÿé—®è¿‡ï¼Œå‡ ä¹æ‰€æœ‰çš„é¢è¯•éƒ½æ˜¯é€ ç«ç®­ï¼Œå·¥ä½œæ‹§èºä¸ã€‚</p>\n<p>æˆ‘è®¤ä¸ºä»ä¸¤ä¸ªè§’åº¦æ¥çœ‹è¿™ä¸ªé—®é¢˜ï¼š</p>\n<ol>\n<li>åº”è˜è€…<ol>\n<li>åƒé€<code>React</code>çš„æƒ…å†µä¸‹ï¼Œè§£å†³é—®é¢˜çš„ä¸Šé™è‚¯å®šæ˜¯æé«˜äº†</li>\n<li>ä¸€ä¸ªä¼˜ç§€çš„æ¡†æ¶æ˜¯ä¸€ä½ä¼˜ç§€çš„è€å¸ˆ</li>\n</ol>\n</li>\n<li>æ‹›è˜è€…ï¼Œæ—¢ç„¶éƒ½æ˜¯èƒ½å¹²æ´»çš„ï¼Œæˆ‘å°±æ‰¾ä¸€ä¸ªæ‡‚å¾—æ›´å¤šçš„äººæ¥å¹²è¿™ä¸ªæ´»</li>\n</ol>\n<h1 id=\"JSX\"><a href=\"#JSX\" class=\"headerlink\" title=\"JSX\"></a>JSX</h1><p>åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥å¼€å§‹ã€‚</p>\n<p>JSXï¼Œå†ç†Ÿæ‚‰ä¸è¿‡äº†ï¼Œæ—¥å¸¸ä½¿ç”¨Reactè¿‡ç¨‹ä¸­è‚¯å®šä¼šç”¨åˆ°çš„ã€‚ç»™ä¸€ä¸ªdemoï¼Œå¸®å¤§å®¶å›ä¸€ä¸‹ã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import React from &quot;react&quot;;</span><br><span class=\"line\">import ReactDOM from &quot;react-dom&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">class App extends React.Component &#123;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    const text &#x3D; &quot;å“ˆå“ˆå“ˆ&quot;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">      &lt;div&gt;</span><br><span class=\"line\">        &lt;p&gt;&#123;text&#125;&lt;&#x2F;p&gt;</span><br><span class=\"line\">      &lt;&#x2F;div&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">const rootElement &#x3D; document.getElementById(&quot;root&quot;);</span><br><span class=\"line\">ReactDOM.render(&lt;App &#x2F;&gt;, rootElement);</span><br></pre></td></tr></table></figure>\n\n\n\n<p>æˆ‘å…ˆé—®å‡ ä¸ªé—®é¢˜ï¼Œå¦‚æœèƒ½å¤Ÿæ¸…æ™°çš„å¿«é€Ÿç­”å‡ºæ¥ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼Œä½ çš„åŸºç¡€å¾ˆæ‰å®ï¼Œå¦‚æœä¸è¡Œï¼Œé‚£å°±ä¸€èµ·çœ‹çœ‹ï¼Œçœ‹å®Œä¹‹åå¯ä»¥æŠŠä½ çš„ç­”æ¡ˆå†™åœ¨è¯„è®ºåŒºï¼Œå’Œå¤§å®¶è®¨è®ºã€‚</p>\n<ul>\n<li>ä»€ä¹ˆæ˜¯<code>JSX</code>ï¼Ÿ<code>JSX</code>å’Œ<code>JS</code>æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</li>\n<li><code>JSX</code>çš„åº•å±‚åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</li>\n<li>ä¸ºä»€ä¹ˆ<code>React</code>è¦é€‰æ‹©<code>JSX</code>ï¼Ÿ</li>\n</ul>\n<p>å¸¦ç€é—®é¢˜ä¸€èµ·æ¥çœ‹ã€‚</p>\n<h2 id=\"ä»€ä¹ˆæ˜¯JSX\"><a href=\"#ä»€ä¹ˆæ˜¯JSX\" class=\"headerlink\" title=\"ä»€ä¹ˆæ˜¯JSX\"></a>ä»€ä¹ˆæ˜¯JSX</h2><p>å…ˆçœ‹çœ‹<code>React</code>å®˜ç½‘çš„ä¸€å¥è¯ã€‚</p>\n<blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const element &#x3D; &lt;h1&gt;Hello, world!&lt;&#x2F;h1&gt;;</span><br></pre></td></tr></table></figure>\n\n<p>å®ƒè¢«ç§°ä¸º JSXï¼Œæ˜¯ä¸€ä¸ª JavaScript çš„è¯­æ³•æ‰©å±•ã€‚</p>\n</blockquote>\n<p>è¯­æ³•æ‰©å±•ï¼Œæ„æ€å°±æ˜¯<code>JS</code>æœ‰çš„ä»–éƒ½æœ‰çš„æƒ…å†µä¸‹ï¼Œè¿˜æœ‰ä¸€äº›åˆ«çš„åŠŸèƒ½ã€‚å¯æ˜¯è¿™è´§ï¼Œæ˜æ˜¾åœ¨<code>JavaScript</code>å­¦ä¹ è¿‡ç¨‹ä¸­æ²¡è§è¿‡ä»–å‘€ã€‚ä»–èƒ½è¿è¡Œåœ¨<code>JavaScript</code>çš„ç¯å¢ƒä¸­å—ï¼Ÿæ‰“å¼€<code>Chrome</code>æ§åˆ¶å°ã€‚</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/react/console.png\"  alt=\"console\"></p>\n<p>ä¸Šæ¥å°±æ˜¯åŠˆå¤´ç›–è„¸çš„è¯­æ³•é”™è¯¯ï¼Œçœ‹æ ·å­è¿™éƒ¨åˆ†å°±æ˜¯å¤šå‡ºæ¥çš„åŠŸèƒ½äº†å‘—ã€‚é‚£å’‹è¿è¡Œå•Šï¼Ÿ</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.(js|jsx)?$/</span>,</span><br><span class=\"line\">        <span class=\"comment\">// å¼€å¯ç¼“å­˜</span></span><br><span class=\"line\">        options: &#123; <span class=\"attr\">cacheDirectory</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">        loader: <span class=\"string\">'babel-loader'</span>,</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n\n<p>æ€ä¹ˆæ ·ï¼Œç†Ÿæ‚‰ä¸ï¼Œæ„æ€æ˜¯å‘Šè¯‰<code>webpack</code>ï¼Œè§£æ<code>jsx</code>ç»“å°¾çš„ä»£ç ï¼Œéœ€è¦ç”¨åˆ°<code>babel</code>ã€‚okï¼Œä¹Ÿå°±æ˜¯è¯´è¦æƒ³è¿è¡Œ<code>jsx</code>ï¼Œå°±å¿…é¡»ç”¨<code>babel</code>è§£æã€‚é‚£å¥½ï¼Œä»€ä¹ˆæ˜¯babelï¼Ÿ</p>\n<h3 id=\"babel\"><a href=\"#babel\" class=\"headerlink\" title=\"babel\"></a>babel</h3><p>æ‹‰ä¸€æ®µ<code>babel</code>å®˜ç½‘ä¸Šçš„ä¸€å¥è¯</p>\n<blockquote>\n<h2 id=\"Babel-æ˜¯ä¸€ä¸ª-JavaScript-ç¼–è¯‘å™¨\"><a href=\"#Babel-æ˜¯ä¸€ä¸ª-JavaScript-ç¼–è¯‘å™¨\" class=\"headerlink\" title=\"Babel æ˜¯ä¸€ä¸ª JavaScript ç¼–è¯‘å™¨\"></a>Babel æ˜¯ä¸€ä¸ª JavaScript ç¼–è¯‘å™¨</h2><p>Babel æ˜¯ä¸€ä¸ªå·¥å…·é“¾ï¼Œä¸»è¦ç”¨äºå°† ECMAScript 2015+ ç‰ˆæœ¬çš„ä»£ç è½¬æ¢ä¸ºå‘åå…¼å®¹çš„ JavaScript è¯­æ³•ï¼Œä»¥ä¾¿èƒ½å¤Ÿè¿è¡Œåœ¨å½“å‰å’Œæ—§ç‰ˆæœ¬çš„æµè§ˆå™¨æˆ–å…¶ä»–ç¯å¢ƒä¸­ã€‚</p>\n</blockquote>\n<p><code>babel</code>ï¼Œå…¶å®å°±æ˜¯å¸®æˆ‘ä»¬è§£ææˆ‘ä»¬å†™çš„ä»£ç ï¼Œç„¶åå˜æˆæµè§ˆå™¨èƒ½å¤Ÿè®¤è¯†æ ·å¼ã€‚æ¯”å¦‚<code>jsx</code>ï¼Œæ¯”å¦‚æ–°é²œçš„<code>es6</code>è¯­æ³•å¯ä»¥è¿è¡Œåœ¨è€ç‰ˆæœ¬çš„æµè§ˆå™¨ä¸Šï¼Œè®©è€ç‰ˆæœ¬çš„æµè§ˆå™¨èƒ½å¤Ÿè®¤è¯†ã€‚</p>\n<p>é‚£é—®é¢˜åˆæ¥äº†ï¼Œjsxè¢«babelå˜æˆä»€ä¹ˆæ ·å­äº†ï¼Ÿ</p>\n<p>åœ¨çº¿è½¬æ¢ï¼š<a href=\"https://babeljs.io/repl\" target=\"_blank\" rel=\"noopener\">https://babeljs.io/repl</a></p>\n<p>å¤§å®¶å¯ä»¥æŠŠä¸Šé¢çš„å°demoï¼Œæ‰”è¿›å»ã€‚</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/react/bebel.png\"  alt=\"bebel\"></p>\n<p>å‘ç°æ²¡æœ‰ã€‚æˆ‘ä»¬<code>return</code>å‡ºå»çš„ä¸œè¥¿å˜æˆäº†<code>React.createElement</code>ã€‚å“ˆå“ˆï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å³ä½¿æ²¡æœ‰ç”¨åˆ°<code>React</code>(è§£å†³äº†ä¸€åˆ°é¢è¯•é¢˜ï¼)ï¼Œä¹Ÿéœ€è¦åœ¨ä¸Šé¢<code>import</code>ï¼Œå› ä¸º<code>jsx</code>æœ€åæ˜¯ä¼šè¢«è½¬åŒ–ä¸º<code>React.createElement</code>ï¼Œä¼šç”¨åˆ°çš„ï¼ï¼ˆä¸è¿‡ç°åœ¨æœ€æ–°çš„å¥½åƒä¸éœ€è¦å¼•ç”¨ä¹Ÿä¸ä¼šæŠ¥é”™äº†ï¼Œå› ä¸ºä»–è‡ªå·±è¯†åˆ«äº†ã€‚</p>\n<p>å®˜ç½‘ä»‹ç»ï¼š<a href=\"https://zh-hans.reactjs.org/blog/2020/09/22/introducing-the-new-jsx-transform.html\" target=\"_blank\" rel=\"noopener\">https://zh-hans.reactjs.org/blog/2020/09/22/introducing-the-new-jsx-transform.html</a></p>\n<blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; ç”±ç¼–è¯‘å™¨å¼•å…¥ï¼ˆç¦æ­¢è‡ªå·±å¼•å…¥ï¼ï¼‰</span><br><span class=\"line\">import &#123;jsx as _jsx&#125; from &#39;react&#x2F;jsx-runtime&#39;;</span><br><span class=\"line\"></span><br><span class=\"line\">function App() &#123;</span><br><span class=\"line\">  return _jsx(&#39;h1&#39;, &#123; children: &#39;Hello world&#39; &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æ³¨æ„ï¼Œæ­¤æ—¶æºä»£ç <strong>æ— éœ€å¼•å…¥ React</strong> å³å¯ä½¿ç”¨ JSX äº†ï¼ï¼ˆä½†ä»éœ€å¼•å…¥ Reactï¼Œä»¥ä¾¿ä½¿ç”¨ React æä¾›çš„ Hook æˆ–å…¶ä»–å¯¼å‡ºã€‚ï¼‰</p>\n</blockquote>\n<p>å›åˆ°ä¹‹å‰<code>React</code>å®˜ç½‘æåˆ°çš„</p>\n<blockquote>\n<p>å®ƒè¢«ç§°ä¸º JSXï¼Œæ˜¯ä¸€ä¸ª JavaScript çš„è¯­æ³•æ‰©å±•ã€‚</p>\n</blockquote>\n<p>æœ‰æ²¡æœ‰å‘¼åº”èµ·æ¥äº†ï¼Œç¡®å®<code>js</code>ä»–éƒ½æœ‰ï¼Œä½†æ˜¯<code>js</code>æ²¡æœ‰çš„ï¼Œä»–è¿˜æœ‰æ¯”å¦‚è½¬åŒ–ä¸º<code>React.createElement</code>ã€‚</p>\n<h2 id=\"createElement\"><a href=\"#createElement\" class=\"headerlink\" title=\"createElement\"></a>createElement</h2><p>æˆ‘ä»¬æ˜¯æ¥è¯»æºç å­¦ä¹ çš„ï¼Œæˆ‘ä»¬æ—¢ç„¶çŸ¥é“äº†<code>jsx</code>çš„åº•å±‚æ˜¯è°ƒç”¨<code>react</code>çš„å‡½æ•°ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹è¿™ä¸ªå‡½æ•°æ˜¯ä¸ªä»€ä¹ˆæƒ…å†µã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createElement</span>(<span class=\"params\">type, config, children</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// propName å˜é‡ç”¨äºå‚¨å­˜åé¢éœ€è¦ç”¨åˆ°çš„å…ƒç´ å±æ€§</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> propName; </span><br><span class=\"line\">  <span class=\"comment\">// props å˜é‡ç”¨äºå‚¨å­˜å…ƒç´ å±æ€§çš„é”®å€¼å¯¹é›†åˆ</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> props = &#123;&#125;; </span><br><span class=\"line\">  <span class=\"comment\">// keyã€refã€selfã€source å‡ä¸º React å…ƒç´ çš„å±æ€§ï¼Œæ­¤å¤„ä¸å¿…æ·±ç©¶</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> key = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> ref = <span class=\"literal\">null</span>; </span><br><span class=\"line\">  <span class=\"keyword\">let</span> self = <span class=\"literal\">null</span>; </span><br><span class=\"line\">  <span class=\"keyword\">let</span> source = <span class=\"literal\">null</span>; </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// config å¯¹è±¡ä¸­å­˜å‚¨çš„æ˜¯å…ƒç´ çš„å±æ€§</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (config != <span class=\"literal\">null</span>) &#123; </span><br><span class=\"line\">    <span class=\"comment\">// è¿›æ¥ä¹‹ååšçš„ç¬¬ä¸€ä»¶äº‹ï¼Œæ˜¯ä¾æ¬¡å¯¹ refã€keyã€self å’Œ source å±æ€§èµ‹å€¼</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (hasValidRef(config)) &#123;</span><br><span class=\"line\">      ref = config.ref;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// æ­¤å¤„å°† key å€¼å­—ç¬¦ä¸²åŒ–</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (hasValidKey(config)) &#123;</span><br><span class=\"line\">      key = <span class=\"string\">''</span> + config.key; </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    self = config.__self === <span class=\"literal\">undefined</span> ? <span class=\"literal\">null</span> : config.__self;</span><br><span class=\"line\">    source = config.__source === <span class=\"literal\">undefined</span> ? <span class=\"literal\">null</span> : config.__source;</span><br><span class=\"line\">    <span class=\"comment\">// æ¥ç€å°±æ˜¯è¦æŠŠ config é‡Œé¢çš„å±æ€§éƒ½ä¸€ä¸ªä¸€ä¸ªæŒªåˆ° props è¿™ä¸ªä¹‹å‰å£°æ˜å¥½çš„å¯¹è±¡é‡Œé¢</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (propName <span class=\"keyword\">in</span> config) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (</span><br><span class=\"line\">        <span class=\"comment\">// ç­›é€‰å‡ºå¯ä»¥æè¿› props å¯¹è±¡é‡Œçš„å±æ€§</span></span><br><span class=\"line\">        hasOwnProperty.call(config, propName) &amp;&amp;</span><br><span class=\"line\">        !RESERVED_PROPS.hasOwnProperty(propName) </span><br><span class=\"line\">      ) &#123;</span><br><span class=\"line\">        props[propName] = config[propName]; </span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// childrenLength æŒ‡çš„æ˜¯å½“å‰å…ƒç´ çš„å­å…ƒç´ çš„ä¸ªæ•°ï¼Œå‡å»çš„ 2 æ˜¯ type å’Œ config ä¸¤ä¸ªå‚æ•°å ç”¨çš„é•¿åº¦</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> childrenLength = <span class=\"built_in\">arguments</span>.length - <span class=\"number\">2</span>; </span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœæŠ›å»typeå’Œconfigï¼Œå°±åªå‰©ä¸‹ä¸€ä¸ªå‚æ•°ï¼Œä¸€èˆ¬æ„å‘³ç€æ–‡æœ¬èŠ‚ç‚¹å‡ºç°äº†</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (childrenLength === <span class=\"number\">1</span>) &#123; </span><br><span class=\"line\">    <span class=\"comment\">// ç›´æ¥æŠŠè¿™ä¸ªå‚æ•°çš„å€¼èµ‹ç»™props.children</span></span><br><span class=\"line\">    props.children = children; </span><br><span class=\"line\">    <span class=\"comment\">// å¤„ç†åµŒå¥—å¤šä¸ªå­å…ƒç´ çš„æƒ…å†µ</span></span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (childrenLength &gt; <span class=\"number\">1</span>) &#123; </span><br><span class=\"line\">    <span class=\"comment\">// å£°æ˜ä¸€ä¸ªå­å…ƒç´ æ•°ç»„</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> childArray = <span class=\"built_in\">Array</span>(childrenLength); </span><br><span class=\"line\">    <span class=\"comment\">// æŠŠå­å…ƒç´ æ¨è¿›æ•°ç»„é‡Œ</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; childrenLength; i++) &#123; </span><br><span class=\"line\">      childArray[i] = <span class=\"built_in\">arguments</span>[i + <span class=\"number\">2</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// æœ€åæŠŠè¿™ä¸ªæ•°ç»„èµ‹å€¼ç»™props.children</span></span><br><span class=\"line\">    props.children = childArray; </span><br><span class=\"line\">  &#125; </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// å¤„ç† defaultProps</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (type &amp;&amp; type.defaultProps) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> defaultProps = type.defaultProps;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (propName <span class=\"keyword\">in</span> defaultProps) &#123; </span><br><span class=\"line\">      <span class=\"keyword\">if</span> (props[propName] === <span class=\"literal\">undefined</span>) &#123;</span><br><span class=\"line\">        props[propName] = defaultProps[propName];</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// æœ€åè¿”å›ä¸€ä¸ªè°ƒç”¨ReactElementæ‰§è¡Œæ–¹æ³•ï¼Œå¹¶ä¼ å…¥åˆšæ‰å¤„ç†è¿‡çš„å‚æ•°</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> ReactElement(</span><br><span class=\"line\">    type,</span><br><span class=\"line\">    key,</span><br><span class=\"line\">    ref,</span><br><span class=\"line\">    self,</span><br><span class=\"line\">    source,</span><br><span class=\"line\">    ReactCurrentOwner.current,</span><br><span class=\"line\">    props,</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>å…ˆä¸çœ‹å‚æ•°ï¼Œæˆ‘ä»¬å°±å…ˆçœ‹è¿”å›å€¼çš„åå­—å’Œè¿™ä¸ªå‡½æ•°çš„åå­—ã€‚æˆ‘ä»¬åˆæ­¥çŒœæµ‹ï¼Œ<code>jsx</code>æ˜¯é€šè¿‡<code>createElement</code>è¿™ä¸ªå‡½æ•°æ¥åˆ›å»ºä¸€ä¸ª<code>React</code>å…ƒç´ ï¼Œç„¶åç”±<code>ReactDOM.render</code>æ¥æ¸²æŸ“åˆ°æˆ‘ä»¬æŒ‡å®šåå­—çš„å…ƒç´ ä¸Šã€‚</p>\n<p>okï¼Œé‚£ä¹ˆæˆ‘ä»¬å¹³å¸¸å†™çš„jsxå…ƒç´ å°±æ˜¯<code>ReactElement</code>ç”Ÿæˆçš„ä¸œè¥¿ã€‚æˆ‘ä»¬çœ‹çœ‹<code>ReactElement</code>ç”Ÿæˆçš„æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ã€‚</p>\n<p>æˆ‘ä»¬å…ˆæŠŠæˆ‘ä»¬å¹³å¸¸å†™çš„<code>jsx</code>ç»™æ‰“å°ä¸€ä¸‹ã€‚</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/react/element.png\"  alt=\"element\"></p>\n<p>å‡­ç›´è§‰ï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰è¿™ä¸ªæ˜¯ä¸€ä¸ª<code>è™šæ‹ŸDOM</code>çš„èŠ‚ç‚¹ï¼Œä»–æœ‰ç±»å‹ç„¶ååˆæ˜¯<code>div</code>ï¼Œå¯¹åº”çš„ä¼šä¸ä¼šæ˜¯<code>html</code>çš„<code>div</code>æ ‡ç­¾ï¼Ÿè¿˜æœ‰<code>className</code>ï¼Œè¿™ä¸ªå¾ˆæ˜æ˜¾å°±æ˜¯å¯¹åº”<code>class</code>ã€‚æˆ‘ä»¬å»ä¸€çœ‹ç©¶ç«Ÿã€‚</p>\n<h2 id=\"ReactElement\"><a href=\"#ReactElement\" class=\"headerlink\" title=\"ReactElement\"></a>ReactElement</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> ReactElement = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">type, key, ref, self, source, owner, props</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> element = &#123;</span><br><span class=\"line\">    <span class=\"comment\">// è¿™ä¸ªæ˜¯ä¸€ä¸ªReactç»“ç‚¹çš„æ ‡è¯†ç¬¦</span></span><br><span class=\"line\">    $$<span class=\"keyword\">typeof</span>: REACT_ELEMENT_TYPE,</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å¾ˆæ˜æ˜¾å°±æ˜¯å¯¹åº”çš„htmlçš„æ ‡ç­¾</span></span><br><span class=\"line\">    type: type,</span><br><span class=\"line\">    key: key,</span><br><span class=\"line\">    ref: ref,</span><br><span class=\"line\">    props: props,</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// è®°å½•ç”±è°åˆ›å»ºçš„ï¼Œæš‚æ—¶ä¹Ÿä¸çŸ¥é“ä»€ä¹ˆç”¨ã€‚å…ˆæŒ–ä¸ªå‘</span></span><br><span class=\"line\">    _owner: owner,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// å¼€å‘ç¯å¢ƒä¸‹çš„é…ç½®ï¼Œä¸»è¦å°±æ˜¯Object.freezeï¼Œå¯ä»¥åœ¨MDNä¸Šé¢æŸ¥ä¸€ä¸‹ã€‚æˆ‘å°±ä¸å¤šä»‹ç»äº†</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (__DEV__) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// The validation flag is currently mutative. We put it on</span></span><br><span class=\"line\">    <span class=\"comment\">// an external backing store so that we can freeze the whole object.</span></span><br><span class=\"line\">    <span class=\"comment\">// This can be replaced with a WeakMap once they are implemented in</span></span><br><span class=\"line\">    <span class=\"comment\">// commonly used development environments.</span></span><br><span class=\"line\">    element._store = &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// To make comparing ReactElements easier for testing purposes, we make</span></span><br><span class=\"line\">    <span class=\"comment\">// the validation flag non-enumerable (where possible, which should</span></span><br><span class=\"line\">    <span class=\"comment\">// include every environment we run tests in), so the test framework</span></span><br><span class=\"line\">    <span class=\"comment\">// ignores it.</span></span><br><span class=\"line\">    <span class=\"built_in\">Object</span>.defineProperty(element._store, <span class=\"string\">'validated'</span>, &#123;</span><br><span class=\"line\">      configurable: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      enumerable: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      writable: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      value: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"comment\">// self and source are DEV only properties.</span></span><br><span class=\"line\">    <span class=\"built_in\">Object</span>.defineProperty(element, <span class=\"string\">'_self'</span>, &#123;</span><br><span class=\"line\">      configurable: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      enumerable: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      writable: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      value: self,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"comment\">// Two elements created in two different places should be considered</span></span><br><span class=\"line\">    <span class=\"comment\">// equal for testing purposes and therefore we hide it from enumeration.</span></span><br><span class=\"line\">    <span class=\"built_in\">Object</span>.defineProperty(element, <span class=\"string\">'_source'</span>, &#123;</span><br><span class=\"line\">      configurable: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      enumerable: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      writable: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      value: source,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">Object</span>.freeze) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">Object</span>.freeze(element.props);</span><br><span class=\"line\">      <span class=\"built_in\">Object</span>.freeze(element);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> element;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>çœ‹è¿‡ä¹‹åï¼Œæ˜¯ä¸æ˜¯å’Œæˆ‘ä»¬çœ‹åˆ°çš„èŠ‚ç‚¹ä¸€æ ·ï¼Œé¦–å…ˆï¼Œæ ‡æ³¨ä¸€ä¸‹<code>$$typeof</code>ä¸º<code>reactèŠ‚ç‚¹</code>ã€‚ç„¶åå°±æ˜¯æ­£å¸¸çš„ä¼ å‚ï¼Œæ¯”å¦‚<code>key</code>ï¼Œ<code>ref</code>ï¼Œ<code>props</code>ç­‰ç­‰ã€‚</p>\n<h2 id=\"ReactDOM-render\"><a href=\"#ReactDOM-render\" class=\"headerlink\" title=\"ReactDOM.render\"></a>ReactDOM.render</h2><p>è¿™ä¸ªå°±æ˜¯ReactèŠ‚ç‚¹æ¸²æŸ“ä¸ºçœŸæ˜¯èŠ‚ç‚¹çš„æ“ä½œã€‚è¯ä¸å¤šè¯´ï¼Œä¸Šæºç ï¼</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isValidContainer</span>(<span class=\"params\">node: mixed</span>): <span class=\"title\">boolean</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> !!(</span><br><span class=\"line\">    node &amp;&amp;</span><br><span class=\"line\">    (node.nodeType === ELEMENT_NODE ||</span><br><span class=\"line\">      node.nodeType === DOCUMENT_NODE ||</span><br><span class=\"line\">      node.nodeType === DOCUMENT_FRAGMENT_NODE ||</span><br><span class=\"line\">      (node.nodeType === COMMENT_NODE &amp;&amp;</span><br><span class=\"line\">        (node: any).nodeValue === <span class=\"string\">' react-mount-point-unstable '</span>))</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">render</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  element: React$Element&lt;any&gt;,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  container: Container,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  callback: ?Function,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// ç”¨äºæŠ›å‡ºé”™è¯¯çš„, å°±æ˜¯åˆ¤æ–­è¿™ä¸ªcontaineræ˜¯ä¸æ˜¯æ‰¾å¾—åˆ°</span></span><br><span class=\"line\">  invariant(</span><br><span class=\"line\">    isValidContainer(container),</span><br><span class=\"line\">    <span class=\"string\">'Target container is not a DOM element.'</span>,</span><br><span class=\"line\">  );</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (__DEV__) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> isModernRoot =</span><br><span class=\"line\">      isContainerMarkedAsRoot(container) &amp;&amp;</span><br><span class=\"line\">      container._reactRootContainer === <span class=\"literal\">undefined</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isModernRoot) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.error(</span><br><span class=\"line\">        <span class=\"string\">'You are calling ReactDOM.render() on a container that was previously '</span> +</span><br><span class=\"line\">          <span class=\"string\">'passed to ReactDOM.createRoot(). This is not supported. '</span> +</span><br><span class=\"line\">          <span class=\"string\">'Did you mean to call root.render(element)?'</span>,</span><br><span class=\"line\">      );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// è¿™é‡Œé¢æ¶‰åŠåˆ°äº†fiberçš„ä¸€äº›æ¶æ„ï¼Œæˆ‘æƒ³ä¹‹åå†è¯´ï¼Œå†æŒ–ä¸ªå‘</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> legacyRenderSubtreeIntoContainer(</span><br><span class=\"line\">    <span class=\"literal\">null</span>,</span><br><span class=\"line\">    element,</span><br><span class=\"line\">    container,</span><br><span class=\"line\">    <span class=\"literal\">false</span>,</span><br><span class=\"line\">    callback,</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>æœ‰æ²¡æœ‰æ„Ÿè§‰å¾ˆç®€å•ï¼Œå»é™¤<code>__DEV__</code>æƒ…å†µçš„è¯ã€‚ä¹Ÿæ˜¯è¿”å›ä¸€ä¸ªå‡½æ•°çš„ç»“æœã€‚ã€‚ã€‚</p>\n<h2 id=\"ReactDOM-hydrate\"><a href=\"#ReactDOM-hydrate\" class=\"headerlink\" title=\"ReactDOM.hydrate\"></a>ReactDOM.hydrate</h2><p>è¿™ä¸ªå‡½æ•°æˆ‘å‘ç°å¾ˆæœ‰æ„æ€ï¼Œä¸ReactDOM.renderåªæœ‰ä¸€è¡Œä»£ç ä¸ä¸€æ ·</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">legacyRenderSubtreeIntoContainer(</span><br><span class=\"line\">    null,</span><br><span class=\"line\">    element,</span><br><span class=\"line\">    container,</span><br><span class=\"line\"><span class=\"deletion\">-   false,</span></span><br><span class=\"line\"><span class=\"addition\">+   true,</span></span><br><span class=\"line\">    callback,</span><br><span class=\"line\">  );</span><br></pre></td></tr></table></figure>\n\n\n\n<p>é¦–å…ˆï¼Œè¿™ä¸ª<code>hydrate</code>çš„æ„æ€æ˜¯æ³¨æ°´ã€‚å¤§è‡´çš„æ„æ€æ˜¯ç»™ä¸€ä¸ªç»“ç‚¹å¢åŠ æ°´åˆ†ï¼Œå¢æ·»è‰²å½©ã€‚ä¹‹å‰æ˜¯ç»™<code>SSR</code>è¿‡ç¨‹ä¸­æ·»åŠ ç‚¹å‡»äº‹ä»¶ä¹‹ç±»ä½¿ç”¨çš„ã€‚åœ¨<code>React17</code>ä¹‹åä¼šæ·˜æ±°æ‰<code>ReactDOM.Render</code>ï¼Œå…¨éƒ¨ç”¨<code>ReactDOM.hydrate</code>æ¥ä»£æ›¿ã€‚</p>\n<p>Reactå®˜ç½‘çš„ä¸€å¥è¯</p>\n<blockquote>\n<p>ä½¿ç”¨ <code>ReactDOM.render()</code> å¯¹æœåŠ¡ç«¯æ¸²æŸ“å®¹å™¨è¿›è¡Œ hydrate æ“ä½œçš„æ–¹å¼å·²ç»è¢«åºŸå¼ƒï¼Œå¹¶ä¸”ä¼šåœ¨ React 17 è¢«ç§»é™¤ã€‚ä½œä¸ºæ›¿ä»£ï¼Œè¯·ä½¿ç”¨ <a href=\"https://zh-hans.reactjs.org/docs/react-dom.html#hydrate\" target=\"_blank\" rel=\"noopener\"><code>hydrate()</code></a>ã€‚</p>\n</blockquote>\n<h2 id=\"ä¸ºä»€ä¹ˆè¦ä½¿ç”¨JSX\"><a href=\"#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨JSX\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆè¦ä½¿ç”¨JSX\"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨JSX</h2><p>è¿™é‡Œåˆ†äº«ä¸€ä¸ªè§£é¢˜çš„å°æŠ€å·§ã€‚ä¸ºä»€ä¹ˆè¦XXå…¶å®å°±æ˜¯è¦é—®ä½ ï¼ŒXXçš„å¥½å¤„ã€‚okï¼Œé‚£æ¥ä¸‹æ¥å°±å¾ˆå¥½å›ç­”äº†</p>\n<p>é¦–å…ˆï¼Œå› ä¸ºå¦‚æœä¸ç”¨<code>jsx</code>ï¼Œæˆ‘ä»¬å°±è¦åœ¨ä»£ç é‡Œé¢å†™ä¸Šç™¾ä¸ª<code>React.crearteElement</code>ã€‚</p>\n<p>ç¬¬äºŒï¼Œè¿™ä¸ªè¯­æ³•ç³–å¯ä»¥è®©å¼€å‘è€…ä½¿ç”¨ç†Ÿæ‚‰çš„<code>HTML</code>æ ‡ç­¾æ¥åˆ›å»º<code>è™šæ‹ŸDOM</code>ï¼Œé™ä½å­¦ä¹ æˆæœ¬ã€‚æå‡å¼€å‘æ•ˆç‡ä¸å¼€å‘ä½“éªŒ</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/react/bebel.png\"  alt=\"bebel\"></p>\n<h1 id=\"å‰©ä½™çš„å‘\"><a href=\"#å‰©ä½™çš„å‘\" class=\"headerlink\" title=\"å‰©ä½™çš„å‘\"></a>å‰©ä½™çš„å‘</h1><ul>\n<li>legacyRenderSubtreeIntoContainerï¼ˆæ¶‰åŠfiberæ¶æ„</li>\n<li>_ownerï¼ˆåˆ›å»ºçš„æ—¶å€™ï¼Œè¿™ä¸ªå±æ€§æœ‰ä»€ä¹ˆç”¨</li>\n</ul>\n<h1 id=\"ç´¢å¼•\"><a href=\"#ç´¢å¼•\" class=\"headerlink\" title=\"ç´¢å¼•\"></a>ç´¢å¼•</h1><p><a href=\"https://zh-hans.reactjs.org/docs\" target=\"_blank\" rel=\"noopener\">https://zh-hans.reactjs.org/docs</a></p>\n<p><a href=\"https://www.babeljs.cn/docs/\" target=\"_blank\" rel=\"noopener\">https://www.babeljs.cn/docs/</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h1><p>ä¸€äº›åºŸè¯å’Œä¸ªäººæ„Ÿæ‚Ÿï¼Œçœ‹å¹²è´§çš„ç›´æ¥è·³è¿‡â€¦.åˆ°<code>jsx</code></p>\n<p>é‡è¯†å‰ç«¯æ–­æ–­ç»­ç»­ä¹Ÿå†™äº†å¤§åŠå¹´äº†ã€‚é‡Œé¢åŸºæœ¬ä¸Šéƒ½æ˜¯ä¸ªäººæŠ€æœ¯æ ˆçš„ç§¯ç´¯ï¼Œä»¥åŠé¢è¯•é¢˜çš„å›ç­”ã€‚æ„Ÿå…´è¶£çš„ä¼™ä¼´å¯ä»¥ç‚¹åˆ°æˆ‘çš„ä¸»é¡µå»çœ‹ã€‚</p>\n<p>è¯´è¯´ä»Šå¤©çš„ä¸»è§’-<code>React</code>å§ã€‚<code>React</code>çš„æºç ä¹‹å‰ä¸€ç›´æƒ³è¦å»é˜…è¯»å­¦ä¹ çš„ï¼Œä¹Ÿç¡®ç¡®å®å®åœ¨çœ‹äº†ï¼Œä½†æ˜¯ç»å¸¸çœ‹ç€çœ‹ç€å°±å‘å›°ã€‚ç„¶åå°±å¼€å§‹å·æ‡’ï¼Œä»ä¸€äº›å‘¨è¾¹çš„å¼€å§‹é˜…è¯»ï¼Œæ¯”å¦‚<code>React-Router</code>ï¼Œ<code>React-Redux</code>ä¹‹ç±»çš„ã€‚ä¹‹å‰éƒ½æ˜¯çœ‹å®Œä¹‹åå†å¼€å§‹å†™æ–‡ç« ã€‚ç°åœ¨æƒ³ä¸€è¾¹çœ‹ä¸€è¾¹å†™ï¼Œæ¢ä¸ªæ–¹å¼çœ‹çœ‹ã€‚å¦‚æœæœ‰å†™é”™çš„åœ°æ–¹æ¬¢è¿å¤§å®¶è®¨è®ºï¼Œå¦‚æœè§‰å¾—è¿˜å¯ä»¥çš„è¯å¯ä»¥ç‚¹ä¸ªèµï¼Œè°¢è°¢ï¼</p>\n<p>ä½œä¸ºä¸€å<code>React</code>çš„é‡åº¦ä½¿ç”¨è€…å’Œçˆ±å¥½è€…ã€‚æˆ‘å°†ä¼šå’Œå¤§å®¶ä¸€èµ·ä»ã€Œä½¿ç”¨è€…ã€åˆ°ã€Œäº†è§£è€…ã€è¿›æ­¥ï¼</p>\n<h1 id=\"Reactçš„ç›¸å…³ä¿¡æ¯\"><a href=\"#Reactçš„ç›¸å…³ä¿¡æ¯\" class=\"headerlink\" title=\"Reactçš„ç›¸å…³ä¿¡æ¯\"></a>Reactçš„ç›¸å…³ä¿¡æ¯</h1><h2 id=\"åŠŸåˆ©çš„è§’åº¦\"><a href=\"#åŠŸåˆ©çš„è§’åº¦\" class=\"headerlink\" title=\"åŠŸåˆ©çš„è§’åº¦\"></a>åŠŸåˆ©çš„è§’åº¦</h2><p>æ‰“å¼€æ‹›è˜è½¯ä»¶ï¼Œç°åœ¨åŸºæœ¬ä¸Šçš„å¤§å‚ï¼Œç”šè‡³æ˜¯å¤–åŒ…å…¬å¸éƒ½æ™®éè¦æ±‚ä½ ä¼š<code>React</code>æˆ–è€…<code>Vue</code>ã€‚ç»™å‡ºçš„è–ªèµ„ä¹Ÿæ˜¯éå¸¸çš„è¯±äººã€‚</p>\n<p>ï¼ˆå›¾ç‰‡æ¥è‡ªBossæŸè˜ï¼‰</p>\n<p><img src=\"/image/react1/offer.png\" alt=\"offer\"></p>\n<p>ä¸ºäº†å‘è´¢è¿™ä¸ªæœ´å®çš„æ¢¦æƒ³ä¹Ÿåº”è¯¥å­¦ä¹ ã€‚</p>\n<h2 id=\"å­¦ä¹ çš„è§’åº¦\"><a href=\"#å­¦ä¹ çš„è§’åº¦\" class=\"headerlink\" title=\"å­¦ä¹ çš„è§’åº¦\"></a>å­¦ä¹ çš„è§’åº¦</h2><p>å¦‚ä»Šå‰ç«¯å¾¡ä¸‰å®¶ï¼š<code>Angular</code>ã€<code>React</code>ã€<code>Vue</code>ä¸‰åˆ†å¤©ä¸‹ã€‚å›½å†…æ›´é’ç<code>React</code>å’Œ<code>Vue</code>ã€‚æ‰€ä»¥ï¼Œä»å­¦ä¹ çš„è§’åº¦æ›´åº”è¯¥å­¦ä¹ <code>React</code>ã€‚</p>\n<p><a href=\"https://www.npmtrends.com/react-vs-vue-vs-@angular/core\" target=\"_blank\" rel=\"noopener\">https://www.npmtrends.com/react-vs-vue-vs-@angular/core</a></p>\n<p><img src=\"/image/react1/download.jpg\" alt=\"offer\"></p>\n<p><img src=\"/image/react1/stats\" alt=\"offer\"></p>\n<h2 id=\"ä¸ºä»€ä¹ˆéè¦å­¦ä¹ æºç \"><a href=\"#ä¸ºä»€ä¹ˆéè¦å­¦ä¹ æºç \" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆéè¦å­¦ä¹ æºç \"></a>ä¸ºä»€ä¹ˆéè¦å­¦ä¹ æºç </h2><p>è¿™ä¸ªé—®é¢˜æˆ‘ä¹‹å‰ä¹Ÿé—®è¿‡ï¼Œå‡ ä¹æ‰€æœ‰çš„é¢è¯•éƒ½æ˜¯é€ ç«ç®­ï¼Œå·¥ä½œæ‹§èºä¸ã€‚</p>\n<p>æˆ‘è®¤ä¸ºä»ä¸¤ä¸ªè§’åº¦æ¥çœ‹è¿™ä¸ªé—®é¢˜ï¼š</p>\n<ol>\n<li>åº”è˜è€…<ol>\n<li>åƒé€<code>React</code>çš„æƒ…å†µä¸‹ï¼Œè§£å†³é—®é¢˜çš„ä¸Šé™è‚¯å®šæ˜¯æé«˜äº†</li>\n<li>ä¸€ä¸ªä¼˜ç§€çš„æ¡†æ¶æ˜¯ä¸€ä½ä¼˜ç§€çš„è€å¸ˆ</li>\n</ol>\n</li>\n<li>æ‹›è˜è€…ï¼Œæ—¢ç„¶éƒ½æ˜¯èƒ½å¹²æ´»çš„ï¼Œæˆ‘å°±æ‰¾ä¸€ä¸ªæ‡‚å¾—æ›´å¤šçš„äººæ¥å¹²è¿™ä¸ªæ´»</li>\n</ol>\n<h1 id=\"JSX\"><a href=\"#JSX\" class=\"headerlink\" title=\"JSX\"></a>JSX</h1><p>åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥å¼€å§‹ã€‚</p>\n<p>JSXï¼Œå†ç†Ÿæ‚‰ä¸è¿‡äº†ï¼Œæ—¥å¸¸ä½¿ç”¨Reactè¿‡ç¨‹ä¸­è‚¯å®šä¼šç”¨åˆ°çš„ã€‚ç»™ä¸€ä¸ªdemoï¼Œå¸®å¤§å®¶å›ä¸€ä¸‹ã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import React from &quot;react&quot;;</span><br><span class=\"line\">import ReactDOM from &quot;react-dom&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">class App extends React.Component &#123;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    const text &#x3D; &quot;å“ˆå“ˆå“ˆ&quot;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">      &lt;div&gt;</span><br><span class=\"line\">        &lt;p&gt;&#123;text&#125;&lt;&#x2F;p&gt;</span><br><span class=\"line\">      &lt;&#x2F;div&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">const rootElement &#x3D; document.getElementById(&quot;root&quot;);</span><br><span class=\"line\">ReactDOM.render(&lt;App &#x2F;&gt;, rootElement);</span><br></pre></td></tr></table></figure>\n\n\n\n<p>æˆ‘å…ˆé—®å‡ ä¸ªé—®é¢˜ï¼Œå¦‚æœèƒ½å¤Ÿæ¸…æ™°çš„å¿«é€Ÿç­”å‡ºæ¥ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼Œä½ çš„åŸºç¡€å¾ˆæ‰å®ï¼Œå¦‚æœä¸è¡Œï¼Œé‚£å°±ä¸€èµ·çœ‹çœ‹ï¼Œçœ‹å®Œä¹‹åå¯ä»¥æŠŠä½ çš„ç­”æ¡ˆå†™åœ¨è¯„è®ºåŒºï¼Œå’Œå¤§å®¶è®¨è®ºã€‚</p>\n<ul>\n<li>ä»€ä¹ˆæ˜¯<code>JSX</code>ï¼Ÿ<code>JSX</code>å’Œ<code>JS</code>æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</li>\n<li><code>JSX</code>çš„åº•å±‚åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</li>\n<li>ä¸ºä»€ä¹ˆ<code>React</code>è¦é€‰æ‹©<code>JSX</code>ï¼Ÿ</li>\n</ul>\n<p>å¸¦ç€é—®é¢˜ä¸€èµ·æ¥çœ‹ã€‚</p>\n<h2 id=\"ä»€ä¹ˆæ˜¯JSX\"><a href=\"#ä»€ä¹ˆæ˜¯JSX\" class=\"headerlink\" title=\"ä»€ä¹ˆæ˜¯JSX\"></a>ä»€ä¹ˆæ˜¯JSX</h2><p>å…ˆçœ‹çœ‹<code>React</code>å®˜ç½‘çš„ä¸€å¥è¯ã€‚</p>\n<blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const element &#x3D; &lt;h1&gt;Hello, world!&lt;&#x2F;h1&gt;;</span><br></pre></td></tr></table></figure>\n\n<p>å®ƒè¢«ç§°ä¸º JSXï¼Œæ˜¯ä¸€ä¸ª JavaScript çš„è¯­æ³•æ‰©å±•ã€‚</p>\n</blockquote>\n<p>è¯­æ³•æ‰©å±•ï¼Œæ„æ€å°±æ˜¯<code>JS</code>æœ‰çš„ä»–éƒ½æœ‰çš„æƒ…å†µä¸‹ï¼Œè¿˜æœ‰ä¸€äº›åˆ«çš„åŠŸèƒ½ã€‚å¯æ˜¯è¿™è´§ï¼Œæ˜æ˜¾åœ¨<code>JavaScript</code>å­¦ä¹ è¿‡ç¨‹ä¸­æ²¡è§è¿‡ä»–å‘€ã€‚ä»–èƒ½è¿è¡Œåœ¨<code>JavaScript</code>çš„ç¯å¢ƒä¸­å—ï¼Ÿæ‰“å¼€<code>Chrome</code>æ§åˆ¶å°ã€‚</p>\n<p><img src=\"/image/react/console.png\" alt=\"console\"></p>\n<p>ä¸Šæ¥å°±æ˜¯åŠˆå¤´ç›–è„¸çš„è¯­æ³•é”™è¯¯ï¼Œçœ‹æ ·å­è¿™éƒ¨åˆ†å°±æ˜¯å¤šå‡ºæ¥çš„åŠŸèƒ½äº†å‘—ã€‚é‚£å’‹è¿è¡Œå•Šï¼Ÿ</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.(js|jsx)?$/</span>,</span><br><span class=\"line\">        <span class=\"comment\">// å¼€å¯ç¼“å­˜</span></span><br><span class=\"line\">        options: &#123; <span class=\"attr\">cacheDirectory</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">        loader: <span class=\"string\">'babel-loader'</span>,</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n\n<p>æ€ä¹ˆæ ·ï¼Œç†Ÿæ‚‰ä¸ï¼Œæ„æ€æ˜¯å‘Šè¯‰<code>webpack</code>ï¼Œè§£æ<code>jsx</code>ç»“å°¾çš„ä»£ç ï¼Œéœ€è¦ç”¨åˆ°<code>babel</code>ã€‚okï¼Œä¹Ÿå°±æ˜¯è¯´è¦æƒ³è¿è¡Œ<code>jsx</code>ï¼Œå°±å¿…é¡»ç”¨<code>babel</code>è§£æã€‚é‚£å¥½ï¼Œä»€ä¹ˆæ˜¯babelï¼Ÿ</p>\n<h3 id=\"babel\"><a href=\"#babel\" class=\"headerlink\" title=\"babel\"></a>babel</h3><p>æ‹‰ä¸€æ®µ<code>babel</code>å®˜ç½‘ä¸Šçš„ä¸€å¥è¯</p>\n<blockquote>\n<h2 id=\"Babel-æ˜¯ä¸€ä¸ª-JavaScript-ç¼–è¯‘å™¨\"><a href=\"#Babel-æ˜¯ä¸€ä¸ª-JavaScript-ç¼–è¯‘å™¨\" class=\"headerlink\" title=\"Babel æ˜¯ä¸€ä¸ª JavaScript ç¼–è¯‘å™¨\"></a>Babel æ˜¯ä¸€ä¸ª JavaScript ç¼–è¯‘å™¨</h2><p>Babel æ˜¯ä¸€ä¸ªå·¥å…·é“¾ï¼Œä¸»è¦ç”¨äºå°† ECMAScript 2015+ ç‰ˆæœ¬çš„ä»£ç è½¬æ¢ä¸ºå‘åå…¼å®¹çš„ JavaScript è¯­æ³•ï¼Œä»¥ä¾¿èƒ½å¤Ÿè¿è¡Œåœ¨å½“å‰å’Œæ—§ç‰ˆæœ¬çš„æµè§ˆå™¨æˆ–å…¶ä»–ç¯å¢ƒä¸­ã€‚</p>\n</blockquote>\n<p><code>babel</code>ï¼Œå…¶å®å°±æ˜¯å¸®æˆ‘ä»¬è§£ææˆ‘ä»¬å†™çš„ä»£ç ï¼Œç„¶åå˜æˆæµè§ˆå™¨èƒ½å¤Ÿè®¤è¯†æ ·å¼ã€‚æ¯”å¦‚<code>jsx</code>ï¼Œæ¯”å¦‚æ–°é²œçš„<code>es6</code>è¯­æ³•å¯ä»¥è¿è¡Œåœ¨è€ç‰ˆæœ¬çš„æµè§ˆå™¨ä¸Šï¼Œè®©è€ç‰ˆæœ¬çš„æµè§ˆå™¨èƒ½å¤Ÿè®¤è¯†ã€‚</p>\n<p>é‚£é—®é¢˜åˆæ¥äº†ï¼Œjsxè¢«babelå˜æˆä»€ä¹ˆæ ·å­äº†ï¼Ÿ</p>\n<p>åœ¨çº¿è½¬æ¢ï¼š<a href=\"https://babeljs.io/repl\" target=\"_blank\" rel=\"noopener\">https://babeljs.io/repl</a></p>\n<p>å¤§å®¶å¯ä»¥æŠŠä¸Šé¢çš„å°demoï¼Œæ‰”è¿›å»ã€‚</p>\n<p><img src=\"/image/react/bebel.png\" alt=\"bebel\"></p>\n<p>å‘ç°æ²¡æœ‰ã€‚æˆ‘ä»¬<code>return</code>å‡ºå»çš„ä¸œè¥¿å˜æˆäº†<code>React.createElement</code>ã€‚å“ˆå“ˆï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å³ä½¿æ²¡æœ‰ç”¨åˆ°<code>React</code>(è§£å†³äº†ä¸€åˆ°é¢è¯•é¢˜ï¼)ï¼Œä¹Ÿéœ€è¦åœ¨ä¸Šé¢<code>import</code>ï¼Œå› ä¸º<code>jsx</code>æœ€åæ˜¯ä¼šè¢«è½¬åŒ–ä¸º<code>React.createElement</code>ï¼Œä¼šç”¨åˆ°çš„ï¼ï¼ˆä¸è¿‡ç°åœ¨æœ€æ–°çš„å¥½åƒä¸éœ€è¦å¼•ç”¨ä¹Ÿä¸ä¼šæŠ¥é”™äº†ï¼Œå› ä¸ºä»–è‡ªå·±è¯†åˆ«äº†ã€‚</p>\n<p>å®˜ç½‘ä»‹ç»ï¼š<a href=\"https://zh-hans.reactjs.org/blog/2020/09/22/introducing-the-new-jsx-transform.html\" target=\"_blank\" rel=\"noopener\">https://zh-hans.reactjs.org/blog/2020/09/22/introducing-the-new-jsx-transform.html</a></p>\n<blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; ç”±ç¼–è¯‘å™¨å¼•å…¥ï¼ˆç¦æ­¢è‡ªå·±å¼•å…¥ï¼ï¼‰</span><br><span class=\"line\">import &#123;jsx as _jsx&#125; from &#39;react&#x2F;jsx-runtime&#39;;</span><br><span class=\"line\"></span><br><span class=\"line\">function App() &#123;</span><br><span class=\"line\">  return _jsx(&#39;h1&#39;, &#123; children: &#39;Hello world&#39; &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æ³¨æ„ï¼Œæ­¤æ—¶æºä»£ç <strong>æ— éœ€å¼•å…¥ React</strong> å³å¯ä½¿ç”¨ JSX äº†ï¼ï¼ˆä½†ä»éœ€å¼•å…¥ Reactï¼Œä»¥ä¾¿ä½¿ç”¨ React æä¾›çš„ Hook æˆ–å…¶ä»–å¯¼å‡ºã€‚ï¼‰</p>\n</blockquote>\n<p>å›åˆ°ä¹‹å‰<code>React</code>å®˜ç½‘æåˆ°çš„</p>\n<blockquote>\n<p>å®ƒè¢«ç§°ä¸º JSXï¼Œæ˜¯ä¸€ä¸ª JavaScript çš„è¯­æ³•æ‰©å±•ã€‚</p>\n</blockquote>\n<p>æœ‰æ²¡æœ‰å‘¼åº”èµ·æ¥äº†ï¼Œç¡®å®<code>js</code>ä»–éƒ½æœ‰ï¼Œä½†æ˜¯<code>js</code>æ²¡æœ‰çš„ï¼Œä»–è¿˜æœ‰æ¯”å¦‚è½¬åŒ–ä¸º<code>React.createElement</code>ã€‚</p>\n<h2 id=\"createElement\"><a href=\"#createElement\" class=\"headerlink\" title=\"createElement\"></a>createElement</h2><p>æˆ‘ä»¬æ˜¯æ¥è¯»æºç å­¦ä¹ çš„ï¼Œæˆ‘ä»¬æ—¢ç„¶çŸ¥é“äº†<code>jsx</code>çš„åº•å±‚æ˜¯è°ƒç”¨<code>react</code>çš„å‡½æ•°ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹è¿™ä¸ªå‡½æ•°æ˜¯ä¸ªä»€ä¹ˆæƒ…å†µã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createElement</span>(<span class=\"params\">type, config, children</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// propName å˜é‡ç”¨äºå‚¨å­˜åé¢éœ€è¦ç”¨åˆ°çš„å…ƒç´ å±æ€§</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> propName; </span><br><span class=\"line\">  <span class=\"comment\">// props å˜é‡ç”¨äºå‚¨å­˜å…ƒç´ å±æ€§çš„é”®å€¼å¯¹é›†åˆ</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> props = &#123;&#125;; </span><br><span class=\"line\">  <span class=\"comment\">// keyã€refã€selfã€source å‡ä¸º React å…ƒç´ çš„å±æ€§ï¼Œæ­¤å¤„ä¸å¿…æ·±ç©¶</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> key = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> ref = <span class=\"literal\">null</span>; </span><br><span class=\"line\">  <span class=\"keyword\">let</span> self = <span class=\"literal\">null</span>; </span><br><span class=\"line\">  <span class=\"keyword\">let</span> source = <span class=\"literal\">null</span>; </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// config å¯¹è±¡ä¸­å­˜å‚¨çš„æ˜¯å…ƒç´ çš„å±æ€§</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (config != <span class=\"literal\">null</span>) &#123; </span><br><span class=\"line\">    <span class=\"comment\">// è¿›æ¥ä¹‹ååšçš„ç¬¬ä¸€ä»¶äº‹ï¼Œæ˜¯ä¾æ¬¡å¯¹ refã€keyã€self å’Œ source å±æ€§èµ‹å€¼</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (hasValidRef(config)) &#123;</span><br><span class=\"line\">      ref = config.ref;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// æ­¤å¤„å°† key å€¼å­—ç¬¦ä¸²åŒ–</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (hasValidKey(config)) &#123;</span><br><span class=\"line\">      key = <span class=\"string\">''</span> + config.key; </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    self = config.__self === <span class=\"literal\">undefined</span> ? <span class=\"literal\">null</span> : config.__self;</span><br><span class=\"line\">    source = config.__source === <span class=\"literal\">undefined</span> ? <span class=\"literal\">null</span> : config.__source;</span><br><span class=\"line\">    <span class=\"comment\">// æ¥ç€å°±æ˜¯è¦æŠŠ config é‡Œé¢çš„å±æ€§éƒ½ä¸€ä¸ªä¸€ä¸ªæŒªåˆ° props è¿™ä¸ªä¹‹å‰å£°æ˜å¥½çš„å¯¹è±¡é‡Œé¢</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (propName <span class=\"keyword\">in</span> config) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (</span><br><span class=\"line\">        <span class=\"comment\">// ç­›é€‰å‡ºå¯ä»¥æè¿› props å¯¹è±¡é‡Œçš„å±æ€§</span></span><br><span class=\"line\">        hasOwnProperty.call(config, propName) &amp;&amp;</span><br><span class=\"line\">        !RESERVED_PROPS.hasOwnProperty(propName) </span><br><span class=\"line\">      ) &#123;</span><br><span class=\"line\">        props[propName] = config[propName]; </span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// childrenLength æŒ‡çš„æ˜¯å½“å‰å…ƒç´ çš„å­å…ƒç´ çš„ä¸ªæ•°ï¼Œå‡å»çš„ 2 æ˜¯ type å’Œ config ä¸¤ä¸ªå‚æ•°å ç”¨çš„é•¿åº¦</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> childrenLength = <span class=\"built_in\">arguments</span>.length - <span class=\"number\">2</span>; </span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœæŠ›å»typeå’Œconfigï¼Œå°±åªå‰©ä¸‹ä¸€ä¸ªå‚æ•°ï¼Œä¸€èˆ¬æ„å‘³ç€æ–‡æœ¬èŠ‚ç‚¹å‡ºç°äº†</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (childrenLength === <span class=\"number\">1</span>) &#123; </span><br><span class=\"line\">    <span class=\"comment\">// ç›´æ¥æŠŠè¿™ä¸ªå‚æ•°çš„å€¼èµ‹ç»™props.children</span></span><br><span class=\"line\">    props.children = children; </span><br><span class=\"line\">    <span class=\"comment\">// å¤„ç†åµŒå¥—å¤šä¸ªå­å…ƒç´ çš„æƒ…å†µ</span></span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (childrenLength &gt; <span class=\"number\">1</span>) &#123; </span><br><span class=\"line\">    <span class=\"comment\">// å£°æ˜ä¸€ä¸ªå­å…ƒç´ æ•°ç»„</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> childArray = <span class=\"built_in\">Array</span>(childrenLength); </span><br><span class=\"line\">    <span class=\"comment\">// æŠŠå­å…ƒç´ æ¨è¿›æ•°ç»„é‡Œ</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; childrenLength; i++) &#123; </span><br><span class=\"line\">      childArray[i] = <span class=\"built_in\">arguments</span>[i + <span class=\"number\">2</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// æœ€åæŠŠè¿™ä¸ªæ•°ç»„èµ‹å€¼ç»™props.children</span></span><br><span class=\"line\">    props.children = childArray; </span><br><span class=\"line\">  &#125; </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// å¤„ç† defaultProps</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (type &amp;&amp; type.defaultProps) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> defaultProps = type.defaultProps;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (propName <span class=\"keyword\">in</span> defaultProps) &#123; </span><br><span class=\"line\">      <span class=\"keyword\">if</span> (props[propName] === <span class=\"literal\">undefined</span>) &#123;</span><br><span class=\"line\">        props[propName] = defaultProps[propName];</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// æœ€åè¿”å›ä¸€ä¸ªè°ƒç”¨ReactElementæ‰§è¡Œæ–¹æ³•ï¼Œå¹¶ä¼ å…¥åˆšæ‰å¤„ç†è¿‡çš„å‚æ•°</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> ReactElement(</span><br><span class=\"line\">    type,</span><br><span class=\"line\">    key,</span><br><span class=\"line\">    ref,</span><br><span class=\"line\">    self,</span><br><span class=\"line\">    source,</span><br><span class=\"line\">    ReactCurrentOwner.current,</span><br><span class=\"line\">    props,</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>å…ˆä¸çœ‹å‚æ•°ï¼Œæˆ‘ä»¬å°±å…ˆçœ‹è¿”å›å€¼çš„åå­—å’Œè¿™ä¸ªå‡½æ•°çš„åå­—ã€‚æˆ‘ä»¬åˆæ­¥çŒœæµ‹ï¼Œ<code>jsx</code>æ˜¯é€šè¿‡<code>createElement</code>è¿™ä¸ªå‡½æ•°æ¥åˆ›å»ºä¸€ä¸ª<code>React</code>å…ƒç´ ï¼Œç„¶åç”±<code>ReactDOM.render</code>æ¥æ¸²æŸ“åˆ°æˆ‘ä»¬æŒ‡å®šåå­—çš„å…ƒç´ ä¸Šã€‚</p>\n<p>okï¼Œé‚£ä¹ˆæˆ‘ä»¬å¹³å¸¸å†™çš„jsxå…ƒç´ å°±æ˜¯<code>ReactElement</code>ç”Ÿæˆçš„ä¸œè¥¿ã€‚æˆ‘ä»¬çœ‹çœ‹<code>ReactElement</code>ç”Ÿæˆçš„æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ã€‚</p>\n<p>æˆ‘ä»¬å…ˆæŠŠæˆ‘ä»¬å¹³å¸¸å†™çš„<code>jsx</code>ç»™æ‰“å°ä¸€ä¸‹ã€‚</p>\n<p><img src=\"/image/react/element.png\" alt=\"element\"></p>\n<p>å‡­ç›´è§‰ï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰è¿™ä¸ªæ˜¯ä¸€ä¸ª<code>è™šæ‹ŸDOM</code>çš„èŠ‚ç‚¹ï¼Œä»–æœ‰ç±»å‹ç„¶ååˆæ˜¯<code>div</code>ï¼Œå¯¹åº”çš„ä¼šä¸ä¼šæ˜¯<code>html</code>çš„<code>div</code>æ ‡ç­¾ï¼Ÿè¿˜æœ‰<code>className</code>ï¼Œè¿™ä¸ªå¾ˆæ˜æ˜¾å°±æ˜¯å¯¹åº”<code>class</code>ã€‚æˆ‘ä»¬å»ä¸€çœ‹ç©¶ç«Ÿã€‚</p>\n<h2 id=\"ReactElement\"><a href=\"#ReactElement\" class=\"headerlink\" title=\"ReactElement\"></a>ReactElement</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> ReactElement = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">type, key, ref, self, source, owner, props</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> element = &#123;</span><br><span class=\"line\">    <span class=\"comment\">// è¿™ä¸ªæ˜¯ä¸€ä¸ªReactç»“ç‚¹çš„æ ‡è¯†ç¬¦</span></span><br><span class=\"line\">    $$<span class=\"keyword\">typeof</span>: REACT_ELEMENT_TYPE,</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å¾ˆæ˜æ˜¾å°±æ˜¯å¯¹åº”çš„htmlçš„æ ‡ç­¾</span></span><br><span class=\"line\">    type: type,</span><br><span class=\"line\">    key: key,</span><br><span class=\"line\">    ref: ref,</span><br><span class=\"line\">    props: props,</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// è®°å½•ç”±è°åˆ›å»ºçš„ï¼Œæš‚æ—¶ä¹Ÿä¸çŸ¥é“ä»€ä¹ˆç”¨ã€‚å…ˆæŒ–ä¸ªå‘</span></span><br><span class=\"line\">    _owner: owner,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// å¼€å‘ç¯å¢ƒä¸‹çš„é…ç½®ï¼Œä¸»è¦å°±æ˜¯Object.freezeï¼Œå¯ä»¥åœ¨MDNä¸Šé¢æŸ¥ä¸€ä¸‹ã€‚æˆ‘å°±ä¸å¤šä»‹ç»äº†</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (__DEV__) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// The validation flag is currently mutative. We put it on</span></span><br><span class=\"line\">    <span class=\"comment\">// an external backing store so that we can freeze the whole object.</span></span><br><span class=\"line\">    <span class=\"comment\">// This can be replaced with a WeakMap once they are implemented in</span></span><br><span class=\"line\">    <span class=\"comment\">// commonly used development environments.</span></span><br><span class=\"line\">    element._store = &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// To make comparing ReactElements easier for testing purposes, we make</span></span><br><span class=\"line\">    <span class=\"comment\">// the validation flag non-enumerable (where possible, which should</span></span><br><span class=\"line\">    <span class=\"comment\">// include every environment we run tests in), so the test framework</span></span><br><span class=\"line\">    <span class=\"comment\">// ignores it.</span></span><br><span class=\"line\">    <span class=\"built_in\">Object</span>.defineProperty(element._store, <span class=\"string\">'validated'</span>, &#123;</span><br><span class=\"line\">      configurable: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      enumerable: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      writable: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      value: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"comment\">// self and source are DEV only properties.</span></span><br><span class=\"line\">    <span class=\"built_in\">Object</span>.defineProperty(element, <span class=\"string\">'_self'</span>, &#123;</span><br><span class=\"line\">      configurable: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      enumerable: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      writable: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      value: self,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"comment\">// Two elements created in two different places should be considered</span></span><br><span class=\"line\">    <span class=\"comment\">// equal for testing purposes and therefore we hide it from enumeration.</span></span><br><span class=\"line\">    <span class=\"built_in\">Object</span>.defineProperty(element, <span class=\"string\">'_source'</span>, &#123;</span><br><span class=\"line\">      configurable: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      enumerable: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      writable: <span class=\"literal\">false</span>,</span><br><span class=\"line\">      value: source,</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">Object</span>.freeze) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">Object</span>.freeze(element.props);</span><br><span class=\"line\">      <span class=\"built_in\">Object</span>.freeze(element);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> element;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>çœ‹è¿‡ä¹‹åï¼Œæ˜¯ä¸æ˜¯å’Œæˆ‘ä»¬çœ‹åˆ°çš„èŠ‚ç‚¹ä¸€æ ·ï¼Œé¦–å…ˆï¼Œæ ‡æ³¨ä¸€ä¸‹<code>$$typeof</code>ä¸º<code>reactèŠ‚ç‚¹</code>ã€‚ç„¶åå°±æ˜¯æ­£å¸¸çš„ä¼ å‚ï¼Œæ¯”å¦‚<code>key</code>ï¼Œ<code>ref</code>ï¼Œ<code>props</code>ç­‰ç­‰ã€‚</p>\n<h2 id=\"ReactDOM-render\"><a href=\"#ReactDOM-render\" class=\"headerlink\" title=\"ReactDOM.render\"></a>ReactDOM.render</h2><p>è¿™ä¸ªå°±æ˜¯ReactèŠ‚ç‚¹æ¸²æŸ“ä¸ºçœŸæ˜¯èŠ‚ç‚¹çš„æ“ä½œã€‚è¯ä¸å¤šè¯´ï¼Œä¸Šæºç ï¼</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isValidContainer</span>(<span class=\"params\">node: mixed</span>): <span class=\"title\">boolean</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> !!(</span><br><span class=\"line\">    node &amp;&amp;</span><br><span class=\"line\">    (node.nodeType === ELEMENT_NODE ||</span><br><span class=\"line\">      node.nodeType === DOCUMENT_NODE ||</span><br><span class=\"line\">      node.nodeType === DOCUMENT_FRAGMENT_NODE ||</span><br><span class=\"line\">      (node.nodeType === COMMENT_NODE &amp;&amp;</span><br><span class=\"line\">        (node: any).nodeValue === <span class=\"string\">' react-mount-point-unstable '</span>))</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">render</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  element: React$Element&lt;any&gt;,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  container: Container,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  callback: ?Function,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// ç”¨äºæŠ›å‡ºé”™è¯¯çš„, å°±æ˜¯åˆ¤æ–­è¿™ä¸ªcontaineræ˜¯ä¸æ˜¯æ‰¾å¾—åˆ°</span></span><br><span class=\"line\">  invariant(</span><br><span class=\"line\">    isValidContainer(container),</span><br><span class=\"line\">    <span class=\"string\">'Target container is not a DOM element.'</span>,</span><br><span class=\"line\">  );</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (__DEV__) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> isModernRoot =</span><br><span class=\"line\">      isContainerMarkedAsRoot(container) &amp;&amp;</span><br><span class=\"line\">      container._reactRootContainer === <span class=\"literal\">undefined</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isModernRoot) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.error(</span><br><span class=\"line\">        <span class=\"string\">'You are calling ReactDOM.render() on a container that was previously '</span> +</span><br><span class=\"line\">          <span class=\"string\">'passed to ReactDOM.createRoot(). This is not supported. '</span> +</span><br><span class=\"line\">          <span class=\"string\">'Did you mean to call root.render(element)?'</span>,</span><br><span class=\"line\">      );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// è¿™é‡Œé¢æ¶‰åŠåˆ°äº†fiberçš„ä¸€äº›æ¶æ„ï¼Œæˆ‘æƒ³ä¹‹åå†è¯´ï¼Œå†æŒ–ä¸ªå‘</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> legacyRenderSubtreeIntoContainer(</span><br><span class=\"line\">    <span class=\"literal\">null</span>,</span><br><span class=\"line\">    element,</span><br><span class=\"line\">    container,</span><br><span class=\"line\">    <span class=\"literal\">false</span>,</span><br><span class=\"line\">    callback,</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>æœ‰æ²¡æœ‰æ„Ÿè§‰å¾ˆç®€å•ï¼Œå»é™¤<code>__DEV__</code>æƒ…å†µçš„è¯ã€‚ä¹Ÿæ˜¯è¿”å›ä¸€ä¸ªå‡½æ•°çš„ç»“æœã€‚ã€‚ã€‚</p>\n<h2 id=\"ReactDOM-hydrate\"><a href=\"#ReactDOM-hydrate\" class=\"headerlink\" title=\"ReactDOM.hydrate\"></a>ReactDOM.hydrate</h2><p>è¿™ä¸ªå‡½æ•°æˆ‘å‘ç°å¾ˆæœ‰æ„æ€ï¼Œä¸ReactDOM.renderåªæœ‰ä¸€è¡Œä»£ç ä¸ä¸€æ ·</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">legacyRenderSubtreeIntoContainer(</span><br><span class=\"line\">    null,</span><br><span class=\"line\">    element,</span><br><span class=\"line\">    container,</span><br><span class=\"line\"><span class=\"deletion\">-   false,</span></span><br><span class=\"line\"><span class=\"addition\">+   true,</span></span><br><span class=\"line\">    callback,</span><br><span class=\"line\">  );</span><br></pre></td></tr></table></figure>\n\n\n\n<p>é¦–å…ˆï¼Œè¿™ä¸ª<code>hydrate</code>çš„æ„æ€æ˜¯æ³¨æ°´ã€‚å¤§è‡´çš„æ„æ€æ˜¯ç»™ä¸€ä¸ªç»“ç‚¹å¢åŠ æ°´åˆ†ï¼Œå¢æ·»è‰²å½©ã€‚ä¹‹å‰æ˜¯ç»™<code>SSR</code>è¿‡ç¨‹ä¸­æ·»åŠ ç‚¹å‡»äº‹ä»¶ä¹‹ç±»ä½¿ç”¨çš„ã€‚åœ¨<code>React17</code>ä¹‹åä¼šæ·˜æ±°æ‰<code>ReactDOM.Render</code>ï¼Œå…¨éƒ¨ç”¨<code>ReactDOM.hydrate</code>æ¥ä»£æ›¿ã€‚</p>\n<p>Reactå®˜ç½‘çš„ä¸€å¥è¯</p>\n<blockquote>\n<p>ä½¿ç”¨ <code>ReactDOM.render()</code> å¯¹æœåŠ¡ç«¯æ¸²æŸ“å®¹å™¨è¿›è¡Œ hydrate æ“ä½œçš„æ–¹å¼å·²ç»è¢«åºŸå¼ƒï¼Œå¹¶ä¸”ä¼šåœ¨ React 17 è¢«ç§»é™¤ã€‚ä½œä¸ºæ›¿ä»£ï¼Œè¯·ä½¿ç”¨ <a href=\"https://zh-hans.reactjs.org/docs/react-dom.html#hydrate\" target=\"_blank\" rel=\"noopener\"><code>hydrate()</code></a>ã€‚</p>\n</blockquote>\n<h2 id=\"ä¸ºä»€ä¹ˆè¦ä½¿ç”¨JSX\"><a href=\"#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨JSX\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆè¦ä½¿ç”¨JSX\"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨JSX</h2><p>è¿™é‡Œåˆ†äº«ä¸€ä¸ªè§£é¢˜çš„å°æŠ€å·§ã€‚ä¸ºä»€ä¹ˆè¦XXå…¶å®å°±æ˜¯è¦é—®ä½ ï¼ŒXXçš„å¥½å¤„ã€‚okï¼Œé‚£æ¥ä¸‹æ¥å°±å¾ˆå¥½å›ç­”äº†</p>\n<p>é¦–å…ˆï¼Œå› ä¸ºå¦‚æœä¸ç”¨<code>jsx</code>ï¼Œæˆ‘ä»¬å°±è¦åœ¨ä»£ç é‡Œé¢å†™ä¸Šç™¾ä¸ª<code>React.crearteElement</code>ã€‚</p>\n<p>ç¬¬äºŒï¼Œè¿™ä¸ªè¯­æ³•ç³–å¯ä»¥è®©å¼€å‘è€…ä½¿ç”¨ç†Ÿæ‚‰çš„<code>HTML</code>æ ‡ç­¾æ¥åˆ›å»º<code>è™šæ‹ŸDOM</code>ï¼Œé™ä½å­¦ä¹ æˆæœ¬ã€‚æå‡å¼€å‘æ•ˆç‡ä¸å¼€å‘ä½“éªŒ</p>\n<p><img src=\"/image/react/bebel.png\" alt=\"bebel\"></p>\n<h1 id=\"å‰©ä½™çš„å‘\"><a href=\"#å‰©ä½™çš„å‘\" class=\"headerlink\" title=\"å‰©ä½™çš„å‘\"></a>å‰©ä½™çš„å‘</h1><ul>\n<li>legacyRenderSubtreeIntoContainerï¼ˆæ¶‰åŠfiberæ¶æ„</li>\n<li>_ownerï¼ˆåˆ›å»ºçš„æ—¶å€™ï¼Œè¿™ä¸ªå±æ€§æœ‰ä»€ä¹ˆç”¨</li>\n</ul>\n<h1 id=\"ç´¢å¼•\"><a href=\"#ç´¢å¼•\" class=\"headerlink\" title=\"ç´¢å¼•\"></a>ç´¢å¼•</h1><p><a href=\"https://zh-hans.reactjs.org/docs\" target=\"_blank\" rel=\"noopener\">https://zh-hans.reactjs.org/docs</a></p>\n<p><a href=\"https://www.babeljs.cn/docs/\" target=\"_blank\" rel=\"noopener\">https://www.babeljs.cn/docs/</a></p>\n"},{"title":"window.history.back(); ç¼“å­˜ è¿”å›ä¸Šçº§é¡µé¢ä¸åˆ·æ–°æ•°æ®","date":"2019-06-19T03:12:34.000Z","cover":"/image/cover/history.jpeg","_content":"\n## é—®é¢˜\n\n - æˆ‘ä»¬ç»å¸¸ä¼šåšå®Œä¸€ä¸ªæ“ä½œä¹‹åè¿”å›ä¸Šä¸€ä¸ªé¡µé¢ï¼ˆæ¯”å¦‚æ–°å¢å®Œä¸€æ¡è®°å½•ï¼‰\n\n - ç„¶åæˆ‘ä»¬å¸Œæœ›è¿”å›ä¸Šä¸€ä¸ªé¡µé¢çš„æ—¶å€™å°±è‡ªåŠ¨åˆ·æ–°ä»–ã€‚\n - ä½†æ˜¯ç”±äºJSçš„ç¼“å­˜æœºåˆ¶\n - å¯¼è‡´æˆ‘ä»¬çš„æ•°æ®è¿˜æ˜¯ä»å‰ä¸€æ¬¡é‡Œé¢å–çš„ï¼ˆä»–çš„åˆè¡·æ˜¯å¸Œæœ›ä½ æ›´å¿«ï¼Œæ›´çœèµ„æºï¼‰\n - ä½†æ˜¯å’Œæˆ‘ä»¬çš„éœ€æ±‚ä¸åŒ\n - å¦‚å›¾ï¼š\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/historyBackå‡½æ•°/20190318092239845.png)\n\n## æ¢ç´¢\nä»ç½‘ä¸Šæ‰¾çš„ä¸€äº›èµ„æ–™ï¼š\n\n - åœ¨`window.history.back();` åé¢åŠ `location.reload();`\n - `window.history.go(-1);window.location.reload()`\n\nå‡æ— ç»ˆè€Œè¿”\n\n## è§£å†³\n\n - `window.location.replace(document.referrer)`\n - `window.location.href=â€œä¸Šä¸€ä¸ªé¡µé¢URLâ€`ï¼ˆä¸‹ä¸‹ç­–ï¼‰\n","source":"_posts/window-history-back-ç¼“å­˜-è¿”å›ä¸Šçº§é¡µé¢ä¸åˆ·æ–°æ•°æ®.md","raw":"---\ntitle: window.history.back(); ç¼“å­˜ è¿”å›ä¸Šçº§é¡µé¢ä¸åˆ·æ–°æ•°æ®\ndate: 2019-06-19 11:12:34\ntags: [HTML, JavaScript]\ncategory: [Webå‰ç«¯]\ncover: /image/cover/history.jpeg\n---\n\n## é—®é¢˜\n\n - æˆ‘ä»¬ç»å¸¸ä¼šåšå®Œä¸€ä¸ªæ“ä½œä¹‹åè¿”å›ä¸Šä¸€ä¸ªé¡µé¢ï¼ˆæ¯”å¦‚æ–°å¢å®Œä¸€æ¡è®°å½•ï¼‰\n\n - ç„¶åæˆ‘ä»¬å¸Œæœ›è¿”å›ä¸Šä¸€ä¸ªé¡µé¢çš„æ—¶å€™å°±è‡ªåŠ¨åˆ·æ–°ä»–ã€‚\n - ä½†æ˜¯ç”±äºJSçš„ç¼“å­˜æœºåˆ¶\n - å¯¼è‡´æˆ‘ä»¬çš„æ•°æ®è¿˜æ˜¯ä»å‰ä¸€æ¬¡é‡Œé¢å–çš„ï¼ˆä»–çš„åˆè¡·æ˜¯å¸Œæœ›ä½ æ›´å¿«ï¼Œæ›´çœèµ„æºï¼‰\n - ä½†æ˜¯å’Œæˆ‘ä»¬çš„éœ€æ±‚ä¸åŒ\n - å¦‚å›¾ï¼š\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](/image/historyBackå‡½æ•°/20190318092239845.png)\n\n## æ¢ç´¢\nä»ç½‘ä¸Šæ‰¾çš„ä¸€äº›èµ„æ–™ï¼š\n\n - åœ¨`window.history.back();` åé¢åŠ `location.reload();`\n - `window.history.go(-1);window.location.reload()`\n\nå‡æ— ç»ˆè€Œè¿”\n\n## è§£å†³\n\n - `window.location.replace(document.referrer)`\n - `window.location.href=â€œä¸Šä¸€ä¸ªé¡µé¢URLâ€`ï¼ˆä¸‹ä¸‹ç­–ï¼‰\n","slug":"window-history-back-ç¼“å­˜-è¿”å›ä¸Šçº§é¡µé¢ä¸åˆ·æ–°æ•°æ®","published":1,"updated":"2021-06-24T14:00:06.849Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra860017lwrd1rs03p22","content":"<h2 id=\"é—®é¢˜\"><a href=\"#é—®é¢˜\" class=\"headerlink\" title=\"é—®é¢˜\"></a>é—®é¢˜</h2><ul>\n<li><p>æˆ‘ä»¬ç»å¸¸ä¼šåšå®Œä¸€ä¸ªæ“ä½œä¹‹åè¿”å›ä¸Šä¸€ä¸ªé¡µé¢ï¼ˆæ¯”å¦‚æ–°å¢å®Œä¸€æ¡è®°å½•ï¼‰</p>\n</li>\n<li><p>ç„¶åæˆ‘ä»¬å¸Œæœ›è¿”å›ä¸Šä¸€ä¸ªé¡µé¢çš„æ—¶å€™å°±è‡ªåŠ¨åˆ·æ–°ä»–ã€‚</p>\n</li>\n<li><p>ä½†æ˜¯ç”±äºJSçš„ç¼“å­˜æœºåˆ¶</p>\n</li>\n<li><p>å¯¼è‡´æˆ‘ä»¬çš„æ•°æ®è¿˜æ˜¯ä»å‰ä¸€æ¬¡é‡Œé¢å–çš„ï¼ˆä»–çš„åˆè¡·æ˜¯å¸Œæœ›ä½ æ›´å¿«ï¼Œæ›´çœèµ„æºï¼‰</p>\n</li>\n<li><p>ä½†æ˜¯å’Œæˆ‘ä»¬çš„éœ€æ±‚ä¸åŒ</p>\n</li>\n<li><p>å¦‚å›¾ï¼š</p>\n</li>\n</ul>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/historyBack%E5%87%BD%E6%95%B0/20190318092239845.png\"  alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<h2 id=\"æ¢ç´¢\"><a href=\"#æ¢ç´¢\" class=\"headerlink\" title=\"æ¢ç´¢\"></a>æ¢ç´¢</h2><p>ä»ç½‘ä¸Šæ‰¾çš„ä¸€äº›èµ„æ–™ï¼š</p>\n<ul>\n<li>åœ¨<code>window.history.back();</code> åé¢åŠ <code>location.reload();</code></li>\n<li><code>window.history.go(-1);window.location.reload()</code></li>\n</ul>\n<p>å‡æ— ç»ˆè€Œè¿”</p>\n<h2 id=\"è§£å†³\"><a href=\"#è§£å†³\" class=\"headerlink\" title=\"è§£å†³\"></a>è§£å†³</h2><ul>\n<li><code>window.location.replace(document.referrer)</code></li>\n<li><code>window.location.href=â€œä¸Šä¸€ä¸ªé¡µé¢URLâ€</code>ï¼ˆä¸‹ä¸‹ç­–ï¼‰</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"é—®é¢˜\"><a href=\"#é—®é¢˜\" class=\"headerlink\" title=\"é—®é¢˜\"></a>é—®é¢˜</h2><ul>\n<li><p>æˆ‘ä»¬ç»å¸¸ä¼šåšå®Œä¸€ä¸ªæ“ä½œä¹‹åè¿”å›ä¸Šä¸€ä¸ªé¡µé¢ï¼ˆæ¯”å¦‚æ–°å¢å®Œä¸€æ¡è®°å½•ï¼‰</p>\n</li>\n<li><p>ç„¶åæˆ‘ä»¬å¸Œæœ›è¿”å›ä¸Šä¸€ä¸ªé¡µé¢çš„æ—¶å€™å°±è‡ªåŠ¨åˆ·æ–°ä»–ã€‚</p>\n</li>\n<li><p>ä½†æ˜¯ç”±äºJSçš„ç¼“å­˜æœºåˆ¶</p>\n</li>\n<li><p>å¯¼è‡´æˆ‘ä»¬çš„æ•°æ®è¿˜æ˜¯ä»å‰ä¸€æ¬¡é‡Œé¢å–çš„ï¼ˆä»–çš„åˆè¡·æ˜¯å¸Œæœ›ä½ æ›´å¿«ï¼Œæ›´çœèµ„æºï¼‰</p>\n</li>\n<li><p>ä½†æ˜¯å’Œæˆ‘ä»¬çš„éœ€æ±‚ä¸åŒ</p>\n</li>\n<li><p>å¦‚å›¾ï¼š</p>\n</li>\n</ul>\n<p><img src=\"/image/historyBack%E5%87%BD%E6%95%B0/20190318092239845.png\" alt=\"åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°\"></p>\n<h2 id=\"æ¢ç´¢\"><a href=\"#æ¢ç´¢\" class=\"headerlink\" title=\"æ¢ç´¢\"></a>æ¢ç´¢</h2><p>ä»ç½‘ä¸Šæ‰¾çš„ä¸€äº›èµ„æ–™ï¼š</p>\n<ul>\n<li>åœ¨<code>window.history.back();</code> åé¢åŠ <code>location.reload();</code></li>\n<li><code>window.history.go(-1);window.location.reload()</code></li>\n</ul>\n<p>å‡æ— ç»ˆè€Œè¿”</p>\n<h2 id=\"è§£å†³\"><a href=\"#è§£å†³\" class=\"headerlink\" title=\"è§£å†³\"></a>è§£å†³</h2><ul>\n<li><code>window.location.replace(document.referrer)</code></li>\n<li><code>window.location.href=â€œä¸Šä¸€ä¸ªé¡µé¢URLâ€</code>ï¼ˆä¸‹ä¸‹ç­–ï¼‰</li>\n</ul>\n"},{"title":"ã€é‡è¯†å‰ç«¯ã€‘React-Routeræºç é˜…è¯»","date":"2020-11-14T12:29:17.000Z","cover":"/image/cover/web.jpeg","_content":"\n# å‰è¨€\n\næ­¤å¤„ä»‹ç»ä¸€ä¸‹React-Routerçš„æ ¸å¿ƒåŸç†ã€‚ç‰¹åˆ«ç»†è‡´çš„æ ‡ç‚¹ç¬¦å·çš„ä¸äºˆè®¨è®ºã€‚\n\n# å­¦å‰å°çŸ¥è¯†\n\n`React-Router`å…¶å®æœ€æ ¸å¿ƒçš„ä¸œè¥¿æ˜¯`Route`ç»„ä»¶å’Œç”±ç»Ÿä¸€ä½œè€…å¼€å‘çš„`History`åº“æ¥å»ºç«‹çš„ã€‚æ¥ä¸‹æ¥è·Ÿç€é•œå¤´ä¸€èµ·èµ°è¿›ç¥ç§˜çš„`ÃŸReact-Router`ä¸–ç•Œå§ã€‚\n\nå·²ç»çŸ¥é“æ€ä¹ˆä½¿ç”¨çš„ç›´æ¥è·³è¿‡ï¼Œåˆ°ä¸‹é¢çš„æºç åˆ†æå»â”—|ï½€Oâ€²|â”› å—·~~\n\n# ç®€å•ç¤ºä¾‹\n\nä¸€èµ·å»ºä¸€ä¸ªç®€å•çš„ç¤ºä¾‹å§ã€‚å…ˆç”¨`react`å®˜ç½‘çš„`create-react-app`è„šæ‰‹æ¶å¼„ä¸ª`react`å‡ºæ¥ã€‚\n\n```sh\nnpx create-react-app my-app\ncd my-app\nnpm start\n```\n\nå®‰è£…[react-router-dom](https://reactrouter.com/web/guides/quick-start)\n\n```sh\nnpm install react-router-dom\n```\n\nåœ¨å¤§å®¶å®‰è£…ä¹‹ä½™ï¼Œæˆ‘ç®€ç­”çš„ä»‹ç»ä¸€ä¸‹`react-router`å’Œ`react-router-dom`çš„åŒºåˆ«ã€‚\n\n## react-routerå’Œreact-router-domçš„åŒºåˆ«ã€‚\n\n### å…ˆçœ‹æä¾›çš„API\u0003\n\n```javascript\nimport { Switch, Route, Router } from 'react-router';\n\nimport { Swtich, Route, BrowserRouter, HashHistory, Link } from 'react-router-dom';\n```\n\n#### React-router\n\næä¾›äº†è·¯ç”±çš„æ ¸å¿ƒapiã€‚å¦‚Routerã€Routeã€Switchç­‰ï¼Œä½†æ²¡æœ‰æä¾›æœ‰å…³domæ“ä½œè¿›è¡Œè·¯ç”±è·³è½¬çš„apiï¼›\n\n#### React-router-dom\n\næä¾›äº†`BrowserRouter`ã€`Route`ã€`Link`ç­‰apiï¼Œå¯ä»¥é€šè¿‡domæ“ä½œè§¦å‘äº‹ä»¶æ§åˆ¶è·¯ç”±ã€‚\n\n`Link`ç»„ä»¶ï¼Œä¼šæ¸²æŸ“ä¸€ä¸ªaæ ‡ç­¾ï¼›`BrowserRouter`å’Œ`HashRouter`ç»„ä»¶ï¼Œå‰è€…ä½¿ç”¨`pushState`å’Œ`popState`äº‹ä»¶æ„å»ºè·¯ç”±ï¼Œåè€…ä½¿ç”¨` hash `å’Œ `hashchange `äº‹ä»¶æ„å»ºè·¯ç”±ã€‚\n\n`react-router-dom`åœ¨`react-router`çš„åŸºç¡€ä¸Šæ‰©å±•äº†å¯æ“ä½œ`dom`çš„`api`ã€‚\n\n`Swtich` å’Œ `Route` éƒ½æ˜¯ä»`react-router`ä¸­å¯¼å…¥äº†ç›¸åº”çš„ç»„ä»¶å¹¶é‡æ–°å¯¼å‡ºï¼Œæ²¡åšä»€ä¹ˆç‰¹æ®Šå¤„ç†ã€‚\n\n`react-router-dom`ä¸­`package.json`ä¾èµ–ä¸­å­˜åœ¨å¯¹`react-router`çš„ä¾èµ–ï¼Œæ•…æ­¤ï¼Œä¸éœ€è¦`npm`å®‰è£…`react-router`ã€‚\n\n> - å¯ç›´æ¥ npm å®‰è£… react-router-domï¼Œä½¿ç”¨å…¶apiã€‚\n\n## ç®€å•ä¿®æ”¹\n\nğŸ‘Œï¼Œå¤§å®¶ğŸ”¥åº”è¯¥å·²ç»å®‰è£…å®Œäº†å§ï¼Ÿæ¥ä¸‹æ¥ç®€å•çš„ä¿®æ”¹ä¸€ä¸‹è„šæ‰‹æ¶é‡Œé¢çš„å†…å®¹ã€‚ä¸»è¦æ˜¯ä¸ºäº†ç†Ÿæ‚‰å¯¹æ‰‹ï¼ŒçŸ¥å·±çŸ¥å½¼ç™¾æˆ˜ç™¾èƒœã€‚\n\n![demo](/image/router/demo.png)\n\nä¿®æ”¹ä¸€ä¸‹`src/app.js`\n\n```javascript\nimport React from 'react';\nimport {\n  BrowserRouter as Router,\n  Switch,\n  Route,\n  Link,\n} from \"react-router-dom\";\n\nfunction Home() {\n  return (\n    <>\n      <h1>é¦–é¡µ</h1>\n      <Link to=\"/login\">ç™»å½•</Link>\n    </>\n  )\n}\n\nfunction Login() {\n  return (\n    <>\n      <h1>ç™»å½•é¡µ</h1>\n      <Link to=\"/\">å›é¦–é¡µ</Link>\n    </>\n  );\n}\n\nfunction App() {\n  return (\n    <Router>\n      <Switch>\n        <Route path=\"/login\" component={Login}/>\n        <Route path=\"/\" component={Home}/>\n      </Switch>\n    </Router>\n  );\n}\n\nexport default App;\n```\n\nè¿™æ ·å°±å®Œæˆäº†ä¸€ä¸ªæœ€ç®€å•çš„ç¤ºä¾‹äº†ã€‚\n\n# SPAçš„æ ¸å¿ƒæ€æƒ³\n\n- ç›‘å¬`URL`çš„å˜åŒ–\n- æ”¹å˜æŸäº›`context`çš„å€¼\n- è·å–å¯¹åº”çš„é¡µé¢ç»„ä»¶\n- `render`æ–°çš„é¡µé¢\n\n# æºç æ”»è¯»\n\n## BrowserRouter\n\nä»å‰é¢çš„ç®€å•ç¤ºä¾‹ä¸­æˆ‘ä»¬ï¼Œå‘ç°æœ‰ä¸€ä¸ªæœ€å¤–å±‚çš„ä¼™è®¡ï¼Œå«`BrowserRouter`ã€‚æˆ‘ä»¬ç›´æ¥å¹²åˆ°ä»–çš„githubæºç å»ç…ç…ã€‚\n\né“¾æ¥ï¼šhttps://github.com/ReactTraining/react-router/blob/master/packages/react-router-dom/modules/BrowserRouter.js\n\n```javascript\nimport React from \"react\";\nimport { Router } from \"react-router\";\nimport { createBrowserHistory as createHistory } from \"history\";\nimport PropTypes from \"prop-types\";\nimport warning from \"tiny-warning\";\n\n/**\n * The public API for a <Router> that uses HTML5 history.\n */\nclass BrowserRouter extends React.Component {\n  history = createHistory(this.props);\n\n  render() {\n    return <Router history={this.history} children={this.props.children} />;\n  }\n}\n\nif (__DEV__) {\n  BrowserRouter.propTypes = {\n    basename: PropTypes.string,\n    children: PropTypes.node,\n    forceRefresh: PropTypes.bool,\n    getUserConfirmation: PropTypes.func,\n    keyLength: PropTypes.number\n  };\n\n  BrowserRouter.prototype.componentDidMount = function() {\n    warning(\n      !this.props.history,\n      \"<BrowserRouter> ignores the history prop. To use a custom history, \" +\n        \"use `import { Router }` instead of `import { BrowserRouter as Router }`.\"\n    );\n  };\n}\n\nexport default BrowserRouter;\n\n```\n\næŠ›å¼€ä¸€äº›ä¸ƒä¸ƒå…«å…«çš„åˆ¤æ–­ã€‚é‡æ–°çœ‹ã€‚\n\n```javascript\nimport React from \"react\";\nimport { Router } from \"react-router\";\nimport { createBrowserHistory as createHistory } from \"history\";\n\nclass BrowserRouter extends React.Component {\n  history = createHistory(this.props);\n\n  render() {\n    return <Router history={this.history} children={this.props.children} />;\n  }\n}\n```\n\nå†™ç€å‡ ä¸ªå¤§å­—ï¼šã€Šç“œå­äºŒæ‰‹è½¦ã€‹ä»–åªæ˜¯ä¸€ä¸ªä¸­é—´å•†ï¼Œä»–åœ¨èµšå·®ä»·ã€‚ï¼ˆæ‰“é’±ï¼\n\n`BrowserRouter`æ˜¯ä¾èµ–äºä¸¤ä¸ªåº“ï¼šåˆ†åˆ«ä¸º`history`å’Œ`react-router`ã€‚okï¼Œæˆ‘ä»¬ä¸€æ¢ç©¶ç«Ÿã€‚\n\n## react-router\n\næºç é“¾æ¥ï¼šhttps://github.com/ReactTraining/react-router/blob/master/packages/react-router/modules/Router.js\n\n\n\n```javascript\nimport HistoryContext from \"./HistoryContext.js\";\nimport RouterContext from \"./RouterContext.js\";\n```\n\nè¿™ä¸¤ä¸ªä¸œè¥¿å…¶å®å¾ˆç®€å•ï¼Œéƒ½æ˜¯å¼•ç”¨äº†ä¸€ä¸ªå«åš`createContext`ï¼Œç›®çš„ä¹Ÿå¾ˆç®€å•ï¼Œè¿™é‡Œå…¶å®å°±æ˜¯åˆ›å»ºçš„æ™®é€šcontextï¼Œåªä¸è¿‡æ‹¥æœ‰ç‰¹å®šçš„åç§°è€Œå·²ã€‚æºç å¦‚ä¸‹ã€‚å°±å‡ è¡Œã€‚\n\n```javascript\n// TODO: Replace with React.createContext once we can assume React 16+\nimport createContext from \"mini-create-react-context\";\n\nconst createNamedContext = name => {\n  const context = createContext();\n  context.displayName = name;\n\n  return context;\n};\n\nexport default createNamedContext;\n```\n\nOKï¼Œé‡ç‚¹æ˜¯æ¥ä¸‹æ¥ï¼ŒæŠ›å¼€contextä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨çš„ä¸œè¥¿ã€‚æˆ‘æ•´ç†ä¸€ä¸‹ã€‚\n\nå…ˆçœ‹æ„é€ å‡½æ•°\n\n### æ„é€ å‡½æ•°\n\n```javascript\nconstructor(props) {\n  super(props);\n\n  this.state = {\n    location: props.history.location\n  };\n\n  // This is a bit of a hack. We have to start listening for location\n  // changes here in the constructor in case there are any <Redirect>s\n  // on the initial render. If there are, they will replace/push when\n  // they mount and since cDM fires in children before parents, we may\n  // get a new location before the <Router> is mounted.\n  \n  // _isMounted è¡¨ç¤ºç»„ä»¶æ˜¯å¦åŠ è½½å®Œæˆ\n  this._isMounted = false;\n  // ç»„ä»¶æœªåŠ è½½å®Œæ¯•ï¼Œä½†æ˜¯ location å‘ç”Ÿçš„å˜åŒ–ï¼Œæš‚å­˜åœ¨ _pendingLocation å­—æ®µä¸­\n  this._pendingLocation = null;\n\n  // æ²¡æœ‰ staticContext å±æ€§ï¼Œè¡¨ç¤ºæ˜¯ HashRouter æˆ–æ˜¯ BrowserRouter\n  if (!props.staticContext) {\n    this.unlisten = props.history.listen(location => {\n      if (this._isMounted) {\n        // ç»„ä»¶åŠ è½½å®Œæ¯•ï¼Œå°†å˜åŒ–çš„ location æ–¹æ³• state ä¸­\n        this.setState({ location });\n      } else {\n        this._pendingLocation = location;\n      }\n    });\n  }\n}\n```\n\næœ‰ä¸¤ä¸ªå€¼â˜`_isMounted`å’Œ`_pendingLocation`\n\nåˆ†åˆ«æ˜¯  æ˜¯å¦æŒ‚è½½   å¾…å®š\n\nå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªlocationï¼Œé»˜è®¤å€¼æ˜¯ç”±å¤–é¢ä¼ å…¥çš„historyï¼Œæˆ‘æ‰¾åˆ°ä¼ å…¥çš„åœ°æ–¹ã€‚\n\nå…¶å®å°±æ˜¯ä¹‹å‰çœ‹åˆ°çš„`BrowserRouter`\n\n```javascript\nimport React from \"react\";\nimport { Router } from \"react-router\";\nimport { createBrowserHistory as createHistory } from \"history\";\n\nclass BrowserRouter extends React.Component {\n  history = createHistory(this.props);\n\n  render() {\n    return <Router history={this.history} children={this.props.children} />;\n  }\n}\n```\n\nä¸éš¾å‘ç°ï¼Œhistoryçš„é»˜è®¤å€¼å°±æ˜¯ç”±historyè¿™ä¸ªåº“æ¥æä¾›çš„ï¼Œè¿™ä¸ªåé¢ä¼šæåˆ°ï¼Œæˆ‘ä»¬ç»§ç»­çœ‹ã€‚\n\nå…ˆç®€å•çœ‹ä¸€ä¸‹æ³¨é‡Šçš„ç¿»è¯‘(è°·æ­Œç¿»è¯‘)\n\n> è¿™æœ‰ç‚¹hackã€‚ æˆ‘ä»¬å¿…é¡»å¼€å§‹åœ¨æ„é€ å‡½æ•°ä¸­ç›‘å¬ä½ç½®æ›´æ”¹ï¼Œä»¥é˜²åˆå§‹æ¸²æŸ“ä¸­å­˜åœ¨ä»»ä½•<Redirect>ã€‚ å¦‚æœæœ‰çš„è¯ï¼Œå®ƒä»¬å°†åœ¨å®‰è£…æ—¶æ›¿æ¢/æ¨åŠ¨ï¼Œå¹¶ä¸”ç”±äºcDMåœ¨çˆ¶çº§ä¹‹å‰åœ¨å­çº§ä¸­è§¦å‘ï¼Œå› æ­¤åœ¨å®‰è£…<Router>ä¹‹å‰ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šè·å¾—ä¸€ä¸ªæ–°ä½ç½®ã€‚ \n\nä»€ä¹ˆæ„æ€å‘¢ï¼Œæˆ‘ç®€å•æè¿°ä¸€ä¸‹ï¼š\n\n> å› ä¸ºå­ç»„ä»¶ä¼šæ¯”çˆ¶ç»„ä»¶æ›´æ—©æ¸²æŸ“å®Œæˆ, ä»¥åŠ`<Redirect>`çš„å­˜åœ¨, è‹¥æ˜¯åœ¨`<Router>`çš„`componentDidMount`ç”Ÿå‘½å‘¨æœŸä¸­å¯¹`history.location`è¿›è¡Œç›‘å¬, åˆ™æœ‰å¯èƒ½åœ¨ç›‘å¬äº‹ä»¶æ³¨å†Œä¹‹å‰, `history.location`å·²ç»ç”±äº`<Redirect>`å‘ç”Ÿäº†å¤šæ¬¡æ”¹å˜, å› æ­¤æˆ‘ä»¬éœ€è¦åœ¨`<Router>`çš„`constructor`ä¸­å°±æ³¨å†Œç›‘å¬äº‹ä»¶\n\næ”¶å›æ¥ï¼Œè¿›å…¥`if`ç»§ç»­çœ‹ã€‚\n\n```javascript\nthis.unlisten = props.history.listen(location => {\n  if (this._isMounted) {\n  \tthis.setState({ location });\n  } else {\n  \tthis._pendingLocation = location;\n  }\n});\n```\n\nå°±æ˜¯è°ƒç”¨äº†`history`çš„`listen`æ–¹æ³•ã€‚ä»ä»£ç ä¸­å¯ä»¥å¤§è‡´äº†è§£åˆ°å°±æ˜¯å¯¹`history`è¿›è¡Œç›‘å¬ï¼Œç„¶åè¿›è¡Œä¸€äº›æ“ä½œã€‚\n\n### componentWillUnmount\n\né‚£ä¹ˆè¿™ä¸ª`unlisten`ä»€ä¹ˆæ—¶å€™æ‰§è¡Œå‘¢ï¼Ÿ\n\n```javascript\ncomponentWillUnmount() {\n    if (this.unlisten) {\n      this.unlisten();\n      this._isMounted = false;\n      this._pendingLocation = null;\n    }\n  }\n```\n\nåœ¨`Router`è¿™ä¸ªç»„ä»¶å¸è½½çš„æ—¶å€™å°±æ‰§è¡Œå•¦ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå–æ¶ˆäº†å¯¹`history`çš„ç›‘å¬ã€‚\n\n### componentDidUnmount\n\nç„¶åçœ‹ä¸€ä¸‹`conponentDidMount`\n\n```javascript\ncomponentDidMount() {\n    this._isMounted = true;\n\n    if (this._pendingLocation) {\n      this.setState({ location: this._pendingLocation });\n    }\n  }\n```\n\nä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯ä¿®æ”¹ä¸€ä¸‹æ˜¯å¦æŒ‚è½½çš„å€¼ï¼Œä»¥åŠç»§ç»­ä¹‹å‰åœ¨æ„é€ å‡½æ•°é‡Œé¢çš„åˆ¤æ–­ã€‚å¦‚æœæš‚å­˜æ•°æ®æœ‰çš„è¯å°±æŠŠä»–å­˜ä¸‹æ¥ã€‚\n\n### render\n\n```react\nrender() {\n    return (\n      <RouterContext.Provider\n        value={{\n          // æ ¹æ® HashRouter è¿˜æ˜¯ BrowserRouterï¼Œå¯åˆ¤æ–­ history ç±»å‹\n          history: this.props.history,\n          // è¿™ä¸ª location å°±æ˜¯ç›‘å¬ history å˜åŒ–å¾—åˆ°çš„ location\n          location: this.state.location,\n          // path url params isExact å››ä¸ªå±æ€§\n          match: Router.computeRootMatch(this.state.location.pathname),\n          // åªæœ‰ StaticRouter ä¼šä¼  staticContext\n          // HashRouter å’Œ BrowserRouter éƒ½æ˜¯ null\n          staticContext: this.props.staticContext\n        }}\n      >\n        <HistoryContext.Provider\n          children={this.props.children || null}\n          value={this.props.history}\n        />\n      </RouterContext.Provider>\n    );\n  }\n```\n\n### æ€»ç»“\n\nRouterè¿™ä¸ªç»„ä»¶ä¸»è¦å°±æ˜¯å°†ä¸€äº›æ•°æ®è¿›è¡Œå­˜å‚¨ã€‚å­˜åˆ°`Context`ï¼Œä¹‹é—´ä¸ä¹ä¸€äº›ç‰¹æ®Šæƒ…å†µçš„åˆ¤æ–­ï¼Œæ¯”å¦‚å­ç»„ä»¶æ¸²æŸ“æ¯”çˆ¶ç»„ä»¶æ—©ï¼Œä»¥åŠ`Redirect`çš„æƒ…å†µçš„å¤„ç†ã€‚åœ¨å¸è½½çš„æ—¶å€™è¦ç§»é™¤å¯¹`history`çš„ç›‘å¬ã€‚\n\nå­ç»„ä»¶ä½œä¸ºæ¶ˆè´¹è€…ï¼Œå°±å¯ä»¥å¯¹é¡µé¢è¿›è¡Œä¿®æ”¹ï¼Œè·³è½¬ï¼Œè·å–è¿™äº›æ•°å€¼ã€‚\n\n\n\n## history\n\n### createBrowserHistory\n\n#### è¿”å›çš„å†…å®¹\n\nä¹‹å‰ä¸€ç›´æœ‰ä¸æ–­æåˆ°çš„`history`ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹å®ƒæ˜¯è°\n\næºç è¿æ¥ï¼šhttps://github.com/ReactTraining/history/blob/master/packages/history/index.ts\n\næˆ‘ä»¬ä¹‹å‰ç”¨åˆ°çš„`createBrowserHistory`ï¼Œä»–å…¶å®æ˜¯è¿”å›çš„ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡é‡Œé¢æœ‰æˆ‘ä»¬å¸¸ç”¨çš„ä¸€äº›æ–¹æ³•ã€‚\n\n```javascript\nlet history: BrowserHistory = {\n    get action() {\n      return action;\n    },\n    get location() {\n      return location;\n    },\n    createHref,\n    push,\n    replace,\n    go,\n    back() {\n      go(-1);\n    },\n    forward() {\n      go(1);\n    },\n    listen(listener) {\n      return listeners.push(listener);\n    },\n    block(blocker) {\n      let unblock = blockers.push(blocker);\n\n      if (blockers.length === 1) {\n        window.addEventListener(BeforeUnloadEventType, promptBeforeUnload);\n      }\n\n      return function() {\n        unblock();\n\n        // Remove the beforeunload listener so the document may\n        // still be salvageable in the pagehide event.\n        // See https://html.spec.whatwg.org/#unloading-documents\n        if (!blockers.length) {\n          window.removeEventListener(BeforeUnloadEventType, promptBeforeUnload);\n        }\n      };\n    }\n  };\n\n  return history;\n}\n```\n\nå¤§éƒ¨åˆ†ç²¾é«“å°±æ˜¯è¿™é‡Œã€‚å‘ç°æœ‰å¤šç†Ÿæ‚‰çš„ä¼™ä¼´ï¼ => `push`ã€`replace`ã€`go`ç­‰ç­‰ã€‚æœ‰äº›å…¶å®éƒ½æ˜¯`window`æä¾›çš„ã€‚\n\næœ‰äº›ç›´æ¥çœ‹ä»£ç å°±å¯ä»¥æ˜ç™½çš„å°±ä¸è§£é‡Šäº†ï¼Œæ¯”å¦‚`forward`ï¼Œ`back`ã€‚\n\n##### go\n\næ¯”å¦‚ä¸Šé¢æåˆ°çš„`go`æ–¹æ³•ï¼Œæˆªå–éƒ¨åˆ†æºç ã€‚\n\n```typescript\nlet globalHistory = window.history;\nfunction go(delta: number) {\n    globalHistory.go(delta);\n  }\n```\n\n\n\n##### createHref\n\n```typescript\n\n// è¿”å›ä¸€ä¸ªå®Œæ•´çš„url\nexport function createPath({\n  pathname = '/',\n  search = '',\n  hash = ''\n}: PartialPath) {\n  return pathname + search + hash;\n}\n\n// è¿”å›ä¸€ä¸ªurl\nfunction createHref(to: To) {\n  \t// çœ‹ä¸Šé¢\n    return typeof to === 'string' ? to : createPath(to);\n  }\n```\n\n\n\n##### push\n\n`push`çš„æºç ï¼Œé‡Œé¢é™„å¸¦äº†ä¸€äº›ä¼šç”¨åˆ°çš„å‡½æ•°ã€‚\n\n```typescript\n// å°±æ˜¯ç®€å•å¤„ç†ä¸€ä¸‹è¿”å›å€¼ã€‚\nfunction getNextLocation(to: To, state: State = null): Location {\n  return readOnly<Location>({\n    ...location,\n    ...(typeof to === 'string' ? parsePath(to) : to),\n    state,\n    key: createKey()\n  });\n}\n\n// è¿›è¡Œåˆ¤æ–­\nfunction allowTx(action: Action, location: Location, retry: () => void) {\n    return (\n      // é•¿åº¦ä¸º0å°±è¿”å›trueï¼Œé•¿åº¦å¤§äº0å°±è°ƒç”¨å‡½æ•°ï¼Œå¹¶ä¼ å…¥å‚æ•°ã€‚è¿™ä¸ªblockersç­‰ä¸€ä¸‹ä»”ç»†æ¢è®¨ä¸€ä¸‹\n      !blockers.length || (blockers.call({ action, location, retry }), false)\n    );\n  }\n\n\n// é¡¾åæ€ä¹‰è·å–stateå’Œurl\nfunction getHistoryStateAndUrl(\n    nextLocation: Location,\n    index: number\n  ): [HistoryState, string] {\n    return [\n      {\n        usr: nextLocation.state,\n        key: nextLocation.key,\n        idx: index\n      },\n      // çœ‹ä¸Šé¢ æœ‰ä¸“é—¨ä»‹ç»\n      createHref(nextLocation)\n    ];\n  }\n\n// è¿”å›ä¸€äº›å…³äºlocationçš„ä¿¡æ¯\nfunction getIndexAndLocation(): [number, Location] {\n    let { pathname, search, hash } = window.location;\n    let state = globalHistory.state || {};\n    return [\n      state.idx,\n      readOnly<Location>({\n        pathname,\n        search,\n        hash,\n        state: state.usr || null,\n        key: state.key || 'default'\n      })\n    ];\n  }\n\n// æ‰§è¡Œlistenerså†…éƒ¨çš„ä¸€äº›å‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯è·³è½¬ï¼‰ï¼Œåé¢ä¹Ÿä¼šè¯¦ç»†è§£è¯»\nfunction applyTx(nextAction: Action) {\n    action = nextAction;\n    [index, location] = getIndexAndLocation();\n    listeners.call({ action, location });\n  }\n\n\nfunction push(to: To, state?: State) {\n  \t// è¿™é‡Œæ˜¯ä¸€ä¸ªæšä¸¾å€¼\n    let nextAction = Action.Push;\n  \t\n    let nextLocation = getNextLocation(to, state);\n  \t// é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å†æ¥ä¸€æ¬¡\n    function retry() {\n      push(to, state);\n    }\n\n    if (allowTx(nextAction, nextLocation, retry)) {\n      let [historyState, url] = getHistoryStateAndUrl(nextLocation, index + 1);\n\n      // TODO: Support forced reloading\n      // try...catch because iOS limits us to 100 pushState calls :/\n      try {\n        // MDNçš„åœ°å€: https://developer.mozilla.org/zh-CN/docs/Web/API/History/pushState\n        globalHistory.pushState(historyState, '', url);\n      } catch (error) {\n        // They are going to lose state here, but there is no real\n        // way to warn them about it since the page will refresh...\n        // MDNçš„åœ°å€: https://developer.mozilla.org/zh-CN/docs/Web/API/Location/assign\n        window.location.assign(url);\n      }\n\n      applyTx(nextAction);\n    }\n  }\n```\n\næˆ‘åœ¨æ³¨é‡Šé‡Œé¢å·²ç»è¿›è¡Œéå¸¸è¯¦ç»†çš„è§£è¯»äº†ï¼Œç”¨åˆ°çš„æ¯ä¸ªå‡½æ•°éƒ½æœ‰è§£é‡Šæˆ–è€…å®˜æ–¹æƒå¨çš„urlã€‚\n\næ€»ç»“ä¸€ä¸‹ï¼š`history.push`çš„ä¸€ä¸ªå®Œæ•´æµç¨‹\n\n- è°ƒç”¨`history.pushState`\n  - é”™è¯¯ç”±`window.location.assign`æ¥å¤„ç†\n- æ‰§è¡Œä¸€ä¸‹`listeners`é‡Œé¢çš„å‡½æ•°\n\næ˜¯çš„ï¼Œä½ æ²¡æœ‰çœ‹é”™ï¼Œå°±è¿™ä¹ˆç®€å•ï¼Œåªæ˜¯é‡Œé¢æœ‰å¾ˆå¤šè°ƒç”¨çš„å‡½æ•°ï¼Œæˆ‘éƒ½æˆªå–å‡ºæ¥ä¸€ä¸€è§£é‡Šï¼Œåšåˆ°æ¯è¡Œä»£ç éƒ½ç†è§£ï¼Œæ‰€ä»¥æ˜¾å¾—æ¯”è¾ƒé•¿ï¼Œæ¦‚æ‹¬æ¥è¯´å°±æ˜¯è¿™ä¹ˆç®€å•ã€‚\n\né‡ç‚¹æ¥çœ‹ä¸€ä¸‹`listen`å’Œè¢«è°ƒç”¨çš„`createBrowserHistory`\n\n##### replace\n\nè¿™é‡Œé¢ç”¨çš„å‡½æ•°ï¼Œåœ¨å‰é¢çš„pushéƒ½æœ‰è§£æï¼Œå¯ä»¥å¾€ä¸Šé¢å»æ‰¾æ‰¾ï¼Œå°±ä¸å¤šèµ˜è¿°äº†ã€‚\n\n```typescript\nfunction replace(to: To, state?: State) {\n    let nextAction = Action.Replace;\n    let nextLocation = getNextLocation(to, state);\n    function retry() {\n      replace(to, state);\n    }\n\n    if (allowTx(nextAction, nextLocation, retry)) {\n      let [historyState, url] = getHistoryStateAndUrl(nextLocation, index);\n\n      // TODO: Support forced reloading\n      globalHistory.replaceState(historyState, '', url);\n\n      applyTx(nextAction);\n    }\n  }\n```\n\n\n\n##### listen\n\nåœ¨`history`è¿”å›çš„`listen`æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°æˆ‘ä»¬ä¹‹å‰åœ¨react-routerçš„æºç ä¸­å‘ç°ï¼Œä»–æ˜¯åœ¨æ„é€ å‡½æ•°å’Œå¸è½½çš„æ—¶å€™ä¼šç”¨åˆ°ã€‚\n\n```javascript\nlisten(listener) {\n      return listeners.push(listener);\n    },\n```\n\nä»”ç»†çœ‹çœ‹ï¼Œè¿™ä¸ª`listeners`æ˜¯åœ¨åšäº›ä»€ä¹ˆã€‚\n\n##### createEvents\n\nè¿™ä¸ªå‡½æ•°åé¢çš„blockersä¹Ÿä¼šç”¨åˆ°\n\n```typescript\nlet listeners = createEvents<Listener>();\n\nfunction createEvents<F extends Function>(): Events<F> {\n  let handlers: F[] = [];\n\n  return {\n    get length() {\n      return handlers.length;\n    },\n    push(fn: F) {\n      handlers.push(fn);\n      return function() {\n        handlers = handlers.filter(handler => handler !== fn);\n      };\n    },\n    call(arg) {\n      handlers.forEach(fn => fn && fn(arg));\n    }\n  };\n}\n```\n\nè¿™ä¸ªæ–¹æ³•ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯åˆ›å»ºäº‹ä»¶ã€‚å®šä¹‰äº†ä¸€ä¸ªå˜é‡ `handlers` æ•°ç»„ï¼Œç”¨äºå­˜æ”¾è¦å¤„ç†çš„å›è°ƒå‡½æ•°äº‹ä»¶ã€‚\n\nç„¶åè¿”å›äº†ä¸€ä¸ªå¯¹è±¡ã€‚\n\n`push` æ–¹æ³•å°±æ˜¯å¾€ `handlers` ä¸­æ·»åŠ è¦æ‰§è¡Œçš„å‡½æ•°ã€‚\n\nè¿™å—ä¸»è¦åœ¨ `history.listen()` ä¸­ä½¿ç”¨ï¼Œå¯ä»¥ç¿»åˆ°å¼€å¤´çœ‹ä¸‹ `history` ä¸­è¿”å›äº† `listen()` æ–¹æ³•ï¼Œå°±æ˜¯è°ƒç”¨äº†`listeners.push(listener)` ã€‚\n\næœ€å `call()` æ–¹æ³•å°±æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œå°±æ˜¯å–å‡º `handlers` é‡Œé¢çš„å›è°ƒå‡½æ•°å¹¶é€ä¸ªæ‰§è¡Œã€‚\n\næ€»ç»“ä¸€ä¸‹ï¼Œå°±æ˜¯å­˜å‚¨ä¸€ä¸‹`push`è¿›æ¥çš„å‡½æ•°ï¼Œå¹¶è¿›è¡Œè¿‡æ»¤ã€‚ä¹‹åè°ƒç”¨çš„æ—¶å€™ä¼šä¾æ¬¡æ‰§è¡Œã€‚`length`å°±æ˜¯å½“å‰æ‹¥æœ‰çš„å‡½æ•°æ•°é‡ã€‚\n\nå†åˆ‡å›å»ï¼Œå°±ä¼šå‘ç°ï¼Œæ¯æ¬¡è°ƒç”¨è¿™ä¸ª`listen`å°±ç›¸å½“äº`push`ä¸€ä¸ªå‡½æ•°åˆ°å†…éƒ¨çš„ä¸€ä¸ªå˜é‡`handlers`ä¸­ã€‚\n\n##### block\n\nå’Œ`listeners`ä¸€æ ·ï¼Œä¹Ÿæ˜¯ç”¨`createEvents`åˆ›å»ºçš„ï¼Œå°±ä¸å¤šè¯´å•¦ã€‚è¯´ä¸€ä¸‹å“ªé‡Œä¼šç”¨åˆ°è¿™ä¸ªå§ã€‚\n\n```typescript\nlet blockers = createEvents<Blocker>();\n```\n\n- `block(prompt)` - (function) Prevents navigation (see [the history docs](https://github.com/ReactTraining/history/blob/master/docs/blocking-transitions.md))\n\nè¿™ä¸ªæ˜¯`react-router`å®˜ç½‘çš„è§£é‡Šã€‚\n\næˆ‘è¿™é‡Œç®€å•æ¦‚æ‹¬ä¸€ä¸‹ï¼Œå°±æ˜¯ç”¨äºå…³é—­æˆ–è€…å›é€€æµè§ˆå™¨çš„è¯¯æ“ä½œä¼šç”¨åˆ°çš„ã€‚è¯¦ç»†çš„å¯ä»¥çœ‹ç‚¹å‡»è¿›å»æŸ¥çœ‹ã€‚\n\n##### æ€»ç»“\n\nè‡³æ­¤ï¼Œæˆ‘ä»¬è°ƒç”¨çš„`createBrowserHistory`æ‰€è¿”å›çš„ä¸€äº›å±æ€§çš„æºç éƒ½å·²ç»äº†å¦‚æŒ‡æŒäº†ã€‚ä½†æ˜¯å…·ä½“æ˜¯æ€ä¹ˆå·¥ä½œè¿˜æ˜¯ä¸€çŸ¥åŠè§£ã€‚\n\n#### å…·ä½“æ ¸å¿ƒåŸç†\n\nå…ˆç§€ä¸€ä¸‹æºç ã€‚historyçš„æ ¸å¿ƒåŸç†å°±æ˜¯è¿™ä¸ªã€‚å…ˆåˆ«è¢«è¿™ä¹ˆå¤šè¡Œä»£ç å”¬åˆ°äº†ï¼Œå¾ˆå¤šéƒ½æ˜¯æˆ‘ä»¬åœ¨ä¹‹å‰çš„pushé‡Œé¢æœ‰è§£é‡Šçš„\n\n```typescript\nconst PopStateEventType = 'popstate';\nlet blockedPopTx: Transition | null = null;\nfunction handlePop() {\n  // å¦‚æœæœ‰\n  if (blockedPopTx) {\n    blockers.call(blockedPopTx);\n    blockedPopTx = null;\n  } else {\n    let nextAction = Action.Pop;\n    let [nextIndex, nextLocation] = getIndexAndLocation();\n\n    if (blockers.length) {\n      if (nextIndex != null) {\n        let delta = index - nextIndex;\n        if (delta) {\n          // Revert the POP\n          blockedPopTx = {\n            action: nextAction,\n            location: nextLocation,\n            retry() {\n              go(delta * -1);\n            }\n          };\n\n          go(delta);\n        }\n      } else {\n        // Trying to POP to a location with no index. We did not create\n        // this location, so we can't effectively block the navigation.\n        warning(\n          false,\n          // TODO: Write up a doc that explains our blocking strategy in\n          // detail and link to it here so people can understand better what\n          // is going on and how to avoid it.\n          `You are trying to block a POP navigation to a location that was not ` +\n          `created by the history library. The block will fail silently in ` +\n          `production, but in general you should do all navigation with the ` +\n          `history library (instead of using window.history.pushState directly) ` +\n          `to avoid this situation.`\n        );\n      }\n    } else {\n      applyTx(nextAction);\n    }\n  }\n}\n\nwindow.addEventListener(PopStateEventType, handlePop);\n```\n\né‡ç‚¹è¯´ä¸€ä¸‹`window.addEventListener(PopStateEventType, handlePop)`\n\nMDNåœ°å€ï¼šhttps://developer.mozilla.org/zh-CN/docs/Web/API/Window/popstate_event\n\nå…¶å®å°±æ˜¯ç›‘å¬è·¯ç”±çš„å˜åŒ–ç„¶åï¼Œæ‰§è¡Œå›è°ƒå‡½æ•°\n\n### createHashHistory\n\nè¿™ä¸ªå¤§ä½“ä¸Šä¸æ™®é€šè·¯ç”±ä¸€è‡´ã€‚è¿™é‡Œæˆ‘æƒ³å¼ºè°ƒä¸€äº›é—®é¢˜ã€‚\n\n> æ¯”å¦‚å“ˆå¸Œè·¯ç”±çš„é”šç‚¹é—®é¢˜ï¼Œæˆ‘è‡ªå·±å·²çŸ¥çš„å‡ ä¸ªæ–¹æ¡ˆ\n>\n> - ### [scrollIntoView](https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollIntoView)\n>\n> - ### [scrollTop](https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollTop)\n>\n> - ## [react-anchor-without-hash](https://github.com/kwzm/react-anchor-without-hash)\n\næ„Ÿå…´è¶£çš„è‡ªå·±æŸ¥è¯¢ä¸€ä¸‹ï¼Œè¿™ä¸ªä¸åœ¨æœ¬æ¬¡çš„è®¨è®ºèŒƒå›´å†…ã€‚\n\n#### å…·ä½“æ ¸å¿ƒåŸç†\n\nä¹‹å‰è¯´çš„åˆ°ï¼Œ`history`è·¯ç”±çš„æ ¸å¿ƒæ˜¯`window.addEventListener(PopStateEventType, handlePop);`\n\nè€Œå“ˆå¸Œè·¯ç”±çš„æ ¸å¿ƒä¹Ÿæ˜¯ç›‘å¬è·¯ç”±çš„å˜åŒ–ï¼Œåªæ˜¯å‚æ•°ä¸åŒã€‚\n\n```javascript\nwindow.addEventListener('hashchange',function(e){\n    /* ç›‘å¬æ”¹å˜ */\n})\n```\n\nè€Œå¯¹è·¯ç”±çš„æ”¹å˜ã€‚`history`è·¯ç”±æ˜¯ï¼š`history.pushState`ï¼Œ`history.replaceState`ã€‚\n\nå“ˆå¸Œè·¯ç”±æ˜¯ï¼š\n\n`window.location.hash`\n\né€šè¿‡`window.location.hash `å±æ€§è·å–å’Œè®¾ç½® `hash `å€¼ã€‚\n\nå…·ä½“çš„è¯å¾ˆå·®ä¸å¤šï¼Œå…³å¿ƒç»†èŠ‚çš„ä¼™ä¼´å¯ä»¥å»çœ‹å…¶æºç å“¦ã€‚\n\n# æ ¸å¿ƒAPI\n\nä¹‹å‰æˆ‘ä»¬çœ‹äº†BrowserRouterã€‚æˆ‘ä»¬å›è¿‡å¤´æ¥çœ‹çœ‹ï¼Œdemoä¸­çš„å®ä¾‹ä»£ç è¿˜æœ‰å¤šå°‘æ²¡æœ‰è§£å†³ï¼š\n\n```react\nimport React from 'react';\nimport {\n  BrowserRouter as Router,\n  Switch,\n  Route,\n  Link,\n} from \"react-router-dom\";\n\nfunction Home() {\n  return (\n    <>\n      <h1>é¦–é¡µ</h1>\n      <Link to=\"/login\">ç™»å½•</Link>\n    </>\n  )\n}\n\nfunction Login() {\n  return (\n    <>\n      <h1>ç™»å½•é¡µ</h1>\n      <Link to=\"/\">å›é¦–é¡µ</Link>\n    </>\n  );\n}\n\nfunction App() {\n  return (\n    <Router>\n      <Switch>\n        <Route path=\"/login\" component={Login}/>\n        <Route path=\"/\" component={Home}/>\n      </Switch>\n    </Router>\n  );\n}\n\nexport default App;\n```\n\næˆ‘ä»¬å·²ç»çœ‹å®Œäº†`BrowserRouter`ï¼ˆ`Router`ã€‚ä¸‹é¢è¿˜æœ‰`Switch`å’Œ`Route`ã€‚\n\n## Switch\n\nå…ˆä¸Šæºç ã€‚æˆ‘æ‘˜å–æœ€æ ¸å¿ƒçš„ä¸€éƒ¨åˆ†ã€‚\n\n```react\nclass Switch extends React.Component {\n  render() {\n    return (\n      <RouterContext.Consumer>\n        {context => {\n          invariant(context, \"You should not use <Switch> outside a <Router>\");\n\n          // é»˜è®¤ä½¿ç”¨context.locationï¼Œå¦‚æœæœ‰ç‰¹æ®Šå®šåˆ¶çš„locationæ‰ä¼šä½¿ç”¨ã€‚\n          // ä¸‹é¢æœ‰ä»‹ç»\n          const location = this.props.location || context.location;\n\n          let element, match;\n\n          // We use React.Children.forEach instead of React.Children.toArray().find()\n          // here because toArray adds keys to all child elements and we do not want\n          // to trigger an unmount/remount for two <Route>s that render the same\n          // component at different URLs.\n          // React.Children.forEach å¯¹å­å…ƒç´ åšéå†\n          React.Children.forEach(this.props.children, child => {\n            // åªè¦æ‰¾åˆ°ä¸€ä¸ª matchï¼Œé‚£ä¹ˆå°±ä¸ä¼šå†è¿›æ¥äº†\n            if (match == null && React.isValidElement(child)) {\n              element = child;\n\n              // child.props.path å°±ä¸å¤šè®²äº†ï¼Œ Route çš„æ ‡å‡†å†™æ³•\n              // éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ from ä¹Ÿä¼šè¢«åŒ¹é…åˆ°\n              // ä»»ä½•ç»„ä»¶ï¼Œåªè¦åœ¨ Switch ä¸‹ï¼Œæœ‰ from å±æ€§ï¼Œå¹¶ä¸”å’Œå½“å‰è·¯å¾„åŒ¹é…ï¼Œå°±ä¼šè¢«æ¸²æŸ“\n              // fromå…·ä½“æ˜¯ç»™<Redirect>ä½¿ç”¨çš„ï¼Œåé¢ä¼šè¯´åˆ°\n              const path = child.props.path || child.props.from;\n\n              // åˆ¤æ–­ç»„ä»¶æ˜¯å¦åŒ¹é…\n              match = path\n              // ä¸‹é¢æœ‰ä¸“å±çš„ä»‹ç»è¿™ä¸ªå‡½æ•°\n                ? matchPath(location.pathname, { ...child.props, path })\n                : context.match;\n            }\n          });\n\n          return match\n            ? React.cloneElement(element, { location, computedMatch: match })\n            : null;\n        }}\n      </RouterContext.Consumer>\n    );\n  }\n}\n\n```\n\nSwitchä¸­çš„locationè¿™ä¸ªpropsæ€ä¹ˆç”¨ï¼Ÿä»€ä¹ˆç”¨ï¼Ÿ\n\n> ## æ‘˜è‡ªå®˜ç½‘\n>\n> ## [location: object](https://reactrouter.com/web/api/Switch/location-object)\n>\n> A [`location`](https://reactrouter.com/web/api/location) object to be used for matching children elements instead of the current history location (usually the current browser URL).\n>\n> è°·æ­Œç¿»è¯‘ï¼šç”¨äºåŒ¹é…å­å…ƒç´ çš„ä½ç½®å¯¹è±¡ï¼Œè€Œä¸æ˜¯å½“å‰å†å²è®°å½•ä½ç½®ï¼ˆé€šå¸¸æ˜¯å½“å‰æµè§ˆå™¨URLï¼‰ã€‚\n\n### matchPath\n\n```javascript\nfunction matchPath(pathname, options = {}) {\n  // è§„èŒƒç»“æ„ä½“\n  // å¦‚æœ options ä¼ çš„æ˜¯ä¸ª stringï¼Œé‚£é»˜è®¤è¿™ä¸ª string ä»£è¡¨ path\n  // å¦‚æœ options ä¼ çš„æ˜¯ä¸ª æ•°ç»„ï¼Œé‚£åªè¦æœ‰ä¸€ä¸ªåŒ¹é…ï¼Œå°±è®¤ä¸ºåŒ¹é…\n  if (typeof options === \"string\" || Array.isArray(options)) {\n    options = { path: options };\n  }\n\n  const { path, exact = false, strict = false, sensitive = false } = options;\n\n  // è½¬åŒ–æˆæ•°ç»„è¿›è¡Œåˆ¤æ–­\n  const paths = [].concat(path);\n\n  // éƒ½æ˜¯å¾ˆç®€å•çš„å†…å®¹ï¼Œéš¾ç‚¹å°±åœ¨è¿™ä¸ªreduceï¼Œè¿™ä¸ªå¾ˆæœ‰æ„æ€ï¼Œæ„Ÿå…´è¶£æˆ–è€…ä¸äº†è§£çš„èµ¶ç´§å»MDNäº†è§£ä¸€ä¸‹ï¼ï¼ï¼\n  return paths.reduce((matched, path) => {\n    if (!path && path !== \"\") return null;\n    // åªè¦æœ‰ä¸€ä¸ª matchï¼Œç›´æ¥è¿”å›ï¼Œè®¤ä¸ºæ˜¯ match\n    if (matched) return matched;\n\n    // regexp æ˜¯æ­£åˆ™è¡¨è¾¾å¼\n    // keys æ˜¯åˆ‡å‰²å‡ºæ¥çš„å¾— key çš„å€¼\n    const { regexp, keys } = compilePath(path, {\n      end: exact,\n      strict,\n      sensitive\n    });\n    // exec() è¯¥æ–¹æ³•å¦‚æœæ‰¾åˆ°äº†åŒ¹é…çš„æ–‡æœ¬çš„è¯ï¼Œåˆ™ä¼šè¿”å›ä¸€ä¸ªç»“æœæ•°ç»„ï¼Œå¦åˆ™çš„è¯ï¼Œä¼šè¿”å›ä¸€ä¸ª\n    const match = regexp.exec(pathname);\n    /* åŒ¹é…ä¸æˆåŠŸï¼Œè¿”å›null */\n    if (!match) return null;\n\n    // url è¡¨ç¤ºåŒ¹é…åˆ°çš„éƒ¨åˆ†\n    const [url, ...values] = match;\n    // pathname === url è¡¨ç¤ºå®Œå…¨åŒ¹é…\n    const isExact = pathname === url;\n\n    if (exact && !isExact) return null;\n\n    return {\n      path, // the path used to match\n      url: path === \"/\" && url === \"\" ? \"/\" : url, // the matched portion of the URL\n      isExact, // whether or not we matched exactly\n      params: keys.reduce((memo, key, index) => {\n        memo[key.name] = values[index];\n        return memo;\n      }, {})\n    };\n  }, null);\n}\n```\n\nmatchPath å‡½æ•°ä¹Ÿæ˜¯ç”± react-router export å‡ºå»çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ¥è·å¾—æŸä¸ª url ä¸­çš„æŒ‡å®šçš„å‚æ•°ã€‚\n\n\n\n## Route\n\nRoute æ˜¯ç”¨äºå£°æ˜è·¯ç”±æ˜ å°„åˆ°åº”ç”¨ç¨‹åºçš„ç»„ä»¶å±‚ã€‚\n\nRoute æœ‰ä¸‰ç§æ¸²æŸ“çš„æ–¹æ³•ï¼Œå½“ç„¶ï¼Œéƒ½é…ç½®çš„è¯åªæœ‰ä¸€ä¸ªä¼šç”Ÿæ•ˆï¼Œä¼˜å…ˆçº§æ˜¯ children > component > render\n\n\\1. <Route component>\n\\2. <Route render>\n\\3. <Route children>\n\næ¯ä¸ªåœ¨ä¸åŒçš„æƒ…å†µä¸‹éƒ½æœ‰ç”¨ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¼šä½¿ç”¨ componentã€‚\n\n### component\n\ncomponent è¡¨ç¤ºåªæœ‰å½“ä½ç½®åŒ¹é…æ—¶æ‰ä¼šæ¸²æŸ“çš„ React ç»„ä»¶ã€‚ä½¿ç”¨ componentï¼ˆè€Œä¸æ˜¯ render æˆ– children ï¼‰Route ä½¿ç”¨ä»ç»™å®šç»„ä»¶ React.createElement(element, props) åˆ›å»ºæ–°çš„ React elementã€‚è¿™æ„å‘³ç€ï¼Œä½¿ç”¨ component åˆ›å»ºçš„ç»„ä»¶èƒ½è·å¾— router ä¸­çš„ propsã€‚\n\n### children\n\nä»æºç ä¸­å¯ä»¥çœ‹å‡ºï¼Œchildren çš„ä¼˜å…ˆçº§æ˜¯é«˜äº componentï¼Œè€Œä¸”å¯ä»¥æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œchildren æ²¡æœ‰è·å¾— router çš„ propsã€‚\n\nchildren æœ‰ä¸€ä¸ªéå¸¸ç‰¹æ®Šçš„åœ°æ–¹åœ¨äºï¼Œå½“è·¯ç”±ä¸åŒ¹é…ä¸” children æ˜¯ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œ children æ–¹æ³•ï¼Œè¿™å°±ç»™äº†è®¾è®¡å¾ˆå¤§çš„çµæ´»æ€§ã€‚\n\n### render\n\nrender å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¼˜å…ˆçº§æ˜¯æœ€ä½çš„ï¼Œå½“åŒ¹é…æˆåŠŸçš„æ—¶å€™ï¼Œæ‰§è¡Œè¿™ä¸ªå‡½æ•°ã€‚\n\n### exact & strict & sensitive\n\nè¿™ä¸‰è€…éƒ½æ˜¯ä½¿ç”¨ path-to-regexp åšè·¯å¾„åŒ¹é…éœ€è¦çš„ä¸‰ä¸ªå‚æ•°ã€‚\n\n1. exact: å¦‚æœä¸º trueï¼Œåˆ™åªæœ‰åœ¨è·¯å¾„å®Œå…¨åŒ¹é… location.pathname æ—¶æ‰åŒ¹é…ã€‚\n2. strict: åœ¨ç¡®å®šä¸ºä½ç½®æ˜¯å¦ä¸å½“å‰ URL åŒ¹é…æ—¶ï¼Œå°†è€ƒè™‘ä½ç½® pathname åçš„æ–œçº¿ã€‚\n3. sensitive: å¦‚æœè·¯å¾„åŒºåˆ†å¤§å°å†™ï¼Œåˆ™ä¸º true ï¼Œåˆ™åŒ¹é…ã€‚\n\n### location\n\nRoute å…ƒç´ å°è¯•å…¶åŒ¹é… path åˆ°å½“å‰æµè§ˆå™¨ URLï¼Œä½†æ˜¯ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ location å®ç°ä¸å½“å‰æµè§ˆå™¨ä½ç½®ä»¥å¤–çš„ä½ç½®ç›¸åŒ¹é…ã€‚\n\nä¸‹é¢åˆ—å‡º Route æºç ï¼Œå¹¶ä¸”åˆ å»äº† dev éƒ¨åˆ†ã€‚\n\n```js\nimport React from \"react\";\nimport { isValidElementType } from \"react-is\";\nimport PropTypes from \"prop-types\";\nimport invariant from \"tiny-invariant\";\nimport warning from \"tiny-warning\";\n\nimport RouterContext from \"./RouterContext.js\";\nimport matchPath from \"./matchPath.js\";\n\n/**\n * The public API for matching a single path and rendering.\n */\nclass Route extends React.Component {\n  render() {\n    return (\n      <RouterContext.Consumer>\n        {context => {\n          invariant(context, \"You should not use <Route> outside a <Router>\");\n\n          // å¯ä»¥çœ‹å‡ºï¼Œç”¨æˆ·ä¼ çš„ location è¦†ç›–æ‰äº† context ä¸­çš„ location\n          const location = this.props.location || context.location;\n\n          // å¦‚æœæœ‰ computedMatch å°±ç”¨ computedMatch ä½œä¸ºç»“æœ\n          // å¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ¤æ–­æ˜¯å¦æœ‰ path ä¼ å‚\n          // matchPath æ˜¯è°ƒç”¨ path-to-regexp åˆ¤æ–­æ˜¯å¦åŒ¹é…\n          // path-to-regexp éœ€è¦ä¸‰ä¸ªå‚æ•°\n          // exact: å¦‚æœä¸º trueï¼Œåˆ™åªæœ‰åœ¨è·¯å¾„å®Œå…¨åŒ¹é… location.pathname æ—¶æ‰åŒ¹é…\n          // strict: å¦‚æœä¸º true å½“çœŸå®çš„è·¯å¾„å…·æœ‰ä¸€ä¸ªæ–œçº¿å°†åªåŒ¹é…ä¸€ä¸ªæ–œçº¿location.pathname\n          // sensitive: å¦‚æœè·¯å¾„åŒºåˆ†å¤§å°å†™ï¼Œåˆ™ä¸º true ï¼Œåˆ™åŒ¹é…\n          const match = this.props.computedMatch\n            ? this.props.computedMatch // <Switch> already computed the match for us\n            : this.props.path\n            ? matchPath(location.pathname, this.props)\n            : context.match;\n\n          // props å°±æ˜¯æ›´æ–°åçš„ context\n          // location åšäº†æ›´æ–°ï¼ˆæœ‰å¯èƒ½æ˜¯ç”¨æˆ·ä¼ å…¥çš„locationï¼‰\n          // match åšäº†æ›´æ–°\n          const props = { ...context, location, match };\n\n          // ä¸‰ç§æ¸²æŸ“æ–¹å¼\n          let { children, component, render } = this.props;\n\n          // Preact uses an empty array as children by\n          // default, so use null if that's the case.\n          // children é»˜è®¤æ˜¯ä¸ªç©ºæ•°ç»„ï¼Œå¦‚æœæ˜¯é»˜è®¤æƒ…å†µï¼Œç½®ä¸º null\n          if (Array.isArray(children) && children.length === 0) {\n            children = null;\n          }\n\n          return (\n            // RouterContext ä¸­æ›´æ–°äº† location, match\n            <RouterContext.Provider value={props}>\n              {props.match\n              // é¦–å…ˆåˆ¤æ–­çš„æ˜¯æœ‰æ—  children\n                ? children\n                  // å¦‚æœ children æ˜¯ä¸ªå‡½æ•°ï¼Œæ‰§è¡Œï¼Œå¦åˆ™ç›´æ¥è¿”å› children\n                  ? typeof children === \"function\"\n                  : children(props)\n                  : children\n                  // å¦‚æœæ²¡æœ‰ childrenï¼Œåˆ¤æ–­æœ‰æ—  component\n                : component\n                  // æœ‰ componentï¼Œé‡æ–°æ–°å»ºä¸€ä¸ª component\n                  ? React.createElement(component, props)\n                  // æ²¡æœ‰ componentï¼Œåˆ¤æ–­æœ‰æ—  render\n                  : render\n                  // æœ‰ renderï¼Œæ‰§è¡Œ render æ–¹æ³•\n                  ? render(props)\n                  // æ²¡æœ‰è¿”å› null\n                  : null\n\n                // è¿™é‡Œæ˜¯ä¸ match çš„æƒ…å†µï¼Œåˆ¤æ–­ children æ˜¯å¦å‡½æ•°\n                : typeof children === \"function\"\n                // æ˜¯çš„è¯æ‰§è¡Œ\n                ? children(props)\n                : null}\n            </RouterContext.Provider>\n          );\n        }}\n      </RouterContext.Consumer>\n    );\n  }\n}\n\nexport default Route;\n```\n\nRoute ç»„ä»¶æ ¹æ®è‡ªèº«çš„ä¼ å‚ï¼Œå¯¹ä¸Šå±‚ RouterContext ä¸­çš„éƒ¨åˆ†å±æ€§ï¼ˆlocation å’Œ matchï¼‰è¿›è¡Œäº†æ›´æ–°ï¼Œå¹¶ä¸”å¦‚æœå½“å‰è·¯å¾„å’Œé…ç½®çš„ path è·¯å¾„ matchï¼Œåˆ™æ¸²æŸ“è¯¥ç»„ä»¶ï¼Œæ¸²æŸ“çš„æ–¹å¼æœ‰ childrenï¼Œcomponentï¼Œrender ä¸‰ç§æ–¹å¼ï¼Œæˆ‘ä»¬æœ€å¸¸ç”¨çš„å°±æ˜¯ component æ–¹å¼ï¼Œæ³¨æ„æ¯ç§æ–¹å¼çš„åŒºåˆ«ã€‚\n\n## Prompt\n\nPrompt ç”¨äºè·¯ç”±åˆ‡æ¢æç¤ºã€‚è¿™åœ¨æŸäº›åœºæ™¯ä¸‹æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œæ¯”å¦‚ç”¨æˆ·åœ¨æŸä¸ªé¡µé¢ä¿®æ”¹æ•°æ®ï¼Œç¦»å¼€æ—¶ï¼Œæç¤ºç”¨æˆ·æ˜¯å¦ä¿å­˜ï¼ŒPrompt ç»„ä»¶æœ‰ä¿©ä¸ªå±æ€§ï¼š\n\n1. messageï¼šç”¨äºæ˜¾ç¤ºæç¤ºçš„æ–‡æœ¬ä¿¡æ¯ã€‚\n2. whenï¼šä¼ é€’å¸ƒå°”å€¼ï¼Œç›¸å½“äºæ ‡ç­¾çš„å¼€å…³ï¼Œé»˜è®¤æ˜¯ trueï¼Œè®¾ç½®æˆ false æ—¶ï¼Œå¤±æ•ˆã€‚\n\nPrompt çš„æœ¬è´¨æ˜¯åœ¨ when ä¸º true çš„æ—¶å€™ï¼Œè°ƒç”¨ context.history.block æ–¹æ³•ï¼Œä¸ºå…¨å±€æ³¨å†Œè·¯ç”±ç›‘å¬ï¼Œblock çš„åŸç†çœ‹ä¹‹å‰çš„ history ç›¸å…³æ–‡ç« ã€‚è·¯æœ‰å˜åŒ–çš„æ—¶å€™ï¼Œé»˜è®¤ä½¿ç”¨ window.confirm è¿›è¡Œç¡®è®¤ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ confirm çš„å½¢å¼ï¼Œå°±æ˜¯åœ¨ BrowserRouter æˆ–è€… HashRouter ä¼ å…¥ getUserConfirmation è¿™ä¸ªå‚æ•°ï¼Œä¼šæ›¿æ¢æ‰ window.confirmã€‚\n\n```react\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport invariant from \"tiny-invariant\";\n\nimport Lifecycle from \"./Lifecycle.js\";\nimport RouterContext from \"./RouterContext.js\";\n\n/**\n * The public API for prompting the user before navigating away from a screen.\n */\nfunction Prompt({ message, when = true }) {\n  return (\n    <RouterContext.Consumer>\n      {context => {\n        invariant(context, \"You should not use <Prompt> outside a <Router>\");\n\n        if (!when || context.staticContext) return null;\n\n        // è°ƒç”¨äº† history.block æ–¹æ³•\n        const method = context.history.block;\n\n        return (\n          <Lifecycle\n            onMount={self => {\n              self.release = method(message);\n            }}\n            onUpdate={(self, prevProps) => {\n              if (prevProps.message !== message) {\n                self.release();\n                self.release = method(message);\n              }\n            }}\n            onUnmount={self => {\n              self.release();\n            }}\n            message={message}\n          />\n        );\n      }}\n    </RouterContext.Consumer>\n  );\n}\n\nexport default Prompt;\n```\n\n## Redirect\n\nRedirect ä¸å…¶è¯´æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œä¸å¦‚è¯´æ˜¯æœ‰ç»„ä»¶å°è£…çš„ä¸€ç»„æ–¹æ³•ï¼Œè¯¥ç»„ä»¶åœ¨ componentDidMount ç”Ÿå‘½å‘¨æœŸå†…ï¼Œé€šè¿‡è°ƒç”¨ history API è·³è½¬åˆ°åˆ°æ–°ä½ç½®ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ–°ä½ç½®å°†è¦†ç›–å†å²å †æ ˆä¸­çš„å½“å‰ä½ç½®ã€‚\n\n<Redirect to=\"/somewhere/else\"/> to è¡¨ç¤ºè¦é‡å®šå‘åˆ°çš„ç½‘å€ã€‚to ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª location å¯¹è±¡\n\n<Redirect push to=\"/somewhere/else\"/> push ä¸º true æ—¶ï¼Œé‡å®šå‘ä¼šå°†æ–°æ¡ç›®æ¨å…¥å†å²è®°å½•ï¼Œè€Œä¸æ˜¯æ›¿æ¢å½“å‰æ¡ç›®ã€‚\n\nç»“åˆ Switch å’Œ Redirect æºç çœ‹ï¼Œå¦‚æœ Redirect ä¸­æœ‰ from å±æ€§ï¼Œä¼šè¢« Switch è·å¾—ï¼Œå½“ from å’Œå½“å‰è·¯å¾„åŒ¹é…çš„æ—¶å€™ï¼Œå°±ä¼šæ¸²æŸ“ Redirect ç»„ä»¶ï¼Œæ‰§è¡Œè·³è½¬ã€‚\n\n```js\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { createLocation, locationsAreEqual } from \"history\";\nimport invariant from \"tiny-invariant\";\n\nimport Lifecycle from \"./Lifecycle.js\";\nimport RouterContext from \"./RouterContext.js\";\nimport generatePath from \"./generatePath.js\";\n\n/**\n * The public API for navigating programmatically with a component.\n */\nfunction Redirect({ computedMatch, to, push = false }) {\n  return (\n    // å•¥éƒ½æœ‰çš„å¤§å“¥ RouterContext\n    <RouterContext.Consumer>\n      {context => {\n        invariant(context, \"You should not use <Redirect> outside a <Router>\");\n\n        const { history, staticContext } = context;\n\n        // ä¸€èˆ¬æ¥è¯´ï¼ŒRedirect æ“ä½œéƒ½ä¸éœ€è¦ç•™æœ‰ historyï¼Œæ‰€ä»¥é€‰æ‹©é€‰æ‹© history.replace\n        const method = push ? history.push : history.replace;\n\n\n        const location = createLocation(\n          // computedMatch å°±æ˜¯çœ‹çœ‹ switch æœ‰æ²¡æœ‰å¤šç®¡é—²äº‹\n          computedMatch\n            ? typeof to === \"string\"\n              ? generatePath(to, computedMatch.params)\n              : {\n                  ...to,\n                  pathname: generatePath(to.pathname, computedMatch.params)\n                }\n            : to\n        );\n\n        // When rendering in a static context,\n        // set the new location immediately.\n        // staticRouter ä¸“ç”¨\n        if (staticContext) {\n          method(location);\n          return null;\n        }\n\n        return (\n          <Lifecycle\n            onMount={() => {\n              // componentDidMount çš„æ—¶å€™æ‰§è¡Œ method(location)ï¼Œä¹Ÿå°±æ˜¯ history.replace æ“ä½œ\n              method(location);\n            }}\n            onUpdate={(self, prevProps) => {\n              // componentDidUpdate æ—¶å€™åˆ¤æ–­å½“å‰ location å’Œä¸Šä¸€ä¸ª location æ˜¯å¦å‘ç”Ÿå˜åŒ–\n              // åªè¦å‘ç”Ÿå˜åŒ–ï¼Œè°ƒç”¨ method(location)\n              // ä¸€èˆ¬æ¥è®²ï¼Œåœ¨ componentDidMount çš„æ—¶å€™å°±è·³èµ°äº†ï¼Œä¸ä¼šç­‰åˆ° componentDidUpdate\n              const prevLocation = createLocation(prevProps.to);\n              if (\n                !locationsAreEqual(prevLocation, {\n                  ...location,\n                  key: prevLocation.key\n                })\n              ) {\n                method(location);\n              }\n            }}\n\n            // æ— æ•ˆ\n            to={to}\n          />\n        );\n      }}\n    </RouterContext.Consumer>\n  );\n}\n\nexport default Redirect;\n```\n\nLifecycle ä¸ render ä»»ä½•é¡µé¢ï¼Œåªæœ‰ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼ŒLifecycle æä¾›äº† onMountï¼Œ onUpdateï¼Œ onUnmount ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚\n\n```js\nimport React from \"react\";\n\nclass Lifecycle extends React.Component {\n  componentDidMount() {\n    if (this.props.onMount) this.props.onMount.call(this, this);\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.onUpdate) this.props.onUpdate.call(this, this, prevProps);\n  }\n\n  componentWillUnmount() {\n    if (this.props.onUnmount) this.props.onUnmount.call(this, this);\n  }\n\n  render() {\n    return null;\n  }\n}\n\nexport default Lifecycle;\n```\n\n# æ€»ç»“\n\næ•´ä¸ª`react-router`æ˜¯ç”±`createBrowserHistory`æˆ–è€…`createHashHistory`æ¥ç‰µå¤´ï¼Œä¸æˆ‘ä»¬çš„`React`ç»„ä»¶ç»‘å®šåœ¨ä¸€èµ·ï¼Œç„¶åä¼ é€’äº†ä¸€äº›å±äº`history`è¿™ä¸ªåº“çš„æ–¹æ³•ä»¥åŠæ•°å€¼ã€‚å½“ç„¶ï¼Œè¿˜æœ‰è·¯ç”±çš„åŒ¹é…å’Œæ¸²æŸ“ã€‚\n\nåœ¨`history`è¿™ä¸ªåº“é‡Œé¢åˆæœ‰å¯¹äºè·¯ç”±çš„ç›‘å¬ï¼Œæ”¹å˜ç­‰ç­‰ã€‚\n\n## æµç¨‹\n\nä»¥`history`æ¨¡å¼åšå‚è€ƒï¼ˆä¹Ÿæ˜¯æˆ‘ä»¬é‡ç‚¹é˜…è¯»çš„ã€‚\n\n### ä¿®æ”¹url\n\nå½“`url`æ”¹å˜çš„æ—¶å€™ï¼Œä¼šè§¦å‘å†™åœ¨`window`ä¸Šé¢çš„ç›‘å¬`window.addEventListener('popstate', handlePop)`ã€‚\n\nè°ƒç”¨äº†æˆ‘ä»¬çš„å‡½æ•°`handlePop`\n\nå‡½æ•°å†…éƒ¨æˆ‘ä»¬`setState`ï¼Œä¿®æ”¹äº†`location`ï¼Œæ–¹ä¾¿ä¼ é€’æ­£ç¡®çš„å€¼ä¸‹å»ï¼Œå¹¶é€šè¿‡äº†`Switch`æ‰¾å‡ºåŒ¹é…çš„`Route`ç»„ä»¶ã€‚\n\nè§¦å‘äº†ç»„ä»¶çš„æ¸²æŸ“ã€‚\n\n> å½“ç„¶ä¹ŸåŒ…æ‹¬æˆ‘ä»¬æ‰€è°“çš„history.pushï¼Œhistory.repalceç­‰ç­‰è¿™äº›æ–¹æ³•ï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¿®æ”¹urlï¼Œç„¶åå°±æ˜¯é‡å¤ä¸Šé¢çš„æ­¥éª¤\n\n\n\n\n\n\n\n","source":"_posts/ã€é‡è¯†å‰ç«¯ã€‘React-Routeræºç é˜…è¯».md","raw":"---\ntitle: ã€é‡è¯†å‰ç«¯ã€‘React-Routeræºç é˜…è¯»\ndate: 2020-11-14 20:29:17\ntags: [æºç é˜…è¯», React]\ncategory: [é‡æ‹¾å‰ç«¯]\ncover: /image/cover/web.jpeg\n---\n\n# å‰è¨€\n\næ­¤å¤„ä»‹ç»ä¸€ä¸‹React-Routerçš„æ ¸å¿ƒåŸç†ã€‚ç‰¹åˆ«ç»†è‡´çš„æ ‡ç‚¹ç¬¦å·çš„ä¸äºˆè®¨è®ºã€‚\n\n# å­¦å‰å°çŸ¥è¯†\n\n`React-Router`å…¶å®æœ€æ ¸å¿ƒçš„ä¸œè¥¿æ˜¯`Route`ç»„ä»¶å’Œç”±ç»Ÿä¸€ä½œè€…å¼€å‘çš„`History`åº“æ¥å»ºç«‹çš„ã€‚æ¥ä¸‹æ¥è·Ÿç€é•œå¤´ä¸€èµ·èµ°è¿›ç¥ç§˜çš„`ÃŸReact-Router`ä¸–ç•Œå§ã€‚\n\nå·²ç»çŸ¥é“æ€ä¹ˆä½¿ç”¨çš„ç›´æ¥è·³è¿‡ï¼Œåˆ°ä¸‹é¢çš„æºç åˆ†æå»â”—|ï½€Oâ€²|â”› å—·~~\n\n# ç®€å•ç¤ºä¾‹\n\nä¸€èµ·å»ºä¸€ä¸ªç®€å•çš„ç¤ºä¾‹å§ã€‚å…ˆç”¨`react`å®˜ç½‘çš„`create-react-app`è„šæ‰‹æ¶å¼„ä¸ª`react`å‡ºæ¥ã€‚\n\n```sh\nnpx create-react-app my-app\ncd my-app\nnpm start\n```\n\nå®‰è£…[react-router-dom](https://reactrouter.com/web/guides/quick-start)\n\n```sh\nnpm install react-router-dom\n```\n\nåœ¨å¤§å®¶å®‰è£…ä¹‹ä½™ï¼Œæˆ‘ç®€ç­”çš„ä»‹ç»ä¸€ä¸‹`react-router`å’Œ`react-router-dom`çš„åŒºåˆ«ã€‚\n\n## react-routerå’Œreact-router-domçš„åŒºåˆ«ã€‚\n\n### å…ˆçœ‹æä¾›çš„API\u0003\n\n```javascript\nimport { Switch, Route, Router } from 'react-router';\n\nimport { Swtich, Route, BrowserRouter, HashHistory, Link } from 'react-router-dom';\n```\n\n#### React-router\n\næä¾›äº†è·¯ç”±çš„æ ¸å¿ƒapiã€‚å¦‚Routerã€Routeã€Switchç­‰ï¼Œä½†æ²¡æœ‰æä¾›æœ‰å…³domæ“ä½œè¿›è¡Œè·¯ç”±è·³è½¬çš„apiï¼›\n\n#### React-router-dom\n\næä¾›äº†`BrowserRouter`ã€`Route`ã€`Link`ç­‰apiï¼Œå¯ä»¥é€šè¿‡domæ“ä½œè§¦å‘äº‹ä»¶æ§åˆ¶è·¯ç”±ã€‚\n\n`Link`ç»„ä»¶ï¼Œä¼šæ¸²æŸ“ä¸€ä¸ªaæ ‡ç­¾ï¼›`BrowserRouter`å’Œ`HashRouter`ç»„ä»¶ï¼Œå‰è€…ä½¿ç”¨`pushState`å’Œ`popState`äº‹ä»¶æ„å»ºè·¯ç”±ï¼Œåè€…ä½¿ç”¨` hash `å’Œ `hashchange `äº‹ä»¶æ„å»ºè·¯ç”±ã€‚\n\n`react-router-dom`åœ¨`react-router`çš„åŸºç¡€ä¸Šæ‰©å±•äº†å¯æ“ä½œ`dom`çš„`api`ã€‚\n\n`Swtich` å’Œ `Route` éƒ½æ˜¯ä»`react-router`ä¸­å¯¼å…¥äº†ç›¸åº”çš„ç»„ä»¶å¹¶é‡æ–°å¯¼å‡ºï¼Œæ²¡åšä»€ä¹ˆç‰¹æ®Šå¤„ç†ã€‚\n\n`react-router-dom`ä¸­`package.json`ä¾èµ–ä¸­å­˜åœ¨å¯¹`react-router`çš„ä¾èµ–ï¼Œæ•…æ­¤ï¼Œä¸éœ€è¦`npm`å®‰è£…`react-router`ã€‚\n\n> - å¯ç›´æ¥ npm å®‰è£… react-router-domï¼Œä½¿ç”¨å…¶apiã€‚\n\n## ç®€å•ä¿®æ”¹\n\nğŸ‘Œï¼Œå¤§å®¶ğŸ”¥åº”è¯¥å·²ç»å®‰è£…å®Œäº†å§ï¼Ÿæ¥ä¸‹æ¥ç®€å•çš„ä¿®æ”¹ä¸€ä¸‹è„šæ‰‹æ¶é‡Œé¢çš„å†…å®¹ã€‚ä¸»è¦æ˜¯ä¸ºäº†ç†Ÿæ‚‰å¯¹æ‰‹ï¼ŒçŸ¥å·±çŸ¥å½¼ç™¾æˆ˜ç™¾èƒœã€‚\n\n![demo](/image/router/demo.png)\n\nä¿®æ”¹ä¸€ä¸‹`src/app.js`\n\n```javascript\nimport React from 'react';\nimport {\n  BrowserRouter as Router,\n  Switch,\n  Route,\n  Link,\n} from \"react-router-dom\";\n\nfunction Home() {\n  return (\n    <>\n      <h1>é¦–é¡µ</h1>\n      <Link to=\"/login\">ç™»å½•</Link>\n    </>\n  )\n}\n\nfunction Login() {\n  return (\n    <>\n      <h1>ç™»å½•é¡µ</h1>\n      <Link to=\"/\">å›é¦–é¡µ</Link>\n    </>\n  );\n}\n\nfunction App() {\n  return (\n    <Router>\n      <Switch>\n        <Route path=\"/login\" component={Login}/>\n        <Route path=\"/\" component={Home}/>\n      </Switch>\n    </Router>\n  );\n}\n\nexport default App;\n```\n\nè¿™æ ·å°±å®Œæˆäº†ä¸€ä¸ªæœ€ç®€å•çš„ç¤ºä¾‹äº†ã€‚\n\n# SPAçš„æ ¸å¿ƒæ€æƒ³\n\n- ç›‘å¬`URL`çš„å˜åŒ–\n- æ”¹å˜æŸäº›`context`çš„å€¼\n- è·å–å¯¹åº”çš„é¡µé¢ç»„ä»¶\n- `render`æ–°çš„é¡µé¢\n\n# æºç æ”»è¯»\n\n## BrowserRouter\n\nä»å‰é¢çš„ç®€å•ç¤ºä¾‹ä¸­æˆ‘ä»¬ï¼Œå‘ç°æœ‰ä¸€ä¸ªæœ€å¤–å±‚çš„ä¼™è®¡ï¼Œå«`BrowserRouter`ã€‚æˆ‘ä»¬ç›´æ¥å¹²åˆ°ä»–çš„githubæºç å»ç…ç…ã€‚\n\né“¾æ¥ï¼šhttps://github.com/ReactTraining/react-router/blob/master/packages/react-router-dom/modules/BrowserRouter.js\n\n```javascript\nimport React from \"react\";\nimport { Router } from \"react-router\";\nimport { createBrowserHistory as createHistory } from \"history\";\nimport PropTypes from \"prop-types\";\nimport warning from \"tiny-warning\";\n\n/**\n * The public API for a <Router> that uses HTML5 history.\n */\nclass BrowserRouter extends React.Component {\n  history = createHistory(this.props);\n\n  render() {\n    return <Router history={this.history} children={this.props.children} />;\n  }\n}\n\nif (__DEV__) {\n  BrowserRouter.propTypes = {\n    basename: PropTypes.string,\n    children: PropTypes.node,\n    forceRefresh: PropTypes.bool,\n    getUserConfirmation: PropTypes.func,\n    keyLength: PropTypes.number\n  };\n\n  BrowserRouter.prototype.componentDidMount = function() {\n    warning(\n      !this.props.history,\n      \"<BrowserRouter> ignores the history prop. To use a custom history, \" +\n        \"use `import { Router }` instead of `import { BrowserRouter as Router }`.\"\n    );\n  };\n}\n\nexport default BrowserRouter;\n\n```\n\næŠ›å¼€ä¸€äº›ä¸ƒä¸ƒå…«å…«çš„åˆ¤æ–­ã€‚é‡æ–°çœ‹ã€‚\n\n```javascript\nimport React from \"react\";\nimport { Router } from \"react-router\";\nimport { createBrowserHistory as createHistory } from \"history\";\n\nclass BrowserRouter extends React.Component {\n  history = createHistory(this.props);\n\n  render() {\n    return <Router history={this.history} children={this.props.children} />;\n  }\n}\n```\n\nå†™ç€å‡ ä¸ªå¤§å­—ï¼šã€Šç“œå­äºŒæ‰‹è½¦ã€‹ä»–åªæ˜¯ä¸€ä¸ªä¸­é—´å•†ï¼Œä»–åœ¨èµšå·®ä»·ã€‚ï¼ˆæ‰“é’±ï¼\n\n`BrowserRouter`æ˜¯ä¾èµ–äºä¸¤ä¸ªåº“ï¼šåˆ†åˆ«ä¸º`history`å’Œ`react-router`ã€‚okï¼Œæˆ‘ä»¬ä¸€æ¢ç©¶ç«Ÿã€‚\n\n## react-router\n\næºç é“¾æ¥ï¼šhttps://github.com/ReactTraining/react-router/blob/master/packages/react-router/modules/Router.js\n\n\n\n```javascript\nimport HistoryContext from \"./HistoryContext.js\";\nimport RouterContext from \"./RouterContext.js\";\n```\n\nè¿™ä¸¤ä¸ªä¸œè¥¿å…¶å®å¾ˆç®€å•ï¼Œéƒ½æ˜¯å¼•ç”¨äº†ä¸€ä¸ªå«åš`createContext`ï¼Œç›®çš„ä¹Ÿå¾ˆç®€å•ï¼Œè¿™é‡Œå…¶å®å°±æ˜¯åˆ›å»ºçš„æ™®é€šcontextï¼Œåªä¸è¿‡æ‹¥æœ‰ç‰¹å®šçš„åç§°è€Œå·²ã€‚æºç å¦‚ä¸‹ã€‚å°±å‡ è¡Œã€‚\n\n```javascript\n// TODO: Replace with React.createContext once we can assume React 16+\nimport createContext from \"mini-create-react-context\";\n\nconst createNamedContext = name => {\n  const context = createContext();\n  context.displayName = name;\n\n  return context;\n};\n\nexport default createNamedContext;\n```\n\nOKï¼Œé‡ç‚¹æ˜¯æ¥ä¸‹æ¥ï¼ŒæŠ›å¼€contextä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨çš„ä¸œè¥¿ã€‚æˆ‘æ•´ç†ä¸€ä¸‹ã€‚\n\nå…ˆçœ‹æ„é€ å‡½æ•°\n\n### æ„é€ å‡½æ•°\n\n```javascript\nconstructor(props) {\n  super(props);\n\n  this.state = {\n    location: props.history.location\n  };\n\n  // This is a bit of a hack. We have to start listening for location\n  // changes here in the constructor in case there are any <Redirect>s\n  // on the initial render. If there are, they will replace/push when\n  // they mount and since cDM fires in children before parents, we may\n  // get a new location before the <Router> is mounted.\n  \n  // _isMounted è¡¨ç¤ºç»„ä»¶æ˜¯å¦åŠ è½½å®Œæˆ\n  this._isMounted = false;\n  // ç»„ä»¶æœªåŠ è½½å®Œæ¯•ï¼Œä½†æ˜¯ location å‘ç”Ÿçš„å˜åŒ–ï¼Œæš‚å­˜åœ¨ _pendingLocation å­—æ®µä¸­\n  this._pendingLocation = null;\n\n  // æ²¡æœ‰ staticContext å±æ€§ï¼Œè¡¨ç¤ºæ˜¯ HashRouter æˆ–æ˜¯ BrowserRouter\n  if (!props.staticContext) {\n    this.unlisten = props.history.listen(location => {\n      if (this._isMounted) {\n        // ç»„ä»¶åŠ è½½å®Œæ¯•ï¼Œå°†å˜åŒ–çš„ location æ–¹æ³• state ä¸­\n        this.setState({ location });\n      } else {\n        this._pendingLocation = location;\n      }\n    });\n  }\n}\n```\n\næœ‰ä¸¤ä¸ªå€¼â˜`_isMounted`å’Œ`_pendingLocation`\n\nåˆ†åˆ«æ˜¯  æ˜¯å¦æŒ‚è½½   å¾…å®š\n\nå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªlocationï¼Œé»˜è®¤å€¼æ˜¯ç”±å¤–é¢ä¼ å…¥çš„historyï¼Œæˆ‘æ‰¾åˆ°ä¼ å…¥çš„åœ°æ–¹ã€‚\n\nå…¶å®å°±æ˜¯ä¹‹å‰çœ‹åˆ°çš„`BrowserRouter`\n\n```javascript\nimport React from \"react\";\nimport { Router } from \"react-router\";\nimport { createBrowserHistory as createHistory } from \"history\";\n\nclass BrowserRouter extends React.Component {\n  history = createHistory(this.props);\n\n  render() {\n    return <Router history={this.history} children={this.props.children} />;\n  }\n}\n```\n\nä¸éš¾å‘ç°ï¼Œhistoryçš„é»˜è®¤å€¼å°±æ˜¯ç”±historyè¿™ä¸ªåº“æ¥æä¾›çš„ï¼Œè¿™ä¸ªåé¢ä¼šæåˆ°ï¼Œæˆ‘ä»¬ç»§ç»­çœ‹ã€‚\n\nå…ˆç®€å•çœ‹ä¸€ä¸‹æ³¨é‡Šçš„ç¿»è¯‘(è°·æ­Œç¿»è¯‘)\n\n> è¿™æœ‰ç‚¹hackã€‚ æˆ‘ä»¬å¿…é¡»å¼€å§‹åœ¨æ„é€ å‡½æ•°ä¸­ç›‘å¬ä½ç½®æ›´æ”¹ï¼Œä»¥é˜²åˆå§‹æ¸²æŸ“ä¸­å­˜åœ¨ä»»ä½•<Redirect>ã€‚ å¦‚æœæœ‰çš„è¯ï¼Œå®ƒä»¬å°†åœ¨å®‰è£…æ—¶æ›¿æ¢/æ¨åŠ¨ï¼Œå¹¶ä¸”ç”±äºcDMåœ¨çˆ¶çº§ä¹‹å‰åœ¨å­çº§ä¸­è§¦å‘ï¼Œå› æ­¤åœ¨å®‰è£…<Router>ä¹‹å‰ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šè·å¾—ä¸€ä¸ªæ–°ä½ç½®ã€‚ \n\nä»€ä¹ˆæ„æ€å‘¢ï¼Œæˆ‘ç®€å•æè¿°ä¸€ä¸‹ï¼š\n\n> å› ä¸ºå­ç»„ä»¶ä¼šæ¯”çˆ¶ç»„ä»¶æ›´æ—©æ¸²æŸ“å®Œæˆ, ä»¥åŠ`<Redirect>`çš„å­˜åœ¨, è‹¥æ˜¯åœ¨`<Router>`çš„`componentDidMount`ç”Ÿå‘½å‘¨æœŸä¸­å¯¹`history.location`è¿›è¡Œç›‘å¬, åˆ™æœ‰å¯èƒ½åœ¨ç›‘å¬äº‹ä»¶æ³¨å†Œä¹‹å‰, `history.location`å·²ç»ç”±äº`<Redirect>`å‘ç”Ÿäº†å¤šæ¬¡æ”¹å˜, å› æ­¤æˆ‘ä»¬éœ€è¦åœ¨`<Router>`çš„`constructor`ä¸­å°±æ³¨å†Œç›‘å¬äº‹ä»¶\n\næ”¶å›æ¥ï¼Œè¿›å…¥`if`ç»§ç»­çœ‹ã€‚\n\n```javascript\nthis.unlisten = props.history.listen(location => {\n  if (this._isMounted) {\n  \tthis.setState({ location });\n  } else {\n  \tthis._pendingLocation = location;\n  }\n});\n```\n\nå°±æ˜¯è°ƒç”¨äº†`history`çš„`listen`æ–¹æ³•ã€‚ä»ä»£ç ä¸­å¯ä»¥å¤§è‡´äº†è§£åˆ°å°±æ˜¯å¯¹`history`è¿›è¡Œç›‘å¬ï¼Œç„¶åè¿›è¡Œä¸€äº›æ“ä½œã€‚\n\n### componentWillUnmount\n\né‚£ä¹ˆè¿™ä¸ª`unlisten`ä»€ä¹ˆæ—¶å€™æ‰§è¡Œå‘¢ï¼Ÿ\n\n```javascript\ncomponentWillUnmount() {\n    if (this.unlisten) {\n      this.unlisten();\n      this._isMounted = false;\n      this._pendingLocation = null;\n    }\n  }\n```\n\nåœ¨`Router`è¿™ä¸ªç»„ä»¶å¸è½½çš„æ—¶å€™å°±æ‰§è¡Œå•¦ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå–æ¶ˆäº†å¯¹`history`çš„ç›‘å¬ã€‚\n\n### componentDidUnmount\n\nç„¶åçœ‹ä¸€ä¸‹`conponentDidMount`\n\n```javascript\ncomponentDidMount() {\n    this._isMounted = true;\n\n    if (this._pendingLocation) {\n      this.setState({ location: this._pendingLocation });\n    }\n  }\n```\n\nä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯ä¿®æ”¹ä¸€ä¸‹æ˜¯å¦æŒ‚è½½çš„å€¼ï¼Œä»¥åŠç»§ç»­ä¹‹å‰åœ¨æ„é€ å‡½æ•°é‡Œé¢çš„åˆ¤æ–­ã€‚å¦‚æœæš‚å­˜æ•°æ®æœ‰çš„è¯å°±æŠŠä»–å­˜ä¸‹æ¥ã€‚\n\n### render\n\n```react\nrender() {\n    return (\n      <RouterContext.Provider\n        value={{\n          // æ ¹æ® HashRouter è¿˜æ˜¯ BrowserRouterï¼Œå¯åˆ¤æ–­ history ç±»å‹\n          history: this.props.history,\n          // è¿™ä¸ª location å°±æ˜¯ç›‘å¬ history å˜åŒ–å¾—åˆ°çš„ location\n          location: this.state.location,\n          // path url params isExact å››ä¸ªå±æ€§\n          match: Router.computeRootMatch(this.state.location.pathname),\n          // åªæœ‰ StaticRouter ä¼šä¼  staticContext\n          // HashRouter å’Œ BrowserRouter éƒ½æ˜¯ null\n          staticContext: this.props.staticContext\n        }}\n      >\n        <HistoryContext.Provider\n          children={this.props.children || null}\n          value={this.props.history}\n        />\n      </RouterContext.Provider>\n    );\n  }\n```\n\n### æ€»ç»“\n\nRouterè¿™ä¸ªç»„ä»¶ä¸»è¦å°±æ˜¯å°†ä¸€äº›æ•°æ®è¿›è¡Œå­˜å‚¨ã€‚å­˜åˆ°`Context`ï¼Œä¹‹é—´ä¸ä¹ä¸€äº›ç‰¹æ®Šæƒ…å†µçš„åˆ¤æ–­ï¼Œæ¯”å¦‚å­ç»„ä»¶æ¸²æŸ“æ¯”çˆ¶ç»„ä»¶æ—©ï¼Œä»¥åŠ`Redirect`çš„æƒ…å†µçš„å¤„ç†ã€‚åœ¨å¸è½½çš„æ—¶å€™è¦ç§»é™¤å¯¹`history`çš„ç›‘å¬ã€‚\n\nå­ç»„ä»¶ä½œä¸ºæ¶ˆè´¹è€…ï¼Œå°±å¯ä»¥å¯¹é¡µé¢è¿›è¡Œä¿®æ”¹ï¼Œè·³è½¬ï¼Œè·å–è¿™äº›æ•°å€¼ã€‚\n\n\n\n## history\n\n### createBrowserHistory\n\n#### è¿”å›çš„å†…å®¹\n\nä¹‹å‰ä¸€ç›´æœ‰ä¸æ–­æåˆ°çš„`history`ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹å®ƒæ˜¯è°\n\næºç è¿æ¥ï¼šhttps://github.com/ReactTraining/history/blob/master/packages/history/index.ts\n\næˆ‘ä»¬ä¹‹å‰ç”¨åˆ°çš„`createBrowserHistory`ï¼Œä»–å…¶å®æ˜¯è¿”å›çš„ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡é‡Œé¢æœ‰æˆ‘ä»¬å¸¸ç”¨çš„ä¸€äº›æ–¹æ³•ã€‚\n\n```javascript\nlet history: BrowserHistory = {\n    get action() {\n      return action;\n    },\n    get location() {\n      return location;\n    },\n    createHref,\n    push,\n    replace,\n    go,\n    back() {\n      go(-1);\n    },\n    forward() {\n      go(1);\n    },\n    listen(listener) {\n      return listeners.push(listener);\n    },\n    block(blocker) {\n      let unblock = blockers.push(blocker);\n\n      if (blockers.length === 1) {\n        window.addEventListener(BeforeUnloadEventType, promptBeforeUnload);\n      }\n\n      return function() {\n        unblock();\n\n        // Remove the beforeunload listener so the document may\n        // still be salvageable in the pagehide event.\n        // See https://html.spec.whatwg.org/#unloading-documents\n        if (!blockers.length) {\n          window.removeEventListener(BeforeUnloadEventType, promptBeforeUnload);\n        }\n      };\n    }\n  };\n\n  return history;\n}\n```\n\nå¤§éƒ¨åˆ†ç²¾é«“å°±æ˜¯è¿™é‡Œã€‚å‘ç°æœ‰å¤šç†Ÿæ‚‰çš„ä¼™ä¼´ï¼ => `push`ã€`replace`ã€`go`ç­‰ç­‰ã€‚æœ‰äº›å…¶å®éƒ½æ˜¯`window`æä¾›çš„ã€‚\n\næœ‰äº›ç›´æ¥çœ‹ä»£ç å°±å¯ä»¥æ˜ç™½çš„å°±ä¸è§£é‡Šäº†ï¼Œæ¯”å¦‚`forward`ï¼Œ`back`ã€‚\n\n##### go\n\næ¯”å¦‚ä¸Šé¢æåˆ°çš„`go`æ–¹æ³•ï¼Œæˆªå–éƒ¨åˆ†æºç ã€‚\n\n```typescript\nlet globalHistory = window.history;\nfunction go(delta: number) {\n    globalHistory.go(delta);\n  }\n```\n\n\n\n##### createHref\n\n```typescript\n\n// è¿”å›ä¸€ä¸ªå®Œæ•´çš„url\nexport function createPath({\n  pathname = '/',\n  search = '',\n  hash = ''\n}: PartialPath) {\n  return pathname + search + hash;\n}\n\n// è¿”å›ä¸€ä¸ªurl\nfunction createHref(to: To) {\n  \t// çœ‹ä¸Šé¢\n    return typeof to === 'string' ? to : createPath(to);\n  }\n```\n\n\n\n##### push\n\n`push`çš„æºç ï¼Œé‡Œé¢é™„å¸¦äº†ä¸€äº›ä¼šç”¨åˆ°çš„å‡½æ•°ã€‚\n\n```typescript\n// å°±æ˜¯ç®€å•å¤„ç†ä¸€ä¸‹è¿”å›å€¼ã€‚\nfunction getNextLocation(to: To, state: State = null): Location {\n  return readOnly<Location>({\n    ...location,\n    ...(typeof to === 'string' ? parsePath(to) : to),\n    state,\n    key: createKey()\n  });\n}\n\n// è¿›è¡Œåˆ¤æ–­\nfunction allowTx(action: Action, location: Location, retry: () => void) {\n    return (\n      // é•¿åº¦ä¸º0å°±è¿”å›trueï¼Œé•¿åº¦å¤§äº0å°±è°ƒç”¨å‡½æ•°ï¼Œå¹¶ä¼ å…¥å‚æ•°ã€‚è¿™ä¸ªblockersç­‰ä¸€ä¸‹ä»”ç»†æ¢è®¨ä¸€ä¸‹\n      !blockers.length || (blockers.call({ action, location, retry }), false)\n    );\n  }\n\n\n// é¡¾åæ€ä¹‰è·å–stateå’Œurl\nfunction getHistoryStateAndUrl(\n    nextLocation: Location,\n    index: number\n  ): [HistoryState, string] {\n    return [\n      {\n        usr: nextLocation.state,\n        key: nextLocation.key,\n        idx: index\n      },\n      // çœ‹ä¸Šé¢ æœ‰ä¸“é—¨ä»‹ç»\n      createHref(nextLocation)\n    ];\n  }\n\n// è¿”å›ä¸€äº›å…³äºlocationçš„ä¿¡æ¯\nfunction getIndexAndLocation(): [number, Location] {\n    let { pathname, search, hash } = window.location;\n    let state = globalHistory.state || {};\n    return [\n      state.idx,\n      readOnly<Location>({\n        pathname,\n        search,\n        hash,\n        state: state.usr || null,\n        key: state.key || 'default'\n      })\n    ];\n  }\n\n// æ‰§è¡Œlistenerså†…éƒ¨çš„ä¸€äº›å‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯è·³è½¬ï¼‰ï¼Œåé¢ä¹Ÿä¼šè¯¦ç»†è§£è¯»\nfunction applyTx(nextAction: Action) {\n    action = nextAction;\n    [index, location] = getIndexAndLocation();\n    listeners.call({ action, location });\n  }\n\n\nfunction push(to: To, state?: State) {\n  \t// è¿™é‡Œæ˜¯ä¸€ä¸ªæšä¸¾å€¼\n    let nextAction = Action.Push;\n  \t\n    let nextLocation = getNextLocation(to, state);\n  \t// é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å†æ¥ä¸€æ¬¡\n    function retry() {\n      push(to, state);\n    }\n\n    if (allowTx(nextAction, nextLocation, retry)) {\n      let [historyState, url] = getHistoryStateAndUrl(nextLocation, index + 1);\n\n      // TODO: Support forced reloading\n      // try...catch because iOS limits us to 100 pushState calls :/\n      try {\n        // MDNçš„åœ°å€: https://developer.mozilla.org/zh-CN/docs/Web/API/History/pushState\n        globalHistory.pushState(historyState, '', url);\n      } catch (error) {\n        // They are going to lose state here, but there is no real\n        // way to warn them about it since the page will refresh...\n        // MDNçš„åœ°å€: https://developer.mozilla.org/zh-CN/docs/Web/API/Location/assign\n        window.location.assign(url);\n      }\n\n      applyTx(nextAction);\n    }\n  }\n```\n\næˆ‘åœ¨æ³¨é‡Šé‡Œé¢å·²ç»è¿›è¡Œéå¸¸è¯¦ç»†çš„è§£è¯»äº†ï¼Œç”¨åˆ°çš„æ¯ä¸ªå‡½æ•°éƒ½æœ‰è§£é‡Šæˆ–è€…å®˜æ–¹æƒå¨çš„urlã€‚\n\næ€»ç»“ä¸€ä¸‹ï¼š`history.push`çš„ä¸€ä¸ªå®Œæ•´æµç¨‹\n\n- è°ƒç”¨`history.pushState`\n  - é”™è¯¯ç”±`window.location.assign`æ¥å¤„ç†\n- æ‰§è¡Œä¸€ä¸‹`listeners`é‡Œé¢çš„å‡½æ•°\n\næ˜¯çš„ï¼Œä½ æ²¡æœ‰çœ‹é”™ï¼Œå°±è¿™ä¹ˆç®€å•ï¼Œåªæ˜¯é‡Œé¢æœ‰å¾ˆå¤šè°ƒç”¨çš„å‡½æ•°ï¼Œæˆ‘éƒ½æˆªå–å‡ºæ¥ä¸€ä¸€è§£é‡Šï¼Œåšåˆ°æ¯è¡Œä»£ç éƒ½ç†è§£ï¼Œæ‰€ä»¥æ˜¾å¾—æ¯”è¾ƒé•¿ï¼Œæ¦‚æ‹¬æ¥è¯´å°±æ˜¯è¿™ä¹ˆç®€å•ã€‚\n\né‡ç‚¹æ¥çœ‹ä¸€ä¸‹`listen`å’Œè¢«è°ƒç”¨çš„`createBrowserHistory`\n\n##### replace\n\nè¿™é‡Œé¢ç”¨çš„å‡½æ•°ï¼Œåœ¨å‰é¢çš„pushéƒ½æœ‰è§£æï¼Œå¯ä»¥å¾€ä¸Šé¢å»æ‰¾æ‰¾ï¼Œå°±ä¸å¤šèµ˜è¿°äº†ã€‚\n\n```typescript\nfunction replace(to: To, state?: State) {\n    let nextAction = Action.Replace;\n    let nextLocation = getNextLocation(to, state);\n    function retry() {\n      replace(to, state);\n    }\n\n    if (allowTx(nextAction, nextLocation, retry)) {\n      let [historyState, url] = getHistoryStateAndUrl(nextLocation, index);\n\n      // TODO: Support forced reloading\n      globalHistory.replaceState(historyState, '', url);\n\n      applyTx(nextAction);\n    }\n  }\n```\n\n\n\n##### listen\n\nåœ¨`history`è¿”å›çš„`listen`æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°æˆ‘ä»¬ä¹‹å‰åœ¨react-routerçš„æºç ä¸­å‘ç°ï¼Œä»–æ˜¯åœ¨æ„é€ å‡½æ•°å’Œå¸è½½çš„æ—¶å€™ä¼šç”¨åˆ°ã€‚\n\n```javascript\nlisten(listener) {\n      return listeners.push(listener);\n    },\n```\n\nä»”ç»†çœ‹çœ‹ï¼Œè¿™ä¸ª`listeners`æ˜¯åœ¨åšäº›ä»€ä¹ˆã€‚\n\n##### createEvents\n\nè¿™ä¸ªå‡½æ•°åé¢çš„blockersä¹Ÿä¼šç”¨åˆ°\n\n```typescript\nlet listeners = createEvents<Listener>();\n\nfunction createEvents<F extends Function>(): Events<F> {\n  let handlers: F[] = [];\n\n  return {\n    get length() {\n      return handlers.length;\n    },\n    push(fn: F) {\n      handlers.push(fn);\n      return function() {\n        handlers = handlers.filter(handler => handler !== fn);\n      };\n    },\n    call(arg) {\n      handlers.forEach(fn => fn && fn(arg));\n    }\n  };\n}\n```\n\nè¿™ä¸ªæ–¹æ³•ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯åˆ›å»ºäº‹ä»¶ã€‚å®šä¹‰äº†ä¸€ä¸ªå˜é‡ `handlers` æ•°ç»„ï¼Œç”¨äºå­˜æ”¾è¦å¤„ç†çš„å›è°ƒå‡½æ•°äº‹ä»¶ã€‚\n\nç„¶åè¿”å›äº†ä¸€ä¸ªå¯¹è±¡ã€‚\n\n`push` æ–¹æ³•å°±æ˜¯å¾€ `handlers` ä¸­æ·»åŠ è¦æ‰§è¡Œçš„å‡½æ•°ã€‚\n\nè¿™å—ä¸»è¦åœ¨ `history.listen()` ä¸­ä½¿ç”¨ï¼Œå¯ä»¥ç¿»åˆ°å¼€å¤´çœ‹ä¸‹ `history` ä¸­è¿”å›äº† `listen()` æ–¹æ³•ï¼Œå°±æ˜¯è°ƒç”¨äº†`listeners.push(listener)` ã€‚\n\næœ€å `call()` æ–¹æ³•å°±æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œå°±æ˜¯å–å‡º `handlers` é‡Œé¢çš„å›è°ƒå‡½æ•°å¹¶é€ä¸ªæ‰§è¡Œã€‚\n\næ€»ç»“ä¸€ä¸‹ï¼Œå°±æ˜¯å­˜å‚¨ä¸€ä¸‹`push`è¿›æ¥çš„å‡½æ•°ï¼Œå¹¶è¿›è¡Œè¿‡æ»¤ã€‚ä¹‹åè°ƒç”¨çš„æ—¶å€™ä¼šä¾æ¬¡æ‰§è¡Œã€‚`length`å°±æ˜¯å½“å‰æ‹¥æœ‰çš„å‡½æ•°æ•°é‡ã€‚\n\nå†åˆ‡å›å»ï¼Œå°±ä¼šå‘ç°ï¼Œæ¯æ¬¡è°ƒç”¨è¿™ä¸ª`listen`å°±ç›¸å½“äº`push`ä¸€ä¸ªå‡½æ•°åˆ°å†…éƒ¨çš„ä¸€ä¸ªå˜é‡`handlers`ä¸­ã€‚\n\n##### block\n\nå’Œ`listeners`ä¸€æ ·ï¼Œä¹Ÿæ˜¯ç”¨`createEvents`åˆ›å»ºçš„ï¼Œå°±ä¸å¤šè¯´å•¦ã€‚è¯´ä¸€ä¸‹å“ªé‡Œä¼šç”¨åˆ°è¿™ä¸ªå§ã€‚\n\n```typescript\nlet blockers = createEvents<Blocker>();\n```\n\n- `block(prompt)` - (function) Prevents navigation (see [the history docs](https://github.com/ReactTraining/history/blob/master/docs/blocking-transitions.md))\n\nè¿™ä¸ªæ˜¯`react-router`å®˜ç½‘çš„è§£é‡Šã€‚\n\næˆ‘è¿™é‡Œç®€å•æ¦‚æ‹¬ä¸€ä¸‹ï¼Œå°±æ˜¯ç”¨äºå…³é—­æˆ–è€…å›é€€æµè§ˆå™¨çš„è¯¯æ“ä½œä¼šç”¨åˆ°çš„ã€‚è¯¦ç»†çš„å¯ä»¥çœ‹ç‚¹å‡»è¿›å»æŸ¥çœ‹ã€‚\n\n##### æ€»ç»“\n\nè‡³æ­¤ï¼Œæˆ‘ä»¬è°ƒç”¨çš„`createBrowserHistory`æ‰€è¿”å›çš„ä¸€äº›å±æ€§çš„æºç éƒ½å·²ç»äº†å¦‚æŒ‡æŒäº†ã€‚ä½†æ˜¯å…·ä½“æ˜¯æ€ä¹ˆå·¥ä½œè¿˜æ˜¯ä¸€çŸ¥åŠè§£ã€‚\n\n#### å…·ä½“æ ¸å¿ƒåŸç†\n\nå…ˆç§€ä¸€ä¸‹æºç ã€‚historyçš„æ ¸å¿ƒåŸç†å°±æ˜¯è¿™ä¸ªã€‚å…ˆåˆ«è¢«è¿™ä¹ˆå¤šè¡Œä»£ç å”¬åˆ°äº†ï¼Œå¾ˆå¤šéƒ½æ˜¯æˆ‘ä»¬åœ¨ä¹‹å‰çš„pushé‡Œé¢æœ‰è§£é‡Šçš„\n\n```typescript\nconst PopStateEventType = 'popstate';\nlet blockedPopTx: Transition | null = null;\nfunction handlePop() {\n  // å¦‚æœæœ‰\n  if (blockedPopTx) {\n    blockers.call(blockedPopTx);\n    blockedPopTx = null;\n  } else {\n    let nextAction = Action.Pop;\n    let [nextIndex, nextLocation] = getIndexAndLocation();\n\n    if (blockers.length) {\n      if (nextIndex != null) {\n        let delta = index - nextIndex;\n        if (delta) {\n          // Revert the POP\n          blockedPopTx = {\n            action: nextAction,\n            location: nextLocation,\n            retry() {\n              go(delta * -1);\n            }\n          };\n\n          go(delta);\n        }\n      } else {\n        // Trying to POP to a location with no index. We did not create\n        // this location, so we can't effectively block the navigation.\n        warning(\n          false,\n          // TODO: Write up a doc that explains our blocking strategy in\n          // detail and link to it here so people can understand better what\n          // is going on and how to avoid it.\n          `You are trying to block a POP navigation to a location that was not ` +\n          `created by the history library. The block will fail silently in ` +\n          `production, but in general you should do all navigation with the ` +\n          `history library (instead of using window.history.pushState directly) ` +\n          `to avoid this situation.`\n        );\n      }\n    } else {\n      applyTx(nextAction);\n    }\n  }\n}\n\nwindow.addEventListener(PopStateEventType, handlePop);\n```\n\né‡ç‚¹è¯´ä¸€ä¸‹`window.addEventListener(PopStateEventType, handlePop)`\n\nMDNåœ°å€ï¼šhttps://developer.mozilla.org/zh-CN/docs/Web/API/Window/popstate_event\n\nå…¶å®å°±æ˜¯ç›‘å¬è·¯ç”±çš„å˜åŒ–ç„¶åï¼Œæ‰§è¡Œå›è°ƒå‡½æ•°\n\n### createHashHistory\n\nè¿™ä¸ªå¤§ä½“ä¸Šä¸æ™®é€šè·¯ç”±ä¸€è‡´ã€‚è¿™é‡Œæˆ‘æƒ³å¼ºè°ƒä¸€äº›é—®é¢˜ã€‚\n\n> æ¯”å¦‚å“ˆå¸Œè·¯ç”±çš„é”šç‚¹é—®é¢˜ï¼Œæˆ‘è‡ªå·±å·²çŸ¥çš„å‡ ä¸ªæ–¹æ¡ˆ\n>\n> - ### [scrollIntoView](https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollIntoView)\n>\n> - ### [scrollTop](https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollTop)\n>\n> - ## [react-anchor-without-hash](https://github.com/kwzm/react-anchor-without-hash)\n\næ„Ÿå…´è¶£çš„è‡ªå·±æŸ¥è¯¢ä¸€ä¸‹ï¼Œè¿™ä¸ªä¸åœ¨æœ¬æ¬¡çš„è®¨è®ºèŒƒå›´å†…ã€‚\n\n#### å…·ä½“æ ¸å¿ƒåŸç†\n\nä¹‹å‰è¯´çš„åˆ°ï¼Œ`history`è·¯ç”±çš„æ ¸å¿ƒæ˜¯`window.addEventListener(PopStateEventType, handlePop);`\n\nè€Œå“ˆå¸Œè·¯ç”±çš„æ ¸å¿ƒä¹Ÿæ˜¯ç›‘å¬è·¯ç”±çš„å˜åŒ–ï¼Œåªæ˜¯å‚æ•°ä¸åŒã€‚\n\n```javascript\nwindow.addEventListener('hashchange',function(e){\n    /* ç›‘å¬æ”¹å˜ */\n})\n```\n\nè€Œå¯¹è·¯ç”±çš„æ”¹å˜ã€‚`history`è·¯ç”±æ˜¯ï¼š`history.pushState`ï¼Œ`history.replaceState`ã€‚\n\nå“ˆå¸Œè·¯ç”±æ˜¯ï¼š\n\n`window.location.hash`\n\né€šè¿‡`window.location.hash `å±æ€§è·å–å’Œè®¾ç½® `hash `å€¼ã€‚\n\nå…·ä½“çš„è¯å¾ˆå·®ä¸å¤šï¼Œå…³å¿ƒç»†èŠ‚çš„ä¼™ä¼´å¯ä»¥å»çœ‹å…¶æºç å“¦ã€‚\n\n# æ ¸å¿ƒAPI\n\nä¹‹å‰æˆ‘ä»¬çœ‹äº†BrowserRouterã€‚æˆ‘ä»¬å›è¿‡å¤´æ¥çœ‹çœ‹ï¼Œdemoä¸­çš„å®ä¾‹ä»£ç è¿˜æœ‰å¤šå°‘æ²¡æœ‰è§£å†³ï¼š\n\n```react\nimport React from 'react';\nimport {\n  BrowserRouter as Router,\n  Switch,\n  Route,\n  Link,\n} from \"react-router-dom\";\n\nfunction Home() {\n  return (\n    <>\n      <h1>é¦–é¡µ</h1>\n      <Link to=\"/login\">ç™»å½•</Link>\n    </>\n  )\n}\n\nfunction Login() {\n  return (\n    <>\n      <h1>ç™»å½•é¡µ</h1>\n      <Link to=\"/\">å›é¦–é¡µ</Link>\n    </>\n  );\n}\n\nfunction App() {\n  return (\n    <Router>\n      <Switch>\n        <Route path=\"/login\" component={Login}/>\n        <Route path=\"/\" component={Home}/>\n      </Switch>\n    </Router>\n  );\n}\n\nexport default App;\n```\n\næˆ‘ä»¬å·²ç»çœ‹å®Œäº†`BrowserRouter`ï¼ˆ`Router`ã€‚ä¸‹é¢è¿˜æœ‰`Switch`å’Œ`Route`ã€‚\n\n## Switch\n\nå…ˆä¸Šæºç ã€‚æˆ‘æ‘˜å–æœ€æ ¸å¿ƒçš„ä¸€éƒ¨åˆ†ã€‚\n\n```react\nclass Switch extends React.Component {\n  render() {\n    return (\n      <RouterContext.Consumer>\n        {context => {\n          invariant(context, \"You should not use <Switch> outside a <Router>\");\n\n          // é»˜è®¤ä½¿ç”¨context.locationï¼Œå¦‚æœæœ‰ç‰¹æ®Šå®šåˆ¶çš„locationæ‰ä¼šä½¿ç”¨ã€‚\n          // ä¸‹é¢æœ‰ä»‹ç»\n          const location = this.props.location || context.location;\n\n          let element, match;\n\n          // We use React.Children.forEach instead of React.Children.toArray().find()\n          // here because toArray adds keys to all child elements and we do not want\n          // to trigger an unmount/remount for two <Route>s that render the same\n          // component at different URLs.\n          // React.Children.forEach å¯¹å­å…ƒç´ åšéå†\n          React.Children.forEach(this.props.children, child => {\n            // åªè¦æ‰¾åˆ°ä¸€ä¸ª matchï¼Œé‚£ä¹ˆå°±ä¸ä¼šå†è¿›æ¥äº†\n            if (match == null && React.isValidElement(child)) {\n              element = child;\n\n              // child.props.path å°±ä¸å¤šè®²äº†ï¼Œ Route çš„æ ‡å‡†å†™æ³•\n              // éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ from ä¹Ÿä¼šè¢«åŒ¹é…åˆ°\n              // ä»»ä½•ç»„ä»¶ï¼Œåªè¦åœ¨ Switch ä¸‹ï¼Œæœ‰ from å±æ€§ï¼Œå¹¶ä¸”å’Œå½“å‰è·¯å¾„åŒ¹é…ï¼Œå°±ä¼šè¢«æ¸²æŸ“\n              // fromå…·ä½“æ˜¯ç»™<Redirect>ä½¿ç”¨çš„ï¼Œåé¢ä¼šè¯´åˆ°\n              const path = child.props.path || child.props.from;\n\n              // åˆ¤æ–­ç»„ä»¶æ˜¯å¦åŒ¹é…\n              match = path\n              // ä¸‹é¢æœ‰ä¸“å±çš„ä»‹ç»è¿™ä¸ªå‡½æ•°\n                ? matchPath(location.pathname, { ...child.props, path })\n                : context.match;\n            }\n          });\n\n          return match\n            ? React.cloneElement(element, { location, computedMatch: match })\n            : null;\n        }}\n      </RouterContext.Consumer>\n    );\n  }\n}\n\n```\n\nSwitchä¸­çš„locationè¿™ä¸ªpropsæ€ä¹ˆç”¨ï¼Ÿä»€ä¹ˆç”¨ï¼Ÿ\n\n> ## æ‘˜è‡ªå®˜ç½‘\n>\n> ## [location: object](https://reactrouter.com/web/api/Switch/location-object)\n>\n> A [`location`](https://reactrouter.com/web/api/location) object to be used for matching children elements instead of the current history location (usually the current browser URL).\n>\n> è°·æ­Œç¿»è¯‘ï¼šç”¨äºåŒ¹é…å­å…ƒç´ çš„ä½ç½®å¯¹è±¡ï¼Œè€Œä¸æ˜¯å½“å‰å†å²è®°å½•ä½ç½®ï¼ˆé€šå¸¸æ˜¯å½“å‰æµè§ˆå™¨URLï¼‰ã€‚\n\n### matchPath\n\n```javascript\nfunction matchPath(pathname, options = {}) {\n  // è§„èŒƒç»“æ„ä½“\n  // å¦‚æœ options ä¼ çš„æ˜¯ä¸ª stringï¼Œé‚£é»˜è®¤è¿™ä¸ª string ä»£è¡¨ path\n  // å¦‚æœ options ä¼ çš„æ˜¯ä¸ª æ•°ç»„ï¼Œé‚£åªè¦æœ‰ä¸€ä¸ªåŒ¹é…ï¼Œå°±è®¤ä¸ºåŒ¹é…\n  if (typeof options === \"string\" || Array.isArray(options)) {\n    options = { path: options };\n  }\n\n  const { path, exact = false, strict = false, sensitive = false } = options;\n\n  // è½¬åŒ–æˆæ•°ç»„è¿›è¡Œåˆ¤æ–­\n  const paths = [].concat(path);\n\n  // éƒ½æ˜¯å¾ˆç®€å•çš„å†…å®¹ï¼Œéš¾ç‚¹å°±åœ¨è¿™ä¸ªreduceï¼Œè¿™ä¸ªå¾ˆæœ‰æ„æ€ï¼Œæ„Ÿå…´è¶£æˆ–è€…ä¸äº†è§£çš„èµ¶ç´§å»MDNäº†è§£ä¸€ä¸‹ï¼ï¼ï¼\n  return paths.reduce((matched, path) => {\n    if (!path && path !== \"\") return null;\n    // åªè¦æœ‰ä¸€ä¸ª matchï¼Œç›´æ¥è¿”å›ï¼Œè®¤ä¸ºæ˜¯ match\n    if (matched) return matched;\n\n    // regexp æ˜¯æ­£åˆ™è¡¨è¾¾å¼\n    // keys æ˜¯åˆ‡å‰²å‡ºæ¥çš„å¾— key çš„å€¼\n    const { regexp, keys } = compilePath(path, {\n      end: exact,\n      strict,\n      sensitive\n    });\n    // exec() è¯¥æ–¹æ³•å¦‚æœæ‰¾åˆ°äº†åŒ¹é…çš„æ–‡æœ¬çš„è¯ï¼Œåˆ™ä¼šè¿”å›ä¸€ä¸ªç»“æœæ•°ç»„ï¼Œå¦åˆ™çš„è¯ï¼Œä¼šè¿”å›ä¸€ä¸ª\n    const match = regexp.exec(pathname);\n    /* åŒ¹é…ä¸æˆåŠŸï¼Œè¿”å›null */\n    if (!match) return null;\n\n    // url è¡¨ç¤ºåŒ¹é…åˆ°çš„éƒ¨åˆ†\n    const [url, ...values] = match;\n    // pathname === url è¡¨ç¤ºå®Œå…¨åŒ¹é…\n    const isExact = pathname === url;\n\n    if (exact && !isExact) return null;\n\n    return {\n      path, // the path used to match\n      url: path === \"/\" && url === \"\" ? \"/\" : url, // the matched portion of the URL\n      isExact, // whether or not we matched exactly\n      params: keys.reduce((memo, key, index) => {\n        memo[key.name] = values[index];\n        return memo;\n      }, {})\n    };\n  }, null);\n}\n```\n\nmatchPath å‡½æ•°ä¹Ÿæ˜¯ç”± react-router export å‡ºå»çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ¥è·å¾—æŸä¸ª url ä¸­çš„æŒ‡å®šçš„å‚æ•°ã€‚\n\n\n\n## Route\n\nRoute æ˜¯ç”¨äºå£°æ˜è·¯ç”±æ˜ å°„åˆ°åº”ç”¨ç¨‹åºçš„ç»„ä»¶å±‚ã€‚\n\nRoute æœ‰ä¸‰ç§æ¸²æŸ“çš„æ–¹æ³•ï¼Œå½“ç„¶ï¼Œéƒ½é…ç½®çš„è¯åªæœ‰ä¸€ä¸ªä¼šç”Ÿæ•ˆï¼Œä¼˜å…ˆçº§æ˜¯ children > component > render\n\n\\1. <Route component>\n\\2. <Route render>\n\\3. <Route children>\n\næ¯ä¸ªåœ¨ä¸åŒçš„æƒ…å†µä¸‹éƒ½æœ‰ç”¨ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¼šä½¿ç”¨ componentã€‚\n\n### component\n\ncomponent è¡¨ç¤ºåªæœ‰å½“ä½ç½®åŒ¹é…æ—¶æ‰ä¼šæ¸²æŸ“çš„ React ç»„ä»¶ã€‚ä½¿ç”¨ componentï¼ˆè€Œä¸æ˜¯ render æˆ– children ï¼‰Route ä½¿ç”¨ä»ç»™å®šç»„ä»¶ React.createElement(element, props) åˆ›å»ºæ–°çš„ React elementã€‚è¿™æ„å‘³ç€ï¼Œä½¿ç”¨ component åˆ›å»ºçš„ç»„ä»¶èƒ½è·å¾— router ä¸­çš„ propsã€‚\n\n### children\n\nä»æºç ä¸­å¯ä»¥çœ‹å‡ºï¼Œchildren çš„ä¼˜å…ˆçº§æ˜¯é«˜äº componentï¼Œè€Œä¸”å¯ä»¥æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œchildren æ²¡æœ‰è·å¾— router çš„ propsã€‚\n\nchildren æœ‰ä¸€ä¸ªéå¸¸ç‰¹æ®Šçš„åœ°æ–¹åœ¨äºï¼Œå½“è·¯ç”±ä¸åŒ¹é…ä¸” children æ˜¯ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œ children æ–¹æ³•ï¼Œè¿™å°±ç»™äº†è®¾è®¡å¾ˆå¤§çš„çµæ´»æ€§ã€‚\n\n### render\n\nrender å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¼˜å…ˆçº§æ˜¯æœ€ä½çš„ï¼Œå½“åŒ¹é…æˆåŠŸçš„æ—¶å€™ï¼Œæ‰§è¡Œè¿™ä¸ªå‡½æ•°ã€‚\n\n### exact & strict & sensitive\n\nè¿™ä¸‰è€…éƒ½æ˜¯ä½¿ç”¨ path-to-regexp åšè·¯å¾„åŒ¹é…éœ€è¦çš„ä¸‰ä¸ªå‚æ•°ã€‚\n\n1. exact: å¦‚æœä¸º trueï¼Œåˆ™åªæœ‰åœ¨è·¯å¾„å®Œå…¨åŒ¹é… location.pathname æ—¶æ‰åŒ¹é…ã€‚\n2. strict: åœ¨ç¡®å®šä¸ºä½ç½®æ˜¯å¦ä¸å½“å‰ URL åŒ¹é…æ—¶ï¼Œå°†è€ƒè™‘ä½ç½® pathname åçš„æ–œçº¿ã€‚\n3. sensitive: å¦‚æœè·¯å¾„åŒºåˆ†å¤§å°å†™ï¼Œåˆ™ä¸º true ï¼Œåˆ™åŒ¹é…ã€‚\n\n### location\n\nRoute å…ƒç´ å°è¯•å…¶åŒ¹é… path åˆ°å½“å‰æµè§ˆå™¨ URLï¼Œä½†æ˜¯ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ location å®ç°ä¸å½“å‰æµè§ˆå™¨ä½ç½®ä»¥å¤–çš„ä½ç½®ç›¸åŒ¹é…ã€‚\n\nä¸‹é¢åˆ—å‡º Route æºç ï¼Œå¹¶ä¸”åˆ å»äº† dev éƒ¨åˆ†ã€‚\n\n```js\nimport React from \"react\";\nimport { isValidElementType } from \"react-is\";\nimport PropTypes from \"prop-types\";\nimport invariant from \"tiny-invariant\";\nimport warning from \"tiny-warning\";\n\nimport RouterContext from \"./RouterContext.js\";\nimport matchPath from \"./matchPath.js\";\n\n/**\n * The public API for matching a single path and rendering.\n */\nclass Route extends React.Component {\n  render() {\n    return (\n      <RouterContext.Consumer>\n        {context => {\n          invariant(context, \"You should not use <Route> outside a <Router>\");\n\n          // å¯ä»¥çœ‹å‡ºï¼Œç”¨æˆ·ä¼ çš„ location è¦†ç›–æ‰äº† context ä¸­çš„ location\n          const location = this.props.location || context.location;\n\n          // å¦‚æœæœ‰ computedMatch å°±ç”¨ computedMatch ä½œä¸ºç»“æœ\n          // å¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ¤æ–­æ˜¯å¦æœ‰ path ä¼ å‚\n          // matchPath æ˜¯è°ƒç”¨ path-to-regexp åˆ¤æ–­æ˜¯å¦åŒ¹é…\n          // path-to-regexp éœ€è¦ä¸‰ä¸ªå‚æ•°\n          // exact: å¦‚æœä¸º trueï¼Œåˆ™åªæœ‰åœ¨è·¯å¾„å®Œå…¨åŒ¹é… location.pathname æ—¶æ‰åŒ¹é…\n          // strict: å¦‚æœä¸º true å½“çœŸå®çš„è·¯å¾„å…·æœ‰ä¸€ä¸ªæ–œçº¿å°†åªåŒ¹é…ä¸€ä¸ªæ–œçº¿location.pathname\n          // sensitive: å¦‚æœè·¯å¾„åŒºåˆ†å¤§å°å†™ï¼Œåˆ™ä¸º true ï¼Œåˆ™åŒ¹é…\n          const match = this.props.computedMatch\n            ? this.props.computedMatch // <Switch> already computed the match for us\n            : this.props.path\n            ? matchPath(location.pathname, this.props)\n            : context.match;\n\n          // props å°±æ˜¯æ›´æ–°åçš„ context\n          // location åšäº†æ›´æ–°ï¼ˆæœ‰å¯èƒ½æ˜¯ç”¨æˆ·ä¼ å…¥çš„locationï¼‰\n          // match åšäº†æ›´æ–°\n          const props = { ...context, location, match };\n\n          // ä¸‰ç§æ¸²æŸ“æ–¹å¼\n          let { children, component, render } = this.props;\n\n          // Preact uses an empty array as children by\n          // default, so use null if that's the case.\n          // children é»˜è®¤æ˜¯ä¸ªç©ºæ•°ç»„ï¼Œå¦‚æœæ˜¯é»˜è®¤æƒ…å†µï¼Œç½®ä¸º null\n          if (Array.isArray(children) && children.length === 0) {\n            children = null;\n          }\n\n          return (\n            // RouterContext ä¸­æ›´æ–°äº† location, match\n            <RouterContext.Provider value={props}>\n              {props.match\n              // é¦–å…ˆåˆ¤æ–­çš„æ˜¯æœ‰æ—  children\n                ? children\n                  // å¦‚æœ children æ˜¯ä¸ªå‡½æ•°ï¼Œæ‰§è¡Œï¼Œå¦åˆ™ç›´æ¥è¿”å› children\n                  ? typeof children === \"function\"\n                  : children(props)\n                  : children\n                  // å¦‚æœæ²¡æœ‰ childrenï¼Œåˆ¤æ–­æœ‰æ—  component\n                : component\n                  // æœ‰ componentï¼Œé‡æ–°æ–°å»ºä¸€ä¸ª component\n                  ? React.createElement(component, props)\n                  // æ²¡æœ‰ componentï¼Œåˆ¤æ–­æœ‰æ—  render\n                  : render\n                  // æœ‰ renderï¼Œæ‰§è¡Œ render æ–¹æ³•\n                  ? render(props)\n                  // æ²¡æœ‰è¿”å› null\n                  : null\n\n                // è¿™é‡Œæ˜¯ä¸ match çš„æƒ…å†µï¼Œåˆ¤æ–­ children æ˜¯å¦å‡½æ•°\n                : typeof children === \"function\"\n                // æ˜¯çš„è¯æ‰§è¡Œ\n                ? children(props)\n                : null}\n            </RouterContext.Provider>\n          );\n        }}\n      </RouterContext.Consumer>\n    );\n  }\n}\n\nexport default Route;\n```\n\nRoute ç»„ä»¶æ ¹æ®è‡ªèº«çš„ä¼ å‚ï¼Œå¯¹ä¸Šå±‚ RouterContext ä¸­çš„éƒ¨åˆ†å±æ€§ï¼ˆlocation å’Œ matchï¼‰è¿›è¡Œäº†æ›´æ–°ï¼Œå¹¶ä¸”å¦‚æœå½“å‰è·¯å¾„å’Œé…ç½®çš„ path è·¯å¾„ matchï¼Œåˆ™æ¸²æŸ“è¯¥ç»„ä»¶ï¼Œæ¸²æŸ“çš„æ–¹å¼æœ‰ childrenï¼Œcomponentï¼Œrender ä¸‰ç§æ–¹å¼ï¼Œæˆ‘ä»¬æœ€å¸¸ç”¨çš„å°±æ˜¯ component æ–¹å¼ï¼Œæ³¨æ„æ¯ç§æ–¹å¼çš„åŒºåˆ«ã€‚\n\n## Prompt\n\nPrompt ç”¨äºè·¯ç”±åˆ‡æ¢æç¤ºã€‚è¿™åœ¨æŸäº›åœºæ™¯ä¸‹æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œæ¯”å¦‚ç”¨æˆ·åœ¨æŸä¸ªé¡µé¢ä¿®æ”¹æ•°æ®ï¼Œç¦»å¼€æ—¶ï¼Œæç¤ºç”¨æˆ·æ˜¯å¦ä¿å­˜ï¼ŒPrompt ç»„ä»¶æœ‰ä¿©ä¸ªå±æ€§ï¼š\n\n1. messageï¼šç”¨äºæ˜¾ç¤ºæç¤ºçš„æ–‡æœ¬ä¿¡æ¯ã€‚\n2. whenï¼šä¼ é€’å¸ƒå°”å€¼ï¼Œç›¸å½“äºæ ‡ç­¾çš„å¼€å…³ï¼Œé»˜è®¤æ˜¯ trueï¼Œè®¾ç½®æˆ false æ—¶ï¼Œå¤±æ•ˆã€‚\n\nPrompt çš„æœ¬è´¨æ˜¯åœ¨ when ä¸º true çš„æ—¶å€™ï¼Œè°ƒç”¨ context.history.block æ–¹æ³•ï¼Œä¸ºå…¨å±€æ³¨å†Œè·¯ç”±ç›‘å¬ï¼Œblock çš„åŸç†çœ‹ä¹‹å‰çš„ history ç›¸å…³æ–‡ç« ã€‚è·¯æœ‰å˜åŒ–çš„æ—¶å€™ï¼Œé»˜è®¤ä½¿ç”¨ window.confirm è¿›è¡Œç¡®è®¤ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ confirm çš„å½¢å¼ï¼Œå°±æ˜¯åœ¨ BrowserRouter æˆ–è€… HashRouter ä¼ å…¥ getUserConfirmation è¿™ä¸ªå‚æ•°ï¼Œä¼šæ›¿æ¢æ‰ window.confirmã€‚\n\n```react\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport invariant from \"tiny-invariant\";\n\nimport Lifecycle from \"./Lifecycle.js\";\nimport RouterContext from \"./RouterContext.js\";\n\n/**\n * The public API for prompting the user before navigating away from a screen.\n */\nfunction Prompt({ message, when = true }) {\n  return (\n    <RouterContext.Consumer>\n      {context => {\n        invariant(context, \"You should not use <Prompt> outside a <Router>\");\n\n        if (!when || context.staticContext) return null;\n\n        // è°ƒç”¨äº† history.block æ–¹æ³•\n        const method = context.history.block;\n\n        return (\n          <Lifecycle\n            onMount={self => {\n              self.release = method(message);\n            }}\n            onUpdate={(self, prevProps) => {\n              if (prevProps.message !== message) {\n                self.release();\n                self.release = method(message);\n              }\n            }}\n            onUnmount={self => {\n              self.release();\n            }}\n            message={message}\n          />\n        );\n      }}\n    </RouterContext.Consumer>\n  );\n}\n\nexport default Prompt;\n```\n\n## Redirect\n\nRedirect ä¸å…¶è¯´æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œä¸å¦‚è¯´æ˜¯æœ‰ç»„ä»¶å°è£…çš„ä¸€ç»„æ–¹æ³•ï¼Œè¯¥ç»„ä»¶åœ¨ componentDidMount ç”Ÿå‘½å‘¨æœŸå†…ï¼Œé€šè¿‡è°ƒç”¨ history API è·³è½¬åˆ°åˆ°æ–°ä½ç½®ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ–°ä½ç½®å°†è¦†ç›–å†å²å †æ ˆä¸­çš„å½“å‰ä½ç½®ã€‚\n\n<Redirect to=\"/somewhere/else\"/> to è¡¨ç¤ºè¦é‡å®šå‘åˆ°çš„ç½‘å€ã€‚to ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª location å¯¹è±¡\n\n<Redirect push to=\"/somewhere/else\"/> push ä¸º true æ—¶ï¼Œé‡å®šå‘ä¼šå°†æ–°æ¡ç›®æ¨å…¥å†å²è®°å½•ï¼Œè€Œä¸æ˜¯æ›¿æ¢å½“å‰æ¡ç›®ã€‚\n\nç»“åˆ Switch å’Œ Redirect æºç çœ‹ï¼Œå¦‚æœ Redirect ä¸­æœ‰ from å±æ€§ï¼Œä¼šè¢« Switch è·å¾—ï¼Œå½“ from å’Œå½“å‰è·¯å¾„åŒ¹é…çš„æ—¶å€™ï¼Œå°±ä¼šæ¸²æŸ“ Redirect ç»„ä»¶ï¼Œæ‰§è¡Œè·³è½¬ã€‚\n\n```js\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { createLocation, locationsAreEqual } from \"history\";\nimport invariant from \"tiny-invariant\";\n\nimport Lifecycle from \"./Lifecycle.js\";\nimport RouterContext from \"./RouterContext.js\";\nimport generatePath from \"./generatePath.js\";\n\n/**\n * The public API for navigating programmatically with a component.\n */\nfunction Redirect({ computedMatch, to, push = false }) {\n  return (\n    // å•¥éƒ½æœ‰çš„å¤§å“¥ RouterContext\n    <RouterContext.Consumer>\n      {context => {\n        invariant(context, \"You should not use <Redirect> outside a <Router>\");\n\n        const { history, staticContext } = context;\n\n        // ä¸€èˆ¬æ¥è¯´ï¼ŒRedirect æ“ä½œéƒ½ä¸éœ€è¦ç•™æœ‰ historyï¼Œæ‰€ä»¥é€‰æ‹©é€‰æ‹© history.replace\n        const method = push ? history.push : history.replace;\n\n\n        const location = createLocation(\n          // computedMatch å°±æ˜¯çœ‹çœ‹ switch æœ‰æ²¡æœ‰å¤šç®¡é—²äº‹\n          computedMatch\n            ? typeof to === \"string\"\n              ? generatePath(to, computedMatch.params)\n              : {\n                  ...to,\n                  pathname: generatePath(to.pathname, computedMatch.params)\n                }\n            : to\n        );\n\n        // When rendering in a static context,\n        // set the new location immediately.\n        // staticRouter ä¸“ç”¨\n        if (staticContext) {\n          method(location);\n          return null;\n        }\n\n        return (\n          <Lifecycle\n            onMount={() => {\n              // componentDidMount çš„æ—¶å€™æ‰§è¡Œ method(location)ï¼Œä¹Ÿå°±æ˜¯ history.replace æ“ä½œ\n              method(location);\n            }}\n            onUpdate={(self, prevProps) => {\n              // componentDidUpdate æ—¶å€™åˆ¤æ–­å½“å‰ location å’Œä¸Šä¸€ä¸ª location æ˜¯å¦å‘ç”Ÿå˜åŒ–\n              // åªè¦å‘ç”Ÿå˜åŒ–ï¼Œè°ƒç”¨ method(location)\n              // ä¸€èˆ¬æ¥è®²ï¼Œåœ¨ componentDidMount çš„æ—¶å€™å°±è·³èµ°äº†ï¼Œä¸ä¼šç­‰åˆ° componentDidUpdate\n              const prevLocation = createLocation(prevProps.to);\n              if (\n                !locationsAreEqual(prevLocation, {\n                  ...location,\n                  key: prevLocation.key\n                })\n              ) {\n                method(location);\n              }\n            }}\n\n            // æ— æ•ˆ\n            to={to}\n          />\n        );\n      }}\n    </RouterContext.Consumer>\n  );\n}\n\nexport default Redirect;\n```\n\nLifecycle ä¸ render ä»»ä½•é¡µé¢ï¼Œåªæœ‰ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼ŒLifecycle æä¾›äº† onMountï¼Œ onUpdateï¼Œ onUnmount ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚\n\n```js\nimport React from \"react\";\n\nclass Lifecycle extends React.Component {\n  componentDidMount() {\n    if (this.props.onMount) this.props.onMount.call(this, this);\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.onUpdate) this.props.onUpdate.call(this, this, prevProps);\n  }\n\n  componentWillUnmount() {\n    if (this.props.onUnmount) this.props.onUnmount.call(this, this);\n  }\n\n  render() {\n    return null;\n  }\n}\n\nexport default Lifecycle;\n```\n\n# æ€»ç»“\n\næ•´ä¸ª`react-router`æ˜¯ç”±`createBrowserHistory`æˆ–è€…`createHashHistory`æ¥ç‰µå¤´ï¼Œä¸æˆ‘ä»¬çš„`React`ç»„ä»¶ç»‘å®šåœ¨ä¸€èµ·ï¼Œç„¶åä¼ é€’äº†ä¸€äº›å±äº`history`è¿™ä¸ªåº“çš„æ–¹æ³•ä»¥åŠæ•°å€¼ã€‚å½“ç„¶ï¼Œè¿˜æœ‰è·¯ç”±çš„åŒ¹é…å’Œæ¸²æŸ“ã€‚\n\nåœ¨`history`è¿™ä¸ªåº“é‡Œé¢åˆæœ‰å¯¹äºè·¯ç”±çš„ç›‘å¬ï¼Œæ”¹å˜ç­‰ç­‰ã€‚\n\n## æµç¨‹\n\nä»¥`history`æ¨¡å¼åšå‚è€ƒï¼ˆä¹Ÿæ˜¯æˆ‘ä»¬é‡ç‚¹é˜…è¯»çš„ã€‚\n\n### ä¿®æ”¹url\n\nå½“`url`æ”¹å˜çš„æ—¶å€™ï¼Œä¼šè§¦å‘å†™åœ¨`window`ä¸Šé¢çš„ç›‘å¬`window.addEventListener('popstate', handlePop)`ã€‚\n\nè°ƒç”¨äº†æˆ‘ä»¬çš„å‡½æ•°`handlePop`\n\nå‡½æ•°å†…éƒ¨æˆ‘ä»¬`setState`ï¼Œä¿®æ”¹äº†`location`ï¼Œæ–¹ä¾¿ä¼ é€’æ­£ç¡®çš„å€¼ä¸‹å»ï¼Œå¹¶é€šè¿‡äº†`Switch`æ‰¾å‡ºåŒ¹é…çš„`Route`ç»„ä»¶ã€‚\n\nè§¦å‘äº†ç»„ä»¶çš„æ¸²æŸ“ã€‚\n\n> å½“ç„¶ä¹ŸåŒ…æ‹¬æˆ‘ä»¬æ‰€è°“çš„history.pushï¼Œhistory.repalceç­‰ç­‰è¿™äº›æ–¹æ³•ï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¿®æ”¹urlï¼Œç„¶åå°±æ˜¯é‡å¤ä¸Šé¢çš„æ­¥éª¤\n\n\n\n\n\n\n\n","slug":"ã€é‡è¯†å‰ç«¯ã€‘React-Routeræºç é˜…è¯»","published":1,"updated":"2021-06-27T07:33:14.178Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra860018lwrdeqypcfqk","content":"<h1 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h1><p>æ­¤å¤„ä»‹ç»ä¸€ä¸‹React-Routerçš„æ ¸å¿ƒåŸç†ã€‚ç‰¹åˆ«ç»†è‡´çš„æ ‡ç‚¹ç¬¦å·çš„ä¸äºˆè®¨è®ºã€‚</p>\n<h1 id=\"å­¦å‰å°çŸ¥è¯†\"><a href=\"#å­¦å‰å°çŸ¥è¯†\" class=\"headerlink\" title=\"å­¦å‰å°çŸ¥è¯†\"></a>å­¦å‰å°çŸ¥è¯†</h1><p><code>React-Router</code>å…¶å®æœ€æ ¸å¿ƒçš„ä¸œè¥¿æ˜¯<code>Route</code>ç»„ä»¶å’Œç”±ç»Ÿä¸€ä½œè€…å¼€å‘çš„<code>History</code>åº“æ¥å»ºç«‹çš„ã€‚æ¥ä¸‹æ¥è·Ÿç€é•œå¤´ä¸€èµ·èµ°è¿›ç¥ç§˜çš„<code>ÃŸReact-Router</code>ä¸–ç•Œå§ã€‚</p>\n<p>å·²ç»çŸ¥é“æ€ä¹ˆä½¿ç”¨çš„ç›´æ¥è·³è¿‡ï¼Œåˆ°ä¸‹é¢çš„æºç åˆ†æå»â”—|ï½€Oâ€²|â”› å—·~~</p>\n<h1 id=\"ç®€å•ç¤ºä¾‹\"><a href=\"#ç®€å•ç¤ºä¾‹\" class=\"headerlink\" title=\"ç®€å•ç¤ºä¾‹\"></a>ç®€å•ç¤ºä¾‹</h1><p>ä¸€èµ·å»ºä¸€ä¸ªç®€å•çš„ç¤ºä¾‹å§ã€‚å…ˆç”¨<code>react</code>å®˜ç½‘çš„<code>create-react-app</code>è„šæ‰‹æ¶å¼„ä¸ª<code>react</code>å‡ºæ¥ã€‚</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npx create-react-app my-app</span><br><span class=\"line\"><span class=\"built_in\">cd</span> my-app</span><br><span class=\"line\">npm start</span><br></pre></td></tr></table></figure>\n\n<p>å®‰è£…<a href=\"https://reactrouter.com/web/guides/quick-start\" target=\"_blank\" rel=\"noopener\">react-router-dom</a></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install react-router-dom</span><br></pre></td></tr></table></figure>\n\n<p>åœ¨å¤§å®¶å®‰è£…ä¹‹ä½™ï¼Œæˆ‘ç®€ç­”çš„ä»‹ç»ä¸€ä¸‹<code>react-router</code>å’Œ<code>react-router-dom</code>çš„åŒºåˆ«ã€‚</p>\n<h2 id=\"react-routerå’Œreact-router-domçš„åŒºåˆ«ã€‚\"><a href=\"#react-routerå’Œreact-router-domçš„åŒºåˆ«ã€‚\" class=\"headerlink\" title=\"react-routerå’Œreact-router-domçš„åŒºåˆ«ã€‚\"></a>react-routerå’Œreact-router-domçš„åŒºåˆ«ã€‚</h2><h3 id=\"å…ˆçœ‹æä¾›çš„API\"><a href=\"#å…ˆçœ‹æä¾›çš„API\" class=\"headerlink\" title=\"å…ˆçœ‹æä¾›çš„API\u0003\"></a>å…ˆçœ‹æä¾›çš„API\u0003</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; Switch, Route, Router &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react-router'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Swtich, Route, BrowserRouter, HashHistory, Link &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react-router-dom'</span>;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"React-router\"><a href=\"#React-router\" class=\"headerlink\" title=\"React-router\"></a>React-router</h4><p>æä¾›äº†è·¯ç”±çš„æ ¸å¿ƒapiã€‚å¦‚Routerã€Routeã€Switchç­‰ï¼Œä½†æ²¡æœ‰æä¾›æœ‰å…³domæ“ä½œè¿›è¡Œè·¯ç”±è·³è½¬çš„apiï¼›</p>\n<h4 id=\"React-router-dom\"><a href=\"#React-router-dom\" class=\"headerlink\" title=\"React-router-dom\"></a>React-router-dom</h4><p>æä¾›äº†<code>BrowserRouter</code>ã€<code>Route</code>ã€<code>Link</code>ç­‰apiï¼Œå¯ä»¥é€šè¿‡domæ“ä½œè§¦å‘äº‹ä»¶æ§åˆ¶è·¯ç”±ã€‚</p>\n<p><code>Link</code>ç»„ä»¶ï¼Œä¼šæ¸²æŸ“ä¸€ä¸ªaæ ‡ç­¾ï¼›<code>BrowserRouter</code>å’Œ<code>HashRouter</code>ç»„ä»¶ï¼Œå‰è€…ä½¿ç”¨<code>pushState</code>å’Œ<code>popState</code>äº‹ä»¶æ„å»ºè·¯ç”±ï¼Œåè€…ä½¿ç”¨<code>hash</code>å’Œ <code>hashchange</code>äº‹ä»¶æ„å»ºè·¯ç”±ã€‚</p>\n<p><code>react-router-dom</code>åœ¨<code>react-router</code>çš„åŸºç¡€ä¸Šæ‰©å±•äº†å¯æ“ä½œ<code>dom</code>çš„<code>api</code>ã€‚</p>\n<p><code>Swtich</code> å’Œ <code>Route</code> éƒ½æ˜¯ä»<code>react-router</code>ä¸­å¯¼å…¥äº†ç›¸åº”çš„ç»„ä»¶å¹¶é‡æ–°å¯¼å‡ºï¼Œæ²¡åšä»€ä¹ˆç‰¹æ®Šå¤„ç†ã€‚</p>\n<p><code>react-router-dom</code>ä¸­<code>package.json</code>ä¾èµ–ä¸­å­˜åœ¨å¯¹<code>react-router</code>çš„ä¾èµ–ï¼Œæ•…æ­¤ï¼Œä¸éœ€è¦<code>npm</code>å®‰è£…<code>react-router</code>ã€‚</p>\n<blockquote>\n<ul>\n<li>å¯ç›´æ¥ npm å®‰è£… react-router-domï¼Œä½¿ç”¨å…¶apiã€‚</li>\n</ul>\n</blockquote>\n<h2 id=\"ç®€å•ä¿®æ”¹\"><a href=\"#ç®€å•ä¿®æ”¹\" class=\"headerlink\" title=\"ç®€å•ä¿®æ”¹\"></a>ç®€å•ä¿®æ”¹</h2><p>ğŸ‘Œï¼Œå¤§å®¶ğŸ”¥åº”è¯¥å·²ç»å®‰è£…å®Œäº†å§ï¼Ÿæ¥ä¸‹æ¥ç®€å•çš„ä¿®æ”¹ä¸€ä¸‹è„šæ‰‹æ¶é‡Œé¢çš„å†…å®¹ã€‚ä¸»è¦æ˜¯ä¸ºäº†ç†Ÿæ‚‰å¯¹æ‰‹ï¼ŒçŸ¥å·±çŸ¥å½¼ç™¾æˆ˜ç™¾èƒœã€‚</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/router/demo.png\"  alt=\"demo\"></p>\n<p>ä¿®æ”¹ä¸€ä¸‹<code>src/app.js</code></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123;</span><br><span class=\"line\">  BrowserRouter <span class=\"keyword\">as</span> Router,</span><br><span class=\"line\">  Switch,</span><br><span class=\"line\">  Route,</span><br><span class=\"line\">  Link,</span><br><span class=\"line\">&#125; <span class=\"keyword\">from</span> <span class=\"string\">\"react-router-dom\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Home</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    &lt;&gt;</span><br><span class=\"line\">      &lt;h1&gt;é¦–é¡µ&lt;<span class=\"regexp\">/h1&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;Link to=\"/</span>login<span class=\"string\">\"&gt;ç™»å½•&lt;/Link&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/&gt;</span></span><br><span class=\"line\"><span class=\"string\">  )</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">function Login() &#123;</span></span><br><span class=\"line\"><span class=\"string\">  return (</span></span><br><span class=\"line\"><span class=\"string\">    &lt;&gt;</span></span><br><span class=\"line\"><span class=\"string\">      &lt;h1&gt;ç™»å½•é¡µ&lt;/h1&gt;</span></span><br><span class=\"line\"><span class=\"string\">      &lt;Link to=\"</span>/<span class=\"string\">\"&gt;å›é¦–é¡µ&lt;/Link&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/&gt;</span></span><br><span class=\"line\"><span class=\"string\">  );</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">function App() &#123;</span></span><br><span class=\"line\"><span class=\"string\">  return (</span></span><br><span class=\"line\"><span class=\"string\">    &lt;Router&gt;</span></span><br><span class=\"line\"><span class=\"string\">      &lt;Switch&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;Route path=\"</span>/login<span class=\"string\">\" component=&#123;Login&#125;/&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;Route path=\"</span>/<span class=\"string\">\" component=&#123;Home&#125;/&gt;</span></span><br><span class=\"line\"><span class=\"string\">      &lt;/Switch&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/Router&gt;</span></span><br><span class=\"line\"><span class=\"string\">  );</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">export default App;</span></span><br></pre></td></tr></table></figure>\n\n<p>è¿™æ ·å°±å®Œæˆäº†ä¸€ä¸ªæœ€ç®€å•çš„ç¤ºä¾‹äº†ã€‚</p>\n<h1 id=\"SPAçš„æ ¸å¿ƒæ€æƒ³\"><a href=\"#SPAçš„æ ¸å¿ƒæ€æƒ³\" class=\"headerlink\" title=\"SPAçš„æ ¸å¿ƒæ€æƒ³\"></a>SPAçš„æ ¸å¿ƒæ€æƒ³</h1><ul>\n<li>ç›‘å¬<code>URL</code>çš„å˜åŒ–</li>\n<li>æ”¹å˜æŸäº›<code>context</code>çš„å€¼</li>\n<li>è·å–å¯¹åº”çš„é¡µé¢ç»„ä»¶</li>\n<li><code>render</code>æ–°çš„é¡µé¢</li>\n</ul>\n<h1 id=\"æºç æ”»è¯»\"><a href=\"#æºç æ”»è¯»\" class=\"headerlink\" title=\"æºç æ”»è¯»\"></a>æºç æ”»è¯»</h1><h2 id=\"BrowserRouter\"><a href=\"#BrowserRouter\" class=\"headerlink\" title=\"BrowserRouter\"></a>BrowserRouter</h2><p>ä»å‰é¢çš„ç®€å•ç¤ºä¾‹ä¸­æˆ‘ä»¬ï¼Œå‘ç°æœ‰ä¸€ä¸ªæœ€å¤–å±‚çš„ä¼™è®¡ï¼Œå«<code>BrowserRouter</code>ã€‚æˆ‘ä»¬ç›´æ¥å¹²åˆ°ä»–çš„githubæºç å»ç…ç…ã€‚</p>\n<p>é“¾æ¥ï¼š<a href=\"https://github.com/ReactTraining/react-router/blob/master/packages/react-router-dom/modules/BrowserRouter.js\" target=\"_blank\" rel=\"noopener\">https://github.com/ReactTraining/react-router/blob/master/packages/react-router-dom/modules/BrowserRouter.js</a></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">\"react\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Router &#125; <span class=\"keyword\">from</span> <span class=\"string\">\"react-router\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; createBrowserHistory <span class=\"keyword\">as</span> createHistory &#125; <span class=\"keyword\">from</span> <span class=\"string\">\"history\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> PropTypes <span class=\"keyword\">from</span> <span class=\"string\">\"prop-types\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> warning <span class=\"keyword\">from</span> <span class=\"string\">\"tiny-warning\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * The public API for a &lt;Router&gt; that uses HTML5 history.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BrowserRouter</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  history = createHistory(<span class=\"keyword\">this</span>.props);</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Router</span> <span class=\"attr\">history</span>=<span class=\"string\">&#123;this.history&#125;</span> <span class=\"attr\">children</span>=<span class=\"string\">&#123;this.props.children&#125;</span> /&gt;</span></span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (__DEV__) &#123;</span><br><span class=\"line\">  BrowserRouter.propTypes = &#123;</span><br><span class=\"line\">    basename: PropTypes.string,</span><br><span class=\"line\">    children: PropTypes.node,</span><br><span class=\"line\">    forceRefresh: PropTypes.bool,</span><br><span class=\"line\">    getUserConfirmation: PropTypes.func,</span><br><span class=\"line\">    keyLength: PropTypes.number</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  BrowserRouter.prototype.componentDidMount = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    warning(</span><br><span class=\"line\">      !<span class=\"keyword\">this</span>.props.history,</span><br><span class=\"line\">      <span class=\"string\">\"&lt;BrowserRouter&gt; ignores the history prop. To use a custom history, \"</span> +</span><br><span class=\"line\">        <span class=\"string\">\"use `import &#123; Router &#125;` instead of `import &#123; BrowserRouter as Router &#125;`.\"</span></span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> BrowserRouter;</span><br></pre></td></tr></table></figure>\n\n<p>æŠ›å¼€ä¸€äº›ä¸ƒä¸ƒå…«å…«çš„åˆ¤æ–­ã€‚é‡æ–°çœ‹ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">\"react\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Router &#125; <span class=\"keyword\">from</span> <span class=\"string\">\"react-router\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; createBrowserHistory <span class=\"keyword\">as</span> createHistory &#125; <span class=\"keyword\">from</span> <span class=\"string\">\"history\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BrowserRouter</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  history = createHistory(<span class=\"keyword\">this</span>.props);</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Router</span> <span class=\"attr\">history</span>=<span class=\"string\">&#123;this.history&#125;</span> <span class=\"attr\">children</span>=<span class=\"string\">&#123;this.props.children&#125;</span> /&gt;</span></span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å†™ç€å‡ ä¸ªå¤§å­—ï¼šã€Šç“œå­äºŒæ‰‹è½¦ã€‹ä»–åªæ˜¯ä¸€ä¸ªä¸­é—´å•†ï¼Œä»–åœ¨èµšå·®ä»·ã€‚ï¼ˆæ‰“é’±ï¼</p>\n<p><code>BrowserRouter</code>æ˜¯ä¾èµ–äºä¸¤ä¸ªåº“ï¼šåˆ†åˆ«ä¸º<code>history</code>å’Œ<code>react-router</code>ã€‚okï¼Œæˆ‘ä»¬ä¸€æ¢ç©¶ç«Ÿã€‚</p>\n<h2 id=\"react-router\"><a href=\"#react-router\" class=\"headerlink\" title=\"react-router\"></a>react-router</h2><p>æºç é“¾æ¥ï¼š<a href=\"https://github.com/ReactTraining/react-router/blob/master/packages/react-router/modules/Router.js\" target=\"_blank\" rel=\"noopener\">https://github.com/ReactTraining/react-router/blob/master/packages/react-router/modules/Router.js</a></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> HistoryContext <span class=\"keyword\">from</span> <span class=\"string\">\"./HistoryContext.js\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> RouterContext <span class=\"keyword\">from</span> <span class=\"string\">\"./RouterContext.js\"</span>;</span><br></pre></td></tr></table></figure>\n\n<p>è¿™ä¸¤ä¸ªä¸œè¥¿å…¶å®å¾ˆç®€å•ï¼Œéƒ½æ˜¯å¼•ç”¨äº†ä¸€ä¸ªå«åš<code>createContext</code>ï¼Œç›®çš„ä¹Ÿå¾ˆç®€å•ï¼Œè¿™é‡Œå…¶å®å°±æ˜¯åˆ›å»ºçš„æ™®é€šcontextï¼Œåªä¸è¿‡æ‹¥æœ‰ç‰¹å®šçš„åç§°è€Œå·²ã€‚æºç å¦‚ä¸‹ã€‚å°±å‡ è¡Œã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// <span class=\"doctag\">TODO:</span> Replace with React.createContext once we can assume React 16+</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> createContext <span class=\"keyword\">from</span> <span class=\"string\">\"mini-create-react-context\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> createNamedContext = <span class=\"function\"><span class=\"params\">name</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> context = createContext();</span><br><span class=\"line\">  context.displayName = name;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> context;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> createNamedContext;</span><br></pre></td></tr></table></figure>\n\n<p>OKï¼Œé‡ç‚¹æ˜¯æ¥ä¸‹æ¥ï¼ŒæŠ›å¼€contextä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨çš„ä¸œè¥¿ã€‚æˆ‘æ•´ç†ä¸€ä¸‹ã€‚</p>\n<p>å…ˆçœ‹æ„é€ å‡½æ•°</p>\n<h3 id=\"æ„é€ å‡½æ•°\"><a href=\"#æ„é€ å‡½æ•°\" class=\"headerlink\" title=\"æ„é€ å‡½æ•°\"></a>æ„é€ å‡½æ•°</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">constructor</span>(props) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">super</span>(props);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.state = &#123;</span><br><span class=\"line\">    location: props.history.location</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// This is a bit of a hack. We have to start listening for location</span></span><br><span class=\"line\">  <span class=\"comment\">// changes here in the constructor in case there are any &lt;Redirect&gt;s</span></span><br><span class=\"line\">  <span class=\"comment\">// on the initial render. If there are, they will replace/push when</span></span><br><span class=\"line\">  <span class=\"comment\">// they mount and since cDM fires in children before parents, we may</span></span><br><span class=\"line\">  <span class=\"comment\">// get a new location before the &lt;Router&gt; is mounted.</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// _isMounted è¡¨ç¤ºç»„ä»¶æ˜¯å¦åŠ è½½å®Œæˆ</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>._isMounted = <span class=\"literal\">false</span>;</span><br><span class=\"line\">  <span class=\"comment\">// ç»„ä»¶æœªåŠ è½½å®Œæ¯•ï¼Œä½†æ˜¯ location å‘ç”Ÿçš„å˜åŒ–ï¼Œæš‚å­˜åœ¨ _pendingLocation å­—æ®µä¸­</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>._pendingLocation = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// æ²¡æœ‰ staticContext å±æ€§ï¼Œè¡¨ç¤ºæ˜¯ HashRouter æˆ–æ˜¯ BrowserRouter</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!props.staticContext) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.unlisten = props.history.listen(<span class=\"function\"><span class=\"params\">location</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>._isMounted) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// ç»„ä»¶åŠ è½½å®Œæ¯•ï¼Œå°†å˜åŒ–çš„ location æ–¹æ³• state ä¸­</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.setState(&#123; location &#125;);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>._pendingLocation = location;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æœ‰ä¸¤ä¸ªå€¼â˜<code>_isMounted</code>å’Œ<code>_pendingLocation</code></p>\n<p>åˆ†åˆ«æ˜¯  æ˜¯å¦æŒ‚è½½   å¾…å®š</p>\n<p>å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªlocationï¼Œé»˜è®¤å€¼æ˜¯ç”±å¤–é¢ä¼ å…¥çš„historyï¼Œæˆ‘æ‰¾åˆ°ä¼ å…¥çš„åœ°æ–¹ã€‚</p>\n<p>å…¶å®å°±æ˜¯ä¹‹å‰çœ‹åˆ°çš„<code>BrowserRouter</code></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">\"react\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Router &#125; <span class=\"keyword\">from</span> <span class=\"string\">\"react-router\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; createBrowserHistory <span class=\"keyword\">as</span> createHistory &#125; <span class=\"keyword\">from</span> <span class=\"string\">\"history\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BrowserRouter</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  history = createHistory(<span class=\"keyword\">this</span>.props);</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Router</span> <span class=\"attr\">history</span>=<span class=\"string\">&#123;this.history&#125;</span> <span class=\"attr\">children</span>=<span class=\"string\">&#123;this.props.children&#125;</span> /&gt;</span></span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä¸éš¾å‘ç°ï¼Œhistoryçš„é»˜è®¤å€¼å°±æ˜¯ç”±historyè¿™ä¸ªåº“æ¥æä¾›çš„ï¼Œè¿™ä¸ªåé¢ä¼šæåˆ°ï¼Œæˆ‘ä»¬ç»§ç»­çœ‹ã€‚</p>\n<p>å…ˆç®€å•çœ‹ä¸€ä¸‹æ³¨é‡Šçš„ç¿»è¯‘(è°·æ­Œç¿»è¯‘)</p>\n<blockquote>\n<p>è¿™æœ‰ç‚¹hackã€‚ æˆ‘ä»¬å¿…é¡»å¼€å§‹åœ¨æ„é€ å‡½æ•°ä¸­ç›‘å¬ä½ç½®æ›´æ”¹ï¼Œä»¥é˜²åˆå§‹æ¸²æŸ“ä¸­å­˜åœ¨ä»»ä½•<Redirect>ã€‚ å¦‚æœæœ‰çš„è¯ï¼Œå®ƒä»¬å°†åœ¨å®‰è£…æ—¶æ›¿æ¢/æ¨åŠ¨ï¼Œå¹¶ä¸”ç”±äºcDMåœ¨çˆ¶çº§ä¹‹å‰åœ¨å­çº§ä¸­è§¦å‘ï¼Œå› æ­¤åœ¨å®‰è£…<Router>ä¹‹å‰ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šè·å¾—ä¸€ä¸ªæ–°ä½ç½®ã€‚ </p>\n</blockquote>\n<p>ä»€ä¹ˆæ„æ€å‘¢ï¼Œæˆ‘ç®€å•æè¿°ä¸€ä¸‹ï¼š</p>\n<blockquote>\n<p>å› ä¸ºå­ç»„ä»¶ä¼šæ¯”çˆ¶ç»„ä»¶æ›´æ—©æ¸²æŸ“å®Œæˆ, ä»¥åŠ<code>&lt;Redirect&gt;</code>çš„å­˜åœ¨, è‹¥æ˜¯åœ¨<code>&lt;Router&gt;</code>çš„<code>componentDidMount</code>ç”Ÿå‘½å‘¨æœŸä¸­å¯¹<code>history.location</code>è¿›è¡Œç›‘å¬, åˆ™æœ‰å¯èƒ½åœ¨ç›‘å¬äº‹ä»¶æ³¨å†Œä¹‹å‰, <code>history.location</code>å·²ç»ç”±äº<code>&lt;Redirect&gt;</code>å‘ç”Ÿäº†å¤šæ¬¡æ”¹å˜, å› æ­¤æˆ‘ä»¬éœ€è¦åœ¨<code>&lt;Router&gt;</code>çš„<code>constructor</code>ä¸­å°±æ³¨å†Œç›‘å¬äº‹ä»¶</p>\n</blockquote>\n<p>æ”¶å›æ¥ï¼Œè¿›å…¥<code>if</code>ç»§ç»­çœ‹ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">this</span>.unlisten = props.history.listen(<span class=\"function\"><span class=\"params\">location</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>._isMounted) &#123;</span><br><span class=\"line\">  \t<span class=\"keyword\">this</span>.setState(&#123; location &#125;);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">  \t<span class=\"keyword\">this</span>._pendingLocation = location;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>å°±æ˜¯è°ƒç”¨äº†<code>history</code>çš„<code>listen</code>æ–¹æ³•ã€‚ä»ä»£ç ä¸­å¯ä»¥å¤§è‡´äº†è§£åˆ°å°±æ˜¯å¯¹<code>history</code>è¿›è¡Œç›‘å¬ï¼Œç„¶åè¿›è¡Œä¸€äº›æ“ä½œã€‚</p>\n<h3 id=\"componentWillUnmount\"><a href=\"#componentWillUnmount\" class=\"headerlink\" title=\"componentWillUnmount\"></a>componentWillUnmount</h3><p>é‚£ä¹ˆè¿™ä¸ª<code>unlisten</code>ä»€ä¹ˆæ—¶å€™æ‰§è¡Œå‘¢ï¼Ÿ</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">componentWillUnmount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.unlisten) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.unlisten();</span><br><span class=\"line\">      <span class=\"keyword\">this</span>._isMounted = <span class=\"literal\">false</span>;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>._pendingLocation = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<p>åœ¨<code>Router</code>è¿™ä¸ªç»„ä»¶å¸è½½çš„æ—¶å€™å°±æ‰§è¡Œå•¦ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå–æ¶ˆäº†å¯¹<code>history</code>çš„ç›‘å¬ã€‚</p>\n<h3 id=\"componentDidUnmount\"><a href=\"#componentDidUnmount\" class=\"headerlink\" title=\"componentDidUnmount\"></a>componentDidUnmount</h3><p>ç„¶åçœ‹ä¸€ä¸‹<code>conponentDidMount</code></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">componentDidMount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>._isMounted = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>._pendingLocation) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.setState(&#123; <span class=\"attr\">location</span>: <span class=\"keyword\">this</span>._pendingLocation &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯ä¿®æ”¹ä¸€ä¸‹æ˜¯å¦æŒ‚è½½çš„å€¼ï¼Œä»¥åŠç»§ç»­ä¹‹å‰åœ¨æ„é€ å‡½æ•°é‡Œé¢çš„åˆ¤æ–­ã€‚å¦‚æœæš‚å­˜æ•°æ®æœ‰çš„è¯å°±æŠŠä»–å­˜ä¸‹æ¥ã€‚</p>\n<h3 id=\"render\"><a href=\"#render\" class=\"headerlink\" title=\"render\"></a>render</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">render() &#123;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">      &lt;RouterContext.Provider</span><br><span class=\"line\">        value&#x3D;&#123;&#123;</span><br><span class=\"line\">          &#x2F;&#x2F; æ ¹æ® HashRouter è¿˜æ˜¯ BrowserRouterï¼Œå¯åˆ¤æ–­ history ç±»å‹</span><br><span class=\"line\">          history: this.props.history,</span><br><span class=\"line\">          &#x2F;&#x2F; è¿™ä¸ª location å°±æ˜¯ç›‘å¬ history å˜åŒ–å¾—åˆ°çš„ location</span><br><span class=\"line\">          location: this.state.location,</span><br><span class=\"line\">          &#x2F;&#x2F; path url params isExact å››ä¸ªå±æ€§</span><br><span class=\"line\">          match: Router.computeRootMatch(this.state.location.pathname),</span><br><span class=\"line\">          &#x2F;&#x2F; åªæœ‰ StaticRouter ä¼šä¼  staticContext</span><br><span class=\"line\">          &#x2F;&#x2F; HashRouter å’Œ BrowserRouter éƒ½æ˜¯ null</span><br><span class=\"line\">          staticContext: this.props.staticContext</span><br><span class=\"line\">        &#125;&#125;</span><br><span class=\"line\">      &gt;</span><br><span class=\"line\">        &lt;HistoryContext.Provider</span><br><span class=\"line\">          children&#x3D;&#123;this.props.children || null&#125;</span><br><span class=\"line\">          value&#x3D;&#123;this.props.history&#125;</span><br><span class=\"line\">        &#x2F;&gt;</span><br><span class=\"line\">      &lt;&#x2F;RouterContext.Provider&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h3><p>Routerè¿™ä¸ªç»„ä»¶ä¸»è¦å°±æ˜¯å°†ä¸€äº›æ•°æ®è¿›è¡Œå­˜å‚¨ã€‚å­˜åˆ°<code>Context</code>ï¼Œä¹‹é—´ä¸ä¹ä¸€äº›ç‰¹æ®Šæƒ…å†µçš„åˆ¤æ–­ï¼Œæ¯”å¦‚å­ç»„ä»¶æ¸²æŸ“æ¯”çˆ¶ç»„ä»¶æ—©ï¼Œä»¥åŠ<code>Redirect</code>çš„æƒ…å†µçš„å¤„ç†ã€‚åœ¨å¸è½½çš„æ—¶å€™è¦ç§»é™¤å¯¹<code>history</code>çš„ç›‘å¬ã€‚</p>\n<p>å­ç»„ä»¶ä½œä¸ºæ¶ˆè´¹è€…ï¼Œå°±å¯ä»¥å¯¹é¡µé¢è¿›è¡Œä¿®æ”¹ï¼Œè·³è½¬ï¼Œè·å–è¿™äº›æ•°å€¼ã€‚</p>\n<h2 id=\"history\"><a href=\"#history\" class=\"headerlink\" title=\"history\"></a>history</h2><h3 id=\"createBrowserHistory\"><a href=\"#createBrowserHistory\" class=\"headerlink\" title=\"createBrowserHistory\"></a>createBrowserHistory</h3><h4 id=\"è¿”å›çš„å†…å®¹\"><a href=\"#è¿”å›çš„å†…å®¹\" class=\"headerlink\" title=\"è¿”å›çš„å†…å®¹\"></a>è¿”å›çš„å†…å®¹</h4><p>ä¹‹å‰ä¸€ç›´æœ‰ä¸æ–­æåˆ°çš„<code>history</code>ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹å®ƒæ˜¯è°</p>\n<p>æºç è¿æ¥ï¼š<a href=\"https://github.com/ReactTraining/history/blob/master/packages/history/index.ts\" target=\"_blank\" rel=\"noopener\">https://github.com/ReactTraining/history/blob/master/packages/history/index.ts</a></p>\n<p>æˆ‘ä»¬ä¹‹å‰ç”¨åˆ°çš„<code>createBrowserHistory</code>ï¼Œä»–å…¶å®æ˜¯è¿”å›çš„ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡é‡Œé¢æœ‰æˆ‘ä»¬å¸¸ç”¨çš„ä¸€äº›æ–¹æ³•ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> history: BrowserHistory = &#123;</span><br><span class=\"line\">    <span class=\"keyword\">get</span> action() &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> action;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"keyword\">get</span> location() &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> location;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    createHref,</span><br><span class=\"line\">    push,</span><br><span class=\"line\">    replace,</span><br><span class=\"line\">    go,</span><br><span class=\"line\">    back() &#123;</span><br><span class=\"line\">      go(<span class=\"number\">-1</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    forward() &#123;</span><br><span class=\"line\">      go(<span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    listen(listener) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> listeners.push(listener);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    block(blocker) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> unblock = blockers.push(blocker);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (blockers.length === <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">window</span>.addEventListener(BeforeUnloadEventType, promptBeforeUnload);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        unblock();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Remove the beforeunload listener so the document may</span></span><br><span class=\"line\">        <span class=\"comment\">// still be salvageable in the pagehide event.</span></span><br><span class=\"line\">        <span class=\"comment\">// See https://html.spec.whatwg.org/#unloading-documents</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!blockers.length) &#123;</span><br><span class=\"line\">          <span class=\"built_in\">window</span>.removeEventListener(BeforeUnloadEventType, promptBeforeUnload);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> history;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å¤§éƒ¨åˆ†ç²¾é«“å°±æ˜¯è¿™é‡Œã€‚å‘ç°æœ‰å¤šç†Ÿæ‚‰çš„ä¼™ä¼´ï¼ =&gt; <code>push</code>ã€<code>replace</code>ã€<code>go</code>ç­‰ç­‰ã€‚æœ‰äº›å…¶å®éƒ½æ˜¯<code>window</code>æä¾›çš„ã€‚</p>\n<p>æœ‰äº›ç›´æ¥çœ‹ä»£ç å°±å¯ä»¥æ˜ç™½çš„å°±ä¸è§£é‡Šäº†ï¼Œæ¯”å¦‚<code>forward</code>ï¼Œ<code>back</code>ã€‚</p>\n<h5 id=\"go\"><a href=\"#go\" class=\"headerlink\" title=\"go\"></a>go</h5><p>æ¯”å¦‚ä¸Šé¢æåˆ°çš„<code>go</code>æ–¹æ³•ï¼Œæˆªå–éƒ¨åˆ†æºç ã€‚</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> globalHistory = <span class=\"built_in\">window</span>.history;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">go</span>(<span class=\"params\">delta: <span class=\"built_in\">number</span></span>) </span>&#123;</span><br><span class=\"line\">    globalHistory.go(delta);</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"createHref\"><a href=\"#createHref\" class=\"headerlink\" title=\"createHref\"></a>createHref</h5><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è¿”å›ä¸€ä¸ªå®Œæ•´çš„url</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createPath</span>(<span class=\"params\">&#123;</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  pathname = '/',</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  search = '',</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  hash = ''</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">&#125;: PartialPath</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> pathname + search + hash;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è¿”å›ä¸€ä¸ªurl</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createHref</span>(<span class=\"params\">to: To</span>) </span>&#123;</span><br><span class=\"line\">  \t<span class=\"comment\">// çœ‹ä¸Šé¢</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">typeof</span> to === <span class=\"string\">'string'</span> ? to : createPath(to);</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"push\"><a href=\"#push\" class=\"headerlink\" title=\"push\"></a>push</h5><p><code>push</code>çš„æºç ï¼Œé‡Œé¢é™„å¸¦äº†ä¸€äº›ä¼šç”¨åˆ°çš„å‡½æ•°ã€‚</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// å°±æ˜¯ç®€å•å¤„ç†ä¸€ä¸‹è¿”å›å€¼ã€‚</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getNextLocation</span>(<span class=\"params\">to: To, state: State = <span class=\"literal\">null</span></span>): <span class=\"title\">Location</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> readOnly&lt;Location&gt;(&#123;</span><br><span class=\"line\">    ...location,</span><br><span class=\"line\">    ...(<span class=\"keyword\">typeof</span> to === <span class=\"string\">'string'</span> ? parsePath(to) : to),</span><br><span class=\"line\">    state,</span><br><span class=\"line\">    key: createKey()</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è¿›è¡Œåˆ¤æ–­</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">allowTx</span>(<span class=\"params\">action: Action, location: Location, retry: () =&gt; <span class=\"built_in\">void</span></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      <span class=\"comment\">// é•¿åº¦ä¸º0å°±è¿”å›trueï¼Œé•¿åº¦å¤§äº0å°±è°ƒç”¨å‡½æ•°ï¼Œå¹¶ä¼ å…¥å‚æ•°ã€‚è¿™ä¸ªblockersç­‰ä¸€ä¸‹ä»”ç»†æ¢è®¨ä¸€ä¸‹</span></span><br><span class=\"line\">      !blockers.length || (blockers.call(&#123; action, location, retry &#125;), <span class=\"literal\">false</span>)</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// é¡¾åæ€ä¹‰è·å–stateå’Œurl</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getHistoryStateAndUrl</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">    nextLocation: Location,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">    index: <span class=\"built_in\">number</span></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  </span>): [<span class=\"title\">HistoryState</span>, <span class=\"title\">string</span>] </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        usr: nextLocation.state,</span><br><span class=\"line\">        key: nextLocation.key,</span><br><span class=\"line\">        idx: index</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"comment\">// çœ‹ä¸Šé¢ æœ‰ä¸“é—¨ä»‹ç»</span></span><br><span class=\"line\">      createHref(nextLocation)</span><br><span class=\"line\">    ];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è¿”å›ä¸€äº›å…³äºlocationçš„ä¿¡æ¯</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getIndexAndLocation</span>(<span class=\"params\"></span>): [<span class=\"title\">number</span>, <span class=\"title\">Location</span>] </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> &#123; pathname, search, hash &#125; = <span class=\"built_in\">window</span>.location;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> state = globalHistory.state || &#123;&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [</span><br><span class=\"line\">      state.idx,</span><br><span class=\"line\">      readOnly&lt;Location&gt;(&#123;</span><br><span class=\"line\">        pathname,</span><br><span class=\"line\">        search,</span><br><span class=\"line\">        hash,</span><br><span class=\"line\">        state: state.usr || <span class=\"literal\">null</span>,</span><br><span class=\"line\">        key: state.key || <span class=\"string\">'default'</span></span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    ];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æ‰§è¡Œlistenerså†…éƒ¨çš„ä¸€äº›å‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯è·³è½¬ï¼‰ï¼Œåé¢ä¹Ÿä¼šè¯¦ç»†è§£è¯»</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">applyTx</span>(<span class=\"params\">nextAction: Action</span>) </span>&#123;</span><br><span class=\"line\">    action = nextAction;</span><br><span class=\"line\">    [index, location] = getIndexAndLocation();</span><br><span class=\"line\">    listeners.call(&#123; action, location &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">push</span>(<span class=\"params\">to: To, state?: State</span>) </span>&#123;</span><br><span class=\"line\">  \t<span class=\"comment\">// è¿™é‡Œæ˜¯ä¸€ä¸ªæšä¸¾å€¼</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> nextAction = Action.Push;</span><br><span class=\"line\">  \t</span><br><span class=\"line\">    <span class=\"keyword\">let</span> nextLocation = getNextLocation(to, state);</span><br><span class=\"line\">  \t<span class=\"comment\">// é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å†æ¥ä¸€æ¬¡</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">retry</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      push(to, state);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (allowTx(nextAction, nextLocation, retry)) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> [historyState, url] = getHistoryStateAndUrl(nextLocation, index + <span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// <span class=\"doctag\">TODO:</span> Support forced reloading</span></span><br><span class=\"line\">      <span class=\"comment\">// try...catch because iOS limits us to 100 pushState calls :/</span></span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// MDNçš„åœ°å€: https://developer.mozilla.org/zh-CN/docs/Web/API/History/pushState</span></span><br><span class=\"line\">        globalHistory.pushState(historyState, <span class=\"string\">''</span>, url);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// They are going to lose state here, but there is no real</span></span><br><span class=\"line\">        <span class=\"comment\">// way to warn them about it since the page will refresh...</span></span><br><span class=\"line\">        <span class=\"comment\">// MDNçš„åœ°å€: https://developer.mozilla.org/zh-CN/docs/Web/API/Location/assign</span></span><br><span class=\"line\">        <span class=\"built_in\">window</span>.location.assign(url);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      applyTx(nextAction);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<p>æˆ‘åœ¨æ³¨é‡Šé‡Œé¢å·²ç»è¿›è¡Œéå¸¸è¯¦ç»†çš„è§£è¯»äº†ï¼Œç”¨åˆ°çš„æ¯ä¸ªå‡½æ•°éƒ½æœ‰è§£é‡Šæˆ–è€…å®˜æ–¹æƒå¨çš„urlã€‚</p>\n<p>æ€»ç»“ä¸€ä¸‹ï¼š<code>history.push</code>çš„ä¸€ä¸ªå®Œæ•´æµç¨‹</p>\n<ul>\n<li>è°ƒç”¨<code>history.pushState</code><ul>\n<li>é”™è¯¯ç”±<code>window.location.assign</code>æ¥å¤„ç†</li>\n</ul>\n</li>\n<li>æ‰§è¡Œä¸€ä¸‹<code>listeners</code>é‡Œé¢çš„å‡½æ•°</li>\n</ul>\n<p>æ˜¯çš„ï¼Œä½ æ²¡æœ‰çœ‹é”™ï¼Œå°±è¿™ä¹ˆç®€å•ï¼Œåªæ˜¯é‡Œé¢æœ‰å¾ˆå¤šè°ƒç”¨çš„å‡½æ•°ï¼Œæˆ‘éƒ½æˆªå–å‡ºæ¥ä¸€ä¸€è§£é‡Šï¼Œåšåˆ°æ¯è¡Œä»£ç éƒ½ç†è§£ï¼Œæ‰€ä»¥æ˜¾å¾—æ¯”è¾ƒé•¿ï¼Œæ¦‚æ‹¬æ¥è¯´å°±æ˜¯è¿™ä¹ˆç®€å•ã€‚</p>\n<p>é‡ç‚¹æ¥çœ‹ä¸€ä¸‹<code>listen</code>å’Œè¢«è°ƒç”¨çš„<code>createBrowserHistory</code></p>\n<h5 id=\"replace\"><a href=\"#replace\" class=\"headerlink\" title=\"replace\"></a>replace</h5><p>è¿™é‡Œé¢ç”¨çš„å‡½æ•°ï¼Œåœ¨å‰é¢çš„pushéƒ½æœ‰è§£æï¼Œå¯ä»¥å¾€ä¸Šé¢å»æ‰¾æ‰¾ï¼Œå°±ä¸å¤šèµ˜è¿°äº†ã€‚</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">replace</span>(<span class=\"params\">to: To, state?: State</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> nextAction = Action.Replace;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> nextLocation = getNextLocation(to, state);</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">retry</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      replace(to, state);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (allowTx(nextAction, nextLocation, retry)) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> [historyState, url] = getHistoryStateAndUrl(nextLocation, index);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// <span class=\"doctag\">TODO:</span> Support forced reloading</span></span><br><span class=\"line\">      globalHistory.replaceState(historyState, <span class=\"string\">''</span>, url);</span><br><span class=\"line\"></span><br><span class=\"line\">      applyTx(nextAction);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"listen\"><a href=\"#listen\" class=\"headerlink\" title=\"listen\"></a>listen</h5><p>åœ¨<code>history</code>è¿”å›çš„<code>listen</code>æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°æˆ‘ä»¬ä¹‹å‰åœ¨react-routerçš„æºç ä¸­å‘ç°ï¼Œä»–æ˜¯åœ¨æ„é€ å‡½æ•°å’Œå¸è½½çš„æ—¶å€™ä¼šç”¨åˆ°ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">listen(listener) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> listeners.push(listener);</span><br><span class=\"line\">    &#125;,</span><br></pre></td></tr></table></figure>\n\n<p>ä»”ç»†çœ‹çœ‹ï¼Œè¿™ä¸ª<code>listeners</code>æ˜¯åœ¨åšäº›ä»€ä¹ˆã€‚</p>\n<h5 id=\"createEvents\"><a href=\"#createEvents\" class=\"headerlink\" title=\"createEvents\"></a>createEvents</h5><p>è¿™ä¸ªå‡½æ•°åé¢çš„blockersä¹Ÿä¼šç”¨åˆ°</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> listeners = createEvents&lt;Listener&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createEvents</span>&lt;<span class=\"title\">F</span> <span class=\"title\">extends</span> <span class=\"title\">Function</span>&gt;(<span class=\"params\"></span>): <span class=\"title\">Events</span>&lt;<span class=\"title\">F</span>&gt; </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> handlers: F[] = [];</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">get</span> length() &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> handlers.length;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    push(fn: F) &#123;</span><br><span class=\"line\">      handlers.push(fn);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        handlers = handlers.filter(<span class=\"function\"><span class=\"params\">handler</span> =&gt;</span> handler !== fn);</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    call(arg) &#123;</span><br><span class=\"line\">      handlers.forEach(<span class=\"function\"><span class=\"params\">fn</span> =&gt;</span> fn &amp;&amp; fn(arg));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>è¿™ä¸ªæ–¹æ³•ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯åˆ›å»ºäº‹ä»¶ã€‚å®šä¹‰äº†ä¸€ä¸ªå˜é‡ <code>handlers</code> æ•°ç»„ï¼Œç”¨äºå­˜æ”¾è¦å¤„ç†çš„å›è°ƒå‡½æ•°äº‹ä»¶ã€‚</p>\n<p>ç„¶åè¿”å›äº†ä¸€ä¸ªå¯¹è±¡ã€‚</p>\n<p><code>push</code> æ–¹æ³•å°±æ˜¯å¾€ <code>handlers</code> ä¸­æ·»åŠ è¦æ‰§è¡Œçš„å‡½æ•°ã€‚</p>\n<p>è¿™å—ä¸»è¦åœ¨ <code>history.listen()</code> ä¸­ä½¿ç”¨ï¼Œå¯ä»¥ç¿»åˆ°å¼€å¤´çœ‹ä¸‹ <code>history</code> ä¸­è¿”å›äº† <code>listen()</code> æ–¹æ³•ï¼Œå°±æ˜¯è°ƒç”¨äº†<code>listeners.push(listener)</code> ã€‚</p>\n<p>æœ€å <code>call()</code> æ–¹æ³•å°±æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œå°±æ˜¯å–å‡º <code>handlers</code> é‡Œé¢çš„å›è°ƒå‡½æ•°å¹¶é€ä¸ªæ‰§è¡Œã€‚</p>\n<p>æ€»ç»“ä¸€ä¸‹ï¼Œå°±æ˜¯å­˜å‚¨ä¸€ä¸‹<code>push</code>è¿›æ¥çš„å‡½æ•°ï¼Œå¹¶è¿›è¡Œè¿‡æ»¤ã€‚ä¹‹åè°ƒç”¨çš„æ—¶å€™ä¼šä¾æ¬¡æ‰§è¡Œã€‚<code>length</code>å°±æ˜¯å½“å‰æ‹¥æœ‰çš„å‡½æ•°æ•°é‡ã€‚</p>\n<p>å†åˆ‡å›å»ï¼Œå°±ä¼šå‘ç°ï¼Œæ¯æ¬¡è°ƒç”¨è¿™ä¸ª<code>listen</code>å°±ç›¸å½“äº<code>push</code>ä¸€ä¸ªå‡½æ•°åˆ°å†…éƒ¨çš„ä¸€ä¸ªå˜é‡<code>handlers</code>ä¸­ã€‚</p>\n<h5 id=\"block\"><a href=\"#block\" class=\"headerlink\" title=\"block\"></a>block</h5><p>å’Œ<code>listeners</code>ä¸€æ ·ï¼Œä¹Ÿæ˜¯ç”¨<code>createEvents</code>åˆ›å»ºçš„ï¼Œå°±ä¸å¤šè¯´å•¦ã€‚è¯´ä¸€ä¸‹å“ªé‡Œä¼šç”¨åˆ°è¿™ä¸ªå§ã€‚</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> blockers = createEvents&lt;Blocker&gt;();</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><code>block(prompt)</code> - (function) Prevents navigation (see <a href=\"https://github.com/ReactTraining/history/blob/master/docs/blocking-transitions.md\" target=\"_blank\" rel=\"noopener\">the history docs</a>)</li>\n</ul>\n<p>è¿™ä¸ªæ˜¯<code>react-router</code>å®˜ç½‘çš„è§£é‡Šã€‚</p>\n<p>æˆ‘è¿™é‡Œç®€å•æ¦‚æ‹¬ä¸€ä¸‹ï¼Œå°±æ˜¯ç”¨äºå…³é—­æˆ–è€…å›é€€æµè§ˆå™¨çš„è¯¯æ“ä½œä¼šç”¨åˆ°çš„ã€‚è¯¦ç»†çš„å¯ä»¥çœ‹ç‚¹å‡»è¿›å»æŸ¥çœ‹ã€‚</p>\n<h5 id=\"æ€»ç»“-1\"><a href=\"#æ€»ç»“-1\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h5><p>è‡³æ­¤ï¼Œæˆ‘ä»¬è°ƒç”¨çš„<code>createBrowserHistory</code>æ‰€è¿”å›çš„ä¸€äº›å±æ€§çš„æºç éƒ½å·²ç»äº†å¦‚æŒ‡æŒäº†ã€‚ä½†æ˜¯å…·ä½“æ˜¯æ€ä¹ˆå·¥ä½œè¿˜æ˜¯ä¸€çŸ¥åŠè§£ã€‚</p>\n<h4 id=\"å…·ä½“æ ¸å¿ƒåŸç†\"><a href=\"#å…·ä½“æ ¸å¿ƒåŸç†\" class=\"headerlink\" title=\"å…·ä½“æ ¸å¿ƒåŸç†\"></a>å…·ä½“æ ¸å¿ƒåŸç†</h4><p>å…ˆç§€ä¸€ä¸‹æºç ã€‚historyçš„æ ¸å¿ƒåŸç†å°±æ˜¯è¿™ä¸ªã€‚å…ˆåˆ«è¢«è¿™ä¹ˆå¤šè¡Œä»£ç å”¬åˆ°äº†ï¼Œå¾ˆå¤šéƒ½æ˜¯æˆ‘ä»¬åœ¨ä¹‹å‰çš„pushé‡Œé¢æœ‰è§£é‡Šçš„</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> PopStateEventType = <span class=\"string\">'popstate'</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> blockedPopTx: Transition | <span class=\"literal\">null</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handlePop</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœæœ‰</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (blockedPopTx) &#123;</span><br><span class=\"line\">    blockers.call(blockedPopTx);</span><br><span class=\"line\">    blockedPopTx = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> nextAction = Action.Pop;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> [nextIndex, nextLocation] = getIndexAndLocation();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (blockers.length) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (nextIndex != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> delta = index - nextIndex;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (delta) &#123;</span><br><span class=\"line\">          <span class=\"comment\">// Revert the POP</span></span><br><span class=\"line\">          blockedPopTx = &#123;</span><br><span class=\"line\">            action: nextAction,</span><br><span class=\"line\">            location: nextLocation,</span><br><span class=\"line\">            retry() &#123;</span><br><span class=\"line\">              go(delta * <span class=\"number\">-1</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">          go(delta);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Trying to POP to a location with no index. We did not create</span></span><br><span class=\"line\">        <span class=\"comment\">// this location, so we can't effectively block the navigation.</span></span><br><span class=\"line\">        warning(</span><br><span class=\"line\">          <span class=\"literal\">false</span>,</span><br><span class=\"line\">          <span class=\"comment\">// <span class=\"doctag\">TODO:</span> Write up a doc that explains our blocking strategy in</span></span><br><span class=\"line\">          <span class=\"comment\">// detail and link to it here so people can understand better what</span></span><br><span class=\"line\">          <span class=\"comment\">// is going on and how to avoid it.</span></span><br><span class=\"line\">          <span class=\"string\">`You are trying to block a POP navigation to a location that was not `</span> +</span><br><span class=\"line\">          <span class=\"string\">`created by the history library. The block will fail silently in `</span> +</span><br><span class=\"line\">          <span class=\"string\">`production, but in general you should do all navigation with the `</span> +</span><br><span class=\"line\">          <span class=\"string\">`history library (instead of using window.history.pushState directly) `</span> +</span><br><span class=\"line\">          <span class=\"string\">`to avoid this situation.`</span></span><br><span class=\"line\">        );</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      applyTx(nextAction);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">window</span>.addEventListener(PopStateEventType, handlePop);</span><br></pre></td></tr></table></figure>\n\n<p>é‡ç‚¹è¯´ä¸€ä¸‹<code>window.addEventListener(PopStateEventType, handlePop)</code></p>\n<p>MDNåœ°å€ï¼š<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Window/popstate_event\" target=\"_blank\" rel=\"noopener\">https://developer.mozilla.org/zh-CN/docs/Web/API/Window/popstate_event</a></p>\n<p>å…¶å®å°±æ˜¯ç›‘å¬è·¯ç”±çš„å˜åŒ–ç„¶åï¼Œæ‰§è¡Œå›è°ƒå‡½æ•°</p>\n<h3 id=\"createHashHistory\"><a href=\"#createHashHistory\" class=\"headerlink\" title=\"createHashHistory\"></a>createHashHistory</h3><p>è¿™ä¸ªå¤§ä½“ä¸Šä¸æ™®é€šè·¯ç”±ä¸€è‡´ã€‚è¿™é‡Œæˆ‘æƒ³å¼ºè°ƒä¸€äº›é—®é¢˜ã€‚</p>\n<blockquote>\n<p>æ¯”å¦‚å“ˆå¸Œè·¯ç”±çš„é”šç‚¹é—®é¢˜ï¼Œæˆ‘è‡ªå·±å·²çŸ¥çš„å‡ ä¸ªæ–¹æ¡ˆ</p>\n<ul>\n<li><h3 id=\"scrollIntoView\"><a href=\"#scrollIntoView\" class=\"headerlink\" title=\"scrollIntoView\"></a><a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollIntoView\" target=\"_blank\" rel=\"noopener\">scrollIntoView</a></h3></li>\n<li><h3 id=\"scrollTop\"><a href=\"#scrollTop\" class=\"headerlink\" title=\"scrollTop\"></a><a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollTop\" target=\"_blank\" rel=\"noopener\">scrollTop</a></h3></li>\n<li><h2 id=\"react-anchor-without-hash\"><a href=\"#react-anchor-without-hash\" class=\"headerlink\" title=\"react-anchor-without-hash\"></a><a href=\"https://github.com/kwzm/react-anchor-without-hash\" target=\"_blank\" rel=\"noopener\">react-anchor-without-hash</a></h2></li>\n</ul>\n</blockquote>\n<p>æ„Ÿå…´è¶£çš„è‡ªå·±æŸ¥è¯¢ä¸€ä¸‹ï¼Œè¿™ä¸ªä¸åœ¨æœ¬æ¬¡çš„è®¨è®ºèŒƒå›´å†…ã€‚</p>\n<h4 id=\"å…·ä½“æ ¸å¿ƒåŸç†-1\"><a href=\"#å…·ä½“æ ¸å¿ƒåŸç†-1\" class=\"headerlink\" title=\"å…·ä½“æ ¸å¿ƒåŸç†\"></a>å…·ä½“æ ¸å¿ƒåŸç†</h4><p>ä¹‹å‰è¯´çš„åˆ°ï¼Œ<code>history</code>è·¯ç”±çš„æ ¸å¿ƒæ˜¯<code>window.addEventListener(PopStateEventType, handlePop);</code></p>\n<p>è€Œå“ˆå¸Œè·¯ç”±çš„æ ¸å¿ƒä¹Ÿæ˜¯ç›‘å¬è·¯ç”±çš„å˜åŒ–ï¼Œåªæ˜¯å‚æ•°ä¸åŒã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.addEventListener(<span class=\"string\">'hashchange'</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/* ç›‘å¬æ”¹å˜ */</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>è€Œå¯¹è·¯ç”±çš„æ”¹å˜ã€‚<code>history</code>è·¯ç”±æ˜¯ï¼š<code>history.pushState</code>ï¼Œ<code>history.replaceState</code>ã€‚</p>\n<p>å“ˆå¸Œè·¯ç”±æ˜¯ï¼š</p>\n<p><code>window.location.hash</code></p>\n<p>é€šè¿‡<code>window.location.hash</code>å±æ€§è·å–å’Œè®¾ç½® <code>hash</code>å€¼ã€‚</p>\n<p>å…·ä½“çš„è¯å¾ˆå·®ä¸å¤šï¼Œå…³å¿ƒç»†èŠ‚çš„ä¼™ä¼´å¯ä»¥å»çœ‹å…¶æºç å“¦ã€‚</p>\n<h1 id=\"æ ¸å¿ƒAPI\"><a href=\"#æ ¸å¿ƒAPI\" class=\"headerlink\" title=\"æ ¸å¿ƒAPI\"></a>æ ¸å¿ƒAPI</h1><p>ä¹‹å‰æˆ‘ä»¬çœ‹äº†BrowserRouterã€‚æˆ‘ä»¬å›è¿‡å¤´æ¥çœ‹çœ‹ï¼Œdemoä¸­çš„å®ä¾‹ä»£ç è¿˜æœ‰å¤šå°‘æ²¡æœ‰è§£å†³ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import React from &#39;react&#39;;</span><br><span class=\"line\">import &#123;</span><br><span class=\"line\">  BrowserRouter as Router,</span><br><span class=\"line\">  Switch,</span><br><span class=\"line\">  Route,</span><br><span class=\"line\">  Link,</span><br><span class=\"line\">&#125; from &quot;react-router-dom&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">function Home() &#123;</span><br><span class=\"line\">  return (</span><br><span class=\"line\">    &lt;&gt;</span><br><span class=\"line\">      &lt;h1&gt;é¦–é¡µ&lt;&#x2F;h1&gt;</span><br><span class=\"line\">      &lt;Link to&#x3D;&quot;&#x2F;login&quot;&gt;ç™»å½•&lt;&#x2F;Link&gt;</span><br><span class=\"line\">    &lt;&#x2F;&gt;</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function Login() &#123;</span><br><span class=\"line\">  return (</span><br><span class=\"line\">    &lt;&gt;</span><br><span class=\"line\">      &lt;h1&gt;ç™»å½•é¡µ&lt;&#x2F;h1&gt;</span><br><span class=\"line\">      &lt;Link to&#x3D;&quot;&#x2F;&quot;&gt;å›é¦–é¡µ&lt;&#x2F;Link&gt;</span><br><span class=\"line\">    &lt;&#x2F;&gt;</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function App() &#123;</span><br><span class=\"line\">  return (</span><br><span class=\"line\">    &lt;Router&gt;</span><br><span class=\"line\">      &lt;Switch&gt;</span><br><span class=\"line\">        &lt;Route path&#x3D;&quot;&#x2F;login&quot; component&#x3D;&#123;Login&#125;&#x2F;&gt;</span><br><span class=\"line\">        &lt;Route path&#x3D;&quot;&#x2F;&quot; component&#x3D;&#123;Home&#125;&#x2F;&gt;</span><br><span class=\"line\">      &lt;&#x2F;Switch&gt;</span><br><span class=\"line\">    &lt;&#x2F;Router&gt;</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default App;</span><br></pre></td></tr></table></figure>\n\n<p>æˆ‘ä»¬å·²ç»çœ‹å®Œäº†<code>BrowserRouter</code>ï¼ˆ<code>Router</code>ã€‚ä¸‹é¢è¿˜æœ‰<code>Switch</code>å’Œ<code>Route</code>ã€‚</p>\n<h2 id=\"Switch\"><a href=\"#Switch\" class=\"headerlink\" title=\"Switch\"></a>Switch</h2><p>å…ˆä¸Šæºç ã€‚æˆ‘æ‘˜å–æœ€æ ¸å¿ƒçš„ä¸€éƒ¨åˆ†ã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Switch extends React.Component &#123;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">      &lt;RouterContext.Consumer&gt;</span><br><span class=\"line\">        &#123;context &#x3D;&gt; &#123;</span><br><span class=\"line\">          invariant(context, &quot;You should not use &lt;Switch&gt; outside a &lt;Router&gt;&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">          &#x2F;&#x2F; é»˜è®¤ä½¿ç”¨context.locationï¼Œå¦‚æœæœ‰ç‰¹æ®Šå®šåˆ¶çš„locationæ‰ä¼šä½¿ç”¨ã€‚</span><br><span class=\"line\">          &#x2F;&#x2F; ä¸‹é¢æœ‰ä»‹ç»</span><br><span class=\"line\">          const location &#x3D; this.props.location || context.location;</span><br><span class=\"line\"></span><br><span class=\"line\">          let element, match;</span><br><span class=\"line\"></span><br><span class=\"line\">          &#x2F;&#x2F; We use React.Children.forEach instead of React.Children.toArray().find()</span><br><span class=\"line\">          &#x2F;&#x2F; here because toArray adds keys to all child elements and we do not want</span><br><span class=\"line\">          &#x2F;&#x2F; to trigger an unmount&#x2F;remount for two &lt;Route&gt;s that render the same</span><br><span class=\"line\">          &#x2F;&#x2F; component at different URLs.</span><br><span class=\"line\">          &#x2F;&#x2F; React.Children.forEach å¯¹å­å…ƒç´ åšéå†</span><br><span class=\"line\">          React.Children.forEach(this.props.children, child &#x3D;&gt; &#123;</span><br><span class=\"line\">            &#x2F;&#x2F; åªè¦æ‰¾åˆ°ä¸€ä¸ª matchï¼Œé‚£ä¹ˆå°±ä¸ä¼šå†è¿›æ¥äº†</span><br><span class=\"line\">            if (match &#x3D;&#x3D; null &amp;&amp; React.isValidElement(child)) &#123;</span><br><span class=\"line\">              element &#x3D; child;</span><br><span class=\"line\"></span><br><span class=\"line\">              &#x2F;&#x2F; child.props.path å°±ä¸å¤šè®²äº†ï¼Œ Route çš„æ ‡å‡†å†™æ³•</span><br><span class=\"line\">              &#x2F;&#x2F; éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ from ä¹Ÿä¼šè¢«åŒ¹é…åˆ°</span><br><span class=\"line\">              &#x2F;&#x2F; ä»»ä½•ç»„ä»¶ï¼Œåªè¦åœ¨ Switch ä¸‹ï¼Œæœ‰ from å±æ€§ï¼Œå¹¶ä¸”å’Œå½“å‰è·¯å¾„åŒ¹é…ï¼Œå°±ä¼šè¢«æ¸²æŸ“</span><br><span class=\"line\">              &#x2F;&#x2F; fromå…·ä½“æ˜¯ç»™&lt;Redirect&gt;ä½¿ç”¨çš„ï¼Œåé¢ä¼šè¯´åˆ°</span><br><span class=\"line\">              const path &#x3D; child.props.path || child.props.from;</span><br><span class=\"line\"></span><br><span class=\"line\">              &#x2F;&#x2F; åˆ¤æ–­ç»„ä»¶æ˜¯å¦åŒ¹é…</span><br><span class=\"line\">              match &#x3D; path</span><br><span class=\"line\">              &#x2F;&#x2F; ä¸‹é¢æœ‰ä¸“å±çš„ä»‹ç»è¿™ä¸ªå‡½æ•°</span><br><span class=\"line\">                ? matchPath(location.pathname, &#123; ...child.props, path &#125;)</span><br><span class=\"line\">                : context.match;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">          return match</span><br><span class=\"line\">            ? React.cloneElement(element, &#123; location, computedMatch: match &#125;)</span><br><span class=\"line\">            : null;</span><br><span class=\"line\">        &#125;&#125;</span><br><span class=\"line\">      &lt;&#x2F;RouterContext.Consumer&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Switchä¸­çš„locationè¿™ä¸ªpropsæ€ä¹ˆç”¨ï¼Ÿä»€ä¹ˆç”¨ï¼Ÿ</p>\n<blockquote>\n<h2 id=\"æ‘˜è‡ªå®˜ç½‘\"><a href=\"#æ‘˜è‡ªå®˜ç½‘\" class=\"headerlink\" title=\"æ‘˜è‡ªå®˜ç½‘\"></a>æ‘˜è‡ªå®˜ç½‘</h2><h2 id=\"location-object\"><a href=\"#location-object\" class=\"headerlink\" title=\"location: object\"></a><a href=\"https://reactrouter.com/web/api/Switch/location-object\" target=\"_blank\" rel=\"noopener\">location: object</a></h2><p>A <a href=\"https://reactrouter.com/web/api/location\" target=\"_blank\" rel=\"noopener\"><code>location</code></a> object to be used for matching children elements instead of the current history location (usually the current browser URL).</p>\n<p>è°·æ­Œç¿»è¯‘ï¼šç”¨äºåŒ¹é…å­å…ƒç´ çš„ä½ç½®å¯¹è±¡ï¼Œè€Œä¸æ˜¯å½“å‰å†å²è®°å½•ä½ç½®ï¼ˆé€šå¸¸æ˜¯å½“å‰æµè§ˆå™¨URLï¼‰ã€‚</p>\n</blockquote>\n<h3 id=\"matchPath\"><a href=\"#matchPath\" class=\"headerlink\" title=\"matchPath\"></a>matchPath</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">matchPath</span>(<span class=\"params\">pathname, options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// è§„èŒƒç»“æ„ä½“</span></span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœ options ä¼ çš„æ˜¯ä¸ª stringï¼Œé‚£é»˜è®¤è¿™ä¸ª string ä»£è¡¨ path</span></span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœ options ä¼ çš„æ˜¯ä¸ª æ•°ç»„ï¼Œé‚£åªè¦æœ‰ä¸€ä¸ªåŒ¹é…ï¼Œå°±è®¤ä¸ºåŒ¹é…</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> options === <span class=\"string\">\"string\"</span> || <span class=\"built_in\">Array</span>.isArray(options)) &#123;</span><br><span class=\"line\">    options = &#123; <span class=\"attr\">path</span>: options &#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> &#123; path, exact = <span class=\"literal\">false</span>, strict = <span class=\"literal\">false</span>, sensitive = <span class=\"literal\">false</span> &#125; = options;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// è½¬åŒ–æˆæ•°ç»„è¿›è¡Œåˆ¤æ–­</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> paths = [].concat(path);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// éƒ½æ˜¯å¾ˆç®€å•çš„å†…å®¹ï¼Œéš¾ç‚¹å°±åœ¨è¿™ä¸ªreduceï¼Œè¿™ä¸ªå¾ˆæœ‰æ„æ€ï¼Œæ„Ÿå…´è¶£æˆ–è€…ä¸äº†è§£çš„èµ¶ç´§å»MDNäº†è§£ä¸€ä¸‹ï¼ï¼ï¼</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> paths.reduce(<span class=\"function\">(<span class=\"params\">matched, path</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!path &amp;&amp; path !== <span class=\"string\">\"\"</span>) <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"comment\">// åªè¦æœ‰ä¸€ä¸ª matchï¼Œç›´æ¥è¿”å›ï¼Œè®¤ä¸ºæ˜¯ match</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (matched) <span class=\"keyword\">return</span> matched;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// regexp æ˜¯æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class=\"line\">    <span class=\"comment\">// keys æ˜¯åˆ‡å‰²å‡ºæ¥çš„å¾— key çš„å€¼</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; regexp, keys &#125; = compilePath(path, &#123;</span><br><span class=\"line\">      end: exact,</span><br><span class=\"line\">      strict,</span><br><span class=\"line\">      sensitive</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"comment\">// exec() è¯¥æ–¹æ³•å¦‚æœæ‰¾åˆ°äº†åŒ¹é…çš„æ–‡æœ¬çš„è¯ï¼Œåˆ™ä¼šè¿”å›ä¸€ä¸ªç»“æœæ•°ç»„ï¼Œå¦åˆ™çš„è¯ï¼Œä¼šè¿”å›ä¸€ä¸ª</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> match = regexp.exec(pathname);</span><br><span class=\"line\">    <span class=\"comment\">/* åŒ¹é…ä¸æˆåŠŸï¼Œè¿”å›null */</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!match) <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// url è¡¨ç¤ºåŒ¹é…åˆ°çš„éƒ¨åˆ†</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> [url, ...values] = match;</span><br><span class=\"line\">    <span class=\"comment\">// pathname === url è¡¨ç¤ºå®Œå…¨åŒ¹é…</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> isExact = pathname === url;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (exact &amp;&amp; !isExact) <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      path, <span class=\"comment\">// the path used to match</span></span><br><span class=\"line\">      url: path === <span class=\"string\">\"/\"</span> &amp;&amp; url === <span class=\"string\">\"\"</span> ? <span class=\"string\">\"/\"</span> : url, <span class=\"comment\">// the matched portion of the URL</span></span><br><span class=\"line\">      isExact, <span class=\"comment\">// whether or not we matched exactly</span></span><br><span class=\"line\">      params: keys.reduce(<span class=\"function\">(<span class=\"params\">memo, key, index</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        memo[key.name] = values[index];</span><br><span class=\"line\">        <span class=\"keyword\">return</span> memo;</span><br><span class=\"line\">      &#125;, &#123;&#125;)</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;, <span class=\"literal\">null</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>matchPath å‡½æ•°ä¹Ÿæ˜¯ç”± react-router export å‡ºå»çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ¥è·å¾—æŸä¸ª url ä¸­çš„æŒ‡å®šçš„å‚æ•°ã€‚</p>\n<h2 id=\"Route\"><a href=\"#Route\" class=\"headerlink\" title=\"Route\"></a>Route</h2><p>Route æ˜¯ç”¨äºå£°æ˜è·¯ç”±æ˜ å°„åˆ°åº”ç”¨ç¨‹åºçš„ç»„ä»¶å±‚ã€‚</p>\n<p>Route æœ‰ä¸‰ç§æ¸²æŸ“çš„æ–¹æ³•ï¼Œå½“ç„¶ï¼Œéƒ½é…ç½®çš„è¯åªæœ‰ä¸€ä¸ªä¼šç”Ÿæ•ˆï¼Œä¼˜å…ˆçº§æ˜¯ children &gt; component &gt; render</p>\n<p>\\1. <Route component><br>\\2. <Route render><br>\\3. <Route children></p>\n<p>æ¯ä¸ªåœ¨ä¸åŒçš„æƒ…å†µä¸‹éƒ½æœ‰ç”¨ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¼šä½¿ç”¨ componentã€‚</p>\n<h3 id=\"component\"><a href=\"#component\" class=\"headerlink\" title=\"component\"></a>component</h3><p>component è¡¨ç¤ºåªæœ‰å½“ä½ç½®åŒ¹é…æ—¶æ‰ä¼šæ¸²æŸ“çš„ React ç»„ä»¶ã€‚ä½¿ç”¨ componentï¼ˆè€Œä¸æ˜¯ render æˆ– children ï¼‰Route ä½¿ç”¨ä»ç»™å®šç»„ä»¶ React.createElement(element, props) åˆ›å»ºæ–°çš„ React elementã€‚è¿™æ„å‘³ç€ï¼Œä½¿ç”¨ component åˆ›å»ºçš„ç»„ä»¶èƒ½è·å¾— router ä¸­çš„ propsã€‚</p>\n<h3 id=\"children\"><a href=\"#children\" class=\"headerlink\" title=\"children\"></a>children</h3><p>ä»æºç ä¸­å¯ä»¥çœ‹å‡ºï¼Œchildren çš„ä¼˜å…ˆçº§æ˜¯é«˜äº componentï¼Œè€Œä¸”å¯ä»¥æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œchildren æ²¡æœ‰è·å¾— router çš„ propsã€‚</p>\n<p>children æœ‰ä¸€ä¸ªéå¸¸ç‰¹æ®Šçš„åœ°æ–¹åœ¨äºï¼Œå½“è·¯ç”±ä¸åŒ¹é…ä¸” children æ˜¯ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œ children æ–¹æ³•ï¼Œè¿™å°±ç»™äº†è®¾è®¡å¾ˆå¤§çš„çµæ´»æ€§ã€‚</p>\n<h3 id=\"render-1\"><a href=\"#render-1\" class=\"headerlink\" title=\"render\"></a>render</h3><p>render å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¼˜å…ˆçº§æ˜¯æœ€ä½çš„ï¼Œå½“åŒ¹é…æˆåŠŸçš„æ—¶å€™ï¼Œæ‰§è¡Œè¿™ä¸ªå‡½æ•°ã€‚</p>\n<h3 id=\"exact-amp-strict-amp-sensitive\"><a href=\"#exact-amp-strict-amp-sensitive\" class=\"headerlink\" title=\"exact &amp; strict &amp; sensitive\"></a>exact &amp; strict &amp; sensitive</h3><p>è¿™ä¸‰è€…éƒ½æ˜¯ä½¿ç”¨ path-to-regexp åšè·¯å¾„åŒ¹é…éœ€è¦çš„ä¸‰ä¸ªå‚æ•°ã€‚</p>\n<ol>\n<li>exact: å¦‚æœä¸º trueï¼Œåˆ™åªæœ‰åœ¨è·¯å¾„å®Œå…¨åŒ¹é… location.pathname æ—¶æ‰åŒ¹é…ã€‚</li>\n<li>strict: åœ¨ç¡®å®šä¸ºä½ç½®æ˜¯å¦ä¸å½“å‰ URL åŒ¹é…æ—¶ï¼Œå°†è€ƒè™‘ä½ç½® pathname åçš„æ–œçº¿ã€‚</li>\n<li>sensitive: å¦‚æœè·¯å¾„åŒºåˆ†å¤§å°å†™ï¼Œåˆ™ä¸º true ï¼Œåˆ™åŒ¹é…ã€‚</li>\n</ol>\n<h3 id=\"location\"><a href=\"#location\" class=\"headerlink\" title=\"location\"></a>location</h3><p>Route å…ƒç´ å°è¯•å…¶åŒ¹é… path åˆ°å½“å‰æµè§ˆå™¨ URLï¼Œä½†æ˜¯ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ location å®ç°ä¸å½“å‰æµè§ˆå™¨ä½ç½®ä»¥å¤–çš„ä½ç½®ç›¸åŒ¹é…ã€‚</p>\n<p>ä¸‹é¢åˆ—å‡º Route æºç ï¼Œå¹¶ä¸”åˆ å»äº† dev éƒ¨åˆ†ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">\"react\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; isValidElementType &#125; <span class=\"keyword\">from</span> <span class=\"string\">\"react-is\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> PropTypes <span class=\"keyword\">from</span> <span class=\"string\">\"prop-types\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> invariant <span class=\"keyword\">from</span> <span class=\"string\">\"tiny-invariant\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> warning <span class=\"keyword\">from</span> <span class=\"string\">\"tiny-warning\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> RouterContext <span class=\"keyword\">from</span> <span class=\"string\">\"./RouterContext.js\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> matchPath <span class=\"keyword\">from</span> <span class=\"string\">\"./matchPath.js\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * The public API for matching a single path and rendering.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Route</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;RouterContext.Consumer&gt;</span><br><span class=\"line\">        &#123;context =&gt; &#123;</span><br><span class=\"line\">          invariant(context, <span class=\"string\">\"You should not use &lt;Route&gt; outside a &lt;Router&gt;\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"comment\">// å¯ä»¥çœ‹å‡ºï¼Œç”¨æˆ·ä¼ çš„ location è¦†ç›–æ‰äº† context ä¸­çš„ location</span></span><br><span class=\"line\">          <span class=\"keyword\">const</span> location = <span class=\"keyword\">this</span>.props.location || context.location;</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"comment\">// å¦‚æœæœ‰ computedMatch å°±ç”¨ computedMatch ä½œä¸ºç»“æœ</span></span><br><span class=\"line\">          <span class=\"comment\">// å¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ¤æ–­æ˜¯å¦æœ‰ path ä¼ å‚</span></span><br><span class=\"line\">          <span class=\"comment\">// matchPath æ˜¯è°ƒç”¨ path-to-regexp åˆ¤æ–­æ˜¯å¦åŒ¹é…</span></span><br><span class=\"line\">          <span class=\"comment\">// path-to-regexp éœ€è¦ä¸‰ä¸ªå‚æ•°</span></span><br><span class=\"line\">          <span class=\"comment\">// exact: å¦‚æœä¸º trueï¼Œåˆ™åªæœ‰åœ¨è·¯å¾„å®Œå…¨åŒ¹é… location.pathname æ—¶æ‰åŒ¹é…</span></span><br><span class=\"line\">          <span class=\"comment\">// strict: å¦‚æœä¸º true å½“çœŸå®çš„è·¯å¾„å…·æœ‰ä¸€ä¸ªæ–œçº¿å°†åªåŒ¹é…ä¸€ä¸ªæ–œçº¿location.pathname</span></span><br><span class=\"line\">          <span class=\"comment\">// sensitive: å¦‚æœè·¯å¾„åŒºåˆ†å¤§å°å†™ï¼Œåˆ™ä¸º true ï¼Œåˆ™åŒ¹é…</span></span><br><span class=\"line\">          <span class=\"keyword\">const</span> match = <span class=\"keyword\">this</span>.props.computedMatch</span><br><span class=\"line\">            ? <span class=\"keyword\">this</span>.props.computedMatch <span class=\"comment\">// &lt;Switch&gt; already computed the match for us</span></span><br><span class=\"line\">            : <span class=\"keyword\">this</span>.props.path</span><br><span class=\"line\">            ? matchPath(location.pathname, <span class=\"keyword\">this</span>.props)</span><br><span class=\"line\">            : context.match;</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"comment\">// props å°±æ˜¯æ›´æ–°åçš„ context</span></span><br><span class=\"line\">          <span class=\"comment\">// location åšäº†æ›´æ–°ï¼ˆæœ‰å¯èƒ½æ˜¯ç”¨æˆ·ä¼ å…¥çš„locationï¼‰</span></span><br><span class=\"line\">          <span class=\"comment\">// match åšäº†æ›´æ–°</span></span><br><span class=\"line\">          <span class=\"keyword\">const</span> props = &#123; ...context, location, match &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"comment\">// ä¸‰ç§æ¸²æŸ“æ–¹å¼</span></span><br><span class=\"line\">          <span class=\"keyword\">let</span> &#123; children, component, render &#125; = <span class=\"keyword\">this</span>.props;</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"comment\">// Preact uses an empty array as children by</span></span><br><span class=\"line\">          <span class=\"comment\">// default, so use null if that's the case.</span></span><br><span class=\"line\">          <span class=\"comment\">// children é»˜è®¤æ˜¯ä¸ªç©ºæ•°ç»„ï¼Œå¦‚æœæ˜¯é»˜è®¤æƒ…å†µï¼Œç½®ä¸º null</span></span><br><span class=\"line\">          <span class=\"keyword\">if</span> (<span class=\"built_in\">Array</span>.isArray(children) &amp;&amp; children.length === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            children = <span class=\"literal\">null</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"keyword\">return</span> (</span><br><span class=\"line\">            <span class=\"comment\">// RouterContext ä¸­æ›´æ–°äº† location, match</span></span><br><span class=\"line\">            &lt;RouterContext.Provider value=&#123;props&#125;&gt;</span><br><span class=\"line\">              &#123;props.match</span><br><span class=\"line\">              <span class=\"comment\">// é¦–å…ˆåˆ¤æ–­çš„æ˜¯æœ‰æ—  children</span></span><br><span class=\"line\">                ? children</span><br><span class=\"line\">                  <span class=\"comment\">// å¦‚æœ children æ˜¯ä¸ªå‡½æ•°ï¼Œæ‰§è¡Œï¼Œå¦åˆ™ç›´æ¥è¿”å› children</span></span><br><span class=\"line\">                  ? <span class=\"keyword\">typeof</span> children === <span class=\"string\">\"function\"</span></span><br><span class=\"line\">                  : children(props)</span><br><span class=\"line\">                  : children</span><br><span class=\"line\">                  <span class=\"comment\">// å¦‚æœæ²¡æœ‰ childrenï¼Œåˆ¤æ–­æœ‰æ—  component</span></span><br><span class=\"line\">                : component</span><br><span class=\"line\">                  <span class=\"comment\">// æœ‰ componentï¼Œé‡æ–°æ–°å»ºä¸€ä¸ª component</span></span><br><span class=\"line\">                  ? React.createElement(component, props)</span><br><span class=\"line\">                  <span class=\"comment\">// æ²¡æœ‰ componentï¼Œåˆ¤æ–­æœ‰æ—  render</span></span><br><span class=\"line\">                  : render</span><br><span class=\"line\">                  <span class=\"comment\">// æœ‰ renderï¼Œæ‰§è¡Œ render æ–¹æ³•</span></span><br><span class=\"line\">                  ? render(props)</span><br><span class=\"line\">                  <span class=\"comment\">// æ²¡æœ‰è¿”å› null</span></span><br><span class=\"line\">                  : <span class=\"literal\">null</span></span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">// è¿™é‡Œæ˜¯ä¸ match çš„æƒ…å†µï¼Œåˆ¤æ–­ children æ˜¯å¦å‡½æ•°</span></span><br><span class=\"line\">                : <span class=\"keyword\">typeof</span> children === <span class=\"string\">\"function\"</span></span><br><span class=\"line\">                <span class=\"comment\">// æ˜¯çš„è¯æ‰§è¡Œ</span></span><br><span class=\"line\">                ? children(props)</span><br><span class=\"line\">                : <span class=\"literal\">null</span>&#125;</span><br><span class=\"line\">            &lt;<span class=\"regexp\">/RouterContext.Provider&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">          );</span></span><br><span class=\"line\"><span class=\"regexp\">        &#125;&#125;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;/</span>RouterContext.Consumer&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> Route;</span><br></pre></td></tr></table></figure>\n\n<p>Route ç»„ä»¶æ ¹æ®è‡ªèº«çš„ä¼ å‚ï¼Œå¯¹ä¸Šå±‚ RouterContext ä¸­çš„éƒ¨åˆ†å±æ€§ï¼ˆlocation å’Œ matchï¼‰è¿›è¡Œäº†æ›´æ–°ï¼Œå¹¶ä¸”å¦‚æœå½“å‰è·¯å¾„å’Œé…ç½®çš„ path è·¯å¾„ matchï¼Œåˆ™æ¸²æŸ“è¯¥ç»„ä»¶ï¼Œæ¸²æŸ“çš„æ–¹å¼æœ‰ childrenï¼Œcomponentï¼Œrender ä¸‰ç§æ–¹å¼ï¼Œæˆ‘ä»¬æœ€å¸¸ç”¨çš„å°±æ˜¯ component æ–¹å¼ï¼Œæ³¨æ„æ¯ç§æ–¹å¼çš„åŒºåˆ«ã€‚</p>\n<h2 id=\"Prompt\"><a href=\"#Prompt\" class=\"headerlink\" title=\"Prompt\"></a>Prompt</h2><p>Prompt ç”¨äºè·¯ç”±åˆ‡æ¢æç¤ºã€‚è¿™åœ¨æŸäº›åœºæ™¯ä¸‹æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œæ¯”å¦‚ç”¨æˆ·åœ¨æŸä¸ªé¡µé¢ä¿®æ”¹æ•°æ®ï¼Œç¦»å¼€æ—¶ï¼Œæç¤ºç”¨æˆ·æ˜¯å¦ä¿å­˜ï¼ŒPrompt ç»„ä»¶æœ‰ä¿©ä¸ªå±æ€§ï¼š</p>\n<ol>\n<li>messageï¼šç”¨äºæ˜¾ç¤ºæç¤ºçš„æ–‡æœ¬ä¿¡æ¯ã€‚</li>\n<li>whenï¼šä¼ é€’å¸ƒå°”å€¼ï¼Œç›¸å½“äºæ ‡ç­¾çš„å¼€å…³ï¼Œé»˜è®¤æ˜¯ trueï¼Œè®¾ç½®æˆ false æ—¶ï¼Œå¤±æ•ˆã€‚</li>\n</ol>\n<p>Prompt çš„æœ¬è´¨æ˜¯åœ¨ when ä¸º true çš„æ—¶å€™ï¼Œè°ƒç”¨ context.history.block æ–¹æ³•ï¼Œä¸ºå…¨å±€æ³¨å†Œè·¯ç”±ç›‘å¬ï¼Œblock çš„åŸç†çœ‹ä¹‹å‰çš„ history ç›¸å…³æ–‡ç« ã€‚è·¯æœ‰å˜åŒ–çš„æ—¶å€™ï¼Œé»˜è®¤ä½¿ç”¨ window.confirm è¿›è¡Œç¡®è®¤ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ confirm çš„å½¢å¼ï¼Œå°±æ˜¯åœ¨ BrowserRouter æˆ–è€… HashRouter ä¼ å…¥ getUserConfirmation è¿™ä¸ªå‚æ•°ï¼Œä¼šæ›¿æ¢æ‰ window.confirmã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import React from &quot;react&quot;;</span><br><span class=\"line\">import PropTypes from &quot;prop-types&quot;;</span><br><span class=\"line\">import invariant from &quot;tiny-invariant&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">import Lifecycle from &quot;.&#x2F;Lifecycle.js&quot;;</span><br><span class=\"line\">import RouterContext from &quot;.&#x2F;RouterContext.js&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;**</span><br><span class=\"line\"> * The public API for prompting the user before navigating away from a screen.</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">function Prompt(&#123; message, when &#x3D; true &#125;) &#123;</span><br><span class=\"line\">  return (</span><br><span class=\"line\">    &lt;RouterContext.Consumer&gt;</span><br><span class=\"line\">      &#123;context &#x3D;&gt; &#123;</span><br><span class=\"line\">        invariant(context, &quot;You should not use &lt;Prompt&gt; outside a &lt;Router&gt;&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">        if (!when || context.staticContext) return null;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#x2F;&#x2F; è°ƒç”¨äº† history.block æ–¹æ³•</span><br><span class=\"line\">        const method &#x3D; context.history.block;</span><br><span class=\"line\"></span><br><span class=\"line\">        return (</span><br><span class=\"line\">          &lt;Lifecycle</span><br><span class=\"line\">            onMount&#x3D;&#123;self &#x3D;&gt; &#123;</span><br><span class=\"line\">              self.release &#x3D; method(message);</span><br><span class=\"line\">            &#125;&#125;</span><br><span class=\"line\">            onUpdate&#x3D;&#123;(self, prevProps) &#x3D;&gt; &#123;</span><br><span class=\"line\">              if (prevProps.message !&#x3D;&#x3D; message) &#123;</span><br><span class=\"line\">                self.release();</span><br><span class=\"line\">                self.release &#x3D; method(message);</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            &#125;&#125;</span><br><span class=\"line\">            onUnmount&#x3D;&#123;self &#x3D;&gt; &#123;</span><br><span class=\"line\">              self.release();</span><br><span class=\"line\">            &#125;&#125;</span><br><span class=\"line\">            message&#x3D;&#123;message&#125;</span><br><span class=\"line\">          &#x2F;&gt;</span><br><span class=\"line\">        );</span><br><span class=\"line\">      &#125;&#125;</span><br><span class=\"line\">    &lt;&#x2F;RouterContext.Consumer&gt;</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default Prompt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Redirect\"><a href=\"#Redirect\" class=\"headerlink\" title=\"Redirect\"></a>Redirect</h2><p>Redirect ä¸å…¶è¯´æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œä¸å¦‚è¯´æ˜¯æœ‰ç»„ä»¶å°è£…çš„ä¸€ç»„æ–¹æ³•ï¼Œè¯¥ç»„ä»¶åœ¨ componentDidMount ç”Ÿå‘½å‘¨æœŸå†…ï¼Œé€šè¿‡è°ƒç”¨ history API è·³è½¬åˆ°åˆ°æ–°ä½ç½®ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ–°ä½ç½®å°†è¦†ç›–å†å²å †æ ˆä¸­çš„å½“å‰ä½ç½®ã€‚</p>\n<p><Redirect to=\"/somewhere/else\"/> to è¡¨ç¤ºè¦é‡å®šå‘åˆ°çš„ç½‘å€ã€‚to ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª location å¯¹è±¡</p>\n<p><Redirect push to=\"/somewhere/else\"/> push ä¸º true æ—¶ï¼Œé‡å®šå‘ä¼šå°†æ–°æ¡ç›®æ¨å…¥å†å²è®°å½•ï¼Œè€Œä¸æ˜¯æ›¿æ¢å½“å‰æ¡ç›®ã€‚</p>\n<p>ç»“åˆ Switch å’Œ Redirect æºç çœ‹ï¼Œå¦‚æœ Redirect ä¸­æœ‰ from å±æ€§ï¼Œä¼šè¢« Switch è·å¾—ï¼Œå½“ from å’Œå½“å‰è·¯å¾„åŒ¹é…çš„æ—¶å€™ï¼Œå°±ä¼šæ¸²æŸ“ Redirect ç»„ä»¶ï¼Œæ‰§è¡Œè·³è½¬ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">\"react\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> PropTypes <span class=\"keyword\">from</span> <span class=\"string\">\"prop-types\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; createLocation, locationsAreEqual &#125; <span class=\"keyword\">from</span> <span class=\"string\">\"history\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> invariant <span class=\"keyword\">from</span> <span class=\"string\">\"tiny-invariant\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> Lifecycle <span class=\"keyword\">from</span> <span class=\"string\">\"./Lifecycle.js\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> RouterContext <span class=\"keyword\">from</span> <span class=\"string\">\"./RouterContext.js\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> generatePath <span class=\"keyword\">from</span> <span class=\"string\">\"./generatePath.js\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * The public API for navigating programmatically with a component.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Redirect</span>(<span class=\"params\">&#123; computedMatch, to, push = false &#125;</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"comment\">// å•¥éƒ½æœ‰çš„å¤§å“¥ RouterContext</span></span><br><span class=\"line\">    &lt;RouterContext.Consumer&gt;</span><br><span class=\"line\">      &#123;context =&gt; &#123;</span><br><span class=\"line\">        invariant(context, <span class=\"string\">\"You should not use &lt;Redirect&gt; outside a &lt;Router&gt;\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> &#123; history, staticContext &#125; = context;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// ä¸€èˆ¬æ¥è¯´ï¼ŒRedirect æ“ä½œéƒ½ä¸éœ€è¦ç•™æœ‰ historyï¼Œæ‰€ä»¥é€‰æ‹©é€‰æ‹© history.replace</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> method = push ? history.push : history.replace;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> location = createLocation(</span><br><span class=\"line\">          <span class=\"comment\">// computedMatch å°±æ˜¯çœ‹çœ‹ switch æœ‰æ²¡æœ‰å¤šç®¡é—²äº‹</span></span><br><span class=\"line\">          computedMatch</span><br><span class=\"line\">            ? <span class=\"keyword\">typeof</span> to === <span class=\"string\">\"string\"</span></span><br><span class=\"line\">              ? generatePath(to, computedMatch.params)</span><br><span class=\"line\">              : &#123;</span><br><span class=\"line\">                  ...to,</span><br><span class=\"line\">                  pathname: generatePath(to.pathname, computedMatch.params)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            : to</span><br><span class=\"line\">        );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// When rendering in a static context,</span></span><br><span class=\"line\">        <span class=\"comment\">// set the new location immediately.</span></span><br><span class=\"line\">        <span class=\"comment\">// staticRouter ä¸“ç”¨</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (staticContext) &#123;</span><br><span class=\"line\">          method(location);</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> (</span><br><span class=\"line\">          &lt;Lifecycle</span><br><span class=\"line\">            onMount=&#123;() =&gt; &#123;</span><br><span class=\"line\">              <span class=\"comment\">// componentDidMount çš„æ—¶å€™æ‰§è¡Œ method(location)ï¼Œä¹Ÿå°±æ˜¯ history.replace æ“ä½œ</span></span><br><span class=\"line\">              method(location);</span><br><span class=\"line\">            &#125;&#125;</span><br><span class=\"line\">            onUpdate=&#123;(self, prevProps) =&gt; &#123;</span><br><span class=\"line\">              <span class=\"comment\">// componentDidUpdate æ—¶å€™åˆ¤æ–­å½“å‰ location å’Œä¸Šä¸€ä¸ª location æ˜¯å¦å‘ç”Ÿå˜åŒ–</span></span><br><span class=\"line\">              <span class=\"comment\">// åªè¦å‘ç”Ÿå˜åŒ–ï¼Œè°ƒç”¨ method(location)</span></span><br><span class=\"line\">              <span class=\"comment\">// ä¸€èˆ¬æ¥è®²ï¼Œåœ¨ componentDidMount çš„æ—¶å€™å°±è·³èµ°äº†ï¼Œä¸ä¼šç­‰åˆ° componentDidUpdate</span></span><br><span class=\"line\">              <span class=\"keyword\">const</span> prevLocation = createLocation(prevProps.to);</span><br><span class=\"line\">              <span class=\"keyword\">if</span> (</span><br><span class=\"line\">                !locationsAreEqual(prevLocation, &#123;</span><br><span class=\"line\">                  ...location,</span><br><span class=\"line\">                  key: prevLocation.key</span><br><span class=\"line\">                &#125;)</span><br><span class=\"line\">              ) &#123;</span><br><span class=\"line\">                method(location);</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            &#125;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// æ— æ•ˆ</span></span><br><span class=\"line\">            to=&#123;to&#125;</span><br><span class=\"line\">          /&gt;</span><br><span class=\"line\">        );</span><br><span class=\"line\">      &#125;&#125;</span><br><span class=\"line\">    &lt;<span class=\"regexp\">/RouterContext.Consumer&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  );</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">export default Redirect;</span></span><br></pre></td></tr></table></figure>\n\n<p>Lifecycle ä¸ render ä»»ä½•é¡µé¢ï¼Œåªæœ‰ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼ŒLifecycle æä¾›äº† onMountï¼Œ onUpdateï¼Œ onUnmount ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">\"react\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Lifecycle</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  componentDidMount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.props.onMount) <span class=\"keyword\">this</span>.props.onMount.call(<span class=\"keyword\">this</span>, <span class=\"keyword\">this</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentDidUpdate(prevProps) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.props.onUpdate) <span class=\"keyword\">this</span>.props.onUpdate.call(<span class=\"keyword\">this</span>, <span class=\"keyword\">this</span>, prevProps);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentWillUnmount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.props.onUnmount) <span class=\"keyword\">this</span>.props.onUnmount.call(<span class=\"keyword\">this</span>, <span class=\"keyword\">this</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> Lifecycle;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"æ€»ç»“-2\"><a href=\"#æ€»ç»“-2\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h1><p>æ•´ä¸ª<code>react-router</code>æ˜¯ç”±<code>createBrowserHistory</code>æˆ–è€…<code>createHashHistory</code>æ¥ç‰µå¤´ï¼Œä¸æˆ‘ä»¬çš„<code>React</code>ç»„ä»¶ç»‘å®šåœ¨ä¸€èµ·ï¼Œç„¶åä¼ é€’äº†ä¸€äº›å±äº<code>history</code>è¿™ä¸ªåº“çš„æ–¹æ³•ä»¥åŠæ•°å€¼ã€‚å½“ç„¶ï¼Œè¿˜æœ‰è·¯ç”±çš„åŒ¹é…å’Œæ¸²æŸ“ã€‚</p>\n<p>åœ¨<code>history</code>è¿™ä¸ªåº“é‡Œé¢åˆæœ‰å¯¹äºè·¯ç”±çš„ç›‘å¬ï¼Œæ”¹å˜ç­‰ç­‰ã€‚</p>\n<h2 id=\"æµç¨‹\"><a href=\"#æµç¨‹\" class=\"headerlink\" title=\"æµç¨‹\"></a>æµç¨‹</h2><p>ä»¥<code>history</code>æ¨¡å¼åšå‚è€ƒï¼ˆä¹Ÿæ˜¯æˆ‘ä»¬é‡ç‚¹é˜…è¯»çš„ã€‚</p>\n<h3 id=\"ä¿®æ”¹url\"><a href=\"#ä¿®æ”¹url\" class=\"headerlink\" title=\"ä¿®æ”¹url\"></a>ä¿®æ”¹url</h3><p>å½“<code>url</code>æ”¹å˜çš„æ—¶å€™ï¼Œä¼šè§¦å‘å†™åœ¨<code>window</code>ä¸Šé¢çš„ç›‘å¬<code>window.addEventListener(&#39;popstate&#39;, handlePop)</code>ã€‚</p>\n<p>è°ƒç”¨äº†æˆ‘ä»¬çš„å‡½æ•°<code>handlePop</code></p>\n<p>å‡½æ•°å†…éƒ¨æˆ‘ä»¬<code>setState</code>ï¼Œä¿®æ”¹äº†<code>location</code>ï¼Œæ–¹ä¾¿ä¼ é€’æ­£ç¡®çš„å€¼ä¸‹å»ï¼Œå¹¶é€šè¿‡äº†<code>Switch</code>æ‰¾å‡ºåŒ¹é…çš„<code>Route</code>ç»„ä»¶ã€‚</p>\n<p>è§¦å‘äº†ç»„ä»¶çš„æ¸²æŸ“ã€‚</p>\n<blockquote>\n<p>å½“ç„¶ä¹ŸåŒ…æ‹¬æˆ‘ä»¬æ‰€è°“çš„history.pushï¼Œhistory.repalceç­‰ç­‰è¿™äº›æ–¹æ³•ï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¿®æ”¹urlï¼Œç„¶åå°±æ˜¯é‡å¤ä¸Šé¢çš„æ­¥éª¤</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h1><p>æ­¤å¤„ä»‹ç»ä¸€ä¸‹React-Routerçš„æ ¸å¿ƒåŸç†ã€‚ç‰¹åˆ«ç»†è‡´çš„æ ‡ç‚¹ç¬¦å·çš„ä¸äºˆè®¨è®ºã€‚</p>\n<h1 id=\"å­¦å‰å°çŸ¥è¯†\"><a href=\"#å­¦å‰å°çŸ¥è¯†\" class=\"headerlink\" title=\"å­¦å‰å°çŸ¥è¯†\"></a>å­¦å‰å°çŸ¥è¯†</h1><p><code>React-Router</code>å…¶å®æœ€æ ¸å¿ƒçš„ä¸œè¥¿æ˜¯<code>Route</code>ç»„ä»¶å’Œç”±ç»Ÿä¸€ä½œè€…å¼€å‘çš„<code>History</code>åº“æ¥å»ºç«‹çš„ã€‚æ¥ä¸‹æ¥è·Ÿç€é•œå¤´ä¸€èµ·èµ°è¿›ç¥ç§˜çš„<code>ÃŸReact-Router</code>ä¸–ç•Œå§ã€‚</p>\n<p>å·²ç»çŸ¥é“æ€ä¹ˆä½¿ç”¨çš„ç›´æ¥è·³è¿‡ï¼Œåˆ°ä¸‹é¢çš„æºç åˆ†æå»â”—|ï½€Oâ€²|â”› å—·~~</p>\n<h1 id=\"ç®€å•ç¤ºä¾‹\"><a href=\"#ç®€å•ç¤ºä¾‹\" class=\"headerlink\" title=\"ç®€å•ç¤ºä¾‹\"></a>ç®€å•ç¤ºä¾‹</h1><p>ä¸€èµ·å»ºä¸€ä¸ªç®€å•çš„ç¤ºä¾‹å§ã€‚å…ˆç”¨<code>react</code>å®˜ç½‘çš„<code>create-react-app</code>è„šæ‰‹æ¶å¼„ä¸ª<code>react</code>å‡ºæ¥ã€‚</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npx create-react-app my-app</span><br><span class=\"line\"><span class=\"built_in\">cd</span> my-app</span><br><span class=\"line\">npm start</span><br></pre></td></tr></table></figure>\n\n<p>å®‰è£…<a href=\"https://reactrouter.com/web/guides/quick-start\" target=\"_blank\" rel=\"noopener\">react-router-dom</a></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install react-router-dom</span><br></pre></td></tr></table></figure>\n\n<p>åœ¨å¤§å®¶å®‰è£…ä¹‹ä½™ï¼Œæˆ‘ç®€ç­”çš„ä»‹ç»ä¸€ä¸‹<code>react-router</code>å’Œ<code>react-router-dom</code>çš„åŒºåˆ«ã€‚</p>\n<h2 id=\"react-routerå’Œreact-router-domçš„åŒºåˆ«ã€‚\"><a href=\"#react-routerå’Œreact-router-domçš„åŒºåˆ«ã€‚\" class=\"headerlink\" title=\"react-routerå’Œreact-router-domçš„åŒºåˆ«ã€‚\"></a>react-routerå’Œreact-router-domçš„åŒºåˆ«ã€‚</h2><h3 id=\"å…ˆçœ‹æä¾›çš„API\"><a href=\"#å…ˆçœ‹æä¾›çš„API\" class=\"headerlink\" title=\"å…ˆçœ‹æä¾›çš„API\u0003\"></a>å…ˆçœ‹æä¾›çš„API\u0003</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; Switch, Route, Router &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react-router'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Swtich, Route, BrowserRouter, HashHistory, Link &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react-router-dom'</span>;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"React-router\"><a href=\"#React-router\" class=\"headerlink\" title=\"React-router\"></a>React-router</h4><p>æä¾›äº†è·¯ç”±çš„æ ¸å¿ƒapiã€‚å¦‚Routerã€Routeã€Switchç­‰ï¼Œä½†æ²¡æœ‰æä¾›æœ‰å…³domæ“ä½œè¿›è¡Œè·¯ç”±è·³è½¬çš„apiï¼›</p>\n<h4 id=\"React-router-dom\"><a href=\"#React-router-dom\" class=\"headerlink\" title=\"React-router-dom\"></a>React-router-dom</h4><p>æä¾›äº†<code>BrowserRouter</code>ã€<code>Route</code>ã€<code>Link</code>ç­‰apiï¼Œå¯ä»¥é€šè¿‡domæ“ä½œè§¦å‘äº‹ä»¶æ§åˆ¶è·¯ç”±ã€‚</p>\n<p><code>Link</code>ç»„ä»¶ï¼Œä¼šæ¸²æŸ“ä¸€ä¸ªaæ ‡ç­¾ï¼›<code>BrowserRouter</code>å’Œ<code>HashRouter</code>ç»„ä»¶ï¼Œå‰è€…ä½¿ç”¨<code>pushState</code>å’Œ<code>popState</code>äº‹ä»¶æ„å»ºè·¯ç”±ï¼Œåè€…ä½¿ç”¨<code>hash</code>å’Œ <code>hashchange</code>äº‹ä»¶æ„å»ºè·¯ç”±ã€‚</p>\n<p><code>react-router-dom</code>åœ¨<code>react-router</code>çš„åŸºç¡€ä¸Šæ‰©å±•äº†å¯æ“ä½œ<code>dom</code>çš„<code>api</code>ã€‚</p>\n<p><code>Swtich</code> å’Œ <code>Route</code> éƒ½æ˜¯ä»<code>react-router</code>ä¸­å¯¼å…¥äº†ç›¸åº”çš„ç»„ä»¶å¹¶é‡æ–°å¯¼å‡ºï¼Œæ²¡åšä»€ä¹ˆç‰¹æ®Šå¤„ç†ã€‚</p>\n<p><code>react-router-dom</code>ä¸­<code>package.json</code>ä¾èµ–ä¸­å­˜åœ¨å¯¹<code>react-router</code>çš„ä¾èµ–ï¼Œæ•…æ­¤ï¼Œä¸éœ€è¦<code>npm</code>å®‰è£…<code>react-router</code>ã€‚</p>\n<blockquote>\n<ul>\n<li>å¯ç›´æ¥ npm å®‰è£… react-router-domï¼Œä½¿ç”¨å…¶apiã€‚</li>\n</ul>\n</blockquote>\n<h2 id=\"ç®€å•ä¿®æ”¹\"><a href=\"#ç®€å•ä¿®æ”¹\" class=\"headerlink\" title=\"ç®€å•ä¿®æ”¹\"></a>ç®€å•ä¿®æ”¹</h2><p>ğŸ‘Œï¼Œå¤§å®¶ğŸ”¥åº”è¯¥å·²ç»å®‰è£…å®Œäº†å§ï¼Ÿæ¥ä¸‹æ¥ç®€å•çš„ä¿®æ”¹ä¸€ä¸‹è„šæ‰‹æ¶é‡Œé¢çš„å†…å®¹ã€‚ä¸»è¦æ˜¯ä¸ºäº†ç†Ÿæ‚‰å¯¹æ‰‹ï¼ŒçŸ¥å·±çŸ¥å½¼ç™¾æˆ˜ç™¾èƒœã€‚</p>\n<p><img src=\"/image/router/demo.png\" alt=\"demo\"></p>\n<p>ä¿®æ”¹ä¸€ä¸‹<code>src/app.js</code></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123;</span><br><span class=\"line\">  BrowserRouter <span class=\"keyword\">as</span> Router,</span><br><span class=\"line\">  Switch,</span><br><span class=\"line\">  Route,</span><br><span class=\"line\">  Link,</span><br><span class=\"line\">&#125; <span class=\"keyword\">from</span> <span class=\"string\">\"react-router-dom\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Home</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    &lt;&gt;</span><br><span class=\"line\">      &lt;h1&gt;é¦–é¡µ&lt;<span class=\"regexp\">/h1&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;Link to=\"/</span>login<span class=\"string\">\"&gt;ç™»å½•&lt;/Link&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/&gt;</span></span><br><span class=\"line\"><span class=\"string\">  )</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">function Login() &#123;</span></span><br><span class=\"line\"><span class=\"string\">  return (</span></span><br><span class=\"line\"><span class=\"string\">    &lt;&gt;</span></span><br><span class=\"line\"><span class=\"string\">      &lt;h1&gt;ç™»å½•é¡µ&lt;/h1&gt;</span></span><br><span class=\"line\"><span class=\"string\">      &lt;Link to=\"</span>/<span class=\"string\">\"&gt;å›é¦–é¡µ&lt;/Link&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/&gt;</span></span><br><span class=\"line\"><span class=\"string\">  );</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">function App() &#123;</span></span><br><span class=\"line\"><span class=\"string\">  return (</span></span><br><span class=\"line\"><span class=\"string\">    &lt;Router&gt;</span></span><br><span class=\"line\"><span class=\"string\">      &lt;Switch&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;Route path=\"</span>/login<span class=\"string\">\" component=&#123;Login&#125;/&gt;</span></span><br><span class=\"line\"><span class=\"string\">        &lt;Route path=\"</span>/<span class=\"string\">\" component=&#123;Home&#125;/&gt;</span></span><br><span class=\"line\"><span class=\"string\">      &lt;/Switch&gt;</span></span><br><span class=\"line\"><span class=\"string\">    &lt;/Router&gt;</span></span><br><span class=\"line\"><span class=\"string\">  );</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">export default App;</span></span><br></pre></td></tr></table></figure>\n\n<p>è¿™æ ·å°±å®Œæˆäº†ä¸€ä¸ªæœ€ç®€å•çš„ç¤ºä¾‹äº†ã€‚</p>\n<h1 id=\"SPAçš„æ ¸å¿ƒæ€æƒ³\"><a href=\"#SPAçš„æ ¸å¿ƒæ€æƒ³\" class=\"headerlink\" title=\"SPAçš„æ ¸å¿ƒæ€æƒ³\"></a>SPAçš„æ ¸å¿ƒæ€æƒ³</h1><ul>\n<li>ç›‘å¬<code>URL</code>çš„å˜åŒ–</li>\n<li>æ”¹å˜æŸäº›<code>context</code>çš„å€¼</li>\n<li>è·å–å¯¹åº”çš„é¡µé¢ç»„ä»¶</li>\n<li><code>render</code>æ–°çš„é¡µé¢</li>\n</ul>\n<h1 id=\"æºç æ”»è¯»\"><a href=\"#æºç æ”»è¯»\" class=\"headerlink\" title=\"æºç æ”»è¯»\"></a>æºç æ”»è¯»</h1><h2 id=\"BrowserRouter\"><a href=\"#BrowserRouter\" class=\"headerlink\" title=\"BrowserRouter\"></a>BrowserRouter</h2><p>ä»å‰é¢çš„ç®€å•ç¤ºä¾‹ä¸­æˆ‘ä»¬ï¼Œå‘ç°æœ‰ä¸€ä¸ªæœ€å¤–å±‚çš„ä¼™è®¡ï¼Œå«<code>BrowserRouter</code>ã€‚æˆ‘ä»¬ç›´æ¥å¹²åˆ°ä»–çš„githubæºç å»ç…ç…ã€‚</p>\n<p>é“¾æ¥ï¼š<a href=\"https://github.com/ReactTraining/react-router/blob/master/packages/react-router-dom/modules/BrowserRouter.js\" target=\"_blank\" rel=\"noopener\">https://github.com/ReactTraining/react-router/blob/master/packages/react-router-dom/modules/BrowserRouter.js</a></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">\"react\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Router &#125; <span class=\"keyword\">from</span> <span class=\"string\">\"react-router\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; createBrowserHistory <span class=\"keyword\">as</span> createHistory &#125; <span class=\"keyword\">from</span> <span class=\"string\">\"history\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> PropTypes <span class=\"keyword\">from</span> <span class=\"string\">\"prop-types\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> warning <span class=\"keyword\">from</span> <span class=\"string\">\"tiny-warning\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * The public API for a &lt;Router&gt; that uses HTML5 history.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BrowserRouter</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  history = createHistory(<span class=\"keyword\">this</span>.props);</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Router</span> <span class=\"attr\">history</span>=<span class=\"string\">&#123;this.history&#125;</span> <span class=\"attr\">children</span>=<span class=\"string\">&#123;this.props.children&#125;</span> /&gt;</span></span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (__DEV__) &#123;</span><br><span class=\"line\">  BrowserRouter.propTypes = &#123;</span><br><span class=\"line\">    basename: PropTypes.string,</span><br><span class=\"line\">    children: PropTypes.node,</span><br><span class=\"line\">    forceRefresh: PropTypes.bool,</span><br><span class=\"line\">    getUserConfirmation: PropTypes.func,</span><br><span class=\"line\">    keyLength: PropTypes.number</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  BrowserRouter.prototype.componentDidMount = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    warning(</span><br><span class=\"line\">      !<span class=\"keyword\">this</span>.props.history,</span><br><span class=\"line\">      <span class=\"string\">\"&lt;BrowserRouter&gt; ignores the history prop. To use a custom history, \"</span> +</span><br><span class=\"line\">        <span class=\"string\">\"use `import &#123; Router &#125;` instead of `import &#123; BrowserRouter as Router &#125;`.\"</span></span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> BrowserRouter;</span><br></pre></td></tr></table></figure>\n\n<p>æŠ›å¼€ä¸€äº›ä¸ƒä¸ƒå…«å…«çš„åˆ¤æ–­ã€‚é‡æ–°çœ‹ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">\"react\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Router &#125; <span class=\"keyword\">from</span> <span class=\"string\">\"react-router\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; createBrowserHistory <span class=\"keyword\">as</span> createHistory &#125; <span class=\"keyword\">from</span> <span class=\"string\">\"history\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BrowserRouter</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  history = createHistory(<span class=\"keyword\">this</span>.props);</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Router</span> <span class=\"attr\">history</span>=<span class=\"string\">&#123;this.history&#125;</span> <span class=\"attr\">children</span>=<span class=\"string\">&#123;this.props.children&#125;</span> /&gt;</span></span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å†™ç€å‡ ä¸ªå¤§å­—ï¼šã€Šç“œå­äºŒæ‰‹è½¦ã€‹ä»–åªæ˜¯ä¸€ä¸ªä¸­é—´å•†ï¼Œä»–åœ¨èµšå·®ä»·ã€‚ï¼ˆæ‰“é’±ï¼</p>\n<p><code>BrowserRouter</code>æ˜¯ä¾èµ–äºä¸¤ä¸ªåº“ï¼šåˆ†åˆ«ä¸º<code>history</code>å’Œ<code>react-router</code>ã€‚okï¼Œæˆ‘ä»¬ä¸€æ¢ç©¶ç«Ÿã€‚</p>\n<h2 id=\"react-router\"><a href=\"#react-router\" class=\"headerlink\" title=\"react-router\"></a>react-router</h2><p>æºç é“¾æ¥ï¼š<a href=\"https://github.com/ReactTraining/react-router/blob/master/packages/react-router/modules/Router.js\" target=\"_blank\" rel=\"noopener\">https://github.com/ReactTraining/react-router/blob/master/packages/react-router/modules/Router.js</a></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> HistoryContext <span class=\"keyword\">from</span> <span class=\"string\">\"./HistoryContext.js\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> RouterContext <span class=\"keyword\">from</span> <span class=\"string\">\"./RouterContext.js\"</span>;</span><br></pre></td></tr></table></figure>\n\n<p>è¿™ä¸¤ä¸ªä¸œè¥¿å…¶å®å¾ˆç®€å•ï¼Œéƒ½æ˜¯å¼•ç”¨äº†ä¸€ä¸ªå«åš<code>createContext</code>ï¼Œç›®çš„ä¹Ÿå¾ˆç®€å•ï¼Œè¿™é‡Œå…¶å®å°±æ˜¯åˆ›å»ºçš„æ™®é€šcontextï¼Œåªä¸è¿‡æ‹¥æœ‰ç‰¹å®šçš„åç§°è€Œå·²ã€‚æºç å¦‚ä¸‹ã€‚å°±å‡ è¡Œã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// <span class=\"doctag\">TODO:</span> Replace with React.createContext once we can assume React 16+</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> createContext <span class=\"keyword\">from</span> <span class=\"string\">\"mini-create-react-context\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> createNamedContext = <span class=\"function\"><span class=\"params\">name</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> context = createContext();</span><br><span class=\"line\">  context.displayName = name;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> context;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> createNamedContext;</span><br></pre></td></tr></table></figure>\n\n<p>OKï¼Œé‡ç‚¹æ˜¯æ¥ä¸‹æ¥ï¼ŒæŠ›å¼€contextä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨çš„ä¸œè¥¿ã€‚æˆ‘æ•´ç†ä¸€ä¸‹ã€‚</p>\n<p>å…ˆçœ‹æ„é€ å‡½æ•°</p>\n<h3 id=\"æ„é€ å‡½æ•°\"><a href=\"#æ„é€ å‡½æ•°\" class=\"headerlink\" title=\"æ„é€ å‡½æ•°\"></a>æ„é€ å‡½æ•°</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">constructor</span>(props) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">super</span>(props);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.state = &#123;</span><br><span class=\"line\">    location: props.history.location</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// This is a bit of a hack. We have to start listening for location</span></span><br><span class=\"line\">  <span class=\"comment\">// changes here in the constructor in case there are any &lt;Redirect&gt;s</span></span><br><span class=\"line\">  <span class=\"comment\">// on the initial render. If there are, they will replace/push when</span></span><br><span class=\"line\">  <span class=\"comment\">// they mount and since cDM fires in children before parents, we may</span></span><br><span class=\"line\">  <span class=\"comment\">// get a new location before the &lt;Router&gt; is mounted.</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// _isMounted è¡¨ç¤ºç»„ä»¶æ˜¯å¦åŠ è½½å®Œæˆ</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>._isMounted = <span class=\"literal\">false</span>;</span><br><span class=\"line\">  <span class=\"comment\">// ç»„ä»¶æœªåŠ è½½å®Œæ¯•ï¼Œä½†æ˜¯ location å‘ç”Ÿçš„å˜åŒ–ï¼Œæš‚å­˜åœ¨ _pendingLocation å­—æ®µä¸­</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>._pendingLocation = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// æ²¡æœ‰ staticContext å±æ€§ï¼Œè¡¨ç¤ºæ˜¯ HashRouter æˆ–æ˜¯ BrowserRouter</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!props.staticContext) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.unlisten = props.history.listen(<span class=\"function\"><span class=\"params\">location</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>._isMounted) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// ç»„ä»¶åŠ è½½å®Œæ¯•ï¼Œå°†å˜åŒ–çš„ location æ–¹æ³• state ä¸­</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.setState(&#123; location &#125;);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>._pendingLocation = location;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æœ‰ä¸¤ä¸ªå€¼â˜<code>_isMounted</code>å’Œ<code>_pendingLocation</code></p>\n<p>åˆ†åˆ«æ˜¯  æ˜¯å¦æŒ‚è½½   å¾…å®š</p>\n<p>å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªlocationï¼Œé»˜è®¤å€¼æ˜¯ç”±å¤–é¢ä¼ å…¥çš„historyï¼Œæˆ‘æ‰¾åˆ°ä¼ å…¥çš„åœ°æ–¹ã€‚</p>\n<p>å…¶å®å°±æ˜¯ä¹‹å‰çœ‹åˆ°çš„<code>BrowserRouter</code></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">\"react\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; Router &#125; <span class=\"keyword\">from</span> <span class=\"string\">\"react-router\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; createBrowserHistory <span class=\"keyword\">as</span> createHistory &#125; <span class=\"keyword\">from</span> <span class=\"string\">\"history\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BrowserRouter</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  history = createHistory(<span class=\"keyword\">this</span>.props);</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Router</span> <span class=\"attr\">history</span>=<span class=\"string\">&#123;this.history&#125;</span> <span class=\"attr\">children</span>=<span class=\"string\">&#123;this.props.children&#125;</span> /&gt;</span></span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä¸éš¾å‘ç°ï¼Œhistoryçš„é»˜è®¤å€¼å°±æ˜¯ç”±historyè¿™ä¸ªåº“æ¥æä¾›çš„ï¼Œè¿™ä¸ªåé¢ä¼šæåˆ°ï¼Œæˆ‘ä»¬ç»§ç»­çœ‹ã€‚</p>\n<p>å…ˆç®€å•çœ‹ä¸€ä¸‹æ³¨é‡Šçš„ç¿»è¯‘(è°·æ­Œç¿»è¯‘)</p>\n<blockquote>\n<p>è¿™æœ‰ç‚¹hackã€‚ æˆ‘ä»¬å¿…é¡»å¼€å§‹åœ¨æ„é€ å‡½æ•°ä¸­ç›‘å¬ä½ç½®æ›´æ”¹ï¼Œä»¥é˜²åˆå§‹æ¸²æŸ“ä¸­å­˜åœ¨ä»»ä½•<Redirect>ã€‚ å¦‚æœæœ‰çš„è¯ï¼Œå®ƒä»¬å°†åœ¨å®‰è£…æ—¶æ›¿æ¢/æ¨åŠ¨ï¼Œå¹¶ä¸”ç”±äºcDMåœ¨çˆ¶çº§ä¹‹å‰åœ¨å­çº§ä¸­è§¦å‘ï¼Œå› æ­¤åœ¨å®‰è£…<Router>ä¹‹å‰ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šè·å¾—ä¸€ä¸ªæ–°ä½ç½®ã€‚ </p>\n</blockquote>\n<p>ä»€ä¹ˆæ„æ€å‘¢ï¼Œæˆ‘ç®€å•æè¿°ä¸€ä¸‹ï¼š</p>\n<blockquote>\n<p>å› ä¸ºå­ç»„ä»¶ä¼šæ¯”çˆ¶ç»„ä»¶æ›´æ—©æ¸²æŸ“å®Œæˆ, ä»¥åŠ<code>&lt;Redirect&gt;</code>çš„å­˜åœ¨, è‹¥æ˜¯åœ¨<code>&lt;Router&gt;</code>çš„<code>componentDidMount</code>ç”Ÿå‘½å‘¨æœŸä¸­å¯¹<code>history.location</code>è¿›è¡Œç›‘å¬, åˆ™æœ‰å¯èƒ½åœ¨ç›‘å¬äº‹ä»¶æ³¨å†Œä¹‹å‰, <code>history.location</code>å·²ç»ç”±äº<code>&lt;Redirect&gt;</code>å‘ç”Ÿäº†å¤šæ¬¡æ”¹å˜, å› æ­¤æˆ‘ä»¬éœ€è¦åœ¨<code>&lt;Router&gt;</code>çš„<code>constructor</code>ä¸­å°±æ³¨å†Œç›‘å¬äº‹ä»¶</p>\n</blockquote>\n<p>æ”¶å›æ¥ï¼Œè¿›å…¥<code>if</code>ç»§ç»­çœ‹ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">this</span>.unlisten = props.history.listen(<span class=\"function\"><span class=\"params\">location</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>._isMounted) &#123;</span><br><span class=\"line\">  \t<span class=\"keyword\">this</span>.setState(&#123; location &#125;);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">  \t<span class=\"keyword\">this</span>._pendingLocation = location;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>å°±æ˜¯è°ƒç”¨äº†<code>history</code>çš„<code>listen</code>æ–¹æ³•ã€‚ä»ä»£ç ä¸­å¯ä»¥å¤§è‡´äº†è§£åˆ°å°±æ˜¯å¯¹<code>history</code>è¿›è¡Œç›‘å¬ï¼Œç„¶åè¿›è¡Œä¸€äº›æ“ä½œã€‚</p>\n<h3 id=\"componentWillUnmount\"><a href=\"#componentWillUnmount\" class=\"headerlink\" title=\"componentWillUnmount\"></a>componentWillUnmount</h3><p>é‚£ä¹ˆè¿™ä¸ª<code>unlisten</code>ä»€ä¹ˆæ—¶å€™æ‰§è¡Œå‘¢ï¼Ÿ</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">componentWillUnmount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.unlisten) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.unlisten();</span><br><span class=\"line\">      <span class=\"keyword\">this</span>._isMounted = <span class=\"literal\">false</span>;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>._pendingLocation = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<p>åœ¨<code>Router</code>è¿™ä¸ªç»„ä»¶å¸è½½çš„æ—¶å€™å°±æ‰§è¡Œå•¦ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå–æ¶ˆäº†å¯¹<code>history</code>çš„ç›‘å¬ã€‚</p>\n<h3 id=\"componentDidUnmount\"><a href=\"#componentDidUnmount\" class=\"headerlink\" title=\"componentDidUnmount\"></a>componentDidUnmount</h3><p>ç„¶åçœ‹ä¸€ä¸‹<code>conponentDidMount</code></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">componentDidMount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>._isMounted = <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>._pendingLocation) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.setState(&#123; <span class=\"attr\">location</span>: <span class=\"keyword\">this</span>._pendingLocation &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯ä¿®æ”¹ä¸€ä¸‹æ˜¯å¦æŒ‚è½½çš„å€¼ï¼Œä»¥åŠç»§ç»­ä¹‹å‰åœ¨æ„é€ å‡½æ•°é‡Œé¢çš„åˆ¤æ–­ã€‚å¦‚æœæš‚å­˜æ•°æ®æœ‰çš„è¯å°±æŠŠä»–å­˜ä¸‹æ¥ã€‚</p>\n<h3 id=\"render\"><a href=\"#render\" class=\"headerlink\" title=\"render\"></a>render</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">render() &#123;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">      &lt;RouterContext.Provider</span><br><span class=\"line\">        value&#x3D;&#123;&#123;</span><br><span class=\"line\">          &#x2F;&#x2F; æ ¹æ® HashRouter è¿˜æ˜¯ BrowserRouterï¼Œå¯åˆ¤æ–­ history ç±»å‹</span><br><span class=\"line\">          history: this.props.history,</span><br><span class=\"line\">          &#x2F;&#x2F; è¿™ä¸ª location å°±æ˜¯ç›‘å¬ history å˜åŒ–å¾—åˆ°çš„ location</span><br><span class=\"line\">          location: this.state.location,</span><br><span class=\"line\">          &#x2F;&#x2F; path url params isExact å››ä¸ªå±æ€§</span><br><span class=\"line\">          match: Router.computeRootMatch(this.state.location.pathname),</span><br><span class=\"line\">          &#x2F;&#x2F; åªæœ‰ StaticRouter ä¼šä¼  staticContext</span><br><span class=\"line\">          &#x2F;&#x2F; HashRouter å’Œ BrowserRouter éƒ½æ˜¯ null</span><br><span class=\"line\">          staticContext: this.props.staticContext</span><br><span class=\"line\">        &#125;&#125;</span><br><span class=\"line\">      &gt;</span><br><span class=\"line\">        &lt;HistoryContext.Provider</span><br><span class=\"line\">          children&#x3D;&#123;this.props.children || null&#125;</span><br><span class=\"line\">          value&#x3D;&#123;this.props.history&#125;</span><br><span class=\"line\">        &#x2F;&gt;</span><br><span class=\"line\">      &lt;&#x2F;RouterContext.Provider&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h3><p>Routerè¿™ä¸ªç»„ä»¶ä¸»è¦å°±æ˜¯å°†ä¸€äº›æ•°æ®è¿›è¡Œå­˜å‚¨ã€‚å­˜åˆ°<code>Context</code>ï¼Œä¹‹é—´ä¸ä¹ä¸€äº›ç‰¹æ®Šæƒ…å†µçš„åˆ¤æ–­ï¼Œæ¯”å¦‚å­ç»„ä»¶æ¸²æŸ“æ¯”çˆ¶ç»„ä»¶æ—©ï¼Œä»¥åŠ<code>Redirect</code>çš„æƒ…å†µçš„å¤„ç†ã€‚åœ¨å¸è½½çš„æ—¶å€™è¦ç§»é™¤å¯¹<code>history</code>çš„ç›‘å¬ã€‚</p>\n<p>å­ç»„ä»¶ä½œä¸ºæ¶ˆè´¹è€…ï¼Œå°±å¯ä»¥å¯¹é¡µé¢è¿›è¡Œä¿®æ”¹ï¼Œè·³è½¬ï¼Œè·å–è¿™äº›æ•°å€¼ã€‚</p>\n<h2 id=\"history\"><a href=\"#history\" class=\"headerlink\" title=\"history\"></a>history</h2><h3 id=\"createBrowserHistory\"><a href=\"#createBrowserHistory\" class=\"headerlink\" title=\"createBrowserHistory\"></a>createBrowserHistory</h3><h4 id=\"è¿”å›çš„å†…å®¹\"><a href=\"#è¿”å›çš„å†…å®¹\" class=\"headerlink\" title=\"è¿”å›çš„å†…å®¹\"></a>è¿”å›çš„å†…å®¹</h4><p>ä¹‹å‰ä¸€ç›´æœ‰ä¸æ–­æåˆ°çš„<code>history</code>ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹å®ƒæ˜¯è°</p>\n<p>æºç è¿æ¥ï¼š<a href=\"https://github.com/ReactTraining/history/blob/master/packages/history/index.ts\" target=\"_blank\" rel=\"noopener\">https://github.com/ReactTraining/history/blob/master/packages/history/index.ts</a></p>\n<p>æˆ‘ä»¬ä¹‹å‰ç”¨åˆ°çš„<code>createBrowserHistory</code>ï¼Œä»–å…¶å®æ˜¯è¿”å›çš„ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡é‡Œé¢æœ‰æˆ‘ä»¬å¸¸ç”¨çš„ä¸€äº›æ–¹æ³•ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> history: BrowserHistory = &#123;</span><br><span class=\"line\">    <span class=\"keyword\">get</span> action() &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> action;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"keyword\">get</span> location() &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> location;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    createHref,</span><br><span class=\"line\">    push,</span><br><span class=\"line\">    replace,</span><br><span class=\"line\">    go,</span><br><span class=\"line\">    back() &#123;</span><br><span class=\"line\">      go(<span class=\"number\">-1</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    forward() &#123;</span><br><span class=\"line\">      go(<span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    listen(listener) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> listeners.push(listener);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    block(blocker) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> unblock = blockers.push(blocker);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (blockers.length === <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">window</span>.addEventListener(BeforeUnloadEventType, promptBeforeUnload);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        unblock();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Remove the beforeunload listener so the document may</span></span><br><span class=\"line\">        <span class=\"comment\">// still be salvageable in the pagehide event.</span></span><br><span class=\"line\">        <span class=\"comment\">// See https://html.spec.whatwg.org/#unloading-documents</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!blockers.length) &#123;</span><br><span class=\"line\">          <span class=\"built_in\">window</span>.removeEventListener(BeforeUnloadEventType, promptBeforeUnload);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> history;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å¤§éƒ¨åˆ†ç²¾é«“å°±æ˜¯è¿™é‡Œã€‚å‘ç°æœ‰å¤šç†Ÿæ‚‰çš„ä¼™ä¼´ï¼ =&gt; <code>push</code>ã€<code>replace</code>ã€<code>go</code>ç­‰ç­‰ã€‚æœ‰äº›å…¶å®éƒ½æ˜¯<code>window</code>æä¾›çš„ã€‚</p>\n<p>æœ‰äº›ç›´æ¥çœ‹ä»£ç å°±å¯ä»¥æ˜ç™½çš„å°±ä¸è§£é‡Šäº†ï¼Œæ¯”å¦‚<code>forward</code>ï¼Œ<code>back</code>ã€‚</p>\n<h5 id=\"go\"><a href=\"#go\" class=\"headerlink\" title=\"go\"></a>go</h5><p>æ¯”å¦‚ä¸Šé¢æåˆ°çš„<code>go</code>æ–¹æ³•ï¼Œæˆªå–éƒ¨åˆ†æºç ã€‚</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> globalHistory = <span class=\"built_in\">window</span>.history;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">go</span>(<span class=\"params\">delta: <span class=\"built_in\">number</span></span>) </span>&#123;</span><br><span class=\"line\">    globalHistory.go(delta);</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"createHref\"><a href=\"#createHref\" class=\"headerlink\" title=\"createHref\"></a>createHref</h5><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è¿”å›ä¸€ä¸ªå®Œæ•´çš„url</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createPath</span>(<span class=\"params\">&#123;</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  pathname = '/',</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  search = '',</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  hash = ''</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">&#125;: PartialPath</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> pathname + search + hash;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è¿”å›ä¸€ä¸ªurl</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createHref</span>(<span class=\"params\">to: To</span>) </span>&#123;</span><br><span class=\"line\">  \t<span class=\"comment\">// çœ‹ä¸Šé¢</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">typeof</span> to === <span class=\"string\">'string'</span> ? to : createPath(to);</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"push\"><a href=\"#push\" class=\"headerlink\" title=\"push\"></a>push</h5><p><code>push</code>çš„æºç ï¼Œé‡Œé¢é™„å¸¦äº†ä¸€äº›ä¼šç”¨åˆ°çš„å‡½æ•°ã€‚</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// å°±æ˜¯ç®€å•å¤„ç†ä¸€ä¸‹è¿”å›å€¼ã€‚</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getNextLocation</span>(<span class=\"params\">to: To, state: State = <span class=\"literal\">null</span></span>): <span class=\"title\">Location</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> readOnly&lt;Location&gt;(&#123;</span><br><span class=\"line\">    ...location,</span><br><span class=\"line\">    ...(<span class=\"keyword\">typeof</span> to === <span class=\"string\">'string'</span> ? parsePath(to) : to),</span><br><span class=\"line\">    state,</span><br><span class=\"line\">    key: createKey()</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è¿›è¡Œåˆ¤æ–­</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">allowTx</span>(<span class=\"params\">action: Action, location: Location, retry: () =&gt; <span class=\"built_in\">void</span></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      <span class=\"comment\">// é•¿åº¦ä¸º0å°±è¿”å›trueï¼Œé•¿åº¦å¤§äº0å°±è°ƒç”¨å‡½æ•°ï¼Œå¹¶ä¼ å…¥å‚æ•°ã€‚è¿™ä¸ªblockersç­‰ä¸€ä¸‹ä»”ç»†æ¢è®¨ä¸€ä¸‹</span></span><br><span class=\"line\">      !blockers.length || (blockers.call(&#123; action, location, retry &#125;), <span class=\"literal\">false</span>)</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// é¡¾åæ€ä¹‰è·å–stateå’Œurl</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getHistoryStateAndUrl</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">    nextLocation: Location,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">    index: <span class=\"built_in\">number</span></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  </span>): [<span class=\"title\">HistoryState</span>, <span class=\"title\">string</span>] </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        usr: nextLocation.state,</span><br><span class=\"line\">        key: nextLocation.key,</span><br><span class=\"line\">        idx: index</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"comment\">// çœ‹ä¸Šé¢ æœ‰ä¸“é—¨ä»‹ç»</span></span><br><span class=\"line\">      createHref(nextLocation)</span><br><span class=\"line\">    ];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è¿”å›ä¸€äº›å…³äºlocationçš„ä¿¡æ¯</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getIndexAndLocation</span>(<span class=\"params\"></span>): [<span class=\"title\">number</span>, <span class=\"title\">Location</span>] </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> &#123; pathname, search, hash &#125; = <span class=\"built_in\">window</span>.location;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> state = globalHistory.state || &#123;&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [</span><br><span class=\"line\">      state.idx,</span><br><span class=\"line\">      readOnly&lt;Location&gt;(&#123;</span><br><span class=\"line\">        pathname,</span><br><span class=\"line\">        search,</span><br><span class=\"line\">        hash,</span><br><span class=\"line\">        state: state.usr || <span class=\"literal\">null</span>,</span><br><span class=\"line\">        key: state.key || <span class=\"string\">'default'</span></span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    ];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æ‰§è¡Œlistenerså†…éƒ¨çš„ä¸€äº›å‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯è·³è½¬ï¼‰ï¼Œåé¢ä¹Ÿä¼šè¯¦ç»†è§£è¯»</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">applyTx</span>(<span class=\"params\">nextAction: Action</span>) </span>&#123;</span><br><span class=\"line\">    action = nextAction;</span><br><span class=\"line\">    [index, location] = getIndexAndLocation();</span><br><span class=\"line\">    listeners.call(&#123; action, location &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">push</span>(<span class=\"params\">to: To, state?: State</span>) </span>&#123;</span><br><span class=\"line\">  \t<span class=\"comment\">// è¿™é‡Œæ˜¯ä¸€ä¸ªæšä¸¾å€¼</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> nextAction = Action.Push;</span><br><span class=\"line\">  \t</span><br><span class=\"line\">    <span class=\"keyword\">let</span> nextLocation = getNextLocation(to, state);</span><br><span class=\"line\">  \t<span class=\"comment\">// é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å†æ¥ä¸€æ¬¡</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">retry</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      push(to, state);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (allowTx(nextAction, nextLocation, retry)) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> [historyState, url] = getHistoryStateAndUrl(nextLocation, index + <span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// <span class=\"doctag\">TODO:</span> Support forced reloading</span></span><br><span class=\"line\">      <span class=\"comment\">// try...catch because iOS limits us to 100 pushState calls :/</span></span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// MDNçš„åœ°å€: https://developer.mozilla.org/zh-CN/docs/Web/API/History/pushState</span></span><br><span class=\"line\">        globalHistory.pushState(historyState, <span class=\"string\">''</span>, url);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (error) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// They are going to lose state here, but there is no real</span></span><br><span class=\"line\">        <span class=\"comment\">// way to warn them about it since the page will refresh...</span></span><br><span class=\"line\">        <span class=\"comment\">// MDNçš„åœ°å€: https://developer.mozilla.org/zh-CN/docs/Web/API/Location/assign</span></span><br><span class=\"line\">        <span class=\"built_in\">window</span>.location.assign(url);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      applyTx(nextAction);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<p>æˆ‘åœ¨æ³¨é‡Šé‡Œé¢å·²ç»è¿›è¡Œéå¸¸è¯¦ç»†çš„è§£è¯»äº†ï¼Œç”¨åˆ°çš„æ¯ä¸ªå‡½æ•°éƒ½æœ‰è§£é‡Šæˆ–è€…å®˜æ–¹æƒå¨çš„urlã€‚</p>\n<p>æ€»ç»“ä¸€ä¸‹ï¼š<code>history.push</code>çš„ä¸€ä¸ªå®Œæ•´æµç¨‹</p>\n<ul>\n<li>è°ƒç”¨<code>history.pushState</code><ul>\n<li>é”™è¯¯ç”±<code>window.location.assign</code>æ¥å¤„ç†</li>\n</ul>\n</li>\n<li>æ‰§è¡Œä¸€ä¸‹<code>listeners</code>é‡Œé¢çš„å‡½æ•°</li>\n</ul>\n<p>æ˜¯çš„ï¼Œä½ æ²¡æœ‰çœ‹é”™ï¼Œå°±è¿™ä¹ˆç®€å•ï¼Œåªæ˜¯é‡Œé¢æœ‰å¾ˆå¤šè°ƒç”¨çš„å‡½æ•°ï¼Œæˆ‘éƒ½æˆªå–å‡ºæ¥ä¸€ä¸€è§£é‡Šï¼Œåšåˆ°æ¯è¡Œä»£ç éƒ½ç†è§£ï¼Œæ‰€ä»¥æ˜¾å¾—æ¯”è¾ƒé•¿ï¼Œæ¦‚æ‹¬æ¥è¯´å°±æ˜¯è¿™ä¹ˆç®€å•ã€‚</p>\n<p>é‡ç‚¹æ¥çœ‹ä¸€ä¸‹<code>listen</code>å’Œè¢«è°ƒç”¨çš„<code>createBrowserHistory</code></p>\n<h5 id=\"replace\"><a href=\"#replace\" class=\"headerlink\" title=\"replace\"></a>replace</h5><p>è¿™é‡Œé¢ç”¨çš„å‡½æ•°ï¼Œåœ¨å‰é¢çš„pushéƒ½æœ‰è§£æï¼Œå¯ä»¥å¾€ä¸Šé¢å»æ‰¾æ‰¾ï¼Œå°±ä¸å¤šèµ˜è¿°äº†ã€‚</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">replace</span>(<span class=\"params\">to: To, state?: State</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> nextAction = Action.Replace;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> nextLocation = getNextLocation(to, state);</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">retry</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      replace(to, state);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (allowTx(nextAction, nextLocation, retry)) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> [historyState, url] = getHistoryStateAndUrl(nextLocation, index);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// <span class=\"doctag\">TODO:</span> Support forced reloading</span></span><br><span class=\"line\">      globalHistory.replaceState(historyState, <span class=\"string\">''</span>, url);</span><br><span class=\"line\"></span><br><span class=\"line\">      applyTx(nextAction);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"listen\"><a href=\"#listen\" class=\"headerlink\" title=\"listen\"></a>listen</h5><p>åœ¨<code>history</code>è¿”å›çš„<code>listen</code>æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°æˆ‘ä»¬ä¹‹å‰åœ¨react-routerçš„æºç ä¸­å‘ç°ï¼Œä»–æ˜¯åœ¨æ„é€ å‡½æ•°å’Œå¸è½½çš„æ—¶å€™ä¼šç”¨åˆ°ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">listen(listener) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> listeners.push(listener);</span><br><span class=\"line\">    &#125;,</span><br></pre></td></tr></table></figure>\n\n<p>ä»”ç»†çœ‹çœ‹ï¼Œè¿™ä¸ª<code>listeners</code>æ˜¯åœ¨åšäº›ä»€ä¹ˆã€‚</p>\n<h5 id=\"createEvents\"><a href=\"#createEvents\" class=\"headerlink\" title=\"createEvents\"></a>createEvents</h5><p>è¿™ä¸ªå‡½æ•°åé¢çš„blockersä¹Ÿä¼šç”¨åˆ°</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> listeners = createEvents&lt;Listener&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createEvents</span>&lt;<span class=\"title\">F</span> <span class=\"title\">extends</span> <span class=\"title\">Function</span>&gt;(<span class=\"params\"></span>): <span class=\"title\">Events</span>&lt;<span class=\"title\">F</span>&gt; </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> handlers: F[] = [];</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">get</span> length() &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> handlers.length;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    push(fn: F) &#123;</span><br><span class=\"line\">      handlers.push(fn);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        handlers = handlers.filter(<span class=\"function\"><span class=\"params\">handler</span> =&gt;</span> handler !== fn);</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    call(arg) &#123;</span><br><span class=\"line\">      handlers.forEach(<span class=\"function\"><span class=\"params\">fn</span> =&gt;</span> fn &amp;&amp; fn(arg));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>è¿™ä¸ªæ–¹æ³•ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯åˆ›å»ºäº‹ä»¶ã€‚å®šä¹‰äº†ä¸€ä¸ªå˜é‡ <code>handlers</code> æ•°ç»„ï¼Œç”¨äºå­˜æ”¾è¦å¤„ç†çš„å›è°ƒå‡½æ•°äº‹ä»¶ã€‚</p>\n<p>ç„¶åè¿”å›äº†ä¸€ä¸ªå¯¹è±¡ã€‚</p>\n<p><code>push</code> æ–¹æ³•å°±æ˜¯å¾€ <code>handlers</code> ä¸­æ·»åŠ è¦æ‰§è¡Œçš„å‡½æ•°ã€‚</p>\n<p>è¿™å—ä¸»è¦åœ¨ <code>history.listen()</code> ä¸­ä½¿ç”¨ï¼Œå¯ä»¥ç¿»åˆ°å¼€å¤´çœ‹ä¸‹ <code>history</code> ä¸­è¿”å›äº† <code>listen()</code> æ–¹æ³•ï¼Œå°±æ˜¯è°ƒç”¨äº†<code>listeners.push(listener)</code> ã€‚</p>\n<p>æœ€å <code>call()</code> æ–¹æ³•å°±æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œå°±æ˜¯å–å‡º <code>handlers</code> é‡Œé¢çš„å›è°ƒå‡½æ•°å¹¶é€ä¸ªæ‰§è¡Œã€‚</p>\n<p>æ€»ç»“ä¸€ä¸‹ï¼Œå°±æ˜¯å­˜å‚¨ä¸€ä¸‹<code>push</code>è¿›æ¥çš„å‡½æ•°ï¼Œå¹¶è¿›è¡Œè¿‡æ»¤ã€‚ä¹‹åè°ƒç”¨çš„æ—¶å€™ä¼šä¾æ¬¡æ‰§è¡Œã€‚<code>length</code>å°±æ˜¯å½“å‰æ‹¥æœ‰çš„å‡½æ•°æ•°é‡ã€‚</p>\n<p>å†åˆ‡å›å»ï¼Œå°±ä¼šå‘ç°ï¼Œæ¯æ¬¡è°ƒç”¨è¿™ä¸ª<code>listen</code>å°±ç›¸å½“äº<code>push</code>ä¸€ä¸ªå‡½æ•°åˆ°å†…éƒ¨çš„ä¸€ä¸ªå˜é‡<code>handlers</code>ä¸­ã€‚</p>\n<h5 id=\"block\"><a href=\"#block\" class=\"headerlink\" title=\"block\"></a>block</h5><p>å’Œ<code>listeners</code>ä¸€æ ·ï¼Œä¹Ÿæ˜¯ç”¨<code>createEvents</code>åˆ›å»ºçš„ï¼Œå°±ä¸å¤šè¯´å•¦ã€‚è¯´ä¸€ä¸‹å“ªé‡Œä¼šç”¨åˆ°è¿™ä¸ªå§ã€‚</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> blockers = createEvents&lt;Blocker&gt;();</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><code>block(prompt)</code> - (function) Prevents navigation (see <a href=\"https://github.com/ReactTraining/history/blob/master/docs/blocking-transitions.md\" target=\"_blank\" rel=\"noopener\">the history docs</a>)</li>\n</ul>\n<p>è¿™ä¸ªæ˜¯<code>react-router</code>å®˜ç½‘çš„è§£é‡Šã€‚</p>\n<p>æˆ‘è¿™é‡Œç®€å•æ¦‚æ‹¬ä¸€ä¸‹ï¼Œå°±æ˜¯ç”¨äºå…³é—­æˆ–è€…å›é€€æµè§ˆå™¨çš„è¯¯æ“ä½œä¼šç”¨åˆ°çš„ã€‚è¯¦ç»†çš„å¯ä»¥çœ‹ç‚¹å‡»è¿›å»æŸ¥çœ‹ã€‚</p>\n<h5 id=\"æ€»ç»“-1\"><a href=\"#æ€»ç»“-1\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h5><p>è‡³æ­¤ï¼Œæˆ‘ä»¬è°ƒç”¨çš„<code>createBrowserHistory</code>æ‰€è¿”å›çš„ä¸€äº›å±æ€§çš„æºç éƒ½å·²ç»äº†å¦‚æŒ‡æŒäº†ã€‚ä½†æ˜¯å…·ä½“æ˜¯æ€ä¹ˆå·¥ä½œè¿˜æ˜¯ä¸€çŸ¥åŠè§£ã€‚</p>\n<h4 id=\"å…·ä½“æ ¸å¿ƒåŸç†\"><a href=\"#å…·ä½“æ ¸å¿ƒåŸç†\" class=\"headerlink\" title=\"å…·ä½“æ ¸å¿ƒåŸç†\"></a>å…·ä½“æ ¸å¿ƒåŸç†</h4><p>å…ˆç§€ä¸€ä¸‹æºç ã€‚historyçš„æ ¸å¿ƒåŸç†å°±æ˜¯è¿™ä¸ªã€‚å…ˆåˆ«è¢«è¿™ä¹ˆå¤šè¡Œä»£ç å”¬åˆ°äº†ï¼Œå¾ˆå¤šéƒ½æ˜¯æˆ‘ä»¬åœ¨ä¹‹å‰çš„pushé‡Œé¢æœ‰è§£é‡Šçš„</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> PopStateEventType = <span class=\"string\">'popstate'</span>;</span><br><span class=\"line\"><span class=\"keyword\">let</span> blockedPopTx: Transition | <span class=\"literal\">null</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handlePop</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœæœ‰</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (blockedPopTx) &#123;</span><br><span class=\"line\">    blockers.call(blockedPopTx);</span><br><span class=\"line\">    blockedPopTx = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> nextAction = Action.Pop;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> [nextIndex, nextLocation] = getIndexAndLocation();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (blockers.length) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (nextIndex != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> delta = index - nextIndex;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (delta) &#123;</span><br><span class=\"line\">          <span class=\"comment\">// Revert the POP</span></span><br><span class=\"line\">          blockedPopTx = &#123;</span><br><span class=\"line\">            action: nextAction,</span><br><span class=\"line\">            location: nextLocation,</span><br><span class=\"line\">            retry() &#123;</span><br><span class=\"line\">              go(delta * <span class=\"number\">-1</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">          go(delta);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Trying to POP to a location with no index. We did not create</span></span><br><span class=\"line\">        <span class=\"comment\">// this location, so we can't effectively block the navigation.</span></span><br><span class=\"line\">        warning(</span><br><span class=\"line\">          <span class=\"literal\">false</span>,</span><br><span class=\"line\">          <span class=\"comment\">// <span class=\"doctag\">TODO:</span> Write up a doc that explains our blocking strategy in</span></span><br><span class=\"line\">          <span class=\"comment\">// detail and link to it here so people can understand better what</span></span><br><span class=\"line\">          <span class=\"comment\">// is going on and how to avoid it.</span></span><br><span class=\"line\">          <span class=\"string\">`You are trying to block a POP navigation to a location that was not `</span> +</span><br><span class=\"line\">          <span class=\"string\">`created by the history library. The block will fail silently in `</span> +</span><br><span class=\"line\">          <span class=\"string\">`production, but in general you should do all navigation with the `</span> +</span><br><span class=\"line\">          <span class=\"string\">`history library (instead of using window.history.pushState directly) `</span> +</span><br><span class=\"line\">          <span class=\"string\">`to avoid this situation.`</span></span><br><span class=\"line\">        );</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      applyTx(nextAction);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">window</span>.addEventListener(PopStateEventType, handlePop);</span><br></pre></td></tr></table></figure>\n\n<p>é‡ç‚¹è¯´ä¸€ä¸‹<code>window.addEventListener(PopStateEventType, handlePop)</code></p>\n<p>MDNåœ°å€ï¼š<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Window/popstate_event\" target=\"_blank\" rel=\"noopener\">https://developer.mozilla.org/zh-CN/docs/Web/API/Window/popstate_event</a></p>\n<p>å…¶å®å°±æ˜¯ç›‘å¬è·¯ç”±çš„å˜åŒ–ç„¶åï¼Œæ‰§è¡Œå›è°ƒå‡½æ•°</p>\n<h3 id=\"createHashHistory\"><a href=\"#createHashHistory\" class=\"headerlink\" title=\"createHashHistory\"></a>createHashHistory</h3><p>è¿™ä¸ªå¤§ä½“ä¸Šä¸æ™®é€šè·¯ç”±ä¸€è‡´ã€‚è¿™é‡Œæˆ‘æƒ³å¼ºè°ƒä¸€äº›é—®é¢˜ã€‚</p>\n<blockquote>\n<p>æ¯”å¦‚å“ˆå¸Œè·¯ç”±çš„é”šç‚¹é—®é¢˜ï¼Œæˆ‘è‡ªå·±å·²çŸ¥çš„å‡ ä¸ªæ–¹æ¡ˆ</p>\n<ul>\n<li><h3 id=\"scrollIntoView\"><a href=\"#scrollIntoView\" class=\"headerlink\" title=\"scrollIntoView\"></a><a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollIntoView\" target=\"_blank\" rel=\"noopener\">scrollIntoView</a></h3></li>\n<li><h3 id=\"scrollTop\"><a href=\"#scrollTop\" class=\"headerlink\" title=\"scrollTop\"></a><a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollTop\" target=\"_blank\" rel=\"noopener\">scrollTop</a></h3></li>\n<li><h2 id=\"react-anchor-without-hash\"><a href=\"#react-anchor-without-hash\" class=\"headerlink\" title=\"react-anchor-without-hash\"></a><a href=\"https://github.com/kwzm/react-anchor-without-hash\" target=\"_blank\" rel=\"noopener\">react-anchor-without-hash</a></h2></li>\n</ul>\n</blockquote>\n<p>æ„Ÿå…´è¶£çš„è‡ªå·±æŸ¥è¯¢ä¸€ä¸‹ï¼Œè¿™ä¸ªä¸åœ¨æœ¬æ¬¡çš„è®¨è®ºèŒƒå›´å†…ã€‚</p>\n<h4 id=\"å…·ä½“æ ¸å¿ƒåŸç†-1\"><a href=\"#å…·ä½“æ ¸å¿ƒåŸç†-1\" class=\"headerlink\" title=\"å…·ä½“æ ¸å¿ƒåŸç†\"></a>å…·ä½“æ ¸å¿ƒåŸç†</h4><p>ä¹‹å‰è¯´çš„åˆ°ï¼Œ<code>history</code>è·¯ç”±çš„æ ¸å¿ƒæ˜¯<code>window.addEventListener(PopStateEventType, handlePop);</code></p>\n<p>è€Œå“ˆå¸Œè·¯ç”±çš„æ ¸å¿ƒä¹Ÿæ˜¯ç›‘å¬è·¯ç”±çš„å˜åŒ–ï¼Œåªæ˜¯å‚æ•°ä¸åŒã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">window</span>.addEventListener(<span class=\"string\">'hashchange'</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">/* ç›‘å¬æ”¹å˜ */</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>è€Œå¯¹è·¯ç”±çš„æ”¹å˜ã€‚<code>history</code>è·¯ç”±æ˜¯ï¼š<code>history.pushState</code>ï¼Œ<code>history.replaceState</code>ã€‚</p>\n<p>å“ˆå¸Œè·¯ç”±æ˜¯ï¼š</p>\n<p><code>window.location.hash</code></p>\n<p>é€šè¿‡<code>window.location.hash</code>å±æ€§è·å–å’Œè®¾ç½® <code>hash</code>å€¼ã€‚</p>\n<p>å…·ä½“çš„è¯å¾ˆå·®ä¸å¤šï¼Œå…³å¿ƒç»†èŠ‚çš„ä¼™ä¼´å¯ä»¥å»çœ‹å…¶æºç å“¦ã€‚</p>\n<h1 id=\"æ ¸å¿ƒAPI\"><a href=\"#æ ¸å¿ƒAPI\" class=\"headerlink\" title=\"æ ¸å¿ƒAPI\"></a>æ ¸å¿ƒAPI</h1><p>ä¹‹å‰æˆ‘ä»¬çœ‹äº†BrowserRouterã€‚æˆ‘ä»¬å›è¿‡å¤´æ¥çœ‹çœ‹ï¼Œdemoä¸­çš„å®ä¾‹ä»£ç è¿˜æœ‰å¤šå°‘æ²¡æœ‰è§£å†³ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import React from &#39;react&#39;;</span><br><span class=\"line\">import &#123;</span><br><span class=\"line\">  BrowserRouter as Router,</span><br><span class=\"line\">  Switch,</span><br><span class=\"line\">  Route,</span><br><span class=\"line\">  Link,</span><br><span class=\"line\">&#125; from &quot;react-router-dom&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">function Home() &#123;</span><br><span class=\"line\">  return (</span><br><span class=\"line\">    &lt;&gt;</span><br><span class=\"line\">      &lt;h1&gt;é¦–é¡µ&lt;&#x2F;h1&gt;</span><br><span class=\"line\">      &lt;Link to&#x3D;&quot;&#x2F;login&quot;&gt;ç™»å½•&lt;&#x2F;Link&gt;</span><br><span class=\"line\">    &lt;&#x2F;&gt;</span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function Login() &#123;</span><br><span class=\"line\">  return (</span><br><span class=\"line\">    &lt;&gt;</span><br><span class=\"line\">      &lt;h1&gt;ç™»å½•é¡µ&lt;&#x2F;h1&gt;</span><br><span class=\"line\">      &lt;Link to&#x3D;&quot;&#x2F;&quot;&gt;å›é¦–é¡µ&lt;&#x2F;Link&gt;</span><br><span class=\"line\">    &lt;&#x2F;&gt;</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">function App() &#123;</span><br><span class=\"line\">  return (</span><br><span class=\"line\">    &lt;Router&gt;</span><br><span class=\"line\">      &lt;Switch&gt;</span><br><span class=\"line\">        &lt;Route path&#x3D;&quot;&#x2F;login&quot; component&#x3D;&#123;Login&#125;&#x2F;&gt;</span><br><span class=\"line\">        &lt;Route path&#x3D;&quot;&#x2F;&quot; component&#x3D;&#123;Home&#125;&#x2F;&gt;</span><br><span class=\"line\">      &lt;&#x2F;Switch&gt;</span><br><span class=\"line\">    &lt;&#x2F;Router&gt;</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default App;</span><br></pre></td></tr></table></figure>\n\n<p>æˆ‘ä»¬å·²ç»çœ‹å®Œäº†<code>BrowserRouter</code>ï¼ˆ<code>Router</code>ã€‚ä¸‹é¢è¿˜æœ‰<code>Switch</code>å’Œ<code>Route</code>ã€‚</p>\n<h2 id=\"Switch\"><a href=\"#Switch\" class=\"headerlink\" title=\"Switch\"></a>Switch</h2><p>å…ˆä¸Šæºç ã€‚æˆ‘æ‘˜å–æœ€æ ¸å¿ƒçš„ä¸€éƒ¨åˆ†ã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Switch extends React.Component &#123;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    return (</span><br><span class=\"line\">      &lt;RouterContext.Consumer&gt;</span><br><span class=\"line\">        &#123;context &#x3D;&gt; &#123;</span><br><span class=\"line\">          invariant(context, &quot;You should not use &lt;Switch&gt; outside a &lt;Router&gt;&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">          &#x2F;&#x2F; é»˜è®¤ä½¿ç”¨context.locationï¼Œå¦‚æœæœ‰ç‰¹æ®Šå®šåˆ¶çš„locationæ‰ä¼šä½¿ç”¨ã€‚</span><br><span class=\"line\">          &#x2F;&#x2F; ä¸‹é¢æœ‰ä»‹ç»</span><br><span class=\"line\">          const location &#x3D; this.props.location || context.location;</span><br><span class=\"line\"></span><br><span class=\"line\">          let element, match;</span><br><span class=\"line\"></span><br><span class=\"line\">          &#x2F;&#x2F; We use React.Children.forEach instead of React.Children.toArray().find()</span><br><span class=\"line\">          &#x2F;&#x2F; here because toArray adds keys to all child elements and we do not want</span><br><span class=\"line\">          &#x2F;&#x2F; to trigger an unmount&#x2F;remount for two &lt;Route&gt;s that render the same</span><br><span class=\"line\">          &#x2F;&#x2F; component at different URLs.</span><br><span class=\"line\">          &#x2F;&#x2F; React.Children.forEach å¯¹å­å…ƒç´ åšéå†</span><br><span class=\"line\">          React.Children.forEach(this.props.children, child &#x3D;&gt; &#123;</span><br><span class=\"line\">            &#x2F;&#x2F; åªè¦æ‰¾åˆ°ä¸€ä¸ª matchï¼Œé‚£ä¹ˆå°±ä¸ä¼šå†è¿›æ¥äº†</span><br><span class=\"line\">            if (match &#x3D;&#x3D; null &amp;&amp; React.isValidElement(child)) &#123;</span><br><span class=\"line\">              element &#x3D; child;</span><br><span class=\"line\"></span><br><span class=\"line\">              &#x2F;&#x2F; child.props.path å°±ä¸å¤šè®²äº†ï¼Œ Route çš„æ ‡å‡†å†™æ³•</span><br><span class=\"line\">              &#x2F;&#x2F; éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ from ä¹Ÿä¼šè¢«åŒ¹é…åˆ°</span><br><span class=\"line\">              &#x2F;&#x2F; ä»»ä½•ç»„ä»¶ï¼Œåªè¦åœ¨ Switch ä¸‹ï¼Œæœ‰ from å±æ€§ï¼Œå¹¶ä¸”å’Œå½“å‰è·¯å¾„åŒ¹é…ï¼Œå°±ä¼šè¢«æ¸²æŸ“</span><br><span class=\"line\">              &#x2F;&#x2F; fromå…·ä½“æ˜¯ç»™&lt;Redirect&gt;ä½¿ç”¨çš„ï¼Œåé¢ä¼šè¯´åˆ°</span><br><span class=\"line\">              const path &#x3D; child.props.path || child.props.from;</span><br><span class=\"line\"></span><br><span class=\"line\">              &#x2F;&#x2F; åˆ¤æ–­ç»„ä»¶æ˜¯å¦åŒ¹é…</span><br><span class=\"line\">              match &#x3D; path</span><br><span class=\"line\">              &#x2F;&#x2F; ä¸‹é¢æœ‰ä¸“å±çš„ä»‹ç»è¿™ä¸ªå‡½æ•°</span><br><span class=\"line\">                ? matchPath(location.pathname, &#123; ...child.props, path &#125;)</span><br><span class=\"line\">                : context.match;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">          return match</span><br><span class=\"line\">            ? React.cloneElement(element, &#123; location, computedMatch: match &#125;)</span><br><span class=\"line\">            : null;</span><br><span class=\"line\">        &#125;&#125;</span><br><span class=\"line\">      &lt;&#x2F;RouterContext.Consumer&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Switchä¸­çš„locationè¿™ä¸ªpropsæ€ä¹ˆç”¨ï¼Ÿä»€ä¹ˆç”¨ï¼Ÿ</p>\n<blockquote>\n<h2 id=\"æ‘˜è‡ªå®˜ç½‘\"><a href=\"#æ‘˜è‡ªå®˜ç½‘\" class=\"headerlink\" title=\"æ‘˜è‡ªå®˜ç½‘\"></a>æ‘˜è‡ªå®˜ç½‘</h2><h2 id=\"location-object\"><a href=\"#location-object\" class=\"headerlink\" title=\"location: object\"></a><a href=\"https://reactrouter.com/web/api/Switch/location-object\" target=\"_blank\" rel=\"noopener\">location: object</a></h2><p>A <a href=\"https://reactrouter.com/web/api/location\" target=\"_blank\" rel=\"noopener\"><code>location</code></a> object to be used for matching children elements instead of the current history location (usually the current browser URL).</p>\n<p>è°·æ­Œç¿»è¯‘ï¼šç”¨äºåŒ¹é…å­å…ƒç´ çš„ä½ç½®å¯¹è±¡ï¼Œè€Œä¸æ˜¯å½“å‰å†å²è®°å½•ä½ç½®ï¼ˆé€šå¸¸æ˜¯å½“å‰æµè§ˆå™¨URLï¼‰ã€‚</p>\n</blockquote>\n<h3 id=\"matchPath\"><a href=\"#matchPath\" class=\"headerlink\" title=\"matchPath\"></a>matchPath</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">matchPath</span>(<span class=\"params\">pathname, options = &#123;&#125;</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// è§„èŒƒç»“æ„ä½“</span></span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœ options ä¼ çš„æ˜¯ä¸ª stringï¼Œé‚£é»˜è®¤è¿™ä¸ª string ä»£è¡¨ path</span></span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœ options ä¼ çš„æ˜¯ä¸ª æ•°ç»„ï¼Œé‚£åªè¦æœ‰ä¸€ä¸ªåŒ¹é…ï¼Œå°±è®¤ä¸ºåŒ¹é…</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> options === <span class=\"string\">\"string\"</span> || <span class=\"built_in\">Array</span>.isArray(options)) &#123;</span><br><span class=\"line\">    options = &#123; <span class=\"attr\">path</span>: options &#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> &#123; path, exact = <span class=\"literal\">false</span>, strict = <span class=\"literal\">false</span>, sensitive = <span class=\"literal\">false</span> &#125; = options;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// è½¬åŒ–æˆæ•°ç»„è¿›è¡Œåˆ¤æ–­</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> paths = [].concat(path);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// éƒ½æ˜¯å¾ˆç®€å•çš„å†…å®¹ï¼Œéš¾ç‚¹å°±åœ¨è¿™ä¸ªreduceï¼Œè¿™ä¸ªå¾ˆæœ‰æ„æ€ï¼Œæ„Ÿå…´è¶£æˆ–è€…ä¸äº†è§£çš„èµ¶ç´§å»MDNäº†è§£ä¸€ä¸‹ï¼ï¼ï¼</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> paths.reduce(<span class=\"function\">(<span class=\"params\">matched, path</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!path &amp;&amp; path !== <span class=\"string\">\"\"</span>) <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"comment\">// åªè¦æœ‰ä¸€ä¸ª matchï¼Œç›´æ¥è¿”å›ï¼Œè®¤ä¸ºæ˜¯ match</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (matched) <span class=\"keyword\">return</span> matched;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// regexp æ˜¯æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class=\"line\">    <span class=\"comment\">// keys æ˜¯åˆ‡å‰²å‡ºæ¥çš„å¾— key çš„å€¼</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; regexp, keys &#125; = compilePath(path, &#123;</span><br><span class=\"line\">      end: exact,</span><br><span class=\"line\">      strict,</span><br><span class=\"line\">      sensitive</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"comment\">// exec() è¯¥æ–¹æ³•å¦‚æœæ‰¾åˆ°äº†åŒ¹é…çš„æ–‡æœ¬çš„è¯ï¼Œåˆ™ä¼šè¿”å›ä¸€ä¸ªç»“æœæ•°ç»„ï¼Œå¦åˆ™çš„è¯ï¼Œä¼šè¿”å›ä¸€ä¸ª</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> match = regexp.exec(pathname);</span><br><span class=\"line\">    <span class=\"comment\">/* åŒ¹é…ä¸æˆåŠŸï¼Œè¿”å›null */</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!match) <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// url è¡¨ç¤ºåŒ¹é…åˆ°çš„éƒ¨åˆ†</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> [url, ...values] = match;</span><br><span class=\"line\">    <span class=\"comment\">// pathname === url è¡¨ç¤ºå®Œå…¨åŒ¹é…</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> isExact = pathname === url;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (exact &amp;&amp; !isExact) <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      path, <span class=\"comment\">// the path used to match</span></span><br><span class=\"line\">      url: path === <span class=\"string\">\"/\"</span> &amp;&amp; url === <span class=\"string\">\"\"</span> ? <span class=\"string\">\"/\"</span> : url, <span class=\"comment\">// the matched portion of the URL</span></span><br><span class=\"line\">      isExact, <span class=\"comment\">// whether or not we matched exactly</span></span><br><span class=\"line\">      params: keys.reduce(<span class=\"function\">(<span class=\"params\">memo, key, index</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        memo[key.name] = values[index];</span><br><span class=\"line\">        <span class=\"keyword\">return</span> memo;</span><br><span class=\"line\">      &#125;, &#123;&#125;)</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;, <span class=\"literal\">null</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>matchPath å‡½æ•°ä¹Ÿæ˜¯ç”± react-router export å‡ºå»çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ¥è·å¾—æŸä¸ª url ä¸­çš„æŒ‡å®šçš„å‚æ•°ã€‚</p>\n<h2 id=\"Route\"><a href=\"#Route\" class=\"headerlink\" title=\"Route\"></a>Route</h2><p>Route æ˜¯ç”¨äºå£°æ˜è·¯ç”±æ˜ å°„åˆ°åº”ç”¨ç¨‹åºçš„ç»„ä»¶å±‚ã€‚</p>\n<p>Route æœ‰ä¸‰ç§æ¸²æŸ“çš„æ–¹æ³•ï¼Œå½“ç„¶ï¼Œéƒ½é…ç½®çš„è¯åªæœ‰ä¸€ä¸ªä¼šç”Ÿæ•ˆï¼Œä¼˜å…ˆçº§æ˜¯ children &gt; component &gt; render</p>\n<p>\\1. <Route component><br>\\2. <Route render><br>\\3. <Route children></p>\n<p>æ¯ä¸ªåœ¨ä¸åŒçš„æƒ…å†µä¸‹éƒ½æœ‰ç”¨ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¼šä½¿ç”¨ componentã€‚</p>\n<h3 id=\"component\"><a href=\"#component\" class=\"headerlink\" title=\"component\"></a>component</h3><p>component è¡¨ç¤ºåªæœ‰å½“ä½ç½®åŒ¹é…æ—¶æ‰ä¼šæ¸²æŸ“çš„ React ç»„ä»¶ã€‚ä½¿ç”¨ componentï¼ˆè€Œä¸æ˜¯ render æˆ– children ï¼‰Route ä½¿ç”¨ä»ç»™å®šç»„ä»¶ React.createElement(element, props) åˆ›å»ºæ–°çš„ React elementã€‚è¿™æ„å‘³ç€ï¼Œä½¿ç”¨ component åˆ›å»ºçš„ç»„ä»¶èƒ½è·å¾— router ä¸­çš„ propsã€‚</p>\n<h3 id=\"children\"><a href=\"#children\" class=\"headerlink\" title=\"children\"></a>children</h3><p>ä»æºç ä¸­å¯ä»¥çœ‹å‡ºï¼Œchildren çš„ä¼˜å…ˆçº§æ˜¯é«˜äº componentï¼Œè€Œä¸”å¯ä»¥æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œchildren æ²¡æœ‰è·å¾— router çš„ propsã€‚</p>\n<p>children æœ‰ä¸€ä¸ªéå¸¸ç‰¹æ®Šçš„åœ°æ–¹åœ¨äºï¼Œå½“è·¯ç”±ä¸åŒ¹é…ä¸” children æ˜¯ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œä¼šæ‰§è¡Œ children æ–¹æ³•ï¼Œè¿™å°±ç»™äº†è®¾è®¡å¾ˆå¤§çš„çµæ´»æ€§ã€‚</p>\n<h3 id=\"render-1\"><a href=\"#render-1\" class=\"headerlink\" title=\"render\"></a>render</h3><p>render å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¼˜å…ˆçº§æ˜¯æœ€ä½çš„ï¼Œå½“åŒ¹é…æˆåŠŸçš„æ—¶å€™ï¼Œæ‰§è¡Œè¿™ä¸ªå‡½æ•°ã€‚</p>\n<h3 id=\"exact-amp-strict-amp-sensitive\"><a href=\"#exact-amp-strict-amp-sensitive\" class=\"headerlink\" title=\"exact &amp; strict &amp; sensitive\"></a>exact &amp; strict &amp; sensitive</h3><p>è¿™ä¸‰è€…éƒ½æ˜¯ä½¿ç”¨ path-to-regexp åšè·¯å¾„åŒ¹é…éœ€è¦çš„ä¸‰ä¸ªå‚æ•°ã€‚</p>\n<ol>\n<li>exact: å¦‚æœä¸º trueï¼Œåˆ™åªæœ‰åœ¨è·¯å¾„å®Œå…¨åŒ¹é… location.pathname æ—¶æ‰åŒ¹é…ã€‚</li>\n<li>strict: åœ¨ç¡®å®šä¸ºä½ç½®æ˜¯å¦ä¸å½“å‰ URL åŒ¹é…æ—¶ï¼Œå°†è€ƒè™‘ä½ç½® pathname åçš„æ–œçº¿ã€‚</li>\n<li>sensitive: å¦‚æœè·¯å¾„åŒºåˆ†å¤§å°å†™ï¼Œåˆ™ä¸º true ï¼Œåˆ™åŒ¹é…ã€‚</li>\n</ol>\n<h3 id=\"location\"><a href=\"#location\" class=\"headerlink\" title=\"location\"></a>location</h3><p>Route å…ƒç´ å°è¯•å…¶åŒ¹é… path åˆ°å½“å‰æµè§ˆå™¨ URLï¼Œä½†æ˜¯ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ location å®ç°ä¸å½“å‰æµè§ˆå™¨ä½ç½®ä»¥å¤–çš„ä½ç½®ç›¸åŒ¹é…ã€‚</p>\n<p>ä¸‹é¢åˆ—å‡º Route æºç ï¼Œå¹¶ä¸”åˆ å»äº† dev éƒ¨åˆ†ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">\"react\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; isValidElementType &#125; <span class=\"keyword\">from</span> <span class=\"string\">\"react-is\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> PropTypes <span class=\"keyword\">from</span> <span class=\"string\">\"prop-types\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> invariant <span class=\"keyword\">from</span> <span class=\"string\">\"tiny-invariant\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> warning <span class=\"keyword\">from</span> <span class=\"string\">\"tiny-warning\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> RouterContext <span class=\"keyword\">from</span> <span class=\"string\">\"./RouterContext.js\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> matchPath <span class=\"keyword\">from</span> <span class=\"string\">\"./matchPath.js\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * The public API for matching a single path and rendering.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Route</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;RouterContext.Consumer&gt;</span><br><span class=\"line\">        &#123;context =&gt; &#123;</span><br><span class=\"line\">          invariant(context, <span class=\"string\">\"You should not use &lt;Route&gt; outside a &lt;Router&gt;\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"comment\">// å¯ä»¥çœ‹å‡ºï¼Œç”¨æˆ·ä¼ çš„ location è¦†ç›–æ‰äº† context ä¸­çš„ location</span></span><br><span class=\"line\">          <span class=\"keyword\">const</span> location = <span class=\"keyword\">this</span>.props.location || context.location;</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"comment\">// å¦‚æœæœ‰ computedMatch å°±ç”¨ computedMatch ä½œä¸ºç»“æœ</span></span><br><span class=\"line\">          <span class=\"comment\">// å¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ¤æ–­æ˜¯å¦æœ‰ path ä¼ å‚</span></span><br><span class=\"line\">          <span class=\"comment\">// matchPath æ˜¯è°ƒç”¨ path-to-regexp åˆ¤æ–­æ˜¯å¦åŒ¹é…</span></span><br><span class=\"line\">          <span class=\"comment\">// path-to-regexp éœ€è¦ä¸‰ä¸ªå‚æ•°</span></span><br><span class=\"line\">          <span class=\"comment\">// exact: å¦‚æœä¸º trueï¼Œåˆ™åªæœ‰åœ¨è·¯å¾„å®Œå…¨åŒ¹é… location.pathname æ—¶æ‰åŒ¹é…</span></span><br><span class=\"line\">          <span class=\"comment\">// strict: å¦‚æœä¸º true å½“çœŸå®çš„è·¯å¾„å…·æœ‰ä¸€ä¸ªæ–œçº¿å°†åªåŒ¹é…ä¸€ä¸ªæ–œçº¿location.pathname</span></span><br><span class=\"line\">          <span class=\"comment\">// sensitive: å¦‚æœè·¯å¾„åŒºåˆ†å¤§å°å†™ï¼Œåˆ™ä¸º true ï¼Œåˆ™åŒ¹é…</span></span><br><span class=\"line\">          <span class=\"keyword\">const</span> match = <span class=\"keyword\">this</span>.props.computedMatch</span><br><span class=\"line\">            ? <span class=\"keyword\">this</span>.props.computedMatch <span class=\"comment\">// &lt;Switch&gt; already computed the match for us</span></span><br><span class=\"line\">            : <span class=\"keyword\">this</span>.props.path</span><br><span class=\"line\">            ? matchPath(location.pathname, <span class=\"keyword\">this</span>.props)</span><br><span class=\"line\">            : context.match;</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"comment\">// props å°±æ˜¯æ›´æ–°åçš„ context</span></span><br><span class=\"line\">          <span class=\"comment\">// location åšäº†æ›´æ–°ï¼ˆæœ‰å¯èƒ½æ˜¯ç”¨æˆ·ä¼ å…¥çš„locationï¼‰</span></span><br><span class=\"line\">          <span class=\"comment\">// match åšäº†æ›´æ–°</span></span><br><span class=\"line\">          <span class=\"keyword\">const</span> props = &#123; ...context, location, match &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"comment\">// ä¸‰ç§æ¸²æŸ“æ–¹å¼</span></span><br><span class=\"line\">          <span class=\"keyword\">let</span> &#123; children, component, render &#125; = <span class=\"keyword\">this</span>.props;</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"comment\">// Preact uses an empty array as children by</span></span><br><span class=\"line\">          <span class=\"comment\">// default, so use null if that's the case.</span></span><br><span class=\"line\">          <span class=\"comment\">// children é»˜è®¤æ˜¯ä¸ªç©ºæ•°ç»„ï¼Œå¦‚æœæ˜¯é»˜è®¤æƒ…å†µï¼Œç½®ä¸º null</span></span><br><span class=\"line\">          <span class=\"keyword\">if</span> (<span class=\"built_in\">Array</span>.isArray(children) &amp;&amp; children.length === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            children = <span class=\"literal\">null</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">          <span class=\"keyword\">return</span> (</span><br><span class=\"line\">            <span class=\"comment\">// RouterContext ä¸­æ›´æ–°äº† location, match</span></span><br><span class=\"line\">            &lt;RouterContext.Provider value=&#123;props&#125;&gt;</span><br><span class=\"line\">              &#123;props.match</span><br><span class=\"line\">              <span class=\"comment\">// é¦–å…ˆåˆ¤æ–­çš„æ˜¯æœ‰æ—  children</span></span><br><span class=\"line\">                ? children</span><br><span class=\"line\">                  <span class=\"comment\">// å¦‚æœ children æ˜¯ä¸ªå‡½æ•°ï¼Œæ‰§è¡Œï¼Œå¦åˆ™ç›´æ¥è¿”å› children</span></span><br><span class=\"line\">                  ? <span class=\"keyword\">typeof</span> children === <span class=\"string\">\"function\"</span></span><br><span class=\"line\">                  : children(props)</span><br><span class=\"line\">                  : children</span><br><span class=\"line\">                  <span class=\"comment\">// å¦‚æœæ²¡æœ‰ childrenï¼Œåˆ¤æ–­æœ‰æ—  component</span></span><br><span class=\"line\">                : component</span><br><span class=\"line\">                  <span class=\"comment\">// æœ‰ componentï¼Œé‡æ–°æ–°å»ºä¸€ä¸ª component</span></span><br><span class=\"line\">                  ? React.createElement(component, props)</span><br><span class=\"line\">                  <span class=\"comment\">// æ²¡æœ‰ componentï¼Œåˆ¤æ–­æœ‰æ—  render</span></span><br><span class=\"line\">                  : render</span><br><span class=\"line\">                  <span class=\"comment\">// æœ‰ renderï¼Œæ‰§è¡Œ render æ–¹æ³•</span></span><br><span class=\"line\">                  ? render(props)</span><br><span class=\"line\">                  <span class=\"comment\">// æ²¡æœ‰è¿”å› null</span></span><br><span class=\"line\">                  : <span class=\"literal\">null</span></span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">// è¿™é‡Œæ˜¯ä¸ match çš„æƒ…å†µï¼Œåˆ¤æ–­ children æ˜¯å¦å‡½æ•°</span></span><br><span class=\"line\">                : <span class=\"keyword\">typeof</span> children === <span class=\"string\">\"function\"</span></span><br><span class=\"line\">                <span class=\"comment\">// æ˜¯çš„è¯æ‰§è¡Œ</span></span><br><span class=\"line\">                ? children(props)</span><br><span class=\"line\">                : <span class=\"literal\">null</span>&#125;</span><br><span class=\"line\">            &lt;<span class=\"regexp\">/RouterContext.Provider&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">          );</span></span><br><span class=\"line\"><span class=\"regexp\">        &#125;&#125;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;/</span>RouterContext.Consumer&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> Route;</span><br></pre></td></tr></table></figure>\n\n<p>Route ç»„ä»¶æ ¹æ®è‡ªèº«çš„ä¼ å‚ï¼Œå¯¹ä¸Šå±‚ RouterContext ä¸­çš„éƒ¨åˆ†å±æ€§ï¼ˆlocation å’Œ matchï¼‰è¿›è¡Œäº†æ›´æ–°ï¼Œå¹¶ä¸”å¦‚æœå½“å‰è·¯å¾„å’Œé…ç½®çš„ path è·¯å¾„ matchï¼Œåˆ™æ¸²æŸ“è¯¥ç»„ä»¶ï¼Œæ¸²æŸ“çš„æ–¹å¼æœ‰ childrenï¼Œcomponentï¼Œrender ä¸‰ç§æ–¹å¼ï¼Œæˆ‘ä»¬æœ€å¸¸ç”¨çš„å°±æ˜¯ component æ–¹å¼ï¼Œæ³¨æ„æ¯ç§æ–¹å¼çš„åŒºåˆ«ã€‚</p>\n<h2 id=\"Prompt\"><a href=\"#Prompt\" class=\"headerlink\" title=\"Prompt\"></a>Prompt</h2><p>Prompt ç”¨äºè·¯ç”±åˆ‡æ¢æç¤ºã€‚è¿™åœ¨æŸäº›åœºæ™¯ä¸‹æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œæ¯”å¦‚ç”¨æˆ·åœ¨æŸä¸ªé¡µé¢ä¿®æ”¹æ•°æ®ï¼Œç¦»å¼€æ—¶ï¼Œæç¤ºç”¨æˆ·æ˜¯å¦ä¿å­˜ï¼ŒPrompt ç»„ä»¶æœ‰ä¿©ä¸ªå±æ€§ï¼š</p>\n<ol>\n<li>messageï¼šç”¨äºæ˜¾ç¤ºæç¤ºçš„æ–‡æœ¬ä¿¡æ¯ã€‚</li>\n<li>whenï¼šä¼ é€’å¸ƒå°”å€¼ï¼Œç›¸å½“äºæ ‡ç­¾çš„å¼€å…³ï¼Œé»˜è®¤æ˜¯ trueï¼Œè®¾ç½®æˆ false æ—¶ï¼Œå¤±æ•ˆã€‚</li>\n</ol>\n<p>Prompt çš„æœ¬è´¨æ˜¯åœ¨ when ä¸º true çš„æ—¶å€™ï¼Œè°ƒç”¨ context.history.block æ–¹æ³•ï¼Œä¸ºå…¨å±€æ³¨å†Œè·¯ç”±ç›‘å¬ï¼Œblock çš„åŸç†çœ‹ä¹‹å‰çš„ history ç›¸å…³æ–‡ç« ã€‚è·¯æœ‰å˜åŒ–çš„æ—¶å€™ï¼Œé»˜è®¤ä½¿ç”¨ window.confirm è¿›è¡Œç¡®è®¤ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ confirm çš„å½¢å¼ï¼Œå°±æ˜¯åœ¨ BrowserRouter æˆ–è€… HashRouter ä¼ å…¥ getUserConfirmation è¿™ä¸ªå‚æ•°ï¼Œä¼šæ›¿æ¢æ‰ window.confirmã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import React from &quot;react&quot;;</span><br><span class=\"line\">import PropTypes from &quot;prop-types&quot;;</span><br><span class=\"line\">import invariant from &quot;tiny-invariant&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">import Lifecycle from &quot;.&#x2F;Lifecycle.js&quot;;</span><br><span class=\"line\">import RouterContext from &quot;.&#x2F;RouterContext.js&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;**</span><br><span class=\"line\"> * The public API for prompting the user before navigating away from a screen.</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">function Prompt(&#123; message, when &#x3D; true &#125;) &#123;</span><br><span class=\"line\">  return (</span><br><span class=\"line\">    &lt;RouterContext.Consumer&gt;</span><br><span class=\"line\">      &#123;context &#x3D;&gt; &#123;</span><br><span class=\"line\">        invariant(context, &quot;You should not use &lt;Prompt&gt; outside a &lt;Router&gt;&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">        if (!when || context.staticContext) return null;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#x2F;&#x2F; è°ƒç”¨äº† history.block æ–¹æ³•</span><br><span class=\"line\">        const method &#x3D; context.history.block;</span><br><span class=\"line\"></span><br><span class=\"line\">        return (</span><br><span class=\"line\">          &lt;Lifecycle</span><br><span class=\"line\">            onMount&#x3D;&#123;self &#x3D;&gt; &#123;</span><br><span class=\"line\">              self.release &#x3D; method(message);</span><br><span class=\"line\">            &#125;&#125;</span><br><span class=\"line\">            onUpdate&#x3D;&#123;(self, prevProps) &#x3D;&gt; &#123;</span><br><span class=\"line\">              if (prevProps.message !&#x3D;&#x3D; message) &#123;</span><br><span class=\"line\">                self.release();</span><br><span class=\"line\">                self.release &#x3D; method(message);</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            &#125;&#125;</span><br><span class=\"line\">            onUnmount&#x3D;&#123;self &#x3D;&gt; &#123;</span><br><span class=\"line\">              self.release();</span><br><span class=\"line\">            &#125;&#125;</span><br><span class=\"line\">            message&#x3D;&#123;message&#125;</span><br><span class=\"line\">          &#x2F;&gt;</span><br><span class=\"line\">        );</span><br><span class=\"line\">      &#125;&#125;</span><br><span class=\"line\">    &lt;&#x2F;RouterContext.Consumer&gt;</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export default Prompt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Redirect\"><a href=\"#Redirect\" class=\"headerlink\" title=\"Redirect\"></a>Redirect</h2><p>Redirect ä¸å…¶è¯´æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œä¸å¦‚è¯´æ˜¯æœ‰ç»„ä»¶å°è£…çš„ä¸€ç»„æ–¹æ³•ï¼Œè¯¥ç»„ä»¶åœ¨ componentDidMount ç”Ÿå‘½å‘¨æœŸå†…ï¼Œé€šè¿‡è°ƒç”¨ history API è·³è½¬åˆ°åˆ°æ–°ä½ç½®ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ–°ä½ç½®å°†è¦†ç›–å†å²å †æ ˆä¸­çš„å½“å‰ä½ç½®ã€‚</p>\n<p><Redirect to=\"/somewhere/else\"/> to è¡¨ç¤ºè¦é‡å®šå‘åˆ°çš„ç½‘å€ã€‚to ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª location å¯¹è±¡</p>\n<p><Redirect push to=\"/somewhere/else\"/> push ä¸º true æ—¶ï¼Œé‡å®šå‘ä¼šå°†æ–°æ¡ç›®æ¨å…¥å†å²è®°å½•ï¼Œè€Œä¸æ˜¯æ›¿æ¢å½“å‰æ¡ç›®ã€‚</p>\n<p>ç»“åˆ Switch å’Œ Redirect æºç çœ‹ï¼Œå¦‚æœ Redirect ä¸­æœ‰ from å±æ€§ï¼Œä¼šè¢« Switch è·å¾—ï¼Œå½“ from å’Œå½“å‰è·¯å¾„åŒ¹é…çš„æ—¶å€™ï¼Œå°±ä¼šæ¸²æŸ“ Redirect ç»„ä»¶ï¼Œæ‰§è¡Œè·³è½¬ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">\"react\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> PropTypes <span class=\"keyword\">from</span> <span class=\"string\">\"prop-types\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; createLocation, locationsAreEqual &#125; <span class=\"keyword\">from</span> <span class=\"string\">\"history\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> invariant <span class=\"keyword\">from</span> <span class=\"string\">\"tiny-invariant\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> Lifecycle <span class=\"keyword\">from</span> <span class=\"string\">\"./Lifecycle.js\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> RouterContext <span class=\"keyword\">from</span> <span class=\"string\">\"./RouterContext.js\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> generatePath <span class=\"keyword\">from</span> <span class=\"string\">\"./generatePath.js\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * The public API for navigating programmatically with a component.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Redirect</span>(<span class=\"params\">&#123; computedMatch, to, push = false &#125;</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"comment\">// å•¥éƒ½æœ‰çš„å¤§å“¥ RouterContext</span></span><br><span class=\"line\">    &lt;RouterContext.Consumer&gt;</span><br><span class=\"line\">      &#123;context =&gt; &#123;</span><br><span class=\"line\">        invariant(context, <span class=\"string\">\"You should not use &lt;Redirect&gt; outside a &lt;Router&gt;\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> &#123; history, staticContext &#125; = context;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// ä¸€èˆ¬æ¥è¯´ï¼ŒRedirect æ“ä½œéƒ½ä¸éœ€è¦ç•™æœ‰ historyï¼Œæ‰€ä»¥é€‰æ‹©é€‰æ‹© history.replace</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> method = push ? history.push : history.replace;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">const</span> location = createLocation(</span><br><span class=\"line\">          <span class=\"comment\">// computedMatch å°±æ˜¯çœ‹çœ‹ switch æœ‰æ²¡æœ‰å¤šç®¡é—²äº‹</span></span><br><span class=\"line\">          computedMatch</span><br><span class=\"line\">            ? <span class=\"keyword\">typeof</span> to === <span class=\"string\">\"string\"</span></span><br><span class=\"line\">              ? generatePath(to, computedMatch.params)</span><br><span class=\"line\">              : &#123;</span><br><span class=\"line\">                  ...to,</span><br><span class=\"line\">                  pathname: generatePath(to.pathname, computedMatch.params)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            : to</span><br><span class=\"line\">        );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// When rendering in a static context,</span></span><br><span class=\"line\">        <span class=\"comment\">// set the new location immediately.</span></span><br><span class=\"line\">        <span class=\"comment\">// staticRouter ä¸“ç”¨</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (staticContext) &#123;</span><br><span class=\"line\">          method(location);</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> (</span><br><span class=\"line\">          &lt;Lifecycle</span><br><span class=\"line\">            onMount=&#123;() =&gt; &#123;</span><br><span class=\"line\">              <span class=\"comment\">// componentDidMount çš„æ—¶å€™æ‰§è¡Œ method(location)ï¼Œä¹Ÿå°±æ˜¯ history.replace æ“ä½œ</span></span><br><span class=\"line\">              method(location);</span><br><span class=\"line\">            &#125;&#125;</span><br><span class=\"line\">            onUpdate=&#123;(self, prevProps) =&gt; &#123;</span><br><span class=\"line\">              <span class=\"comment\">// componentDidUpdate æ—¶å€™åˆ¤æ–­å½“å‰ location å’Œä¸Šä¸€ä¸ª location æ˜¯å¦å‘ç”Ÿå˜åŒ–</span></span><br><span class=\"line\">              <span class=\"comment\">// åªè¦å‘ç”Ÿå˜åŒ–ï¼Œè°ƒç”¨ method(location)</span></span><br><span class=\"line\">              <span class=\"comment\">// ä¸€èˆ¬æ¥è®²ï¼Œåœ¨ componentDidMount çš„æ—¶å€™å°±è·³èµ°äº†ï¼Œä¸ä¼šç­‰åˆ° componentDidUpdate</span></span><br><span class=\"line\">              <span class=\"keyword\">const</span> prevLocation = createLocation(prevProps.to);</span><br><span class=\"line\">              <span class=\"keyword\">if</span> (</span><br><span class=\"line\">                !locationsAreEqual(prevLocation, &#123;</span><br><span class=\"line\">                  ...location,</span><br><span class=\"line\">                  key: prevLocation.key</span><br><span class=\"line\">                &#125;)</span><br><span class=\"line\">              ) &#123;</span><br><span class=\"line\">                method(location);</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            &#125;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// æ— æ•ˆ</span></span><br><span class=\"line\">            to=&#123;to&#125;</span><br><span class=\"line\">          /&gt;</span><br><span class=\"line\">        );</span><br><span class=\"line\">      &#125;&#125;</span><br><span class=\"line\">    &lt;<span class=\"regexp\">/RouterContext.Consumer&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  );</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">export default Redirect;</span></span><br></pre></td></tr></table></figure>\n\n<p>Lifecycle ä¸ render ä»»ä½•é¡µé¢ï¼Œåªæœ‰ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼ŒLifecycle æä¾›äº† onMountï¼Œ onUpdateï¼Œ onUnmount ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">\"react\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Lifecycle</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  componentDidMount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.props.onMount) <span class=\"keyword\">this</span>.props.onMount.call(<span class=\"keyword\">this</span>, <span class=\"keyword\">this</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentDidUpdate(prevProps) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.props.onUpdate) <span class=\"keyword\">this</span>.props.onUpdate.call(<span class=\"keyword\">this</span>, <span class=\"keyword\">this</span>, prevProps);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  componentWillUnmount() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.props.onUnmount) <span class=\"keyword\">this</span>.props.onUnmount.call(<span class=\"keyword\">this</span>, <span class=\"keyword\">this</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> Lifecycle;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"æ€»ç»“-2\"><a href=\"#æ€»ç»“-2\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h1><p>æ•´ä¸ª<code>react-router</code>æ˜¯ç”±<code>createBrowserHistory</code>æˆ–è€…<code>createHashHistory</code>æ¥ç‰µå¤´ï¼Œä¸æˆ‘ä»¬çš„<code>React</code>ç»„ä»¶ç»‘å®šåœ¨ä¸€èµ·ï¼Œç„¶åä¼ é€’äº†ä¸€äº›å±äº<code>history</code>è¿™ä¸ªåº“çš„æ–¹æ³•ä»¥åŠæ•°å€¼ã€‚å½“ç„¶ï¼Œè¿˜æœ‰è·¯ç”±çš„åŒ¹é…å’Œæ¸²æŸ“ã€‚</p>\n<p>åœ¨<code>history</code>è¿™ä¸ªåº“é‡Œé¢åˆæœ‰å¯¹äºè·¯ç”±çš„ç›‘å¬ï¼Œæ”¹å˜ç­‰ç­‰ã€‚</p>\n<h2 id=\"æµç¨‹\"><a href=\"#æµç¨‹\" class=\"headerlink\" title=\"æµç¨‹\"></a>æµç¨‹</h2><p>ä»¥<code>history</code>æ¨¡å¼åšå‚è€ƒï¼ˆä¹Ÿæ˜¯æˆ‘ä»¬é‡ç‚¹é˜…è¯»çš„ã€‚</p>\n<h3 id=\"ä¿®æ”¹url\"><a href=\"#ä¿®æ”¹url\" class=\"headerlink\" title=\"ä¿®æ”¹url\"></a>ä¿®æ”¹url</h3><p>å½“<code>url</code>æ”¹å˜çš„æ—¶å€™ï¼Œä¼šè§¦å‘å†™åœ¨<code>window</code>ä¸Šé¢çš„ç›‘å¬<code>window.addEventListener(&#39;popstate&#39;, handlePop)</code>ã€‚</p>\n<p>è°ƒç”¨äº†æˆ‘ä»¬çš„å‡½æ•°<code>handlePop</code></p>\n<p>å‡½æ•°å†…éƒ¨æˆ‘ä»¬<code>setState</code>ï¼Œä¿®æ”¹äº†<code>location</code>ï¼Œæ–¹ä¾¿ä¼ é€’æ­£ç¡®çš„å€¼ä¸‹å»ï¼Œå¹¶é€šè¿‡äº†<code>Switch</code>æ‰¾å‡ºåŒ¹é…çš„<code>Route</code>ç»„ä»¶ã€‚</p>\n<p>è§¦å‘äº†ç»„ä»¶çš„æ¸²æŸ“ã€‚</p>\n<blockquote>\n<p>å½“ç„¶ä¹ŸåŒ…æ‹¬æˆ‘ä»¬æ‰€è°“çš„history.pushï¼Œhistory.repalceç­‰ç­‰è¿™äº›æ–¹æ³•ï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¿®æ”¹urlï¼Œç„¶åå°±æ˜¯é‡å¤ä¸Šé¢çš„æ­¥éª¤</p>\n</blockquote>\n"},{"title":"ã€é‡è¯†å‰ç«¯ã€‘Reactæºç é˜…è¯»ï¼ˆä¸‰ï¼‰4åƒå­—å‘Šè¯‰ä½  Fiber åˆå§‹åŒ–","date":"2021-04-06T06:08:31.000Z","cover":"/image/cover/react.png","_content":"\n# å‰è¨€\n\nåœ¨ç¬¬ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬è§£è¯»åˆ°ReactDOM.renderä¹‹åå°±æ²¡æœ‰ç»§ç»­äº†ã€‚å› ä¸ºæˆ‘çœ‹äº†ä¸€ä¸‹è®¾è®¡åˆ°äº†Fiberçš„ä¸€äº›çŸ¥è¯†ï¼Œæ‰€ä»¥åœ¨ç¬¬äºŒç« è¡¥å……äº†Fiberçš„åŸºç¡€çŸ¥è¯†ä¹‹åï¼Œæˆ‘å°†Fiberæ‹†åˆ†æˆå››å—æ¥è®²\n\n- åŠ¨æœºï¼ˆæˆ–è€…è¯´åˆè¡·\n- åˆå§‹åŒ–-Fiberæ ‘çš„å‡†å¤‡å·¥ä½œ\n- render-Fiberæ ‘çš„æ„å»º\n- commit-Fiberæ ‘æ˜ å°„åˆ°DOM\n\nç°åœ¨æ˜¯åˆå§‹åŒ–é˜¶æ®µ\n\næˆ‘ä»¬ç°åœ¨ç›´æ¥è¿›å…¥Fiberçš„åˆå§‹åŒ–ã€‚Actionï¼\n\n# å‰æƒ…å›é¡¾\n\nå›é¡¾ä¸€ä¸‹ä¹‹å‰å­¦ä¹ JSXçš„æ—¶å€™ï¼Œé˜…è¯»åˆ°ReactDOM.renderã€‚å¦‚æœä½ æ²¡æœ‰é˜…è¯»è¿‡ä¹‹å‰çš„æ–‡ç« ï¼Œå¼ºçƒˆå»ºè®®ä½ åˆ°æˆ‘çš„ä¸»é¡µå»é˜…è¯»æˆ‘ä¹‹å‰çš„åšå®¢ã€‚ä¸‹é¢æˆ‘ä»¬å¼€å§‹ã€‚\n\nReactDOM.renderçš„æºç ã€‚\n\n```typescript\nexport function isValidContainer(node: mixed): boolean {\n  return !!(\n    node &&\n    (node.nodeType === ELEMENT_NODE ||\n      node.nodeType === DOCUMENT_NODE ||\n      node.nodeType === DOCUMENT_FRAGMENT_NODE ||\n      (node.nodeType === COMMENT_NODE &&\n        (node: any).nodeValue === ' react-mount-point-unstable '))\n  );\n}\n\nexport function render(\n  element: React$Element<any>,\n  container: Container,\n  callback: ?Function,\n) {\n  // ç”¨äºæŠ›å‡ºé”™è¯¯çš„, å°±æ˜¯åˆ¤æ–­è¿™ä¸ªcontaineræ˜¯ä¸æ˜¯æ‰¾å¾—åˆ°\n  invariant(\n    isValidContainer(container),\n    'Target container is not a DOM element.',\n  );\n  if (__DEV__) {\n    const isModernRoot =\n      isContainerMarkedAsRoot(container) &&\n      container._reactRootContainer === undefined;\n    if (isModernRoot) {\n      console.error(\n        'You are calling ReactDOM.render() on a container that was previously ' +\n          'passed to ReactDOM.createRoot(). This is not supported. ' +\n          'Did you mean to call root.render(element)?',\n      );\n    }\n  }\n  \n  // è¿™é‡Œé¢æ¶‰åŠåˆ°äº†fiberçš„ä¸€äº›æ¶æ„ï¼Œå¼€å§‹è¡¥å‘\n  return legacyRenderSubtreeIntoContainer(\n    null,\n    element,\n    container,\n    false,\n    callback,\n  );\n}\n```\n\næœ€åreturnçš„è¿™ä¸ªå‡½æ•°æœ‰ç‚¹æ„æ€ã€‚\n\n# æºç æ”»è¯»\n\n## legacyRenderSubtreeIntoContainer\n\næˆ‘ä»¬é¦–å…ˆç¿»è¯‘ä¸€ä¸‹è¿™ä¸ªå‡½æ•°çš„åå­—ï¼Œè¿›è¡Œé©¼å³°æ‹†åˆ†ï¼š\n\n> Googleç¿»è¯‘ï¼šlegacy Render Subtree Into Containerï¼ˆæ—§ç‰ˆæ¸²æŸ“å­æ ‘æ”¾å…¥å®¹å™¨\n\nå…ˆåˆ«æ€¥ç€ç¿»è¯‘ã€‚æˆ‘ä»¬å…ˆçœ‹çœ‹æºç ã€‚\n\n```typescript\nfunction legacyRenderSubtreeIntoContainer(parentComponent, children, container, forceHydrate, callback) {\n  // container å¯¹åº”çš„æ˜¯æˆ‘ä»¬ä¼ å…¥çš„çœŸå® DOM å¯¹è±¡\n  var root = container._reactRootContainer;\n  // åˆå§‹åŒ– fiberRoot å¯¹è±¡\n  var fiberRoot;\n  // DOM å¯¹è±¡æœ¬èº«ä¸å­˜åœ¨ _reactRootContainer å±æ€§ï¼Œå› æ­¤ root ä¸ºç©º\n  if (!root) {\n    // è‹¥ root ä¸ºç©ºï¼Œåˆ™åˆå§‹åŒ– _reactRootContainerï¼Œå¹¶å°†å…¶å€¼èµ‹å€¼ç»™ root\n    // legacyCreateRootFromDOMContainer ä¸»è¦çš„åŠŸèƒ½æ˜¯åˆ›å»ºï¼Œå¹¶ä¸”è¿›è¡Œä¸€äº›â€œè„åˆ¤æ–­â€ã€‚æ„Ÿå…´è¶£çš„ï¼Œæˆ‘åœ¨åé¢ä¹Ÿä¼šè¯¦ç»†ç»™å‡º\n    root = container._reactRootContainer = legacyCreateRootFromDOMContainer(container, forceHydrate);\n    // legacyCreateRootFromDOMContainer åˆ›å»ºå‡ºçš„å¯¹è±¡ä¼šæœ‰ä¸€ä¸ª _internalRoot å±æ€§ï¼Œå°†å…¶èµ‹å€¼ç»™ fiberRoot\n    fiberRoot = root._internalRoot;\n\n    // è¿™é‡Œå¤„ç†çš„æ˜¯ ReactDOM.render å…¥å‚ä¸­çš„å›è°ƒå‡½æ•°ï¼Œä½ äº†è§£å³å¯\n    if (typeof callback === 'function') {\n      var originalCallback = callback;\n      callback = function () {\n        var instance = getPublicRootInstance(fiberRoot);\n        originalCallback.call(instance);\n      };\n    } // Initial mount should not be batched.\n    // è¿›å…¥ unbatchedUpdates æ–¹æ³•\n    unbatchedUpdates(function () {\n      updateContainer(children, fiberRoot, parentComponent, callback);\n    });\n  } else {\n    // else é€»è¾‘å¤„ç†çš„æ˜¯éé¦–æ¬¡æ¸²æŸ“çš„æƒ…å†µï¼ˆå³æ›´æ–°ï¼‰ï¼Œå…¶é€»è¾‘é™¤äº†è·³è¿‡äº†åˆå§‹åŒ–å·¥ä½œï¼Œä¸æ¥¼ä¸ŠåŸºæœ¬ä¸€è‡´\n    fiberRoot = root._internalRoot;\n    if (typeof callback === 'function') {\n      var _originalCallback = callback;\n      callback = function () {\n        var instance = getPublicRootInstance(fiberRoot);\n        _originalCallback.call(instance);\n      };\n    } // Update\n\n    updateContainer(children, fiberRoot, parentComponent, callback);\n  }\n  return getPublicRootInstance(fiberRoot);\n}\n```\n\næ¢³ç†ä¸€ä¸‹æ•´ä¸ªæµç¨‹ï¼Œç„¶åæˆ‘ä»¬å†ä¸€ä¸€çœ‹è¿™äº›å‡½æ•°ã€‚\n\nä»¥ä¸‹æµç¨‹æ˜¯æŒ‡åˆå§‹åŒ–ï¼Œä¹Ÿå°±æ˜¯`if/else`åˆ¤æ–­é‡Œé¢çš„`if`ã€‚è€Œä¸æ˜¯`else`ï¼Œ`else`æ˜¯éé¦–æ¬¡æ¸²æŸ“ï¼Œèµ°çš„æ›´æ–°æµç¨‹ï¼Œæ³¨é‡Šé‡Œé¢å†™äº†ã€‚\n\n1. åˆ›å»º`container._reactRootContainer`å¯¹è±¡ï¼Œå¹¶èµ‹å€¼ç»™`root`\n2. å°†`root`ä¸Šçš„`_inernalRoot`èµ‹å€¼ç»™`fiberRoot`\n3. å°†`legacyRenderSubtreeIntoContainer`çš„ä¸€äº›å‚æ•°å’Œ`fiberRoot`ä¸€èµ·ä¼ ç»™`updateContainer`\n4. `å°†updateConatiner`ä½œä¸ºå›è°ƒå‡½æ•°ä¼ ç»™`unbatechedUpdates`\n\nokï¼Œç°åœ¨çœ‹ä¸å¤ªæ‡‚æ²¡å…³ç³»ã€‚æˆ‘ä»¬å°†é‡Œé¢ç”¨åˆ°çš„å‡½æ•°ä¸€ä¸€è§£è¯»ï¼Œç„¶åå†å›æ¥è¡¥å……æ•´ä¸ªæµç¨‹ã€‚\n\n## legacyCreateRootFromDOMContainer\n\nå¤§å®¶ç°åœ¨ä¸€å®šä¼šæ™•å¤´è½¬å‘ï¼Œå› ä¸ºæˆ‘çœ‹çš„æ—¶å€™ä¹Ÿæ˜¯è¿™æ ·ï¼Œä»–çš„åå­—å’Œå‡½æ•°åå­—å–çš„å¤ªåƒäº†ï¼Œæˆ‘ä»¬éœ€è¦ç»™ä»–ä»¬ç‹¬è‡ªç”¨è‡ªå·±çš„æ–¹å¼å‘½åã€‚æˆ‘ä¼šå†™ä¸‹Googleç¿»è¯‘ï¼Œ å¸®åŠ©å¤§å®¶å–åå­—ã€‚\n\n> Googleç¿»è¯‘ï¼šlegacy Create Root From DOM Containerï¼ˆä»DOMå®¹å™¨åˆ›å»ºæ ¹ç›®å½•\n\nçœ‹äº†ç¿»è¯‘ä¹‹åæ˜¯ä¸æ˜¯ç„•ç„¶å¤§æ‚Ÿï¼Ÿåˆ«æ€¥ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹æºç ã€‚\n\n```typescript\nfunction legacyCreateRootFromDOMContainer(\n  container: Container,\n  forceHydrate: boolean,\n): RootType {\n    // å¦‚æœforceHydrateæ˜¯falseï¼Œå°±ä¼šè°ƒç”¨åé¢çš„æ–¹æ³•ã€‚\n  const shouldHydrate =\n    forceHydrate || shouldHydrateDueToLegacyHeuristic(container);\n  // First clear any existing content.\n  if (!shouldHydrate) {\n    let warned = false;\n    let rootSibling;\n    // è¿™ä¸ªå¾ªç¯ï¼Œæ˜¯ä¸ºäº†æ¸…ç†æ‰€æœ‰çš„å†…å®¹ï¼Œç„¶åæ‰¾åˆ°æˆ‘ä»¬è¦æ¸²æŸ“çš„æœ€åˆçš„æ ¹divã€‚é€šå¸¸æˆ‘ä»¬çš„htmlä¼šæœ‰ä¸€ä¸ª\n    // <div id=\"root\"></div> ä¸ºçš„å°±æ˜¯ä¿éšœä»–çš„çº¯å‡€ã€‚\n    while ((rootSibling = container.lastChild)) {\n      if (__DEV__) {\n        if (\n          !warned &&\n          rootSibling.nodeType === ELEMENT_NODE &&\n          (rootSibling: any).hasAttribute(ROOT_ATTRIBUTE_NAME)\n        ) {\n          warned = true;\n          console.error(\n            'render(): Target node has markup rendered by React, but there ' +\n              'are unrelated nodes as well. This is most commonly caused by ' +\n              'white-space inserted around server-rendered markup.',\n          );\n        }\n      }\n      container.removeChild(rootSibling);\n    }\n  }\n  if (__DEV__) {\n    if (shouldHydrate && !forceHydrate && !warnedAboutHydrateAPI) {\n      warnedAboutHydrateAPI = true;\n      console.warn(\n        'render(): Calling ReactDOM.render() to hydrate server-rendered markup ' +\n          'will stop working in React v18. Replace the ReactDOM.render() call ' +\n          'with ReactDOM.hydrate() if you want React to attach to the server HTML.',\n      );\n    }\n  }\n\n  return createLegacyRoot(\n    container,\n    shouldHydrate\n      ? {\n          hydrate: true,\n        }\n      : undefined,\n  );\n}\n```\n\né‡Œé¢åˆç”¨åˆ°ä¸¤ä¸ªå‡½æ•°ï¼Œæˆ‘ä¸ºå¤§å®¶å¬å‡ºæ¥ã€‚\n\n### shouldHydrateDueToLegacyHeuristic\n\n\n\n```typescript\nfunction getReactRootElementInContainer(container: any) {\n  // å¦‚æœæ²¡æœ‰å°±è¿”å›null\n  if (!container) {\n    return null;\n  }\n  // å†…éƒ¨å®šä¹‰çš„ä¸€ä¸ªå¸¸é‡\n  // export const DOCUMENT_NODE = 9;çœ‹åå­—å°±é¡¾åæ€ä¹‰äº†\n  // å¦‚æœæ˜¯å†…éƒ¨ä¸€ä¸ªdocumentèŠ‚ç‚¹å°±è¿”å›documentèŠ‚ç‚¹\n  // æ„Ÿå…´è¶£å¯ä»¥çœ‹çœ‹MDNçš„ä»‹ç»ï¼šhttps://developer.mozilla.org/zh-CN/docs/Web/API/Document\n  // å¸¸é‡çš„å€¼ä¹Ÿæœ‰ï¼šhttps://developer.mozilla.org/zh-CN/docs/Web/API/Node/nodeType\n  if (container.nodeType === DOCUMENT_NODE) {\n    return container.documentElement;\n  } else {\n    // å¦åˆ™è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ \n    return container.firstChild;\n  }\n}\n\nfunction shouldHydrateDueToLegacyHeuristic(container) {\n  // å°†containerä¼ å…¥å‡½æ•°ï¼Œè¿›è¡Œåˆ¤æ–­ç±»å‹ï¼Œå¹¶å¾—åˆ°èŠ‚ç‚¹ï¼ˆæœ‰å¯èƒ½ä¸ºç©ºï¼Œçœ‹æ³¨é‡Š\n  const rootElement = getReactRootElementInContainer(container);\n  // å¼ºè½¬ä¸ºå¸ƒå°”å€¼\n  return !!(\n    rootElement &&\n    rootElement.nodeType === ELEMENT_NODE &&\n    // export const ROOT_ATTRIBUTE_NAME = 'data-reactroot'; \n    rootElement.hasAttribute(ROOT_ATTRIBUTE_NAME)\n  );\n}\n```\n\næˆ‘ä»¬çœ‹åˆ°ä¸€ä¸ªhasAttributeä¸º\"data-reactroot\"ã€‚è¿™æ˜¯ React åœ¨æœåŠ¡ç«¯æ¸²æŸ“çš„æ—¶å€™åŠ ä¸Šå»çš„ã€‚ä¹‹å‰æœ‰è¯´è¿‡Hydrateè¿™ä¸ªæ“ä½œæ˜¯æœåŠ¡ç«¯æ¸²æŸ“çš„æ—¶å€™éœ€è¦çš„ä¸œè¥¿ã€‚\n\n> Googleç¿»è¯‘ï¼šgetReactRootElementInContainerï¼ˆè·å–å®¹å™¨ä¸­çš„Reactæ ¹å…ƒç´ \n>\n> Googleç¿»è¯‘ï¼šshouldHydrateDueToLegacyHeuristicï¼ˆåº”å½“å› ä¼ ç»Ÿå¯å‘è€Œæ°´åˆ\n>\n> è¯´äººè¯å°±æ˜¯æ˜¯å¦éœ€è¦è¿›è¡Œhydrateæ“ä½œ\n\næ‰€ä»¥`legacyCreateRootFromDOMContainer`è¿™ä¸ªå‡½æ•°æ˜¯ä¿éšœ`container`çš„çº¯å‡€ã€‚å¹¶ä¸”è¿”å›`createLegacyRoot`å‡½æ•°ã€‚okç»§ç»­çœ‹ã€‚\n\n### createLegacyRoot\n\n```typescript\nfunction ReactDOMLegacyRoot(container: Container, options: void | RootOptions) {\n  // æ˜¯ä¸æ˜¯çœ‹è§è€æœ‹å‹äº†ã€‚_internalRootã€‚ç»§ç»­çœ‹ä¸‹é¢çš„å†…å®¹ï¼Œæˆ‘ä»¬æ¥è§£æä¸€ä¸‹createRootImpl\n  this._internalRoot = createRootImpl(container, LegacyRoot, options);\n}\n\nexport function createLegacyRoot(\n  container: Container,\n  options?: RootOptions,\n): RootType {\n  // åˆæ˜¯ç†Ÿæ‚‰çš„æ“ä½œï¼Œè¿”å›æŸä¸ªä¸œè¥¿\n  return new ReactDOMLegacyRoot(container, options);\n}\n```\n\n### createRootImpl\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬é€šç¯‡éƒ½æ˜¯ä»¥é`hydrate`æ¥çœ‹çš„ï¼Œå› ä¸ºæˆ‘ä»¬ä¸æ˜¯æœåŠ¡ç«¯æ¸²æŸ“ã€‚ä½†æ˜¯æˆ‘ä¹Ÿä¼šä»‹ç»å¦‚æœæœ‰`hydrate`çš„å†…å®¹ã€‚æ‰€ä»¥å¤§å®¶çœ‹çš„æ—¶å€™å¯ä»¥ç¨å¾®å¸¦å…¥ä¸€ç‚¹å»çœ‹ï¼Œä¸ç„¶å¾ˆå®¹æ˜“èµ°ç¥ï¼\n\n```typescript\n// åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªfiberRoot\nfunction createRootImpl(\n  container: Container,\n  tag: RootTag,\n  options: void | RootOptions,\n) {\n  // Tag is either LegacyRoot or Concurrent Root\n  // åˆ¤æ–­æ˜¯å¦ä¸ºhydrateæ¨¡å¼\n  const hydrate = options != null && options.hydrate === true;\n  const hydrationCallbacks =\n    (options != null && options.hydrationOptions) || null;\n  const mutableSources =\n    (options != null &&\n      options.hydrationOptions != null &&\n      options.hydrationOptions.mutableSources) ||\n    null;\n  const strictModeLevelOverride =\n    options != null && options.unstable_strictModeLevel != null\n      ? options.unstable_strictModeLevel\n      : null;\n  // åˆ›å»ºä¸€ä¸ªfiberRoot\n  const root = createContainer(\n    container,\n    tag,\n    hydrate,\n    hydrationCallbacks,\n    strictModeLevelOverride,\n  );\n  // ç»™containeré™„åŠ ä¸€ä¸ªå†…éƒ¨å±æ€§ç”¨äºæŒ‡å‘fiberRootçš„currentå±æ€§å¯¹åº”çš„rootFiberèŠ‚ç‚¹\n  markContainerAsRoot(root.current, container);\n\n  const rootContainerElement =\n    container.nodeType === COMMENT_NODE ? container.parentNode : container;\n  listenToAllSupportedEvents(rootContainerElement);\n\n  if (mutableSources) {\n    for (let i = 0; i < mutableSources.length; i++) {\n      const mutableSource = mutableSources[i];\n      registerMutableSourceForHydration(root, mutableSource);\n    }\n  }\n\n  return root;\n}\n```\n\nä¸ºä»€ä¹ˆæˆ‘åœ¨æ³¨é‡Šé‡Œé¢ä¼šåŠ ä¸Šã€Œåˆ›å»ºä¸€ä¸ªfiberRootã€ï¼Œä¸æ˜¯ä¸€ä¸ªæ˜¯åˆ›å»ºä¸€ä¸ªcontainerå—ï¼Ÿæˆ‘ä»¬çœ‹createContaineré‡Œé¢åšäº†ä»€ä¹ˆã€‚\n\n\n\n### createContainer\n\n```typescript\nexport function createFiberRoot(\n  containerInfo: any,\n  tag: RootTag,\n  hydrate: boolean,\n  hydrationCallbacks: null | SuspenseHydrationCallbacks,\n  strictModeLevelOverride: null | number,\n): FiberRoot {\n  // é€šè¿‡FiberRootNodeæ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªfiberRootå®ä¾‹\n  const root: FiberRoot = (new FiberRootNode(containerInfo, tag, hydrate): any);\n  // å¦‚æœæœ‰ï¼Œå°±è¡¥å……è¿›è¿™ä¸ªå›è°ƒå‡½æ•°\n  if (enableSuspenseCallback) {\n    root.hydrationCallbacks = hydrationCallbacks;\n  }\n\n  // Cyclic construction. This cheats the type system right now because\n  // stateNode is any.\n  // é€šè¿‡createHostRootFiberæ–¹æ³•åˆ›å»ºfiber treeçš„æ ¹ç»“ç‚¹ï¼Œå³rootFiber\n  // fiberèŠ‚ç‚¹ä¹Ÿä¼šåƒDOMæ ‘ç»“æ„ä¸€æ ·å½¢æˆä¸€ä¸ªfiber treeå•é“¾è¡¨æ ‘ç»“æ„\n  // æ¯ä¸ªDOMèŠ‚ç‚¹æˆ–è€…ç»„ä»¶éƒ½ä¼šç”Ÿæˆä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„fiberèŠ‚ç‚¹ï¼Œåœ¨åç»­çš„è°ƒå’Œ(reconciliation)é˜¶æ®µèµ·ç€è‡³å…³é‡è¦çš„ä½œç”¨\n  const uninitializedFiber = createHostRootFiber(tag, strictModeLevelOverride);\n  // åˆ›å»ºå®ŒrootFiberä¹‹åï¼Œä¼šå°†fiberRootçš„å®ä¾‹çš„currentå±æ€§æŒ‡å‘åˆšåˆ›å»ºçš„rootFiber\n  root.current = uninitializedFiber;\n  // åŒæ—¶rootFiberçš„stateNodeå±æ€§ä¼šæŒ‡å‘fiberRootå®ä¾‹ï¼Œå½¢æˆç›¸äº’å¼•ç”¨\n  uninitializedFiber.stateNode = root;\n\n  if (enableCache) {\n    const initialCache = new Map();\n    root.pooledCache = initialCache;\n    const initialState = {\n      element: null,\n      cache: initialCache,\n    };\n    uninitializedFiber.memoizedState = initialState;\n  } else {\n    const initialState = {\n      element: null,\n    };\n    uninitializedFiber.memoizedState = initialState;\n  }\n\n  initializeUpdateQueue(uninitializedFiber);\n\t// æœ€åå°†åˆ›å»ºçš„fiberRootå®ä¾‹è¿”å›\n  return root;\n}\n\n// å†…éƒ¨è°ƒç”¨createFiberRootæ–¹æ³•è¿”å›ä¸€ä¸ªfiberRootå®ä¾‹\nexport function createContainer(\n  containerInfo: Container,\n  tag: RootTag,\n  hydrate: boolean,\n  hydrationCallbacks: null | SuspenseHydrationCallbacks,\n  strictModeLevelOverride: null | number,\n): OpaqueRoot {\n  return createFiberRoot(\n    containerInfo,\n    tag,\n    hydrate,\n    hydrationCallbacks,\n    strictModeLevelOverride,\n  );\n}\n```\n\nè¿™é‡Œä¹Ÿæ¯”è¾ƒç®€å•ï¼Œåªæ˜¯å•çº¯çš„è°ƒç”¨å‡½æ•°ï¼Œç„¶åè¿”å›ã€‚çœŸæ­£çš„ç§˜å¯†å°±åœ¨è¿™äº›å‡½æ•°é‡Œé¢ï¼Œè€å¿ƒç‚¹ç»§ç»­çœ‹ï¼é»æ˜å°±åœ¨çœ¼å‰\n\n\n\n#### FiberRootNode\n\nä¸€ä¸ªéå¸¸ææ€–çš„å†…å®¹ã€‚ä½†æ˜¯çœ‹åå­—ä¹Ÿèƒ½çŒœä¸ªå¤§æ¦‚ã€‚è¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰è¯´è¿‡ã€‚ä¸€ä¸ªfiberèŠ‚ç‚¹è¦å­˜çš„å†…å®¹è¿˜è›®å¤šçš„ã€‚æ¯”å¦‚è¢«æš‚åœæ—¶çš„çŠ¶æ€ï¼Œæ¢å¤æ—¶è¦åšçš„äº‹æƒ…ï¼Œä¼˜å…ˆçº§ç­‰ç­‰....è¿™é‡Œæˆ‘å°½å¯èƒ½çš„å»å†™æ³¨é‡Šã€‚å¸®åŠ©å¤§å®¶è¿˜è¦æˆ‘è‡ªå·±ç†è§£ã€‚\n\n```typescript\nfunction FiberRootNode(containerInfo, tag, hydrate) {\n  //root èŠ‚ç‚¹ç±»å‹()\n  this.tag = tag;\n  //rootæ ¹èŠ‚ç‚¹ï¼Œrenderæ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°\n  this.containerInfo = containerInfo;\n  //åœ¨æŒä¹…æ›´æ–°ä¸­ä¼šç”¨åˆ°ï¼Œä¸æ”¯æŒå¢é‡æ›´æ–°çš„å¹³å°ï¼Œreact-dom æ˜¯æ•´ä¸ªåº”ç”¨æ›´æ–°ï¼Œæ‰€ä»¥ç”¨ä¸åˆ°\n  this.pendingChildren = null;\n  //å½“å‰åº”ç”¨rootèŠ‚ç‚¹å¯¹åº”çš„Fiberå¯¹è±¡\n  this.current = null;\n  //ç¼“å­˜\n  this.pingCache = null;\n  //å·²ç»å®Œæˆä»»åŠ¡çš„FiberRootå¯¹è±¡ï¼Œåœ¨commit(æäº¤)é˜¶æ®µåªä¼šå¤„ç†è¯¥å€¼å¯¹åº”çš„ä»»åŠ¡\n  this.finishedWork = null;\n  //åœ¨ä»»åŠ¡è¢«æŒ‚èµ·çš„æ—¶å€™é€šè¿‡setTimeoutè®¾ç½®çš„è¿”å›å†…å®¹ï¼Œç”¨æ¥ä¸‹ä¸€æ¬¡å¦‚æœæœ‰æ–°çš„ä»»åŠ¡æŒ‚èµ·æ—¶æ¸…ç†è¿˜æ²¡è§¦å‘çš„timeout\n  this.timeoutHandle = noTimeout;\n  //é¡¶å±‚ context å¯¹è±¡ï¼Œåªæœ‰ä¸»åŠ¨è°ƒç”¨renderSubtreeIntoContaineræ‰ä¼šç”Ÿæ•ˆ\n  this.context = null;\n  this.pendingContext = null;\n  // è€æœ‹å‹äº†ï¼Œç”¨æ¥ç¡®å®šç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™æ˜¯å¦éœ€è¦æ³¨æ°´\n  this.hydrate = hydrate;\n  //å›è°ƒèŠ‚ç‚¹\n  this.callbackNode = null;\n  //å›è°ƒå±æ€§\n  this.callbackPriority = NoLane;\n  // export const NoLanes: Lanes = 0b0000000000000000000000000000000;\n  /*\n  export function createLaneMap<T>(initial: T): LaneMap<T> {\n    // Intentionally pushing one by one.\n    // https://v8.dev/blog/elements-kinds#avoid-creating-holes\n    const laneMap = [];\n    for (let i = 0; i < TotalLanes; i++) {\n      laneMap.push(initial);\n    }\n    return laneMap;\n  }\n  */\n  //ä»»åŠ¡æ—¶é—´ã€‚ç”±äºè¯¥å­—æ®µåœ¨æœªæ¥ä¼šé‡æ„ï¼Œå½“å‰æˆ‘ä»¬ä¸éœ€è¦ç†è§£ä»–ã€‚\n  this.eventTimes = createLaneMap(NoLanes);\n  // è¿‡æœŸæ—¶é—´ã€‚å‡½æ•°ä¸Šé¢çš„æ³¨é‡Šæœ‰ã€‚export const NoTimestamp = -1;\n  this.expirationTimes = createLaneMap(NoTimestamp);\n\n  // ä¼˜å…ˆçº§çš„åˆå§‹åŒ–\n  this.pendingLanes = NoLanes;\n  this.suspendedLanes = NoLanes;\n  this.pingedLanes = NoLanes;\n  this.mutableReadLanes = NoLanes;\n  this.finishedLanes = NoLanes;\n\n  this.entangledLanes = NoLanes;\n  this.entanglements = createLaneMap(NoLanes);\n\n  if (enableCache) {\n    this.pooledCache = null;\n    this.pooledCacheLanes = NoLanes;\n  }\n\n  if (supportsHydration) {\n    this.mutableSourceEagerHydrationData = null;\n  }\n\n  if (enableSchedulerTracing) {\n    this.interactionThreadID = unstable_getThreadID();\n    this.memoizedInteractions = new Set();\n    this.pendingInteractionMap = new Map();\n  }\n  if (enableSuspenseCallback) {\n    this.hydrationCallbacks = null;\n  }\n\n  if (enableProfilerTimer && enableProfilerCommitHooks) {\n    this.effectDuration = 0;\n    this.passiveEffectDuration = 0;\n  }\n\n  if (__DEV__) {\n    switch (tag) {\n      case ConcurrentRoot:\n        this._debugRootType = 'createRoot()';\n        break;\n      case LegacyRoot:\n        this._debugRootType = 'createLegacyRoot()';\n        break;\n    }\n  }\n}\n```\n\n\n\n#### createHostRootFiber\n\né€šç¯‡å¤§è®ºéƒ½æ˜¯åœ¨åˆ¤æ–­modeç±»å‹ã€‚æ„Ÿå…´è¶£çš„å¯ä»¥å†æ·±æŒ–ã€‚è¿™é‡Œæˆ‘å°±ç•¥è¿‡äº†ã€‚çœ¼ç›å·²ç»çœ‹èŠ±äº†ã€‚ã€‚ã€‚\n\n```typescript\nexport function createHostRootFiber(\n  tag: RootTag,\n  strictModeLevelOverride: null | number,\n): Fiber {\n  let mode;\n  if (tag === ConcurrentRoot) {\n    mode = ConcurrentMode;\n    if (strictModeLevelOverride !== null) {\n      if (strictModeLevelOverride >= 1) {\n        mode |= StrictLegacyMode;\n      }\n      if (enableStrictEffects) {\n        if (strictModeLevelOverride >= 2) {\n          mode |= StrictEffectsMode;\n        }\n      }\n    } else {\n      if (enableStrictEffects && createRootStrictEffectsByDefault) {\n        mode |= StrictLegacyMode | StrictEffectsMode;\n      } else {\n        mode |= StrictLegacyMode;\n      }\n    }\n  } else {\n    mode = NoMode;\n  }\n\n  if (enableProfilerTimer && isDevToolsPresent) {\n    // Always collect profile timings when DevTools are present.\n    // This enables DevTools to start capturing timing at any pointâ€“\n    // Without some nodes in the tree having empty base times.\n    mode |= ProfileMode;\n  }\n\t// export const HostRoot = 3;\n  return createFiber(HostRoot, null, null, mode);\n}\n```\n\n\n\n#### createFiber\n\nä¹Ÿæ˜¯åŒ…ä¸€ä¸ªå£³å­ã€‚ä¸»è¦è¿˜æ˜¯ä¸ºäº†åˆ›å»ºFiberNodeã€‚\n\n```typescript\nconst createFiber = function(\n  tag: WorkTag,\n  pendingProps: mixed,\n  key: null | string,\n  mode: TypeOfMode,\n): Fiber {\n  // $FlowFixMe: the shapes are exact here but Flow doesn't like constructors\n  return new FiberNode(tag, pendingProps, key, mode);\n};\n\n```\n\n\n\n#### FiberNode\n\nå®˜æ–¹å…¶å®å·²ç»æ³¨é‡Šäº†å±æ€§çš„è¦ç´ ã€‚ä½†æ˜¯æˆ‘è¿˜æ˜¯ä¼šå°½å¯èƒ½çš„å®Œå–„ã€‚\n\n```typescript\nfunction FiberNode(\n  tag: WorkTag,\n  pendingProps: mixed,\n  key: null | string,\n  mode: TypeOfMode,\n) {\n  // Instance\n  // ç”¨äºæ ‡è®°fiberèŠ‚ç‚¹çš„ç±»å‹\n  this.tag = tag;\n  // ç”¨äºå”¯ä¸€æ ‡è¯†ä¸€ä¸ªfiberèŠ‚ç‚¹\n  this.key = key;\n  // èŠ‚ç‚¹ç±»å‹\n  this.elementType = null;\n  // ReactNodeçš„èŠ‚ç‚¹ç±»å‹\n  this.type = null;\n  // FiberNodeä¼šé€šè¿‡stateNodeç»‘å®šä¸€äº›å…¶ä»–çš„å¯¹è±¡ï¼Œä¾‹å¦‚FiberNodeå¯¹åº”çš„Domã€FiberRootã€ReactComponentå®ä¾‹\n  this.stateNode = null;\n\n  // Fiber\n  // è¡¨ç¤ºçˆ¶çº§ FiberNode\n  this.return = null;\n  // è¡¨ç¤ºç¬¬ä¸€ä¸ªå­ FiberNode\n  this.child = null;\n  // è¡¨ç¤ºç´§ç´§ç›¸é‚»çš„ä¸‹ä¸€ä¸ªå…„å¼Ÿ FiberNode\n  this.sibling = null;\n  // ä¸‹æ ‡\n  this.index = 0;\n\n  this.ref = null;\n\n  // è¡¨ç¤ºæ–°çš„props\n  this.pendingProps = pendingProps;\n  // è¡¨ç¤ºç»è¿‡æ‰€æœ‰æµç¨‹å¤„ç†åçš„æ–°props\n  this.memoizedProps = null;\n  // æ›´æ–°é˜Ÿåˆ—\n  this.updateQueue = null;\n  // è¡¨ç¤ºç»è¿‡æ‰€æœ‰æµç¨‹å¤„ç†åçš„æ–°state\n  this.memoizedState = null;\n  // ä¾èµ–\n  this.dependencies = null;\n\n  this.mode = mode;\n\n  // Effects\n  // æ ‡å¿—æ›´æ–°çš„ç±»å‹ï¼šåˆ é™¤ã€æ–°å¢ã€ä¿®æ”¹ã€‚\n  this.flags = NoFlags;\n  // å­Fiberæ ‘çš„æ ‡å¿—æ›´æ–°çš„ç±»å‹ï¼šåˆ é™¤ã€æ–°å¢ã€ä¿®æ”¹ã€‚\n  this.subtreeFlags = NoFlags;\n  // éœ€è¦åˆ é™¤çš„å†…å®¹\n  this.deletions = null;\n\n  // ä¼˜å…ˆçº§\n  this.lanes = NoLanes;\n  // å­çš„ä¼˜å…ˆçº§\n  this.childLanes = NoLanes;\n\n  // åŒç¼“å†²ï¼šé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œæé«˜æ•ˆç‡ï¼ˆä¹‹åDom-diffçš„æ—¶å€™å¯ä»¥ç›´æ¥æ¯”è¾ƒæˆ–è€…ä½¿ç”¨\n  this.alternate = null;\n\n  if (enableProfilerTimer) {\n    // Note: The following is done to avoid a v8 performance cliff.\n    //\n    // Initializing the fields below to smis and later updating them with\n    // double values will cause Fibers to end up having separate shapes.\n    // This behavior/bug has something to do with Object.preventExtension().\n    // Fortunately this only impacts DEV builds.\n    // Unfortunately it makes React unusably slow for some applications.\n    // To work around this, initialize the fields below with doubles.\n    //\n    // Learn more about this here:\n    // https://github.com/facebook/react/issues/14365\n    // https://bugs.chromium.org/p/v8/issues/detail?id=8538\n    this.actualDuration = Number.NaN;\n    this.actualStartTime = Number.NaN;\n    this.selfBaseDuration = Number.NaN;\n    this.treeBaseDuration = Number.NaN;\n\n    // It's okay to replace the initial doubles with smis after initialization.\n    // This won't trigger the performance cliff mentioned above,\n    // and it simplifies other profiler code (including DevTools).\n    this.actualDuration = 0;\n    this.actualStartTime = -1;\n    this.selfBaseDuration = 0;\n    this.treeBaseDuration = 0;\n  }\n\n  if (__DEV__) {\n    // This isn't directly used but is handy for debugging internals:\n    this._debugID = debugCounter++;\n    this._debugSource = null;\n    this._debugOwner = null;\n    this._debugNeedsRemount = false;\n    this._debugHookTypes = null;\n    if (!hasBadMapPolyfill && typeof Object.preventExtensions === 'function') {\n      Object.preventExtensions(this);\n    }\n  }\n}\n```\n\n\n\n#### initializeUpdateQueue\n\ncreateContainerè¿˜æœ‰æœ€åä¸€ä¸ªå‡½æ•°ï¼Œåˆå§‹åŒ–æ›´æ–°é˜Ÿåˆ—ã€‚\n\n```typescript\nexport function initializeUpdateQueue<State>(fiber: Fiber): void {\n  const queue: UpdateQueue<State> = {\n    baseState: fiber.memoizedState,\n    firstBaseUpdate: null,\n    lastBaseUpdate: null,\n    shared: {\n      pending: null,\n      interleaved: null,\n      lanes: NoLanes,\n    },\n    effects: null,\n  };\n  fiber.updateQueue = queue;\n}\n```\n\n\n\n# å°ç»“ä¸€ç•ª\n\nå¤§è´¹å‘¨ç« çš„åšè¿™äº›é˜…è¯»ï¼Œå…¶å®å›è¿‡ç¥æ¥çœ‹ã€‚å°±æ˜¯ä¸ºäº†åˆ›å»º`fiberNode`ï¼ˆ`FiberRootNodeå®ä¾‹`ï¼‰å’Œ`rootFiber`å¯¹è±¡ã€‚è¿™ä¸¤å…„å¼Ÿæ˜¯æ•´ä¸ªFiberæ ‘æ„å»ºçš„èµ·ç‚¹ã€‚\n\n- `fiberNode`ï¼ˆ`FiberRootNodeå®ä¾‹`ï¼‰ -> çš„å…³è”å¯¹è±¡æ˜¯çœŸå® DOM çš„å®¹å™¨èŠ‚ç‚¹\n- `rootFiber` -> è™šæ‹Ÿ DOM çš„æ ¹èŠ‚ç‚¹\n\nç„¶åå†å›è¿‡ç¥æ¥çœ‹ï¼Œç¡®å®ã€‚ä»–ä»¬å„è‡ªåˆ›å»ºéƒ½æ˜¯ä¸ºä»–ä»¬æ‰€ä»£è¡¨çš„ä¸œè¥¿è€Œåˆ›å»ºï¼Œæ— è®ºæ˜¯å±æ€§æˆ–è€…æ‰“å…¥æ–¹æ³•ã€‚\n\n# æ”¶å°¾\n\næœ€åä»–ä»¬éƒ½ä¼šè¢«`unbatchedUpdates`æ‰€æ”¶ç¼–ï¼ˆçœ‹çœ‹æœ€ä¸Šé¢æ¢¦å¼€å§‹çš„åœ°æ–¹ã€ŒlegacyRenderSubtreeIntoContainerã€ï¼‰ã€‚æœ€åæˆ‘ä»¬æ‰€åˆ›å»ºçš„éƒ½ä¼šå½’å…¥åˆ°å®ƒçš„æ‰‹ä¸Šã€‚ä¸€èµ·çœ‹çœ‹æœ€åä¸€ä¸ªå‡½æ•°å§ã€‚\n\n## æ–¹ä¾¿é˜…è¯»\n\n```typescript\nunbatchedUpdates(function () {\n  updateContainer(children, fiberRoot, parentComponent, callback);\n});\n```\n\n\n\n## unbatchedUpdates\n\n```typescript\nfunction unbatchedUpdates(fn, a) {\n  // è¿™é‡Œæ˜¯å¯¹ä¸Šä¸‹æ–‡çš„å¤„ç†ï¼Œä¸å¿…çº ç»“\n  var prevExecutionContext = executionContext;\n  executionContext &= ~BatchedContext;\n  executionContext |= LegacyUnbatchedContext;\n  try {\n    // é‡ç‚¹åœ¨è¿™é‡Œï¼Œç›´æ¥è°ƒç”¨äº†ä¼ å…¥çš„å›è°ƒå‡½æ•° fnï¼Œå¯¹åº”å½“å‰é“¾è·¯ä¸­çš„ updateContainer æ–¹æ³•\n    return fn(a);\n  } finally {\n    // finally é€»è¾‘é‡Œæ˜¯å¯¹å›è°ƒé˜Ÿåˆ—çš„å¤„ç†ï¼Œæ­¤å¤„ä¸ç”¨å¤ªå…³æ³¨\n    executionContext = prevExecutionContext;\n    if (executionContext === NoContext) {\n      // Flush the immediate callbacks that were scheduled during this batch\n      resetRenderTimer();\n      flushSyncCallbackQueue();\n    }\n  }\n}\n```\n\n\n\n## updateContainer\n\n```typescript\nfunction updateContainer(element, container, parentComponent, callback) {\n  ......\n\n  // è¿™æ˜¯ä¸€ä¸ª event ç›¸å…³çš„å…¥å‚ï¼Œæ­¤å¤„ä¸å¿…å…³æ³¨\n  var eventTime = requestEventTime();\n\n  ......\n\n  // è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå…³é”®çš„å…¥å‚ï¼Œlane è¡¨ç¤ºä¼˜å…ˆçº§\n  var lane = requestUpdateLane(current);\n  // ç»“åˆ laneï¼ˆä¼˜å…ˆçº§ï¼‰ä¿¡æ¯ï¼Œåˆ›å»º update å¯¹è±¡ï¼Œä¸€ä¸ª update å¯¹è±¡æ„å‘³ç€ä¸€ä¸ªæ›´æ–°\n  var update = createUpdate(eventTime, lane); \n\n  // update çš„ payload å¯¹åº”çš„æ˜¯ä¸€ä¸ª React å…ƒç´ \n  update.payload = {\n    element: element\n  };\n\n  // å¤„ç† callbackï¼Œè¿™ä¸ª callback å…¶å®å°±æ˜¯æˆ‘ä»¬è°ƒç”¨ ReactDOM.render æ—¶ä¼ å…¥çš„ callback\n  callback = callback === undefined ? null : callback;\n  if (callback !== null) {\n    {\n      if (typeof callback !== 'function') {\n        error('render(...): Expected the last optional `callback` argument to be a ' + 'function. Instead received: %s.', callback);\n      }\n    }\n    update.callback = callback;\n  }\n\n  // å°† update å…¥é˜Ÿ\n  enqueueUpdate(current, update);\n  // è°ƒåº¦ fiberRoot \n  scheduleUpdateOnFiber(current, lane, eventTime);\n  // è¿”å›å½“å‰èŠ‚ç‚¹ï¼ˆfiberRootï¼‰çš„ä¼˜å…ˆçº§\n  return lane;\n}\n```\n\n\n\nupdateContainer çš„é€»è¾‘ç›¸å¯¹æ¥è¯´ä¸°å¯Œäº†ç‚¹ï¼Œä½†å¤§éƒ¨åˆ†é€»è¾‘ä¹Ÿæ˜¯åœ¨å¹²æ‚æ´»ï¼Œå®ƒåšçš„æœ€å…³é”®çš„äº‹æƒ…å¯ä»¥æ€»ç»“ä¸ºä¸‰ä»¶ï¼š\n\n- è¯·æ±‚å½“å‰ Fiber èŠ‚ç‚¹çš„ laneï¼ˆä¼˜å…ˆçº§ï¼‰ï¼›\n\n- ç»“åˆ laneï¼ˆä¼˜å…ˆçº§ï¼‰ï¼Œåˆ›å»ºå½“å‰ Fiber èŠ‚ç‚¹çš„ update å¯¹è±¡ï¼Œå¹¶å°†å…¶å…¥é˜Ÿï¼›\n\n- è°ƒåº¦å½“å‰èŠ‚ç‚¹ï¼ˆrootFiberï¼‰ã€‚\n\nçœ‹åˆ°è¿™é‡Œçš„ä¼™ä¼´ï¼Œè°¢è°¢ä½ çš„è€å¿ƒã€‚\n\n\n\n# æœ€å\n\nå› ä¸ºæˆ‘ä¹Ÿæ˜¯åœ¨ä¸€è¾¹çœ‹ï¼Œä¸€è¾¹è®°å½•ï¼Œå¦‚æœæœ‰é—®é¢˜ï¼Œå¤§å®¶ä¸€å®šè¦åŠæ—¶æå‡ºæ¥ã€‚æˆ‘ä¹Ÿä¼šåŠæ—¶æ›´æ–°çš„ã€‚è¿™éƒ¨åˆ†æˆ‘åº”è¯¥ä¼šå±¡æ¬¡é˜…è¯»ã€‚æ¯•ç«Ÿå¤§ç¥å†™äº†å‡ å¹´ï¼Œæˆ‘ä¸å¯èƒ½å‡ å¤©å°±çœ‹æ˜ç™½çš„ã€‚\n\n\n\n# ç´¢å¼•\n\nhttps://zh-hans.reactjs.org/docs\n\n\n\n\n\n\n\n\n\n","source":"_posts/ã€é‡è¯†å‰ç«¯ã€‘Reactæºç é˜…è¯»ï¼ˆä¸‰ï¼‰Fiber åˆå§‹åŒ–.md","raw":"---\ntitle: ã€é‡è¯†å‰ç«¯ã€‘Reactæºç é˜…è¯»ï¼ˆä¸‰ï¼‰4åƒå­—å‘Šè¯‰ä½  Fiber åˆå§‹åŒ–\ndate: 2021-04-06 14:08:31\ntags: [react]\ncategory: [é‡æ‹¾å‰ç«¯]\ncover: /image/cover/react.png\n---\n\n# å‰è¨€\n\nåœ¨ç¬¬ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬è§£è¯»åˆ°ReactDOM.renderä¹‹åå°±æ²¡æœ‰ç»§ç»­äº†ã€‚å› ä¸ºæˆ‘çœ‹äº†ä¸€ä¸‹è®¾è®¡åˆ°äº†Fiberçš„ä¸€äº›çŸ¥è¯†ï¼Œæ‰€ä»¥åœ¨ç¬¬äºŒç« è¡¥å……äº†Fiberçš„åŸºç¡€çŸ¥è¯†ä¹‹åï¼Œæˆ‘å°†Fiberæ‹†åˆ†æˆå››å—æ¥è®²\n\n- åŠ¨æœºï¼ˆæˆ–è€…è¯´åˆè¡·\n- åˆå§‹åŒ–-Fiberæ ‘çš„å‡†å¤‡å·¥ä½œ\n- render-Fiberæ ‘çš„æ„å»º\n- commit-Fiberæ ‘æ˜ å°„åˆ°DOM\n\nç°åœ¨æ˜¯åˆå§‹åŒ–é˜¶æ®µ\n\næˆ‘ä»¬ç°åœ¨ç›´æ¥è¿›å…¥Fiberçš„åˆå§‹åŒ–ã€‚Actionï¼\n\n# å‰æƒ…å›é¡¾\n\nå›é¡¾ä¸€ä¸‹ä¹‹å‰å­¦ä¹ JSXçš„æ—¶å€™ï¼Œé˜…è¯»åˆ°ReactDOM.renderã€‚å¦‚æœä½ æ²¡æœ‰é˜…è¯»è¿‡ä¹‹å‰çš„æ–‡ç« ï¼Œå¼ºçƒˆå»ºè®®ä½ åˆ°æˆ‘çš„ä¸»é¡µå»é˜…è¯»æˆ‘ä¹‹å‰çš„åšå®¢ã€‚ä¸‹é¢æˆ‘ä»¬å¼€å§‹ã€‚\n\nReactDOM.renderçš„æºç ã€‚\n\n```typescript\nexport function isValidContainer(node: mixed): boolean {\n  return !!(\n    node &&\n    (node.nodeType === ELEMENT_NODE ||\n      node.nodeType === DOCUMENT_NODE ||\n      node.nodeType === DOCUMENT_FRAGMENT_NODE ||\n      (node.nodeType === COMMENT_NODE &&\n        (node: any).nodeValue === ' react-mount-point-unstable '))\n  );\n}\n\nexport function render(\n  element: React$Element<any>,\n  container: Container,\n  callback: ?Function,\n) {\n  // ç”¨äºæŠ›å‡ºé”™è¯¯çš„, å°±æ˜¯åˆ¤æ–­è¿™ä¸ªcontaineræ˜¯ä¸æ˜¯æ‰¾å¾—åˆ°\n  invariant(\n    isValidContainer(container),\n    'Target container is not a DOM element.',\n  );\n  if (__DEV__) {\n    const isModernRoot =\n      isContainerMarkedAsRoot(container) &&\n      container._reactRootContainer === undefined;\n    if (isModernRoot) {\n      console.error(\n        'You are calling ReactDOM.render() on a container that was previously ' +\n          'passed to ReactDOM.createRoot(). This is not supported. ' +\n          'Did you mean to call root.render(element)?',\n      );\n    }\n  }\n  \n  // è¿™é‡Œé¢æ¶‰åŠåˆ°äº†fiberçš„ä¸€äº›æ¶æ„ï¼Œå¼€å§‹è¡¥å‘\n  return legacyRenderSubtreeIntoContainer(\n    null,\n    element,\n    container,\n    false,\n    callback,\n  );\n}\n```\n\næœ€åreturnçš„è¿™ä¸ªå‡½æ•°æœ‰ç‚¹æ„æ€ã€‚\n\n# æºç æ”»è¯»\n\n## legacyRenderSubtreeIntoContainer\n\næˆ‘ä»¬é¦–å…ˆç¿»è¯‘ä¸€ä¸‹è¿™ä¸ªå‡½æ•°çš„åå­—ï¼Œè¿›è¡Œé©¼å³°æ‹†åˆ†ï¼š\n\n> Googleç¿»è¯‘ï¼šlegacy Render Subtree Into Containerï¼ˆæ—§ç‰ˆæ¸²æŸ“å­æ ‘æ”¾å…¥å®¹å™¨\n\nå…ˆåˆ«æ€¥ç€ç¿»è¯‘ã€‚æˆ‘ä»¬å…ˆçœ‹çœ‹æºç ã€‚\n\n```typescript\nfunction legacyRenderSubtreeIntoContainer(parentComponent, children, container, forceHydrate, callback) {\n  // container å¯¹åº”çš„æ˜¯æˆ‘ä»¬ä¼ å…¥çš„çœŸå® DOM å¯¹è±¡\n  var root = container._reactRootContainer;\n  // åˆå§‹åŒ– fiberRoot å¯¹è±¡\n  var fiberRoot;\n  // DOM å¯¹è±¡æœ¬èº«ä¸å­˜åœ¨ _reactRootContainer å±æ€§ï¼Œå› æ­¤ root ä¸ºç©º\n  if (!root) {\n    // è‹¥ root ä¸ºç©ºï¼Œåˆ™åˆå§‹åŒ– _reactRootContainerï¼Œå¹¶å°†å…¶å€¼èµ‹å€¼ç»™ root\n    // legacyCreateRootFromDOMContainer ä¸»è¦çš„åŠŸèƒ½æ˜¯åˆ›å»ºï¼Œå¹¶ä¸”è¿›è¡Œä¸€äº›â€œè„åˆ¤æ–­â€ã€‚æ„Ÿå…´è¶£çš„ï¼Œæˆ‘åœ¨åé¢ä¹Ÿä¼šè¯¦ç»†ç»™å‡º\n    root = container._reactRootContainer = legacyCreateRootFromDOMContainer(container, forceHydrate);\n    // legacyCreateRootFromDOMContainer åˆ›å»ºå‡ºçš„å¯¹è±¡ä¼šæœ‰ä¸€ä¸ª _internalRoot å±æ€§ï¼Œå°†å…¶èµ‹å€¼ç»™ fiberRoot\n    fiberRoot = root._internalRoot;\n\n    // è¿™é‡Œå¤„ç†çš„æ˜¯ ReactDOM.render å…¥å‚ä¸­çš„å›è°ƒå‡½æ•°ï¼Œä½ äº†è§£å³å¯\n    if (typeof callback === 'function') {\n      var originalCallback = callback;\n      callback = function () {\n        var instance = getPublicRootInstance(fiberRoot);\n        originalCallback.call(instance);\n      };\n    } // Initial mount should not be batched.\n    // è¿›å…¥ unbatchedUpdates æ–¹æ³•\n    unbatchedUpdates(function () {\n      updateContainer(children, fiberRoot, parentComponent, callback);\n    });\n  } else {\n    // else é€»è¾‘å¤„ç†çš„æ˜¯éé¦–æ¬¡æ¸²æŸ“çš„æƒ…å†µï¼ˆå³æ›´æ–°ï¼‰ï¼Œå…¶é€»è¾‘é™¤äº†è·³è¿‡äº†åˆå§‹åŒ–å·¥ä½œï¼Œä¸æ¥¼ä¸ŠåŸºæœ¬ä¸€è‡´\n    fiberRoot = root._internalRoot;\n    if (typeof callback === 'function') {\n      var _originalCallback = callback;\n      callback = function () {\n        var instance = getPublicRootInstance(fiberRoot);\n        _originalCallback.call(instance);\n      };\n    } // Update\n\n    updateContainer(children, fiberRoot, parentComponent, callback);\n  }\n  return getPublicRootInstance(fiberRoot);\n}\n```\n\næ¢³ç†ä¸€ä¸‹æ•´ä¸ªæµç¨‹ï¼Œç„¶åæˆ‘ä»¬å†ä¸€ä¸€çœ‹è¿™äº›å‡½æ•°ã€‚\n\nä»¥ä¸‹æµç¨‹æ˜¯æŒ‡åˆå§‹åŒ–ï¼Œä¹Ÿå°±æ˜¯`if/else`åˆ¤æ–­é‡Œé¢çš„`if`ã€‚è€Œä¸æ˜¯`else`ï¼Œ`else`æ˜¯éé¦–æ¬¡æ¸²æŸ“ï¼Œèµ°çš„æ›´æ–°æµç¨‹ï¼Œæ³¨é‡Šé‡Œé¢å†™äº†ã€‚\n\n1. åˆ›å»º`container._reactRootContainer`å¯¹è±¡ï¼Œå¹¶èµ‹å€¼ç»™`root`\n2. å°†`root`ä¸Šçš„`_inernalRoot`èµ‹å€¼ç»™`fiberRoot`\n3. å°†`legacyRenderSubtreeIntoContainer`çš„ä¸€äº›å‚æ•°å’Œ`fiberRoot`ä¸€èµ·ä¼ ç»™`updateContainer`\n4. `å°†updateConatiner`ä½œä¸ºå›è°ƒå‡½æ•°ä¼ ç»™`unbatechedUpdates`\n\nokï¼Œç°åœ¨çœ‹ä¸å¤ªæ‡‚æ²¡å…³ç³»ã€‚æˆ‘ä»¬å°†é‡Œé¢ç”¨åˆ°çš„å‡½æ•°ä¸€ä¸€è§£è¯»ï¼Œç„¶åå†å›æ¥è¡¥å……æ•´ä¸ªæµç¨‹ã€‚\n\n## legacyCreateRootFromDOMContainer\n\nå¤§å®¶ç°åœ¨ä¸€å®šä¼šæ™•å¤´è½¬å‘ï¼Œå› ä¸ºæˆ‘çœ‹çš„æ—¶å€™ä¹Ÿæ˜¯è¿™æ ·ï¼Œä»–çš„åå­—å’Œå‡½æ•°åå­—å–çš„å¤ªåƒäº†ï¼Œæˆ‘ä»¬éœ€è¦ç»™ä»–ä»¬ç‹¬è‡ªç”¨è‡ªå·±çš„æ–¹å¼å‘½åã€‚æˆ‘ä¼šå†™ä¸‹Googleç¿»è¯‘ï¼Œ å¸®åŠ©å¤§å®¶å–åå­—ã€‚\n\n> Googleç¿»è¯‘ï¼šlegacy Create Root From DOM Containerï¼ˆä»DOMå®¹å™¨åˆ›å»ºæ ¹ç›®å½•\n\nçœ‹äº†ç¿»è¯‘ä¹‹åæ˜¯ä¸æ˜¯ç„•ç„¶å¤§æ‚Ÿï¼Ÿåˆ«æ€¥ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹æºç ã€‚\n\n```typescript\nfunction legacyCreateRootFromDOMContainer(\n  container: Container,\n  forceHydrate: boolean,\n): RootType {\n    // å¦‚æœforceHydrateæ˜¯falseï¼Œå°±ä¼šè°ƒç”¨åé¢çš„æ–¹æ³•ã€‚\n  const shouldHydrate =\n    forceHydrate || shouldHydrateDueToLegacyHeuristic(container);\n  // First clear any existing content.\n  if (!shouldHydrate) {\n    let warned = false;\n    let rootSibling;\n    // è¿™ä¸ªå¾ªç¯ï¼Œæ˜¯ä¸ºäº†æ¸…ç†æ‰€æœ‰çš„å†…å®¹ï¼Œç„¶åæ‰¾åˆ°æˆ‘ä»¬è¦æ¸²æŸ“çš„æœ€åˆçš„æ ¹divã€‚é€šå¸¸æˆ‘ä»¬çš„htmlä¼šæœ‰ä¸€ä¸ª\n    // <div id=\"root\"></div> ä¸ºçš„å°±æ˜¯ä¿éšœä»–çš„çº¯å‡€ã€‚\n    while ((rootSibling = container.lastChild)) {\n      if (__DEV__) {\n        if (\n          !warned &&\n          rootSibling.nodeType === ELEMENT_NODE &&\n          (rootSibling: any).hasAttribute(ROOT_ATTRIBUTE_NAME)\n        ) {\n          warned = true;\n          console.error(\n            'render(): Target node has markup rendered by React, but there ' +\n              'are unrelated nodes as well. This is most commonly caused by ' +\n              'white-space inserted around server-rendered markup.',\n          );\n        }\n      }\n      container.removeChild(rootSibling);\n    }\n  }\n  if (__DEV__) {\n    if (shouldHydrate && !forceHydrate && !warnedAboutHydrateAPI) {\n      warnedAboutHydrateAPI = true;\n      console.warn(\n        'render(): Calling ReactDOM.render() to hydrate server-rendered markup ' +\n          'will stop working in React v18. Replace the ReactDOM.render() call ' +\n          'with ReactDOM.hydrate() if you want React to attach to the server HTML.',\n      );\n    }\n  }\n\n  return createLegacyRoot(\n    container,\n    shouldHydrate\n      ? {\n          hydrate: true,\n        }\n      : undefined,\n  );\n}\n```\n\né‡Œé¢åˆç”¨åˆ°ä¸¤ä¸ªå‡½æ•°ï¼Œæˆ‘ä¸ºå¤§å®¶å¬å‡ºæ¥ã€‚\n\n### shouldHydrateDueToLegacyHeuristic\n\n\n\n```typescript\nfunction getReactRootElementInContainer(container: any) {\n  // å¦‚æœæ²¡æœ‰å°±è¿”å›null\n  if (!container) {\n    return null;\n  }\n  // å†…éƒ¨å®šä¹‰çš„ä¸€ä¸ªå¸¸é‡\n  // export const DOCUMENT_NODE = 9;çœ‹åå­—å°±é¡¾åæ€ä¹‰äº†\n  // å¦‚æœæ˜¯å†…éƒ¨ä¸€ä¸ªdocumentèŠ‚ç‚¹å°±è¿”å›documentèŠ‚ç‚¹\n  // æ„Ÿå…´è¶£å¯ä»¥çœ‹çœ‹MDNçš„ä»‹ç»ï¼šhttps://developer.mozilla.org/zh-CN/docs/Web/API/Document\n  // å¸¸é‡çš„å€¼ä¹Ÿæœ‰ï¼šhttps://developer.mozilla.org/zh-CN/docs/Web/API/Node/nodeType\n  if (container.nodeType === DOCUMENT_NODE) {\n    return container.documentElement;\n  } else {\n    // å¦åˆ™è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ \n    return container.firstChild;\n  }\n}\n\nfunction shouldHydrateDueToLegacyHeuristic(container) {\n  // å°†containerä¼ å…¥å‡½æ•°ï¼Œè¿›è¡Œåˆ¤æ–­ç±»å‹ï¼Œå¹¶å¾—åˆ°èŠ‚ç‚¹ï¼ˆæœ‰å¯èƒ½ä¸ºç©ºï¼Œçœ‹æ³¨é‡Š\n  const rootElement = getReactRootElementInContainer(container);\n  // å¼ºè½¬ä¸ºå¸ƒå°”å€¼\n  return !!(\n    rootElement &&\n    rootElement.nodeType === ELEMENT_NODE &&\n    // export const ROOT_ATTRIBUTE_NAME = 'data-reactroot'; \n    rootElement.hasAttribute(ROOT_ATTRIBUTE_NAME)\n  );\n}\n```\n\næˆ‘ä»¬çœ‹åˆ°ä¸€ä¸ªhasAttributeä¸º\"data-reactroot\"ã€‚è¿™æ˜¯ React åœ¨æœåŠ¡ç«¯æ¸²æŸ“çš„æ—¶å€™åŠ ä¸Šå»çš„ã€‚ä¹‹å‰æœ‰è¯´è¿‡Hydrateè¿™ä¸ªæ“ä½œæ˜¯æœåŠ¡ç«¯æ¸²æŸ“çš„æ—¶å€™éœ€è¦çš„ä¸œè¥¿ã€‚\n\n> Googleç¿»è¯‘ï¼šgetReactRootElementInContainerï¼ˆè·å–å®¹å™¨ä¸­çš„Reactæ ¹å…ƒç´ \n>\n> Googleç¿»è¯‘ï¼šshouldHydrateDueToLegacyHeuristicï¼ˆåº”å½“å› ä¼ ç»Ÿå¯å‘è€Œæ°´åˆ\n>\n> è¯´äººè¯å°±æ˜¯æ˜¯å¦éœ€è¦è¿›è¡Œhydrateæ“ä½œ\n\næ‰€ä»¥`legacyCreateRootFromDOMContainer`è¿™ä¸ªå‡½æ•°æ˜¯ä¿éšœ`container`çš„çº¯å‡€ã€‚å¹¶ä¸”è¿”å›`createLegacyRoot`å‡½æ•°ã€‚okç»§ç»­çœ‹ã€‚\n\n### createLegacyRoot\n\n```typescript\nfunction ReactDOMLegacyRoot(container: Container, options: void | RootOptions) {\n  // æ˜¯ä¸æ˜¯çœ‹è§è€æœ‹å‹äº†ã€‚_internalRootã€‚ç»§ç»­çœ‹ä¸‹é¢çš„å†…å®¹ï¼Œæˆ‘ä»¬æ¥è§£æä¸€ä¸‹createRootImpl\n  this._internalRoot = createRootImpl(container, LegacyRoot, options);\n}\n\nexport function createLegacyRoot(\n  container: Container,\n  options?: RootOptions,\n): RootType {\n  // åˆæ˜¯ç†Ÿæ‚‰çš„æ“ä½œï¼Œè¿”å›æŸä¸ªä¸œè¥¿\n  return new ReactDOMLegacyRoot(container, options);\n}\n```\n\n### createRootImpl\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬é€šç¯‡éƒ½æ˜¯ä»¥é`hydrate`æ¥çœ‹çš„ï¼Œå› ä¸ºæˆ‘ä»¬ä¸æ˜¯æœåŠ¡ç«¯æ¸²æŸ“ã€‚ä½†æ˜¯æˆ‘ä¹Ÿä¼šä»‹ç»å¦‚æœæœ‰`hydrate`çš„å†…å®¹ã€‚æ‰€ä»¥å¤§å®¶çœ‹çš„æ—¶å€™å¯ä»¥ç¨å¾®å¸¦å…¥ä¸€ç‚¹å»çœ‹ï¼Œä¸ç„¶å¾ˆå®¹æ˜“èµ°ç¥ï¼\n\n```typescript\n// åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªfiberRoot\nfunction createRootImpl(\n  container: Container,\n  tag: RootTag,\n  options: void | RootOptions,\n) {\n  // Tag is either LegacyRoot or Concurrent Root\n  // åˆ¤æ–­æ˜¯å¦ä¸ºhydrateæ¨¡å¼\n  const hydrate = options != null && options.hydrate === true;\n  const hydrationCallbacks =\n    (options != null && options.hydrationOptions) || null;\n  const mutableSources =\n    (options != null &&\n      options.hydrationOptions != null &&\n      options.hydrationOptions.mutableSources) ||\n    null;\n  const strictModeLevelOverride =\n    options != null && options.unstable_strictModeLevel != null\n      ? options.unstable_strictModeLevel\n      : null;\n  // åˆ›å»ºä¸€ä¸ªfiberRoot\n  const root = createContainer(\n    container,\n    tag,\n    hydrate,\n    hydrationCallbacks,\n    strictModeLevelOverride,\n  );\n  // ç»™containeré™„åŠ ä¸€ä¸ªå†…éƒ¨å±æ€§ç”¨äºæŒ‡å‘fiberRootçš„currentå±æ€§å¯¹åº”çš„rootFiberèŠ‚ç‚¹\n  markContainerAsRoot(root.current, container);\n\n  const rootContainerElement =\n    container.nodeType === COMMENT_NODE ? container.parentNode : container;\n  listenToAllSupportedEvents(rootContainerElement);\n\n  if (mutableSources) {\n    for (let i = 0; i < mutableSources.length; i++) {\n      const mutableSource = mutableSources[i];\n      registerMutableSourceForHydration(root, mutableSource);\n    }\n  }\n\n  return root;\n}\n```\n\nä¸ºä»€ä¹ˆæˆ‘åœ¨æ³¨é‡Šé‡Œé¢ä¼šåŠ ä¸Šã€Œåˆ›å»ºä¸€ä¸ªfiberRootã€ï¼Œä¸æ˜¯ä¸€ä¸ªæ˜¯åˆ›å»ºä¸€ä¸ªcontainerå—ï¼Ÿæˆ‘ä»¬çœ‹createContaineré‡Œé¢åšäº†ä»€ä¹ˆã€‚\n\n\n\n### createContainer\n\n```typescript\nexport function createFiberRoot(\n  containerInfo: any,\n  tag: RootTag,\n  hydrate: boolean,\n  hydrationCallbacks: null | SuspenseHydrationCallbacks,\n  strictModeLevelOverride: null | number,\n): FiberRoot {\n  // é€šè¿‡FiberRootNodeæ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªfiberRootå®ä¾‹\n  const root: FiberRoot = (new FiberRootNode(containerInfo, tag, hydrate): any);\n  // å¦‚æœæœ‰ï¼Œå°±è¡¥å……è¿›è¿™ä¸ªå›è°ƒå‡½æ•°\n  if (enableSuspenseCallback) {\n    root.hydrationCallbacks = hydrationCallbacks;\n  }\n\n  // Cyclic construction. This cheats the type system right now because\n  // stateNode is any.\n  // é€šè¿‡createHostRootFiberæ–¹æ³•åˆ›å»ºfiber treeçš„æ ¹ç»“ç‚¹ï¼Œå³rootFiber\n  // fiberèŠ‚ç‚¹ä¹Ÿä¼šåƒDOMæ ‘ç»“æ„ä¸€æ ·å½¢æˆä¸€ä¸ªfiber treeå•é“¾è¡¨æ ‘ç»“æ„\n  // æ¯ä¸ªDOMèŠ‚ç‚¹æˆ–è€…ç»„ä»¶éƒ½ä¼šç”Ÿæˆä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„fiberèŠ‚ç‚¹ï¼Œåœ¨åç»­çš„è°ƒå’Œ(reconciliation)é˜¶æ®µèµ·ç€è‡³å…³é‡è¦çš„ä½œç”¨\n  const uninitializedFiber = createHostRootFiber(tag, strictModeLevelOverride);\n  // åˆ›å»ºå®ŒrootFiberä¹‹åï¼Œä¼šå°†fiberRootçš„å®ä¾‹çš„currentå±æ€§æŒ‡å‘åˆšåˆ›å»ºçš„rootFiber\n  root.current = uninitializedFiber;\n  // åŒæ—¶rootFiberçš„stateNodeå±æ€§ä¼šæŒ‡å‘fiberRootå®ä¾‹ï¼Œå½¢æˆç›¸äº’å¼•ç”¨\n  uninitializedFiber.stateNode = root;\n\n  if (enableCache) {\n    const initialCache = new Map();\n    root.pooledCache = initialCache;\n    const initialState = {\n      element: null,\n      cache: initialCache,\n    };\n    uninitializedFiber.memoizedState = initialState;\n  } else {\n    const initialState = {\n      element: null,\n    };\n    uninitializedFiber.memoizedState = initialState;\n  }\n\n  initializeUpdateQueue(uninitializedFiber);\n\t// æœ€åå°†åˆ›å»ºçš„fiberRootå®ä¾‹è¿”å›\n  return root;\n}\n\n// å†…éƒ¨è°ƒç”¨createFiberRootæ–¹æ³•è¿”å›ä¸€ä¸ªfiberRootå®ä¾‹\nexport function createContainer(\n  containerInfo: Container,\n  tag: RootTag,\n  hydrate: boolean,\n  hydrationCallbacks: null | SuspenseHydrationCallbacks,\n  strictModeLevelOverride: null | number,\n): OpaqueRoot {\n  return createFiberRoot(\n    containerInfo,\n    tag,\n    hydrate,\n    hydrationCallbacks,\n    strictModeLevelOverride,\n  );\n}\n```\n\nè¿™é‡Œä¹Ÿæ¯”è¾ƒç®€å•ï¼Œåªæ˜¯å•çº¯çš„è°ƒç”¨å‡½æ•°ï¼Œç„¶åè¿”å›ã€‚çœŸæ­£çš„ç§˜å¯†å°±åœ¨è¿™äº›å‡½æ•°é‡Œé¢ï¼Œè€å¿ƒç‚¹ç»§ç»­çœ‹ï¼é»æ˜å°±åœ¨çœ¼å‰\n\n\n\n#### FiberRootNode\n\nä¸€ä¸ªéå¸¸ææ€–çš„å†…å®¹ã€‚ä½†æ˜¯çœ‹åå­—ä¹Ÿèƒ½çŒœä¸ªå¤§æ¦‚ã€‚è¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰è¯´è¿‡ã€‚ä¸€ä¸ªfiberèŠ‚ç‚¹è¦å­˜çš„å†…å®¹è¿˜è›®å¤šçš„ã€‚æ¯”å¦‚è¢«æš‚åœæ—¶çš„çŠ¶æ€ï¼Œæ¢å¤æ—¶è¦åšçš„äº‹æƒ…ï¼Œä¼˜å…ˆçº§ç­‰ç­‰....è¿™é‡Œæˆ‘å°½å¯èƒ½çš„å»å†™æ³¨é‡Šã€‚å¸®åŠ©å¤§å®¶è¿˜è¦æˆ‘è‡ªå·±ç†è§£ã€‚\n\n```typescript\nfunction FiberRootNode(containerInfo, tag, hydrate) {\n  //root èŠ‚ç‚¹ç±»å‹()\n  this.tag = tag;\n  //rootæ ¹èŠ‚ç‚¹ï¼Œrenderæ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°\n  this.containerInfo = containerInfo;\n  //åœ¨æŒä¹…æ›´æ–°ä¸­ä¼šç”¨åˆ°ï¼Œä¸æ”¯æŒå¢é‡æ›´æ–°çš„å¹³å°ï¼Œreact-dom æ˜¯æ•´ä¸ªåº”ç”¨æ›´æ–°ï¼Œæ‰€ä»¥ç”¨ä¸åˆ°\n  this.pendingChildren = null;\n  //å½“å‰åº”ç”¨rootèŠ‚ç‚¹å¯¹åº”çš„Fiberå¯¹è±¡\n  this.current = null;\n  //ç¼“å­˜\n  this.pingCache = null;\n  //å·²ç»å®Œæˆä»»åŠ¡çš„FiberRootå¯¹è±¡ï¼Œåœ¨commit(æäº¤)é˜¶æ®µåªä¼šå¤„ç†è¯¥å€¼å¯¹åº”çš„ä»»åŠ¡\n  this.finishedWork = null;\n  //åœ¨ä»»åŠ¡è¢«æŒ‚èµ·çš„æ—¶å€™é€šè¿‡setTimeoutè®¾ç½®çš„è¿”å›å†…å®¹ï¼Œç”¨æ¥ä¸‹ä¸€æ¬¡å¦‚æœæœ‰æ–°çš„ä»»åŠ¡æŒ‚èµ·æ—¶æ¸…ç†è¿˜æ²¡è§¦å‘çš„timeout\n  this.timeoutHandle = noTimeout;\n  //é¡¶å±‚ context å¯¹è±¡ï¼Œåªæœ‰ä¸»åŠ¨è°ƒç”¨renderSubtreeIntoContaineræ‰ä¼šç”Ÿæ•ˆ\n  this.context = null;\n  this.pendingContext = null;\n  // è€æœ‹å‹äº†ï¼Œç”¨æ¥ç¡®å®šç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™æ˜¯å¦éœ€è¦æ³¨æ°´\n  this.hydrate = hydrate;\n  //å›è°ƒèŠ‚ç‚¹\n  this.callbackNode = null;\n  //å›è°ƒå±æ€§\n  this.callbackPriority = NoLane;\n  // export const NoLanes: Lanes = 0b0000000000000000000000000000000;\n  /*\n  export function createLaneMap<T>(initial: T): LaneMap<T> {\n    // Intentionally pushing one by one.\n    // https://v8.dev/blog/elements-kinds#avoid-creating-holes\n    const laneMap = [];\n    for (let i = 0; i < TotalLanes; i++) {\n      laneMap.push(initial);\n    }\n    return laneMap;\n  }\n  */\n  //ä»»åŠ¡æ—¶é—´ã€‚ç”±äºè¯¥å­—æ®µåœ¨æœªæ¥ä¼šé‡æ„ï¼Œå½“å‰æˆ‘ä»¬ä¸éœ€è¦ç†è§£ä»–ã€‚\n  this.eventTimes = createLaneMap(NoLanes);\n  // è¿‡æœŸæ—¶é—´ã€‚å‡½æ•°ä¸Šé¢çš„æ³¨é‡Šæœ‰ã€‚export const NoTimestamp = -1;\n  this.expirationTimes = createLaneMap(NoTimestamp);\n\n  // ä¼˜å…ˆçº§çš„åˆå§‹åŒ–\n  this.pendingLanes = NoLanes;\n  this.suspendedLanes = NoLanes;\n  this.pingedLanes = NoLanes;\n  this.mutableReadLanes = NoLanes;\n  this.finishedLanes = NoLanes;\n\n  this.entangledLanes = NoLanes;\n  this.entanglements = createLaneMap(NoLanes);\n\n  if (enableCache) {\n    this.pooledCache = null;\n    this.pooledCacheLanes = NoLanes;\n  }\n\n  if (supportsHydration) {\n    this.mutableSourceEagerHydrationData = null;\n  }\n\n  if (enableSchedulerTracing) {\n    this.interactionThreadID = unstable_getThreadID();\n    this.memoizedInteractions = new Set();\n    this.pendingInteractionMap = new Map();\n  }\n  if (enableSuspenseCallback) {\n    this.hydrationCallbacks = null;\n  }\n\n  if (enableProfilerTimer && enableProfilerCommitHooks) {\n    this.effectDuration = 0;\n    this.passiveEffectDuration = 0;\n  }\n\n  if (__DEV__) {\n    switch (tag) {\n      case ConcurrentRoot:\n        this._debugRootType = 'createRoot()';\n        break;\n      case LegacyRoot:\n        this._debugRootType = 'createLegacyRoot()';\n        break;\n    }\n  }\n}\n```\n\n\n\n#### createHostRootFiber\n\né€šç¯‡å¤§è®ºéƒ½æ˜¯åœ¨åˆ¤æ–­modeç±»å‹ã€‚æ„Ÿå…´è¶£çš„å¯ä»¥å†æ·±æŒ–ã€‚è¿™é‡Œæˆ‘å°±ç•¥è¿‡äº†ã€‚çœ¼ç›å·²ç»çœ‹èŠ±äº†ã€‚ã€‚ã€‚\n\n```typescript\nexport function createHostRootFiber(\n  tag: RootTag,\n  strictModeLevelOverride: null | number,\n): Fiber {\n  let mode;\n  if (tag === ConcurrentRoot) {\n    mode = ConcurrentMode;\n    if (strictModeLevelOverride !== null) {\n      if (strictModeLevelOverride >= 1) {\n        mode |= StrictLegacyMode;\n      }\n      if (enableStrictEffects) {\n        if (strictModeLevelOverride >= 2) {\n          mode |= StrictEffectsMode;\n        }\n      }\n    } else {\n      if (enableStrictEffects && createRootStrictEffectsByDefault) {\n        mode |= StrictLegacyMode | StrictEffectsMode;\n      } else {\n        mode |= StrictLegacyMode;\n      }\n    }\n  } else {\n    mode = NoMode;\n  }\n\n  if (enableProfilerTimer && isDevToolsPresent) {\n    // Always collect profile timings when DevTools are present.\n    // This enables DevTools to start capturing timing at any pointâ€“\n    // Without some nodes in the tree having empty base times.\n    mode |= ProfileMode;\n  }\n\t// export const HostRoot = 3;\n  return createFiber(HostRoot, null, null, mode);\n}\n```\n\n\n\n#### createFiber\n\nä¹Ÿæ˜¯åŒ…ä¸€ä¸ªå£³å­ã€‚ä¸»è¦è¿˜æ˜¯ä¸ºäº†åˆ›å»ºFiberNodeã€‚\n\n```typescript\nconst createFiber = function(\n  tag: WorkTag,\n  pendingProps: mixed,\n  key: null | string,\n  mode: TypeOfMode,\n): Fiber {\n  // $FlowFixMe: the shapes are exact here but Flow doesn't like constructors\n  return new FiberNode(tag, pendingProps, key, mode);\n};\n\n```\n\n\n\n#### FiberNode\n\nå®˜æ–¹å…¶å®å·²ç»æ³¨é‡Šäº†å±æ€§çš„è¦ç´ ã€‚ä½†æ˜¯æˆ‘è¿˜æ˜¯ä¼šå°½å¯èƒ½çš„å®Œå–„ã€‚\n\n```typescript\nfunction FiberNode(\n  tag: WorkTag,\n  pendingProps: mixed,\n  key: null | string,\n  mode: TypeOfMode,\n) {\n  // Instance\n  // ç”¨äºæ ‡è®°fiberèŠ‚ç‚¹çš„ç±»å‹\n  this.tag = tag;\n  // ç”¨äºå”¯ä¸€æ ‡è¯†ä¸€ä¸ªfiberèŠ‚ç‚¹\n  this.key = key;\n  // èŠ‚ç‚¹ç±»å‹\n  this.elementType = null;\n  // ReactNodeçš„èŠ‚ç‚¹ç±»å‹\n  this.type = null;\n  // FiberNodeä¼šé€šè¿‡stateNodeç»‘å®šä¸€äº›å…¶ä»–çš„å¯¹è±¡ï¼Œä¾‹å¦‚FiberNodeå¯¹åº”çš„Domã€FiberRootã€ReactComponentå®ä¾‹\n  this.stateNode = null;\n\n  // Fiber\n  // è¡¨ç¤ºçˆ¶çº§ FiberNode\n  this.return = null;\n  // è¡¨ç¤ºç¬¬ä¸€ä¸ªå­ FiberNode\n  this.child = null;\n  // è¡¨ç¤ºç´§ç´§ç›¸é‚»çš„ä¸‹ä¸€ä¸ªå…„å¼Ÿ FiberNode\n  this.sibling = null;\n  // ä¸‹æ ‡\n  this.index = 0;\n\n  this.ref = null;\n\n  // è¡¨ç¤ºæ–°çš„props\n  this.pendingProps = pendingProps;\n  // è¡¨ç¤ºç»è¿‡æ‰€æœ‰æµç¨‹å¤„ç†åçš„æ–°props\n  this.memoizedProps = null;\n  // æ›´æ–°é˜Ÿåˆ—\n  this.updateQueue = null;\n  // è¡¨ç¤ºç»è¿‡æ‰€æœ‰æµç¨‹å¤„ç†åçš„æ–°state\n  this.memoizedState = null;\n  // ä¾èµ–\n  this.dependencies = null;\n\n  this.mode = mode;\n\n  // Effects\n  // æ ‡å¿—æ›´æ–°çš„ç±»å‹ï¼šåˆ é™¤ã€æ–°å¢ã€ä¿®æ”¹ã€‚\n  this.flags = NoFlags;\n  // å­Fiberæ ‘çš„æ ‡å¿—æ›´æ–°çš„ç±»å‹ï¼šåˆ é™¤ã€æ–°å¢ã€ä¿®æ”¹ã€‚\n  this.subtreeFlags = NoFlags;\n  // éœ€è¦åˆ é™¤çš„å†…å®¹\n  this.deletions = null;\n\n  // ä¼˜å…ˆçº§\n  this.lanes = NoLanes;\n  // å­çš„ä¼˜å…ˆçº§\n  this.childLanes = NoLanes;\n\n  // åŒç¼“å†²ï¼šé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œæé«˜æ•ˆç‡ï¼ˆä¹‹åDom-diffçš„æ—¶å€™å¯ä»¥ç›´æ¥æ¯”è¾ƒæˆ–è€…ä½¿ç”¨\n  this.alternate = null;\n\n  if (enableProfilerTimer) {\n    // Note: The following is done to avoid a v8 performance cliff.\n    //\n    // Initializing the fields below to smis and later updating them with\n    // double values will cause Fibers to end up having separate shapes.\n    // This behavior/bug has something to do with Object.preventExtension().\n    // Fortunately this only impacts DEV builds.\n    // Unfortunately it makes React unusably slow for some applications.\n    // To work around this, initialize the fields below with doubles.\n    //\n    // Learn more about this here:\n    // https://github.com/facebook/react/issues/14365\n    // https://bugs.chromium.org/p/v8/issues/detail?id=8538\n    this.actualDuration = Number.NaN;\n    this.actualStartTime = Number.NaN;\n    this.selfBaseDuration = Number.NaN;\n    this.treeBaseDuration = Number.NaN;\n\n    // It's okay to replace the initial doubles with smis after initialization.\n    // This won't trigger the performance cliff mentioned above,\n    // and it simplifies other profiler code (including DevTools).\n    this.actualDuration = 0;\n    this.actualStartTime = -1;\n    this.selfBaseDuration = 0;\n    this.treeBaseDuration = 0;\n  }\n\n  if (__DEV__) {\n    // This isn't directly used but is handy for debugging internals:\n    this._debugID = debugCounter++;\n    this._debugSource = null;\n    this._debugOwner = null;\n    this._debugNeedsRemount = false;\n    this._debugHookTypes = null;\n    if (!hasBadMapPolyfill && typeof Object.preventExtensions === 'function') {\n      Object.preventExtensions(this);\n    }\n  }\n}\n```\n\n\n\n#### initializeUpdateQueue\n\ncreateContainerè¿˜æœ‰æœ€åä¸€ä¸ªå‡½æ•°ï¼Œåˆå§‹åŒ–æ›´æ–°é˜Ÿåˆ—ã€‚\n\n```typescript\nexport function initializeUpdateQueue<State>(fiber: Fiber): void {\n  const queue: UpdateQueue<State> = {\n    baseState: fiber.memoizedState,\n    firstBaseUpdate: null,\n    lastBaseUpdate: null,\n    shared: {\n      pending: null,\n      interleaved: null,\n      lanes: NoLanes,\n    },\n    effects: null,\n  };\n  fiber.updateQueue = queue;\n}\n```\n\n\n\n# å°ç»“ä¸€ç•ª\n\nå¤§è´¹å‘¨ç« çš„åšè¿™äº›é˜…è¯»ï¼Œå…¶å®å›è¿‡ç¥æ¥çœ‹ã€‚å°±æ˜¯ä¸ºäº†åˆ›å»º`fiberNode`ï¼ˆ`FiberRootNodeå®ä¾‹`ï¼‰å’Œ`rootFiber`å¯¹è±¡ã€‚è¿™ä¸¤å…„å¼Ÿæ˜¯æ•´ä¸ªFiberæ ‘æ„å»ºçš„èµ·ç‚¹ã€‚\n\n- `fiberNode`ï¼ˆ`FiberRootNodeå®ä¾‹`ï¼‰ -> çš„å…³è”å¯¹è±¡æ˜¯çœŸå® DOM çš„å®¹å™¨èŠ‚ç‚¹\n- `rootFiber` -> è™šæ‹Ÿ DOM çš„æ ¹èŠ‚ç‚¹\n\nç„¶åå†å›è¿‡ç¥æ¥çœ‹ï¼Œç¡®å®ã€‚ä»–ä»¬å„è‡ªåˆ›å»ºéƒ½æ˜¯ä¸ºä»–ä»¬æ‰€ä»£è¡¨çš„ä¸œè¥¿è€Œåˆ›å»ºï¼Œæ— è®ºæ˜¯å±æ€§æˆ–è€…æ‰“å…¥æ–¹æ³•ã€‚\n\n# æ”¶å°¾\n\næœ€åä»–ä»¬éƒ½ä¼šè¢«`unbatchedUpdates`æ‰€æ”¶ç¼–ï¼ˆçœ‹çœ‹æœ€ä¸Šé¢æ¢¦å¼€å§‹çš„åœ°æ–¹ã€ŒlegacyRenderSubtreeIntoContainerã€ï¼‰ã€‚æœ€åæˆ‘ä»¬æ‰€åˆ›å»ºçš„éƒ½ä¼šå½’å…¥åˆ°å®ƒçš„æ‰‹ä¸Šã€‚ä¸€èµ·çœ‹çœ‹æœ€åä¸€ä¸ªå‡½æ•°å§ã€‚\n\n## æ–¹ä¾¿é˜…è¯»\n\n```typescript\nunbatchedUpdates(function () {\n  updateContainer(children, fiberRoot, parentComponent, callback);\n});\n```\n\n\n\n## unbatchedUpdates\n\n```typescript\nfunction unbatchedUpdates(fn, a) {\n  // è¿™é‡Œæ˜¯å¯¹ä¸Šä¸‹æ–‡çš„å¤„ç†ï¼Œä¸å¿…çº ç»“\n  var prevExecutionContext = executionContext;\n  executionContext &= ~BatchedContext;\n  executionContext |= LegacyUnbatchedContext;\n  try {\n    // é‡ç‚¹åœ¨è¿™é‡Œï¼Œç›´æ¥è°ƒç”¨äº†ä¼ å…¥çš„å›è°ƒå‡½æ•° fnï¼Œå¯¹åº”å½“å‰é“¾è·¯ä¸­çš„ updateContainer æ–¹æ³•\n    return fn(a);\n  } finally {\n    // finally é€»è¾‘é‡Œæ˜¯å¯¹å›è°ƒé˜Ÿåˆ—çš„å¤„ç†ï¼Œæ­¤å¤„ä¸ç”¨å¤ªå…³æ³¨\n    executionContext = prevExecutionContext;\n    if (executionContext === NoContext) {\n      // Flush the immediate callbacks that were scheduled during this batch\n      resetRenderTimer();\n      flushSyncCallbackQueue();\n    }\n  }\n}\n```\n\n\n\n## updateContainer\n\n```typescript\nfunction updateContainer(element, container, parentComponent, callback) {\n  ......\n\n  // è¿™æ˜¯ä¸€ä¸ª event ç›¸å…³çš„å…¥å‚ï¼Œæ­¤å¤„ä¸å¿…å…³æ³¨\n  var eventTime = requestEventTime();\n\n  ......\n\n  // è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå…³é”®çš„å…¥å‚ï¼Œlane è¡¨ç¤ºä¼˜å…ˆçº§\n  var lane = requestUpdateLane(current);\n  // ç»“åˆ laneï¼ˆä¼˜å…ˆçº§ï¼‰ä¿¡æ¯ï¼Œåˆ›å»º update å¯¹è±¡ï¼Œä¸€ä¸ª update å¯¹è±¡æ„å‘³ç€ä¸€ä¸ªæ›´æ–°\n  var update = createUpdate(eventTime, lane); \n\n  // update çš„ payload å¯¹åº”çš„æ˜¯ä¸€ä¸ª React å…ƒç´ \n  update.payload = {\n    element: element\n  };\n\n  // å¤„ç† callbackï¼Œè¿™ä¸ª callback å…¶å®å°±æ˜¯æˆ‘ä»¬è°ƒç”¨ ReactDOM.render æ—¶ä¼ å…¥çš„ callback\n  callback = callback === undefined ? null : callback;\n  if (callback !== null) {\n    {\n      if (typeof callback !== 'function') {\n        error('render(...): Expected the last optional `callback` argument to be a ' + 'function. Instead received: %s.', callback);\n      }\n    }\n    update.callback = callback;\n  }\n\n  // å°† update å…¥é˜Ÿ\n  enqueueUpdate(current, update);\n  // è°ƒåº¦ fiberRoot \n  scheduleUpdateOnFiber(current, lane, eventTime);\n  // è¿”å›å½“å‰èŠ‚ç‚¹ï¼ˆfiberRootï¼‰çš„ä¼˜å…ˆçº§\n  return lane;\n}\n```\n\n\n\nupdateContainer çš„é€»è¾‘ç›¸å¯¹æ¥è¯´ä¸°å¯Œäº†ç‚¹ï¼Œä½†å¤§éƒ¨åˆ†é€»è¾‘ä¹Ÿæ˜¯åœ¨å¹²æ‚æ´»ï¼Œå®ƒåšçš„æœ€å…³é”®çš„äº‹æƒ…å¯ä»¥æ€»ç»“ä¸ºä¸‰ä»¶ï¼š\n\n- è¯·æ±‚å½“å‰ Fiber èŠ‚ç‚¹çš„ laneï¼ˆä¼˜å…ˆçº§ï¼‰ï¼›\n\n- ç»“åˆ laneï¼ˆä¼˜å…ˆçº§ï¼‰ï¼Œåˆ›å»ºå½“å‰ Fiber èŠ‚ç‚¹çš„ update å¯¹è±¡ï¼Œå¹¶å°†å…¶å…¥é˜Ÿï¼›\n\n- è°ƒåº¦å½“å‰èŠ‚ç‚¹ï¼ˆrootFiberï¼‰ã€‚\n\nçœ‹åˆ°è¿™é‡Œçš„ä¼™ä¼´ï¼Œè°¢è°¢ä½ çš„è€å¿ƒã€‚\n\n\n\n# æœ€å\n\nå› ä¸ºæˆ‘ä¹Ÿæ˜¯åœ¨ä¸€è¾¹çœ‹ï¼Œä¸€è¾¹è®°å½•ï¼Œå¦‚æœæœ‰é—®é¢˜ï¼Œå¤§å®¶ä¸€å®šè¦åŠæ—¶æå‡ºæ¥ã€‚æˆ‘ä¹Ÿä¼šåŠæ—¶æ›´æ–°çš„ã€‚è¿™éƒ¨åˆ†æˆ‘åº”è¯¥ä¼šå±¡æ¬¡é˜…è¯»ã€‚æ¯•ç«Ÿå¤§ç¥å†™äº†å‡ å¹´ï¼Œæˆ‘ä¸å¯èƒ½å‡ å¤©å°±çœ‹æ˜ç™½çš„ã€‚\n\n\n\n# ç´¢å¼•\n\nhttps://zh-hans.reactjs.org/docs\n\n\n\n\n\n\n\n\n\n","slug":"ã€é‡è¯†å‰ç«¯ã€‘Reactæºç é˜…è¯»ï¼ˆä¸‰ï¼‰Fiber åˆå§‹åŒ–","published":1,"updated":"2021-06-24T14:00:06.850Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra88001clwrd2xc0bzy5","content":"<h1 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h1><p>åœ¨ç¬¬ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬è§£è¯»åˆ°ReactDOM.renderä¹‹åå°±æ²¡æœ‰ç»§ç»­äº†ã€‚å› ä¸ºæˆ‘çœ‹äº†ä¸€ä¸‹è®¾è®¡åˆ°äº†Fiberçš„ä¸€äº›çŸ¥è¯†ï¼Œæ‰€ä»¥åœ¨ç¬¬äºŒç« è¡¥å……äº†Fiberçš„åŸºç¡€çŸ¥è¯†ä¹‹åï¼Œæˆ‘å°†Fiberæ‹†åˆ†æˆå››å—æ¥è®²</p>\n<ul>\n<li>åŠ¨æœºï¼ˆæˆ–è€…è¯´åˆè¡·</li>\n<li>åˆå§‹åŒ–-Fiberæ ‘çš„å‡†å¤‡å·¥ä½œ</li>\n<li>render-Fiberæ ‘çš„æ„å»º</li>\n<li>commit-Fiberæ ‘æ˜ å°„åˆ°DOM</li>\n</ul>\n<p>ç°åœ¨æ˜¯åˆå§‹åŒ–é˜¶æ®µ</p>\n<p>æˆ‘ä»¬ç°åœ¨ç›´æ¥è¿›å…¥Fiberçš„åˆå§‹åŒ–ã€‚Actionï¼</p>\n<h1 id=\"å‰æƒ…å›é¡¾\"><a href=\"#å‰æƒ…å›é¡¾\" class=\"headerlink\" title=\"å‰æƒ…å›é¡¾\"></a>å‰æƒ…å›é¡¾</h1><p>å›é¡¾ä¸€ä¸‹ä¹‹å‰å­¦ä¹ JSXçš„æ—¶å€™ï¼Œé˜…è¯»åˆ°ReactDOM.renderã€‚å¦‚æœä½ æ²¡æœ‰é˜…è¯»è¿‡ä¹‹å‰çš„æ–‡ç« ï¼Œå¼ºçƒˆå»ºè®®ä½ åˆ°æˆ‘çš„ä¸»é¡µå»é˜…è¯»æˆ‘ä¹‹å‰çš„åšå®¢ã€‚ä¸‹é¢æˆ‘ä»¬å¼€å§‹ã€‚</p>\n<p>ReactDOM.renderçš„æºç ã€‚</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isValidContainer</span>(<span class=\"params\">node: mixed</span>): <span class=\"title\">boolean</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> !!(</span><br><span class=\"line\">    node &amp;&amp;</span><br><span class=\"line\">    (node.nodeType === ELEMENT_NODE ||</span><br><span class=\"line\">      node.nodeType === DOCUMENT_NODE ||</span><br><span class=\"line\">      node.nodeType === DOCUMENT_FRAGMENT_NODE ||</span><br><span class=\"line\">      (node.nodeType === COMMENT_NODE &amp;&amp;</span><br><span class=\"line\">        (node: <span class=\"built_in\">any</span>).nodeValue === <span class=\"string\">' react-mount-point-unstable '</span>))</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">render</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  element: React$Element&lt;<span class=\"built_in\">any</span>&gt;,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  container: Container,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  callback: ?<span class=\"built_in\">Function</span>,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// ç”¨äºæŠ›å‡ºé”™è¯¯çš„, å°±æ˜¯åˆ¤æ–­è¿™ä¸ªcontaineræ˜¯ä¸æ˜¯æ‰¾å¾—åˆ°</span></span><br><span class=\"line\">  invariant(</span><br><span class=\"line\">    isValidContainer(container),</span><br><span class=\"line\">    <span class=\"string\">'Target container is not a DOM element.'</span>,</span><br><span class=\"line\">  );</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (__DEV__) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> isModernRoot =</span><br><span class=\"line\">      isContainerMarkedAsRoot(container) &amp;&amp;</span><br><span class=\"line\">      container._reactRootContainer === <span class=\"literal\">undefined</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isModernRoot) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.error(</span><br><span class=\"line\">        <span class=\"string\">'You are calling ReactDOM.render() on a container that was previously '</span> +</span><br><span class=\"line\">          <span class=\"string\">'passed to ReactDOM.createRoot(). This is not supported. '</span> +</span><br><span class=\"line\">          <span class=\"string\">'Did you mean to call root.render(element)?'</span>,</span><br><span class=\"line\">      );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// è¿™é‡Œé¢æ¶‰åŠåˆ°äº†fiberçš„ä¸€äº›æ¶æ„ï¼Œå¼€å§‹è¡¥å‘</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> legacyRenderSubtreeIntoContainer(</span><br><span class=\"line\">    <span class=\"literal\">null</span>,</span><br><span class=\"line\">    element,</span><br><span class=\"line\">    container,</span><br><span class=\"line\">    <span class=\"literal\">false</span>,</span><br><span class=\"line\">    callback,</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æœ€åreturnçš„è¿™ä¸ªå‡½æ•°æœ‰ç‚¹æ„æ€ã€‚</p>\n<h1 id=\"æºç æ”»è¯»\"><a href=\"#æºç æ”»è¯»\" class=\"headerlink\" title=\"æºç æ”»è¯»\"></a>æºç æ”»è¯»</h1><h2 id=\"legacyRenderSubtreeIntoContainer\"><a href=\"#legacyRenderSubtreeIntoContainer\" class=\"headerlink\" title=\"legacyRenderSubtreeIntoContainer\"></a>legacyRenderSubtreeIntoContainer</h2><p>æˆ‘ä»¬é¦–å…ˆç¿»è¯‘ä¸€ä¸‹è¿™ä¸ªå‡½æ•°çš„åå­—ï¼Œè¿›è¡Œé©¼å³°æ‹†åˆ†ï¼š</p>\n<blockquote>\n<p>Googleç¿»è¯‘ï¼šlegacy Render Subtree Into Containerï¼ˆæ—§ç‰ˆæ¸²æŸ“å­æ ‘æ”¾å…¥å®¹å™¨</p>\n</blockquote>\n<p>å…ˆåˆ«æ€¥ç€ç¿»è¯‘ã€‚æˆ‘ä»¬å…ˆçœ‹çœ‹æºç ã€‚</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">legacyRenderSubtreeIntoContainer</span>(<span class=\"params\">parentComponent, children, container, forceHydrate, callback</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// container å¯¹åº”çš„æ˜¯æˆ‘ä»¬ä¼ å…¥çš„çœŸå® DOM å¯¹è±¡</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> root = container._reactRootContainer;</span><br><span class=\"line\">  <span class=\"comment\">// åˆå§‹åŒ– fiberRoot å¯¹è±¡</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> fiberRoot;</span><br><span class=\"line\">  <span class=\"comment\">// DOM å¯¹è±¡æœ¬èº«ä¸å­˜åœ¨ _reactRootContainer å±æ€§ï¼Œå› æ­¤ root ä¸ºç©º</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!root) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// è‹¥ root ä¸ºç©ºï¼Œåˆ™åˆå§‹åŒ– _reactRootContainerï¼Œå¹¶å°†å…¶å€¼èµ‹å€¼ç»™ root</span></span><br><span class=\"line\">    <span class=\"comment\">// legacyCreateRootFromDOMContainer ä¸»è¦çš„åŠŸèƒ½æ˜¯åˆ›å»ºï¼Œå¹¶ä¸”è¿›è¡Œä¸€äº›â€œè„åˆ¤æ–­â€ã€‚æ„Ÿå…´è¶£çš„ï¼Œæˆ‘åœ¨åé¢ä¹Ÿä¼šè¯¦ç»†ç»™å‡º</span></span><br><span class=\"line\">    root = container._reactRootContainer = legacyCreateRootFromDOMContainer(container, forceHydrate);</span><br><span class=\"line\">    <span class=\"comment\">// legacyCreateRootFromDOMContainer åˆ›å»ºå‡ºçš„å¯¹è±¡ä¼šæœ‰ä¸€ä¸ª _internalRoot å±æ€§ï¼Œå°†å…¶èµ‹å€¼ç»™ fiberRoot</span></span><br><span class=\"line\">    fiberRoot = root._internalRoot;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// è¿™é‡Œå¤„ç†çš„æ˜¯ ReactDOM.render å…¥å‚ä¸­çš„å›è°ƒå‡½æ•°ï¼Œä½ äº†è§£å³å¯</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> callback === <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> originalCallback = callback;</span><br><span class=\"line\">      callback = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> instance = getPublicRootInstance(fiberRoot);</span><br><span class=\"line\">        originalCallback.call(instance);</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">    &#125; <span class=\"comment\">// Initial mount should not be batched.</span></span><br><span class=\"line\">    <span class=\"comment\">// è¿›å…¥ unbatchedUpdates æ–¹æ³•</span></span><br><span class=\"line\">    unbatchedUpdates(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      updateContainer(children, fiberRoot, parentComponent, callback);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// else é€»è¾‘å¤„ç†çš„æ˜¯éé¦–æ¬¡æ¸²æŸ“çš„æƒ…å†µï¼ˆå³æ›´æ–°ï¼‰ï¼Œå…¶é€»è¾‘é™¤äº†è·³è¿‡äº†åˆå§‹åŒ–å·¥ä½œï¼Œä¸æ¥¼ä¸ŠåŸºæœ¬ä¸€è‡´</span></span><br><span class=\"line\">    fiberRoot = root._internalRoot;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> callback === <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> _originalCallback = callback;</span><br><span class=\"line\">      callback = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> instance = getPublicRootInstance(fiberRoot);</span><br><span class=\"line\">        _originalCallback.call(instance);</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">    &#125; <span class=\"comment\">// Update</span></span><br><span class=\"line\"></span><br><span class=\"line\">    updateContainer(children, fiberRoot, parentComponent, callback);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> getPublicRootInstance(fiberRoot);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æ¢³ç†ä¸€ä¸‹æ•´ä¸ªæµç¨‹ï¼Œç„¶åæˆ‘ä»¬å†ä¸€ä¸€çœ‹è¿™äº›å‡½æ•°ã€‚</p>\n<p>ä»¥ä¸‹æµç¨‹æ˜¯æŒ‡åˆå§‹åŒ–ï¼Œä¹Ÿå°±æ˜¯<code>if/else</code>åˆ¤æ–­é‡Œé¢çš„<code>if</code>ã€‚è€Œä¸æ˜¯<code>else</code>ï¼Œ<code>else</code>æ˜¯éé¦–æ¬¡æ¸²æŸ“ï¼Œèµ°çš„æ›´æ–°æµç¨‹ï¼Œæ³¨é‡Šé‡Œé¢å†™äº†ã€‚</p>\n<ol>\n<li>åˆ›å»º<code>container._reactRootContainer</code>å¯¹è±¡ï¼Œå¹¶èµ‹å€¼ç»™<code>root</code></li>\n<li>å°†<code>root</code>ä¸Šçš„<code>_inernalRoot</code>èµ‹å€¼ç»™<code>fiberRoot</code></li>\n<li>å°†<code>legacyRenderSubtreeIntoContainer</code>çš„ä¸€äº›å‚æ•°å’Œ<code>fiberRoot</code>ä¸€èµ·ä¼ ç»™<code>updateContainer</code></li>\n<li><code>å°†updateConatiner</code>ä½œä¸ºå›è°ƒå‡½æ•°ä¼ ç»™<code>unbatechedUpdates</code></li>\n</ol>\n<p>okï¼Œç°åœ¨çœ‹ä¸å¤ªæ‡‚æ²¡å…³ç³»ã€‚æˆ‘ä»¬å°†é‡Œé¢ç”¨åˆ°çš„å‡½æ•°ä¸€ä¸€è§£è¯»ï¼Œç„¶åå†å›æ¥è¡¥å……æ•´ä¸ªæµç¨‹ã€‚</p>\n<h2 id=\"legacyCreateRootFromDOMContainer\"><a href=\"#legacyCreateRootFromDOMContainer\" class=\"headerlink\" title=\"legacyCreateRootFromDOMContainer\"></a>legacyCreateRootFromDOMContainer</h2><p>å¤§å®¶ç°åœ¨ä¸€å®šä¼šæ™•å¤´è½¬å‘ï¼Œå› ä¸ºæˆ‘çœ‹çš„æ—¶å€™ä¹Ÿæ˜¯è¿™æ ·ï¼Œä»–çš„åå­—å’Œå‡½æ•°åå­—å–çš„å¤ªåƒäº†ï¼Œæˆ‘ä»¬éœ€è¦ç»™ä»–ä»¬ç‹¬è‡ªç”¨è‡ªå·±çš„æ–¹å¼å‘½åã€‚æˆ‘ä¼šå†™ä¸‹Googleç¿»è¯‘ï¼Œ å¸®åŠ©å¤§å®¶å–åå­—ã€‚</p>\n<blockquote>\n<p>Googleç¿»è¯‘ï¼šlegacy Create Root From DOM Containerï¼ˆä»DOMå®¹å™¨åˆ›å»ºæ ¹ç›®å½•</p>\n</blockquote>\n<p>çœ‹äº†ç¿»è¯‘ä¹‹åæ˜¯ä¸æ˜¯ç„•ç„¶å¤§æ‚Ÿï¼Ÿåˆ«æ€¥ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹æºç ã€‚</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">legacyCreateRootFromDOMContainer</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  container: Container,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  forceHydrate: <span class=\"built_in\">boolean</span>,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\"></span>): <span class=\"title\">RootType</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœforceHydrateæ˜¯falseï¼Œå°±ä¼šè°ƒç”¨åé¢çš„æ–¹æ³•ã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> shouldHydrate =</span><br><span class=\"line\">    forceHydrate || shouldHydrateDueToLegacyHeuristic(container);</span><br><span class=\"line\">  <span class=\"comment\">// First clear any existing content.</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!shouldHydrate) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> warned = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> rootSibling;</span><br><span class=\"line\">    <span class=\"comment\">// è¿™ä¸ªå¾ªç¯ï¼Œæ˜¯ä¸ºäº†æ¸…ç†æ‰€æœ‰çš„å†…å®¹ï¼Œç„¶åæ‰¾åˆ°æˆ‘ä»¬è¦æ¸²æŸ“çš„æœ€åˆçš„æ ¹divã€‚é€šå¸¸æˆ‘ä»¬çš„htmlä¼šæœ‰ä¸€ä¸ª</span></span><br><span class=\"line\">    <span class=\"comment\">// &lt;div id=\"root\"&gt;&lt;/div&gt; ä¸ºçš„å°±æ˜¯ä¿éšœä»–çš„çº¯å‡€ã€‚</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> ((rootSibling = container.lastChild)) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (__DEV__) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (</span><br><span class=\"line\">          !warned &amp;&amp;</span><br><span class=\"line\">          rootSibling.nodeType === ELEMENT_NODE &amp;&amp;</span><br><span class=\"line\">          (rootSibling: <span class=\"built_in\">any</span>).hasAttribute(ROOT_ATTRIBUTE_NAME)</span><br><span class=\"line\">        ) &#123;</span><br><span class=\"line\">          warned = <span class=\"literal\">true</span>;</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.error(</span><br><span class=\"line\">            <span class=\"string\">'render(): Target node has markup rendered by React, but there '</span> +</span><br><span class=\"line\">              <span class=\"string\">'are unrelated nodes as well. This is most commonly caused by '</span> +</span><br><span class=\"line\">              <span class=\"string\">'white-space inserted around server-rendered markup.'</span>,</span><br><span class=\"line\">          );</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      container.removeChild(rootSibling);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (__DEV__) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (shouldHydrate &amp;&amp; !forceHydrate &amp;&amp; !warnedAboutHydrateAPI) &#123;</span><br><span class=\"line\">      warnedAboutHydrateAPI = <span class=\"literal\">true</span>;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.warn(</span><br><span class=\"line\">        <span class=\"string\">'render(): Calling ReactDOM.render() to hydrate server-rendered markup '</span> +</span><br><span class=\"line\">          <span class=\"string\">'will stop working in React v18. Replace the ReactDOM.render() call '</span> +</span><br><span class=\"line\">          <span class=\"string\">'with ReactDOM.hydrate() if you want React to attach to the server HTML.'</span>,</span><br><span class=\"line\">      );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> createLegacyRoot(</span><br><span class=\"line\">    container,</span><br><span class=\"line\">    shouldHydrate</span><br><span class=\"line\">      ? &#123;</span><br><span class=\"line\">          hydrate: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      : <span class=\"literal\">undefined</span>,</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>é‡Œé¢åˆç”¨åˆ°ä¸¤ä¸ªå‡½æ•°ï¼Œæˆ‘ä¸ºå¤§å®¶å¬å‡ºæ¥ã€‚</p>\n<h3 id=\"shouldHydrateDueToLegacyHeuristic\"><a href=\"#shouldHydrateDueToLegacyHeuristic\" class=\"headerlink\" title=\"shouldHydrateDueToLegacyHeuristic\"></a>shouldHydrateDueToLegacyHeuristic</h3><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getReactRootElementInContainer</span>(<span class=\"params\">container: <span class=\"built_in\">any</span></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœæ²¡æœ‰å°±è¿”å›null</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!container) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// å†…éƒ¨å®šä¹‰çš„ä¸€ä¸ªå¸¸é‡</span></span><br><span class=\"line\">  <span class=\"comment\">// export const DOCUMENT_NODE = 9;çœ‹åå­—å°±é¡¾åæ€ä¹‰äº†</span></span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœæ˜¯å†…éƒ¨ä¸€ä¸ªdocumentèŠ‚ç‚¹å°±è¿”å›documentèŠ‚ç‚¹</span></span><br><span class=\"line\">  <span class=\"comment\">// æ„Ÿå…´è¶£å¯ä»¥çœ‹çœ‹MDNçš„ä»‹ç»ï¼šhttps://developer.mozilla.org/zh-CN/docs/Web/API/Document</span></span><br><span class=\"line\">  <span class=\"comment\">// å¸¸é‡çš„å€¼ä¹Ÿæœ‰ï¼šhttps://developer.mozilla.org/zh-CN/docs/Web/API/Node/nodeType</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (container.nodeType === DOCUMENT_NODE) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> container.documentElement;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// å¦åˆ™è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> container.firstChild;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">shouldHydrateDueToLegacyHeuristic</span>(<span class=\"params\">container</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// å°†containerä¼ å…¥å‡½æ•°ï¼Œè¿›è¡Œåˆ¤æ–­ç±»å‹ï¼Œå¹¶å¾—åˆ°èŠ‚ç‚¹ï¼ˆæœ‰å¯èƒ½ä¸ºç©ºï¼Œçœ‹æ³¨é‡Š</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> rootElement = getReactRootElementInContainer(container);</span><br><span class=\"line\">  <span class=\"comment\">// å¼ºè½¬ä¸ºå¸ƒå°”å€¼</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> !!(</span><br><span class=\"line\">    rootElement &amp;&amp;</span><br><span class=\"line\">    rootElement.nodeType === ELEMENT_NODE &amp;&amp;</span><br><span class=\"line\">    <span class=\"comment\">// export const ROOT_ATTRIBUTE_NAME = 'data-reactroot'; </span></span><br><span class=\"line\">    rootElement.hasAttribute(ROOT_ATTRIBUTE_NAME)</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æˆ‘ä»¬çœ‹åˆ°ä¸€ä¸ªhasAttributeä¸ºâ€data-reactrootâ€ã€‚è¿™æ˜¯ React åœ¨æœåŠ¡ç«¯æ¸²æŸ“çš„æ—¶å€™åŠ ä¸Šå»çš„ã€‚ä¹‹å‰æœ‰è¯´è¿‡Hydrateè¿™ä¸ªæ“ä½œæ˜¯æœåŠ¡ç«¯æ¸²æŸ“çš„æ—¶å€™éœ€è¦çš„ä¸œè¥¿ã€‚</p>\n<blockquote>\n<p>Googleç¿»è¯‘ï¼šgetReactRootElementInContainerï¼ˆè·å–å®¹å™¨ä¸­çš„Reactæ ¹å…ƒç´ </p>\n<p>Googleç¿»è¯‘ï¼šshouldHydrateDueToLegacyHeuristicï¼ˆåº”å½“å› ä¼ ç»Ÿå¯å‘è€Œæ°´åˆ</p>\n<p>è¯´äººè¯å°±æ˜¯æ˜¯å¦éœ€è¦è¿›è¡Œhydrateæ“ä½œ</p>\n</blockquote>\n<p>æ‰€ä»¥<code>legacyCreateRootFromDOMContainer</code>è¿™ä¸ªå‡½æ•°æ˜¯ä¿éšœ<code>container</code>çš„çº¯å‡€ã€‚å¹¶ä¸”è¿”å›<code>createLegacyRoot</code>å‡½æ•°ã€‚okç»§ç»­çœ‹ã€‚</p>\n<h3 id=\"createLegacyRoot\"><a href=\"#createLegacyRoot\" class=\"headerlink\" title=\"createLegacyRoot\"></a>createLegacyRoot</h3><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">ReactDOMLegacyRoot</span>(<span class=\"params\">container: Container, options: <span class=\"built_in\">void</span> | RootOptions</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// æ˜¯ä¸æ˜¯çœ‹è§è€æœ‹å‹äº†ã€‚_internalRootã€‚ç»§ç»­çœ‹ä¸‹é¢çš„å†…å®¹ï¼Œæˆ‘ä»¬æ¥è§£æä¸€ä¸‹createRootImpl</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>._internalRoot = createRootImpl(container, LegacyRoot, options);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createLegacyRoot</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  container: Container,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  options?: RootOptions,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\"></span>): <span class=\"title\">RootType</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// åˆæ˜¯ç†Ÿæ‚‰çš„æ“ä½œï¼Œè¿”å›æŸä¸ªä¸œè¥¿</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> ReactDOMLegacyRoot(container, options);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"createRootImpl\"><a href=\"#createRootImpl\" class=\"headerlink\" title=\"createRootImpl\"></a>createRootImpl</h3><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬é€šç¯‡éƒ½æ˜¯ä»¥é<code>hydrate</code>æ¥çœ‹çš„ï¼Œå› ä¸ºæˆ‘ä»¬ä¸æ˜¯æœåŠ¡ç«¯æ¸²æŸ“ã€‚ä½†æ˜¯æˆ‘ä¹Ÿä¼šä»‹ç»å¦‚æœæœ‰<code>hydrate</code>çš„å†…å®¹ã€‚æ‰€ä»¥å¤§å®¶çœ‹çš„æ—¶å€™å¯ä»¥ç¨å¾®å¸¦å…¥ä¸€ç‚¹å»çœ‹ï¼Œä¸ç„¶å¾ˆå®¹æ˜“èµ°ç¥ï¼</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªfiberRoot</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createRootImpl</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  container: Container,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  tag: RootTag,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  options: <span class=\"built_in\">void</span> | RootOptions,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// Tag is either LegacyRoot or Concurrent Root</span></span><br><span class=\"line\">  <span class=\"comment\">// åˆ¤æ–­æ˜¯å¦ä¸ºhydrateæ¨¡å¼</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> hydrate = options != <span class=\"literal\">null</span> &amp;&amp; options.hydrate === <span class=\"literal\">true</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> hydrationCallbacks =</span><br><span class=\"line\">    (options != <span class=\"literal\">null</span> &amp;&amp; options.hydrationOptions) || <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> mutableSources =</span><br><span class=\"line\">    (options != <span class=\"literal\">null</span> &amp;&amp;</span><br><span class=\"line\">      options.hydrationOptions != <span class=\"literal\">null</span> &amp;&amp;</span><br><span class=\"line\">      options.hydrationOptions.mutableSources) ||</span><br><span class=\"line\">    <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> strictModeLevelOverride =</span><br><span class=\"line\">    options != <span class=\"literal\">null</span> &amp;&amp; options.unstable_strictModeLevel != <span class=\"literal\">null</span></span><br><span class=\"line\">      ? options.unstable_strictModeLevel</span><br><span class=\"line\">      : <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// åˆ›å»ºä¸€ä¸ªfiberRoot</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> root = createContainer(</span><br><span class=\"line\">    container,</span><br><span class=\"line\">    tag,</span><br><span class=\"line\">    hydrate,</span><br><span class=\"line\">    hydrationCallbacks,</span><br><span class=\"line\">    strictModeLevelOverride,</span><br><span class=\"line\">  );</span><br><span class=\"line\">  <span class=\"comment\">// ç»™containeré™„åŠ ä¸€ä¸ªå†…éƒ¨å±æ€§ç”¨äºæŒ‡å‘fiberRootçš„currentå±æ€§å¯¹åº”çš„rootFiberèŠ‚ç‚¹</span></span><br><span class=\"line\">  markContainerAsRoot(root.current, container);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> rootContainerElement =</span><br><span class=\"line\">    container.nodeType === COMMENT_NODE ? container.parentNode : container;</span><br><span class=\"line\">  listenToAllSupportedEvents(rootContainerElement);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (mutableSources) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; mutableSources.length; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> mutableSource = mutableSources[i];</span><br><span class=\"line\">      registerMutableSourceForHydration(root, mutableSource);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> root;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä¸ºä»€ä¹ˆæˆ‘åœ¨æ³¨é‡Šé‡Œé¢ä¼šåŠ ä¸Šã€Œåˆ›å»ºä¸€ä¸ªfiberRootã€ï¼Œä¸æ˜¯ä¸€ä¸ªæ˜¯åˆ›å»ºä¸€ä¸ªcontainerå—ï¼Ÿæˆ‘ä»¬çœ‹createContaineré‡Œé¢åšäº†ä»€ä¹ˆã€‚</p>\n<h3 id=\"createContainer\"><a href=\"#createContainer\" class=\"headerlink\" title=\"createContainer\"></a>createContainer</h3><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createFiberRoot</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  containerInfo: <span class=\"built_in\">any</span>,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  tag: RootTag,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  hydrate: <span class=\"built_in\">boolean</span>,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  hydrationCallbacks: <span class=\"literal\">null</span> | SuspenseHydrationCallbacks,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  strictModeLevelOverride: <span class=\"literal\">null</span> | <span class=\"built_in\">number</span>,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\"></span>): <span class=\"title\">FiberRoot</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// é€šè¿‡FiberRootNodeæ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªfiberRootå®ä¾‹</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> root: FiberRoot = (<span class=\"keyword\">new</span> FiberRootNode(containerInfo, tag, hydrate): <span class=\"built_in\">any</span>);</span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœæœ‰ï¼Œå°±è¡¥å……è¿›è¿™ä¸ªå›è°ƒå‡½æ•°</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (enableSuspenseCallback) &#123;</span><br><span class=\"line\">    root.hydrationCallbacks = hydrationCallbacks;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Cyclic construction. This cheats the type system right now because</span></span><br><span class=\"line\">  <span class=\"comment\">// stateNode is any.</span></span><br><span class=\"line\">  <span class=\"comment\">// é€šè¿‡createHostRootFiberæ–¹æ³•åˆ›å»ºfiber treeçš„æ ¹ç»“ç‚¹ï¼Œå³rootFiber</span></span><br><span class=\"line\">  <span class=\"comment\">// fiberèŠ‚ç‚¹ä¹Ÿä¼šåƒDOMæ ‘ç»“æ„ä¸€æ ·å½¢æˆä¸€ä¸ªfiber treeå•é“¾è¡¨æ ‘ç»“æ„</span></span><br><span class=\"line\">  <span class=\"comment\">// æ¯ä¸ªDOMèŠ‚ç‚¹æˆ–è€…ç»„ä»¶éƒ½ä¼šç”Ÿæˆä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„fiberèŠ‚ç‚¹ï¼Œåœ¨åç»­çš„è°ƒå’Œ(reconciliation)é˜¶æ®µèµ·ç€è‡³å…³é‡è¦çš„ä½œç”¨</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> uninitializedFiber = createHostRootFiber(tag, strictModeLevelOverride);</span><br><span class=\"line\">  <span class=\"comment\">// åˆ›å»ºå®ŒrootFiberä¹‹åï¼Œä¼šå°†fiberRootçš„å®ä¾‹çš„currentå±æ€§æŒ‡å‘åˆšåˆ›å»ºçš„rootFiber</span></span><br><span class=\"line\">  root.current = uninitializedFiber;</span><br><span class=\"line\">  <span class=\"comment\">// åŒæ—¶rootFiberçš„stateNodeå±æ€§ä¼šæŒ‡å‘fiberRootå®ä¾‹ï¼Œå½¢æˆç›¸äº’å¼•ç”¨</span></span><br><span class=\"line\">  uninitializedFiber.stateNode = root;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (enableCache) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> initialCache = <span class=\"keyword\">new</span> Map();</span><br><span class=\"line\">    root.pooledCache = initialCache;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> initialState = &#123;</span><br><span class=\"line\">      element: <span class=\"literal\">null</span>,</span><br><span class=\"line\">      cache: initialCache,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    uninitializedFiber.memoizedState = initialState;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> initialState = &#123;</span><br><span class=\"line\">      element: <span class=\"literal\">null</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    uninitializedFiber.memoizedState = initialState;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  initializeUpdateQueue(uninitializedFiber);</span><br><span class=\"line\">\t<span class=\"comment\">// æœ€åå°†åˆ›å»ºçš„fiberRootå®ä¾‹è¿”å›</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> root;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// å†…éƒ¨è°ƒç”¨createFiberRootæ–¹æ³•è¿”å›ä¸€ä¸ªfiberRootå®ä¾‹</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createContainer</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  containerInfo: Container,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  tag: RootTag,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  hydrate: <span class=\"built_in\">boolean</span>,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  hydrationCallbacks: <span class=\"literal\">null</span> | SuspenseHydrationCallbacks,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  strictModeLevelOverride: <span class=\"literal\">null</span> | <span class=\"built_in\">number</span>,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\"></span>): <span class=\"title\">OpaqueRoot</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> createFiberRoot(</span><br><span class=\"line\">    containerInfo,</span><br><span class=\"line\">    tag,</span><br><span class=\"line\">    hydrate,</span><br><span class=\"line\">    hydrationCallbacks,</span><br><span class=\"line\">    strictModeLevelOverride,</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>è¿™é‡Œä¹Ÿæ¯”è¾ƒç®€å•ï¼Œåªæ˜¯å•çº¯çš„è°ƒç”¨å‡½æ•°ï¼Œç„¶åè¿”å›ã€‚çœŸæ­£çš„ç§˜å¯†å°±åœ¨è¿™äº›å‡½æ•°é‡Œé¢ï¼Œè€å¿ƒç‚¹ç»§ç»­çœ‹ï¼é»æ˜å°±åœ¨çœ¼å‰</p>\n<h4 id=\"FiberRootNode\"><a href=\"#FiberRootNode\" class=\"headerlink\" title=\"FiberRootNode\"></a>FiberRootNode</h4><p>ä¸€ä¸ªéå¸¸ææ€–çš„å†…å®¹ã€‚ä½†æ˜¯çœ‹åå­—ä¹Ÿèƒ½çŒœä¸ªå¤§æ¦‚ã€‚è¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰è¯´è¿‡ã€‚ä¸€ä¸ªfiberèŠ‚ç‚¹è¦å­˜çš„å†…å®¹è¿˜è›®å¤šçš„ã€‚æ¯”å¦‚è¢«æš‚åœæ—¶çš„çŠ¶æ€ï¼Œæ¢å¤æ—¶è¦åšçš„äº‹æƒ…ï¼Œä¼˜å…ˆçº§ç­‰ç­‰â€¦.è¿™é‡Œæˆ‘å°½å¯èƒ½çš„å»å†™æ³¨é‡Šã€‚å¸®åŠ©å¤§å®¶è¿˜è¦æˆ‘è‡ªå·±ç†è§£ã€‚</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">FiberRootNode</span>(<span class=\"params\">containerInfo, tag, hydrate</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//root èŠ‚ç‚¹ç±»å‹()</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.tag = tag;</span><br><span class=\"line\">  <span class=\"comment\">//rootæ ¹èŠ‚ç‚¹ï¼Œrenderæ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.containerInfo = containerInfo;</span><br><span class=\"line\">  <span class=\"comment\">//åœ¨æŒä¹…æ›´æ–°ä¸­ä¼šç”¨åˆ°ï¼Œä¸æ”¯æŒå¢é‡æ›´æ–°çš„å¹³å°ï¼Œreact-dom æ˜¯æ•´ä¸ªåº”ç”¨æ›´æ–°ï¼Œæ‰€ä»¥ç”¨ä¸åˆ°</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.pendingChildren = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">//å½“å‰åº”ç”¨rootèŠ‚ç‚¹å¯¹åº”çš„Fiberå¯¹è±¡</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.current = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">//ç¼“å­˜</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.pingCache = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">//å·²ç»å®Œæˆä»»åŠ¡çš„FiberRootå¯¹è±¡ï¼Œåœ¨commit(æäº¤)é˜¶æ®µåªä¼šå¤„ç†è¯¥å€¼å¯¹åº”çš„ä»»åŠ¡</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.finishedWork = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">//åœ¨ä»»åŠ¡è¢«æŒ‚èµ·çš„æ—¶å€™é€šè¿‡setTimeoutè®¾ç½®çš„è¿”å›å†…å®¹ï¼Œç”¨æ¥ä¸‹ä¸€æ¬¡å¦‚æœæœ‰æ–°çš„ä»»åŠ¡æŒ‚èµ·æ—¶æ¸…ç†è¿˜æ²¡è§¦å‘çš„timeout</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.timeoutHandle = noTimeout;</span><br><span class=\"line\">  <span class=\"comment\">//é¡¶å±‚ context å¯¹è±¡ï¼Œåªæœ‰ä¸»åŠ¨è°ƒç”¨renderSubtreeIntoContaineræ‰ä¼šç”Ÿæ•ˆ</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.context = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.pendingContext = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// è€æœ‹å‹äº†ï¼Œç”¨æ¥ç¡®å®šç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™æ˜¯å¦éœ€è¦æ³¨æ°´</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.hydrate = hydrate;</span><br><span class=\"line\">  <span class=\"comment\">//å›è°ƒèŠ‚ç‚¹</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.callbackNode = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">//å›è°ƒå±æ€§</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.callbackPriority = NoLane;</span><br><span class=\"line\">  <span class=\"comment\">// export const NoLanes: Lanes = 0b0000000000000000000000000000000;</span></span><br><span class=\"line\">  <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">  export function createLaneMap&lt;T&gt;(initial: T): LaneMap&lt;T&gt; &#123;</span></span><br><span class=\"line\"><span class=\"comment\">    // Intentionally pushing one by one.</span></span><br><span class=\"line\"><span class=\"comment\">    // https://v8.dev/blog/elements-kinds#avoid-creating-holes</span></span><br><span class=\"line\"><span class=\"comment\">    const laneMap = [];</span></span><br><span class=\"line\"><span class=\"comment\">    for (let i = 0; i &lt; TotalLanes; i++) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">      laneMap.push(initial);</span></span><br><span class=\"line\"><span class=\"comment\">    &#125;</span></span><br><span class=\"line\"><span class=\"comment\">    return laneMap;</span></span><br><span class=\"line\"><span class=\"comment\">  &#125;</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\">  <span class=\"comment\">//ä»»åŠ¡æ—¶é—´ã€‚ç”±äºè¯¥å­—æ®µåœ¨æœªæ¥ä¼šé‡æ„ï¼Œå½“å‰æˆ‘ä»¬ä¸éœ€è¦ç†è§£ä»–ã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.eventTimes = createLaneMap(NoLanes);</span><br><span class=\"line\">  <span class=\"comment\">// è¿‡æœŸæ—¶é—´ã€‚å‡½æ•°ä¸Šé¢çš„æ³¨é‡Šæœ‰ã€‚export const NoTimestamp = -1;</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.expirationTimes = createLaneMap(NoTimestamp);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// ä¼˜å…ˆçº§çš„åˆå§‹åŒ–</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.pendingLanes = NoLanes;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.suspendedLanes = NoLanes;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.pingedLanes = NoLanes;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.mutableReadLanes = NoLanes;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.finishedLanes = NoLanes;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.entangledLanes = NoLanes;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.entanglements = createLaneMap(NoLanes);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (enableCache) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.pooledCache = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.pooledCacheLanes = NoLanes;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (supportsHydration) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.mutableSourceEagerHydrationData = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (enableSchedulerTracing) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.interactionThreadID = unstable_getThreadID();</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.memoizedInteractions = <span class=\"keyword\">new</span> Set();</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.pendingInteractionMap = <span class=\"keyword\">new</span> Map();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (enableSuspenseCallback) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.hydrationCallbacks = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (enableProfilerTimer &amp;&amp; enableProfilerCommitHooks) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.effectDuration = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.passiveEffectDuration = <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (__DEV__) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (tag) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> ConcurrentRoot:</span><br><span class=\"line\">        <span class=\"keyword\">this</span>._debugRootType = <span class=\"string\">'createRoot()'</span>;</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> LegacyRoot:</span><br><span class=\"line\">        <span class=\"keyword\">this</span>._debugRootType = <span class=\"string\">'createLegacyRoot()'</span>;</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"createHostRootFiber\"><a href=\"#createHostRootFiber\" class=\"headerlink\" title=\"createHostRootFiber\"></a>createHostRootFiber</h4><p>é€šç¯‡å¤§è®ºéƒ½æ˜¯åœ¨åˆ¤æ–­modeç±»å‹ã€‚æ„Ÿå…´è¶£çš„å¯ä»¥å†æ·±æŒ–ã€‚è¿™é‡Œæˆ‘å°±ç•¥è¿‡äº†ã€‚çœ¼ç›å·²ç»çœ‹èŠ±äº†ã€‚ã€‚ã€‚</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createHostRootFiber</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  tag: RootTag,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  strictModeLevelOverride: <span class=\"literal\">null</span> | <span class=\"built_in\">number</span>,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\"></span>): <span class=\"title\">Fiber</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> mode;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (tag === ConcurrentRoot) &#123;</span><br><span class=\"line\">    mode = ConcurrentMode;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (strictModeLevelOverride !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (strictModeLevelOverride &gt;= <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        mode |= StrictLegacyMode;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (enableStrictEffects) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (strictModeLevelOverride &gt;= <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">          mode |= StrictEffectsMode;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (enableStrictEffects &amp;&amp; createRootStrictEffectsByDefault) &#123;</span><br><span class=\"line\">        mode |= StrictLegacyMode | StrictEffectsMode;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        mode |= StrictLegacyMode;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    mode = NoMode;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (enableProfilerTimer &amp;&amp; isDevToolsPresent) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Always collect profile timings when DevTools are present.</span></span><br><span class=\"line\">    <span class=\"comment\">// This enables DevTools to start capturing timing at any pointâ€“</span></span><br><span class=\"line\">    <span class=\"comment\">// Without some nodes in the tree having empty base times.</span></span><br><span class=\"line\">    mode |= ProfileMode;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">\t<span class=\"comment\">// export const HostRoot = 3;</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> createFiber(HostRoot, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>, mode);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"createFiber\"><a href=\"#createFiber\" class=\"headerlink\" title=\"createFiber\"></a>createFiber</h4><p>ä¹Ÿæ˜¯åŒ…ä¸€ä¸ªå£³å­ã€‚ä¸»è¦è¿˜æ˜¯ä¸ºäº†åˆ›å»ºFiberNodeã€‚</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> createFiber = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  tag: WorkTag,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  pendingProps: mixed,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  key: <span class=\"literal\">null</span> | <span class=\"built_in\">string</span>,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  mode: TypeOfMode,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\"></span>): <span class=\"title\">Fiber</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// $FlowFixMe: the shapes are exact here but Flow doesn't like constructors</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> FiberNode(tag, pendingProps, key, mode);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"FiberNode\"><a href=\"#FiberNode\" class=\"headerlink\" title=\"FiberNode\"></a>FiberNode</h4><p>å®˜æ–¹å…¶å®å·²ç»æ³¨é‡Šäº†å±æ€§çš„è¦ç´ ã€‚ä½†æ˜¯æˆ‘è¿˜æ˜¯ä¼šå°½å¯èƒ½çš„å®Œå–„ã€‚</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">FiberNode</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  tag: WorkTag,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  pendingProps: mixed,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  key: <span class=\"literal\">null</span> | <span class=\"built_in\">string</span>,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  mode: TypeOfMode,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// Instance</span></span><br><span class=\"line\">  <span class=\"comment\">// ç”¨äºæ ‡è®°fiberèŠ‚ç‚¹çš„ç±»å‹</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.tag = tag;</span><br><span class=\"line\">  <span class=\"comment\">// ç”¨äºå”¯ä¸€æ ‡è¯†ä¸€ä¸ªfiberèŠ‚ç‚¹</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.key = key;</span><br><span class=\"line\">  <span class=\"comment\">// èŠ‚ç‚¹ç±»å‹</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.elementType = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// ReactNodeçš„èŠ‚ç‚¹ç±»å‹</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.type = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// FiberNodeä¼šé€šè¿‡stateNodeç»‘å®šä¸€äº›å…¶ä»–çš„å¯¹è±¡ï¼Œä¾‹å¦‚FiberNodeå¯¹åº”çš„Domã€FiberRootã€ReactComponentå®ä¾‹</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.stateNode = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Fiber</span></span><br><span class=\"line\">  <span class=\"comment\">// è¡¨ç¤ºçˆ¶çº§ FiberNode</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.return = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// è¡¨ç¤ºç¬¬ä¸€ä¸ªå­ FiberNode</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.child = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// è¡¨ç¤ºç´§ç´§ç›¸é‚»çš„ä¸‹ä¸€ä¸ªå…„å¼Ÿ FiberNode</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.sibling = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// ä¸‹æ ‡</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.index = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.ref = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// è¡¨ç¤ºæ–°çš„props</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.pendingProps = pendingProps;</span><br><span class=\"line\">  <span class=\"comment\">// è¡¨ç¤ºç»è¿‡æ‰€æœ‰æµç¨‹å¤„ç†åçš„æ–°props</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.memoizedProps = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// æ›´æ–°é˜Ÿåˆ—</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.updateQueue = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// è¡¨ç¤ºç»è¿‡æ‰€æœ‰æµç¨‹å¤„ç†åçš„æ–°state</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.memoizedState = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// ä¾èµ–</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.dependencies = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.mode = mode;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Effects</span></span><br><span class=\"line\">  <span class=\"comment\">// æ ‡å¿—æ›´æ–°çš„ç±»å‹ï¼šåˆ é™¤ã€æ–°å¢ã€ä¿®æ”¹ã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.flags = NoFlags;</span><br><span class=\"line\">  <span class=\"comment\">// å­Fiberæ ‘çš„æ ‡å¿—æ›´æ–°çš„ç±»å‹ï¼šåˆ é™¤ã€æ–°å¢ã€ä¿®æ”¹ã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.subtreeFlags = NoFlags;</span><br><span class=\"line\">  <span class=\"comment\">// éœ€è¦åˆ é™¤çš„å†…å®¹</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.deletions = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// ä¼˜å…ˆçº§</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.lanes = NoLanes;</span><br><span class=\"line\">  <span class=\"comment\">// å­çš„ä¼˜å…ˆçº§</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.childLanes = NoLanes;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// åŒç¼“å†²ï¼šé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œæé«˜æ•ˆç‡ï¼ˆä¹‹åDom-diffçš„æ—¶å€™å¯ä»¥ç›´æ¥æ¯”è¾ƒæˆ–è€…ä½¿ç”¨</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.alternate = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (enableProfilerTimer) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Note: The following is done to avoid a v8 performance cliff.</span></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"comment\">// Initializing the fields below to smis and later updating them with</span></span><br><span class=\"line\">    <span class=\"comment\">// double values will cause Fibers to end up having separate shapes.</span></span><br><span class=\"line\">    <span class=\"comment\">// This behavior/bug has something to do with Object.preventExtension().</span></span><br><span class=\"line\">    <span class=\"comment\">// Fortunately this only impacts DEV builds.</span></span><br><span class=\"line\">    <span class=\"comment\">// Unfortunately it makes React unusably slow for some applications.</span></span><br><span class=\"line\">    <span class=\"comment\">// To work around this, initialize the fields below with doubles.</span></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"comment\">// Learn more about this here:</span></span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/facebook/react/issues/14365</span></span><br><span class=\"line\">    <span class=\"comment\">// https://bugs.chromium.org/p/v8/issues/detail?id=8538</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.actualDuration = <span class=\"built_in\">Number</span>.NaN;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.actualStartTime = <span class=\"built_in\">Number</span>.NaN;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.selfBaseDuration = <span class=\"built_in\">Number</span>.NaN;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.treeBaseDuration = <span class=\"built_in\">Number</span>.NaN;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// It's okay to replace the initial doubles with smis after initialization.</span></span><br><span class=\"line\">    <span class=\"comment\">// This won't trigger the performance cliff mentioned above,</span></span><br><span class=\"line\">    <span class=\"comment\">// and it simplifies other profiler code (including DevTools).</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.actualDuration = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.actualStartTime = <span class=\"number\">-1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.selfBaseDuration = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.treeBaseDuration = <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (__DEV__) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// This isn't directly used but is handy for debugging internals:</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>._debugID = debugCounter++;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>._debugSource = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>._debugOwner = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>._debugNeedsRemount = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>._debugHookTypes = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!hasBadMapPolyfill &amp;&amp; <span class=\"keyword\">typeof</span> <span class=\"built_in\">Object</span>.preventExtensions === <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">Object</span>.preventExtensions(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"initializeUpdateQueue\"><a href=\"#initializeUpdateQueue\" class=\"headerlink\" title=\"initializeUpdateQueue\"></a>initializeUpdateQueue</h4><p>createContainerè¿˜æœ‰æœ€åä¸€ä¸ªå‡½æ•°ï¼Œåˆå§‹åŒ–æ›´æ–°é˜Ÿåˆ—ã€‚</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">initializeUpdateQueue</span>&lt;<span class=\"title\">State</span>&gt;(<span class=\"params\">fiber: Fiber</span>): <span class=\"title\">void</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> queue: UpdateQueue&lt;State&gt; = &#123;</span><br><span class=\"line\">    baseState: fiber.memoizedState,</span><br><span class=\"line\">    firstBaseUpdate: <span class=\"literal\">null</span>,</span><br><span class=\"line\">    lastBaseUpdate: <span class=\"literal\">null</span>,</span><br><span class=\"line\">    shared: &#123;</span><br><span class=\"line\">      pending: <span class=\"literal\">null</span>,</span><br><span class=\"line\">      interleaved: <span class=\"literal\">null</span>,</span><br><span class=\"line\">      lanes: NoLanes,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    effects: <span class=\"literal\">null</span>,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  fiber.updateQueue = queue;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"å°ç»“ä¸€ç•ª\"><a href=\"#å°ç»“ä¸€ç•ª\" class=\"headerlink\" title=\"å°ç»“ä¸€ç•ª\"></a>å°ç»“ä¸€ç•ª</h1><p>å¤§è´¹å‘¨ç« çš„åšè¿™äº›é˜…è¯»ï¼Œå…¶å®å›è¿‡ç¥æ¥çœ‹ã€‚å°±æ˜¯ä¸ºäº†åˆ›å»º<code>fiberNode</code>ï¼ˆ<code>FiberRootNodeå®ä¾‹</code>ï¼‰å’Œ<code>rootFiber</code>å¯¹è±¡ã€‚è¿™ä¸¤å…„å¼Ÿæ˜¯æ•´ä¸ªFiberæ ‘æ„å»ºçš„èµ·ç‚¹ã€‚</p>\n<ul>\n<li><code>fiberNode</code>ï¼ˆ<code>FiberRootNodeå®ä¾‹</code>ï¼‰ -&gt; çš„å…³è”å¯¹è±¡æ˜¯çœŸå® DOM çš„å®¹å™¨èŠ‚ç‚¹</li>\n<li><code>rootFiber</code> -&gt; è™šæ‹Ÿ DOM çš„æ ¹èŠ‚ç‚¹</li>\n</ul>\n<p>ç„¶åå†å›è¿‡ç¥æ¥çœ‹ï¼Œç¡®å®ã€‚ä»–ä»¬å„è‡ªåˆ›å»ºéƒ½æ˜¯ä¸ºä»–ä»¬æ‰€ä»£è¡¨çš„ä¸œè¥¿è€Œåˆ›å»ºï¼Œæ— è®ºæ˜¯å±æ€§æˆ–è€…æ‰“å…¥æ–¹æ³•ã€‚</p>\n<h1 id=\"æ”¶å°¾\"><a href=\"#æ”¶å°¾\" class=\"headerlink\" title=\"æ”¶å°¾\"></a>æ”¶å°¾</h1><p>æœ€åä»–ä»¬éƒ½ä¼šè¢«<code>unbatchedUpdates</code>æ‰€æ”¶ç¼–ï¼ˆçœ‹çœ‹æœ€ä¸Šé¢æ¢¦å¼€å§‹çš„åœ°æ–¹ã€ŒlegacyRenderSubtreeIntoContainerã€ï¼‰ã€‚æœ€åæˆ‘ä»¬æ‰€åˆ›å»ºçš„éƒ½ä¼šå½’å…¥åˆ°å®ƒçš„æ‰‹ä¸Šã€‚ä¸€èµ·çœ‹çœ‹æœ€åä¸€ä¸ªå‡½æ•°å§ã€‚</p>\n<h2 id=\"æ–¹ä¾¿é˜…è¯»\"><a href=\"#æ–¹ä¾¿é˜…è¯»\" class=\"headerlink\" title=\"æ–¹ä¾¿é˜…è¯»\"></a>æ–¹ä¾¿é˜…è¯»</h2><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">unbatchedUpdates(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  updateContainer(children, fiberRoot, parentComponent, callback);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"unbatchedUpdates\"><a href=\"#unbatchedUpdates\" class=\"headerlink\" title=\"unbatchedUpdates\"></a>unbatchedUpdates</h2><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">unbatchedUpdates</span>(<span class=\"params\">fn, a</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// è¿™é‡Œæ˜¯å¯¹ä¸Šä¸‹æ–‡çš„å¤„ç†ï¼Œä¸å¿…çº ç»“</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> prevExecutionContext = executionContext;</span><br><span class=\"line\">  executionContext &amp;= ~BatchedContext;</span><br><span class=\"line\">  executionContext |= LegacyUnbatchedContext;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// é‡ç‚¹åœ¨è¿™é‡Œï¼Œç›´æ¥è°ƒç”¨äº†ä¼ å…¥çš„å›è°ƒå‡½æ•° fnï¼Œå¯¹åº”å½“å‰é“¾è·¯ä¸­çš„ updateContainer æ–¹æ³•</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> fn(a);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// finally é€»è¾‘é‡Œæ˜¯å¯¹å›è°ƒé˜Ÿåˆ—çš„å¤„ç†ï¼Œæ­¤å¤„ä¸ç”¨å¤ªå…³æ³¨</span></span><br><span class=\"line\">    executionContext = prevExecutionContext;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (executionContext === NoContext) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// Flush the immediate callbacks that were scheduled during this batch</span></span><br><span class=\"line\">      resetRenderTimer();</span><br><span class=\"line\">      flushSyncCallbackQueue();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"updateContainer\"><a href=\"#updateContainer\" class=\"headerlink\" title=\"updateContainer\"></a>updateContainer</h2><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">updateContainer</span>(<span class=\"params\">element, container, parentComponent, callback</span>) </span>&#123;</span><br><span class=\"line\">  ......</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// è¿™æ˜¯ä¸€ä¸ª event ç›¸å…³çš„å…¥å‚ï¼Œæ­¤å¤„ä¸å¿…å…³æ³¨</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> eventTime = requestEventTime();</span><br><span class=\"line\"></span><br><span class=\"line\">  ......</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå…³é”®çš„å…¥å‚ï¼Œlane è¡¨ç¤ºä¼˜å…ˆçº§</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> lane = requestUpdateLane(current);</span><br><span class=\"line\">  <span class=\"comment\">// ç»“åˆ laneï¼ˆä¼˜å…ˆçº§ï¼‰ä¿¡æ¯ï¼Œåˆ›å»º update å¯¹è±¡ï¼Œä¸€ä¸ª update å¯¹è±¡æ„å‘³ç€ä¸€ä¸ªæ›´æ–°</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> update = createUpdate(eventTime, lane); </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// update çš„ payload å¯¹åº”çš„æ˜¯ä¸€ä¸ª React å…ƒç´ </span></span><br><span class=\"line\">  update.payload = &#123;</span><br><span class=\"line\">    element: element</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// å¤„ç† callbackï¼Œè¿™ä¸ª callback å…¶å®å°±æ˜¯æˆ‘ä»¬è°ƒç”¨ ReactDOM.render æ—¶ä¼ å…¥çš„ callback</span></span><br><span class=\"line\">  callback = callback === <span class=\"literal\">undefined</span> ? <span class=\"literal\">null</span> : callback;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (callback !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> callback !== <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">        error(<span class=\"string\">'render(...): Expected the last optional `callback` argument to be a '</span> + <span class=\"string\">'function. Instead received: %s.'</span>, callback);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    update.callback = callback;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// å°† update å…¥é˜Ÿ</span></span><br><span class=\"line\">  enqueueUpdate(current, update);</span><br><span class=\"line\">  <span class=\"comment\">// è°ƒåº¦ fiberRoot </span></span><br><span class=\"line\">  scheduleUpdateOnFiber(current, lane, eventTime);</span><br><span class=\"line\">  <span class=\"comment\">// è¿”å›å½“å‰èŠ‚ç‚¹ï¼ˆfiberRootï¼‰çš„ä¼˜å…ˆçº§</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> lane;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>updateContainer çš„é€»è¾‘ç›¸å¯¹æ¥è¯´ä¸°å¯Œäº†ç‚¹ï¼Œä½†å¤§éƒ¨åˆ†é€»è¾‘ä¹Ÿæ˜¯åœ¨å¹²æ‚æ´»ï¼Œå®ƒåšçš„æœ€å…³é”®çš„äº‹æƒ…å¯ä»¥æ€»ç»“ä¸ºä¸‰ä»¶ï¼š</p>\n<ul>\n<li><p>è¯·æ±‚å½“å‰ Fiber èŠ‚ç‚¹çš„ laneï¼ˆä¼˜å…ˆçº§ï¼‰ï¼›</p>\n</li>\n<li><p>ç»“åˆ laneï¼ˆä¼˜å…ˆçº§ï¼‰ï¼Œåˆ›å»ºå½“å‰ Fiber èŠ‚ç‚¹çš„ update å¯¹è±¡ï¼Œå¹¶å°†å…¶å…¥é˜Ÿï¼›</p>\n</li>\n<li><p>è°ƒåº¦å½“å‰èŠ‚ç‚¹ï¼ˆrootFiberï¼‰ã€‚</p>\n</li>\n</ul>\n<p>çœ‹åˆ°è¿™é‡Œçš„ä¼™ä¼´ï¼Œè°¢è°¢ä½ çš„è€å¿ƒã€‚</p>\n<h1 id=\"æœ€å\"><a href=\"#æœ€å\" class=\"headerlink\" title=\"æœ€å\"></a>æœ€å</h1><p>å› ä¸ºæˆ‘ä¹Ÿæ˜¯åœ¨ä¸€è¾¹çœ‹ï¼Œä¸€è¾¹è®°å½•ï¼Œå¦‚æœæœ‰é—®é¢˜ï¼Œå¤§å®¶ä¸€å®šè¦åŠæ—¶æå‡ºæ¥ã€‚æˆ‘ä¹Ÿä¼šåŠæ—¶æ›´æ–°çš„ã€‚è¿™éƒ¨åˆ†æˆ‘åº”è¯¥ä¼šå±¡æ¬¡é˜…è¯»ã€‚æ¯•ç«Ÿå¤§ç¥å†™äº†å‡ å¹´ï¼Œæˆ‘ä¸å¯èƒ½å‡ å¤©å°±çœ‹æ˜ç™½çš„ã€‚</p>\n<h1 id=\"ç´¢å¼•\"><a href=\"#ç´¢å¼•\" class=\"headerlink\" title=\"ç´¢å¼•\"></a>ç´¢å¼•</h1><p><a href=\"https://zh-hans.reactjs.org/docs\" target=\"_blank\" rel=\"noopener\">https://zh-hans.reactjs.org/docs</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h1><p>åœ¨ç¬¬ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬è§£è¯»åˆ°ReactDOM.renderä¹‹åå°±æ²¡æœ‰ç»§ç»­äº†ã€‚å› ä¸ºæˆ‘çœ‹äº†ä¸€ä¸‹è®¾è®¡åˆ°äº†Fiberçš„ä¸€äº›çŸ¥è¯†ï¼Œæ‰€ä»¥åœ¨ç¬¬äºŒç« è¡¥å……äº†Fiberçš„åŸºç¡€çŸ¥è¯†ä¹‹åï¼Œæˆ‘å°†Fiberæ‹†åˆ†æˆå››å—æ¥è®²</p>\n<ul>\n<li>åŠ¨æœºï¼ˆæˆ–è€…è¯´åˆè¡·</li>\n<li>åˆå§‹åŒ–-Fiberæ ‘çš„å‡†å¤‡å·¥ä½œ</li>\n<li>render-Fiberæ ‘çš„æ„å»º</li>\n<li>commit-Fiberæ ‘æ˜ å°„åˆ°DOM</li>\n</ul>\n<p>ç°åœ¨æ˜¯åˆå§‹åŒ–é˜¶æ®µ</p>\n<p>æˆ‘ä»¬ç°åœ¨ç›´æ¥è¿›å…¥Fiberçš„åˆå§‹åŒ–ã€‚Actionï¼</p>\n<h1 id=\"å‰æƒ…å›é¡¾\"><a href=\"#å‰æƒ…å›é¡¾\" class=\"headerlink\" title=\"å‰æƒ…å›é¡¾\"></a>å‰æƒ…å›é¡¾</h1><p>å›é¡¾ä¸€ä¸‹ä¹‹å‰å­¦ä¹ JSXçš„æ—¶å€™ï¼Œé˜…è¯»åˆ°ReactDOM.renderã€‚å¦‚æœä½ æ²¡æœ‰é˜…è¯»è¿‡ä¹‹å‰çš„æ–‡ç« ï¼Œå¼ºçƒˆå»ºè®®ä½ åˆ°æˆ‘çš„ä¸»é¡µå»é˜…è¯»æˆ‘ä¹‹å‰çš„åšå®¢ã€‚ä¸‹é¢æˆ‘ä»¬å¼€å§‹ã€‚</p>\n<p>ReactDOM.renderçš„æºç ã€‚</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isValidContainer</span>(<span class=\"params\">node: mixed</span>): <span class=\"title\">boolean</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> !!(</span><br><span class=\"line\">    node &amp;&amp;</span><br><span class=\"line\">    (node.nodeType === ELEMENT_NODE ||</span><br><span class=\"line\">      node.nodeType === DOCUMENT_NODE ||</span><br><span class=\"line\">      node.nodeType === DOCUMENT_FRAGMENT_NODE ||</span><br><span class=\"line\">      (node.nodeType === COMMENT_NODE &amp;&amp;</span><br><span class=\"line\">        (node: <span class=\"built_in\">any</span>).nodeValue === <span class=\"string\">' react-mount-point-unstable '</span>))</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">render</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  element: React$Element&lt;<span class=\"built_in\">any</span>&gt;,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  container: Container,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  callback: ?<span class=\"built_in\">Function</span>,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// ç”¨äºæŠ›å‡ºé”™è¯¯çš„, å°±æ˜¯åˆ¤æ–­è¿™ä¸ªcontaineræ˜¯ä¸æ˜¯æ‰¾å¾—åˆ°</span></span><br><span class=\"line\">  invariant(</span><br><span class=\"line\">    isValidContainer(container),</span><br><span class=\"line\">    <span class=\"string\">'Target container is not a DOM element.'</span>,</span><br><span class=\"line\">  );</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (__DEV__) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> isModernRoot =</span><br><span class=\"line\">      isContainerMarkedAsRoot(container) &amp;&amp;</span><br><span class=\"line\">      container._reactRootContainer === <span class=\"literal\">undefined</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isModernRoot) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.error(</span><br><span class=\"line\">        <span class=\"string\">'You are calling ReactDOM.render() on a container that was previously '</span> +</span><br><span class=\"line\">          <span class=\"string\">'passed to ReactDOM.createRoot(). This is not supported. '</span> +</span><br><span class=\"line\">          <span class=\"string\">'Did you mean to call root.render(element)?'</span>,</span><br><span class=\"line\">      );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// è¿™é‡Œé¢æ¶‰åŠåˆ°äº†fiberçš„ä¸€äº›æ¶æ„ï¼Œå¼€å§‹è¡¥å‘</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> legacyRenderSubtreeIntoContainer(</span><br><span class=\"line\">    <span class=\"literal\">null</span>,</span><br><span class=\"line\">    element,</span><br><span class=\"line\">    container,</span><br><span class=\"line\">    <span class=\"literal\">false</span>,</span><br><span class=\"line\">    callback,</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æœ€åreturnçš„è¿™ä¸ªå‡½æ•°æœ‰ç‚¹æ„æ€ã€‚</p>\n<h1 id=\"æºç æ”»è¯»\"><a href=\"#æºç æ”»è¯»\" class=\"headerlink\" title=\"æºç æ”»è¯»\"></a>æºç æ”»è¯»</h1><h2 id=\"legacyRenderSubtreeIntoContainer\"><a href=\"#legacyRenderSubtreeIntoContainer\" class=\"headerlink\" title=\"legacyRenderSubtreeIntoContainer\"></a>legacyRenderSubtreeIntoContainer</h2><p>æˆ‘ä»¬é¦–å…ˆç¿»è¯‘ä¸€ä¸‹è¿™ä¸ªå‡½æ•°çš„åå­—ï¼Œè¿›è¡Œé©¼å³°æ‹†åˆ†ï¼š</p>\n<blockquote>\n<p>Googleç¿»è¯‘ï¼šlegacy Render Subtree Into Containerï¼ˆæ—§ç‰ˆæ¸²æŸ“å­æ ‘æ”¾å…¥å®¹å™¨</p>\n</blockquote>\n<p>å…ˆåˆ«æ€¥ç€ç¿»è¯‘ã€‚æˆ‘ä»¬å…ˆçœ‹çœ‹æºç ã€‚</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">legacyRenderSubtreeIntoContainer</span>(<span class=\"params\">parentComponent, children, container, forceHydrate, callback</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// container å¯¹åº”çš„æ˜¯æˆ‘ä»¬ä¼ å…¥çš„çœŸå® DOM å¯¹è±¡</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> root = container._reactRootContainer;</span><br><span class=\"line\">  <span class=\"comment\">// åˆå§‹åŒ– fiberRoot å¯¹è±¡</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> fiberRoot;</span><br><span class=\"line\">  <span class=\"comment\">// DOM å¯¹è±¡æœ¬èº«ä¸å­˜åœ¨ _reactRootContainer å±æ€§ï¼Œå› æ­¤ root ä¸ºç©º</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!root) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// è‹¥ root ä¸ºç©ºï¼Œåˆ™åˆå§‹åŒ– _reactRootContainerï¼Œå¹¶å°†å…¶å€¼èµ‹å€¼ç»™ root</span></span><br><span class=\"line\">    <span class=\"comment\">// legacyCreateRootFromDOMContainer ä¸»è¦çš„åŠŸèƒ½æ˜¯åˆ›å»ºï¼Œå¹¶ä¸”è¿›è¡Œä¸€äº›â€œè„åˆ¤æ–­â€ã€‚æ„Ÿå…´è¶£çš„ï¼Œæˆ‘åœ¨åé¢ä¹Ÿä¼šè¯¦ç»†ç»™å‡º</span></span><br><span class=\"line\">    root = container._reactRootContainer = legacyCreateRootFromDOMContainer(container, forceHydrate);</span><br><span class=\"line\">    <span class=\"comment\">// legacyCreateRootFromDOMContainer åˆ›å»ºå‡ºçš„å¯¹è±¡ä¼šæœ‰ä¸€ä¸ª _internalRoot å±æ€§ï¼Œå°†å…¶èµ‹å€¼ç»™ fiberRoot</span></span><br><span class=\"line\">    fiberRoot = root._internalRoot;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// è¿™é‡Œå¤„ç†çš„æ˜¯ ReactDOM.render å…¥å‚ä¸­çš„å›è°ƒå‡½æ•°ï¼Œä½ äº†è§£å³å¯</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> callback === <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> originalCallback = callback;</span><br><span class=\"line\">      callback = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> instance = getPublicRootInstance(fiberRoot);</span><br><span class=\"line\">        originalCallback.call(instance);</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">    &#125; <span class=\"comment\">// Initial mount should not be batched.</span></span><br><span class=\"line\">    <span class=\"comment\">// è¿›å…¥ unbatchedUpdates æ–¹æ³•</span></span><br><span class=\"line\">    unbatchedUpdates(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      updateContainer(children, fiberRoot, parentComponent, callback);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// else é€»è¾‘å¤„ç†çš„æ˜¯éé¦–æ¬¡æ¸²æŸ“çš„æƒ…å†µï¼ˆå³æ›´æ–°ï¼‰ï¼Œå…¶é€»è¾‘é™¤äº†è·³è¿‡äº†åˆå§‹åŒ–å·¥ä½œï¼Œä¸æ¥¼ä¸ŠåŸºæœ¬ä¸€è‡´</span></span><br><span class=\"line\">    fiberRoot = root._internalRoot;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> callback === <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> _originalCallback = callback;</span><br><span class=\"line\">      callback = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> instance = getPublicRootInstance(fiberRoot);</span><br><span class=\"line\">        _originalCallback.call(instance);</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">    &#125; <span class=\"comment\">// Update</span></span><br><span class=\"line\"></span><br><span class=\"line\">    updateContainer(children, fiberRoot, parentComponent, callback);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> getPublicRootInstance(fiberRoot);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æ¢³ç†ä¸€ä¸‹æ•´ä¸ªæµç¨‹ï¼Œç„¶åæˆ‘ä»¬å†ä¸€ä¸€çœ‹è¿™äº›å‡½æ•°ã€‚</p>\n<p>ä»¥ä¸‹æµç¨‹æ˜¯æŒ‡åˆå§‹åŒ–ï¼Œä¹Ÿå°±æ˜¯<code>if/else</code>åˆ¤æ–­é‡Œé¢çš„<code>if</code>ã€‚è€Œä¸æ˜¯<code>else</code>ï¼Œ<code>else</code>æ˜¯éé¦–æ¬¡æ¸²æŸ“ï¼Œèµ°çš„æ›´æ–°æµç¨‹ï¼Œæ³¨é‡Šé‡Œé¢å†™äº†ã€‚</p>\n<ol>\n<li>åˆ›å»º<code>container._reactRootContainer</code>å¯¹è±¡ï¼Œå¹¶èµ‹å€¼ç»™<code>root</code></li>\n<li>å°†<code>root</code>ä¸Šçš„<code>_inernalRoot</code>èµ‹å€¼ç»™<code>fiberRoot</code></li>\n<li>å°†<code>legacyRenderSubtreeIntoContainer</code>çš„ä¸€äº›å‚æ•°å’Œ<code>fiberRoot</code>ä¸€èµ·ä¼ ç»™<code>updateContainer</code></li>\n<li><code>å°†updateConatiner</code>ä½œä¸ºå›è°ƒå‡½æ•°ä¼ ç»™<code>unbatechedUpdates</code></li>\n</ol>\n<p>okï¼Œç°åœ¨çœ‹ä¸å¤ªæ‡‚æ²¡å…³ç³»ã€‚æˆ‘ä»¬å°†é‡Œé¢ç”¨åˆ°çš„å‡½æ•°ä¸€ä¸€è§£è¯»ï¼Œç„¶åå†å›æ¥è¡¥å……æ•´ä¸ªæµç¨‹ã€‚</p>\n<h2 id=\"legacyCreateRootFromDOMContainer\"><a href=\"#legacyCreateRootFromDOMContainer\" class=\"headerlink\" title=\"legacyCreateRootFromDOMContainer\"></a>legacyCreateRootFromDOMContainer</h2><p>å¤§å®¶ç°åœ¨ä¸€å®šä¼šæ™•å¤´è½¬å‘ï¼Œå› ä¸ºæˆ‘çœ‹çš„æ—¶å€™ä¹Ÿæ˜¯è¿™æ ·ï¼Œä»–çš„åå­—å’Œå‡½æ•°åå­—å–çš„å¤ªåƒäº†ï¼Œæˆ‘ä»¬éœ€è¦ç»™ä»–ä»¬ç‹¬è‡ªç”¨è‡ªå·±çš„æ–¹å¼å‘½åã€‚æˆ‘ä¼šå†™ä¸‹Googleç¿»è¯‘ï¼Œ å¸®åŠ©å¤§å®¶å–åå­—ã€‚</p>\n<blockquote>\n<p>Googleç¿»è¯‘ï¼šlegacy Create Root From DOM Containerï¼ˆä»DOMå®¹å™¨åˆ›å»ºæ ¹ç›®å½•</p>\n</blockquote>\n<p>çœ‹äº†ç¿»è¯‘ä¹‹åæ˜¯ä¸æ˜¯ç„•ç„¶å¤§æ‚Ÿï¼Ÿåˆ«æ€¥ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹æºç ã€‚</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">legacyCreateRootFromDOMContainer</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  container: Container,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  forceHydrate: <span class=\"built_in\">boolean</span>,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\"></span>): <span class=\"title\">RootType</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœforceHydrateæ˜¯falseï¼Œå°±ä¼šè°ƒç”¨åé¢çš„æ–¹æ³•ã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> shouldHydrate =</span><br><span class=\"line\">    forceHydrate || shouldHydrateDueToLegacyHeuristic(container);</span><br><span class=\"line\">  <span class=\"comment\">// First clear any existing content.</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!shouldHydrate) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> warned = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> rootSibling;</span><br><span class=\"line\">    <span class=\"comment\">// è¿™ä¸ªå¾ªç¯ï¼Œæ˜¯ä¸ºäº†æ¸…ç†æ‰€æœ‰çš„å†…å®¹ï¼Œç„¶åæ‰¾åˆ°æˆ‘ä»¬è¦æ¸²æŸ“çš„æœ€åˆçš„æ ¹divã€‚é€šå¸¸æˆ‘ä»¬çš„htmlä¼šæœ‰ä¸€ä¸ª</span></span><br><span class=\"line\">    <span class=\"comment\">// &lt;div id=\"root\"&gt;&lt;/div&gt; ä¸ºçš„å°±æ˜¯ä¿éšœä»–çš„çº¯å‡€ã€‚</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> ((rootSibling = container.lastChild)) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (__DEV__) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (</span><br><span class=\"line\">          !warned &amp;&amp;</span><br><span class=\"line\">          rootSibling.nodeType === ELEMENT_NODE &amp;&amp;</span><br><span class=\"line\">          (rootSibling: <span class=\"built_in\">any</span>).hasAttribute(ROOT_ATTRIBUTE_NAME)</span><br><span class=\"line\">        ) &#123;</span><br><span class=\"line\">          warned = <span class=\"literal\">true</span>;</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.error(</span><br><span class=\"line\">            <span class=\"string\">'render(): Target node has markup rendered by React, but there '</span> +</span><br><span class=\"line\">              <span class=\"string\">'are unrelated nodes as well. This is most commonly caused by '</span> +</span><br><span class=\"line\">              <span class=\"string\">'white-space inserted around server-rendered markup.'</span>,</span><br><span class=\"line\">          );</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      container.removeChild(rootSibling);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (__DEV__) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (shouldHydrate &amp;&amp; !forceHydrate &amp;&amp; !warnedAboutHydrateAPI) &#123;</span><br><span class=\"line\">      warnedAboutHydrateAPI = <span class=\"literal\">true</span>;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.warn(</span><br><span class=\"line\">        <span class=\"string\">'render(): Calling ReactDOM.render() to hydrate server-rendered markup '</span> +</span><br><span class=\"line\">          <span class=\"string\">'will stop working in React v18. Replace the ReactDOM.render() call '</span> +</span><br><span class=\"line\">          <span class=\"string\">'with ReactDOM.hydrate() if you want React to attach to the server HTML.'</span>,</span><br><span class=\"line\">      );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> createLegacyRoot(</span><br><span class=\"line\">    container,</span><br><span class=\"line\">    shouldHydrate</span><br><span class=\"line\">      ? &#123;</span><br><span class=\"line\">          hydrate: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      : <span class=\"literal\">undefined</span>,</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>é‡Œé¢åˆç”¨åˆ°ä¸¤ä¸ªå‡½æ•°ï¼Œæˆ‘ä¸ºå¤§å®¶å¬å‡ºæ¥ã€‚</p>\n<h3 id=\"shouldHydrateDueToLegacyHeuristic\"><a href=\"#shouldHydrateDueToLegacyHeuristic\" class=\"headerlink\" title=\"shouldHydrateDueToLegacyHeuristic\"></a>shouldHydrateDueToLegacyHeuristic</h3><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getReactRootElementInContainer</span>(<span class=\"params\">container: <span class=\"built_in\">any</span></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœæ²¡æœ‰å°±è¿”å›null</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!container) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// å†…éƒ¨å®šä¹‰çš„ä¸€ä¸ªå¸¸é‡</span></span><br><span class=\"line\">  <span class=\"comment\">// export const DOCUMENT_NODE = 9;çœ‹åå­—å°±é¡¾åæ€ä¹‰äº†</span></span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœæ˜¯å†…éƒ¨ä¸€ä¸ªdocumentèŠ‚ç‚¹å°±è¿”å›documentèŠ‚ç‚¹</span></span><br><span class=\"line\">  <span class=\"comment\">// æ„Ÿå…´è¶£å¯ä»¥çœ‹çœ‹MDNçš„ä»‹ç»ï¼šhttps://developer.mozilla.org/zh-CN/docs/Web/API/Document</span></span><br><span class=\"line\">  <span class=\"comment\">// å¸¸é‡çš„å€¼ä¹Ÿæœ‰ï¼šhttps://developer.mozilla.org/zh-CN/docs/Web/API/Node/nodeType</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (container.nodeType === DOCUMENT_NODE) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> container.documentElement;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// å¦åˆ™è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> container.firstChild;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">shouldHydrateDueToLegacyHeuristic</span>(<span class=\"params\">container</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// å°†containerä¼ å…¥å‡½æ•°ï¼Œè¿›è¡Œåˆ¤æ–­ç±»å‹ï¼Œå¹¶å¾—åˆ°èŠ‚ç‚¹ï¼ˆæœ‰å¯èƒ½ä¸ºç©ºï¼Œçœ‹æ³¨é‡Š</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> rootElement = getReactRootElementInContainer(container);</span><br><span class=\"line\">  <span class=\"comment\">// å¼ºè½¬ä¸ºå¸ƒå°”å€¼</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> !!(</span><br><span class=\"line\">    rootElement &amp;&amp;</span><br><span class=\"line\">    rootElement.nodeType === ELEMENT_NODE &amp;&amp;</span><br><span class=\"line\">    <span class=\"comment\">// export const ROOT_ATTRIBUTE_NAME = 'data-reactroot'; </span></span><br><span class=\"line\">    rootElement.hasAttribute(ROOT_ATTRIBUTE_NAME)</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æˆ‘ä»¬çœ‹åˆ°ä¸€ä¸ªhasAttributeä¸ºâ€data-reactrootâ€ã€‚è¿™æ˜¯ React åœ¨æœåŠ¡ç«¯æ¸²æŸ“çš„æ—¶å€™åŠ ä¸Šå»çš„ã€‚ä¹‹å‰æœ‰è¯´è¿‡Hydrateè¿™ä¸ªæ“ä½œæ˜¯æœåŠ¡ç«¯æ¸²æŸ“çš„æ—¶å€™éœ€è¦çš„ä¸œè¥¿ã€‚</p>\n<blockquote>\n<p>Googleç¿»è¯‘ï¼šgetReactRootElementInContainerï¼ˆè·å–å®¹å™¨ä¸­çš„Reactæ ¹å…ƒç´ </p>\n<p>Googleç¿»è¯‘ï¼šshouldHydrateDueToLegacyHeuristicï¼ˆåº”å½“å› ä¼ ç»Ÿå¯å‘è€Œæ°´åˆ</p>\n<p>è¯´äººè¯å°±æ˜¯æ˜¯å¦éœ€è¦è¿›è¡Œhydrateæ“ä½œ</p>\n</blockquote>\n<p>æ‰€ä»¥<code>legacyCreateRootFromDOMContainer</code>è¿™ä¸ªå‡½æ•°æ˜¯ä¿éšœ<code>container</code>çš„çº¯å‡€ã€‚å¹¶ä¸”è¿”å›<code>createLegacyRoot</code>å‡½æ•°ã€‚okç»§ç»­çœ‹ã€‚</p>\n<h3 id=\"createLegacyRoot\"><a href=\"#createLegacyRoot\" class=\"headerlink\" title=\"createLegacyRoot\"></a>createLegacyRoot</h3><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">ReactDOMLegacyRoot</span>(<span class=\"params\">container: Container, options: <span class=\"built_in\">void</span> | RootOptions</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// æ˜¯ä¸æ˜¯çœ‹è§è€æœ‹å‹äº†ã€‚_internalRootã€‚ç»§ç»­çœ‹ä¸‹é¢çš„å†…å®¹ï¼Œæˆ‘ä»¬æ¥è§£æä¸€ä¸‹createRootImpl</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>._internalRoot = createRootImpl(container, LegacyRoot, options);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createLegacyRoot</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  container: Container,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  options?: RootOptions,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\"></span>): <span class=\"title\">RootType</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// åˆæ˜¯ç†Ÿæ‚‰çš„æ“ä½œï¼Œè¿”å›æŸä¸ªä¸œè¥¿</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> ReactDOMLegacyRoot(container, options);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"createRootImpl\"><a href=\"#createRootImpl\" class=\"headerlink\" title=\"createRootImpl\"></a>createRootImpl</h3><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬é€šç¯‡éƒ½æ˜¯ä»¥é<code>hydrate</code>æ¥çœ‹çš„ï¼Œå› ä¸ºæˆ‘ä»¬ä¸æ˜¯æœåŠ¡ç«¯æ¸²æŸ“ã€‚ä½†æ˜¯æˆ‘ä¹Ÿä¼šä»‹ç»å¦‚æœæœ‰<code>hydrate</code>çš„å†…å®¹ã€‚æ‰€ä»¥å¤§å®¶çœ‹çš„æ—¶å€™å¯ä»¥ç¨å¾®å¸¦å…¥ä¸€ç‚¹å»çœ‹ï¼Œä¸ç„¶å¾ˆå®¹æ˜“èµ°ç¥ï¼</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªfiberRoot</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createRootImpl</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  container: Container,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  tag: RootTag,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  options: <span class=\"built_in\">void</span> | RootOptions,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// Tag is either LegacyRoot or Concurrent Root</span></span><br><span class=\"line\">  <span class=\"comment\">// åˆ¤æ–­æ˜¯å¦ä¸ºhydrateæ¨¡å¼</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> hydrate = options != <span class=\"literal\">null</span> &amp;&amp; options.hydrate === <span class=\"literal\">true</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> hydrationCallbacks =</span><br><span class=\"line\">    (options != <span class=\"literal\">null</span> &amp;&amp; options.hydrationOptions) || <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> mutableSources =</span><br><span class=\"line\">    (options != <span class=\"literal\">null</span> &amp;&amp;</span><br><span class=\"line\">      options.hydrationOptions != <span class=\"literal\">null</span> &amp;&amp;</span><br><span class=\"line\">      options.hydrationOptions.mutableSources) ||</span><br><span class=\"line\">    <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> strictModeLevelOverride =</span><br><span class=\"line\">    options != <span class=\"literal\">null</span> &amp;&amp; options.unstable_strictModeLevel != <span class=\"literal\">null</span></span><br><span class=\"line\">      ? options.unstable_strictModeLevel</span><br><span class=\"line\">      : <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// åˆ›å»ºä¸€ä¸ªfiberRoot</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> root = createContainer(</span><br><span class=\"line\">    container,</span><br><span class=\"line\">    tag,</span><br><span class=\"line\">    hydrate,</span><br><span class=\"line\">    hydrationCallbacks,</span><br><span class=\"line\">    strictModeLevelOverride,</span><br><span class=\"line\">  );</span><br><span class=\"line\">  <span class=\"comment\">// ç»™containeré™„åŠ ä¸€ä¸ªå†…éƒ¨å±æ€§ç”¨äºæŒ‡å‘fiberRootçš„currentå±æ€§å¯¹åº”çš„rootFiberèŠ‚ç‚¹</span></span><br><span class=\"line\">  markContainerAsRoot(root.current, container);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> rootContainerElement =</span><br><span class=\"line\">    container.nodeType === COMMENT_NODE ? container.parentNode : container;</span><br><span class=\"line\">  listenToAllSupportedEvents(rootContainerElement);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (mutableSources) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; mutableSources.length; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> mutableSource = mutableSources[i];</span><br><span class=\"line\">      registerMutableSourceForHydration(root, mutableSource);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> root;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä¸ºä»€ä¹ˆæˆ‘åœ¨æ³¨é‡Šé‡Œé¢ä¼šåŠ ä¸Šã€Œåˆ›å»ºä¸€ä¸ªfiberRootã€ï¼Œä¸æ˜¯ä¸€ä¸ªæ˜¯åˆ›å»ºä¸€ä¸ªcontainerå—ï¼Ÿæˆ‘ä»¬çœ‹createContaineré‡Œé¢åšäº†ä»€ä¹ˆã€‚</p>\n<h3 id=\"createContainer\"><a href=\"#createContainer\" class=\"headerlink\" title=\"createContainer\"></a>createContainer</h3><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createFiberRoot</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  containerInfo: <span class=\"built_in\">any</span>,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  tag: RootTag,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  hydrate: <span class=\"built_in\">boolean</span>,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  hydrationCallbacks: <span class=\"literal\">null</span> | SuspenseHydrationCallbacks,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  strictModeLevelOverride: <span class=\"literal\">null</span> | <span class=\"built_in\">number</span>,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\"></span>): <span class=\"title\">FiberRoot</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// é€šè¿‡FiberRootNodeæ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªfiberRootå®ä¾‹</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> root: FiberRoot = (<span class=\"keyword\">new</span> FiberRootNode(containerInfo, tag, hydrate): <span class=\"built_in\">any</span>);</span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœæœ‰ï¼Œå°±è¡¥å……è¿›è¿™ä¸ªå›è°ƒå‡½æ•°</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (enableSuspenseCallback) &#123;</span><br><span class=\"line\">    root.hydrationCallbacks = hydrationCallbacks;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Cyclic construction. This cheats the type system right now because</span></span><br><span class=\"line\">  <span class=\"comment\">// stateNode is any.</span></span><br><span class=\"line\">  <span class=\"comment\">// é€šè¿‡createHostRootFiberæ–¹æ³•åˆ›å»ºfiber treeçš„æ ¹ç»“ç‚¹ï¼Œå³rootFiber</span></span><br><span class=\"line\">  <span class=\"comment\">// fiberèŠ‚ç‚¹ä¹Ÿä¼šåƒDOMæ ‘ç»“æ„ä¸€æ ·å½¢æˆä¸€ä¸ªfiber treeå•é“¾è¡¨æ ‘ç»“æ„</span></span><br><span class=\"line\">  <span class=\"comment\">// æ¯ä¸ªDOMèŠ‚ç‚¹æˆ–è€…ç»„ä»¶éƒ½ä¼šç”Ÿæˆä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„fiberèŠ‚ç‚¹ï¼Œåœ¨åç»­çš„è°ƒå’Œ(reconciliation)é˜¶æ®µèµ·ç€è‡³å…³é‡è¦çš„ä½œç”¨</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> uninitializedFiber = createHostRootFiber(tag, strictModeLevelOverride);</span><br><span class=\"line\">  <span class=\"comment\">// åˆ›å»ºå®ŒrootFiberä¹‹åï¼Œä¼šå°†fiberRootçš„å®ä¾‹çš„currentå±æ€§æŒ‡å‘åˆšåˆ›å»ºçš„rootFiber</span></span><br><span class=\"line\">  root.current = uninitializedFiber;</span><br><span class=\"line\">  <span class=\"comment\">// åŒæ—¶rootFiberçš„stateNodeå±æ€§ä¼šæŒ‡å‘fiberRootå®ä¾‹ï¼Œå½¢æˆç›¸äº’å¼•ç”¨</span></span><br><span class=\"line\">  uninitializedFiber.stateNode = root;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (enableCache) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> initialCache = <span class=\"keyword\">new</span> Map();</span><br><span class=\"line\">    root.pooledCache = initialCache;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> initialState = &#123;</span><br><span class=\"line\">      element: <span class=\"literal\">null</span>,</span><br><span class=\"line\">      cache: initialCache,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    uninitializedFiber.memoizedState = initialState;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> initialState = &#123;</span><br><span class=\"line\">      element: <span class=\"literal\">null</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    uninitializedFiber.memoizedState = initialState;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  initializeUpdateQueue(uninitializedFiber);</span><br><span class=\"line\">\t<span class=\"comment\">// æœ€åå°†åˆ›å»ºçš„fiberRootå®ä¾‹è¿”å›</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> root;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// å†…éƒ¨è°ƒç”¨createFiberRootæ–¹æ³•è¿”å›ä¸€ä¸ªfiberRootå®ä¾‹</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createContainer</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  containerInfo: Container,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  tag: RootTag,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  hydrate: <span class=\"built_in\">boolean</span>,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  hydrationCallbacks: <span class=\"literal\">null</span> | SuspenseHydrationCallbacks,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  strictModeLevelOverride: <span class=\"literal\">null</span> | <span class=\"built_in\">number</span>,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\"></span>): <span class=\"title\">OpaqueRoot</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> createFiberRoot(</span><br><span class=\"line\">    containerInfo,</span><br><span class=\"line\">    tag,</span><br><span class=\"line\">    hydrate,</span><br><span class=\"line\">    hydrationCallbacks,</span><br><span class=\"line\">    strictModeLevelOverride,</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>è¿™é‡Œä¹Ÿæ¯”è¾ƒç®€å•ï¼Œåªæ˜¯å•çº¯çš„è°ƒç”¨å‡½æ•°ï¼Œç„¶åè¿”å›ã€‚çœŸæ­£çš„ç§˜å¯†å°±åœ¨è¿™äº›å‡½æ•°é‡Œé¢ï¼Œè€å¿ƒç‚¹ç»§ç»­çœ‹ï¼é»æ˜å°±åœ¨çœ¼å‰</p>\n<h4 id=\"FiberRootNode\"><a href=\"#FiberRootNode\" class=\"headerlink\" title=\"FiberRootNode\"></a>FiberRootNode</h4><p>ä¸€ä¸ªéå¸¸ææ€–çš„å†…å®¹ã€‚ä½†æ˜¯çœ‹åå­—ä¹Ÿèƒ½çŒœä¸ªå¤§æ¦‚ã€‚è¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰è¯´è¿‡ã€‚ä¸€ä¸ªfiberèŠ‚ç‚¹è¦å­˜çš„å†…å®¹è¿˜è›®å¤šçš„ã€‚æ¯”å¦‚è¢«æš‚åœæ—¶çš„çŠ¶æ€ï¼Œæ¢å¤æ—¶è¦åšçš„äº‹æƒ…ï¼Œä¼˜å…ˆçº§ç­‰ç­‰â€¦.è¿™é‡Œæˆ‘å°½å¯èƒ½çš„å»å†™æ³¨é‡Šã€‚å¸®åŠ©å¤§å®¶è¿˜è¦æˆ‘è‡ªå·±ç†è§£ã€‚</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">FiberRootNode</span>(<span class=\"params\">containerInfo, tag, hydrate</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//root èŠ‚ç‚¹ç±»å‹()</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.tag = tag;</span><br><span class=\"line\">  <span class=\"comment\">//rootæ ¹èŠ‚ç‚¹ï¼Œrenderæ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.containerInfo = containerInfo;</span><br><span class=\"line\">  <span class=\"comment\">//åœ¨æŒä¹…æ›´æ–°ä¸­ä¼šç”¨åˆ°ï¼Œä¸æ”¯æŒå¢é‡æ›´æ–°çš„å¹³å°ï¼Œreact-dom æ˜¯æ•´ä¸ªåº”ç”¨æ›´æ–°ï¼Œæ‰€ä»¥ç”¨ä¸åˆ°</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.pendingChildren = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">//å½“å‰åº”ç”¨rootèŠ‚ç‚¹å¯¹åº”çš„Fiberå¯¹è±¡</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.current = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">//ç¼“å­˜</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.pingCache = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">//å·²ç»å®Œæˆä»»åŠ¡çš„FiberRootå¯¹è±¡ï¼Œåœ¨commit(æäº¤)é˜¶æ®µåªä¼šå¤„ç†è¯¥å€¼å¯¹åº”çš„ä»»åŠ¡</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.finishedWork = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">//åœ¨ä»»åŠ¡è¢«æŒ‚èµ·çš„æ—¶å€™é€šè¿‡setTimeoutè®¾ç½®çš„è¿”å›å†…å®¹ï¼Œç”¨æ¥ä¸‹ä¸€æ¬¡å¦‚æœæœ‰æ–°çš„ä»»åŠ¡æŒ‚èµ·æ—¶æ¸…ç†è¿˜æ²¡è§¦å‘çš„timeout</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.timeoutHandle = noTimeout;</span><br><span class=\"line\">  <span class=\"comment\">//é¡¶å±‚ context å¯¹è±¡ï¼Œåªæœ‰ä¸»åŠ¨è°ƒç”¨renderSubtreeIntoContaineræ‰ä¼šç”Ÿæ•ˆ</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.context = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.pendingContext = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// è€æœ‹å‹äº†ï¼Œç”¨æ¥ç¡®å®šç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™æ˜¯å¦éœ€è¦æ³¨æ°´</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.hydrate = hydrate;</span><br><span class=\"line\">  <span class=\"comment\">//å›è°ƒèŠ‚ç‚¹</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.callbackNode = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">//å›è°ƒå±æ€§</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.callbackPriority = NoLane;</span><br><span class=\"line\">  <span class=\"comment\">// export const NoLanes: Lanes = 0b0000000000000000000000000000000;</span></span><br><span class=\"line\">  <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">  export function createLaneMap&lt;T&gt;(initial: T): LaneMap&lt;T&gt; &#123;</span></span><br><span class=\"line\"><span class=\"comment\">    // Intentionally pushing one by one.</span></span><br><span class=\"line\"><span class=\"comment\">    // https://v8.dev/blog/elements-kinds#avoid-creating-holes</span></span><br><span class=\"line\"><span class=\"comment\">    const laneMap = [];</span></span><br><span class=\"line\"><span class=\"comment\">    for (let i = 0; i &lt; TotalLanes; i++) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">      laneMap.push(initial);</span></span><br><span class=\"line\"><span class=\"comment\">    &#125;</span></span><br><span class=\"line\"><span class=\"comment\">    return laneMap;</span></span><br><span class=\"line\"><span class=\"comment\">  &#125;</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\">  <span class=\"comment\">//ä»»åŠ¡æ—¶é—´ã€‚ç”±äºè¯¥å­—æ®µåœ¨æœªæ¥ä¼šé‡æ„ï¼Œå½“å‰æˆ‘ä»¬ä¸éœ€è¦ç†è§£ä»–ã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.eventTimes = createLaneMap(NoLanes);</span><br><span class=\"line\">  <span class=\"comment\">// è¿‡æœŸæ—¶é—´ã€‚å‡½æ•°ä¸Šé¢çš„æ³¨é‡Šæœ‰ã€‚export const NoTimestamp = -1;</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.expirationTimes = createLaneMap(NoTimestamp);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// ä¼˜å…ˆçº§çš„åˆå§‹åŒ–</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.pendingLanes = NoLanes;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.suspendedLanes = NoLanes;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.pingedLanes = NoLanes;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.mutableReadLanes = NoLanes;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.finishedLanes = NoLanes;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.entangledLanes = NoLanes;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.entanglements = createLaneMap(NoLanes);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (enableCache) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.pooledCache = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.pooledCacheLanes = NoLanes;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (supportsHydration) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.mutableSourceEagerHydrationData = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (enableSchedulerTracing) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.interactionThreadID = unstable_getThreadID();</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.memoizedInteractions = <span class=\"keyword\">new</span> Set();</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.pendingInteractionMap = <span class=\"keyword\">new</span> Map();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (enableSuspenseCallback) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.hydrationCallbacks = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (enableProfilerTimer &amp;&amp; enableProfilerCommitHooks) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.effectDuration = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.passiveEffectDuration = <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (__DEV__) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (tag) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> ConcurrentRoot:</span><br><span class=\"line\">        <span class=\"keyword\">this</span>._debugRootType = <span class=\"string\">'createRoot()'</span>;</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> LegacyRoot:</span><br><span class=\"line\">        <span class=\"keyword\">this</span>._debugRootType = <span class=\"string\">'createLegacyRoot()'</span>;</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"createHostRootFiber\"><a href=\"#createHostRootFiber\" class=\"headerlink\" title=\"createHostRootFiber\"></a>createHostRootFiber</h4><p>é€šç¯‡å¤§è®ºéƒ½æ˜¯åœ¨åˆ¤æ–­modeç±»å‹ã€‚æ„Ÿå…´è¶£çš„å¯ä»¥å†æ·±æŒ–ã€‚è¿™é‡Œæˆ‘å°±ç•¥è¿‡äº†ã€‚çœ¼ç›å·²ç»çœ‹èŠ±äº†ã€‚ã€‚ã€‚</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createHostRootFiber</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  tag: RootTag,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  strictModeLevelOverride: <span class=\"literal\">null</span> | <span class=\"built_in\">number</span>,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\"></span>): <span class=\"title\">Fiber</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> mode;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (tag === ConcurrentRoot) &#123;</span><br><span class=\"line\">    mode = ConcurrentMode;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (strictModeLevelOverride !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (strictModeLevelOverride &gt;= <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        mode |= StrictLegacyMode;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (enableStrictEffects) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (strictModeLevelOverride &gt;= <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">          mode |= StrictEffectsMode;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (enableStrictEffects &amp;&amp; createRootStrictEffectsByDefault) &#123;</span><br><span class=\"line\">        mode |= StrictLegacyMode | StrictEffectsMode;</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        mode |= StrictLegacyMode;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    mode = NoMode;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (enableProfilerTimer &amp;&amp; isDevToolsPresent) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Always collect profile timings when DevTools are present.</span></span><br><span class=\"line\">    <span class=\"comment\">// This enables DevTools to start capturing timing at any pointâ€“</span></span><br><span class=\"line\">    <span class=\"comment\">// Without some nodes in the tree having empty base times.</span></span><br><span class=\"line\">    mode |= ProfileMode;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">\t<span class=\"comment\">// export const HostRoot = 3;</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> createFiber(HostRoot, <span class=\"literal\">null</span>, <span class=\"literal\">null</span>, mode);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"createFiber\"><a href=\"#createFiber\" class=\"headerlink\" title=\"createFiber\"></a>createFiber</h4><p>ä¹Ÿæ˜¯åŒ…ä¸€ä¸ªå£³å­ã€‚ä¸»è¦è¿˜æ˜¯ä¸ºäº†åˆ›å»ºFiberNodeã€‚</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> createFiber = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  tag: WorkTag,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  pendingProps: mixed,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  key: <span class=\"literal\">null</span> | <span class=\"built_in\">string</span>,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  mode: TypeOfMode,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\"></span>): <span class=\"title\">Fiber</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// $FlowFixMe: the shapes are exact here but Flow doesn't like constructors</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> FiberNode(tag, pendingProps, key, mode);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"FiberNode\"><a href=\"#FiberNode\" class=\"headerlink\" title=\"FiberNode\"></a>FiberNode</h4><p>å®˜æ–¹å…¶å®å·²ç»æ³¨é‡Šäº†å±æ€§çš„è¦ç´ ã€‚ä½†æ˜¯æˆ‘è¿˜æ˜¯ä¼šå°½å¯èƒ½çš„å®Œå–„ã€‚</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">FiberNode</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  tag: WorkTag,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  pendingProps: mixed,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  key: <span class=\"literal\">null</span> | <span class=\"built_in\">string</span>,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  mode: TypeOfMode,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// Instance</span></span><br><span class=\"line\">  <span class=\"comment\">// ç”¨äºæ ‡è®°fiberèŠ‚ç‚¹çš„ç±»å‹</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.tag = tag;</span><br><span class=\"line\">  <span class=\"comment\">// ç”¨äºå”¯ä¸€æ ‡è¯†ä¸€ä¸ªfiberèŠ‚ç‚¹</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.key = key;</span><br><span class=\"line\">  <span class=\"comment\">// èŠ‚ç‚¹ç±»å‹</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.elementType = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// ReactNodeçš„èŠ‚ç‚¹ç±»å‹</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.type = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// FiberNodeä¼šé€šè¿‡stateNodeç»‘å®šä¸€äº›å…¶ä»–çš„å¯¹è±¡ï¼Œä¾‹å¦‚FiberNodeå¯¹åº”çš„Domã€FiberRootã€ReactComponentå®ä¾‹</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.stateNode = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Fiber</span></span><br><span class=\"line\">  <span class=\"comment\">// è¡¨ç¤ºçˆ¶çº§ FiberNode</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.return = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// è¡¨ç¤ºç¬¬ä¸€ä¸ªå­ FiberNode</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.child = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// è¡¨ç¤ºç´§ç´§ç›¸é‚»çš„ä¸‹ä¸€ä¸ªå…„å¼Ÿ FiberNode</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.sibling = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// ä¸‹æ ‡</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.index = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.ref = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// è¡¨ç¤ºæ–°çš„props</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.pendingProps = pendingProps;</span><br><span class=\"line\">  <span class=\"comment\">// è¡¨ç¤ºç»è¿‡æ‰€æœ‰æµç¨‹å¤„ç†åçš„æ–°props</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.memoizedProps = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// æ›´æ–°é˜Ÿåˆ—</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.updateQueue = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// è¡¨ç¤ºç»è¿‡æ‰€æœ‰æµç¨‹å¤„ç†åçš„æ–°state</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.memoizedState = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// ä¾èµ–</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.dependencies = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.mode = mode;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Effects</span></span><br><span class=\"line\">  <span class=\"comment\">// æ ‡å¿—æ›´æ–°çš„ç±»å‹ï¼šåˆ é™¤ã€æ–°å¢ã€ä¿®æ”¹ã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.flags = NoFlags;</span><br><span class=\"line\">  <span class=\"comment\">// å­Fiberæ ‘çš„æ ‡å¿—æ›´æ–°çš„ç±»å‹ï¼šåˆ é™¤ã€æ–°å¢ã€ä¿®æ”¹ã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.subtreeFlags = NoFlags;</span><br><span class=\"line\">  <span class=\"comment\">// éœ€è¦åˆ é™¤çš„å†…å®¹</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.deletions = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// ä¼˜å…ˆçº§</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.lanes = NoLanes;</span><br><span class=\"line\">  <span class=\"comment\">// å­çš„ä¼˜å…ˆçº§</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.childLanes = NoLanes;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// åŒç¼“å†²ï¼šé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œæé«˜æ•ˆç‡ï¼ˆä¹‹åDom-diffçš„æ—¶å€™å¯ä»¥ç›´æ¥æ¯”è¾ƒæˆ–è€…ä½¿ç”¨</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.alternate = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (enableProfilerTimer) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Note: The following is done to avoid a v8 performance cliff.</span></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"comment\">// Initializing the fields below to smis and later updating them with</span></span><br><span class=\"line\">    <span class=\"comment\">// double values will cause Fibers to end up having separate shapes.</span></span><br><span class=\"line\">    <span class=\"comment\">// This behavior/bug has something to do with Object.preventExtension().</span></span><br><span class=\"line\">    <span class=\"comment\">// Fortunately this only impacts DEV builds.</span></span><br><span class=\"line\">    <span class=\"comment\">// Unfortunately it makes React unusably slow for some applications.</span></span><br><span class=\"line\">    <span class=\"comment\">// To work around this, initialize the fields below with doubles.</span></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"comment\">// Learn more about this here:</span></span><br><span class=\"line\">    <span class=\"comment\">// https://github.com/facebook/react/issues/14365</span></span><br><span class=\"line\">    <span class=\"comment\">// https://bugs.chromium.org/p/v8/issues/detail?id=8538</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.actualDuration = <span class=\"built_in\">Number</span>.NaN;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.actualStartTime = <span class=\"built_in\">Number</span>.NaN;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.selfBaseDuration = <span class=\"built_in\">Number</span>.NaN;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.treeBaseDuration = <span class=\"built_in\">Number</span>.NaN;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// It's okay to replace the initial doubles with smis after initialization.</span></span><br><span class=\"line\">    <span class=\"comment\">// This won't trigger the performance cliff mentioned above,</span></span><br><span class=\"line\">    <span class=\"comment\">// and it simplifies other profiler code (including DevTools).</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.actualDuration = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.actualStartTime = <span class=\"number\">-1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.selfBaseDuration = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.treeBaseDuration = <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (__DEV__) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// This isn't directly used but is handy for debugging internals:</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>._debugID = debugCounter++;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>._debugSource = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>._debugOwner = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>._debugNeedsRemount = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>._debugHookTypes = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!hasBadMapPolyfill &amp;&amp; <span class=\"keyword\">typeof</span> <span class=\"built_in\">Object</span>.preventExtensions === <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">      <span class=\"built_in\">Object</span>.preventExtensions(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"initializeUpdateQueue\"><a href=\"#initializeUpdateQueue\" class=\"headerlink\" title=\"initializeUpdateQueue\"></a>initializeUpdateQueue</h4><p>createContainerè¿˜æœ‰æœ€åä¸€ä¸ªå‡½æ•°ï¼Œåˆå§‹åŒ–æ›´æ–°é˜Ÿåˆ—ã€‚</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">initializeUpdateQueue</span>&lt;<span class=\"title\">State</span>&gt;(<span class=\"params\">fiber: Fiber</span>): <span class=\"title\">void</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> queue: UpdateQueue&lt;State&gt; = &#123;</span><br><span class=\"line\">    baseState: fiber.memoizedState,</span><br><span class=\"line\">    firstBaseUpdate: <span class=\"literal\">null</span>,</span><br><span class=\"line\">    lastBaseUpdate: <span class=\"literal\">null</span>,</span><br><span class=\"line\">    shared: &#123;</span><br><span class=\"line\">      pending: <span class=\"literal\">null</span>,</span><br><span class=\"line\">      interleaved: <span class=\"literal\">null</span>,</span><br><span class=\"line\">      lanes: NoLanes,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    effects: <span class=\"literal\">null</span>,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  fiber.updateQueue = queue;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"å°ç»“ä¸€ç•ª\"><a href=\"#å°ç»“ä¸€ç•ª\" class=\"headerlink\" title=\"å°ç»“ä¸€ç•ª\"></a>å°ç»“ä¸€ç•ª</h1><p>å¤§è´¹å‘¨ç« çš„åšè¿™äº›é˜…è¯»ï¼Œå…¶å®å›è¿‡ç¥æ¥çœ‹ã€‚å°±æ˜¯ä¸ºäº†åˆ›å»º<code>fiberNode</code>ï¼ˆ<code>FiberRootNodeå®ä¾‹</code>ï¼‰å’Œ<code>rootFiber</code>å¯¹è±¡ã€‚è¿™ä¸¤å…„å¼Ÿæ˜¯æ•´ä¸ªFiberæ ‘æ„å»ºçš„èµ·ç‚¹ã€‚</p>\n<ul>\n<li><code>fiberNode</code>ï¼ˆ<code>FiberRootNodeå®ä¾‹</code>ï¼‰ -&gt; çš„å…³è”å¯¹è±¡æ˜¯çœŸå® DOM çš„å®¹å™¨èŠ‚ç‚¹</li>\n<li><code>rootFiber</code> -&gt; è™šæ‹Ÿ DOM çš„æ ¹èŠ‚ç‚¹</li>\n</ul>\n<p>ç„¶åå†å›è¿‡ç¥æ¥çœ‹ï¼Œç¡®å®ã€‚ä»–ä»¬å„è‡ªåˆ›å»ºéƒ½æ˜¯ä¸ºä»–ä»¬æ‰€ä»£è¡¨çš„ä¸œè¥¿è€Œåˆ›å»ºï¼Œæ— è®ºæ˜¯å±æ€§æˆ–è€…æ‰“å…¥æ–¹æ³•ã€‚</p>\n<h1 id=\"æ”¶å°¾\"><a href=\"#æ”¶å°¾\" class=\"headerlink\" title=\"æ”¶å°¾\"></a>æ”¶å°¾</h1><p>æœ€åä»–ä»¬éƒ½ä¼šè¢«<code>unbatchedUpdates</code>æ‰€æ”¶ç¼–ï¼ˆçœ‹çœ‹æœ€ä¸Šé¢æ¢¦å¼€å§‹çš„åœ°æ–¹ã€ŒlegacyRenderSubtreeIntoContainerã€ï¼‰ã€‚æœ€åæˆ‘ä»¬æ‰€åˆ›å»ºçš„éƒ½ä¼šå½’å…¥åˆ°å®ƒçš„æ‰‹ä¸Šã€‚ä¸€èµ·çœ‹çœ‹æœ€åä¸€ä¸ªå‡½æ•°å§ã€‚</p>\n<h2 id=\"æ–¹ä¾¿é˜…è¯»\"><a href=\"#æ–¹ä¾¿é˜…è¯»\" class=\"headerlink\" title=\"æ–¹ä¾¿é˜…è¯»\"></a>æ–¹ä¾¿é˜…è¯»</h2><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">unbatchedUpdates(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  updateContainer(children, fiberRoot, parentComponent, callback);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"unbatchedUpdates\"><a href=\"#unbatchedUpdates\" class=\"headerlink\" title=\"unbatchedUpdates\"></a>unbatchedUpdates</h2><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">unbatchedUpdates</span>(<span class=\"params\">fn, a</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// è¿™é‡Œæ˜¯å¯¹ä¸Šä¸‹æ–‡çš„å¤„ç†ï¼Œä¸å¿…çº ç»“</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> prevExecutionContext = executionContext;</span><br><span class=\"line\">  executionContext &amp;= ~BatchedContext;</span><br><span class=\"line\">  executionContext |= LegacyUnbatchedContext;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// é‡ç‚¹åœ¨è¿™é‡Œï¼Œç›´æ¥è°ƒç”¨äº†ä¼ å…¥çš„å›è°ƒå‡½æ•° fnï¼Œå¯¹åº”å½“å‰é“¾è·¯ä¸­çš„ updateContainer æ–¹æ³•</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> fn(a);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// finally é€»è¾‘é‡Œæ˜¯å¯¹å›è°ƒé˜Ÿåˆ—çš„å¤„ç†ï¼Œæ­¤å¤„ä¸ç”¨å¤ªå…³æ³¨</span></span><br><span class=\"line\">    executionContext = prevExecutionContext;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (executionContext === NoContext) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// Flush the immediate callbacks that were scheduled during this batch</span></span><br><span class=\"line\">      resetRenderTimer();</span><br><span class=\"line\">      flushSyncCallbackQueue();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"updateContainer\"><a href=\"#updateContainer\" class=\"headerlink\" title=\"updateContainer\"></a>updateContainer</h2><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">updateContainer</span>(<span class=\"params\">element, container, parentComponent, callback</span>) </span>&#123;</span><br><span class=\"line\">  ......</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// è¿™æ˜¯ä¸€ä¸ª event ç›¸å…³çš„å…¥å‚ï¼Œæ­¤å¤„ä¸å¿…å…³æ³¨</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> eventTime = requestEventTime();</span><br><span class=\"line\"></span><br><span class=\"line\">  ......</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå…³é”®çš„å…¥å‚ï¼Œlane è¡¨ç¤ºä¼˜å…ˆçº§</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> lane = requestUpdateLane(current);</span><br><span class=\"line\">  <span class=\"comment\">// ç»“åˆ laneï¼ˆä¼˜å…ˆçº§ï¼‰ä¿¡æ¯ï¼Œåˆ›å»º update å¯¹è±¡ï¼Œä¸€ä¸ª update å¯¹è±¡æ„å‘³ç€ä¸€ä¸ªæ›´æ–°</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> update = createUpdate(eventTime, lane); </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// update çš„ payload å¯¹åº”çš„æ˜¯ä¸€ä¸ª React å…ƒç´ </span></span><br><span class=\"line\">  update.payload = &#123;</span><br><span class=\"line\">    element: element</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// å¤„ç† callbackï¼Œè¿™ä¸ª callback å…¶å®å°±æ˜¯æˆ‘ä»¬è°ƒç”¨ ReactDOM.render æ—¶ä¼ å…¥çš„ callback</span></span><br><span class=\"line\">  callback = callback === <span class=\"literal\">undefined</span> ? <span class=\"literal\">null</span> : callback;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (callback !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> callback !== <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">        error(<span class=\"string\">'render(...): Expected the last optional `callback` argument to be a '</span> + <span class=\"string\">'function. Instead received: %s.'</span>, callback);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    update.callback = callback;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// å°† update å…¥é˜Ÿ</span></span><br><span class=\"line\">  enqueueUpdate(current, update);</span><br><span class=\"line\">  <span class=\"comment\">// è°ƒåº¦ fiberRoot </span></span><br><span class=\"line\">  scheduleUpdateOnFiber(current, lane, eventTime);</span><br><span class=\"line\">  <span class=\"comment\">// è¿”å›å½“å‰èŠ‚ç‚¹ï¼ˆfiberRootï¼‰çš„ä¼˜å…ˆçº§</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> lane;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>updateContainer çš„é€»è¾‘ç›¸å¯¹æ¥è¯´ä¸°å¯Œäº†ç‚¹ï¼Œä½†å¤§éƒ¨åˆ†é€»è¾‘ä¹Ÿæ˜¯åœ¨å¹²æ‚æ´»ï¼Œå®ƒåšçš„æœ€å…³é”®çš„äº‹æƒ…å¯ä»¥æ€»ç»“ä¸ºä¸‰ä»¶ï¼š</p>\n<ul>\n<li><p>è¯·æ±‚å½“å‰ Fiber èŠ‚ç‚¹çš„ laneï¼ˆä¼˜å…ˆçº§ï¼‰ï¼›</p>\n</li>\n<li><p>ç»“åˆ laneï¼ˆä¼˜å…ˆçº§ï¼‰ï¼Œåˆ›å»ºå½“å‰ Fiber èŠ‚ç‚¹çš„ update å¯¹è±¡ï¼Œå¹¶å°†å…¶å…¥é˜Ÿï¼›</p>\n</li>\n<li><p>è°ƒåº¦å½“å‰èŠ‚ç‚¹ï¼ˆrootFiberï¼‰ã€‚</p>\n</li>\n</ul>\n<p>çœ‹åˆ°è¿™é‡Œçš„ä¼™ä¼´ï¼Œè°¢è°¢ä½ çš„è€å¿ƒã€‚</p>\n<h1 id=\"æœ€å\"><a href=\"#æœ€å\" class=\"headerlink\" title=\"æœ€å\"></a>æœ€å</h1><p>å› ä¸ºæˆ‘ä¹Ÿæ˜¯åœ¨ä¸€è¾¹çœ‹ï¼Œä¸€è¾¹è®°å½•ï¼Œå¦‚æœæœ‰é—®é¢˜ï¼Œå¤§å®¶ä¸€å®šè¦åŠæ—¶æå‡ºæ¥ã€‚æˆ‘ä¹Ÿä¼šåŠæ—¶æ›´æ–°çš„ã€‚è¿™éƒ¨åˆ†æˆ‘åº”è¯¥ä¼šå±¡æ¬¡é˜…è¯»ã€‚æ¯•ç«Ÿå¤§ç¥å†™äº†å‡ å¹´ï¼Œæˆ‘ä¸å¯èƒ½å‡ å¤©å°±çœ‹æ˜ç™½çš„ã€‚</p>\n<h1 id=\"ç´¢å¼•\"><a href=\"#ç´¢å¼•\" class=\"headerlink\" title=\"ç´¢å¼•\"></a>ç´¢å¼•</h1><p><a href=\"https://zh-hans.reactjs.org/docs\" target=\"_blank\" rel=\"noopener\">https://zh-hans.reactjs.org/docs</a></p>\n"},{"title":"ã€é‡è¯†å‰ç«¯ã€‘Reactæºç é˜…è¯»ï¼ˆäºŒï¼‰2000å­—å‘Šè¯‰ä½ Fiberè®¾è®¡åŠ¨æœº","date":"2021-04-05T02:08:31.000Z","cover":"/image/cover/react.png","_content":"\n# å‰è¨€\n\nä¸Šä¸€ç¯‡æŒ–çš„å‘å‡ ä¹éƒ½æ˜¯`Fiber`æœ‰å…³çš„ï¼Œæœ¬æ¥æƒ³å…ˆå­¦ä¹ ä¸€ä¸‹`Hooks`ï¼Œå‘ç°ä¹Ÿå’Œ`FIber`å¯†åˆ‡ç›¸å…³äº†ï¼Œå†³å®šå…ˆæå®šä¸€ä¸‹`Fiber`ã€‚ä¸äº†è§£çš„å¯ä»¥æŸ¥çœ‹æˆ‘çš„ä¸»é¡µã€‚`Fiber`æ¶æ„`React`å†™äº†å‡ å¹´æ—¶é—´ï¼Œä¸€ç¯‡æ–‡ç« è‚¯å®šæ˜¯è®²ä¸å®Œçš„ï¼Œæˆ‘å†³å®šåˆ†ä¸ºå››ä¸ªé˜¶æ®µä»‹ç»ã€‚\n\n- åŠ¨æœºï¼ˆæˆ–è€…è¯´åˆè¡·\n- åˆå§‹åŒ–-Fiberæ ‘çš„å‡†å¤‡å·¥ä½œ\n- render-Fiberæ ‘çš„æ„å»º\n- commit-Fiberæ ‘æ˜ å°„åˆ°DOM\n\nçœ‹äº†ç½‘ä¸Šçš„æ–‡ç« å¤§éƒ½æµ…å°è¾„æ­¢ï¼Œå°±å†™äº†ä¸€äº›ç®€å•çš„ä»‹ç»ï¼Œæˆ‘ä¹Ÿç…§çŒ«ç”»è™ç„¶åå»é¢è¯•ï¼Œè¢«æ‰“å›äº†ã€‚æ¯”å¦‚å‡ ä¸ªé—®é¢˜ï¼Œå¦‚æœä½ èƒ½ç­”çš„ä¸é”™è¯´æ˜ä½ çš„`Fiber`çŸ¥è¯†è¿˜ä¸é”™ã€‚\n\n1. éƒ½è¯´`Fiber`æ˜¯æœ‰ä¼˜å…ˆçº§ï¼Œæœ‰æ‰“æ–­ä»»åŠ¡çš„æœºåˆ¶ï¼Œä½†æ˜¯`JavaScript`ä»–æ˜¯å•çº¿ç¨‹çš„ï¼Œåœ¨è®¡ç®—çš„æ—¶å€™å¦‚ä½•æ‰“æ–­å‘¢ï¼Ÿ\n2. æ•°æ®ç»“æ„ä¸ºä»€ä¹ˆé€‰æ‹©äº†é“¾è¡¨ä½œä¸ºæ•°æ®ç»“æ„ï¼Ÿåˆ«çš„ä¸å¯ä»¥å—ï¼Ÿæ¯”å¦‚ï¼Œæ•°ç»„ï¼Ÿ\n3. ä¸ºä»€ä¹ˆæœ‰çš„æ—¶å€™`render`ä¼šæ‰§è¡Œå¤šæ¬¡ï¼Ÿ\n4. `Fiber`æ¶æ„ä¸€å®šæ˜¯å¼‚æ­¥çš„å—ï¼Ÿ\n5. `Fiber`æ ‘å’Œè™šæ‹ŸDOMæ ‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\n\n\n\nè¿™äº›éƒ½æ˜¯æˆ‘é¢è¯•é‡åˆ°çš„é—®é¢˜...å¤ªæ·±äº†ï¼Œç½‘ä¸Šçš„æ–‡ç« å‡ ä¹æ²¡æœ‰æåˆ°ï¼Œæ‰€ä»¥æˆ‘å†³å®šè‡ªå·±æ¥å­¦ä¹ ä¸€ä¸‹ï¼Œç„¶ååˆ†äº«å¹¶è®°å½•æˆ‘çš„å­¦ä¹ è¿‡ç¨‹ã€‚å¦‚æœæœ‰é”™è¯¯çš„åœ°æ–¹ï¼Œè¿˜è¯·ä¸€èµ·è®¨è®ºã€‚æœ‰ä»»ä½•é—®é¢˜éƒ½å¯ä»¥æ·»åŠ æˆ‘çš„vï¼šã€ŒDerrickTelã€    å’Œæˆ‘è®¨è®ºã€‚\n\néº»çƒ¦å†™ä¸€ä¸‹å¤‡æ³¨ï¼Œè°¢è°¢ã€‚\n\n# å‰ç½®å°çŸ¥è¯†\n\n## è¿›ç¨‹å’Œçº¿ç¨‹\n\nå¤šçº¿ç¨‹å¯ä»¥å¹¶è¡Œå¤„ç†ä»»åŠ¡ï¼Œä½†æ˜¯çº¿ç¨‹æ˜¯ä¸èƒ½å•ç‹¬å­˜åœ¨çš„ï¼Œå®ƒæ˜¯ç”±è¿›ç¨‹æ¥å¯åŠ¨å’Œç®¡ç†çš„ã€‚é‚£ä»€ä¹ˆåˆæ˜¯è¿›ç¨‹å‘¢ï¼Ÿ\n\nä¸€ä¸ªè¿›ç¨‹å°±æ˜¯ä¸€ä¸ªç¨‹åºçš„è¿è¡Œå®ä¾‹ã€‚è¯¦ç»†è§£é‡Šå°±æ˜¯ï¼Œå¯åŠ¨ä¸€ä¸ªç¨‹åºçš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿä¼šä¸ºè¯¥ç¨‹åºåˆ›å»ºä¸€å—å†…å­˜ï¼Œç”¨æ¥å­˜æ”¾ä»£ç ã€è¿è¡Œä¸­çš„æ•°æ®å’Œä¸€ä¸ªæ‰§è¡Œä»»åŠ¡çš„ä¸»çº¿ç¨‹ï¼Œæˆ‘ä»¬æŠŠè¿™æ ·çš„ä¸€ä¸ªè¿è¡Œç¯å¢ƒå«è¿›ç¨‹ã€‚\n\nå› ä¸ºä¸æ˜¯æ ¸å¿ƒï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œç»™ä¸€ä¸ªç®€å•çš„ä¾‹å­å¸®åŠ©ç†è§£ï¼š\n\nè¿›ç¨‹æ˜¯ç«è½¦å¤´ï¼Œçº¿ç¨‹æ˜¯ç«è½¦çš„è½¦å¢ã€‚æ²¡æœ‰ç«è½¦å¤´ï¼Œè½¦å¢æ— æ³•è‡ªå·±è¿è¡Œã€‚ä¸€ä¸ªç«è½¦å¤´å¯ä»¥æ‹‰å¤šä¸ªè½¦å¢ã€‚\n\n## å•çº¿ç¨‹çš„JavaScriptå’Œå¤šçº¿ç¨‹çš„æµè§ˆå™¨\n\nå¤§å®¶ç¬¬ä¸€æ¬¡æ¥è§¦åˆ°JavaScriptå¬åˆ°æœ€å¤šçš„ææ€•å°±æ˜¯JavaScript æ˜¯å•çº¿ç¨‹çš„ï¼Œæ›´æœ‰ç”šè€…ä¼šçŸ¥é“ä¸ºä»€ä¹ˆJavaScriptè¦æ˜¯å•çº¿ç¨‹çš„ã€‚\n\n> è¯•æƒ³å¦‚æœæ¸²æŸ“çº¿ç¨‹å’Œ JavaScript çº¿ç¨‹åŒæ—¶åœ¨å·¥ä½œï¼Œé‚£ä¹ˆæ¸²æŸ“ç»“æœå¿…ç„¶æ˜¯éš¾ä»¥é¢„æµ‹çš„ï¼šæ¯”å¦‚æ¸²æŸ“çº¿ç¨‹åˆšç»˜åˆ¶å¥½çš„ç”»é¢ï¼Œå¯èƒ½è½¬å¤´å°±ä¼šè¢«ä¸€æ®µ JavaScript ç»™æ”¹å¾—é¢ç›®å…¨éã€‚è¿™å°±å†³å®šäº†JavaScript çº¿ç¨‹å’Œæ¸²æŸ“çº¿ç¨‹å¿…é¡»æ˜¯äº’æ–¥çš„ï¼šè¿™ä¸¤ä¸ªçº¿ç¨‹ä¸èƒ½å¤Ÿç©¿æ’æ‰§è¡Œï¼Œå¿…é¡»ä¸²è¡Œã€‚å½“å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹åªèƒ½æŒ‚èµ·ç­‰å¾…ã€‚\n\næ‰€ä»¥JavaScriptæ˜¯å•çº¿ç¨‹çš„ã€‚é‚£ä¸ºä»€ä¹ˆæµè§ˆå™¨åˆæ˜¯å¤šçº¿ç¨‹çš„ï¼Ÿå› ä¸ºåœ¨æ—©æœŸçš„å•çº¿ç¨‹æµè§ˆå™¨ä¼šç¢°åˆ°å‡ ä¸ªé—®é¢˜ï¼š\n\n1. ä¸ç¨³å®š\n   1. æ¯”å¦‚ä¸€ä¸ªWebè§†é¢‘æˆ–Webæ¸¸æˆï¼Œè¿™äº›å¯èƒ½éƒ½éœ€è¦å¼ºå¤§çš„æ’ä»¶æ¥å¸®åŠ©è§£å†³é—®é¢˜ã€‚ä½†æ˜¯æ’ä»¶æœ€å®¹æ˜“å‡ºç°BUGï¼Œä¸€ä¸ªBUGå´©æºƒäº†ï¼Œé‚£å°±ä¼šå¯¼è‡´æ•´ä¸ªæµè§ˆå™¨çš„å´©æºƒ\n2. ä¸æµç•…\n   1. å°±ä¸€ä¸ªçº¿ç¨‹ï¼Œå¦‚æœè¢«ä¸€ä¸ªä»»åŠ¡å æ®äº†å¤§é‡çš„äº‹æƒ…ï¼Œç”šè‡³æ˜¯æ­»å¾ªç¯ï¼Œä¹Ÿä¼šè®©æµè§ˆå™¨å¤„äºåœæ»çŠ¶æ€\n3. ä¸å®‰å…¨\n   1. å¦‚æœå•çº¿ç¨‹çš„æ’çº¿åœ¨è¿è¡Œæ—¶ï¼Œæ˜¯ä¸€ä¸ªç—…æ¯’æˆ–è€…æ¶æ„ç¨‹åºï¼Œä½ çš„ç”µè„‘å°†é¢ä¸´å·¨å¤§çš„é£é™©\n\næ‰€ä»¥æµè§ˆå™¨å°±éœ€è¦å¤šçº¿ç¨‹æ¥å¤„ç†è¿™äº›é—ç•™é—®é¢˜ï¼Œå¹¶ä¸”å¯ä»¥ä¿è¯é€Ÿåº¦çš„åŒæ—¶ä¿è¯å®‰å…¨ã€‚æ¯”å¦‚ç½‘ç»œçº¿ç¨‹ï¼Œå¯ä»¥æŠŠæ•°æ®éƒ½å¼„æ¸…æ¥šäº†ï¼Œç­‰å¾…JavaScriptæ¥æå–ï¼Œå°±å¥½åƒæ´—è¡£æœï¼Œæˆ‘æ”¾æ´—è¡£åº—æ´—ï¼Œæˆ‘åƒå®Œé¥­æ¥æ‹¿å°±å¥½äº†ã€‚ä¸éœ€è¦æˆ‘è‡ªå·±æ‰‹åŠ¨çš„å»æ´—ã€‚ä½†æ˜¯ä¹Ÿä¼šå¸¦æ¥å‡ ä¸ªé—®é¢˜\n\n1. æ›´å¤šçš„ç³»ç»Ÿèµ„æºå ç”¨ã€‚\n2. æ›´å¤æ‚çš„æµè§ˆå™¨æ¶æ„ã€‚ï¼ˆä¸æ˜¯æœ¬æ–‡é‡ç‚¹\n\n> å•çº¿ç¨‹çš„JavaScriptæœ‰è‡ªå·±çš„è¿è¡Œæœºåˆ¶ã€Œäº‹ä»¶å¾ªç¯ã€ã€‚å¯ä»¥åœ¨æˆ‘çš„ä¸»ä¸šæŸ¥çœ‹æ–‡ç« è¿›è¡Œé˜…è¯»ã€‚\n\n\n\n# Reactçš„å¡é¡¿\n\nåœ¨`React15`åŠä¹‹å‰çš„ç‰ˆæœ¬ã€‚éƒ½æ˜¯è¿›è¡Œä¸¤é¢—æ ‘çš„æ¯”è¾ƒï¼Œç„¶åæ‰¾åˆ°éœ€è¦æ›´æ–°çš„åœ°æ–¹ï¼Œæœ€åæ›´æ–°åˆ°çœŸå®çš„DOMæ ‘ä¸Šã€‚è€Œè¿™ä¸ªç®—æ³•æ˜¯åœ¨æ•°æ®ç»“æ„ä¸­çš„ä¸¤æ£µæ ‘çš„æ¯”è¾ƒä¸­ä¼˜åŒ–è€Œæ¥ã€‚ä¹Ÿä»åŸæœ¬ O(n3) çš„ Diff æ—¶é—´å¤æ‚åº¦ä¼˜åŒ–åˆ°äº†å‰æ— å¤äººçš„ O(n)ã€‚æˆ‘ä»¬ç§°ä¹‹ä¸ºã€Œ Stack Reconciler ã€ã€‚åœ¨å¾ˆé•¿çš„ä¸€æ®µæ—¶é—´é£å…‰æ— é™ã€‚\n\nä½†æ˜¯ï¼Œéšç€æ—¶é—´çš„æ¨ç§»å’Œä¸šåŠ¡å¤æ‚åº¦çš„æå‡ï¼ŒReact æ›¾ç»è¢«äººä»¬æ´¥æ´¥ä¹é“çš„ Stack Reconciler ä¹Ÿæ¸æ¸åœ¨ä½“éªŒæ–¹é¢æ˜¾å‡ºç–²æ€ã€‚\n\nä¸ºä»€ä¹ˆä¼šå‡ºç°ä¹åŠ›çš„æ„Ÿè§‰ï¼Ÿ\n\nå› ä¸ºä»æœ¬è´¨ä¸Šæ¥è¯´ï¼Œæ ˆè°ƒå’Œæœºåˆ¶ä¸‹çš„ Diff ç®—æ³•ï¼Œå…¶å®æ˜¯æ ‘çš„æ·±åº¦ä¼˜å…ˆéå†çš„è¿‡ç¨‹ã€‚è€Œæ ‘çš„æ·±åº¦ä¼˜å…ˆéå†ï¼Œæ€»æ˜¯å’Œé€’å½’è„±ä¸äº†å…³ç³»ã€‚\n\né€’å½’å°±æ˜¯é™¤éç¢°åˆ°äº†ä»–çš„è¿”å›æ¡ä»¶ï¼Œå¦åˆ™ï¼Œå°†æ— çº¿çš„å¾ªç¯ä¸‹å»ã€‚è¿™ä¸ªé—®é¢˜æœ€è‡´å‘½çš„å°±æ˜¯ï¼Œæ— æ³•åœæ­¢ã€‚åŠ å…¥è¶³å¤Ÿå¤§ï¼Œå°†ä¼šå‡ºç°ã€Œé¡µé¢å¡æ­»ã€ã€‚\n\n# FIberçš„å‡ºç°\n\né¦–å…ˆFiberçš„ç¿»è¯‘æ˜¯ï¼šã€Œçº¤ç»´ã€ã€‚\n\nç»´åŸºç™¾ç§‘ï¼šã€Œ**çº¤ç»´**ï¼ˆè‹±è¯­ï¼šfiberï¼‰æ˜¯æŒ‡ç”±è¿ç»­æˆ–ä¸è¿ç»­çš„ç»†ä¸ç»„æˆçš„ç‰©è´¨ã€‚ã€\n\nç®€å•æ¥è¯´å°±æ˜¯éå¸¸çš„ç»†çš„ä¸œè¥¿ï¼Œä¹Ÿå°±æ˜¯å¯¹æ•´ä¸ªæ¸²æŸ“è¿‡ç¨‹è¿›è¡Œçº¤ç»´çº§åˆ«çš„æ§åˆ¶ã€‚\n\n## Fiberå¦‚ä½•è§£å†³é—®é¢˜\n\nFiberæ˜¯å¯¹æ•´ä¸ªReactçš„è°ƒåº¦ç®—æ³•çš„é‡å†™ï¼Œåˆæ˜¯ä¸€ä¸ªReactè‡ªåˆ›çš„æ•°æ®ç»“æ„ï¼Œé‡Œé¢ä¿å­˜äº†ä¸€ä¸ªè™šæ‹ŸDOMçš„èŠ‚ç‚¹ï¼Œä¹Ÿä¿å­˜äº†éœ€è¦æ›´æ–°çš„çŠ¶æ€ï¼Œä»¥åŠå‰¯ä½œç”¨ã€‚\n\næˆ‘ä»¬çŸ¥é“ï¼Œç”¨æˆ·åœ¨ä½¿ç”¨çš„æ—¶å€™æœ€æ€•çš„æ˜¯ä»€ä¹ˆï¼Ÿæ²¡ååº”ï¼Œä¹Ÿå°±æ˜¯ã€Œé¡µé¢å¡æ­»ã€ã€‚è€Œæˆ‘ä»¬ç©æ¸¸æˆè§‰å¾—å¡æ˜¯å› ä¸ºä»–ä¸€ç§’é’Ÿçš„å¸§æ•°å°‘äº60å¸§ï¼Œæ‰€ä»¥æˆ‘ä»¬è§‰å¾—å¡ï¼Œè€Œæµè§ˆå™¨çš„é¡µé¢ä¹Ÿä¸€æ ·ã€‚Reactåªéœ€è¦ä¸€ç§’é’Ÿèƒ½å¤Ÿä¿è¯60å¸§çš„æµç•…å‡ºç°å°±å¯ä»¥äº†ï¼Œç”¨æˆ·å°±ä¸è§‰å¾—ã€Œé¡µé¢å¡æ­»ã€äº†ã€‚\n\næ‰€ä»¥Fiberçš„ä»»åŠ¡è‚¯å®šæ˜¯ï¼Œåœ¨ä¿è¯è‡³å°‘60å¸§æ¯ç§’çš„æƒ…å†µä¸‹ï¼Œæ‰å»åšåˆ«çš„äº‹æƒ…ã€‚\n\n## Fiberæ¶æ„æ ¸å¿ƒï¼šâ€œå¯ä¸­æ–­â€â€œå¯æ¢å¤â€â€œä¼˜å…ˆçº§â€\n\nFiberæ‰€åšçš„è¿™ä¸€ç³»åˆ—æ“ä½œéƒ½æ˜¯ä¸ºäº†ç”¨æˆ·çš„ä¸æ»‘ä½“éªŒã€‚\n\næƒ³è±¡ä¸€ä¸‹ï¼Œæ‰“æ–­ç°åœ¨éå¸¸å†—é•¿çš„è®¡ç®—ï¼Œé€šè¿‡ä¼˜å…ˆçº§çš„åˆ¤æ–­ï¼Œä¼˜å…ˆæ¸²æŸ“é¡µé¢æˆ–è€…åˆ«çš„ä»€ä¹ˆã€‚ç„¶åå†æ¢å¤å†—é•¿çš„è®¡ç®—ã€‚æ˜¯ä¸æ˜¯è„‘ä¸­åŸºæœ¬æœ‰ä¸€ä¸ªæ¨¡ç³Šçš„æ¦‚å¿µäº†ï¼Ÿ\n\nåœ¨è¿›ä¸€æ­¥ï¼ŒReactå…¶å®ä¸ºå¾ˆå¤šä»»åŠ¡è¿›è¡Œäº†åˆ‡ç‰‡ï¼Œè¿™äº›æ¯ä¸€ä¸ªç»†å°çš„ç‰‡ï¼Œæˆ‘ä»¬å¯ä»¥æˆä¸ºã€ŒFiberã€ã€‚åœ¨æ‰§è¡Œå®Œä¸€ä¸ªã€ŒFiberã€çš„æ—¶å€™ï¼Œä¼šæ£€æŸ¥é˜Ÿåˆ—ä¸­æœ€é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ã€‚å¦‚æœæœ‰æ¯”ç›®å‰çš„è¿™ä¸ªä¼˜å…ˆçº§é«˜çš„ï¼Œå…ˆæŠŠæ•°æ®å’ŒçŠ¶æ€ä¿å­˜åœ¨ã€ŒFiberã€èŠ‚ç‚¹ä¸Šï¼Œç„¶åè¿›è¡Œé‚£ä¸ªã€Œæ›´é«˜ä¼˜å…ˆçº§ä»»åŠ¡ã€ã€‚ä¹‹åå†æ£€æŸ¥ï¼Œå¦‚æœæ²¡æœ‰å°±æ¢å¤ä»»åŠ¡ã€‚\n\nåœ¨ render é˜¶æ®µï¼Œä¸€ä¸ªåºå¤§çš„æ›´æ–°ä»»åŠ¡è¢«åˆ†è§£ä¸ºäº†ä¸€ä¸ªä¸ªçš„å·¥ä½œå•å…ƒï¼Œè¿™äº›å·¥ä½œå•å…ƒæœ‰ç€ä¸åŒçš„ä¼˜å…ˆçº§ï¼ŒReact å¯ä»¥æ ¹æ®ä¼˜å…ˆçº§çš„é«˜ä½å»å®ç°å·¥ä½œå•å…ƒçš„æ‰“æ–­å’Œæ¢å¤ã€‚ç”±äº render é˜¶æ®µçš„æ“ä½œå¯¹ç”¨æˆ·æ¥è¯´å…¶å®æ˜¯â€œä¸å¯è§â€çš„ï¼Œæ‰€ä»¥å°±ç®—æ‰“æ–­å†é‡å¯ï¼Œå¯¹ç”¨æˆ·æ¥è¯´ä¹Ÿæ˜¯ 0 æ„ŸçŸ¥ã€‚ä½†æ˜¯ï¼Œå·¥ä½œå•å…ƒï¼ˆä¹Ÿå°±æ˜¯ä»»åŠ¡ï¼‰çš„é‡å¯å°†ä¼šä¼´éšç€å¯¹éƒ¨åˆ†ç”Ÿå‘½å‘¨æœŸçš„é‡å¤æ‰§è¡Œï¼Œè¿™äº›ç”Ÿå‘½å‘¨æœŸæ˜¯ï¼š\n\n- componentWillMount\n\n- componentWillUpdate\n\n- shouldComponentUpdate\n\n- componentWillReceiveProps\n\nå…¶ä¸­ shouldComponentUpdate çš„ä½œç”¨æ˜¯é€šè¿‡è¿”å› true æˆ–è€… falseï¼Œæ¥å¸®åŠ©æˆ‘ä»¬åˆ¤æ–­æ›´æ–°çš„å¿…è¦æ€§ï¼Œä¸€èˆ¬åœ¨è¿™ä¸ªå‡½æ•°ä¸­ä¸ä¼šè¿›è¡Œå‰¯ä½œç”¨æ“ä½œï¼Œå› æ­¤é£é™©ä¸å¤§ã€‚\n\nè€Œ â€œcomponentWillâ€ å¼€å¤´çš„ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œåˆ™å¸¸å¹´è¢«å¼€å‘è€…ä»¥å„ç§å„æ ·çš„å§¿åŠ¿æ»¥ç”¨ï¼Œæ˜¯å‰¯ä½œç”¨çš„â€œé‡ç¾åŒºâ€ã€‚\n\n\n\n# æ€è€ƒ\n\nä¹‹å‰çš„é—®é¢˜ï¼Œç°åœ¨æ˜¯å¦æœ‰çš„å·²ç»æœ‰ç­”æ¡ˆäº†ï¼Ÿæœ‰çš„è¿˜æ²¡æœ‰ï¼Ÿæ¬¢è¿è®¨è®º\n\n1. éƒ½è¯´`Fiber`æ˜¯æœ‰ä¼˜å…ˆçº§ï¼Œæœ‰æ‰“æ–­ä»»åŠ¡çš„æœºåˆ¶ï¼Œä½†æ˜¯`JavaScript`ä»–æ˜¯å•çº¿ç¨‹çš„ï¼Œåœ¨è®¡ç®—çš„æ—¶å€™å¦‚ä½•æ‰“æ–­å‘¢ï¼Ÿ\n2. æ•°æ®ç»“æ„ä¸ºä»€ä¹ˆé€‰æ‹©äº†é“¾è¡¨ä½œä¸ºæ•°æ®ç»“æ„ï¼Ÿåˆ«çš„ä¸å¯ä»¥å—ï¼Ÿæ¯”å¦‚ï¼Œæ•°ç»„ï¼Ÿ\n3. ä¸ºä»€ä¹ˆæœ‰çš„æ—¶å€™`render`ä¼šæ‰§è¡Œå¤šæ¬¡ï¼Ÿ\n4. `Fiber`æ¶æ„ä¸€å®šæ˜¯å¼‚æ­¥çš„å—ï¼Ÿ\n5. `Fiber`æ ‘å’Œè™šæ‹ŸDOMæ ‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\n\n# ç´¢å¼•\n\nhttps://zh-hans.reactjs.org/docs\n\n\n\n\n\n\n\n\n\n","source":"_posts/ã€é‡è¯†å‰ç«¯ã€‘Reactæºç é˜…è¯»ï¼ˆäºŒï¼‰2000å­—å‘Šè¯‰ä½ Fiberè®¾è®¡åŠ¨æœº.md","raw":"---\ntitle: ã€é‡è¯†å‰ç«¯ã€‘Reactæºç é˜…è¯»ï¼ˆäºŒï¼‰2000å­—å‘Šè¯‰ä½ Fiberè®¾è®¡åŠ¨æœº\ndate: 2021-04-05 10:08:31\ntags: [react]\ncategory: [é‡æ‹¾å‰ç«¯]\ncover: /image/cover/react.png\n---\n\n# å‰è¨€\n\nä¸Šä¸€ç¯‡æŒ–çš„å‘å‡ ä¹éƒ½æ˜¯`Fiber`æœ‰å…³çš„ï¼Œæœ¬æ¥æƒ³å…ˆå­¦ä¹ ä¸€ä¸‹`Hooks`ï¼Œå‘ç°ä¹Ÿå’Œ`FIber`å¯†åˆ‡ç›¸å…³äº†ï¼Œå†³å®šå…ˆæå®šä¸€ä¸‹`Fiber`ã€‚ä¸äº†è§£çš„å¯ä»¥æŸ¥çœ‹æˆ‘çš„ä¸»é¡µã€‚`Fiber`æ¶æ„`React`å†™äº†å‡ å¹´æ—¶é—´ï¼Œä¸€ç¯‡æ–‡ç« è‚¯å®šæ˜¯è®²ä¸å®Œçš„ï¼Œæˆ‘å†³å®šåˆ†ä¸ºå››ä¸ªé˜¶æ®µä»‹ç»ã€‚\n\n- åŠ¨æœºï¼ˆæˆ–è€…è¯´åˆè¡·\n- åˆå§‹åŒ–-Fiberæ ‘çš„å‡†å¤‡å·¥ä½œ\n- render-Fiberæ ‘çš„æ„å»º\n- commit-Fiberæ ‘æ˜ å°„åˆ°DOM\n\nçœ‹äº†ç½‘ä¸Šçš„æ–‡ç« å¤§éƒ½æµ…å°è¾„æ­¢ï¼Œå°±å†™äº†ä¸€äº›ç®€å•çš„ä»‹ç»ï¼Œæˆ‘ä¹Ÿç…§çŒ«ç”»è™ç„¶åå»é¢è¯•ï¼Œè¢«æ‰“å›äº†ã€‚æ¯”å¦‚å‡ ä¸ªé—®é¢˜ï¼Œå¦‚æœä½ èƒ½ç­”çš„ä¸é”™è¯´æ˜ä½ çš„`Fiber`çŸ¥è¯†è¿˜ä¸é”™ã€‚\n\n1. éƒ½è¯´`Fiber`æ˜¯æœ‰ä¼˜å…ˆçº§ï¼Œæœ‰æ‰“æ–­ä»»åŠ¡çš„æœºåˆ¶ï¼Œä½†æ˜¯`JavaScript`ä»–æ˜¯å•çº¿ç¨‹çš„ï¼Œåœ¨è®¡ç®—çš„æ—¶å€™å¦‚ä½•æ‰“æ–­å‘¢ï¼Ÿ\n2. æ•°æ®ç»“æ„ä¸ºä»€ä¹ˆé€‰æ‹©äº†é“¾è¡¨ä½œä¸ºæ•°æ®ç»“æ„ï¼Ÿåˆ«çš„ä¸å¯ä»¥å—ï¼Ÿæ¯”å¦‚ï¼Œæ•°ç»„ï¼Ÿ\n3. ä¸ºä»€ä¹ˆæœ‰çš„æ—¶å€™`render`ä¼šæ‰§è¡Œå¤šæ¬¡ï¼Ÿ\n4. `Fiber`æ¶æ„ä¸€å®šæ˜¯å¼‚æ­¥çš„å—ï¼Ÿ\n5. `Fiber`æ ‘å’Œè™šæ‹ŸDOMæ ‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\n\n\n\nè¿™äº›éƒ½æ˜¯æˆ‘é¢è¯•é‡åˆ°çš„é—®é¢˜...å¤ªæ·±äº†ï¼Œç½‘ä¸Šçš„æ–‡ç« å‡ ä¹æ²¡æœ‰æåˆ°ï¼Œæ‰€ä»¥æˆ‘å†³å®šè‡ªå·±æ¥å­¦ä¹ ä¸€ä¸‹ï¼Œç„¶ååˆ†äº«å¹¶è®°å½•æˆ‘çš„å­¦ä¹ è¿‡ç¨‹ã€‚å¦‚æœæœ‰é”™è¯¯çš„åœ°æ–¹ï¼Œè¿˜è¯·ä¸€èµ·è®¨è®ºã€‚æœ‰ä»»ä½•é—®é¢˜éƒ½å¯ä»¥æ·»åŠ æˆ‘çš„vï¼šã€ŒDerrickTelã€    å’Œæˆ‘è®¨è®ºã€‚\n\néº»çƒ¦å†™ä¸€ä¸‹å¤‡æ³¨ï¼Œè°¢è°¢ã€‚\n\n# å‰ç½®å°çŸ¥è¯†\n\n## è¿›ç¨‹å’Œçº¿ç¨‹\n\nå¤šçº¿ç¨‹å¯ä»¥å¹¶è¡Œå¤„ç†ä»»åŠ¡ï¼Œä½†æ˜¯çº¿ç¨‹æ˜¯ä¸èƒ½å•ç‹¬å­˜åœ¨çš„ï¼Œå®ƒæ˜¯ç”±è¿›ç¨‹æ¥å¯åŠ¨å’Œç®¡ç†çš„ã€‚é‚£ä»€ä¹ˆåˆæ˜¯è¿›ç¨‹å‘¢ï¼Ÿ\n\nä¸€ä¸ªè¿›ç¨‹å°±æ˜¯ä¸€ä¸ªç¨‹åºçš„è¿è¡Œå®ä¾‹ã€‚è¯¦ç»†è§£é‡Šå°±æ˜¯ï¼Œå¯åŠ¨ä¸€ä¸ªç¨‹åºçš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿä¼šä¸ºè¯¥ç¨‹åºåˆ›å»ºä¸€å—å†…å­˜ï¼Œç”¨æ¥å­˜æ”¾ä»£ç ã€è¿è¡Œä¸­çš„æ•°æ®å’Œä¸€ä¸ªæ‰§è¡Œä»»åŠ¡çš„ä¸»çº¿ç¨‹ï¼Œæˆ‘ä»¬æŠŠè¿™æ ·çš„ä¸€ä¸ªè¿è¡Œç¯å¢ƒå«è¿›ç¨‹ã€‚\n\nå› ä¸ºä¸æ˜¯æ ¸å¿ƒï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œç»™ä¸€ä¸ªç®€å•çš„ä¾‹å­å¸®åŠ©ç†è§£ï¼š\n\nè¿›ç¨‹æ˜¯ç«è½¦å¤´ï¼Œçº¿ç¨‹æ˜¯ç«è½¦çš„è½¦å¢ã€‚æ²¡æœ‰ç«è½¦å¤´ï¼Œè½¦å¢æ— æ³•è‡ªå·±è¿è¡Œã€‚ä¸€ä¸ªç«è½¦å¤´å¯ä»¥æ‹‰å¤šä¸ªè½¦å¢ã€‚\n\n## å•çº¿ç¨‹çš„JavaScriptå’Œå¤šçº¿ç¨‹çš„æµè§ˆå™¨\n\nå¤§å®¶ç¬¬ä¸€æ¬¡æ¥è§¦åˆ°JavaScriptå¬åˆ°æœ€å¤šçš„ææ€•å°±æ˜¯JavaScript æ˜¯å•çº¿ç¨‹çš„ï¼Œæ›´æœ‰ç”šè€…ä¼šçŸ¥é“ä¸ºä»€ä¹ˆJavaScriptè¦æ˜¯å•çº¿ç¨‹çš„ã€‚\n\n> è¯•æƒ³å¦‚æœæ¸²æŸ“çº¿ç¨‹å’Œ JavaScript çº¿ç¨‹åŒæ—¶åœ¨å·¥ä½œï¼Œé‚£ä¹ˆæ¸²æŸ“ç»“æœå¿…ç„¶æ˜¯éš¾ä»¥é¢„æµ‹çš„ï¼šæ¯”å¦‚æ¸²æŸ“çº¿ç¨‹åˆšç»˜åˆ¶å¥½çš„ç”»é¢ï¼Œå¯èƒ½è½¬å¤´å°±ä¼šè¢«ä¸€æ®µ JavaScript ç»™æ”¹å¾—é¢ç›®å…¨éã€‚è¿™å°±å†³å®šäº†JavaScript çº¿ç¨‹å’Œæ¸²æŸ“çº¿ç¨‹å¿…é¡»æ˜¯äº’æ–¥çš„ï¼šè¿™ä¸¤ä¸ªçº¿ç¨‹ä¸èƒ½å¤Ÿç©¿æ’æ‰§è¡Œï¼Œå¿…é¡»ä¸²è¡Œã€‚å½“å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹åªèƒ½æŒ‚èµ·ç­‰å¾…ã€‚\n\næ‰€ä»¥JavaScriptæ˜¯å•çº¿ç¨‹çš„ã€‚é‚£ä¸ºä»€ä¹ˆæµè§ˆå™¨åˆæ˜¯å¤šçº¿ç¨‹çš„ï¼Ÿå› ä¸ºåœ¨æ—©æœŸçš„å•çº¿ç¨‹æµè§ˆå™¨ä¼šç¢°åˆ°å‡ ä¸ªé—®é¢˜ï¼š\n\n1. ä¸ç¨³å®š\n   1. æ¯”å¦‚ä¸€ä¸ªWebè§†é¢‘æˆ–Webæ¸¸æˆï¼Œè¿™äº›å¯èƒ½éƒ½éœ€è¦å¼ºå¤§çš„æ’ä»¶æ¥å¸®åŠ©è§£å†³é—®é¢˜ã€‚ä½†æ˜¯æ’ä»¶æœ€å®¹æ˜“å‡ºç°BUGï¼Œä¸€ä¸ªBUGå´©æºƒäº†ï¼Œé‚£å°±ä¼šå¯¼è‡´æ•´ä¸ªæµè§ˆå™¨çš„å´©æºƒ\n2. ä¸æµç•…\n   1. å°±ä¸€ä¸ªçº¿ç¨‹ï¼Œå¦‚æœè¢«ä¸€ä¸ªä»»åŠ¡å æ®äº†å¤§é‡çš„äº‹æƒ…ï¼Œç”šè‡³æ˜¯æ­»å¾ªç¯ï¼Œä¹Ÿä¼šè®©æµè§ˆå™¨å¤„äºåœæ»çŠ¶æ€\n3. ä¸å®‰å…¨\n   1. å¦‚æœå•çº¿ç¨‹çš„æ’çº¿åœ¨è¿è¡Œæ—¶ï¼Œæ˜¯ä¸€ä¸ªç—…æ¯’æˆ–è€…æ¶æ„ç¨‹åºï¼Œä½ çš„ç”µè„‘å°†é¢ä¸´å·¨å¤§çš„é£é™©\n\næ‰€ä»¥æµè§ˆå™¨å°±éœ€è¦å¤šçº¿ç¨‹æ¥å¤„ç†è¿™äº›é—ç•™é—®é¢˜ï¼Œå¹¶ä¸”å¯ä»¥ä¿è¯é€Ÿåº¦çš„åŒæ—¶ä¿è¯å®‰å…¨ã€‚æ¯”å¦‚ç½‘ç»œçº¿ç¨‹ï¼Œå¯ä»¥æŠŠæ•°æ®éƒ½å¼„æ¸…æ¥šäº†ï¼Œç­‰å¾…JavaScriptæ¥æå–ï¼Œå°±å¥½åƒæ´—è¡£æœï¼Œæˆ‘æ”¾æ´—è¡£åº—æ´—ï¼Œæˆ‘åƒå®Œé¥­æ¥æ‹¿å°±å¥½äº†ã€‚ä¸éœ€è¦æˆ‘è‡ªå·±æ‰‹åŠ¨çš„å»æ´—ã€‚ä½†æ˜¯ä¹Ÿä¼šå¸¦æ¥å‡ ä¸ªé—®é¢˜\n\n1. æ›´å¤šçš„ç³»ç»Ÿèµ„æºå ç”¨ã€‚\n2. æ›´å¤æ‚çš„æµè§ˆå™¨æ¶æ„ã€‚ï¼ˆä¸æ˜¯æœ¬æ–‡é‡ç‚¹\n\n> å•çº¿ç¨‹çš„JavaScriptæœ‰è‡ªå·±çš„è¿è¡Œæœºåˆ¶ã€Œäº‹ä»¶å¾ªç¯ã€ã€‚å¯ä»¥åœ¨æˆ‘çš„ä¸»ä¸šæŸ¥çœ‹æ–‡ç« è¿›è¡Œé˜…è¯»ã€‚\n\n\n\n# Reactçš„å¡é¡¿\n\nåœ¨`React15`åŠä¹‹å‰çš„ç‰ˆæœ¬ã€‚éƒ½æ˜¯è¿›è¡Œä¸¤é¢—æ ‘çš„æ¯”è¾ƒï¼Œç„¶åæ‰¾åˆ°éœ€è¦æ›´æ–°çš„åœ°æ–¹ï¼Œæœ€åæ›´æ–°åˆ°çœŸå®çš„DOMæ ‘ä¸Šã€‚è€Œè¿™ä¸ªç®—æ³•æ˜¯åœ¨æ•°æ®ç»“æ„ä¸­çš„ä¸¤æ£µæ ‘çš„æ¯”è¾ƒä¸­ä¼˜åŒ–è€Œæ¥ã€‚ä¹Ÿä»åŸæœ¬ O(n3) çš„ Diff æ—¶é—´å¤æ‚åº¦ä¼˜åŒ–åˆ°äº†å‰æ— å¤äººçš„ O(n)ã€‚æˆ‘ä»¬ç§°ä¹‹ä¸ºã€Œ Stack Reconciler ã€ã€‚åœ¨å¾ˆé•¿çš„ä¸€æ®µæ—¶é—´é£å…‰æ— é™ã€‚\n\nä½†æ˜¯ï¼Œéšç€æ—¶é—´çš„æ¨ç§»å’Œä¸šåŠ¡å¤æ‚åº¦çš„æå‡ï¼ŒReact æ›¾ç»è¢«äººä»¬æ´¥æ´¥ä¹é“çš„ Stack Reconciler ä¹Ÿæ¸æ¸åœ¨ä½“éªŒæ–¹é¢æ˜¾å‡ºç–²æ€ã€‚\n\nä¸ºä»€ä¹ˆä¼šå‡ºç°ä¹åŠ›çš„æ„Ÿè§‰ï¼Ÿ\n\nå› ä¸ºä»æœ¬è´¨ä¸Šæ¥è¯´ï¼Œæ ˆè°ƒå’Œæœºåˆ¶ä¸‹çš„ Diff ç®—æ³•ï¼Œå…¶å®æ˜¯æ ‘çš„æ·±åº¦ä¼˜å…ˆéå†çš„è¿‡ç¨‹ã€‚è€Œæ ‘çš„æ·±åº¦ä¼˜å…ˆéå†ï¼Œæ€»æ˜¯å’Œé€’å½’è„±ä¸äº†å…³ç³»ã€‚\n\né€’å½’å°±æ˜¯é™¤éç¢°åˆ°äº†ä»–çš„è¿”å›æ¡ä»¶ï¼Œå¦åˆ™ï¼Œå°†æ— çº¿çš„å¾ªç¯ä¸‹å»ã€‚è¿™ä¸ªé—®é¢˜æœ€è‡´å‘½çš„å°±æ˜¯ï¼Œæ— æ³•åœæ­¢ã€‚åŠ å…¥è¶³å¤Ÿå¤§ï¼Œå°†ä¼šå‡ºç°ã€Œé¡µé¢å¡æ­»ã€ã€‚\n\n# FIberçš„å‡ºç°\n\né¦–å…ˆFiberçš„ç¿»è¯‘æ˜¯ï¼šã€Œçº¤ç»´ã€ã€‚\n\nç»´åŸºç™¾ç§‘ï¼šã€Œ**çº¤ç»´**ï¼ˆè‹±è¯­ï¼šfiberï¼‰æ˜¯æŒ‡ç”±è¿ç»­æˆ–ä¸è¿ç»­çš„ç»†ä¸ç»„æˆçš„ç‰©è´¨ã€‚ã€\n\nç®€å•æ¥è¯´å°±æ˜¯éå¸¸çš„ç»†çš„ä¸œè¥¿ï¼Œä¹Ÿå°±æ˜¯å¯¹æ•´ä¸ªæ¸²æŸ“è¿‡ç¨‹è¿›è¡Œçº¤ç»´çº§åˆ«çš„æ§åˆ¶ã€‚\n\n## Fiberå¦‚ä½•è§£å†³é—®é¢˜\n\nFiberæ˜¯å¯¹æ•´ä¸ªReactçš„è°ƒåº¦ç®—æ³•çš„é‡å†™ï¼Œåˆæ˜¯ä¸€ä¸ªReactè‡ªåˆ›çš„æ•°æ®ç»“æ„ï¼Œé‡Œé¢ä¿å­˜äº†ä¸€ä¸ªè™šæ‹ŸDOMçš„èŠ‚ç‚¹ï¼Œä¹Ÿä¿å­˜äº†éœ€è¦æ›´æ–°çš„çŠ¶æ€ï¼Œä»¥åŠå‰¯ä½œç”¨ã€‚\n\næˆ‘ä»¬çŸ¥é“ï¼Œç”¨æˆ·åœ¨ä½¿ç”¨çš„æ—¶å€™æœ€æ€•çš„æ˜¯ä»€ä¹ˆï¼Ÿæ²¡ååº”ï¼Œä¹Ÿå°±æ˜¯ã€Œé¡µé¢å¡æ­»ã€ã€‚è€Œæˆ‘ä»¬ç©æ¸¸æˆè§‰å¾—å¡æ˜¯å› ä¸ºä»–ä¸€ç§’é’Ÿçš„å¸§æ•°å°‘äº60å¸§ï¼Œæ‰€ä»¥æˆ‘ä»¬è§‰å¾—å¡ï¼Œè€Œæµè§ˆå™¨çš„é¡µé¢ä¹Ÿä¸€æ ·ã€‚Reactåªéœ€è¦ä¸€ç§’é’Ÿèƒ½å¤Ÿä¿è¯60å¸§çš„æµç•…å‡ºç°å°±å¯ä»¥äº†ï¼Œç”¨æˆ·å°±ä¸è§‰å¾—ã€Œé¡µé¢å¡æ­»ã€äº†ã€‚\n\næ‰€ä»¥Fiberçš„ä»»åŠ¡è‚¯å®šæ˜¯ï¼Œåœ¨ä¿è¯è‡³å°‘60å¸§æ¯ç§’çš„æƒ…å†µä¸‹ï¼Œæ‰å»åšåˆ«çš„äº‹æƒ…ã€‚\n\n## Fiberæ¶æ„æ ¸å¿ƒï¼šâ€œå¯ä¸­æ–­â€â€œå¯æ¢å¤â€â€œä¼˜å…ˆçº§â€\n\nFiberæ‰€åšçš„è¿™ä¸€ç³»åˆ—æ“ä½œéƒ½æ˜¯ä¸ºäº†ç”¨æˆ·çš„ä¸æ»‘ä½“éªŒã€‚\n\næƒ³è±¡ä¸€ä¸‹ï¼Œæ‰“æ–­ç°åœ¨éå¸¸å†—é•¿çš„è®¡ç®—ï¼Œé€šè¿‡ä¼˜å…ˆçº§çš„åˆ¤æ–­ï¼Œä¼˜å…ˆæ¸²æŸ“é¡µé¢æˆ–è€…åˆ«çš„ä»€ä¹ˆã€‚ç„¶åå†æ¢å¤å†—é•¿çš„è®¡ç®—ã€‚æ˜¯ä¸æ˜¯è„‘ä¸­åŸºæœ¬æœ‰ä¸€ä¸ªæ¨¡ç³Šçš„æ¦‚å¿µäº†ï¼Ÿ\n\nåœ¨è¿›ä¸€æ­¥ï¼ŒReactå…¶å®ä¸ºå¾ˆå¤šä»»åŠ¡è¿›è¡Œäº†åˆ‡ç‰‡ï¼Œè¿™äº›æ¯ä¸€ä¸ªç»†å°çš„ç‰‡ï¼Œæˆ‘ä»¬å¯ä»¥æˆä¸ºã€ŒFiberã€ã€‚åœ¨æ‰§è¡Œå®Œä¸€ä¸ªã€ŒFiberã€çš„æ—¶å€™ï¼Œä¼šæ£€æŸ¥é˜Ÿåˆ—ä¸­æœ€é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ã€‚å¦‚æœæœ‰æ¯”ç›®å‰çš„è¿™ä¸ªä¼˜å…ˆçº§é«˜çš„ï¼Œå…ˆæŠŠæ•°æ®å’ŒçŠ¶æ€ä¿å­˜åœ¨ã€ŒFiberã€èŠ‚ç‚¹ä¸Šï¼Œç„¶åè¿›è¡Œé‚£ä¸ªã€Œæ›´é«˜ä¼˜å…ˆçº§ä»»åŠ¡ã€ã€‚ä¹‹åå†æ£€æŸ¥ï¼Œå¦‚æœæ²¡æœ‰å°±æ¢å¤ä»»åŠ¡ã€‚\n\nåœ¨ render é˜¶æ®µï¼Œä¸€ä¸ªåºå¤§çš„æ›´æ–°ä»»åŠ¡è¢«åˆ†è§£ä¸ºäº†ä¸€ä¸ªä¸ªçš„å·¥ä½œå•å…ƒï¼Œè¿™äº›å·¥ä½œå•å…ƒæœ‰ç€ä¸åŒçš„ä¼˜å…ˆçº§ï¼ŒReact å¯ä»¥æ ¹æ®ä¼˜å…ˆçº§çš„é«˜ä½å»å®ç°å·¥ä½œå•å…ƒçš„æ‰“æ–­å’Œæ¢å¤ã€‚ç”±äº render é˜¶æ®µçš„æ“ä½œå¯¹ç”¨æˆ·æ¥è¯´å…¶å®æ˜¯â€œä¸å¯è§â€çš„ï¼Œæ‰€ä»¥å°±ç®—æ‰“æ–­å†é‡å¯ï¼Œå¯¹ç”¨æˆ·æ¥è¯´ä¹Ÿæ˜¯ 0 æ„ŸçŸ¥ã€‚ä½†æ˜¯ï¼Œå·¥ä½œå•å…ƒï¼ˆä¹Ÿå°±æ˜¯ä»»åŠ¡ï¼‰çš„é‡å¯å°†ä¼šä¼´éšç€å¯¹éƒ¨åˆ†ç”Ÿå‘½å‘¨æœŸçš„é‡å¤æ‰§è¡Œï¼Œè¿™äº›ç”Ÿå‘½å‘¨æœŸæ˜¯ï¼š\n\n- componentWillMount\n\n- componentWillUpdate\n\n- shouldComponentUpdate\n\n- componentWillReceiveProps\n\nå…¶ä¸­ shouldComponentUpdate çš„ä½œç”¨æ˜¯é€šè¿‡è¿”å› true æˆ–è€… falseï¼Œæ¥å¸®åŠ©æˆ‘ä»¬åˆ¤æ–­æ›´æ–°çš„å¿…è¦æ€§ï¼Œä¸€èˆ¬åœ¨è¿™ä¸ªå‡½æ•°ä¸­ä¸ä¼šè¿›è¡Œå‰¯ä½œç”¨æ“ä½œï¼Œå› æ­¤é£é™©ä¸å¤§ã€‚\n\nè€Œ â€œcomponentWillâ€ å¼€å¤´çš„ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œåˆ™å¸¸å¹´è¢«å¼€å‘è€…ä»¥å„ç§å„æ ·çš„å§¿åŠ¿æ»¥ç”¨ï¼Œæ˜¯å‰¯ä½œç”¨çš„â€œé‡ç¾åŒºâ€ã€‚\n\n\n\n# æ€è€ƒ\n\nä¹‹å‰çš„é—®é¢˜ï¼Œç°åœ¨æ˜¯å¦æœ‰çš„å·²ç»æœ‰ç­”æ¡ˆäº†ï¼Ÿæœ‰çš„è¿˜æ²¡æœ‰ï¼Ÿæ¬¢è¿è®¨è®º\n\n1. éƒ½è¯´`Fiber`æ˜¯æœ‰ä¼˜å…ˆçº§ï¼Œæœ‰æ‰“æ–­ä»»åŠ¡çš„æœºåˆ¶ï¼Œä½†æ˜¯`JavaScript`ä»–æ˜¯å•çº¿ç¨‹çš„ï¼Œåœ¨è®¡ç®—çš„æ—¶å€™å¦‚ä½•æ‰“æ–­å‘¢ï¼Ÿ\n2. æ•°æ®ç»“æ„ä¸ºä»€ä¹ˆé€‰æ‹©äº†é“¾è¡¨ä½œä¸ºæ•°æ®ç»“æ„ï¼Ÿåˆ«çš„ä¸å¯ä»¥å—ï¼Ÿæ¯”å¦‚ï¼Œæ•°ç»„ï¼Ÿ\n3. ä¸ºä»€ä¹ˆæœ‰çš„æ—¶å€™`render`ä¼šæ‰§è¡Œå¤šæ¬¡ï¼Ÿ\n4. `Fiber`æ¶æ„ä¸€å®šæ˜¯å¼‚æ­¥çš„å—ï¼Ÿ\n5. `Fiber`æ ‘å’Œè™šæ‹ŸDOMæ ‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\n\n# ç´¢å¼•\n\nhttps://zh-hans.reactjs.org/docs\n\n\n\n\n\n\n\n\n\n","slug":"ã€é‡è¯†å‰ç«¯ã€‘Reactæºç é˜…è¯»ï¼ˆäºŒï¼‰2000å­—å‘Šè¯‰ä½ Fiberè®¾è®¡åŠ¨æœº","published":1,"updated":"2021-06-24T14:00:06.850Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra8c001elwrd296whmen","content":"<h1 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h1><p>ä¸Šä¸€ç¯‡æŒ–çš„å‘å‡ ä¹éƒ½æ˜¯<code>Fiber</code>æœ‰å…³çš„ï¼Œæœ¬æ¥æƒ³å…ˆå­¦ä¹ ä¸€ä¸‹<code>Hooks</code>ï¼Œå‘ç°ä¹Ÿå’Œ<code>FIber</code>å¯†åˆ‡ç›¸å…³äº†ï¼Œå†³å®šå…ˆæå®šä¸€ä¸‹<code>Fiber</code>ã€‚ä¸äº†è§£çš„å¯ä»¥æŸ¥çœ‹æˆ‘çš„ä¸»é¡µã€‚<code>Fiber</code>æ¶æ„<code>React</code>å†™äº†å‡ å¹´æ—¶é—´ï¼Œä¸€ç¯‡æ–‡ç« è‚¯å®šæ˜¯è®²ä¸å®Œçš„ï¼Œæˆ‘å†³å®šåˆ†ä¸ºå››ä¸ªé˜¶æ®µä»‹ç»ã€‚</p>\n<ul>\n<li>åŠ¨æœºï¼ˆæˆ–è€…è¯´åˆè¡·</li>\n<li>åˆå§‹åŒ–-Fiberæ ‘çš„å‡†å¤‡å·¥ä½œ</li>\n<li>render-Fiberæ ‘çš„æ„å»º</li>\n<li>commit-Fiberæ ‘æ˜ å°„åˆ°DOM</li>\n</ul>\n<p>çœ‹äº†ç½‘ä¸Šçš„æ–‡ç« å¤§éƒ½æµ…å°è¾„æ­¢ï¼Œå°±å†™äº†ä¸€äº›ç®€å•çš„ä»‹ç»ï¼Œæˆ‘ä¹Ÿç…§çŒ«ç”»è™ç„¶åå»é¢è¯•ï¼Œè¢«æ‰“å›äº†ã€‚æ¯”å¦‚å‡ ä¸ªé—®é¢˜ï¼Œå¦‚æœä½ èƒ½ç­”çš„ä¸é”™è¯´æ˜ä½ çš„<code>Fiber</code>çŸ¥è¯†è¿˜ä¸é”™ã€‚</p>\n<ol>\n<li>éƒ½è¯´<code>Fiber</code>æ˜¯æœ‰ä¼˜å…ˆçº§ï¼Œæœ‰æ‰“æ–­ä»»åŠ¡çš„æœºåˆ¶ï¼Œä½†æ˜¯<code>JavaScript</code>ä»–æ˜¯å•çº¿ç¨‹çš„ï¼Œåœ¨è®¡ç®—çš„æ—¶å€™å¦‚ä½•æ‰“æ–­å‘¢ï¼Ÿ</li>\n<li>æ•°æ®ç»“æ„ä¸ºä»€ä¹ˆé€‰æ‹©äº†é“¾è¡¨ä½œä¸ºæ•°æ®ç»“æ„ï¼Ÿåˆ«çš„ä¸å¯ä»¥å—ï¼Ÿæ¯”å¦‚ï¼Œæ•°ç»„ï¼Ÿ</li>\n<li>ä¸ºä»€ä¹ˆæœ‰çš„æ—¶å€™<code>render</code>ä¼šæ‰§è¡Œå¤šæ¬¡ï¼Ÿ</li>\n<li><code>Fiber</code>æ¶æ„ä¸€å®šæ˜¯å¼‚æ­¥çš„å—ï¼Ÿ</li>\n<li><code>Fiber</code>æ ‘å’Œè™šæ‹ŸDOMæ ‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</li>\n</ol>\n<p>è¿™äº›éƒ½æ˜¯æˆ‘é¢è¯•é‡åˆ°çš„é—®é¢˜â€¦å¤ªæ·±äº†ï¼Œç½‘ä¸Šçš„æ–‡ç« å‡ ä¹æ²¡æœ‰æåˆ°ï¼Œæ‰€ä»¥æˆ‘å†³å®šè‡ªå·±æ¥å­¦ä¹ ä¸€ä¸‹ï¼Œç„¶ååˆ†äº«å¹¶è®°å½•æˆ‘çš„å­¦ä¹ è¿‡ç¨‹ã€‚å¦‚æœæœ‰é”™è¯¯çš„åœ°æ–¹ï¼Œè¿˜è¯·ä¸€èµ·è®¨è®ºã€‚æœ‰ä»»ä½•é—®é¢˜éƒ½å¯ä»¥æ·»åŠ æˆ‘çš„vï¼šã€ŒDerrickTelã€    å’Œæˆ‘è®¨è®ºã€‚</p>\n<p>éº»çƒ¦å†™ä¸€ä¸‹å¤‡æ³¨ï¼Œè°¢è°¢ã€‚</p>\n<h1 id=\"å‰ç½®å°çŸ¥è¯†\"><a href=\"#å‰ç½®å°çŸ¥è¯†\" class=\"headerlink\" title=\"å‰ç½®å°çŸ¥è¯†\"></a>å‰ç½®å°çŸ¥è¯†</h1><h2 id=\"è¿›ç¨‹å’Œçº¿ç¨‹\"><a href=\"#è¿›ç¨‹å’Œçº¿ç¨‹\" class=\"headerlink\" title=\"è¿›ç¨‹å’Œçº¿ç¨‹\"></a>è¿›ç¨‹å’Œçº¿ç¨‹</h2><p>å¤šçº¿ç¨‹å¯ä»¥å¹¶è¡Œå¤„ç†ä»»åŠ¡ï¼Œä½†æ˜¯çº¿ç¨‹æ˜¯ä¸èƒ½å•ç‹¬å­˜åœ¨çš„ï¼Œå®ƒæ˜¯ç”±è¿›ç¨‹æ¥å¯åŠ¨å’Œç®¡ç†çš„ã€‚é‚£ä»€ä¹ˆåˆæ˜¯è¿›ç¨‹å‘¢ï¼Ÿ</p>\n<p>ä¸€ä¸ªè¿›ç¨‹å°±æ˜¯ä¸€ä¸ªç¨‹åºçš„è¿è¡Œå®ä¾‹ã€‚è¯¦ç»†è§£é‡Šå°±æ˜¯ï¼Œå¯åŠ¨ä¸€ä¸ªç¨‹åºçš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿä¼šä¸ºè¯¥ç¨‹åºåˆ›å»ºä¸€å—å†…å­˜ï¼Œç”¨æ¥å­˜æ”¾ä»£ç ã€è¿è¡Œä¸­çš„æ•°æ®å’Œä¸€ä¸ªæ‰§è¡Œä»»åŠ¡çš„ä¸»çº¿ç¨‹ï¼Œæˆ‘ä»¬æŠŠè¿™æ ·çš„ä¸€ä¸ªè¿è¡Œç¯å¢ƒå«è¿›ç¨‹ã€‚</p>\n<p>å› ä¸ºä¸æ˜¯æ ¸å¿ƒï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œç»™ä¸€ä¸ªç®€å•çš„ä¾‹å­å¸®åŠ©ç†è§£ï¼š</p>\n<p>è¿›ç¨‹æ˜¯ç«è½¦å¤´ï¼Œçº¿ç¨‹æ˜¯ç«è½¦çš„è½¦å¢ã€‚æ²¡æœ‰ç«è½¦å¤´ï¼Œè½¦å¢æ— æ³•è‡ªå·±è¿è¡Œã€‚ä¸€ä¸ªç«è½¦å¤´å¯ä»¥æ‹‰å¤šä¸ªè½¦å¢ã€‚</p>\n<h2 id=\"å•çº¿ç¨‹çš„JavaScriptå’Œå¤šçº¿ç¨‹çš„æµè§ˆå™¨\"><a href=\"#å•çº¿ç¨‹çš„JavaScriptå’Œå¤šçº¿ç¨‹çš„æµè§ˆå™¨\" class=\"headerlink\" title=\"å•çº¿ç¨‹çš„JavaScriptå’Œå¤šçº¿ç¨‹çš„æµè§ˆå™¨\"></a>å•çº¿ç¨‹çš„JavaScriptå’Œå¤šçº¿ç¨‹çš„æµè§ˆå™¨</h2><p>å¤§å®¶ç¬¬ä¸€æ¬¡æ¥è§¦åˆ°JavaScriptå¬åˆ°æœ€å¤šçš„ææ€•å°±æ˜¯JavaScript æ˜¯å•çº¿ç¨‹çš„ï¼Œæ›´æœ‰ç”šè€…ä¼šçŸ¥é“ä¸ºä»€ä¹ˆJavaScriptè¦æ˜¯å•çº¿ç¨‹çš„ã€‚</p>\n<blockquote>\n<p>è¯•æƒ³å¦‚æœæ¸²æŸ“çº¿ç¨‹å’Œ JavaScript çº¿ç¨‹åŒæ—¶åœ¨å·¥ä½œï¼Œé‚£ä¹ˆæ¸²æŸ“ç»“æœå¿…ç„¶æ˜¯éš¾ä»¥é¢„æµ‹çš„ï¼šæ¯”å¦‚æ¸²æŸ“çº¿ç¨‹åˆšç»˜åˆ¶å¥½çš„ç”»é¢ï¼Œå¯èƒ½è½¬å¤´å°±ä¼šè¢«ä¸€æ®µ JavaScript ç»™æ”¹å¾—é¢ç›®å…¨éã€‚è¿™å°±å†³å®šäº†JavaScript çº¿ç¨‹å’Œæ¸²æŸ“çº¿ç¨‹å¿…é¡»æ˜¯äº’æ–¥çš„ï¼šè¿™ä¸¤ä¸ªçº¿ç¨‹ä¸èƒ½å¤Ÿç©¿æ’æ‰§è¡Œï¼Œå¿…é¡»ä¸²è¡Œã€‚å½“å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹åªèƒ½æŒ‚èµ·ç­‰å¾…ã€‚</p>\n</blockquote>\n<p>æ‰€ä»¥JavaScriptæ˜¯å•çº¿ç¨‹çš„ã€‚é‚£ä¸ºä»€ä¹ˆæµè§ˆå™¨åˆæ˜¯å¤šçº¿ç¨‹çš„ï¼Ÿå› ä¸ºåœ¨æ—©æœŸçš„å•çº¿ç¨‹æµè§ˆå™¨ä¼šç¢°åˆ°å‡ ä¸ªé—®é¢˜ï¼š</p>\n<ol>\n<li>ä¸ç¨³å®š<ol>\n<li>æ¯”å¦‚ä¸€ä¸ªWebè§†é¢‘æˆ–Webæ¸¸æˆï¼Œè¿™äº›å¯èƒ½éƒ½éœ€è¦å¼ºå¤§çš„æ’ä»¶æ¥å¸®åŠ©è§£å†³é—®é¢˜ã€‚ä½†æ˜¯æ’ä»¶æœ€å®¹æ˜“å‡ºç°BUGï¼Œä¸€ä¸ªBUGå´©æºƒäº†ï¼Œé‚£å°±ä¼šå¯¼è‡´æ•´ä¸ªæµè§ˆå™¨çš„å´©æºƒ</li>\n</ol>\n</li>\n<li>ä¸æµç•…<ol>\n<li>å°±ä¸€ä¸ªçº¿ç¨‹ï¼Œå¦‚æœè¢«ä¸€ä¸ªä»»åŠ¡å æ®äº†å¤§é‡çš„äº‹æƒ…ï¼Œç”šè‡³æ˜¯æ­»å¾ªç¯ï¼Œä¹Ÿä¼šè®©æµè§ˆå™¨å¤„äºåœæ»çŠ¶æ€</li>\n</ol>\n</li>\n<li>ä¸å®‰å…¨<ol>\n<li>å¦‚æœå•çº¿ç¨‹çš„æ’çº¿åœ¨è¿è¡Œæ—¶ï¼Œæ˜¯ä¸€ä¸ªç—…æ¯’æˆ–è€…æ¶æ„ç¨‹åºï¼Œä½ çš„ç”µè„‘å°†é¢ä¸´å·¨å¤§çš„é£é™©</li>\n</ol>\n</li>\n</ol>\n<p>æ‰€ä»¥æµè§ˆå™¨å°±éœ€è¦å¤šçº¿ç¨‹æ¥å¤„ç†è¿™äº›é—ç•™é—®é¢˜ï¼Œå¹¶ä¸”å¯ä»¥ä¿è¯é€Ÿåº¦çš„åŒæ—¶ä¿è¯å®‰å…¨ã€‚æ¯”å¦‚ç½‘ç»œçº¿ç¨‹ï¼Œå¯ä»¥æŠŠæ•°æ®éƒ½å¼„æ¸…æ¥šäº†ï¼Œç­‰å¾…JavaScriptæ¥æå–ï¼Œå°±å¥½åƒæ´—è¡£æœï¼Œæˆ‘æ”¾æ´—è¡£åº—æ´—ï¼Œæˆ‘åƒå®Œé¥­æ¥æ‹¿å°±å¥½äº†ã€‚ä¸éœ€è¦æˆ‘è‡ªå·±æ‰‹åŠ¨çš„å»æ´—ã€‚ä½†æ˜¯ä¹Ÿä¼šå¸¦æ¥å‡ ä¸ªé—®é¢˜</p>\n<ol>\n<li>æ›´å¤šçš„ç³»ç»Ÿèµ„æºå ç”¨ã€‚</li>\n<li>æ›´å¤æ‚çš„æµè§ˆå™¨æ¶æ„ã€‚ï¼ˆä¸æ˜¯æœ¬æ–‡é‡ç‚¹</li>\n</ol>\n<blockquote>\n<p>å•çº¿ç¨‹çš„JavaScriptæœ‰è‡ªå·±çš„è¿è¡Œæœºåˆ¶ã€Œäº‹ä»¶å¾ªç¯ã€ã€‚å¯ä»¥åœ¨æˆ‘çš„ä¸»ä¸šæŸ¥çœ‹æ–‡ç« è¿›è¡Œé˜…è¯»ã€‚</p>\n</blockquote>\n<h1 id=\"Reactçš„å¡é¡¿\"><a href=\"#Reactçš„å¡é¡¿\" class=\"headerlink\" title=\"Reactçš„å¡é¡¿\"></a>Reactçš„å¡é¡¿</h1><p>åœ¨<code>React15</code>åŠä¹‹å‰çš„ç‰ˆæœ¬ã€‚éƒ½æ˜¯è¿›è¡Œä¸¤é¢—æ ‘çš„æ¯”è¾ƒï¼Œç„¶åæ‰¾åˆ°éœ€è¦æ›´æ–°çš„åœ°æ–¹ï¼Œæœ€åæ›´æ–°åˆ°çœŸå®çš„DOMæ ‘ä¸Šã€‚è€Œè¿™ä¸ªç®—æ³•æ˜¯åœ¨æ•°æ®ç»“æ„ä¸­çš„ä¸¤æ£µæ ‘çš„æ¯”è¾ƒä¸­ä¼˜åŒ–è€Œæ¥ã€‚ä¹Ÿä»åŸæœ¬ O(n3) çš„ Diff æ—¶é—´å¤æ‚åº¦ä¼˜åŒ–åˆ°äº†å‰æ— å¤äººçš„ O(n)ã€‚æˆ‘ä»¬ç§°ä¹‹ä¸ºã€Œ Stack Reconciler ã€ã€‚åœ¨å¾ˆé•¿çš„ä¸€æ®µæ—¶é—´é£å…‰æ— é™ã€‚</p>\n<p>ä½†æ˜¯ï¼Œéšç€æ—¶é—´çš„æ¨ç§»å’Œä¸šåŠ¡å¤æ‚åº¦çš„æå‡ï¼ŒReact æ›¾ç»è¢«äººä»¬æ´¥æ´¥ä¹é“çš„ Stack Reconciler ä¹Ÿæ¸æ¸åœ¨ä½“éªŒæ–¹é¢æ˜¾å‡ºç–²æ€ã€‚</p>\n<p>ä¸ºä»€ä¹ˆä¼šå‡ºç°ä¹åŠ›çš„æ„Ÿè§‰ï¼Ÿ</p>\n<p>å› ä¸ºä»æœ¬è´¨ä¸Šæ¥è¯´ï¼Œæ ˆè°ƒå’Œæœºåˆ¶ä¸‹çš„ Diff ç®—æ³•ï¼Œå…¶å®æ˜¯æ ‘çš„æ·±åº¦ä¼˜å…ˆéå†çš„è¿‡ç¨‹ã€‚è€Œæ ‘çš„æ·±åº¦ä¼˜å…ˆéå†ï¼Œæ€»æ˜¯å’Œé€’å½’è„±ä¸äº†å…³ç³»ã€‚</p>\n<p>é€’å½’å°±æ˜¯é™¤éç¢°åˆ°äº†ä»–çš„è¿”å›æ¡ä»¶ï¼Œå¦åˆ™ï¼Œå°†æ— çº¿çš„å¾ªç¯ä¸‹å»ã€‚è¿™ä¸ªé—®é¢˜æœ€è‡´å‘½çš„å°±æ˜¯ï¼Œæ— æ³•åœæ­¢ã€‚åŠ å…¥è¶³å¤Ÿå¤§ï¼Œå°†ä¼šå‡ºç°ã€Œé¡µé¢å¡æ­»ã€ã€‚</p>\n<h1 id=\"FIberçš„å‡ºç°\"><a href=\"#FIberçš„å‡ºç°\" class=\"headerlink\" title=\"FIberçš„å‡ºç°\"></a>FIberçš„å‡ºç°</h1><p>é¦–å…ˆFiberçš„ç¿»è¯‘æ˜¯ï¼šã€Œçº¤ç»´ã€ã€‚</p>\n<p>ç»´åŸºç™¾ç§‘ï¼šã€Œ<strong>çº¤ç»´</strong>ï¼ˆè‹±è¯­ï¼šfiberï¼‰æ˜¯æŒ‡ç”±è¿ç»­æˆ–ä¸è¿ç»­çš„ç»†ä¸ç»„æˆçš„ç‰©è´¨ã€‚ã€</p>\n<p>ç®€å•æ¥è¯´å°±æ˜¯éå¸¸çš„ç»†çš„ä¸œè¥¿ï¼Œä¹Ÿå°±æ˜¯å¯¹æ•´ä¸ªæ¸²æŸ“è¿‡ç¨‹è¿›è¡Œçº¤ç»´çº§åˆ«çš„æ§åˆ¶ã€‚</p>\n<h2 id=\"Fiberå¦‚ä½•è§£å†³é—®é¢˜\"><a href=\"#Fiberå¦‚ä½•è§£å†³é—®é¢˜\" class=\"headerlink\" title=\"Fiberå¦‚ä½•è§£å†³é—®é¢˜\"></a>Fiberå¦‚ä½•è§£å†³é—®é¢˜</h2><p>Fiberæ˜¯å¯¹æ•´ä¸ªReactçš„è°ƒåº¦ç®—æ³•çš„é‡å†™ï¼Œåˆæ˜¯ä¸€ä¸ªReactè‡ªåˆ›çš„æ•°æ®ç»“æ„ï¼Œé‡Œé¢ä¿å­˜äº†ä¸€ä¸ªè™šæ‹ŸDOMçš„èŠ‚ç‚¹ï¼Œä¹Ÿä¿å­˜äº†éœ€è¦æ›´æ–°çš„çŠ¶æ€ï¼Œä»¥åŠå‰¯ä½œç”¨ã€‚</p>\n<p>æˆ‘ä»¬çŸ¥é“ï¼Œç”¨æˆ·åœ¨ä½¿ç”¨çš„æ—¶å€™æœ€æ€•çš„æ˜¯ä»€ä¹ˆï¼Ÿæ²¡ååº”ï¼Œä¹Ÿå°±æ˜¯ã€Œé¡µé¢å¡æ­»ã€ã€‚è€Œæˆ‘ä»¬ç©æ¸¸æˆè§‰å¾—å¡æ˜¯å› ä¸ºä»–ä¸€ç§’é’Ÿçš„å¸§æ•°å°‘äº60å¸§ï¼Œæ‰€ä»¥æˆ‘ä»¬è§‰å¾—å¡ï¼Œè€Œæµè§ˆå™¨çš„é¡µé¢ä¹Ÿä¸€æ ·ã€‚Reactåªéœ€è¦ä¸€ç§’é’Ÿèƒ½å¤Ÿä¿è¯60å¸§çš„æµç•…å‡ºç°å°±å¯ä»¥äº†ï¼Œç”¨æˆ·å°±ä¸è§‰å¾—ã€Œé¡µé¢å¡æ­»ã€äº†ã€‚</p>\n<p>æ‰€ä»¥Fiberçš„ä»»åŠ¡è‚¯å®šæ˜¯ï¼Œåœ¨ä¿è¯è‡³å°‘60å¸§æ¯ç§’çš„æƒ…å†µä¸‹ï¼Œæ‰å»åšåˆ«çš„äº‹æƒ…ã€‚</p>\n<h2 id=\"Fiberæ¶æ„æ ¸å¿ƒï¼šâ€œå¯ä¸­æ–­â€â€œå¯æ¢å¤â€â€œä¼˜å…ˆçº§â€\"><a href=\"#Fiberæ¶æ„æ ¸å¿ƒï¼šâ€œå¯ä¸­æ–­â€â€œå¯æ¢å¤â€â€œä¼˜å…ˆçº§â€\" class=\"headerlink\" title=\"Fiberæ¶æ„æ ¸å¿ƒï¼šâ€œå¯ä¸­æ–­â€â€œå¯æ¢å¤â€â€œä¼˜å…ˆçº§â€\"></a>Fiberæ¶æ„æ ¸å¿ƒï¼šâ€œå¯ä¸­æ–­â€â€œå¯æ¢å¤â€â€œä¼˜å…ˆçº§â€</h2><p>Fiberæ‰€åšçš„è¿™ä¸€ç³»åˆ—æ“ä½œéƒ½æ˜¯ä¸ºäº†ç”¨æˆ·çš„ä¸æ»‘ä½“éªŒã€‚</p>\n<p>æƒ³è±¡ä¸€ä¸‹ï¼Œæ‰“æ–­ç°åœ¨éå¸¸å†—é•¿çš„è®¡ç®—ï¼Œé€šè¿‡ä¼˜å…ˆçº§çš„åˆ¤æ–­ï¼Œä¼˜å…ˆæ¸²æŸ“é¡µé¢æˆ–è€…åˆ«çš„ä»€ä¹ˆã€‚ç„¶åå†æ¢å¤å†—é•¿çš„è®¡ç®—ã€‚æ˜¯ä¸æ˜¯è„‘ä¸­åŸºæœ¬æœ‰ä¸€ä¸ªæ¨¡ç³Šçš„æ¦‚å¿µäº†ï¼Ÿ</p>\n<p>åœ¨è¿›ä¸€æ­¥ï¼ŒReactå…¶å®ä¸ºå¾ˆå¤šä»»åŠ¡è¿›è¡Œäº†åˆ‡ç‰‡ï¼Œè¿™äº›æ¯ä¸€ä¸ªç»†å°çš„ç‰‡ï¼Œæˆ‘ä»¬å¯ä»¥æˆä¸ºã€ŒFiberã€ã€‚åœ¨æ‰§è¡Œå®Œä¸€ä¸ªã€ŒFiberã€çš„æ—¶å€™ï¼Œä¼šæ£€æŸ¥é˜Ÿåˆ—ä¸­æœ€é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ã€‚å¦‚æœæœ‰æ¯”ç›®å‰çš„è¿™ä¸ªä¼˜å…ˆçº§é«˜çš„ï¼Œå…ˆæŠŠæ•°æ®å’ŒçŠ¶æ€ä¿å­˜åœ¨ã€ŒFiberã€èŠ‚ç‚¹ä¸Šï¼Œç„¶åè¿›è¡Œé‚£ä¸ªã€Œæ›´é«˜ä¼˜å…ˆçº§ä»»åŠ¡ã€ã€‚ä¹‹åå†æ£€æŸ¥ï¼Œå¦‚æœæ²¡æœ‰å°±æ¢å¤ä»»åŠ¡ã€‚</p>\n<p>åœ¨ render é˜¶æ®µï¼Œä¸€ä¸ªåºå¤§çš„æ›´æ–°ä»»åŠ¡è¢«åˆ†è§£ä¸ºäº†ä¸€ä¸ªä¸ªçš„å·¥ä½œå•å…ƒï¼Œè¿™äº›å·¥ä½œå•å…ƒæœ‰ç€ä¸åŒçš„ä¼˜å…ˆçº§ï¼ŒReact å¯ä»¥æ ¹æ®ä¼˜å…ˆçº§çš„é«˜ä½å»å®ç°å·¥ä½œå•å…ƒçš„æ‰“æ–­å’Œæ¢å¤ã€‚ç”±äº render é˜¶æ®µçš„æ“ä½œå¯¹ç”¨æˆ·æ¥è¯´å…¶å®æ˜¯â€œä¸å¯è§â€çš„ï¼Œæ‰€ä»¥å°±ç®—æ‰“æ–­å†é‡å¯ï¼Œå¯¹ç”¨æˆ·æ¥è¯´ä¹Ÿæ˜¯ 0 æ„ŸçŸ¥ã€‚ä½†æ˜¯ï¼Œå·¥ä½œå•å…ƒï¼ˆä¹Ÿå°±æ˜¯ä»»åŠ¡ï¼‰çš„é‡å¯å°†ä¼šä¼´éšç€å¯¹éƒ¨åˆ†ç”Ÿå‘½å‘¨æœŸçš„é‡å¤æ‰§è¡Œï¼Œè¿™äº›ç”Ÿå‘½å‘¨æœŸæ˜¯ï¼š</p>\n<ul>\n<li><p>componentWillMount</p>\n</li>\n<li><p>componentWillUpdate</p>\n</li>\n<li><p>shouldComponentUpdate</p>\n</li>\n<li><p>componentWillReceiveProps</p>\n</li>\n</ul>\n<p>å…¶ä¸­ shouldComponentUpdate çš„ä½œç”¨æ˜¯é€šè¿‡è¿”å› true æˆ–è€… falseï¼Œæ¥å¸®åŠ©æˆ‘ä»¬åˆ¤æ–­æ›´æ–°çš„å¿…è¦æ€§ï¼Œä¸€èˆ¬åœ¨è¿™ä¸ªå‡½æ•°ä¸­ä¸ä¼šè¿›è¡Œå‰¯ä½œç”¨æ“ä½œï¼Œå› æ­¤é£é™©ä¸å¤§ã€‚</p>\n<p>è€Œ â€œcomponentWillâ€ å¼€å¤´çš„ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œåˆ™å¸¸å¹´è¢«å¼€å‘è€…ä»¥å„ç§å„æ ·çš„å§¿åŠ¿æ»¥ç”¨ï¼Œæ˜¯å‰¯ä½œç”¨çš„â€œé‡ç¾åŒºâ€ã€‚</p>\n<h1 id=\"æ€è€ƒ\"><a href=\"#æ€è€ƒ\" class=\"headerlink\" title=\"æ€è€ƒ\"></a>æ€è€ƒ</h1><p>ä¹‹å‰çš„é—®é¢˜ï¼Œç°åœ¨æ˜¯å¦æœ‰çš„å·²ç»æœ‰ç­”æ¡ˆäº†ï¼Ÿæœ‰çš„è¿˜æ²¡æœ‰ï¼Ÿæ¬¢è¿è®¨è®º</p>\n<ol>\n<li>éƒ½è¯´<code>Fiber</code>æ˜¯æœ‰ä¼˜å…ˆçº§ï¼Œæœ‰æ‰“æ–­ä»»åŠ¡çš„æœºåˆ¶ï¼Œä½†æ˜¯<code>JavaScript</code>ä»–æ˜¯å•çº¿ç¨‹çš„ï¼Œåœ¨è®¡ç®—çš„æ—¶å€™å¦‚ä½•æ‰“æ–­å‘¢ï¼Ÿ</li>\n<li>æ•°æ®ç»“æ„ä¸ºä»€ä¹ˆé€‰æ‹©äº†é“¾è¡¨ä½œä¸ºæ•°æ®ç»“æ„ï¼Ÿåˆ«çš„ä¸å¯ä»¥å—ï¼Ÿæ¯”å¦‚ï¼Œæ•°ç»„ï¼Ÿ</li>\n<li>ä¸ºä»€ä¹ˆæœ‰çš„æ—¶å€™<code>render</code>ä¼šæ‰§è¡Œå¤šæ¬¡ï¼Ÿ</li>\n<li><code>Fiber</code>æ¶æ„ä¸€å®šæ˜¯å¼‚æ­¥çš„å—ï¼Ÿ</li>\n<li><code>Fiber</code>æ ‘å’Œè™šæ‹ŸDOMæ ‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</li>\n</ol>\n<h1 id=\"ç´¢å¼•\"><a href=\"#ç´¢å¼•\" class=\"headerlink\" title=\"ç´¢å¼•\"></a>ç´¢å¼•</h1><p><a href=\"https://zh-hans.reactjs.org/docs\" target=\"_blank\" rel=\"noopener\">https://zh-hans.reactjs.org/docs</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h1><p>ä¸Šä¸€ç¯‡æŒ–çš„å‘å‡ ä¹éƒ½æ˜¯<code>Fiber</code>æœ‰å…³çš„ï¼Œæœ¬æ¥æƒ³å…ˆå­¦ä¹ ä¸€ä¸‹<code>Hooks</code>ï¼Œå‘ç°ä¹Ÿå’Œ<code>FIber</code>å¯†åˆ‡ç›¸å…³äº†ï¼Œå†³å®šå…ˆæå®šä¸€ä¸‹<code>Fiber</code>ã€‚ä¸äº†è§£çš„å¯ä»¥æŸ¥çœ‹æˆ‘çš„ä¸»é¡µã€‚<code>Fiber</code>æ¶æ„<code>React</code>å†™äº†å‡ å¹´æ—¶é—´ï¼Œä¸€ç¯‡æ–‡ç« è‚¯å®šæ˜¯è®²ä¸å®Œçš„ï¼Œæˆ‘å†³å®šåˆ†ä¸ºå››ä¸ªé˜¶æ®µä»‹ç»ã€‚</p>\n<ul>\n<li>åŠ¨æœºï¼ˆæˆ–è€…è¯´åˆè¡·</li>\n<li>åˆå§‹åŒ–-Fiberæ ‘çš„å‡†å¤‡å·¥ä½œ</li>\n<li>render-Fiberæ ‘çš„æ„å»º</li>\n<li>commit-Fiberæ ‘æ˜ å°„åˆ°DOM</li>\n</ul>\n<p>çœ‹äº†ç½‘ä¸Šçš„æ–‡ç« å¤§éƒ½æµ…å°è¾„æ­¢ï¼Œå°±å†™äº†ä¸€äº›ç®€å•çš„ä»‹ç»ï¼Œæˆ‘ä¹Ÿç…§çŒ«ç”»è™ç„¶åå»é¢è¯•ï¼Œè¢«æ‰“å›äº†ã€‚æ¯”å¦‚å‡ ä¸ªé—®é¢˜ï¼Œå¦‚æœä½ èƒ½ç­”çš„ä¸é”™è¯´æ˜ä½ çš„<code>Fiber</code>çŸ¥è¯†è¿˜ä¸é”™ã€‚</p>\n<ol>\n<li>éƒ½è¯´<code>Fiber</code>æ˜¯æœ‰ä¼˜å…ˆçº§ï¼Œæœ‰æ‰“æ–­ä»»åŠ¡çš„æœºåˆ¶ï¼Œä½†æ˜¯<code>JavaScript</code>ä»–æ˜¯å•çº¿ç¨‹çš„ï¼Œåœ¨è®¡ç®—çš„æ—¶å€™å¦‚ä½•æ‰“æ–­å‘¢ï¼Ÿ</li>\n<li>æ•°æ®ç»“æ„ä¸ºä»€ä¹ˆé€‰æ‹©äº†é“¾è¡¨ä½œä¸ºæ•°æ®ç»“æ„ï¼Ÿåˆ«çš„ä¸å¯ä»¥å—ï¼Ÿæ¯”å¦‚ï¼Œæ•°ç»„ï¼Ÿ</li>\n<li>ä¸ºä»€ä¹ˆæœ‰çš„æ—¶å€™<code>render</code>ä¼šæ‰§è¡Œå¤šæ¬¡ï¼Ÿ</li>\n<li><code>Fiber</code>æ¶æ„ä¸€å®šæ˜¯å¼‚æ­¥çš„å—ï¼Ÿ</li>\n<li><code>Fiber</code>æ ‘å’Œè™šæ‹ŸDOMæ ‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</li>\n</ol>\n<p>è¿™äº›éƒ½æ˜¯æˆ‘é¢è¯•é‡åˆ°çš„é—®é¢˜â€¦å¤ªæ·±äº†ï¼Œç½‘ä¸Šçš„æ–‡ç« å‡ ä¹æ²¡æœ‰æåˆ°ï¼Œæ‰€ä»¥æˆ‘å†³å®šè‡ªå·±æ¥å­¦ä¹ ä¸€ä¸‹ï¼Œç„¶ååˆ†äº«å¹¶è®°å½•æˆ‘çš„å­¦ä¹ è¿‡ç¨‹ã€‚å¦‚æœæœ‰é”™è¯¯çš„åœ°æ–¹ï¼Œè¿˜è¯·ä¸€èµ·è®¨è®ºã€‚æœ‰ä»»ä½•é—®é¢˜éƒ½å¯ä»¥æ·»åŠ æˆ‘çš„vï¼šã€ŒDerrickTelã€    å’Œæˆ‘è®¨è®ºã€‚</p>\n<p>éº»çƒ¦å†™ä¸€ä¸‹å¤‡æ³¨ï¼Œè°¢è°¢ã€‚</p>\n<h1 id=\"å‰ç½®å°çŸ¥è¯†\"><a href=\"#å‰ç½®å°çŸ¥è¯†\" class=\"headerlink\" title=\"å‰ç½®å°çŸ¥è¯†\"></a>å‰ç½®å°çŸ¥è¯†</h1><h2 id=\"è¿›ç¨‹å’Œçº¿ç¨‹\"><a href=\"#è¿›ç¨‹å’Œçº¿ç¨‹\" class=\"headerlink\" title=\"è¿›ç¨‹å’Œçº¿ç¨‹\"></a>è¿›ç¨‹å’Œçº¿ç¨‹</h2><p>å¤šçº¿ç¨‹å¯ä»¥å¹¶è¡Œå¤„ç†ä»»åŠ¡ï¼Œä½†æ˜¯çº¿ç¨‹æ˜¯ä¸èƒ½å•ç‹¬å­˜åœ¨çš„ï¼Œå®ƒæ˜¯ç”±è¿›ç¨‹æ¥å¯åŠ¨å’Œç®¡ç†çš„ã€‚é‚£ä»€ä¹ˆåˆæ˜¯è¿›ç¨‹å‘¢ï¼Ÿ</p>\n<p>ä¸€ä¸ªè¿›ç¨‹å°±æ˜¯ä¸€ä¸ªç¨‹åºçš„è¿è¡Œå®ä¾‹ã€‚è¯¦ç»†è§£é‡Šå°±æ˜¯ï¼Œå¯åŠ¨ä¸€ä¸ªç¨‹åºçš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿä¼šä¸ºè¯¥ç¨‹åºåˆ›å»ºä¸€å—å†…å­˜ï¼Œç”¨æ¥å­˜æ”¾ä»£ç ã€è¿è¡Œä¸­çš„æ•°æ®å’Œä¸€ä¸ªæ‰§è¡Œä»»åŠ¡çš„ä¸»çº¿ç¨‹ï¼Œæˆ‘ä»¬æŠŠè¿™æ ·çš„ä¸€ä¸ªè¿è¡Œç¯å¢ƒå«è¿›ç¨‹ã€‚</p>\n<p>å› ä¸ºä¸æ˜¯æ ¸å¿ƒï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œç»™ä¸€ä¸ªç®€å•çš„ä¾‹å­å¸®åŠ©ç†è§£ï¼š</p>\n<p>è¿›ç¨‹æ˜¯ç«è½¦å¤´ï¼Œçº¿ç¨‹æ˜¯ç«è½¦çš„è½¦å¢ã€‚æ²¡æœ‰ç«è½¦å¤´ï¼Œè½¦å¢æ— æ³•è‡ªå·±è¿è¡Œã€‚ä¸€ä¸ªç«è½¦å¤´å¯ä»¥æ‹‰å¤šä¸ªè½¦å¢ã€‚</p>\n<h2 id=\"å•çº¿ç¨‹çš„JavaScriptå’Œå¤šçº¿ç¨‹çš„æµè§ˆå™¨\"><a href=\"#å•çº¿ç¨‹çš„JavaScriptå’Œå¤šçº¿ç¨‹çš„æµè§ˆå™¨\" class=\"headerlink\" title=\"å•çº¿ç¨‹çš„JavaScriptå’Œå¤šçº¿ç¨‹çš„æµè§ˆå™¨\"></a>å•çº¿ç¨‹çš„JavaScriptå’Œå¤šçº¿ç¨‹çš„æµè§ˆå™¨</h2><p>å¤§å®¶ç¬¬ä¸€æ¬¡æ¥è§¦åˆ°JavaScriptå¬åˆ°æœ€å¤šçš„ææ€•å°±æ˜¯JavaScript æ˜¯å•çº¿ç¨‹çš„ï¼Œæ›´æœ‰ç”šè€…ä¼šçŸ¥é“ä¸ºä»€ä¹ˆJavaScriptè¦æ˜¯å•çº¿ç¨‹çš„ã€‚</p>\n<blockquote>\n<p>è¯•æƒ³å¦‚æœæ¸²æŸ“çº¿ç¨‹å’Œ JavaScript çº¿ç¨‹åŒæ—¶åœ¨å·¥ä½œï¼Œé‚£ä¹ˆæ¸²æŸ“ç»“æœå¿…ç„¶æ˜¯éš¾ä»¥é¢„æµ‹çš„ï¼šæ¯”å¦‚æ¸²æŸ“çº¿ç¨‹åˆšç»˜åˆ¶å¥½çš„ç”»é¢ï¼Œå¯èƒ½è½¬å¤´å°±ä¼šè¢«ä¸€æ®µ JavaScript ç»™æ”¹å¾—é¢ç›®å…¨éã€‚è¿™å°±å†³å®šäº†JavaScript çº¿ç¨‹å’Œæ¸²æŸ“çº¿ç¨‹å¿…é¡»æ˜¯äº’æ–¥çš„ï¼šè¿™ä¸¤ä¸ªçº¿ç¨‹ä¸èƒ½å¤Ÿç©¿æ’æ‰§è¡Œï¼Œå¿…é¡»ä¸²è¡Œã€‚å½“å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹åªèƒ½æŒ‚èµ·ç­‰å¾…ã€‚</p>\n</blockquote>\n<p>æ‰€ä»¥JavaScriptæ˜¯å•çº¿ç¨‹çš„ã€‚é‚£ä¸ºä»€ä¹ˆæµè§ˆå™¨åˆæ˜¯å¤šçº¿ç¨‹çš„ï¼Ÿå› ä¸ºåœ¨æ—©æœŸçš„å•çº¿ç¨‹æµè§ˆå™¨ä¼šç¢°åˆ°å‡ ä¸ªé—®é¢˜ï¼š</p>\n<ol>\n<li>ä¸ç¨³å®š<ol>\n<li>æ¯”å¦‚ä¸€ä¸ªWebè§†é¢‘æˆ–Webæ¸¸æˆï¼Œè¿™äº›å¯èƒ½éƒ½éœ€è¦å¼ºå¤§çš„æ’ä»¶æ¥å¸®åŠ©è§£å†³é—®é¢˜ã€‚ä½†æ˜¯æ’ä»¶æœ€å®¹æ˜“å‡ºç°BUGï¼Œä¸€ä¸ªBUGå´©æºƒäº†ï¼Œé‚£å°±ä¼šå¯¼è‡´æ•´ä¸ªæµè§ˆå™¨çš„å´©æºƒ</li>\n</ol>\n</li>\n<li>ä¸æµç•…<ol>\n<li>å°±ä¸€ä¸ªçº¿ç¨‹ï¼Œå¦‚æœè¢«ä¸€ä¸ªä»»åŠ¡å æ®äº†å¤§é‡çš„äº‹æƒ…ï¼Œç”šè‡³æ˜¯æ­»å¾ªç¯ï¼Œä¹Ÿä¼šè®©æµè§ˆå™¨å¤„äºåœæ»çŠ¶æ€</li>\n</ol>\n</li>\n<li>ä¸å®‰å…¨<ol>\n<li>å¦‚æœå•çº¿ç¨‹çš„æ’çº¿åœ¨è¿è¡Œæ—¶ï¼Œæ˜¯ä¸€ä¸ªç—…æ¯’æˆ–è€…æ¶æ„ç¨‹åºï¼Œä½ çš„ç”µè„‘å°†é¢ä¸´å·¨å¤§çš„é£é™©</li>\n</ol>\n</li>\n</ol>\n<p>æ‰€ä»¥æµè§ˆå™¨å°±éœ€è¦å¤šçº¿ç¨‹æ¥å¤„ç†è¿™äº›é—ç•™é—®é¢˜ï¼Œå¹¶ä¸”å¯ä»¥ä¿è¯é€Ÿåº¦çš„åŒæ—¶ä¿è¯å®‰å…¨ã€‚æ¯”å¦‚ç½‘ç»œçº¿ç¨‹ï¼Œå¯ä»¥æŠŠæ•°æ®éƒ½å¼„æ¸…æ¥šäº†ï¼Œç­‰å¾…JavaScriptæ¥æå–ï¼Œå°±å¥½åƒæ´—è¡£æœï¼Œæˆ‘æ”¾æ´—è¡£åº—æ´—ï¼Œæˆ‘åƒå®Œé¥­æ¥æ‹¿å°±å¥½äº†ã€‚ä¸éœ€è¦æˆ‘è‡ªå·±æ‰‹åŠ¨çš„å»æ´—ã€‚ä½†æ˜¯ä¹Ÿä¼šå¸¦æ¥å‡ ä¸ªé—®é¢˜</p>\n<ol>\n<li>æ›´å¤šçš„ç³»ç»Ÿèµ„æºå ç”¨ã€‚</li>\n<li>æ›´å¤æ‚çš„æµè§ˆå™¨æ¶æ„ã€‚ï¼ˆä¸æ˜¯æœ¬æ–‡é‡ç‚¹</li>\n</ol>\n<blockquote>\n<p>å•çº¿ç¨‹çš„JavaScriptæœ‰è‡ªå·±çš„è¿è¡Œæœºåˆ¶ã€Œäº‹ä»¶å¾ªç¯ã€ã€‚å¯ä»¥åœ¨æˆ‘çš„ä¸»ä¸šæŸ¥çœ‹æ–‡ç« è¿›è¡Œé˜…è¯»ã€‚</p>\n</blockquote>\n<h1 id=\"Reactçš„å¡é¡¿\"><a href=\"#Reactçš„å¡é¡¿\" class=\"headerlink\" title=\"Reactçš„å¡é¡¿\"></a>Reactçš„å¡é¡¿</h1><p>åœ¨<code>React15</code>åŠä¹‹å‰çš„ç‰ˆæœ¬ã€‚éƒ½æ˜¯è¿›è¡Œä¸¤é¢—æ ‘çš„æ¯”è¾ƒï¼Œç„¶åæ‰¾åˆ°éœ€è¦æ›´æ–°çš„åœ°æ–¹ï¼Œæœ€åæ›´æ–°åˆ°çœŸå®çš„DOMæ ‘ä¸Šã€‚è€Œè¿™ä¸ªç®—æ³•æ˜¯åœ¨æ•°æ®ç»“æ„ä¸­çš„ä¸¤æ£µæ ‘çš„æ¯”è¾ƒä¸­ä¼˜åŒ–è€Œæ¥ã€‚ä¹Ÿä»åŸæœ¬ O(n3) çš„ Diff æ—¶é—´å¤æ‚åº¦ä¼˜åŒ–åˆ°äº†å‰æ— å¤äººçš„ O(n)ã€‚æˆ‘ä»¬ç§°ä¹‹ä¸ºã€Œ Stack Reconciler ã€ã€‚åœ¨å¾ˆé•¿çš„ä¸€æ®µæ—¶é—´é£å…‰æ— é™ã€‚</p>\n<p>ä½†æ˜¯ï¼Œéšç€æ—¶é—´çš„æ¨ç§»å’Œä¸šåŠ¡å¤æ‚åº¦çš„æå‡ï¼ŒReact æ›¾ç»è¢«äººä»¬æ´¥æ´¥ä¹é“çš„ Stack Reconciler ä¹Ÿæ¸æ¸åœ¨ä½“éªŒæ–¹é¢æ˜¾å‡ºç–²æ€ã€‚</p>\n<p>ä¸ºä»€ä¹ˆä¼šå‡ºç°ä¹åŠ›çš„æ„Ÿè§‰ï¼Ÿ</p>\n<p>å› ä¸ºä»æœ¬è´¨ä¸Šæ¥è¯´ï¼Œæ ˆè°ƒå’Œæœºåˆ¶ä¸‹çš„ Diff ç®—æ³•ï¼Œå…¶å®æ˜¯æ ‘çš„æ·±åº¦ä¼˜å…ˆéå†çš„è¿‡ç¨‹ã€‚è€Œæ ‘çš„æ·±åº¦ä¼˜å…ˆéå†ï¼Œæ€»æ˜¯å’Œé€’å½’è„±ä¸äº†å…³ç³»ã€‚</p>\n<p>é€’å½’å°±æ˜¯é™¤éç¢°åˆ°äº†ä»–çš„è¿”å›æ¡ä»¶ï¼Œå¦åˆ™ï¼Œå°†æ— çº¿çš„å¾ªç¯ä¸‹å»ã€‚è¿™ä¸ªé—®é¢˜æœ€è‡´å‘½çš„å°±æ˜¯ï¼Œæ— æ³•åœæ­¢ã€‚åŠ å…¥è¶³å¤Ÿå¤§ï¼Œå°†ä¼šå‡ºç°ã€Œé¡µé¢å¡æ­»ã€ã€‚</p>\n<h1 id=\"FIberçš„å‡ºç°\"><a href=\"#FIberçš„å‡ºç°\" class=\"headerlink\" title=\"FIberçš„å‡ºç°\"></a>FIberçš„å‡ºç°</h1><p>é¦–å…ˆFiberçš„ç¿»è¯‘æ˜¯ï¼šã€Œçº¤ç»´ã€ã€‚</p>\n<p>ç»´åŸºç™¾ç§‘ï¼šã€Œ<strong>çº¤ç»´</strong>ï¼ˆè‹±è¯­ï¼šfiberï¼‰æ˜¯æŒ‡ç”±è¿ç»­æˆ–ä¸è¿ç»­çš„ç»†ä¸ç»„æˆçš„ç‰©è´¨ã€‚ã€</p>\n<p>ç®€å•æ¥è¯´å°±æ˜¯éå¸¸çš„ç»†çš„ä¸œè¥¿ï¼Œä¹Ÿå°±æ˜¯å¯¹æ•´ä¸ªæ¸²æŸ“è¿‡ç¨‹è¿›è¡Œçº¤ç»´çº§åˆ«çš„æ§åˆ¶ã€‚</p>\n<h2 id=\"Fiberå¦‚ä½•è§£å†³é—®é¢˜\"><a href=\"#Fiberå¦‚ä½•è§£å†³é—®é¢˜\" class=\"headerlink\" title=\"Fiberå¦‚ä½•è§£å†³é—®é¢˜\"></a>Fiberå¦‚ä½•è§£å†³é—®é¢˜</h2><p>Fiberæ˜¯å¯¹æ•´ä¸ªReactçš„è°ƒåº¦ç®—æ³•çš„é‡å†™ï¼Œåˆæ˜¯ä¸€ä¸ªReactè‡ªåˆ›çš„æ•°æ®ç»“æ„ï¼Œé‡Œé¢ä¿å­˜äº†ä¸€ä¸ªè™šæ‹ŸDOMçš„èŠ‚ç‚¹ï¼Œä¹Ÿä¿å­˜äº†éœ€è¦æ›´æ–°çš„çŠ¶æ€ï¼Œä»¥åŠå‰¯ä½œç”¨ã€‚</p>\n<p>æˆ‘ä»¬çŸ¥é“ï¼Œç”¨æˆ·åœ¨ä½¿ç”¨çš„æ—¶å€™æœ€æ€•çš„æ˜¯ä»€ä¹ˆï¼Ÿæ²¡ååº”ï¼Œä¹Ÿå°±æ˜¯ã€Œé¡µé¢å¡æ­»ã€ã€‚è€Œæˆ‘ä»¬ç©æ¸¸æˆè§‰å¾—å¡æ˜¯å› ä¸ºä»–ä¸€ç§’é’Ÿçš„å¸§æ•°å°‘äº60å¸§ï¼Œæ‰€ä»¥æˆ‘ä»¬è§‰å¾—å¡ï¼Œè€Œæµè§ˆå™¨çš„é¡µé¢ä¹Ÿä¸€æ ·ã€‚Reactåªéœ€è¦ä¸€ç§’é’Ÿèƒ½å¤Ÿä¿è¯60å¸§çš„æµç•…å‡ºç°å°±å¯ä»¥äº†ï¼Œç”¨æˆ·å°±ä¸è§‰å¾—ã€Œé¡µé¢å¡æ­»ã€äº†ã€‚</p>\n<p>æ‰€ä»¥Fiberçš„ä»»åŠ¡è‚¯å®šæ˜¯ï¼Œåœ¨ä¿è¯è‡³å°‘60å¸§æ¯ç§’çš„æƒ…å†µä¸‹ï¼Œæ‰å»åšåˆ«çš„äº‹æƒ…ã€‚</p>\n<h2 id=\"Fiberæ¶æ„æ ¸å¿ƒï¼šâ€œå¯ä¸­æ–­â€â€œå¯æ¢å¤â€â€œä¼˜å…ˆçº§â€\"><a href=\"#Fiberæ¶æ„æ ¸å¿ƒï¼šâ€œå¯ä¸­æ–­â€â€œå¯æ¢å¤â€â€œä¼˜å…ˆçº§â€\" class=\"headerlink\" title=\"Fiberæ¶æ„æ ¸å¿ƒï¼šâ€œå¯ä¸­æ–­â€â€œå¯æ¢å¤â€â€œä¼˜å…ˆçº§â€\"></a>Fiberæ¶æ„æ ¸å¿ƒï¼šâ€œå¯ä¸­æ–­â€â€œå¯æ¢å¤â€â€œä¼˜å…ˆçº§â€</h2><p>Fiberæ‰€åšçš„è¿™ä¸€ç³»åˆ—æ“ä½œéƒ½æ˜¯ä¸ºäº†ç”¨æˆ·çš„ä¸æ»‘ä½“éªŒã€‚</p>\n<p>æƒ³è±¡ä¸€ä¸‹ï¼Œæ‰“æ–­ç°åœ¨éå¸¸å†—é•¿çš„è®¡ç®—ï¼Œé€šè¿‡ä¼˜å…ˆçº§çš„åˆ¤æ–­ï¼Œä¼˜å…ˆæ¸²æŸ“é¡µé¢æˆ–è€…åˆ«çš„ä»€ä¹ˆã€‚ç„¶åå†æ¢å¤å†—é•¿çš„è®¡ç®—ã€‚æ˜¯ä¸æ˜¯è„‘ä¸­åŸºæœ¬æœ‰ä¸€ä¸ªæ¨¡ç³Šçš„æ¦‚å¿µäº†ï¼Ÿ</p>\n<p>åœ¨è¿›ä¸€æ­¥ï¼ŒReactå…¶å®ä¸ºå¾ˆå¤šä»»åŠ¡è¿›è¡Œäº†åˆ‡ç‰‡ï¼Œè¿™äº›æ¯ä¸€ä¸ªç»†å°çš„ç‰‡ï¼Œæˆ‘ä»¬å¯ä»¥æˆä¸ºã€ŒFiberã€ã€‚åœ¨æ‰§è¡Œå®Œä¸€ä¸ªã€ŒFiberã€çš„æ—¶å€™ï¼Œä¼šæ£€æŸ¥é˜Ÿåˆ—ä¸­æœ€é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ã€‚å¦‚æœæœ‰æ¯”ç›®å‰çš„è¿™ä¸ªä¼˜å…ˆçº§é«˜çš„ï¼Œå…ˆæŠŠæ•°æ®å’ŒçŠ¶æ€ä¿å­˜åœ¨ã€ŒFiberã€èŠ‚ç‚¹ä¸Šï¼Œç„¶åè¿›è¡Œé‚£ä¸ªã€Œæ›´é«˜ä¼˜å…ˆçº§ä»»åŠ¡ã€ã€‚ä¹‹åå†æ£€æŸ¥ï¼Œå¦‚æœæ²¡æœ‰å°±æ¢å¤ä»»åŠ¡ã€‚</p>\n<p>åœ¨ render é˜¶æ®µï¼Œä¸€ä¸ªåºå¤§çš„æ›´æ–°ä»»åŠ¡è¢«åˆ†è§£ä¸ºäº†ä¸€ä¸ªä¸ªçš„å·¥ä½œå•å…ƒï¼Œè¿™äº›å·¥ä½œå•å…ƒæœ‰ç€ä¸åŒçš„ä¼˜å…ˆçº§ï¼ŒReact å¯ä»¥æ ¹æ®ä¼˜å…ˆçº§çš„é«˜ä½å»å®ç°å·¥ä½œå•å…ƒçš„æ‰“æ–­å’Œæ¢å¤ã€‚ç”±äº render é˜¶æ®µçš„æ“ä½œå¯¹ç”¨æˆ·æ¥è¯´å…¶å®æ˜¯â€œä¸å¯è§â€çš„ï¼Œæ‰€ä»¥å°±ç®—æ‰“æ–­å†é‡å¯ï¼Œå¯¹ç”¨æˆ·æ¥è¯´ä¹Ÿæ˜¯ 0 æ„ŸçŸ¥ã€‚ä½†æ˜¯ï¼Œå·¥ä½œå•å…ƒï¼ˆä¹Ÿå°±æ˜¯ä»»åŠ¡ï¼‰çš„é‡å¯å°†ä¼šä¼´éšç€å¯¹éƒ¨åˆ†ç”Ÿå‘½å‘¨æœŸçš„é‡å¤æ‰§è¡Œï¼Œè¿™äº›ç”Ÿå‘½å‘¨æœŸæ˜¯ï¼š</p>\n<ul>\n<li><p>componentWillMount</p>\n</li>\n<li><p>componentWillUpdate</p>\n</li>\n<li><p>shouldComponentUpdate</p>\n</li>\n<li><p>componentWillReceiveProps</p>\n</li>\n</ul>\n<p>å…¶ä¸­ shouldComponentUpdate çš„ä½œç”¨æ˜¯é€šè¿‡è¿”å› true æˆ–è€… falseï¼Œæ¥å¸®åŠ©æˆ‘ä»¬åˆ¤æ–­æ›´æ–°çš„å¿…è¦æ€§ï¼Œä¸€èˆ¬åœ¨è¿™ä¸ªå‡½æ•°ä¸­ä¸ä¼šè¿›è¡Œå‰¯ä½œç”¨æ“ä½œï¼Œå› æ­¤é£é™©ä¸å¤§ã€‚</p>\n<p>è€Œ â€œcomponentWillâ€ å¼€å¤´çš„ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œåˆ™å¸¸å¹´è¢«å¼€å‘è€…ä»¥å„ç§å„æ ·çš„å§¿åŠ¿æ»¥ç”¨ï¼Œæ˜¯å‰¯ä½œç”¨çš„â€œé‡ç¾åŒºâ€ã€‚</p>\n<h1 id=\"æ€è€ƒ\"><a href=\"#æ€è€ƒ\" class=\"headerlink\" title=\"æ€è€ƒ\"></a>æ€è€ƒ</h1><p>ä¹‹å‰çš„é—®é¢˜ï¼Œç°åœ¨æ˜¯å¦æœ‰çš„å·²ç»æœ‰ç­”æ¡ˆäº†ï¼Ÿæœ‰çš„è¿˜æ²¡æœ‰ï¼Ÿæ¬¢è¿è®¨è®º</p>\n<ol>\n<li>éƒ½è¯´<code>Fiber</code>æ˜¯æœ‰ä¼˜å…ˆçº§ï¼Œæœ‰æ‰“æ–­ä»»åŠ¡çš„æœºåˆ¶ï¼Œä½†æ˜¯<code>JavaScript</code>ä»–æ˜¯å•çº¿ç¨‹çš„ï¼Œåœ¨è®¡ç®—çš„æ—¶å€™å¦‚ä½•æ‰“æ–­å‘¢ï¼Ÿ</li>\n<li>æ•°æ®ç»“æ„ä¸ºä»€ä¹ˆé€‰æ‹©äº†é“¾è¡¨ä½œä¸ºæ•°æ®ç»“æ„ï¼Ÿåˆ«çš„ä¸å¯ä»¥å—ï¼Ÿæ¯”å¦‚ï¼Œæ•°ç»„ï¼Ÿ</li>\n<li>ä¸ºä»€ä¹ˆæœ‰çš„æ—¶å€™<code>render</code>ä¼šæ‰§è¡Œå¤šæ¬¡ï¼Ÿ</li>\n<li><code>Fiber</code>æ¶æ„ä¸€å®šæ˜¯å¼‚æ­¥çš„å—ï¼Ÿ</li>\n<li><code>Fiber</code>æ ‘å’Œè™šæ‹ŸDOMæ ‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</li>\n</ol>\n<h1 id=\"ç´¢å¼•\"><a href=\"#ç´¢å¼•\" class=\"headerlink\" title=\"ç´¢å¼•\"></a>ç´¢å¼•</h1><p><a href=\"https://zh-hans.reactjs.org/docs\" target=\"_blank\" rel=\"noopener\">https://zh-hans.reactjs.org/docs</a></p>\n"},{"title":"ã€é‡è¯†å‰ç«¯ã€‘reduxæºç é˜…è¯»","date":"2020-09-11T08:10:35.000Z","cover":"/image/cover/web.jpeg","_content":"\næœ€è¿‘åœ¨å†™ã€é‡æ‹¾å‰ç«¯ã€‘ç³»åˆ—ï¼Œä¸‹é¢æœ‰å‡ ä¸ªå¿«é€Ÿé€šé“ï¼Œå¤§å®¶è‡ªå–\n\n[ã€é‡è¯†å‰ç«¯ã€‘åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿](https://juejin.im/post/6850418113944420359)\n\n[ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—](https://juejin.im/post/6850418117508759566)\n\n[ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this](https://juejin.im/post/6854573215658803208)\n\n[ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šJavaScriptçš„æ‰§è¡Œæœºåˆ¶](https://juejin.im/post/6859911609633767438)\n\n[ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC](https://juejin.im/post/6860375101322461198)\n\n[ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ](https://juejin.im/post/6865204092877144077)\n\n[ã€é‡è¯†å‰ç«¯ã€‘æš´èµ°çš„å¼‚æ­¥ç¼–ç¨‹](https://juejin.im/post/6867814019055484942)\n\n[ã€é‡è¯†å‰ç«¯ã€‘reduxæºç é˜…è¯»](https://juejin.im/post/6877910314110140423/)\n\n# å‰è¨€\n\nä¹‹å‰ä¸€ç›´åœ¨ä½¿ç”¨reduxï¼Œåæ¥å‡ºäº†hooksï¼Œç”¨çš„æ¯”è¾ƒå°‘äº†ï¼Œä½†æ˜¯è¿˜æ˜¯ä¼šä½¿ç”¨ï¼Œä»–ä»¬ä¸å†²çªï¼Œå„è‡ªå¯¹åº”çš„åœºæ™¯ä¸åŒã€‚å¬è¯´reduxæºç æ¯”è¾ƒå°‘ï¼Œä¹Ÿæ¯”è¾ƒå¥½æ‡‚ï¼ˆä¸æ˜¯è´¬ä½ï¼Œè¶Šå¼ºçš„ä»£ç å…¶å®è¶Šç®€æ´æ˜äº†ï¼‰\n\næ‰€ä»¥å‡†å¤‡é˜…è¯»ä¸€ä¸‹ï¼Œä¹Ÿç®—æ˜¯é‡è¯†å‰ç«¯ç³»åˆ—çš„ä¸€å‘˜å§ã€‚\n\næ³¨æ„ä¸€ä¸‹ï¼Œå…¶å®æˆ‘ä»¬å†™reactçš„æ—¶å€™ç”¨åˆ°çš„å…¶å®æ˜¯redux-reactã€‚åé¢ä¹Ÿä¼šä¸€èµ·ä»‹ç»ã€‚\n\næ›´å¥½çš„é˜…è¯»ä½“éªŒå…¶å®æ˜¯åœ¨é¡¹ç›®é‡Œé¢æ‰“æ–­ç‚¹ï¼Œè¿™é‡Œæ˜¯æˆ‘çš„[GitHubåœ°å€](https://github.com/DerrickTel/redux-source-analyse)ï¼Œå–œæ¬¢çš„åŒå­¦å¯ä»¥forkæˆ–è€…starä¸€ä¸‹å“¦ã€‚é‡Œé¢æˆ‘æŠŠæºç éƒ½æ‹‰å‡ºæ¥æ”¾åˆ°æ–‡ä»¶å¤¹é‡Œé¢ç„¶åç”±create-react-appæ¥è°ƒç”¨ï¼Œè€Œä¸æ˜¯ç›´æ¥ç”¨npmè£…ã€‚è¿™æœ‰åŠ©äºç†è§£ä¸è°ƒè¯•ï¼Œé‡Œé¢ä¹Ÿæœ‰æˆ‘çš„æ³¨é‡Šï¼Œå…¶å®å¯ä»¥ç›´æ¥é˜…è¯»æºç çš„æ³¨é‡Šä¼šæ›´å¿«ã€‚\n\nreduxå’Œrdux-reactçš„ä»£ç ä¹Ÿæ˜¯ç›®å‰æœ€æ–°ï¼ˆ2020-09-13ï¼‰çš„masteråˆ†æ”¯ä¸Šé¢çš„ã€‚\n\n# å¼€å§‹\n\nreduxæ˜¯ç”¨çš„rollupæ‰“åŒ…çš„ã€‚\n\næ‰“å¼€æ ¹ç›®å½•ä¸‹é¢çš„`rollup.config.js`å¯ä»¥çœ‹åˆ°å…¥å£æ˜¯srcç›®å½•ä¸‹çš„indexæ–‡ä»¶ã€‚\n\nå¯ä»¥çœ‹åˆ°ä»–å¯¼å‡ºçš„ä¸€äº›ä¸œè¥¿\n\n```js\nexport {\n  createStore,\n  combineReducers,\n  bindActionCreators,\n  applyMiddleware,\n  compose,\n  __DO_NOT_USE__ActionTypes\n}\n```\n\næˆ‘ä»¬ä¸€ä¸ªä¸ªå¼€å§‹ã€‚é¦–å…ˆæ˜ å…¥çœ¼å¸˜çš„æ˜¯createStore\n\n## createStore\n\nå¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹æ˜¯æ€ä¹ˆç”¨ã€‚ä»¥ä¸‹é‡‡ç”¨[æˆ‘çš„æºç ](https://github.com/DerrickTel/redux-source-analyse)é˜…è¯»é‡Œé¢çš„ä»£ç ï¼š\n\n```js\n// middleware\nconst logger = (store:any) => (next:any) => (action:any) => {\n  // debugger\n  console.info('dispatching', action)\n  let result = next(action);\n  console.log('next state', store.getState())\n  return result\n}\n\nlet store = createStore(rootReducer, applyMiddleware(logger));\n```\n\nå†çœ‹çœ‹æºç çš„createStoreã€‚\n\n### å‚æ•°\n\n```js\nexport default function createStore<\n  S,\n  A extends Action,\n  Ext = {},\n  StateExt = never\n>(\n  reducer: Reducer<S, A>,\n  preloadedState?: PreloadedState<S> | StoreEnhancer<Ext, StateExt>,\n  enhancer?: StoreEnhancer<Ext, StateExt>\n): Store<ExtendState<S, StateExt>, A, StateExt, Ext> & Ext {\n  //.. ä¸€äº›æ ¡éªŒçš„æºç å°±ä¸ä»‹ç»äº†ï¼Œæƒ³äº†è§£çš„å¯ä»¥çœ‹æˆ‘çš„GitHubï¼Œä¸Šé¢æœ‰æ³¨é‡Š\n  let currentReducer = reducer // ä¸´æ—¶å­˜æ”¾ reducer çš„åœ°æ–¹\n  let currentState = preloadedState as S // ä¸´æ—¶å­˜æ”¾ state çš„åœ°æ–¹\n  let currentListeners: (() => void)[] | null = [] // ç›‘å¬é˜Ÿåˆ—\n  let nextListeners = currentListeners // å¼•ç”¨èµ‹å€¼, å’Œæ­£å¼çš„é˜Ÿåˆ—è¿›è¡ŒåŒºåˆ†, åˆ«æœ‰ä»–ç”¨\n  let isDispatching = false // æ˜¯ä¸æ˜¯æ­£åœ¨dispatch\n  // ... \n}\n```\n\ncreateStoreæ¥æ”¶3ä¸ªå‚æ•°`reducer`ï¼Œ`preloadedState`ï¼Œ`enhancer`ã€‚\n\næˆ‘ä»¬ä¸€ä¸€å‰–æä»–ä»¬åˆ†åˆ«æ˜¯åšä»€ä¹ˆçš„ã€‚\n\n#### reducer\n\nè¿™ä¸ªå¤§å®¶å¤ªç†Ÿæ‚‰äº†ã€‚å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åæˆ‘ä»¬åœ¨é‡Œé¢å†™`switch`ï¼Œ`switch` `dispatch`è¿‡æ¥ `action`çš„`type`ã€‚ç„¶ååšå¯¹åº”çš„æ“ä½œã€‚æœ€åè¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯å…¨æ–°çš„`store`çš„æ•°æ®ã€‚ä¸ºä»€ä¹ˆæ˜¯è¿”å›ä¸€ä¸ªå…¨æ–°çš„`store`ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢jsçš„å¼•ç”¨ã€‚\n\nå¿˜è®°çš„ï¼Œæˆ–è€…ä¸å¤ªæ‡‚çš„åŒå­¦å¯ä»¥çœ‹ä¸€ä¸‹ä¸‹é¢çš„demoï¼š\n\n```js\nconst initState = {\n  todos: []\n}\n\n// è¿™é‡Œé¢æˆ‘ä»¬ä¸€èˆ¬ä¼šèµ‹å€¼ä¸Šé»˜è®¤çš„stateï¼Œå› ä¸ºåç»­å¯èƒ½ä¼šç”¨åˆ°é»˜è®¤çš„æƒ…å†µï¼Œåƒæ•°ç»„ä¹‹ç±»çš„å°±éå¸¸å¸¸è§ã€‚\nconst todos = (state = initState, action) => {\n  switch (action.type) {\n    case 'ADD_TODO':\n      return {\n        ...state\n      }\n    case 'TOGGLE_TODO':\n      return state.map(\n        todo =>\n          todo.id === action.id ? { ...todo, completed: !todo.completed } : todo\n      )\n    default: {\n      return state\n    }\n      \n  }\n}\n\nexport default todos\n```\n\n\n\n#### preloadedState\n\nè¿™ä¸ªå…¶å®æˆ‘ä»¬ç”¨çš„ä¸æ˜¯å¾ˆå¤šï¼Œå› ä¸ºæˆ‘ä»¬ä¸€èˆ¬é¢„å­˜çš„éƒ½ç›´æ¥å¸è½½`reducer`é‡Œé¢äº†ã€‚åƒğŸ‘†ğŸŒ°é‡Œé¢çš„`state = initState`å°±çœå»äº†æˆ‘ä»¬çš„ä¼ é€’è¿™ä¸ªå‚æ•°çš„è¿‡ç¨‹ã€‚è€Œä¸”æ•°æ®æ”¾åœ¨`reducer`é‡Œé¢ä¹Ÿæ›´åŠ æ¸…æ™°ã€‚\n\nå“ªæ€•æ˜¯åœ¨[é˜®ä¸€å³°è€å¸ˆçš„æ—¥å¿—](http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_one_basic_usages.html)é‡Œé¢ä¹Ÿæ˜¯è¿™æ ·æ•™çš„ã€‚\n\n```js\nconst defaultState = 0;\nconst reducer = (state = defaultState, action) => {\n  switch (action.type) {\n    case 'ADD':\n      return state + action.payload;\n    default: \n      return state;\n  }\n};\n\nconst state = reducer(1, {\n  type: 'ADD',\n  payload: 2\n});\n```\n\nä¸­æ–‡ç¿»è¯‘å°±æ˜¯ï¼šé¢„å­˜çš„`state`ã€‚ä¹Ÿå¯ä»¥ç†è§£ä¸ºåˆå§‹çš„ï¼Œé»˜è®¤çš„ã€‚å› ä¸ºæˆ‘ä»¬ä¸€èˆ¬åœ¨ä¹Ÿé¡µé¢é‡Œé¢ç›´æ¥æ‹¿`store`é‡Œé¢çš„å€¼ï¼Œæˆ–è€…`map`æˆ–è€…ä»€ä¹ˆã€‚å¾ˆæœ‰å¯èƒ½å°±ä¼šæŠ¥é”™ï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰é»˜è®¤å€¼æˆ‘ä»¬ç›´æ¥ç”¨`map`å°±ä¼šæŠ¥é”™....ç›¸ä¿¡åˆšåˆšå¼€å§‹ç”¨çš„å°ä¼™ä¼´åº”è¯¥æœ‰è¿™æ ·çš„å›°æƒ‘ã€‚\n\nä½†æ˜¯ï¼Œæˆ‘ä»¬é€šå¸¸éƒ½æ˜¯ä¼ ä¸¤ä¸ªå‚æ•°ï¼Œé‚£å’‹åŠï¼Ÿæˆ‘çœ‹ä»–å¥½åƒæ˜¯é¡ºåºè¯»å–çš„è¯¶...\n\nreduxå…¼å®¹æˆ‘ä»¬å•¦ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‰é¢æœ‰ä¸€æ®µä»£ç æ˜¯ä¸ºäº†åšè¿™ä¸ªçš„\n\n```js\n// preloadedStateä¸ºfunction enhancerä¸ºundefinedçš„æ—¶å€™è¯´æ˜initStateæ²¡æœ‰åˆå§‹åŒ–, ä½†æ˜¯æœ‰middleware\nif (typeof preloadedState === 'function' && typeof enhancer === 'undefined') {\n  enhancer = preloadedState // æŠŠ preloadedState èµ‹å€¼ç»™ enhancer\n  preloadedState = undefined // preloadedStateèµ‹å€¼undeifined\n}\n```\n\n\n\n#### enhancer\n\nä¸­æ–‡ç¿»è¯‘æ˜¯ï¼šå¢å¼ºã€‚å…¶å®å°±æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ä¸­é—´ä»¶ï¼Œç”¨äºå¢å¼ºæˆ‘ä»¬çš„`redux`ã€‚å¸¸è§æœ‰çš„æœ‰`log`ï¼Œ`redux-thunk`ï¼Œ`redux-saga`ç­‰ç­‰ã€‚\n\næˆ‘ä»¬å‘ç°ä»£ç é‡Œé¢æœ‰ä¸€æ®µæ˜¯è¿™æ ·çš„ï¼š\n\n```js\n// debugger\n// å¦‚æœå‚æ•°enhancerå­˜åœ¨\n  if (typeof enhancer !== 'undefined') {\n    // å¦‚æœenhancerå­˜åœ¨ï¼Œé‚£ä»–å¿…é¡»æ˜¯ä¸ªfunction, å¦åˆ™throw Errorå“ˆ\n    if (typeof enhancer !== 'function') {\n      throw new Error('Expected the enhancer to be a function.')\n    }\n    /**\n     * ä¼ å…¥ç¬¦åˆå‚æ•°ç±»å‹çš„å‚æ•°ï¼Œå°±å¯ä»¥æ‰§è¡Œ enhancer,\n     * ä½†æ˜¯è¿™ä¸ªreturnæ·±æ·±çš„å¸å¼•äº†æˆ‘, å› ä¸ºè¯´æ˜æœ‰applyMiddlewareçš„æ—¶å€™åé¢çš„éƒ½ä¸ç”¨çœ‹äº† ??? å½“ç„¶\u001dä¸å¯èƒ½\n     * å¯æ˜¯applyMiddlewareå…¶å®æ˜¯å¿…ç”¨é¡¹ï¼Œæ‰€ä»¥çŒœæƒ³ä¸€ä¸‹applyMiddlewareå¼ºåŒ–storeä¹‹åä¼šenhancerèµ‹å€¼undefinedï¼Œå†æ¬¡è°ƒç”¨createStore\n     * ä¸Šä¸‹æ‰“ä¸ªdebuggerçœ‹ä¸€ä¸‹æ‰§è¡Œé¡ºåº(debuggerä½ç½®ä»¥æ³¨é‡Š)ï¼Œæœç„¶ä¸å‡ºæ‰€æ–™\n     * å¥½äº†ï¼Œ å‡è®¾æˆ‘ä»¬è¿˜ä¸çŸ¥é“applyMiddleware()è¿™ä¸ªfuncrionå…·ä½“å¹²äº†ä»€ä¹ˆï¼Œ\n     * åªçŸ¥é“ä»–åšäº†ä¸€äº›å¤„ç†ç„¶åé‡æ–°è°ƒç”¨äº†createStoreå¹¶ä¸”enhancerå‚æ•°ä¸ºundefined\n     * å…ˆè®°ä¸‹ï¼Œåç»­åœ¨çœ‹applyMiddlewareï¼Œ å› ä¸ºæˆ‘ä»¬ç°åœ¨è¦çœ‹çš„æ˜¯createStore\n     * * */\n    // debugger\n    return enhancer(createStore)(reducer, preloadedState)\n  }\n```\n\nè¿™ä¸ªé‡ç‚¹å…¶å®åœ¨äº`applyMiddleware`ï¼Œåç»­æˆ‘ä»¬ä¼šä»‹ç»åˆ°çš„ã€‚\n\n### å†…ç½®å˜é‡\n\nè¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œæˆ‘å°±éƒ½å†™åœ¨æ³¨é‡Šé‡Œé¢äº†\n\n```js\nlet currentReducer = reducer // ä¸´æ—¶å­˜æ”¾ reducer çš„åœ°æ–¹\nlet currentState = preloadedState as S // ä¸´æ—¶å­˜æ”¾ state çš„åœ°æ–¹\nlet currentListeners: (() => void)[] | null = [] // ç›‘å¬é˜Ÿåˆ—\nlet nextListeners = currentListeners // å¼•ç”¨èµ‹å€¼, å’Œæ­£å¼çš„é˜Ÿåˆ—è¿›è¡ŒåŒºåˆ†, åˆ«æœ‰ä»–ç”¨\nlet isDispatching = false // æ˜¯ä¸æ˜¯æ­£åœ¨dispatch\n```\n\n\n\n### å†…ç½®æ–¹æ³•\n\n#### ensureCanMutateNextListeners\n\nè¿™é‡Œå…¶å®æ˜¯ä¸ºäº†å¼„ä¸¤ä¸ªæ•°ç»„ï¼Œä¸€ä¸ªæ“ä½œä¸€ä¸ªåŸæ•°ç»„è€ŒæŠ½è±¡çš„ä¸€ä¸ªæ–¹æ³•ã€‚\n\næœ‰ä¸€ä¸ªå°çš„çŸ¥è¯†ç‚¹ï¼Œ`===`å¯¹äºæ•°ç»„çš„åˆ¤æ–­åªèƒ½ç”¨äºåˆ¤æ–­æ˜¯å¦æ˜¯åŒä¸€ä¸ªå†…å­˜åœ°å€ï¼Œä¸ä¿¡çš„è¯å¤§å®¶å¯ä»¥è¯•è¯•ã€‚\n\n```js\nconst a = [1, 2];\nconst b = [1, 2];\nconst c = a;\nconsole.log(a === b);\nconsole.log(a === c);\nconsole.log(b === c);\n```\n\n\n\næ‰€ä»¥ä¸‹é¢çš„æ“ä½œçš„å°±å˜å¾—å¾ˆå¥½ç†è§£äº†ã€‚åœ¨æˆ‘ä»¬æ“ä½œ`listener`ä¹‹å‰ä¼šå…ˆå­˜å‚¨ä¸€ä¸‹å¿«ç…§ã€‚å¤§å®¶è¦å¤šç†è§£ä¸€ä¸‹ï¼Œå› ä¸ºåé¢å¾ˆå¤šåœ°æ–¹ä¼šç”¨åˆ°è¿™ä¸ªå‡½æ•°ã€‚\n\n```js\n// Googleç¿»è¯‘: ç¡®ä¿å¯ä»¥ä½¿ä¸‹ä¸€ä¸ªä¾¦å¬å™¨çªå˜\n  // æˆ‘çš„ç†è§£æ˜¯å­˜å‚¨ä¸€ä¸‹å¿«ç…§, ä»¥ä¸ºæ¥ä¸‹æ¥å¯èƒ½ä¼šè¿›è¡Œæ“ä½œ.\n  function ensureCanMutateNextListeners() {\n    // æ˜¯å¦ç›¸åŒ, æ˜¯ä¸æ˜¯ç®€å•çš„å¼•ç”¨èµ‹å€¼, æ˜¯çš„è¯å°±æµ…æ‹·è´ä¸€ä»½\n    if (nextListeners === currentListeners) {\n      nextListeners = currentListeners.slice()\n    }\n  }\n```\n\n\n\n#### getState\n\nè¿™ä¸ªå‡½æ•°å¾ˆç®€å•ï¼Œé¦–å…ˆåˆ¤æ–­ä¸€ä¸‹æ˜¯å¦æ˜¯åœ¨dispatchï¼Œç„¶åè¿”å›å½“å‰çš„stateã€‚\n\n```js\n// è·å–å½“å‰çš„state\n  function getState(): S {\n    // å¦‚æœæ­£åœ¨dispatch å°±æŠ¥é”™,å› ä¸ºè¦è·å–æœ€æ–°çš„state, dispatchå¾ˆæœ‰å¯èƒ½ä¼šæ”¹å˜state\n    if (isDispatching) {\n      throw new Error(\n        'You may not call store.getState() while the reducer is executing. ' +\n          'The reducer has already received the state as an argument. ' +\n          'Pass it down from the top reducer instead of reading it from the store.'\n      )\n    }\n\n    return currentState as S\n  }\n```\n\næœ‰æ²¡æœ‰æ„Ÿè§‰reduxå¥½åƒä¹Ÿä¸è¿‡å¦‚æ­¤~~æ¥ç€çœ‹å“¦ã€‚\n\n#### subscribe\n\nä¸­æ–‡ç¿»è¯‘ï¼šè®¢é˜…è€…ã€‚\n\nå…¶å®ä¹Ÿå¾ˆå¥½ç†è§£ã€‚å¯èƒ½æœ‰ç”¨è¿‡`redux`çš„åŒå­¦éƒ½æœ‰ç”¨è¿‡è¿™ä¸ªã€‚\n\næˆ‘ä¸¾ä¸€ä¸ªæ€ä¹ˆç”¨çš„ğŸŒ°ï¼š\n\n```js\nconst unSubscribe = store.subscribe(() => {\n  console.log('store.subscribe', store.getState())\n})\n// å–æ¶ˆè®¢é˜…å°±ç›´æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°å°±å¥½äº†\n// unSubscribe();\n```\n\nä¸€æ—¦è§¦å‘äº†`dispatch`å°±ä¼šè§¦å‘è¿™ä¸ªå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å†™ä¸Šå»çš„`console.log()`\n\nç„¶åæˆ‘ä»¬å†æ¥çœ‹è¿™ä¸ªå‡½æ•°ã€‚\n\n```js\nfunction subscribe(listener: () => void) {\n    // listenerå¿…é¡»ä¸ºå‡½æ•°ï¼Œå› ä¸ºè¦ä»¥å›è°ƒå‡½æ•°çš„æ–¹å¼æ¥è§¦å‘ã€‚\n    if (typeof listener !== 'function') {\n      throw new Error('Expected the listener to be a function.')\n    }\n\n    // å¦‚æœæ­£åœ¨dispatchä¸­åˆ™æŠ›é”™ï¼Œå’ŒgetStateåŒç†\n    if (isDispatching) {\n      throw new Error(\n        'You may not call store.subscribe() while the reducer is executing. ' +\n          'If you would like to be notified after the store has been updated, subscribe from a ' +\n          'component and invoke store.getState() in the callback to access the latest state. ' +\n          'See https://redux.js.org/api/store#subscribelistener for more details.'\n      )\n    }\n\n    // æ˜¯å¦æœ‰ç›‘å¬è€…,æˆ–è€…æ˜¯å¦è¢«è®¢é˜…\n    let isSubscribed = true\n\n    // ä¿å­˜å¿«ç…§, æ‹·è´ä¸€ä»½ç›‘å¬é˜Ÿåˆ—åˆ°nextListeners(å¦‚æœæ˜¯å¼•ç”¨çš„è¯)\n    ensureCanMutateNextListeners()\n    // å¾€ç›‘å¬é˜Ÿåˆ—é‡Œé¢æ¨å…¥ä¸€ä¸ªç›‘å¬è€…\n    nextListeners.push(listener)\n\n    // è¿”å›ä¸€ä¸ªå–æ¶ˆè®¢é˜…çš„æ–¹æ³•\n    return function unsubscribe() {\n      // å¦‚æœæ²¡æœ‰è¢«è®¢é˜…, ç›´æ¥shut down\n      if (!isSubscribed) {\n        return\n      }\n\n      // å¦‚æœæ­£åœ¨dispatch æŠ¥é”™ï¼Œå’Œä¸Šé¢ğŸ‘†åŒç†\n      if (isDispatching) {\n        throw new Error(\n          'You may not unsubscribe from a store listener while the reducer is executing. ' +\n            'See https://redux.js.org/api/store#subscribelistener for more details.'\n        )\n      }\n\n      // å–æ¶ˆè®¢é˜…\n      isSubscribed = false\n\n      // ä¾æ—§æ˜¯æ‹¿ä¸‹å½“å‰çš„ç›‘å¬é˜Ÿåˆ—ï¼Œä¸ç„¶ç­‰ä¸€ä¸‹åˆ é™¤çš„æ—¶å€™ï¼Œä¼šåˆ æ‰æ‰€æœ‰çš„é˜Ÿåˆ—ã€‚å…¶å®æˆ‘ä»¬åªéœ€è¦åˆ æ‰ç›‘å¬è€…å°±å¥½äº†\n      ensureCanMutateNextListeners()\n      // æ‰¾åˆ°ç›‘å¬è€…\n      const index = nextListeners.indexOf(listener)\n      // åˆ é™¤è¿™ä¸ªç›‘å¬è€…\n      nextListeners.splice(index, 1)\n      // æ¸…ç©ºå½“å‰çš„ç›‘å¬é˜Ÿåˆ—\n      currentListeners = null\n    }\n  }\n```\n\n\n\n#### dispatch\n\nè¿™ä¸ªå‡½æ•°å¯ä»¥è¯´æ˜¯å²ä¸Šæœ€TMå¸¸ç”¨çš„å‡½æ•°çš„ï¼Œæœ€TMé‡è¦ä¹‹é‡ä¸­ä¹‹é‡ï¼Œè€Œä¸”è¿˜æ˜¯æ›´æ–°storeçš„å”¯ä¸€æ–¹æ³•ï¼Œæ³¨æ„è¿™ä¸ªå”¯ä¸€ã€‚ä½†æ˜¯åˆéå¸¸å¥½ç†è§£ã€‚\n\næˆ‘ä»¬è¿˜æ˜¯å…ˆçœ‹ä¸€ä¸ªğŸŒ°å§ï¼š\n\n```js\nprops.dispatch({\n  type: 'TEST',\n  test1: 1,\n  test2: 2,\n  // ...\n})\n```\n\nç„¶åï¼Œæˆ‘ä»¬çš„storeå°±æ”¹å˜äº†ï¼Œå°±ä¼šæ›´æ–°propsï¼Œæ¥è§¦å‘renderï¼Œè§†å›¾å¯èƒ½å°±ä¼šæ›´æ–°ä¹‹ç±»çš„ã€‚\n\nğŸ‘Œï¼Œç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªä¸€ç‚¹ç‚¹äº†è§£ï¼Œæ¥çœ‹ä¸€ä¸‹æºç ã€‚\n\n```js\n// ä¿®æ”¹storeçš„å”¯ä¸€æ–¹æ³•\n  function dispatch(action: A) {\n    // actionå¿…é¡»æ˜¯ä¸€ä¸ªå¯¹è±¡\n    if (!isPlainObject(action)) {\n      throw new Error(\n        'Actions must be plain objects. ' +\n          'Use custom middleware for async actions.'\n      )\n    }\n\n    // actionå¿…é¡»æ‹¥æœ‰ä¸€ä¸ªtype\n    if (typeof action.type === 'undefined') {\n      throw new Error(\n        'Actions may not have an undefined \"type\" property. ' +\n          'Have you misspelled a constant?'\n      )\n    }\n\n    // å¦‚æœæ­£åœ¨dispatchingï¼Œé‚£ä¹ˆä¸æ‰§è¡Œdispatchæ“ä½œã€‚\n    if (isDispatching) {\n      throw new Error('Reducers may not dispatch actions.')\n    }\n\n    // è®¾ç½®dispatchingçŠ¶æ€ä¸ºtrueï¼Œå¹¶ä½¿ç”¨reducerç”Ÿæˆæ–°çš„çŠ¶æ€æ ‘ã€‚\n    try {\n      isDispatching = true\n      currentState = currentReducer(currentState, action)\n    } finally {\n      // å½“è·å–æ–°çš„çŠ¶æ€æ ‘å®Œæˆåï¼Œè®¾ç½®çŠ¶æ€ä¸ºfalse.\n      isDispatching = false\n    }\n\n    // å°†ç›®å‰æœ€æ–°çš„ç›‘å¬æ–¹æ³•æ”¾ç½®åˆ°å³å°†æ‰§è¡Œçš„é˜Ÿåˆ—ä¸­éå†å¹¶ä¸”æ‰§è¡Œ\n    const listeners = (currentListeners = nextListeners)\n    for (let i = 0; i < listeners.length; i++) {\n      const listener = listeners[i]\n      listener()\n    }\n\n    // å°†è§¦å‘çš„actionè¿”å›\n    return action\n  }\n```\n\nå…¶å®çœ‹ä¸‹æ¥ï¼Œæˆ‘ä»¬å‘ç°ä»–å°±æ˜¯ç®€å•çš„å°†æˆ‘ä»¬çš„å‚æ•°è½¬å‘ç»™äº†`reducer`ï¼Œç„¶åæ‰§è¡Œäº†æˆ‘ä»¬ä¹‹å‰å»ºç«‹çš„ç›‘å¬é˜Ÿåˆ—ã€‚\n\næœ‰æ²¡æœ‰åŒå­¦ä¼šå’Œæˆ‘æƒ³çš„ä¸€æ ·ï¼Œé‚£ä¸ºä»€ä¹ˆä¸ç›´æ¥æ‰§è¡Œ`reducer`ï¼Ÿå› ä¸ºæˆ‘ä»¬é‡Œé¢æœ‰è®¢é˜…å‡½æ•°éœ€è¦æ‰§è¡Œï¼Œå¯¹å§ï¼Œè€Œä¸”è¿˜æœ‰`dispatch`çš„çŠ¶æ€éœ€è¦é€šçŸ¥`store`ï¼Œä¸ç„¶`getState`ä¹‹ç±»çš„ï¼Œæˆ‘ä»¬ä¹‹å‰æœ‰çœ‹åˆ°åˆ¤æ–­`dispatch`çŠ¶æ€çš„å¾ˆå¯èƒ½å‡ºç°åå·®ã€‚\n\næˆ‘ä»¬åªéœ€è¦`connect`ä¸€ä¸‹å°±å¯ä»¥ç›´æ¥åœ¨`props`é‡Œé¢æ‹¿åˆ°`dispatch`ï¼Œä¸éœ€è¦`import`ä¹‹ç±»çš„ï¼Œå¾ˆç®€æ´ã€‚\n\n#### replaceReducer\n\nè¿™ä¸ªå‡½æ•°é¡¾åæ€ä¹‰ï¼Œä¹Ÿå¾ˆå¥½ç†è§£ï¼Œæˆ‘å°±ä¸å¤šåšè§£é‡Šäº†ï¼Œç›´æ¥çœ‹æ³¨é‡Šå§ã€‚\n\n```js\n// è¿™ä¸ªå…¶å®å¾ˆå°‘ç”¨åˆ°, å®˜æ–¹çš„ä»‹ç»æ˜¯ä¸»è¦æ˜¯ç”¨äºåŠ¨æ€æ›¿æ¢reducerçš„æ—¶å€™ä¼šç”¨åˆ°\n  function replaceReducer<NewState, NewActions extends A>(\n    nextReducer: Reducer<NewState, NewActions>\n  ): Store<ExtendState<NewState, StateExt>, NewActions, StateExt, Ext> & Ext {\n    if (typeof nextReducer !== 'function') {\n      throw new Error('Expected the nextReducer to be a function.')\n    }\n\n    // ä¿®æ”¹reducer\n    // å½“å‰çš„currentReduceræ›´æ–°ä¸ºå‚æ•°nextReducer\n    // TODO: do this more elegantly\n    ;((currentReducer as unknown) as Reducer<\n      NewState,\n      NewActions\n    >) = nextReducer\n\n    // This action has a similar effect to ActionTypes.INIT.\n    // Any reducers that existed in both the new and old rootReducer\n    // will receive the previous state. This effectively populates\n    // the new state tree with any relevant data from the old one.\n    // å’ŒINITçš„dispatchç›¸åŒï¼Œå‘é€ä¸€ä¸ªdispatchåˆå§‹åŒ–stateï¼Œè¡¨æ˜ä¸€ä¸‹æ˜¯REPLACE\n    // è‡ªå·±ğŸ‘€çœ‹ä¸€ä¸‹utilsæ–¹æ³•çš„ActionTypesï¼Œ éšæ€§çš„éšæœºæ•°\n    dispatch({ type: ActionTypes.REPLACE } as A)\n    // change the type of the store by casting it to the new store\n    return (store as unknown) as Store<\n      ExtendState<NewState, StateExt>,\n      NewActions,\n      StateExt,\n      Ext\n    > &\n      Ext\n  }\n```\n\nå‘ç°ä¸¤ä¸ªå¾ˆæœ‰è¶£çš„ç‚¹ï¼š\n\n1. å¤§ä½¬ä»¬ä¹Ÿä¼šå†™`todo`ï¼Œå…³é”®æ˜¯ï¼ä»–ä»¬çš„`TODO`å¹´å¤´æœ‰ç‚¹ä¹…äº†ï¼Œå“ˆå“ˆå“ˆå“ˆï¼Œ5å¹´äº†ï¼Œçœ‹æ ·å­ä¸æ˜¯åªæœ‰æˆ‘ä¸ä¼šç»§ç»­ä¼˜åŒ–çš„ï¼Œå“ˆå“ˆå“ˆå“ˆã€‚ä¹Ÿæœ‰å¯èƒ½æ˜¯æ²¡æœ‰æƒ³åˆ°æ›´å¥½çš„æ–¹æ³•ã€‚ã€‚ã€‚\n2. é‡Œé¢ä»–è‡ªå·±`dispatch`äº†ä¸€ä¸ªï¼Œ`ActionTypes.REPLACE`ã€‚\n\nokï¼Œæˆ‘ä»¬ä¸€æ¢ç©¶ç«Ÿï¼Œè¿™ä¸ª`ActionTypes.REPLACE`\n\næ‰’å¼€è¡£æœï¼ç›´æ¥å¼€çœ‹ğŸ‘€ï¼\n\n```js\n/**\n * These are private action types reserved by Redux.\n * For any unknown actions, you must return the current state.\n * If the current state is undefined, you must return the initial state.\n * Do not reference these action types directly in your code.\n */\n\nconst randomString = () =>\n  Math.random().toString(36).substring(7).split('').join('.')\n\nconst ActionTypes = {\n  INIT: `@@redux/INIT${/* #__PURE__ */ randomString()}`,\n  REPLACE: `@@redux/REPLACE${/* #__PURE__ */ randomString()}`,\n  PROBE_UNKNOWN_ACTION: () => `@@redux/PROBE_UNKNOWN_ACTION${randomString()}`\n}\n\nexport default ActionTypes\n\n```\n\nå…¶å®å°±æ˜¯ä¸€ä¸ªä¸æƒ³å’Œæˆ‘ä»¬çš„`type`å†²çªçš„éšæœºæ•°ï¼Œå‘Šè¯‰`redux`ï¼Œè¿™ä¸ªæ˜¯ä»–ä»¬å†…éƒ¨çš„ä¸€ä¸ª`dispatch`è€Œå·²ã€‚\n\n#### observable\n\nè¿™ä¸ªç©æ„ï¼Œå…¶å®æˆ‘æ˜¯ä¸å¤ªæ‡‚ä»–æ˜¯å¹²ä»€ä¹ˆçš„ã€‚ã€‚ã€‚å…¨å±€æœä¹Ÿæ²¡æœ‰æœå‡ºæ¥ï¼Œè€Œä¸”æˆ‘ä¹Ÿæ²¡ç”¨è¿‡ã€‚ã€‚ã€‚\n\nå¤§å®¶çœ‹æ³¨é‡Šå§ï¼Œä¸è¿‡å¤šè§£é‡Šï¼Œå¦‚æœæœ‰æ‡‚å“¥ï¼Œæ¬¢è¿ä¸€èµ·äº¤æµè®¨è®ºå‘€ã€‚\n\n```js\n// æŸ¥è¯¢ä¹‹å,ä¹Ÿæ²¡å‘ç°æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ç”¨å¤„...æš‚æ—¶è·³è¿‡,å¦‚æœæœ‰å¸…å“¥çœ‹åˆ°çš„è¯å¯ä»¥ä¸åèµæ•™\n  function observable() {\n    const outerSubscribe = subscribe\n    return {\n      /**\n       The minimal observable subscription method.\n       @param observer Any object that can be used as an observer.\n       The observer object should have a `next` method.\n       @returns An object with an `unsubscribe` method that can\n       be used to unsubscribe the observable from the store, and prevent further\n       emission of values from the observable.\n       */\n      subscribe(observer: unknown) {\n        if (typeof observer !== 'object' || observer === null) {\n          throw new TypeError('Expected the observer to be an object.')\n        }\n\n        //è·å–è§‚å¯Ÿç€çš„çŠ¶æ€\n        function observeState() {\n          const observerAsObserver = observer as Observer<S>\n          if (observerAsObserver.next) {\n            observerAsObserver.next(getState())\n          }\n        }\n\n        observeState()\n        //è¿”å›å–æ¶ˆè®¢é˜…çš„æ–¹æ³•\n        const unsubscribe = outerSubscribe(observeState)\n        return { unsubscribe }\n      },\n\n      [$$observable]() {\n        return this\n      }\n    }\n  }\n```\n\n\n\nå…¶å®ä»–å†…éƒ¨è¿˜è‡ªå·±æ‰§è¡Œäº†ä¸€ä¸‹`dispatch`ï¼Œåœ¨`createStore`çš„æœ€åã€‚\n\n```js\ndispatch({ type: ActionTypes.INIT } as A)\n```\n\nå…¶å®ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œæˆ‘ä»¬`createStore`çš„æ—¶å€™ï¼Œåˆå§‹çš„`state`å°±æ˜¯è¿™æ ·æ¥çš„~\n\né‡Œé¢çš„`INIT`ï¼Œåœ¨æˆ‘ä»¬ä¹‹å‰`REPLACE`é‡Œé¢ä¹Ÿæœ‰ä»‹ç»ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªéšæœºæ•°è€Œå·²ã€‚\n\n## applyMiddleware\n\nè¿™ä¸ªå‘ï¼Œæ˜¯ä¹‹å‰åœ¨`createStore`çš„`ensureCanMutateNextListeners`åŸ‹ä¸‹çš„ï¼Œç°åœ¨æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹è¿™ä¸ªã€‚\n\nè¿™ä¸ªreduxæ‹“å±•dispatchçš„å”¯ä¸€çš„æ ‡å‡†çš„æ–¹æ³•ã€‚\n\né¦–å…ˆï¼Œæˆ‘ä»¬å¾—çŸ¥é“æ€ä¹ˆç”¨ã€‚æˆ‘è´´ä¸‹æˆ‘è‡ªå·±demoã€‚\n\n```js\n// middleware\nconst logger = (store:any) => (next:any) => (action:any) => {\n  // debugger\n  console.info('dispatching', action)\n  const result = next(action);\n  console.log('next state', store.getState())\n  return result\n}\n```\n\nè¿™ä¸ªæ˜¯å®˜æ–¹çš„demoï¼Œä¸äº†è§£çš„ï¼Œ[ç‚¹æˆ‘å¿«é€Ÿäº†è§£](https://www.redux.org.cn/docs/advanced/Middleware.html)\n\nokï¼Œæˆ‘ä»¬ç›´æ¥è´´æºç ï¼Œå¾ˆçŸ­ï¼Œä½†æ˜¯æœ‰å¾ˆå¤šå¥¥å¦™ï¼ˆå¥¥å¦™æ‰“é’±ï¼ï¼‰ã€‚\n\n```js\nexport default function applyMiddleware(\n  ...middlewares: Middleware[]\n): StoreEnhancer<any> {\n  return (createStore: StoreEnhancerStoreCreator) => <S, A extends AnyAction>(\n    reducer: Reducer<S, A>,\n    preloadedState?: PreloadedState<S>\n  ) => {\n    const store = createStore(reducer, preloadedState)\n    let dispatch: Dispatch = () => {\n      throw new Error(\n        'Dispatching while constructing your middleware is not allowed. ' +\n          'Other middleware would not be applied to this dispatch.'\n      )\n    }\n\n    const middlewareAPI: MiddlewareAPI = {\n      getState: store.getState,\n      dispatch: (action, ...args) => dispatch(action, ...args)\n    }\n    const chain = middlewares.map(middleware => middleware(middlewareAPI))\n    dispatch = compose<typeof dispatch>(...chain)(store.dispatch)\n\n    return {\n      ...store,\n      dispatch\n    }\n  }\n}\n```\n\nçœ‹èµ·æ¥å¾ˆçŸ­ï¼Œä½†æ˜¯å´æœ‰å¾ˆå¤šæ·±å¥¥çš„åœ°æ–¹ã€‚ä¸€ä¸ªä¸ªæ¥ã€‚\n\nåœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸€ä¸‹å‡½æ•°æŸ¯é‡ŒåŒ–ã€‚ç›´æ¥ä¸Šdemoå¸®åŠ©ç†è§£\n\n```js\nfunction test(a) {\n  return function test2(b){\n    console.log(a + b)\n  }\n}\n\nconst t = test(1);\nt(2); // 3\n```\n\nè¿™é‡Œå°±æ˜¯ä¸€ä¸ªç®€å•çš„å‡½æ•°æŸ¯é‡ŒåŒ–ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå­˜å‚¨ä¸€ä¸‹ç¬¬ä¸€æ¬¡ä¼ å…¥çš„å‚æ•°ï¼Œåé¢å¦‚æœè¿™ä¸ª`1`ä¼šå¤ç”¨çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å®šä¹‰çš„å˜é‡`t`å°±å¯ä»¥åœ¨å¾ˆå¤šåœ°æ–¹ä½¿ç”¨ï¼Œé‡Œé¢ç”¨åˆ°äº†é—­åŒ…çš„çŸ¥è¯†ï¼Œè€Œä¸”æ˜¯éå¸¸å…¸å‹çš„é—­åŒ…ï¼Œå­˜å‚¨å½¢å‚`a`ï¼Œå®å‚`1`ã€‚\n\nè¿˜è®°å¾—æˆ‘ä»¬çš„ä½¿ç”¨ç”¨ä¾‹å—ï¼Ÿ\n\n```js\n// middleware\nconst logger = (store:any) => (next:any) => (action:any) => {\n  // debugger\n  console.info('dispatching', action)\n  const result = next(action);\n  console.log('next state', store.getState())\n  return result\n}\n```\n\nè¿™é‡Œé¢ç¬¬ä¸€ä¸ªå‚æ•°`store`å°±æ˜¯å¯¹åº”åˆ°æˆ‘ä»¬`createStore`æºç é‡Œé¢æˆ‘ä»¬æŒ–çš„å‘ã€‚\n\n```js\nif (typeof enhancer !== 'undefined') {\n    // å¦‚æœenhancerå­˜åœ¨ï¼Œé‚£ä»–å¿…é¡»æ˜¯ä¸ªfunction, å¦åˆ™throw Errorå“ˆ\n    if (typeof enhancer !== 'function') {\n      throw new Error('Expected the enhancer to be a function.')\n    }\n    /**\n     * ä¼ å…¥ç¬¦åˆå‚æ•°ç±»å‹çš„å‚æ•°ï¼Œå°±å¯ä»¥æ‰§è¡Œ enhancer,\n     * ä½†æ˜¯è¿™ä¸ªreturnæ·±æ·±çš„å¸å¼•äº†æˆ‘, å› ä¸ºè¯´æ˜æœ‰applyMiddlewareçš„æ—¶å€™åé¢çš„éƒ½ä¸ç”¨çœ‹äº† ??? å½“ç„¶\u001dä¸å¯èƒ½\n     * å¯æ˜¯applyMiddlewareå…¶å®æ˜¯å¿…ç”¨é¡¹ï¼Œæ‰€ä»¥çŒœæƒ³ä¸€ä¸‹applyMiddlewareå¼ºåŒ–storeä¹‹åä¼šenhancerèµ‹å€¼undefinedï¼Œå†æ¬¡è°ƒç”¨createStore\n     * ä¸Šä¸‹æ‰“ä¸ªdebuggerçœ‹ä¸€ä¸‹æ‰§è¡Œé¡ºåº(debuggerä½ç½®ä»¥æ³¨é‡Š)ï¼Œæœç„¶ä¸å‡ºæ‰€æ–™\n     * å¥½äº†ï¼Œ å‡è®¾æˆ‘ä»¬è¿˜ä¸çŸ¥é“applyMiddleware()è¿™ä¸ªfuncrionå…·ä½“å¹²äº†ä»€ä¹ˆï¼Œ\n     * åªçŸ¥é“ä»–åšäº†ä¸€äº›å¤„ç†ç„¶åé‡æ–°è°ƒç”¨äº†createStoreå¹¶ä¸”enhancerå‚æ•°ä¸ºundefined\n     * å…ˆè®°ä¸‹ï¼Œåç»­åœ¨çœ‹applyMiddlewareï¼Œ å› ä¸ºæˆ‘ä»¬ç°åœ¨è¦çœ‹çš„æ˜¯createStore\n     * * */\n    // debugger\n\n    return enhancer(createStore)(\n      reducer,\n      preloadedState as PreloadedState<S>\n    ) as Store<ExtendState<S, StateExt>, A, StateExt, Ext> & Ext\n  }\n```\n\nç¬¬äºŒä¸ª`next`ï¼Œå…¶å®å°±æ˜¯`middlewareAPI`é‡Œé¢çš„`dispatch`\n\n```js\nconst middlewareAPI: MiddlewareAPI = {\n      getState: store.getState,\n      dispatch: (action, ...args) => dispatch(action, ...args),\n      test:2,\n    }\n```\n\nå¢åŠ ä¸€ä¸ª`log`åœ¨`middleware`é‡Œé¢å°±å¯ä»¥çŸ¥é“äº†\n\n```js\nconst logger = (store:any) => (next:any) => (action:any) => {\n  // debugger\n  \n  console.log(store)\n  console.log('next===',next)\n  console.log(action)\n  console.info('dispatching', action)\n  // const result = next(action);\n  console.log('next state', store.getState())\n  // return result\n}\n```\n\nè¿™ä¸ªæ—¶å€™`log`çš„æ˜¯æˆ‘ä»¬åœ¨`createStore`é‡Œé¢çš„`dispatch`ï¼Œè¿˜å‡ºç°äº†æˆ‘ä»¬çš„æ³¨é‡Š\n\nè¯´æ˜`next`è¿™ä¸ªå‚æ•°å°±æ˜¯å¯¹åº”çš„`middlewareAPI`é‡Œé¢çš„`dispatch`ä¹Ÿå°±æ˜¯è¯´æ˜¯`createStore`é‡Œé¢çš„`dispatch`ã€‚\n\n\n\nç¬¬ä¸‰ä¸ªå‚æ•°`action`\n\nå¾ˆç®€å•ï¼Œå…¶å®å°±æ˜¯æ™®æ™®é€šé€šçš„ä¸€ä¸ª`action`ã€‚ä¸è¿‡æ˜¯ä»æˆ‘ä»¬`middleaware`é‡Œé¢å¾—åˆ°çš„ã€‚è¿™ä¸ªæ²¡æœ‰ç–‘æƒ‘ã€‚\n\n\n\n> æˆ‘ä»¬ä¼šå‘ç°ä¸€ä¸ªå¾ˆæœ‰è¶£çš„äº‹æƒ…å°±æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æ³¨é‡Šæ‰è°ƒç”¨`next(action)`ï¼Œå¹¶ä¸”ä¸å°†ç»“æœ`return`çš„è¯ï¼Œè¿™ä¸ª`action`å°±ä¼šè¢«å¡ä½ï¼Œæ²¡æœ‰å‘å‡ºå»ï¼Œè¢«æˆ‘ä»¬æ‰“æ–­äº†ï¼Œæ‰€ä»¥è¿™å°±æ˜¯æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªçš„åŸå› ã€‚é‚£ä¹ˆå°±å¯ä»¥å¼•ç”³å‡ºæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰æ‰“æ–­æŸäº›æƒ…å†µä¸‹çš„actionï¼Œç„¶åéœ€è¦åœ¨é‚£äº›æƒ…å†µä¸‹ç»™actioné‡Œé¢åŠ äº›ä»€ä¹ˆï¼Œéƒ½å¯ä»¥åŠåˆ°ã€‚\n\n\n\nokï¼Œæˆ‘ä»¬çœ‹äº†ä¹‹åå¥½åƒçŸ¥é“`applyMiddleware`é‡Œé¢çš„å‚æ•°éƒ½å¯¹åº”è¿™å“ªäº›ä¸œè¥¿äº†ï¼Œä½†æ˜¯ä¼¼ä¹ä¸çŸ¥é“ä¸ºä»€ä¹ˆæ˜¯ä¸€ç§æŸ¯é‡ŒåŒ–çš„å½¢å¼æ¥å±•ç¤ºçš„ã€‚æˆ‘ä»¬çœ‹ä¸‹é¢çš„ä»£ç å°±ä¼šçŸ¥é“äº†ã€‚\n\n```js\n// è°ƒç”¨æ¯ä¸€ä¸ªè¿™æ ·å½¢å¼çš„middleware = store => next => action =>{}, \n// ç»„æˆä¸€ä¸ªè¿™æ ·[f(next)=>acticon=>next(action)...]çš„arrayï¼Œèµ‹å€¼ç»™chain\nconst chain = middlewares.map(middleware => middleware(middlewareAPI))\n// debugger\n// composeçœ‹ -> compose.jsæ–‡ä»¶\n// compose(...chain)ä¼šå½¢æˆä¸€ä¸ªè°ƒç”¨é“¾, nextæŒ‡ä»£ä¸‹ä¸€ä¸ªå‡½æ•°çš„æ³¨å†Œ, è¿™å°±æ˜¯ä¸­é—´ä»¶çš„è¿”å›å€¼è¦æ˜¯next(action)çš„åŸå› \n// å¦‚æœæ‰§è¡Œåˆ°äº†æœ€ånextå°±æ˜¯åŸç”Ÿçš„store.dispatchæ–¹æ³•\ndispatch = compose(...chain)(store.dispatch) \n```\n\né‡Œé¢æåˆ°äº†`compose`è¿™ä¸ªå‡½æ•°ï¼Œå…¶å®è¿™ä¸ªå‡½æ•°å°±æ˜¯æ•´ä¸ªä¸­é—´ä»¶çš„ç²¾é«“æ‰€åœ¨ã€‚æŸ¯é‡ŒåŒ–çš„å¥¥ä¹‰ï¼\n\n```js\nexport default function compose(...funcs: Function[]) {\n  if (funcs.length === 0) {\n    // infer the argument type so it is usable in inference down the line\n    return <T>(arg: T) => arg\n  }\n\n  if (funcs.length === 1) {\n    return funcs[0]\n  }\n\n  return funcs.reduce((a, b) => (...args: any) => a(b(...args)))\n}\n```\n\nä¸äº†è§£reduceçš„åŒå­¦å¯ä»¥[ç‚¹è¿™é‡Œ](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce)ã€‚\n\nè¿™ä¸ªcomposeå…¶å®æ˜¯ä¸€ä¸ªè°ƒç”¨é“¾ï¼Œæˆ‘ä»¬çš„æ‰€æœ‰çš„ä¸­é—´ä»¶éƒ½ä¼šæŒ‰é¡ºåºåŠ è½½ï¼Œç„¶åæ˜¯ğŸ‘‡è¿™ç§å½¢å¼\n\n```js\nmiddleware = middleware1 => middleware2 => middleware3 => middleware4 //...\n```\n\næˆ‘ä»¬é€šè¿‡ä¸€ä¸‹ä»£ç çŸ¥é“ï¼Œç¡®å®æ˜¯å¾€ä¸‹ä¼ é€’çš„ã€‚\n\n```js\n// middleware\nconst logger = (store:any) => (next:any) => (action:any) => {\n  // debugger\n  \n  console.log(store)\n  console.log('next===',next)\n  console.log(action)\n  console.info('dispatching', action)\n  action.aa = 2\n  const result = next(action);\n  console.log('next state', store.getState())\n  return result\n}\n\nconst logger2 = (store:any) => (next:any) => (action:any) => {\n  // debugger\n  \n  console.log(store)\n  console.log('next2===',next)\n  console.log('logger2==-=-=-=-=-=-=',action)\n  console.info('dispatching', action)\n  const result = next(action);\n  console.log('next state', store.getState())\n  return result\n}\n\nconst store = createStore(rootReducer, {todos:[]}, applyMiddleware(logger, logger2));\n```\n\nåœ¨`logger2`é‡Œé¢ç¡®å®æ‰“å°å‡ºæ¥`aa`è¿™ä¸ªå±æ€§çš„å€¼ï¼Œè€Œ`logger`å´æ²¡æœ‰\n\n\n\n## compose\n\nè¿™ä¸ªåœ¨ä¸Šé¢ä»‹ç»applyMiddlewareçš„æ—¶å€™è¯´è¿‡äº†ã€‚å°±ä¸å¤šè¯´äº†ã€‚\n\n\n\n## combineReducers\n\nè¿™ä¸ªä¸­æ–‡ç¿»è¯‘å°±æ˜¯ã€Šç»„åˆreducerã€‹ã€‚\n\nå…¶å®å°±æ˜¯ å­—é¢æ„æ€ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹æ€ä¹ˆç”¨å°±äº†è§£äº†ã€‚\n\n```js\nexport default combineReducers({\n  firstReducer: todos,\n  secondReducer: visibilityFilter\n})\n```\n\nç„¶åæˆ‘ä»¬çœ‹ä¸€ä¸‹`log`å‡ºæ¥çš„`props`æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚\n\n```js\n{\n\tfirstReducer: {todos: Array(0)}\n\tsecondReducer: \"SHOW_ALL\"\n}\n```\n\nä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸€å¼€å§‹è®¾ç½®è¿›å»çš„`key`å€¼ï¼Œè¿”å›çš„æ—¶å€™ä¹Ÿæ˜¯æŒ‰è¿™ä¸ªæ ¼å¼è¿”å›çš„ã€‚\n\né‡Œé¢æœ‰è®¸å¤šå‡½æ•°ï¼Œæˆ‘ä»¬å…ˆçœ‹ä»–åˆ°å¤„çš„å‡½æ•°`combineReducers`\n\n### combineReducers\n\n```js\n// ç”¨äºåˆå¹¶reducer ä¸€èˆ¬æ˜¯è¿™æ ·combineReducers({a,b,c})\nexport default function combineReducers(reducers: ReducersMapObject) {\n  // reducersä¸­keyçš„æ•°ç»„\n  const reducerKeys = Object.keys(reducers)\n  // æœ€ç»ˆçš„reducer\n  const finalReducers: ReducersMapObject = {}\n\n  // å¾ªç¯ï¼Œ ç›®çš„ä¸ºäº†ç»™finalReducersèµ‹å€¼ï¼Œ è¿‡è™‘äº†ä¸ç¬¦åˆè§„èŒƒçš„reducer\n  for (let i = 0; i < reducerKeys.length; i++) {\n    // æ¥å—å½“å‰çš„key\n    const key = reducerKeys[i]\n\n    // å¦‚æœä¸æ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œ å½“å‰çš„reduceræ˜¯undefinedä¼šç»™å‡ºwarning\n    if (process.env.NODE_ENV !== 'production') {\n      if (typeof reducers[key] === 'undefined') {\n        warning(`No reducer provided for key \"${key}\"`)\n      }\n    }\n\n    // reducerè¦æ˜¯ä¸€ä¸ªfunction\n    if (typeof reducers[key] === 'function') {\n      // èµ‹å€¼ç»™finalReducers\n      finalReducers[key] = reducers[key]\n    }\n  }\n  // ç¬¦åˆè§„èŒƒçš„reducerçš„keyæ•°ç»„\n  const finalReducerKeys = Object.keys(finalReducers)\n\n  // This is used to make sure we don't warn about the same\n  // keys multiple times.\n  // æ„æƒ³ä¸åˆ°çš„keyï¼Œ å…ˆå¾€ä¸‹çœ‹çœ‹\n  let unexpectedKeyCache: { [key: string]: true }\n  // productionç¯å¢ƒä¸º{}\n  if (process.env.NODE_ENV !== 'production') {\n    unexpectedKeyCache = {}\n  }\n\n  let shapeAssertionError: Error\n  try {\n    // çœ‹è¿™ä¸ªfunction\n    assertReducerShape(finalReducers)\n  } catch (e) {\n    shapeAssertionError = e\n  }\n\n  // è¿”å›functionï¼Œ å³ä¸ºcreateStoreä¸­çš„reducerå‚æ•°æ—¢currentReducer\n  // è‡ªç„¶æœ‰stateå’Œactionä¸¤ä¸ªå‚æ•°ï¼Œ å¯ä»¥å›createStoreæ–‡ä»¶çœ‹çœ‹currentReducer(currentState, action)\n  return function combination(\n    state: StateFromReducersMapObject<typeof reducers> = {},\n    action: AnyAction\n  ) {\n    // reducerä¸è§„èŒƒæŠ¥é”™\n    if (shapeAssertionError) {\n      throw shapeAssertionError\n    }\n\n    // æ¯”è¾ƒç»†è‡´çš„âŒä¿¡æ¯ï¼Œé¡ºä¾¿çœ‹äº†ä¸€ä¸‹getUndefinedStateErrorMessageï¼Œéƒ½æ˜¯ç”¨äºæç¤ºwarningå’Œerrorçš„ï¼Œ ä¸è¿‡å¤šè§£é‡Šäº†\n    if (process.env.NODE_ENV !== 'production') {\n      const warningMessage = getUnexpectedStateShapeWarningMessage(\n        state,\n        finalReducers,\n        action,\n        unexpectedKeyCache\n      )\n      if (warningMessage) {\n        warning(warningMessage)\n      }\n    }\n\n    let hasChanged = false\n    const nextState: StateFromReducersMapObject<typeof reducers> = {}\n    for (let i = 0; i < finalReducerKeys.length; i++) {\n\n      // è·å–finalReducerKeysçš„keyå’Œvalueï¼ˆfunctionï¼‰\n      const key = finalReducerKeys[i]\n      const reducer = finalReducers[key]\n      // å½“å‰keyçš„stateå€¼\n      const previousStateForKey = state[key]\n      // æ‰§è¡Œreducerï¼Œ è¿”å›å½“å‰state\n      const nextStateForKey = reducer(previousStateForKey, action)\n      // ä¸å­˜åœ¨è¿”å›å€¼æŠ¥é”™\n      if (typeof nextStateForKey === 'undefined') {\n        const errorMessage = getUndefinedStateErrorMessage(key, action)\n        throw new Error(errorMessage)\n      }\n      // æ–°çš„stateæ”¾åœ¨nextStateå¯¹åº”çš„keyé‡Œ\n      nextState[key] = nextStateForKey\n      // åˆ¤æ–­æ–°çš„stateæ˜¯ä¸æ˜¯åŒä¸€å¼•ç”¨ï¼Œ ä»¥æ£€éªŒreduceræ˜¯ä¸æ˜¯çº¯å‡½æ•°\n      hasChanged = hasChanged || nextStateForKey !== previousStateForKey\n    }\n    hasChanged =\n      hasChanged || finalReducerKeys.length !== Object.keys(state).length\n      // æ”¹å˜äº†è¿”å›nextState\n    return hasChanged ? nextState : state\n  }\n  /*\n  *  æ–°ç‰ˆæœ¬çš„reduxè¿™éƒ¨åˆ†æ”¹å˜äº†å®ç°æ–¹æ³•\n  *  è€ç‰ˆæœ¬çš„reduxä½¿ç”¨çš„reduceå‡½æ•°å®ç°çš„\n  *  ç®€å•ä¾‹å­å¦‚ä¸‹\n  * function combineReducers(reducers) {\n  *    return (state = {}, action) => {\n  *        return Object.keys(reducers).reduce((currentState, key) => {\n  *            currentState[key] = reducers[key](state[key], action);\n  *             return currentState;\n  *         }, {})\n  *      };\n  *    }\n  * \n  * */\n}\n```\n\nä¸Šé¢æ˜¯ä¸»è¦æºç ï¼Œä¸€ä¸ªä¸ªå‰–æè¿›å»ã€‚\n\nå…ˆæ˜¯å¯¹æ•°æ®è¿›è¡Œæ¸…æ´—ï¼Œç¬¬ä¸€æ¬¡ç­›é€‰å‡ºç¬¦åˆè¦æ±‚çš„`reducer`ä»¬\n\n```js\n// reducersä¸­keyçš„æ•°ç»„\n  const reducerKeys = Object.keys(reducers)\n  // æœ€ç»ˆçš„reducer\n  const finalReducers: ReducersMapObject = {}\n\n  // å¾ªç¯ï¼Œ ç›®çš„ä¸ºäº†ç»™finalReducersèµ‹å€¼ï¼Œ è¿‡è™‘äº†ä¸ç¬¦åˆè§„èŒƒçš„reducer\n  for (let i = 0; i < reducerKeys.length; i++) {\n    // æ¥å—å½“å‰çš„key\n    const key = reducerKeys[i]\n\n    // å¦‚æœä¸æ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œ å½“å‰çš„reduceræ˜¯undefinedä¼šç»™å‡ºwarning\n    if (process.env.NODE_ENV !== 'production') {\n      if (typeof reducers[key] === 'undefined') {\n        warning(`No reducer provided for key \"${key}\"`)\n      }\n    }\n\n    // reducerè¦æ˜¯ä¸€ä¸ªfunction\n    if (typeof reducers[key] === 'function') {\n      // èµ‹å€¼ç»™finalReducers\n      finalReducers[key] = reducers[key]\n    }\n  }\n```\n\n\n\n### assertReducerShape\n\nåˆç­›ä¹‹åçš„finalReducersä¼šäº¤ç”±assertReducerShapeå†ä¸€æ¬¡è¿›è¡Œæ£€éªŒã€‚é‡Œé¢å°±æ˜¯ä¸€ä¸ªåˆ¤æ–­ï¼Œç„¶åç»™å‡ºè­¦å‘Šâš ï¸ä¹‹ç±»çš„ã€‚å°±ä¸å¤šè¯´äº†ã€‚\n\n```js\nfunction assertReducerShape(reducers) {\n  Object.keys(reducers).forEach(key => {\n    const reducer = reducers[key]\n   // reducerè¿”å›å€¼\n    const initialState = reducer(undefined, { type: ActionTypes.INIT })\n    // undefined throw Error\n    if (typeof initialState === 'undefined') {\n      throw new Error(\n        `Reducer \"${key}\" returned undefined during initialization. ` +\n          `If the state passed to the reducer is undefined, you must ` +\n          `explicitly return the initial state. The initial state may ` +\n          `not be undefined. If you don't want to set a value for this reducer, ` +\n          `you can use null instead of undefined.`\n      )\n    }\n\n    // å¾ˆæ˜æ˜¾assertReducerShapeæ˜¯ç”¨äºreducerçš„è§„èŒƒ\n    // å›åˆ°combineReducers\n    if (\n      typeof reducer(undefined, {\n        type: ActionTypes.PROBE_UNKNOWN_ACTION()\n      }) === 'undefined'\n    ) {\n      throw new Error(\n        `Reducer \"${key}\" returned undefined when probed with a random type. ` +\n          `Don't try to handle ${\n            ActionTypes.INIT\n          } or other actions in \"redux/*\" ` +\n          `namespace. They are considered private. Instead, you must return the ` +\n          `current state for any unknown actions, unless it is undefined, ` +\n          `in which case you must return the initial state, regardless of the ` +\n          `action type. The initial state may not be undefined, but can be null.`\n      )\n    }\n  })\n}\n```\n\n\n\n### combination\n\nç„¶åå°±æ˜¯è¿”å›combinationè¿™ä¸ªå‡½æ•°ã€‚å‚æ•°çš„æ„ä¹‰å°±æ˜¯ä»–çš„åå­—ã€‚å°±ä¸å¤šè¯´äº†ã€‚\n\n```js\nreturn function combination(state = {}, action) {\n    // reducerä¸è§„èŒƒæŠ¥é”™\n    if (shapeAssertionError) {\n      throw shapeAssertionError\n    }\n\n    // æ¯”è¾ƒç»†è‡´çš„âŒä¿¡æ¯ï¼Œé¡ºä¾¿çœ‹äº†ä¸€ä¸‹getUndefinedStateErrorMessageï¼Œéƒ½æ˜¯ç”¨äºæç¤ºwarningå’Œerrorçš„ï¼Œ ä¸è¿‡å¤šè§£é‡Šäº†\n    if (process.env.NODE_ENV !== 'production') {\n      const warningMessage = getUnexpectedStateShapeWarningMessage(\n        state,\n        finalReducers,\n        action,\n        unexpectedKeyCache\n      )\n      if (warningMessage) {\n        warning(warningMessage)\n      }\n    }\n\n    let hasChanged = false\n    const nextState = {}\n    for (let i = 0; i < finalReducerKeys.length; i++) {\n      // è·å–finalReducerKeysçš„keyå’Œvalueï¼ˆfunctionï¼‰\n      const key = finalReducerKeys[i]\n      const reducer = finalReducers[key]\n      // å½“å‰keyçš„stateå€¼\n      const previousStateForKey = state[key]\n      // æ‰§è¡Œreducerï¼Œ è¿”å›å½“å‰state\n      const nextStateForKey = reducer(previousStateForKey, action)\n      // ä¸å­˜åœ¨è¿”å›å€¼æŠ¥é”™\n      if (typeof nextStateForKey === 'undefined') {\n        const errorMessage = getUndefinedStateErrorMessage(key, action)\n        throw new Error(errorMessage)\n      }\n      // æ–°çš„stateæ”¾åœ¨nextStateå¯¹åº”çš„keyé‡Œ\n      nextState[key] = nextStateForKey\n      // åˆ¤æ–­æ–°çš„stateæ˜¯ä¸æ˜¯åŒä¸€å¼•ç”¨ï¼Œ ä»¥æ£€éªŒreduceræ˜¯ä¸æ˜¯çº¯å‡½æ•°\n      hasChanged = hasChanged || nextStateForKey !== previousStateForKey\n    }\n    // æ”¹å˜äº†è¿”å›nextState\n    return hasChanged ? nextState : state\n  }\n  /*\n  *  æ–°ç‰ˆæœ¬çš„reduxè¿™éƒ¨åˆ†æ”¹å˜äº†å®ç°æ–¹æ³•\n  *  è€ç‰ˆæœ¬çš„reduxä½¿ç”¨çš„reduceå‡½æ•°å®ç°çš„\n  *  ç®€å•ä¾‹å­å¦‚ä¸‹\n  * function combineReducers(reducers) {\n  *    return (state = {}, action) => {\n  *        return Object.keys(reducers).reduce((currentState, key) => {\n  *            currentState[key] = reducers[key](state[key], action);\n  *             return currentState;\n  *         }, {})\n  *      };\n  *    }\n  * \n  * */\n```\n\n\n\nå…¶å®å°±æ˜¯æ‰§è¡Œreducerï¼Œç„¶åæŠŠå€¼æ‹¿å‡ºæ¥æ¯”å¯¹ï¼Œå¦‚æœæ˜¯å¼•ç”¨çš„è¯å°±è¿”å›ä¹‹å‰çš„stateï¼Œå¦‚æœä¸æ˜¯å°±ä½¿ç”¨æ–°çš„ã€‚ä»–çš„æ¯”å¯¹å’Œä¹‹å‰è¯´çš„æ•°ç»„æ¯”å¯¹ä¸€æ ·ï¼Œéƒ½æ˜¯æ¯”å¯¹å†…å­˜åœ°å€ã€‚\n\nä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Ÿ\n\nå¥½é—®é¢˜ï¼\n\nè¿™æ ·åšçš„å¥½å¤„å…¶å®å°±æ˜¯ä¸ºäº†çº¯å‡½æ•°ï¼Œä¸ºäº†ä¸€åˆ‡å¯é¢„æµ‹ã€‚è€Œä¸”ç®€å•çš„æ¯”è¾ƒå†…å­˜åœ°å€æ¯”é€’å½’çš„æ€§èƒ½å¥½å¤ªå¤šäº†ã€‚\n\né‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆæ ·æ‰å¯ä»¥å¥‘åˆè¿™æ ·çš„ç†å¿µå‘¢ï¼Ÿ\n\nå°±æ˜¯æˆ‘ä»¬åœ¨å†™reducerè¿”å›çš„æ—¶å€™ï¼Œéœ€è¦è¿”å›ä¸€ä¸ªå…¨æ–°çš„å¯¹è±¡ï¼Œé€šå¸¸æ˜¯\n\n```js\nreturn{\n\t...state,\n\txx: xx\n}\n```\n\nç±»ä¼¼è¿™æ ·ã€‚è¿™æ ·çš„è¯jså°±ä¼šæ–°å¼€è¾Ÿä¸€ä¸ªå†…å­˜åœ°å€å‡ºæ¥ã€‚åœ¨æ¯”å¯¹çš„æ—¶å€™å†…å­˜åœ°å€å°±ä¸ä¼šç›¸åŒäº†ã€‚\n\n\n\n## bindActionCreators\n\nè¿™ä¸ªå‡½æ•°å…¶å®éå¸¸å°‘ç”¨åˆ°ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«æ™¦æ¶©çš„ä¸œè¥¿ï¼Œåªæ˜¯ä¸€ä¸ªå°è£…ã€‚ä½†æ˜¯æ˜¯ä¸€ç§æ›´ä¸ºä¼˜é›…çš„æ–¹å¼ã€‚\n\nç›´æ¥çœ‹ä»£ç ï¼Œå¾ˆå°‘ã€‚\n\n```js\nexport default function bindActionCreators(actionCreators, dispatch) {\n  // actionCreatorsä¸ºfunction\n  if (typeof actionCreators === 'function') {\n    return bindActionCreator(actionCreators, dispatch)\n  }\n\n  // ä¸æ˜¯object throw Error\n  if (typeof actionCreators !== 'object' || actionCreators === null) {\n    throw new Error(\n      `bindActionCreators expected an object or a function, instead received ${\n        actionCreators === null ? 'null' : typeof actionCreators\n      }. ` +\n        `Did you write \"import ActionCreators from\" instead of \"import * as ActionCreators from\"?`\n    )\n  }\n\n  // object è½¬ä¸ºæ•°ç»„\n  const keys = Object.keys(actionCreators)\n  // å®šä¹‰return çš„props\n  const boundActionCreators = {}\n  for (let i = 0; i < keys.length; i++) {\n    // actionCreatorsçš„key é€šå¸¸ä¸ºactionCreators functionçš„nameï¼ˆæ–¹æ³•åï¼‰\n    const key = keys[i]\n    // function => actionCreatorså·¥å‚æ–¹æ³•æœ¬èº«\n    const actionCreator = actionCreators[key]\n    if (typeof actionCreator === 'function') {\n      // å‚æ•°ä¸º{actionsï¼šfunction xxx}æ˜¯è¿”å›ç›¸åŒçš„ç±»å‹\n      boundActionCreators[key] = bindActionCreator(actionCreator, dispatch)\n    }\n  }\n  // return çš„props\n  return boundActionCreators\n}\n```\n\nä»£ç å¾ˆç®€å•ä¹Ÿå¾ˆæ¸…æ™°ï¼Œå°±æ˜¯å¼„ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œç„¶åæŠŠ`actionCreators`é‡Œé¢çš„`value`å˜æˆ`bindActionCreator(actionCreator, dispatch)`çš„å€¼ï¼Œé‚£ä¹ˆä¸€èµ·çœ‹ä¸€ä¸‹`bindActionCreator`\n\n```js\nfunction bindActionCreator<A extends AnyAction = AnyAction>(\n  actionCreator: ActionCreator<A>,\n  dispatch: Dispatch\n) {\n  return function (this: any, ...args: any[]) {\n    return dispatch(actionCreator.apply(this, args))\n  }\n}\n```\n\nå…¶å®è¿™é‡Œçœ‹èµ·æ¥æœ‰ç‚¹è¿·ç³Šï¼Œçœ‹ä¹Ÿæ˜¯èƒ½çœ‹æ‡‚ï¼Œå…¶å®å°±æ˜¯è¿”å›ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯å¹²ä»€ä¹ˆçš„å‘¢ï¼Ÿè¿”å›æ‰§è¡Œdispatchä¹‹åçš„è¿”å›å€¼ã€‚è¿™ä¹ˆæè¿™ä¹ˆä¸€åœˆç©¶ç«Ÿæœ‰ä»€ä¹ˆç§˜å¯†å‘¢ï¼Ÿ\n\næˆ‘ä»¬å†™ä¸€ä¸ªdemoå°±ä¼šçŸ¥é“äº†ã€‚\n\nå‡å¦‚æˆ‘ä»¬è¦åšä¸€ä¸ªåŠ¨æ€çš„å¢åŠ çš„actionï¼Œåˆ†åˆ«ä¸ºç‚¹å‡»ä¸€æ¬¡+1ï¼Œç‚¹å‡»ä¸€æ¬¡+2ï¼Œç‚¹å‡»ä¸€æ¬¡+3ã€‚\n\næˆ‘ä»¬éœ€è¦\n\n```js\nconst counterIncActionCreator = function(step) {\n  return {\n    type: 'INCREMENT',\n    step: step || 1\n  }\n}\n\n// ä¸ºäº†ç®€åŒ–ä»£ç æˆ‘æŠŠdispatchå‡½æ•°å®šä¹‰ä¸ºåªæœ‰æ‰“å°åŠŸèƒ½çš„å‡½æ•°\nconst dispatch = function(action) {\n  console.log(action)\n}\n\nconst action1 = counterIncActionCreator()\ndispatch(action1) // { type: 'INCREMENT', step: 1 }\n\nconst action2 = counterIncActionCreator(2)\ndispatch(action2) // { type: 'INCREMENT', step: 2 }\n\nconst action3 = counterIncActionCreator(3)\ndispatch(action3) // { type: 'INCREMENT', step: 3 }\n\n```\n\næœ‰ç‚¹éš¾å—å…¶å®ï¼Œä½†æ˜¯æˆ‘ä»¬ç”¨äº†`bindActionCreator`ä¹‹å\n\n```js\nconst increment = bindActionCreator(counterIncActionCreator, dispatch)\n\nincrement() // { type: 'INCREMENT', step: 1 }\n\nincrement(2) // { type: 'INCREMENT', step: 2 }\n\nincrement(3) // { type: 'INCREMENT', step: 3 }\n\n```\n\nå°±æ•´ä¸ªå¸…èµ·æ¥ï¼Œæœ‰æ²¡æœ‰ï¼Ÿï¼æ›´åŠ ä¼˜é›…äº†ã€‚\n\nè€Œä¸”æˆ‘ä»¬è¿˜å¯ä»¥åˆ¶ä½œå¢å’Œå‡çš„ä¸¤ä¸ªå·¥å‚ğŸ­\n\n```js\nconst MyActionCreators = {\n  increment: function(step) {\n    return {\n      type: 'INCREMENT',\n      step: step || 1\n    }\n  },\n\n  decrement: function(step) {\n    return {\n      type: 'DECREMENT',\n      step: - (step || 1)\n    }\n  }\n}\n\n```\n\n\n\nè€æ–¹æ³•\n\n```js\n// åŸå§‹çš„è°ƒåº¦æ–¹å¼\ndispatch(MyActionCreators.increment()) // { type: 'INCREMENT', step: 1 }\ndispatch(MyActionCreators.increment(2)) // { type: 'INCREMENT', step: 2 }\ndispatch(MyActionCreators.increment(3)) // { type: 'INCREMENT', step: 3 }\ndispatch(MyActionCreators.decrement()) // { type: 'DECREMENT', step: -1 }\ndispatch(MyActionCreators.decrement(2)) // { type: 'DECREMENT', step: -2 }\ndispatch(MyActionCreators.decrement(3)) // { type: 'DECREMENT', step: -3 }\n\n```\n\nè¿›åŒ–ä¹‹å\n\n```js\nMyNewActionCreators.increment() // { type: 'INCREMENT', step: 1 }\nMyNewActionCreators.increment(2) // { type: 'INCREMENT', step: 2 }\nMyNewActionCreators.increment(3) // { type: 'INCREMENT', step: 3 }\nMyNewActionCreators.decrement() // { type: 'DECREMENT', step: -1 }\nMyNewActionCreators.decrement(2) // { type: 'DECREMENT', step: -2 }\nMyNewActionCreators.decrement(3) // { type: 'DECREMENT', step: -3 }\n\n```\n\n\n\n## Reduxæ€»ç»“\n\nè‡³æ­¤æˆ‘ä»¬çš„reduxæºç é˜…è¯»å°±åˆ°æ­¤ä¸ºæ­¢ã€‚\n\næ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·å­¦ä¹ ä¸€ä¸‹å’Œreduxé…åˆä½¿ç”¨çš„react-redux\n\n## react-redux\n\nReact åŸæœ¬å’Œreduxæ²¡æœ‰å…³ç³»ï¼Œreduxåªæ˜¯è´Ÿè´£æ•°æ®å¤„ç†ï¼Œç†è®ºä¸Šæ— è®ºæ˜¯vueæˆ–è€…angularéƒ½å¯ä»¥ä½¿ç”¨ã€‚\n\nä½†æ˜¯react-reduxå°†reactå’Œreduxç´§å¯†çš„è”ç³»åœ¨äº†ä¸€èµ·ã€‚ç”¨æ›´ç¬¦åˆreactçš„æ–¹å¼æ¥è°ƒç”¨reduxã€‚\n\nåç»­ä¼šå‡ºä¸€ç¯‡ä»‹ç»react-reduxçš„æ–‡ç« ã€‚\n\n# æ€»ç»“\n\nè‡ªæ­¤reduxæºç é˜…è¯»ç®—æ˜¯å‘Šä¸€æ®µè½äº†ã€‚å…¶å®æºç å¾ˆç®€å•ï¼Œä½†æ˜¯æ€æƒ³å´å¾ˆé«˜çº§ã€‚\n\nå¦‚æœæœ‰ä¸æ‡‚çš„ï¼Œæˆ–è€…å“ªé‡Œè¯´é”™äº†ï¼Œå°ä¼™ä¼´æ¬¢è¿åœ¨è¯„è®ºåŒºè®¨è®ºã€‚\n\n# ç´¢å¼•\n\n>https://juejin.im/post/6844903638377185288\n>\n>https://www.redux.org.cn/\n\n\n\n\n\n> å®åœ¨æ˜¯æ²¡æœ‰åœ°æ–¹åæ§½ï¼Œæˆ‘åœ¨è¿™é‡Œè¯´ä¸€ä¸‹æœ€è¿‘çš„äº‹æƒ…å§ã€‚å…ˆæ˜¯éƒ¨é—¨é»„äº†ï¼Œç„¶åå¤§é¢†å¯¼æ¢äººäº†ï¼Œå¤§é¢†å¯¼ä¸çŸ¥é“æ˜¯ä¸æ˜¯æ–°å®˜ä¸Šä»»ä¸‰æŠŠç«ï¼Œéè¦æä»€ä¹ˆææ•ˆï¼Œå…¶å®å°±æ˜¯æŠŠäººå¼„èµ°ï¼Œç„¶ååŠ å¤§å·¥ä½œé‡ï¼Œåˆšåˆšå¼€å§‹æ¢ç»„æˆ‘å°±å»å†™å¾ˆè€çš„vueé¡¹ç›®ï¼Œæ²¡æœ‰é„™è§†vueçš„æ„æ€ï¼Œæ˜¯å› ä¸ºæˆ‘ä¹‹å‰éƒ½åœ¨å†™reactï¼Œç„¶åä¸€ä¸‹è®©æˆ‘å†™ï¼Œä¹Ÿä¸å¤ªé€‚åº”è€Œå·²ï¼Œè¿˜æ˜¯å¾ˆå°‘çš„ç‰ˆæœ¬ã€‚é‚£å°±å†™å°±å†™å§ï¼Œåæ­£åšå‰ç«¯çš„éƒ½å¾—å­¦ä¸æ˜¯ï¼Ÿå¯æ˜¯ï¼Œå¤§é¢†å¯¼ä¸ºäº†ç»™åšç»™è€æ¿çœ‹ï¼Œç„¶åè®©æˆ‘ä»¬ä¸‹ç­ä¸è¦èµ°ï¼Œå°±æ˜¯æ²¡æœ‰äº‹æƒ…åšå°±å¹²åç€çš„é‚£ç§ã€‚æœ¬ç€90åçš„æ€§å­æˆ‘å°±èµ°äº†ï¼Œç„¶åæˆ‘èµ°äº†ä¹‹åï¼Œæœ‰äº›å°ä¼™ä¼´å¯èƒ½ä¹Ÿå¼€å§‹èµ°äº†ï¼Œç„¶åæˆ‘å°±è¢«æŠ“å»åŠé€€äº†....æˆ‘ä¹Ÿæ²¡æœ‰æ­»çš®èµ–è„¸çš„èµ–ç€ã€‚å€Ÿå£ä¹Ÿéå¸¸çš„å¥‡è‘©\"ä½ æ´»åœ¨è‡ªå·±çš„ä¸–ç•Œé‡Œé¢ï¼Œæ²¡æœ‰å…³å¿ƒå‘¨å›´åŒäº‹å¿™ä¸å¿™ï¼Œæ”¹bugä¸ç§¯æï¼Œä»£ç è´¨é‡ä½\"ä¹‹ç±»çš„ã€‚ã€‚ã€‚å¯æ˜¯æˆ‘åªæ˜¯å·¥ä½œçš„æ—¶å€™æˆ´ç€è€Œå·²ï¼Œå› ä¸ºç»å¸¸æœ‰äº§å“ä¸Šæ¥å°±åœ¨æ—è¾¹å¼€å§‹è®¨è®ºäº†ï¼Œç„¶åæˆ‘è‡ªå·±çš„å·¥ä½œéƒ½åšä¸å®Œï¼Œæ€ä¹ˆå…³å¿ƒåŒäº‹å•Šã€‚ã€‚å¼ºè¡ŒåŠ äº†å·¥ä½œé‡ä¹‹åæˆ‘éƒ½å¾ˆæ™šèµ°æˆ–è€…å›å®¶å·¥ä½œäº†ã€‚å› ä¸ºåœ¨å…¬å¸èµ–ç€çœŸçš„å¾ˆéš¾å—ï¼Œä¸ºä»€ä¹ˆä¸åœ¨è‡ªå·±èˆ’é€‚çš„å®¶ä¸­å·¥ä½œå‘¢ï¼Ÿè¿˜å¯ä»¥é©¬ä¸Šç¡è§‰é‚£ç§ï¼ŒéŸ³ä¹è¿˜å¯ä»¥å¤–æ”¾ã€‚ã€‚ã€‚å†è¯´äº†æˆ‘ä¹‹å‰çš„ä»£ç ï¼Œå› ä¸ºé¡¹ç›®é»„äº†ï¼Œåº”è¯¥æ²¡äººçœ‹äº†å§....å”‰ï¼Œå…¶å®å°±æ˜¯ åŠé€€ã€‚æˆ‘éƒ½æ‡‚ã€‚\n>\n> ä½†æ˜¯æˆ‘çš„ç®€å†å…¶å®å˜å¾—æå…¶ä¸‘é™‹äº†ï¼Œå› ä¸ºæˆ‘å¹´åˆçš„æ‰è·³æ§½è¿‡æ¥çš„ã€‚ç°åœ¨è¿™ä¸ªæ—¶é—´éå¸¸å°´å°¬....è€Œä¸”æˆ‘æ¥çš„ç¬¬ä¸€å¤©å¬è¯´è¦996ï¼Œé©¬ä¸Šæäº†ç¦»èŒç”³è¯·ï¼Œæˆ‘çš„é¢†å¯¼åŒæ„äº†ï¼Œå¯ä»¥ä¹‹å‰çš„å¤§é¢†å¯¼å’Œæˆ‘è¯´ä»¥åä¸ä¼š996äº†å°±æ˜¯æ­£å¸¸ä¸Šä¸‹ç­ã€‚ã€‚ç„¶åä»–å°±è·³æ§½äº†ã€‚ã€‚ã€‚\n>\n> ç®—æ˜¯è‡ªå·±ä¸è®¤çœŸå®¡æŸ¥å…¬å¸ï¼Œä¸è¿‡ä»–ä»¬ä¹Ÿå¤ªéª—äººäº†å§...å”‰ã€‚\n>\n> ç°åœ¨åœ¨å®¶é‡Œä¹Ÿå¾ˆç„¦è™‘ï¼Œä¸çŸ¥é“æ‰¾ä¸æ‰¾å¾—åˆ°å·¥ä½œï¼Œæ­å·çš„å…¬å¸çœ‹äº†ä¸€åœˆéƒ½æ˜¯996ï¼Œå­¦é˜¿é‡Œçš„åŠ ç­ä¸å­¦é˜¿é‡Œçš„å·¥èµ„ã€‚ã€‚ã€‚\n>\n> å›½åº†ä»¥åå†è¯´å§ï¼Œå¸Œæœ›æ—©ç‚¹æŠŠé‡è¯†å‰ç«¯ç³»åˆ—æ›´å®Œã€‚\n\n","source":"_posts/ã€é‡è¯†å‰ç«¯ã€‘reduxæºç é˜…è¯».md","raw":"---\ntitle: ã€é‡è¯†å‰ç«¯ã€‘reduxæºç é˜…è¯»\ndate: 2020-09-11 16:10:35\ntags: [æºç é˜…è¯», React]\ncategory: [é‡æ‹¾å‰ç«¯]\ncover: /image/cover/web.jpeg\n---\n\næœ€è¿‘åœ¨å†™ã€é‡æ‹¾å‰ç«¯ã€‘ç³»åˆ—ï¼Œä¸‹é¢æœ‰å‡ ä¸ªå¿«é€Ÿé€šé“ï¼Œå¤§å®¶è‡ªå–\n\n[ã€é‡è¯†å‰ç«¯ã€‘åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿](https://juejin.im/post/6850418113944420359)\n\n[ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—](https://juejin.im/post/6850418117508759566)\n\n[ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this](https://juejin.im/post/6854573215658803208)\n\n[ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šJavaScriptçš„æ‰§è¡Œæœºåˆ¶](https://juejin.im/post/6859911609633767438)\n\n[ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC](https://juejin.im/post/6860375101322461198)\n\n[ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ](https://juejin.im/post/6865204092877144077)\n\n[ã€é‡è¯†å‰ç«¯ã€‘æš´èµ°çš„å¼‚æ­¥ç¼–ç¨‹](https://juejin.im/post/6867814019055484942)\n\n[ã€é‡è¯†å‰ç«¯ã€‘reduxæºç é˜…è¯»](https://juejin.im/post/6877910314110140423/)\n\n# å‰è¨€\n\nä¹‹å‰ä¸€ç›´åœ¨ä½¿ç”¨reduxï¼Œåæ¥å‡ºäº†hooksï¼Œç”¨çš„æ¯”è¾ƒå°‘äº†ï¼Œä½†æ˜¯è¿˜æ˜¯ä¼šä½¿ç”¨ï¼Œä»–ä»¬ä¸å†²çªï¼Œå„è‡ªå¯¹åº”çš„åœºæ™¯ä¸åŒã€‚å¬è¯´reduxæºç æ¯”è¾ƒå°‘ï¼Œä¹Ÿæ¯”è¾ƒå¥½æ‡‚ï¼ˆä¸æ˜¯è´¬ä½ï¼Œè¶Šå¼ºçš„ä»£ç å…¶å®è¶Šç®€æ´æ˜äº†ï¼‰\n\næ‰€ä»¥å‡†å¤‡é˜…è¯»ä¸€ä¸‹ï¼Œä¹Ÿç®—æ˜¯é‡è¯†å‰ç«¯ç³»åˆ—çš„ä¸€å‘˜å§ã€‚\n\næ³¨æ„ä¸€ä¸‹ï¼Œå…¶å®æˆ‘ä»¬å†™reactçš„æ—¶å€™ç”¨åˆ°çš„å…¶å®æ˜¯redux-reactã€‚åé¢ä¹Ÿä¼šä¸€èµ·ä»‹ç»ã€‚\n\næ›´å¥½çš„é˜…è¯»ä½“éªŒå…¶å®æ˜¯åœ¨é¡¹ç›®é‡Œé¢æ‰“æ–­ç‚¹ï¼Œè¿™é‡Œæ˜¯æˆ‘çš„[GitHubåœ°å€](https://github.com/DerrickTel/redux-source-analyse)ï¼Œå–œæ¬¢çš„åŒå­¦å¯ä»¥forkæˆ–è€…starä¸€ä¸‹å“¦ã€‚é‡Œé¢æˆ‘æŠŠæºç éƒ½æ‹‰å‡ºæ¥æ”¾åˆ°æ–‡ä»¶å¤¹é‡Œé¢ç„¶åç”±create-react-appæ¥è°ƒç”¨ï¼Œè€Œä¸æ˜¯ç›´æ¥ç”¨npmè£…ã€‚è¿™æœ‰åŠ©äºç†è§£ä¸è°ƒè¯•ï¼Œé‡Œé¢ä¹Ÿæœ‰æˆ‘çš„æ³¨é‡Šï¼Œå…¶å®å¯ä»¥ç›´æ¥é˜…è¯»æºç çš„æ³¨é‡Šä¼šæ›´å¿«ã€‚\n\nreduxå’Œrdux-reactçš„ä»£ç ä¹Ÿæ˜¯ç›®å‰æœ€æ–°ï¼ˆ2020-09-13ï¼‰çš„masteråˆ†æ”¯ä¸Šé¢çš„ã€‚\n\n# å¼€å§‹\n\nreduxæ˜¯ç”¨çš„rollupæ‰“åŒ…çš„ã€‚\n\næ‰“å¼€æ ¹ç›®å½•ä¸‹é¢çš„`rollup.config.js`å¯ä»¥çœ‹åˆ°å…¥å£æ˜¯srcç›®å½•ä¸‹çš„indexæ–‡ä»¶ã€‚\n\nå¯ä»¥çœ‹åˆ°ä»–å¯¼å‡ºçš„ä¸€äº›ä¸œè¥¿\n\n```js\nexport {\n  createStore,\n  combineReducers,\n  bindActionCreators,\n  applyMiddleware,\n  compose,\n  __DO_NOT_USE__ActionTypes\n}\n```\n\næˆ‘ä»¬ä¸€ä¸ªä¸ªå¼€å§‹ã€‚é¦–å…ˆæ˜ å…¥çœ¼å¸˜çš„æ˜¯createStore\n\n## createStore\n\nå¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹æ˜¯æ€ä¹ˆç”¨ã€‚ä»¥ä¸‹é‡‡ç”¨[æˆ‘çš„æºç ](https://github.com/DerrickTel/redux-source-analyse)é˜…è¯»é‡Œé¢çš„ä»£ç ï¼š\n\n```js\n// middleware\nconst logger = (store:any) => (next:any) => (action:any) => {\n  // debugger\n  console.info('dispatching', action)\n  let result = next(action);\n  console.log('next state', store.getState())\n  return result\n}\n\nlet store = createStore(rootReducer, applyMiddleware(logger));\n```\n\nå†çœ‹çœ‹æºç çš„createStoreã€‚\n\n### å‚æ•°\n\n```js\nexport default function createStore<\n  S,\n  A extends Action,\n  Ext = {},\n  StateExt = never\n>(\n  reducer: Reducer<S, A>,\n  preloadedState?: PreloadedState<S> | StoreEnhancer<Ext, StateExt>,\n  enhancer?: StoreEnhancer<Ext, StateExt>\n): Store<ExtendState<S, StateExt>, A, StateExt, Ext> & Ext {\n  //.. ä¸€äº›æ ¡éªŒçš„æºç å°±ä¸ä»‹ç»äº†ï¼Œæƒ³äº†è§£çš„å¯ä»¥çœ‹æˆ‘çš„GitHubï¼Œä¸Šé¢æœ‰æ³¨é‡Š\n  let currentReducer = reducer // ä¸´æ—¶å­˜æ”¾ reducer çš„åœ°æ–¹\n  let currentState = preloadedState as S // ä¸´æ—¶å­˜æ”¾ state çš„åœ°æ–¹\n  let currentListeners: (() => void)[] | null = [] // ç›‘å¬é˜Ÿåˆ—\n  let nextListeners = currentListeners // å¼•ç”¨èµ‹å€¼, å’Œæ­£å¼çš„é˜Ÿåˆ—è¿›è¡ŒåŒºåˆ†, åˆ«æœ‰ä»–ç”¨\n  let isDispatching = false // æ˜¯ä¸æ˜¯æ­£åœ¨dispatch\n  // ... \n}\n```\n\ncreateStoreæ¥æ”¶3ä¸ªå‚æ•°`reducer`ï¼Œ`preloadedState`ï¼Œ`enhancer`ã€‚\n\næˆ‘ä»¬ä¸€ä¸€å‰–æä»–ä»¬åˆ†åˆ«æ˜¯åšä»€ä¹ˆçš„ã€‚\n\n#### reducer\n\nè¿™ä¸ªå¤§å®¶å¤ªç†Ÿæ‚‰äº†ã€‚å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åæˆ‘ä»¬åœ¨é‡Œé¢å†™`switch`ï¼Œ`switch` `dispatch`è¿‡æ¥ `action`çš„`type`ã€‚ç„¶ååšå¯¹åº”çš„æ“ä½œã€‚æœ€åè¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯å…¨æ–°çš„`store`çš„æ•°æ®ã€‚ä¸ºä»€ä¹ˆæ˜¯è¿”å›ä¸€ä¸ªå…¨æ–°çš„`store`ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢jsçš„å¼•ç”¨ã€‚\n\nå¿˜è®°çš„ï¼Œæˆ–è€…ä¸å¤ªæ‡‚çš„åŒå­¦å¯ä»¥çœ‹ä¸€ä¸‹ä¸‹é¢çš„demoï¼š\n\n```js\nconst initState = {\n  todos: []\n}\n\n// è¿™é‡Œé¢æˆ‘ä»¬ä¸€èˆ¬ä¼šèµ‹å€¼ä¸Šé»˜è®¤çš„stateï¼Œå› ä¸ºåç»­å¯èƒ½ä¼šç”¨åˆ°é»˜è®¤çš„æƒ…å†µï¼Œåƒæ•°ç»„ä¹‹ç±»çš„å°±éå¸¸å¸¸è§ã€‚\nconst todos = (state = initState, action) => {\n  switch (action.type) {\n    case 'ADD_TODO':\n      return {\n        ...state\n      }\n    case 'TOGGLE_TODO':\n      return state.map(\n        todo =>\n          todo.id === action.id ? { ...todo, completed: !todo.completed } : todo\n      )\n    default: {\n      return state\n    }\n      \n  }\n}\n\nexport default todos\n```\n\n\n\n#### preloadedState\n\nè¿™ä¸ªå…¶å®æˆ‘ä»¬ç”¨çš„ä¸æ˜¯å¾ˆå¤šï¼Œå› ä¸ºæˆ‘ä»¬ä¸€èˆ¬é¢„å­˜çš„éƒ½ç›´æ¥å¸è½½`reducer`é‡Œé¢äº†ã€‚åƒğŸ‘†ğŸŒ°é‡Œé¢çš„`state = initState`å°±çœå»äº†æˆ‘ä»¬çš„ä¼ é€’è¿™ä¸ªå‚æ•°çš„è¿‡ç¨‹ã€‚è€Œä¸”æ•°æ®æ”¾åœ¨`reducer`é‡Œé¢ä¹Ÿæ›´åŠ æ¸…æ™°ã€‚\n\nå“ªæ€•æ˜¯åœ¨[é˜®ä¸€å³°è€å¸ˆçš„æ—¥å¿—](http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_one_basic_usages.html)é‡Œé¢ä¹Ÿæ˜¯è¿™æ ·æ•™çš„ã€‚\n\n```js\nconst defaultState = 0;\nconst reducer = (state = defaultState, action) => {\n  switch (action.type) {\n    case 'ADD':\n      return state + action.payload;\n    default: \n      return state;\n  }\n};\n\nconst state = reducer(1, {\n  type: 'ADD',\n  payload: 2\n});\n```\n\nä¸­æ–‡ç¿»è¯‘å°±æ˜¯ï¼šé¢„å­˜çš„`state`ã€‚ä¹Ÿå¯ä»¥ç†è§£ä¸ºåˆå§‹çš„ï¼Œé»˜è®¤çš„ã€‚å› ä¸ºæˆ‘ä»¬ä¸€èˆ¬åœ¨ä¹Ÿé¡µé¢é‡Œé¢ç›´æ¥æ‹¿`store`é‡Œé¢çš„å€¼ï¼Œæˆ–è€…`map`æˆ–è€…ä»€ä¹ˆã€‚å¾ˆæœ‰å¯èƒ½å°±ä¼šæŠ¥é”™ï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰é»˜è®¤å€¼æˆ‘ä»¬ç›´æ¥ç”¨`map`å°±ä¼šæŠ¥é”™....ç›¸ä¿¡åˆšåˆšå¼€å§‹ç”¨çš„å°ä¼™ä¼´åº”è¯¥æœ‰è¿™æ ·çš„å›°æƒ‘ã€‚\n\nä½†æ˜¯ï¼Œæˆ‘ä»¬é€šå¸¸éƒ½æ˜¯ä¼ ä¸¤ä¸ªå‚æ•°ï¼Œé‚£å’‹åŠï¼Ÿæˆ‘çœ‹ä»–å¥½åƒæ˜¯é¡ºåºè¯»å–çš„è¯¶...\n\nreduxå…¼å®¹æˆ‘ä»¬å•¦ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‰é¢æœ‰ä¸€æ®µä»£ç æ˜¯ä¸ºäº†åšè¿™ä¸ªçš„\n\n```js\n// preloadedStateä¸ºfunction enhancerä¸ºundefinedçš„æ—¶å€™è¯´æ˜initStateæ²¡æœ‰åˆå§‹åŒ–, ä½†æ˜¯æœ‰middleware\nif (typeof preloadedState === 'function' && typeof enhancer === 'undefined') {\n  enhancer = preloadedState // æŠŠ preloadedState èµ‹å€¼ç»™ enhancer\n  preloadedState = undefined // preloadedStateèµ‹å€¼undeifined\n}\n```\n\n\n\n#### enhancer\n\nä¸­æ–‡ç¿»è¯‘æ˜¯ï¼šå¢å¼ºã€‚å…¶å®å°±æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ä¸­é—´ä»¶ï¼Œç”¨äºå¢å¼ºæˆ‘ä»¬çš„`redux`ã€‚å¸¸è§æœ‰çš„æœ‰`log`ï¼Œ`redux-thunk`ï¼Œ`redux-saga`ç­‰ç­‰ã€‚\n\næˆ‘ä»¬å‘ç°ä»£ç é‡Œé¢æœ‰ä¸€æ®µæ˜¯è¿™æ ·çš„ï¼š\n\n```js\n// debugger\n// å¦‚æœå‚æ•°enhancerå­˜åœ¨\n  if (typeof enhancer !== 'undefined') {\n    // å¦‚æœenhancerå­˜åœ¨ï¼Œé‚£ä»–å¿…é¡»æ˜¯ä¸ªfunction, å¦åˆ™throw Errorå“ˆ\n    if (typeof enhancer !== 'function') {\n      throw new Error('Expected the enhancer to be a function.')\n    }\n    /**\n     * ä¼ å…¥ç¬¦åˆå‚æ•°ç±»å‹çš„å‚æ•°ï¼Œå°±å¯ä»¥æ‰§è¡Œ enhancer,\n     * ä½†æ˜¯è¿™ä¸ªreturnæ·±æ·±çš„å¸å¼•äº†æˆ‘, å› ä¸ºè¯´æ˜æœ‰applyMiddlewareçš„æ—¶å€™åé¢çš„éƒ½ä¸ç”¨çœ‹äº† ??? å½“ç„¶\u001dä¸å¯èƒ½\n     * å¯æ˜¯applyMiddlewareå…¶å®æ˜¯å¿…ç”¨é¡¹ï¼Œæ‰€ä»¥çŒœæƒ³ä¸€ä¸‹applyMiddlewareå¼ºåŒ–storeä¹‹åä¼šenhancerèµ‹å€¼undefinedï¼Œå†æ¬¡è°ƒç”¨createStore\n     * ä¸Šä¸‹æ‰“ä¸ªdebuggerçœ‹ä¸€ä¸‹æ‰§è¡Œé¡ºåº(debuggerä½ç½®ä»¥æ³¨é‡Š)ï¼Œæœç„¶ä¸å‡ºæ‰€æ–™\n     * å¥½äº†ï¼Œ å‡è®¾æˆ‘ä»¬è¿˜ä¸çŸ¥é“applyMiddleware()è¿™ä¸ªfuncrionå…·ä½“å¹²äº†ä»€ä¹ˆï¼Œ\n     * åªçŸ¥é“ä»–åšäº†ä¸€äº›å¤„ç†ç„¶åé‡æ–°è°ƒç”¨äº†createStoreå¹¶ä¸”enhancerå‚æ•°ä¸ºundefined\n     * å…ˆè®°ä¸‹ï¼Œåç»­åœ¨çœ‹applyMiddlewareï¼Œ å› ä¸ºæˆ‘ä»¬ç°åœ¨è¦çœ‹çš„æ˜¯createStore\n     * * */\n    // debugger\n    return enhancer(createStore)(reducer, preloadedState)\n  }\n```\n\nè¿™ä¸ªé‡ç‚¹å…¶å®åœ¨äº`applyMiddleware`ï¼Œåç»­æˆ‘ä»¬ä¼šä»‹ç»åˆ°çš„ã€‚\n\n### å†…ç½®å˜é‡\n\nè¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œæˆ‘å°±éƒ½å†™åœ¨æ³¨é‡Šé‡Œé¢äº†\n\n```js\nlet currentReducer = reducer // ä¸´æ—¶å­˜æ”¾ reducer çš„åœ°æ–¹\nlet currentState = preloadedState as S // ä¸´æ—¶å­˜æ”¾ state çš„åœ°æ–¹\nlet currentListeners: (() => void)[] | null = [] // ç›‘å¬é˜Ÿåˆ—\nlet nextListeners = currentListeners // å¼•ç”¨èµ‹å€¼, å’Œæ­£å¼çš„é˜Ÿåˆ—è¿›è¡ŒåŒºåˆ†, åˆ«æœ‰ä»–ç”¨\nlet isDispatching = false // æ˜¯ä¸æ˜¯æ­£åœ¨dispatch\n```\n\n\n\n### å†…ç½®æ–¹æ³•\n\n#### ensureCanMutateNextListeners\n\nè¿™é‡Œå…¶å®æ˜¯ä¸ºäº†å¼„ä¸¤ä¸ªæ•°ç»„ï¼Œä¸€ä¸ªæ“ä½œä¸€ä¸ªåŸæ•°ç»„è€ŒæŠ½è±¡çš„ä¸€ä¸ªæ–¹æ³•ã€‚\n\næœ‰ä¸€ä¸ªå°çš„çŸ¥è¯†ç‚¹ï¼Œ`===`å¯¹äºæ•°ç»„çš„åˆ¤æ–­åªèƒ½ç”¨äºåˆ¤æ–­æ˜¯å¦æ˜¯åŒä¸€ä¸ªå†…å­˜åœ°å€ï¼Œä¸ä¿¡çš„è¯å¤§å®¶å¯ä»¥è¯•è¯•ã€‚\n\n```js\nconst a = [1, 2];\nconst b = [1, 2];\nconst c = a;\nconsole.log(a === b);\nconsole.log(a === c);\nconsole.log(b === c);\n```\n\n\n\næ‰€ä»¥ä¸‹é¢çš„æ“ä½œçš„å°±å˜å¾—å¾ˆå¥½ç†è§£äº†ã€‚åœ¨æˆ‘ä»¬æ“ä½œ`listener`ä¹‹å‰ä¼šå…ˆå­˜å‚¨ä¸€ä¸‹å¿«ç…§ã€‚å¤§å®¶è¦å¤šç†è§£ä¸€ä¸‹ï¼Œå› ä¸ºåé¢å¾ˆå¤šåœ°æ–¹ä¼šç”¨åˆ°è¿™ä¸ªå‡½æ•°ã€‚\n\n```js\n// Googleç¿»è¯‘: ç¡®ä¿å¯ä»¥ä½¿ä¸‹ä¸€ä¸ªä¾¦å¬å™¨çªå˜\n  // æˆ‘çš„ç†è§£æ˜¯å­˜å‚¨ä¸€ä¸‹å¿«ç…§, ä»¥ä¸ºæ¥ä¸‹æ¥å¯èƒ½ä¼šè¿›è¡Œæ“ä½œ.\n  function ensureCanMutateNextListeners() {\n    // æ˜¯å¦ç›¸åŒ, æ˜¯ä¸æ˜¯ç®€å•çš„å¼•ç”¨èµ‹å€¼, æ˜¯çš„è¯å°±æµ…æ‹·è´ä¸€ä»½\n    if (nextListeners === currentListeners) {\n      nextListeners = currentListeners.slice()\n    }\n  }\n```\n\n\n\n#### getState\n\nè¿™ä¸ªå‡½æ•°å¾ˆç®€å•ï¼Œé¦–å…ˆåˆ¤æ–­ä¸€ä¸‹æ˜¯å¦æ˜¯åœ¨dispatchï¼Œç„¶åè¿”å›å½“å‰çš„stateã€‚\n\n```js\n// è·å–å½“å‰çš„state\n  function getState(): S {\n    // å¦‚æœæ­£åœ¨dispatch å°±æŠ¥é”™,å› ä¸ºè¦è·å–æœ€æ–°çš„state, dispatchå¾ˆæœ‰å¯èƒ½ä¼šæ”¹å˜state\n    if (isDispatching) {\n      throw new Error(\n        'You may not call store.getState() while the reducer is executing. ' +\n          'The reducer has already received the state as an argument. ' +\n          'Pass it down from the top reducer instead of reading it from the store.'\n      )\n    }\n\n    return currentState as S\n  }\n```\n\næœ‰æ²¡æœ‰æ„Ÿè§‰reduxå¥½åƒä¹Ÿä¸è¿‡å¦‚æ­¤~~æ¥ç€çœ‹å“¦ã€‚\n\n#### subscribe\n\nä¸­æ–‡ç¿»è¯‘ï¼šè®¢é˜…è€…ã€‚\n\nå…¶å®ä¹Ÿå¾ˆå¥½ç†è§£ã€‚å¯èƒ½æœ‰ç”¨è¿‡`redux`çš„åŒå­¦éƒ½æœ‰ç”¨è¿‡è¿™ä¸ªã€‚\n\næˆ‘ä¸¾ä¸€ä¸ªæ€ä¹ˆç”¨çš„ğŸŒ°ï¼š\n\n```js\nconst unSubscribe = store.subscribe(() => {\n  console.log('store.subscribe', store.getState())\n})\n// å–æ¶ˆè®¢é˜…å°±ç›´æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°å°±å¥½äº†\n// unSubscribe();\n```\n\nä¸€æ—¦è§¦å‘äº†`dispatch`å°±ä¼šè§¦å‘è¿™ä¸ªå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å†™ä¸Šå»çš„`console.log()`\n\nç„¶åæˆ‘ä»¬å†æ¥çœ‹è¿™ä¸ªå‡½æ•°ã€‚\n\n```js\nfunction subscribe(listener: () => void) {\n    // listenerå¿…é¡»ä¸ºå‡½æ•°ï¼Œå› ä¸ºè¦ä»¥å›è°ƒå‡½æ•°çš„æ–¹å¼æ¥è§¦å‘ã€‚\n    if (typeof listener !== 'function') {\n      throw new Error('Expected the listener to be a function.')\n    }\n\n    // å¦‚æœæ­£åœ¨dispatchä¸­åˆ™æŠ›é”™ï¼Œå’ŒgetStateåŒç†\n    if (isDispatching) {\n      throw new Error(\n        'You may not call store.subscribe() while the reducer is executing. ' +\n          'If you would like to be notified after the store has been updated, subscribe from a ' +\n          'component and invoke store.getState() in the callback to access the latest state. ' +\n          'See https://redux.js.org/api/store#subscribelistener for more details.'\n      )\n    }\n\n    // æ˜¯å¦æœ‰ç›‘å¬è€…,æˆ–è€…æ˜¯å¦è¢«è®¢é˜…\n    let isSubscribed = true\n\n    // ä¿å­˜å¿«ç…§, æ‹·è´ä¸€ä»½ç›‘å¬é˜Ÿåˆ—åˆ°nextListeners(å¦‚æœæ˜¯å¼•ç”¨çš„è¯)\n    ensureCanMutateNextListeners()\n    // å¾€ç›‘å¬é˜Ÿåˆ—é‡Œé¢æ¨å…¥ä¸€ä¸ªç›‘å¬è€…\n    nextListeners.push(listener)\n\n    // è¿”å›ä¸€ä¸ªå–æ¶ˆè®¢é˜…çš„æ–¹æ³•\n    return function unsubscribe() {\n      // å¦‚æœæ²¡æœ‰è¢«è®¢é˜…, ç›´æ¥shut down\n      if (!isSubscribed) {\n        return\n      }\n\n      // å¦‚æœæ­£åœ¨dispatch æŠ¥é”™ï¼Œå’Œä¸Šé¢ğŸ‘†åŒç†\n      if (isDispatching) {\n        throw new Error(\n          'You may not unsubscribe from a store listener while the reducer is executing. ' +\n            'See https://redux.js.org/api/store#subscribelistener for more details.'\n        )\n      }\n\n      // å–æ¶ˆè®¢é˜…\n      isSubscribed = false\n\n      // ä¾æ—§æ˜¯æ‹¿ä¸‹å½“å‰çš„ç›‘å¬é˜Ÿåˆ—ï¼Œä¸ç„¶ç­‰ä¸€ä¸‹åˆ é™¤çš„æ—¶å€™ï¼Œä¼šåˆ æ‰æ‰€æœ‰çš„é˜Ÿåˆ—ã€‚å…¶å®æˆ‘ä»¬åªéœ€è¦åˆ æ‰ç›‘å¬è€…å°±å¥½äº†\n      ensureCanMutateNextListeners()\n      // æ‰¾åˆ°ç›‘å¬è€…\n      const index = nextListeners.indexOf(listener)\n      // åˆ é™¤è¿™ä¸ªç›‘å¬è€…\n      nextListeners.splice(index, 1)\n      // æ¸…ç©ºå½“å‰çš„ç›‘å¬é˜Ÿåˆ—\n      currentListeners = null\n    }\n  }\n```\n\n\n\n#### dispatch\n\nè¿™ä¸ªå‡½æ•°å¯ä»¥è¯´æ˜¯å²ä¸Šæœ€TMå¸¸ç”¨çš„å‡½æ•°çš„ï¼Œæœ€TMé‡è¦ä¹‹é‡ä¸­ä¹‹é‡ï¼Œè€Œä¸”è¿˜æ˜¯æ›´æ–°storeçš„å”¯ä¸€æ–¹æ³•ï¼Œæ³¨æ„è¿™ä¸ªå”¯ä¸€ã€‚ä½†æ˜¯åˆéå¸¸å¥½ç†è§£ã€‚\n\næˆ‘ä»¬è¿˜æ˜¯å…ˆçœ‹ä¸€ä¸ªğŸŒ°å§ï¼š\n\n```js\nprops.dispatch({\n  type: 'TEST',\n  test1: 1,\n  test2: 2,\n  // ...\n})\n```\n\nç„¶åï¼Œæˆ‘ä»¬çš„storeå°±æ”¹å˜äº†ï¼Œå°±ä¼šæ›´æ–°propsï¼Œæ¥è§¦å‘renderï¼Œè§†å›¾å¯èƒ½å°±ä¼šæ›´æ–°ä¹‹ç±»çš„ã€‚\n\nğŸ‘Œï¼Œç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªä¸€ç‚¹ç‚¹äº†è§£ï¼Œæ¥çœ‹ä¸€ä¸‹æºç ã€‚\n\n```js\n// ä¿®æ”¹storeçš„å”¯ä¸€æ–¹æ³•\n  function dispatch(action: A) {\n    // actionå¿…é¡»æ˜¯ä¸€ä¸ªå¯¹è±¡\n    if (!isPlainObject(action)) {\n      throw new Error(\n        'Actions must be plain objects. ' +\n          'Use custom middleware for async actions.'\n      )\n    }\n\n    // actionå¿…é¡»æ‹¥æœ‰ä¸€ä¸ªtype\n    if (typeof action.type === 'undefined') {\n      throw new Error(\n        'Actions may not have an undefined \"type\" property. ' +\n          'Have you misspelled a constant?'\n      )\n    }\n\n    // å¦‚æœæ­£åœ¨dispatchingï¼Œé‚£ä¹ˆä¸æ‰§è¡Œdispatchæ“ä½œã€‚\n    if (isDispatching) {\n      throw new Error('Reducers may not dispatch actions.')\n    }\n\n    // è®¾ç½®dispatchingçŠ¶æ€ä¸ºtrueï¼Œå¹¶ä½¿ç”¨reducerç”Ÿæˆæ–°çš„çŠ¶æ€æ ‘ã€‚\n    try {\n      isDispatching = true\n      currentState = currentReducer(currentState, action)\n    } finally {\n      // å½“è·å–æ–°çš„çŠ¶æ€æ ‘å®Œæˆåï¼Œè®¾ç½®çŠ¶æ€ä¸ºfalse.\n      isDispatching = false\n    }\n\n    // å°†ç›®å‰æœ€æ–°çš„ç›‘å¬æ–¹æ³•æ”¾ç½®åˆ°å³å°†æ‰§è¡Œçš„é˜Ÿåˆ—ä¸­éå†å¹¶ä¸”æ‰§è¡Œ\n    const listeners = (currentListeners = nextListeners)\n    for (let i = 0; i < listeners.length; i++) {\n      const listener = listeners[i]\n      listener()\n    }\n\n    // å°†è§¦å‘çš„actionè¿”å›\n    return action\n  }\n```\n\nå…¶å®çœ‹ä¸‹æ¥ï¼Œæˆ‘ä»¬å‘ç°ä»–å°±æ˜¯ç®€å•çš„å°†æˆ‘ä»¬çš„å‚æ•°è½¬å‘ç»™äº†`reducer`ï¼Œç„¶åæ‰§è¡Œäº†æˆ‘ä»¬ä¹‹å‰å»ºç«‹çš„ç›‘å¬é˜Ÿåˆ—ã€‚\n\næœ‰æ²¡æœ‰åŒå­¦ä¼šå’Œæˆ‘æƒ³çš„ä¸€æ ·ï¼Œé‚£ä¸ºä»€ä¹ˆä¸ç›´æ¥æ‰§è¡Œ`reducer`ï¼Ÿå› ä¸ºæˆ‘ä»¬é‡Œé¢æœ‰è®¢é˜…å‡½æ•°éœ€è¦æ‰§è¡Œï¼Œå¯¹å§ï¼Œè€Œä¸”è¿˜æœ‰`dispatch`çš„çŠ¶æ€éœ€è¦é€šçŸ¥`store`ï¼Œä¸ç„¶`getState`ä¹‹ç±»çš„ï¼Œæˆ‘ä»¬ä¹‹å‰æœ‰çœ‹åˆ°åˆ¤æ–­`dispatch`çŠ¶æ€çš„å¾ˆå¯èƒ½å‡ºç°åå·®ã€‚\n\næˆ‘ä»¬åªéœ€è¦`connect`ä¸€ä¸‹å°±å¯ä»¥ç›´æ¥åœ¨`props`é‡Œé¢æ‹¿åˆ°`dispatch`ï¼Œä¸éœ€è¦`import`ä¹‹ç±»çš„ï¼Œå¾ˆç®€æ´ã€‚\n\n#### replaceReducer\n\nè¿™ä¸ªå‡½æ•°é¡¾åæ€ä¹‰ï¼Œä¹Ÿå¾ˆå¥½ç†è§£ï¼Œæˆ‘å°±ä¸å¤šåšè§£é‡Šäº†ï¼Œç›´æ¥çœ‹æ³¨é‡Šå§ã€‚\n\n```js\n// è¿™ä¸ªå…¶å®å¾ˆå°‘ç”¨åˆ°, å®˜æ–¹çš„ä»‹ç»æ˜¯ä¸»è¦æ˜¯ç”¨äºåŠ¨æ€æ›¿æ¢reducerçš„æ—¶å€™ä¼šç”¨åˆ°\n  function replaceReducer<NewState, NewActions extends A>(\n    nextReducer: Reducer<NewState, NewActions>\n  ): Store<ExtendState<NewState, StateExt>, NewActions, StateExt, Ext> & Ext {\n    if (typeof nextReducer !== 'function') {\n      throw new Error('Expected the nextReducer to be a function.')\n    }\n\n    // ä¿®æ”¹reducer\n    // å½“å‰çš„currentReduceræ›´æ–°ä¸ºå‚æ•°nextReducer\n    // TODO: do this more elegantly\n    ;((currentReducer as unknown) as Reducer<\n      NewState,\n      NewActions\n    >) = nextReducer\n\n    // This action has a similar effect to ActionTypes.INIT.\n    // Any reducers that existed in both the new and old rootReducer\n    // will receive the previous state. This effectively populates\n    // the new state tree with any relevant data from the old one.\n    // å’ŒINITçš„dispatchç›¸åŒï¼Œå‘é€ä¸€ä¸ªdispatchåˆå§‹åŒ–stateï¼Œè¡¨æ˜ä¸€ä¸‹æ˜¯REPLACE\n    // è‡ªå·±ğŸ‘€çœ‹ä¸€ä¸‹utilsæ–¹æ³•çš„ActionTypesï¼Œ éšæ€§çš„éšæœºæ•°\n    dispatch({ type: ActionTypes.REPLACE } as A)\n    // change the type of the store by casting it to the new store\n    return (store as unknown) as Store<\n      ExtendState<NewState, StateExt>,\n      NewActions,\n      StateExt,\n      Ext\n    > &\n      Ext\n  }\n```\n\nå‘ç°ä¸¤ä¸ªå¾ˆæœ‰è¶£çš„ç‚¹ï¼š\n\n1. å¤§ä½¬ä»¬ä¹Ÿä¼šå†™`todo`ï¼Œå…³é”®æ˜¯ï¼ä»–ä»¬çš„`TODO`å¹´å¤´æœ‰ç‚¹ä¹…äº†ï¼Œå“ˆå“ˆå“ˆå“ˆï¼Œ5å¹´äº†ï¼Œçœ‹æ ·å­ä¸æ˜¯åªæœ‰æˆ‘ä¸ä¼šç»§ç»­ä¼˜åŒ–çš„ï¼Œå“ˆå“ˆå“ˆå“ˆã€‚ä¹Ÿæœ‰å¯èƒ½æ˜¯æ²¡æœ‰æƒ³åˆ°æ›´å¥½çš„æ–¹æ³•ã€‚ã€‚ã€‚\n2. é‡Œé¢ä»–è‡ªå·±`dispatch`äº†ä¸€ä¸ªï¼Œ`ActionTypes.REPLACE`ã€‚\n\nokï¼Œæˆ‘ä»¬ä¸€æ¢ç©¶ç«Ÿï¼Œè¿™ä¸ª`ActionTypes.REPLACE`\n\næ‰’å¼€è¡£æœï¼ç›´æ¥å¼€çœ‹ğŸ‘€ï¼\n\n```js\n/**\n * These are private action types reserved by Redux.\n * For any unknown actions, you must return the current state.\n * If the current state is undefined, you must return the initial state.\n * Do not reference these action types directly in your code.\n */\n\nconst randomString = () =>\n  Math.random().toString(36).substring(7).split('').join('.')\n\nconst ActionTypes = {\n  INIT: `@@redux/INIT${/* #__PURE__ */ randomString()}`,\n  REPLACE: `@@redux/REPLACE${/* #__PURE__ */ randomString()}`,\n  PROBE_UNKNOWN_ACTION: () => `@@redux/PROBE_UNKNOWN_ACTION${randomString()}`\n}\n\nexport default ActionTypes\n\n```\n\nå…¶å®å°±æ˜¯ä¸€ä¸ªä¸æƒ³å’Œæˆ‘ä»¬çš„`type`å†²çªçš„éšæœºæ•°ï¼Œå‘Šè¯‰`redux`ï¼Œè¿™ä¸ªæ˜¯ä»–ä»¬å†…éƒ¨çš„ä¸€ä¸ª`dispatch`è€Œå·²ã€‚\n\n#### observable\n\nè¿™ä¸ªç©æ„ï¼Œå…¶å®æˆ‘æ˜¯ä¸å¤ªæ‡‚ä»–æ˜¯å¹²ä»€ä¹ˆçš„ã€‚ã€‚ã€‚å…¨å±€æœä¹Ÿæ²¡æœ‰æœå‡ºæ¥ï¼Œè€Œä¸”æˆ‘ä¹Ÿæ²¡ç”¨è¿‡ã€‚ã€‚ã€‚\n\nå¤§å®¶çœ‹æ³¨é‡Šå§ï¼Œä¸è¿‡å¤šè§£é‡Šï¼Œå¦‚æœæœ‰æ‡‚å“¥ï¼Œæ¬¢è¿ä¸€èµ·äº¤æµè®¨è®ºå‘€ã€‚\n\n```js\n// æŸ¥è¯¢ä¹‹å,ä¹Ÿæ²¡å‘ç°æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ç”¨å¤„...æš‚æ—¶è·³è¿‡,å¦‚æœæœ‰å¸…å“¥çœ‹åˆ°çš„è¯å¯ä»¥ä¸åèµæ•™\n  function observable() {\n    const outerSubscribe = subscribe\n    return {\n      /**\n       The minimal observable subscription method.\n       @param observer Any object that can be used as an observer.\n       The observer object should have a `next` method.\n       @returns An object with an `unsubscribe` method that can\n       be used to unsubscribe the observable from the store, and prevent further\n       emission of values from the observable.\n       */\n      subscribe(observer: unknown) {\n        if (typeof observer !== 'object' || observer === null) {\n          throw new TypeError('Expected the observer to be an object.')\n        }\n\n        //è·å–è§‚å¯Ÿç€çš„çŠ¶æ€\n        function observeState() {\n          const observerAsObserver = observer as Observer<S>\n          if (observerAsObserver.next) {\n            observerAsObserver.next(getState())\n          }\n        }\n\n        observeState()\n        //è¿”å›å–æ¶ˆè®¢é˜…çš„æ–¹æ³•\n        const unsubscribe = outerSubscribe(observeState)\n        return { unsubscribe }\n      },\n\n      [$$observable]() {\n        return this\n      }\n    }\n  }\n```\n\n\n\nå…¶å®ä»–å†…éƒ¨è¿˜è‡ªå·±æ‰§è¡Œäº†ä¸€ä¸‹`dispatch`ï¼Œåœ¨`createStore`çš„æœ€åã€‚\n\n```js\ndispatch({ type: ActionTypes.INIT } as A)\n```\n\nå…¶å®ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œæˆ‘ä»¬`createStore`çš„æ—¶å€™ï¼Œåˆå§‹çš„`state`å°±æ˜¯è¿™æ ·æ¥çš„~\n\né‡Œé¢çš„`INIT`ï¼Œåœ¨æˆ‘ä»¬ä¹‹å‰`REPLACE`é‡Œé¢ä¹Ÿæœ‰ä»‹ç»ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªéšæœºæ•°è€Œå·²ã€‚\n\n## applyMiddleware\n\nè¿™ä¸ªå‘ï¼Œæ˜¯ä¹‹å‰åœ¨`createStore`çš„`ensureCanMutateNextListeners`åŸ‹ä¸‹çš„ï¼Œç°åœ¨æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹è¿™ä¸ªã€‚\n\nè¿™ä¸ªreduxæ‹“å±•dispatchçš„å”¯ä¸€çš„æ ‡å‡†çš„æ–¹æ³•ã€‚\n\né¦–å…ˆï¼Œæˆ‘ä»¬å¾—çŸ¥é“æ€ä¹ˆç”¨ã€‚æˆ‘è´´ä¸‹æˆ‘è‡ªå·±demoã€‚\n\n```js\n// middleware\nconst logger = (store:any) => (next:any) => (action:any) => {\n  // debugger\n  console.info('dispatching', action)\n  const result = next(action);\n  console.log('next state', store.getState())\n  return result\n}\n```\n\nè¿™ä¸ªæ˜¯å®˜æ–¹çš„demoï¼Œä¸äº†è§£çš„ï¼Œ[ç‚¹æˆ‘å¿«é€Ÿäº†è§£](https://www.redux.org.cn/docs/advanced/Middleware.html)\n\nokï¼Œæˆ‘ä»¬ç›´æ¥è´´æºç ï¼Œå¾ˆçŸ­ï¼Œä½†æ˜¯æœ‰å¾ˆå¤šå¥¥å¦™ï¼ˆå¥¥å¦™æ‰“é’±ï¼ï¼‰ã€‚\n\n```js\nexport default function applyMiddleware(\n  ...middlewares: Middleware[]\n): StoreEnhancer<any> {\n  return (createStore: StoreEnhancerStoreCreator) => <S, A extends AnyAction>(\n    reducer: Reducer<S, A>,\n    preloadedState?: PreloadedState<S>\n  ) => {\n    const store = createStore(reducer, preloadedState)\n    let dispatch: Dispatch = () => {\n      throw new Error(\n        'Dispatching while constructing your middleware is not allowed. ' +\n          'Other middleware would not be applied to this dispatch.'\n      )\n    }\n\n    const middlewareAPI: MiddlewareAPI = {\n      getState: store.getState,\n      dispatch: (action, ...args) => dispatch(action, ...args)\n    }\n    const chain = middlewares.map(middleware => middleware(middlewareAPI))\n    dispatch = compose<typeof dispatch>(...chain)(store.dispatch)\n\n    return {\n      ...store,\n      dispatch\n    }\n  }\n}\n```\n\nçœ‹èµ·æ¥å¾ˆçŸ­ï¼Œä½†æ˜¯å´æœ‰å¾ˆå¤šæ·±å¥¥çš„åœ°æ–¹ã€‚ä¸€ä¸ªä¸ªæ¥ã€‚\n\nåœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸€ä¸‹å‡½æ•°æŸ¯é‡ŒåŒ–ã€‚ç›´æ¥ä¸Šdemoå¸®åŠ©ç†è§£\n\n```js\nfunction test(a) {\n  return function test2(b){\n    console.log(a + b)\n  }\n}\n\nconst t = test(1);\nt(2); // 3\n```\n\nè¿™é‡Œå°±æ˜¯ä¸€ä¸ªç®€å•çš„å‡½æ•°æŸ¯é‡ŒåŒ–ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå­˜å‚¨ä¸€ä¸‹ç¬¬ä¸€æ¬¡ä¼ å…¥çš„å‚æ•°ï¼Œåé¢å¦‚æœè¿™ä¸ª`1`ä¼šå¤ç”¨çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å®šä¹‰çš„å˜é‡`t`å°±å¯ä»¥åœ¨å¾ˆå¤šåœ°æ–¹ä½¿ç”¨ï¼Œé‡Œé¢ç”¨åˆ°äº†é—­åŒ…çš„çŸ¥è¯†ï¼Œè€Œä¸”æ˜¯éå¸¸å…¸å‹çš„é—­åŒ…ï¼Œå­˜å‚¨å½¢å‚`a`ï¼Œå®å‚`1`ã€‚\n\nè¿˜è®°å¾—æˆ‘ä»¬çš„ä½¿ç”¨ç”¨ä¾‹å—ï¼Ÿ\n\n```js\n// middleware\nconst logger = (store:any) => (next:any) => (action:any) => {\n  // debugger\n  console.info('dispatching', action)\n  const result = next(action);\n  console.log('next state', store.getState())\n  return result\n}\n```\n\nè¿™é‡Œé¢ç¬¬ä¸€ä¸ªå‚æ•°`store`å°±æ˜¯å¯¹åº”åˆ°æˆ‘ä»¬`createStore`æºç é‡Œé¢æˆ‘ä»¬æŒ–çš„å‘ã€‚\n\n```js\nif (typeof enhancer !== 'undefined') {\n    // å¦‚æœenhancerå­˜åœ¨ï¼Œé‚£ä»–å¿…é¡»æ˜¯ä¸ªfunction, å¦åˆ™throw Errorå“ˆ\n    if (typeof enhancer !== 'function') {\n      throw new Error('Expected the enhancer to be a function.')\n    }\n    /**\n     * ä¼ å…¥ç¬¦åˆå‚æ•°ç±»å‹çš„å‚æ•°ï¼Œå°±å¯ä»¥æ‰§è¡Œ enhancer,\n     * ä½†æ˜¯è¿™ä¸ªreturnæ·±æ·±çš„å¸å¼•äº†æˆ‘, å› ä¸ºè¯´æ˜æœ‰applyMiddlewareçš„æ—¶å€™åé¢çš„éƒ½ä¸ç”¨çœ‹äº† ??? å½“ç„¶\u001dä¸å¯èƒ½\n     * å¯æ˜¯applyMiddlewareå…¶å®æ˜¯å¿…ç”¨é¡¹ï¼Œæ‰€ä»¥çŒœæƒ³ä¸€ä¸‹applyMiddlewareå¼ºåŒ–storeä¹‹åä¼šenhancerèµ‹å€¼undefinedï¼Œå†æ¬¡è°ƒç”¨createStore\n     * ä¸Šä¸‹æ‰“ä¸ªdebuggerçœ‹ä¸€ä¸‹æ‰§è¡Œé¡ºåº(debuggerä½ç½®ä»¥æ³¨é‡Š)ï¼Œæœç„¶ä¸å‡ºæ‰€æ–™\n     * å¥½äº†ï¼Œ å‡è®¾æˆ‘ä»¬è¿˜ä¸çŸ¥é“applyMiddleware()è¿™ä¸ªfuncrionå…·ä½“å¹²äº†ä»€ä¹ˆï¼Œ\n     * åªçŸ¥é“ä»–åšäº†ä¸€äº›å¤„ç†ç„¶åé‡æ–°è°ƒç”¨äº†createStoreå¹¶ä¸”enhancerå‚æ•°ä¸ºundefined\n     * å…ˆè®°ä¸‹ï¼Œåç»­åœ¨çœ‹applyMiddlewareï¼Œ å› ä¸ºæˆ‘ä»¬ç°åœ¨è¦çœ‹çš„æ˜¯createStore\n     * * */\n    // debugger\n\n    return enhancer(createStore)(\n      reducer,\n      preloadedState as PreloadedState<S>\n    ) as Store<ExtendState<S, StateExt>, A, StateExt, Ext> & Ext\n  }\n```\n\nç¬¬äºŒä¸ª`next`ï¼Œå…¶å®å°±æ˜¯`middlewareAPI`é‡Œé¢çš„`dispatch`\n\n```js\nconst middlewareAPI: MiddlewareAPI = {\n      getState: store.getState,\n      dispatch: (action, ...args) => dispatch(action, ...args),\n      test:2,\n    }\n```\n\nå¢åŠ ä¸€ä¸ª`log`åœ¨`middleware`é‡Œé¢å°±å¯ä»¥çŸ¥é“äº†\n\n```js\nconst logger = (store:any) => (next:any) => (action:any) => {\n  // debugger\n  \n  console.log(store)\n  console.log('next===',next)\n  console.log(action)\n  console.info('dispatching', action)\n  // const result = next(action);\n  console.log('next state', store.getState())\n  // return result\n}\n```\n\nè¿™ä¸ªæ—¶å€™`log`çš„æ˜¯æˆ‘ä»¬åœ¨`createStore`é‡Œé¢çš„`dispatch`ï¼Œè¿˜å‡ºç°äº†æˆ‘ä»¬çš„æ³¨é‡Š\n\nè¯´æ˜`next`è¿™ä¸ªå‚æ•°å°±æ˜¯å¯¹åº”çš„`middlewareAPI`é‡Œé¢çš„`dispatch`ä¹Ÿå°±æ˜¯è¯´æ˜¯`createStore`é‡Œé¢çš„`dispatch`ã€‚\n\n\n\nç¬¬ä¸‰ä¸ªå‚æ•°`action`\n\nå¾ˆç®€å•ï¼Œå…¶å®å°±æ˜¯æ™®æ™®é€šé€šçš„ä¸€ä¸ª`action`ã€‚ä¸è¿‡æ˜¯ä»æˆ‘ä»¬`middleaware`é‡Œé¢å¾—åˆ°çš„ã€‚è¿™ä¸ªæ²¡æœ‰ç–‘æƒ‘ã€‚\n\n\n\n> æˆ‘ä»¬ä¼šå‘ç°ä¸€ä¸ªå¾ˆæœ‰è¶£çš„äº‹æƒ…å°±æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æ³¨é‡Šæ‰è°ƒç”¨`next(action)`ï¼Œå¹¶ä¸”ä¸å°†ç»“æœ`return`çš„è¯ï¼Œè¿™ä¸ª`action`å°±ä¼šè¢«å¡ä½ï¼Œæ²¡æœ‰å‘å‡ºå»ï¼Œè¢«æˆ‘ä»¬æ‰“æ–­äº†ï¼Œæ‰€ä»¥è¿™å°±æ˜¯æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªçš„åŸå› ã€‚é‚£ä¹ˆå°±å¯ä»¥å¼•ç”³å‡ºæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰æ‰“æ–­æŸäº›æƒ…å†µä¸‹çš„actionï¼Œç„¶åéœ€è¦åœ¨é‚£äº›æƒ…å†µä¸‹ç»™actioné‡Œé¢åŠ äº›ä»€ä¹ˆï¼Œéƒ½å¯ä»¥åŠåˆ°ã€‚\n\n\n\nokï¼Œæˆ‘ä»¬çœ‹äº†ä¹‹åå¥½åƒçŸ¥é“`applyMiddleware`é‡Œé¢çš„å‚æ•°éƒ½å¯¹åº”è¿™å“ªäº›ä¸œè¥¿äº†ï¼Œä½†æ˜¯ä¼¼ä¹ä¸çŸ¥é“ä¸ºä»€ä¹ˆæ˜¯ä¸€ç§æŸ¯é‡ŒåŒ–çš„å½¢å¼æ¥å±•ç¤ºçš„ã€‚æˆ‘ä»¬çœ‹ä¸‹é¢çš„ä»£ç å°±ä¼šçŸ¥é“äº†ã€‚\n\n```js\n// è°ƒç”¨æ¯ä¸€ä¸ªè¿™æ ·å½¢å¼çš„middleware = store => next => action =>{}, \n// ç»„æˆä¸€ä¸ªè¿™æ ·[f(next)=>acticon=>next(action)...]çš„arrayï¼Œèµ‹å€¼ç»™chain\nconst chain = middlewares.map(middleware => middleware(middlewareAPI))\n// debugger\n// composeçœ‹ -> compose.jsæ–‡ä»¶\n// compose(...chain)ä¼šå½¢æˆä¸€ä¸ªè°ƒç”¨é“¾, nextæŒ‡ä»£ä¸‹ä¸€ä¸ªå‡½æ•°çš„æ³¨å†Œ, è¿™å°±æ˜¯ä¸­é—´ä»¶çš„è¿”å›å€¼è¦æ˜¯next(action)çš„åŸå› \n// å¦‚æœæ‰§è¡Œåˆ°äº†æœ€ånextå°±æ˜¯åŸç”Ÿçš„store.dispatchæ–¹æ³•\ndispatch = compose(...chain)(store.dispatch) \n```\n\né‡Œé¢æåˆ°äº†`compose`è¿™ä¸ªå‡½æ•°ï¼Œå…¶å®è¿™ä¸ªå‡½æ•°å°±æ˜¯æ•´ä¸ªä¸­é—´ä»¶çš„ç²¾é«“æ‰€åœ¨ã€‚æŸ¯é‡ŒåŒ–çš„å¥¥ä¹‰ï¼\n\n```js\nexport default function compose(...funcs: Function[]) {\n  if (funcs.length === 0) {\n    // infer the argument type so it is usable in inference down the line\n    return <T>(arg: T) => arg\n  }\n\n  if (funcs.length === 1) {\n    return funcs[0]\n  }\n\n  return funcs.reduce((a, b) => (...args: any) => a(b(...args)))\n}\n```\n\nä¸äº†è§£reduceçš„åŒå­¦å¯ä»¥[ç‚¹è¿™é‡Œ](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce)ã€‚\n\nè¿™ä¸ªcomposeå…¶å®æ˜¯ä¸€ä¸ªè°ƒç”¨é“¾ï¼Œæˆ‘ä»¬çš„æ‰€æœ‰çš„ä¸­é—´ä»¶éƒ½ä¼šæŒ‰é¡ºåºåŠ è½½ï¼Œç„¶åæ˜¯ğŸ‘‡è¿™ç§å½¢å¼\n\n```js\nmiddleware = middleware1 => middleware2 => middleware3 => middleware4 //...\n```\n\næˆ‘ä»¬é€šè¿‡ä¸€ä¸‹ä»£ç çŸ¥é“ï¼Œç¡®å®æ˜¯å¾€ä¸‹ä¼ é€’çš„ã€‚\n\n```js\n// middleware\nconst logger = (store:any) => (next:any) => (action:any) => {\n  // debugger\n  \n  console.log(store)\n  console.log('next===',next)\n  console.log(action)\n  console.info('dispatching', action)\n  action.aa = 2\n  const result = next(action);\n  console.log('next state', store.getState())\n  return result\n}\n\nconst logger2 = (store:any) => (next:any) => (action:any) => {\n  // debugger\n  \n  console.log(store)\n  console.log('next2===',next)\n  console.log('logger2==-=-=-=-=-=-=',action)\n  console.info('dispatching', action)\n  const result = next(action);\n  console.log('next state', store.getState())\n  return result\n}\n\nconst store = createStore(rootReducer, {todos:[]}, applyMiddleware(logger, logger2));\n```\n\nåœ¨`logger2`é‡Œé¢ç¡®å®æ‰“å°å‡ºæ¥`aa`è¿™ä¸ªå±æ€§çš„å€¼ï¼Œè€Œ`logger`å´æ²¡æœ‰\n\n\n\n## compose\n\nè¿™ä¸ªåœ¨ä¸Šé¢ä»‹ç»applyMiddlewareçš„æ—¶å€™è¯´è¿‡äº†ã€‚å°±ä¸å¤šè¯´äº†ã€‚\n\n\n\n## combineReducers\n\nè¿™ä¸ªä¸­æ–‡ç¿»è¯‘å°±æ˜¯ã€Šç»„åˆreducerã€‹ã€‚\n\nå…¶å®å°±æ˜¯ å­—é¢æ„æ€ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹æ€ä¹ˆç”¨å°±äº†è§£äº†ã€‚\n\n```js\nexport default combineReducers({\n  firstReducer: todos,\n  secondReducer: visibilityFilter\n})\n```\n\nç„¶åæˆ‘ä»¬çœ‹ä¸€ä¸‹`log`å‡ºæ¥çš„`props`æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚\n\n```js\n{\n\tfirstReducer: {todos: Array(0)}\n\tsecondReducer: \"SHOW_ALL\"\n}\n```\n\nä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸€å¼€å§‹è®¾ç½®è¿›å»çš„`key`å€¼ï¼Œè¿”å›çš„æ—¶å€™ä¹Ÿæ˜¯æŒ‰è¿™ä¸ªæ ¼å¼è¿”å›çš„ã€‚\n\né‡Œé¢æœ‰è®¸å¤šå‡½æ•°ï¼Œæˆ‘ä»¬å…ˆçœ‹ä»–åˆ°å¤„çš„å‡½æ•°`combineReducers`\n\n### combineReducers\n\n```js\n// ç”¨äºåˆå¹¶reducer ä¸€èˆ¬æ˜¯è¿™æ ·combineReducers({a,b,c})\nexport default function combineReducers(reducers: ReducersMapObject) {\n  // reducersä¸­keyçš„æ•°ç»„\n  const reducerKeys = Object.keys(reducers)\n  // æœ€ç»ˆçš„reducer\n  const finalReducers: ReducersMapObject = {}\n\n  // å¾ªç¯ï¼Œ ç›®çš„ä¸ºäº†ç»™finalReducersèµ‹å€¼ï¼Œ è¿‡è™‘äº†ä¸ç¬¦åˆè§„èŒƒçš„reducer\n  for (let i = 0; i < reducerKeys.length; i++) {\n    // æ¥å—å½“å‰çš„key\n    const key = reducerKeys[i]\n\n    // å¦‚æœä¸æ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œ å½“å‰çš„reduceræ˜¯undefinedä¼šç»™å‡ºwarning\n    if (process.env.NODE_ENV !== 'production') {\n      if (typeof reducers[key] === 'undefined') {\n        warning(`No reducer provided for key \"${key}\"`)\n      }\n    }\n\n    // reducerè¦æ˜¯ä¸€ä¸ªfunction\n    if (typeof reducers[key] === 'function') {\n      // èµ‹å€¼ç»™finalReducers\n      finalReducers[key] = reducers[key]\n    }\n  }\n  // ç¬¦åˆè§„èŒƒçš„reducerçš„keyæ•°ç»„\n  const finalReducerKeys = Object.keys(finalReducers)\n\n  // This is used to make sure we don't warn about the same\n  // keys multiple times.\n  // æ„æƒ³ä¸åˆ°çš„keyï¼Œ å…ˆå¾€ä¸‹çœ‹çœ‹\n  let unexpectedKeyCache: { [key: string]: true }\n  // productionç¯å¢ƒä¸º{}\n  if (process.env.NODE_ENV !== 'production') {\n    unexpectedKeyCache = {}\n  }\n\n  let shapeAssertionError: Error\n  try {\n    // çœ‹è¿™ä¸ªfunction\n    assertReducerShape(finalReducers)\n  } catch (e) {\n    shapeAssertionError = e\n  }\n\n  // è¿”å›functionï¼Œ å³ä¸ºcreateStoreä¸­çš„reducerå‚æ•°æ—¢currentReducer\n  // è‡ªç„¶æœ‰stateå’Œactionä¸¤ä¸ªå‚æ•°ï¼Œ å¯ä»¥å›createStoreæ–‡ä»¶çœ‹çœ‹currentReducer(currentState, action)\n  return function combination(\n    state: StateFromReducersMapObject<typeof reducers> = {},\n    action: AnyAction\n  ) {\n    // reducerä¸è§„èŒƒæŠ¥é”™\n    if (shapeAssertionError) {\n      throw shapeAssertionError\n    }\n\n    // æ¯”è¾ƒç»†è‡´çš„âŒä¿¡æ¯ï¼Œé¡ºä¾¿çœ‹äº†ä¸€ä¸‹getUndefinedStateErrorMessageï¼Œéƒ½æ˜¯ç”¨äºæç¤ºwarningå’Œerrorçš„ï¼Œ ä¸è¿‡å¤šè§£é‡Šäº†\n    if (process.env.NODE_ENV !== 'production') {\n      const warningMessage = getUnexpectedStateShapeWarningMessage(\n        state,\n        finalReducers,\n        action,\n        unexpectedKeyCache\n      )\n      if (warningMessage) {\n        warning(warningMessage)\n      }\n    }\n\n    let hasChanged = false\n    const nextState: StateFromReducersMapObject<typeof reducers> = {}\n    for (let i = 0; i < finalReducerKeys.length; i++) {\n\n      // è·å–finalReducerKeysçš„keyå’Œvalueï¼ˆfunctionï¼‰\n      const key = finalReducerKeys[i]\n      const reducer = finalReducers[key]\n      // å½“å‰keyçš„stateå€¼\n      const previousStateForKey = state[key]\n      // æ‰§è¡Œreducerï¼Œ è¿”å›å½“å‰state\n      const nextStateForKey = reducer(previousStateForKey, action)\n      // ä¸å­˜åœ¨è¿”å›å€¼æŠ¥é”™\n      if (typeof nextStateForKey === 'undefined') {\n        const errorMessage = getUndefinedStateErrorMessage(key, action)\n        throw new Error(errorMessage)\n      }\n      // æ–°çš„stateæ”¾åœ¨nextStateå¯¹åº”çš„keyé‡Œ\n      nextState[key] = nextStateForKey\n      // åˆ¤æ–­æ–°çš„stateæ˜¯ä¸æ˜¯åŒä¸€å¼•ç”¨ï¼Œ ä»¥æ£€éªŒreduceræ˜¯ä¸æ˜¯çº¯å‡½æ•°\n      hasChanged = hasChanged || nextStateForKey !== previousStateForKey\n    }\n    hasChanged =\n      hasChanged || finalReducerKeys.length !== Object.keys(state).length\n      // æ”¹å˜äº†è¿”å›nextState\n    return hasChanged ? nextState : state\n  }\n  /*\n  *  æ–°ç‰ˆæœ¬çš„reduxè¿™éƒ¨åˆ†æ”¹å˜äº†å®ç°æ–¹æ³•\n  *  è€ç‰ˆæœ¬çš„reduxä½¿ç”¨çš„reduceå‡½æ•°å®ç°çš„\n  *  ç®€å•ä¾‹å­å¦‚ä¸‹\n  * function combineReducers(reducers) {\n  *    return (state = {}, action) => {\n  *        return Object.keys(reducers).reduce((currentState, key) => {\n  *            currentState[key] = reducers[key](state[key], action);\n  *             return currentState;\n  *         }, {})\n  *      };\n  *    }\n  * \n  * */\n}\n```\n\nä¸Šé¢æ˜¯ä¸»è¦æºç ï¼Œä¸€ä¸ªä¸ªå‰–æè¿›å»ã€‚\n\nå…ˆæ˜¯å¯¹æ•°æ®è¿›è¡Œæ¸…æ´—ï¼Œç¬¬ä¸€æ¬¡ç­›é€‰å‡ºç¬¦åˆè¦æ±‚çš„`reducer`ä»¬\n\n```js\n// reducersä¸­keyçš„æ•°ç»„\n  const reducerKeys = Object.keys(reducers)\n  // æœ€ç»ˆçš„reducer\n  const finalReducers: ReducersMapObject = {}\n\n  // å¾ªç¯ï¼Œ ç›®çš„ä¸ºäº†ç»™finalReducersèµ‹å€¼ï¼Œ è¿‡è™‘äº†ä¸ç¬¦åˆè§„èŒƒçš„reducer\n  for (let i = 0; i < reducerKeys.length; i++) {\n    // æ¥å—å½“å‰çš„key\n    const key = reducerKeys[i]\n\n    // å¦‚æœä¸æ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œ å½“å‰çš„reduceræ˜¯undefinedä¼šç»™å‡ºwarning\n    if (process.env.NODE_ENV !== 'production') {\n      if (typeof reducers[key] === 'undefined') {\n        warning(`No reducer provided for key \"${key}\"`)\n      }\n    }\n\n    // reducerè¦æ˜¯ä¸€ä¸ªfunction\n    if (typeof reducers[key] === 'function') {\n      // èµ‹å€¼ç»™finalReducers\n      finalReducers[key] = reducers[key]\n    }\n  }\n```\n\n\n\n### assertReducerShape\n\nåˆç­›ä¹‹åçš„finalReducersä¼šäº¤ç”±assertReducerShapeå†ä¸€æ¬¡è¿›è¡Œæ£€éªŒã€‚é‡Œé¢å°±æ˜¯ä¸€ä¸ªåˆ¤æ–­ï¼Œç„¶åç»™å‡ºè­¦å‘Šâš ï¸ä¹‹ç±»çš„ã€‚å°±ä¸å¤šè¯´äº†ã€‚\n\n```js\nfunction assertReducerShape(reducers) {\n  Object.keys(reducers).forEach(key => {\n    const reducer = reducers[key]\n   // reducerè¿”å›å€¼\n    const initialState = reducer(undefined, { type: ActionTypes.INIT })\n    // undefined throw Error\n    if (typeof initialState === 'undefined') {\n      throw new Error(\n        `Reducer \"${key}\" returned undefined during initialization. ` +\n          `If the state passed to the reducer is undefined, you must ` +\n          `explicitly return the initial state. The initial state may ` +\n          `not be undefined. If you don't want to set a value for this reducer, ` +\n          `you can use null instead of undefined.`\n      )\n    }\n\n    // å¾ˆæ˜æ˜¾assertReducerShapeæ˜¯ç”¨äºreducerçš„è§„èŒƒ\n    // å›åˆ°combineReducers\n    if (\n      typeof reducer(undefined, {\n        type: ActionTypes.PROBE_UNKNOWN_ACTION()\n      }) === 'undefined'\n    ) {\n      throw new Error(\n        `Reducer \"${key}\" returned undefined when probed with a random type. ` +\n          `Don't try to handle ${\n            ActionTypes.INIT\n          } or other actions in \"redux/*\" ` +\n          `namespace. They are considered private. Instead, you must return the ` +\n          `current state for any unknown actions, unless it is undefined, ` +\n          `in which case you must return the initial state, regardless of the ` +\n          `action type. The initial state may not be undefined, but can be null.`\n      )\n    }\n  })\n}\n```\n\n\n\n### combination\n\nç„¶åå°±æ˜¯è¿”å›combinationè¿™ä¸ªå‡½æ•°ã€‚å‚æ•°çš„æ„ä¹‰å°±æ˜¯ä»–çš„åå­—ã€‚å°±ä¸å¤šè¯´äº†ã€‚\n\n```js\nreturn function combination(state = {}, action) {\n    // reducerä¸è§„èŒƒæŠ¥é”™\n    if (shapeAssertionError) {\n      throw shapeAssertionError\n    }\n\n    // æ¯”è¾ƒç»†è‡´çš„âŒä¿¡æ¯ï¼Œé¡ºä¾¿çœ‹äº†ä¸€ä¸‹getUndefinedStateErrorMessageï¼Œéƒ½æ˜¯ç”¨äºæç¤ºwarningå’Œerrorçš„ï¼Œ ä¸è¿‡å¤šè§£é‡Šäº†\n    if (process.env.NODE_ENV !== 'production') {\n      const warningMessage = getUnexpectedStateShapeWarningMessage(\n        state,\n        finalReducers,\n        action,\n        unexpectedKeyCache\n      )\n      if (warningMessage) {\n        warning(warningMessage)\n      }\n    }\n\n    let hasChanged = false\n    const nextState = {}\n    for (let i = 0; i < finalReducerKeys.length; i++) {\n      // è·å–finalReducerKeysçš„keyå’Œvalueï¼ˆfunctionï¼‰\n      const key = finalReducerKeys[i]\n      const reducer = finalReducers[key]\n      // å½“å‰keyçš„stateå€¼\n      const previousStateForKey = state[key]\n      // æ‰§è¡Œreducerï¼Œ è¿”å›å½“å‰state\n      const nextStateForKey = reducer(previousStateForKey, action)\n      // ä¸å­˜åœ¨è¿”å›å€¼æŠ¥é”™\n      if (typeof nextStateForKey === 'undefined') {\n        const errorMessage = getUndefinedStateErrorMessage(key, action)\n        throw new Error(errorMessage)\n      }\n      // æ–°çš„stateæ”¾åœ¨nextStateå¯¹åº”çš„keyé‡Œ\n      nextState[key] = nextStateForKey\n      // åˆ¤æ–­æ–°çš„stateæ˜¯ä¸æ˜¯åŒä¸€å¼•ç”¨ï¼Œ ä»¥æ£€éªŒreduceræ˜¯ä¸æ˜¯çº¯å‡½æ•°\n      hasChanged = hasChanged || nextStateForKey !== previousStateForKey\n    }\n    // æ”¹å˜äº†è¿”å›nextState\n    return hasChanged ? nextState : state\n  }\n  /*\n  *  æ–°ç‰ˆæœ¬çš„reduxè¿™éƒ¨åˆ†æ”¹å˜äº†å®ç°æ–¹æ³•\n  *  è€ç‰ˆæœ¬çš„reduxä½¿ç”¨çš„reduceå‡½æ•°å®ç°çš„\n  *  ç®€å•ä¾‹å­å¦‚ä¸‹\n  * function combineReducers(reducers) {\n  *    return (state = {}, action) => {\n  *        return Object.keys(reducers).reduce((currentState, key) => {\n  *            currentState[key] = reducers[key](state[key], action);\n  *             return currentState;\n  *         }, {})\n  *      };\n  *    }\n  * \n  * */\n```\n\n\n\nå…¶å®å°±æ˜¯æ‰§è¡Œreducerï¼Œç„¶åæŠŠå€¼æ‹¿å‡ºæ¥æ¯”å¯¹ï¼Œå¦‚æœæ˜¯å¼•ç”¨çš„è¯å°±è¿”å›ä¹‹å‰çš„stateï¼Œå¦‚æœä¸æ˜¯å°±ä½¿ç”¨æ–°çš„ã€‚ä»–çš„æ¯”å¯¹å’Œä¹‹å‰è¯´çš„æ•°ç»„æ¯”å¯¹ä¸€æ ·ï¼Œéƒ½æ˜¯æ¯”å¯¹å†…å­˜åœ°å€ã€‚\n\nä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Ÿ\n\nå¥½é—®é¢˜ï¼\n\nè¿™æ ·åšçš„å¥½å¤„å…¶å®å°±æ˜¯ä¸ºäº†çº¯å‡½æ•°ï¼Œä¸ºäº†ä¸€åˆ‡å¯é¢„æµ‹ã€‚è€Œä¸”ç®€å•çš„æ¯”è¾ƒå†…å­˜åœ°å€æ¯”é€’å½’çš„æ€§èƒ½å¥½å¤ªå¤šäº†ã€‚\n\né‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆæ ·æ‰å¯ä»¥å¥‘åˆè¿™æ ·çš„ç†å¿µå‘¢ï¼Ÿ\n\nå°±æ˜¯æˆ‘ä»¬åœ¨å†™reducerè¿”å›çš„æ—¶å€™ï¼Œéœ€è¦è¿”å›ä¸€ä¸ªå…¨æ–°çš„å¯¹è±¡ï¼Œé€šå¸¸æ˜¯\n\n```js\nreturn{\n\t...state,\n\txx: xx\n}\n```\n\nç±»ä¼¼è¿™æ ·ã€‚è¿™æ ·çš„è¯jså°±ä¼šæ–°å¼€è¾Ÿä¸€ä¸ªå†…å­˜åœ°å€å‡ºæ¥ã€‚åœ¨æ¯”å¯¹çš„æ—¶å€™å†…å­˜åœ°å€å°±ä¸ä¼šç›¸åŒäº†ã€‚\n\n\n\n## bindActionCreators\n\nè¿™ä¸ªå‡½æ•°å…¶å®éå¸¸å°‘ç”¨åˆ°ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«æ™¦æ¶©çš„ä¸œè¥¿ï¼Œåªæ˜¯ä¸€ä¸ªå°è£…ã€‚ä½†æ˜¯æ˜¯ä¸€ç§æ›´ä¸ºä¼˜é›…çš„æ–¹å¼ã€‚\n\nç›´æ¥çœ‹ä»£ç ï¼Œå¾ˆå°‘ã€‚\n\n```js\nexport default function bindActionCreators(actionCreators, dispatch) {\n  // actionCreatorsä¸ºfunction\n  if (typeof actionCreators === 'function') {\n    return bindActionCreator(actionCreators, dispatch)\n  }\n\n  // ä¸æ˜¯object throw Error\n  if (typeof actionCreators !== 'object' || actionCreators === null) {\n    throw new Error(\n      `bindActionCreators expected an object or a function, instead received ${\n        actionCreators === null ? 'null' : typeof actionCreators\n      }. ` +\n        `Did you write \"import ActionCreators from\" instead of \"import * as ActionCreators from\"?`\n    )\n  }\n\n  // object è½¬ä¸ºæ•°ç»„\n  const keys = Object.keys(actionCreators)\n  // å®šä¹‰return çš„props\n  const boundActionCreators = {}\n  for (let i = 0; i < keys.length; i++) {\n    // actionCreatorsçš„key é€šå¸¸ä¸ºactionCreators functionçš„nameï¼ˆæ–¹æ³•åï¼‰\n    const key = keys[i]\n    // function => actionCreatorså·¥å‚æ–¹æ³•æœ¬èº«\n    const actionCreator = actionCreators[key]\n    if (typeof actionCreator === 'function') {\n      // å‚æ•°ä¸º{actionsï¼šfunction xxx}æ˜¯è¿”å›ç›¸åŒçš„ç±»å‹\n      boundActionCreators[key] = bindActionCreator(actionCreator, dispatch)\n    }\n  }\n  // return çš„props\n  return boundActionCreators\n}\n```\n\nä»£ç å¾ˆç®€å•ä¹Ÿå¾ˆæ¸…æ™°ï¼Œå°±æ˜¯å¼„ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œç„¶åæŠŠ`actionCreators`é‡Œé¢çš„`value`å˜æˆ`bindActionCreator(actionCreator, dispatch)`çš„å€¼ï¼Œé‚£ä¹ˆä¸€èµ·çœ‹ä¸€ä¸‹`bindActionCreator`\n\n```js\nfunction bindActionCreator<A extends AnyAction = AnyAction>(\n  actionCreator: ActionCreator<A>,\n  dispatch: Dispatch\n) {\n  return function (this: any, ...args: any[]) {\n    return dispatch(actionCreator.apply(this, args))\n  }\n}\n```\n\nå…¶å®è¿™é‡Œçœ‹èµ·æ¥æœ‰ç‚¹è¿·ç³Šï¼Œçœ‹ä¹Ÿæ˜¯èƒ½çœ‹æ‡‚ï¼Œå…¶å®å°±æ˜¯è¿”å›ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯å¹²ä»€ä¹ˆçš„å‘¢ï¼Ÿè¿”å›æ‰§è¡Œdispatchä¹‹åçš„è¿”å›å€¼ã€‚è¿™ä¹ˆæè¿™ä¹ˆä¸€åœˆç©¶ç«Ÿæœ‰ä»€ä¹ˆç§˜å¯†å‘¢ï¼Ÿ\n\næˆ‘ä»¬å†™ä¸€ä¸ªdemoå°±ä¼šçŸ¥é“äº†ã€‚\n\nå‡å¦‚æˆ‘ä»¬è¦åšä¸€ä¸ªåŠ¨æ€çš„å¢åŠ çš„actionï¼Œåˆ†åˆ«ä¸ºç‚¹å‡»ä¸€æ¬¡+1ï¼Œç‚¹å‡»ä¸€æ¬¡+2ï¼Œç‚¹å‡»ä¸€æ¬¡+3ã€‚\n\næˆ‘ä»¬éœ€è¦\n\n```js\nconst counterIncActionCreator = function(step) {\n  return {\n    type: 'INCREMENT',\n    step: step || 1\n  }\n}\n\n// ä¸ºäº†ç®€åŒ–ä»£ç æˆ‘æŠŠdispatchå‡½æ•°å®šä¹‰ä¸ºåªæœ‰æ‰“å°åŠŸèƒ½çš„å‡½æ•°\nconst dispatch = function(action) {\n  console.log(action)\n}\n\nconst action1 = counterIncActionCreator()\ndispatch(action1) // { type: 'INCREMENT', step: 1 }\n\nconst action2 = counterIncActionCreator(2)\ndispatch(action2) // { type: 'INCREMENT', step: 2 }\n\nconst action3 = counterIncActionCreator(3)\ndispatch(action3) // { type: 'INCREMENT', step: 3 }\n\n```\n\næœ‰ç‚¹éš¾å—å…¶å®ï¼Œä½†æ˜¯æˆ‘ä»¬ç”¨äº†`bindActionCreator`ä¹‹å\n\n```js\nconst increment = bindActionCreator(counterIncActionCreator, dispatch)\n\nincrement() // { type: 'INCREMENT', step: 1 }\n\nincrement(2) // { type: 'INCREMENT', step: 2 }\n\nincrement(3) // { type: 'INCREMENT', step: 3 }\n\n```\n\nå°±æ•´ä¸ªå¸…èµ·æ¥ï¼Œæœ‰æ²¡æœ‰ï¼Ÿï¼æ›´åŠ ä¼˜é›…äº†ã€‚\n\nè€Œä¸”æˆ‘ä»¬è¿˜å¯ä»¥åˆ¶ä½œå¢å’Œå‡çš„ä¸¤ä¸ªå·¥å‚ğŸ­\n\n```js\nconst MyActionCreators = {\n  increment: function(step) {\n    return {\n      type: 'INCREMENT',\n      step: step || 1\n    }\n  },\n\n  decrement: function(step) {\n    return {\n      type: 'DECREMENT',\n      step: - (step || 1)\n    }\n  }\n}\n\n```\n\n\n\nè€æ–¹æ³•\n\n```js\n// åŸå§‹çš„è°ƒåº¦æ–¹å¼\ndispatch(MyActionCreators.increment()) // { type: 'INCREMENT', step: 1 }\ndispatch(MyActionCreators.increment(2)) // { type: 'INCREMENT', step: 2 }\ndispatch(MyActionCreators.increment(3)) // { type: 'INCREMENT', step: 3 }\ndispatch(MyActionCreators.decrement()) // { type: 'DECREMENT', step: -1 }\ndispatch(MyActionCreators.decrement(2)) // { type: 'DECREMENT', step: -2 }\ndispatch(MyActionCreators.decrement(3)) // { type: 'DECREMENT', step: -3 }\n\n```\n\nè¿›åŒ–ä¹‹å\n\n```js\nMyNewActionCreators.increment() // { type: 'INCREMENT', step: 1 }\nMyNewActionCreators.increment(2) // { type: 'INCREMENT', step: 2 }\nMyNewActionCreators.increment(3) // { type: 'INCREMENT', step: 3 }\nMyNewActionCreators.decrement() // { type: 'DECREMENT', step: -1 }\nMyNewActionCreators.decrement(2) // { type: 'DECREMENT', step: -2 }\nMyNewActionCreators.decrement(3) // { type: 'DECREMENT', step: -3 }\n\n```\n\n\n\n## Reduxæ€»ç»“\n\nè‡³æ­¤æˆ‘ä»¬çš„reduxæºç é˜…è¯»å°±åˆ°æ­¤ä¸ºæ­¢ã€‚\n\næ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·å­¦ä¹ ä¸€ä¸‹å’Œreduxé…åˆä½¿ç”¨çš„react-redux\n\n## react-redux\n\nReact åŸæœ¬å’Œreduxæ²¡æœ‰å…³ç³»ï¼Œreduxåªæ˜¯è´Ÿè´£æ•°æ®å¤„ç†ï¼Œç†è®ºä¸Šæ— è®ºæ˜¯vueæˆ–è€…angularéƒ½å¯ä»¥ä½¿ç”¨ã€‚\n\nä½†æ˜¯react-reduxå°†reactå’Œreduxç´§å¯†çš„è”ç³»åœ¨äº†ä¸€èµ·ã€‚ç”¨æ›´ç¬¦åˆreactçš„æ–¹å¼æ¥è°ƒç”¨reduxã€‚\n\nåç»­ä¼šå‡ºä¸€ç¯‡ä»‹ç»react-reduxçš„æ–‡ç« ã€‚\n\n# æ€»ç»“\n\nè‡ªæ­¤reduxæºç é˜…è¯»ç®—æ˜¯å‘Šä¸€æ®µè½äº†ã€‚å…¶å®æºç å¾ˆç®€å•ï¼Œä½†æ˜¯æ€æƒ³å´å¾ˆé«˜çº§ã€‚\n\nå¦‚æœæœ‰ä¸æ‡‚çš„ï¼Œæˆ–è€…å“ªé‡Œè¯´é”™äº†ï¼Œå°ä¼™ä¼´æ¬¢è¿åœ¨è¯„è®ºåŒºè®¨è®ºã€‚\n\n# ç´¢å¼•\n\n>https://juejin.im/post/6844903638377185288\n>\n>https://www.redux.org.cn/\n\n\n\n\n\n> å®åœ¨æ˜¯æ²¡æœ‰åœ°æ–¹åæ§½ï¼Œæˆ‘åœ¨è¿™é‡Œè¯´ä¸€ä¸‹æœ€è¿‘çš„äº‹æƒ…å§ã€‚å…ˆæ˜¯éƒ¨é—¨é»„äº†ï¼Œç„¶åå¤§é¢†å¯¼æ¢äººäº†ï¼Œå¤§é¢†å¯¼ä¸çŸ¥é“æ˜¯ä¸æ˜¯æ–°å®˜ä¸Šä»»ä¸‰æŠŠç«ï¼Œéè¦æä»€ä¹ˆææ•ˆï¼Œå…¶å®å°±æ˜¯æŠŠäººå¼„èµ°ï¼Œç„¶ååŠ å¤§å·¥ä½œé‡ï¼Œåˆšåˆšå¼€å§‹æ¢ç»„æˆ‘å°±å»å†™å¾ˆè€çš„vueé¡¹ç›®ï¼Œæ²¡æœ‰é„™è§†vueçš„æ„æ€ï¼Œæ˜¯å› ä¸ºæˆ‘ä¹‹å‰éƒ½åœ¨å†™reactï¼Œç„¶åä¸€ä¸‹è®©æˆ‘å†™ï¼Œä¹Ÿä¸å¤ªé€‚åº”è€Œå·²ï¼Œè¿˜æ˜¯å¾ˆå°‘çš„ç‰ˆæœ¬ã€‚é‚£å°±å†™å°±å†™å§ï¼Œåæ­£åšå‰ç«¯çš„éƒ½å¾—å­¦ä¸æ˜¯ï¼Ÿå¯æ˜¯ï¼Œå¤§é¢†å¯¼ä¸ºäº†ç»™åšç»™è€æ¿çœ‹ï¼Œç„¶åè®©æˆ‘ä»¬ä¸‹ç­ä¸è¦èµ°ï¼Œå°±æ˜¯æ²¡æœ‰äº‹æƒ…åšå°±å¹²åç€çš„é‚£ç§ã€‚æœ¬ç€90åçš„æ€§å­æˆ‘å°±èµ°äº†ï¼Œç„¶åæˆ‘èµ°äº†ä¹‹åï¼Œæœ‰äº›å°ä¼™ä¼´å¯èƒ½ä¹Ÿå¼€å§‹èµ°äº†ï¼Œç„¶åæˆ‘å°±è¢«æŠ“å»åŠé€€äº†....æˆ‘ä¹Ÿæ²¡æœ‰æ­»çš®èµ–è„¸çš„èµ–ç€ã€‚å€Ÿå£ä¹Ÿéå¸¸çš„å¥‡è‘©\"ä½ æ´»åœ¨è‡ªå·±çš„ä¸–ç•Œé‡Œé¢ï¼Œæ²¡æœ‰å…³å¿ƒå‘¨å›´åŒäº‹å¿™ä¸å¿™ï¼Œæ”¹bugä¸ç§¯æï¼Œä»£ç è´¨é‡ä½\"ä¹‹ç±»çš„ã€‚ã€‚ã€‚å¯æ˜¯æˆ‘åªæ˜¯å·¥ä½œçš„æ—¶å€™æˆ´ç€è€Œå·²ï¼Œå› ä¸ºç»å¸¸æœ‰äº§å“ä¸Šæ¥å°±åœ¨æ—è¾¹å¼€å§‹è®¨è®ºäº†ï¼Œç„¶åæˆ‘è‡ªå·±çš„å·¥ä½œéƒ½åšä¸å®Œï¼Œæ€ä¹ˆå…³å¿ƒåŒäº‹å•Šã€‚ã€‚å¼ºè¡ŒåŠ äº†å·¥ä½œé‡ä¹‹åæˆ‘éƒ½å¾ˆæ™šèµ°æˆ–è€…å›å®¶å·¥ä½œäº†ã€‚å› ä¸ºåœ¨å…¬å¸èµ–ç€çœŸçš„å¾ˆéš¾å—ï¼Œä¸ºä»€ä¹ˆä¸åœ¨è‡ªå·±èˆ’é€‚çš„å®¶ä¸­å·¥ä½œå‘¢ï¼Ÿè¿˜å¯ä»¥é©¬ä¸Šç¡è§‰é‚£ç§ï¼ŒéŸ³ä¹è¿˜å¯ä»¥å¤–æ”¾ã€‚ã€‚ã€‚å†è¯´äº†æˆ‘ä¹‹å‰çš„ä»£ç ï¼Œå› ä¸ºé¡¹ç›®é»„äº†ï¼Œåº”è¯¥æ²¡äººçœ‹äº†å§....å”‰ï¼Œå…¶å®å°±æ˜¯ åŠé€€ã€‚æˆ‘éƒ½æ‡‚ã€‚\n>\n> ä½†æ˜¯æˆ‘çš„ç®€å†å…¶å®å˜å¾—æå…¶ä¸‘é™‹äº†ï¼Œå› ä¸ºæˆ‘å¹´åˆçš„æ‰è·³æ§½è¿‡æ¥çš„ã€‚ç°åœ¨è¿™ä¸ªæ—¶é—´éå¸¸å°´å°¬....è€Œä¸”æˆ‘æ¥çš„ç¬¬ä¸€å¤©å¬è¯´è¦996ï¼Œé©¬ä¸Šæäº†ç¦»èŒç”³è¯·ï¼Œæˆ‘çš„é¢†å¯¼åŒæ„äº†ï¼Œå¯ä»¥ä¹‹å‰çš„å¤§é¢†å¯¼å’Œæˆ‘è¯´ä»¥åä¸ä¼š996äº†å°±æ˜¯æ­£å¸¸ä¸Šä¸‹ç­ã€‚ã€‚ç„¶åä»–å°±è·³æ§½äº†ã€‚ã€‚ã€‚\n>\n> ç®—æ˜¯è‡ªå·±ä¸è®¤çœŸå®¡æŸ¥å…¬å¸ï¼Œä¸è¿‡ä»–ä»¬ä¹Ÿå¤ªéª—äººäº†å§...å”‰ã€‚\n>\n> ç°åœ¨åœ¨å®¶é‡Œä¹Ÿå¾ˆç„¦è™‘ï¼Œä¸çŸ¥é“æ‰¾ä¸æ‰¾å¾—åˆ°å·¥ä½œï¼Œæ­å·çš„å…¬å¸çœ‹äº†ä¸€åœˆéƒ½æ˜¯996ï¼Œå­¦é˜¿é‡Œçš„åŠ ç­ä¸å­¦é˜¿é‡Œçš„å·¥èµ„ã€‚ã€‚ã€‚\n>\n> å›½åº†ä»¥åå†è¯´å§ï¼Œå¸Œæœ›æ—©ç‚¹æŠŠé‡è¯†å‰ç«¯ç³»åˆ—æ›´å®Œã€‚\n\n","slug":"ã€é‡è¯†å‰ç«¯ã€‘reduxæºç é˜…è¯»","published":1,"updated":"2021-06-24T14:00:06.851Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra8g001jlwrde1xq9gj8","content":"<p>æœ€è¿‘åœ¨å†™ã€é‡æ‹¾å‰ç«¯ã€‘ç³»åˆ—ï¼Œä¸‹é¢æœ‰å‡ ä¸ªå¿«é€Ÿé€šé“ï¼Œå¤§å®¶è‡ªå–</p>\n<p><a href=\"https://juejin.im/post/6850418113944420359\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿</a></p>\n<p><a href=\"https://juejin.im/post/6850418117508759566\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—</a></p>\n<p><a href=\"https://juejin.im/post/6854573215658803208\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this</a></p>\n<p><a href=\"https://juejin.im/post/6859911609633767438\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šJavaScriptçš„æ‰§è¡Œæœºåˆ¶</a></p>\n<p><a href=\"https://juejin.im/post/6860375101322461198\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC</a></p>\n<p><a href=\"https://juejin.im/post/6865204092877144077\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ</a></p>\n<p><a href=\"https://juejin.im/post/6867814019055484942\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘æš´èµ°çš„å¼‚æ­¥ç¼–ç¨‹</a></p>\n<p><a href=\"https://juejin.im/post/6877910314110140423/\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘reduxæºç é˜…è¯»</a></p>\n<h1 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h1><p>ä¹‹å‰ä¸€ç›´åœ¨ä½¿ç”¨reduxï¼Œåæ¥å‡ºäº†hooksï¼Œç”¨çš„æ¯”è¾ƒå°‘äº†ï¼Œä½†æ˜¯è¿˜æ˜¯ä¼šä½¿ç”¨ï¼Œä»–ä»¬ä¸å†²çªï¼Œå„è‡ªå¯¹åº”çš„åœºæ™¯ä¸åŒã€‚å¬è¯´reduxæºç æ¯”è¾ƒå°‘ï¼Œä¹Ÿæ¯”è¾ƒå¥½æ‡‚ï¼ˆä¸æ˜¯è´¬ä½ï¼Œè¶Šå¼ºçš„ä»£ç å…¶å®è¶Šç®€æ´æ˜äº†ï¼‰</p>\n<p>æ‰€ä»¥å‡†å¤‡é˜…è¯»ä¸€ä¸‹ï¼Œä¹Ÿç®—æ˜¯é‡è¯†å‰ç«¯ç³»åˆ—çš„ä¸€å‘˜å§ã€‚</p>\n<p>æ³¨æ„ä¸€ä¸‹ï¼Œå…¶å®æˆ‘ä»¬å†™reactçš„æ—¶å€™ç”¨åˆ°çš„å…¶å®æ˜¯redux-reactã€‚åé¢ä¹Ÿä¼šä¸€èµ·ä»‹ç»ã€‚</p>\n<p>æ›´å¥½çš„é˜…è¯»ä½“éªŒå…¶å®æ˜¯åœ¨é¡¹ç›®é‡Œé¢æ‰“æ–­ç‚¹ï¼Œè¿™é‡Œæ˜¯æˆ‘çš„<a href=\"https://github.com/DerrickTel/redux-source-analyse\" target=\"_blank\" rel=\"noopener\">GitHubåœ°å€</a>ï¼Œå–œæ¬¢çš„åŒå­¦å¯ä»¥forkæˆ–è€…starä¸€ä¸‹å“¦ã€‚é‡Œé¢æˆ‘æŠŠæºç éƒ½æ‹‰å‡ºæ¥æ”¾åˆ°æ–‡ä»¶å¤¹é‡Œé¢ç„¶åç”±create-react-appæ¥è°ƒç”¨ï¼Œè€Œä¸æ˜¯ç›´æ¥ç”¨npmè£…ã€‚è¿™æœ‰åŠ©äºç†è§£ä¸è°ƒè¯•ï¼Œé‡Œé¢ä¹Ÿæœ‰æˆ‘çš„æ³¨é‡Šï¼Œå…¶å®å¯ä»¥ç›´æ¥é˜…è¯»æºç çš„æ³¨é‡Šä¼šæ›´å¿«ã€‚</p>\n<p>reduxå’Œrdux-reactçš„ä»£ç ä¹Ÿæ˜¯ç›®å‰æœ€æ–°ï¼ˆ2020-09-13ï¼‰çš„masteråˆ†æ”¯ä¸Šé¢çš„ã€‚</p>\n<h1 id=\"å¼€å§‹\"><a href=\"#å¼€å§‹\" class=\"headerlink\" title=\"å¼€å§‹\"></a>å¼€å§‹</h1><p>reduxæ˜¯ç”¨çš„rollupæ‰“åŒ…çš„ã€‚</p>\n<p>æ‰“å¼€æ ¹ç›®å½•ä¸‹é¢çš„<code>rollup.config.js</code>å¯ä»¥çœ‹åˆ°å…¥å£æ˜¯srcç›®å½•ä¸‹çš„indexæ–‡ä»¶ã€‚</p>\n<p>å¯ä»¥çœ‹åˆ°ä»–å¯¼å‡ºçš„ä¸€äº›ä¸œè¥¿</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> &#123;</span><br><span class=\"line\">  createStore,</span><br><span class=\"line\">  combineReducers,</span><br><span class=\"line\">  bindActionCreators,</span><br><span class=\"line\">  applyMiddleware,</span><br><span class=\"line\">  compose,</span><br><span class=\"line\">  __DO_NOT_USE__ActionTypes</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æˆ‘ä»¬ä¸€ä¸ªä¸ªå¼€å§‹ã€‚é¦–å…ˆæ˜ å…¥çœ¼å¸˜çš„æ˜¯createStore</p>\n<h2 id=\"createStore\"><a href=\"#createStore\" class=\"headerlink\" title=\"createStore\"></a>createStore</h2><p>å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹æ˜¯æ€ä¹ˆç”¨ã€‚ä»¥ä¸‹é‡‡ç”¨<a href=\"https://github.com/DerrickTel/redux-source-analyse\" target=\"_blank\" rel=\"noopener\">æˆ‘çš„æºç </a>é˜…è¯»é‡Œé¢çš„ä»£ç ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// middleware</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> logger = <span class=\"function\">(<span class=\"params\">store:any</span>) =&gt;</span> <span class=\"function\">(<span class=\"params\">next:any</span>) =&gt;</span> <span class=\"function\">(<span class=\"params\">action:any</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// debugger</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.info(<span class=\"string\">'dispatching'</span>, action)</span><br><span class=\"line\">  <span class=\"keyword\">let</span> result = next(action);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'next state'</span>, store.getState())</span><br><span class=\"line\">  <span class=\"keyword\">return</span> result</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> store = createStore(rootReducer, applyMiddleware(logger));</span><br></pre></td></tr></table></figure>\n\n<p>å†çœ‹çœ‹æºç çš„createStoreã€‚</p>\n<h3 id=\"å‚æ•°\"><a href=\"#å‚æ•°\" class=\"headerlink\" title=\"å‚æ•°\"></a>å‚æ•°</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createStore</span>&lt;</span></span><br><span class=\"line\"><span class=\"function\">  <span class=\"title\">S</span>,</span></span><br><span class=\"line\"><span class=\"function\">  <span class=\"title\">A</span> <span class=\"title\">extends</span> <span class=\"title\">Action</span>,</span></span><br><span class=\"line\"><span class=\"function\">  <span class=\"title\">Ext</span> = </span>&#123;&#125;,</span><br><span class=\"line\">  StateExt = never</span><br><span class=\"line\">&gt;(</span><br><span class=\"line\">  reducer: Reducer&lt;S, A&gt;,</span><br><span class=\"line\">  preloadedState?: PreloadedState&lt;S&gt; | StoreEnhancer&lt;Ext, StateExt&gt;,</span><br><span class=\"line\">  enhancer?: StoreEnhancer&lt;Ext, StateExt&gt;</span><br><span class=\"line\">): Store&lt;ExtendState&lt;S, StateExt&gt;, A, StateExt, Ext&gt; &amp; Ext &#123;</span><br><span class=\"line\">  <span class=\"comment\">//.. ä¸€äº›æ ¡éªŒçš„æºç å°±ä¸ä»‹ç»äº†ï¼Œæƒ³äº†è§£çš„å¯ä»¥çœ‹æˆ‘çš„GitHubï¼Œä¸Šé¢æœ‰æ³¨é‡Š</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> currentReducer = reducer <span class=\"comment\">// ä¸´æ—¶å­˜æ”¾ reducer çš„åœ°æ–¹</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> currentState = preloadedState <span class=\"keyword\">as</span> S <span class=\"comment\">// ä¸´æ—¶å­˜æ”¾ state çš„åœ°æ–¹</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> currentListeners: <span class=\"function\">(<span class=\"params\">(</span>) =&gt;</span> <span class=\"keyword\">void</span>)[] | <span class=\"literal\">null</span> = [] <span class=\"comment\">// ç›‘å¬é˜Ÿåˆ—</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> nextListeners = currentListeners <span class=\"comment\">// å¼•ç”¨èµ‹å€¼, å’Œæ­£å¼çš„é˜Ÿåˆ—è¿›è¡ŒåŒºåˆ†, åˆ«æœ‰ä»–ç”¨</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> isDispatching = <span class=\"literal\">false</span> <span class=\"comment\">// æ˜¯ä¸æ˜¯æ­£åœ¨dispatch</span></span><br><span class=\"line\">  <span class=\"comment\">// ... </span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>createStoreæ¥æ”¶3ä¸ªå‚æ•°<code>reducer</code>ï¼Œ<code>preloadedState</code>ï¼Œ<code>enhancer</code>ã€‚</p>\n<p>æˆ‘ä»¬ä¸€ä¸€å‰–æä»–ä»¬åˆ†åˆ«æ˜¯åšä»€ä¹ˆçš„ã€‚</p>\n<h4 id=\"reducer\"><a href=\"#reducer\" class=\"headerlink\" title=\"reducer\"></a>reducer</h4><p>è¿™ä¸ªå¤§å®¶å¤ªç†Ÿæ‚‰äº†ã€‚å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åæˆ‘ä»¬åœ¨é‡Œé¢å†™<code>switch</code>ï¼Œ<code>switch</code> <code>dispatch</code>è¿‡æ¥ <code>action</code>çš„<code>type</code>ã€‚ç„¶ååšå¯¹åº”çš„æ“ä½œã€‚æœ€åè¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯å…¨æ–°çš„<code>store</code>çš„æ•°æ®ã€‚ä¸ºä»€ä¹ˆæ˜¯è¿”å›ä¸€ä¸ªå…¨æ–°çš„<code>store</code>ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢jsçš„å¼•ç”¨ã€‚</p>\n<p>å¿˜è®°çš„ï¼Œæˆ–è€…ä¸å¤ªæ‡‚çš„åŒå­¦å¯ä»¥çœ‹ä¸€ä¸‹ä¸‹é¢çš„demoï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> initState = &#123;</span><br><span class=\"line\">  todos: []</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è¿™é‡Œé¢æˆ‘ä»¬ä¸€èˆ¬ä¼šèµ‹å€¼ä¸Šé»˜è®¤çš„stateï¼Œå› ä¸ºåç»­å¯èƒ½ä¼šç”¨åˆ°é»˜è®¤çš„æƒ…å†µï¼Œåƒæ•°ç»„ä¹‹ç±»çš„å°±éå¸¸å¸¸è§ã€‚</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> todos = <span class=\"function\">(<span class=\"params\">state = initState, action</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">switch</span> (action.type) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'ADD_TODO'</span>:</span><br><span class=\"line\">      <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        ...state</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'TOGGLE_TODO'</span>:</span><br><span class=\"line\">      <span class=\"keyword\">return</span> state.map(</span><br><span class=\"line\">        todo =&gt;</span><br><span class=\"line\">          todo.id === action.id ? &#123; ...todo, <span class=\"attr\">completed</span>: !todo.completed &#125; : todo</span><br><span class=\"line\">      )</span><br><span class=\"line\">    <span class=\"keyword\">default</span>: &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> state</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">      </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> todos</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"preloadedState\"><a href=\"#preloadedState\" class=\"headerlink\" title=\"preloadedState\"></a>preloadedState</h4><p>è¿™ä¸ªå…¶å®æˆ‘ä»¬ç”¨çš„ä¸æ˜¯å¾ˆå¤šï¼Œå› ä¸ºæˆ‘ä»¬ä¸€èˆ¬é¢„å­˜çš„éƒ½ç›´æ¥å¸è½½<code>reducer</code>é‡Œé¢äº†ã€‚åƒğŸ‘†ğŸŒ°é‡Œé¢çš„<code>state = initState</code>å°±çœå»äº†æˆ‘ä»¬çš„ä¼ é€’è¿™ä¸ªå‚æ•°çš„è¿‡ç¨‹ã€‚è€Œä¸”æ•°æ®æ”¾åœ¨<code>reducer</code>é‡Œé¢ä¹Ÿæ›´åŠ æ¸…æ™°ã€‚</p>\n<p>å“ªæ€•æ˜¯åœ¨<a href=\"http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_one_basic_usages.html\" target=\"_blank\" rel=\"noopener\">é˜®ä¸€å³°è€å¸ˆçš„æ—¥å¿—</a>é‡Œé¢ä¹Ÿæ˜¯è¿™æ ·æ•™çš„ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> defaultState = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> reducer = <span class=\"function\">(<span class=\"params\">state = defaultState, action</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">switch</span> (action.type) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'ADD'</span>:</span><br><span class=\"line\">      <span class=\"keyword\">return</span> state + action.payload;</span><br><span class=\"line\">    <span class=\"keyword\">default</span>: </span><br><span class=\"line\">      <span class=\"keyword\">return</span> state;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> state = reducer(<span class=\"number\">1</span>, &#123;</span><br><span class=\"line\">  type: <span class=\"string\">'ADD'</span>,</span><br><span class=\"line\">  payload: <span class=\"number\">2</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>ä¸­æ–‡ç¿»è¯‘å°±æ˜¯ï¼šé¢„å­˜çš„<code>state</code>ã€‚ä¹Ÿå¯ä»¥ç†è§£ä¸ºåˆå§‹çš„ï¼Œé»˜è®¤çš„ã€‚å› ä¸ºæˆ‘ä»¬ä¸€èˆ¬åœ¨ä¹Ÿé¡µé¢é‡Œé¢ç›´æ¥æ‹¿<code>store</code>é‡Œé¢çš„å€¼ï¼Œæˆ–è€…<code>map</code>æˆ–è€…ä»€ä¹ˆã€‚å¾ˆæœ‰å¯èƒ½å°±ä¼šæŠ¥é”™ï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰é»˜è®¤å€¼æˆ‘ä»¬ç›´æ¥ç”¨<code>map</code>å°±ä¼šæŠ¥é”™â€¦.ç›¸ä¿¡åˆšåˆšå¼€å§‹ç”¨çš„å°ä¼™ä¼´åº”è¯¥æœ‰è¿™æ ·çš„å›°æƒ‘ã€‚</p>\n<p>ä½†æ˜¯ï¼Œæˆ‘ä»¬é€šå¸¸éƒ½æ˜¯ä¼ ä¸¤ä¸ªå‚æ•°ï¼Œé‚£å’‹åŠï¼Ÿæˆ‘çœ‹ä»–å¥½åƒæ˜¯é¡ºåºè¯»å–çš„è¯¶â€¦</p>\n<p>reduxå…¼å®¹æˆ‘ä»¬å•¦ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‰é¢æœ‰ä¸€æ®µä»£ç æ˜¯ä¸ºäº†åšè¿™ä¸ªçš„</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// preloadedStateä¸ºfunction enhancerä¸ºundefinedçš„æ—¶å€™è¯´æ˜initStateæ²¡æœ‰åˆå§‹åŒ–, ä½†æ˜¯æœ‰middleware</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> preloadedState === <span class=\"string\">'function'</span> &amp;&amp; <span class=\"keyword\">typeof</span> enhancer === <span class=\"string\">'undefined'</span>) &#123;</span><br><span class=\"line\">  enhancer = preloadedState <span class=\"comment\">// æŠŠ preloadedState èµ‹å€¼ç»™ enhancer</span></span><br><span class=\"line\">  preloadedState = <span class=\"literal\">undefined</span> <span class=\"comment\">// preloadedStateèµ‹å€¼undeifined</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"enhancer\"><a href=\"#enhancer\" class=\"headerlink\" title=\"enhancer\"></a>enhancer</h4><p>ä¸­æ–‡ç¿»è¯‘æ˜¯ï¼šå¢å¼ºã€‚å…¶å®å°±æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ä¸­é—´ä»¶ï¼Œç”¨äºå¢å¼ºæˆ‘ä»¬çš„<code>redux</code>ã€‚å¸¸è§æœ‰çš„æœ‰<code>log</code>ï¼Œ<code>redux-thunk</code>ï¼Œ<code>redux-saga</code>ç­‰ç­‰ã€‚</p>\n<p>æˆ‘ä»¬å‘ç°ä»£ç é‡Œé¢æœ‰ä¸€æ®µæ˜¯è¿™æ ·çš„ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// debugger</span></span><br><span class=\"line\"><span class=\"comment\">// å¦‚æœå‚æ•°enhancerå­˜åœ¨</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> enhancer !== <span class=\"string\">'undefined'</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœenhancerå­˜åœ¨ï¼Œé‚£ä»–å¿…é¡»æ˜¯ä¸ªfunction, å¦åˆ™throw Errorå“ˆ</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> enhancer !== <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">'Expected the enhancer to be a function.'</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * ä¼ å…¥ç¬¦åˆå‚æ•°ç±»å‹çš„å‚æ•°ï¼Œå°±å¯ä»¥æ‰§è¡Œ enhancer,</span></span><br><span class=\"line\"><span class=\"comment\">     * ä½†æ˜¯è¿™ä¸ªreturnæ·±æ·±çš„å¸å¼•äº†æˆ‘, å› ä¸ºè¯´æ˜æœ‰applyMiddlewareçš„æ—¶å€™åé¢çš„éƒ½ä¸ç”¨çœ‹äº† ??? å½“ç„¶\u001dä¸å¯èƒ½</span></span><br><span class=\"line\"><span class=\"comment\">     * å¯æ˜¯applyMiddlewareå…¶å®æ˜¯å¿…ç”¨é¡¹ï¼Œæ‰€ä»¥çŒœæƒ³ä¸€ä¸‹applyMiddlewareå¼ºåŒ–storeä¹‹åä¼šenhancerèµ‹å€¼undefinedï¼Œå†æ¬¡è°ƒç”¨createStore</span></span><br><span class=\"line\"><span class=\"comment\">     * ä¸Šä¸‹æ‰“ä¸ªdebuggerçœ‹ä¸€ä¸‹æ‰§è¡Œé¡ºåº(debuggerä½ç½®ä»¥æ³¨é‡Š)ï¼Œæœç„¶ä¸å‡ºæ‰€æ–™</span></span><br><span class=\"line\"><span class=\"comment\">     * å¥½äº†ï¼Œ å‡è®¾æˆ‘ä»¬è¿˜ä¸çŸ¥é“applyMiddleware()è¿™ä¸ªfuncrionå…·ä½“å¹²äº†ä»€ä¹ˆï¼Œ</span></span><br><span class=\"line\"><span class=\"comment\">     * åªçŸ¥é“ä»–åšäº†ä¸€äº›å¤„ç†ç„¶åé‡æ–°è°ƒç”¨äº†createStoreå¹¶ä¸”enhancerå‚æ•°ä¸ºundefined</span></span><br><span class=\"line\"><span class=\"comment\">     * å…ˆè®°ä¸‹ï¼Œåç»­åœ¨çœ‹applyMiddlewareï¼Œ å› ä¸ºæˆ‘ä»¬ç°åœ¨è¦çœ‹çš„æ˜¯createStore</span></span><br><span class=\"line\"><span class=\"comment\">     * * */</span></span><br><span class=\"line\">    <span class=\"comment\">// debugger</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> enhancer(createStore)(reducer, preloadedState)</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<p>è¿™ä¸ªé‡ç‚¹å…¶å®åœ¨äº<code>applyMiddleware</code>ï¼Œåç»­æˆ‘ä»¬ä¼šä»‹ç»åˆ°çš„ã€‚</p>\n<h3 id=\"å†…ç½®å˜é‡\"><a href=\"#å†…ç½®å˜é‡\" class=\"headerlink\" title=\"å†…ç½®å˜é‡\"></a>å†…ç½®å˜é‡</h3><p>è¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œæˆ‘å°±éƒ½å†™åœ¨æ³¨é‡Šé‡Œé¢äº†</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> currentReducer = reducer <span class=\"comment\">// ä¸´æ—¶å­˜æ”¾ reducer çš„åœ°æ–¹</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> currentState = preloadedState <span class=\"keyword\">as</span> S <span class=\"comment\">// ä¸´æ—¶å­˜æ”¾ state çš„åœ°æ–¹</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> currentListeners: <span class=\"function\">(<span class=\"params\">(</span>) =&gt;</span> <span class=\"keyword\">void</span>)[] | <span class=\"literal\">null</span> = [] <span class=\"comment\">// ç›‘å¬é˜Ÿåˆ—</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> nextListeners = currentListeners <span class=\"comment\">// å¼•ç”¨èµ‹å€¼, å’Œæ­£å¼çš„é˜Ÿåˆ—è¿›è¡ŒåŒºåˆ†, åˆ«æœ‰ä»–ç”¨</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> isDispatching = <span class=\"literal\">false</span> <span class=\"comment\">// æ˜¯ä¸æ˜¯æ­£åœ¨dispatch</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"å†…ç½®æ–¹æ³•\"><a href=\"#å†…ç½®æ–¹æ³•\" class=\"headerlink\" title=\"å†…ç½®æ–¹æ³•\"></a>å†…ç½®æ–¹æ³•</h3><h4 id=\"ensureCanMutateNextListeners\"><a href=\"#ensureCanMutateNextListeners\" class=\"headerlink\" title=\"ensureCanMutateNextListeners\"></a>ensureCanMutateNextListeners</h4><p>è¿™é‡Œå…¶å®æ˜¯ä¸ºäº†å¼„ä¸¤ä¸ªæ•°ç»„ï¼Œä¸€ä¸ªæ“ä½œä¸€ä¸ªåŸæ•°ç»„è€ŒæŠ½è±¡çš„ä¸€ä¸ªæ–¹æ³•ã€‚</p>\n<p>æœ‰ä¸€ä¸ªå°çš„çŸ¥è¯†ç‚¹ï¼Œ<code>===</code>å¯¹äºæ•°ç»„çš„åˆ¤æ–­åªèƒ½ç”¨äºåˆ¤æ–­æ˜¯å¦æ˜¯åŒä¸€ä¸ªå†…å­˜åœ°å€ï¼Œä¸ä¿¡çš„è¯å¤§å®¶å¯ä»¥è¯•è¯•ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> a = [<span class=\"number\">1</span>, <span class=\"number\">2</span>];</span><br><span class=\"line\"><span class=\"keyword\">const</span> b = [<span class=\"number\">1</span>, <span class=\"number\">2</span>];</span><br><span class=\"line\"><span class=\"keyword\">const</span> c = a;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a === b);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a === c);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b === c);</span><br></pre></td></tr></table></figure>\n\n\n\n<p>æ‰€ä»¥ä¸‹é¢çš„æ“ä½œçš„å°±å˜å¾—å¾ˆå¥½ç†è§£äº†ã€‚åœ¨æˆ‘ä»¬æ“ä½œ<code>listener</code>ä¹‹å‰ä¼šå…ˆå­˜å‚¨ä¸€ä¸‹å¿«ç…§ã€‚å¤§å®¶è¦å¤šç†è§£ä¸€ä¸‹ï¼Œå› ä¸ºåé¢å¾ˆå¤šåœ°æ–¹ä¼šç”¨åˆ°è¿™ä¸ªå‡½æ•°ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Googleç¿»è¯‘: ç¡®ä¿å¯ä»¥ä½¿ä¸‹ä¸€ä¸ªä¾¦å¬å™¨çªå˜</span></span><br><span class=\"line\">  <span class=\"comment\">// æˆ‘çš„ç†è§£æ˜¯å­˜å‚¨ä¸€ä¸‹å¿«ç…§, ä»¥ä¸ºæ¥ä¸‹æ¥å¯èƒ½ä¼šè¿›è¡Œæ“ä½œ.</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">ensureCanMutateNextListeners</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// æ˜¯å¦ç›¸åŒ, æ˜¯ä¸æ˜¯ç®€å•çš„å¼•ç”¨èµ‹å€¼, æ˜¯çš„è¯å°±æµ…æ‹·è´ä¸€ä»½</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (nextListeners === currentListeners) &#123;</span><br><span class=\"line\">      nextListeners = currentListeners.slice()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"getState\"><a href=\"#getState\" class=\"headerlink\" title=\"getState\"></a>getState</h4><p>è¿™ä¸ªå‡½æ•°å¾ˆç®€å•ï¼Œé¦–å…ˆåˆ¤æ–­ä¸€ä¸‹æ˜¯å¦æ˜¯åœ¨dispatchï¼Œç„¶åè¿”å›å½“å‰çš„stateã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// è·å–å½“å‰çš„state</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getState</span>(<span class=\"params\"></span>): <span class=\"title\">S</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœæ­£åœ¨dispatch å°±æŠ¥é”™,å› ä¸ºè¦è·å–æœ€æ–°çš„state, dispatchå¾ˆæœ‰å¯èƒ½ä¼šæ”¹å˜state</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isDispatching) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(</span><br><span class=\"line\">        <span class=\"string\">'You may not call store.getState() while the reducer is executing. '</span> +</span><br><span class=\"line\">          <span class=\"string\">'The reducer has already received the state as an argument. '</span> +</span><br><span class=\"line\">          <span class=\"string\">'Pass it down from the top reducer instead of reading it from the store.'</span></span><br><span class=\"line\">      )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> currentState <span class=\"keyword\">as</span> S</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<p>æœ‰æ²¡æœ‰æ„Ÿè§‰reduxå¥½åƒä¹Ÿä¸è¿‡å¦‚æ­¤~~æ¥ç€çœ‹å“¦ã€‚</p>\n<h4 id=\"subscribe\"><a href=\"#subscribe\" class=\"headerlink\" title=\"subscribe\"></a>subscribe</h4><p>ä¸­æ–‡ç¿»è¯‘ï¼šè®¢é˜…è€…ã€‚</p>\n<p>å…¶å®ä¹Ÿå¾ˆå¥½ç†è§£ã€‚å¯èƒ½æœ‰ç”¨è¿‡<code>redux</code>çš„åŒå­¦éƒ½æœ‰ç”¨è¿‡è¿™ä¸ªã€‚</p>\n<p>æˆ‘ä¸¾ä¸€ä¸ªæ€ä¹ˆç”¨çš„ğŸŒ°ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> unSubscribe = store.subscribe(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'store.subscribe'</span>, store.getState())</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"comment\">// å–æ¶ˆè®¢é˜…å°±ç›´æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°å°±å¥½äº†</span></span><br><span class=\"line\"><span class=\"comment\">// unSubscribe();</span></span><br></pre></td></tr></table></figure>\n\n<p>ä¸€æ—¦è§¦å‘äº†<code>dispatch</code>å°±ä¼šè§¦å‘è¿™ä¸ªå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å†™ä¸Šå»çš„<code>console.log()</code></p>\n<p>ç„¶åæˆ‘ä»¬å†æ¥çœ‹è¿™ä¸ªå‡½æ•°ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">subscribe</span>(<span class=\"params\">listener: (</span>) =&gt; <span class=\"title\">void</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// listenerå¿…é¡»ä¸ºå‡½æ•°ï¼Œå› ä¸ºè¦ä»¥å›è°ƒå‡½æ•°çš„æ–¹å¼æ¥è§¦å‘ã€‚</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> listener !== <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">'Expected the listener to be a function.'</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœæ­£åœ¨dispatchä¸­åˆ™æŠ›é”™ï¼Œå’ŒgetStateåŒç†</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isDispatching) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(</span><br><span class=\"line\">        <span class=\"string\">'You may not call store.subscribe() while the reducer is executing. '</span> +</span><br><span class=\"line\">          <span class=\"string\">'If you would like to be notified after the store has been updated, subscribe from a '</span> +</span><br><span class=\"line\">          <span class=\"string\">'component and invoke store.getState() in the callback to access the latest state. '</span> +</span><br><span class=\"line\">          <span class=\"string\">'See https://redux.js.org/api/store#subscribelistener for more details.'</span></span><br><span class=\"line\">      )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// æ˜¯å¦æœ‰ç›‘å¬è€…,æˆ–è€…æ˜¯å¦è¢«è®¢é˜…</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> isSubscribed = <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// ä¿å­˜å¿«ç…§, æ‹·è´ä¸€ä»½ç›‘å¬é˜Ÿåˆ—åˆ°nextListeners(å¦‚æœæ˜¯å¼•ç”¨çš„è¯)</span></span><br><span class=\"line\">    ensureCanMutateNextListeners()</span><br><span class=\"line\">    <span class=\"comment\">// å¾€ç›‘å¬é˜Ÿåˆ—é‡Œé¢æ¨å…¥ä¸€ä¸ªç›‘å¬è€…</span></span><br><span class=\"line\">    nextListeners.push(listener)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// è¿”å›ä¸€ä¸ªå–æ¶ˆè®¢é˜…çš„æ–¹æ³•</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">unsubscribe</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">// å¦‚æœæ²¡æœ‰è¢«è®¢é˜…, ç›´æ¥shut down</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!isSubscribed) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// å¦‚æœæ­£åœ¨dispatch æŠ¥é”™ï¼Œå’Œä¸Šé¢ğŸ‘†åŒç†</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (isDispatching) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(</span><br><span class=\"line\">          <span class=\"string\">'You may not unsubscribe from a store listener while the reducer is executing. '</span> +</span><br><span class=\"line\">            <span class=\"string\">'See https://redux.js.org/api/store#subscribelistener for more details.'</span></span><br><span class=\"line\">        )</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// å–æ¶ˆè®¢é˜…</span></span><br><span class=\"line\">      isSubscribed = <span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// ä¾æ—§æ˜¯æ‹¿ä¸‹å½“å‰çš„ç›‘å¬é˜Ÿåˆ—ï¼Œä¸ç„¶ç­‰ä¸€ä¸‹åˆ é™¤çš„æ—¶å€™ï¼Œä¼šåˆ æ‰æ‰€æœ‰çš„é˜Ÿåˆ—ã€‚å…¶å®æˆ‘ä»¬åªéœ€è¦åˆ æ‰ç›‘å¬è€…å°±å¥½äº†</span></span><br><span class=\"line\">      ensureCanMutateNextListeners()</span><br><span class=\"line\">      <span class=\"comment\">// æ‰¾åˆ°ç›‘å¬è€…</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> index = nextListeners.indexOf(listener)</span><br><span class=\"line\">      <span class=\"comment\">// åˆ é™¤è¿™ä¸ªç›‘å¬è€…</span></span><br><span class=\"line\">      nextListeners.splice(index, <span class=\"number\">1</span>)</span><br><span class=\"line\">      <span class=\"comment\">// æ¸…ç©ºå½“å‰çš„ç›‘å¬é˜Ÿåˆ—</span></span><br><span class=\"line\">      currentListeners = <span class=\"literal\">null</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"dispatch\"><a href=\"#dispatch\" class=\"headerlink\" title=\"dispatch\"></a>dispatch</h4><p>è¿™ä¸ªå‡½æ•°å¯ä»¥è¯´æ˜¯å²ä¸Šæœ€TMå¸¸ç”¨çš„å‡½æ•°çš„ï¼Œæœ€TMé‡è¦ä¹‹é‡ä¸­ä¹‹é‡ï¼Œè€Œä¸”è¿˜æ˜¯æ›´æ–°storeçš„å”¯ä¸€æ–¹æ³•ï¼Œæ³¨æ„è¿™ä¸ªå”¯ä¸€ã€‚ä½†æ˜¯åˆéå¸¸å¥½ç†è§£ã€‚</p>\n<p>æˆ‘ä»¬è¿˜æ˜¯å…ˆçœ‹ä¸€ä¸ªğŸŒ°å§ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">props.dispatch(&#123;</span><br><span class=\"line\">  type: <span class=\"string\">'TEST'</span>,</span><br><span class=\"line\">  test1: <span class=\"number\">1</span>,</span><br><span class=\"line\">  test2: <span class=\"number\">2</span>,</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>ç„¶åï¼Œæˆ‘ä»¬çš„storeå°±æ”¹å˜äº†ï¼Œå°±ä¼šæ›´æ–°propsï¼Œæ¥è§¦å‘renderï¼Œè§†å›¾å¯èƒ½å°±ä¼šæ›´æ–°ä¹‹ç±»çš„ã€‚</p>\n<p>ğŸ‘Œï¼Œç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªä¸€ç‚¹ç‚¹äº†è§£ï¼Œæ¥çœ‹ä¸€ä¸‹æºç ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ä¿®æ”¹storeçš„å”¯ä¸€æ–¹æ³•</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">dispatch</span>(<span class=\"params\">action: A</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// actionå¿…é¡»æ˜¯ä¸€ä¸ªå¯¹è±¡</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!isPlainObject(action)) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(</span><br><span class=\"line\">        <span class=\"string\">'Actions must be plain objects. '</span> +</span><br><span class=\"line\">          <span class=\"string\">'Use custom middleware for async actions.'</span></span><br><span class=\"line\">      )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// actionå¿…é¡»æ‹¥æœ‰ä¸€ä¸ªtype</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> action.type === <span class=\"string\">'undefined'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(</span><br><span class=\"line\">        <span class=\"string\">'Actions may not have an undefined \"type\" property. '</span> +</span><br><span class=\"line\">          <span class=\"string\">'Have you misspelled a constant?'</span></span><br><span class=\"line\">      )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœæ­£åœ¨dispatchingï¼Œé‚£ä¹ˆä¸æ‰§è¡Œdispatchæ“ä½œã€‚</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isDispatching) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">'Reducers may not dispatch actions.'</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// è®¾ç½®dispatchingçŠ¶æ€ä¸ºtrueï¼Œå¹¶ä½¿ç”¨reducerç”Ÿæˆæ–°çš„çŠ¶æ€æ ‘ã€‚</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      isDispatching = <span class=\"literal\">true</span></span><br><span class=\"line\">      currentState = currentReducer(currentState, action)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å½“è·å–æ–°çš„çŠ¶æ€æ ‘å®Œæˆåï¼Œè®¾ç½®çŠ¶æ€ä¸ºfalse.</span></span><br><span class=\"line\">      isDispatching = <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å°†ç›®å‰æœ€æ–°çš„ç›‘å¬æ–¹æ³•æ”¾ç½®åˆ°å³å°†æ‰§è¡Œçš„é˜Ÿåˆ—ä¸­éå†å¹¶ä¸”æ‰§è¡Œ</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> listeners = (currentListeners = nextListeners)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; listeners.length; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> listener = listeners[i]</span><br><span class=\"line\">      listener()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å°†è§¦å‘çš„actionè¿”å›</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> action</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<p>å…¶å®çœ‹ä¸‹æ¥ï¼Œæˆ‘ä»¬å‘ç°ä»–å°±æ˜¯ç®€å•çš„å°†æˆ‘ä»¬çš„å‚æ•°è½¬å‘ç»™äº†<code>reducer</code>ï¼Œç„¶åæ‰§è¡Œäº†æˆ‘ä»¬ä¹‹å‰å»ºç«‹çš„ç›‘å¬é˜Ÿåˆ—ã€‚</p>\n<p>æœ‰æ²¡æœ‰åŒå­¦ä¼šå’Œæˆ‘æƒ³çš„ä¸€æ ·ï¼Œé‚£ä¸ºä»€ä¹ˆä¸ç›´æ¥æ‰§è¡Œ<code>reducer</code>ï¼Ÿå› ä¸ºæˆ‘ä»¬é‡Œé¢æœ‰è®¢é˜…å‡½æ•°éœ€è¦æ‰§è¡Œï¼Œå¯¹å§ï¼Œè€Œä¸”è¿˜æœ‰<code>dispatch</code>çš„çŠ¶æ€éœ€è¦é€šçŸ¥<code>store</code>ï¼Œä¸ç„¶<code>getState</code>ä¹‹ç±»çš„ï¼Œæˆ‘ä»¬ä¹‹å‰æœ‰çœ‹åˆ°åˆ¤æ–­<code>dispatch</code>çŠ¶æ€çš„å¾ˆå¯èƒ½å‡ºç°åå·®ã€‚</p>\n<p>æˆ‘ä»¬åªéœ€è¦<code>connect</code>ä¸€ä¸‹å°±å¯ä»¥ç›´æ¥åœ¨<code>props</code>é‡Œé¢æ‹¿åˆ°<code>dispatch</code>ï¼Œä¸éœ€è¦<code>import</code>ä¹‹ç±»çš„ï¼Œå¾ˆç®€æ´ã€‚</p>\n<h4 id=\"replaceReducer\"><a href=\"#replaceReducer\" class=\"headerlink\" title=\"replaceReducer\"></a>replaceReducer</h4><p>è¿™ä¸ªå‡½æ•°é¡¾åæ€ä¹‰ï¼Œä¹Ÿå¾ˆå¥½ç†è§£ï¼Œæˆ‘å°±ä¸å¤šåšè§£é‡Šäº†ï¼Œç›´æ¥çœ‹æ³¨é‡Šå§ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// è¿™ä¸ªå…¶å®å¾ˆå°‘ç”¨åˆ°, å®˜æ–¹çš„ä»‹ç»æ˜¯ä¸»è¦æ˜¯ç”¨äºåŠ¨æ€æ›¿æ¢reducerçš„æ—¶å€™ä¼šç”¨åˆ°</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">replaceReducer</span>&lt;<span class=\"title\">NewState</span>, <span class=\"title\">NewActions</span> <span class=\"title\">extends</span> <span class=\"title\">A</span>&gt;(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">    nextReducer: Reducer&lt;NewState, NewActions&gt;</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  </span>): <span class=\"title\">Store</span>&lt;<span class=\"title\">ExtendState</span>&lt;<span class=\"title\">NewState</span>, <span class=\"title\">StateExt</span>&gt;, <span class=\"title\">NewActions</span>, <span class=\"title\">StateExt</span>, <span class=\"title\">Ext</span>&gt; &amp; <span class=\"title\">Ext</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> nextReducer !== <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">'Expected the nextReducer to be a function.'</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// ä¿®æ”¹reducer</span></span><br><span class=\"line\">    <span class=\"comment\">// å½“å‰çš„currentReduceræ›´æ–°ä¸ºå‚æ•°nextReducer</span></span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">TODO:</span> do this more elegantly</span></span><br><span class=\"line\">    ;((currentReducer <span class=\"keyword\">as</span> unknown) <span class=\"keyword\">as</span> Reducer&lt;</span><br><span class=\"line\">      NewState,</span><br><span class=\"line\">      NewActions</span><br><span class=\"line\">    &gt;) = nextReducer</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// This action has a similar effect to ActionTypes.INIT.</span></span><br><span class=\"line\">    <span class=\"comment\">// Any reducers that existed in both the new and old rootReducer</span></span><br><span class=\"line\">    <span class=\"comment\">// will receive the previous state. This effectively populates</span></span><br><span class=\"line\">    <span class=\"comment\">// the new state tree with any relevant data from the old one.</span></span><br><span class=\"line\">    <span class=\"comment\">// å’ŒINITçš„dispatchç›¸åŒï¼Œå‘é€ä¸€ä¸ªdispatchåˆå§‹åŒ–stateï¼Œè¡¨æ˜ä¸€ä¸‹æ˜¯REPLACE</span></span><br><span class=\"line\">    <span class=\"comment\">// è‡ªå·±ğŸ‘€çœ‹ä¸€ä¸‹utilsæ–¹æ³•çš„ActionTypesï¼Œ éšæ€§çš„éšæœºæ•°</span></span><br><span class=\"line\">    dispatch(&#123; <span class=\"attr\">type</span>: ActionTypes.REPLACE &#125; <span class=\"keyword\">as</span> A)</span><br><span class=\"line\">    <span class=\"comment\">// change the type of the store by casting it to the new store</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> (store <span class=\"keyword\">as</span> unknown) <span class=\"keyword\">as</span> Store&lt;</span><br><span class=\"line\">      ExtendState&lt;NewState, StateExt&gt;,</span><br><span class=\"line\">      NewActions,</span><br><span class=\"line\">      StateExt,</span><br><span class=\"line\">      Ext</span><br><span class=\"line\">    &gt; &amp;</span><br><span class=\"line\">      Ext</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<p>å‘ç°ä¸¤ä¸ªå¾ˆæœ‰è¶£çš„ç‚¹ï¼š</p>\n<ol>\n<li>å¤§ä½¬ä»¬ä¹Ÿä¼šå†™<code>todo</code>ï¼Œå…³é”®æ˜¯ï¼ä»–ä»¬çš„<code>TODO</code>å¹´å¤´æœ‰ç‚¹ä¹…äº†ï¼Œå“ˆå“ˆå“ˆå“ˆï¼Œ5å¹´äº†ï¼Œçœ‹æ ·å­ä¸æ˜¯åªæœ‰æˆ‘ä¸ä¼šç»§ç»­ä¼˜åŒ–çš„ï¼Œå“ˆå“ˆå“ˆå“ˆã€‚ä¹Ÿæœ‰å¯èƒ½æ˜¯æ²¡æœ‰æƒ³åˆ°æ›´å¥½çš„æ–¹æ³•ã€‚ã€‚ã€‚</li>\n<li>é‡Œé¢ä»–è‡ªå·±<code>dispatch</code>äº†ä¸€ä¸ªï¼Œ<code>ActionTypes.REPLACE</code>ã€‚</li>\n</ol>\n<p>okï¼Œæˆ‘ä»¬ä¸€æ¢ç©¶ç«Ÿï¼Œè¿™ä¸ª<code>ActionTypes.REPLACE</code></p>\n<p>æ‰’å¼€è¡£æœï¼ç›´æ¥å¼€çœ‹ğŸ‘€ï¼</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * These are private action types reserved by Redux.</span></span><br><span class=\"line\"><span class=\"comment\"> * For any unknown actions, you must return the current state.</span></span><br><span class=\"line\"><span class=\"comment\"> * If the current state is undefined, you must return the initial state.</span></span><br><span class=\"line\"><span class=\"comment\"> * Do not reference these action types directly in your code.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> randomString = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span></span><br><span class=\"line\">  <span class=\"built_in\">Math</span>.random().toString(<span class=\"number\">36</span>).substring(<span class=\"number\">7</span>).split(<span class=\"string\">''</span>).join(<span class=\"string\">'.'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> ActionTypes = &#123;</span><br><span class=\"line\">  INIT: <span class=\"string\">`@@redux/INIT<span class=\"subst\">$&#123;<span class=\"regexp\">/* #__PURE__ */</span> randomString()&#125;</span>`</span>,</span><br><span class=\"line\">  REPLACE: <span class=\"string\">`@@redux/REPLACE<span class=\"subst\">$&#123;<span class=\"regexp\">/* #__PURE__ */</span> randomString()&#125;</span>`</span>,</span><br><span class=\"line\">  PROBE_UNKNOWN_ACTION: <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> <span class=\"string\">`@@redux/PROBE_UNKNOWN_ACTION<span class=\"subst\">$&#123;randomString()&#125;</span>`</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> ActionTypes</span><br></pre></td></tr></table></figure>\n\n<p>å…¶å®å°±æ˜¯ä¸€ä¸ªä¸æƒ³å’Œæˆ‘ä»¬çš„<code>type</code>å†²çªçš„éšæœºæ•°ï¼Œå‘Šè¯‰<code>redux</code>ï¼Œè¿™ä¸ªæ˜¯ä»–ä»¬å†…éƒ¨çš„ä¸€ä¸ª<code>dispatch</code>è€Œå·²ã€‚</p>\n<h4 id=\"observable\"><a href=\"#observable\" class=\"headerlink\" title=\"observable\"></a>observable</h4><p>è¿™ä¸ªç©æ„ï¼Œå…¶å®æˆ‘æ˜¯ä¸å¤ªæ‡‚ä»–æ˜¯å¹²ä»€ä¹ˆçš„ã€‚ã€‚ã€‚å…¨å±€æœä¹Ÿæ²¡æœ‰æœå‡ºæ¥ï¼Œè€Œä¸”æˆ‘ä¹Ÿæ²¡ç”¨è¿‡ã€‚ã€‚ã€‚</p>\n<p>å¤§å®¶çœ‹æ³¨é‡Šå§ï¼Œä¸è¿‡å¤šè§£é‡Šï¼Œå¦‚æœæœ‰æ‡‚å“¥ï¼Œæ¬¢è¿ä¸€èµ·äº¤æµè®¨è®ºå‘€ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// æŸ¥è¯¢ä¹‹å,ä¹Ÿæ²¡å‘ç°æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ç”¨å¤„...æš‚æ—¶è·³è¿‡,å¦‚æœæœ‰å¸…å“¥çœ‹åˆ°çš„è¯å¯ä»¥ä¸åèµæ•™</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">observable</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> outerSubscribe = subscribe</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">       The minimal observable subscription method.</span></span><br><span class=\"line\"><span class=\"comment\">       <span class=\"doctag\">@param </span>observer Any object that can be used as an observer.</span></span><br><span class=\"line\"><span class=\"comment\">       The observer object should have a `next` method.</span></span><br><span class=\"line\"><span class=\"comment\">       <span class=\"doctag\">@returns </span>An object with an `unsubscribe` method that can</span></span><br><span class=\"line\"><span class=\"comment\">       be used to unsubscribe the observable from the store, and prevent further</span></span><br><span class=\"line\"><span class=\"comment\">       emission of values from the observable.</span></span><br><span class=\"line\"><span class=\"comment\">       */</span></span><br><span class=\"line\">      subscribe(observer: unknown) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> observer !== <span class=\"string\">'object'</span> || observer === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">TypeError</span>(<span class=\"string\">'Expected the observer to be an object.'</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//è·å–è§‚å¯Ÿç€çš„çŠ¶æ€</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">observeState</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"keyword\">const</span> observerAsObserver = observer <span class=\"keyword\">as</span> Observer&lt;S&gt;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (observerAsObserver.next) &#123;</span><br><span class=\"line\">            observerAsObserver.next(getState())</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        observeState()</span><br><span class=\"line\">        <span class=\"comment\">//è¿”å›å–æ¶ˆè®¢é˜…çš„æ–¹æ³•</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> unsubscribe = outerSubscribe(observeState)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> &#123; unsubscribe &#125;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">      [$$observable]() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>å…¶å®ä»–å†…éƒ¨è¿˜è‡ªå·±æ‰§è¡Œäº†ä¸€ä¸‹<code>dispatch</code>ï¼Œåœ¨<code>createStore</code>çš„æœ€åã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dispatch(&#123; <span class=\"attr\">type</span>: ActionTypes.INIT &#125; <span class=\"keyword\">as</span> A)</span><br></pre></td></tr></table></figure>\n\n<p>å…¶å®ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œæˆ‘ä»¬<code>createStore</code>çš„æ—¶å€™ï¼Œåˆå§‹çš„<code>state</code>å°±æ˜¯è¿™æ ·æ¥çš„~</p>\n<p>é‡Œé¢çš„<code>INIT</code>ï¼Œåœ¨æˆ‘ä»¬ä¹‹å‰<code>REPLACE</code>é‡Œé¢ä¹Ÿæœ‰ä»‹ç»ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªéšæœºæ•°è€Œå·²ã€‚</p>\n<h2 id=\"applyMiddleware\"><a href=\"#applyMiddleware\" class=\"headerlink\" title=\"applyMiddleware\"></a>applyMiddleware</h2><p>è¿™ä¸ªå‘ï¼Œæ˜¯ä¹‹å‰åœ¨<code>createStore</code>çš„<code>ensureCanMutateNextListeners</code>åŸ‹ä¸‹çš„ï¼Œç°åœ¨æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹è¿™ä¸ªã€‚</p>\n<p>è¿™ä¸ªreduxæ‹“å±•dispatchçš„å”¯ä¸€çš„æ ‡å‡†çš„æ–¹æ³•ã€‚</p>\n<p>é¦–å…ˆï¼Œæˆ‘ä»¬å¾—çŸ¥é“æ€ä¹ˆç”¨ã€‚æˆ‘è´´ä¸‹æˆ‘è‡ªå·±demoã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// middleware</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> logger = <span class=\"function\">(<span class=\"params\">store:any</span>) =&gt;</span> <span class=\"function\">(<span class=\"params\">next:any</span>) =&gt;</span> <span class=\"function\">(<span class=\"params\">action:any</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// debugger</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.info(<span class=\"string\">'dispatching'</span>, action)</span><br><span class=\"line\">  <span class=\"keyword\">const</span> result = next(action);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'next state'</span>, store.getState())</span><br><span class=\"line\">  <span class=\"keyword\">return</span> result</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>è¿™ä¸ªæ˜¯å®˜æ–¹çš„demoï¼Œä¸äº†è§£çš„ï¼Œ<a href=\"https://www.redux.org.cn/docs/advanced/Middleware.html\" target=\"_blank\" rel=\"noopener\">ç‚¹æˆ‘å¿«é€Ÿäº†è§£</a></p>\n<p>okï¼Œæˆ‘ä»¬ç›´æ¥è´´æºç ï¼Œå¾ˆçŸ­ï¼Œä½†æ˜¯æœ‰å¾ˆå¤šå¥¥å¦™ï¼ˆå¥¥å¦™æ‰“é’±ï¼ï¼‰ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">applyMiddleware</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  ...middlewares: Middleware[]</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\"></span>): <span class=\"title\">StoreEnhancer</span>&lt;<span class=\"title\">any</span>&gt; </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\">(<span class=\"params\">createStore: StoreEnhancerStoreCreator</span>) =&gt;</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">S,</span> <span class=\"attr\">A</span> <span class=\"attr\">extends</span> <span class=\"attr\">AnyAction</span>&gt;</span>(</span></span><br><span class=\"line\">    reducer: Reducer&lt;S, A&gt;,</span><br><span class=\"line\">    preloadedState?: PreloadedState&lt;S&gt;</span><br><span class=\"line\">  ) =&gt; &#123;</span><br><span class=\"line\">    const store = createStore(reducer, preloadedState)</span><br><span class=\"line\">    let dispatch: Dispatch = () =&gt; &#123;</span><br><span class=\"line\">      throw new Error(</span><br><span class=\"line\">        'Dispatching while constructing your middleware is not allowed. ' +</span><br><span class=\"line\">          'Other middleware would not be applied to this dispatch.'</span><br><span class=\"line\">      )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    const middlewareAPI: MiddlewareAPI = &#123;</span><br><span class=\"line\">      getState: store.getState,</span><br><span class=\"line\">      dispatch: (action, ...args) =&gt; dispatch(action, ...args)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    const chain = middlewares.map(middleware =&gt; middleware(middlewareAPI))</span><br><span class=\"line\">    dispatch = compose&lt;typeof dispatch&gt;(...chain)(store.dispatch)</span><br><span class=\"line\"></span><br><span class=\"line\">    return &#123;</span><br><span class=\"line\">      ...store,</span><br><span class=\"line\">      dispatch</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>çœ‹èµ·æ¥å¾ˆçŸ­ï¼Œä½†æ˜¯å´æœ‰å¾ˆå¤šæ·±å¥¥çš„åœ°æ–¹ã€‚ä¸€ä¸ªä¸ªæ¥ã€‚</p>\n<p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸€ä¸‹å‡½æ•°æŸ¯é‡ŒåŒ–ã€‚ç›´æ¥ä¸Šdemoå¸®åŠ©ç†è§£</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\">a</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test2</span>(<span class=\"params\">b</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(a + b)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> t = test(<span class=\"number\">1</span>);</span><br><span class=\"line\">t(<span class=\"number\">2</span>); <span class=\"comment\">// 3</span></span><br></pre></td></tr></table></figure>\n\n<p>è¿™é‡Œå°±æ˜¯ä¸€ä¸ªç®€å•çš„å‡½æ•°æŸ¯é‡ŒåŒ–ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå­˜å‚¨ä¸€ä¸‹ç¬¬ä¸€æ¬¡ä¼ å…¥çš„å‚æ•°ï¼Œåé¢å¦‚æœè¿™ä¸ª<code>1</code>ä¼šå¤ç”¨çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å®šä¹‰çš„å˜é‡<code>t</code>å°±å¯ä»¥åœ¨å¾ˆå¤šåœ°æ–¹ä½¿ç”¨ï¼Œé‡Œé¢ç”¨åˆ°äº†é—­åŒ…çš„çŸ¥è¯†ï¼Œè€Œä¸”æ˜¯éå¸¸å…¸å‹çš„é—­åŒ…ï¼Œå­˜å‚¨å½¢å‚<code>a</code>ï¼Œå®å‚<code>1</code>ã€‚</p>\n<p>è¿˜è®°å¾—æˆ‘ä»¬çš„ä½¿ç”¨ç”¨ä¾‹å—ï¼Ÿ</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// middleware</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> logger = <span class=\"function\">(<span class=\"params\">store:any</span>) =&gt;</span> <span class=\"function\">(<span class=\"params\">next:any</span>) =&gt;</span> <span class=\"function\">(<span class=\"params\">action:any</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// debugger</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.info(<span class=\"string\">'dispatching'</span>, action)</span><br><span class=\"line\">  <span class=\"keyword\">const</span> result = next(action);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'next state'</span>, store.getState())</span><br><span class=\"line\">  <span class=\"keyword\">return</span> result</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>è¿™é‡Œé¢ç¬¬ä¸€ä¸ªå‚æ•°<code>store</code>å°±æ˜¯å¯¹åº”åˆ°æˆ‘ä»¬<code>createStore</code>æºç é‡Œé¢æˆ‘ä»¬æŒ–çš„å‘ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> enhancer !== <span class=\"string\">'undefined'</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœenhancerå­˜åœ¨ï¼Œé‚£ä»–å¿…é¡»æ˜¯ä¸ªfunction, å¦åˆ™throw Errorå“ˆ</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> enhancer !== <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">'Expected the enhancer to be a function.'</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * ä¼ å…¥ç¬¦åˆå‚æ•°ç±»å‹çš„å‚æ•°ï¼Œå°±å¯ä»¥æ‰§è¡Œ enhancer,</span></span><br><span class=\"line\"><span class=\"comment\">     * ä½†æ˜¯è¿™ä¸ªreturnæ·±æ·±çš„å¸å¼•äº†æˆ‘, å› ä¸ºè¯´æ˜æœ‰applyMiddlewareçš„æ—¶å€™åé¢çš„éƒ½ä¸ç”¨çœ‹äº† ??? å½“ç„¶\u001dä¸å¯èƒ½</span></span><br><span class=\"line\"><span class=\"comment\">     * å¯æ˜¯applyMiddlewareå…¶å®æ˜¯å¿…ç”¨é¡¹ï¼Œæ‰€ä»¥çŒœæƒ³ä¸€ä¸‹applyMiddlewareå¼ºåŒ–storeä¹‹åä¼šenhancerèµ‹å€¼undefinedï¼Œå†æ¬¡è°ƒç”¨createStore</span></span><br><span class=\"line\"><span class=\"comment\">     * ä¸Šä¸‹æ‰“ä¸ªdebuggerçœ‹ä¸€ä¸‹æ‰§è¡Œé¡ºåº(debuggerä½ç½®ä»¥æ³¨é‡Š)ï¼Œæœç„¶ä¸å‡ºæ‰€æ–™</span></span><br><span class=\"line\"><span class=\"comment\">     * å¥½äº†ï¼Œ å‡è®¾æˆ‘ä»¬è¿˜ä¸çŸ¥é“applyMiddleware()è¿™ä¸ªfuncrionå…·ä½“å¹²äº†ä»€ä¹ˆï¼Œ</span></span><br><span class=\"line\"><span class=\"comment\">     * åªçŸ¥é“ä»–åšäº†ä¸€äº›å¤„ç†ç„¶åé‡æ–°è°ƒç”¨äº†createStoreå¹¶ä¸”enhancerå‚æ•°ä¸ºundefined</span></span><br><span class=\"line\"><span class=\"comment\">     * å…ˆè®°ä¸‹ï¼Œåç»­åœ¨çœ‹applyMiddlewareï¼Œ å› ä¸ºæˆ‘ä»¬ç°åœ¨è¦çœ‹çš„æ˜¯createStore</span></span><br><span class=\"line\"><span class=\"comment\">     * * */</span></span><br><span class=\"line\">    <span class=\"comment\">// debugger</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> enhancer(createStore)(</span><br><span class=\"line\">      reducer,</span><br><span class=\"line\">      preloadedState <span class=\"keyword\">as</span> PreloadedState&lt;S&gt;</span><br><span class=\"line\">    ) <span class=\"keyword\">as</span> Store&lt;ExtendState&lt;S, StateExt&gt;, A, StateExt, Ext&gt; &amp; Ext</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<p>ç¬¬äºŒä¸ª<code>next</code>ï¼Œå…¶å®å°±æ˜¯<code>middlewareAPI</code>é‡Œé¢çš„<code>dispatch</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> middlewareAPI: MiddlewareAPI = &#123;</span><br><span class=\"line\">      getState: store.getState,</span><br><span class=\"line\">      dispatch: <span class=\"function\">(<span class=\"params\">action, ...args</span>) =&gt;</span> dispatch(action, ...args),</span><br><span class=\"line\">      test:<span class=\"number\">2</span>,</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>å¢åŠ ä¸€ä¸ª<code>log</code>åœ¨<code>middleware</code>é‡Œé¢å°±å¯ä»¥çŸ¥é“äº†</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> logger = <span class=\"function\">(<span class=\"params\">store:any</span>) =&gt;</span> <span class=\"function\">(<span class=\"params\">next:any</span>) =&gt;</span> <span class=\"function\">(<span class=\"params\">action:any</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// debugger</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(store)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'next==='</span>,next)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(action)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.info(<span class=\"string\">'dispatching'</span>, action)</span><br><span class=\"line\">  <span class=\"comment\">// const result = next(action);</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'next state'</span>, store.getState())</span><br><span class=\"line\">  <span class=\"comment\">// return result</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>è¿™ä¸ªæ—¶å€™<code>log</code>çš„æ˜¯æˆ‘ä»¬åœ¨<code>createStore</code>é‡Œé¢çš„<code>dispatch</code>ï¼Œè¿˜å‡ºç°äº†æˆ‘ä»¬çš„æ³¨é‡Š</p>\n<p>è¯´æ˜<code>next</code>è¿™ä¸ªå‚æ•°å°±æ˜¯å¯¹åº”çš„<code>middlewareAPI</code>é‡Œé¢çš„<code>dispatch</code>ä¹Ÿå°±æ˜¯è¯´æ˜¯<code>createStore</code>é‡Œé¢çš„<code>dispatch</code>ã€‚</p>\n<p>ç¬¬ä¸‰ä¸ªå‚æ•°<code>action</code></p>\n<p>å¾ˆç®€å•ï¼Œå…¶å®å°±æ˜¯æ™®æ™®é€šé€šçš„ä¸€ä¸ª<code>action</code>ã€‚ä¸è¿‡æ˜¯ä»æˆ‘ä»¬<code>middleaware</code>é‡Œé¢å¾—åˆ°çš„ã€‚è¿™ä¸ªæ²¡æœ‰ç–‘æƒ‘ã€‚</p>\n<blockquote>\n<p>æˆ‘ä»¬ä¼šå‘ç°ä¸€ä¸ªå¾ˆæœ‰è¶£çš„äº‹æƒ…å°±æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æ³¨é‡Šæ‰è°ƒç”¨<code>next(action)</code>ï¼Œå¹¶ä¸”ä¸å°†ç»“æœ<code>return</code>çš„è¯ï¼Œè¿™ä¸ª<code>action</code>å°±ä¼šè¢«å¡ä½ï¼Œæ²¡æœ‰å‘å‡ºå»ï¼Œè¢«æˆ‘ä»¬æ‰“æ–­äº†ï¼Œæ‰€ä»¥è¿™å°±æ˜¯æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªçš„åŸå› ã€‚é‚£ä¹ˆå°±å¯ä»¥å¼•ç”³å‡ºæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰æ‰“æ–­æŸäº›æƒ…å†µä¸‹çš„actionï¼Œç„¶åéœ€è¦åœ¨é‚£äº›æƒ…å†µä¸‹ç»™actioné‡Œé¢åŠ äº›ä»€ä¹ˆï¼Œéƒ½å¯ä»¥åŠåˆ°ã€‚</p>\n</blockquote>\n<p>okï¼Œæˆ‘ä»¬çœ‹äº†ä¹‹åå¥½åƒçŸ¥é“<code>applyMiddleware</code>é‡Œé¢çš„å‚æ•°éƒ½å¯¹åº”è¿™å“ªäº›ä¸œè¥¿äº†ï¼Œä½†æ˜¯ä¼¼ä¹ä¸çŸ¥é“ä¸ºä»€ä¹ˆæ˜¯ä¸€ç§æŸ¯é‡ŒåŒ–çš„å½¢å¼æ¥å±•ç¤ºçš„ã€‚æˆ‘ä»¬çœ‹ä¸‹é¢çš„ä»£ç å°±ä¼šçŸ¥é“äº†ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// è°ƒç”¨æ¯ä¸€ä¸ªè¿™æ ·å½¢å¼çš„middleware = store =&gt; next =&gt; action =&gt;&#123;&#125;, </span></span><br><span class=\"line\"><span class=\"comment\">// ç»„æˆä¸€ä¸ªè¿™æ ·[f(next)=&gt;acticon=&gt;next(action)...]çš„arrayï¼Œèµ‹å€¼ç»™chain</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> chain = middlewares.map(<span class=\"function\"><span class=\"params\">middleware</span> =&gt;</span> middleware(middlewareAPI))</span><br><span class=\"line\"><span class=\"comment\">// debugger</span></span><br><span class=\"line\"><span class=\"comment\">// composeçœ‹ -&gt; compose.jsæ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"comment\">// compose(...chain)ä¼šå½¢æˆä¸€ä¸ªè°ƒç”¨é“¾, nextæŒ‡ä»£ä¸‹ä¸€ä¸ªå‡½æ•°çš„æ³¨å†Œ, è¿™å°±æ˜¯ä¸­é—´ä»¶çš„è¿”å›å€¼è¦æ˜¯next(action)çš„åŸå› </span></span><br><span class=\"line\"><span class=\"comment\">// å¦‚æœæ‰§è¡Œåˆ°äº†æœ€ånextå°±æ˜¯åŸç”Ÿçš„store.dispatchæ–¹æ³•</span></span><br><span class=\"line\">dispatch = compose(...chain)(store.dispatch)</span><br></pre></td></tr></table></figure>\n\n<p>é‡Œé¢æåˆ°äº†<code>compose</code>è¿™ä¸ªå‡½æ•°ï¼Œå…¶å®è¿™ä¸ªå‡½æ•°å°±æ˜¯æ•´ä¸ªä¸­é—´ä»¶çš„ç²¾é«“æ‰€åœ¨ã€‚æŸ¯é‡ŒåŒ–çš„å¥¥ä¹‰ï¼</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">compose</span>(<span class=\"params\">...funcs: Function[]</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (funcs.length === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// infer the argument type so it is usable in inference down the line</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">T</span>&gt;</span>(arg: T) =&gt; arg</span></span><br><span class=\"line\"><span class=\"xml\">  &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"xml\">  if (funcs.length === 1) &#123;</span></span><br><span class=\"line\"><span class=\"xml\">    return funcs[0]</span></span><br><span class=\"line\"><span class=\"xml\">  &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"xml\">  return funcs.reduce((a, b) =&gt; (...args: any) =&gt; a(b(...args)))</span></span><br><span class=\"line\"><span class=\"xml\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>ä¸äº†è§£reduceçš„åŒå­¦å¯ä»¥<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce\" target=\"_blank\" rel=\"noopener\">ç‚¹è¿™é‡Œ</a>ã€‚</p>\n<p>è¿™ä¸ªcomposeå…¶å®æ˜¯ä¸€ä¸ªè°ƒç”¨é“¾ï¼Œæˆ‘ä»¬çš„æ‰€æœ‰çš„ä¸­é—´ä»¶éƒ½ä¼šæŒ‰é¡ºåºåŠ è½½ï¼Œç„¶åæ˜¯ğŸ‘‡è¿™ç§å½¢å¼</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">middleware = <span class=\"function\"><span class=\"params\">middleware1</span> =&gt;</span> <span class=\"function\"><span class=\"params\">middleware2</span> =&gt;</span> <span class=\"function\"><span class=\"params\">middleware3</span> =&gt;</span> middleware4 <span class=\"comment\">//...</span></span><br></pre></td></tr></table></figure>\n\n<p>æˆ‘ä»¬é€šè¿‡ä¸€ä¸‹ä»£ç çŸ¥é“ï¼Œç¡®å®æ˜¯å¾€ä¸‹ä¼ é€’çš„ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// middleware</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> logger = <span class=\"function\">(<span class=\"params\">store:any</span>) =&gt;</span> <span class=\"function\">(<span class=\"params\">next:any</span>) =&gt;</span> <span class=\"function\">(<span class=\"params\">action:any</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// debugger</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(store)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'next==='</span>,next)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(action)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.info(<span class=\"string\">'dispatching'</span>, action)</span><br><span class=\"line\">  action.aa = <span class=\"number\">2</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> result = next(action);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'next state'</span>, store.getState())</span><br><span class=\"line\">  <span class=\"keyword\">return</span> result</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> logger2 = <span class=\"function\">(<span class=\"params\">store:any</span>) =&gt;</span> <span class=\"function\">(<span class=\"params\">next:any</span>) =&gt;</span> <span class=\"function\">(<span class=\"params\">action:any</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// debugger</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(store)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'next2==='</span>,next)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'logger2==-=-=-=-=-=-='</span>,action)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.info(<span class=\"string\">'dispatching'</span>, action)</span><br><span class=\"line\">  <span class=\"keyword\">const</span> result = next(action);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'next state'</span>, store.getState())</span><br><span class=\"line\">  <span class=\"keyword\">return</span> result</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> store = createStore(rootReducer, &#123;<span class=\"attr\">todos</span>:[]&#125;, applyMiddleware(logger, logger2));</span><br></pre></td></tr></table></figure>\n\n<p>åœ¨<code>logger2</code>é‡Œé¢ç¡®å®æ‰“å°å‡ºæ¥<code>aa</code>è¿™ä¸ªå±æ€§çš„å€¼ï¼Œè€Œ<code>logger</code>å´æ²¡æœ‰</p>\n<h2 id=\"compose\"><a href=\"#compose\" class=\"headerlink\" title=\"compose\"></a>compose</h2><p>è¿™ä¸ªåœ¨ä¸Šé¢ä»‹ç»applyMiddlewareçš„æ—¶å€™è¯´è¿‡äº†ã€‚å°±ä¸å¤šè¯´äº†ã€‚</p>\n<h2 id=\"combineReducers\"><a href=\"#combineReducers\" class=\"headerlink\" title=\"combineReducers\"></a>combineReducers</h2><p>è¿™ä¸ªä¸­æ–‡ç¿»è¯‘å°±æ˜¯ã€Šç»„åˆreducerã€‹ã€‚</p>\n<p>å…¶å®å°±æ˜¯ å­—é¢æ„æ€ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹æ€ä¹ˆç”¨å°±äº†è§£äº†ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> combineReducers(&#123;</span><br><span class=\"line\">  firstReducer: todos,</span><br><span class=\"line\">  secondReducer: visibilityFilter</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>ç„¶åæˆ‘ä»¬çœ‹ä¸€ä¸‹<code>log</code>å‡ºæ¥çš„<code>props</code>æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">\tfirstReducer: &#123;<span class=\"attr\">todos</span>: <span class=\"built_in\">Array</span>(<span class=\"number\">0</span>)&#125;</span><br><span class=\"line\">\tsecondReducer: <span class=\"string\">\"SHOW_ALL\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸€å¼€å§‹è®¾ç½®è¿›å»çš„<code>key</code>å€¼ï¼Œè¿”å›çš„æ—¶å€™ä¹Ÿæ˜¯æŒ‰è¿™ä¸ªæ ¼å¼è¿”å›çš„ã€‚</p>\n<p>é‡Œé¢æœ‰è®¸å¤šå‡½æ•°ï¼Œæˆ‘ä»¬å…ˆçœ‹ä»–åˆ°å¤„çš„å‡½æ•°<code>combineReducers</code></p>\n<h3 id=\"combineReducers-1\"><a href=\"#combineReducers-1\" class=\"headerlink\" title=\"combineReducers\"></a>combineReducers</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ç”¨äºåˆå¹¶reducer ä¸€èˆ¬æ˜¯è¿™æ ·combineReducers(&#123;a,b,c&#125;)</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">combineReducers</span>(<span class=\"params\">reducers: ReducersMapObject</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// reducersä¸­keyçš„æ•°ç»„</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> reducerKeys = <span class=\"built_in\">Object</span>.keys(reducers)</span><br><span class=\"line\">  <span class=\"comment\">// æœ€ç»ˆçš„reducer</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> finalReducers: ReducersMapObject = &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// å¾ªç¯ï¼Œ ç›®çš„ä¸ºäº†ç»™finalReducersèµ‹å€¼ï¼Œ è¿‡è™‘äº†ä¸ç¬¦åˆè§„èŒƒçš„reducer</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; reducerKeys.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// æ¥å—å½“å‰çš„key</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> key = reducerKeys[i]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœä¸æ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œ å½“å‰çš„reduceræ˜¯undefinedä¼šç»™å‡ºwarning</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (process.env.NODE_ENV !== <span class=\"string\">'production'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> reducers[key] === <span class=\"string\">'undefined'</span>) &#123;</span><br><span class=\"line\">        warning(<span class=\"string\">`No reducer provided for key \"<span class=\"subst\">$&#123;key&#125;</span>\"`</span>)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// reducerè¦æ˜¯ä¸€ä¸ªfunction</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> reducers[key] === <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// èµ‹å€¼ç»™finalReducers</span></span><br><span class=\"line\">      finalReducers[key] = reducers[key]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// ç¬¦åˆè§„èŒƒçš„reducerçš„keyæ•°ç»„</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> finalReducerKeys = <span class=\"built_in\">Object</span>.keys(finalReducers)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// This is used to make sure we don't warn about the same</span></span><br><span class=\"line\">  <span class=\"comment\">// keys multiple times.</span></span><br><span class=\"line\">  <span class=\"comment\">// æ„æƒ³ä¸åˆ°çš„keyï¼Œ å…ˆå¾€ä¸‹çœ‹çœ‹</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> unexpectedKeyCache: &#123; [key: string]: <span class=\"literal\">true</span> &#125;</span><br><span class=\"line\">  <span class=\"comment\">// productionç¯å¢ƒä¸º&#123;&#125;</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (process.env.NODE_ENV !== <span class=\"string\">'production'</span>) &#123;</span><br><span class=\"line\">    unexpectedKeyCache = &#123;&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> shapeAssertionError: <span class=\"built_in\">Error</span></span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// çœ‹è¿™ä¸ªfunction</span></span><br><span class=\"line\">    assertReducerShape(finalReducers)</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">    shapeAssertionError = e</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// è¿”å›functionï¼Œ å³ä¸ºcreateStoreä¸­çš„reducerå‚æ•°æ—¢currentReducer</span></span><br><span class=\"line\">  <span class=\"comment\">// è‡ªç„¶æœ‰stateå’Œactionä¸¤ä¸ªå‚æ•°ï¼Œ å¯ä»¥å›createStoreæ–‡ä»¶çœ‹çœ‹currentReducer(currentState, action)</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">combination</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">    state: StateFromReducersMapObject&lt;typeof reducers&gt; = &#123;&#125;,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">    action: AnyAction</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  </span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// reducerä¸è§„èŒƒæŠ¥é”™</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (shapeAssertionError) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> shapeAssertionError</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// æ¯”è¾ƒç»†è‡´çš„âŒä¿¡æ¯ï¼Œé¡ºä¾¿çœ‹äº†ä¸€ä¸‹getUndefinedStateErrorMessageï¼Œéƒ½æ˜¯ç”¨äºæç¤ºwarningå’Œerrorçš„ï¼Œ ä¸è¿‡å¤šè§£é‡Šäº†</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (process.env.NODE_ENV !== <span class=\"string\">'production'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> warningMessage = getUnexpectedStateShapeWarningMessage(</span><br><span class=\"line\">        state,</span><br><span class=\"line\">        finalReducers,</span><br><span class=\"line\">        action,</span><br><span class=\"line\">        unexpectedKeyCache</span><br><span class=\"line\">      )</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (warningMessage) &#123;</span><br><span class=\"line\">        warning(warningMessage)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> hasChanged = <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> nextState: StateFromReducersMapObject&lt;<span class=\"keyword\">typeof</span> reducers&gt; = &#123;&#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; finalReducerKeys.length; i++) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// è·å–finalReducerKeysçš„keyå’Œvalueï¼ˆfunctionï¼‰</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> key = finalReducerKeys[i]</span><br><span class=\"line\">      <span class=\"keyword\">const</span> reducer = finalReducers[key]</span><br><span class=\"line\">      <span class=\"comment\">// å½“å‰keyçš„stateå€¼</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> previousStateForKey = state[key]</span><br><span class=\"line\">      <span class=\"comment\">// æ‰§è¡Œreducerï¼Œ è¿”å›å½“å‰state</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> nextStateForKey = reducer(previousStateForKey, action)</span><br><span class=\"line\">      <span class=\"comment\">// ä¸å­˜åœ¨è¿”å›å€¼æŠ¥é”™</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> nextStateForKey === <span class=\"string\">'undefined'</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> errorMessage = getUndefinedStateErrorMessage(key, action)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(errorMessage)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"comment\">// æ–°çš„stateæ”¾åœ¨nextStateå¯¹åº”çš„keyé‡Œ</span></span><br><span class=\"line\">      nextState[key] = nextStateForKey</span><br><span class=\"line\">      <span class=\"comment\">// åˆ¤æ–­æ–°çš„stateæ˜¯ä¸æ˜¯åŒä¸€å¼•ç”¨ï¼Œ ä»¥æ£€éªŒreduceræ˜¯ä¸æ˜¯çº¯å‡½æ•°</span></span><br><span class=\"line\">      hasChanged = hasChanged || nextStateForKey !== previousStateForKey</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    hasChanged =</span><br><span class=\"line\">      hasChanged || finalReducerKeys.length !== <span class=\"built_in\">Object</span>.keys(state).length</span><br><span class=\"line\">      <span class=\"comment\">// æ”¹å˜äº†è¿”å›nextState</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> hasChanged ? nextState : state</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">  *  æ–°ç‰ˆæœ¬çš„reduxè¿™éƒ¨åˆ†æ”¹å˜äº†å®ç°æ–¹æ³•</span></span><br><span class=\"line\"><span class=\"comment\">  *  è€ç‰ˆæœ¬çš„reduxä½¿ç”¨çš„reduceå‡½æ•°å®ç°çš„</span></span><br><span class=\"line\"><span class=\"comment\">  *  ç®€å•ä¾‹å­å¦‚ä¸‹</span></span><br><span class=\"line\"><span class=\"comment\">  * function combineReducers(reducers) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">  *    return (state = &#123;&#125;, action) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"comment\">  *        return Object.keys(reducers).reduce((currentState, key) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"comment\">  *            currentState[key] = reducers[key](state[key], action);</span></span><br><span class=\"line\"><span class=\"comment\">  *             return currentState;</span></span><br><span class=\"line\"><span class=\"comment\">  *         &#125;, &#123;&#125;)</span></span><br><span class=\"line\"><span class=\"comment\">  *      &#125;;</span></span><br><span class=\"line\"><span class=\"comment\">  *    &#125;</span></span><br><span class=\"line\"><span class=\"comment\">  * </span></span><br><span class=\"line\"><span class=\"comment\">  * */</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä¸Šé¢æ˜¯ä¸»è¦æºç ï¼Œä¸€ä¸ªä¸ªå‰–æè¿›å»ã€‚</p>\n<p>å…ˆæ˜¯å¯¹æ•°æ®è¿›è¡Œæ¸…æ´—ï¼Œç¬¬ä¸€æ¬¡ç­›é€‰å‡ºç¬¦åˆè¦æ±‚çš„<code>reducer</code>ä»¬</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// reducersä¸­keyçš„æ•°ç»„</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> reducerKeys = <span class=\"built_in\">Object</span>.keys(reducers)</span><br><span class=\"line\">  <span class=\"comment\">// æœ€ç»ˆçš„reducer</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> finalReducers: ReducersMapObject = &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// å¾ªç¯ï¼Œ ç›®çš„ä¸ºäº†ç»™finalReducersèµ‹å€¼ï¼Œ è¿‡è™‘äº†ä¸ç¬¦åˆè§„èŒƒçš„reducer</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; reducerKeys.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// æ¥å—å½“å‰çš„key</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> key = reducerKeys[i]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœä¸æ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œ å½“å‰çš„reduceræ˜¯undefinedä¼šç»™å‡ºwarning</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (process.env.NODE_ENV !== <span class=\"string\">'production'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> reducers[key] === <span class=\"string\">'undefined'</span>) &#123;</span><br><span class=\"line\">        warning(<span class=\"string\">`No reducer provided for key \"<span class=\"subst\">$&#123;key&#125;</span>\"`</span>)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// reducerè¦æ˜¯ä¸€ä¸ªfunction</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> reducers[key] === <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// èµ‹å€¼ç»™finalReducers</span></span><br><span class=\"line\">      finalReducers[key] = reducers[key]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"assertReducerShape\"><a href=\"#assertReducerShape\" class=\"headerlink\" title=\"assertReducerShape\"></a>assertReducerShape</h3><p>åˆç­›ä¹‹åçš„finalReducersä¼šäº¤ç”±assertReducerShapeå†ä¸€æ¬¡è¿›è¡Œæ£€éªŒã€‚é‡Œé¢å°±æ˜¯ä¸€ä¸ªåˆ¤æ–­ï¼Œç„¶åç»™å‡ºè­¦å‘Šâš ï¸ä¹‹ç±»çš„ã€‚å°±ä¸å¤šè¯´äº†ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">assertReducerShape</span>(<span class=\"params\">reducers</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">Object</span>.keys(reducers).forEach(<span class=\"function\"><span class=\"params\">key</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> reducer = reducers[key]</span><br><span class=\"line\">   <span class=\"comment\">// reducerè¿”å›å€¼</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> initialState = reducer(<span class=\"literal\">undefined</span>, &#123; <span class=\"attr\">type</span>: ActionTypes.INIT &#125;)</span><br><span class=\"line\">    <span class=\"comment\">// undefined throw Error</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> initialState === <span class=\"string\">'undefined'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(</span><br><span class=\"line\">        <span class=\"string\">`Reducer \"<span class=\"subst\">$&#123;key&#125;</span>\" returned undefined during initialization. `</span> +</span><br><span class=\"line\">          <span class=\"string\">`If the state passed to the reducer is undefined, you must `</span> +</span><br><span class=\"line\">          <span class=\"string\">`explicitly return the initial state. The initial state may `</span> +</span><br><span class=\"line\">          <span class=\"string\">`not be undefined. If you don't want to set a value for this reducer, `</span> +</span><br><span class=\"line\">          <span class=\"string\">`you can use null instead of undefined.`</span></span><br><span class=\"line\">      )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å¾ˆæ˜æ˜¾assertReducerShapeæ˜¯ç”¨äºreducerçš„è§„èŒƒ</span></span><br><span class=\"line\">    <span class=\"comment\">// å›åˆ°combineReducers</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (</span><br><span class=\"line\">      <span class=\"keyword\">typeof</span> reducer(<span class=\"literal\">undefined</span>, &#123;</span><br><span class=\"line\">        type: ActionTypes.PROBE_UNKNOWN_ACTION()</span><br><span class=\"line\">      &#125;) === <span class=\"string\">'undefined'</span></span><br><span class=\"line\">    ) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(</span><br><span class=\"line\">        <span class=\"string\">`Reducer \"<span class=\"subst\">$&#123;key&#125;</span>\" returned undefined when probed with a random type. `</span> +</span><br><span class=\"line\">          <span class=\"string\">`Don't try to handle <span class=\"subst\">$&#123;</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">            ActionTypes.INIT</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">          &#125;</span> or other actions in \"redux/*\" `</span> +</span><br><span class=\"line\">          <span class=\"string\">`namespace. They are considered private. Instead, you must return the `</span> +</span><br><span class=\"line\">          <span class=\"string\">`current state for any unknown actions, unless it is undefined, `</span> +</span><br><span class=\"line\">          <span class=\"string\">`in which case you must return the initial state, regardless of the `</span> +</span><br><span class=\"line\">          <span class=\"string\">`action type. The initial state may not be undefined, but can be null.`</span></span><br><span class=\"line\">      )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"combination\"><a href=\"#combination\" class=\"headerlink\" title=\"combination\"></a>combination</h3><p>ç„¶åå°±æ˜¯è¿”å›combinationè¿™ä¸ªå‡½æ•°ã€‚å‚æ•°çš„æ„ä¹‰å°±æ˜¯ä»–çš„åå­—ã€‚å°±ä¸å¤šè¯´äº†ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">combination</span>(<span class=\"params\">state = &#123;&#125;, action</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// reducerä¸è§„èŒƒæŠ¥é”™</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (shapeAssertionError) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> shapeAssertionError</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// æ¯”è¾ƒç»†è‡´çš„âŒä¿¡æ¯ï¼Œé¡ºä¾¿çœ‹äº†ä¸€ä¸‹getUndefinedStateErrorMessageï¼Œéƒ½æ˜¯ç”¨äºæç¤ºwarningå’Œerrorçš„ï¼Œ ä¸è¿‡å¤šè§£é‡Šäº†</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (process.env.NODE_ENV !== <span class=\"string\">'production'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> warningMessage = getUnexpectedStateShapeWarningMessage(</span><br><span class=\"line\">        state,</span><br><span class=\"line\">        finalReducers,</span><br><span class=\"line\">        action,</span><br><span class=\"line\">        unexpectedKeyCache</span><br><span class=\"line\">      )</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (warningMessage) &#123;</span><br><span class=\"line\">        warning(warningMessage)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> hasChanged = <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> nextState = &#123;&#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; finalReducerKeys.length; i++) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// è·å–finalReducerKeysçš„keyå’Œvalueï¼ˆfunctionï¼‰</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> key = finalReducerKeys[i]</span><br><span class=\"line\">      <span class=\"keyword\">const</span> reducer = finalReducers[key]</span><br><span class=\"line\">      <span class=\"comment\">// å½“å‰keyçš„stateå€¼</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> previousStateForKey = state[key]</span><br><span class=\"line\">      <span class=\"comment\">// æ‰§è¡Œreducerï¼Œ è¿”å›å½“å‰state</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> nextStateForKey = reducer(previousStateForKey, action)</span><br><span class=\"line\">      <span class=\"comment\">// ä¸å­˜åœ¨è¿”å›å€¼æŠ¥é”™</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> nextStateForKey === <span class=\"string\">'undefined'</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> errorMessage = getUndefinedStateErrorMessage(key, action)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(errorMessage)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"comment\">// æ–°çš„stateæ”¾åœ¨nextStateå¯¹åº”çš„keyé‡Œ</span></span><br><span class=\"line\">      nextState[key] = nextStateForKey</span><br><span class=\"line\">      <span class=\"comment\">// åˆ¤æ–­æ–°çš„stateæ˜¯ä¸æ˜¯åŒä¸€å¼•ç”¨ï¼Œ ä»¥æ£€éªŒreduceræ˜¯ä¸æ˜¯çº¯å‡½æ•°</span></span><br><span class=\"line\">      hasChanged = hasChanged || nextStateForKey !== previousStateForKey</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// æ”¹å˜äº†è¿”å›nextState</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> hasChanged ? nextState : state</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">  *  æ–°ç‰ˆæœ¬çš„reduxè¿™éƒ¨åˆ†æ”¹å˜äº†å®ç°æ–¹æ³•</span></span><br><span class=\"line\"><span class=\"comment\">  *  è€ç‰ˆæœ¬çš„reduxä½¿ç”¨çš„reduceå‡½æ•°å®ç°çš„</span></span><br><span class=\"line\"><span class=\"comment\">  *  ç®€å•ä¾‹å­å¦‚ä¸‹</span></span><br><span class=\"line\"><span class=\"comment\">  * function combineReducers(reducers) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">  *    return (state = &#123;&#125;, action) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"comment\">  *        return Object.keys(reducers).reduce((currentState, key) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"comment\">  *            currentState[key] = reducers[key](state[key], action);</span></span><br><span class=\"line\"><span class=\"comment\">  *             return currentState;</span></span><br><span class=\"line\"><span class=\"comment\">  *         &#125;, &#123;&#125;)</span></span><br><span class=\"line\"><span class=\"comment\">  *      &#125;;</span></span><br><span class=\"line\"><span class=\"comment\">  *    &#125;</span></span><br><span class=\"line\"><span class=\"comment\">  * </span></span><br><span class=\"line\"><span class=\"comment\">  * */</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>å…¶å®å°±æ˜¯æ‰§è¡Œreducerï¼Œç„¶åæŠŠå€¼æ‹¿å‡ºæ¥æ¯”å¯¹ï¼Œå¦‚æœæ˜¯å¼•ç”¨çš„è¯å°±è¿”å›ä¹‹å‰çš„stateï¼Œå¦‚æœä¸æ˜¯å°±ä½¿ç”¨æ–°çš„ã€‚ä»–çš„æ¯”å¯¹å’Œä¹‹å‰è¯´çš„æ•°ç»„æ¯”å¯¹ä¸€æ ·ï¼Œéƒ½æ˜¯æ¯”å¯¹å†…å­˜åœ°å€ã€‚</p>\n<p>ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Ÿ</p>\n<p>å¥½é—®é¢˜ï¼</p>\n<p>è¿™æ ·åšçš„å¥½å¤„å…¶å®å°±æ˜¯ä¸ºäº†çº¯å‡½æ•°ï¼Œä¸ºäº†ä¸€åˆ‡å¯é¢„æµ‹ã€‚è€Œä¸”ç®€å•çš„æ¯”è¾ƒå†…å­˜åœ°å€æ¯”é€’å½’çš„æ€§èƒ½å¥½å¤ªå¤šäº†ã€‚</p>\n<p>é‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆæ ·æ‰å¯ä»¥å¥‘åˆè¿™æ ·çš„ç†å¿µå‘¢ï¼Ÿ</p>\n<p>å°±æ˜¯æˆ‘ä»¬åœ¨å†™reducerè¿”å›çš„æ—¶å€™ï¼Œéœ€è¦è¿”å›ä¸€ä¸ªå…¨æ–°çš„å¯¹è±¡ï¼Œé€šå¸¸æ˜¯</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">return</span>&#123;</span><br><span class=\"line\">\t...state,</span><br><span class=\"line\">\txx: xx</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ç±»ä¼¼è¿™æ ·ã€‚è¿™æ ·çš„è¯jså°±ä¼šæ–°å¼€è¾Ÿä¸€ä¸ªå†…å­˜åœ°å€å‡ºæ¥ã€‚åœ¨æ¯”å¯¹çš„æ—¶å€™å†…å­˜åœ°å€å°±ä¸ä¼šç›¸åŒäº†ã€‚</p>\n<h2 id=\"bindActionCreators\"><a href=\"#bindActionCreators\" class=\"headerlink\" title=\"bindActionCreators\"></a>bindActionCreators</h2><p>è¿™ä¸ªå‡½æ•°å…¶å®éå¸¸å°‘ç”¨åˆ°ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«æ™¦æ¶©çš„ä¸œè¥¿ï¼Œåªæ˜¯ä¸€ä¸ªå°è£…ã€‚ä½†æ˜¯æ˜¯ä¸€ç§æ›´ä¸ºä¼˜é›…çš„æ–¹å¼ã€‚</p>\n<p>ç›´æ¥çœ‹ä»£ç ï¼Œå¾ˆå°‘ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bindActionCreators</span>(<span class=\"params\">actionCreators, dispatch</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// actionCreatorsä¸ºfunction</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> actionCreators === <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> bindActionCreator(actionCreators, dispatch)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// ä¸æ˜¯object throw Error</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> actionCreators !== <span class=\"string\">'object'</span> || actionCreators === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(</span><br><span class=\"line\">      <span class=\"string\">`bindActionCreators expected an object or a function, instead received <span class=\"subst\">$&#123;</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">        actionCreators === <span class=\"literal\">null</span> ? <span class=\"string\">'null'</span> : <span class=\"keyword\">typeof</span> actionCreators</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">      &#125;</span>. `</span> +</span><br><span class=\"line\">        <span class=\"string\">`Did you write \"import ActionCreators from\" instead of \"import * as ActionCreators from\"?`</span></span><br><span class=\"line\">    )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// object è½¬ä¸ºæ•°ç»„</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> keys = <span class=\"built_in\">Object</span>.keys(actionCreators)</span><br><span class=\"line\">  <span class=\"comment\">// å®šä¹‰return çš„props</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> boundActionCreators = &#123;&#125;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; keys.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// actionCreatorsçš„key é€šå¸¸ä¸ºactionCreators functionçš„nameï¼ˆæ–¹æ³•åï¼‰</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> key = keys[i]</span><br><span class=\"line\">    <span class=\"comment\">// function =&gt; actionCreatorså·¥å‚æ–¹æ³•æœ¬èº«</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> actionCreator = actionCreators[key]</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> actionCreator === <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å‚æ•°ä¸º&#123;actionsï¼šfunction xxx&#125;æ˜¯è¿”å›ç›¸åŒçš„ç±»å‹</span></span><br><span class=\"line\">      boundActionCreators[key] = bindActionCreator(actionCreator, dispatch)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// return çš„props</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> boundActionCreators</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä»£ç å¾ˆç®€å•ä¹Ÿå¾ˆæ¸…æ™°ï¼Œå°±æ˜¯å¼„ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œç„¶åæŠŠ<code>actionCreators</code>é‡Œé¢çš„<code>value</code>å˜æˆ<code>bindActionCreator(actionCreator, dispatch)</code>çš„å€¼ï¼Œé‚£ä¹ˆä¸€èµ·çœ‹ä¸€ä¸‹<code>bindActionCreator</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bindActionCreator</span>&lt;<span class=\"title\">A</span> <span class=\"title\">extends</span> <span class=\"title\">AnyAction</span> = <span class=\"title\">AnyAction</span>&gt;(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  actionCreator: ActionCreator&lt;A&gt;,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  dispatch: Dispatch</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">this: any, ...args: any[]</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> dispatch(actionCreator.apply(<span class=\"keyword\">this</span>, args))</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å…¶å®è¿™é‡Œçœ‹èµ·æ¥æœ‰ç‚¹è¿·ç³Šï¼Œçœ‹ä¹Ÿæ˜¯èƒ½çœ‹æ‡‚ï¼Œå…¶å®å°±æ˜¯è¿”å›ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯å¹²ä»€ä¹ˆçš„å‘¢ï¼Ÿè¿”å›æ‰§è¡Œdispatchä¹‹åçš„è¿”å›å€¼ã€‚è¿™ä¹ˆæè¿™ä¹ˆä¸€åœˆç©¶ç«Ÿæœ‰ä»€ä¹ˆç§˜å¯†å‘¢ï¼Ÿ</p>\n<p>æˆ‘ä»¬å†™ä¸€ä¸ªdemoå°±ä¼šçŸ¥é“äº†ã€‚</p>\n<p>å‡å¦‚æˆ‘ä»¬è¦åšä¸€ä¸ªåŠ¨æ€çš„å¢åŠ çš„actionï¼Œåˆ†åˆ«ä¸ºç‚¹å‡»ä¸€æ¬¡+1ï¼Œç‚¹å‡»ä¸€æ¬¡+2ï¼Œç‚¹å‡»ä¸€æ¬¡+3ã€‚</p>\n<p>æˆ‘ä»¬éœ€è¦</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> counterIncActionCreator = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">step</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    type: <span class=\"string\">'INCREMENT'</span>,</span><br><span class=\"line\">    step: step || <span class=\"number\">1</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ä¸ºäº†ç®€åŒ–ä»£ç æˆ‘æŠŠdispatchå‡½æ•°å®šä¹‰ä¸ºåªæœ‰æ‰“å°åŠŸèƒ½çš„å‡½æ•°</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> dispatch = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">action</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(action)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> action1 = counterIncActionCreator()</span><br><span class=\"line\">dispatch(action1) <span class=\"comment\">// &#123; type: 'INCREMENT', step: 1 &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> action2 = counterIncActionCreator(<span class=\"number\">2</span>)</span><br><span class=\"line\">dispatch(action2) <span class=\"comment\">// &#123; type: 'INCREMENT', step: 2 &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> action3 = counterIncActionCreator(<span class=\"number\">3</span>)</span><br><span class=\"line\">dispatch(action3) <span class=\"comment\">// &#123; type: 'INCREMENT', step: 3 &#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>æœ‰ç‚¹éš¾å—å…¶å®ï¼Œä½†æ˜¯æˆ‘ä»¬ç”¨äº†<code>bindActionCreator</code>ä¹‹å</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> increment = bindActionCreator(counterIncActionCreator, dispatch)</span><br><span class=\"line\"></span><br><span class=\"line\">increment() <span class=\"comment\">// &#123; type: 'INCREMENT', step: 1 &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">increment(<span class=\"number\">2</span>) <span class=\"comment\">// &#123; type: 'INCREMENT', step: 2 &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">increment(<span class=\"number\">3</span>) <span class=\"comment\">// &#123; type: 'INCREMENT', step: 3 &#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>å°±æ•´ä¸ªå¸…èµ·æ¥ï¼Œæœ‰æ²¡æœ‰ï¼Ÿï¼æ›´åŠ ä¼˜é›…äº†ã€‚</p>\n<p>è€Œä¸”æˆ‘ä»¬è¿˜å¯ä»¥åˆ¶ä½œå¢å’Œå‡çš„ä¸¤ä¸ªå·¥å‚ğŸ­</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> MyActionCreators = &#123;</span><br><span class=\"line\">  increment: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">step</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      type: <span class=\"string\">'INCREMENT'</span>,</span><br><span class=\"line\">      step: step || <span class=\"number\">1</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">  decrement: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">step</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      type: <span class=\"string\">'DECREMENT'</span>,</span><br><span class=\"line\">      step: - (step || <span class=\"number\">1</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>è€æ–¹æ³•</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// åŸå§‹çš„è°ƒåº¦æ–¹å¼</span></span><br><span class=\"line\">dispatch(MyActionCreators.increment()) <span class=\"comment\">// &#123; type: 'INCREMENT', step: 1 &#125;</span></span><br><span class=\"line\">dispatch(MyActionCreators.increment(<span class=\"number\">2</span>)) <span class=\"comment\">// &#123; type: 'INCREMENT', step: 2 &#125;</span></span><br><span class=\"line\">dispatch(MyActionCreators.increment(<span class=\"number\">3</span>)) <span class=\"comment\">// &#123; type: 'INCREMENT', step: 3 &#125;</span></span><br><span class=\"line\">dispatch(MyActionCreators.decrement()) <span class=\"comment\">// &#123; type: 'DECREMENT', step: -1 &#125;</span></span><br><span class=\"line\">dispatch(MyActionCreators.decrement(<span class=\"number\">2</span>)) <span class=\"comment\">// &#123; type: 'DECREMENT', step: -2 &#125;</span></span><br><span class=\"line\">dispatch(MyActionCreators.decrement(<span class=\"number\">3</span>)) <span class=\"comment\">// &#123; type: 'DECREMENT', step: -3 &#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>è¿›åŒ–ä¹‹å</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MyNewActionCreators.increment() <span class=\"comment\">// &#123; type: 'INCREMENT', step: 1 &#125;</span></span><br><span class=\"line\">MyNewActionCreators.increment(<span class=\"number\">2</span>) <span class=\"comment\">// &#123; type: 'INCREMENT', step: 2 &#125;</span></span><br><span class=\"line\">MyNewActionCreators.increment(<span class=\"number\">3</span>) <span class=\"comment\">// &#123; type: 'INCREMENT', step: 3 &#125;</span></span><br><span class=\"line\">MyNewActionCreators.decrement() <span class=\"comment\">// &#123; type: 'DECREMENT', step: -1 &#125;</span></span><br><span class=\"line\">MyNewActionCreators.decrement(<span class=\"number\">2</span>) <span class=\"comment\">// &#123; type: 'DECREMENT', step: -2 &#125;</span></span><br><span class=\"line\">MyNewActionCreators.decrement(<span class=\"number\">3</span>) <span class=\"comment\">// &#123; type: 'DECREMENT', step: -3 &#125;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"Reduxæ€»ç»“\"><a href=\"#Reduxæ€»ç»“\" class=\"headerlink\" title=\"Reduxæ€»ç»“\"></a>Reduxæ€»ç»“</h2><p>è‡³æ­¤æˆ‘ä»¬çš„reduxæºç é˜…è¯»å°±åˆ°æ­¤ä¸ºæ­¢ã€‚</p>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·å­¦ä¹ ä¸€ä¸‹å’Œreduxé…åˆä½¿ç”¨çš„react-redux</p>\n<h2 id=\"react-redux\"><a href=\"#react-redux\" class=\"headerlink\" title=\"react-redux\"></a>react-redux</h2><p>React åŸæœ¬å’Œreduxæ²¡æœ‰å…³ç³»ï¼Œreduxåªæ˜¯è´Ÿè´£æ•°æ®å¤„ç†ï¼Œç†è®ºä¸Šæ— è®ºæ˜¯vueæˆ–è€…angularéƒ½å¯ä»¥ä½¿ç”¨ã€‚</p>\n<p>ä½†æ˜¯react-reduxå°†reactå’Œreduxç´§å¯†çš„è”ç³»åœ¨äº†ä¸€èµ·ã€‚ç”¨æ›´ç¬¦åˆreactçš„æ–¹å¼æ¥è°ƒç”¨reduxã€‚</p>\n<p>åç»­ä¼šå‡ºä¸€ç¯‡ä»‹ç»react-reduxçš„æ–‡ç« ã€‚</p>\n<h1 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h1><p>è‡ªæ­¤reduxæºç é˜…è¯»ç®—æ˜¯å‘Šä¸€æ®µè½äº†ã€‚å…¶å®æºç å¾ˆç®€å•ï¼Œä½†æ˜¯æ€æƒ³å´å¾ˆé«˜çº§ã€‚</p>\n<p>å¦‚æœæœ‰ä¸æ‡‚çš„ï¼Œæˆ–è€…å“ªé‡Œè¯´é”™äº†ï¼Œå°ä¼™ä¼´æ¬¢è¿åœ¨è¯„è®ºåŒºè®¨è®ºã€‚</p>\n<h1 id=\"ç´¢å¼•\"><a href=\"#ç´¢å¼•\" class=\"headerlink\" title=\"ç´¢å¼•\"></a>ç´¢å¼•</h1><blockquote>\n<p><a href=\"https://juejin.im/post/6844903638377185288\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/6844903638377185288</a></p>\n<p><a href=\"https://www.redux.org.cn/\" target=\"_blank\" rel=\"noopener\">https://www.redux.org.cn/</a></p>\n</blockquote>\n<blockquote>\n<p>å®åœ¨æ˜¯æ²¡æœ‰åœ°æ–¹åæ§½ï¼Œæˆ‘åœ¨è¿™é‡Œè¯´ä¸€ä¸‹æœ€è¿‘çš„äº‹æƒ…å§ã€‚å…ˆæ˜¯éƒ¨é—¨é»„äº†ï¼Œç„¶åå¤§é¢†å¯¼æ¢äººäº†ï¼Œå¤§é¢†å¯¼ä¸çŸ¥é“æ˜¯ä¸æ˜¯æ–°å®˜ä¸Šä»»ä¸‰æŠŠç«ï¼Œéè¦æä»€ä¹ˆææ•ˆï¼Œå…¶å®å°±æ˜¯æŠŠäººå¼„èµ°ï¼Œç„¶ååŠ å¤§å·¥ä½œé‡ï¼Œåˆšåˆšå¼€å§‹æ¢ç»„æˆ‘å°±å»å†™å¾ˆè€çš„vueé¡¹ç›®ï¼Œæ²¡æœ‰é„™è§†vueçš„æ„æ€ï¼Œæ˜¯å› ä¸ºæˆ‘ä¹‹å‰éƒ½åœ¨å†™reactï¼Œç„¶åä¸€ä¸‹è®©æˆ‘å†™ï¼Œä¹Ÿä¸å¤ªé€‚åº”è€Œå·²ï¼Œè¿˜æ˜¯å¾ˆå°‘çš„ç‰ˆæœ¬ã€‚é‚£å°±å†™å°±å†™å§ï¼Œåæ­£åšå‰ç«¯çš„éƒ½å¾—å­¦ä¸æ˜¯ï¼Ÿå¯æ˜¯ï¼Œå¤§é¢†å¯¼ä¸ºäº†ç»™åšç»™è€æ¿çœ‹ï¼Œç„¶åè®©æˆ‘ä»¬ä¸‹ç­ä¸è¦èµ°ï¼Œå°±æ˜¯æ²¡æœ‰äº‹æƒ…åšå°±å¹²åç€çš„é‚£ç§ã€‚æœ¬ç€90åçš„æ€§å­æˆ‘å°±èµ°äº†ï¼Œç„¶åæˆ‘èµ°äº†ä¹‹åï¼Œæœ‰äº›å°ä¼™ä¼´å¯èƒ½ä¹Ÿå¼€å§‹èµ°äº†ï¼Œç„¶åæˆ‘å°±è¢«æŠ“å»åŠé€€äº†â€¦.æˆ‘ä¹Ÿæ²¡æœ‰æ­»çš®èµ–è„¸çš„èµ–ç€ã€‚å€Ÿå£ä¹Ÿéå¸¸çš„å¥‡è‘©â€ä½ æ´»åœ¨è‡ªå·±çš„ä¸–ç•Œé‡Œé¢ï¼Œæ²¡æœ‰å…³å¿ƒå‘¨å›´åŒäº‹å¿™ä¸å¿™ï¼Œæ”¹bugä¸ç§¯æï¼Œä»£ç è´¨é‡ä½â€ä¹‹ç±»çš„ã€‚ã€‚ã€‚å¯æ˜¯æˆ‘åªæ˜¯å·¥ä½œçš„æ—¶å€™æˆ´ç€è€Œå·²ï¼Œå› ä¸ºç»å¸¸æœ‰äº§å“ä¸Šæ¥å°±åœ¨æ—è¾¹å¼€å§‹è®¨è®ºäº†ï¼Œç„¶åæˆ‘è‡ªå·±çš„å·¥ä½œéƒ½åšä¸å®Œï¼Œæ€ä¹ˆå…³å¿ƒåŒäº‹å•Šã€‚ã€‚å¼ºè¡ŒåŠ äº†å·¥ä½œé‡ä¹‹åæˆ‘éƒ½å¾ˆæ™šèµ°æˆ–è€…å›å®¶å·¥ä½œäº†ã€‚å› ä¸ºåœ¨å…¬å¸èµ–ç€çœŸçš„å¾ˆéš¾å—ï¼Œä¸ºä»€ä¹ˆä¸åœ¨è‡ªå·±èˆ’é€‚çš„å®¶ä¸­å·¥ä½œå‘¢ï¼Ÿè¿˜å¯ä»¥é©¬ä¸Šç¡è§‰é‚£ç§ï¼ŒéŸ³ä¹è¿˜å¯ä»¥å¤–æ”¾ã€‚ã€‚ã€‚å†è¯´äº†æˆ‘ä¹‹å‰çš„ä»£ç ï¼Œå› ä¸ºé¡¹ç›®é»„äº†ï¼Œåº”è¯¥æ²¡äººçœ‹äº†å§â€¦.å”‰ï¼Œå…¶å®å°±æ˜¯ åŠé€€ã€‚æˆ‘éƒ½æ‡‚ã€‚</p>\n<p>ä½†æ˜¯æˆ‘çš„ç®€å†å…¶å®å˜å¾—æå…¶ä¸‘é™‹äº†ï¼Œå› ä¸ºæˆ‘å¹´åˆçš„æ‰è·³æ§½è¿‡æ¥çš„ã€‚ç°åœ¨è¿™ä¸ªæ—¶é—´éå¸¸å°´å°¬â€¦.è€Œä¸”æˆ‘æ¥çš„ç¬¬ä¸€å¤©å¬è¯´è¦996ï¼Œé©¬ä¸Šæäº†ç¦»èŒç”³è¯·ï¼Œæˆ‘çš„é¢†å¯¼åŒæ„äº†ï¼Œå¯ä»¥ä¹‹å‰çš„å¤§é¢†å¯¼å’Œæˆ‘è¯´ä»¥åä¸ä¼š996äº†å°±æ˜¯æ­£å¸¸ä¸Šä¸‹ç­ã€‚ã€‚ç„¶åä»–å°±è·³æ§½äº†ã€‚ã€‚ã€‚</p>\n<p>ç®—æ˜¯è‡ªå·±ä¸è®¤çœŸå®¡æŸ¥å…¬å¸ï¼Œä¸è¿‡ä»–ä»¬ä¹Ÿå¤ªéª—äººäº†å§â€¦å”‰ã€‚</p>\n<p>ç°åœ¨åœ¨å®¶é‡Œä¹Ÿå¾ˆç„¦è™‘ï¼Œä¸çŸ¥é“æ‰¾ä¸æ‰¾å¾—åˆ°å·¥ä½œï¼Œæ­å·çš„å…¬å¸çœ‹äº†ä¸€åœˆéƒ½æ˜¯996ï¼Œå­¦é˜¿é‡Œçš„åŠ ç­ä¸å­¦é˜¿é‡Œçš„å·¥èµ„ã€‚ã€‚ã€‚</p>\n<p>å›½åº†ä»¥åå†è¯´å§ï¼Œå¸Œæœ›æ—©ç‚¹æŠŠé‡è¯†å‰ç«¯ç³»åˆ—æ›´å®Œã€‚</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<p>æœ€è¿‘åœ¨å†™ã€é‡æ‹¾å‰ç«¯ã€‘ç³»åˆ—ï¼Œä¸‹é¢æœ‰å‡ ä¸ªå¿«é€Ÿé€šé“ï¼Œå¤§å®¶è‡ªå–</p>\n<p><a href=\"https://juejin.im/post/6850418113944420359\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿</a></p>\n<p><a href=\"https://juejin.im/post/6850418117508759566\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—</a></p>\n<p><a href=\"https://juejin.im/post/6854573215658803208\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this</a></p>\n<p><a href=\"https://juejin.im/post/6859911609633767438\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šJavaScriptçš„æ‰§è¡Œæœºåˆ¶</a></p>\n<p><a href=\"https://juejin.im/post/6860375101322461198\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC</a></p>\n<p><a href=\"https://juejin.im/post/6865204092877144077\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ</a></p>\n<p><a href=\"https://juejin.im/post/6867814019055484942\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘æš´èµ°çš„å¼‚æ­¥ç¼–ç¨‹</a></p>\n<p><a href=\"https://juejin.im/post/6877910314110140423/\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘reduxæºç é˜…è¯»</a></p>\n<h1 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h1><p>ä¹‹å‰ä¸€ç›´åœ¨ä½¿ç”¨reduxï¼Œåæ¥å‡ºäº†hooksï¼Œç”¨çš„æ¯”è¾ƒå°‘äº†ï¼Œä½†æ˜¯è¿˜æ˜¯ä¼šä½¿ç”¨ï¼Œä»–ä»¬ä¸å†²çªï¼Œå„è‡ªå¯¹åº”çš„åœºæ™¯ä¸åŒã€‚å¬è¯´reduxæºç æ¯”è¾ƒå°‘ï¼Œä¹Ÿæ¯”è¾ƒå¥½æ‡‚ï¼ˆä¸æ˜¯è´¬ä½ï¼Œè¶Šå¼ºçš„ä»£ç å…¶å®è¶Šç®€æ´æ˜äº†ï¼‰</p>\n<p>æ‰€ä»¥å‡†å¤‡é˜…è¯»ä¸€ä¸‹ï¼Œä¹Ÿç®—æ˜¯é‡è¯†å‰ç«¯ç³»åˆ—çš„ä¸€å‘˜å§ã€‚</p>\n<p>æ³¨æ„ä¸€ä¸‹ï¼Œå…¶å®æˆ‘ä»¬å†™reactçš„æ—¶å€™ç”¨åˆ°çš„å…¶å®æ˜¯redux-reactã€‚åé¢ä¹Ÿä¼šä¸€èµ·ä»‹ç»ã€‚</p>\n<p>æ›´å¥½çš„é˜…è¯»ä½“éªŒå…¶å®æ˜¯åœ¨é¡¹ç›®é‡Œé¢æ‰“æ–­ç‚¹ï¼Œè¿™é‡Œæ˜¯æˆ‘çš„<a href=\"https://github.com/DerrickTel/redux-source-analyse\" target=\"_blank\" rel=\"noopener\">GitHubåœ°å€</a>ï¼Œå–œæ¬¢çš„åŒå­¦å¯ä»¥forkæˆ–è€…starä¸€ä¸‹å“¦ã€‚é‡Œé¢æˆ‘æŠŠæºç éƒ½æ‹‰å‡ºæ¥æ”¾åˆ°æ–‡ä»¶å¤¹é‡Œé¢ç„¶åç”±create-react-appæ¥è°ƒç”¨ï¼Œè€Œä¸æ˜¯ç›´æ¥ç”¨npmè£…ã€‚è¿™æœ‰åŠ©äºç†è§£ä¸è°ƒè¯•ï¼Œé‡Œé¢ä¹Ÿæœ‰æˆ‘çš„æ³¨é‡Šï¼Œå…¶å®å¯ä»¥ç›´æ¥é˜…è¯»æºç çš„æ³¨é‡Šä¼šæ›´å¿«ã€‚</p>\n<p>reduxå’Œrdux-reactçš„ä»£ç ä¹Ÿæ˜¯ç›®å‰æœ€æ–°ï¼ˆ2020-09-13ï¼‰çš„masteråˆ†æ”¯ä¸Šé¢çš„ã€‚</p>\n<h1 id=\"å¼€å§‹\"><a href=\"#å¼€å§‹\" class=\"headerlink\" title=\"å¼€å§‹\"></a>å¼€å§‹</h1><p>reduxæ˜¯ç”¨çš„rollupæ‰“åŒ…çš„ã€‚</p>\n<p>æ‰“å¼€æ ¹ç›®å½•ä¸‹é¢çš„<code>rollup.config.js</code>å¯ä»¥çœ‹åˆ°å…¥å£æ˜¯srcç›®å½•ä¸‹çš„indexæ–‡ä»¶ã€‚</p>\n<p>å¯ä»¥çœ‹åˆ°ä»–å¯¼å‡ºçš„ä¸€äº›ä¸œè¥¿</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> &#123;</span><br><span class=\"line\">  createStore,</span><br><span class=\"line\">  combineReducers,</span><br><span class=\"line\">  bindActionCreators,</span><br><span class=\"line\">  applyMiddleware,</span><br><span class=\"line\">  compose,</span><br><span class=\"line\">  __DO_NOT_USE__ActionTypes</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æˆ‘ä»¬ä¸€ä¸ªä¸ªå¼€å§‹ã€‚é¦–å…ˆæ˜ å…¥çœ¼å¸˜çš„æ˜¯createStore</p>\n<h2 id=\"createStore\"><a href=\"#createStore\" class=\"headerlink\" title=\"createStore\"></a>createStore</h2><p>å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹æ˜¯æ€ä¹ˆç”¨ã€‚ä»¥ä¸‹é‡‡ç”¨<a href=\"https://github.com/DerrickTel/redux-source-analyse\" target=\"_blank\" rel=\"noopener\">æˆ‘çš„æºç </a>é˜…è¯»é‡Œé¢çš„ä»£ç ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// middleware</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> logger = <span class=\"function\">(<span class=\"params\">store:any</span>) =&gt;</span> <span class=\"function\">(<span class=\"params\">next:any</span>) =&gt;</span> <span class=\"function\">(<span class=\"params\">action:any</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// debugger</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.info(<span class=\"string\">'dispatching'</span>, action)</span><br><span class=\"line\">  <span class=\"keyword\">let</span> result = next(action);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'next state'</span>, store.getState())</span><br><span class=\"line\">  <span class=\"keyword\">return</span> result</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> store = createStore(rootReducer, applyMiddleware(logger));</span><br></pre></td></tr></table></figure>\n\n<p>å†çœ‹çœ‹æºç çš„createStoreã€‚</p>\n<h3 id=\"å‚æ•°\"><a href=\"#å‚æ•°\" class=\"headerlink\" title=\"å‚æ•°\"></a>å‚æ•°</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createStore</span>&lt;</span></span><br><span class=\"line\"><span class=\"function\">  <span class=\"title\">S</span>,</span></span><br><span class=\"line\"><span class=\"function\">  <span class=\"title\">A</span> <span class=\"title\">extends</span> <span class=\"title\">Action</span>,</span></span><br><span class=\"line\"><span class=\"function\">  <span class=\"title\">Ext</span> = </span>&#123;&#125;,</span><br><span class=\"line\">  StateExt = never</span><br><span class=\"line\">&gt;(</span><br><span class=\"line\">  reducer: Reducer&lt;S, A&gt;,</span><br><span class=\"line\">  preloadedState?: PreloadedState&lt;S&gt; | StoreEnhancer&lt;Ext, StateExt&gt;,</span><br><span class=\"line\">  enhancer?: StoreEnhancer&lt;Ext, StateExt&gt;</span><br><span class=\"line\">): Store&lt;ExtendState&lt;S, StateExt&gt;, A, StateExt, Ext&gt; &amp; Ext &#123;</span><br><span class=\"line\">  <span class=\"comment\">//.. ä¸€äº›æ ¡éªŒçš„æºç å°±ä¸ä»‹ç»äº†ï¼Œæƒ³äº†è§£çš„å¯ä»¥çœ‹æˆ‘çš„GitHubï¼Œä¸Šé¢æœ‰æ³¨é‡Š</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> currentReducer = reducer <span class=\"comment\">// ä¸´æ—¶å­˜æ”¾ reducer çš„åœ°æ–¹</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> currentState = preloadedState <span class=\"keyword\">as</span> S <span class=\"comment\">// ä¸´æ—¶å­˜æ”¾ state çš„åœ°æ–¹</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> currentListeners: <span class=\"function\">(<span class=\"params\">(</span>) =&gt;</span> <span class=\"keyword\">void</span>)[] | <span class=\"literal\">null</span> = [] <span class=\"comment\">// ç›‘å¬é˜Ÿåˆ—</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> nextListeners = currentListeners <span class=\"comment\">// å¼•ç”¨èµ‹å€¼, å’Œæ­£å¼çš„é˜Ÿåˆ—è¿›è¡ŒåŒºåˆ†, åˆ«æœ‰ä»–ç”¨</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> isDispatching = <span class=\"literal\">false</span> <span class=\"comment\">// æ˜¯ä¸æ˜¯æ­£åœ¨dispatch</span></span><br><span class=\"line\">  <span class=\"comment\">// ... </span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>createStoreæ¥æ”¶3ä¸ªå‚æ•°<code>reducer</code>ï¼Œ<code>preloadedState</code>ï¼Œ<code>enhancer</code>ã€‚</p>\n<p>æˆ‘ä»¬ä¸€ä¸€å‰–æä»–ä»¬åˆ†åˆ«æ˜¯åšä»€ä¹ˆçš„ã€‚</p>\n<h4 id=\"reducer\"><a href=\"#reducer\" class=\"headerlink\" title=\"reducer\"></a>reducer</h4><p>è¿™ä¸ªå¤§å®¶å¤ªç†Ÿæ‚‰äº†ã€‚å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åæˆ‘ä»¬åœ¨é‡Œé¢å†™<code>switch</code>ï¼Œ<code>switch</code> <code>dispatch</code>è¿‡æ¥ <code>action</code>çš„<code>type</code>ã€‚ç„¶ååšå¯¹åº”çš„æ“ä½œã€‚æœ€åè¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯å…¨æ–°çš„<code>store</code>çš„æ•°æ®ã€‚ä¸ºä»€ä¹ˆæ˜¯è¿”å›ä¸€ä¸ªå…¨æ–°çš„<code>store</code>ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢jsçš„å¼•ç”¨ã€‚</p>\n<p>å¿˜è®°çš„ï¼Œæˆ–è€…ä¸å¤ªæ‡‚çš„åŒå­¦å¯ä»¥çœ‹ä¸€ä¸‹ä¸‹é¢çš„demoï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> initState = &#123;</span><br><span class=\"line\">  todos: []</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è¿™é‡Œé¢æˆ‘ä»¬ä¸€èˆ¬ä¼šèµ‹å€¼ä¸Šé»˜è®¤çš„stateï¼Œå› ä¸ºåç»­å¯èƒ½ä¼šç”¨åˆ°é»˜è®¤çš„æƒ…å†µï¼Œåƒæ•°ç»„ä¹‹ç±»çš„å°±éå¸¸å¸¸è§ã€‚</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> todos = <span class=\"function\">(<span class=\"params\">state = initState, action</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">switch</span> (action.type) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'ADD_TODO'</span>:</span><br><span class=\"line\">      <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        ...state</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'TOGGLE_TODO'</span>:</span><br><span class=\"line\">      <span class=\"keyword\">return</span> state.map(</span><br><span class=\"line\">        todo =&gt;</span><br><span class=\"line\">          todo.id === action.id ? &#123; ...todo, <span class=\"attr\">completed</span>: !todo.completed &#125; : todo</span><br><span class=\"line\">      )</span><br><span class=\"line\">    <span class=\"keyword\">default</span>: &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> state</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">      </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> todos</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"preloadedState\"><a href=\"#preloadedState\" class=\"headerlink\" title=\"preloadedState\"></a>preloadedState</h4><p>è¿™ä¸ªå…¶å®æˆ‘ä»¬ç”¨çš„ä¸æ˜¯å¾ˆå¤šï¼Œå› ä¸ºæˆ‘ä»¬ä¸€èˆ¬é¢„å­˜çš„éƒ½ç›´æ¥å¸è½½<code>reducer</code>é‡Œé¢äº†ã€‚åƒğŸ‘†ğŸŒ°é‡Œé¢çš„<code>state = initState</code>å°±çœå»äº†æˆ‘ä»¬çš„ä¼ é€’è¿™ä¸ªå‚æ•°çš„è¿‡ç¨‹ã€‚è€Œä¸”æ•°æ®æ”¾åœ¨<code>reducer</code>é‡Œé¢ä¹Ÿæ›´åŠ æ¸…æ™°ã€‚</p>\n<p>å“ªæ€•æ˜¯åœ¨<a href=\"http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_one_basic_usages.html\" target=\"_blank\" rel=\"noopener\">é˜®ä¸€å³°è€å¸ˆçš„æ—¥å¿—</a>é‡Œé¢ä¹Ÿæ˜¯è¿™æ ·æ•™çš„ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> defaultState = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> reducer = <span class=\"function\">(<span class=\"params\">state = defaultState, action</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">switch</span> (action.type) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'ADD'</span>:</span><br><span class=\"line\">      <span class=\"keyword\">return</span> state + action.payload;</span><br><span class=\"line\">    <span class=\"keyword\">default</span>: </span><br><span class=\"line\">      <span class=\"keyword\">return</span> state;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> state = reducer(<span class=\"number\">1</span>, &#123;</span><br><span class=\"line\">  type: <span class=\"string\">'ADD'</span>,</span><br><span class=\"line\">  payload: <span class=\"number\">2</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>ä¸­æ–‡ç¿»è¯‘å°±æ˜¯ï¼šé¢„å­˜çš„<code>state</code>ã€‚ä¹Ÿå¯ä»¥ç†è§£ä¸ºåˆå§‹çš„ï¼Œé»˜è®¤çš„ã€‚å› ä¸ºæˆ‘ä»¬ä¸€èˆ¬åœ¨ä¹Ÿé¡µé¢é‡Œé¢ç›´æ¥æ‹¿<code>store</code>é‡Œé¢çš„å€¼ï¼Œæˆ–è€…<code>map</code>æˆ–è€…ä»€ä¹ˆã€‚å¾ˆæœ‰å¯èƒ½å°±ä¼šæŠ¥é”™ï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰é»˜è®¤å€¼æˆ‘ä»¬ç›´æ¥ç”¨<code>map</code>å°±ä¼šæŠ¥é”™â€¦.ç›¸ä¿¡åˆšåˆšå¼€å§‹ç”¨çš„å°ä¼™ä¼´åº”è¯¥æœ‰è¿™æ ·çš„å›°æƒ‘ã€‚</p>\n<p>ä½†æ˜¯ï¼Œæˆ‘ä»¬é€šå¸¸éƒ½æ˜¯ä¼ ä¸¤ä¸ªå‚æ•°ï¼Œé‚£å’‹åŠï¼Ÿæˆ‘çœ‹ä»–å¥½åƒæ˜¯é¡ºåºè¯»å–çš„è¯¶â€¦</p>\n<p>reduxå…¼å®¹æˆ‘ä»¬å•¦ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‰é¢æœ‰ä¸€æ®µä»£ç æ˜¯ä¸ºäº†åšè¿™ä¸ªçš„</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// preloadedStateä¸ºfunction enhancerä¸ºundefinedçš„æ—¶å€™è¯´æ˜initStateæ²¡æœ‰åˆå§‹åŒ–, ä½†æ˜¯æœ‰middleware</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> preloadedState === <span class=\"string\">'function'</span> &amp;&amp; <span class=\"keyword\">typeof</span> enhancer === <span class=\"string\">'undefined'</span>) &#123;</span><br><span class=\"line\">  enhancer = preloadedState <span class=\"comment\">// æŠŠ preloadedState èµ‹å€¼ç»™ enhancer</span></span><br><span class=\"line\">  preloadedState = <span class=\"literal\">undefined</span> <span class=\"comment\">// preloadedStateèµ‹å€¼undeifined</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"enhancer\"><a href=\"#enhancer\" class=\"headerlink\" title=\"enhancer\"></a>enhancer</h4><p>ä¸­æ–‡ç¿»è¯‘æ˜¯ï¼šå¢å¼ºã€‚å…¶å®å°±æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ä¸­é—´ä»¶ï¼Œç”¨äºå¢å¼ºæˆ‘ä»¬çš„<code>redux</code>ã€‚å¸¸è§æœ‰çš„æœ‰<code>log</code>ï¼Œ<code>redux-thunk</code>ï¼Œ<code>redux-saga</code>ç­‰ç­‰ã€‚</p>\n<p>æˆ‘ä»¬å‘ç°ä»£ç é‡Œé¢æœ‰ä¸€æ®µæ˜¯è¿™æ ·çš„ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// debugger</span></span><br><span class=\"line\"><span class=\"comment\">// å¦‚æœå‚æ•°enhancerå­˜åœ¨</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> enhancer !== <span class=\"string\">'undefined'</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœenhancerå­˜åœ¨ï¼Œé‚£ä»–å¿…é¡»æ˜¯ä¸ªfunction, å¦åˆ™throw Errorå“ˆ</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> enhancer !== <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">'Expected the enhancer to be a function.'</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * ä¼ å…¥ç¬¦åˆå‚æ•°ç±»å‹çš„å‚æ•°ï¼Œå°±å¯ä»¥æ‰§è¡Œ enhancer,</span></span><br><span class=\"line\"><span class=\"comment\">     * ä½†æ˜¯è¿™ä¸ªreturnæ·±æ·±çš„å¸å¼•äº†æˆ‘, å› ä¸ºè¯´æ˜æœ‰applyMiddlewareçš„æ—¶å€™åé¢çš„éƒ½ä¸ç”¨çœ‹äº† ??? å½“ç„¶\u001dä¸å¯èƒ½</span></span><br><span class=\"line\"><span class=\"comment\">     * å¯æ˜¯applyMiddlewareå…¶å®æ˜¯å¿…ç”¨é¡¹ï¼Œæ‰€ä»¥çŒœæƒ³ä¸€ä¸‹applyMiddlewareå¼ºåŒ–storeä¹‹åä¼šenhancerèµ‹å€¼undefinedï¼Œå†æ¬¡è°ƒç”¨createStore</span></span><br><span class=\"line\"><span class=\"comment\">     * ä¸Šä¸‹æ‰“ä¸ªdebuggerçœ‹ä¸€ä¸‹æ‰§è¡Œé¡ºåº(debuggerä½ç½®ä»¥æ³¨é‡Š)ï¼Œæœç„¶ä¸å‡ºæ‰€æ–™</span></span><br><span class=\"line\"><span class=\"comment\">     * å¥½äº†ï¼Œ å‡è®¾æˆ‘ä»¬è¿˜ä¸çŸ¥é“applyMiddleware()è¿™ä¸ªfuncrionå…·ä½“å¹²äº†ä»€ä¹ˆï¼Œ</span></span><br><span class=\"line\"><span class=\"comment\">     * åªçŸ¥é“ä»–åšäº†ä¸€äº›å¤„ç†ç„¶åé‡æ–°è°ƒç”¨äº†createStoreå¹¶ä¸”enhancerå‚æ•°ä¸ºundefined</span></span><br><span class=\"line\"><span class=\"comment\">     * å…ˆè®°ä¸‹ï¼Œåç»­åœ¨çœ‹applyMiddlewareï¼Œ å› ä¸ºæˆ‘ä»¬ç°åœ¨è¦çœ‹çš„æ˜¯createStore</span></span><br><span class=\"line\"><span class=\"comment\">     * * */</span></span><br><span class=\"line\">    <span class=\"comment\">// debugger</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> enhancer(createStore)(reducer, preloadedState)</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<p>è¿™ä¸ªé‡ç‚¹å…¶å®åœ¨äº<code>applyMiddleware</code>ï¼Œåç»­æˆ‘ä»¬ä¼šä»‹ç»åˆ°çš„ã€‚</p>\n<h3 id=\"å†…ç½®å˜é‡\"><a href=\"#å†…ç½®å˜é‡\" class=\"headerlink\" title=\"å†…ç½®å˜é‡\"></a>å†…ç½®å˜é‡</h3><p>è¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œæˆ‘å°±éƒ½å†™åœ¨æ³¨é‡Šé‡Œé¢äº†</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> currentReducer = reducer <span class=\"comment\">// ä¸´æ—¶å­˜æ”¾ reducer çš„åœ°æ–¹</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> currentState = preloadedState <span class=\"keyword\">as</span> S <span class=\"comment\">// ä¸´æ—¶å­˜æ”¾ state çš„åœ°æ–¹</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> currentListeners: <span class=\"function\">(<span class=\"params\">(</span>) =&gt;</span> <span class=\"keyword\">void</span>)[] | <span class=\"literal\">null</span> = [] <span class=\"comment\">// ç›‘å¬é˜Ÿåˆ—</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> nextListeners = currentListeners <span class=\"comment\">// å¼•ç”¨èµ‹å€¼, å’Œæ­£å¼çš„é˜Ÿåˆ—è¿›è¡ŒåŒºåˆ†, åˆ«æœ‰ä»–ç”¨</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> isDispatching = <span class=\"literal\">false</span> <span class=\"comment\">// æ˜¯ä¸æ˜¯æ­£åœ¨dispatch</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"å†…ç½®æ–¹æ³•\"><a href=\"#å†…ç½®æ–¹æ³•\" class=\"headerlink\" title=\"å†…ç½®æ–¹æ³•\"></a>å†…ç½®æ–¹æ³•</h3><h4 id=\"ensureCanMutateNextListeners\"><a href=\"#ensureCanMutateNextListeners\" class=\"headerlink\" title=\"ensureCanMutateNextListeners\"></a>ensureCanMutateNextListeners</h4><p>è¿™é‡Œå…¶å®æ˜¯ä¸ºäº†å¼„ä¸¤ä¸ªæ•°ç»„ï¼Œä¸€ä¸ªæ“ä½œä¸€ä¸ªåŸæ•°ç»„è€ŒæŠ½è±¡çš„ä¸€ä¸ªæ–¹æ³•ã€‚</p>\n<p>æœ‰ä¸€ä¸ªå°çš„çŸ¥è¯†ç‚¹ï¼Œ<code>===</code>å¯¹äºæ•°ç»„çš„åˆ¤æ–­åªèƒ½ç”¨äºåˆ¤æ–­æ˜¯å¦æ˜¯åŒä¸€ä¸ªå†…å­˜åœ°å€ï¼Œä¸ä¿¡çš„è¯å¤§å®¶å¯ä»¥è¯•è¯•ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> a = [<span class=\"number\">1</span>, <span class=\"number\">2</span>];</span><br><span class=\"line\"><span class=\"keyword\">const</span> b = [<span class=\"number\">1</span>, <span class=\"number\">2</span>];</span><br><span class=\"line\"><span class=\"keyword\">const</span> c = a;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a === b);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a === c);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b === c);</span><br></pre></td></tr></table></figure>\n\n\n\n<p>æ‰€ä»¥ä¸‹é¢çš„æ“ä½œçš„å°±å˜å¾—å¾ˆå¥½ç†è§£äº†ã€‚åœ¨æˆ‘ä»¬æ“ä½œ<code>listener</code>ä¹‹å‰ä¼šå…ˆå­˜å‚¨ä¸€ä¸‹å¿«ç…§ã€‚å¤§å®¶è¦å¤šç†è§£ä¸€ä¸‹ï¼Œå› ä¸ºåé¢å¾ˆå¤šåœ°æ–¹ä¼šç”¨åˆ°è¿™ä¸ªå‡½æ•°ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Googleç¿»è¯‘: ç¡®ä¿å¯ä»¥ä½¿ä¸‹ä¸€ä¸ªä¾¦å¬å™¨çªå˜</span></span><br><span class=\"line\">  <span class=\"comment\">// æˆ‘çš„ç†è§£æ˜¯å­˜å‚¨ä¸€ä¸‹å¿«ç…§, ä»¥ä¸ºæ¥ä¸‹æ¥å¯èƒ½ä¼šè¿›è¡Œæ“ä½œ.</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">ensureCanMutateNextListeners</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// æ˜¯å¦ç›¸åŒ, æ˜¯ä¸æ˜¯ç®€å•çš„å¼•ç”¨èµ‹å€¼, æ˜¯çš„è¯å°±æµ…æ‹·è´ä¸€ä»½</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (nextListeners === currentListeners) &#123;</span><br><span class=\"line\">      nextListeners = currentListeners.slice()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"getState\"><a href=\"#getState\" class=\"headerlink\" title=\"getState\"></a>getState</h4><p>è¿™ä¸ªå‡½æ•°å¾ˆç®€å•ï¼Œé¦–å…ˆåˆ¤æ–­ä¸€ä¸‹æ˜¯å¦æ˜¯åœ¨dispatchï¼Œç„¶åè¿”å›å½“å‰çš„stateã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// è·å–å½“å‰çš„state</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getState</span>(<span class=\"params\"></span>): <span class=\"title\">S</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœæ­£åœ¨dispatch å°±æŠ¥é”™,å› ä¸ºè¦è·å–æœ€æ–°çš„state, dispatchå¾ˆæœ‰å¯èƒ½ä¼šæ”¹å˜state</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isDispatching) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(</span><br><span class=\"line\">        <span class=\"string\">'You may not call store.getState() while the reducer is executing. '</span> +</span><br><span class=\"line\">          <span class=\"string\">'The reducer has already received the state as an argument. '</span> +</span><br><span class=\"line\">          <span class=\"string\">'Pass it down from the top reducer instead of reading it from the store.'</span></span><br><span class=\"line\">      )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> currentState <span class=\"keyword\">as</span> S</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<p>æœ‰æ²¡æœ‰æ„Ÿè§‰reduxå¥½åƒä¹Ÿä¸è¿‡å¦‚æ­¤~~æ¥ç€çœ‹å“¦ã€‚</p>\n<h4 id=\"subscribe\"><a href=\"#subscribe\" class=\"headerlink\" title=\"subscribe\"></a>subscribe</h4><p>ä¸­æ–‡ç¿»è¯‘ï¼šè®¢é˜…è€…ã€‚</p>\n<p>å…¶å®ä¹Ÿå¾ˆå¥½ç†è§£ã€‚å¯èƒ½æœ‰ç”¨è¿‡<code>redux</code>çš„åŒå­¦éƒ½æœ‰ç”¨è¿‡è¿™ä¸ªã€‚</p>\n<p>æˆ‘ä¸¾ä¸€ä¸ªæ€ä¹ˆç”¨çš„ğŸŒ°ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> unSubscribe = store.subscribe(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'store.subscribe'</span>, store.getState())</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"comment\">// å–æ¶ˆè®¢é˜…å°±ç›´æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°å°±å¥½äº†</span></span><br><span class=\"line\"><span class=\"comment\">// unSubscribe();</span></span><br></pre></td></tr></table></figure>\n\n<p>ä¸€æ—¦è§¦å‘äº†<code>dispatch</code>å°±ä¼šè§¦å‘è¿™ä¸ªå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å†™ä¸Šå»çš„<code>console.log()</code></p>\n<p>ç„¶åæˆ‘ä»¬å†æ¥çœ‹è¿™ä¸ªå‡½æ•°ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">subscribe</span>(<span class=\"params\">listener: (</span>) =&gt; <span class=\"title\">void</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// listenerå¿…é¡»ä¸ºå‡½æ•°ï¼Œå› ä¸ºè¦ä»¥å›è°ƒå‡½æ•°çš„æ–¹å¼æ¥è§¦å‘ã€‚</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> listener !== <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">'Expected the listener to be a function.'</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœæ­£åœ¨dispatchä¸­åˆ™æŠ›é”™ï¼Œå’ŒgetStateåŒç†</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isDispatching) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(</span><br><span class=\"line\">        <span class=\"string\">'You may not call store.subscribe() while the reducer is executing. '</span> +</span><br><span class=\"line\">          <span class=\"string\">'If you would like to be notified after the store has been updated, subscribe from a '</span> +</span><br><span class=\"line\">          <span class=\"string\">'component and invoke store.getState() in the callback to access the latest state. '</span> +</span><br><span class=\"line\">          <span class=\"string\">'See https://redux.js.org/api/store#subscribelistener for more details.'</span></span><br><span class=\"line\">      )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// æ˜¯å¦æœ‰ç›‘å¬è€…,æˆ–è€…æ˜¯å¦è¢«è®¢é˜…</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> isSubscribed = <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// ä¿å­˜å¿«ç…§, æ‹·è´ä¸€ä»½ç›‘å¬é˜Ÿåˆ—åˆ°nextListeners(å¦‚æœæ˜¯å¼•ç”¨çš„è¯)</span></span><br><span class=\"line\">    ensureCanMutateNextListeners()</span><br><span class=\"line\">    <span class=\"comment\">// å¾€ç›‘å¬é˜Ÿåˆ—é‡Œé¢æ¨å…¥ä¸€ä¸ªç›‘å¬è€…</span></span><br><span class=\"line\">    nextListeners.push(listener)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// è¿”å›ä¸€ä¸ªå–æ¶ˆè®¢é˜…çš„æ–¹æ³•</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">unsubscribe</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">// å¦‚æœæ²¡æœ‰è¢«è®¢é˜…, ç›´æ¥shut down</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (!isSubscribed) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// å¦‚æœæ­£åœ¨dispatch æŠ¥é”™ï¼Œå’Œä¸Šé¢ğŸ‘†åŒç†</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (isDispatching) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(</span><br><span class=\"line\">          <span class=\"string\">'You may not unsubscribe from a store listener while the reducer is executing. '</span> +</span><br><span class=\"line\">            <span class=\"string\">'See https://redux.js.org/api/store#subscribelistener for more details.'</span></span><br><span class=\"line\">        )</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// å–æ¶ˆè®¢é˜…</span></span><br><span class=\"line\">      isSubscribed = <span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// ä¾æ—§æ˜¯æ‹¿ä¸‹å½“å‰çš„ç›‘å¬é˜Ÿåˆ—ï¼Œä¸ç„¶ç­‰ä¸€ä¸‹åˆ é™¤çš„æ—¶å€™ï¼Œä¼šåˆ æ‰æ‰€æœ‰çš„é˜Ÿåˆ—ã€‚å…¶å®æˆ‘ä»¬åªéœ€è¦åˆ æ‰ç›‘å¬è€…å°±å¥½äº†</span></span><br><span class=\"line\">      ensureCanMutateNextListeners()</span><br><span class=\"line\">      <span class=\"comment\">// æ‰¾åˆ°ç›‘å¬è€…</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> index = nextListeners.indexOf(listener)</span><br><span class=\"line\">      <span class=\"comment\">// åˆ é™¤è¿™ä¸ªç›‘å¬è€…</span></span><br><span class=\"line\">      nextListeners.splice(index, <span class=\"number\">1</span>)</span><br><span class=\"line\">      <span class=\"comment\">// æ¸…ç©ºå½“å‰çš„ç›‘å¬é˜Ÿåˆ—</span></span><br><span class=\"line\">      currentListeners = <span class=\"literal\">null</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"dispatch\"><a href=\"#dispatch\" class=\"headerlink\" title=\"dispatch\"></a>dispatch</h4><p>è¿™ä¸ªå‡½æ•°å¯ä»¥è¯´æ˜¯å²ä¸Šæœ€TMå¸¸ç”¨çš„å‡½æ•°çš„ï¼Œæœ€TMé‡è¦ä¹‹é‡ä¸­ä¹‹é‡ï¼Œè€Œä¸”è¿˜æ˜¯æ›´æ–°storeçš„å”¯ä¸€æ–¹æ³•ï¼Œæ³¨æ„è¿™ä¸ªå”¯ä¸€ã€‚ä½†æ˜¯åˆéå¸¸å¥½ç†è§£ã€‚</p>\n<p>æˆ‘ä»¬è¿˜æ˜¯å…ˆçœ‹ä¸€ä¸ªğŸŒ°å§ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">props.dispatch(&#123;</span><br><span class=\"line\">  type: <span class=\"string\">'TEST'</span>,</span><br><span class=\"line\">  test1: <span class=\"number\">1</span>,</span><br><span class=\"line\">  test2: <span class=\"number\">2</span>,</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>ç„¶åï¼Œæˆ‘ä»¬çš„storeå°±æ”¹å˜äº†ï¼Œå°±ä¼šæ›´æ–°propsï¼Œæ¥è§¦å‘renderï¼Œè§†å›¾å¯èƒ½å°±ä¼šæ›´æ–°ä¹‹ç±»çš„ã€‚</p>\n<p>ğŸ‘Œï¼Œç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªä¸€ç‚¹ç‚¹äº†è§£ï¼Œæ¥çœ‹ä¸€ä¸‹æºç ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ä¿®æ”¹storeçš„å”¯ä¸€æ–¹æ³•</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">dispatch</span>(<span class=\"params\">action: A</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// actionå¿…é¡»æ˜¯ä¸€ä¸ªå¯¹è±¡</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!isPlainObject(action)) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(</span><br><span class=\"line\">        <span class=\"string\">'Actions must be plain objects. '</span> +</span><br><span class=\"line\">          <span class=\"string\">'Use custom middleware for async actions.'</span></span><br><span class=\"line\">      )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// actionå¿…é¡»æ‹¥æœ‰ä¸€ä¸ªtype</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> action.type === <span class=\"string\">'undefined'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(</span><br><span class=\"line\">        <span class=\"string\">'Actions may not have an undefined \"type\" property. '</span> +</span><br><span class=\"line\">          <span class=\"string\">'Have you misspelled a constant?'</span></span><br><span class=\"line\">      )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœæ­£åœ¨dispatchingï¼Œé‚£ä¹ˆä¸æ‰§è¡Œdispatchæ“ä½œã€‚</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isDispatching) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">'Reducers may not dispatch actions.'</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// è®¾ç½®dispatchingçŠ¶æ€ä¸ºtrueï¼Œå¹¶ä½¿ç”¨reducerç”Ÿæˆæ–°çš„çŠ¶æ€æ ‘ã€‚</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      isDispatching = <span class=\"literal\">true</span></span><br><span class=\"line\">      currentState = currentReducer(currentState, action)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å½“è·å–æ–°çš„çŠ¶æ€æ ‘å®Œæˆåï¼Œè®¾ç½®çŠ¶æ€ä¸ºfalse.</span></span><br><span class=\"line\">      isDispatching = <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å°†ç›®å‰æœ€æ–°çš„ç›‘å¬æ–¹æ³•æ”¾ç½®åˆ°å³å°†æ‰§è¡Œçš„é˜Ÿåˆ—ä¸­éå†å¹¶ä¸”æ‰§è¡Œ</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> listeners = (currentListeners = nextListeners)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; listeners.length; i++) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> listener = listeners[i]</span><br><span class=\"line\">      listener()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å°†è§¦å‘çš„actionè¿”å›</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> action</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<p>å…¶å®çœ‹ä¸‹æ¥ï¼Œæˆ‘ä»¬å‘ç°ä»–å°±æ˜¯ç®€å•çš„å°†æˆ‘ä»¬çš„å‚æ•°è½¬å‘ç»™äº†<code>reducer</code>ï¼Œç„¶åæ‰§è¡Œäº†æˆ‘ä»¬ä¹‹å‰å»ºç«‹çš„ç›‘å¬é˜Ÿåˆ—ã€‚</p>\n<p>æœ‰æ²¡æœ‰åŒå­¦ä¼šå’Œæˆ‘æƒ³çš„ä¸€æ ·ï¼Œé‚£ä¸ºä»€ä¹ˆä¸ç›´æ¥æ‰§è¡Œ<code>reducer</code>ï¼Ÿå› ä¸ºæˆ‘ä»¬é‡Œé¢æœ‰è®¢é˜…å‡½æ•°éœ€è¦æ‰§è¡Œï¼Œå¯¹å§ï¼Œè€Œä¸”è¿˜æœ‰<code>dispatch</code>çš„çŠ¶æ€éœ€è¦é€šçŸ¥<code>store</code>ï¼Œä¸ç„¶<code>getState</code>ä¹‹ç±»çš„ï¼Œæˆ‘ä»¬ä¹‹å‰æœ‰çœ‹åˆ°åˆ¤æ–­<code>dispatch</code>çŠ¶æ€çš„å¾ˆå¯èƒ½å‡ºç°åå·®ã€‚</p>\n<p>æˆ‘ä»¬åªéœ€è¦<code>connect</code>ä¸€ä¸‹å°±å¯ä»¥ç›´æ¥åœ¨<code>props</code>é‡Œé¢æ‹¿åˆ°<code>dispatch</code>ï¼Œä¸éœ€è¦<code>import</code>ä¹‹ç±»çš„ï¼Œå¾ˆç®€æ´ã€‚</p>\n<h4 id=\"replaceReducer\"><a href=\"#replaceReducer\" class=\"headerlink\" title=\"replaceReducer\"></a>replaceReducer</h4><p>è¿™ä¸ªå‡½æ•°é¡¾åæ€ä¹‰ï¼Œä¹Ÿå¾ˆå¥½ç†è§£ï¼Œæˆ‘å°±ä¸å¤šåšè§£é‡Šäº†ï¼Œç›´æ¥çœ‹æ³¨é‡Šå§ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// è¿™ä¸ªå…¶å®å¾ˆå°‘ç”¨åˆ°, å®˜æ–¹çš„ä»‹ç»æ˜¯ä¸»è¦æ˜¯ç”¨äºåŠ¨æ€æ›¿æ¢reducerçš„æ—¶å€™ä¼šç”¨åˆ°</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">replaceReducer</span>&lt;<span class=\"title\">NewState</span>, <span class=\"title\">NewActions</span> <span class=\"title\">extends</span> <span class=\"title\">A</span>&gt;(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">    nextReducer: Reducer&lt;NewState, NewActions&gt;</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  </span>): <span class=\"title\">Store</span>&lt;<span class=\"title\">ExtendState</span>&lt;<span class=\"title\">NewState</span>, <span class=\"title\">StateExt</span>&gt;, <span class=\"title\">NewActions</span>, <span class=\"title\">StateExt</span>, <span class=\"title\">Ext</span>&gt; &amp; <span class=\"title\">Ext</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> nextReducer !== <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">'Expected the nextReducer to be a function.'</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// ä¿®æ”¹reducer</span></span><br><span class=\"line\">    <span class=\"comment\">// å½“å‰çš„currentReduceræ›´æ–°ä¸ºå‚æ•°nextReducer</span></span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">TODO:</span> do this more elegantly</span></span><br><span class=\"line\">    ;((currentReducer <span class=\"keyword\">as</span> unknown) <span class=\"keyword\">as</span> Reducer&lt;</span><br><span class=\"line\">      NewState,</span><br><span class=\"line\">      NewActions</span><br><span class=\"line\">    &gt;) = nextReducer</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// This action has a similar effect to ActionTypes.INIT.</span></span><br><span class=\"line\">    <span class=\"comment\">// Any reducers that existed in both the new and old rootReducer</span></span><br><span class=\"line\">    <span class=\"comment\">// will receive the previous state. This effectively populates</span></span><br><span class=\"line\">    <span class=\"comment\">// the new state tree with any relevant data from the old one.</span></span><br><span class=\"line\">    <span class=\"comment\">// å’ŒINITçš„dispatchç›¸åŒï¼Œå‘é€ä¸€ä¸ªdispatchåˆå§‹åŒ–stateï¼Œè¡¨æ˜ä¸€ä¸‹æ˜¯REPLACE</span></span><br><span class=\"line\">    <span class=\"comment\">// è‡ªå·±ğŸ‘€çœ‹ä¸€ä¸‹utilsæ–¹æ³•çš„ActionTypesï¼Œ éšæ€§çš„éšæœºæ•°</span></span><br><span class=\"line\">    dispatch(&#123; <span class=\"attr\">type</span>: ActionTypes.REPLACE &#125; <span class=\"keyword\">as</span> A)</span><br><span class=\"line\">    <span class=\"comment\">// change the type of the store by casting it to the new store</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> (store <span class=\"keyword\">as</span> unknown) <span class=\"keyword\">as</span> Store&lt;</span><br><span class=\"line\">      ExtendState&lt;NewState, StateExt&gt;,</span><br><span class=\"line\">      NewActions,</span><br><span class=\"line\">      StateExt,</span><br><span class=\"line\">      Ext</span><br><span class=\"line\">    &gt; &amp;</span><br><span class=\"line\">      Ext</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<p>å‘ç°ä¸¤ä¸ªå¾ˆæœ‰è¶£çš„ç‚¹ï¼š</p>\n<ol>\n<li>å¤§ä½¬ä»¬ä¹Ÿä¼šå†™<code>todo</code>ï¼Œå…³é”®æ˜¯ï¼ä»–ä»¬çš„<code>TODO</code>å¹´å¤´æœ‰ç‚¹ä¹…äº†ï¼Œå“ˆå“ˆå“ˆå“ˆï¼Œ5å¹´äº†ï¼Œçœ‹æ ·å­ä¸æ˜¯åªæœ‰æˆ‘ä¸ä¼šç»§ç»­ä¼˜åŒ–çš„ï¼Œå“ˆå“ˆå“ˆå“ˆã€‚ä¹Ÿæœ‰å¯èƒ½æ˜¯æ²¡æœ‰æƒ³åˆ°æ›´å¥½çš„æ–¹æ³•ã€‚ã€‚ã€‚</li>\n<li>é‡Œé¢ä»–è‡ªå·±<code>dispatch</code>äº†ä¸€ä¸ªï¼Œ<code>ActionTypes.REPLACE</code>ã€‚</li>\n</ol>\n<p>okï¼Œæˆ‘ä»¬ä¸€æ¢ç©¶ç«Ÿï¼Œè¿™ä¸ª<code>ActionTypes.REPLACE</code></p>\n<p>æ‰’å¼€è¡£æœï¼ç›´æ¥å¼€çœ‹ğŸ‘€ï¼</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * These are private action types reserved by Redux.</span></span><br><span class=\"line\"><span class=\"comment\"> * For any unknown actions, you must return the current state.</span></span><br><span class=\"line\"><span class=\"comment\"> * If the current state is undefined, you must return the initial state.</span></span><br><span class=\"line\"><span class=\"comment\"> * Do not reference these action types directly in your code.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> randomString = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span></span><br><span class=\"line\">  <span class=\"built_in\">Math</span>.random().toString(<span class=\"number\">36</span>).substring(<span class=\"number\">7</span>).split(<span class=\"string\">''</span>).join(<span class=\"string\">'.'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> ActionTypes = &#123;</span><br><span class=\"line\">  INIT: <span class=\"string\">`@@redux/INIT<span class=\"subst\">$&#123;<span class=\"regexp\">/* #__PURE__ */</span> randomString()&#125;</span>`</span>,</span><br><span class=\"line\">  REPLACE: <span class=\"string\">`@@redux/REPLACE<span class=\"subst\">$&#123;<span class=\"regexp\">/* #__PURE__ */</span> randomString()&#125;</span>`</span>,</span><br><span class=\"line\">  PROBE_UNKNOWN_ACTION: <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> <span class=\"string\">`@@redux/PROBE_UNKNOWN_ACTION<span class=\"subst\">$&#123;randomString()&#125;</span>`</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> ActionTypes</span><br></pre></td></tr></table></figure>\n\n<p>å…¶å®å°±æ˜¯ä¸€ä¸ªä¸æƒ³å’Œæˆ‘ä»¬çš„<code>type</code>å†²çªçš„éšæœºæ•°ï¼Œå‘Šè¯‰<code>redux</code>ï¼Œè¿™ä¸ªæ˜¯ä»–ä»¬å†…éƒ¨çš„ä¸€ä¸ª<code>dispatch</code>è€Œå·²ã€‚</p>\n<h4 id=\"observable\"><a href=\"#observable\" class=\"headerlink\" title=\"observable\"></a>observable</h4><p>è¿™ä¸ªç©æ„ï¼Œå…¶å®æˆ‘æ˜¯ä¸å¤ªæ‡‚ä»–æ˜¯å¹²ä»€ä¹ˆçš„ã€‚ã€‚ã€‚å…¨å±€æœä¹Ÿæ²¡æœ‰æœå‡ºæ¥ï¼Œè€Œä¸”æˆ‘ä¹Ÿæ²¡ç”¨è¿‡ã€‚ã€‚ã€‚</p>\n<p>å¤§å®¶çœ‹æ³¨é‡Šå§ï¼Œä¸è¿‡å¤šè§£é‡Šï¼Œå¦‚æœæœ‰æ‡‚å“¥ï¼Œæ¬¢è¿ä¸€èµ·äº¤æµè®¨è®ºå‘€ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// æŸ¥è¯¢ä¹‹å,ä¹Ÿæ²¡å‘ç°æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ç”¨å¤„...æš‚æ—¶è·³è¿‡,å¦‚æœæœ‰å¸…å“¥çœ‹åˆ°çš„è¯å¯ä»¥ä¸åèµæ•™</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">observable</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> outerSubscribe = subscribe</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">       The minimal observable subscription method.</span></span><br><span class=\"line\"><span class=\"comment\">       <span class=\"doctag\">@param </span>observer Any object that can be used as an observer.</span></span><br><span class=\"line\"><span class=\"comment\">       The observer object should have a `next` method.</span></span><br><span class=\"line\"><span class=\"comment\">       <span class=\"doctag\">@returns </span>An object with an `unsubscribe` method that can</span></span><br><span class=\"line\"><span class=\"comment\">       be used to unsubscribe the observable from the store, and prevent further</span></span><br><span class=\"line\"><span class=\"comment\">       emission of values from the observable.</span></span><br><span class=\"line\"><span class=\"comment\">       */</span></span><br><span class=\"line\">      subscribe(observer: unknown) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> observer !== <span class=\"string\">'object'</span> || observer === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">TypeError</span>(<span class=\"string\">'Expected the observer to be an object.'</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//è·å–è§‚å¯Ÿç€çš„çŠ¶æ€</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">observeState</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">          <span class=\"keyword\">const</span> observerAsObserver = observer <span class=\"keyword\">as</span> Observer&lt;S&gt;</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (observerAsObserver.next) &#123;</span><br><span class=\"line\">            observerAsObserver.next(getState())</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        observeState()</span><br><span class=\"line\">        <span class=\"comment\">//è¿”å›å–æ¶ˆè®¢é˜…çš„æ–¹æ³•</span></span><br><span class=\"line\">        <span class=\"keyword\">const</span> unsubscribe = outerSubscribe(observeState)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> &#123; unsubscribe &#125;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">      [$$observable]() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>å…¶å®ä»–å†…éƒ¨è¿˜è‡ªå·±æ‰§è¡Œäº†ä¸€ä¸‹<code>dispatch</code>ï¼Œåœ¨<code>createStore</code>çš„æœ€åã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dispatch(&#123; <span class=\"attr\">type</span>: ActionTypes.INIT &#125; <span class=\"keyword\">as</span> A)</span><br></pre></td></tr></table></figure>\n\n<p>å…¶å®ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œæˆ‘ä»¬<code>createStore</code>çš„æ—¶å€™ï¼Œåˆå§‹çš„<code>state</code>å°±æ˜¯è¿™æ ·æ¥çš„~</p>\n<p>é‡Œé¢çš„<code>INIT</code>ï¼Œåœ¨æˆ‘ä»¬ä¹‹å‰<code>REPLACE</code>é‡Œé¢ä¹Ÿæœ‰ä»‹ç»ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªéšæœºæ•°è€Œå·²ã€‚</p>\n<h2 id=\"applyMiddleware\"><a href=\"#applyMiddleware\" class=\"headerlink\" title=\"applyMiddleware\"></a>applyMiddleware</h2><p>è¿™ä¸ªå‘ï¼Œæ˜¯ä¹‹å‰åœ¨<code>createStore</code>çš„<code>ensureCanMutateNextListeners</code>åŸ‹ä¸‹çš„ï¼Œç°åœ¨æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹è¿™ä¸ªã€‚</p>\n<p>è¿™ä¸ªreduxæ‹“å±•dispatchçš„å”¯ä¸€çš„æ ‡å‡†çš„æ–¹æ³•ã€‚</p>\n<p>é¦–å…ˆï¼Œæˆ‘ä»¬å¾—çŸ¥é“æ€ä¹ˆç”¨ã€‚æˆ‘è´´ä¸‹æˆ‘è‡ªå·±demoã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// middleware</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> logger = <span class=\"function\">(<span class=\"params\">store:any</span>) =&gt;</span> <span class=\"function\">(<span class=\"params\">next:any</span>) =&gt;</span> <span class=\"function\">(<span class=\"params\">action:any</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// debugger</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.info(<span class=\"string\">'dispatching'</span>, action)</span><br><span class=\"line\">  <span class=\"keyword\">const</span> result = next(action);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'next state'</span>, store.getState())</span><br><span class=\"line\">  <span class=\"keyword\">return</span> result</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>è¿™ä¸ªæ˜¯å®˜æ–¹çš„demoï¼Œä¸äº†è§£çš„ï¼Œ<a href=\"https://www.redux.org.cn/docs/advanced/Middleware.html\" target=\"_blank\" rel=\"noopener\">ç‚¹æˆ‘å¿«é€Ÿäº†è§£</a></p>\n<p>okï¼Œæˆ‘ä»¬ç›´æ¥è´´æºç ï¼Œå¾ˆçŸ­ï¼Œä½†æ˜¯æœ‰å¾ˆå¤šå¥¥å¦™ï¼ˆå¥¥å¦™æ‰“é’±ï¼ï¼‰ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">applyMiddleware</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  ...middlewares: Middleware[]</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\"></span>): <span class=\"title\">StoreEnhancer</span>&lt;<span class=\"title\">any</span>&gt; </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\">(<span class=\"params\">createStore: StoreEnhancerStoreCreator</span>) =&gt;</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">S,</span> <span class=\"attr\">A</span> <span class=\"attr\">extends</span> <span class=\"attr\">AnyAction</span>&gt;</span>(</span></span><br><span class=\"line\">    reducer: Reducer&lt;S, A&gt;,</span><br><span class=\"line\">    preloadedState?: PreloadedState&lt;S&gt;</span><br><span class=\"line\">  ) =&gt; &#123;</span><br><span class=\"line\">    const store = createStore(reducer, preloadedState)</span><br><span class=\"line\">    let dispatch: Dispatch = () =&gt; &#123;</span><br><span class=\"line\">      throw new Error(</span><br><span class=\"line\">        'Dispatching while constructing your middleware is not allowed. ' +</span><br><span class=\"line\">          'Other middleware would not be applied to this dispatch.'</span><br><span class=\"line\">      )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    const middlewareAPI: MiddlewareAPI = &#123;</span><br><span class=\"line\">      getState: store.getState,</span><br><span class=\"line\">      dispatch: (action, ...args) =&gt; dispatch(action, ...args)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    const chain = middlewares.map(middleware =&gt; middleware(middlewareAPI))</span><br><span class=\"line\">    dispatch = compose&lt;typeof dispatch&gt;(...chain)(store.dispatch)</span><br><span class=\"line\"></span><br><span class=\"line\">    return &#123;</span><br><span class=\"line\">      ...store,</span><br><span class=\"line\">      dispatch</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>çœ‹èµ·æ¥å¾ˆçŸ­ï¼Œä½†æ˜¯å´æœ‰å¾ˆå¤šæ·±å¥¥çš„åœ°æ–¹ã€‚ä¸€ä¸ªä¸ªæ¥ã€‚</p>\n<p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸€ä¸‹å‡½æ•°æŸ¯é‡ŒåŒ–ã€‚ç›´æ¥ä¸Šdemoå¸®åŠ©ç†è§£</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\">a</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test2</span>(<span class=\"params\">b</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(a + b)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> t = test(<span class=\"number\">1</span>);</span><br><span class=\"line\">t(<span class=\"number\">2</span>); <span class=\"comment\">// 3</span></span><br></pre></td></tr></table></figure>\n\n<p>è¿™é‡Œå°±æ˜¯ä¸€ä¸ªç®€å•çš„å‡½æ•°æŸ¯é‡ŒåŒ–ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå­˜å‚¨ä¸€ä¸‹ç¬¬ä¸€æ¬¡ä¼ å…¥çš„å‚æ•°ï¼Œåé¢å¦‚æœè¿™ä¸ª<code>1</code>ä¼šå¤ç”¨çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å®šä¹‰çš„å˜é‡<code>t</code>å°±å¯ä»¥åœ¨å¾ˆå¤šåœ°æ–¹ä½¿ç”¨ï¼Œé‡Œé¢ç”¨åˆ°äº†é—­åŒ…çš„çŸ¥è¯†ï¼Œè€Œä¸”æ˜¯éå¸¸å…¸å‹çš„é—­åŒ…ï¼Œå­˜å‚¨å½¢å‚<code>a</code>ï¼Œå®å‚<code>1</code>ã€‚</p>\n<p>è¿˜è®°å¾—æˆ‘ä»¬çš„ä½¿ç”¨ç”¨ä¾‹å—ï¼Ÿ</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// middleware</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> logger = <span class=\"function\">(<span class=\"params\">store:any</span>) =&gt;</span> <span class=\"function\">(<span class=\"params\">next:any</span>) =&gt;</span> <span class=\"function\">(<span class=\"params\">action:any</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// debugger</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.info(<span class=\"string\">'dispatching'</span>, action)</span><br><span class=\"line\">  <span class=\"keyword\">const</span> result = next(action);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'next state'</span>, store.getState())</span><br><span class=\"line\">  <span class=\"keyword\">return</span> result</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>è¿™é‡Œé¢ç¬¬ä¸€ä¸ªå‚æ•°<code>store</code>å°±æ˜¯å¯¹åº”åˆ°æˆ‘ä»¬<code>createStore</code>æºç é‡Œé¢æˆ‘ä»¬æŒ–çš„å‘ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> enhancer !== <span class=\"string\">'undefined'</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœenhancerå­˜åœ¨ï¼Œé‚£ä»–å¿…é¡»æ˜¯ä¸ªfunction, å¦åˆ™throw Errorå“ˆ</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> enhancer !== <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">'Expected the enhancer to be a function.'</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * ä¼ å…¥ç¬¦åˆå‚æ•°ç±»å‹çš„å‚æ•°ï¼Œå°±å¯ä»¥æ‰§è¡Œ enhancer,</span></span><br><span class=\"line\"><span class=\"comment\">     * ä½†æ˜¯è¿™ä¸ªreturnæ·±æ·±çš„å¸å¼•äº†æˆ‘, å› ä¸ºè¯´æ˜æœ‰applyMiddlewareçš„æ—¶å€™åé¢çš„éƒ½ä¸ç”¨çœ‹äº† ??? å½“ç„¶\u001dä¸å¯èƒ½</span></span><br><span class=\"line\"><span class=\"comment\">     * å¯æ˜¯applyMiddlewareå…¶å®æ˜¯å¿…ç”¨é¡¹ï¼Œæ‰€ä»¥çŒœæƒ³ä¸€ä¸‹applyMiddlewareå¼ºåŒ–storeä¹‹åä¼šenhancerèµ‹å€¼undefinedï¼Œå†æ¬¡è°ƒç”¨createStore</span></span><br><span class=\"line\"><span class=\"comment\">     * ä¸Šä¸‹æ‰“ä¸ªdebuggerçœ‹ä¸€ä¸‹æ‰§è¡Œé¡ºåº(debuggerä½ç½®ä»¥æ³¨é‡Š)ï¼Œæœç„¶ä¸å‡ºæ‰€æ–™</span></span><br><span class=\"line\"><span class=\"comment\">     * å¥½äº†ï¼Œ å‡è®¾æˆ‘ä»¬è¿˜ä¸çŸ¥é“applyMiddleware()è¿™ä¸ªfuncrionå…·ä½“å¹²äº†ä»€ä¹ˆï¼Œ</span></span><br><span class=\"line\"><span class=\"comment\">     * åªçŸ¥é“ä»–åšäº†ä¸€äº›å¤„ç†ç„¶åé‡æ–°è°ƒç”¨äº†createStoreå¹¶ä¸”enhancerå‚æ•°ä¸ºundefined</span></span><br><span class=\"line\"><span class=\"comment\">     * å…ˆè®°ä¸‹ï¼Œåç»­åœ¨çœ‹applyMiddlewareï¼Œ å› ä¸ºæˆ‘ä»¬ç°åœ¨è¦çœ‹çš„æ˜¯createStore</span></span><br><span class=\"line\"><span class=\"comment\">     * * */</span></span><br><span class=\"line\">    <span class=\"comment\">// debugger</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> enhancer(createStore)(</span><br><span class=\"line\">      reducer,</span><br><span class=\"line\">      preloadedState <span class=\"keyword\">as</span> PreloadedState&lt;S&gt;</span><br><span class=\"line\">    ) <span class=\"keyword\">as</span> Store&lt;ExtendState&lt;S, StateExt&gt;, A, StateExt, Ext&gt; &amp; Ext</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<p>ç¬¬äºŒä¸ª<code>next</code>ï¼Œå…¶å®å°±æ˜¯<code>middlewareAPI</code>é‡Œé¢çš„<code>dispatch</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> middlewareAPI: MiddlewareAPI = &#123;</span><br><span class=\"line\">      getState: store.getState,</span><br><span class=\"line\">      dispatch: <span class=\"function\">(<span class=\"params\">action, ...args</span>) =&gt;</span> dispatch(action, ...args),</span><br><span class=\"line\">      test:<span class=\"number\">2</span>,</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>å¢åŠ ä¸€ä¸ª<code>log</code>åœ¨<code>middleware</code>é‡Œé¢å°±å¯ä»¥çŸ¥é“äº†</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> logger = <span class=\"function\">(<span class=\"params\">store:any</span>) =&gt;</span> <span class=\"function\">(<span class=\"params\">next:any</span>) =&gt;</span> <span class=\"function\">(<span class=\"params\">action:any</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// debugger</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(store)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'next==='</span>,next)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(action)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.info(<span class=\"string\">'dispatching'</span>, action)</span><br><span class=\"line\">  <span class=\"comment\">// const result = next(action);</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'next state'</span>, store.getState())</span><br><span class=\"line\">  <span class=\"comment\">// return result</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>è¿™ä¸ªæ—¶å€™<code>log</code>çš„æ˜¯æˆ‘ä»¬åœ¨<code>createStore</code>é‡Œé¢çš„<code>dispatch</code>ï¼Œè¿˜å‡ºç°äº†æˆ‘ä»¬çš„æ³¨é‡Š</p>\n<p>è¯´æ˜<code>next</code>è¿™ä¸ªå‚æ•°å°±æ˜¯å¯¹åº”çš„<code>middlewareAPI</code>é‡Œé¢çš„<code>dispatch</code>ä¹Ÿå°±æ˜¯è¯´æ˜¯<code>createStore</code>é‡Œé¢çš„<code>dispatch</code>ã€‚</p>\n<p>ç¬¬ä¸‰ä¸ªå‚æ•°<code>action</code></p>\n<p>å¾ˆç®€å•ï¼Œå…¶å®å°±æ˜¯æ™®æ™®é€šé€šçš„ä¸€ä¸ª<code>action</code>ã€‚ä¸è¿‡æ˜¯ä»æˆ‘ä»¬<code>middleaware</code>é‡Œé¢å¾—åˆ°çš„ã€‚è¿™ä¸ªæ²¡æœ‰ç–‘æƒ‘ã€‚</p>\n<blockquote>\n<p>æˆ‘ä»¬ä¼šå‘ç°ä¸€ä¸ªå¾ˆæœ‰è¶£çš„äº‹æƒ…å°±æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æ³¨é‡Šæ‰è°ƒç”¨<code>next(action)</code>ï¼Œå¹¶ä¸”ä¸å°†ç»“æœ<code>return</code>çš„è¯ï¼Œè¿™ä¸ª<code>action</code>å°±ä¼šè¢«å¡ä½ï¼Œæ²¡æœ‰å‘å‡ºå»ï¼Œè¢«æˆ‘ä»¬æ‰“æ–­äº†ï¼Œæ‰€ä»¥è¿™å°±æ˜¯æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦åšè¿™ä¸ªçš„åŸå› ã€‚é‚£ä¹ˆå°±å¯ä»¥å¼•ç”³å‡ºæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰æ‰“æ–­æŸäº›æƒ…å†µä¸‹çš„actionï¼Œç„¶åéœ€è¦åœ¨é‚£äº›æƒ…å†µä¸‹ç»™actioné‡Œé¢åŠ äº›ä»€ä¹ˆï¼Œéƒ½å¯ä»¥åŠåˆ°ã€‚</p>\n</blockquote>\n<p>okï¼Œæˆ‘ä»¬çœ‹äº†ä¹‹åå¥½åƒçŸ¥é“<code>applyMiddleware</code>é‡Œé¢çš„å‚æ•°éƒ½å¯¹åº”è¿™å“ªäº›ä¸œè¥¿äº†ï¼Œä½†æ˜¯ä¼¼ä¹ä¸çŸ¥é“ä¸ºä»€ä¹ˆæ˜¯ä¸€ç§æŸ¯é‡ŒåŒ–çš„å½¢å¼æ¥å±•ç¤ºçš„ã€‚æˆ‘ä»¬çœ‹ä¸‹é¢çš„ä»£ç å°±ä¼šçŸ¥é“äº†ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// è°ƒç”¨æ¯ä¸€ä¸ªè¿™æ ·å½¢å¼çš„middleware = store =&gt; next =&gt; action =&gt;&#123;&#125;, </span></span><br><span class=\"line\"><span class=\"comment\">// ç»„æˆä¸€ä¸ªè¿™æ ·[f(next)=&gt;acticon=&gt;next(action)...]çš„arrayï¼Œèµ‹å€¼ç»™chain</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> chain = middlewares.map(<span class=\"function\"><span class=\"params\">middleware</span> =&gt;</span> middleware(middlewareAPI))</span><br><span class=\"line\"><span class=\"comment\">// debugger</span></span><br><span class=\"line\"><span class=\"comment\">// composeçœ‹ -&gt; compose.jsæ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"comment\">// compose(...chain)ä¼šå½¢æˆä¸€ä¸ªè°ƒç”¨é“¾, nextæŒ‡ä»£ä¸‹ä¸€ä¸ªå‡½æ•°çš„æ³¨å†Œ, è¿™å°±æ˜¯ä¸­é—´ä»¶çš„è¿”å›å€¼è¦æ˜¯next(action)çš„åŸå› </span></span><br><span class=\"line\"><span class=\"comment\">// å¦‚æœæ‰§è¡Œåˆ°äº†æœ€ånextå°±æ˜¯åŸç”Ÿçš„store.dispatchæ–¹æ³•</span></span><br><span class=\"line\">dispatch = compose(...chain)(store.dispatch)</span><br></pre></td></tr></table></figure>\n\n<p>é‡Œé¢æåˆ°äº†<code>compose</code>è¿™ä¸ªå‡½æ•°ï¼Œå…¶å®è¿™ä¸ªå‡½æ•°å°±æ˜¯æ•´ä¸ªä¸­é—´ä»¶çš„ç²¾é«“æ‰€åœ¨ã€‚æŸ¯é‡ŒåŒ–çš„å¥¥ä¹‰ï¼</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">compose</span>(<span class=\"params\">...funcs: Function[]</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (funcs.length === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// infer the argument type so it is usable in inference down the line</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">T</span>&gt;</span>(arg: T) =&gt; arg</span></span><br><span class=\"line\"><span class=\"xml\">  &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"xml\">  if (funcs.length === 1) &#123;</span></span><br><span class=\"line\"><span class=\"xml\">    return funcs[0]</span></span><br><span class=\"line\"><span class=\"xml\">  &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"xml\">  return funcs.reduce((a, b) =&gt; (...args: any) =&gt; a(b(...args)))</span></span><br><span class=\"line\"><span class=\"xml\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>ä¸äº†è§£reduceçš„åŒå­¦å¯ä»¥<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce\" target=\"_blank\" rel=\"noopener\">ç‚¹è¿™é‡Œ</a>ã€‚</p>\n<p>è¿™ä¸ªcomposeå…¶å®æ˜¯ä¸€ä¸ªè°ƒç”¨é“¾ï¼Œæˆ‘ä»¬çš„æ‰€æœ‰çš„ä¸­é—´ä»¶éƒ½ä¼šæŒ‰é¡ºåºåŠ è½½ï¼Œç„¶åæ˜¯ğŸ‘‡è¿™ç§å½¢å¼</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">middleware = <span class=\"function\"><span class=\"params\">middleware1</span> =&gt;</span> <span class=\"function\"><span class=\"params\">middleware2</span> =&gt;</span> <span class=\"function\"><span class=\"params\">middleware3</span> =&gt;</span> middleware4 <span class=\"comment\">//...</span></span><br></pre></td></tr></table></figure>\n\n<p>æˆ‘ä»¬é€šè¿‡ä¸€ä¸‹ä»£ç çŸ¥é“ï¼Œç¡®å®æ˜¯å¾€ä¸‹ä¼ é€’çš„ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// middleware</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> logger = <span class=\"function\">(<span class=\"params\">store:any</span>) =&gt;</span> <span class=\"function\">(<span class=\"params\">next:any</span>) =&gt;</span> <span class=\"function\">(<span class=\"params\">action:any</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// debugger</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(store)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'next==='</span>,next)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(action)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.info(<span class=\"string\">'dispatching'</span>, action)</span><br><span class=\"line\">  action.aa = <span class=\"number\">2</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> result = next(action);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'next state'</span>, store.getState())</span><br><span class=\"line\">  <span class=\"keyword\">return</span> result</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> logger2 = <span class=\"function\">(<span class=\"params\">store:any</span>) =&gt;</span> <span class=\"function\">(<span class=\"params\">next:any</span>) =&gt;</span> <span class=\"function\">(<span class=\"params\">action:any</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// debugger</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(store)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'next2==='</span>,next)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'logger2==-=-=-=-=-=-='</span>,action)</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.info(<span class=\"string\">'dispatching'</span>, action)</span><br><span class=\"line\">  <span class=\"keyword\">const</span> result = next(action);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'next state'</span>, store.getState())</span><br><span class=\"line\">  <span class=\"keyword\">return</span> result</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> store = createStore(rootReducer, &#123;<span class=\"attr\">todos</span>:[]&#125;, applyMiddleware(logger, logger2));</span><br></pre></td></tr></table></figure>\n\n<p>åœ¨<code>logger2</code>é‡Œé¢ç¡®å®æ‰“å°å‡ºæ¥<code>aa</code>è¿™ä¸ªå±æ€§çš„å€¼ï¼Œè€Œ<code>logger</code>å´æ²¡æœ‰</p>\n<h2 id=\"compose\"><a href=\"#compose\" class=\"headerlink\" title=\"compose\"></a>compose</h2><p>è¿™ä¸ªåœ¨ä¸Šé¢ä»‹ç»applyMiddlewareçš„æ—¶å€™è¯´è¿‡äº†ã€‚å°±ä¸å¤šè¯´äº†ã€‚</p>\n<h2 id=\"combineReducers\"><a href=\"#combineReducers\" class=\"headerlink\" title=\"combineReducers\"></a>combineReducers</h2><p>è¿™ä¸ªä¸­æ–‡ç¿»è¯‘å°±æ˜¯ã€Šç»„åˆreducerã€‹ã€‚</p>\n<p>å…¶å®å°±æ˜¯ å­—é¢æ„æ€ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹æ€ä¹ˆç”¨å°±äº†è§£äº†ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> combineReducers(&#123;</span><br><span class=\"line\">  firstReducer: todos,</span><br><span class=\"line\">  secondReducer: visibilityFilter</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>ç„¶åæˆ‘ä»¬çœ‹ä¸€ä¸‹<code>log</code>å‡ºæ¥çš„<code>props</code>æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">\tfirstReducer: &#123;<span class=\"attr\">todos</span>: <span class=\"built_in\">Array</span>(<span class=\"number\">0</span>)&#125;</span><br><span class=\"line\">\tsecondReducer: <span class=\"string\">\"SHOW_ALL\"</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸€å¼€å§‹è®¾ç½®è¿›å»çš„<code>key</code>å€¼ï¼Œè¿”å›çš„æ—¶å€™ä¹Ÿæ˜¯æŒ‰è¿™ä¸ªæ ¼å¼è¿”å›çš„ã€‚</p>\n<p>é‡Œé¢æœ‰è®¸å¤šå‡½æ•°ï¼Œæˆ‘ä»¬å…ˆçœ‹ä»–åˆ°å¤„çš„å‡½æ•°<code>combineReducers</code></p>\n<h3 id=\"combineReducers-1\"><a href=\"#combineReducers-1\" class=\"headerlink\" title=\"combineReducers\"></a>combineReducers</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ç”¨äºåˆå¹¶reducer ä¸€èˆ¬æ˜¯è¿™æ ·combineReducers(&#123;a,b,c&#125;)</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">combineReducers</span>(<span class=\"params\">reducers: ReducersMapObject</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// reducersä¸­keyçš„æ•°ç»„</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> reducerKeys = <span class=\"built_in\">Object</span>.keys(reducers)</span><br><span class=\"line\">  <span class=\"comment\">// æœ€ç»ˆçš„reducer</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> finalReducers: ReducersMapObject = &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// å¾ªç¯ï¼Œ ç›®çš„ä¸ºäº†ç»™finalReducersèµ‹å€¼ï¼Œ è¿‡è™‘äº†ä¸ç¬¦åˆè§„èŒƒçš„reducer</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; reducerKeys.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// æ¥å—å½“å‰çš„key</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> key = reducerKeys[i]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœä¸æ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œ å½“å‰çš„reduceræ˜¯undefinedä¼šç»™å‡ºwarning</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (process.env.NODE_ENV !== <span class=\"string\">'production'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> reducers[key] === <span class=\"string\">'undefined'</span>) &#123;</span><br><span class=\"line\">        warning(<span class=\"string\">`No reducer provided for key \"<span class=\"subst\">$&#123;key&#125;</span>\"`</span>)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// reducerè¦æ˜¯ä¸€ä¸ªfunction</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> reducers[key] === <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// èµ‹å€¼ç»™finalReducers</span></span><br><span class=\"line\">      finalReducers[key] = reducers[key]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// ç¬¦åˆè§„èŒƒçš„reducerçš„keyæ•°ç»„</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> finalReducerKeys = <span class=\"built_in\">Object</span>.keys(finalReducers)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// This is used to make sure we don't warn about the same</span></span><br><span class=\"line\">  <span class=\"comment\">// keys multiple times.</span></span><br><span class=\"line\">  <span class=\"comment\">// æ„æƒ³ä¸åˆ°çš„keyï¼Œ å…ˆå¾€ä¸‹çœ‹çœ‹</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> unexpectedKeyCache: &#123; [key: string]: <span class=\"literal\">true</span> &#125;</span><br><span class=\"line\">  <span class=\"comment\">// productionç¯å¢ƒä¸º&#123;&#125;</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (process.env.NODE_ENV !== <span class=\"string\">'production'</span>) &#123;</span><br><span class=\"line\">    unexpectedKeyCache = &#123;&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">let</span> shapeAssertionError: <span class=\"built_in\">Error</span></span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// çœ‹è¿™ä¸ªfunction</span></span><br><span class=\"line\">    assertReducerShape(finalReducers)</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">    shapeAssertionError = e</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// è¿”å›functionï¼Œ å³ä¸ºcreateStoreä¸­çš„reducerå‚æ•°æ—¢currentReducer</span></span><br><span class=\"line\">  <span class=\"comment\">// è‡ªç„¶æœ‰stateå’Œactionä¸¤ä¸ªå‚æ•°ï¼Œ å¯ä»¥å›createStoreæ–‡ä»¶çœ‹çœ‹currentReducer(currentState, action)</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">combination</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">    state: StateFromReducersMapObject&lt;typeof reducers&gt; = &#123;&#125;,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">    action: AnyAction</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  </span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// reducerä¸è§„èŒƒæŠ¥é”™</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (shapeAssertionError) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> shapeAssertionError</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// æ¯”è¾ƒç»†è‡´çš„âŒä¿¡æ¯ï¼Œé¡ºä¾¿çœ‹äº†ä¸€ä¸‹getUndefinedStateErrorMessageï¼Œéƒ½æ˜¯ç”¨äºæç¤ºwarningå’Œerrorçš„ï¼Œ ä¸è¿‡å¤šè§£é‡Šäº†</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (process.env.NODE_ENV !== <span class=\"string\">'production'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> warningMessage = getUnexpectedStateShapeWarningMessage(</span><br><span class=\"line\">        state,</span><br><span class=\"line\">        finalReducers,</span><br><span class=\"line\">        action,</span><br><span class=\"line\">        unexpectedKeyCache</span><br><span class=\"line\">      )</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (warningMessage) &#123;</span><br><span class=\"line\">        warning(warningMessage)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> hasChanged = <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> nextState: StateFromReducersMapObject&lt;<span class=\"keyword\">typeof</span> reducers&gt; = &#123;&#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; finalReducerKeys.length; i++) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// è·å–finalReducerKeysçš„keyå’Œvalueï¼ˆfunctionï¼‰</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> key = finalReducerKeys[i]</span><br><span class=\"line\">      <span class=\"keyword\">const</span> reducer = finalReducers[key]</span><br><span class=\"line\">      <span class=\"comment\">// å½“å‰keyçš„stateå€¼</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> previousStateForKey = state[key]</span><br><span class=\"line\">      <span class=\"comment\">// æ‰§è¡Œreducerï¼Œ è¿”å›å½“å‰state</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> nextStateForKey = reducer(previousStateForKey, action)</span><br><span class=\"line\">      <span class=\"comment\">// ä¸å­˜åœ¨è¿”å›å€¼æŠ¥é”™</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> nextStateForKey === <span class=\"string\">'undefined'</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> errorMessage = getUndefinedStateErrorMessage(key, action)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(errorMessage)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"comment\">// æ–°çš„stateæ”¾åœ¨nextStateå¯¹åº”çš„keyé‡Œ</span></span><br><span class=\"line\">      nextState[key] = nextStateForKey</span><br><span class=\"line\">      <span class=\"comment\">// åˆ¤æ–­æ–°çš„stateæ˜¯ä¸æ˜¯åŒä¸€å¼•ç”¨ï¼Œ ä»¥æ£€éªŒreduceræ˜¯ä¸æ˜¯çº¯å‡½æ•°</span></span><br><span class=\"line\">      hasChanged = hasChanged || nextStateForKey !== previousStateForKey</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    hasChanged =</span><br><span class=\"line\">      hasChanged || finalReducerKeys.length !== <span class=\"built_in\">Object</span>.keys(state).length</span><br><span class=\"line\">      <span class=\"comment\">// æ”¹å˜äº†è¿”å›nextState</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> hasChanged ? nextState : state</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">  *  æ–°ç‰ˆæœ¬çš„reduxè¿™éƒ¨åˆ†æ”¹å˜äº†å®ç°æ–¹æ³•</span></span><br><span class=\"line\"><span class=\"comment\">  *  è€ç‰ˆæœ¬çš„reduxä½¿ç”¨çš„reduceå‡½æ•°å®ç°çš„</span></span><br><span class=\"line\"><span class=\"comment\">  *  ç®€å•ä¾‹å­å¦‚ä¸‹</span></span><br><span class=\"line\"><span class=\"comment\">  * function combineReducers(reducers) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">  *    return (state = &#123;&#125;, action) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"comment\">  *        return Object.keys(reducers).reduce((currentState, key) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"comment\">  *            currentState[key] = reducers[key](state[key], action);</span></span><br><span class=\"line\"><span class=\"comment\">  *             return currentState;</span></span><br><span class=\"line\"><span class=\"comment\">  *         &#125;, &#123;&#125;)</span></span><br><span class=\"line\"><span class=\"comment\">  *      &#125;;</span></span><br><span class=\"line\"><span class=\"comment\">  *    &#125;</span></span><br><span class=\"line\"><span class=\"comment\">  * </span></span><br><span class=\"line\"><span class=\"comment\">  * */</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä¸Šé¢æ˜¯ä¸»è¦æºç ï¼Œä¸€ä¸ªä¸ªå‰–æè¿›å»ã€‚</p>\n<p>å…ˆæ˜¯å¯¹æ•°æ®è¿›è¡Œæ¸…æ´—ï¼Œç¬¬ä¸€æ¬¡ç­›é€‰å‡ºç¬¦åˆè¦æ±‚çš„<code>reducer</code>ä»¬</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// reducersä¸­keyçš„æ•°ç»„</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> reducerKeys = <span class=\"built_in\">Object</span>.keys(reducers)</span><br><span class=\"line\">  <span class=\"comment\">// æœ€ç»ˆçš„reducer</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> finalReducers: ReducersMapObject = &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// å¾ªç¯ï¼Œ ç›®çš„ä¸ºäº†ç»™finalReducersèµ‹å€¼ï¼Œ è¿‡è™‘äº†ä¸ç¬¦åˆè§„èŒƒçš„reducer</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; reducerKeys.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// æ¥å—å½“å‰çš„key</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> key = reducerKeys[i]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœä¸æ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œ å½“å‰çš„reduceræ˜¯undefinedä¼šç»™å‡ºwarning</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (process.env.NODE_ENV !== <span class=\"string\">'production'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> reducers[key] === <span class=\"string\">'undefined'</span>) &#123;</span><br><span class=\"line\">        warning(<span class=\"string\">`No reducer provided for key \"<span class=\"subst\">$&#123;key&#125;</span>\"`</span>)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// reducerè¦æ˜¯ä¸€ä¸ªfunction</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> reducers[key] === <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// èµ‹å€¼ç»™finalReducers</span></span><br><span class=\"line\">      finalReducers[key] = reducers[key]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"assertReducerShape\"><a href=\"#assertReducerShape\" class=\"headerlink\" title=\"assertReducerShape\"></a>assertReducerShape</h3><p>åˆç­›ä¹‹åçš„finalReducersä¼šäº¤ç”±assertReducerShapeå†ä¸€æ¬¡è¿›è¡Œæ£€éªŒã€‚é‡Œé¢å°±æ˜¯ä¸€ä¸ªåˆ¤æ–­ï¼Œç„¶åç»™å‡ºè­¦å‘Šâš ï¸ä¹‹ç±»çš„ã€‚å°±ä¸å¤šè¯´äº†ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">assertReducerShape</span>(<span class=\"params\">reducers</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">Object</span>.keys(reducers).forEach(<span class=\"function\"><span class=\"params\">key</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> reducer = reducers[key]</span><br><span class=\"line\">   <span class=\"comment\">// reducerè¿”å›å€¼</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> initialState = reducer(<span class=\"literal\">undefined</span>, &#123; <span class=\"attr\">type</span>: ActionTypes.INIT &#125;)</span><br><span class=\"line\">    <span class=\"comment\">// undefined throw Error</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> initialState === <span class=\"string\">'undefined'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(</span><br><span class=\"line\">        <span class=\"string\">`Reducer \"<span class=\"subst\">$&#123;key&#125;</span>\" returned undefined during initialization. `</span> +</span><br><span class=\"line\">          <span class=\"string\">`If the state passed to the reducer is undefined, you must `</span> +</span><br><span class=\"line\">          <span class=\"string\">`explicitly return the initial state. The initial state may `</span> +</span><br><span class=\"line\">          <span class=\"string\">`not be undefined. If you don't want to set a value for this reducer, `</span> +</span><br><span class=\"line\">          <span class=\"string\">`you can use null instead of undefined.`</span></span><br><span class=\"line\">      )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å¾ˆæ˜æ˜¾assertReducerShapeæ˜¯ç”¨äºreducerçš„è§„èŒƒ</span></span><br><span class=\"line\">    <span class=\"comment\">// å›åˆ°combineReducers</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (</span><br><span class=\"line\">      <span class=\"keyword\">typeof</span> reducer(<span class=\"literal\">undefined</span>, &#123;</span><br><span class=\"line\">        type: ActionTypes.PROBE_UNKNOWN_ACTION()</span><br><span class=\"line\">      &#125;) === <span class=\"string\">'undefined'</span></span><br><span class=\"line\">    ) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(</span><br><span class=\"line\">        <span class=\"string\">`Reducer \"<span class=\"subst\">$&#123;key&#125;</span>\" returned undefined when probed with a random type. `</span> +</span><br><span class=\"line\">          <span class=\"string\">`Don't try to handle <span class=\"subst\">$&#123;</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">            ActionTypes.INIT</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">          &#125;</span> or other actions in \"redux/*\" `</span> +</span><br><span class=\"line\">          <span class=\"string\">`namespace. They are considered private. Instead, you must return the `</span> +</span><br><span class=\"line\">          <span class=\"string\">`current state for any unknown actions, unless it is undefined, `</span> +</span><br><span class=\"line\">          <span class=\"string\">`in which case you must return the initial state, regardless of the `</span> +</span><br><span class=\"line\">          <span class=\"string\">`action type. The initial state may not be undefined, but can be null.`</span></span><br><span class=\"line\">      )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"combination\"><a href=\"#combination\" class=\"headerlink\" title=\"combination\"></a>combination</h3><p>ç„¶åå°±æ˜¯è¿”å›combinationè¿™ä¸ªå‡½æ•°ã€‚å‚æ•°çš„æ„ä¹‰å°±æ˜¯ä»–çš„åå­—ã€‚å°±ä¸å¤šè¯´äº†ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">combination</span>(<span class=\"params\">state = &#123;&#125;, action</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// reducerä¸è§„èŒƒæŠ¥é”™</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (shapeAssertionError) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> shapeAssertionError</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// æ¯”è¾ƒç»†è‡´çš„âŒä¿¡æ¯ï¼Œé¡ºä¾¿çœ‹äº†ä¸€ä¸‹getUndefinedStateErrorMessageï¼Œéƒ½æ˜¯ç”¨äºæç¤ºwarningå’Œerrorçš„ï¼Œ ä¸è¿‡å¤šè§£é‡Šäº†</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (process.env.NODE_ENV !== <span class=\"string\">'production'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> warningMessage = getUnexpectedStateShapeWarningMessage(</span><br><span class=\"line\">        state,</span><br><span class=\"line\">        finalReducers,</span><br><span class=\"line\">        action,</span><br><span class=\"line\">        unexpectedKeyCache</span><br><span class=\"line\">      )</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (warningMessage) &#123;</span><br><span class=\"line\">        warning(warningMessage)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> hasChanged = <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> nextState = &#123;&#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; finalReducerKeys.length; i++) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// è·å–finalReducerKeysçš„keyå’Œvalueï¼ˆfunctionï¼‰</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> key = finalReducerKeys[i]</span><br><span class=\"line\">      <span class=\"keyword\">const</span> reducer = finalReducers[key]</span><br><span class=\"line\">      <span class=\"comment\">// å½“å‰keyçš„stateå€¼</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> previousStateForKey = state[key]</span><br><span class=\"line\">      <span class=\"comment\">// æ‰§è¡Œreducerï¼Œ è¿”å›å½“å‰state</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> nextStateForKey = reducer(previousStateForKey, action)</span><br><span class=\"line\">      <span class=\"comment\">// ä¸å­˜åœ¨è¿”å›å€¼æŠ¥é”™</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> nextStateForKey === <span class=\"string\">'undefined'</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> errorMessage = getUndefinedStateErrorMessage(key, action)</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(errorMessage)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"comment\">// æ–°çš„stateæ”¾åœ¨nextStateå¯¹åº”çš„keyé‡Œ</span></span><br><span class=\"line\">      nextState[key] = nextStateForKey</span><br><span class=\"line\">      <span class=\"comment\">// åˆ¤æ–­æ–°çš„stateæ˜¯ä¸æ˜¯åŒä¸€å¼•ç”¨ï¼Œ ä»¥æ£€éªŒreduceræ˜¯ä¸æ˜¯çº¯å‡½æ•°</span></span><br><span class=\"line\">      hasChanged = hasChanged || nextStateForKey !== previousStateForKey</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// æ”¹å˜äº†è¿”å›nextState</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> hasChanged ? nextState : state</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">  *  æ–°ç‰ˆæœ¬çš„reduxè¿™éƒ¨åˆ†æ”¹å˜äº†å®ç°æ–¹æ³•</span></span><br><span class=\"line\"><span class=\"comment\">  *  è€ç‰ˆæœ¬çš„reduxä½¿ç”¨çš„reduceå‡½æ•°å®ç°çš„</span></span><br><span class=\"line\"><span class=\"comment\">  *  ç®€å•ä¾‹å­å¦‚ä¸‹</span></span><br><span class=\"line\"><span class=\"comment\">  * function combineReducers(reducers) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">  *    return (state = &#123;&#125;, action) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"comment\">  *        return Object.keys(reducers).reduce((currentState, key) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"comment\">  *            currentState[key] = reducers[key](state[key], action);</span></span><br><span class=\"line\"><span class=\"comment\">  *             return currentState;</span></span><br><span class=\"line\"><span class=\"comment\">  *         &#125;, &#123;&#125;)</span></span><br><span class=\"line\"><span class=\"comment\">  *      &#125;;</span></span><br><span class=\"line\"><span class=\"comment\">  *    &#125;</span></span><br><span class=\"line\"><span class=\"comment\">  * </span></span><br><span class=\"line\"><span class=\"comment\">  * */</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>å…¶å®å°±æ˜¯æ‰§è¡Œreducerï¼Œç„¶åæŠŠå€¼æ‹¿å‡ºæ¥æ¯”å¯¹ï¼Œå¦‚æœæ˜¯å¼•ç”¨çš„è¯å°±è¿”å›ä¹‹å‰çš„stateï¼Œå¦‚æœä¸æ˜¯å°±ä½¿ç”¨æ–°çš„ã€‚ä»–çš„æ¯”å¯¹å’Œä¹‹å‰è¯´çš„æ•°ç»„æ¯”å¯¹ä¸€æ ·ï¼Œéƒ½æ˜¯æ¯”å¯¹å†…å­˜åœ°å€ã€‚</p>\n<p>ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Ÿ</p>\n<p>å¥½é—®é¢˜ï¼</p>\n<p>è¿™æ ·åšçš„å¥½å¤„å…¶å®å°±æ˜¯ä¸ºäº†çº¯å‡½æ•°ï¼Œä¸ºäº†ä¸€åˆ‡å¯é¢„æµ‹ã€‚è€Œä¸”ç®€å•çš„æ¯”è¾ƒå†…å­˜åœ°å€æ¯”é€’å½’çš„æ€§èƒ½å¥½å¤ªå¤šäº†ã€‚</p>\n<p>é‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆæ ·æ‰å¯ä»¥å¥‘åˆè¿™æ ·çš„ç†å¿µå‘¢ï¼Ÿ</p>\n<p>å°±æ˜¯æˆ‘ä»¬åœ¨å†™reducerè¿”å›çš„æ—¶å€™ï¼Œéœ€è¦è¿”å›ä¸€ä¸ªå…¨æ–°çš„å¯¹è±¡ï¼Œé€šå¸¸æ˜¯</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">return</span>&#123;</span><br><span class=\"line\">\t...state,</span><br><span class=\"line\">\txx: xx</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ç±»ä¼¼è¿™æ ·ã€‚è¿™æ ·çš„è¯jså°±ä¼šæ–°å¼€è¾Ÿä¸€ä¸ªå†…å­˜åœ°å€å‡ºæ¥ã€‚åœ¨æ¯”å¯¹çš„æ—¶å€™å†…å­˜åœ°å€å°±ä¸ä¼šç›¸åŒäº†ã€‚</p>\n<h2 id=\"bindActionCreators\"><a href=\"#bindActionCreators\" class=\"headerlink\" title=\"bindActionCreators\"></a>bindActionCreators</h2><p>è¿™ä¸ªå‡½æ•°å…¶å®éå¸¸å°‘ç”¨åˆ°ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«æ™¦æ¶©çš„ä¸œè¥¿ï¼Œåªæ˜¯ä¸€ä¸ªå°è£…ã€‚ä½†æ˜¯æ˜¯ä¸€ç§æ›´ä¸ºä¼˜é›…çš„æ–¹å¼ã€‚</p>\n<p>ç›´æ¥çœ‹ä»£ç ï¼Œå¾ˆå°‘ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bindActionCreators</span>(<span class=\"params\">actionCreators, dispatch</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// actionCreatorsä¸ºfunction</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> actionCreators === <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> bindActionCreator(actionCreators, dispatch)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// ä¸æ˜¯object throw Error</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> actionCreators !== <span class=\"string\">'object'</span> || actionCreators === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(</span><br><span class=\"line\">      <span class=\"string\">`bindActionCreators expected an object or a function, instead received <span class=\"subst\">$&#123;</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">        actionCreators === <span class=\"literal\">null</span> ? <span class=\"string\">'null'</span> : <span class=\"keyword\">typeof</span> actionCreators</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">      &#125;</span>. `</span> +</span><br><span class=\"line\">        <span class=\"string\">`Did you write \"import ActionCreators from\" instead of \"import * as ActionCreators from\"?`</span></span><br><span class=\"line\">    )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// object è½¬ä¸ºæ•°ç»„</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> keys = <span class=\"built_in\">Object</span>.keys(actionCreators)</span><br><span class=\"line\">  <span class=\"comment\">// å®šä¹‰return çš„props</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> boundActionCreators = &#123;&#125;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; keys.length; i++) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// actionCreatorsçš„key é€šå¸¸ä¸ºactionCreators functionçš„nameï¼ˆæ–¹æ³•åï¼‰</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> key = keys[i]</span><br><span class=\"line\">    <span class=\"comment\">// function =&gt; actionCreatorså·¥å‚æ–¹æ³•æœ¬èº«</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> actionCreator = actionCreators[key]</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> actionCreator === <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å‚æ•°ä¸º&#123;actionsï¼šfunction xxx&#125;æ˜¯è¿”å›ç›¸åŒçš„ç±»å‹</span></span><br><span class=\"line\">      boundActionCreators[key] = bindActionCreator(actionCreator, dispatch)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// return çš„props</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> boundActionCreators</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä»£ç å¾ˆç®€å•ä¹Ÿå¾ˆæ¸…æ™°ï¼Œå°±æ˜¯å¼„ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œç„¶åæŠŠ<code>actionCreators</code>é‡Œé¢çš„<code>value</code>å˜æˆ<code>bindActionCreator(actionCreator, dispatch)</code>çš„å€¼ï¼Œé‚£ä¹ˆä¸€èµ·çœ‹ä¸€ä¸‹<code>bindActionCreator</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bindActionCreator</span>&lt;<span class=\"title\">A</span> <span class=\"title\">extends</span> <span class=\"title\">AnyAction</span> = <span class=\"title\">AnyAction</span>&gt;(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  actionCreator: ActionCreator&lt;A&gt;,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  dispatch: Dispatch</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">this: any, ...args: any[]</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> dispatch(actionCreator.apply(<span class=\"keyword\">this</span>, args))</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å…¶å®è¿™é‡Œçœ‹èµ·æ¥æœ‰ç‚¹è¿·ç³Šï¼Œçœ‹ä¹Ÿæ˜¯èƒ½çœ‹æ‡‚ï¼Œå…¶å®å°±æ˜¯è¿”å›ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯å¹²ä»€ä¹ˆçš„å‘¢ï¼Ÿè¿”å›æ‰§è¡Œdispatchä¹‹åçš„è¿”å›å€¼ã€‚è¿™ä¹ˆæè¿™ä¹ˆä¸€åœˆç©¶ç«Ÿæœ‰ä»€ä¹ˆç§˜å¯†å‘¢ï¼Ÿ</p>\n<p>æˆ‘ä»¬å†™ä¸€ä¸ªdemoå°±ä¼šçŸ¥é“äº†ã€‚</p>\n<p>å‡å¦‚æˆ‘ä»¬è¦åšä¸€ä¸ªåŠ¨æ€çš„å¢åŠ çš„actionï¼Œåˆ†åˆ«ä¸ºç‚¹å‡»ä¸€æ¬¡+1ï¼Œç‚¹å‡»ä¸€æ¬¡+2ï¼Œç‚¹å‡»ä¸€æ¬¡+3ã€‚</p>\n<p>æˆ‘ä»¬éœ€è¦</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> counterIncActionCreator = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">step</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    type: <span class=\"string\">'INCREMENT'</span>,</span><br><span class=\"line\">    step: step || <span class=\"number\">1</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ä¸ºäº†ç®€åŒ–ä»£ç æˆ‘æŠŠdispatchå‡½æ•°å®šä¹‰ä¸ºåªæœ‰æ‰“å°åŠŸèƒ½çš„å‡½æ•°</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> dispatch = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">action</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(action)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> action1 = counterIncActionCreator()</span><br><span class=\"line\">dispatch(action1) <span class=\"comment\">// &#123; type: 'INCREMENT', step: 1 &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> action2 = counterIncActionCreator(<span class=\"number\">2</span>)</span><br><span class=\"line\">dispatch(action2) <span class=\"comment\">// &#123; type: 'INCREMENT', step: 2 &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> action3 = counterIncActionCreator(<span class=\"number\">3</span>)</span><br><span class=\"line\">dispatch(action3) <span class=\"comment\">// &#123; type: 'INCREMENT', step: 3 &#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>æœ‰ç‚¹éš¾å—å…¶å®ï¼Œä½†æ˜¯æˆ‘ä»¬ç”¨äº†<code>bindActionCreator</code>ä¹‹å</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> increment = bindActionCreator(counterIncActionCreator, dispatch)</span><br><span class=\"line\"></span><br><span class=\"line\">increment() <span class=\"comment\">// &#123; type: 'INCREMENT', step: 1 &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">increment(<span class=\"number\">2</span>) <span class=\"comment\">// &#123; type: 'INCREMENT', step: 2 &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">increment(<span class=\"number\">3</span>) <span class=\"comment\">// &#123; type: 'INCREMENT', step: 3 &#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>å°±æ•´ä¸ªå¸…èµ·æ¥ï¼Œæœ‰æ²¡æœ‰ï¼Ÿï¼æ›´åŠ ä¼˜é›…äº†ã€‚</p>\n<p>è€Œä¸”æˆ‘ä»¬è¿˜å¯ä»¥åˆ¶ä½œå¢å’Œå‡çš„ä¸¤ä¸ªå·¥å‚ğŸ­</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> MyActionCreators = &#123;</span><br><span class=\"line\">  increment: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">step</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      type: <span class=\"string\">'INCREMENT'</span>,</span><br><span class=\"line\">      step: step || <span class=\"number\">1</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">  decrement: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">step</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      type: <span class=\"string\">'DECREMENT'</span>,</span><br><span class=\"line\">      step: - (step || <span class=\"number\">1</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<p>è€æ–¹æ³•</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// åŸå§‹çš„è°ƒåº¦æ–¹å¼</span></span><br><span class=\"line\">dispatch(MyActionCreators.increment()) <span class=\"comment\">// &#123; type: 'INCREMENT', step: 1 &#125;</span></span><br><span class=\"line\">dispatch(MyActionCreators.increment(<span class=\"number\">2</span>)) <span class=\"comment\">// &#123; type: 'INCREMENT', step: 2 &#125;</span></span><br><span class=\"line\">dispatch(MyActionCreators.increment(<span class=\"number\">3</span>)) <span class=\"comment\">// &#123; type: 'INCREMENT', step: 3 &#125;</span></span><br><span class=\"line\">dispatch(MyActionCreators.decrement()) <span class=\"comment\">// &#123; type: 'DECREMENT', step: -1 &#125;</span></span><br><span class=\"line\">dispatch(MyActionCreators.decrement(<span class=\"number\">2</span>)) <span class=\"comment\">// &#123; type: 'DECREMENT', step: -2 &#125;</span></span><br><span class=\"line\">dispatch(MyActionCreators.decrement(<span class=\"number\">3</span>)) <span class=\"comment\">// &#123; type: 'DECREMENT', step: -3 &#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>è¿›åŒ–ä¹‹å</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MyNewActionCreators.increment() <span class=\"comment\">// &#123; type: 'INCREMENT', step: 1 &#125;</span></span><br><span class=\"line\">MyNewActionCreators.increment(<span class=\"number\">2</span>) <span class=\"comment\">// &#123; type: 'INCREMENT', step: 2 &#125;</span></span><br><span class=\"line\">MyNewActionCreators.increment(<span class=\"number\">3</span>) <span class=\"comment\">// &#123; type: 'INCREMENT', step: 3 &#125;</span></span><br><span class=\"line\">MyNewActionCreators.decrement() <span class=\"comment\">// &#123; type: 'DECREMENT', step: -1 &#125;</span></span><br><span class=\"line\">MyNewActionCreators.decrement(<span class=\"number\">2</span>) <span class=\"comment\">// &#123; type: 'DECREMENT', step: -2 &#125;</span></span><br><span class=\"line\">MyNewActionCreators.decrement(<span class=\"number\">3</span>) <span class=\"comment\">// &#123; type: 'DECREMENT', step: -3 &#125;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"Reduxæ€»ç»“\"><a href=\"#Reduxæ€»ç»“\" class=\"headerlink\" title=\"Reduxæ€»ç»“\"></a>Reduxæ€»ç»“</h2><p>è‡³æ­¤æˆ‘ä»¬çš„reduxæºç é˜…è¯»å°±åˆ°æ­¤ä¸ºæ­¢ã€‚</p>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·å­¦ä¹ ä¸€ä¸‹å’Œreduxé…åˆä½¿ç”¨çš„react-redux</p>\n<h2 id=\"react-redux\"><a href=\"#react-redux\" class=\"headerlink\" title=\"react-redux\"></a>react-redux</h2><p>React åŸæœ¬å’Œreduxæ²¡æœ‰å…³ç³»ï¼Œreduxåªæ˜¯è´Ÿè´£æ•°æ®å¤„ç†ï¼Œç†è®ºä¸Šæ— è®ºæ˜¯vueæˆ–è€…angularéƒ½å¯ä»¥ä½¿ç”¨ã€‚</p>\n<p>ä½†æ˜¯react-reduxå°†reactå’Œreduxç´§å¯†çš„è”ç³»åœ¨äº†ä¸€èµ·ã€‚ç”¨æ›´ç¬¦åˆreactçš„æ–¹å¼æ¥è°ƒç”¨reduxã€‚</p>\n<p>åç»­ä¼šå‡ºä¸€ç¯‡ä»‹ç»react-reduxçš„æ–‡ç« ã€‚</p>\n<h1 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h1><p>è‡ªæ­¤reduxæºç é˜…è¯»ç®—æ˜¯å‘Šä¸€æ®µè½äº†ã€‚å…¶å®æºç å¾ˆç®€å•ï¼Œä½†æ˜¯æ€æƒ³å´å¾ˆé«˜çº§ã€‚</p>\n<p>å¦‚æœæœ‰ä¸æ‡‚çš„ï¼Œæˆ–è€…å“ªé‡Œè¯´é”™äº†ï¼Œå°ä¼™ä¼´æ¬¢è¿åœ¨è¯„è®ºåŒºè®¨è®ºã€‚</p>\n<h1 id=\"ç´¢å¼•\"><a href=\"#ç´¢å¼•\" class=\"headerlink\" title=\"ç´¢å¼•\"></a>ç´¢å¼•</h1><blockquote>\n<p><a href=\"https://juejin.im/post/6844903638377185288\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/6844903638377185288</a></p>\n<p><a href=\"https://www.redux.org.cn/\" target=\"_blank\" rel=\"noopener\">https://www.redux.org.cn/</a></p>\n</blockquote>\n<blockquote>\n<p>å®åœ¨æ˜¯æ²¡æœ‰åœ°æ–¹åæ§½ï¼Œæˆ‘åœ¨è¿™é‡Œè¯´ä¸€ä¸‹æœ€è¿‘çš„äº‹æƒ…å§ã€‚å…ˆæ˜¯éƒ¨é—¨é»„äº†ï¼Œç„¶åå¤§é¢†å¯¼æ¢äººäº†ï¼Œå¤§é¢†å¯¼ä¸çŸ¥é“æ˜¯ä¸æ˜¯æ–°å®˜ä¸Šä»»ä¸‰æŠŠç«ï¼Œéè¦æä»€ä¹ˆææ•ˆï¼Œå…¶å®å°±æ˜¯æŠŠäººå¼„èµ°ï¼Œç„¶ååŠ å¤§å·¥ä½œé‡ï¼Œåˆšåˆšå¼€å§‹æ¢ç»„æˆ‘å°±å»å†™å¾ˆè€çš„vueé¡¹ç›®ï¼Œæ²¡æœ‰é„™è§†vueçš„æ„æ€ï¼Œæ˜¯å› ä¸ºæˆ‘ä¹‹å‰éƒ½åœ¨å†™reactï¼Œç„¶åä¸€ä¸‹è®©æˆ‘å†™ï¼Œä¹Ÿä¸å¤ªé€‚åº”è€Œå·²ï¼Œè¿˜æ˜¯å¾ˆå°‘çš„ç‰ˆæœ¬ã€‚é‚£å°±å†™å°±å†™å§ï¼Œåæ­£åšå‰ç«¯çš„éƒ½å¾—å­¦ä¸æ˜¯ï¼Ÿå¯æ˜¯ï¼Œå¤§é¢†å¯¼ä¸ºäº†ç»™åšç»™è€æ¿çœ‹ï¼Œç„¶åè®©æˆ‘ä»¬ä¸‹ç­ä¸è¦èµ°ï¼Œå°±æ˜¯æ²¡æœ‰äº‹æƒ…åšå°±å¹²åç€çš„é‚£ç§ã€‚æœ¬ç€90åçš„æ€§å­æˆ‘å°±èµ°äº†ï¼Œç„¶åæˆ‘èµ°äº†ä¹‹åï¼Œæœ‰äº›å°ä¼™ä¼´å¯èƒ½ä¹Ÿå¼€å§‹èµ°äº†ï¼Œç„¶åæˆ‘å°±è¢«æŠ“å»åŠé€€äº†â€¦.æˆ‘ä¹Ÿæ²¡æœ‰æ­»çš®èµ–è„¸çš„èµ–ç€ã€‚å€Ÿå£ä¹Ÿéå¸¸çš„å¥‡è‘©â€ä½ æ´»åœ¨è‡ªå·±çš„ä¸–ç•Œé‡Œé¢ï¼Œæ²¡æœ‰å…³å¿ƒå‘¨å›´åŒäº‹å¿™ä¸å¿™ï¼Œæ”¹bugä¸ç§¯æï¼Œä»£ç è´¨é‡ä½â€ä¹‹ç±»çš„ã€‚ã€‚ã€‚å¯æ˜¯æˆ‘åªæ˜¯å·¥ä½œçš„æ—¶å€™æˆ´ç€è€Œå·²ï¼Œå› ä¸ºç»å¸¸æœ‰äº§å“ä¸Šæ¥å°±åœ¨æ—è¾¹å¼€å§‹è®¨è®ºäº†ï¼Œç„¶åæˆ‘è‡ªå·±çš„å·¥ä½œéƒ½åšä¸å®Œï¼Œæ€ä¹ˆå…³å¿ƒåŒäº‹å•Šã€‚ã€‚å¼ºè¡ŒåŠ äº†å·¥ä½œé‡ä¹‹åæˆ‘éƒ½å¾ˆæ™šèµ°æˆ–è€…å›å®¶å·¥ä½œäº†ã€‚å› ä¸ºåœ¨å…¬å¸èµ–ç€çœŸçš„å¾ˆéš¾å—ï¼Œä¸ºä»€ä¹ˆä¸åœ¨è‡ªå·±èˆ’é€‚çš„å®¶ä¸­å·¥ä½œå‘¢ï¼Ÿè¿˜å¯ä»¥é©¬ä¸Šç¡è§‰é‚£ç§ï¼ŒéŸ³ä¹è¿˜å¯ä»¥å¤–æ”¾ã€‚ã€‚ã€‚å†è¯´äº†æˆ‘ä¹‹å‰çš„ä»£ç ï¼Œå› ä¸ºé¡¹ç›®é»„äº†ï¼Œåº”è¯¥æ²¡äººçœ‹äº†å§â€¦.å”‰ï¼Œå…¶å®å°±æ˜¯ åŠé€€ã€‚æˆ‘éƒ½æ‡‚ã€‚</p>\n<p>ä½†æ˜¯æˆ‘çš„ç®€å†å…¶å®å˜å¾—æå…¶ä¸‘é™‹äº†ï¼Œå› ä¸ºæˆ‘å¹´åˆçš„æ‰è·³æ§½è¿‡æ¥çš„ã€‚ç°åœ¨è¿™ä¸ªæ—¶é—´éå¸¸å°´å°¬â€¦.è€Œä¸”æˆ‘æ¥çš„ç¬¬ä¸€å¤©å¬è¯´è¦996ï¼Œé©¬ä¸Šæäº†ç¦»èŒç”³è¯·ï¼Œæˆ‘çš„é¢†å¯¼åŒæ„äº†ï¼Œå¯ä»¥ä¹‹å‰çš„å¤§é¢†å¯¼å’Œæˆ‘è¯´ä»¥åä¸ä¼š996äº†å°±æ˜¯æ­£å¸¸ä¸Šä¸‹ç­ã€‚ã€‚ç„¶åä»–å°±è·³æ§½äº†ã€‚ã€‚ã€‚</p>\n<p>ç®—æ˜¯è‡ªå·±ä¸è®¤çœŸå®¡æŸ¥å…¬å¸ï¼Œä¸è¿‡ä»–ä»¬ä¹Ÿå¤ªéª—äººäº†å§â€¦å”‰ã€‚</p>\n<p>ç°åœ¨åœ¨å®¶é‡Œä¹Ÿå¾ˆç„¦è™‘ï¼Œä¸çŸ¥é“æ‰¾ä¸æ‰¾å¾—åˆ°å·¥ä½œï¼Œæ­å·çš„å…¬å¸çœ‹äº†ä¸€åœˆéƒ½æ˜¯996ï¼Œå­¦é˜¿é‡Œçš„åŠ ç­ä¸å­¦é˜¿é‡Œçš„å·¥èµ„ã€‚ã€‚ã€‚</p>\n<p>å›½åº†ä»¥åå†è¯´å§ï¼Œå¸Œæœ›æ—©ç‚¹æŠŠé‡è¯†å‰ç«¯ç³»åˆ—æ›´å®Œã€‚</p>\n</blockquote>\n"},{"title":"ã€é‡è¯†å‰ç«¯ã€‘Reactæºç é˜…è¯»ï¼ˆå››ï¼‰","date":"2021-06-30T06:08:31.000Z","cover":"/image/cover/react.png","_content":"\n# å‰è¨€\n\næˆ‘å°†Fiberæ‹†åˆ†æˆå››å—æ¥è®²\n\n- åŠ¨æœºï¼ˆæˆ–è€…è¯´åˆè¡·\n- åˆå§‹åŒ–-Fiberæ ‘çš„å‡†å¤‡å·¥ä½œ\n- render-Fiberæ ‘çš„æ„å»º\n- commit-Fiberæ ‘æ˜ å°„åˆ°DOM\n\nrender-Fiberæ ‘çš„æ„å»º\n\nFiberæ ‘çš„æ„å»ºã€‚Actionï¼\n\n## ä¸€äº›åºŸè¯ï¼Œå¯ä»¥è·³è¿‡\n\nè·ç¦»ä¸Šä¸€ç¯‡æ–‡ç« ä¹Ÿæœ‰2ä¸ªå¤šæœˆçš„æ—¶é—´äº†ã€‚ï¼ˆç¡®å®æ¬ç –æ¯”è¾ƒå¿™æ²¡ç©ºï¼‰ç°åœ¨å›å¤´çœ‹ï¼Œç¡®å®ä¸€è„¸æ‡µé€¼ã€‚ä½†æ˜¯æœ‰äº›åŸç†ç¡®å®æ˜¯åˆ»åœ¨è„‘å­é‡Œçš„ï¼Œé‡æ–°æ¡èµ·æ¥ä¹Ÿå¾ˆå¿«ã€‚\n\n# å‰æ™¯å›é¡¾\n\næˆ‘ä»¬çŸ¥é“ä¸€ä¸ªæœ€æ™®é€šçš„Reactä»£ç æ˜¯è¿™æ ·çš„ï¼š\n\n```jsx\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\n\nclass App extends React.Component {\n  render() {\n    const text = \"å“ˆå“ˆå“ˆ\"\n    return (\n      <div>\n        <p>{text}</p>\n      </div>\n    );\n  }\n}\n\nconst rootElement = document.getElementById(\"root\");\nReactDOM.render(<App />, rootElement);\n```\n\nç„¶åæˆ‘ä»¬é˜…è¯»äº†ReactDOM.renderçš„æºç ã€‚çŸ¥é“äº†renderå†…éƒ¨å…¶å®æ˜¯è°ƒç”¨`legacyRenderSubtreeIntoContainer`è¿™é‡Œé¢å…¶å®æ˜¯åœ¨åšä¸ºFiberæ ‘åšåˆå§‹åŒ–ã€‚\n\nç„¶åæˆ‘ä»¬`updateContainer`çš„æœ€åä¸¤ä¸ªå‡½æ•°è¿˜æ²¡æœ‰è§£è¯»ï¼Œç»§ç»­çœ‹ã€‚\n\n## updateContainer\n\n```typescript\nfunction updateContainer(element, container, parentComponent, callback) {\n  ......\n\n  // è¿™æ˜¯ä¸€ä¸ª event ç›¸å…³çš„å…¥å‚ï¼Œæ­¤å¤„ä¸å¿…å…³æ³¨\n  var eventTime = requestEventTime();\n\n  ......\n\n  // è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå…³é”®çš„å…¥å‚ï¼Œlane è¡¨ç¤ºä¼˜å…ˆçº§\n  var lane = requestUpdateLane(current);\n  // ç»“åˆ laneï¼ˆä¼˜å…ˆçº§ï¼‰ä¿¡æ¯ï¼Œåˆ›å»º update å¯¹è±¡ï¼Œä¸€ä¸ª update å¯¹è±¡æ„å‘³ç€ä¸€ä¸ªæ›´æ–°\n  var update = createUpdate(eventTime, lane); \n\n  // update çš„ payload å¯¹åº”çš„æ˜¯ä¸€ä¸ª React å…ƒç´ \n  update.payload = {\n    element: element\n  };\n\n  // å¤„ç† callbackï¼Œè¿™ä¸ª callback å…¶å®å°±æ˜¯æˆ‘ä»¬è°ƒç”¨ ReactDOM.render æ—¶ä¼ å…¥çš„ callback\n  callback = callback === undefined ? null : callback;\n  if (callback !== null) {\n    {\n      if (typeof callback !== 'function') {\n        error('render(...): Expected the last optional `callback` argument to be a ' + 'function. Instead received: %s.', callback);\n      }\n    }\n    update.callback = callback;\n  }\n\n  // å°† update å…¥é˜Ÿ\n  enqueueUpdate(current, update, lane);\n  // è°ƒåº¦ fiberRoot \n  scheduleUpdateOnFiber(current, lane, eventTime);\n  // è¿”å›å½“å‰èŠ‚ç‚¹ï¼ˆfiberRootï¼‰çš„ä¼˜å…ˆçº§\n  return lane;\n}\n```\n\n# æºç æ”»è¯»\n\nè¿˜å‰©ä¸‹ä¸¤ä¸ªå‡½æ•°`enqueueUpdate`å’Œ`scheduleUpdateOnFiber`\n\nè¿™ä¸¤ä¸ªå…„å¼Ÿå¼„å®Œä¸çŸ¥é“åé¢è¿˜å‰©ä¸‹ä»€ä¹ˆï¼Œä¸€èµ·çœ‹çœ‹å§ã€‚\n\nè¿™é‡Œå…ˆè¡¥å……ä¸€ä¸‹ï¼Œ`initializeUpdateQueue`å†…éƒ¨çš„ä¸œè¥¿ï¼Œå› ä¸ºä¹Ÿæœ‰ä¼šç”¨äº†ï¼Œè‚¯å®šä¼šæœ‰ç–‘é—®ã€‚\n\n```typescript\nexport function initializeUpdateQueue<State>(fiber: Fiber): void {\n  const queue: UpdateQueue<State> = {\n    baseState: fiber.memoizedState,\n    firstBaseUpdate: null,\n    lastBaseUpdate: null,\n    shared: {\n      pending: null,\n      interleaved: null,\n      lanes: NoLanes,\n    },\n    effects: null,\n  };\n  fiber.updateQueue = queue;\n}\n```\n\n\n\n## enqueueUpdate\n\n```tsx\nexport function enqueueUpdate<State>(\n  fiber: Fiber,\n  update: Update<State>,\n  lane: Lane,\n) {\n  const updateQueue = fiber.updateQueue;\n  if (updateQueue === null) {\n    // åªåœ¨fiber å¸è½½çš„æ—¶å€™ä¼šå‘ç”Ÿ\n    // Only occurs if the fiber has been unmounted.\n    return;\n  }\n\n  const sharedQueue: SharedQueue<State> = (updateQueue: any).shared;\n  // æ¯”è¾ƒfiber laneå’Œlaneï¼Œç›¸åŒæ—¶æ›´æ–°ï¼Œå…·ä½“å†…å®¹å¯ä»¥çœ‹ä¸‹é¢çš„æºç ã€‚è¿™é‡Œä¸åŠ è®¨è®º\n  // renderåˆå§‹åŒ–æ—¶ä¸æ‰§è¡Œ\n  if (isInterleavedUpdate(fiber, lane)) {\n    const interleaved = sharedQueue.interleaved;\n    if (interleaved === null) {\n      // This is the first update. Create a circular list.\n      update.next = update;\n      // At the end of the current render, this queue's interleaved updates will\n      // be transfered to the pending queue.\n      pushInterleavedQueue(sharedQueue);\n    } else {\n      update.next = interleaved.next;\n      interleaved.next = update;\n    }\n    sharedQueue.interleaved = update;\n  } else {\n    const pending = sharedQueue.pending;\n    if (pending === null) {\n      // This is the first update. Create a circular list.\n      update.next = update;\n    } else {\n      update.next = pending.next;\n      pending.next = update;\n    }\n    sharedQueue.pending = update;\n  }\n\t// å¼€å‘æ¨¡å¼\n  if (__DEV__) {\n    if (\n      currentlyProcessingQueue === sharedQueue &&\n      !didWarnUpdateInsideUpdate\n    ) {\n      console.error(\n        'An update (setState, replaceState, or forceUpdate) was scheduled ' +\n          'from inside an update function. Update functions should be pure, ' +\n          'with zero side-effects. Consider using componentDidUpdate or a ' +\n          'callback.',\n      );\n      didWarnUpdateInsideUpdate = true;\n    }\n  }\n}\n```\n\n\n\n### isInterleavedUpdate\n\n```typescript\nexport function isInterleavedUpdate(fiber: Fiber, lane: Lane) {\n  return (\n    // TODO: Optimize slightly by comparing to root that fiber belongs to.\n    // Requires some refactoring. Not a big deal though since it's rare for\n    // concurrent apps to have more than a single root.\n    workInProgressRoot !== null &&\n    (fiber.mode & ConcurrentMode) !== NoMode &&\n    // If this is a render phase update (i.e. UNSAFE_componentWillReceiveProps),\n    // then don't treat this as an interleaved update. This pattern is\n    // accompanied by a warning but we haven't fully deprecated it yet. We can\n    // remove once the deferRenderPhaseUpdateToNextBatch flag is enabled.\n    (deferRenderPhaseUpdateToNextBatch ||\n      (executionContext & RenderContext) === NoContext)\n  );\n}\n```\n\nä¸Šé¢æåˆ°çš„ã€‚å‡½æ•°çš„å¤§æ¦‚æ˜¯åˆ¤æ–­æ˜¯å¦æ˜¯äº¤é”™æ›´æ–°ã€‚\n\n","source":"_posts/ã€é‡è¯†å‰ç«¯ã€‘Reactæºç é˜…è¯»ï¼ˆå››ï¼‰.md","raw":"---\ntitle: ã€é‡è¯†å‰ç«¯ã€‘Reactæºç é˜…è¯»ï¼ˆå››ï¼‰\ndate: 2021-06-30 14:08:31\ntags: [react]\ncategory: [é‡æ‹¾å‰ç«¯]\ncover: /image/cover/react.png\n---\n\n# å‰è¨€\n\næˆ‘å°†Fiberæ‹†åˆ†æˆå››å—æ¥è®²\n\n- åŠ¨æœºï¼ˆæˆ–è€…è¯´åˆè¡·\n- åˆå§‹åŒ–-Fiberæ ‘çš„å‡†å¤‡å·¥ä½œ\n- render-Fiberæ ‘çš„æ„å»º\n- commit-Fiberæ ‘æ˜ å°„åˆ°DOM\n\nrender-Fiberæ ‘çš„æ„å»º\n\nFiberæ ‘çš„æ„å»ºã€‚Actionï¼\n\n## ä¸€äº›åºŸè¯ï¼Œå¯ä»¥è·³è¿‡\n\nè·ç¦»ä¸Šä¸€ç¯‡æ–‡ç« ä¹Ÿæœ‰2ä¸ªå¤šæœˆçš„æ—¶é—´äº†ã€‚ï¼ˆç¡®å®æ¬ç –æ¯”è¾ƒå¿™æ²¡ç©ºï¼‰ç°åœ¨å›å¤´çœ‹ï¼Œç¡®å®ä¸€è„¸æ‡µé€¼ã€‚ä½†æ˜¯æœ‰äº›åŸç†ç¡®å®æ˜¯åˆ»åœ¨è„‘å­é‡Œçš„ï¼Œé‡æ–°æ¡èµ·æ¥ä¹Ÿå¾ˆå¿«ã€‚\n\n# å‰æ™¯å›é¡¾\n\næˆ‘ä»¬çŸ¥é“ä¸€ä¸ªæœ€æ™®é€šçš„Reactä»£ç æ˜¯è¿™æ ·çš„ï¼š\n\n```jsx\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\n\nclass App extends React.Component {\n  render() {\n    const text = \"å“ˆå“ˆå“ˆ\"\n    return (\n      <div>\n        <p>{text}</p>\n      </div>\n    );\n  }\n}\n\nconst rootElement = document.getElementById(\"root\");\nReactDOM.render(<App />, rootElement);\n```\n\nç„¶åæˆ‘ä»¬é˜…è¯»äº†ReactDOM.renderçš„æºç ã€‚çŸ¥é“äº†renderå†…éƒ¨å…¶å®æ˜¯è°ƒç”¨`legacyRenderSubtreeIntoContainer`è¿™é‡Œé¢å…¶å®æ˜¯åœ¨åšä¸ºFiberæ ‘åšåˆå§‹åŒ–ã€‚\n\nç„¶åæˆ‘ä»¬`updateContainer`çš„æœ€åä¸¤ä¸ªå‡½æ•°è¿˜æ²¡æœ‰è§£è¯»ï¼Œç»§ç»­çœ‹ã€‚\n\n## updateContainer\n\n```typescript\nfunction updateContainer(element, container, parentComponent, callback) {\n  ......\n\n  // è¿™æ˜¯ä¸€ä¸ª event ç›¸å…³çš„å…¥å‚ï¼Œæ­¤å¤„ä¸å¿…å…³æ³¨\n  var eventTime = requestEventTime();\n\n  ......\n\n  // è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå…³é”®çš„å…¥å‚ï¼Œlane è¡¨ç¤ºä¼˜å…ˆçº§\n  var lane = requestUpdateLane(current);\n  // ç»“åˆ laneï¼ˆä¼˜å…ˆçº§ï¼‰ä¿¡æ¯ï¼Œåˆ›å»º update å¯¹è±¡ï¼Œä¸€ä¸ª update å¯¹è±¡æ„å‘³ç€ä¸€ä¸ªæ›´æ–°\n  var update = createUpdate(eventTime, lane); \n\n  // update çš„ payload å¯¹åº”çš„æ˜¯ä¸€ä¸ª React å…ƒç´ \n  update.payload = {\n    element: element\n  };\n\n  // å¤„ç† callbackï¼Œè¿™ä¸ª callback å…¶å®å°±æ˜¯æˆ‘ä»¬è°ƒç”¨ ReactDOM.render æ—¶ä¼ å…¥çš„ callback\n  callback = callback === undefined ? null : callback;\n  if (callback !== null) {\n    {\n      if (typeof callback !== 'function') {\n        error('render(...): Expected the last optional `callback` argument to be a ' + 'function. Instead received: %s.', callback);\n      }\n    }\n    update.callback = callback;\n  }\n\n  // å°† update å…¥é˜Ÿ\n  enqueueUpdate(current, update, lane);\n  // è°ƒåº¦ fiberRoot \n  scheduleUpdateOnFiber(current, lane, eventTime);\n  // è¿”å›å½“å‰èŠ‚ç‚¹ï¼ˆfiberRootï¼‰çš„ä¼˜å…ˆçº§\n  return lane;\n}\n```\n\n# æºç æ”»è¯»\n\nè¿˜å‰©ä¸‹ä¸¤ä¸ªå‡½æ•°`enqueueUpdate`å’Œ`scheduleUpdateOnFiber`\n\nè¿™ä¸¤ä¸ªå…„å¼Ÿå¼„å®Œä¸çŸ¥é“åé¢è¿˜å‰©ä¸‹ä»€ä¹ˆï¼Œä¸€èµ·çœ‹çœ‹å§ã€‚\n\nè¿™é‡Œå…ˆè¡¥å……ä¸€ä¸‹ï¼Œ`initializeUpdateQueue`å†…éƒ¨çš„ä¸œè¥¿ï¼Œå› ä¸ºä¹Ÿæœ‰ä¼šç”¨äº†ï¼Œè‚¯å®šä¼šæœ‰ç–‘é—®ã€‚\n\n```typescript\nexport function initializeUpdateQueue<State>(fiber: Fiber): void {\n  const queue: UpdateQueue<State> = {\n    baseState: fiber.memoizedState,\n    firstBaseUpdate: null,\n    lastBaseUpdate: null,\n    shared: {\n      pending: null,\n      interleaved: null,\n      lanes: NoLanes,\n    },\n    effects: null,\n  };\n  fiber.updateQueue = queue;\n}\n```\n\n\n\n## enqueueUpdate\n\n```tsx\nexport function enqueueUpdate<State>(\n  fiber: Fiber,\n  update: Update<State>,\n  lane: Lane,\n) {\n  const updateQueue = fiber.updateQueue;\n  if (updateQueue === null) {\n    // åªåœ¨fiber å¸è½½çš„æ—¶å€™ä¼šå‘ç”Ÿ\n    // Only occurs if the fiber has been unmounted.\n    return;\n  }\n\n  const sharedQueue: SharedQueue<State> = (updateQueue: any).shared;\n  // æ¯”è¾ƒfiber laneå’Œlaneï¼Œç›¸åŒæ—¶æ›´æ–°ï¼Œå…·ä½“å†…å®¹å¯ä»¥çœ‹ä¸‹é¢çš„æºç ã€‚è¿™é‡Œä¸åŠ è®¨è®º\n  // renderåˆå§‹åŒ–æ—¶ä¸æ‰§è¡Œ\n  if (isInterleavedUpdate(fiber, lane)) {\n    const interleaved = sharedQueue.interleaved;\n    if (interleaved === null) {\n      // This is the first update. Create a circular list.\n      update.next = update;\n      // At the end of the current render, this queue's interleaved updates will\n      // be transfered to the pending queue.\n      pushInterleavedQueue(sharedQueue);\n    } else {\n      update.next = interleaved.next;\n      interleaved.next = update;\n    }\n    sharedQueue.interleaved = update;\n  } else {\n    const pending = sharedQueue.pending;\n    if (pending === null) {\n      // This is the first update. Create a circular list.\n      update.next = update;\n    } else {\n      update.next = pending.next;\n      pending.next = update;\n    }\n    sharedQueue.pending = update;\n  }\n\t// å¼€å‘æ¨¡å¼\n  if (__DEV__) {\n    if (\n      currentlyProcessingQueue === sharedQueue &&\n      !didWarnUpdateInsideUpdate\n    ) {\n      console.error(\n        'An update (setState, replaceState, or forceUpdate) was scheduled ' +\n          'from inside an update function. Update functions should be pure, ' +\n          'with zero side-effects. Consider using componentDidUpdate or a ' +\n          'callback.',\n      );\n      didWarnUpdateInsideUpdate = true;\n    }\n  }\n}\n```\n\n\n\n### isInterleavedUpdate\n\n```typescript\nexport function isInterleavedUpdate(fiber: Fiber, lane: Lane) {\n  return (\n    // TODO: Optimize slightly by comparing to root that fiber belongs to.\n    // Requires some refactoring. Not a big deal though since it's rare for\n    // concurrent apps to have more than a single root.\n    workInProgressRoot !== null &&\n    (fiber.mode & ConcurrentMode) !== NoMode &&\n    // If this is a render phase update (i.e. UNSAFE_componentWillReceiveProps),\n    // then don't treat this as an interleaved update. This pattern is\n    // accompanied by a warning but we haven't fully deprecated it yet. We can\n    // remove once the deferRenderPhaseUpdateToNextBatch flag is enabled.\n    (deferRenderPhaseUpdateToNextBatch ||\n      (executionContext & RenderContext) === NoContext)\n  );\n}\n```\n\nä¸Šé¢æåˆ°çš„ã€‚å‡½æ•°çš„å¤§æ¦‚æ˜¯åˆ¤æ–­æ˜¯å¦æ˜¯äº¤é”™æ›´æ–°ã€‚\n\n","slug":"ã€é‡è¯†å‰ç«¯ã€‘Reactæºç é˜…è¯»ï¼ˆå››ï¼‰","published":1,"updated":"2021-06-24T14:00:06.851Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra8h001klwrdbmdu5adq","content":"<h1 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h1><p>æˆ‘å°†Fiberæ‹†åˆ†æˆå››å—æ¥è®²</p>\n<ul>\n<li>åŠ¨æœºï¼ˆæˆ–è€…è¯´åˆè¡·</li>\n<li>åˆå§‹åŒ–-Fiberæ ‘çš„å‡†å¤‡å·¥ä½œ</li>\n<li>render-Fiberæ ‘çš„æ„å»º</li>\n<li>commit-Fiberæ ‘æ˜ å°„åˆ°DOM</li>\n</ul>\n<p>render-Fiberæ ‘çš„æ„å»º</p>\n<p>Fiberæ ‘çš„æ„å»ºã€‚Actionï¼</p>\n<h2 id=\"ä¸€äº›åºŸè¯ï¼Œå¯ä»¥è·³è¿‡\"><a href=\"#ä¸€äº›åºŸè¯ï¼Œå¯ä»¥è·³è¿‡\" class=\"headerlink\" title=\"ä¸€äº›åºŸè¯ï¼Œå¯ä»¥è·³è¿‡\"></a>ä¸€äº›åºŸè¯ï¼Œå¯ä»¥è·³è¿‡</h2><p>è·ç¦»ä¸Šä¸€ç¯‡æ–‡ç« ä¹Ÿæœ‰2ä¸ªå¤šæœˆçš„æ—¶é—´äº†ã€‚ï¼ˆç¡®å®æ¬ç –æ¯”è¾ƒå¿™æ²¡ç©ºï¼‰ç°åœ¨å›å¤´çœ‹ï¼Œç¡®å®ä¸€è„¸æ‡µé€¼ã€‚ä½†æ˜¯æœ‰äº›åŸç†ç¡®å®æ˜¯åˆ»åœ¨è„‘å­é‡Œçš„ï¼Œé‡æ–°æ¡èµ·æ¥ä¹Ÿå¾ˆå¿«ã€‚</p>\n<h1 id=\"å‰æ™¯å›é¡¾\"><a href=\"#å‰æ™¯å›é¡¾\" class=\"headerlink\" title=\"å‰æ™¯å›é¡¾\"></a>å‰æ™¯å›é¡¾</h1><p>æˆ‘ä»¬çŸ¥é“ä¸€ä¸ªæœ€æ™®é€šçš„Reactä»£ç æ˜¯è¿™æ ·çš„ï¼š</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">\"react\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> ReactDOM <span class=\"keyword\">from</span> <span class=\"string\">\"react-dom\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">App</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> text = <span class=\"string\">\"å“ˆå“ˆå“ˆ\"</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;div&gt;</span><br><span class=\"line\">        &lt;p&gt;&#123;text&#125;&lt;<span class=\"regexp\">/p&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;/</span>div&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> rootElement = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"root\"</span>);</span><br><span class=\"line\">ReactDOM.render(<span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">App</span> /&gt;</span></span>, rootElement);</span><br></pre></td></tr></table></figure>\n\n<p>ç„¶åæˆ‘ä»¬é˜…è¯»äº†ReactDOM.renderçš„æºç ã€‚çŸ¥é“äº†renderå†…éƒ¨å…¶å®æ˜¯è°ƒç”¨<code>legacyRenderSubtreeIntoContainer</code>è¿™é‡Œé¢å…¶å®æ˜¯åœ¨åšä¸ºFiberæ ‘åšåˆå§‹åŒ–ã€‚</p>\n<p>ç„¶åæˆ‘ä»¬<code>updateContainer</code>çš„æœ€åä¸¤ä¸ªå‡½æ•°è¿˜æ²¡æœ‰è§£è¯»ï¼Œç»§ç»­çœ‹ã€‚</p>\n<h2 id=\"updateContainer\"><a href=\"#updateContainer\" class=\"headerlink\" title=\"updateContainer\"></a>updateContainer</h2><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">updateContainer</span>(<span class=\"params\">element, container, parentComponent, callback</span>) </span>&#123;</span><br><span class=\"line\">  ......</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// è¿™æ˜¯ä¸€ä¸ª event ç›¸å…³çš„å…¥å‚ï¼Œæ­¤å¤„ä¸å¿…å…³æ³¨</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> eventTime = requestEventTime();</span><br><span class=\"line\"></span><br><span class=\"line\">  ......</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå…³é”®çš„å…¥å‚ï¼Œlane è¡¨ç¤ºä¼˜å…ˆçº§</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> lane = requestUpdateLane(current);</span><br><span class=\"line\">  <span class=\"comment\">// ç»“åˆ laneï¼ˆä¼˜å…ˆçº§ï¼‰ä¿¡æ¯ï¼Œåˆ›å»º update å¯¹è±¡ï¼Œä¸€ä¸ª update å¯¹è±¡æ„å‘³ç€ä¸€ä¸ªæ›´æ–°</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> update = createUpdate(eventTime, lane); </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// update çš„ payload å¯¹åº”çš„æ˜¯ä¸€ä¸ª React å…ƒç´ </span></span><br><span class=\"line\">  update.payload = &#123;</span><br><span class=\"line\">    element: element</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// å¤„ç† callbackï¼Œè¿™ä¸ª callback å…¶å®å°±æ˜¯æˆ‘ä»¬è°ƒç”¨ ReactDOM.render æ—¶ä¼ å…¥çš„ callback</span></span><br><span class=\"line\">  callback = callback === <span class=\"literal\">undefined</span> ? <span class=\"literal\">null</span> : callback;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (callback !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> callback !== <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">        error(<span class=\"string\">'render(...): Expected the last optional `callback` argument to be a '</span> + <span class=\"string\">'function. Instead received: %s.'</span>, callback);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    update.callback = callback;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// å°† update å…¥é˜Ÿ</span></span><br><span class=\"line\">  enqueueUpdate(current, update, lane);</span><br><span class=\"line\">  <span class=\"comment\">// è°ƒåº¦ fiberRoot </span></span><br><span class=\"line\">  scheduleUpdateOnFiber(current, lane, eventTime);</span><br><span class=\"line\">  <span class=\"comment\">// è¿”å›å½“å‰èŠ‚ç‚¹ï¼ˆfiberRootï¼‰çš„ä¼˜å…ˆçº§</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> lane;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"æºç æ”»è¯»\"><a href=\"#æºç æ”»è¯»\" class=\"headerlink\" title=\"æºç æ”»è¯»\"></a>æºç æ”»è¯»</h1><p>è¿˜å‰©ä¸‹ä¸¤ä¸ªå‡½æ•°<code>enqueueUpdate</code>å’Œ<code>scheduleUpdateOnFiber</code></p>\n<p>è¿™ä¸¤ä¸ªå…„å¼Ÿå¼„å®Œä¸çŸ¥é“åé¢è¿˜å‰©ä¸‹ä»€ä¹ˆï¼Œä¸€èµ·çœ‹çœ‹å§ã€‚</p>\n<p>è¿™é‡Œå…ˆè¡¥å……ä¸€ä¸‹ï¼Œ<code>initializeUpdateQueue</code>å†…éƒ¨çš„ä¸œè¥¿ï¼Œå› ä¸ºä¹Ÿæœ‰ä¼šç”¨äº†ï¼Œè‚¯å®šä¼šæœ‰ç–‘é—®ã€‚</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">initializeUpdateQueue</span>&lt;<span class=\"title\">State</span>&gt;(<span class=\"params\">fiber: Fiber</span>): <span class=\"title\">void</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> queue: UpdateQueue&lt;State&gt; = &#123;</span><br><span class=\"line\">    baseState: fiber.memoizedState,</span><br><span class=\"line\">    firstBaseUpdate: <span class=\"literal\">null</span>,</span><br><span class=\"line\">    lastBaseUpdate: <span class=\"literal\">null</span>,</span><br><span class=\"line\">    shared: &#123;</span><br><span class=\"line\">      pending: <span class=\"literal\">null</span>,</span><br><span class=\"line\">      interleaved: <span class=\"literal\">null</span>,</span><br><span class=\"line\">      lanes: NoLanes,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    effects: <span class=\"literal\">null</span>,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  fiber.updateQueue = queue;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"enqueueUpdate\"><a href=\"#enqueueUpdate\" class=\"headerlink\" title=\"enqueueUpdate\"></a>enqueueUpdate</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export function enqueueUpdate&lt;State&gt;(</span><br><span class=\"line\">  fiber: Fiber,</span><br><span class=\"line\">  update: Update&lt;State&gt;,</span><br><span class=\"line\">  lane: Lane,</span><br><span class=\"line\">) &#123;</span><br><span class=\"line\">  const updateQueue &#x3D; fiber.updateQueue;</span><br><span class=\"line\">  if (updateQueue &#x3D;&#x3D;&#x3D; null) &#123;</span><br><span class=\"line\">    &#x2F;&#x2F; åªåœ¨fiber å¸è½½çš„æ—¶å€™ä¼šå‘ç”Ÿ</span><br><span class=\"line\">    &#x2F;&#x2F; Only occurs if the fiber has been unmounted.</span><br><span class=\"line\">    return;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  const sharedQueue: SharedQueue&lt;State&gt; &#x3D; (updateQueue: any).shared;</span><br><span class=\"line\">  &#x2F;&#x2F; æ¯”è¾ƒfiber laneå’Œlaneï¼Œç›¸åŒæ—¶æ›´æ–°ï¼Œå…·ä½“å†…å®¹å¯ä»¥çœ‹ä¸‹é¢çš„æºç ã€‚è¿™é‡Œä¸åŠ è®¨è®º</span><br><span class=\"line\">  &#x2F;&#x2F; renderåˆå§‹åŒ–æ—¶ä¸æ‰§è¡Œ</span><br><span class=\"line\">  if (isInterleavedUpdate(fiber, lane)) &#123;</span><br><span class=\"line\">    const interleaved &#x3D; sharedQueue.interleaved;</span><br><span class=\"line\">    if (interleaved &#x3D;&#x3D;&#x3D; null) &#123;</span><br><span class=\"line\">      &#x2F;&#x2F; This is the first update. Create a circular list.</span><br><span class=\"line\">      update.next &#x3D; update;</span><br><span class=\"line\">      &#x2F;&#x2F; At the end of the current render, this queue&#39;s interleaved updates will</span><br><span class=\"line\">      &#x2F;&#x2F; be transfered to the pending queue.</span><br><span class=\"line\">      pushInterleavedQueue(sharedQueue);</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">      update.next &#x3D; interleaved.next;</span><br><span class=\"line\">      interleaved.next &#x3D; update;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    sharedQueue.interleaved &#x3D; update;</span><br><span class=\"line\">  &#125; else &#123;</span><br><span class=\"line\">    const pending &#x3D; sharedQueue.pending;</span><br><span class=\"line\">    if (pending &#x3D;&#x3D;&#x3D; null) &#123;</span><br><span class=\"line\">      &#x2F;&#x2F; This is the first update. Create a circular list.</span><br><span class=\"line\">      update.next &#x3D; update;</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">      update.next &#x3D; pending.next;</span><br><span class=\"line\">      pending.next &#x3D; update;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    sharedQueue.pending &#x3D; update;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">\t&#x2F;&#x2F; å¼€å‘æ¨¡å¼</span><br><span class=\"line\">  if (__DEV__) &#123;</span><br><span class=\"line\">    if (</span><br><span class=\"line\">      currentlyProcessingQueue &#x3D;&#x3D;&#x3D; sharedQueue &amp;&amp;</span><br><span class=\"line\">      !didWarnUpdateInsideUpdate</span><br><span class=\"line\">    ) &#123;</span><br><span class=\"line\">      console.error(</span><br><span class=\"line\">        &#39;An update (setState, replaceState, or forceUpdate) was scheduled &#39; +</span><br><span class=\"line\">          &#39;from inside an update function. Update functions should be pure, &#39; +</span><br><span class=\"line\">          &#39;with zero side-effects. Consider using componentDidUpdate or a &#39; +</span><br><span class=\"line\">          &#39;callback.&#39;,</span><br><span class=\"line\">      );</span><br><span class=\"line\">      didWarnUpdateInsideUpdate &#x3D; true;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"isInterleavedUpdate\"><a href=\"#isInterleavedUpdate\" class=\"headerlink\" title=\"isInterleavedUpdate\"></a>isInterleavedUpdate</h3><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isInterleavedUpdate</span>(<span class=\"params\">fiber: Fiber, lane: Lane</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">TODO:</span> Optimize slightly by comparing to root that fiber belongs to.</span></span><br><span class=\"line\">    <span class=\"comment\">// Requires some refactoring. Not a big deal though since it's rare for</span></span><br><span class=\"line\">    <span class=\"comment\">// concurrent apps to have more than a single root.</span></span><br><span class=\"line\">    workInProgressRoot !== <span class=\"literal\">null</span> &amp;&amp;</span><br><span class=\"line\">    (fiber.mode &amp; ConcurrentMode) !== NoMode &amp;&amp;</span><br><span class=\"line\">    <span class=\"comment\">// If this is a render phase update (i.e. UNSAFE_componentWillReceiveProps),</span></span><br><span class=\"line\">    <span class=\"comment\">// then don't treat this as an interleaved update. This pattern is</span></span><br><span class=\"line\">    <span class=\"comment\">// accompanied by a warning but we haven't fully deprecated it yet. We can</span></span><br><span class=\"line\">    <span class=\"comment\">// remove once the deferRenderPhaseUpdateToNextBatch flag is enabled.</span></span><br><span class=\"line\">    (deferRenderPhaseUpdateToNextBatch ||</span><br><span class=\"line\">      (executionContext &amp; RenderContext) === NoContext)</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä¸Šé¢æåˆ°çš„ã€‚å‡½æ•°çš„å¤§æ¦‚æ˜¯åˆ¤æ–­æ˜¯å¦æ˜¯äº¤é”™æ›´æ–°ã€‚</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h1><p>æˆ‘å°†Fiberæ‹†åˆ†æˆå››å—æ¥è®²</p>\n<ul>\n<li>åŠ¨æœºï¼ˆæˆ–è€…è¯´åˆè¡·</li>\n<li>åˆå§‹åŒ–-Fiberæ ‘çš„å‡†å¤‡å·¥ä½œ</li>\n<li>render-Fiberæ ‘çš„æ„å»º</li>\n<li>commit-Fiberæ ‘æ˜ å°„åˆ°DOM</li>\n</ul>\n<p>render-Fiberæ ‘çš„æ„å»º</p>\n<p>Fiberæ ‘çš„æ„å»ºã€‚Actionï¼</p>\n<h2 id=\"ä¸€äº›åºŸè¯ï¼Œå¯ä»¥è·³è¿‡\"><a href=\"#ä¸€äº›åºŸè¯ï¼Œå¯ä»¥è·³è¿‡\" class=\"headerlink\" title=\"ä¸€äº›åºŸè¯ï¼Œå¯ä»¥è·³è¿‡\"></a>ä¸€äº›åºŸè¯ï¼Œå¯ä»¥è·³è¿‡</h2><p>è·ç¦»ä¸Šä¸€ç¯‡æ–‡ç« ä¹Ÿæœ‰2ä¸ªå¤šæœˆçš„æ—¶é—´äº†ã€‚ï¼ˆç¡®å®æ¬ç –æ¯”è¾ƒå¿™æ²¡ç©ºï¼‰ç°åœ¨å›å¤´çœ‹ï¼Œç¡®å®ä¸€è„¸æ‡µé€¼ã€‚ä½†æ˜¯æœ‰äº›åŸç†ç¡®å®æ˜¯åˆ»åœ¨è„‘å­é‡Œçš„ï¼Œé‡æ–°æ¡èµ·æ¥ä¹Ÿå¾ˆå¿«ã€‚</p>\n<h1 id=\"å‰æ™¯å›é¡¾\"><a href=\"#å‰æ™¯å›é¡¾\" class=\"headerlink\" title=\"å‰æ™¯å›é¡¾\"></a>å‰æ™¯å›é¡¾</h1><p>æˆ‘ä»¬çŸ¥é“ä¸€ä¸ªæœ€æ™®é€šçš„Reactä»£ç æ˜¯è¿™æ ·çš„ï¼š</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">\"react\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> ReactDOM <span class=\"keyword\">from</span> <span class=\"string\">\"react-dom\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">App</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> text = <span class=\"string\">\"å“ˆå“ˆå“ˆ\"</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;div&gt;</span><br><span class=\"line\">        &lt;p&gt;&#123;text&#125;&lt;<span class=\"regexp\">/p&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;/</span>div&gt;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> rootElement = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"root\"</span>);</span><br><span class=\"line\">ReactDOM.render(<span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">App</span> /&gt;</span></span>, rootElement);</span><br></pre></td></tr></table></figure>\n\n<p>ç„¶åæˆ‘ä»¬é˜…è¯»äº†ReactDOM.renderçš„æºç ã€‚çŸ¥é“äº†renderå†…éƒ¨å…¶å®æ˜¯è°ƒç”¨<code>legacyRenderSubtreeIntoContainer</code>è¿™é‡Œé¢å…¶å®æ˜¯åœ¨åšä¸ºFiberæ ‘åšåˆå§‹åŒ–ã€‚</p>\n<p>ç„¶åæˆ‘ä»¬<code>updateContainer</code>çš„æœ€åä¸¤ä¸ªå‡½æ•°è¿˜æ²¡æœ‰è§£è¯»ï¼Œç»§ç»­çœ‹ã€‚</p>\n<h2 id=\"updateContainer\"><a href=\"#updateContainer\" class=\"headerlink\" title=\"updateContainer\"></a>updateContainer</h2><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">updateContainer</span>(<span class=\"params\">element, container, parentComponent, callback</span>) </span>&#123;</span><br><span class=\"line\">  ......</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// è¿™æ˜¯ä¸€ä¸ª event ç›¸å…³çš„å…¥å‚ï¼Œæ­¤å¤„ä¸å¿…å…³æ³¨</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> eventTime = requestEventTime();</span><br><span class=\"line\"></span><br><span class=\"line\">  ......</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå…³é”®çš„å…¥å‚ï¼Œlane è¡¨ç¤ºä¼˜å…ˆçº§</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> lane = requestUpdateLane(current);</span><br><span class=\"line\">  <span class=\"comment\">// ç»“åˆ laneï¼ˆä¼˜å…ˆçº§ï¼‰ä¿¡æ¯ï¼Œåˆ›å»º update å¯¹è±¡ï¼Œä¸€ä¸ª update å¯¹è±¡æ„å‘³ç€ä¸€ä¸ªæ›´æ–°</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> update = createUpdate(eventTime, lane); </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// update çš„ payload å¯¹åº”çš„æ˜¯ä¸€ä¸ª React å…ƒç´ </span></span><br><span class=\"line\">  update.payload = &#123;</span><br><span class=\"line\">    element: element</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// å¤„ç† callbackï¼Œè¿™ä¸ª callback å…¶å®å°±æ˜¯æˆ‘ä»¬è°ƒç”¨ ReactDOM.render æ—¶ä¼ å…¥çš„ callback</span></span><br><span class=\"line\">  callback = callback === <span class=\"literal\">undefined</span> ? <span class=\"literal\">null</span> : callback;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (callback !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> callback !== <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">        error(<span class=\"string\">'render(...): Expected the last optional `callback` argument to be a '</span> + <span class=\"string\">'function. Instead received: %s.'</span>, callback);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    update.callback = callback;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// å°† update å…¥é˜Ÿ</span></span><br><span class=\"line\">  enqueueUpdate(current, update, lane);</span><br><span class=\"line\">  <span class=\"comment\">// è°ƒåº¦ fiberRoot </span></span><br><span class=\"line\">  scheduleUpdateOnFiber(current, lane, eventTime);</span><br><span class=\"line\">  <span class=\"comment\">// è¿”å›å½“å‰èŠ‚ç‚¹ï¼ˆfiberRootï¼‰çš„ä¼˜å…ˆçº§</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> lane;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"æºç æ”»è¯»\"><a href=\"#æºç æ”»è¯»\" class=\"headerlink\" title=\"æºç æ”»è¯»\"></a>æºç æ”»è¯»</h1><p>è¿˜å‰©ä¸‹ä¸¤ä¸ªå‡½æ•°<code>enqueueUpdate</code>å’Œ<code>scheduleUpdateOnFiber</code></p>\n<p>è¿™ä¸¤ä¸ªå…„å¼Ÿå¼„å®Œä¸çŸ¥é“åé¢è¿˜å‰©ä¸‹ä»€ä¹ˆï¼Œä¸€èµ·çœ‹çœ‹å§ã€‚</p>\n<p>è¿™é‡Œå…ˆè¡¥å……ä¸€ä¸‹ï¼Œ<code>initializeUpdateQueue</code>å†…éƒ¨çš„ä¸œè¥¿ï¼Œå› ä¸ºä¹Ÿæœ‰ä¼šç”¨äº†ï¼Œè‚¯å®šä¼šæœ‰ç–‘é—®ã€‚</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">initializeUpdateQueue</span>&lt;<span class=\"title\">State</span>&gt;(<span class=\"params\">fiber: Fiber</span>): <span class=\"title\">void</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> queue: UpdateQueue&lt;State&gt; = &#123;</span><br><span class=\"line\">    baseState: fiber.memoizedState,</span><br><span class=\"line\">    firstBaseUpdate: <span class=\"literal\">null</span>,</span><br><span class=\"line\">    lastBaseUpdate: <span class=\"literal\">null</span>,</span><br><span class=\"line\">    shared: &#123;</span><br><span class=\"line\">      pending: <span class=\"literal\">null</span>,</span><br><span class=\"line\">      interleaved: <span class=\"literal\">null</span>,</span><br><span class=\"line\">      lanes: NoLanes,</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    effects: <span class=\"literal\">null</span>,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  fiber.updateQueue = queue;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"enqueueUpdate\"><a href=\"#enqueueUpdate\" class=\"headerlink\" title=\"enqueueUpdate\"></a>enqueueUpdate</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export function enqueueUpdate&lt;State&gt;(</span><br><span class=\"line\">  fiber: Fiber,</span><br><span class=\"line\">  update: Update&lt;State&gt;,</span><br><span class=\"line\">  lane: Lane,</span><br><span class=\"line\">) &#123;</span><br><span class=\"line\">  const updateQueue &#x3D; fiber.updateQueue;</span><br><span class=\"line\">  if (updateQueue &#x3D;&#x3D;&#x3D; null) &#123;</span><br><span class=\"line\">    &#x2F;&#x2F; åªåœ¨fiber å¸è½½çš„æ—¶å€™ä¼šå‘ç”Ÿ</span><br><span class=\"line\">    &#x2F;&#x2F; Only occurs if the fiber has been unmounted.</span><br><span class=\"line\">    return;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  const sharedQueue: SharedQueue&lt;State&gt; &#x3D; (updateQueue: any).shared;</span><br><span class=\"line\">  &#x2F;&#x2F; æ¯”è¾ƒfiber laneå’Œlaneï¼Œç›¸åŒæ—¶æ›´æ–°ï¼Œå…·ä½“å†…å®¹å¯ä»¥çœ‹ä¸‹é¢çš„æºç ã€‚è¿™é‡Œä¸åŠ è®¨è®º</span><br><span class=\"line\">  &#x2F;&#x2F; renderåˆå§‹åŒ–æ—¶ä¸æ‰§è¡Œ</span><br><span class=\"line\">  if (isInterleavedUpdate(fiber, lane)) &#123;</span><br><span class=\"line\">    const interleaved &#x3D; sharedQueue.interleaved;</span><br><span class=\"line\">    if (interleaved &#x3D;&#x3D;&#x3D; null) &#123;</span><br><span class=\"line\">      &#x2F;&#x2F; This is the first update. Create a circular list.</span><br><span class=\"line\">      update.next &#x3D; update;</span><br><span class=\"line\">      &#x2F;&#x2F; At the end of the current render, this queue&#39;s interleaved updates will</span><br><span class=\"line\">      &#x2F;&#x2F; be transfered to the pending queue.</span><br><span class=\"line\">      pushInterleavedQueue(sharedQueue);</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">      update.next &#x3D; interleaved.next;</span><br><span class=\"line\">      interleaved.next &#x3D; update;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    sharedQueue.interleaved &#x3D; update;</span><br><span class=\"line\">  &#125; else &#123;</span><br><span class=\"line\">    const pending &#x3D; sharedQueue.pending;</span><br><span class=\"line\">    if (pending &#x3D;&#x3D;&#x3D; null) &#123;</span><br><span class=\"line\">      &#x2F;&#x2F; This is the first update. Create a circular list.</span><br><span class=\"line\">      update.next &#x3D; update;</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">      update.next &#x3D; pending.next;</span><br><span class=\"line\">      pending.next &#x3D; update;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    sharedQueue.pending &#x3D; update;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">\t&#x2F;&#x2F; å¼€å‘æ¨¡å¼</span><br><span class=\"line\">  if (__DEV__) &#123;</span><br><span class=\"line\">    if (</span><br><span class=\"line\">      currentlyProcessingQueue &#x3D;&#x3D;&#x3D; sharedQueue &amp;&amp;</span><br><span class=\"line\">      !didWarnUpdateInsideUpdate</span><br><span class=\"line\">    ) &#123;</span><br><span class=\"line\">      console.error(</span><br><span class=\"line\">        &#39;An update (setState, replaceState, or forceUpdate) was scheduled &#39; +</span><br><span class=\"line\">          &#39;from inside an update function. Update functions should be pure, &#39; +</span><br><span class=\"line\">          &#39;with zero side-effects. Consider using componentDidUpdate or a &#39; +</span><br><span class=\"line\">          &#39;callback.&#39;,</span><br><span class=\"line\">      );</span><br><span class=\"line\">      didWarnUpdateInsideUpdate &#x3D; true;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"isInterleavedUpdate\"><a href=\"#isInterleavedUpdate\" class=\"headerlink\" title=\"isInterleavedUpdate\"></a>isInterleavedUpdate</h3><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">isInterleavedUpdate</span>(<span class=\"params\">fiber: Fiber, lane: Lane</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">TODO:</span> Optimize slightly by comparing to root that fiber belongs to.</span></span><br><span class=\"line\">    <span class=\"comment\">// Requires some refactoring. Not a big deal though since it's rare for</span></span><br><span class=\"line\">    <span class=\"comment\">// concurrent apps to have more than a single root.</span></span><br><span class=\"line\">    workInProgressRoot !== <span class=\"literal\">null</span> &amp;&amp;</span><br><span class=\"line\">    (fiber.mode &amp; ConcurrentMode) !== NoMode &amp;&amp;</span><br><span class=\"line\">    <span class=\"comment\">// If this is a render phase update (i.e. UNSAFE_componentWillReceiveProps),</span></span><br><span class=\"line\">    <span class=\"comment\">// then don't treat this as an interleaved update. This pattern is</span></span><br><span class=\"line\">    <span class=\"comment\">// accompanied by a warning but we haven't fully deprecated it yet. We can</span></span><br><span class=\"line\">    <span class=\"comment\">// remove once the deferRenderPhaseUpdateToNextBatch flag is enabled.</span></span><br><span class=\"line\">    (deferRenderPhaseUpdateToNextBatch ||</span><br><span class=\"line\">      (executionContext &amp; RenderContext) === NoContext)</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä¸Šé¢æåˆ°çš„ã€‚å‡½æ•°çš„å¤§æ¦‚æ˜¯åˆ¤æ–­æ˜¯å¦æ˜¯äº¤é”™æ›´æ–°ã€‚</p>\n"},{"title":"ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šJavaScriptçš„æ‰§è¡Œæœºåˆ¶","date":"2020-08-10T13:36:40.000Z","cover":"/image/cover/web.jpeg","_content":"\næœ€è¿‘åœ¨å†™ã€é‡æ‹¾å‰ç«¯ã€‘ç³»åˆ—ï¼Œä¸‹é¢æœ‰å‡ ä¸ªå¿«é€Ÿé€šé“ï¼Œå¤§å®¶è‡ªå–\n\n[ã€é‡è¯†å‰ç«¯ã€‘åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿](https://juejin.im/post/6850418113944420359)\n\n[ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—](https://juejin.im/post/6850418117508759566)\n\n[ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this](https://juejin.im/post/6854573215658803208)\n\n[ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šJavaScriptçš„æ‰§è¡Œæœºåˆ¶](https://juejin.im/post/6859911609633767438)\n\n[ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC](https://juejin.im/post/6860375101322461198)\n\n[ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ](https://juejin.im/post/6865204092877144077)\n\n## å‰è¨€\n\näº‹ä»¶å¾ªç¯è¿™ä¸ªäº‹æƒ…ï¼Œå…¶å®åœ¨æˆ‘ä»¬çš„å·¥ä½œä¸­æˆ–å¤šæˆ–å°‘éƒ½ä¼šç¢°åˆ°ï¼Œå¯èƒ½æˆ‘ä»¬åªæ˜¯æ²¡æœ‰å»è®¤è®¤çœŸçœŸçš„ç†è§£ä»–ï¼Œäº†è§£ä»–è€Œå·²ã€‚ä»Šå¤©æˆ‘ä»¬ä¸€èµ·æŠŠäº‹ä»¶å¾ªç¯åƒé€ã€‚\n\n## å•çº¿ç¨‹çš„JS\n\nå…¶å®ï¼Œäº‹ä»¶å¾ªç¯å°±æ˜¯å¯¹äºå•çº¿ç¨‹çš„JSåº”è¿è€Œç”Ÿçš„ã€‚\n\n- å•çº¿ç¨‹ï¼Ÿä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Œè¯¶ï¼Œæˆ‘å¥½åƒå¬è¿‡è¿›ç¨‹è¯¶ï¼Œä»–ä»¬ä¸¤å…„å¼Ÿå•¥åŒºåˆ«ï¼Ÿ\n- ä¸ºä»€ä¹ˆjsä¸€å®šè¦å•çº¿ç¨‹å•Šï¼Œæˆ‘å¬è¯´CPUä¸æ˜¯æœ‰å¾ˆå¤šæ ¸å—ï¼Ÿä¸ºä»€ä¹ˆä¸å¤šçº¿ç¨‹ï¼Ÿ\n\n### çº¿ç¨‹å’Œè¿›ç¨‹çš„çˆ±æ¨çº è‘›\n\nè¿™é‡Œæˆ‘æ¨èé˜®ä¸€å³°è€å¸ˆçš„ä¸€ç¯‡æ–‡ç«  \n\n[ç‚¹æˆ‘å­¦ä¹ ](https://www.ruanyifeng.com/blog/2013/04/processes_and_threads.html)\n\n### ä¸ºä»€ä¹ˆJSæ˜¯å•çº¿ç¨‹ï¼Ÿ\n\n> è¿™ä¸ªè¦å›åˆ°Jså†å²äº†ï¼Œå¸ƒå…°ç™»Â·è‰¾å¥‡(Brendan Eich)è€å“¥ç”¨10å¤©åˆ›é€ jsã€‚å½“æ—¶jsç”¨æ¥å¹²å˜›ï¼Œç®€å•çš„æµè§ˆå™¨äº¤äº’ï¼ŒéªŒè¯ï¼Œæ“ä½œä¸€ä¸‹domæ˜¯å§ã€‚é‚£æŠŠå®ƒè®¾è®¡æˆé‚£ä¹ˆå¤æ‚å¹²ä»€ä¹ˆï¼Œè€Œä¸”å¦‚æœå¤šçº¿ç¨‹çš„è¯ï¼Œæ“ä½œdomä¼šå‡ºç°éº»çƒ¦çš„äº‹æƒ…ï¼Œå‡è®¾ä¸€ä¸ªçº¿ç¨‹è¯»å–DOMèŠ‚ç‚¹æ•°æ®çš„åŒæ—¶ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹æŠŠé‚£ä¸ªDOMèŠ‚ç‚¹åˆ äº†ï¼Œå‘µå‘µã€‚æ‰€ä»¥jsä¸€ä¸ªçº¿ç¨‹å°±å¤Ÿäº†ï¼Œä¹Ÿå°±æ˜¯ä¸€æ­¥ä¸€æ­¥é¡ºåºè¿è¡Œä¸‹æ¥ã€‚\n\n## æµè§ˆå™¨ä¸­çš„æ¶ˆæ¯é˜Ÿåˆ—å’Œäº‹ä»¶å¾ªç¯\n\nè¿™é‡Œæš‚æ—¶åªè¯´æµè§ˆå™¨ä¸­çš„å¾ªç¯äº‹ä»¶å¾ªç¯ï¼Œæœ‰å…³nodeçš„è¯å¯èƒ½æœ‰äº›ç»†å¾®çš„å·®åˆ«ï¼Œä¸è¿‡åº•å±‚çš„åŸç†éƒ½æ˜¯å·®ä¸å¤šçš„ã€‚\n\n### æ³¨æ„\n\nè¿™é‡Œä¸»è¦æ˜¯ä»ä¸€ä¸ªè®¾è®¡è€…çš„è§’åº¦æ¥æ¨¡æ‹Ÿï¼Œä»é›¶æ„å»ºæµè§ˆå™¨ä¸­çš„æ—¶é—´å¾ªç¯ã€‚ä¸ºäº†èƒ½è®©ä½ æ›´åŠ æ·±åˆ»åœ°ç†è§£äº‹ä»¶å¾ªç¯æœºåˆ¶ï¼Œæˆ‘ä»¬å°±ä»æœ€ç®€å•çš„åœºæ™¯æ¥åˆ†æï¼Œç„¶åå¸¦ä½ ä¸€æ­¥æ­¥äº†è§£æµè§ˆå™¨é¡µé¢ä¸»çº¿ç¨‹æ˜¯å¦‚ä½•è¿ä½œçš„ã€‚\n\n### å¼€å§‹\n\n#### äº‹å…ˆçº¦å®šå¥½çš„æ‰§è¡Œé¡ºåº\n\nå‡å¦‚æˆ‘æœ‰ä»¥ä¸‹å‡ ä¸ªä»»åŠ¡\n\n```js\nvar num1 = 1+2; // ä»»åŠ¡ 1\nvar num2 = 20/5; // ä»»åŠ¡ 2\nvar num3 = 7*8; // ä»»åŠ¡ 3\nconsole.log(num1, num2, num3)ï¼› // ä»»åŠ¡ 4\n```\n\n\n\nå¦‚æœè®©æˆ‘æ¥è®¾è®¡ï¼Œæˆ‘å°±ä¼šæœ‰ä¸€ä¸ªä¸»çº¿ç¨‹ï¼Œç„¶åæŠŠä»–ä»¬æŒ‰é¡ºåºæ’è¿›å»ï¼Œç„¶åé¡ºåºæ‰§è¡Œã€‚\n\n\n\n```js\nfunction mainThread(){\n  var num1 = 1+2; // ä»»åŠ¡ 1\n  var num2 = 20/5; // ä»»åŠ¡ 2\n  var num3 = 7*8; // ä»»åŠ¡ 3\n  console.log(num1, num2, num3)ï¼› // ä»»åŠ¡ 4\n}\n```\n\nğŸ˜¯ï¼Œæˆ‘ä»¬å·²ç»è®¾è®¡äº†æœ€ç®€å•çš„çº¿ç¨‹å•¦ã€‚\n\n#### çº¿ç¨‹è¿è¡Œä¸­ï¼Œå¤„ç†çªå‘äº‹ä»¶\n\nå¾ˆå¤šæ—¶å€™ï¼Œæ‰€æœ‰çš„ä»»åŠ¡ä¸æ˜¯ä¹‹å‰å°±ç»Ÿä¸€å®‰æ’å¥½çš„ï¼Œæ¯”å¦‚âŒ¨ï¸çš„è¾“å…¥ï¼ŒğŸ–±çš„ç‚¹å‡»ç­‰ç­‰ã€‚\n\nå¦‚æœæƒ³è¦åœ¨çº¿ç¨‹è¿è¡Œä¸­å¯ä»¥å¾ˆå¥½çš„å¤„ç†è¿™äº›äº‹ä»¶ã€‚å°±éœ€è¦\n\n ====>äº‹ä»¶å¾ªç¯ã€‚è¿™é‡Œæˆ‘ä»¬ç”¨whileæ¥å®ç°ç®€å•çš„äº‹ä»¶å¾ªç¯\n\n```js\nfunction awaitt() {\n  return new Promise(resolve => {\n    document.addEventListener('keydown', resolve);\n  });\n}\n\nasync function mainThread() {\n  while(true){\n    const result = await awaitt();\n    console.log(result);\n  }\n}\n\nmainThread();\n```\n\nè¿™æ ·æ”¹ç‰ˆä¹‹åæœ‰äº†ä»¥ä¸‹å‡ ç‚¹æ”¹è¿›ï¼š\n\n- å¼•å…¥äº†å¾ªç¯æœºåˆ¶\n- å¼•å…¥äº‹ä»¶ï¼Œç„¶åæ•´ä¸ªçº¿ç¨‹åœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œæ´»äº†èµ·æ¥ï¼Œä¸å†æ˜¯æ­»çš„ï¼Œè¿è¡Œå®Œå°±æ»šè›‹äº†çš„é‚£ç§ï¼Œæœ‰äº†äº¤äº’äº†\n\nï¼ˆğŸ¤«æœ€ç®€å•çš„å®ç°ã€‚ã€‚ã€‚åˆ«åæ§½ä»£ç ï¼Œéƒ½æ˜¯æœ€ç®€å•çš„å®ç°å’Œæœ€ç®€å•çš„åœºæ™¯ï¼ŒåŠ©äºç†è§£è€Œå·²ã€‚ã€‚ã€‚ï¼‰\n\n#### å¤„ç†å…¶ä»–çº¿ç¨‹çš„ä»»åŠ¡\n\nä¸Šé¢çš„ç‰ˆæœ¬ç”¨äº†äº‹ä»¶å¾ªç¯çš„æ–¹å¼æ¥è·å–å†…éƒ¨çš„äº‹ä»¶ï¼Œä½†æ˜¯å¯¹äºå¤–éƒ¨çªå‘æƒ…å†µçš„äº‹ä»¶æ˜¯æ— æ³•è§£å†³çš„ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦å‡çº§~\n\né‚£ä¹ˆæ€ä¹ˆè®¾è®¡å¥½ä¸€ä¸ªçº¿ç¨‹æ¨¡å‹å‘¢ï¼Ÿæˆ‘ä»¬æ¢ä¸ªè§’åº¦æƒ³æƒ³æ€è·¯é©¬ä¸Šå°±å‡ºæ¥äº†ã€‚\n\nè¿™äº›å¤–éƒ¨çš„ä»»åŠ¡ï¼Œéƒ½æ˜¯æœ‰å…ˆåé¡ºåºçš„ï¼Œå“ªæ€•æ˜¯éƒ½æ˜¯çªå‘æƒ…å†µã€‚ä»–ä»¬ä¹Ÿæ˜¯æœ‰å…ˆåé¡ºåºã€‚\n\næ‰€ä»¥ä¸€ä¸ªæ¯”è¾ƒé€šç”¨çš„æ¨¡å¼å°±æ˜¯\n\n======> æ¶ˆæ¯é˜Ÿåˆ—\n\n> æ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œå¯ä»¥å­˜æ”¾è¦æ‰§è¡Œçš„ä»»åŠ¡ã€‚å®ƒç¬¦åˆé˜Ÿåˆ—â€œå…ˆè¿›å…ˆå‡ºâ€çš„ç‰¹ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´è¦æ·»åŠ ä»»åŠ¡çš„è¯ï¼Œæ·»åŠ åˆ°é˜Ÿåˆ—çš„å°¾éƒ¨ï¼›è¦å–å‡ºä»»åŠ¡çš„è¯ï¼Œä»é˜Ÿåˆ—å¤´éƒ¨å»å–ã€‚\n\næˆ‘ä»¬è¦å®Œæˆä»¥ä¸‹å‡ ä¸ªæ“ä½œï¼š\n\n1. æ·»åŠ ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼›\n2. IO çº¿ç¨‹ä¸­äº§ç”Ÿçš„æ–°ä»»åŠ¡æ·»åŠ è¿›æ¶ˆæ¯é˜Ÿåˆ—å°¾éƒ¨ï¼›\n3. æ¸²æŸ“ä¸»çº¿ç¨‹ä¼šå¾ªç¯åœ°ä»æ¶ˆæ¯é˜Ÿåˆ—å¤´éƒ¨ä¸­è¯»å–ä»»åŠ¡ï¼Œæ‰§è¡Œä»»åŠ¡ã€‚\n\n\n\n```js\nconst arrTask = []\n\nfunction addTask(fn) {\n  arrTask.push(fn)\n}\n\nfunction otherThread() {\n  addTask(() => {console.log('other')})\n}\n\nfunction awaitt() {\n  return new Promise(resolve => {\n      if(arrTask.length) {\n        const task = arrTask.shift()\n        task()\n        resolve()\n      }\n  });\n}\n\nasync function mainThread() {\n  while(true){\n    \tawait awaitt();\n  }\n}\n\n\naddTask(()=>console.log('in'))\naddTask(()=>console.log('in'))\naddTask(()=>console.log('in'))\n\nmainThread();\notherThread()\n```\n\n\n\næˆ‘ä»¬ç”¨ä¸€ä¸ªæ•°ç»„æ¥æ¨¡æ‹Ÿä¸€ä¸ªé˜Ÿåˆ—ã€‚\n\næ—¢åŸºç¡€äº†å†…éƒ¨çš„ä»»åŠ¡ï¼Œä¹Ÿå¤„ç†äº†å¤–éƒ¨çªå‘çš„ä»»åŠ¡\n\næœ‰ä»»åŠ¡è¿›æ¥ï¼Œ å°±ä¼šæ‰§è¡Œä»»åŠ¡ã€‚\n\n\n\n#### é€€å‡ºä¸»çº¿ç¨‹\n\nå½“é¡µé¢ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæˆä¹‹åï¼Œåˆè¯¥å¦‚ä½•ä¿è¯é¡µé¢ä¸»çº¿ç¨‹èƒ½å¤Ÿå®‰å…¨é€€å‡ºå‘¢ï¼ŸChrome æ˜¯è¿™æ ·è§£å†³çš„ï¼Œç¡®å®šè¦é€€å‡ºå½“å‰é¡µé¢æ—¶ï¼Œé¡µé¢ä¸»çº¿ç¨‹ä¼šè®¾ç½®ä¸€ä¸ªé€€å‡ºæ ‡å¿—çš„å˜é‡ï¼Œåœ¨æ¯æ¬¡æ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰è®¾ç½®é€€å‡ºæ ‡å¿—ã€‚\n\n\n\n```js\nconst arrTask = []\nlet over = false\n\nfunction addTask(fn) {\n  arrTask.push(fn)\n}\n\nfunction otherThread() {\n  addTask(() => {console.log('other')})\n}\n\nfunction awaitt() {\n  return new Promise(resolve => {\n      if(arrTask.length) {\n        const task = arrTask.shift()\n        task()\n        if(!arrTask.length){\n          over = true\n        }\n        resolve()\n      }\n  });\n}\n\nasync function mainThread() {\n  while(true){\n    if(over){\n      break;\n    }\n    \tawait awaitt();\n  }\n}\n\n\naddTask(()=>console.log('in'))\naddTask(()=>console.log('in'))\naddTask(()=>console.log('in'))\n\nmainThread();\notherThread()\n```\n\n\n\n### å•çº¿ç¨‹çš„ç¼ºç‚¹\n\né€šè¿‡ä¸Šé¢çš„ä»‹ç»ï¼Œä½ åº”è¯¥æ¸…æ¥šäº†ï¼Œé¡µé¢çº¿ç¨‹æ‰€æœ‰æ‰§è¡Œçš„ä»»åŠ¡éƒ½æ¥è‡ªäºæ¶ˆæ¯é˜Ÿåˆ—ã€‚æ¶ˆæ¯é˜Ÿåˆ—æ˜¯â€œå…ˆè¿›å…ˆå‡ºâ€çš„å±æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´æ”¾å…¥é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œéœ€è¦ç­‰å¾…å‰é¢çš„ä»»åŠ¡è¢«æ‰§è¡Œå®Œï¼Œæ‰ä¼šè¢«æ‰§è¡Œã€‚é‰´äºè¿™ä¸ªå±æ€§ï¼Œå°±æœ‰å¦‚ä¸‹ä¸¤ä¸ªé—®é¢˜éœ€è¦è§£å†³ã€‚\n\n#### å¦‚ä½•å¤„ç†é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡\n\nåœºæ™¯ï¼š\n\nå‡å¦‚ï¼Œæˆ‘ç°åœ¨æœ‰ä¸€å¤§ä¸²çš„ä»»åŠ¡åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œã€‚\n\næˆ‘çš„domèŠ‚ç‚¹å˜åŒ–çš„æ—¶å€™ï¼Œæˆ‘éœ€è¦å‘é€è¯·æ±‚æˆ–è€…æç¤ºä¸€ä¸ª`alert`ä¹‹ç±»çš„ä¸šåŠ¡é€»è¾‘è¦æ‰§è¡Œã€‚\n\nç°åœ¨å¯è¡Œçš„æœ‰ä¸¤ç§æ–¹æ¡ˆï¼š\n\n- domèŠ‚ç‚¹å˜åŒ–çš„è¯ï¼Œæˆ‘å°±åœä¸‹ç°åœ¨æ­£åœ¨è¿è¡Œçš„ä¸»çº¿ç¨‹ä¸Šçš„ä»»åŠ¡ï¼Œç„¶åè°ƒç”¨æˆ‘éœ€è¦æ‰§è¡Œçš„ä¸šåŠ¡é€»è¾‘ã€‚è¿™æ ·ç¡®å®å…·æœ‰å®æ•ˆæ€§ï¼Œä½†æ˜¯ï¼è¿™æ ·ä¼šä½¿å¾—å½“å‰ä»»åŠ¡çš„æ•ˆç‡æåº¦é™ä½ï¼Œæ¯”å¦‚æˆ‘çš„domèŠ‚ç‚¹å˜åŒ–200æ¬¡ï¼Œé‚£å²‚ä¸æ˜¯å½“å‰çš„ä»»åŠ¡ç‰¹åˆ«ä¹…äº†å—ï¼Ÿ\n- ç¬¬äºŒä¸ªæ–¹æ³•å°±å¯ä»¥è§£å†³ä¸Šè¿°çš„é—®é¢˜ï¼šä¸€æ—¦domèŠ‚ç‚¹æœ‰å˜åŒ–ï¼Œå“ªæ€•æ˜¯200000æ¬¡å˜åŒ–ï¼Œæˆ‘éƒ½æ˜¯å°†ä¸šåŠ¡é€»è¾‘pushåˆ°é˜Ÿåˆ—çš„å°¾éƒ¨ï¼Œè¿™æ ·å°±ä¸ä¼šå½±å“å½“å‰ä»»åŠ¡è¿›è¡Œä»¥åŠæ•ˆç‡äº†ã€‚ä½†æ˜¯ï¼è¿™æ ·çš„è¯æˆ‘çš„å®æ•ˆæ€§å°±è«å¾—äº†ã€‚å°±è«å¾—äº†ã€‚\n\næ€»ç»“ä¸€ä¸‹ï¼šå…¶å®å°±æ˜¯å®æ•ˆæ€§å’Œä»»åŠ¡æ•ˆç‡çš„æƒè¡¡é—®é¢˜ç½¢äº†ã€‚\n\næ±Ÿæ±Ÿæ±Ÿ~\n\nå¾®ä»»åŠ¡å°±åº”è¿è€Œç”Ÿå•¦ã€‚\n\nåŠ å…¥æˆ‘ä»¬æŠŠä»»åŠ¡é˜Ÿåˆ—é‡Œé¢çš„æ¯ä¸ªä»»åŠ¡éƒ½ç§°ä½œå®ä»»åŠ¡çš„è¯ï¼Œæ¯ä¸ªå®ä»»åŠ¡é‡Œé¢éƒ½ä¼šåŒ…å«ä¸€ä¸ªå¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚æ¯ä¸ªå®ä»»åŠ¡ç»“æŸä¹‹åï¼Œéƒ½å›å»æ¸…ç†ä¸€éå¾®ä»»åŠ¡é˜Ÿåˆ—é‡Œé¢çš„é˜Ÿåˆ—ï¼Œè¿™æ ·çš„è¯æ—¢ä¿æŠ¤äº†å®æ•ˆæ€§ï¼Œä¹Ÿä¿æŠ¤äº†ä»»åŠ¡çš„æ•ˆç‡ã€‚\n\n\n\n#### å¦‚ä½•å¤„ç†è°ƒç”¨æ—¶é—´è¿‡é•¿çš„é—®é¢˜\n\næˆ‘ä»¬éƒ½çŸ¥é“jsæ˜¯å•çº¿ç¨‹çš„ã€‚å¦‚æœç°åœ¨åœ¨æ‰§è¡Œä¸€ä¸ªä»»åŠ¡çš„æƒ…å†µä¸‹ã€‚å…¶ä»–ä»»åŠ¡å°±æ˜¯è¦ç­‰å¾…çš„ã€‚é‚£ä¹ˆå°±ä¼šå‡ºç°æŸä¸ªä»»åŠ¡è®¡ç®—çš„å‘¨æœŸç‰¹åˆ«é•¿ï¼Œå¯¼è‡´åˆ«äººéƒ½åœ¨ç­‰å¾…ã€‚\n\nğŸ‘Œï¼Œæˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹\n\n```js\nwhile(true){}\nalter(123)\n```\n\nä¸‹é¢çš„`alter`æ°¸è¿œéƒ½ä¸ä¼šæ‰§è¡Œäº†ã€‚å› ä¸º`while`åœ¨å·¥ä½œï¼Œ`alter`åœ¨ç­‰ä»–æŠŠèµ„æºè®©å‡ºæ¥ã€‚\n\nå‡å¦‚è¯´ï¼Œæˆ‘ç°åœ¨æœ‰ä¸€ä¸ªåŠ¨ç”»è¦è¿›è¡Œï¼Œä½†æ˜¯è¿è¡Œå®Œä¸€å¸§ä¹‹åï¼Œæœ‰ä¸€ä¸ªæå…¶å¤æ‚çš„è®¡ç®—ï¼Œå¯¼è‡´äº†æˆ‘çš„åŠ¨ç”»ä¸æµç•…ï¼Œé‚£ä¹ˆç”¨æˆ·å¯èƒ½å°±ä¼šéå¸¸çš„çƒ¦ã€‚è¿™ä¸æ˜¯æˆ‘ä»¬å¸Œæœ›çœ‹åˆ°çš„ã€‚\n\næ‰€ä»¥jsæœ‰ä¸€ä¸ªå›è°ƒæœºåˆ¶ï¼Œåˆ°äº†ç‰¹å®šçš„æ—¶é—´ç‚¹äº†ï¼Œå›è°ƒä¸€ä¸‹ï¼ŒæŠŠåŠ¨ç”»çš„ä¸‹ä¸€å¸§æ‰§è¡Œä¸€ä¸‹ï¼Œç„¶åç»§ç»­å½“å‰çš„å¤æ‚è®¡ç®—ã€‚\n\n### æ€»ç»“\n\n- å¦‚æœæœ‰ä¸€äº›ç¡®å®šå¥½çš„ä»»åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå•çº¿ç¨‹æ¥æŒ‰ç…§é¡ºåºå¤„ç†è¿™äº›ä»»åŠ¡ï¼Œè¿™æ˜¯ç¬¬ä¸€ç‰ˆçº¿ç¨‹æ¨¡å‹ã€‚\n- è¦åœ¨çº¿ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­æ¥æ”¶å¹¶å¤„ç†æ–°çš„ä»»åŠ¡ï¼Œå°±éœ€è¦å¼•å…¥å¾ªç¯è¯­å¥å’Œäº‹ä»¶ç³»ç»Ÿï¼Œè¿™æ˜¯ç¬¬äºŒç‰ˆçº¿ç¨‹æ¨¡å‹ã€‚\n- å¦‚æœè¦æ¥æ”¶å…¶ä»–çº¿ç¨‹å‘é€è¿‡æ¥çš„ä»»åŠ¡ï¼Œå°±éœ€è¦å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¿™æ˜¯ç¬¬ä¸‰ç‰ˆçº¿ç¨‹æ¨¡å‹ã€‚\n- å¦‚æœå…¶ä»–è¿›ç¨‹æƒ³è¦å‘é€ä»»åŠ¡ç»™é¡µé¢ä¸»çº¿ç¨‹ï¼Œé‚£ä¹ˆå…ˆé€šè¿‡ IPC æŠŠä»»åŠ¡å‘é€ç»™æ¸²æŸ“è¿›ç¨‹çš„ IO çº¿ç¨‹ï¼ŒIO çº¿ç¨‹å†æŠŠä»»åŠ¡å‘é€ç»™é¡µé¢ä¸»çº¿ç¨‹ã€‚\n- æ¶ˆæ¯é˜Ÿåˆ—æœºåˆ¶å¹¶ä¸æ˜¯å¤ªçµæ´»ï¼Œä¸ºäº†é€‚åº”æ•ˆç‡å’Œå®æ—¶æ€§ï¼Œå¼•å…¥äº†å¾®ä»»åŠ¡\n\nåŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„è®¾è®¡æ˜¯ç›®å‰ä½¿ç”¨æœ€å¹¿çš„æ¶ˆæ¯æ¶æ„ï¼Œæ— è®ºæ˜¯å®‰å“è¿˜æ˜¯ Chrome éƒ½é‡‡ç”¨äº†ç±»ä¼¼çš„ä»»åŠ¡æœºåˆ¶ï¼Œæ‰€ä»¥ç†è§£äº†æœ¬ç¯‡æ–‡ç« çš„å†…å®¹åï¼Œä½ å†ç†è§£å…¶ä»–é¡¹ç›®çš„ä»»åŠ¡æœºåˆ¶ä¹Ÿä¼šæ¯”è¾ƒè½»æ¾ã€‚\n\n## æµè§ˆå™¨æ˜¯æ€ä¹ˆå®ç°setTimeout\n\nè¦æƒ³çŸ¥é“æµè§ˆå™¨æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œæˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹ï¼Œæˆ‘ä»¬ä¹‹å‰è®¾è®¡çš„é‚£ä¸ªäº‹ä»¶å¾ªç¯ç³»ç»Ÿï¼š\n\næœ‰xxä»»åŠ¡äº†ï¼Œokï¼Œæˆ‘`push`åˆ°ä»»åŠ¡é˜Ÿåˆ—ã€‚ä»¥æ­¤å¾ªç¯ã€‚\n\næ‰€ä»¥æˆ‘ä»¬å†™åœ¨`setTimeout`é‡Œé¢çš„å‡½æ•°æ‰§è¡Œå…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªä»»åŠ¡ï¼Œä¹Ÿæ˜¯éœ€è¦pushåˆ°ä»»åŠ¡é˜Ÿåˆ—å»çš„ã€‚\n\nä½†æ˜¯ï¼Œæˆ‘ä»¬çš„è¿™ä¸ªæ˜¯å…¶å®æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„å‡½æ•°ï¼Œä¸èƒ½ç›´æ¥å°†æ•´ä¸ªå‡½æ•°pushåˆ°é˜Ÿåˆ—ä¸­ï¼Œå¦åˆ™çš„è¯æˆ‘ä»¬çš„å®æ•ˆæ€§å°±å¾ˆæœ‰å¯èƒ½å‡ºé”™äº†ï¼Œæ¯”å¦‚æˆ‘å¸Œæœ›ä»–åœ¨24å°æ—¶ä¹‹å`alter`å‘Šè¯‰æˆ‘å·²ç»åˆ°äº†ç¬¬äºŒå¤©äº†ã€‚ä»–å¦‚æœæ˜¯ç›´æ¥pushåˆ°ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ²¡æœ‰åˆ°ç¬¬äºŒå¤©å°±ä¼šå‘Šè¯‰æˆ‘ç¬¬äºŒå¤©åˆ°äº†ï¼Œè¿™ä¸æ˜¯è®©ç”¨æˆ·åŒªå¤·æ‰€æ€å˜›ã€‚\n\næ‰€ä»¥è‚¯å®šä¸æ˜¯ç›´æ¥`push`çš„ã€‚é‚£åˆæ˜¯æ€ä¹ˆå¼„å¾—å˜ï¼Ÿ\n\nä½ ä¹Ÿå¯ä»¥æ€è€ƒä¸‹ï¼Œå¦‚æœè®©ä½ åœ¨æ¶ˆæ¯å¾ªç¯ç³»ç»Ÿçš„åŸºç¡€ä¹‹ä¸ŠåŠ ä¸Šå®šæ—¶å™¨çš„åŠŸèƒ½ï¼Œä½ ä¼šå¦‚ä½•è®¾è®¡ï¼Ÿ\n\nåœ¨ Chrome ä¸­é™¤äº†æ­£å¸¸ä½¿ç”¨çš„æ¶ˆæ¯é˜Ÿåˆ—ä¹‹å¤–ï¼Œè¿˜æœ‰å¦å¤–ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¿™ä¸ªé˜Ÿåˆ—ä¸­ç»´æŠ¤äº†éœ€è¦å»¶è¿Ÿæ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨ï¼ŒåŒ…æ‹¬äº†å®šæ—¶å™¨å’Œ Chromium å†…éƒ¨ä¸€äº›éœ€è¦å»¶è¿Ÿæ‰§è¡Œçš„ä»»åŠ¡ã€‚æ‰€ä»¥å½“é€šè¿‡ JavaScript åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨æ—¶ï¼Œæ¸²æŸ“è¿›ç¨‹ä¼šå°†è¯¥å®šæ—¶å™¨çš„å›è°ƒä»»åŠ¡æ·»åŠ åˆ°å»¶è¿Ÿé˜Ÿåˆ—ä¸­\n\næˆ‘ä»¬æŠŠä¹‹å‰çš„äº‹ä»¶å¾ªç¯æ¨¡æ‹Ÿæ”¹ä¸€ä¸‹\n\n```js\nconst mainTask = [\n  fn1,\n  fn2,\n  fn3,\n  â€¦â€¦\n]\n\nconst setTimeoutTask = []\n\nfunction addSetTimeoutTask(fn, timeout){\n  setTimeoutTask.push({\n    fn: fn,\n    id: Math.random(),\n    useTime: timeout + ((new Date()).getTime()\n  })\n}\n\nconst runSetTimeoutTask (){\n  const runList = []\n  setTimeoutTask.forEach(item => {\n    // å·²ç»è¿‡äº†æ—¶é—´ï¼Œæˆ–è€…åˆšåˆšå¥½åˆ°æ—¶é—´çš„è¯å°±å–å‡ºæ¥ã€‚å¾…ä¼šä¸€èµ·æ‰§è¡Œäº†\n    if(item.useTime <= ((new Date()).getTime()) {\n      runList.push(item.fn) \n    }\n  })\n  if(runList.length) {\n    const fn = runList.shift()\n    fn()\n  }\n}\n\nasync function mainThread() {\n  while(true){\n    const task = arrTask.shift()\n    \n    // æ¯æ¬¡æ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡ï¼Œéƒ½å›å»æŸ¥æ‰¾ä¸€ä¸‹å»¶è¿Ÿé˜Ÿåˆ—é‡Œé¢æœ‰æ²¡æœ‰åˆ°ç‚¹çš„å‡½æ•°\n    if(setTimeoutTask.length) {\n       runSetTimeoutTask()\n    }\n  }\n}\n\nmainThread();\n```\n\næ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä¼šçœ‹åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯å…¶å®ä½ åˆ°ç‚¹äº†å¯èƒ½è¦ä¸ä¼šç«‹åˆ»æ‰§è¡Œï¼Œå¿…é¡»ç­‰åˆ°ä¹‹å‰çš„ä»»åŠ¡æ‰§è¡Œå®Œäº†æ‰è½®åˆ°å»¶è¿Ÿé˜Ÿåˆ—çš„æŸ¥è¯¢å’Œæ‰§è¡Œã€‚\n\næˆ‘ä»¬ä»£ç ä¸­æœ‰ä¸€ä¸ªå½©è›‹----> ID\n\nè¿™ä¸ªIDæœ‰ä»€ä¹ˆç”¨ï¼Ÿ\n\nå°±æ˜¯ç”¨äº`clearTimeout`\n\nç›´æ¥ä¼ å…¥IDï¼Œç„¶åå¾ªç¯æ‰¾åˆ°ä»–ï¼Œå°±å¯ä»¥ç›´æ¥ä»é˜Ÿåˆ—é‡Œé¢åˆ æ‰å°±å¥½äº†ã€‚\n\nè¿™é‡Œå°±ä¸éœ€è¦è´´ä»£ç äº†å§ï¼Ÿ\n\n### å†·çŸ¥è¯†\n\n- **å¦‚æœ setTimeout å­˜åœ¨åµŒå¥—è°ƒç”¨ï¼Œé‚£ä¹ˆç³»ç»Ÿä¼šè®¾ç½®æœ€çŸ­æ—¶é—´é—´éš”ä¸º 4 æ¯«ç§’**\n- **æœªæ¿€æ´»çš„é¡µé¢ï¼ŒsetTimeout æ‰§è¡Œæœ€å°é—´éš”æ˜¯ 1000 æ¯«ç§’**\n  - é™¤äº†å‰é¢çš„ 4 æ¯«ç§’å»¶è¿Ÿï¼Œè¿˜æœ‰ä¸€ä¸ªå¾ˆå®¹æ˜“è¢«å¿½ç•¥çš„åœ°æ–¹ï¼Œé‚£å°±æ˜¯æœªè¢«æ¿€æ´»çš„é¡µé¢ä¸­å®šæ—¶å™¨æœ€å°å€¼å¤§äº 1000 æ¯«ç§’ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ ‡ç­¾ä¸æ˜¯å½“å‰çš„æ¿€æ´»æ ‡ç­¾ï¼Œé‚£ä¹ˆå®šæ—¶å™¨æœ€å°çš„æ—¶é—´é—´éš”æ˜¯ 1000 æ¯«ç§’ï¼Œç›®çš„æ˜¯ä¸ºäº†ä¼˜åŒ–åå°é¡µé¢çš„åŠ è½½æŸè€—ä»¥åŠé™ä½è€—ç”µé‡ã€‚è¿™ä¸€ç‚¹ä½ åœ¨ä½¿ç”¨å®šæ—¶å™¨çš„æ—¶å€™è¦æ³¨æ„ã€‚\n- **å»¶æ—¶æ‰§è¡Œæ—¶é—´æœ‰æœ€å¤§å€¼**\n  - é™¤äº†è¦äº†è§£å®šæ—¶å™¨çš„å›è°ƒå‡½æ•°æ—¶é—´æ¯”å®é™…è®¾å®šå€¼è¦å»¶åä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ä¸‹ï¼Œé‚£å°±æ˜¯ Chromeã€Safariã€Firefox éƒ½æ˜¯ä»¥ 32 ä¸ª bit æ¥å­˜å‚¨å»¶æ—¶å€¼çš„ï¼Œ32bit æœ€å¤§åªèƒ½å­˜æ”¾çš„æ•°å­—æ˜¯ 2147483647 æ¯«ç§’ï¼Œè¿™å°±æ„å‘³ç€ï¼Œå¦‚æœ setTimeout è®¾ç½®çš„å»¶è¿Ÿå€¼å¤§äº 2147483647 æ¯«ç§’ï¼ˆå¤§çº¦ 24.8 å¤©ï¼‰æ—¶å°±ä¼šæº¢å‡ºï¼Œè¿™å¯¼è‡´å®šæ—¶å™¨ä¼šè¢«ç«‹å³æ‰§è¡Œã€‚\n- **ä½¿ç”¨ setTimeout è®¾ç½®çš„å›è°ƒå‡½æ•°ä¸­çš„ this ä¸ç¬¦åˆç›´è§‰**\n  - è¿™é‡Œå¯ä»¥çœ‹æˆ‘ä¹‹å‰çš„æ–‡ç« ï¼Œæœ‰å¯¹thisè¿›è¡Œæ”»ç ´\n\n### æ€»ç»“\n\n- é¦–å…ˆï¼Œä¸ºäº†æ”¯æŒå®šæ—¶å™¨çš„å®ç°ï¼Œæµè§ˆå™¨å¢åŠ äº†å»¶æ—¶é˜Ÿåˆ—ã€‚\n- å…¶æ¬¡ï¼Œç”±äºæ¶ˆæ¯é˜Ÿåˆ—æ’é˜Ÿå’Œä¸€äº›ç³»ç»Ÿçº§åˆ«çš„é™åˆ¶ï¼Œé€šè¿‡ setTimeout è®¾ç½®çš„å›è°ƒä»»åŠ¡å¹¶éæ€»æ˜¯å¯ä»¥å®æ—¶åœ°è¢«æ‰§è¡Œï¼Œè¿™æ ·å°±ä¸èƒ½æ»¡è¶³ä¸€äº›å®æ—¶æ€§è¦æ±‚è¾ƒé«˜çš„éœ€æ±‚äº†ã€‚\n\n## å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡\n\nå…¶å®é€šè¿‡ä¹‹å‰çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å¯¹äº‹ä»¶å¾ªç¯å·²ç»äº†è§£çš„å·®ä¸å¤šäº†ï¼Œè¿™é‡Œä¸»è¦æ˜¯æ›´è¯¦ç»†äº†è§£ä¸€ä¸‹ä»–ä»¬ã€‚\n\n### å®ä»»åŠ¡\n\nå®ä»»åŠ¡æœ‰å“ªäº›ï¼Ÿ\n\né™¤äº†å¾®ä»»åŠ¡çš„éƒ½æ˜¯å®ä»»åŠ¡ã€‚ã€‚ã€‚\n\né‚£ä¹ˆå¾®ä»»åŠ¡æœ‰å“ªäº›ï¼Ÿ\n\n`Process.nextTick`ã€`Promise.then catch finally`(æ³¨æ„æˆ‘ä¸æ˜¯è¯´ Promise)ã€`MutationObserver`ã€‚\n\n\n\nåœ¨ä¹‹å‰çš„å­¦ä¹ æˆ‘ä»¬çŸ¥é“åœ¨å®ä»»åŠ¡ç»“æŸä¹‹åï¼Œä¼šå»æ‰§è¡Œä»–è‡ªå·±å½“å‰çš„å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚åœ¨è¿™ä¸ªå¾®ä»»åŠ¡é˜Ÿåˆ—æ‰§è¡Œå®Œæˆä¹‹åå†å»æ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡ã€‚\n\n### å¾®ä»»åŠ¡\n\nå¼‚æ­¥å‡½æ•°æœ‰ä¸¤ç§æ–¹å¼ï¼š\n\n**ç¬¬ä¸€ç§æ˜¯æŠŠå¼‚æ­¥å›è°ƒå‡½æ•°å°è£…æˆä¸€ä¸ªå®ä»»åŠ¡ï¼Œæ·»åŠ åˆ°æ¶ˆæ¯é˜Ÿåˆ—å°¾éƒ¨ï¼Œå½“å¾ªç¯ç³»ç»Ÿæ‰§è¡Œåˆ°è¯¥ä»»åŠ¡çš„æ—¶å€™æ‰§è¡Œå›è°ƒå‡½æ•°**ã€‚è¿™ç§æ¯”è¾ƒå¥½ç†è§£ï¼Œæˆ‘ä»¬å‰é¢ä»‹ç»çš„ setTimeout å’Œ XMLHttpRequest çš„å›è°ƒå‡½æ•°éƒ½æ˜¯é€šè¿‡è¿™ç§æ–¹å¼æ¥å®ç°çš„ã€‚\n\n**ç¬¬äºŒç§æ–¹å¼çš„æ‰§è¡Œæ—¶æœºæ˜¯åœ¨ä¸»å‡½æ•°æ‰§è¡Œç»“æŸä¹‹åã€å½“å‰å®ä»»åŠ¡ç»“æŸä¹‹å‰æ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œè¿™é€šå¸¸éƒ½æ˜¯ä»¥å¾®ä»»åŠ¡å½¢å¼ä½“ç°çš„**ã€‚\n\n\n\n- å¾®ä»»åŠ¡å’Œå®ä»»åŠ¡æ˜¯ç»‘å®šçš„ï¼Œæ¯ä¸ªå®ä»»åŠ¡åœ¨æ‰§è¡Œæ—¶ï¼Œä¼šåˆ›å»ºè‡ªå·±çš„å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚\n- å¾®ä»»åŠ¡çš„æ‰§è¡Œæ—¶é•¿ä¼šå½±å“åˆ°å½“å‰å®ä»»åŠ¡çš„æ—¶é•¿ã€‚æ¯”å¦‚ä¸€ä¸ªå®ä»»åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œäº§ç”Ÿäº† 100 ä¸ªå¾®ä»»åŠ¡ï¼Œæ‰§è¡Œæ¯ä¸ªå¾®ä»»åŠ¡çš„æ—¶é—´æ˜¯ 10 æ¯«ç§’ï¼Œé‚£ä¹ˆæ‰§è¡Œè¿™ 100 ä¸ªå¾®ä»»åŠ¡çš„æ—¶é—´å°±æ˜¯ 1000 æ¯«ç§’ï¼Œä¹Ÿå¯ä»¥è¯´è¿™ 100 ä¸ªå¾®ä»»åŠ¡è®©å®ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´å»¶é•¿äº† 1000 æ¯«ç§’ã€‚æ‰€ä»¥-ä½ åœ¨å†™ä»£ç çš„æ—¶å€™ä¸€å®šè¦æ³¨æ„æ§åˆ¶å¾®ä»»åŠ¡çš„æ‰§è¡Œæ—¶é•¿ã€‚\n- åœ¨ä¸€ä¸ªå®ä»»åŠ¡ä¸­ï¼Œåˆ†åˆ«åˆ›å»ºä¸€ä¸ªç”¨äºå›è°ƒçš„å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡ï¼Œæ— è®ºä»€ä¹ˆæƒ…å†µä¸‹ï¼Œå¾®ä»»åŠ¡éƒ½æ—©äºå®ä»»åŠ¡æ‰§è¡Œã€‚\n\n\n\n## æœŸæœ«è€ƒè¯•\n\n```js\nconsole.log('script start')\n\nasync function async1() {\n  await async2()\n  console.log('async1 end')\n}\nasync function async2() {\n  console.log('async2 end')\n}\nasync1()\n\nsetTimeout(function() {\n  console.log('setTimeout')\n}, 0)\n\nnew Promise(resolve => {\n  console.log('Promise')\n  resolve()\n})\n  .then(function() {\n    console.log('promise1')\n  })\n  .then(function() {\n    console.log('promise2')\n  })\n\nconsole.log('script end')\n```\n\nå¤§å®¶å¯ä»¥è‡ªå·±åœ¨æµè§ˆå™¨é‡Œé¢è¯•è¯•å§ã€‚","source":"_posts/ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šäº‹ä»¶å¾ªç¯.md","raw":"---\ntitle: ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šJavaScriptçš„æ‰§è¡Œæœºåˆ¶\ndate: 2020-08-10 21:36:40\ntags: [JavaScript]\ncategory: [é‡æ‹¾å‰ç«¯]\ncover: /image/cover/web.jpeg\n---\n\næœ€è¿‘åœ¨å†™ã€é‡æ‹¾å‰ç«¯ã€‘ç³»åˆ—ï¼Œä¸‹é¢æœ‰å‡ ä¸ªå¿«é€Ÿé€šé“ï¼Œå¤§å®¶è‡ªå–\n\n[ã€é‡è¯†å‰ç«¯ã€‘åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿](https://juejin.im/post/6850418113944420359)\n\n[ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—](https://juejin.im/post/6850418117508759566)\n\n[ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this](https://juejin.im/post/6854573215658803208)\n\n[ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šJavaScriptçš„æ‰§è¡Œæœºåˆ¶](https://juejin.im/post/6859911609633767438)\n\n[ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC](https://juejin.im/post/6860375101322461198)\n\n[ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ](https://juejin.im/post/6865204092877144077)\n\n## å‰è¨€\n\näº‹ä»¶å¾ªç¯è¿™ä¸ªäº‹æƒ…ï¼Œå…¶å®åœ¨æˆ‘ä»¬çš„å·¥ä½œä¸­æˆ–å¤šæˆ–å°‘éƒ½ä¼šç¢°åˆ°ï¼Œå¯èƒ½æˆ‘ä»¬åªæ˜¯æ²¡æœ‰å»è®¤è®¤çœŸçœŸçš„ç†è§£ä»–ï¼Œäº†è§£ä»–è€Œå·²ã€‚ä»Šå¤©æˆ‘ä»¬ä¸€èµ·æŠŠäº‹ä»¶å¾ªç¯åƒé€ã€‚\n\n## å•çº¿ç¨‹çš„JS\n\nå…¶å®ï¼Œäº‹ä»¶å¾ªç¯å°±æ˜¯å¯¹äºå•çº¿ç¨‹çš„JSåº”è¿è€Œç”Ÿçš„ã€‚\n\n- å•çº¿ç¨‹ï¼Ÿä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Œè¯¶ï¼Œæˆ‘å¥½åƒå¬è¿‡è¿›ç¨‹è¯¶ï¼Œä»–ä»¬ä¸¤å…„å¼Ÿå•¥åŒºåˆ«ï¼Ÿ\n- ä¸ºä»€ä¹ˆjsä¸€å®šè¦å•çº¿ç¨‹å•Šï¼Œæˆ‘å¬è¯´CPUä¸æ˜¯æœ‰å¾ˆå¤šæ ¸å—ï¼Ÿä¸ºä»€ä¹ˆä¸å¤šçº¿ç¨‹ï¼Ÿ\n\n### çº¿ç¨‹å’Œè¿›ç¨‹çš„çˆ±æ¨çº è‘›\n\nè¿™é‡Œæˆ‘æ¨èé˜®ä¸€å³°è€å¸ˆçš„ä¸€ç¯‡æ–‡ç«  \n\n[ç‚¹æˆ‘å­¦ä¹ ](https://www.ruanyifeng.com/blog/2013/04/processes_and_threads.html)\n\n### ä¸ºä»€ä¹ˆJSæ˜¯å•çº¿ç¨‹ï¼Ÿ\n\n> è¿™ä¸ªè¦å›åˆ°Jså†å²äº†ï¼Œå¸ƒå…°ç™»Â·è‰¾å¥‡(Brendan Eich)è€å“¥ç”¨10å¤©åˆ›é€ jsã€‚å½“æ—¶jsç”¨æ¥å¹²å˜›ï¼Œç®€å•çš„æµè§ˆå™¨äº¤äº’ï¼ŒéªŒè¯ï¼Œæ“ä½œä¸€ä¸‹domæ˜¯å§ã€‚é‚£æŠŠå®ƒè®¾è®¡æˆé‚£ä¹ˆå¤æ‚å¹²ä»€ä¹ˆï¼Œè€Œä¸”å¦‚æœå¤šçº¿ç¨‹çš„è¯ï¼Œæ“ä½œdomä¼šå‡ºç°éº»çƒ¦çš„äº‹æƒ…ï¼Œå‡è®¾ä¸€ä¸ªçº¿ç¨‹è¯»å–DOMèŠ‚ç‚¹æ•°æ®çš„åŒæ—¶ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹æŠŠé‚£ä¸ªDOMèŠ‚ç‚¹åˆ äº†ï¼Œå‘µå‘µã€‚æ‰€ä»¥jsä¸€ä¸ªçº¿ç¨‹å°±å¤Ÿäº†ï¼Œä¹Ÿå°±æ˜¯ä¸€æ­¥ä¸€æ­¥é¡ºåºè¿è¡Œä¸‹æ¥ã€‚\n\n## æµè§ˆå™¨ä¸­çš„æ¶ˆæ¯é˜Ÿåˆ—å’Œäº‹ä»¶å¾ªç¯\n\nè¿™é‡Œæš‚æ—¶åªè¯´æµè§ˆå™¨ä¸­çš„å¾ªç¯äº‹ä»¶å¾ªç¯ï¼Œæœ‰å…³nodeçš„è¯å¯èƒ½æœ‰äº›ç»†å¾®çš„å·®åˆ«ï¼Œä¸è¿‡åº•å±‚çš„åŸç†éƒ½æ˜¯å·®ä¸å¤šçš„ã€‚\n\n### æ³¨æ„\n\nè¿™é‡Œä¸»è¦æ˜¯ä»ä¸€ä¸ªè®¾è®¡è€…çš„è§’åº¦æ¥æ¨¡æ‹Ÿï¼Œä»é›¶æ„å»ºæµè§ˆå™¨ä¸­çš„æ—¶é—´å¾ªç¯ã€‚ä¸ºäº†èƒ½è®©ä½ æ›´åŠ æ·±åˆ»åœ°ç†è§£äº‹ä»¶å¾ªç¯æœºåˆ¶ï¼Œæˆ‘ä»¬å°±ä»æœ€ç®€å•çš„åœºæ™¯æ¥åˆ†æï¼Œç„¶åå¸¦ä½ ä¸€æ­¥æ­¥äº†è§£æµè§ˆå™¨é¡µé¢ä¸»çº¿ç¨‹æ˜¯å¦‚ä½•è¿ä½œçš„ã€‚\n\n### å¼€å§‹\n\n#### äº‹å…ˆçº¦å®šå¥½çš„æ‰§è¡Œé¡ºåº\n\nå‡å¦‚æˆ‘æœ‰ä»¥ä¸‹å‡ ä¸ªä»»åŠ¡\n\n```js\nvar num1 = 1+2; // ä»»åŠ¡ 1\nvar num2 = 20/5; // ä»»åŠ¡ 2\nvar num3 = 7*8; // ä»»åŠ¡ 3\nconsole.log(num1, num2, num3)ï¼› // ä»»åŠ¡ 4\n```\n\n\n\nå¦‚æœè®©æˆ‘æ¥è®¾è®¡ï¼Œæˆ‘å°±ä¼šæœ‰ä¸€ä¸ªä¸»çº¿ç¨‹ï¼Œç„¶åæŠŠä»–ä»¬æŒ‰é¡ºåºæ’è¿›å»ï¼Œç„¶åé¡ºåºæ‰§è¡Œã€‚\n\n\n\n```js\nfunction mainThread(){\n  var num1 = 1+2; // ä»»åŠ¡ 1\n  var num2 = 20/5; // ä»»åŠ¡ 2\n  var num3 = 7*8; // ä»»åŠ¡ 3\n  console.log(num1, num2, num3)ï¼› // ä»»åŠ¡ 4\n}\n```\n\nğŸ˜¯ï¼Œæˆ‘ä»¬å·²ç»è®¾è®¡äº†æœ€ç®€å•çš„çº¿ç¨‹å•¦ã€‚\n\n#### çº¿ç¨‹è¿è¡Œä¸­ï¼Œå¤„ç†çªå‘äº‹ä»¶\n\nå¾ˆå¤šæ—¶å€™ï¼Œæ‰€æœ‰çš„ä»»åŠ¡ä¸æ˜¯ä¹‹å‰å°±ç»Ÿä¸€å®‰æ’å¥½çš„ï¼Œæ¯”å¦‚âŒ¨ï¸çš„è¾“å…¥ï¼ŒğŸ–±çš„ç‚¹å‡»ç­‰ç­‰ã€‚\n\nå¦‚æœæƒ³è¦åœ¨çº¿ç¨‹è¿è¡Œä¸­å¯ä»¥å¾ˆå¥½çš„å¤„ç†è¿™äº›äº‹ä»¶ã€‚å°±éœ€è¦\n\n ====>äº‹ä»¶å¾ªç¯ã€‚è¿™é‡Œæˆ‘ä»¬ç”¨whileæ¥å®ç°ç®€å•çš„äº‹ä»¶å¾ªç¯\n\n```js\nfunction awaitt() {\n  return new Promise(resolve => {\n    document.addEventListener('keydown', resolve);\n  });\n}\n\nasync function mainThread() {\n  while(true){\n    const result = await awaitt();\n    console.log(result);\n  }\n}\n\nmainThread();\n```\n\nè¿™æ ·æ”¹ç‰ˆä¹‹åæœ‰äº†ä»¥ä¸‹å‡ ç‚¹æ”¹è¿›ï¼š\n\n- å¼•å…¥äº†å¾ªç¯æœºåˆ¶\n- å¼•å…¥äº‹ä»¶ï¼Œç„¶åæ•´ä¸ªçº¿ç¨‹åœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œæ´»äº†èµ·æ¥ï¼Œä¸å†æ˜¯æ­»çš„ï¼Œè¿è¡Œå®Œå°±æ»šè›‹äº†çš„é‚£ç§ï¼Œæœ‰äº†äº¤äº’äº†\n\nï¼ˆğŸ¤«æœ€ç®€å•çš„å®ç°ã€‚ã€‚ã€‚åˆ«åæ§½ä»£ç ï¼Œéƒ½æ˜¯æœ€ç®€å•çš„å®ç°å’Œæœ€ç®€å•çš„åœºæ™¯ï¼ŒåŠ©äºç†è§£è€Œå·²ã€‚ã€‚ã€‚ï¼‰\n\n#### å¤„ç†å…¶ä»–çº¿ç¨‹çš„ä»»åŠ¡\n\nä¸Šé¢çš„ç‰ˆæœ¬ç”¨äº†äº‹ä»¶å¾ªç¯çš„æ–¹å¼æ¥è·å–å†…éƒ¨çš„äº‹ä»¶ï¼Œä½†æ˜¯å¯¹äºå¤–éƒ¨çªå‘æƒ…å†µçš„äº‹ä»¶æ˜¯æ— æ³•è§£å†³çš„ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦å‡çº§~\n\né‚£ä¹ˆæ€ä¹ˆè®¾è®¡å¥½ä¸€ä¸ªçº¿ç¨‹æ¨¡å‹å‘¢ï¼Ÿæˆ‘ä»¬æ¢ä¸ªè§’åº¦æƒ³æƒ³æ€è·¯é©¬ä¸Šå°±å‡ºæ¥äº†ã€‚\n\nè¿™äº›å¤–éƒ¨çš„ä»»åŠ¡ï¼Œéƒ½æ˜¯æœ‰å…ˆåé¡ºåºçš„ï¼Œå“ªæ€•æ˜¯éƒ½æ˜¯çªå‘æƒ…å†µã€‚ä»–ä»¬ä¹Ÿæ˜¯æœ‰å…ˆåé¡ºåºã€‚\n\næ‰€ä»¥ä¸€ä¸ªæ¯”è¾ƒé€šç”¨çš„æ¨¡å¼å°±æ˜¯\n\n======> æ¶ˆæ¯é˜Ÿåˆ—\n\n> æ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œå¯ä»¥å­˜æ”¾è¦æ‰§è¡Œçš„ä»»åŠ¡ã€‚å®ƒç¬¦åˆé˜Ÿåˆ—â€œå…ˆè¿›å…ˆå‡ºâ€çš„ç‰¹ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´è¦æ·»åŠ ä»»åŠ¡çš„è¯ï¼Œæ·»åŠ åˆ°é˜Ÿåˆ—çš„å°¾éƒ¨ï¼›è¦å–å‡ºä»»åŠ¡çš„è¯ï¼Œä»é˜Ÿåˆ—å¤´éƒ¨å»å–ã€‚\n\næˆ‘ä»¬è¦å®Œæˆä»¥ä¸‹å‡ ä¸ªæ“ä½œï¼š\n\n1. æ·»åŠ ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼›\n2. IO çº¿ç¨‹ä¸­äº§ç”Ÿçš„æ–°ä»»åŠ¡æ·»åŠ è¿›æ¶ˆæ¯é˜Ÿåˆ—å°¾éƒ¨ï¼›\n3. æ¸²æŸ“ä¸»çº¿ç¨‹ä¼šå¾ªç¯åœ°ä»æ¶ˆæ¯é˜Ÿåˆ—å¤´éƒ¨ä¸­è¯»å–ä»»åŠ¡ï¼Œæ‰§è¡Œä»»åŠ¡ã€‚\n\n\n\n```js\nconst arrTask = []\n\nfunction addTask(fn) {\n  arrTask.push(fn)\n}\n\nfunction otherThread() {\n  addTask(() => {console.log('other')})\n}\n\nfunction awaitt() {\n  return new Promise(resolve => {\n      if(arrTask.length) {\n        const task = arrTask.shift()\n        task()\n        resolve()\n      }\n  });\n}\n\nasync function mainThread() {\n  while(true){\n    \tawait awaitt();\n  }\n}\n\n\naddTask(()=>console.log('in'))\naddTask(()=>console.log('in'))\naddTask(()=>console.log('in'))\n\nmainThread();\notherThread()\n```\n\n\n\næˆ‘ä»¬ç”¨ä¸€ä¸ªæ•°ç»„æ¥æ¨¡æ‹Ÿä¸€ä¸ªé˜Ÿåˆ—ã€‚\n\næ—¢åŸºç¡€äº†å†…éƒ¨çš„ä»»åŠ¡ï¼Œä¹Ÿå¤„ç†äº†å¤–éƒ¨çªå‘çš„ä»»åŠ¡\n\næœ‰ä»»åŠ¡è¿›æ¥ï¼Œ å°±ä¼šæ‰§è¡Œä»»åŠ¡ã€‚\n\n\n\n#### é€€å‡ºä¸»çº¿ç¨‹\n\nå½“é¡µé¢ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæˆä¹‹åï¼Œåˆè¯¥å¦‚ä½•ä¿è¯é¡µé¢ä¸»çº¿ç¨‹èƒ½å¤Ÿå®‰å…¨é€€å‡ºå‘¢ï¼ŸChrome æ˜¯è¿™æ ·è§£å†³çš„ï¼Œç¡®å®šè¦é€€å‡ºå½“å‰é¡µé¢æ—¶ï¼Œé¡µé¢ä¸»çº¿ç¨‹ä¼šè®¾ç½®ä¸€ä¸ªé€€å‡ºæ ‡å¿—çš„å˜é‡ï¼Œåœ¨æ¯æ¬¡æ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰è®¾ç½®é€€å‡ºæ ‡å¿—ã€‚\n\n\n\n```js\nconst arrTask = []\nlet over = false\n\nfunction addTask(fn) {\n  arrTask.push(fn)\n}\n\nfunction otherThread() {\n  addTask(() => {console.log('other')})\n}\n\nfunction awaitt() {\n  return new Promise(resolve => {\n      if(arrTask.length) {\n        const task = arrTask.shift()\n        task()\n        if(!arrTask.length){\n          over = true\n        }\n        resolve()\n      }\n  });\n}\n\nasync function mainThread() {\n  while(true){\n    if(over){\n      break;\n    }\n    \tawait awaitt();\n  }\n}\n\n\naddTask(()=>console.log('in'))\naddTask(()=>console.log('in'))\naddTask(()=>console.log('in'))\n\nmainThread();\notherThread()\n```\n\n\n\n### å•çº¿ç¨‹çš„ç¼ºç‚¹\n\né€šè¿‡ä¸Šé¢çš„ä»‹ç»ï¼Œä½ åº”è¯¥æ¸…æ¥šäº†ï¼Œé¡µé¢çº¿ç¨‹æ‰€æœ‰æ‰§è¡Œçš„ä»»åŠ¡éƒ½æ¥è‡ªäºæ¶ˆæ¯é˜Ÿåˆ—ã€‚æ¶ˆæ¯é˜Ÿåˆ—æ˜¯â€œå…ˆè¿›å…ˆå‡ºâ€çš„å±æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´æ”¾å…¥é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œéœ€è¦ç­‰å¾…å‰é¢çš„ä»»åŠ¡è¢«æ‰§è¡Œå®Œï¼Œæ‰ä¼šè¢«æ‰§è¡Œã€‚é‰´äºè¿™ä¸ªå±æ€§ï¼Œå°±æœ‰å¦‚ä¸‹ä¸¤ä¸ªé—®é¢˜éœ€è¦è§£å†³ã€‚\n\n#### å¦‚ä½•å¤„ç†é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡\n\nåœºæ™¯ï¼š\n\nå‡å¦‚ï¼Œæˆ‘ç°åœ¨æœ‰ä¸€å¤§ä¸²çš„ä»»åŠ¡åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œã€‚\n\næˆ‘çš„domèŠ‚ç‚¹å˜åŒ–çš„æ—¶å€™ï¼Œæˆ‘éœ€è¦å‘é€è¯·æ±‚æˆ–è€…æç¤ºä¸€ä¸ª`alert`ä¹‹ç±»çš„ä¸šåŠ¡é€»è¾‘è¦æ‰§è¡Œã€‚\n\nç°åœ¨å¯è¡Œçš„æœ‰ä¸¤ç§æ–¹æ¡ˆï¼š\n\n- domèŠ‚ç‚¹å˜åŒ–çš„è¯ï¼Œæˆ‘å°±åœä¸‹ç°åœ¨æ­£åœ¨è¿è¡Œçš„ä¸»çº¿ç¨‹ä¸Šçš„ä»»åŠ¡ï¼Œç„¶åè°ƒç”¨æˆ‘éœ€è¦æ‰§è¡Œçš„ä¸šåŠ¡é€»è¾‘ã€‚è¿™æ ·ç¡®å®å…·æœ‰å®æ•ˆæ€§ï¼Œä½†æ˜¯ï¼è¿™æ ·ä¼šä½¿å¾—å½“å‰ä»»åŠ¡çš„æ•ˆç‡æåº¦é™ä½ï¼Œæ¯”å¦‚æˆ‘çš„domèŠ‚ç‚¹å˜åŒ–200æ¬¡ï¼Œé‚£å²‚ä¸æ˜¯å½“å‰çš„ä»»åŠ¡ç‰¹åˆ«ä¹…äº†å—ï¼Ÿ\n- ç¬¬äºŒä¸ªæ–¹æ³•å°±å¯ä»¥è§£å†³ä¸Šè¿°çš„é—®é¢˜ï¼šä¸€æ—¦domèŠ‚ç‚¹æœ‰å˜åŒ–ï¼Œå“ªæ€•æ˜¯200000æ¬¡å˜åŒ–ï¼Œæˆ‘éƒ½æ˜¯å°†ä¸šåŠ¡é€»è¾‘pushåˆ°é˜Ÿåˆ—çš„å°¾éƒ¨ï¼Œè¿™æ ·å°±ä¸ä¼šå½±å“å½“å‰ä»»åŠ¡è¿›è¡Œä»¥åŠæ•ˆç‡äº†ã€‚ä½†æ˜¯ï¼è¿™æ ·çš„è¯æˆ‘çš„å®æ•ˆæ€§å°±è«å¾—äº†ã€‚å°±è«å¾—äº†ã€‚\n\næ€»ç»“ä¸€ä¸‹ï¼šå…¶å®å°±æ˜¯å®æ•ˆæ€§å’Œä»»åŠ¡æ•ˆç‡çš„æƒè¡¡é—®é¢˜ç½¢äº†ã€‚\n\næ±Ÿæ±Ÿæ±Ÿ~\n\nå¾®ä»»åŠ¡å°±åº”è¿è€Œç”Ÿå•¦ã€‚\n\nåŠ å…¥æˆ‘ä»¬æŠŠä»»åŠ¡é˜Ÿåˆ—é‡Œé¢çš„æ¯ä¸ªä»»åŠ¡éƒ½ç§°ä½œå®ä»»åŠ¡çš„è¯ï¼Œæ¯ä¸ªå®ä»»åŠ¡é‡Œé¢éƒ½ä¼šåŒ…å«ä¸€ä¸ªå¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚æ¯ä¸ªå®ä»»åŠ¡ç»“æŸä¹‹åï¼Œéƒ½å›å»æ¸…ç†ä¸€éå¾®ä»»åŠ¡é˜Ÿåˆ—é‡Œé¢çš„é˜Ÿåˆ—ï¼Œè¿™æ ·çš„è¯æ—¢ä¿æŠ¤äº†å®æ•ˆæ€§ï¼Œä¹Ÿä¿æŠ¤äº†ä»»åŠ¡çš„æ•ˆç‡ã€‚\n\n\n\n#### å¦‚ä½•å¤„ç†è°ƒç”¨æ—¶é—´è¿‡é•¿çš„é—®é¢˜\n\næˆ‘ä»¬éƒ½çŸ¥é“jsæ˜¯å•çº¿ç¨‹çš„ã€‚å¦‚æœç°åœ¨åœ¨æ‰§è¡Œä¸€ä¸ªä»»åŠ¡çš„æƒ…å†µä¸‹ã€‚å…¶ä»–ä»»åŠ¡å°±æ˜¯è¦ç­‰å¾…çš„ã€‚é‚£ä¹ˆå°±ä¼šå‡ºç°æŸä¸ªä»»åŠ¡è®¡ç®—çš„å‘¨æœŸç‰¹åˆ«é•¿ï¼Œå¯¼è‡´åˆ«äººéƒ½åœ¨ç­‰å¾…ã€‚\n\nğŸ‘Œï¼Œæˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹\n\n```js\nwhile(true){}\nalter(123)\n```\n\nä¸‹é¢çš„`alter`æ°¸è¿œéƒ½ä¸ä¼šæ‰§è¡Œäº†ã€‚å› ä¸º`while`åœ¨å·¥ä½œï¼Œ`alter`åœ¨ç­‰ä»–æŠŠèµ„æºè®©å‡ºæ¥ã€‚\n\nå‡å¦‚è¯´ï¼Œæˆ‘ç°åœ¨æœ‰ä¸€ä¸ªåŠ¨ç”»è¦è¿›è¡Œï¼Œä½†æ˜¯è¿è¡Œå®Œä¸€å¸§ä¹‹åï¼Œæœ‰ä¸€ä¸ªæå…¶å¤æ‚çš„è®¡ç®—ï¼Œå¯¼è‡´äº†æˆ‘çš„åŠ¨ç”»ä¸æµç•…ï¼Œé‚£ä¹ˆç”¨æˆ·å¯èƒ½å°±ä¼šéå¸¸çš„çƒ¦ã€‚è¿™ä¸æ˜¯æˆ‘ä»¬å¸Œæœ›çœ‹åˆ°çš„ã€‚\n\næ‰€ä»¥jsæœ‰ä¸€ä¸ªå›è°ƒæœºåˆ¶ï¼Œåˆ°äº†ç‰¹å®šçš„æ—¶é—´ç‚¹äº†ï¼Œå›è°ƒä¸€ä¸‹ï¼ŒæŠŠåŠ¨ç”»çš„ä¸‹ä¸€å¸§æ‰§è¡Œä¸€ä¸‹ï¼Œç„¶åç»§ç»­å½“å‰çš„å¤æ‚è®¡ç®—ã€‚\n\n### æ€»ç»“\n\n- å¦‚æœæœ‰ä¸€äº›ç¡®å®šå¥½çš„ä»»åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå•çº¿ç¨‹æ¥æŒ‰ç…§é¡ºåºå¤„ç†è¿™äº›ä»»åŠ¡ï¼Œè¿™æ˜¯ç¬¬ä¸€ç‰ˆçº¿ç¨‹æ¨¡å‹ã€‚\n- è¦åœ¨çº¿ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­æ¥æ”¶å¹¶å¤„ç†æ–°çš„ä»»åŠ¡ï¼Œå°±éœ€è¦å¼•å…¥å¾ªç¯è¯­å¥å’Œäº‹ä»¶ç³»ç»Ÿï¼Œè¿™æ˜¯ç¬¬äºŒç‰ˆçº¿ç¨‹æ¨¡å‹ã€‚\n- å¦‚æœè¦æ¥æ”¶å…¶ä»–çº¿ç¨‹å‘é€è¿‡æ¥çš„ä»»åŠ¡ï¼Œå°±éœ€è¦å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¿™æ˜¯ç¬¬ä¸‰ç‰ˆçº¿ç¨‹æ¨¡å‹ã€‚\n- å¦‚æœå…¶ä»–è¿›ç¨‹æƒ³è¦å‘é€ä»»åŠ¡ç»™é¡µé¢ä¸»çº¿ç¨‹ï¼Œé‚£ä¹ˆå…ˆé€šè¿‡ IPC æŠŠä»»åŠ¡å‘é€ç»™æ¸²æŸ“è¿›ç¨‹çš„ IO çº¿ç¨‹ï¼ŒIO çº¿ç¨‹å†æŠŠä»»åŠ¡å‘é€ç»™é¡µé¢ä¸»çº¿ç¨‹ã€‚\n- æ¶ˆæ¯é˜Ÿåˆ—æœºåˆ¶å¹¶ä¸æ˜¯å¤ªçµæ´»ï¼Œä¸ºäº†é€‚åº”æ•ˆç‡å’Œå®æ—¶æ€§ï¼Œå¼•å…¥äº†å¾®ä»»åŠ¡\n\nåŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„è®¾è®¡æ˜¯ç›®å‰ä½¿ç”¨æœ€å¹¿çš„æ¶ˆæ¯æ¶æ„ï¼Œæ— è®ºæ˜¯å®‰å“è¿˜æ˜¯ Chrome éƒ½é‡‡ç”¨äº†ç±»ä¼¼çš„ä»»åŠ¡æœºåˆ¶ï¼Œæ‰€ä»¥ç†è§£äº†æœ¬ç¯‡æ–‡ç« çš„å†…å®¹åï¼Œä½ å†ç†è§£å…¶ä»–é¡¹ç›®çš„ä»»åŠ¡æœºåˆ¶ä¹Ÿä¼šæ¯”è¾ƒè½»æ¾ã€‚\n\n## æµè§ˆå™¨æ˜¯æ€ä¹ˆå®ç°setTimeout\n\nè¦æƒ³çŸ¥é“æµè§ˆå™¨æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œæˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹ï¼Œæˆ‘ä»¬ä¹‹å‰è®¾è®¡çš„é‚£ä¸ªäº‹ä»¶å¾ªç¯ç³»ç»Ÿï¼š\n\næœ‰xxä»»åŠ¡äº†ï¼Œokï¼Œæˆ‘`push`åˆ°ä»»åŠ¡é˜Ÿåˆ—ã€‚ä»¥æ­¤å¾ªç¯ã€‚\n\næ‰€ä»¥æˆ‘ä»¬å†™åœ¨`setTimeout`é‡Œé¢çš„å‡½æ•°æ‰§è¡Œå…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªä»»åŠ¡ï¼Œä¹Ÿæ˜¯éœ€è¦pushåˆ°ä»»åŠ¡é˜Ÿåˆ—å»çš„ã€‚\n\nä½†æ˜¯ï¼Œæˆ‘ä»¬çš„è¿™ä¸ªæ˜¯å…¶å®æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„å‡½æ•°ï¼Œä¸èƒ½ç›´æ¥å°†æ•´ä¸ªå‡½æ•°pushåˆ°é˜Ÿåˆ—ä¸­ï¼Œå¦åˆ™çš„è¯æˆ‘ä»¬çš„å®æ•ˆæ€§å°±å¾ˆæœ‰å¯èƒ½å‡ºé”™äº†ï¼Œæ¯”å¦‚æˆ‘å¸Œæœ›ä»–åœ¨24å°æ—¶ä¹‹å`alter`å‘Šè¯‰æˆ‘å·²ç»åˆ°äº†ç¬¬äºŒå¤©äº†ã€‚ä»–å¦‚æœæ˜¯ç›´æ¥pushåˆ°ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ²¡æœ‰åˆ°ç¬¬äºŒå¤©å°±ä¼šå‘Šè¯‰æˆ‘ç¬¬äºŒå¤©åˆ°äº†ï¼Œè¿™ä¸æ˜¯è®©ç”¨æˆ·åŒªå¤·æ‰€æ€å˜›ã€‚\n\næ‰€ä»¥è‚¯å®šä¸æ˜¯ç›´æ¥`push`çš„ã€‚é‚£åˆæ˜¯æ€ä¹ˆå¼„å¾—å˜ï¼Ÿ\n\nä½ ä¹Ÿå¯ä»¥æ€è€ƒä¸‹ï¼Œå¦‚æœè®©ä½ åœ¨æ¶ˆæ¯å¾ªç¯ç³»ç»Ÿçš„åŸºç¡€ä¹‹ä¸ŠåŠ ä¸Šå®šæ—¶å™¨çš„åŠŸèƒ½ï¼Œä½ ä¼šå¦‚ä½•è®¾è®¡ï¼Ÿ\n\nåœ¨ Chrome ä¸­é™¤äº†æ­£å¸¸ä½¿ç”¨çš„æ¶ˆæ¯é˜Ÿåˆ—ä¹‹å¤–ï¼Œè¿˜æœ‰å¦å¤–ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¿™ä¸ªé˜Ÿåˆ—ä¸­ç»´æŠ¤äº†éœ€è¦å»¶è¿Ÿæ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨ï¼ŒåŒ…æ‹¬äº†å®šæ—¶å™¨å’Œ Chromium å†…éƒ¨ä¸€äº›éœ€è¦å»¶è¿Ÿæ‰§è¡Œçš„ä»»åŠ¡ã€‚æ‰€ä»¥å½“é€šè¿‡ JavaScript åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨æ—¶ï¼Œæ¸²æŸ“è¿›ç¨‹ä¼šå°†è¯¥å®šæ—¶å™¨çš„å›è°ƒä»»åŠ¡æ·»åŠ åˆ°å»¶è¿Ÿé˜Ÿåˆ—ä¸­\n\næˆ‘ä»¬æŠŠä¹‹å‰çš„äº‹ä»¶å¾ªç¯æ¨¡æ‹Ÿæ”¹ä¸€ä¸‹\n\n```js\nconst mainTask = [\n  fn1,\n  fn2,\n  fn3,\n  â€¦â€¦\n]\n\nconst setTimeoutTask = []\n\nfunction addSetTimeoutTask(fn, timeout){\n  setTimeoutTask.push({\n    fn: fn,\n    id: Math.random(),\n    useTime: timeout + ((new Date()).getTime()\n  })\n}\n\nconst runSetTimeoutTask (){\n  const runList = []\n  setTimeoutTask.forEach(item => {\n    // å·²ç»è¿‡äº†æ—¶é—´ï¼Œæˆ–è€…åˆšåˆšå¥½åˆ°æ—¶é—´çš„è¯å°±å–å‡ºæ¥ã€‚å¾…ä¼šä¸€èµ·æ‰§è¡Œäº†\n    if(item.useTime <= ((new Date()).getTime()) {\n      runList.push(item.fn) \n    }\n  })\n  if(runList.length) {\n    const fn = runList.shift()\n    fn()\n  }\n}\n\nasync function mainThread() {\n  while(true){\n    const task = arrTask.shift()\n    \n    // æ¯æ¬¡æ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡ï¼Œéƒ½å›å»æŸ¥æ‰¾ä¸€ä¸‹å»¶è¿Ÿé˜Ÿåˆ—é‡Œé¢æœ‰æ²¡æœ‰åˆ°ç‚¹çš„å‡½æ•°\n    if(setTimeoutTask.length) {\n       runSetTimeoutTask()\n    }\n  }\n}\n\nmainThread();\n```\n\næ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä¼šçœ‹åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯å…¶å®ä½ åˆ°ç‚¹äº†å¯èƒ½è¦ä¸ä¼šç«‹åˆ»æ‰§è¡Œï¼Œå¿…é¡»ç­‰åˆ°ä¹‹å‰çš„ä»»åŠ¡æ‰§è¡Œå®Œäº†æ‰è½®åˆ°å»¶è¿Ÿé˜Ÿåˆ—çš„æŸ¥è¯¢å’Œæ‰§è¡Œã€‚\n\næˆ‘ä»¬ä»£ç ä¸­æœ‰ä¸€ä¸ªå½©è›‹----> ID\n\nè¿™ä¸ªIDæœ‰ä»€ä¹ˆç”¨ï¼Ÿ\n\nå°±æ˜¯ç”¨äº`clearTimeout`\n\nç›´æ¥ä¼ å…¥IDï¼Œç„¶åå¾ªç¯æ‰¾åˆ°ä»–ï¼Œå°±å¯ä»¥ç›´æ¥ä»é˜Ÿåˆ—é‡Œé¢åˆ æ‰å°±å¥½äº†ã€‚\n\nè¿™é‡Œå°±ä¸éœ€è¦è´´ä»£ç äº†å§ï¼Ÿ\n\n### å†·çŸ¥è¯†\n\n- **å¦‚æœ setTimeout å­˜åœ¨åµŒå¥—è°ƒç”¨ï¼Œé‚£ä¹ˆç³»ç»Ÿä¼šè®¾ç½®æœ€çŸ­æ—¶é—´é—´éš”ä¸º 4 æ¯«ç§’**\n- **æœªæ¿€æ´»çš„é¡µé¢ï¼ŒsetTimeout æ‰§è¡Œæœ€å°é—´éš”æ˜¯ 1000 æ¯«ç§’**\n  - é™¤äº†å‰é¢çš„ 4 æ¯«ç§’å»¶è¿Ÿï¼Œè¿˜æœ‰ä¸€ä¸ªå¾ˆå®¹æ˜“è¢«å¿½ç•¥çš„åœ°æ–¹ï¼Œé‚£å°±æ˜¯æœªè¢«æ¿€æ´»çš„é¡µé¢ä¸­å®šæ—¶å™¨æœ€å°å€¼å¤§äº 1000 æ¯«ç§’ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ ‡ç­¾ä¸æ˜¯å½“å‰çš„æ¿€æ´»æ ‡ç­¾ï¼Œé‚£ä¹ˆå®šæ—¶å™¨æœ€å°çš„æ—¶é—´é—´éš”æ˜¯ 1000 æ¯«ç§’ï¼Œç›®çš„æ˜¯ä¸ºäº†ä¼˜åŒ–åå°é¡µé¢çš„åŠ è½½æŸè€—ä»¥åŠé™ä½è€—ç”µé‡ã€‚è¿™ä¸€ç‚¹ä½ åœ¨ä½¿ç”¨å®šæ—¶å™¨çš„æ—¶å€™è¦æ³¨æ„ã€‚\n- **å»¶æ—¶æ‰§è¡Œæ—¶é—´æœ‰æœ€å¤§å€¼**\n  - é™¤äº†è¦äº†è§£å®šæ—¶å™¨çš„å›è°ƒå‡½æ•°æ—¶é—´æ¯”å®é™…è®¾å®šå€¼è¦å»¶åä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ä¸‹ï¼Œé‚£å°±æ˜¯ Chromeã€Safariã€Firefox éƒ½æ˜¯ä»¥ 32 ä¸ª bit æ¥å­˜å‚¨å»¶æ—¶å€¼çš„ï¼Œ32bit æœ€å¤§åªèƒ½å­˜æ”¾çš„æ•°å­—æ˜¯ 2147483647 æ¯«ç§’ï¼Œè¿™å°±æ„å‘³ç€ï¼Œå¦‚æœ setTimeout è®¾ç½®çš„å»¶è¿Ÿå€¼å¤§äº 2147483647 æ¯«ç§’ï¼ˆå¤§çº¦ 24.8 å¤©ï¼‰æ—¶å°±ä¼šæº¢å‡ºï¼Œè¿™å¯¼è‡´å®šæ—¶å™¨ä¼šè¢«ç«‹å³æ‰§è¡Œã€‚\n- **ä½¿ç”¨ setTimeout è®¾ç½®çš„å›è°ƒå‡½æ•°ä¸­çš„ this ä¸ç¬¦åˆç›´è§‰**\n  - è¿™é‡Œå¯ä»¥çœ‹æˆ‘ä¹‹å‰çš„æ–‡ç« ï¼Œæœ‰å¯¹thisè¿›è¡Œæ”»ç ´\n\n### æ€»ç»“\n\n- é¦–å…ˆï¼Œä¸ºäº†æ”¯æŒå®šæ—¶å™¨çš„å®ç°ï¼Œæµè§ˆå™¨å¢åŠ äº†å»¶æ—¶é˜Ÿåˆ—ã€‚\n- å…¶æ¬¡ï¼Œç”±äºæ¶ˆæ¯é˜Ÿåˆ—æ’é˜Ÿå’Œä¸€äº›ç³»ç»Ÿçº§åˆ«çš„é™åˆ¶ï¼Œé€šè¿‡ setTimeout è®¾ç½®çš„å›è°ƒä»»åŠ¡å¹¶éæ€»æ˜¯å¯ä»¥å®æ—¶åœ°è¢«æ‰§è¡Œï¼Œè¿™æ ·å°±ä¸èƒ½æ»¡è¶³ä¸€äº›å®æ—¶æ€§è¦æ±‚è¾ƒé«˜çš„éœ€æ±‚äº†ã€‚\n\n## å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡\n\nå…¶å®é€šè¿‡ä¹‹å‰çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å¯¹äº‹ä»¶å¾ªç¯å·²ç»äº†è§£çš„å·®ä¸å¤šäº†ï¼Œè¿™é‡Œä¸»è¦æ˜¯æ›´è¯¦ç»†äº†è§£ä¸€ä¸‹ä»–ä»¬ã€‚\n\n### å®ä»»åŠ¡\n\nå®ä»»åŠ¡æœ‰å“ªäº›ï¼Ÿ\n\né™¤äº†å¾®ä»»åŠ¡çš„éƒ½æ˜¯å®ä»»åŠ¡ã€‚ã€‚ã€‚\n\né‚£ä¹ˆå¾®ä»»åŠ¡æœ‰å“ªäº›ï¼Ÿ\n\n`Process.nextTick`ã€`Promise.then catch finally`(æ³¨æ„æˆ‘ä¸æ˜¯è¯´ Promise)ã€`MutationObserver`ã€‚\n\n\n\nåœ¨ä¹‹å‰çš„å­¦ä¹ æˆ‘ä»¬çŸ¥é“åœ¨å®ä»»åŠ¡ç»“æŸä¹‹åï¼Œä¼šå»æ‰§è¡Œä»–è‡ªå·±å½“å‰çš„å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚åœ¨è¿™ä¸ªå¾®ä»»åŠ¡é˜Ÿåˆ—æ‰§è¡Œå®Œæˆä¹‹åå†å»æ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡ã€‚\n\n### å¾®ä»»åŠ¡\n\nå¼‚æ­¥å‡½æ•°æœ‰ä¸¤ç§æ–¹å¼ï¼š\n\n**ç¬¬ä¸€ç§æ˜¯æŠŠå¼‚æ­¥å›è°ƒå‡½æ•°å°è£…æˆä¸€ä¸ªå®ä»»åŠ¡ï¼Œæ·»åŠ åˆ°æ¶ˆæ¯é˜Ÿåˆ—å°¾éƒ¨ï¼Œå½“å¾ªç¯ç³»ç»Ÿæ‰§è¡Œåˆ°è¯¥ä»»åŠ¡çš„æ—¶å€™æ‰§è¡Œå›è°ƒå‡½æ•°**ã€‚è¿™ç§æ¯”è¾ƒå¥½ç†è§£ï¼Œæˆ‘ä»¬å‰é¢ä»‹ç»çš„ setTimeout å’Œ XMLHttpRequest çš„å›è°ƒå‡½æ•°éƒ½æ˜¯é€šè¿‡è¿™ç§æ–¹å¼æ¥å®ç°çš„ã€‚\n\n**ç¬¬äºŒç§æ–¹å¼çš„æ‰§è¡Œæ—¶æœºæ˜¯åœ¨ä¸»å‡½æ•°æ‰§è¡Œç»“æŸä¹‹åã€å½“å‰å®ä»»åŠ¡ç»“æŸä¹‹å‰æ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œè¿™é€šå¸¸éƒ½æ˜¯ä»¥å¾®ä»»åŠ¡å½¢å¼ä½“ç°çš„**ã€‚\n\n\n\n- å¾®ä»»åŠ¡å’Œå®ä»»åŠ¡æ˜¯ç»‘å®šçš„ï¼Œæ¯ä¸ªå®ä»»åŠ¡åœ¨æ‰§è¡Œæ—¶ï¼Œä¼šåˆ›å»ºè‡ªå·±çš„å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚\n- å¾®ä»»åŠ¡çš„æ‰§è¡Œæ—¶é•¿ä¼šå½±å“åˆ°å½“å‰å®ä»»åŠ¡çš„æ—¶é•¿ã€‚æ¯”å¦‚ä¸€ä¸ªå®ä»»åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œäº§ç”Ÿäº† 100 ä¸ªå¾®ä»»åŠ¡ï¼Œæ‰§è¡Œæ¯ä¸ªå¾®ä»»åŠ¡çš„æ—¶é—´æ˜¯ 10 æ¯«ç§’ï¼Œé‚£ä¹ˆæ‰§è¡Œè¿™ 100 ä¸ªå¾®ä»»åŠ¡çš„æ—¶é—´å°±æ˜¯ 1000 æ¯«ç§’ï¼Œä¹Ÿå¯ä»¥è¯´è¿™ 100 ä¸ªå¾®ä»»åŠ¡è®©å®ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´å»¶é•¿äº† 1000 æ¯«ç§’ã€‚æ‰€ä»¥-ä½ åœ¨å†™ä»£ç çš„æ—¶å€™ä¸€å®šè¦æ³¨æ„æ§åˆ¶å¾®ä»»åŠ¡çš„æ‰§è¡Œæ—¶é•¿ã€‚\n- åœ¨ä¸€ä¸ªå®ä»»åŠ¡ä¸­ï¼Œåˆ†åˆ«åˆ›å»ºä¸€ä¸ªç”¨äºå›è°ƒçš„å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡ï¼Œæ— è®ºä»€ä¹ˆæƒ…å†µä¸‹ï¼Œå¾®ä»»åŠ¡éƒ½æ—©äºå®ä»»åŠ¡æ‰§è¡Œã€‚\n\n\n\n## æœŸæœ«è€ƒè¯•\n\n```js\nconsole.log('script start')\n\nasync function async1() {\n  await async2()\n  console.log('async1 end')\n}\nasync function async2() {\n  console.log('async2 end')\n}\nasync1()\n\nsetTimeout(function() {\n  console.log('setTimeout')\n}, 0)\n\nnew Promise(resolve => {\n  console.log('Promise')\n  resolve()\n})\n  .then(function() {\n    console.log('promise1')\n  })\n  .then(function() {\n    console.log('promise2')\n  })\n\nconsole.log('script end')\n```\n\nå¤§å®¶å¯ä»¥è‡ªå·±åœ¨æµè§ˆå™¨é‡Œé¢è¯•è¯•å§ã€‚","slug":"ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šäº‹ä»¶å¾ªç¯","published":1,"updated":"2021-06-24T14:00:06.851Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra8i001nlwrdds0t9daa","content":"<p>æœ€è¿‘åœ¨å†™ã€é‡æ‹¾å‰ç«¯ã€‘ç³»åˆ—ï¼Œä¸‹é¢æœ‰å‡ ä¸ªå¿«é€Ÿé€šé“ï¼Œå¤§å®¶è‡ªå–</p>\n<p><a href=\"https://juejin.im/post/6850418113944420359\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿</a></p>\n<p><a href=\"https://juejin.im/post/6850418117508759566\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—</a></p>\n<p><a href=\"https://juejin.im/post/6854573215658803208\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this</a></p>\n<p><a href=\"https://juejin.im/post/6859911609633767438\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šJavaScriptçš„æ‰§è¡Œæœºåˆ¶</a></p>\n<p><a href=\"https://juejin.im/post/6860375101322461198\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC</a></p>\n<p><a href=\"https://juejin.im/post/6865204092877144077\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ</a></p>\n<h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><p>äº‹ä»¶å¾ªç¯è¿™ä¸ªäº‹æƒ…ï¼Œå…¶å®åœ¨æˆ‘ä»¬çš„å·¥ä½œä¸­æˆ–å¤šæˆ–å°‘éƒ½ä¼šç¢°åˆ°ï¼Œå¯èƒ½æˆ‘ä»¬åªæ˜¯æ²¡æœ‰å»è®¤è®¤çœŸçœŸçš„ç†è§£ä»–ï¼Œäº†è§£ä»–è€Œå·²ã€‚ä»Šå¤©æˆ‘ä»¬ä¸€èµ·æŠŠäº‹ä»¶å¾ªç¯åƒé€ã€‚</p>\n<h2 id=\"å•çº¿ç¨‹çš„JS\"><a href=\"#å•çº¿ç¨‹çš„JS\" class=\"headerlink\" title=\"å•çº¿ç¨‹çš„JS\"></a>å•çº¿ç¨‹çš„JS</h2><p>å…¶å®ï¼Œäº‹ä»¶å¾ªç¯å°±æ˜¯å¯¹äºå•çº¿ç¨‹çš„JSåº”è¿è€Œç”Ÿçš„ã€‚</p>\n<ul>\n<li>å•çº¿ç¨‹ï¼Ÿä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Œè¯¶ï¼Œæˆ‘å¥½åƒå¬è¿‡è¿›ç¨‹è¯¶ï¼Œä»–ä»¬ä¸¤å…„å¼Ÿå•¥åŒºåˆ«ï¼Ÿ</li>\n<li>ä¸ºä»€ä¹ˆjsä¸€å®šè¦å•çº¿ç¨‹å•Šï¼Œæˆ‘å¬è¯´CPUä¸æ˜¯æœ‰å¾ˆå¤šæ ¸å—ï¼Ÿä¸ºä»€ä¹ˆä¸å¤šçº¿ç¨‹ï¼Ÿ</li>\n</ul>\n<h3 id=\"çº¿ç¨‹å’Œè¿›ç¨‹çš„çˆ±æ¨çº è‘›\"><a href=\"#çº¿ç¨‹å’Œè¿›ç¨‹çš„çˆ±æ¨çº è‘›\" class=\"headerlink\" title=\"çº¿ç¨‹å’Œè¿›ç¨‹çš„çˆ±æ¨çº è‘›\"></a>çº¿ç¨‹å’Œè¿›ç¨‹çš„çˆ±æ¨çº è‘›</h3><p>è¿™é‡Œæˆ‘æ¨èé˜®ä¸€å³°è€å¸ˆçš„ä¸€ç¯‡æ–‡ç«  </p>\n<p><a href=\"https://www.ruanyifeng.com/blog/2013/04/processes_and_threads.html\" target=\"_blank\" rel=\"noopener\">ç‚¹æˆ‘å­¦ä¹ </a></p>\n<h3 id=\"ä¸ºä»€ä¹ˆJSæ˜¯å•çº¿ç¨‹ï¼Ÿ\"><a href=\"#ä¸ºä»€ä¹ˆJSæ˜¯å•çº¿ç¨‹ï¼Ÿ\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆJSæ˜¯å•çº¿ç¨‹ï¼Ÿ\"></a>ä¸ºä»€ä¹ˆJSæ˜¯å•çº¿ç¨‹ï¼Ÿ</h3><blockquote>\n<p>è¿™ä¸ªè¦å›åˆ°Jså†å²äº†ï¼Œå¸ƒå…°ç™»Â·è‰¾å¥‡(Brendan Eich)è€å“¥ç”¨10å¤©åˆ›é€ jsã€‚å½“æ—¶jsç”¨æ¥å¹²å˜›ï¼Œç®€å•çš„æµè§ˆå™¨äº¤äº’ï¼ŒéªŒè¯ï¼Œæ“ä½œä¸€ä¸‹domæ˜¯å§ã€‚é‚£æŠŠå®ƒè®¾è®¡æˆé‚£ä¹ˆå¤æ‚å¹²ä»€ä¹ˆï¼Œè€Œä¸”å¦‚æœå¤šçº¿ç¨‹çš„è¯ï¼Œæ“ä½œdomä¼šå‡ºç°éº»çƒ¦çš„äº‹æƒ…ï¼Œå‡è®¾ä¸€ä¸ªçº¿ç¨‹è¯»å–DOMèŠ‚ç‚¹æ•°æ®çš„åŒæ—¶ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹æŠŠé‚£ä¸ªDOMèŠ‚ç‚¹åˆ äº†ï¼Œå‘µå‘µã€‚æ‰€ä»¥jsä¸€ä¸ªçº¿ç¨‹å°±å¤Ÿäº†ï¼Œä¹Ÿå°±æ˜¯ä¸€æ­¥ä¸€æ­¥é¡ºåºè¿è¡Œä¸‹æ¥ã€‚</p>\n</blockquote>\n<h2 id=\"æµè§ˆå™¨ä¸­çš„æ¶ˆæ¯é˜Ÿåˆ—å’Œäº‹ä»¶å¾ªç¯\"><a href=\"#æµè§ˆå™¨ä¸­çš„æ¶ˆæ¯é˜Ÿåˆ—å’Œäº‹ä»¶å¾ªç¯\" class=\"headerlink\" title=\"æµè§ˆå™¨ä¸­çš„æ¶ˆæ¯é˜Ÿåˆ—å’Œäº‹ä»¶å¾ªç¯\"></a>æµè§ˆå™¨ä¸­çš„æ¶ˆæ¯é˜Ÿåˆ—å’Œäº‹ä»¶å¾ªç¯</h2><p>è¿™é‡Œæš‚æ—¶åªè¯´æµè§ˆå™¨ä¸­çš„å¾ªç¯äº‹ä»¶å¾ªç¯ï¼Œæœ‰å…³nodeçš„è¯å¯èƒ½æœ‰äº›ç»†å¾®çš„å·®åˆ«ï¼Œä¸è¿‡åº•å±‚çš„åŸç†éƒ½æ˜¯å·®ä¸å¤šçš„ã€‚</p>\n<h3 id=\"æ³¨æ„\"><a href=\"#æ³¨æ„\" class=\"headerlink\" title=\"æ³¨æ„\"></a>æ³¨æ„</h3><p>è¿™é‡Œä¸»è¦æ˜¯ä»ä¸€ä¸ªè®¾è®¡è€…çš„è§’åº¦æ¥æ¨¡æ‹Ÿï¼Œä»é›¶æ„å»ºæµè§ˆå™¨ä¸­çš„æ—¶é—´å¾ªç¯ã€‚ä¸ºäº†èƒ½è®©ä½ æ›´åŠ æ·±åˆ»åœ°ç†è§£äº‹ä»¶å¾ªç¯æœºåˆ¶ï¼Œæˆ‘ä»¬å°±ä»æœ€ç®€å•çš„åœºæ™¯æ¥åˆ†æï¼Œç„¶åå¸¦ä½ ä¸€æ­¥æ­¥äº†è§£æµè§ˆå™¨é¡µé¢ä¸»çº¿ç¨‹æ˜¯å¦‚ä½•è¿ä½œçš„ã€‚</p>\n<h3 id=\"å¼€å§‹\"><a href=\"#å¼€å§‹\" class=\"headerlink\" title=\"å¼€å§‹\"></a>å¼€å§‹</h3><h4 id=\"äº‹å…ˆçº¦å®šå¥½çš„æ‰§è¡Œé¡ºåº\"><a href=\"#äº‹å…ˆçº¦å®šå¥½çš„æ‰§è¡Œé¡ºåº\" class=\"headerlink\" title=\"äº‹å…ˆçº¦å®šå¥½çš„æ‰§è¡Œé¡ºåº\"></a>äº‹å…ˆçº¦å®šå¥½çš„æ‰§è¡Œé¡ºåº</h4><p>å‡å¦‚æˆ‘æœ‰ä»¥ä¸‹å‡ ä¸ªä»»åŠ¡</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> num1 = <span class=\"number\">1</span>+<span class=\"number\">2</span>; <span class=\"comment\">// ä»»åŠ¡ 1</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> num2 = <span class=\"number\">20</span>/<span class=\"number\">5</span>; <span class=\"comment\">// ä»»åŠ¡ 2</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> num3 = <span class=\"number\">7</span>*<span class=\"number\">8</span>; <span class=\"comment\">// ä»»åŠ¡ 3</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(num1, num2, num3)ï¼› <span class=\"comment\">// ä»»åŠ¡ 4</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>å¦‚æœè®©æˆ‘æ¥è®¾è®¡ï¼Œæˆ‘å°±ä¼šæœ‰ä¸€ä¸ªä¸»çº¿ç¨‹ï¼Œç„¶åæŠŠä»–ä»¬æŒ‰é¡ºåºæ’è¿›å»ï¼Œç„¶åé¡ºåºæ‰§è¡Œã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">mainThread</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> num1 = <span class=\"number\">1</span>+<span class=\"number\">2</span>; <span class=\"comment\">// ä»»åŠ¡ 1</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> num2 = <span class=\"number\">20</span>/<span class=\"number\">5</span>; <span class=\"comment\">// ä»»åŠ¡ 2</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> num3 = <span class=\"number\">7</span>*<span class=\"number\">8</span>; <span class=\"comment\">// ä»»åŠ¡ 3</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(num1, num2, num3)ï¼› <span class=\"comment\">// ä»»åŠ¡ 4</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ğŸ˜¯ï¼Œæˆ‘ä»¬å·²ç»è®¾è®¡äº†æœ€ç®€å•çš„çº¿ç¨‹å•¦ã€‚</p>\n<h4 id=\"çº¿ç¨‹è¿è¡Œä¸­ï¼Œå¤„ç†çªå‘äº‹ä»¶\"><a href=\"#çº¿ç¨‹è¿è¡Œä¸­ï¼Œå¤„ç†çªå‘äº‹ä»¶\" class=\"headerlink\" title=\"çº¿ç¨‹è¿è¡Œä¸­ï¼Œå¤„ç†çªå‘äº‹ä»¶\"></a>çº¿ç¨‹è¿è¡Œä¸­ï¼Œå¤„ç†çªå‘äº‹ä»¶</h4><p>å¾ˆå¤šæ—¶å€™ï¼Œæ‰€æœ‰çš„ä»»åŠ¡ä¸æ˜¯ä¹‹å‰å°±ç»Ÿä¸€å®‰æ’å¥½çš„ï¼Œæ¯”å¦‚âŒ¨ï¸çš„è¾“å…¥ï¼ŒğŸ–±çš„ç‚¹å‡»ç­‰ç­‰ã€‚</p>\n<p>å¦‚æœæƒ³è¦åœ¨çº¿ç¨‹è¿è¡Œä¸­å¯ä»¥å¾ˆå¥½çš„å¤„ç†è¿™äº›äº‹ä»¶ã€‚å°±éœ€è¦</p>\n<p> ====&gt;äº‹ä»¶å¾ªç¯ã€‚è¿™é‡Œæˆ‘ä»¬ç”¨whileæ¥å®ç°ç®€å•çš„äº‹ä»¶å¾ªç¯</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">awaitt</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">'keydown'</span>, resolve);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">mainThread</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">while</span>(<span class=\"literal\">true</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> result = <span class=\"keyword\">await</span> awaitt();</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(result);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">mainThread();</span><br></pre></td></tr></table></figure>\n\n<p>è¿™æ ·æ”¹ç‰ˆä¹‹åæœ‰äº†ä»¥ä¸‹å‡ ç‚¹æ”¹è¿›ï¼š</p>\n<ul>\n<li>å¼•å…¥äº†å¾ªç¯æœºåˆ¶</li>\n<li>å¼•å…¥äº‹ä»¶ï¼Œç„¶åæ•´ä¸ªçº¿ç¨‹åœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œæ´»äº†èµ·æ¥ï¼Œä¸å†æ˜¯æ­»çš„ï¼Œè¿è¡Œå®Œå°±æ»šè›‹äº†çš„é‚£ç§ï¼Œæœ‰äº†äº¤äº’äº†</li>\n</ul>\n<p>ï¼ˆğŸ¤«æœ€ç®€å•çš„å®ç°ã€‚ã€‚ã€‚åˆ«åæ§½ä»£ç ï¼Œéƒ½æ˜¯æœ€ç®€å•çš„å®ç°å’Œæœ€ç®€å•çš„åœºæ™¯ï¼ŒåŠ©äºç†è§£è€Œå·²ã€‚ã€‚ã€‚ï¼‰</p>\n<h4 id=\"å¤„ç†å…¶ä»–çº¿ç¨‹çš„ä»»åŠ¡\"><a href=\"#å¤„ç†å…¶ä»–çº¿ç¨‹çš„ä»»åŠ¡\" class=\"headerlink\" title=\"å¤„ç†å…¶ä»–çº¿ç¨‹çš„ä»»åŠ¡\"></a>å¤„ç†å…¶ä»–çº¿ç¨‹çš„ä»»åŠ¡</h4><p>ä¸Šé¢çš„ç‰ˆæœ¬ç”¨äº†äº‹ä»¶å¾ªç¯çš„æ–¹å¼æ¥è·å–å†…éƒ¨çš„äº‹ä»¶ï¼Œä½†æ˜¯å¯¹äºå¤–éƒ¨çªå‘æƒ…å†µçš„äº‹ä»¶æ˜¯æ— æ³•è§£å†³çš„ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦å‡çº§~</p>\n<p>é‚£ä¹ˆæ€ä¹ˆè®¾è®¡å¥½ä¸€ä¸ªçº¿ç¨‹æ¨¡å‹å‘¢ï¼Ÿæˆ‘ä»¬æ¢ä¸ªè§’åº¦æƒ³æƒ³æ€è·¯é©¬ä¸Šå°±å‡ºæ¥äº†ã€‚</p>\n<p>è¿™äº›å¤–éƒ¨çš„ä»»åŠ¡ï¼Œéƒ½æ˜¯æœ‰å…ˆåé¡ºåºçš„ï¼Œå“ªæ€•æ˜¯éƒ½æ˜¯çªå‘æƒ…å†µã€‚ä»–ä»¬ä¹Ÿæ˜¯æœ‰å…ˆåé¡ºåºã€‚</p>\n<p>æ‰€ä»¥ä¸€ä¸ªæ¯”è¾ƒé€šç”¨çš„æ¨¡å¼å°±æ˜¯</p>\n<p>======&gt; æ¶ˆæ¯é˜Ÿåˆ—</p>\n<blockquote>\n<p>æ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œå¯ä»¥å­˜æ”¾è¦æ‰§è¡Œçš„ä»»åŠ¡ã€‚å®ƒç¬¦åˆé˜Ÿåˆ—â€œå…ˆè¿›å…ˆå‡ºâ€çš„ç‰¹ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´è¦æ·»åŠ ä»»åŠ¡çš„è¯ï¼Œæ·»åŠ åˆ°é˜Ÿåˆ—çš„å°¾éƒ¨ï¼›è¦å–å‡ºä»»åŠ¡çš„è¯ï¼Œä»é˜Ÿåˆ—å¤´éƒ¨å»å–ã€‚</p>\n</blockquote>\n<p>æˆ‘ä»¬è¦å®Œæˆä»¥ä¸‹å‡ ä¸ªæ“ä½œï¼š</p>\n<ol>\n<li>æ·»åŠ ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼›</li>\n<li>IO çº¿ç¨‹ä¸­äº§ç”Ÿçš„æ–°ä»»åŠ¡æ·»åŠ è¿›æ¶ˆæ¯é˜Ÿåˆ—å°¾éƒ¨ï¼›</li>\n<li>æ¸²æŸ“ä¸»çº¿ç¨‹ä¼šå¾ªç¯åœ°ä»æ¶ˆæ¯é˜Ÿåˆ—å¤´éƒ¨ä¸­è¯»å–ä»»åŠ¡ï¼Œæ‰§è¡Œä»»åŠ¡ã€‚</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> arrTask = []</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addTask</span>(<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">  arrTask.push(fn)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">otherThread</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  addTask(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;<span class=\"built_in\">console</span>.log(<span class=\"string\">'other'</span>)&#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">awaitt</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(arrTask.length) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> task = arrTask.shift()</span><br><span class=\"line\">        task()</span><br><span class=\"line\">        resolve()</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">mainThread</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">while</span>(<span class=\"literal\">true</span>)&#123;</span><br><span class=\"line\">    \t<span class=\"keyword\">await</span> awaitt();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">addTask(<span class=\"function\"><span class=\"params\">()</span>=&gt;</span><span class=\"built_in\">console</span>.log(<span class=\"string\">'in'</span>))</span><br><span class=\"line\">addTask(<span class=\"function\"><span class=\"params\">()</span>=&gt;</span><span class=\"built_in\">console</span>.log(<span class=\"string\">'in'</span>))</span><br><span class=\"line\">addTask(<span class=\"function\"><span class=\"params\">()</span>=&gt;</span><span class=\"built_in\">console</span>.log(<span class=\"string\">'in'</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">mainThread();</span><br><span class=\"line\">otherThread()</span><br></pre></td></tr></table></figure>\n\n\n\n<p>æˆ‘ä»¬ç”¨ä¸€ä¸ªæ•°ç»„æ¥æ¨¡æ‹Ÿä¸€ä¸ªé˜Ÿåˆ—ã€‚</p>\n<p>æ—¢åŸºç¡€äº†å†…éƒ¨çš„ä»»åŠ¡ï¼Œä¹Ÿå¤„ç†äº†å¤–éƒ¨çªå‘çš„ä»»åŠ¡</p>\n<p>æœ‰ä»»åŠ¡è¿›æ¥ï¼Œ å°±ä¼šæ‰§è¡Œä»»åŠ¡ã€‚</p>\n<h4 id=\"é€€å‡ºä¸»çº¿ç¨‹\"><a href=\"#é€€å‡ºä¸»çº¿ç¨‹\" class=\"headerlink\" title=\"é€€å‡ºä¸»çº¿ç¨‹\"></a>é€€å‡ºä¸»çº¿ç¨‹</h4><p>å½“é¡µé¢ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæˆä¹‹åï¼Œåˆè¯¥å¦‚ä½•ä¿è¯é¡µé¢ä¸»çº¿ç¨‹èƒ½å¤Ÿå®‰å…¨é€€å‡ºå‘¢ï¼ŸChrome æ˜¯è¿™æ ·è§£å†³çš„ï¼Œç¡®å®šè¦é€€å‡ºå½“å‰é¡µé¢æ—¶ï¼Œé¡µé¢ä¸»çº¿ç¨‹ä¼šè®¾ç½®ä¸€ä¸ªé€€å‡ºæ ‡å¿—çš„å˜é‡ï¼Œåœ¨æ¯æ¬¡æ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰è®¾ç½®é€€å‡ºæ ‡å¿—ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> arrTask = []</span><br><span class=\"line\"><span class=\"keyword\">let</span> over = <span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addTask</span>(<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">  arrTask.push(fn)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">otherThread</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  addTask(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;<span class=\"built_in\">console</span>.log(<span class=\"string\">'other'</span>)&#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">awaitt</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(arrTask.length) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> task = arrTask.shift()</span><br><span class=\"line\">        task()</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!arrTask.length)&#123;</span><br><span class=\"line\">          over = <span class=\"literal\">true</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        resolve()</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">mainThread</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">while</span>(<span class=\"literal\">true</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(over)&#123;</span><br><span class=\"line\">      <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    \t<span class=\"keyword\">await</span> awaitt();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">addTask(<span class=\"function\"><span class=\"params\">()</span>=&gt;</span><span class=\"built_in\">console</span>.log(<span class=\"string\">'in'</span>))</span><br><span class=\"line\">addTask(<span class=\"function\"><span class=\"params\">()</span>=&gt;</span><span class=\"built_in\">console</span>.log(<span class=\"string\">'in'</span>))</span><br><span class=\"line\">addTask(<span class=\"function\"><span class=\"params\">()</span>=&gt;</span><span class=\"built_in\">console</span>.log(<span class=\"string\">'in'</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">mainThread();</span><br><span class=\"line\">otherThread()</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"å•çº¿ç¨‹çš„ç¼ºç‚¹\"><a href=\"#å•çº¿ç¨‹çš„ç¼ºç‚¹\" class=\"headerlink\" title=\"å•çº¿ç¨‹çš„ç¼ºç‚¹\"></a>å•çº¿ç¨‹çš„ç¼ºç‚¹</h3><p>é€šè¿‡ä¸Šé¢çš„ä»‹ç»ï¼Œä½ åº”è¯¥æ¸…æ¥šäº†ï¼Œé¡µé¢çº¿ç¨‹æ‰€æœ‰æ‰§è¡Œçš„ä»»åŠ¡éƒ½æ¥è‡ªäºæ¶ˆæ¯é˜Ÿåˆ—ã€‚æ¶ˆæ¯é˜Ÿåˆ—æ˜¯â€œå…ˆè¿›å…ˆå‡ºâ€çš„å±æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´æ”¾å…¥é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œéœ€è¦ç­‰å¾…å‰é¢çš„ä»»åŠ¡è¢«æ‰§è¡Œå®Œï¼Œæ‰ä¼šè¢«æ‰§è¡Œã€‚é‰´äºè¿™ä¸ªå±æ€§ï¼Œå°±æœ‰å¦‚ä¸‹ä¸¤ä¸ªé—®é¢˜éœ€è¦è§£å†³ã€‚</p>\n<h4 id=\"å¦‚ä½•å¤„ç†é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡\"><a href=\"#å¦‚ä½•å¤„ç†é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡\" class=\"headerlink\" title=\"å¦‚ä½•å¤„ç†é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡\"></a>å¦‚ä½•å¤„ç†é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡</h4><p>åœºæ™¯ï¼š</p>\n<p>å‡å¦‚ï¼Œæˆ‘ç°åœ¨æœ‰ä¸€å¤§ä¸²çš„ä»»åŠ¡åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œã€‚</p>\n<p>æˆ‘çš„domèŠ‚ç‚¹å˜åŒ–çš„æ—¶å€™ï¼Œæˆ‘éœ€è¦å‘é€è¯·æ±‚æˆ–è€…æç¤ºä¸€ä¸ª<code>alert</code>ä¹‹ç±»çš„ä¸šåŠ¡é€»è¾‘è¦æ‰§è¡Œã€‚</p>\n<p>ç°åœ¨å¯è¡Œçš„æœ‰ä¸¤ç§æ–¹æ¡ˆï¼š</p>\n<ul>\n<li>domèŠ‚ç‚¹å˜åŒ–çš„è¯ï¼Œæˆ‘å°±åœä¸‹ç°åœ¨æ­£åœ¨è¿è¡Œçš„ä¸»çº¿ç¨‹ä¸Šçš„ä»»åŠ¡ï¼Œç„¶åè°ƒç”¨æˆ‘éœ€è¦æ‰§è¡Œçš„ä¸šåŠ¡é€»è¾‘ã€‚è¿™æ ·ç¡®å®å…·æœ‰å®æ•ˆæ€§ï¼Œä½†æ˜¯ï¼è¿™æ ·ä¼šä½¿å¾—å½“å‰ä»»åŠ¡çš„æ•ˆç‡æåº¦é™ä½ï¼Œæ¯”å¦‚æˆ‘çš„domèŠ‚ç‚¹å˜åŒ–200æ¬¡ï¼Œé‚£å²‚ä¸æ˜¯å½“å‰çš„ä»»åŠ¡ç‰¹åˆ«ä¹…äº†å—ï¼Ÿ</li>\n<li>ç¬¬äºŒä¸ªæ–¹æ³•å°±å¯ä»¥è§£å†³ä¸Šè¿°çš„é—®é¢˜ï¼šä¸€æ—¦domèŠ‚ç‚¹æœ‰å˜åŒ–ï¼Œå“ªæ€•æ˜¯200000æ¬¡å˜åŒ–ï¼Œæˆ‘éƒ½æ˜¯å°†ä¸šåŠ¡é€»è¾‘pushåˆ°é˜Ÿåˆ—çš„å°¾éƒ¨ï¼Œè¿™æ ·å°±ä¸ä¼šå½±å“å½“å‰ä»»åŠ¡è¿›è¡Œä»¥åŠæ•ˆç‡äº†ã€‚ä½†æ˜¯ï¼è¿™æ ·çš„è¯æˆ‘çš„å®æ•ˆæ€§å°±è«å¾—äº†ã€‚å°±è«å¾—äº†ã€‚</li>\n</ul>\n<p>æ€»ç»“ä¸€ä¸‹ï¼šå…¶å®å°±æ˜¯å®æ•ˆæ€§å’Œä»»åŠ¡æ•ˆç‡çš„æƒè¡¡é—®é¢˜ç½¢äº†ã€‚</p>\n<p>æ±Ÿæ±Ÿæ±Ÿ~</p>\n<p>å¾®ä»»åŠ¡å°±åº”è¿è€Œç”Ÿå•¦ã€‚</p>\n<p>åŠ å…¥æˆ‘ä»¬æŠŠä»»åŠ¡é˜Ÿåˆ—é‡Œé¢çš„æ¯ä¸ªä»»åŠ¡éƒ½ç§°ä½œå®ä»»åŠ¡çš„è¯ï¼Œæ¯ä¸ªå®ä»»åŠ¡é‡Œé¢éƒ½ä¼šåŒ…å«ä¸€ä¸ªå¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚æ¯ä¸ªå®ä»»åŠ¡ç»“æŸä¹‹åï¼Œéƒ½å›å»æ¸…ç†ä¸€éå¾®ä»»åŠ¡é˜Ÿåˆ—é‡Œé¢çš„é˜Ÿåˆ—ï¼Œè¿™æ ·çš„è¯æ—¢ä¿æŠ¤äº†å®æ•ˆæ€§ï¼Œä¹Ÿä¿æŠ¤äº†ä»»åŠ¡çš„æ•ˆç‡ã€‚</p>\n<h4 id=\"å¦‚ä½•å¤„ç†è°ƒç”¨æ—¶é—´è¿‡é•¿çš„é—®é¢˜\"><a href=\"#å¦‚ä½•å¤„ç†è°ƒç”¨æ—¶é—´è¿‡é•¿çš„é—®é¢˜\" class=\"headerlink\" title=\"å¦‚ä½•å¤„ç†è°ƒç”¨æ—¶é—´è¿‡é•¿çš„é—®é¢˜\"></a>å¦‚ä½•å¤„ç†è°ƒç”¨æ—¶é—´è¿‡é•¿çš„é—®é¢˜</h4><p>æˆ‘ä»¬éƒ½çŸ¥é“jsæ˜¯å•çº¿ç¨‹çš„ã€‚å¦‚æœç°åœ¨åœ¨æ‰§è¡Œä¸€ä¸ªä»»åŠ¡çš„æƒ…å†µä¸‹ã€‚å…¶ä»–ä»»åŠ¡å°±æ˜¯è¦ç­‰å¾…çš„ã€‚é‚£ä¹ˆå°±ä¼šå‡ºç°æŸä¸ªä»»åŠ¡è®¡ç®—çš„å‘¨æœŸç‰¹åˆ«é•¿ï¼Œå¯¼è‡´åˆ«äººéƒ½åœ¨ç­‰å¾…ã€‚</p>\n<p>ğŸ‘Œï¼Œæˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">while</span>(<span class=\"literal\">true</span>)&#123;&#125;</span><br><span class=\"line\">alter(<span class=\"number\">123</span>)</span><br></pre></td></tr></table></figure>\n\n<p>ä¸‹é¢çš„<code>alter</code>æ°¸è¿œéƒ½ä¸ä¼šæ‰§è¡Œäº†ã€‚å› ä¸º<code>while</code>åœ¨å·¥ä½œï¼Œ<code>alter</code>åœ¨ç­‰ä»–æŠŠèµ„æºè®©å‡ºæ¥ã€‚</p>\n<p>å‡å¦‚è¯´ï¼Œæˆ‘ç°åœ¨æœ‰ä¸€ä¸ªåŠ¨ç”»è¦è¿›è¡Œï¼Œä½†æ˜¯è¿è¡Œå®Œä¸€å¸§ä¹‹åï¼Œæœ‰ä¸€ä¸ªæå…¶å¤æ‚çš„è®¡ç®—ï¼Œå¯¼è‡´äº†æˆ‘çš„åŠ¨ç”»ä¸æµç•…ï¼Œé‚£ä¹ˆç”¨æˆ·å¯èƒ½å°±ä¼šéå¸¸çš„çƒ¦ã€‚è¿™ä¸æ˜¯æˆ‘ä»¬å¸Œæœ›çœ‹åˆ°çš„ã€‚</p>\n<p>æ‰€ä»¥jsæœ‰ä¸€ä¸ªå›è°ƒæœºåˆ¶ï¼Œåˆ°äº†ç‰¹å®šçš„æ—¶é—´ç‚¹äº†ï¼Œå›è°ƒä¸€ä¸‹ï¼ŒæŠŠåŠ¨ç”»çš„ä¸‹ä¸€å¸§æ‰§è¡Œä¸€ä¸‹ï¼Œç„¶åç»§ç»­å½“å‰çš„å¤æ‚è®¡ç®—ã€‚</p>\n<h3 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h3><ul>\n<li>å¦‚æœæœ‰ä¸€äº›ç¡®å®šå¥½çš„ä»»åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå•çº¿ç¨‹æ¥æŒ‰ç…§é¡ºåºå¤„ç†è¿™äº›ä»»åŠ¡ï¼Œè¿™æ˜¯ç¬¬ä¸€ç‰ˆçº¿ç¨‹æ¨¡å‹ã€‚</li>\n<li>è¦åœ¨çº¿ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­æ¥æ”¶å¹¶å¤„ç†æ–°çš„ä»»åŠ¡ï¼Œå°±éœ€è¦å¼•å…¥å¾ªç¯è¯­å¥å’Œäº‹ä»¶ç³»ç»Ÿï¼Œè¿™æ˜¯ç¬¬äºŒç‰ˆçº¿ç¨‹æ¨¡å‹ã€‚</li>\n<li>å¦‚æœè¦æ¥æ”¶å…¶ä»–çº¿ç¨‹å‘é€è¿‡æ¥çš„ä»»åŠ¡ï¼Œå°±éœ€è¦å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¿™æ˜¯ç¬¬ä¸‰ç‰ˆçº¿ç¨‹æ¨¡å‹ã€‚</li>\n<li>å¦‚æœå…¶ä»–è¿›ç¨‹æƒ³è¦å‘é€ä»»åŠ¡ç»™é¡µé¢ä¸»çº¿ç¨‹ï¼Œé‚£ä¹ˆå…ˆé€šè¿‡ IPC æŠŠä»»åŠ¡å‘é€ç»™æ¸²æŸ“è¿›ç¨‹çš„ IO çº¿ç¨‹ï¼ŒIO çº¿ç¨‹å†æŠŠä»»åŠ¡å‘é€ç»™é¡µé¢ä¸»çº¿ç¨‹ã€‚</li>\n<li>æ¶ˆæ¯é˜Ÿåˆ—æœºåˆ¶å¹¶ä¸æ˜¯å¤ªçµæ´»ï¼Œä¸ºäº†é€‚åº”æ•ˆç‡å’Œå®æ—¶æ€§ï¼Œå¼•å…¥äº†å¾®ä»»åŠ¡</li>\n</ul>\n<p>åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„è®¾è®¡æ˜¯ç›®å‰ä½¿ç”¨æœ€å¹¿çš„æ¶ˆæ¯æ¶æ„ï¼Œæ— è®ºæ˜¯å®‰å“è¿˜æ˜¯ Chrome éƒ½é‡‡ç”¨äº†ç±»ä¼¼çš„ä»»åŠ¡æœºåˆ¶ï¼Œæ‰€ä»¥ç†è§£äº†æœ¬ç¯‡æ–‡ç« çš„å†…å®¹åï¼Œä½ å†ç†è§£å…¶ä»–é¡¹ç›®çš„ä»»åŠ¡æœºåˆ¶ä¹Ÿä¼šæ¯”è¾ƒè½»æ¾ã€‚</p>\n<h2 id=\"æµè§ˆå™¨æ˜¯æ€ä¹ˆå®ç°setTimeout\"><a href=\"#æµè§ˆå™¨æ˜¯æ€ä¹ˆå®ç°setTimeout\" class=\"headerlink\" title=\"æµè§ˆå™¨æ˜¯æ€ä¹ˆå®ç°setTimeout\"></a>æµè§ˆå™¨æ˜¯æ€ä¹ˆå®ç°setTimeout</h2><p>è¦æƒ³çŸ¥é“æµè§ˆå™¨æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œæˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹ï¼Œæˆ‘ä»¬ä¹‹å‰è®¾è®¡çš„é‚£ä¸ªäº‹ä»¶å¾ªç¯ç³»ç»Ÿï¼š</p>\n<p>æœ‰xxä»»åŠ¡äº†ï¼Œokï¼Œæˆ‘<code>push</code>åˆ°ä»»åŠ¡é˜Ÿåˆ—ã€‚ä»¥æ­¤å¾ªç¯ã€‚</p>\n<p>æ‰€ä»¥æˆ‘ä»¬å†™åœ¨<code>setTimeout</code>é‡Œé¢çš„å‡½æ•°æ‰§è¡Œå…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªä»»åŠ¡ï¼Œä¹Ÿæ˜¯éœ€è¦pushåˆ°ä»»åŠ¡é˜Ÿåˆ—å»çš„ã€‚</p>\n<p>ä½†æ˜¯ï¼Œæˆ‘ä»¬çš„è¿™ä¸ªæ˜¯å…¶å®æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„å‡½æ•°ï¼Œä¸èƒ½ç›´æ¥å°†æ•´ä¸ªå‡½æ•°pushåˆ°é˜Ÿåˆ—ä¸­ï¼Œå¦åˆ™çš„è¯æˆ‘ä»¬çš„å®æ•ˆæ€§å°±å¾ˆæœ‰å¯èƒ½å‡ºé”™äº†ï¼Œæ¯”å¦‚æˆ‘å¸Œæœ›ä»–åœ¨24å°æ—¶ä¹‹å<code>alter</code>å‘Šè¯‰æˆ‘å·²ç»åˆ°äº†ç¬¬äºŒå¤©äº†ã€‚ä»–å¦‚æœæ˜¯ç›´æ¥pushåˆ°ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ²¡æœ‰åˆ°ç¬¬äºŒå¤©å°±ä¼šå‘Šè¯‰æˆ‘ç¬¬äºŒå¤©åˆ°äº†ï¼Œè¿™ä¸æ˜¯è®©ç”¨æˆ·åŒªå¤·æ‰€æ€å˜›ã€‚</p>\n<p>æ‰€ä»¥è‚¯å®šä¸æ˜¯ç›´æ¥<code>push</code>çš„ã€‚é‚£åˆæ˜¯æ€ä¹ˆå¼„å¾—å˜ï¼Ÿ</p>\n<p>ä½ ä¹Ÿå¯ä»¥æ€è€ƒä¸‹ï¼Œå¦‚æœè®©ä½ åœ¨æ¶ˆæ¯å¾ªç¯ç³»ç»Ÿçš„åŸºç¡€ä¹‹ä¸ŠåŠ ä¸Šå®šæ—¶å™¨çš„åŠŸèƒ½ï¼Œä½ ä¼šå¦‚ä½•è®¾è®¡ï¼Ÿ</p>\n<p>åœ¨ Chrome ä¸­é™¤äº†æ­£å¸¸ä½¿ç”¨çš„æ¶ˆæ¯é˜Ÿåˆ—ä¹‹å¤–ï¼Œè¿˜æœ‰å¦å¤–ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¿™ä¸ªé˜Ÿåˆ—ä¸­ç»´æŠ¤äº†éœ€è¦å»¶è¿Ÿæ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨ï¼ŒåŒ…æ‹¬äº†å®šæ—¶å™¨å’Œ Chromium å†…éƒ¨ä¸€äº›éœ€è¦å»¶è¿Ÿæ‰§è¡Œçš„ä»»åŠ¡ã€‚æ‰€ä»¥å½“é€šè¿‡ JavaScript åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨æ—¶ï¼Œæ¸²æŸ“è¿›ç¨‹ä¼šå°†è¯¥å®šæ—¶å™¨çš„å›è°ƒä»»åŠ¡æ·»åŠ åˆ°å»¶è¿Ÿé˜Ÿåˆ—ä¸­</p>\n<p>æˆ‘ä»¬æŠŠä¹‹å‰çš„äº‹ä»¶å¾ªç¯æ¨¡æ‹Ÿæ”¹ä¸€ä¸‹</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> mainTask = [</span><br><span class=\"line\">  fn1,</span><br><span class=\"line\">  fn2,</span><br><span class=\"line\">  fn3,</span><br><span class=\"line\">  â€¦â€¦</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> setTimeoutTask = []</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addSetTimeoutTask</span>(<span class=\"params\">fn, timeout</span>)</span>&#123;</span><br><span class=\"line\">  setTimeoutTask.push(&#123;</span><br><span class=\"line\">    fn: fn,</span><br><span class=\"line\">    id: <span class=\"built_in\">Math</span>.random(),</span><br><span class=\"line\">    useTime: timeout + ((<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>()).getTime()</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> runSetTimeoutTask ()&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> runList = []</span><br><span class=\"line\">  setTimeoutTask.forEach(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// å·²ç»è¿‡äº†æ—¶é—´ï¼Œæˆ–è€…åˆšåˆšå¥½åˆ°æ—¶é—´çš„è¯å°±å–å‡ºæ¥ã€‚å¾…ä¼šä¸€èµ·æ‰§è¡Œäº†</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(item.useTime &lt;= ((<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>()).getTime()) &#123;</span><br><span class=\"line\">      runList.push(item.fn) </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(runList.length) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> fn = runList.shift()</span><br><span class=\"line\">    fn()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">mainThread</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">while</span>(<span class=\"literal\">true</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> task = arrTask.shift()</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// æ¯æ¬¡æ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡ï¼Œéƒ½å›å»æŸ¥æ‰¾ä¸€ä¸‹å»¶è¿Ÿé˜Ÿåˆ—é‡Œé¢æœ‰æ²¡æœ‰åˆ°ç‚¹çš„å‡½æ•°</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(setTimeoutTask.length) &#123;</span><br><span class=\"line\">       runSetTimeoutTask()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">mainThread();</span><br></pre></td></tr></table></figure>\n\n<p>æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä¼šçœ‹åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯å…¶å®ä½ åˆ°ç‚¹äº†å¯èƒ½è¦ä¸ä¼šç«‹åˆ»æ‰§è¡Œï¼Œå¿…é¡»ç­‰åˆ°ä¹‹å‰çš„ä»»åŠ¡æ‰§è¡Œå®Œäº†æ‰è½®åˆ°å»¶è¿Ÿé˜Ÿåˆ—çš„æŸ¥è¯¢å’Œæ‰§è¡Œã€‚</p>\n<p>æˆ‘ä»¬ä»£ç ä¸­æœ‰ä¸€ä¸ªå½©è›‹â€”-&gt; ID</p>\n<p>è¿™ä¸ªIDæœ‰ä»€ä¹ˆç”¨ï¼Ÿ</p>\n<p>å°±æ˜¯ç”¨äº<code>clearTimeout</code></p>\n<p>ç›´æ¥ä¼ å…¥IDï¼Œç„¶åå¾ªç¯æ‰¾åˆ°ä»–ï¼Œå°±å¯ä»¥ç›´æ¥ä»é˜Ÿåˆ—é‡Œé¢åˆ æ‰å°±å¥½äº†ã€‚</p>\n<p>è¿™é‡Œå°±ä¸éœ€è¦è´´ä»£ç äº†å§ï¼Ÿ</p>\n<h3 id=\"å†·çŸ¥è¯†\"><a href=\"#å†·çŸ¥è¯†\" class=\"headerlink\" title=\"å†·çŸ¥è¯†\"></a>å†·çŸ¥è¯†</h3><ul>\n<li><strong>å¦‚æœ setTimeout å­˜åœ¨åµŒå¥—è°ƒç”¨ï¼Œé‚£ä¹ˆç³»ç»Ÿä¼šè®¾ç½®æœ€çŸ­æ—¶é—´é—´éš”ä¸º 4 æ¯«ç§’</strong></li>\n<li><strong>æœªæ¿€æ´»çš„é¡µé¢ï¼ŒsetTimeout æ‰§è¡Œæœ€å°é—´éš”æ˜¯ 1000 æ¯«ç§’</strong><ul>\n<li>é™¤äº†å‰é¢çš„ 4 æ¯«ç§’å»¶è¿Ÿï¼Œè¿˜æœ‰ä¸€ä¸ªå¾ˆå®¹æ˜“è¢«å¿½ç•¥çš„åœ°æ–¹ï¼Œé‚£å°±æ˜¯æœªè¢«æ¿€æ´»çš„é¡µé¢ä¸­å®šæ—¶å™¨æœ€å°å€¼å¤§äº 1000 æ¯«ç§’ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ ‡ç­¾ä¸æ˜¯å½“å‰çš„æ¿€æ´»æ ‡ç­¾ï¼Œé‚£ä¹ˆå®šæ—¶å™¨æœ€å°çš„æ—¶é—´é—´éš”æ˜¯ 1000 æ¯«ç§’ï¼Œç›®çš„æ˜¯ä¸ºäº†ä¼˜åŒ–åå°é¡µé¢çš„åŠ è½½æŸè€—ä»¥åŠé™ä½è€—ç”µé‡ã€‚è¿™ä¸€ç‚¹ä½ åœ¨ä½¿ç”¨å®šæ—¶å™¨çš„æ—¶å€™è¦æ³¨æ„ã€‚</li>\n</ul>\n</li>\n<li><strong>å»¶æ—¶æ‰§è¡Œæ—¶é—´æœ‰æœ€å¤§å€¼</strong><ul>\n<li>é™¤äº†è¦äº†è§£å®šæ—¶å™¨çš„å›è°ƒå‡½æ•°æ—¶é—´æ¯”å®é™…è®¾å®šå€¼è¦å»¶åä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ä¸‹ï¼Œé‚£å°±æ˜¯ Chromeã€Safariã€Firefox éƒ½æ˜¯ä»¥ 32 ä¸ª bit æ¥å­˜å‚¨å»¶æ—¶å€¼çš„ï¼Œ32bit æœ€å¤§åªèƒ½å­˜æ”¾çš„æ•°å­—æ˜¯ 2147483647 æ¯«ç§’ï¼Œè¿™å°±æ„å‘³ç€ï¼Œå¦‚æœ setTimeout è®¾ç½®çš„å»¶è¿Ÿå€¼å¤§äº 2147483647 æ¯«ç§’ï¼ˆå¤§çº¦ 24.8 å¤©ï¼‰æ—¶å°±ä¼šæº¢å‡ºï¼Œè¿™å¯¼è‡´å®šæ—¶å™¨ä¼šè¢«ç«‹å³æ‰§è¡Œã€‚</li>\n</ul>\n</li>\n<li><strong>ä½¿ç”¨ setTimeout è®¾ç½®çš„å›è°ƒå‡½æ•°ä¸­çš„ this ä¸ç¬¦åˆç›´è§‰</strong><ul>\n<li>è¿™é‡Œå¯ä»¥çœ‹æˆ‘ä¹‹å‰çš„æ–‡ç« ï¼Œæœ‰å¯¹thisè¿›è¡Œæ”»ç ´</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"æ€»ç»“-1\"><a href=\"#æ€»ç»“-1\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h3><ul>\n<li>é¦–å…ˆï¼Œä¸ºäº†æ”¯æŒå®šæ—¶å™¨çš„å®ç°ï¼Œæµè§ˆå™¨å¢åŠ äº†å»¶æ—¶é˜Ÿåˆ—ã€‚</li>\n<li>å…¶æ¬¡ï¼Œç”±äºæ¶ˆæ¯é˜Ÿåˆ—æ’é˜Ÿå’Œä¸€äº›ç³»ç»Ÿçº§åˆ«çš„é™åˆ¶ï¼Œé€šè¿‡ setTimeout è®¾ç½®çš„å›è°ƒä»»åŠ¡å¹¶éæ€»æ˜¯å¯ä»¥å®æ—¶åœ°è¢«æ‰§è¡Œï¼Œè¿™æ ·å°±ä¸èƒ½æ»¡è¶³ä¸€äº›å®æ—¶æ€§è¦æ±‚è¾ƒé«˜çš„éœ€æ±‚äº†ã€‚</li>\n</ul>\n<h2 id=\"å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡\"><a href=\"#å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡\" class=\"headerlink\" title=\"å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡\"></a>å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡</h2><p>å…¶å®é€šè¿‡ä¹‹å‰çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å¯¹äº‹ä»¶å¾ªç¯å·²ç»äº†è§£çš„å·®ä¸å¤šäº†ï¼Œè¿™é‡Œä¸»è¦æ˜¯æ›´è¯¦ç»†äº†è§£ä¸€ä¸‹ä»–ä»¬ã€‚</p>\n<h3 id=\"å®ä»»åŠ¡\"><a href=\"#å®ä»»åŠ¡\" class=\"headerlink\" title=\"å®ä»»åŠ¡\"></a>å®ä»»åŠ¡</h3><p>å®ä»»åŠ¡æœ‰å“ªäº›ï¼Ÿ</p>\n<p>é™¤äº†å¾®ä»»åŠ¡çš„éƒ½æ˜¯å®ä»»åŠ¡ã€‚ã€‚ã€‚</p>\n<p>é‚£ä¹ˆå¾®ä»»åŠ¡æœ‰å“ªäº›ï¼Ÿ</p>\n<p><code>Process.nextTick</code>ã€<code>Promise.then catch finally</code>(æ³¨æ„æˆ‘ä¸æ˜¯è¯´ Promise)ã€<code>MutationObserver</code>ã€‚</p>\n<p>åœ¨ä¹‹å‰çš„å­¦ä¹ æˆ‘ä»¬çŸ¥é“åœ¨å®ä»»åŠ¡ç»“æŸä¹‹åï¼Œä¼šå»æ‰§è¡Œä»–è‡ªå·±å½“å‰çš„å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚åœ¨è¿™ä¸ªå¾®ä»»åŠ¡é˜Ÿåˆ—æ‰§è¡Œå®Œæˆä¹‹åå†å»æ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡ã€‚</p>\n<h3 id=\"å¾®ä»»åŠ¡\"><a href=\"#å¾®ä»»åŠ¡\" class=\"headerlink\" title=\"å¾®ä»»åŠ¡\"></a>å¾®ä»»åŠ¡</h3><p>å¼‚æ­¥å‡½æ•°æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>\n<p><strong>ç¬¬ä¸€ç§æ˜¯æŠŠå¼‚æ­¥å›è°ƒå‡½æ•°å°è£…æˆä¸€ä¸ªå®ä»»åŠ¡ï¼Œæ·»åŠ åˆ°æ¶ˆæ¯é˜Ÿåˆ—å°¾éƒ¨ï¼Œå½“å¾ªç¯ç³»ç»Ÿæ‰§è¡Œåˆ°è¯¥ä»»åŠ¡çš„æ—¶å€™æ‰§è¡Œå›è°ƒå‡½æ•°</strong>ã€‚è¿™ç§æ¯”è¾ƒå¥½ç†è§£ï¼Œæˆ‘ä»¬å‰é¢ä»‹ç»çš„ setTimeout å’Œ XMLHttpRequest çš„å›è°ƒå‡½æ•°éƒ½æ˜¯é€šè¿‡è¿™ç§æ–¹å¼æ¥å®ç°çš„ã€‚</p>\n<p><strong>ç¬¬äºŒç§æ–¹å¼çš„æ‰§è¡Œæ—¶æœºæ˜¯åœ¨ä¸»å‡½æ•°æ‰§è¡Œç»“æŸä¹‹åã€å½“å‰å®ä»»åŠ¡ç»“æŸä¹‹å‰æ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œè¿™é€šå¸¸éƒ½æ˜¯ä»¥å¾®ä»»åŠ¡å½¢å¼ä½“ç°çš„</strong>ã€‚</p>\n<ul>\n<li>å¾®ä»»åŠ¡å’Œå®ä»»åŠ¡æ˜¯ç»‘å®šçš„ï¼Œæ¯ä¸ªå®ä»»åŠ¡åœ¨æ‰§è¡Œæ—¶ï¼Œä¼šåˆ›å»ºè‡ªå·±çš„å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚</li>\n<li>å¾®ä»»åŠ¡çš„æ‰§è¡Œæ—¶é•¿ä¼šå½±å“åˆ°å½“å‰å®ä»»åŠ¡çš„æ—¶é•¿ã€‚æ¯”å¦‚ä¸€ä¸ªå®ä»»åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œäº§ç”Ÿäº† 100 ä¸ªå¾®ä»»åŠ¡ï¼Œæ‰§è¡Œæ¯ä¸ªå¾®ä»»åŠ¡çš„æ—¶é—´æ˜¯ 10 æ¯«ç§’ï¼Œé‚£ä¹ˆæ‰§è¡Œè¿™ 100 ä¸ªå¾®ä»»åŠ¡çš„æ—¶é—´å°±æ˜¯ 1000 æ¯«ç§’ï¼Œä¹Ÿå¯ä»¥è¯´è¿™ 100 ä¸ªå¾®ä»»åŠ¡è®©å®ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´å»¶é•¿äº† 1000 æ¯«ç§’ã€‚æ‰€ä»¥-ä½ åœ¨å†™ä»£ç çš„æ—¶å€™ä¸€å®šè¦æ³¨æ„æ§åˆ¶å¾®ä»»åŠ¡çš„æ‰§è¡Œæ—¶é•¿ã€‚</li>\n<li>åœ¨ä¸€ä¸ªå®ä»»åŠ¡ä¸­ï¼Œåˆ†åˆ«åˆ›å»ºä¸€ä¸ªç”¨äºå›è°ƒçš„å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡ï¼Œæ— è®ºä»€ä¹ˆæƒ…å†µä¸‹ï¼Œå¾®ä»»åŠ¡éƒ½æ—©äºå®ä»»åŠ¡æ‰§è¡Œã€‚</li>\n</ul>\n<h2 id=\"æœŸæœ«è€ƒè¯•\"><a href=\"#æœŸæœ«è€ƒè¯•\" class=\"headerlink\" title=\"æœŸæœ«è€ƒè¯•\"></a>æœŸæœ«è€ƒè¯•</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'script start'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">async1</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">await</span> async2()</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'async1 end'</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">async2</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'async2 end'</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">async1()</span><br><span class=\"line\"></span><br><span class=\"line\">setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'setTimeout'</span>)</span><br><span class=\"line\">&#125;, <span class=\"number\">0</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'Promise'</span>)</span><br><span class=\"line\">  resolve()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'promise1'</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'promise2'</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'script end'</span>)</span><br></pre></td></tr></table></figure>\n\n<p>å¤§å®¶å¯ä»¥è‡ªå·±åœ¨æµè§ˆå™¨é‡Œé¢è¯•è¯•å§ã€‚</p>\n","site":{"data":{}},"excerpt":"","more":"<p>æœ€è¿‘åœ¨å†™ã€é‡æ‹¾å‰ç«¯ã€‘ç³»åˆ—ï¼Œä¸‹é¢æœ‰å‡ ä¸ªå¿«é€Ÿé€šé“ï¼Œå¤§å®¶è‡ªå–</p>\n<p><a href=\"https://juejin.im/post/6850418113944420359\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿</a></p>\n<p><a href=\"https://juejin.im/post/6850418117508759566\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—</a></p>\n<p><a href=\"https://juejin.im/post/6854573215658803208\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this</a></p>\n<p><a href=\"https://juejin.im/post/6859911609633767438\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šJavaScriptçš„æ‰§è¡Œæœºåˆ¶</a></p>\n<p><a href=\"https://juejin.im/post/6860375101322461198\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC</a></p>\n<p><a href=\"https://juejin.im/post/6865204092877144077\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ</a></p>\n<h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><p>äº‹ä»¶å¾ªç¯è¿™ä¸ªäº‹æƒ…ï¼Œå…¶å®åœ¨æˆ‘ä»¬çš„å·¥ä½œä¸­æˆ–å¤šæˆ–å°‘éƒ½ä¼šç¢°åˆ°ï¼Œå¯èƒ½æˆ‘ä»¬åªæ˜¯æ²¡æœ‰å»è®¤è®¤çœŸçœŸçš„ç†è§£ä»–ï¼Œäº†è§£ä»–è€Œå·²ã€‚ä»Šå¤©æˆ‘ä»¬ä¸€èµ·æŠŠäº‹ä»¶å¾ªç¯åƒé€ã€‚</p>\n<h2 id=\"å•çº¿ç¨‹çš„JS\"><a href=\"#å•çº¿ç¨‹çš„JS\" class=\"headerlink\" title=\"å•çº¿ç¨‹çš„JS\"></a>å•çº¿ç¨‹çš„JS</h2><p>å…¶å®ï¼Œäº‹ä»¶å¾ªç¯å°±æ˜¯å¯¹äºå•çº¿ç¨‹çš„JSåº”è¿è€Œç”Ÿçš„ã€‚</p>\n<ul>\n<li>å•çº¿ç¨‹ï¼Ÿä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Œè¯¶ï¼Œæˆ‘å¥½åƒå¬è¿‡è¿›ç¨‹è¯¶ï¼Œä»–ä»¬ä¸¤å…„å¼Ÿå•¥åŒºåˆ«ï¼Ÿ</li>\n<li>ä¸ºä»€ä¹ˆjsä¸€å®šè¦å•çº¿ç¨‹å•Šï¼Œæˆ‘å¬è¯´CPUä¸æ˜¯æœ‰å¾ˆå¤šæ ¸å—ï¼Ÿä¸ºä»€ä¹ˆä¸å¤šçº¿ç¨‹ï¼Ÿ</li>\n</ul>\n<h3 id=\"çº¿ç¨‹å’Œè¿›ç¨‹çš„çˆ±æ¨çº è‘›\"><a href=\"#çº¿ç¨‹å’Œè¿›ç¨‹çš„çˆ±æ¨çº è‘›\" class=\"headerlink\" title=\"çº¿ç¨‹å’Œè¿›ç¨‹çš„çˆ±æ¨çº è‘›\"></a>çº¿ç¨‹å’Œè¿›ç¨‹çš„çˆ±æ¨çº è‘›</h3><p>è¿™é‡Œæˆ‘æ¨èé˜®ä¸€å³°è€å¸ˆçš„ä¸€ç¯‡æ–‡ç«  </p>\n<p><a href=\"https://www.ruanyifeng.com/blog/2013/04/processes_and_threads.html\" target=\"_blank\" rel=\"noopener\">ç‚¹æˆ‘å­¦ä¹ </a></p>\n<h3 id=\"ä¸ºä»€ä¹ˆJSæ˜¯å•çº¿ç¨‹ï¼Ÿ\"><a href=\"#ä¸ºä»€ä¹ˆJSæ˜¯å•çº¿ç¨‹ï¼Ÿ\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆJSæ˜¯å•çº¿ç¨‹ï¼Ÿ\"></a>ä¸ºä»€ä¹ˆJSæ˜¯å•çº¿ç¨‹ï¼Ÿ</h3><blockquote>\n<p>è¿™ä¸ªè¦å›åˆ°Jså†å²äº†ï¼Œå¸ƒå…°ç™»Â·è‰¾å¥‡(Brendan Eich)è€å“¥ç”¨10å¤©åˆ›é€ jsã€‚å½“æ—¶jsç”¨æ¥å¹²å˜›ï¼Œç®€å•çš„æµè§ˆå™¨äº¤äº’ï¼ŒéªŒè¯ï¼Œæ“ä½œä¸€ä¸‹domæ˜¯å§ã€‚é‚£æŠŠå®ƒè®¾è®¡æˆé‚£ä¹ˆå¤æ‚å¹²ä»€ä¹ˆï¼Œè€Œä¸”å¦‚æœå¤šçº¿ç¨‹çš„è¯ï¼Œæ“ä½œdomä¼šå‡ºç°éº»çƒ¦çš„äº‹æƒ…ï¼Œå‡è®¾ä¸€ä¸ªçº¿ç¨‹è¯»å–DOMèŠ‚ç‚¹æ•°æ®çš„åŒæ—¶ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹æŠŠé‚£ä¸ªDOMèŠ‚ç‚¹åˆ äº†ï¼Œå‘µå‘µã€‚æ‰€ä»¥jsä¸€ä¸ªçº¿ç¨‹å°±å¤Ÿäº†ï¼Œä¹Ÿå°±æ˜¯ä¸€æ­¥ä¸€æ­¥é¡ºåºè¿è¡Œä¸‹æ¥ã€‚</p>\n</blockquote>\n<h2 id=\"æµè§ˆå™¨ä¸­çš„æ¶ˆæ¯é˜Ÿåˆ—å’Œäº‹ä»¶å¾ªç¯\"><a href=\"#æµè§ˆå™¨ä¸­çš„æ¶ˆæ¯é˜Ÿåˆ—å’Œäº‹ä»¶å¾ªç¯\" class=\"headerlink\" title=\"æµè§ˆå™¨ä¸­çš„æ¶ˆæ¯é˜Ÿåˆ—å’Œäº‹ä»¶å¾ªç¯\"></a>æµè§ˆå™¨ä¸­çš„æ¶ˆæ¯é˜Ÿåˆ—å’Œäº‹ä»¶å¾ªç¯</h2><p>è¿™é‡Œæš‚æ—¶åªè¯´æµè§ˆå™¨ä¸­çš„å¾ªç¯äº‹ä»¶å¾ªç¯ï¼Œæœ‰å…³nodeçš„è¯å¯èƒ½æœ‰äº›ç»†å¾®çš„å·®åˆ«ï¼Œä¸è¿‡åº•å±‚çš„åŸç†éƒ½æ˜¯å·®ä¸å¤šçš„ã€‚</p>\n<h3 id=\"æ³¨æ„\"><a href=\"#æ³¨æ„\" class=\"headerlink\" title=\"æ³¨æ„\"></a>æ³¨æ„</h3><p>è¿™é‡Œä¸»è¦æ˜¯ä»ä¸€ä¸ªè®¾è®¡è€…çš„è§’åº¦æ¥æ¨¡æ‹Ÿï¼Œä»é›¶æ„å»ºæµè§ˆå™¨ä¸­çš„æ—¶é—´å¾ªç¯ã€‚ä¸ºäº†èƒ½è®©ä½ æ›´åŠ æ·±åˆ»åœ°ç†è§£äº‹ä»¶å¾ªç¯æœºåˆ¶ï¼Œæˆ‘ä»¬å°±ä»æœ€ç®€å•çš„åœºæ™¯æ¥åˆ†æï¼Œç„¶åå¸¦ä½ ä¸€æ­¥æ­¥äº†è§£æµè§ˆå™¨é¡µé¢ä¸»çº¿ç¨‹æ˜¯å¦‚ä½•è¿ä½œçš„ã€‚</p>\n<h3 id=\"å¼€å§‹\"><a href=\"#å¼€å§‹\" class=\"headerlink\" title=\"å¼€å§‹\"></a>å¼€å§‹</h3><h4 id=\"äº‹å…ˆçº¦å®šå¥½çš„æ‰§è¡Œé¡ºåº\"><a href=\"#äº‹å…ˆçº¦å®šå¥½çš„æ‰§è¡Œé¡ºåº\" class=\"headerlink\" title=\"äº‹å…ˆçº¦å®šå¥½çš„æ‰§è¡Œé¡ºåº\"></a>äº‹å…ˆçº¦å®šå¥½çš„æ‰§è¡Œé¡ºåº</h4><p>å‡å¦‚æˆ‘æœ‰ä»¥ä¸‹å‡ ä¸ªä»»åŠ¡</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> num1 = <span class=\"number\">1</span>+<span class=\"number\">2</span>; <span class=\"comment\">// ä»»åŠ¡ 1</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> num2 = <span class=\"number\">20</span>/<span class=\"number\">5</span>; <span class=\"comment\">// ä»»åŠ¡ 2</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> num3 = <span class=\"number\">7</span>*<span class=\"number\">8</span>; <span class=\"comment\">// ä»»åŠ¡ 3</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(num1, num2, num3)ï¼› <span class=\"comment\">// ä»»åŠ¡ 4</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>å¦‚æœè®©æˆ‘æ¥è®¾è®¡ï¼Œæˆ‘å°±ä¼šæœ‰ä¸€ä¸ªä¸»çº¿ç¨‹ï¼Œç„¶åæŠŠä»–ä»¬æŒ‰é¡ºåºæ’è¿›å»ï¼Œç„¶åé¡ºåºæ‰§è¡Œã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">mainThread</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> num1 = <span class=\"number\">1</span>+<span class=\"number\">2</span>; <span class=\"comment\">// ä»»åŠ¡ 1</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> num2 = <span class=\"number\">20</span>/<span class=\"number\">5</span>; <span class=\"comment\">// ä»»åŠ¡ 2</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> num3 = <span class=\"number\">7</span>*<span class=\"number\">8</span>; <span class=\"comment\">// ä»»åŠ¡ 3</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(num1, num2, num3)ï¼› <span class=\"comment\">// ä»»åŠ¡ 4</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ğŸ˜¯ï¼Œæˆ‘ä»¬å·²ç»è®¾è®¡äº†æœ€ç®€å•çš„çº¿ç¨‹å•¦ã€‚</p>\n<h4 id=\"çº¿ç¨‹è¿è¡Œä¸­ï¼Œå¤„ç†çªå‘äº‹ä»¶\"><a href=\"#çº¿ç¨‹è¿è¡Œä¸­ï¼Œå¤„ç†çªå‘äº‹ä»¶\" class=\"headerlink\" title=\"çº¿ç¨‹è¿è¡Œä¸­ï¼Œå¤„ç†çªå‘äº‹ä»¶\"></a>çº¿ç¨‹è¿è¡Œä¸­ï¼Œå¤„ç†çªå‘äº‹ä»¶</h4><p>å¾ˆå¤šæ—¶å€™ï¼Œæ‰€æœ‰çš„ä»»åŠ¡ä¸æ˜¯ä¹‹å‰å°±ç»Ÿä¸€å®‰æ’å¥½çš„ï¼Œæ¯”å¦‚âŒ¨ï¸çš„è¾“å…¥ï¼ŒğŸ–±çš„ç‚¹å‡»ç­‰ç­‰ã€‚</p>\n<p>å¦‚æœæƒ³è¦åœ¨çº¿ç¨‹è¿è¡Œä¸­å¯ä»¥å¾ˆå¥½çš„å¤„ç†è¿™äº›äº‹ä»¶ã€‚å°±éœ€è¦</p>\n<p> ====&gt;äº‹ä»¶å¾ªç¯ã€‚è¿™é‡Œæˆ‘ä»¬ç”¨whileæ¥å®ç°ç®€å•çš„äº‹ä»¶å¾ªç¯</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">awaitt</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">document</span>.addEventListener(<span class=\"string\">'keydown'</span>, resolve);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">mainThread</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">while</span>(<span class=\"literal\">true</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> result = <span class=\"keyword\">await</span> awaitt();</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(result);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">mainThread();</span><br></pre></td></tr></table></figure>\n\n<p>è¿™æ ·æ”¹ç‰ˆä¹‹åæœ‰äº†ä»¥ä¸‹å‡ ç‚¹æ”¹è¿›ï¼š</p>\n<ul>\n<li>å¼•å…¥äº†å¾ªç¯æœºåˆ¶</li>\n<li>å¼•å…¥äº‹ä»¶ï¼Œç„¶åæ•´ä¸ªçº¿ç¨‹åœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œæ´»äº†èµ·æ¥ï¼Œä¸å†æ˜¯æ­»çš„ï¼Œè¿è¡Œå®Œå°±æ»šè›‹äº†çš„é‚£ç§ï¼Œæœ‰äº†äº¤äº’äº†</li>\n</ul>\n<p>ï¼ˆğŸ¤«æœ€ç®€å•çš„å®ç°ã€‚ã€‚ã€‚åˆ«åæ§½ä»£ç ï¼Œéƒ½æ˜¯æœ€ç®€å•çš„å®ç°å’Œæœ€ç®€å•çš„åœºæ™¯ï¼ŒåŠ©äºç†è§£è€Œå·²ã€‚ã€‚ã€‚ï¼‰</p>\n<h4 id=\"å¤„ç†å…¶ä»–çº¿ç¨‹çš„ä»»åŠ¡\"><a href=\"#å¤„ç†å…¶ä»–çº¿ç¨‹çš„ä»»åŠ¡\" class=\"headerlink\" title=\"å¤„ç†å…¶ä»–çº¿ç¨‹çš„ä»»åŠ¡\"></a>å¤„ç†å…¶ä»–çº¿ç¨‹çš„ä»»åŠ¡</h4><p>ä¸Šé¢çš„ç‰ˆæœ¬ç”¨äº†äº‹ä»¶å¾ªç¯çš„æ–¹å¼æ¥è·å–å†…éƒ¨çš„äº‹ä»¶ï¼Œä½†æ˜¯å¯¹äºå¤–éƒ¨çªå‘æƒ…å†µçš„äº‹ä»¶æ˜¯æ— æ³•è§£å†³çš„ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦å‡çº§~</p>\n<p>é‚£ä¹ˆæ€ä¹ˆè®¾è®¡å¥½ä¸€ä¸ªçº¿ç¨‹æ¨¡å‹å‘¢ï¼Ÿæˆ‘ä»¬æ¢ä¸ªè§’åº¦æƒ³æƒ³æ€è·¯é©¬ä¸Šå°±å‡ºæ¥äº†ã€‚</p>\n<p>è¿™äº›å¤–éƒ¨çš„ä»»åŠ¡ï¼Œéƒ½æ˜¯æœ‰å…ˆåé¡ºåºçš„ï¼Œå“ªæ€•æ˜¯éƒ½æ˜¯çªå‘æƒ…å†µã€‚ä»–ä»¬ä¹Ÿæ˜¯æœ‰å…ˆåé¡ºåºã€‚</p>\n<p>æ‰€ä»¥ä¸€ä¸ªæ¯”è¾ƒé€šç”¨çš„æ¨¡å¼å°±æ˜¯</p>\n<p>======&gt; æ¶ˆæ¯é˜Ÿåˆ—</p>\n<blockquote>\n<p>æ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œå¯ä»¥å­˜æ”¾è¦æ‰§è¡Œçš„ä»»åŠ¡ã€‚å®ƒç¬¦åˆé˜Ÿåˆ—â€œå…ˆè¿›å…ˆå‡ºâ€çš„ç‰¹ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´è¦æ·»åŠ ä»»åŠ¡çš„è¯ï¼Œæ·»åŠ åˆ°é˜Ÿåˆ—çš„å°¾éƒ¨ï¼›è¦å–å‡ºä»»åŠ¡çš„è¯ï¼Œä»é˜Ÿåˆ—å¤´éƒ¨å»å–ã€‚</p>\n</blockquote>\n<p>æˆ‘ä»¬è¦å®Œæˆä»¥ä¸‹å‡ ä¸ªæ“ä½œï¼š</p>\n<ol>\n<li>æ·»åŠ ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼›</li>\n<li>IO çº¿ç¨‹ä¸­äº§ç”Ÿçš„æ–°ä»»åŠ¡æ·»åŠ è¿›æ¶ˆæ¯é˜Ÿåˆ—å°¾éƒ¨ï¼›</li>\n<li>æ¸²æŸ“ä¸»çº¿ç¨‹ä¼šå¾ªç¯åœ°ä»æ¶ˆæ¯é˜Ÿåˆ—å¤´éƒ¨ä¸­è¯»å–ä»»åŠ¡ï¼Œæ‰§è¡Œä»»åŠ¡ã€‚</li>\n</ol>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> arrTask = []</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addTask</span>(<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">  arrTask.push(fn)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">otherThread</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  addTask(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;<span class=\"built_in\">console</span>.log(<span class=\"string\">'other'</span>)&#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">awaitt</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(arrTask.length) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> task = arrTask.shift()</span><br><span class=\"line\">        task()</span><br><span class=\"line\">        resolve()</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">mainThread</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">while</span>(<span class=\"literal\">true</span>)&#123;</span><br><span class=\"line\">    \t<span class=\"keyword\">await</span> awaitt();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">addTask(<span class=\"function\"><span class=\"params\">()</span>=&gt;</span><span class=\"built_in\">console</span>.log(<span class=\"string\">'in'</span>))</span><br><span class=\"line\">addTask(<span class=\"function\"><span class=\"params\">()</span>=&gt;</span><span class=\"built_in\">console</span>.log(<span class=\"string\">'in'</span>))</span><br><span class=\"line\">addTask(<span class=\"function\"><span class=\"params\">()</span>=&gt;</span><span class=\"built_in\">console</span>.log(<span class=\"string\">'in'</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">mainThread();</span><br><span class=\"line\">otherThread()</span><br></pre></td></tr></table></figure>\n\n\n\n<p>æˆ‘ä»¬ç”¨ä¸€ä¸ªæ•°ç»„æ¥æ¨¡æ‹Ÿä¸€ä¸ªé˜Ÿåˆ—ã€‚</p>\n<p>æ—¢åŸºç¡€äº†å†…éƒ¨çš„ä»»åŠ¡ï¼Œä¹Ÿå¤„ç†äº†å¤–éƒ¨çªå‘çš„ä»»åŠ¡</p>\n<p>æœ‰ä»»åŠ¡è¿›æ¥ï¼Œ å°±ä¼šæ‰§è¡Œä»»åŠ¡ã€‚</p>\n<h4 id=\"é€€å‡ºä¸»çº¿ç¨‹\"><a href=\"#é€€å‡ºä¸»çº¿ç¨‹\" class=\"headerlink\" title=\"é€€å‡ºä¸»çº¿ç¨‹\"></a>é€€å‡ºä¸»çº¿ç¨‹</h4><p>å½“é¡µé¢ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæˆä¹‹åï¼Œåˆè¯¥å¦‚ä½•ä¿è¯é¡µé¢ä¸»çº¿ç¨‹èƒ½å¤Ÿå®‰å…¨é€€å‡ºå‘¢ï¼ŸChrome æ˜¯è¿™æ ·è§£å†³çš„ï¼Œç¡®å®šè¦é€€å‡ºå½“å‰é¡µé¢æ—¶ï¼Œé¡µé¢ä¸»çº¿ç¨‹ä¼šè®¾ç½®ä¸€ä¸ªé€€å‡ºæ ‡å¿—çš„å˜é‡ï¼Œåœ¨æ¯æ¬¡æ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰è®¾ç½®é€€å‡ºæ ‡å¿—ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> arrTask = []</span><br><span class=\"line\"><span class=\"keyword\">let</span> over = <span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addTask</span>(<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">  arrTask.push(fn)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">otherThread</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  addTask(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;<span class=\"built_in\">console</span>.log(<span class=\"string\">'other'</span>)&#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">awaitt</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(arrTask.length) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> task = arrTask.shift()</span><br><span class=\"line\">        task()</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!arrTask.length)&#123;</span><br><span class=\"line\">          over = <span class=\"literal\">true</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        resolve()</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">mainThread</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">while</span>(<span class=\"literal\">true</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(over)&#123;</span><br><span class=\"line\">      <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    \t<span class=\"keyword\">await</span> awaitt();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">addTask(<span class=\"function\"><span class=\"params\">()</span>=&gt;</span><span class=\"built_in\">console</span>.log(<span class=\"string\">'in'</span>))</span><br><span class=\"line\">addTask(<span class=\"function\"><span class=\"params\">()</span>=&gt;</span><span class=\"built_in\">console</span>.log(<span class=\"string\">'in'</span>))</span><br><span class=\"line\">addTask(<span class=\"function\"><span class=\"params\">()</span>=&gt;</span><span class=\"built_in\">console</span>.log(<span class=\"string\">'in'</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">mainThread();</span><br><span class=\"line\">otherThread()</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"å•çº¿ç¨‹çš„ç¼ºç‚¹\"><a href=\"#å•çº¿ç¨‹çš„ç¼ºç‚¹\" class=\"headerlink\" title=\"å•çº¿ç¨‹çš„ç¼ºç‚¹\"></a>å•çº¿ç¨‹çš„ç¼ºç‚¹</h3><p>é€šè¿‡ä¸Šé¢çš„ä»‹ç»ï¼Œä½ åº”è¯¥æ¸…æ¥šäº†ï¼Œé¡µé¢çº¿ç¨‹æ‰€æœ‰æ‰§è¡Œçš„ä»»åŠ¡éƒ½æ¥è‡ªäºæ¶ˆæ¯é˜Ÿåˆ—ã€‚æ¶ˆæ¯é˜Ÿåˆ—æ˜¯â€œå…ˆè¿›å…ˆå‡ºâ€çš„å±æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´æ”¾å…¥é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œéœ€è¦ç­‰å¾…å‰é¢çš„ä»»åŠ¡è¢«æ‰§è¡Œå®Œï¼Œæ‰ä¼šè¢«æ‰§è¡Œã€‚é‰´äºè¿™ä¸ªå±æ€§ï¼Œå°±æœ‰å¦‚ä¸‹ä¸¤ä¸ªé—®é¢˜éœ€è¦è§£å†³ã€‚</p>\n<h4 id=\"å¦‚ä½•å¤„ç†é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡\"><a href=\"#å¦‚ä½•å¤„ç†é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡\" class=\"headerlink\" title=\"å¦‚ä½•å¤„ç†é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡\"></a>å¦‚ä½•å¤„ç†é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡</h4><p>åœºæ™¯ï¼š</p>\n<p>å‡å¦‚ï¼Œæˆ‘ç°åœ¨æœ‰ä¸€å¤§ä¸²çš„ä»»åŠ¡åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œã€‚</p>\n<p>æˆ‘çš„domèŠ‚ç‚¹å˜åŒ–çš„æ—¶å€™ï¼Œæˆ‘éœ€è¦å‘é€è¯·æ±‚æˆ–è€…æç¤ºä¸€ä¸ª<code>alert</code>ä¹‹ç±»çš„ä¸šåŠ¡é€»è¾‘è¦æ‰§è¡Œã€‚</p>\n<p>ç°åœ¨å¯è¡Œçš„æœ‰ä¸¤ç§æ–¹æ¡ˆï¼š</p>\n<ul>\n<li>domèŠ‚ç‚¹å˜åŒ–çš„è¯ï¼Œæˆ‘å°±åœä¸‹ç°åœ¨æ­£åœ¨è¿è¡Œçš„ä¸»çº¿ç¨‹ä¸Šçš„ä»»åŠ¡ï¼Œç„¶åè°ƒç”¨æˆ‘éœ€è¦æ‰§è¡Œçš„ä¸šåŠ¡é€»è¾‘ã€‚è¿™æ ·ç¡®å®å…·æœ‰å®æ•ˆæ€§ï¼Œä½†æ˜¯ï¼è¿™æ ·ä¼šä½¿å¾—å½“å‰ä»»åŠ¡çš„æ•ˆç‡æåº¦é™ä½ï¼Œæ¯”å¦‚æˆ‘çš„domèŠ‚ç‚¹å˜åŒ–200æ¬¡ï¼Œé‚£å²‚ä¸æ˜¯å½“å‰çš„ä»»åŠ¡ç‰¹åˆ«ä¹…äº†å—ï¼Ÿ</li>\n<li>ç¬¬äºŒä¸ªæ–¹æ³•å°±å¯ä»¥è§£å†³ä¸Šè¿°çš„é—®é¢˜ï¼šä¸€æ—¦domèŠ‚ç‚¹æœ‰å˜åŒ–ï¼Œå“ªæ€•æ˜¯200000æ¬¡å˜åŒ–ï¼Œæˆ‘éƒ½æ˜¯å°†ä¸šåŠ¡é€»è¾‘pushåˆ°é˜Ÿåˆ—çš„å°¾éƒ¨ï¼Œè¿™æ ·å°±ä¸ä¼šå½±å“å½“å‰ä»»åŠ¡è¿›è¡Œä»¥åŠæ•ˆç‡äº†ã€‚ä½†æ˜¯ï¼è¿™æ ·çš„è¯æˆ‘çš„å®æ•ˆæ€§å°±è«å¾—äº†ã€‚å°±è«å¾—äº†ã€‚</li>\n</ul>\n<p>æ€»ç»“ä¸€ä¸‹ï¼šå…¶å®å°±æ˜¯å®æ•ˆæ€§å’Œä»»åŠ¡æ•ˆç‡çš„æƒè¡¡é—®é¢˜ç½¢äº†ã€‚</p>\n<p>æ±Ÿæ±Ÿæ±Ÿ~</p>\n<p>å¾®ä»»åŠ¡å°±åº”è¿è€Œç”Ÿå•¦ã€‚</p>\n<p>åŠ å…¥æˆ‘ä»¬æŠŠä»»åŠ¡é˜Ÿåˆ—é‡Œé¢çš„æ¯ä¸ªä»»åŠ¡éƒ½ç§°ä½œå®ä»»åŠ¡çš„è¯ï¼Œæ¯ä¸ªå®ä»»åŠ¡é‡Œé¢éƒ½ä¼šåŒ…å«ä¸€ä¸ªå¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚æ¯ä¸ªå®ä»»åŠ¡ç»“æŸä¹‹åï¼Œéƒ½å›å»æ¸…ç†ä¸€éå¾®ä»»åŠ¡é˜Ÿåˆ—é‡Œé¢çš„é˜Ÿåˆ—ï¼Œè¿™æ ·çš„è¯æ—¢ä¿æŠ¤äº†å®æ•ˆæ€§ï¼Œä¹Ÿä¿æŠ¤äº†ä»»åŠ¡çš„æ•ˆç‡ã€‚</p>\n<h4 id=\"å¦‚ä½•å¤„ç†è°ƒç”¨æ—¶é—´è¿‡é•¿çš„é—®é¢˜\"><a href=\"#å¦‚ä½•å¤„ç†è°ƒç”¨æ—¶é—´è¿‡é•¿çš„é—®é¢˜\" class=\"headerlink\" title=\"å¦‚ä½•å¤„ç†è°ƒç”¨æ—¶é—´è¿‡é•¿çš„é—®é¢˜\"></a>å¦‚ä½•å¤„ç†è°ƒç”¨æ—¶é—´è¿‡é•¿çš„é—®é¢˜</h4><p>æˆ‘ä»¬éƒ½çŸ¥é“jsæ˜¯å•çº¿ç¨‹çš„ã€‚å¦‚æœç°åœ¨åœ¨æ‰§è¡Œä¸€ä¸ªä»»åŠ¡çš„æƒ…å†µä¸‹ã€‚å…¶ä»–ä»»åŠ¡å°±æ˜¯è¦ç­‰å¾…çš„ã€‚é‚£ä¹ˆå°±ä¼šå‡ºç°æŸä¸ªä»»åŠ¡è®¡ç®—çš„å‘¨æœŸç‰¹åˆ«é•¿ï¼Œå¯¼è‡´åˆ«äººéƒ½åœ¨ç­‰å¾…ã€‚</p>\n<p>ğŸ‘Œï¼Œæˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">while</span>(<span class=\"literal\">true</span>)&#123;&#125;</span><br><span class=\"line\">alter(<span class=\"number\">123</span>)</span><br></pre></td></tr></table></figure>\n\n<p>ä¸‹é¢çš„<code>alter</code>æ°¸è¿œéƒ½ä¸ä¼šæ‰§è¡Œäº†ã€‚å› ä¸º<code>while</code>åœ¨å·¥ä½œï¼Œ<code>alter</code>åœ¨ç­‰ä»–æŠŠèµ„æºè®©å‡ºæ¥ã€‚</p>\n<p>å‡å¦‚è¯´ï¼Œæˆ‘ç°åœ¨æœ‰ä¸€ä¸ªåŠ¨ç”»è¦è¿›è¡Œï¼Œä½†æ˜¯è¿è¡Œå®Œä¸€å¸§ä¹‹åï¼Œæœ‰ä¸€ä¸ªæå…¶å¤æ‚çš„è®¡ç®—ï¼Œå¯¼è‡´äº†æˆ‘çš„åŠ¨ç”»ä¸æµç•…ï¼Œé‚£ä¹ˆç”¨æˆ·å¯èƒ½å°±ä¼šéå¸¸çš„çƒ¦ã€‚è¿™ä¸æ˜¯æˆ‘ä»¬å¸Œæœ›çœ‹åˆ°çš„ã€‚</p>\n<p>æ‰€ä»¥jsæœ‰ä¸€ä¸ªå›è°ƒæœºåˆ¶ï¼Œåˆ°äº†ç‰¹å®šçš„æ—¶é—´ç‚¹äº†ï¼Œå›è°ƒä¸€ä¸‹ï¼ŒæŠŠåŠ¨ç”»çš„ä¸‹ä¸€å¸§æ‰§è¡Œä¸€ä¸‹ï¼Œç„¶åç»§ç»­å½“å‰çš„å¤æ‚è®¡ç®—ã€‚</p>\n<h3 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h3><ul>\n<li>å¦‚æœæœ‰ä¸€äº›ç¡®å®šå¥½çš„ä»»åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå•çº¿ç¨‹æ¥æŒ‰ç…§é¡ºåºå¤„ç†è¿™äº›ä»»åŠ¡ï¼Œè¿™æ˜¯ç¬¬ä¸€ç‰ˆçº¿ç¨‹æ¨¡å‹ã€‚</li>\n<li>è¦åœ¨çº¿ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­æ¥æ”¶å¹¶å¤„ç†æ–°çš„ä»»åŠ¡ï¼Œå°±éœ€è¦å¼•å…¥å¾ªç¯è¯­å¥å’Œäº‹ä»¶ç³»ç»Ÿï¼Œè¿™æ˜¯ç¬¬äºŒç‰ˆçº¿ç¨‹æ¨¡å‹ã€‚</li>\n<li>å¦‚æœè¦æ¥æ”¶å…¶ä»–çº¿ç¨‹å‘é€è¿‡æ¥çš„ä»»åŠ¡ï¼Œå°±éœ€è¦å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¿™æ˜¯ç¬¬ä¸‰ç‰ˆçº¿ç¨‹æ¨¡å‹ã€‚</li>\n<li>å¦‚æœå…¶ä»–è¿›ç¨‹æƒ³è¦å‘é€ä»»åŠ¡ç»™é¡µé¢ä¸»çº¿ç¨‹ï¼Œé‚£ä¹ˆå…ˆé€šè¿‡ IPC æŠŠä»»åŠ¡å‘é€ç»™æ¸²æŸ“è¿›ç¨‹çš„ IO çº¿ç¨‹ï¼ŒIO çº¿ç¨‹å†æŠŠä»»åŠ¡å‘é€ç»™é¡µé¢ä¸»çº¿ç¨‹ã€‚</li>\n<li>æ¶ˆæ¯é˜Ÿåˆ—æœºåˆ¶å¹¶ä¸æ˜¯å¤ªçµæ´»ï¼Œä¸ºäº†é€‚åº”æ•ˆç‡å’Œå®æ—¶æ€§ï¼Œå¼•å…¥äº†å¾®ä»»åŠ¡</li>\n</ul>\n<p>åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„è®¾è®¡æ˜¯ç›®å‰ä½¿ç”¨æœ€å¹¿çš„æ¶ˆæ¯æ¶æ„ï¼Œæ— è®ºæ˜¯å®‰å“è¿˜æ˜¯ Chrome éƒ½é‡‡ç”¨äº†ç±»ä¼¼çš„ä»»åŠ¡æœºåˆ¶ï¼Œæ‰€ä»¥ç†è§£äº†æœ¬ç¯‡æ–‡ç« çš„å†…å®¹åï¼Œä½ å†ç†è§£å…¶ä»–é¡¹ç›®çš„ä»»åŠ¡æœºåˆ¶ä¹Ÿä¼šæ¯”è¾ƒè½»æ¾ã€‚</p>\n<h2 id=\"æµè§ˆå™¨æ˜¯æ€ä¹ˆå®ç°setTimeout\"><a href=\"#æµè§ˆå™¨æ˜¯æ€ä¹ˆå®ç°setTimeout\" class=\"headerlink\" title=\"æµè§ˆå™¨æ˜¯æ€ä¹ˆå®ç°setTimeout\"></a>æµè§ˆå™¨æ˜¯æ€ä¹ˆå®ç°setTimeout</h2><p>è¦æƒ³çŸ¥é“æµè§ˆå™¨æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œæˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹ï¼Œæˆ‘ä»¬ä¹‹å‰è®¾è®¡çš„é‚£ä¸ªäº‹ä»¶å¾ªç¯ç³»ç»Ÿï¼š</p>\n<p>æœ‰xxä»»åŠ¡äº†ï¼Œokï¼Œæˆ‘<code>push</code>åˆ°ä»»åŠ¡é˜Ÿåˆ—ã€‚ä»¥æ­¤å¾ªç¯ã€‚</p>\n<p>æ‰€ä»¥æˆ‘ä»¬å†™åœ¨<code>setTimeout</code>é‡Œé¢çš„å‡½æ•°æ‰§è¡Œå…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªä»»åŠ¡ï¼Œä¹Ÿæ˜¯éœ€è¦pushåˆ°ä»»åŠ¡é˜Ÿåˆ—å»çš„ã€‚</p>\n<p>ä½†æ˜¯ï¼Œæˆ‘ä»¬çš„è¿™ä¸ªæ˜¯å…¶å®æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„å‡½æ•°ï¼Œä¸èƒ½ç›´æ¥å°†æ•´ä¸ªå‡½æ•°pushåˆ°é˜Ÿåˆ—ä¸­ï¼Œå¦åˆ™çš„è¯æˆ‘ä»¬çš„å®æ•ˆæ€§å°±å¾ˆæœ‰å¯èƒ½å‡ºé”™äº†ï¼Œæ¯”å¦‚æˆ‘å¸Œæœ›ä»–åœ¨24å°æ—¶ä¹‹å<code>alter</code>å‘Šè¯‰æˆ‘å·²ç»åˆ°äº†ç¬¬äºŒå¤©äº†ã€‚ä»–å¦‚æœæ˜¯ç›´æ¥pushåˆ°ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ²¡æœ‰åˆ°ç¬¬äºŒå¤©å°±ä¼šå‘Šè¯‰æˆ‘ç¬¬äºŒå¤©åˆ°äº†ï¼Œè¿™ä¸æ˜¯è®©ç”¨æˆ·åŒªå¤·æ‰€æ€å˜›ã€‚</p>\n<p>æ‰€ä»¥è‚¯å®šä¸æ˜¯ç›´æ¥<code>push</code>çš„ã€‚é‚£åˆæ˜¯æ€ä¹ˆå¼„å¾—å˜ï¼Ÿ</p>\n<p>ä½ ä¹Ÿå¯ä»¥æ€è€ƒä¸‹ï¼Œå¦‚æœè®©ä½ åœ¨æ¶ˆæ¯å¾ªç¯ç³»ç»Ÿçš„åŸºç¡€ä¹‹ä¸ŠåŠ ä¸Šå®šæ—¶å™¨çš„åŠŸèƒ½ï¼Œä½ ä¼šå¦‚ä½•è®¾è®¡ï¼Ÿ</p>\n<p>åœ¨ Chrome ä¸­é™¤äº†æ­£å¸¸ä½¿ç”¨çš„æ¶ˆæ¯é˜Ÿåˆ—ä¹‹å¤–ï¼Œè¿˜æœ‰å¦å¤–ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¿™ä¸ªé˜Ÿåˆ—ä¸­ç»´æŠ¤äº†éœ€è¦å»¶è¿Ÿæ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨ï¼ŒåŒ…æ‹¬äº†å®šæ—¶å™¨å’Œ Chromium å†…éƒ¨ä¸€äº›éœ€è¦å»¶è¿Ÿæ‰§è¡Œçš„ä»»åŠ¡ã€‚æ‰€ä»¥å½“é€šè¿‡ JavaScript åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨æ—¶ï¼Œæ¸²æŸ“è¿›ç¨‹ä¼šå°†è¯¥å®šæ—¶å™¨çš„å›è°ƒä»»åŠ¡æ·»åŠ åˆ°å»¶è¿Ÿé˜Ÿåˆ—ä¸­</p>\n<p>æˆ‘ä»¬æŠŠä¹‹å‰çš„äº‹ä»¶å¾ªç¯æ¨¡æ‹Ÿæ”¹ä¸€ä¸‹</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> mainTask = [</span><br><span class=\"line\">  fn1,</span><br><span class=\"line\">  fn2,</span><br><span class=\"line\">  fn3,</span><br><span class=\"line\">  â€¦â€¦</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> setTimeoutTask = []</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addSetTimeoutTask</span>(<span class=\"params\">fn, timeout</span>)</span>&#123;</span><br><span class=\"line\">  setTimeoutTask.push(&#123;</span><br><span class=\"line\">    fn: fn,</span><br><span class=\"line\">    id: <span class=\"built_in\">Math</span>.random(),</span><br><span class=\"line\">    useTime: timeout + ((<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>()).getTime()</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> runSetTimeoutTask ()&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> runList = []</span><br><span class=\"line\">  setTimeoutTask.forEach(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// å·²ç»è¿‡äº†æ—¶é—´ï¼Œæˆ–è€…åˆšåˆšå¥½åˆ°æ—¶é—´çš„è¯å°±å–å‡ºæ¥ã€‚å¾…ä¼šä¸€èµ·æ‰§è¡Œäº†</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(item.useTime &lt;= ((<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>()).getTime()) &#123;</span><br><span class=\"line\">      runList.push(item.fn) </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(runList.length) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> fn = runList.shift()</span><br><span class=\"line\">    fn()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">mainThread</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">while</span>(<span class=\"literal\">true</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> task = arrTask.shift()</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// æ¯æ¬¡æ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡ï¼Œéƒ½å›å»æŸ¥æ‰¾ä¸€ä¸‹å»¶è¿Ÿé˜Ÿåˆ—é‡Œé¢æœ‰æ²¡æœ‰åˆ°ç‚¹çš„å‡½æ•°</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(setTimeoutTask.length) &#123;</span><br><span class=\"line\">       runSetTimeoutTask()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">mainThread();</span><br></pre></td></tr></table></figure>\n\n<p>æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä¼šçœ‹åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯å…¶å®ä½ åˆ°ç‚¹äº†å¯èƒ½è¦ä¸ä¼šç«‹åˆ»æ‰§è¡Œï¼Œå¿…é¡»ç­‰åˆ°ä¹‹å‰çš„ä»»åŠ¡æ‰§è¡Œå®Œäº†æ‰è½®åˆ°å»¶è¿Ÿé˜Ÿåˆ—çš„æŸ¥è¯¢å’Œæ‰§è¡Œã€‚</p>\n<p>æˆ‘ä»¬ä»£ç ä¸­æœ‰ä¸€ä¸ªå½©è›‹â€”-&gt; ID</p>\n<p>è¿™ä¸ªIDæœ‰ä»€ä¹ˆç”¨ï¼Ÿ</p>\n<p>å°±æ˜¯ç”¨äº<code>clearTimeout</code></p>\n<p>ç›´æ¥ä¼ å…¥IDï¼Œç„¶åå¾ªç¯æ‰¾åˆ°ä»–ï¼Œå°±å¯ä»¥ç›´æ¥ä»é˜Ÿåˆ—é‡Œé¢åˆ æ‰å°±å¥½äº†ã€‚</p>\n<p>è¿™é‡Œå°±ä¸éœ€è¦è´´ä»£ç äº†å§ï¼Ÿ</p>\n<h3 id=\"å†·çŸ¥è¯†\"><a href=\"#å†·çŸ¥è¯†\" class=\"headerlink\" title=\"å†·çŸ¥è¯†\"></a>å†·çŸ¥è¯†</h3><ul>\n<li><strong>å¦‚æœ setTimeout å­˜åœ¨åµŒå¥—è°ƒç”¨ï¼Œé‚£ä¹ˆç³»ç»Ÿä¼šè®¾ç½®æœ€çŸ­æ—¶é—´é—´éš”ä¸º 4 æ¯«ç§’</strong></li>\n<li><strong>æœªæ¿€æ´»çš„é¡µé¢ï¼ŒsetTimeout æ‰§è¡Œæœ€å°é—´éš”æ˜¯ 1000 æ¯«ç§’</strong><ul>\n<li>é™¤äº†å‰é¢çš„ 4 æ¯«ç§’å»¶è¿Ÿï¼Œè¿˜æœ‰ä¸€ä¸ªå¾ˆå®¹æ˜“è¢«å¿½ç•¥çš„åœ°æ–¹ï¼Œé‚£å°±æ˜¯æœªè¢«æ¿€æ´»çš„é¡µé¢ä¸­å®šæ—¶å™¨æœ€å°å€¼å¤§äº 1000 æ¯«ç§’ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ ‡ç­¾ä¸æ˜¯å½“å‰çš„æ¿€æ´»æ ‡ç­¾ï¼Œé‚£ä¹ˆå®šæ—¶å™¨æœ€å°çš„æ—¶é—´é—´éš”æ˜¯ 1000 æ¯«ç§’ï¼Œç›®çš„æ˜¯ä¸ºäº†ä¼˜åŒ–åå°é¡µé¢çš„åŠ è½½æŸè€—ä»¥åŠé™ä½è€—ç”µé‡ã€‚è¿™ä¸€ç‚¹ä½ åœ¨ä½¿ç”¨å®šæ—¶å™¨çš„æ—¶å€™è¦æ³¨æ„ã€‚</li>\n</ul>\n</li>\n<li><strong>å»¶æ—¶æ‰§è¡Œæ—¶é—´æœ‰æœ€å¤§å€¼</strong><ul>\n<li>é™¤äº†è¦äº†è§£å®šæ—¶å™¨çš„å›è°ƒå‡½æ•°æ—¶é—´æ¯”å®é™…è®¾å®šå€¼è¦å»¶åä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ä¸‹ï¼Œé‚£å°±æ˜¯ Chromeã€Safariã€Firefox éƒ½æ˜¯ä»¥ 32 ä¸ª bit æ¥å­˜å‚¨å»¶æ—¶å€¼çš„ï¼Œ32bit æœ€å¤§åªèƒ½å­˜æ”¾çš„æ•°å­—æ˜¯ 2147483647 æ¯«ç§’ï¼Œè¿™å°±æ„å‘³ç€ï¼Œå¦‚æœ setTimeout è®¾ç½®çš„å»¶è¿Ÿå€¼å¤§äº 2147483647 æ¯«ç§’ï¼ˆå¤§çº¦ 24.8 å¤©ï¼‰æ—¶å°±ä¼šæº¢å‡ºï¼Œè¿™å¯¼è‡´å®šæ—¶å™¨ä¼šè¢«ç«‹å³æ‰§è¡Œã€‚</li>\n</ul>\n</li>\n<li><strong>ä½¿ç”¨ setTimeout è®¾ç½®çš„å›è°ƒå‡½æ•°ä¸­çš„ this ä¸ç¬¦åˆç›´è§‰</strong><ul>\n<li>è¿™é‡Œå¯ä»¥çœ‹æˆ‘ä¹‹å‰çš„æ–‡ç« ï¼Œæœ‰å¯¹thisè¿›è¡Œæ”»ç ´</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"æ€»ç»“-1\"><a href=\"#æ€»ç»“-1\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h3><ul>\n<li>é¦–å…ˆï¼Œä¸ºäº†æ”¯æŒå®šæ—¶å™¨çš„å®ç°ï¼Œæµè§ˆå™¨å¢åŠ äº†å»¶æ—¶é˜Ÿåˆ—ã€‚</li>\n<li>å…¶æ¬¡ï¼Œç”±äºæ¶ˆæ¯é˜Ÿåˆ—æ’é˜Ÿå’Œä¸€äº›ç³»ç»Ÿçº§åˆ«çš„é™åˆ¶ï¼Œé€šè¿‡ setTimeout è®¾ç½®çš„å›è°ƒä»»åŠ¡å¹¶éæ€»æ˜¯å¯ä»¥å®æ—¶åœ°è¢«æ‰§è¡Œï¼Œè¿™æ ·å°±ä¸èƒ½æ»¡è¶³ä¸€äº›å®æ—¶æ€§è¦æ±‚è¾ƒé«˜çš„éœ€æ±‚äº†ã€‚</li>\n</ul>\n<h2 id=\"å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡\"><a href=\"#å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡\" class=\"headerlink\" title=\"å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡\"></a>å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡</h2><p>å…¶å®é€šè¿‡ä¹‹å‰çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å¯¹äº‹ä»¶å¾ªç¯å·²ç»äº†è§£çš„å·®ä¸å¤šäº†ï¼Œè¿™é‡Œä¸»è¦æ˜¯æ›´è¯¦ç»†äº†è§£ä¸€ä¸‹ä»–ä»¬ã€‚</p>\n<h3 id=\"å®ä»»åŠ¡\"><a href=\"#å®ä»»åŠ¡\" class=\"headerlink\" title=\"å®ä»»åŠ¡\"></a>å®ä»»åŠ¡</h3><p>å®ä»»åŠ¡æœ‰å“ªäº›ï¼Ÿ</p>\n<p>é™¤äº†å¾®ä»»åŠ¡çš„éƒ½æ˜¯å®ä»»åŠ¡ã€‚ã€‚ã€‚</p>\n<p>é‚£ä¹ˆå¾®ä»»åŠ¡æœ‰å“ªäº›ï¼Ÿ</p>\n<p><code>Process.nextTick</code>ã€<code>Promise.then catch finally</code>(æ³¨æ„æˆ‘ä¸æ˜¯è¯´ Promise)ã€<code>MutationObserver</code>ã€‚</p>\n<p>åœ¨ä¹‹å‰çš„å­¦ä¹ æˆ‘ä»¬çŸ¥é“åœ¨å®ä»»åŠ¡ç»“æŸä¹‹åï¼Œä¼šå»æ‰§è¡Œä»–è‡ªå·±å½“å‰çš„å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚åœ¨è¿™ä¸ªå¾®ä»»åŠ¡é˜Ÿåˆ—æ‰§è¡Œå®Œæˆä¹‹åå†å»æ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡ã€‚</p>\n<h3 id=\"å¾®ä»»åŠ¡\"><a href=\"#å¾®ä»»åŠ¡\" class=\"headerlink\" title=\"å¾®ä»»åŠ¡\"></a>å¾®ä»»åŠ¡</h3><p>å¼‚æ­¥å‡½æ•°æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>\n<p><strong>ç¬¬ä¸€ç§æ˜¯æŠŠå¼‚æ­¥å›è°ƒå‡½æ•°å°è£…æˆä¸€ä¸ªå®ä»»åŠ¡ï¼Œæ·»åŠ åˆ°æ¶ˆæ¯é˜Ÿåˆ—å°¾éƒ¨ï¼Œå½“å¾ªç¯ç³»ç»Ÿæ‰§è¡Œåˆ°è¯¥ä»»åŠ¡çš„æ—¶å€™æ‰§è¡Œå›è°ƒå‡½æ•°</strong>ã€‚è¿™ç§æ¯”è¾ƒå¥½ç†è§£ï¼Œæˆ‘ä»¬å‰é¢ä»‹ç»çš„ setTimeout å’Œ XMLHttpRequest çš„å›è°ƒå‡½æ•°éƒ½æ˜¯é€šè¿‡è¿™ç§æ–¹å¼æ¥å®ç°çš„ã€‚</p>\n<p><strong>ç¬¬äºŒç§æ–¹å¼çš„æ‰§è¡Œæ—¶æœºæ˜¯åœ¨ä¸»å‡½æ•°æ‰§è¡Œç»“æŸä¹‹åã€å½“å‰å®ä»»åŠ¡ç»“æŸä¹‹å‰æ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œè¿™é€šå¸¸éƒ½æ˜¯ä»¥å¾®ä»»åŠ¡å½¢å¼ä½“ç°çš„</strong>ã€‚</p>\n<ul>\n<li>å¾®ä»»åŠ¡å’Œå®ä»»åŠ¡æ˜¯ç»‘å®šçš„ï¼Œæ¯ä¸ªå®ä»»åŠ¡åœ¨æ‰§è¡Œæ—¶ï¼Œä¼šåˆ›å»ºè‡ªå·±çš„å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚</li>\n<li>å¾®ä»»åŠ¡çš„æ‰§è¡Œæ—¶é•¿ä¼šå½±å“åˆ°å½“å‰å®ä»»åŠ¡çš„æ—¶é•¿ã€‚æ¯”å¦‚ä¸€ä¸ªå®ä»»åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œäº§ç”Ÿäº† 100 ä¸ªå¾®ä»»åŠ¡ï¼Œæ‰§è¡Œæ¯ä¸ªå¾®ä»»åŠ¡çš„æ—¶é—´æ˜¯ 10 æ¯«ç§’ï¼Œé‚£ä¹ˆæ‰§è¡Œè¿™ 100 ä¸ªå¾®ä»»åŠ¡çš„æ—¶é—´å°±æ˜¯ 1000 æ¯«ç§’ï¼Œä¹Ÿå¯ä»¥è¯´è¿™ 100 ä¸ªå¾®ä»»åŠ¡è®©å®ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´å»¶é•¿äº† 1000 æ¯«ç§’ã€‚æ‰€ä»¥-ä½ åœ¨å†™ä»£ç çš„æ—¶å€™ä¸€å®šè¦æ³¨æ„æ§åˆ¶å¾®ä»»åŠ¡çš„æ‰§è¡Œæ—¶é•¿ã€‚</li>\n<li>åœ¨ä¸€ä¸ªå®ä»»åŠ¡ä¸­ï¼Œåˆ†åˆ«åˆ›å»ºä¸€ä¸ªç”¨äºå›è°ƒçš„å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡ï¼Œæ— è®ºä»€ä¹ˆæƒ…å†µä¸‹ï¼Œå¾®ä»»åŠ¡éƒ½æ—©äºå®ä»»åŠ¡æ‰§è¡Œã€‚</li>\n</ul>\n<h2 id=\"æœŸæœ«è€ƒè¯•\"><a href=\"#æœŸæœ«è€ƒè¯•\" class=\"headerlink\" title=\"æœŸæœ«è€ƒè¯•\"></a>æœŸæœ«è€ƒè¯•</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'script start'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">async1</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">await</span> async2()</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'async1 end'</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">async2</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'async2 end'</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">async1()</span><br><span class=\"line\"></span><br><span class=\"line\">setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'setTimeout'</span>)</span><br><span class=\"line\">&#125;, <span class=\"number\">0</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'Promise'</span>)</span><br><span class=\"line\">  resolve()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'promise1'</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'promise2'</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'script end'</span>)</span><br></pre></td></tr></table></figure>\n\n<p>å¤§å®¶å¯ä»¥è‡ªå·±åœ¨æµè§ˆå™¨é‡Œé¢è¯•è¯•å§ã€‚</p>\n"},{"title":"ã€é‡è¯†å‰ç«¯ã€‘åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿","date":"2020-07-13T15:51:21.000Z","cover":"/image/cover/web.jpeg","_content":"\n## æ¢ç©¶\n\næˆ‘è§‰å¾—å­¦ä¹ ä¸€ä¸ªä¸œè¥¿æœ€é‡è¦çš„æ˜¯ææ‡‚ä¸‰æ ·ä¸œè¥¿\n\nWhat/How/Why\n\n### What\n\nä»€ä¹ˆæ˜¯åŸå‹?ä»€ä¹ˆæ˜¯åŸå‹é“¾?ä»€ä¹ˆæ˜¯ç»§æ‰¿?\n\n#### åŸå‹\n\nåœ¨JavaScriptä¸­ï¼Œ**åŸå‹ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé€šè¿‡åŸå‹å¯ä»¥å®ç°å¯¹è±¡çš„å±æ€§ç»§æ‰¿ï¼Œ**JavaScriptçš„å¯¹è±¡ä¸­éƒ½åŒ…å«äº†ä¸€ä¸ª\" [[Prototype]]\"å†…éƒ¨å±æ€§ï¼Œè¿™ä¸ªå±æ€§æ‰€å¯¹åº”çš„å°±æ˜¯è¯¥å¯¹è±¡çš„åŸå‹ã€‚\n\n\"[[Prototype]]\"ä½œä¸ºå¯¹è±¡çš„å†…éƒ¨å±æ€§ï¼Œæ˜¯ä¸èƒ½è¢«ç›´æ¥è®¿é—®çš„ã€‚æ‰€ä»¥ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹ä¸€ä¸ªå¯¹è±¡çš„åŸå‹ï¼ŒFirefoxå’ŒChromeä¸­æä¾›äº†\"__proto__\"è¿™ä¸ª**éæ ‡å‡†**ï¼ˆä¸æ˜¯æ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒï¼‰çš„è®¿é—®å™¨ï¼ˆECMAå¼•å…¥äº†æ ‡å‡†å¯¹è±¡åŸå‹è®¿é—®å™¨\"Object.getPrototype(object)\"ï¼‰ã€‚\n\nç”¨ä¸€å¥è¯æ¥æ¦‚æ‹¬å°±æ˜¯: åŸå‹æ˜¯ä¸€ä¸ªå±æ€§å¯ä»¥è¢«ç»§æ‰¿çš„å¯¹è±¡.åŸå‹ä¹Ÿå¯ä»¥æœ‰è‡ªå·±çš„åŸå‹.\n\n####\tåŸå‹é“¾\n\nåŸå‹ä¹Ÿå¯ä»¥æœ‰è‡ªå·±çš„åŸå‹, è€Œä¸€ä¸ªä¸ªåŸå‹é€šè¿‡prototypeé“¾æ¥èµ·æ¥çš„å°±å«åšåŸå‹é“¾\n\n#### ç»§æ‰¿\n\nå„¿å­å¯ä»¥é€šè¿‡ç»§æ‰¿è·å¾—çˆ¶äº²çš„å±æ€§æˆ–è€…æ–¹æ³•; \n\n### why\n\nä¸ºä»€ä¹ˆä¼šæœ‰åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿?\n\næ‘˜è‡ªJavaScripté«˜çº§ç¨‹åºè®¾è®¡:\n\n> ç»§æ‰¿æ˜¯OOè¯­è¨€ä¸­çš„ä¸€ä¸ªæœ€ä¸ºäººæ´¥æ´¥ä¹é“çš„æ¦‚å¿µ.è®¸å¤šOOè¯­è¨€éƒ½æ”¯æŒä¸¤ç§ç»§æ‰¿æ–¹å¼: **æ¥å£ç»§æ‰¿** å’Œ **å®ç°ç»§æ‰¿** .æ¥å£ç»§æ‰¿åªç»§æ‰¿æ–¹æ³•ç­¾å,è€Œå®ç°ç»§æ‰¿åˆ™ç»§æ‰¿å®é™…çš„æ–¹æ³•.ç”±äºjsä¸­æ–¹æ³•æ²¡æœ‰ç­¾å,åœ¨ECMAScriptä¸­æ— æ³•å®ç°æ¥å£ç»§æ‰¿.ECMAScriptåªæ”¯æŒå®ç°ç»§æ‰¿,è€Œä¸”å…¶ `å®ç°ç»§æ‰¿` ä¸»è¦æ˜¯ä¾é åŸå‹é“¾æ¥å®ç°çš„.\n\n### How\n\n#### åŸå‹\n\næ€ä¹ˆæ‰¾åˆ°åŸå‹?\n\næˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨, æ‰“å¼€æ§åˆ¶å°(F12), å¯ä»¥ç›´æ¥è¾“å…¥ `const obj = {}`, æˆ‘ä»¬å°±å¯ä»¥æŠŠä»–ç›´æ¥ç‚¹å¼€.å‘ç°é‡Œé¢æœ‰ä¸€ä¸ª`__proto__` å…¶å®æˆ‘ä»¬è¾“å…¥çš„è¿™ä¸ªå¯¹è±¡, æ˜¯ä¸€ä¸ª`Object`æ„é€ å‡½æ•°çš„å®ä¾‹. æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ä¾‹çš„`__proto__`å±æ€§æ‰¾åˆ°ä»–çš„åŸå‹;\n\n#### åŸå‹é“¾\n\næ€ä¹ˆæ‰¾åˆ°åŸå‹é“¾?\n\nåœ¨æ‰¾ä¹‹å‰æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸ªåŸå‹ä¸æ„é€ å‡½æ•°ä¸å®ä¾‹ç›´æ¥çš„å…³ç³».\n\nå‡å®šæˆ‘ä»¬æœ‰ä¸€ä¸ªæ„é€ å‡½æ•° `function A(){}`, æˆ‘ä»¬ç§°ä»–ä¸ºA\n\næˆ‘ä»¬æœ‰ä¸€ä¸ªå®ä¾‹B, ä»–æ˜¯è¿™æ ·æ¥çš„: `const B = new A()`, æˆ‘ä»¬ç§°ä»–ä¸ºB\n\nAçš„åŸå‹ä¸ºC\n\næ¥ä¸‹é‡Œæˆ‘ä»¬å†™ä¸€ä¸ªç­‰å¼æ¥å¾ˆå¥½çš„å±•ç¤ºä»–ä»¬ä¹‹é—´çš„å…³ç³»\n\nA = prototype => C = construct => A = new => B = `__proto__` => C\n\nè§£é‡Šä¸€ä¸‹: Aæœ‰ä¸€ä¸ªå±æ€§`prototype` æŒ‡å‘Açš„åŸå‹ C, è€ŒCçš„å±æ€§`construct`æŒ‡å‘A, Aé€šè¿‡newæ–¹æ³•å¯ä»¥åˆ›å»ºå®ä¾‹B, è€ŒBæœ‰ä¸€ä¸ªå±æ€§`__proto__`æŒ‡å‘äº†C(Açš„åŸå‹)\n\n\n\nOK, ç†è§£å®Œä¸Šé¢çš„ä¸œè¥¿ä¹‹å, æˆ‘ä»¬å†åŠ ä¸€ä¸ªçŸ¥è¯†ç‚¹, Açš„åŸå‹C, ä¹Ÿæ˜¯Cçš„åŸå‹çš„ä¸€ä¸ªå®ä¾‹.\n\n\n\nå…ˆåˆ«æ‡‚æ²¡æ‡‚, æˆ‘ä»¬çœ‹ä¸€ä¸‹å®æˆ˜.\n\nä¹¦æ¥ä¸Šæ–‡ä¸­çš„åŸå‹, æˆ‘å†å¤åˆ¶ä¸€ä¸‹, æ–¹ä¾¿é˜…è¯»\n\n> æˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨, æ‰“å¼€æ§åˆ¶å°(F12), å¯ä»¥ç›´æ¥è¾“å…¥ `const obj = {}`, æˆ‘ä»¬å°±å¯ä»¥æŠŠä»–ç›´æ¥ç‚¹å¼€.å‘ç°é‡Œé¢æœ‰ä¸€ä¸ª`__proto__` å…¶å®æˆ‘ä»¬è¾“å…¥çš„è¿™ä¸ªå¯¹è±¡, æ˜¯ä¸€ä¸ª`Object`æ„é€ å‡½æ•°çš„å®ä¾‹. æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ä¾‹çš„`__proto__`å±æ€§æ‰¾åˆ°ä»–çš„åŸå‹;\n\næˆ‘ä»¬æ¥ç€ç‚¹å¼€`__proto__`,å‘ç°é‡Œé¢æœ‰ä¸€å †\"èŠ±é‡Œèƒ¡å“¨\"çš„ä¸œè¥¿, æˆ‘ä»¬æ‰¾åˆ°äº†å…¶ä¸­ä¸€ä¸ªå¾ˆçœ¼ç†Ÿçš„\"é“ä»”\" -> `construct`;\n\næ ¹æ®ä¹‹å‰çš„äº†è§£\n\n> â€‹\tA = prototype => C = construct => A = new => B = `__proto__` => C\n\næˆ‘ä»¬ç‚¹å¼€çš„è¿™ä¸ª`construct`å…¶å®é‚£ä¸ªç©ºå¯¹è±¡çš„æ„é€ å‡½æ•°`Object`, é‚£ä¹ˆä»–åº”è¯¥æœ‰ä¸€ä¸ª`prototype`æŒ‡å‘äº†ä»–çš„åŸå‹.\n\næˆ‘ä»¬æ‰¾æ‰¾, ç¡®å®å‘ç°äº†æœ‰è¿™ä¹ˆä¸€ä¸ªå±æ€§(`prototype`); é‚£ä¹ˆç‚¹å¼€ä¹‹ååº”è¯¥ä¸æœ€æ—©çš„ç©ºå¯¹è±¡çš„`__proto__`çš„å†…å®¹ä¸€è‡´. æ ¹æ®ç­‰å¼å¯å¾—;\n\n ##### æ€»ç»“ä¸€ä¸‹\n\nå¯¹è±¡çš„ `__proto__` å±æ€§æŒ‡å‘åŸå‹ï¼Œ `__proto__` å°†å¯¹è±¡å’ŒåŸå‹è¿æ¥èµ·æ¥ç»„æˆäº†åŸå‹é“¾\n\næ¥ä¸‹æ¥è¿›å…¥æˆ‘ä»¬çš„é‡å¤´æˆç»§æ‰¿\n\n### ç»§æ‰¿\n\nå…¶å®ç»§æ‰¿åˆåˆ†ä¸ºå¥½å¤šç§: åŸå‹é“¾ç»§æ‰¿, æ„é€ å‡½æ•°ç»§æ‰¿, ç»„åˆç»§æ‰¿å’Œå¯„ç”Ÿç»„åˆç»§æ‰¿;\n\n#### åŸå‹é“¾ç»§æ‰¿\n\n\n\n```js\nfunction A(){\n\tthis.array = [\"a\", \"b\", \"c\"];\n}\n\nfunction B(){\n}\n\n//ç»§æ‰¿äº† A\nB.prototype = new A()\n\nvar b1 = new B()\nb1.array.push(\"d\"); \nconsole.log(b1.array); //\"a,b,c,d\"\n\nvar b2 = new B(); \nconsole.log(b2.array); //\"a,b,c,d\"\n\nb2.array.push(\"e\")\nconsole.log(b2.array) //\"a,b,c,d,e\"\nconsole.log(b1.array) //\"a,b,c,d,e\"\n```\n\næˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªæ„é€ å‡½æ•°, Aå’ŒB; æ ¹æ®ä¹‹å‰çš„çŸ¥è¯†, æˆ‘ä»¬è®©Bçš„åŸå‹æŒ‡å‘äº†æ„é€ å‡½æ•°Aåˆ›é€ å‡ºæ¥çš„å®ä¾‹(`new A()`); ç„¶åæˆ‘ä»¬ç”¨æ„é€ å‡½æ•°Båˆ›é€ äº†å®ä¾‹b1,  å¾€ ç»§æ‰¿æ¥çš„å±æ€§array å¢åŠ ä¸€ä¸ªå­—ç¬¦ä¸²\"d\"; ç„¶åæˆ‘ä»¬è¾“å‡ºä¸€ä¸‹, æŒ‰ç…§æˆ‘ä»¬çš„é€¾æœŸçš„å¤šäº†ä¸€ä¸ª\"e\"çš„æƒ…å†µä¸‹, è¿˜æœ‰\"a,b,c\";\n\næ¥ä¸‹æ¥å°±æœ‰äº›é—®é¢˜äº†. æˆ‘ä»¬æŒ‰ç…§æƒ¯ä¾‹, é€šè¿‡æ„é€ å‡½æ•°B, åˆ›é€ äº†b2. b2ç¡®å®ä¹Ÿæœ‰äº†ç»§æ‰¿æ¥çš„å±æ€§\"array\", å¯æ˜¯è¿™ä¸ªarrayå¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„åˆå§‹çš„`[\"a\",\"b\",\"c\"]`; æˆ‘ä»¬æ”¾å¼ƒæ¢ç©¶, ç»§ç»­å¾€è¿™ä¸ª`array`é‡Œé¢å¢åŠ ä¸€ä¸ª`e`, è¾“å‡ºä¸€ä¸‹`b1`çš„å±æ€§`array`. ç¡®å®æ˜¯å¯ä»¥å¢åŠ è¿™ä¸ª`e`;\n\n\n\nå¯æ˜¯!\n\n\n\nå½“æˆ‘ä»¬è¾“å‡º`b1.array`æ—¶, å‘ç°b1ä¹Ÿè¢«æ”¹äº†, å’Œä¹‹å‰è¯¡å¼‚çš„b2å¤šå‡ºä¸€ä¸ª`d`ä¸€æ ·.\n\næ¢ç©¶å‘ç°è¿™ä¸ªç”±äºæˆ‘ä»¬ç”¨çš„æ˜¯å¼•ç”¨ç±»å‹, æ‰€ä»¥ä»–ä»¬å­˜å‚¨çš„æ˜¯æŒ‡å‘åŒä¸€ä¸ªå†…å­˜çš„å†…å­˜åœ°å€; æ‰€ä»¥æ‰ä¼šå‘ç”Ÿè¿™äº›é—®é¢˜. è¿™ä¹Ÿæš´éœ²äº†åŸå‹é“¾ç»§æ‰¿æ—¶çš„ä¸€ä¸ªé—®é¢˜.å¼•ç”¨ç±»å‹å¸¦æ¥çš„æ¯›ç—…;\n\nå…¶æ¬¡, æˆ‘ä»¬å‘ç°æˆ‘ä»¬çš„Bçš„åŸå‹æŒ‡å‘Açš„æ„é€ å‡½æ•°æ—¶ä¸èƒ½ä¼ é€’å‚æ•°, è¿™ä¹Ÿçš„è¯æœ‰ç‚¹å‘†æ¿\n\nç»¼ä¸ŠåŸå‹é“¾çš„ç»§æ‰¿åœ¨æ—¥å¸¸ä¸­æ˜¯å¾ˆå°‘ç”¨åˆ°çš„\n\n\n\n##### ä¼˜ç‚¹\n\nâ€‹    å­ç±»å¯ä»¥é€šè¿‡åŸå‹é“¾çš„æŸ¥æ‰¾ï¼Œå®ç°çˆ¶ç±»çš„å±æ€§å…¬ç”¨ä¸å­ç±»çš„å®ä¾‹\n\n##### ç¼ºç‚¹\n\n- ä¸€äº›å¼•ç”¨æ•°æ®æ“ä½œçš„æ—¶å€™ä¼šå‡ºé—®é¢˜ï¼Œä¸¤ä¸ªå®ä¾‹ä¼šå…¬ç”¨ç»§æ‰¿å®ä¾‹çš„å¼•ç”¨æ•°æ®ç±»\n- è°¨æ…å®šä¹‰æ–¹æ³•ï¼Œä»¥å…å®šä¹‰æ–¹æ³•ä¹Ÿç»§æ‰¿å¯¹è±¡åŸå‹çš„æ–¹æ³•é‡å\n- æ— æ³•ç›´æ¥ç»™çˆ¶çº§æ„é€ å‡½æ•°ä½¿ç”¨å‚æ•°\n\n\n\n#### æ„é€ å‡½æ•°ç»§æ‰¿\n\n```js\nfunction A(){\n\tthis.array = [\"a\", \"b\", \"c\"];\n}\n\nfunction B(){\n  A.call(this)\n}\n\n//ç»§æ‰¿äº† A\nB.prototype = new A()\n\nvar b1 = new B()\nb1.array.push(\"d\"); \nconsole.log(b1.array); //\"a,b,c,d\"\n\nvar b2 = new B(); \nconsole.log(b2.array); //\"a,b,c\"\n\nb2.array.push(\"e\")\nconsole.log(b2.array) //\"a,b,c,e\"\nconsole.log(b1.array) //\"a,b,c,d\"\n```\n\næˆ‘ä»¬å¥‡è¿¹èˆ¬çš„å‘ç°, æ„é€ å‡½æ•°çš„ç»§æ‰¿è§£å†³äº†æˆ‘ä»¬ä¹‹å‰å‘ç°çš„JavaScriptå¼•ç”¨é—®é¢˜.é‚£å‡½æ•°ä¼ å‚çš„é—®...\n\nå•ª!\n\nåœ, æˆ‘ä»¬ç°åœ¨æ¥ä¼ é€’ä¸€ä¸‹å‚æ•°!\n\næˆ‘ä»¬æŠŠä¸Šé¢çš„ä¾‹å­ä¿®æ”¹ä¸€ä¸‹\n\n```js\nfunction A(name){\n\tthis.array = [\"a\", \"b\", \"c\"];\n  this.name = name\n}\n\nfunction B(){\n  A.call(this, 'B')\n}\n\n//ç»§æ‰¿äº† A\nB.prototype = new A()\n\nvar b1 = new B()\nb1.array.push(\"d\"); \nconsole.log(b1.array); //\"a,b,c,d\"\nconsole.log(b1.name); //\"B\"\n\nvar b2 = new B(); \nconsole.log(b2.array); //\"a,b,c\"\nconsole.log(b1.name); //\"B\"\n\nb2.array.push(\"e\")\nconsole.log(b2.array) //\"a,b,c,e\"\nconsole.log(b1.array) //\"a,b,c,d\"\n```\n\nè¿™æ ·çš„è¯æˆ‘ä»¬è§£å†³äº†åŸå‹é“¾ç»§æ‰¿çš„ä¸¤ä¸ªé—®é¢˜(1.æ— æ³•ä¼ å‚, 2.jså¼•ç”¨é—®é¢˜);\n\nè¯¥ä¸ä¼šæœ‰äººè®¤ä¸ºè¿™æ ·å°±å¾ˆå®Œç¾äº†å§?ä¸ä¼šå§!ä¸ä¼šå§!\n\næˆ‘ä»¬å†·é™ä¸‹æ¥æƒ³æƒ³çœ‹, å…¶å®è¿™ä¸ªä¼ é€’å‚æ•°æ˜¯å‡ ä¹ç®—æ˜¯å†™æ­»çš„. è¿˜ä¸å¦‚ç›´æ¥åœ¨Aé‡Œé¢ç›´æ¥å†™æ­»å¥½äº†, æ ¹æœ¬å°±æ— æ³•å¤ç”¨å˜›; è€Œä¸”ï¼Œåœ¨è¶…ç±»å‹çš„åŸå‹ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œå¯¹å­ç±»å‹è€Œè¨€ä¹Ÿæ˜¯ä¸å¯è§çš„ï¼Œç»“ æœæ‰€æœ‰ç±»å‹éƒ½åªèƒ½ä½¿ç”¨æ„é€ å‡½æ•°æ¨¡å¼ã€‚è€ƒè™‘åˆ°è¿™äº›é—®é¢˜ï¼Œå€Ÿç”¨æ„é€ å‡½æ•°çš„æŠ€æœ¯ä¹Ÿæ˜¯å¾ˆå°‘å•ç‹¬ä½¿ç”¨çš„ã€‚\n\n##### ä¼˜ç‚¹\n\n- è§£å†³äº†åŸå‹é“¾ç»§æ‰¿çš„ å¼•ç”¨ç±»å‹æ“ä½œé—®é¢˜\n- è§£å†³äº†çˆ¶ç±»ä¼ é€’å‚æ•°é—®é¢˜\n\n##### ç¼ºç‚¹\n\n- ä»…ä»…ä½¿ç”¨å€Ÿç”¨æ„é€ å‡½æ•°æ¨¡å¼ç»§æ‰¿ï¼Œæ— æ³•æ‘†è„±å¤Ÿç€å‡½æ•°ã€‚æ–¹æ³•åœ¨æ„é€ å‡½æ•°ä¸­å®šä¹‰å¤ç”¨ä¸å¯è°ˆ\n- å¯¹äºè¶…ç±»çš„åŸå‹å®šä¹‰çš„æ–¹æ³•å¯¹äºå­ç±»æ˜¯ä¸å¯ä½¿ç”¨çš„ï¼Œå­ç±»çš„å®ä¾‹åªæ˜¯å¾—åˆ°äº†çˆ¶ç±»çš„thisç»‘å®šçš„å±æ€§ è€ƒè™‘åˆ°è¿™äº›ç¼ºç‚¹ï¼Œå•ç‹¬ä½¿ç”¨å€Ÿç”¨æ„é€ å‡½æ•°ä¹Ÿæ˜¯å¾ˆå°‘ä½¿ç”¨çš„\n\n\n\n#### ç»„åˆç»§æ‰¿\n\n```js\nfunction A(name){\n  this.name = name\n  this.array = ['1', '2', '3']\n}\nA.prototype.sayName = function (){console.log(this.name)}\n\nfunction B(name, age){\n  A.call(this, name);\n  this.age = age;\n}\n\nB.prototype = new A();\nB.prototype.constructor = A; // å› ä¸ºåŸå‹é“¾ç»§æ‰¿ï¼Œä¼šæŠŠconstructoræŒ‡å‘æ”¹å˜ï¼Œæ‰€ä»¥è¦é‡æ–°æŒ‡å›è‡ªèº«\nB.prototype.sayAge = function (){console.log(this.age)}\n\nvar a = new B('a', 10)\na.array.push('a')\nconsole.log(a.array) // [\"1\", \"2\", \"3\", \"a\"]\na.sayName() // 'a'\na.sayAge() // 10\n\nvar b = new B('b', 20)\nb.array.push('b')\nconsole.log(b.array) // [\"1\", \"2\", \"3\", \"b\"]\nb.sayName()// 'b'\nb.sayAge() // 20\n```\n\nåœ¨è¿™ä¸ªä¾‹å­ä¸­, æ„é€ å‡½æ•°Aæœ‰ä¸¤ä¸ªå†…ç½®å±æ€§`name`å’Œ`array`. Açš„åŸå‹å®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•`sayName`; æ„é€ å‡½æ•°Båœ¨è°ƒç”¨Açš„æ„é€ å‡½æ•°æ—¶ä¼ å…¥äº†ä¸€ä¸ªå‚æ•°`name`, ç„¶ååˆç»™Bçš„åŸå‹ä¸Šå®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•`sayAge`. è¿™æ ·ä¸€æ¥, å°±å¯ä»¥è®©ä¸¤ä¸ªBçš„å®ä¾‹åˆ†åˆ«æ‹¥æœ‰è‡ªå·±çš„å±æ€§, å½“ç„¶ä¹ŸåŒ…æ‹¬äº†array, è¿˜å¯ä»¥æ‹¥æœ‰ç›¸åŒçš„æ–¹æ³•.\n\nç»„åˆç»§æ‰¿é¿å…äº†åŸå‹é“¾å’Œå€Ÿç”¨æ„é€ å‡½æ•°çš„ç¼ºé™·ï¼Œèåˆäº†å®ƒä»¬çš„ä¼˜ç‚¹ï¼Œæˆä¸º JavaScript ä¸­æœ€å¸¸ç”¨çš„ç»§ æ‰¿æ¨¡å¼ã€‚è€Œä¸”(å…³é”®)ï¼Œ`instanceof` å’Œ `isPrototypeOf()`ä¹Ÿèƒ½å¤Ÿç”¨äºè¯†åˆ«åŸºäºç»„åˆç»§æ‰¿åˆ›å»ºçš„å¯¹è±¡ã€‚\n\n##### ä¼˜ç‚¹\n\n- è§£å†³äº†åŸå‹é“¾ç»§æ‰¿å¼•ç”¨ç±»å‹çš„å®ä¾‹æ“ä½œå¯¼è‡´å¼•ç”¨æ”¹å˜\n- è§£å†³äº†å€Ÿæ„é€ å‡½æ•°ç»§æ‰¿æ–¹å¼çš„ï¼Œçˆ¶ç±»åŸå‹å­ç±»å®ä¾‹å¯ä»¥ä½¿ç”¨\n\n##### ç¼ºç‚¹\n\nçˆ¶ç±»çš„æ„é€ å‡½æ•°è¢«å®ä¾‹æ¢äº†ä¸¤æ¬¡ * å®ä¾‹ä¼šæœ‰çˆ¶ç±»çš„æ„é€ å‡½æ•°çš„ä¸€äº›thiså±æ€§ã€å­ç±»çš„æ„é€ å‡½æ•°ï¼ˆprototypeï¼‰ä¸Šä¹Ÿæœ‰ä¸€ä»½å®ä¾‹çš„ä¸Šæœ‰çš„å±æ€§\n\n#### åŸå‹å¼ç»§æ‰¿\n\né“æ ¼æ‹‰æ–¯Â·å…‹ç½—å…‹ç¦å¾·åœ¨ 2006 å¹´å†™äº†ä¸€ç¯‡æ–‡ç« ï¼Œé¢˜ä¸º Prototypal Inheritance in JavaScript (JavaScript 10 ä¸­çš„åŸå‹å¼ç»§æ‰¿)ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œä»–ä»‹ç»äº†ä¸€ç§å®ç°ç»§æ‰¿çš„æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•å¹¶æ²¡æœ‰ä½¿ç”¨ä¸¥æ ¼æ„ä¹‰ä¸Šçš„ æ„é€ å‡½æ•°ã€‚ä»–çš„æƒ³æ³•æ˜¯å€ŸåŠ©åŸå‹å¯ä»¥åŸºäºå·²æœ‰çš„å¯¹è±¡åˆ›å»ºæ–°å¯¹è±¡ï¼ŒåŒæ—¶è¿˜ä¸å¿…å› æ­¤åˆ›å»ºè‡ªå®šä¹‰ç±»å‹ã€‚ä¸º äº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œä»–ç»™å‡ºäº†å¦‚ä¸‹å‡½æ•°ã€‚\n\n```js\nfunction object(o){\n  function F(){}\n  F.prototype = o\n  return new F\n}\n```\n\nçœ‹èµ·æ¥éå¸¸ç®€å•\n\nå…ˆåœ¨`object`å‡½æ•°å†…éƒ¨åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„æ„é€ å‡½æ•°`F`, ç„¶åå°†ä¼ å…¥çš„è¿™ä¸ªå¯¹è±¡`o`ä½œä¸ºè¿™ä¸ªä¸´æ—¶æ„é€ å‡½æ•°çš„åŸå‹, æœ€åè¿”å›è¿™ä¸ªä¸´æ—¶æ„é€ å‡½æ•°çš„å®ä¾‹. \n\nç®€å•æ¥è¯´å°±æ˜¯`object`å¯¹ä¼ å…¥çš„å¯¹è±¡è¿›è¡Œäº†æµ…å¤åˆ¶.\n\næµ…æ‹·è´å’Œæ·±æ‹·è´å¯ä»¥è‡ªè¡ŒGoogleä¸€ä¸‹, è¿™ç®—ä¸€ä¸ªé‡è¦çš„çŸ¥è¯†ç‚¹.\n\nä¸¾ä¸ªğŸŒ°\n\n```js\nfunction object(o){\n  function F(){}\n  F.prototype = o\n  return new F\n}\n\nvar a = {\n  name: 'a',\n  array: ['1', '2'],\n}\n\nvar qq = object(a)\nconsole.log(qq.name)\nqq.array.push('qq')\nconsole.log(qq.array)\n\nvar ww = object(a)\nconsole.log(ww.name)\nww.array.push('ww')\nconsole.log(ww.array)\nconsole.log(qq.array)\n```\n\næœ‰æ²¡æœ‰ä¼¼æ›¾ç›¸è¯†çš„æ„Ÿè§‰....åŸå‹é“¾ç»§æ‰¿çš„è€æ¯›ç—…æ¥äº†...\n\nä¸è¿‡ä»–ä¹Ÿä¸æ˜¯æ²¡æœ‰ä¼˜ç‚¹çš„.\n\nåœ¨æ²¡æœ‰å¿…è¦å…´å¸ˆåŠ¨ä¼—åœ°åˆ›å»ºæ„é€ å‡½æ•°ï¼Œè€Œåªæƒ³è®©ä¸€ä¸ªå¯¹è±¡ä¸å¦ä¸€ä¸ªå¯¹è±¡ä¿æŒç±»ä¼¼çš„æƒ…å†µä¸‹ï¼ŒåŸå‹å¼ ç»§æ‰¿æ˜¯å®Œå…¨å¯ä»¥èƒœä»»çš„ã€‚\n\n> ECMAScript 5 é€šè¿‡æ–°å¢ Object.create()æ–¹æ³•è§„èŒƒåŒ–äº†åŸå‹å¼ç»§æ‰¿ã€‚è¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°:ä¸€ ä¸ªç”¨ä½œæ–°å¯¹è±¡åŸå‹çš„å¯¹è±¡å’Œ(å¯é€‰çš„)ä¸€ä¸ªä¸ºæ–°å¯¹è±¡å®šä¹‰é¢å¤–å±æ€§çš„å¯¹è±¡ã€‚åœ¨ä¼ å…¥ä¸€ä¸ªå‚æ•°çš„æƒ…å†µä¸‹ï¼Œ Object.create()ä¸ object()æ–¹æ³•çš„è¡Œä¸ºç›¸åŒã€‚æœ‰å…´è¶£çš„è¯å¯ä»¥è‡ªå·±äº†è§£ä¸€ä¸‹\n\n##### ä¼˜ç‚¹\n\nå†ä¸ç”¨åˆ›å»ºæ„é€ å‡½æ•°çš„æƒ…å†µä¸‹ï¼Œå®ç°äº†åŸå‹é“¾ç»§æ‰¿ï¼Œä»£ç é‡å‡å°‘ä¸€éƒ¨åˆ†\n\n##### ç¼ºç‚¹\n\n- ä¸€äº›å¼•ç”¨æ•°æ®æ“ä½œçš„æ—¶å€™ä¼šå‡ºé—®é¢˜ï¼Œä¸¤ä¸ªå®ä¾‹ä¼šå…¬ç”¨ç»§æ‰¿å®ä¾‹çš„å¼•ç”¨æ•°æ®ç±»\n- è°¨æ…å®šä¹‰æ–¹æ³•ï¼Œä»¥å…å®šä¹‰æ–¹æ³•ä¹Ÿç»§æ‰¿å¯¹è±¡åŸå‹çš„æ–¹æ³•é‡å\n- æ— æ³•ç›´æ¥ç»™çˆ¶çº§æ„é€ å‡½æ•°ä½¿ç”¨å‚æ•°\n\n#### å¯„ç”Ÿç»§æ‰¿\n\nå¯„ç”Ÿç»§æ‰¿å’ŒåŸå‹å¼ç»§æ‰¿ç´§å¯†ç›¸å…³, åŒæ ·ä¹Ÿæ˜¯ç”±å…‹ç½—å…‹ç¦å¾·æ¨è€Œå¹¿ ä¹‹çš„.å¯„ç”Ÿå¼ç»§æ‰¿çš„æ€è·¯ä¸å¯„ç”Ÿæ„é€ å‡½æ•°å’Œå·¥å‚æ¨¡å¼ç±»ä¼¼ï¼Œå³åˆ›å»ºä¸€ä¸ªä»…ç”¨äºå°è£…ç»§æ‰¿è¿‡ç¨‹çš„å‡½æ•°ï¼Œè¯¥ å‡½æ•°åœ¨å†…éƒ¨ä»¥æŸç§æ–¹å¼æ¥å¢å¼ºå¯¹è±¡ï¼Œæœ€åå†åƒçœŸåœ°æ˜¯å®ƒåšäº†æ‰€æœ‰å·¥ä½œä¸€æ ·è¿”å›å¯¹è±¡ã€‚ä»¥ä¸‹ä»£ç ç¤ºèŒƒäº†å¯„ ç”Ÿå¼ç»§æ‰¿æ¨¡å¼ã€‚\n\nä¸Šä»£ç \n\n```js\nfunction object(o){\n  function F(){}\n  F.prototype = o\n  return new F\n}\n\nfunction createAnother(original){ \n  var clone=object(original); //é€šè¿‡è°ƒç”¨å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡\n  clone.sayHi = function(){ //ä»¥æŸç§æ–¹å¼æ¥å¢å¼ºè¿™ä¸ªå¯¹è±¡\n    alert(\"hi\");\n\t};\n\treturn clone;//è¿”å›è¿™ä¸ªå¯¹è±¡\n }\n```\n\nåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒcreateAnother()å‡½æ•°æ¥æ”¶äº†ä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯å°†è¦ä½œä¸ºæ–°å¯¹è±¡åŸºç¡€çš„å¯¹è±¡ã€‚ç„¶ åï¼ŒæŠŠè¿™ä¸ªå¯¹è±¡(original)ä¼ é€’ç»™ object()å‡½æ•°ï¼Œå°†è¿”å›çš„ç»“æœèµ‹å€¼ç»™ cloneã€‚å†ä¸º clone å¯¹è±¡ æ·»åŠ ä¸€ä¸ªæ–°æ–¹æ³• sayHi()ï¼Œæœ€åè¿”å› clone å¯¹è±¡ã€‚\n\n```js\nvar person = {\n\tname: \"Nicholas\",\n\tfriends: [\"Shelby\", \"Court\", \"Van\"]\n};\nvar anotherPerson = createAnother(person); \nanotherPerson.sayHi(); //\"hi\"\n```\n\nè¿™ä¸ªä¾‹å­ä¸­çš„ä»£ç åŸºäº person è¿”å›äº†ä¸€ä¸ªæ–°å¯¹è±¡â€”â€”anotherPersonã€‚æ–°å¯¹è±¡ä¸ä»…å…·æœ‰ person çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œè€Œä¸”è¿˜æœ‰è‡ªå·±çš„ sayHi()æ–¹æ³•ã€‚\n\nåœ¨ä¸»è¦è€ƒè™‘å¯¹è±¡è€Œä¸æ˜¯è‡ªå®šä¹‰ç±»å‹å’Œæ„é€ å‡½æ•°çš„æƒ…å†µä¸‹ï¼Œå¯„ç”Ÿå¼ç»§æ‰¿ä¹Ÿæ˜¯ä¸€ç§æœ‰ç”¨çš„æ¨¡å¼ã€‚å‰é¢ç¤º èŒƒç»§æ‰¿æ¨¡å¼æ—¶ä½¿ç”¨çš„ object()å‡½æ•°ä¸æ˜¯å¿…éœ€çš„;ä»»ä½•èƒ½å¤Ÿè¿”å›æ–°å¯¹è±¡çš„å‡½æ•°éƒ½é€‚ç”¨äºæ­¤æ¨¡å¼ã€‚\n\n> ä½¿ç”¨å¯„ç”Ÿç»§æ‰¿, ç”±äºä¸èƒ½åšåˆ°å‡½æ•°å¤ç”¨è€Œé™ä½æ•ˆç‡, è¿™ç‚¹å’Œæ„é€ å‡½æ•°ç»§æ‰¿å¾ˆåƒ\n\n##### ä¼˜ç‚¹\n\n- å†ä¸ç”¨åˆ›å»ºæ„é€ å‡½æ•°çš„æƒ…å†µä¸‹ï¼Œå®ç°äº†åŸå‹é“¾ç»§æ‰¿ï¼Œä»£ç é‡å‡å°‘ä¸€éƒ¨åˆ†\n- å¯ä»¥ç»™å¤‡ä»½çš„å¯¹è±¡æ·»åŠ ä¸€äº›å±æ€§\n\n##### ç¼ºç‚¹\n\nç±»ä¼¼æ„é€ å‡½æ•°ä¸€æ ·ï¼Œåˆ›å»ºå¯„ç”Ÿçš„æ–¹æ³•éœ€è¦åœ¨cloneå¯¹è±¡ä¸Šé¢æ·»åŠ ä¸€äº›æƒ³è¦çš„å±æ€§ï¼Œè¿™äº›å±æ€§æ˜¯æ”¾åœ¨cloneä¸Šé¢çš„ä¸€äº›ç§æœ‰çš„å±æ€§\n\n#### å¯„ç”Ÿç»„åˆç»§æ‰¿(ç»ˆææ–¹æ¡ˆ\n\nå‰é¢è¯´è¿‡ï¼Œç»„åˆç»§æ‰¿æ˜¯ JavaScript æœ€å¸¸ç”¨çš„ç»§æ‰¿æ¨¡å¼;ä¸è¿‡ï¼Œå®ƒä¹Ÿæœ‰è‡ªå·±çš„ä¸è¶³ã€‚ç»„åˆç»§æ‰¿æœ€å¤§çš„ é—®é¢˜å°±æ˜¯æ— è®ºä»€ä¹ˆæƒ…å†µä¸‹ï¼Œéƒ½ä¼šè°ƒç”¨ä¸¤æ¬¡è¶…ç±»å‹æ„é€ å‡½æ•°:ä¸€æ¬¡æ˜¯åœ¨åˆ›å»ºå­ç±»å‹åŸå‹çš„æ—¶å€™ï¼Œå¦ä¸€æ¬¡æ˜¯ åœ¨å­ç±»å‹æ„é€ å‡½æ•°å†…éƒ¨ã€‚æ²¡é”™ï¼Œå­ç±»å‹æœ€ç»ˆä¼šåŒ…å«è¶…ç±»å‹å¯¹è±¡çš„å…¨éƒ¨å®ä¾‹å±æ€§ï¼Œä½†æˆ‘ä»¬ä¸å¾—ä¸åœ¨è°ƒç”¨å­ ç±»å‹æ„é€ å‡½æ•°æ—¶é‡å†™è¿™äº›å±æ€§ã€‚å†æ¥çœ‹ä¸€çœ‹ä¸‹é¢ç»„åˆç»§æ‰¿çš„ä¾‹å­ã€‚\n\n```js\nfunction A(name){\n  this.name = name;\n  this.array = ['1','2','3']\n}\nA.prototype.sayName = function(){console.log(this.name)}\n\nfunction B(name, age){\n  \n  A.call(this, name) //ç¬¬äºŒæ¬¡è°ƒç”¨\n  this.age = age\n}\nB.prototype.sayAge = function(){console.log(this.age)}\n\nB.prototype = new A() // ç¬¬ä¸€æ¬¡è°ƒç”¨\nB.prototype.constructor = B\n```\n\nç¬¬ä¸€æ¬¡è°ƒç”¨Aæ„é€ å‡½æ•°çš„æ—¶å€™, Bçš„åŸå‹ä¸Šå°±æ‹¥æœ‰äº†Açš„ä¸¤ä¸ªå±æ€§å’Œä¸€ä¸ªæ–¹æ³•;\n\nç¬¬äºŒæ¬¡è°ƒç”¨Açš„æ„é€ å‡½æ•°æ—¶, ä¸ºBçš„å®ä¾‹åˆ›å»ºäº†Açš„ä¸¤ä¸ªçš„å±æ€§å’Œä¸€ä¸ªæ–¹æ³•, äºæ˜¯å®ä¾‹çš„ä¸¤ä¸ªå±æ€§å’Œä¸€ä¸ªæ–¹æ³•å°±å±è”½äº†åŸå‹ä¸Šçš„å®ä¾‹å’Œæ–¹æ³•; \n\næ˜¯ä¸æ˜¯æ„Ÿè§‰æœ‰ç‚¹ç‚¹æµªè´¹, ä¸è¿‡å¥½åœ¨æˆ‘ä»¬å·²ç»æ‰¾åˆ°è§£å†³æ–¹æ¡ˆ--->å¯„ç”Ÿç»„åˆç»§æ‰¿\n\nä¸¾ä¸€ä¸ªéå¸¸ç®€å•çš„ğŸŒ°, å¹¶ä¸”æˆ‘å°½é‡é€å­—é€å¥çš„è®²æ¸…æ¥š\n\n```js\nfunction object(o){\n  function F(){}\n  F.prototype = o\n  return new F\n} //ä¹Ÿå¯ä»¥ç”¨Object.createæ›¿ä»£\n\nfunction B(name){\n  this.name = name;\n  this.colors = [\"red\", \"blue\", \"green\"];\n}\n\nB.prototype.sayName = function(){ console.log(this.name);\n};\n\nfunction A(name, age){ \n  B.call(this, name); // åªè°ƒç”¨äº†è¿™ä¸€æ¬¡\n\tthis.age = age; \n}\n\nfunction inheritPrototype(A, B){ \n  //è®©prototypeå¯ä»¥æ‹¿åˆ°Bçš„å±æ€§å’Œæ–¹æ³•...è¿™æ˜¯åŸå‹å¼ç»§æ‰¿\n  var prototype = object(B.prototype); \n  //ç”±äºé‡å†™äº†åŸå‹, æ‰€ä»¥æ­¤æ—¶çš„constructorä¼šæŒ‡å‘Object, æ‰€ä»¥å¿…é¡»æŒ‡å®šä¸€ä¸‹constructor...é‚£ä¸ºä»€ä¹ˆä¼šä¸¢å¤±å‘¢?å› ä¸ºæˆ‘ä»¬ç©¿ç»™objectè¿™ä¸ªæ–¹æ³•çš„æ˜¯ä¸€ä¸ªå¯¹è±¡, è€Œå¯¹è±¡çš„æ„é€ å‡½æ•°å°±æ˜¯Object; åœ¨åŸå‹é‚£ä¸€å°èŠ‚æˆ‘ä»¬è¯´è¿‡äº†, åŸå‹ä¹Ÿæ˜¯å¯¹è±¡;\n  prototype.constructor = A; \n  // ç»§æ‰¿å±æ€§ä¹‹åå°±éœ€è¦å°†åŸå‹ç»™æŒ‡å‘å›å», ä¸ºäº†åŸå‹é“¾çš„æ­£ç¡®æŒ‡å‘\n  A.prototype = prototype;\n}\n\ninheritPrototype(A, B);\n\nA.prototype.sayAge = function(){ \n  console.log(this.age);\n}\n```\n\nåŸºæœ¬æ€æƒ³ï¼šé€šè¿‡å€Ÿç”¨æ„é€ å‡½æ•°æ¥ç»§æ‰¿å±æ€§ï¼Œé€šè¿‡åŸå‹é“¾çš„æ··æˆå½¢å¼æ¥ç»§æ‰¿æ–¹æ³•ã€‚å®é™…ä¸Šæ˜¯**åœ¨ç»„åˆç»§æ‰¿çš„åŸºç¡€ä¸Šï¼Œç”¨è¶…ç±»å‹åŸå‹çš„å‰¯æœ¬ä»£æ›¿è°ƒç”¨è¶…ç±»å‹çš„æ„é€ å‡½æ•°ç»™å­ç±»å‹æŒ‡å®šåŸå‹**ã€‚\n\næœ¬è´¨ä¸Šï¼Œæ˜¯ä½¿ç”¨å¯„ç”Ÿå¼ç»§æ‰¿æ¥ç»§æ‰¿è¶…ç±»å‹çš„åŸå‹ï¼Œç„¶åå†å°†ç»“æœæŒ‡å®šç»™å­ç±»å‹çš„åŸå‹ã€‚\n\nä¼˜ç‚¹ï¼šåªè°ƒç”¨äº†ä¸€æ¬¡è¶…ç±»å‹çš„æ„é€ å‡½æ•°ï¼Œå¹¶ä¸”å› æ­¤é¿å…äº†åœ¨å­ç±»å‹çš„åŸå‹ä¸Šåˆ›å»ºä¸å¿…è¦çš„ã€å¤šä½™çš„å±æ€§ã€‚ä¸æ­¤åŒæ—¶ï¼ŒåŸå‹é“¾è¿˜èƒ½ä¿æŒä¸å˜ã€‚å› æ­¤ï¼Œè¿˜èƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨`instanceof`å’Œ`isPrototypeOf()`ã€‚æ™®éè®¤ä¸ºå¯„ç”Ÿç»„åˆå¼ç»§æ‰¿æ˜¯å¼•ç”¨ç±»å‹**æœ€ç†æƒ³**çš„ç»§æ‰¿æ–¹å¼ã€‚\n\n##### ä¼˜ç‚¹\n\n- åœ¨å°‘ä¸€æ¬¡å®ä¾‹åŒ–çˆ¶ç±»çš„æƒ…å†µä¸‹ï¼Œå®ç°äº†åŸå‹é“¾ç»§æ‰¿å’Œå€Ÿç”¨æ„é€ å‡½æ•°\n- å‡å°‘äº†åŸå‹é“¾æŸ¥æ‰¾çš„æ¬¡æ•°ï¼ˆå­ç±»ç›´æ¥ç»§æ‰¿è¶…ç±»çš„prototypeï¼Œè€Œä¸æ˜¯çˆ¶ç±»çš„å®ä¾‹ï¼‰\n\n##### ç¼ºç‚¹\n\næš‚æ— \n\n\n\n#### classç»§æ‰¿\n\n```js\nclass Parent{\n    constructor(name){\n        this.name = name;\n    }\n    getName(){\n        console.log(this.name);\n    }\n}\nclass Child extends Parent{\n    constructor(val){\n        super(val);\n    }\n}\nlet child = new Child('zhangsan');\nchild.getName();  //zhangsan\nchild instanceof Parent // true\n```\n\n**è¯´æ˜ï¼š**æ ¸å¿ƒåœ¨äºä½¿ç”¨ extends è¡¨æ˜ç»§æ‰¿è‡ªå“ªä¸ªçˆ¶ç±»ï¼Œå¹¶ä¸”åœ¨å­ç±»æ„é€ å‡½æ•°ä¸­å¿…é¡»è°ƒç”¨ superã€‚\nclass çš„æœ¬è´¨è¿˜æ˜¯å‡½æ•°ï¼Œè¿™ç§è¡¨è¾¾ä¸è¿‡æ˜¯ä¸€ç§è¯­æ³•ç³–ã€‚\n\nè¿™é‡Œå°±ä¸å±•å¼€äº†.","source":"_posts/ã€é‡è¯†å‰ç«¯ã€‘åŸå‹åŸå‹é“¾å’Œç»§æ‰¿.md","raw":"---\ntitle: ã€é‡è¯†å‰ç«¯ã€‘åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿\ndate: 2020-07-13 23:51:21\ntags: [åŸå‹/åŸå‹é“¾, JavaScript, ç»§æ‰¿]\ncategory: [é‡æ‹¾å‰ç«¯]\ncover: /image/cover/web.jpeg\n---\n\n## æ¢ç©¶\n\næˆ‘è§‰å¾—å­¦ä¹ ä¸€ä¸ªä¸œè¥¿æœ€é‡è¦çš„æ˜¯ææ‡‚ä¸‰æ ·ä¸œè¥¿\n\nWhat/How/Why\n\n### What\n\nä»€ä¹ˆæ˜¯åŸå‹?ä»€ä¹ˆæ˜¯åŸå‹é“¾?ä»€ä¹ˆæ˜¯ç»§æ‰¿?\n\n#### åŸå‹\n\nåœ¨JavaScriptä¸­ï¼Œ**åŸå‹ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé€šè¿‡åŸå‹å¯ä»¥å®ç°å¯¹è±¡çš„å±æ€§ç»§æ‰¿ï¼Œ**JavaScriptçš„å¯¹è±¡ä¸­éƒ½åŒ…å«äº†ä¸€ä¸ª\" [[Prototype]]\"å†…éƒ¨å±æ€§ï¼Œè¿™ä¸ªå±æ€§æ‰€å¯¹åº”çš„å°±æ˜¯è¯¥å¯¹è±¡çš„åŸå‹ã€‚\n\n\"[[Prototype]]\"ä½œä¸ºå¯¹è±¡çš„å†…éƒ¨å±æ€§ï¼Œæ˜¯ä¸èƒ½è¢«ç›´æ¥è®¿é—®çš„ã€‚æ‰€ä»¥ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹ä¸€ä¸ªå¯¹è±¡çš„åŸå‹ï¼ŒFirefoxå’ŒChromeä¸­æä¾›äº†\"__proto__\"è¿™ä¸ª**éæ ‡å‡†**ï¼ˆä¸æ˜¯æ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒï¼‰çš„è®¿é—®å™¨ï¼ˆECMAå¼•å…¥äº†æ ‡å‡†å¯¹è±¡åŸå‹è®¿é—®å™¨\"Object.getPrototype(object)\"ï¼‰ã€‚\n\nç”¨ä¸€å¥è¯æ¥æ¦‚æ‹¬å°±æ˜¯: åŸå‹æ˜¯ä¸€ä¸ªå±æ€§å¯ä»¥è¢«ç»§æ‰¿çš„å¯¹è±¡.åŸå‹ä¹Ÿå¯ä»¥æœ‰è‡ªå·±çš„åŸå‹.\n\n####\tåŸå‹é“¾\n\nåŸå‹ä¹Ÿå¯ä»¥æœ‰è‡ªå·±çš„åŸå‹, è€Œä¸€ä¸ªä¸ªåŸå‹é€šè¿‡prototypeé“¾æ¥èµ·æ¥çš„å°±å«åšåŸå‹é“¾\n\n#### ç»§æ‰¿\n\nå„¿å­å¯ä»¥é€šè¿‡ç»§æ‰¿è·å¾—çˆ¶äº²çš„å±æ€§æˆ–è€…æ–¹æ³•; \n\n### why\n\nä¸ºä»€ä¹ˆä¼šæœ‰åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿?\n\næ‘˜è‡ªJavaScripté«˜çº§ç¨‹åºè®¾è®¡:\n\n> ç»§æ‰¿æ˜¯OOè¯­è¨€ä¸­çš„ä¸€ä¸ªæœ€ä¸ºäººæ´¥æ´¥ä¹é“çš„æ¦‚å¿µ.è®¸å¤šOOè¯­è¨€éƒ½æ”¯æŒä¸¤ç§ç»§æ‰¿æ–¹å¼: **æ¥å£ç»§æ‰¿** å’Œ **å®ç°ç»§æ‰¿** .æ¥å£ç»§æ‰¿åªç»§æ‰¿æ–¹æ³•ç­¾å,è€Œå®ç°ç»§æ‰¿åˆ™ç»§æ‰¿å®é™…çš„æ–¹æ³•.ç”±äºjsä¸­æ–¹æ³•æ²¡æœ‰ç­¾å,åœ¨ECMAScriptä¸­æ— æ³•å®ç°æ¥å£ç»§æ‰¿.ECMAScriptåªæ”¯æŒå®ç°ç»§æ‰¿,è€Œä¸”å…¶ `å®ç°ç»§æ‰¿` ä¸»è¦æ˜¯ä¾é åŸå‹é“¾æ¥å®ç°çš„.\n\n### How\n\n#### åŸå‹\n\næ€ä¹ˆæ‰¾åˆ°åŸå‹?\n\næˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨, æ‰“å¼€æ§åˆ¶å°(F12), å¯ä»¥ç›´æ¥è¾“å…¥ `const obj = {}`, æˆ‘ä»¬å°±å¯ä»¥æŠŠä»–ç›´æ¥ç‚¹å¼€.å‘ç°é‡Œé¢æœ‰ä¸€ä¸ª`__proto__` å…¶å®æˆ‘ä»¬è¾“å…¥çš„è¿™ä¸ªå¯¹è±¡, æ˜¯ä¸€ä¸ª`Object`æ„é€ å‡½æ•°çš„å®ä¾‹. æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ä¾‹çš„`__proto__`å±æ€§æ‰¾åˆ°ä»–çš„åŸå‹;\n\n#### åŸå‹é“¾\n\næ€ä¹ˆæ‰¾åˆ°åŸå‹é“¾?\n\nåœ¨æ‰¾ä¹‹å‰æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸ªåŸå‹ä¸æ„é€ å‡½æ•°ä¸å®ä¾‹ç›´æ¥çš„å…³ç³».\n\nå‡å®šæˆ‘ä»¬æœ‰ä¸€ä¸ªæ„é€ å‡½æ•° `function A(){}`, æˆ‘ä»¬ç§°ä»–ä¸ºA\n\næˆ‘ä»¬æœ‰ä¸€ä¸ªå®ä¾‹B, ä»–æ˜¯è¿™æ ·æ¥çš„: `const B = new A()`, æˆ‘ä»¬ç§°ä»–ä¸ºB\n\nAçš„åŸå‹ä¸ºC\n\næ¥ä¸‹é‡Œæˆ‘ä»¬å†™ä¸€ä¸ªç­‰å¼æ¥å¾ˆå¥½çš„å±•ç¤ºä»–ä»¬ä¹‹é—´çš„å…³ç³»\n\nA = prototype => C = construct => A = new => B = `__proto__` => C\n\nè§£é‡Šä¸€ä¸‹: Aæœ‰ä¸€ä¸ªå±æ€§`prototype` æŒ‡å‘Açš„åŸå‹ C, è€ŒCçš„å±æ€§`construct`æŒ‡å‘A, Aé€šè¿‡newæ–¹æ³•å¯ä»¥åˆ›å»ºå®ä¾‹B, è€ŒBæœ‰ä¸€ä¸ªå±æ€§`__proto__`æŒ‡å‘äº†C(Açš„åŸå‹)\n\n\n\nOK, ç†è§£å®Œä¸Šé¢çš„ä¸œè¥¿ä¹‹å, æˆ‘ä»¬å†åŠ ä¸€ä¸ªçŸ¥è¯†ç‚¹, Açš„åŸå‹C, ä¹Ÿæ˜¯Cçš„åŸå‹çš„ä¸€ä¸ªå®ä¾‹.\n\n\n\nå…ˆåˆ«æ‡‚æ²¡æ‡‚, æˆ‘ä»¬çœ‹ä¸€ä¸‹å®æˆ˜.\n\nä¹¦æ¥ä¸Šæ–‡ä¸­çš„åŸå‹, æˆ‘å†å¤åˆ¶ä¸€ä¸‹, æ–¹ä¾¿é˜…è¯»\n\n> æˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨, æ‰“å¼€æ§åˆ¶å°(F12), å¯ä»¥ç›´æ¥è¾“å…¥ `const obj = {}`, æˆ‘ä»¬å°±å¯ä»¥æŠŠä»–ç›´æ¥ç‚¹å¼€.å‘ç°é‡Œé¢æœ‰ä¸€ä¸ª`__proto__` å…¶å®æˆ‘ä»¬è¾“å…¥çš„è¿™ä¸ªå¯¹è±¡, æ˜¯ä¸€ä¸ª`Object`æ„é€ å‡½æ•°çš„å®ä¾‹. æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ä¾‹çš„`__proto__`å±æ€§æ‰¾åˆ°ä»–çš„åŸå‹;\n\næˆ‘ä»¬æ¥ç€ç‚¹å¼€`__proto__`,å‘ç°é‡Œé¢æœ‰ä¸€å †\"èŠ±é‡Œèƒ¡å“¨\"çš„ä¸œè¥¿, æˆ‘ä»¬æ‰¾åˆ°äº†å…¶ä¸­ä¸€ä¸ªå¾ˆçœ¼ç†Ÿçš„\"é“ä»”\" -> `construct`;\n\næ ¹æ®ä¹‹å‰çš„äº†è§£\n\n> â€‹\tA = prototype => C = construct => A = new => B = `__proto__` => C\n\næˆ‘ä»¬ç‚¹å¼€çš„è¿™ä¸ª`construct`å…¶å®é‚£ä¸ªç©ºå¯¹è±¡çš„æ„é€ å‡½æ•°`Object`, é‚£ä¹ˆä»–åº”è¯¥æœ‰ä¸€ä¸ª`prototype`æŒ‡å‘äº†ä»–çš„åŸå‹.\n\næˆ‘ä»¬æ‰¾æ‰¾, ç¡®å®å‘ç°äº†æœ‰è¿™ä¹ˆä¸€ä¸ªå±æ€§(`prototype`); é‚£ä¹ˆç‚¹å¼€ä¹‹ååº”è¯¥ä¸æœ€æ—©çš„ç©ºå¯¹è±¡çš„`__proto__`çš„å†…å®¹ä¸€è‡´. æ ¹æ®ç­‰å¼å¯å¾—;\n\n ##### æ€»ç»“ä¸€ä¸‹\n\nå¯¹è±¡çš„ `__proto__` å±æ€§æŒ‡å‘åŸå‹ï¼Œ `__proto__` å°†å¯¹è±¡å’ŒåŸå‹è¿æ¥èµ·æ¥ç»„æˆäº†åŸå‹é“¾\n\næ¥ä¸‹æ¥è¿›å…¥æˆ‘ä»¬çš„é‡å¤´æˆç»§æ‰¿\n\n### ç»§æ‰¿\n\nå…¶å®ç»§æ‰¿åˆåˆ†ä¸ºå¥½å¤šç§: åŸå‹é“¾ç»§æ‰¿, æ„é€ å‡½æ•°ç»§æ‰¿, ç»„åˆç»§æ‰¿å’Œå¯„ç”Ÿç»„åˆç»§æ‰¿;\n\n#### åŸå‹é“¾ç»§æ‰¿\n\n\n\n```js\nfunction A(){\n\tthis.array = [\"a\", \"b\", \"c\"];\n}\n\nfunction B(){\n}\n\n//ç»§æ‰¿äº† A\nB.prototype = new A()\n\nvar b1 = new B()\nb1.array.push(\"d\"); \nconsole.log(b1.array); //\"a,b,c,d\"\n\nvar b2 = new B(); \nconsole.log(b2.array); //\"a,b,c,d\"\n\nb2.array.push(\"e\")\nconsole.log(b2.array) //\"a,b,c,d,e\"\nconsole.log(b1.array) //\"a,b,c,d,e\"\n```\n\næˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªæ„é€ å‡½æ•°, Aå’ŒB; æ ¹æ®ä¹‹å‰çš„çŸ¥è¯†, æˆ‘ä»¬è®©Bçš„åŸå‹æŒ‡å‘äº†æ„é€ å‡½æ•°Aåˆ›é€ å‡ºæ¥çš„å®ä¾‹(`new A()`); ç„¶åæˆ‘ä»¬ç”¨æ„é€ å‡½æ•°Båˆ›é€ äº†å®ä¾‹b1,  å¾€ ç»§æ‰¿æ¥çš„å±æ€§array å¢åŠ ä¸€ä¸ªå­—ç¬¦ä¸²\"d\"; ç„¶åæˆ‘ä»¬è¾“å‡ºä¸€ä¸‹, æŒ‰ç…§æˆ‘ä»¬çš„é€¾æœŸçš„å¤šäº†ä¸€ä¸ª\"e\"çš„æƒ…å†µä¸‹, è¿˜æœ‰\"a,b,c\";\n\næ¥ä¸‹æ¥å°±æœ‰äº›é—®é¢˜äº†. æˆ‘ä»¬æŒ‰ç…§æƒ¯ä¾‹, é€šè¿‡æ„é€ å‡½æ•°B, åˆ›é€ äº†b2. b2ç¡®å®ä¹Ÿæœ‰äº†ç»§æ‰¿æ¥çš„å±æ€§\"array\", å¯æ˜¯è¿™ä¸ªarrayå¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„åˆå§‹çš„`[\"a\",\"b\",\"c\"]`; æˆ‘ä»¬æ”¾å¼ƒæ¢ç©¶, ç»§ç»­å¾€è¿™ä¸ª`array`é‡Œé¢å¢åŠ ä¸€ä¸ª`e`, è¾“å‡ºä¸€ä¸‹`b1`çš„å±æ€§`array`. ç¡®å®æ˜¯å¯ä»¥å¢åŠ è¿™ä¸ª`e`;\n\n\n\nå¯æ˜¯!\n\n\n\nå½“æˆ‘ä»¬è¾“å‡º`b1.array`æ—¶, å‘ç°b1ä¹Ÿè¢«æ”¹äº†, å’Œä¹‹å‰è¯¡å¼‚çš„b2å¤šå‡ºä¸€ä¸ª`d`ä¸€æ ·.\n\næ¢ç©¶å‘ç°è¿™ä¸ªç”±äºæˆ‘ä»¬ç”¨çš„æ˜¯å¼•ç”¨ç±»å‹, æ‰€ä»¥ä»–ä»¬å­˜å‚¨çš„æ˜¯æŒ‡å‘åŒä¸€ä¸ªå†…å­˜çš„å†…å­˜åœ°å€; æ‰€ä»¥æ‰ä¼šå‘ç”Ÿè¿™äº›é—®é¢˜. è¿™ä¹Ÿæš´éœ²äº†åŸå‹é“¾ç»§æ‰¿æ—¶çš„ä¸€ä¸ªé—®é¢˜.å¼•ç”¨ç±»å‹å¸¦æ¥çš„æ¯›ç—…;\n\nå…¶æ¬¡, æˆ‘ä»¬å‘ç°æˆ‘ä»¬çš„Bçš„åŸå‹æŒ‡å‘Açš„æ„é€ å‡½æ•°æ—¶ä¸èƒ½ä¼ é€’å‚æ•°, è¿™ä¹Ÿçš„è¯æœ‰ç‚¹å‘†æ¿\n\nç»¼ä¸ŠåŸå‹é“¾çš„ç»§æ‰¿åœ¨æ—¥å¸¸ä¸­æ˜¯å¾ˆå°‘ç”¨åˆ°çš„\n\n\n\n##### ä¼˜ç‚¹\n\nâ€‹    å­ç±»å¯ä»¥é€šè¿‡åŸå‹é“¾çš„æŸ¥æ‰¾ï¼Œå®ç°çˆ¶ç±»çš„å±æ€§å…¬ç”¨ä¸å­ç±»çš„å®ä¾‹\n\n##### ç¼ºç‚¹\n\n- ä¸€äº›å¼•ç”¨æ•°æ®æ“ä½œçš„æ—¶å€™ä¼šå‡ºé—®é¢˜ï¼Œä¸¤ä¸ªå®ä¾‹ä¼šå…¬ç”¨ç»§æ‰¿å®ä¾‹çš„å¼•ç”¨æ•°æ®ç±»\n- è°¨æ…å®šä¹‰æ–¹æ³•ï¼Œä»¥å…å®šä¹‰æ–¹æ³•ä¹Ÿç»§æ‰¿å¯¹è±¡åŸå‹çš„æ–¹æ³•é‡å\n- æ— æ³•ç›´æ¥ç»™çˆ¶çº§æ„é€ å‡½æ•°ä½¿ç”¨å‚æ•°\n\n\n\n#### æ„é€ å‡½æ•°ç»§æ‰¿\n\n```js\nfunction A(){\n\tthis.array = [\"a\", \"b\", \"c\"];\n}\n\nfunction B(){\n  A.call(this)\n}\n\n//ç»§æ‰¿äº† A\nB.prototype = new A()\n\nvar b1 = new B()\nb1.array.push(\"d\"); \nconsole.log(b1.array); //\"a,b,c,d\"\n\nvar b2 = new B(); \nconsole.log(b2.array); //\"a,b,c\"\n\nb2.array.push(\"e\")\nconsole.log(b2.array) //\"a,b,c,e\"\nconsole.log(b1.array) //\"a,b,c,d\"\n```\n\næˆ‘ä»¬å¥‡è¿¹èˆ¬çš„å‘ç°, æ„é€ å‡½æ•°çš„ç»§æ‰¿è§£å†³äº†æˆ‘ä»¬ä¹‹å‰å‘ç°çš„JavaScriptå¼•ç”¨é—®é¢˜.é‚£å‡½æ•°ä¼ å‚çš„é—®...\n\nå•ª!\n\nåœ, æˆ‘ä»¬ç°åœ¨æ¥ä¼ é€’ä¸€ä¸‹å‚æ•°!\n\næˆ‘ä»¬æŠŠä¸Šé¢çš„ä¾‹å­ä¿®æ”¹ä¸€ä¸‹\n\n```js\nfunction A(name){\n\tthis.array = [\"a\", \"b\", \"c\"];\n  this.name = name\n}\n\nfunction B(){\n  A.call(this, 'B')\n}\n\n//ç»§æ‰¿äº† A\nB.prototype = new A()\n\nvar b1 = new B()\nb1.array.push(\"d\"); \nconsole.log(b1.array); //\"a,b,c,d\"\nconsole.log(b1.name); //\"B\"\n\nvar b2 = new B(); \nconsole.log(b2.array); //\"a,b,c\"\nconsole.log(b1.name); //\"B\"\n\nb2.array.push(\"e\")\nconsole.log(b2.array) //\"a,b,c,e\"\nconsole.log(b1.array) //\"a,b,c,d\"\n```\n\nè¿™æ ·çš„è¯æˆ‘ä»¬è§£å†³äº†åŸå‹é“¾ç»§æ‰¿çš„ä¸¤ä¸ªé—®é¢˜(1.æ— æ³•ä¼ å‚, 2.jså¼•ç”¨é—®é¢˜);\n\nè¯¥ä¸ä¼šæœ‰äººè®¤ä¸ºè¿™æ ·å°±å¾ˆå®Œç¾äº†å§?ä¸ä¼šå§!ä¸ä¼šå§!\n\næˆ‘ä»¬å†·é™ä¸‹æ¥æƒ³æƒ³çœ‹, å…¶å®è¿™ä¸ªä¼ é€’å‚æ•°æ˜¯å‡ ä¹ç®—æ˜¯å†™æ­»çš„. è¿˜ä¸å¦‚ç›´æ¥åœ¨Aé‡Œé¢ç›´æ¥å†™æ­»å¥½äº†, æ ¹æœ¬å°±æ— æ³•å¤ç”¨å˜›; è€Œä¸”ï¼Œåœ¨è¶…ç±»å‹çš„åŸå‹ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œå¯¹å­ç±»å‹è€Œè¨€ä¹Ÿæ˜¯ä¸å¯è§çš„ï¼Œç»“ æœæ‰€æœ‰ç±»å‹éƒ½åªèƒ½ä½¿ç”¨æ„é€ å‡½æ•°æ¨¡å¼ã€‚è€ƒè™‘åˆ°è¿™äº›é—®é¢˜ï¼Œå€Ÿç”¨æ„é€ å‡½æ•°çš„æŠ€æœ¯ä¹Ÿæ˜¯å¾ˆå°‘å•ç‹¬ä½¿ç”¨çš„ã€‚\n\n##### ä¼˜ç‚¹\n\n- è§£å†³äº†åŸå‹é“¾ç»§æ‰¿çš„ å¼•ç”¨ç±»å‹æ“ä½œé—®é¢˜\n- è§£å†³äº†çˆ¶ç±»ä¼ é€’å‚æ•°é—®é¢˜\n\n##### ç¼ºç‚¹\n\n- ä»…ä»…ä½¿ç”¨å€Ÿç”¨æ„é€ å‡½æ•°æ¨¡å¼ç»§æ‰¿ï¼Œæ— æ³•æ‘†è„±å¤Ÿç€å‡½æ•°ã€‚æ–¹æ³•åœ¨æ„é€ å‡½æ•°ä¸­å®šä¹‰å¤ç”¨ä¸å¯è°ˆ\n- å¯¹äºè¶…ç±»çš„åŸå‹å®šä¹‰çš„æ–¹æ³•å¯¹äºå­ç±»æ˜¯ä¸å¯ä½¿ç”¨çš„ï¼Œå­ç±»çš„å®ä¾‹åªæ˜¯å¾—åˆ°äº†çˆ¶ç±»çš„thisç»‘å®šçš„å±æ€§ è€ƒè™‘åˆ°è¿™äº›ç¼ºç‚¹ï¼Œå•ç‹¬ä½¿ç”¨å€Ÿç”¨æ„é€ å‡½æ•°ä¹Ÿæ˜¯å¾ˆå°‘ä½¿ç”¨çš„\n\n\n\n#### ç»„åˆç»§æ‰¿\n\n```js\nfunction A(name){\n  this.name = name\n  this.array = ['1', '2', '3']\n}\nA.prototype.sayName = function (){console.log(this.name)}\n\nfunction B(name, age){\n  A.call(this, name);\n  this.age = age;\n}\n\nB.prototype = new A();\nB.prototype.constructor = A; // å› ä¸ºåŸå‹é“¾ç»§æ‰¿ï¼Œä¼šæŠŠconstructoræŒ‡å‘æ”¹å˜ï¼Œæ‰€ä»¥è¦é‡æ–°æŒ‡å›è‡ªèº«\nB.prototype.sayAge = function (){console.log(this.age)}\n\nvar a = new B('a', 10)\na.array.push('a')\nconsole.log(a.array) // [\"1\", \"2\", \"3\", \"a\"]\na.sayName() // 'a'\na.sayAge() // 10\n\nvar b = new B('b', 20)\nb.array.push('b')\nconsole.log(b.array) // [\"1\", \"2\", \"3\", \"b\"]\nb.sayName()// 'b'\nb.sayAge() // 20\n```\n\nåœ¨è¿™ä¸ªä¾‹å­ä¸­, æ„é€ å‡½æ•°Aæœ‰ä¸¤ä¸ªå†…ç½®å±æ€§`name`å’Œ`array`. Açš„åŸå‹å®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•`sayName`; æ„é€ å‡½æ•°Båœ¨è°ƒç”¨Açš„æ„é€ å‡½æ•°æ—¶ä¼ å…¥äº†ä¸€ä¸ªå‚æ•°`name`, ç„¶ååˆç»™Bçš„åŸå‹ä¸Šå®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•`sayAge`. è¿™æ ·ä¸€æ¥, å°±å¯ä»¥è®©ä¸¤ä¸ªBçš„å®ä¾‹åˆ†åˆ«æ‹¥æœ‰è‡ªå·±çš„å±æ€§, å½“ç„¶ä¹ŸåŒ…æ‹¬äº†array, è¿˜å¯ä»¥æ‹¥æœ‰ç›¸åŒçš„æ–¹æ³•.\n\nç»„åˆç»§æ‰¿é¿å…äº†åŸå‹é“¾å’Œå€Ÿç”¨æ„é€ å‡½æ•°çš„ç¼ºé™·ï¼Œèåˆäº†å®ƒä»¬çš„ä¼˜ç‚¹ï¼Œæˆä¸º JavaScript ä¸­æœ€å¸¸ç”¨çš„ç»§ æ‰¿æ¨¡å¼ã€‚è€Œä¸”(å…³é”®)ï¼Œ`instanceof` å’Œ `isPrototypeOf()`ä¹Ÿèƒ½å¤Ÿç”¨äºè¯†åˆ«åŸºäºç»„åˆç»§æ‰¿åˆ›å»ºçš„å¯¹è±¡ã€‚\n\n##### ä¼˜ç‚¹\n\n- è§£å†³äº†åŸå‹é“¾ç»§æ‰¿å¼•ç”¨ç±»å‹çš„å®ä¾‹æ“ä½œå¯¼è‡´å¼•ç”¨æ”¹å˜\n- è§£å†³äº†å€Ÿæ„é€ å‡½æ•°ç»§æ‰¿æ–¹å¼çš„ï¼Œçˆ¶ç±»åŸå‹å­ç±»å®ä¾‹å¯ä»¥ä½¿ç”¨\n\n##### ç¼ºç‚¹\n\nçˆ¶ç±»çš„æ„é€ å‡½æ•°è¢«å®ä¾‹æ¢äº†ä¸¤æ¬¡ * å®ä¾‹ä¼šæœ‰çˆ¶ç±»çš„æ„é€ å‡½æ•°çš„ä¸€äº›thiså±æ€§ã€å­ç±»çš„æ„é€ å‡½æ•°ï¼ˆprototypeï¼‰ä¸Šä¹Ÿæœ‰ä¸€ä»½å®ä¾‹çš„ä¸Šæœ‰çš„å±æ€§\n\n#### åŸå‹å¼ç»§æ‰¿\n\né“æ ¼æ‹‰æ–¯Â·å…‹ç½—å…‹ç¦å¾·åœ¨ 2006 å¹´å†™äº†ä¸€ç¯‡æ–‡ç« ï¼Œé¢˜ä¸º Prototypal Inheritance in JavaScript (JavaScript 10 ä¸­çš„åŸå‹å¼ç»§æ‰¿)ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œä»–ä»‹ç»äº†ä¸€ç§å®ç°ç»§æ‰¿çš„æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•å¹¶æ²¡æœ‰ä½¿ç”¨ä¸¥æ ¼æ„ä¹‰ä¸Šçš„ æ„é€ å‡½æ•°ã€‚ä»–çš„æƒ³æ³•æ˜¯å€ŸåŠ©åŸå‹å¯ä»¥åŸºäºå·²æœ‰çš„å¯¹è±¡åˆ›å»ºæ–°å¯¹è±¡ï¼ŒåŒæ—¶è¿˜ä¸å¿…å› æ­¤åˆ›å»ºè‡ªå®šä¹‰ç±»å‹ã€‚ä¸º äº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œä»–ç»™å‡ºäº†å¦‚ä¸‹å‡½æ•°ã€‚\n\n```js\nfunction object(o){\n  function F(){}\n  F.prototype = o\n  return new F\n}\n```\n\nçœ‹èµ·æ¥éå¸¸ç®€å•\n\nå…ˆåœ¨`object`å‡½æ•°å†…éƒ¨åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„æ„é€ å‡½æ•°`F`, ç„¶åå°†ä¼ å…¥çš„è¿™ä¸ªå¯¹è±¡`o`ä½œä¸ºè¿™ä¸ªä¸´æ—¶æ„é€ å‡½æ•°çš„åŸå‹, æœ€åè¿”å›è¿™ä¸ªä¸´æ—¶æ„é€ å‡½æ•°çš„å®ä¾‹. \n\nç®€å•æ¥è¯´å°±æ˜¯`object`å¯¹ä¼ å…¥çš„å¯¹è±¡è¿›è¡Œäº†æµ…å¤åˆ¶.\n\næµ…æ‹·è´å’Œæ·±æ‹·è´å¯ä»¥è‡ªè¡ŒGoogleä¸€ä¸‹, è¿™ç®—ä¸€ä¸ªé‡è¦çš„çŸ¥è¯†ç‚¹.\n\nä¸¾ä¸ªğŸŒ°\n\n```js\nfunction object(o){\n  function F(){}\n  F.prototype = o\n  return new F\n}\n\nvar a = {\n  name: 'a',\n  array: ['1', '2'],\n}\n\nvar qq = object(a)\nconsole.log(qq.name)\nqq.array.push('qq')\nconsole.log(qq.array)\n\nvar ww = object(a)\nconsole.log(ww.name)\nww.array.push('ww')\nconsole.log(ww.array)\nconsole.log(qq.array)\n```\n\næœ‰æ²¡æœ‰ä¼¼æ›¾ç›¸è¯†çš„æ„Ÿè§‰....åŸå‹é“¾ç»§æ‰¿çš„è€æ¯›ç—…æ¥äº†...\n\nä¸è¿‡ä»–ä¹Ÿä¸æ˜¯æ²¡æœ‰ä¼˜ç‚¹çš„.\n\nåœ¨æ²¡æœ‰å¿…è¦å…´å¸ˆåŠ¨ä¼—åœ°åˆ›å»ºæ„é€ å‡½æ•°ï¼Œè€Œåªæƒ³è®©ä¸€ä¸ªå¯¹è±¡ä¸å¦ä¸€ä¸ªå¯¹è±¡ä¿æŒç±»ä¼¼çš„æƒ…å†µä¸‹ï¼ŒåŸå‹å¼ ç»§æ‰¿æ˜¯å®Œå…¨å¯ä»¥èƒœä»»çš„ã€‚\n\n> ECMAScript 5 é€šè¿‡æ–°å¢ Object.create()æ–¹æ³•è§„èŒƒåŒ–äº†åŸå‹å¼ç»§æ‰¿ã€‚è¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°:ä¸€ ä¸ªç”¨ä½œæ–°å¯¹è±¡åŸå‹çš„å¯¹è±¡å’Œ(å¯é€‰çš„)ä¸€ä¸ªä¸ºæ–°å¯¹è±¡å®šä¹‰é¢å¤–å±æ€§çš„å¯¹è±¡ã€‚åœ¨ä¼ å…¥ä¸€ä¸ªå‚æ•°çš„æƒ…å†µä¸‹ï¼Œ Object.create()ä¸ object()æ–¹æ³•çš„è¡Œä¸ºç›¸åŒã€‚æœ‰å…´è¶£çš„è¯å¯ä»¥è‡ªå·±äº†è§£ä¸€ä¸‹\n\n##### ä¼˜ç‚¹\n\nå†ä¸ç”¨åˆ›å»ºæ„é€ å‡½æ•°çš„æƒ…å†µä¸‹ï¼Œå®ç°äº†åŸå‹é“¾ç»§æ‰¿ï¼Œä»£ç é‡å‡å°‘ä¸€éƒ¨åˆ†\n\n##### ç¼ºç‚¹\n\n- ä¸€äº›å¼•ç”¨æ•°æ®æ“ä½œçš„æ—¶å€™ä¼šå‡ºé—®é¢˜ï¼Œä¸¤ä¸ªå®ä¾‹ä¼šå…¬ç”¨ç»§æ‰¿å®ä¾‹çš„å¼•ç”¨æ•°æ®ç±»\n- è°¨æ…å®šä¹‰æ–¹æ³•ï¼Œä»¥å…å®šä¹‰æ–¹æ³•ä¹Ÿç»§æ‰¿å¯¹è±¡åŸå‹çš„æ–¹æ³•é‡å\n- æ— æ³•ç›´æ¥ç»™çˆ¶çº§æ„é€ å‡½æ•°ä½¿ç”¨å‚æ•°\n\n#### å¯„ç”Ÿç»§æ‰¿\n\nå¯„ç”Ÿç»§æ‰¿å’ŒåŸå‹å¼ç»§æ‰¿ç´§å¯†ç›¸å…³, åŒæ ·ä¹Ÿæ˜¯ç”±å…‹ç½—å…‹ç¦å¾·æ¨è€Œå¹¿ ä¹‹çš„.å¯„ç”Ÿå¼ç»§æ‰¿çš„æ€è·¯ä¸å¯„ç”Ÿæ„é€ å‡½æ•°å’Œå·¥å‚æ¨¡å¼ç±»ä¼¼ï¼Œå³åˆ›å»ºä¸€ä¸ªä»…ç”¨äºå°è£…ç»§æ‰¿è¿‡ç¨‹çš„å‡½æ•°ï¼Œè¯¥ å‡½æ•°åœ¨å†…éƒ¨ä»¥æŸç§æ–¹å¼æ¥å¢å¼ºå¯¹è±¡ï¼Œæœ€åå†åƒçœŸåœ°æ˜¯å®ƒåšäº†æ‰€æœ‰å·¥ä½œä¸€æ ·è¿”å›å¯¹è±¡ã€‚ä»¥ä¸‹ä»£ç ç¤ºèŒƒäº†å¯„ ç”Ÿå¼ç»§æ‰¿æ¨¡å¼ã€‚\n\nä¸Šä»£ç \n\n```js\nfunction object(o){\n  function F(){}\n  F.prototype = o\n  return new F\n}\n\nfunction createAnother(original){ \n  var clone=object(original); //é€šè¿‡è°ƒç”¨å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡\n  clone.sayHi = function(){ //ä»¥æŸç§æ–¹å¼æ¥å¢å¼ºè¿™ä¸ªå¯¹è±¡\n    alert(\"hi\");\n\t};\n\treturn clone;//è¿”å›è¿™ä¸ªå¯¹è±¡\n }\n```\n\nåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒcreateAnother()å‡½æ•°æ¥æ”¶äº†ä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯å°†è¦ä½œä¸ºæ–°å¯¹è±¡åŸºç¡€çš„å¯¹è±¡ã€‚ç„¶ åï¼ŒæŠŠè¿™ä¸ªå¯¹è±¡(original)ä¼ é€’ç»™ object()å‡½æ•°ï¼Œå°†è¿”å›çš„ç»“æœèµ‹å€¼ç»™ cloneã€‚å†ä¸º clone å¯¹è±¡ æ·»åŠ ä¸€ä¸ªæ–°æ–¹æ³• sayHi()ï¼Œæœ€åè¿”å› clone å¯¹è±¡ã€‚\n\n```js\nvar person = {\n\tname: \"Nicholas\",\n\tfriends: [\"Shelby\", \"Court\", \"Van\"]\n};\nvar anotherPerson = createAnother(person); \nanotherPerson.sayHi(); //\"hi\"\n```\n\nè¿™ä¸ªä¾‹å­ä¸­çš„ä»£ç åŸºäº person è¿”å›äº†ä¸€ä¸ªæ–°å¯¹è±¡â€”â€”anotherPersonã€‚æ–°å¯¹è±¡ä¸ä»…å…·æœ‰ person çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œè€Œä¸”è¿˜æœ‰è‡ªå·±çš„ sayHi()æ–¹æ³•ã€‚\n\nåœ¨ä¸»è¦è€ƒè™‘å¯¹è±¡è€Œä¸æ˜¯è‡ªå®šä¹‰ç±»å‹å’Œæ„é€ å‡½æ•°çš„æƒ…å†µä¸‹ï¼Œå¯„ç”Ÿå¼ç»§æ‰¿ä¹Ÿæ˜¯ä¸€ç§æœ‰ç”¨çš„æ¨¡å¼ã€‚å‰é¢ç¤º èŒƒç»§æ‰¿æ¨¡å¼æ—¶ä½¿ç”¨çš„ object()å‡½æ•°ä¸æ˜¯å¿…éœ€çš„;ä»»ä½•èƒ½å¤Ÿè¿”å›æ–°å¯¹è±¡çš„å‡½æ•°éƒ½é€‚ç”¨äºæ­¤æ¨¡å¼ã€‚\n\n> ä½¿ç”¨å¯„ç”Ÿç»§æ‰¿, ç”±äºä¸èƒ½åšåˆ°å‡½æ•°å¤ç”¨è€Œé™ä½æ•ˆç‡, è¿™ç‚¹å’Œæ„é€ å‡½æ•°ç»§æ‰¿å¾ˆåƒ\n\n##### ä¼˜ç‚¹\n\n- å†ä¸ç”¨åˆ›å»ºæ„é€ å‡½æ•°çš„æƒ…å†µä¸‹ï¼Œå®ç°äº†åŸå‹é“¾ç»§æ‰¿ï¼Œä»£ç é‡å‡å°‘ä¸€éƒ¨åˆ†\n- å¯ä»¥ç»™å¤‡ä»½çš„å¯¹è±¡æ·»åŠ ä¸€äº›å±æ€§\n\n##### ç¼ºç‚¹\n\nç±»ä¼¼æ„é€ å‡½æ•°ä¸€æ ·ï¼Œåˆ›å»ºå¯„ç”Ÿçš„æ–¹æ³•éœ€è¦åœ¨cloneå¯¹è±¡ä¸Šé¢æ·»åŠ ä¸€äº›æƒ³è¦çš„å±æ€§ï¼Œè¿™äº›å±æ€§æ˜¯æ”¾åœ¨cloneä¸Šé¢çš„ä¸€äº›ç§æœ‰çš„å±æ€§\n\n#### å¯„ç”Ÿç»„åˆç»§æ‰¿(ç»ˆææ–¹æ¡ˆ\n\nå‰é¢è¯´è¿‡ï¼Œç»„åˆç»§æ‰¿æ˜¯ JavaScript æœ€å¸¸ç”¨çš„ç»§æ‰¿æ¨¡å¼;ä¸è¿‡ï¼Œå®ƒä¹Ÿæœ‰è‡ªå·±çš„ä¸è¶³ã€‚ç»„åˆç»§æ‰¿æœ€å¤§çš„ é—®é¢˜å°±æ˜¯æ— è®ºä»€ä¹ˆæƒ…å†µä¸‹ï¼Œéƒ½ä¼šè°ƒç”¨ä¸¤æ¬¡è¶…ç±»å‹æ„é€ å‡½æ•°:ä¸€æ¬¡æ˜¯åœ¨åˆ›å»ºå­ç±»å‹åŸå‹çš„æ—¶å€™ï¼Œå¦ä¸€æ¬¡æ˜¯ åœ¨å­ç±»å‹æ„é€ å‡½æ•°å†…éƒ¨ã€‚æ²¡é”™ï¼Œå­ç±»å‹æœ€ç»ˆä¼šåŒ…å«è¶…ç±»å‹å¯¹è±¡çš„å…¨éƒ¨å®ä¾‹å±æ€§ï¼Œä½†æˆ‘ä»¬ä¸å¾—ä¸åœ¨è°ƒç”¨å­ ç±»å‹æ„é€ å‡½æ•°æ—¶é‡å†™è¿™äº›å±æ€§ã€‚å†æ¥çœ‹ä¸€çœ‹ä¸‹é¢ç»„åˆç»§æ‰¿çš„ä¾‹å­ã€‚\n\n```js\nfunction A(name){\n  this.name = name;\n  this.array = ['1','2','3']\n}\nA.prototype.sayName = function(){console.log(this.name)}\n\nfunction B(name, age){\n  \n  A.call(this, name) //ç¬¬äºŒæ¬¡è°ƒç”¨\n  this.age = age\n}\nB.prototype.sayAge = function(){console.log(this.age)}\n\nB.prototype = new A() // ç¬¬ä¸€æ¬¡è°ƒç”¨\nB.prototype.constructor = B\n```\n\nç¬¬ä¸€æ¬¡è°ƒç”¨Aæ„é€ å‡½æ•°çš„æ—¶å€™, Bçš„åŸå‹ä¸Šå°±æ‹¥æœ‰äº†Açš„ä¸¤ä¸ªå±æ€§å’Œä¸€ä¸ªæ–¹æ³•;\n\nç¬¬äºŒæ¬¡è°ƒç”¨Açš„æ„é€ å‡½æ•°æ—¶, ä¸ºBçš„å®ä¾‹åˆ›å»ºäº†Açš„ä¸¤ä¸ªçš„å±æ€§å’Œä¸€ä¸ªæ–¹æ³•, äºæ˜¯å®ä¾‹çš„ä¸¤ä¸ªå±æ€§å’Œä¸€ä¸ªæ–¹æ³•å°±å±è”½äº†åŸå‹ä¸Šçš„å®ä¾‹å’Œæ–¹æ³•; \n\næ˜¯ä¸æ˜¯æ„Ÿè§‰æœ‰ç‚¹ç‚¹æµªè´¹, ä¸è¿‡å¥½åœ¨æˆ‘ä»¬å·²ç»æ‰¾åˆ°è§£å†³æ–¹æ¡ˆ--->å¯„ç”Ÿç»„åˆç»§æ‰¿\n\nä¸¾ä¸€ä¸ªéå¸¸ç®€å•çš„ğŸŒ°, å¹¶ä¸”æˆ‘å°½é‡é€å­—é€å¥çš„è®²æ¸…æ¥š\n\n```js\nfunction object(o){\n  function F(){}\n  F.prototype = o\n  return new F\n} //ä¹Ÿå¯ä»¥ç”¨Object.createæ›¿ä»£\n\nfunction B(name){\n  this.name = name;\n  this.colors = [\"red\", \"blue\", \"green\"];\n}\n\nB.prototype.sayName = function(){ console.log(this.name);\n};\n\nfunction A(name, age){ \n  B.call(this, name); // åªè°ƒç”¨äº†è¿™ä¸€æ¬¡\n\tthis.age = age; \n}\n\nfunction inheritPrototype(A, B){ \n  //è®©prototypeå¯ä»¥æ‹¿åˆ°Bçš„å±æ€§å’Œæ–¹æ³•...è¿™æ˜¯åŸå‹å¼ç»§æ‰¿\n  var prototype = object(B.prototype); \n  //ç”±äºé‡å†™äº†åŸå‹, æ‰€ä»¥æ­¤æ—¶çš„constructorä¼šæŒ‡å‘Object, æ‰€ä»¥å¿…é¡»æŒ‡å®šä¸€ä¸‹constructor...é‚£ä¸ºä»€ä¹ˆä¼šä¸¢å¤±å‘¢?å› ä¸ºæˆ‘ä»¬ç©¿ç»™objectè¿™ä¸ªæ–¹æ³•çš„æ˜¯ä¸€ä¸ªå¯¹è±¡, è€Œå¯¹è±¡çš„æ„é€ å‡½æ•°å°±æ˜¯Object; åœ¨åŸå‹é‚£ä¸€å°èŠ‚æˆ‘ä»¬è¯´è¿‡äº†, åŸå‹ä¹Ÿæ˜¯å¯¹è±¡;\n  prototype.constructor = A; \n  // ç»§æ‰¿å±æ€§ä¹‹åå°±éœ€è¦å°†åŸå‹ç»™æŒ‡å‘å›å», ä¸ºäº†åŸå‹é“¾çš„æ­£ç¡®æŒ‡å‘\n  A.prototype = prototype;\n}\n\ninheritPrototype(A, B);\n\nA.prototype.sayAge = function(){ \n  console.log(this.age);\n}\n```\n\nåŸºæœ¬æ€æƒ³ï¼šé€šè¿‡å€Ÿç”¨æ„é€ å‡½æ•°æ¥ç»§æ‰¿å±æ€§ï¼Œé€šè¿‡åŸå‹é“¾çš„æ··æˆå½¢å¼æ¥ç»§æ‰¿æ–¹æ³•ã€‚å®é™…ä¸Šæ˜¯**åœ¨ç»„åˆç»§æ‰¿çš„åŸºç¡€ä¸Šï¼Œç”¨è¶…ç±»å‹åŸå‹çš„å‰¯æœ¬ä»£æ›¿è°ƒç”¨è¶…ç±»å‹çš„æ„é€ å‡½æ•°ç»™å­ç±»å‹æŒ‡å®šåŸå‹**ã€‚\n\næœ¬è´¨ä¸Šï¼Œæ˜¯ä½¿ç”¨å¯„ç”Ÿå¼ç»§æ‰¿æ¥ç»§æ‰¿è¶…ç±»å‹çš„åŸå‹ï¼Œç„¶åå†å°†ç»“æœæŒ‡å®šç»™å­ç±»å‹çš„åŸå‹ã€‚\n\nä¼˜ç‚¹ï¼šåªè°ƒç”¨äº†ä¸€æ¬¡è¶…ç±»å‹çš„æ„é€ å‡½æ•°ï¼Œå¹¶ä¸”å› æ­¤é¿å…äº†åœ¨å­ç±»å‹çš„åŸå‹ä¸Šåˆ›å»ºä¸å¿…è¦çš„ã€å¤šä½™çš„å±æ€§ã€‚ä¸æ­¤åŒæ—¶ï¼ŒåŸå‹é“¾è¿˜èƒ½ä¿æŒä¸å˜ã€‚å› æ­¤ï¼Œè¿˜èƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨`instanceof`å’Œ`isPrototypeOf()`ã€‚æ™®éè®¤ä¸ºå¯„ç”Ÿç»„åˆå¼ç»§æ‰¿æ˜¯å¼•ç”¨ç±»å‹**æœ€ç†æƒ³**çš„ç»§æ‰¿æ–¹å¼ã€‚\n\n##### ä¼˜ç‚¹\n\n- åœ¨å°‘ä¸€æ¬¡å®ä¾‹åŒ–çˆ¶ç±»çš„æƒ…å†µä¸‹ï¼Œå®ç°äº†åŸå‹é“¾ç»§æ‰¿å’Œå€Ÿç”¨æ„é€ å‡½æ•°\n- å‡å°‘äº†åŸå‹é“¾æŸ¥æ‰¾çš„æ¬¡æ•°ï¼ˆå­ç±»ç›´æ¥ç»§æ‰¿è¶…ç±»çš„prototypeï¼Œè€Œä¸æ˜¯çˆ¶ç±»çš„å®ä¾‹ï¼‰\n\n##### ç¼ºç‚¹\n\næš‚æ— \n\n\n\n#### classç»§æ‰¿\n\n```js\nclass Parent{\n    constructor(name){\n        this.name = name;\n    }\n    getName(){\n        console.log(this.name);\n    }\n}\nclass Child extends Parent{\n    constructor(val){\n        super(val);\n    }\n}\nlet child = new Child('zhangsan');\nchild.getName();  //zhangsan\nchild instanceof Parent // true\n```\n\n**è¯´æ˜ï¼š**æ ¸å¿ƒåœ¨äºä½¿ç”¨ extends è¡¨æ˜ç»§æ‰¿è‡ªå“ªä¸ªçˆ¶ç±»ï¼Œå¹¶ä¸”åœ¨å­ç±»æ„é€ å‡½æ•°ä¸­å¿…é¡»è°ƒç”¨ superã€‚\nclass çš„æœ¬è´¨è¿˜æ˜¯å‡½æ•°ï¼Œè¿™ç§è¡¨è¾¾ä¸è¿‡æ˜¯ä¸€ç§è¯­æ³•ç³–ã€‚\n\nè¿™é‡Œå°±ä¸å±•å¼€äº†.","slug":"ã€é‡è¯†å‰ç«¯ã€‘åŸå‹åŸå‹é“¾å’Œç»§æ‰¿","published":1,"updated":"2021-06-24T14:00:06.852Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra8k001plwrd6bur87hd","content":"<h2 id=\"æ¢ç©¶\"><a href=\"#æ¢ç©¶\" class=\"headerlink\" title=\"æ¢ç©¶\"></a>æ¢ç©¶</h2><p>æˆ‘è§‰å¾—å­¦ä¹ ä¸€ä¸ªä¸œè¥¿æœ€é‡è¦çš„æ˜¯ææ‡‚ä¸‰æ ·ä¸œè¥¿</p>\n<p>What/How/Why</p>\n<h3 id=\"What\"><a href=\"#What\" class=\"headerlink\" title=\"What\"></a>What</h3><p>ä»€ä¹ˆæ˜¯åŸå‹?ä»€ä¹ˆæ˜¯åŸå‹é“¾?ä»€ä¹ˆæ˜¯ç»§æ‰¿?</p>\n<h4 id=\"åŸå‹\"><a href=\"#åŸå‹\" class=\"headerlink\" title=\"åŸå‹\"></a>åŸå‹</h4><p>åœ¨JavaScriptä¸­ï¼Œ<strong>åŸå‹ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé€šè¿‡åŸå‹å¯ä»¥å®ç°å¯¹è±¡çš„å±æ€§ç»§æ‰¿ï¼Œ</strong>JavaScriptçš„å¯¹è±¡ä¸­éƒ½åŒ…å«äº†ä¸€ä¸ªâ€ [[Prototype]]â€å†…éƒ¨å±æ€§ï¼Œè¿™ä¸ªå±æ€§æ‰€å¯¹åº”çš„å°±æ˜¯è¯¥å¯¹è±¡çš„åŸå‹ã€‚</p>\n<p>â€œ[[Prototype]]â€ä½œä¸ºå¯¹è±¡çš„å†…éƒ¨å±æ€§ï¼Œæ˜¯ä¸èƒ½è¢«ç›´æ¥è®¿é—®çš„ã€‚æ‰€ä»¥ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹ä¸€ä¸ªå¯¹è±¡çš„åŸå‹ï¼ŒFirefoxå’ŒChromeä¸­æä¾›äº†â€<strong>proto</strong>â€œè¿™ä¸ª<strong>éæ ‡å‡†</strong>ï¼ˆä¸æ˜¯æ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒï¼‰çš„è®¿é—®å™¨ï¼ˆECMAå¼•å…¥äº†æ ‡å‡†å¯¹è±¡åŸå‹è®¿é—®å™¨â€Object.getPrototype(object)â€ï¼‰ã€‚</p>\n<p>ç”¨ä¸€å¥è¯æ¥æ¦‚æ‹¬å°±æ˜¯: åŸå‹æ˜¯ä¸€ä¸ªå±æ€§å¯ä»¥è¢«ç»§æ‰¿çš„å¯¹è±¡.åŸå‹ä¹Ÿå¯ä»¥æœ‰è‡ªå·±çš„åŸå‹.</p>\n<h4 id=\"åŸå‹é“¾\"><a href=\"#åŸå‹é“¾\" class=\"headerlink\" title=\"åŸå‹é“¾\"></a>åŸå‹é“¾</h4><p>åŸå‹ä¹Ÿå¯ä»¥æœ‰è‡ªå·±çš„åŸå‹, è€Œä¸€ä¸ªä¸ªåŸå‹é€šè¿‡prototypeé“¾æ¥èµ·æ¥çš„å°±å«åšåŸå‹é“¾</p>\n<h4 id=\"ç»§æ‰¿\"><a href=\"#ç»§æ‰¿\" class=\"headerlink\" title=\"ç»§æ‰¿\"></a>ç»§æ‰¿</h4><p>å„¿å­å¯ä»¥é€šè¿‡ç»§æ‰¿è·å¾—çˆ¶äº²çš„å±æ€§æˆ–è€…æ–¹æ³•; </p>\n<h3 id=\"why\"><a href=\"#why\" class=\"headerlink\" title=\"why\"></a>why</h3><p>ä¸ºä»€ä¹ˆä¼šæœ‰åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿?</p>\n<p>æ‘˜è‡ªJavaScripté«˜çº§ç¨‹åºè®¾è®¡:</p>\n<blockquote>\n<p>ç»§æ‰¿æ˜¯OOè¯­è¨€ä¸­çš„ä¸€ä¸ªæœ€ä¸ºäººæ´¥æ´¥ä¹é“çš„æ¦‚å¿µ.è®¸å¤šOOè¯­è¨€éƒ½æ”¯æŒä¸¤ç§ç»§æ‰¿æ–¹å¼: <strong>æ¥å£ç»§æ‰¿</strong> å’Œ <strong>å®ç°ç»§æ‰¿</strong> .æ¥å£ç»§æ‰¿åªç»§æ‰¿æ–¹æ³•ç­¾å,è€Œå®ç°ç»§æ‰¿åˆ™ç»§æ‰¿å®é™…çš„æ–¹æ³•.ç”±äºjsä¸­æ–¹æ³•æ²¡æœ‰ç­¾å,åœ¨ECMAScriptä¸­æ— æ³•å®ç°æ¥å£ç»§æ‰¿.ECMAScriptåªæ”¯æŒå®ç°ç»§æ‰¿,è€Œä¸”å…¶ <code>å®ç°ç»§æ‰¿</code> ä¸»è¦æ˜¯ä¾é åŸå‹é“¾æ¥å®ç°çš„.</p>\n</blockquote>\n<h3 id=\"How\"><a href=\"#How\" class=\"headerlink\" title=\"How\"></a>How</h3><h4 id=\"åŸå‹-1\"><a href=\"#åŸå‹-1\" class=\"headerlink\" title=\"åŸå‹\"></a>åŸå‹</h4><p>æ€ä¹ˆæ‰¾åˆ°åŸå‹?</p>\n<p>æˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨, æ‰“å¼€æ§åˆ¶å°(F12), å¯ä»¥ç›´æ¥è¾“å…¥ <code>const obj = {}</code>, æˆ‘ä»¬å°±å¯ä»¥æŠŠä»–ç›´æ¥ç‚¹å¼€.å‘ç°é‡Œé¢æœ‰ä¸€ä¸ª<code>__proto__</code> å…¶å®æˆ‘ä»¬è¾“å…¥çš„è¿™ä¸ªå¯¹è±¡, æ˜¯ä¸€ä¸ª<code>Object</code>æ„é€ å‡½æ•°çš„å®ä¾‹. æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ä¾‹çš„<code>__proto__</code>å±æ€§æ‰¾åˆ°ä»–çš„åŸå‹;</p>\n<h4 id=\"åŸå‹é“¾-1\"><a href=\"#åŸå‹é“¾-1\" class=\"headerlink\" title=\"åŸå‹é“¾\"></a>åŸå‹é“¾</h4><p>æ€ä¹ˆæ‰¾åˆ°åŸå‹é“¾?</p>\n<p>åœ¨æ‰¾ä¹‹å‰æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸ªåŸå‹ä¸æ„é€ å‡½æ•°ä¸å®ä¾‹ç›´æ¥çš„å…³ç³».</p>\n<p>å‡å®šæˆ‘ä»¬æœ‰ä¸€ä¸ªæ„é€ å‡½æ•° <code>function A(){}</code>, æˆ‘ä»¬ç§°ä»–ä¸ºA</p>\n<p>æˆ‘ä»¬æœ‰ä¸€ä¸ªå®ä¾‹B, ä»–æ˜¯è¿™æ ·æ¥çš„: <code>const B = new A()</code>, æˆ‘ä»¬ç§°ä»–ä¸ºB</p>\n<p>Açš„åŸå‹ä¸ºC</p>\n<p>æ¥ä¸‹é‡Œæˆ‘ä»¬å†™ä¸€ä¸ªç­‰å¼æ¥å¾ˆå¥½çš„å±•ç¤ºä»–ä»¬ä¹‹é—´çš„å…³ç³»</p>\n<p>A = prototype =&gt; C = construct =&gt; A = new =&gt; B = <code>__proto__</code> =&gt; C</p>\n<p>è§£é‡Šä¸€ä¸‹: Aæœ‰ä¸€ä¸ªå±æ€§<code>prototype</code> æŒ‡å‘Açš„åŸå‹ C, è€ŒCçš„å±æ€§<code>construct</code>æŒ‡å‘A, Aé€šè¿‡newæ–¹æ³•å¯ä»¥åˆ›å»ºå®ä¾‹B, è€ŒBæœ‰ä¸€ä¸ªå±æ€§<code>__proto__</code>æŒ‡å‘äº†C(Açš„åŸå‹)</p>\n<p>OK, ç†è§£å®Œä¸Šé¢çš„ä¸œè¥¿ä¹‹å, æˆ‘ä»¬å†åŠ ä¸€ä¸ªçŸ¥è¯†ç‚¹, Açš„åŸå‹C, ä¹Ÿæ˜¯Cçš„åŸå‹çš„ä¸€ä¸ªå®ä¾‹.</p>\n<p>å…ˆåˆ«æ‡‚æ²¡æ‡‚, æˆ‘ä»¬çœ‹ä¸€ä¸‹å®æˆ˜.</p>\n<p>ä¹¦æ¥ä¸Šæ–‡ä¸­çš„åŸå‹, æˆ‘å†å¤åˆ¶ä¸€ä¸‹, æ–¹ä¾¿é˜…è¯»</p>\n<blockquote>\n<p>æˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨, æ‰“å¼€æ§åˆ¶å°(F12), å¯ä»¥ç›´æ¥è¾“å…¥ <code>const obj = {}</code>, æˆ‘ä»¬å°±å¯ä»¥æŠŠä»–ç›´æ¥ç‚¹å¼€.å‘ç°é‡Œé¢æœ‰ä¸€ä¸ª<code>__proto__</code> å…¶å®æˆ‘ä»¬è¾“å…¥çš„è¿™ä¸ªå¯¹è±¡, æ˜¯ä¸€ä¸ª<code>Object</code>æ„é€ å‡½æ•°çš„å®ä¾‹. æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ä¾‹çš„<code>__proto__</code>å±æ€§æ‰¾åˆ°ä»–çš„åŸå‹;</p>\n</blockquote>\n<p>æˆ‘ä»¬æ¥ç€ç‚¹å¼€<code>__proto__</code>,å‘ç°é‡Œé¢æœ‰ä¸€å †â€èŠ±é‡Œèƒ¡å“¨â€çš„ä¸œè¥¿, æˆ‘ä»¬æ‰¾åˆ°äº†å…¶ä¸­ä¸€ä¸ªå¾ˆçœ¼ç†Ÿçš„â€é“ä»”â€ -&gt; <code>construct</code>;</p>\n<p>æ ¹æ®ä¹‹å‰çš„äº†è§£</p>\n<blockquote>\n<p>â€‹    A = prototype =&gt; C = construct =&gt; A = new =&gt; B = <code>__proto__</code> =&gt; C</p>\n</blockquote>\n<p>æˆ‘ä»¬ç‚¹å¼€çš„è¿™ä¸ª<code>construct</code>å…¶å®é‚£ä¸ªç©ºå¯¹è±¡çš„æ„é€ å‡½æ•°<code>Object</code>, é‚£ä¹ˆä»–åº”è¯¥æœ‰ä¸€ä¸ª<code>prototype</code>æŒ‡å‘äº†ä»–çš„åŸå‹.</p>\n<p>æˆ‘ä»¬æ‰¾æ‰¾, ç¡®å®å‘ç°äº†æœ‰è¿™ä¹ˆä¸€ä¸ªå±æ€§(<code>prototype</code>); é‚£ä¹ˆç‚¹å¼€ä¹‹ååº”è¯¥ä¸æœ€æ—©çš„ç©ºå¯¹è±¡çš„<code>__proto__</code>çš„å†…å®¹ä¸€è‡´. æ ¹æ®ç­‰å¼å¯å¾—;</p>\n<h5 id=\"æ€»ç»“ä¸€ä¸‹\"><a href=\"#æ€»ç»“ä¸€ä¸‹\" class=\"headerlink\" title=\"æ€»ç»“ä¸€ä¸‹\"></a>æ€»ç»“ä¸€ä¸‹</h5><p>å¯¹è±¡çš„ <code>__proto__</code> å±æ€§æŒ‡å‘åŸå‹ï¼Œ <code>__proto__</code> å°†å¯¹è±¡å’ŒåŸå‹è¿æ¥èµ·æ¥ç»„æˆäº†åŸå‹é“¾</p>\n<p>æ¥ä¸‹æ¥è¿›å…¥æˆ‘ä»¬çš„é‡å¤´æˆç»§æ‰¿</p>\n<h3 id=\"ç»§æ‰¿-1\"><a href=\"#ç»§æ‰¿-1\" class=\"headerlink\" title=\"ç»§æ‰¿\"></a>ç»§æ‰¿</h3><p>å…¶å®ç»§æ‰¿åˆåˆ†ä¸ºå¥½å¤šç§: åŸå‹é“¾ç»§æ‰¿, æ„é€ å‡½æ•°ç»§æ‰¿, ç»„åˆç»§æ‰¿å’Œå¯„ç”Ÿç»„åˆç»§æ‰¿;</p>\n<h4 id=\"åŸå‹é“¾ç»§æ‰¿\"><a href=\"#åŸå‹é“¾ç»§æ‰¿\" class=\"headerlink\" title=\"åŸå‹é“¾ç»§æ‰¿\"></a>åŸå‹é“¾ç»§æ‰¿</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">A</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">this</span>.array = [<span class=\"string\">\"a\"</span>, <span class=\"string\">\"b\"</span>, <span class=\"string\">\"c\"</span>];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">B</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//ç»§æ‰¿äº† A</span></span><br><span class=\"line\">B.prototype = <span class=\"keyword\">new</span> A()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> b1 = <span class=\"keyword\">new</span> B()</span><br><span class=\"line\">b1.array.push(<span class=\"string\">\"d\"</span>); </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b1.array); <span class=\"comment\">//\"a,b,c,d\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> b2 = <span class=\"keyword\">new</span> B(); </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b2.array); <span class=\"comment\">//\"a,b,c,d\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">b2.array.push(<span class=\"string\">\"e\"</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b2.array) <span class=\"comment\">//\"a,b,c,d,e\"</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b1.array) <span class=\"comment\">//\"a,b,c,d,e\"</span></span><br></pre></td></tr></table></figure>\n\n<p>æˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªæ„é€ å‡½æ•°, Aå’ŒB; æ ¹æ®ä¹‹å‰çš„çŸ¥è¯†, æˆ‘ä»¬è®©Bçš„åŸå‹æŒ‡å‘äº†æ„é€ å‡½æ•°Aåˆ›é€ å‡ºæ¥çš„å®ä¾‹(<code>new A()</code>); ç„¶åæˆ‘ä»¬ç”¨æ„é€ å‡½æ•°Båˆ›é€ äº†å®ä¾‹b1,  å¾€ ç»§æ‰¿æ¥çš„å±æ€§array å¢åŠ ä¸€ä¸ªå­—ç¬¦ä¸²â€dâ€; ç„¶åæˆ‘ä»¬è¾“å‡ºä¸€ä¸‹, æŒ‰ç…§æˆ‘ä»¬çš„é€¾æœŸçš„å¤šäº†ä¸€ä¸ªâ€eâ€çš„æƒ…å†µä¸‹, è¿˜æœ‰â€a,b,câ€;</p>\n<p>æ¥ä¸‹æ¥å°±æœ‰äº›é—®é¢˜äº†. æˆ‘ä»¬æŒ‰ç…§æƒ¯ä¾‹, é€šè¿‡æ„é€ å‡½æ•°B, åˆ›é€ äº†b2. b2ç¡®å®ä¹Ÿæœ‰äº†ç»§æ‰¿æ¥çš„å±æ€§â€arrayâ€, å¯æ˜¯è¿™ä¸ªarrayå¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„åˆå§‹çš„<code>[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;]</code>; æˆ‘ä»¬æ”¾å¼ƒæ¢ç©¶, ç»§ç»­å¾€è¿™ä¸ª<code>array</code>é‡Œé¢å¢åŠ ä¸€ä¸ª<code>e</code>, è¾“å‡ºä¸€ä¸‹<code>b1</code>çš„å±æ€§<code>array</code>. ç¡®å®æ˜¯å¯ä»¥å¢åŠ è¿™ä¸ª<code>e</code>;</p>\n<p>å¯æ˜¯!</p>\n<p>å½“æˆ‘ä»¬è¾“å‡º<code>b1.array</code>æ—¶, å‘ç°b1ä¹Ÿè¢«æ”¹äº†, å’Œä¹‹å‰è¯¡å¼‚çš„b2å¤šå‡ºä¸€ä¸ª<code>d</code>ä¸€æ ·.</p>\n<p>æ¢ç©¶å‘ç°è¿™ä¸ªç”±äºæˆ‘ä»¬ç”¨çš„æ˜¯å¼•ç”¨ç±»å‹, æ‰€ä»¥ä»–ä»¬å­˜å‚¨çš„æ˜¯æŒ‡å‘åŒä¸€ä¸ªå†…å­˜çš„å†…å­˜åœ°å€; æ‰€ä»¥æ‰ä¼šå‘ç”Ÿè¿™äº›é—®é¢˜. è¿™ä¹Ÿæš´éœ²äº†åŸå‹é“¾ç»§æ‰¿æ—¶çš„ä¸€ä¸ªé—®é¢˜.å¼•ç”¨ç±»å‹å¸¦æ¥çš„æ¯›ç—…;</p>\n<p>å…¶æ¬¡, æˆ‘ä»¬å‘ç°æˆ‘ä»¬çš„Bçš„åŸå‹æŒ‡å‘Açš„æ„é€ å‡½æ•°æ—¶ä¸èƒ½ä¼ é€’å‚æ•°, è¿™ä¹Ÿçš„è¯æœ‰ç‚¹å‘†æ¿</p>\n<p>ç»¼ä¸ŠåŸå‹é“¾çš„ç»§æ‰¿åœ¨æ—¥å¸¸ä¸­æ˜¯å¾ˆå°‘ç”¨åˆ°çš„</p>\n<h5 id=\"ä¼˜ç‚¹\"><a href=\"#ä¼˜ç‚¹\" class=\"headerlink\" title=\"ä¼˜ç‚¹\"></a>ä¼˜ç‚¹</h5><p>â€‹    å­ç±»å¯ä»¥é€šè¿‡åŸå‹é“¾çš„æŸ¥æ‰¾ï¼Œå®ç°çˆ¶ç±»çš„å±æ€§å…¬ç”¨ä¸å­ç±»çš„å®ä¾‹</p>\n<h5 id=\"ç¼ºç‚¹\"><a href=\"#ç¼ºç‚¹\" class=\"headerlink\" title=\"ç¼ºç‚¹\"></a>ç¼ºç‚¹</h5><ul>\n<li>ä¸€äº›å¼•ç”¨æ•°æ®æ“ä½œçš„æ—¶å€™ä¼šå‡ºé—®é¢˜ï¼Œä¸¤ä¸ªå®ä¾‹ä¼šå…¬ç”¨ç»§æ‰¿å®ä¾‹çš„å¼•ç”¨æ•°æ®ç±»</li>\n<li>è°¨æ…å®šä¹‰æ–¹æ³•ï¼Œä»¥å…å®šä¹‰æ–¹æ³•ä¹Ÿç»§æ‰¿å¯¹è±¡åŸå‹çš„æ–¹æ³•é‡å</li>\n<li>æ— æ³•ç›´æ¥ç»™çˆ¶çº§æ„é€ å‡½æ•°ä½¿ç”¨å‚æ•°</li>\n</ul>\n<h4 id=\"æ„é€ å‡½æ•°ç»§æ‰¿\"><a href=\"#æ„é€ å‡½æ•°ç»§æ‰¿\" class=\"headerlink\" title=\"æ„é€ å‡½æ•°ç»§æ‰¿\"></a>æ„é€ å‡½æ•°ç»§æ‰¿</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">A</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">this</span>.array = [<span class=\"string\">\"a\"</span>, <span class=\"string\">\"b\"</span>, <span class=\"string\">\"c\"</span>];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">B</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  A.call(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//ç»§æ‰¿äº† A</span></span><br><span class=\"line\">B.prototype = <span class=\"keyword\">new</span> A()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> b1 = <span class=\"keyword\">new</span> B()</span><br><span class=\"line\">b1.array.push(<span class=\"string\">\"d\"</span>); </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b1.array); <span class=\"comment\">//\"a,b,c,d\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> b2 = <span class=\"keyword\">new</span> B(); </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b2.array); <span class=\"comment\">//\"a,b,c\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">b2.array.push(<span class=\"string\">\"e\"</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b2.array) <span class=\"comment\">//\"a,b,c,e\"</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b1.array) <span class=\"comment\">//\"a,b,c,d\"</span></span><br></pre></td></tr></table></figure>\n\n<p>æˆ‘ä»¬å¥‡è¿¹èˆ¬çš„å‘ç°, æ„é€ å‡½æ•°çš„ç»§æ‰¿è§£å†³äº†æˆ‘ä»¬ä¹‹å‰å‘ç°çš„JavaScriptå¼•ç”¨é—®é¢˜.é‚£å‡½æ•°ä¼ å‚çš„é—®â€¦</p>\n<p>å•ª!</p>\n<p>åœ, æˆ‘ä»¬ç°åœ¨æ¥ä¼ é€’ä¸€ä¸‹å‚æ•°!</p>\n<p>æˆ‘ä»¬æŠŠä¸Šé¢çš„ä¾‹å­ä¿®æ”¹ä¸€ä¸‹</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">A</span>(<span class=\"params\">name</span>)</span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">this</span>.array = [<span class=\"string\">\"a\"</span>, <span class=\"string\">\"b\"</span>, <span class=\"string\">\"c\"</span>];</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.name = name</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">B</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  A.call(<span class=\"keyword\">this</span>, <span class=\"string\">'B'</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//ç»§æ‰¿äº† A</span></span><br><span class=\"line\">B.prototype = <span class=\"keyword\">new</span> A()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> b1 = <span class=\"keyword\">new</span> B()</span><br><span class=\"line\">b1.array.push(<span class=\"string\">\"d\"</span>); </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b1.array); <span class=\"comment\">//\"a,b,c,d\"</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b1.name); <span class=\"comment\">//\"B\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> b2 = <span class=\"keyword\">new</span> B(); </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b2.array); <span class=\"comment\">//\"a,b,c\"</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b1.name); <span class=\"comment\">//\"B\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">b2.array.push(<span class=\"string\">\"e\"</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b2.array) <span class=\"comment\">//\"a,b,c,e\"</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b1.array) <span class=\"comment\">//\"a,b,c,d\"</span></span><br></pre></td></tr></table></figure>\n\n<p>è¿™æ ·çš„è¯æˆ‘ä»¬è§£å†³äº†åŸå‹é“¾ç»§æ‰¿çš„ä¸¤ä¸ªé—®é¢˜(1.æ— æ³•ä¼ å‚, 2.jså¼•ç”¨é—®é¢˜);</p>\n<p>è¯¥ä¸ä¼šæœ‰äººè®¤ä¸ºè¿™æ ·å°±å¾ˆå®Œç¾äº†å§?ä¸ä¼šå§!ä¸ä¼šå§!</p>\n<p>æˆ‘ä»¬å†·é™ä¸‹æ¥æƒ³æƒ³çœ‹, å…¶å®è¿™ä¸ªä¼ é€’å‚æ•°æ˜¯å‡ ä¹ç®—æ˜¯å†™æ­»çš„. è¿˜ä¸å¦‚ç›´æ¥åœ¨Aé‡Œé¢ç›´æ¥å†™æ­»å¥½äº†, æ ¹æœ¬å°±æ— æ³•å¤ç”¨å˜›; è€Œä¸”ï¼Œåœ¨è¶…ç±»å‹çš„åŸå‹ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œå¯¹å­ç±»å‹è€Œè¨€ä¹Ÿæ˜¯ä¸å¯è§çš„ï¼Œç»“ æœæ‰€æœ‰ç±»å‹éƒ½åªèƒ½ä½¿ç”¨æ„é€ å‡½æ•°æ¨¡å¼ã€‚è€ƒè™‘åˆ°è¿™äº›é—®é¢˜ï¼Œå€Ÿç”¨æ„é€ å‡½æ•°çš„æŠ€æœ¯ä¹Ÿæ˜¯å¾ˆå°‘å•ç‹¬ä½¿ç”¨çš„ã€‚</p>\n<h5 id=\"ä¼˜ç‚¹-1\"><a href=\"#ä¼˜ç‚¹-1\" class=\"headerlink\" title=\"ä¼˜ç‚¹\"></a>ä¼˜ç‚¹</h5><ul>\n<li>è§£å†³äº†åŸå‹é“¾ç»§æ‰¿çš„ å¼•ç”¨ç±»å‹æ“ä½œé—®é¢˜</li>\n<li>è§£å†³äº†çˆ¶ç±»ä¼ é€’å‚æ•°é—®é¢˜</li>\n</ul>\n<h5 id=\"ç¼ºç‚¹-1\"><a href=\"#ç¼ºç‚¹-1\" class=\"headerlink\" title=\"ç¼ºç‚¹\"></a>ç¼ºç‚¹</h5><ul>\n<li>ä»…ä»…ä½¿ç”¨å€Ÿç”¨æ„é€ å‡½æ•°æ¨¡å¼ç»§æ‰¿ï¼Œæ— æ³•æ‘†è„±å¤Ÿç€å‡½æ•°ã€‚æ–¹æ³•åœ¨æ„é€ å‡½æ•°ä¸­å®šä¹‰å¤ç”¨ä¸å¯è°ˆ</li>\n<li>å¯¹äºè¶…ç±»çš„åŸå‹å®šä¹‰çš„æ–¹æ³•å¯¹äºå­ç±»æ˜¯ä¸å¯ä½¿ç”¨çš„ï¼Œå­ç±»çš„å®ä¾‹åªæ˜¯å¾—åˆ°äº†çˆ¶ç±»çš„thisç»‘å®šçš„å±æ€§ è€ƒè™‘åˆ°è¿™äº›ç¼ºç‚¹ï¼Œå•ç‹¬ä½¿ç”¨å€Ÿç”¨æ„é€ å‡½æ•°ä¹Ÿæ˜¯å¾ˆå°‘ä½¿ç”¨çš„</li>\n</ul>\n<h4 id=\"ç»„åˆç»§æ‰¿\"><a href=\"#ç»„åˆç»§æ‰¿\" class=\"headerlink\" title=\"ç»„åˆç»§æ‰¿\"></a>ç»„åˆç»§æ‰¿</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">A</span>(<span class=\"params\">name</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.name = name</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.array = [<span class=\"string\">'1'</span>, <span class=\"string\">'2'</span>, <span class=\"string\">'3'</span>]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">A.prototype.sayName = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>)</span>&#123;<span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name)&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">B</span>(<span class=\"params\">name, age</span>)</span>&#123;</span><br><span class=\"line\">  A.call(<span class=\"keyword\">this</span>, name);</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.age = age;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">B.prototype = <span class=\"keyword\">new</span> A();</span><br><span class=\"line\">B.prototype.constructor = A; <span class=\"comment\">// å› ä¸ºåŸå‹é“¾ç»§æ‰¿ï¼Œä¼šæŠŠconstructoræŒ‡å‘æ”¹å˜ï¼Œæ‰€ä»¥è¦é‡æ–°æŒ‡å›è‡ªèº«</span></span><br><span class=\"line\">B.prototype.sayAge = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>)</span>&#123;<span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.age)&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"keyword\">new</span> B(<span class=\"string\">'a'</span>, <span class=\"number\">10</span>)</span><br><span class=\"line\">a.array.push(<span class=\"string\">'a'</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a.array) <span class=\"comment\">// [\"1\", \"2\", \"3\", \"a\"]</span></span><br><span class=\"line\">a.sayName() <span class=\"comment\">// 'a'</span></span><br><span class=\"line\">a.sayAge() <span class=\"comment\">// 10</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"keyword\">new</span> B(<span class=\"string\">'b'</span>, <span class=\"number\">20</span>)</span><br><span class=\"line\">b.array.push(<span class=\"string\">'b'</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b.array) <span class=\"comment\">// [\"1\", \"2\", \"3\", \"b\"]</span></span><br><span class=\"line\">b.sayName()<span class=\"comment\">// 'b'</span></span><br><span class=\"line\">b.sayAge() <span class=\"comment\">// 20</span></span><br></pre></td></tr></table></figure>\n\n<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­, æ„é€ å‡½æ•°Aæœ‰ä¸¤ä¸ªå†…ç½®å±æ€§<code>name</code>å’Œ<code>array</code>. Açš„åŸå‹å®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•<code>sayName</code>; æ„é€ å‡½æ•°Båœ¨è°ƒç”¨Açš„æ„é€ å‡½æ•°æ—¶ä¼ å…¥äº†ä¸€ä¸ªå‚æ•°<code>name</code>, ç„¶ååˆç»™Bçš„åŸå‹ä¸Šå®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•<code>sayAge</code>. è¿™æ ·ä¸€æ¥, å°±å¯ä»¥è®©ä¸¤ä¸ªBçš„å®ä¾‹åˆ†åˆ«æ‹¥æœ‰è‡ªå·±çš„å±æ€§, å½“ç„¶ä¹ŸåŒ…æ‹¬äº†array, è¿˜å¯ä»¥æ‹¥æœ‰ç›¸åŒçš„æ–¹æ³•.</p>\n<p>ç»„åˆç»§æ‰¿é¿å…äº†åŸå‹é“¾å’Œå€Ÿç”¨æ„é€ å‡½æ•°çš„ç¼ºé™·ï¼Œèåˆäº†å®ƒä»¬çš„ä¼˜ç‚¹ï¼Œæˆä¸º JavaScript ä¸­æœ€å¸¸ç”¨çš„ç»§ æ‰¿æ¨¡å¼ã€‚è€Œä¸”(å…³é”®)ï¼Œ<code>instanceof</code> å’Œ <code>isPrototypeOf()</code>ä¹Ÿèƒ½å¤Ÿç”¨äºè¯†åˆ«åŸºäºç»„åˆç»§æ‰¿åˆ›å»ºçš„å¯¹è±¡ã€‚</p>\n<h5 id=\"ä¼˜ç‚¹-2\"><a href=\"#ä¼˜ç‚¹-2\" class=\"headerlink\" title=\"ä¼˜ç‚¹\"></a>ä¼˜ç‚¹</h5><ul>\n<li>è§£å†³äº†åŸå‹é“¾ç»§æ‰¿å¼•ç”¨ç±»å‹çš„å®ä¾‹æ“ä½œå¯¼è‡´å¼•ç”¨æ”¹å˜</li>\n<li>è§£å†³äº†å€Ÿæ„é€ å‡½æ•°ç»§æ‰¿æ–¹å¼çš„ï¼Œçˆ¶ç±»åŸå‹å­ç±»å®ä¾‹å¯ä»¥ä½¿ç”¨</li>\n</ul>\n<h5 id=\"ç¼ºç‚¹-2\"><a href=\"#ç¼ºç‚¹-2\" class=\"headerlink\" title=\"ç¼ºç‚¹\"></a>ç¼ºç‚¹</h5><p>çˆ¶ç±»çš„æ„é€ å‡½æ•°è¢«å®ä¾‹æ¢äº†ä¸¤æ¬¡ * å®ä¾‹ä¼šæœ‰çˆ¶ç±»çš„æ„é€ å‡½æ•°çš„ä¸€äº›thiså±æ€§ã€å­ç±»çš„æ„é€ å‡½æ•°ï¼ˆprototypeï¼‰ä¸Šä¹Ÿæœ‰ä¸€ä»½å®ä¾‹çš„ä¸Šæœ‰çš„å±æ€§</p>\n<h4 id=\"åŸå‹å¼ç»§æ‰¿\"><a href=\"#åŸå‹å¼ç»§æ‰¿\" class=\"headerlink\" title=\"åŸå‹å¼ç»§æ‰¿\"></a>åŸå‹å¼ç»§æ‰¿</h4><p>é“æ ¼æ‹‰æ–¯Â·å…‹ç½—å…‹ç¦å¾·åœ¨ 2006 å¹´å†™äº†ä¸€ç¯‡æ–‡ç« ï¼Œé¢˜ä¸º Prototypal Inheritance in JavaScript (JavaScript 10 ä¸­çš„åŸå‹å¼ç»§æ‰¿)ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œä»–ä»‹ç»äº†ä¸€ç§å®ç°ç»§æ‰¿çš„æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•å¹¶æ²¡æœ‰ä½¿ç”¨ä¸¥æ ¼æ„ä¹‰ä¸Šçš„ æ„é€ å‡½æ•°ã€‚ä»–çš„æƒ³æ³•æ˜¯å€ŸåŠ©åŸå‹å¯ä»¥åŸºäºå·²æœ‰çš„å¯¹è±¡åˆ›å»ºæ–°å¯¹è±¡ï¼ŒåŒæ—¶è¿˜ä¸å¿…å› æ­¤åˆ›å»ºè‡ªå®šä¹‰ç±»å‹ã€‚ä¸º äº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œä»–ç»™å‡ºäº†å¦‚ä¸‹å‡½æ•°ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">object</span>(<span class=\"params\">o</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">F</span>(<span class=\"params\"></span>)</span>&#123;&#125;</span><br><span class=\"line\">  F.prototype = o</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> F</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>çœ‹èµ·æ¥éå¸¸ç®€å•</p>\n<p>å…ˆåœ¨<code>object</code>å‡½æ•°å†…éƒ¨åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„æ„é€ å‡½æ•°<code>F</code>, ç„¶åå°†ä¼ å…¥çš„è¿™ä¸ªå¯¹è±¡<code>o</code>ä½œä¸ºè¿™ä¸ªä¸´æ—¶æ„é€ å‡½æ•°çš„åŸå‹, æœ€åè¿”å›è¿™ä¸ªä¸´æ—¶æ„é€ å‡½æ•°çš„å®ä¾‹. </p>\n<p>ç®€å•æ¥è¯´å°±æ˜¯<code>object</code>å¯¹ä¼ å…¥çš„å¯¹è±¡è¿›è¡Œäº†æµ…å¤åˆ¶.</p>\n<p>æµ…æ‹·è´å’Œæ·±æ‹·è´å¯ä»¥è‡ªè¡ŒGoogleä¸€ä¸‹, è¿™ç®—ä¸€ä¸ªé‡è¦çš„çŸ¥è¯†ç‚¹.</p>\n<p>ä¸¾ä¸ªğŸŒ°</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">object</span>(<span class=\"params\">o</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">F</span>(<span class=\"params\"></span>)</span>&#123;&#125;</span><br><span class=\"line\">  F.prototype = o</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> F</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">'a'</span>,</span><br><span class=\"line\">  array: [<span class=\"string\">'1'</span>, <span class=\"string\">'2'</span>],</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> qq = object(a)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(qq.name)</span><br><span class=\"line\">qq.array.push(<span class=\"string\">'qq'</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(qq.array)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> ww = object(a)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(ww.name)</span><br><span class=\"line\">ww.array.push(<span class=\"string\">'ww'</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(ww.array)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(qq.array)</span><br></pre></td></tr></table></figure>\n\n<p>æœ‰æ²¡æœ‰ä¼¼æ›¾ç›¸è¯†çš„æ„Ÿè§‰â€¦.åŸå‹é“¾ç»§æ‰¿çš„è€æ¯›ç—…æ¥äº†â€¦</p>\n<p>ä¸è¿‡ä»–ä¹Ÿä¸æ˜¯æ²¡æœ‰ä¼˜ç‚¹çš„.</p>\n<p>åœ¨æ²¡æœ‰å¿…è¦å…´å¸ˆåŠ¨ä¼—åœ°åˆ›å»ºæ„é€ å‡½æ•°ï¼Œè€Œåªæƒ³è®©ä¸€ä¸ªå¯¹è±¡ä¸å¦ä¸€ä¸ªå¯¹è±¡ä¿æŒç±»ä¼¼çš„æƒ…å†µä¸‹ï¼ŒåŸå‹å¼ ç»§æ‰¿æ˜¯å®Œå…¨å¯ä»¥èƒœä»»çš„ã€‚</p>\n<blockquote>\n<p>ECMAScript 5 é€šè¿‡æ–°å¢ Object.create()æ–¹æ³•è§„èŒƒåŒ–äº†åŸå‹å¼ç»§æ‰¿ã€‚è¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°:ä¸€ ä¸ªç”¨ä½œæ–°å¯¹è±¡åŸå‹çš„å¯¹è±¡å’Œ(å¯é€‰çš„)ä¸€ä¸ªä¸ºæ–°å¯¹è±¡å®šä¹‰é¢å¤–å±æ€§çš„å¯¹è±¡ã€‚åœ¨ä¼ å…¥ä¸€ä¸ªå‚æ•°çš„æƒ…å†µä¸‹ï¼Œ Object.create()ä¸ object()æ–¹æ³•çš„è¡Œä¸ºç›¸åŒã€‚æœ‰å…´è¶£çš„è¯å¯ä»¥è‡ªå·±äº†è§£ä¸€ä¸‹</p>\n</blockquote>\n<h5 id=\"ä¼˜ç‚¹-3\"><a href=\"#ä¼˜ç‚¹-3\" class=\"headerlink\" title=\"ä¼˜ç‚¹\"></a>ä¼˜ç‚¹</h5><p>å†ä¸ç”¨åˆ›å»ºæ„é€ å‡½æ•°çš„æƒ…å†µä¸‹ï¼Œå®ç°äº†åŸå‹é“¾ç»§æ‰¿ï¼Œä»£ç é‡å‡å°‘ä¸€éƒ¨åˆ†</p>\n<h5 id=\"ç¼ºç‚¹-3\"><a href=\"#ç¼ºç‚¹-3\" class=\"headerlink\" title=\"ç¼ºç‚¹\"></a>ç¼ºç‚¹</h5><ul>\n<li>ä¸€äº›å¼•ç”¨æ•°æ®æ“ä½œçš„æ—¶å€™ä¼šå‡ºé—®é¢˜ï¼Œä¸¤ä¸ªå®ä¾‹ä¼šå…¬ç”¨ç»§æ‰¿å®ä¾‹çš„å¼•ç”¨æ•°æ®ç±»</li>\n<li>è°¨æ…å®šä¹‰æ–¹æ³•ï¼Œä»¥å…å®šä¹‰æ–¹æ³•ä¹Ÿç»§æ‰¿å¯¹è±¡åŸå‹çš„æ–¹æ³•é‡å</li>\n<li>æ— æ³•ç›´æ¥ç»™çˆ¶çº§æ„é€ å‡½æ•°ä½¿ç”¨å‚æ•°</li>\n</ul>\n<h4 id=\"å¯„ç”Ÿç»§æ‰¿\"><a href=\"#å¯„ç”Ÿç»§æ‰¿\" class=\"headerlink\" title=\"å¯„ç”Ÿç»§æ‰¿\"></a>å¯„ç”Ÿç»§æ‰¿</h4><p>å¯„ç”Ÿç»§æ‰¿å’ŒåŸå‹å¼ç»§æ‰¿ç´§å¯†ç›¸å…³, åŒæ ·ä¹Ÿæ˜¯ç”±å…‹ç½—å…‹ç¦å¾·æ¨è€Œå¹¿ ä¹‹çš„.å¯„ç”Ÿå¼ç»§æ‰¿çš„æ€è·¯ä¸å¯„ç”Ÿæ„é€ å‡½æ•°å’Œå·¥å‚æ¨¡å¼ç±»ä¼¼ï¼Œå³åˆ›å»ºä¸€ä¸ªä»…ç”¨äºå°è£…ç»§æ‰¿è¿‡ç¨‹çš„å‡½æ•°ï¼Œè¯¥ å‡½æ•°åœ¨å†…éƒ¨ä»¥æŸç§æ–¹å¼æ¥å¢å¼ºå¯¹è±¡ï¼Œæœ€åå†åƒçœŸåœ°æ˜¯å®ƒåšäº†æ‰€æœ‰å·¥ä½œä¸€æ ·è¿”å›å¯¹è±¡ã€‚ä»¥ä¸‹ä»£ç ç¤ºèŒƒäº†å¯„ ç”Ÿå¼ç»§æ‰¿æ¨¡å¼ã€‚</p>\n<p>ä¸Šä»£ç </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">object</span>(<span class=\"params\">o</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">F</span>(<span class=\"params\"></span>)</span>&#123;&#125;</span><br><span class=\"line\">  F.prototype = o</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> F</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createAnother</span>(<span class=\"params\">original</span>)</span>&#123; </span><br><span class=\"line\">  <span class=\"keyword\">var</span> clone=object(original); <span class=\"comment\">//é€šè¿‡è°ƒç”¨å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡</span></span><br><span class=\"line\">  clone.sayHi = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123; <span class=\"comment\">//ä»¥æŸç§æ–¹å¼æ¥å¢å¼ºè¿™ä¸ªå¯¹è±¡</span></span><br><span class=\"line\">    alert(<span class=\"string\">\"hi\"</span>);</span><br><span class=\"line\">\t&#125;;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> clone;<span class=\"comment\">//è¿”å›è¿™ä¸ªå¯¹è±¡</span></span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n\n<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒcreateAnother()å‡½æ•°æ¥æ”¶äº†ä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯å°†è¦ä½œä¸ºæ–°å¯¹è±¡åŸºç¡€çš„å¯¹è±¡ã€‚ç„¶ åï¼ŒæŠŠè¿™ä¸ªå¯¹è±¡(original)ä¼ é€’ç»™ object()å‡½æ•°ï¼Œå°†è¿”å›çš„ç»“æœèµ‹å€¼ç»™ cloneã€‚å†ä¸º clone å¯¹è±¡ æ·»åŠ ä¸€ä¸ªæ–°æ–¹æ³• sayHi()ï¼Œæœ€åè¿”å› clone å¯¹è±¡ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> person = &#123;</span><br><span class=\"line\">\tname: <span class=\"string\">\"Nicholas\"</span>,</span><br><span class=\"line\">\tfriends: [<span class=\"string\">\"Shelby\"</span>, <span class=\"string\">\"Court\"</span>, <span class=\"string\">\"Van\"</span>]</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> anotherPerson = createAnother(person); </span><br><span class=\"line\">anotherPerson.sayHi(); <span class=\"comment\">//\"hi\"</span></span><br></pre></td></tr></table></figure>\n\n<p>è¿™ä¸ªä¾‹å­ä¸­çš„ä»£ç åŸºäº person è¿”å›äº†ä¸€ä¸ªæ–°å¯¹è±¡â€”â€”anotherPersonã€‚æ–°å¯¹è±¡ä¸ä»…å…·æœ‰ person çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œè€Œä¸”è¿˜æœ‰è‡ªå·±çš„ sayHi()æ–¹æ³•ã€‚</p>\n<p>åœ¨ä¸»è¦è€ƒè™‘å¯¹è±¡è€Œä¸æ˜¯è‡ªå®šä¹‰ç±»å‹å’Œæ„é€ å‡½æ•°çš„æƒ…å†µä¸‹ï¼Œå¯„ç”Ÿå¼ç»§æ‰¿ä¹Ÿæ˜¯ä¸€ç§æœ‰ç”¨çš„æ¨¡å¼ã€‚å‰é¢ç¤º èŒƒç»§æ‰¿æ¨¡å¼æ—¶ä½¿ç”¨çš„ object()å‡½æ•°ä¸æ˜¯å¿…éœ€çš„;ä»»ä½•èƒ½å¤Ÿè¿”å›æ–°å¯¹è±¡çš„å‡½æ•°éƒ½é€‚ç”¨äºæ­¤æ¨¡å¼ã€‚</p>\n<blockquote>\n<p>ä½¿ç”¨å¯„ç”Ÿç»§æ‰¿, ç”±äºä¸èƒ½åšåˆ°å‡½æ•°å¤ç”¨è€Œé™ä½æ•ˆç‡, è¿™ç‚¹å’Œæ„é€ å‡½æ•°ç»§æ‰¿å¾ˆåƒ</p>\n</blockquote>\n<h5 id=\"ä¼˜ç‚¹-4\"><a href=\"#ä¼˜ç‚¹-4\" class=\"headerlink\" title=\"ä¼˜ç‚¹\"></a>ä¼˜ç‚¹</h5><ul>\n<li>å†ä¸ç”¨åˆ›å»ºæ„é€ å‡½æ•°çš„æƒ…å†µä¸‹ï¼Œå®ç°äº†åŸå‹é“¾ç»§æ‰¿ï¼Œä»£ç é‡å‡å°‘ä¸€éƒ¨åˆ†</li>\n<li>å¯ä»¥ç»™å¤‡ä»½çš„å¯¹è±¡æ·»åŠ ä¸€äº›å±æ€§</li>\n</ul>\n<h5 id=\"ç¼ºç‚¹-4\"><a href=\"#ç¼ºç‚¹-4\" class=\"headerlink\" title=\"ç¼ºç‚¹\"></a>ç¼ºç‚¹</h5><p>ç±»ä¼¼æ„é€ å‡½æ•°ä¸€æ ·ï¼Œåˆ›å»ºå¯„ç”Ÿçš„æ–¹æ³•éœ€è¦åœ¨cloneå¯¹è±¡ä¸Šé¢æ·»åŠ ä¸€äº›æƒ³è¦çš„å±æ€§ï¼Œè¿™äº›å±æ€§æ˜¯æ”¾åœ¨cloneä¸Šé¢çš„ä¸€äº›ç§æœ‰çš„å±æ€§</p>\n<h4 id=\"å¯„ç”Ÿç»„åˆç»§æ‰¿-ç»ˆææ–¹æ¡ˆ\"><a href=\"#å¯„ç”Ÿç»„åˆç»§æ‰¿-ç»ˆææ–¹æ¡ˆ\" class=\"headerlink\" title=\"å¯„ç”Ÿç»„åˆç»§æ‰¿(ç»ˆææ–¹æ¡ˆ\"></a>å¯„ç”Ÿç»„åˆç»§æ‰¿(ç»ˆææ–¹æ¡ˆ</h4><p>å‰é¢è¯´è¿‡ï¼Œç»„åˆç»§æ‰¿æ˜¯ JavaScript æœ€å¸¸ç”¨çš„ç»§æ‰¿æ¨¡å¼;ä¸è¿‡ï¼Œå®ƒä¹Ÿæœ‰è‡ªå·±çš„ä¸è¶³ã€‚ç»„åˆç»§æ‰¿æœ€å¤§çš„ é—®é¢˜å°±æ˜¯æ— è®ºä»€ä¹ˆæƒ…å†µä¸‹ï¼Œéƒ½ä¼šè°ƒç”¨ä¸¤æ¬¡è¶…ç±»å‹æ„é€ å‡½æ•°:ä¸€æ¬¡æ˜¯åœ¨åˆ›å»ºå­ç±»å‹åŸå‹çš„æ—¶å€™ï¼Œå¦ä¸€æ¬¡æ˜¯ åœ¨å­ç±»å‹æ„é€ å‡½æ•°å†…éƒ¨ã€‚æ²¡é”™ï¼Œå­ç±»å‹æœ€ç»ˆä¼šåŒ…å«è¶…ç±»å‹å¯¹è±¡çš„å…¨éƒ¨å®ä¾‹å±æ€§ï¼Œä½†æˆ‘ä»¬ä¸å¾—ä¸åœ¨è°ƒç”¨å­ ç±»å‹æ„é€ å‡½æ•°æ—¶é‡å†™è¿™äº›å±æ€§ã€‚å†æ¥çœ‹ä¸€çœ‹ä¸‹é¢ç»„åˆç»§æ‰¿çš„ä¾‹å­ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">A</span>(<span class=\"params\">name</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.array = [<span class=\"string\">'1'</span>,<span class=\"string\">'2'</span>,<span class=\"string\">'3'</span>]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">A.prototype.sayName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;<span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name)&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">B</span>(<span class=\"params\">name, age</span>)</span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  A.call(<span class=\"keyword\">this</span>, name) <span class=\"comment\">//ç¬¬äºŒæ¬¡è°ƒç”¨</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.age = age</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">B.prototype.sayAge = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;<span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.age)&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">B.prototype = <span class=\"keyword\">new</span> A() <span class=\"comment\">// ç¬¬ä¸€æ¬¡è°ƒç”¨</span></span><br><span class=\"line\">B.prototype.constructor = B</span><br></pre></td></tr></table></figure>\n\n<p>ç¬¬ä¸€æ¬¡è°ƒç”¨Aæ„é€ å‡½æ•°çš„æ—¶å€™, Bçš„åŸå‹ä¸Šå°±æ‹¥æœ‰äº†Açš„ä¸¤ä¸ªå±æ€§å’Œä¸€ä¸ªæ–¹æ³•;</p>\n<p>ç¬¬äºŒæ¬¡è°ƒç”¨Açš„æ„é€ å‡½æ•°æ—¶, ä¸ºBçš„å®ä¾‹åˆ›å»ºäº†Açš„ä¸¤ä¸ªçš„å±æ€§å’Œä¸€ä¸ªæ–¹æ³•, äºæ˜¯å®ä¾‹çš„ä¸¤ä¸ªå±æ€§å’Œä¸€ä¸ªæ–¹æ³•å°±å±è”½äº†åŸå‹ä¸Šçš„å®ä¾‹å’Œæ–¹æ³•; </p>\n<p>æ˜¯ä¸æ˜¯æ„Ÿè§‰æœ‰ç‚¹ç‚¹æµªè´¹, ä¸è¿‡å¥½åœ¨æˆ‘ä»¬å·²ç»æ‰¾åˆ°è§£å†³æ–¹æ¡ˆâ€”&gt;å¯„ç”Ÿç»„åˆç»§æ‰¿</p>\n<p>ä¸¾ä¸€ä¸ªéå¸¸ç®€å•çš„ğŸŒ°, å¹¶ä¸”æˆ‘å°½é‡é€å­—é€å¥çš„è®²æ¸…æ¥š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">object</span>(<span class=\"params\">o</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">F</span>(<span class=\"params\"></span>)</span>&#123;&#125;</span><br><span class=\"line\">  F.prototype = o</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> F</span><br><span class=\"line\">&#125; <span class=\"comment\">//ä¹Ÿå¯ä»¥ç”¨Object.createæ›¿ä»£</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">B</span>(<span class=\"params\">name</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.colors = [<span class=\"string\">\"red\"</span>, <span class=\"string\">\"blue\"</span>, <span class=\"string\">\"green\"</span>];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">B.prototype.sayName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123; <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">A</span>(<span class=\"params\">name, age</span>)</span>&#123; </span><br><span class=\"line\">  B.call(<span class=\"keyword\">this</span>, name); <span class=\"comment\">// åªè°ƒç”¨äº†è¿™ä¸€æ¬¡</span></span><br><span class=\"line\">\t<span class=\"keyword\">this</span>.age = age; </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">inheritPrototype</span>(<span class=\"params\">A, B</span>)</span>&#123; </span><br><span class=\"line\">  <span class=\"comment\">//è®©prototypeå¯ä»¥æ‹¿åˆ°Bçš„å±æ€§å’Œæ–¹æ³•...è¿™æ˜¯åŸå‹å¼ç»§æ‰¿</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> prototype = object(B.prototype); </span><br><span class=\"line\">  <span class=\"comment\">//ç”±äºé‡å†™äº†åŸå‹, æ‰€ä»¥æ­¤æ—¶çš„constructorä¼šæŒ‡å‘Object, æ‰€ä»¥å¿…é¡»æŒ‡å®šä¸€ä¸‹constructor...é‚£ä¸ºä»€ä¹ˆä¼šä¸¢å¤±å‘¢?å› ä¸ºæˆ‘ä»¬ç©¿ç»™objectè¿™ä¸ªæ–¹æ³•çš„æ˜¯ä¸€ä¸ªå¯¹è±¡, è€Œå¯¹è±¡çš„æ„é€ å‡½æ•°å°±æ˜¯Object; åœ¨åŸå‹é‚£ä¸€å°èŠ‚æˆ‘ä»¬è¯´è¿‡äº†, åŸå‹ä¹Ÿæ˜¯å¯¹è±¡;</span></span><br><span class=\"line\">  prototype.constructor = A; </span><br><span class=\"line\">  <span class=\"comment\">// ç»§æ‰¿å±æ€§ä¹‹åå°±éœ€è¦å°†åŸå‹ç»™æŒ‡å‘å›å», ä¸ºäº†åŸå‹é“¾çš„æ­£ç¡®æŒ‡å‘</span></span><br><span class=\"line\">  A.prototype = prototype;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">inheritPrototype(A, B);</span><br><span class=\"line\"></span><br><span class=\"line\">A.prototype.sayAge = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123; </span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.age);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>åŸºæœ¬æ€æƒ³ï¼šé€šè¿‡å€Ÿç”¨æ„é€ å‡½æ•°æ¥ç»§æ‰¿å±æ€§ï¼Œé€šè¿‡åŸå‹é“¾çš„æ··æˆå½¢å¼æ¥ç»§æ‰¿æ–¹æ³•ã€‚å®é™…ä¸Šæ˜¯<strong>åœ¨ç»„åˆç»§æ‰¿çš„åŸºç¡€ä¸Šï¼Œç”¨è¶…ç±»å‹åŸå‹çš„å‰¯æœ¬ä»£æ›¿è°ƒç”¨è¶…ç±»å‹çš„æ„é€ å‡½æ•°ç»™å­ç±»å‹æŒ‡å®šåŸå‹</strong>ã€‚</p>\n<p>æœ¬è´¨ä¸Šï¼Œæ˜¯ä½¿ç”¨å¯„ç”Ÿå¼ç»§æ‰¿æ¥ç»§æ‰¿è¶…ç±»å‹çš„åŸå‹ï¼Œç„¶åå†å°†ç»“æœæŒ‡å®šç»™å­ç±»å‹çš„åŸå‹ã€‚</p>\n<p>ä¼˜ç‚¹ï¼šåªè°ƒç”¨äº†ä¸€æ¬¡è¶…ç±»å‹çš„æ„é€ å‡½æ•°ï¼Œå¹¶ä¸”å› æ­¤é¿å…äº†åœ¨å­ç±»å‹çš„åŸå‹ä¸Šåˆ›å»ºä¸å¿…è¦çš„ã€å¤šä½™çš„å±æ€§ã€‚ä¸æ­¤åŒæ—¶ï¼ŒåŸå‹é“¾è¿˜èƒ½ä¿æŒä¸å˜ã€‚å› æ­¤ï¼Œè¿˜èƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨<code>instanceof</code>å’Œ<code>isPrototypeOf()</code>ã€‚æ™®éè®¤ä¸ºå¯„ç”Ÿç»„åˆå¼ç»§æ‰¿æ˜¯å¼•ç”¨ç±»å‹<strong>æœ€ç†æƒ³</strong>çš„ç»§æ‰¿æ–¹å¼ã€‚</p>\n<h5 id=\"ä¼˜ç‚¹-5\"><a href=\"#ä¼˜ç‚¹-5\" class=\"headerlink\" title=\"ä¼˜ç‚¹\"></a>ä¼˜ç‚¹</h5><ul>\n<li>åœ¨å°‘ä¸€æ¬¡å®ä¾‹åŒ–çˆ¶ç±»çš„æƒ…å†µä¸‹ï¼Œå®ç°äº†åŸå‹é“¾ç»§æ‰¿å’Œå€Ÿç”¨æ„é€ å‡½æ•°</li>\n<li>å‡å°‘äº†åŸå‹é“¾æŸ¥æ‰¾çš„æ¬¡æ•°ï¼ˆå­ç±»ç›´æ¥ç»§æ‰¿è¶…ç±»çš„prototypeï¼Œè€Œä¸æ˜¯çˆ¶ç±»çš„å®ä¾‹ï¼‰</li>\n</ul>\n<h5 id=\"ç¼ºç‚¹-5\"><a href=\"#ç¼ºç‚¹-5\" class=\"headerlink\" title=\"ç¼ºç‚¹\"></a>ç¼ºç‚¹</h5><p>æš‚æ— </p>\n<h4 id=\"classç»§æ‰¿\"><a href=\"#classç»§æ‰¿\" class=\"headerlink\" title=\"classç»§æ‰¿\"></a>classç»§æ‰¿</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Parent</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">constructor</span>(name)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    getName()&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Child</span> <span class=\"keyword\">extends</span> <span class=\"title\">Parent</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">constructor</span>(val)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>(val);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> child = <span class=\"keyword\">new</span> Child(<span class=\"string\">'zhangsan'</span>);</span><br><span class=\"line\">child.getName();  <span class=\"comment\">//zhangsan</span></span><br><span class=\"line\">child <span class=\"keyword\">instanceof</span> Parent <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>è¯´æ˜ï¼š</strong>æ ¸å¿ƒåœ¨äºä½¿ç”¨ extends è¡¨æ˜ç»§æ‰¿è‡ªå“ªä¸ªçˆ¶ç±»ï¼Œå¹¶ä¸”åœ¨å­ç±»æ„é€ å‡½æ•°ä¸­å¿…é¡»è°ƒç”¨ superã€‚<br>class çš„æœ¬è´¨è¿˜æ˜¯å‡½æ•°ï¼Œè¿™ç§è¡¨è¾¾ä¸è¿‡æ˜¯ä¸€ç§è¯­æ³•ç³–ã€‚</p>\n<p>è¿™é‡Œå°±ä¸å±•å¼€äº†.</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"æ¢ç©¶\"><a href=\"#æ¢ç©¶\" class=\"headerlink\" title=\"æ¢ç©¶\"></a>æ¢ç©¶</h2><p>æˆ‘è§‰å¾—å­¦ä¹ ä¸€ä¸ªä¸œè¥¿æœ€é‡è¦çš„æ˜¯ææ‡‚ä¸‰æ ·ä¸œè¥¿</p>\n<p>What/How/Why</p>\n<h3 id=\"What\"><a href=\"#What\" class=\"headerlink\" title=\"What\"></a>What</h3><p>ä»€ä¹ˆæ˜¯åŸå‹?ä»€ä¹ˆæ˜¯åŸå‹é“¾?ä»€ä¹ˆæ˜¯ç»§æ‰¿?</p>\n<h4 id=\"åŸå‹\"><a href=\"#åŸå‹\" class=\"headerlink\" title=\"åŸå‹\"></a>åŸå‹</h4><p>åœ¨JavaScriptä¸­ï¼Œ<strong>åŸå‹ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé€šè¿‡åŸå‹å¯ä»¥å®ç°å¯¹è±¡çš„å±æ€§ç»§æ‰¿ï¼Œ</strong>JavaScriptçš„å¯¹è±¡ä¸­éƒ½åŒ…å«äº†ä¸€ä¸ªâ€ [[Prototype]]â€å†…éƒ¨å±æ€§ï¼Œè¿™ä¸ªå±æ€§æ‰€å¯¹åº”çš„å°±æ˜¯è¯¥å¯¹è±¡çš„åŸå‹ã€‚</p>\n<p>â€œ[[Prototype]]â€ä½œä¸ºå¯¹è±¡çš„å†…éƒ¨å±æ€§ï¼Œæ˜¯ä¸èƒ½è¢«ç›´æ¥è®¿é—®çš„ã€‚æ‰€ä»¥ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹ä¸€ä¸ªå¯¹è±¡çš„åŸå‹ï¼ŒFirefoxå’ŒChromeä¸­æä¾›äº†â€<strong>proto</strong>â€œè¿™ä¸ª<strong>éæ ‡å‡†</strong>ï¼ˆä¸æ˜¯æ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒï¼‰çš„è®¿é—®å™¨ï¼ˆECMAå¼•å…¥äº†æ ‡å‡†å¯¹è±¡åŸå‹è®¿é—®å™¨â€Object.getPrototype(object)â€ï¼‰ã€‚</p>\n<p>ç”¨ä¸€å¥è¯æ¥æ¦‚æ‹¬å°±æ˜¯: åŸå‹æ˜¯ä¸€ä¸ªå±æ€§å¯ä»¥è¢«ç»§æ‰¿çš„å¯¹è±¡.åŸå‹ä¹Ÿå¯ä»¥æœ‰è‡ªå·±çš„åŸå‹.</p>\n<h4 id=\"åŸå‹é“¾\"><a href=\"#åŸå‹é“¾\" class=\"headerlink\" title=\"åŸå‹é“¾\"></a>åŸå‹é“¾</h4><p>åŸå‹ä¹Ÿå¯ä»¥æœ‰è‡ªå·±çš„åŸå‹, è€Œä¸€ä¸ªä¸ªåŸå‹é€šè¿‡prototypeé“¾æ¥èµ·æ¥çš„å°±å«åšåŸå‹é“¾</p>\n<h4 id=\"ç»§æ‰¿\"><a href=\"#ç»§æ‰¿\" class=\"headerlink\" title=\"ç»§æ‰¿\"></a>ç»§æ‰¿</h4><p>å„¿å­å¯ä»¥é€šè¿‡ç»§æ‰¿è·å¾—çˆ¶äº²çš„å±æ€§æˆ–è€…æ–¹æ³•; </p>\n<h3 id=\"why\"><a href=\"#why\" class=\"headerlink\" title=\"why\"></a>why</h3><p>ä¸ºä»€ä¹ˆä¼šæœ‰åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿?</p>\n<p>æ‘˜è‡ªJavaScripté«˜çº§ç¨‹åºè®¾è®¡:</p>\n<blockquote>\n<p>ç»§æ‰¿æ˜¯OOè¯­è¨€ä¸­çš„ä¸€ä¸ªæœ€ä¸ºäººæ´¥æ´¥ä¹é“çš„æ¦‚å¿µ.è®¸å¤šOOè¯­è¨€éƒ½æ”¯æŒä¸¤ç§ç»§æ‰¿æ–¹å¼: <strong>æ¥å£ç»§æ‰¿</strong> å’Œ <strong>å®ç°ç»§æ‰¿</strong> .æ¥å£ç»§æ‰¿åªç»§æ‰¿æ–¹æ³•ç­¾å,è€Œå®ç°ç»§æ‰¿åˆ™ç»§æ‰¿å®é™…çš„æ–¹æ³•.ç”±äºjsä¸­æ–¹æ³•æ²¡æœ‰ç­¾å,åœ¨ECMAScriptä¸­æ— æ³•å®ç°æ¥å£ç»§æ‰¿.ECMAScriptåªæ”¯æŒå®ç°ç»§æ‰¿,è€Œä¸”å…¶ <code>å®ç°ç»§æ‰¿</code> ä¸»è¦æ˜¯ä¾é åŸå‹é“¾æ¥å®ç°çš„.</p>\n</blockquote>\n<h3 id=\"How\"><a href=\"#How\" class=\"headerlink\" title=\"How\"></a>How</h3><h4 id=\"åŸå‹-1\"><a href=\"#åŸå‹-1\" class=\"headerlink\" title=\"åŸå‹\"></a>åŸå‹</h4><p>æ€ä¹ˆæ‰¾åˆ°åŸå‹?</p>\n<p>æˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨, æ‰“å¼€æ§åˆ¶å°(F12), å¯ä»¥ç›´æ¥è¾“å…¥ <code>const obj = {}</code>, æˆ‘ä»¬å°±å¯ä»¥æŠŠä»–ç›´æ¥ç‚¹å¼€.å‘ç°é‡Œé¢æœ‰ä¸€ä¸ª<code>__proto__</code> å…¶å®æˆ‘ä»¬è¾“å…¥çš„è¿™ä¸ªå¯¹è±¡, æ˜¯ä¸€ä¸ª<code>Object</code>æ„é€ å‡½æ•°çš„å®ä¾‹. æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ä¾‹çš„<code>__proto__</code>å±æ€§æ‰¾åˆ°ä»–çš„åŸå‹;</p>\n<h4 id=\"åŸå‹é“¾-1\"><a href=\"#åŸå‹é“¾-1\" class=\"headerlink\" title=\"åŸå‹é“¾\"></a>åŸå‹é“¾</h4><p>æ€ä¹ˆæ‰¾åˆ°åŸå‹é“¾?</p>\n<p>åœ¨æ‰¾ä¹‹å‰æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸ªåŸå‹ä¸æ„é€ å‡½æ•°ä¸å®ä¾‹ç›´æ¥çš„å…³ç³».</p>\n<p>å‡å®šæˆ‘ä»¬æœ‰ä¸€ä¸ªæ„é€ å‡½æ•° <code>function A(){}</code>, æˆ‘ä»¬ç§°ä»–ä¸ºA</p>\n<p>æˆ‘ä»¬æœ‰ä¸€ä¸ªå®ä¾‹B, ä»–æ˜¯è¿™æ ·æ¥çš„: <code>const B = new A()</code>, æˆ‘ä»¬ç§°ä»–ä¸ºB</p>\n<p>Açš„åŸå‹ä¸ºC</p>\n<p>æ¥ä¸‹é‡Œæˆ‘ä»¬å†™ä¸€ä¸ªç­‰å¼æ¥å¾ˆå¥½çš„å±•ç¤ºä»–ä»¬ä¹‹é—´çš„å…³ç³»</p>\n<p>A = prototype =&gt; C = construct =&gt; A = new =&gt; B = <code>__proto__</code> =&gt; C</p>\n<p>è§£é‡Šä¸€ä¸‹: Aæœ‰ä¸€ä¸ªå±æ€§<code>prototype</code> æŒ‡å‘Açš„åŸå‹ C, è€ŒCçš„å±æ€§<code>construct</code>æŒ‡å‘A, Aé€šè¿‡newæ–¹æ³•å¯ä»¥åˆ›å»ºå®ä¾‹B, è€ŒBæœ‰ä¸€ä¸ªå±æ€§<code>__proto__</code>æŒ‡å‘äº†C(Açš„åŸå‹)</p>\n<p>OK, ç†è§£å®Œä¸Šé¢çš„ä¸œè¥¿ä¹‹å, æˆ‘ä»¬å†åŠ ä¸€ä¸ªçŸ¥è¯†ç‚¹, Açš„åŸå‹C, ä¹Ÿæ˜¯Cçš„åŸå‹çš„ä¸€ä¸ªå®ä¾‹.</p>\n<p>å…ˆåˆ«æ‡‚æ²¡æ‡‚, æˆ‘ä»¬çœ‹ä¸€ä¸‹å®æˆ˜.</p>\n<p>ä¹¦æ¥ä¸Šæ–‡ä¸­çš„åŸå‹, æˆ‘å†å¤åˆ¶ä¸€ä¸‹, æ–¹ä¾¿é˜…è¯»</p>\n<blockquote>\n<p>æˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨, æ‰“å¼€æ§åˆ¶å°(F12), å¯ä»¥ç›´æ¥è¾“å…¥ <code>const obj = {}</code>, æˆ‘ä»¬å°±å¯ä»¥æŠŠä»–ç›´æ¥ç‚¹å¼€.å‘ç°é‡Œé¢æœ‰ä¸€ä¸ª<code>__proto__</code> å…¶å®æˆ‘ä»¬è¾“å…¥çš„è¿™ä¸ªå¯¹è±¡, æ˜¯ä¸€ä¸ª<code>Object</code>æ„é€ å‡½æ•°çš„å®ä¾‹. æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ä¾‹çš„<code>__proto__</code>å±æ€§æ‰¾åˆ°ä»–çš„åŸå‹;</p>\n</blockquote>\n<p>æˆ‘ä»¬æ¥ç€ç‚¹å¼€<code>__proto__</code>,å‘ç°é‡Œé¢æœ‰ä¸€å †â€èŠ±é‡Œèƒ¡å“¨â€çš„ä¸œè¥¿, æˆ‘ä»¬æ‰¾åˆ°äº†å…¶ä¸­ä¸€ä¸ªå¾ˆçœ¼ç†Ÿçš„â€é“ä»”â€ -&gt; <code>construct</code>;</p>\n<p>æ ¹æ®ä¹‹å‰çš„äº†è§£</p>\n<blockquote>\n<p>â€‹    A = prototype =&gt; C = construct =&gt; A = new =&gt; B = <code>__proto__</code> =&gt; C</p>\n</blockquote>\n<p>æˆ‘ä»¬ç‚¹å¼€çš„è¿™ä¸ª<code>construct</code>å…¶å®é‚£ä¸ªç©ºå¯¹è±¡çš„æ„é€ å‡½æ•°<code>Object</code>, é‚£ä¹ˆä»–åº”è¯¥æœ‰ä¸€ä¸ª<code>prototype</code>æŒ‡å‘äº†ä»–çš„åŸå‹.</p>\n<p>æˆ‘ä»¬æ‰¾æ‰¾, ç¡®å®å‘ç°äº†æœ‰è¿™ä¹ˆä¸€ä¸ªå±æ€§(<code>prototype</code>); é‚£ä¹ˆç‚¹å¼€ä¹‹ååº”è¯¥ä¸æœ€æ—©çš„ç©ºå¯¹è±¡çš„<code>__proto__</code>çš„å†…å®¹ä¸€è‡´. æ ¹æ®ç­‰å¼å¯å¾—;</p>\n<h5 id=\"æ€»ç»“ä¸€ä¸‹\"><a href=\"#æ€»ç»“ä¸€ä¸‹\" class=\"headerlink\" title=\"æ€»ç»“ä¸€ä¸‹\"></a>æ€»ç»“ä¸€ä¸‹</h5><p>å¯¹è±¡çš„ <code>__proto__</code> å±æ€§æŒ‡å‘åŸå‹ï¼Œ <code>__proto__</code> å°†å¯¹è±¡å’ŒåŸå‹è¿æ¥èµ·æ¥ç»„æˆäº†åŸå‹é“¾</p>\n<p>æ¥ä¸‹æ¥è¿›å…¥æˆ‘ä»¬çš„é‡å¤´æˆç»§æ‰¿</p>\n<h3 id=\"ç»§æ‰¿-1\"><a href=\"#ç»§æ‰¿-1\" class=\"headerlink\" title=\"ç»§æ‰¿\"></a>ç»§æ‰¿</h3><p>å…¶å®ç»§æ‰¿åˆåˆ†ä¸ºå¥½å¤šç§: åŸå‹é“¾ç»§æ‰¿, æ„é€ å‡½æ•°ç»§æ‰¿, ç»„åˆç»§æ‰¿å’Œå¯„ç”Ÿç»„åˆç»§æ‰¿;</p>\n<h4 id=\"åŸå‹é“¾ç»§æ‰¿\"><a href=\"#åŸå‹é“¾ç»§æ‰¿\" class=\"headerlink\" title=\"åŸå‹é“¾ç»§æ‰¿\"></a>åŸå‹é“¾ç»§æ‰¿</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">A</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">this</span>.array = [<span class=\"string\">\"a\"</span>, <span class=\"string\">\"b\"</span>, <span class=\"string\">\"c\"</span>];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">B</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//ç»§æ‰¿äº† A</span></span><br><span class=\"line\">B.prototype = <span class=\"keyword\">new</span> A()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> b1 = <span class=\"keyword\">new</span> B()</span><br><span class=\"line\">b1.array.push(<span class=\"string\">\"d\"</span>); </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b1.array); <span class=\"comment\">//\"a,b,c,d\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> b2 = <span class=\"keyword\">new</span> B(); </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b2.array); <span class=\"comment\">//\"a,b,c,d\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">b2.array.push(<span class=\"string\">\"e\"</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b2.array) <span class=\"comment\">//\"a,b,c,d,e\"</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b1.array) <span class=\"comment\">//\"a,b,c,d,e\"</span></span><br></pre></td></tr></table></figure>\n\n<p>æˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªæ„é€ å‡½æ•°, Aå’ŒB; æ ¹æ®ä¹‹å‰çš„çŸ¥è¯†, æˆ‘ä»¬è®©Bçš„åŸå‹æŒ‡å‘äº†æ„é€ å‡½æ•°Aåˆ›é€ å‡ºæ¥çš„å®ä¾‹(<code>new A()</code>); ç„¶åæˆ‘ä»¬ç”¨æ„é€ å‡½æ•°Båˆ›é€ äº†å®ä¾‹b1,  å¾€ ç»§æ‰¿æ¥çš„å±æ€§array å¢åŠ ä¸€ä¸ªå­—ç¬¦ä¸²â€dâ€; ç„¶åæˆ‘ä»¬è¾“å‡ºä¸€ä¸‹, æŒ‰ç…§æˆ‘ä»¬çš„é€¾æœŸçš„å¤šäº†ä¸€ä¸ªâ€eâ€çš„æƒ…å†µä¸‹, è¿˜æœ‰â€a,b,câ€;</p>\n<p>æ¥ä¸‹æ¥å°±æœ‰äº›é—®é¢˜äº†. æˆ‘ä»¬æŒ‰ç…§æƒ¯ä¾‹, é€šè¿‡æ„é€ å‡½æ•°B, åˆ›é€ äº†b2. b2ç¡®å®ä¹Ÿæœ‰äº†ç»§æ‰¿æ¥çš„å±æ€§â€arrayâ€, å¯æ˜¯è¿™ä¸ªarrayå¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„åˆå§‹çš„<code>[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;]</code>; æˆ‘ä»¬æ”¾å¼ƒæ¢ç©¶, ç»§ç»­å¾€è¿™ä¸ª<code>array</code>é‡Œé¢å¢åŠ ä¸€ä¸ª<code>e</code>, è¾“å‡ºä¸€ä¸‹<code>b1</code>çš„å±æ€§<code>array</code>. ç¡®å®æ˜¯å¯ä»¥å¢åŠ è¿™ä¸ª<code>e</code>;</p>\n<p>å¯æ˜¯!</p>\n<p>å½“æˆ‘ä»¬è¾“å‡º<code>b1.array</code>æ—¶, å‘ç°b1ä¹Ÿè¢«æ”¹äº†, å’Œä¹‹å‰è¯¡å¼‚çš„b2å¤šå‡ºä¸€ä¸ª<code>d</code>ä¸€æ ·.</p>\n<p>æ¢ç©¶å‘ç°è¿™ä¸ªç”±äºæˆ‘ä»¬ç”¨çš„æ˜¯å¼•ç”¨ç±»å‹, æ‰€ä»¥ä»–ä»¬å­˜å‚¨çš„æ˜¯æŒ‡å‘åŒä¸€ä¸ªå†…å­˜çš„å†…å­˜åœ°å€; æ‰€ä»¥æ‰ä¼šå‘ç”Ÿè¿™äº›é—®é¢˜. è¿™ä¹Ÿæš´éœ²äº†åŸå‹é“¾ç»§æ‰¿æ—¶çš„ä¸€ä¸ªé—®é¢˜.å¼•ç”¨ç±»å‹å¸¦æ¥çš„æ¯›ç—…;</p>\n<p>å…¶æ¬¡, æˆ‘ä»¬å‘ç°æˆ‘ä»¬çš„Bçš„åŸå‹æŒ‡å‘Açš„æ„é€ å‡½æ•°æ—¶ä¸èƒ½ä¼ é€’å‚æ•°, è¿™ä¹Ÿçš„è¯æœ‰ç‚¹å‘†æ¿</p>\n<p>ç»¼ä¸ŠåŸå‹é“¾çš„ç»§æ‰¿åœ¨æ—¥å¸¸ä¸­æ˜¯å¾ˆå°‘ç”¨åˆ°çš„</p>\n<h5 id=\"ä¼˜ç‚¹\"><a href=\"#ä¼˜ç‚¹\" class=\"headerlink\" title=\"ä¼˜ç‚¹\"></a>ä¼˜ç‚¹</h5><p>â€‹    å­ç±»å¯ä»¥é€šè¿‡åŸå‹é“¾çš„æŸ¥æ‰¾ï¼Œå®ç°çˆ¶ç±»çš„å±æ€§å…¬ç”¨ä¸å­ç±»çš„å®ä¾‹</p>\n<h5 id=\"ç¼ºç‚¹\"><a href=\"#ç¼ºç‚¹\" class=\"headerlink\" title=\"ç¼ºç‚¹\"></a>ç¼ºç‚¹</h5><ul>\n<li>ä¸€äº›å¼•ç”¨æ•°æ®æ“ä½œçš„æ—¶å€™ä¼šå‡ºé—®é¢˜ï¼Œä¸¤ä¸ªå®ä¾‹ä¼šå…¬ç”¨ç»§æ‰¿å®ä¾‹çš„å¼•ç”¨æ•°æ®ç±»</li>\n<li>è°¨æ…å®šä¹‰æ–¹æ³•ï¼Œä»¥å…å®šä¹‰æ–¹æ³•ä¹Ÿç»§æ‰¿å¯¹è±¡åŸå‹çš„æ–¹æ³•é‡å</li>\n<li>æ— æ³•ç›´æ¥ç»™çˆ¶çº§æ„é€ å‡½æ•°ä½¿ç”¨å‚æ•°</li>\n</ul>\n<h4 id=\"æ„é€ å‡½æ•°ç»§æ‰¿\"><a href=\"#æ„é€ å‡½æ•°ç»§æ‰¿\" class=\"headerlink\" title=\"æ„é€ å‡½æ•°ç»§æ‰¿\"></a>æ„é€ å‡½æ•°ç»§æ‰¿</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">A</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">this</span>.array = [<span class=\"string\">\"a\"</span>, <span class=\"string\">\"b\"</span>, <span class=\"string\">\"c\"</span>];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">B</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  A.call(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//ç»§æ‰¿äº† A</span></span><br><span class=\"line\">B.prototype = <span class=\"keyword\">new</span> A()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> b1 = <span class=\"keyword\">new</span> B()</span><br><span class=\"line\">b1.array.push(<span class=\"string\">\"d\"</span>); </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b1.array); <span class=\"comment\">//\"a,b,c,d\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> b2 = <span class=\"keyword\">new</span> B(); </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b2.array); <span class=\"comment\">//\"a,b,c\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">b2.array.push(<span class=\"string\">\"e\"</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b2.array) <span class=\"comment\">//\"a,b,c,e\"</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b1.array) <span class=\"comment\">//\"a,b,c,d\"</span></span><br></pre></td></tr></table></figure>\n\n<p>æˆ‘ä»¬å¥‡è¿¹èˆ¬çš„å‘ç°, æ„é€ å‡½æ•°çš„ç»§æ‰¿è§£å†³äº†æˆ‘ä»¬ä¹‹å‰å‘ç°çš„JavaScriptå¼•ç”¨é—®é¢˜.é‚£å‡½æ•°ä¼ å‚çš„é—®â€¦</p>\n<p>å•ª!</p>\n<p>åœ, æˆ‘ä»¬ç°åœ¨æ¥ä¼ é€’ä¸€ä¸‹å‚æ•°!</p>\n<p>æˆ‘ä»¬æŠŠä¸Šé¢çš„ä¾‹å­ä¿®æ”¹ä¸€ä¸‹</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">A</span>(<span class=\"params\">name</span>)</span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">this</span>.array = [<span class=\"string\">\"a\"</span>, <span class=\"string\">\"b\"</span>, <span class=\"string\">\"c\"</span>];</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.name = name</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">B</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  A.call(<span class=\"keyword\">this</span>, <span class=\"string\">'B'</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//ç»§æ‰¿äº† A</span></span><br><span class=\"line\">B.prototype = <span class=\"keyword\">new</span> A()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> b1 = <span class=\"keyword\">new</span> B()</span><br><span class=\"line\">b1.array.push(<span class=\"string\">\"d\"</span>); </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b1.array); <span class=\"comment\">//\"a,b,c,d\"</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b1.name); <span class=\"comment\">//\"B\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> b2 = <span class=\"keyword\">new</span> B(); </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b2.array); <span class=\"comment\">//\"a,b,c\"</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b1.name); <span class=\"comment\">//\"B\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">b2.array.push(<span class=\"string\">\"e\"</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b2.array) <span class=\"comment\">//\"a,b,c,e\"</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b1.array) <span class=\"comment\">//\"a,b,c,d\"</span></span><br></pre></td></tr></table></figure>\n\n<p>è¿™æ ·çš„è¯æˆ‘ä»¬è§£å†³äº†åŸå‹é“¾ç»§æ‰¿çš„ä¸¤ä¸ªé—®é¢˜(1.æ— æ³•ä¼ å‚, 2.jså¼•ç”¨é—®é¢˜);</p>\n<p>è¯¥ä¸ä¼šæœ‰äººè®¤ä¸ºè¿™æ ·å°±å¾ˆå®Œç¾äº†å§?ä¸ä¼šå§!ä¸ä¼šå§!</p>\n<p>æˆ‘ä»¬å†·é™ä¸‹æ¥æƒ³æƒ³çœ‹, å…¶å®è¿™ä¸ªä¼ é€’å‚æ•°æ˜¯å‡ ä¹ç®—æ˜¯å†™æ­»çš„. è¿˜ä¸å¦‚ç›´æ¥åœ¨Aé‡Œé¢ç›´æ¥å†™æ­»å¥½äº†, æ ¹æœ¬å°±æ— æ³•å¤ç”¨å˜›; è€Œä¸”ï¼Œåœ¨è¶…ç±»å‹çš„åŸå‹ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œå¯¹å­ç±»å‹è€Œè¨€ä¹Ÿæ˜¯ä¸å¯è§çš„ï¼Œç»“ æœæ‰€æœ‰ç±»å‹éƒ½åªèƒ½ä½¿ç”¨æ„é€ å‡½æ•°æ¨¡å¼ã€‚è€ƒè™‘åˆ°è¿™äº›é—®é¢˜ï¼Œå€Ÿç”¨æ„é€ å‡½æ•°çš„æŠ€æœ¯ä¹Ÿæ˜¯å¾ˆå°‘å•ç‹¬ä½¿ç”¨çš„ã€‚</p>\n<h5 id=\"ä¼˜ç‚¹-1\"><a href=\"#ä¼˜ç‚¹-1\" class=\"headerlink\" title=\"ä¼˜ç‚¹\"></a>ä¼˜ç‚¹</h5><ul>\n<li>è§£å†³äº†åŸå‹é“¾ç»§æ‰¿çš„ å¼•ç”¨ç±»å‹æ“ä½œé—®é¢˜</li>\n<li>è§£å†³äº†çˆ¶ç±»ä¼ é€’å‚æ•°é—®é¢˜</li>\n</ul>\n<h5 id=\"ç¼ºç‚¹-1\"><a href=\"#ç¼ºç‚¹-1\" class=\"headerlink\" title=\"ç¼ºç‚¹\"></a>ç¼ºç‚¹</h5><ul>\n<li>ä»…ä»…ä½¿ç”¨å€Ÿç”¨æ„é€ å‡½æ•°æ¨¡å¼ç»§æ‰¿ï¼Œæ— æ³•æ‘†è„±å¤Ÿç€å‡½æ•°ã€‚æ–¹æ³•åœ¨æ„é€ å‡½æ•°ä¸­å®šä¹‰å¤ç”¨ä¸å¯è°ˆ</li>\n<li>å¯¹äºè¶…ç±»çš„åŸå‹å®šä¹‰çš„æ–¹æ³•å¯¹äºå­ç±»æ˜¯ä¸å¯ä½¿ç”¨çš„ï¼Œå­ç±»çš„å®ä¾‹åªæ˜¯å¾—åˆ°äº†çˆ¶ç±»çš„thisç»‘å®šçš„å±æ€§ è€ƒè™‘åˆ°è¿™äº›ç¼ºç‚¹ï¼Œå•ç‹¬ä½¿ç”¨å€Ÿç”¨æ„é€ å‡½æ•°ä¹Ÿæ˜¯å¾ˆå°‘ä½¿ç”¨çš„</li>\n</ul>\n<h4 id=\"ç»„åˆç»§æ‰¿\"><a href=\"#ç»„åˆç»§æ‰¿\" class=\"headerlink\" title=\"ç»„åˆç»§æ‰¿\"></a>ç»„åˆç»§æ‰¿</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">A</span>(<span class=\"params\">name</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.name = name</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.array = [<span class=\"string\">'1'</span>, <span class=\"string\">'2'</span>, <span class=\"string\">'3'</span>]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">A.prototype.sayName = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>)</span>&#123;<span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name)&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">B</span>(<span class=\"params\">name, age</span>)</span>&#123;</span><br><span class=\"line\">  A.call(<span class=\"keyword\">this</span>, name);</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.age = age;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">B.prototype = <span class=\"keyword\">new</span> A();</span><br><span class=\"line\">B.prototype.constructor = A; <span class=\"comment\">// å› ä¸ºåŸå‹é“¾ç»§æ‰¿ï¼Œä¼šæŠŠconstructoræŒ‡å‘æ”¹å˜ï¼Œæ‰€ä»¥è¦é‡æ–°æŒ‡å›è‡ªèº«</span></span><br><span class=\"line\">B.prototype.sayAge = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>)</span>&#123;<span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.age)&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"keyword\">new</span> B(<span class=\"string\">'a'</span>, <span class=\"number\">10</span>)</span><br><span class=\"line\">a.array.push(<span class=\"string\">'a'</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a.array) <span class=\"comment\">// [\"1\", \"2\", \"3\", \"a\"]</span></span><br><span class=\"line\">a.sayName() <span class=\"comment\">// 'a'</span></span><br><span class=\"line\">a.sayAge() <span class=\"comment\">// 10</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"keyword\">new</span> B(<span class=\"string\">'b'</span>, <span class=\"number\">20</span>)</span><br><span class=\"line\">b.array.push(<span class=\"string\">'b'</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b.array) <span class=\"comment\">// [\"1\", \"2\", \"3\", \"b\"]</span></span><br><span class=\"line\">b.sayName()<span class=\"comment\">// 'b'</span></span><br><span class=\"line\">b.sayAge() <span class=\"comment\">// 20</span></span><br></pre></td></tr></table></figure>\n\n<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­, æ„é€ å‡½æ•°Aæœ‰ä¸¤ä¸ªå†…ç½®å±æ€§<code>name</code>å’Œ<code>array</code>. Açš„åŸå‹å®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•<code>sayName</code>; æ„é€ å‡½æ•°Båœ¨è°ƒç”¨Açš„æ„é€ å‡½æ•°æ—¶ä¼ å…¥äº†ä¸€ä¸ªå‚æ•°<code>name</code>, ç„¶ååˆç»™Bçš„åŸå‹ä¸Šå®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•<code>sayAge</code>. è¿™æ ·ä¸€æ¥, å°±å¯ä»¥è®©ä¸¤ä¸ªBçš„å®ä¾‹åˆ†åˆ«æ‹¥æœ‰è‡ªå·±çš„å±æ€§, å½“ç„¶ä¹ŸåŒ…æ‹¬äº†array, è¿˜å¯ä»¥æ‹¥æœ‰ç›¸åŒçš„æ–¹æ³•.</p>\n<p>ç»„åˆç»§æ‰¿é¿å…äº†åŸå‹é“¾å’Œå€Ÿç”¨æ„é€ å‡½æ•°çš„ç¼ºé™·ï¼Œèåˆäº†å®ƒä»¬çš„ä¼˜ç‚¹ï¼Œæˆä¸º JavaScript ä¸­æœ€å¸¸ç”¨çš„ç»§ æ‰¿æ¨¡å¼ã€‚è€Œä¸”(å…³é”®)ï¼Œ<code>instanceof</code> å’Œ <code>isPrototypeOf()</code>ä¹Ÿèƒ½å¤Ÿç”¨äºè¯†åˆ«åŸºäºç»„åˆç»§æ‰¿åˆ›å»ºçš„å¯¹è±¡ã€‚</p>\n<h5 id=\"ä¼˜ç‚¹-2\"><a href=\"#ä¼˜ç‚¹-2\" class=\"headerlink\" title=\"ä¼˜ç‚¹\"></a>ä¼˜ç‚¹</h5><ul>\n<li>è§£å†³äº†åŸå‹é“¾ç»§æ‰¿å¼•ç”¨ç±»å‹çš„å®ä¾‹æ“ä½œå¯¼è‡´å¼•ç”¨æ”¹å˜</li>\n<li>è§£å†³äº†å€Ÿæ„é€ å‡½æ•°ç»§æ‰¿æ–¹å¼çš„ï¼Œçˆ¶ç±»åŸå‹å­ç±»å®ä¾‹å¯ä»¥ä½¿ç”¨</li>\n</ul>\n<h5 id=\"ç¼ºç‚¹-2\"><a href=\"#ç¼ºç‚¹-2\" class=\"headerlink\" title=\"ç¼ºç‚¹\"></a>ç¼ºç‚¹</h5><p>çˆ¶ç±»çš„æ„é€ å‡½æ•°è¢«å®ä¾‹æ¢äº†ä¸¤æ¬¡ * å®ä¾‹ä¼šæœ‰çˆ¶ç±»çš„æ„é€ å‡½æ•°çš„ä¸€äº›thiså±æ€§ã€å­ç±»çš„æ„é€ å‡½æ•°ï¼ˆprototypeï¼‰ä¸Šä¹Ÿæœ‰ä¸€ä»½å®ä¾‹çš„ä¸Šæœ‰çš„å±æ€§</p>\n<h4 id=\"åŸå‹å¼ç»§æ‰¿\"><a href=\"#åŸå‹å¼ç»§æ‰¿\" class=\"headerlink\" title=\"åŸå‹å¼ç»§æ‰¿\"></a>åŸå‹å¼ç»§æ‰¿</h4><p>é“æ ¼æ‹‰æ–¯Â·å…‹ç½—å…‹ç¦å¾·åœ¨ 2006 å¹´å†™äº†ä¸€ç¯‡æ–‡ç« ï¼Œé¢˜ä¸º Prototypal Inheritance in JavaScript (JavaScript 10 ä¸­çš„åŸå‹å¼ç»§æ‰¿)ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œä»–ä»‹ç»äº†ä¸€ç§å®ç°ç»§æ‰¿çš„æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•å¹¶æ²¡æœ‰ä½¿ç”¨ä¸¥æ ¼æ„ä¹‰ä¸Šçš„ æ„é€ å‡½æ•°ã€‚ä»–çš„æƒ³æ³•æ˜¯å€ŸåŠ©åŸå‹å¯ä»¥åŸºäºå·²æœ‰çš„å¯¹è±¡åˆ›å»ºæ–°å¯¹è±¡ï¼ŒåŒæ—¶è¿˜ä¸å¿…å› æ­¤åˆ›å»ºè‡ªå®šä¹‰ç±»å‹ã€‚ä¸º äº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œä»–ç»™å‡ºäº†å¦‚ä¸‹å‡½æ•°ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">object</span>(<span class=\"params\">o</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">F</span>(<span class=\"params\"></span>)</span>&#123;&#125;</span><br><span class=\"line\">  F.prototype = o</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> F</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>çœ‹èµ·æ¥éå¸¸ç®€å•</p>\n<p>å…ˆåœ¨<code>object</code>å‡½æ•°å†…éƒ¨åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„æ„é€ å‡½æ•°<code>F</code>, ç„¶åå°†ä¼ å…¥çš„è¿™ä¸ªå¯¹è±¡<code>o</code>ä½œä¸ºè¿™ä¸ªä¸´æ—¶æ„é€ å‡½æ•°çš„åŸå‹, æœ€åè¿”å›è¿™ä¸ªä¸´æ—¶æ„é€ å‡½æ•°çš„å®ä¾‹. </p>\n<p>ç®€å•æ¥è¯´å°±æ˜¯<code>object</code>å¯¹ä¼ å…¥çš„å¯¹è±¡è¿›è¡Œäº†æµ…å¤åˆ¶.</p>\n<p>æµ…æ‹·è´å’Œæ·±æ‹·è´å¯ä»¥è‡ªè¡ŒGoogleä¸€ä¸‹, è¿™ç®—ä¸€ä¸ªé‡è¦çš„çŸ¥è¯†ç‚¹.</p>\n<p>ä¸¾ä¸ªğŸŒ°</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">object</span>(<span class=\"params\">o</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">F</span>(<span class=\"params\"></span>)</span>&#123;&#125;</span><br><span class=\"line\">  F.prototype = o</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> F</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">'a'</span>,</span><br><span class=\"line\">  array: [<span class=\"string\">'1'</span>, <span class=\"string\">'2'</span>],</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> qq = object(a)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(qq.name)</span><br><span class=\"line\">qq.array.push(<span class=\"string\">'qq'</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(qq.array)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> ww = object(a)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(ww.name)</span><br><span class=\"line\">ww.array.push(<span class=\"string\">'ww'</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(ww.array)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(qq.array)</span><br></pre></td></tr></table></figure>\n\n<p>æœ‰æ²¡æœ‰ä¼¼æ›¾ç›¸è¯†çš„æ„Ÿè§‰â€¦.åŸå‹é“¾ç»§æ‰¿çš„è€æ¯›ç—…æ¥äº†â€¦</p>\n<p>ä¸è¿‡ä»–ä¹Ÿä¸æ˜¯æ²¡æœ‰ä¼˜ç‚¹çš„.</p>\n<p>åœ¨æ²¡æœ‰å¿…è¦å…´å¸ˆåŠ¨ä¼—åœ°åˆ›å»ºæ„é€ å‡½æ•°ï¼Œè€Œåªæƒ³è®©ä¸€ä¸ªå¯¹è±¡ä¸å¦ä¸€ä¸ªå¯¹è±¡ä¿æŒç±»ä¼¼çš„æƒ…å†µä¸‹ï¼ŒåŸå‹å¼ ç»§æ‰¿æ˜¯å®Œå…¨å¯ä»¥èƒœä»»çš„ã€‚</p>\n<blockquote>\n<p>ECMAScript 5 é€šè¿‡æ–°å¢ Object.create()æ–¹æ³•è§„èŒƒåŒ–äº†åŸå‹å¼ç»§æ‰¿ã€‚è¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°:ä¸€ ä¸ªç”¨ä½œæ–°å¯¹è±¡åŸå‹çš„å¯¹è±¡å’Œ(å¯é€‰çš„)ä¸€ä¸ªä¸ºæ–°å¯¹è±¡å®šä¹‰é¢å¤–å±æ€§çš„å¯¹è±¡ã€‚åœ¨ä¼ å…¥ä¸€ä¸ªå‚æ•°çš„æƒ…å†µä¸‹ï¼Œ Object.create()ä¸ object()æ–¹æ³•çš„è¡Œä¸ºç›¸åŒã€‚æœ‰å…´è¶£çš„è¯å¯ä»¥è‡ªå·±äº†è§£ä¸€ä¸‹</p>\n</blockquote>\n<h5 id=\"ä¼˜ç‚¹-3\"><a href=\"#ä¼˜ç‚¹-3\" class=\"headerlink\" title=\"ä¼˜ç‚¹\"></a>ä¼˜ç‚¹</h5><p>å†ä¸ç”¨åˆ›å»ºæ„é€ å‡½æ•°çš„æƒ…å†µä¸‹ï¼Œå®ç°äº†åŸå‹é“¾ç»§æ‰¿ï¼Œä»£ç é‡å‡å°‘ä¸€éƒ¨åˆ†</p>\n<h5 id=\"ç¼ºç‚¹-3\"><a href=\"#ç¼ºç‚¹-3\" class=\"headerlink\" title=\"ç¼ºç‚¹\"></a>ç¼ºç‚¹</h5><ul>\n<li>ä¸€äº›å¼•ç”¨æ•°æ®æ“ä½œçš„æ—¶å€™ä¼šå‡ºé—®é¢˜ï¼Œä¸¤ä¸ªå®ä¾‹ä¼šå…¬ç”¨ç»§æ‰¿å®ä¾‹çš„å¼•ç”¨æ•°æ®ç±»</li>\n<li>è°¨æ…å®šä¹‰æ–¹æ³•ï¼Œä»¥å…å®šä¹‰æ–¹æ³•ä¹Ÿç»§æ‰¿å¯¹è±¡åŸå‹çš„æ–¹æ³•é‡å</li>\n<li>æ— æ³•ç›´æ¥ç»™çˆ¶çº§æ„é€ å‡½æ•°ä½¿ç”¨å‚æ•°</li>\n</ul>\n<h4 id=\"å¯„ç”Ÿç»§æ‰¿\"><a href=\"#å¯„ç”Ÿç»§æ‰¿\" class=\"headerlink\" title=\"å¯„ç”Ÿç»§æ‰¿\"></a>å¯„ç”Ÿç»§æ‰¿</h4><p>å¯„ç”Ÿç»§æ‰¿å’ŒåŸå‹å¼ç»§æ‰¿ç´§å¯†ç›¸å…³, åŒæ ·ä¹Ÿæ˜¯ç”±å…‹ç½—å…‹ç¦å¾·æ¨è€Œå¹¿ ä¹‹çš„.å¯„ç”Ÿå¼ç»§æ‰¿çš„æ€è·¯ä¸å¯„ç”Ÿæ„é€ å‡½æ•°å’Œå·¥å‚æ¨¡å¼ç±»ä¼¼ï¼Œå³åˆ›å»ºä¸€ä¸ªä»…ç”¨äºå°è£…ç»§æ‰¿è¿‡ç¨‹çš„å‡½æ•°ï¼Œè¯¥ å‡½æ•°åœ¨å†…éƒ¨ä»¥æŸç§æ–¹å¼æ¥å¢å¼ºå¯¹è±¡ï¼Œæœ€åå†åƒçœŸåœ°æ˜¯å®ƒåšäº†æ‰€æœ‰å·¥ä½œä¸€æ ·è¿”å›å¯¹è±¡ã€‚ä»¥ä¸‹ä»£ç ç¤ºèŒƒäº†å¯„ ç”Ÿå¼ç»§æ‰¿æ¨¡å¼ã€‚</p>\n<p>ä¸Šä»£ç </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">object</span>(<span class=\"params\">o</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">F</span>(<span class=\"params\"></span>)</span>&#123;&#125;</span><br><span class=\"line\">  F.prototype = o</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> F</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createAnother</span>(<span class=\"params\">original</span>)</span>&#123; </span><br><span class=\"line\">  <span class=\"keyword\">var</span> clone=object(original); <span class=\"comment\">//é€šè¿‡è°ƒç”¨å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡</span></span><br><span class=\"line\">  clone.sayHi = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123; <span class=\"comment\">//ä»¥æŸç§æ–¹å¼æ¥å¢å¼ºè¿™ä¸ªå¯¹è±¡</span></span><br><span class=\"line\">    alert(<span class=\"string\">\"hi\"</span>);</span><br><span class=\"line\">\t&#125;;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> clone;<span class=\"comment\">//è¿”å›è¿™ä¸ªå¯¹è±¡</span></span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n\n<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒcreateAnother()å‡½æ•°æ¥æ”¶äº†ä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯å°†è¦ä½œä¸ºæ–°å¯¹è±¡åŸºç¡€çš„å¯¹è±¡ã€‚ç„¶ åï¼ŒæŠŠè¿™ä¸ªå¯¹è±¡(original)ä¼ é€’ç»™ object()å‡½æ•°ï¼Œå°†è¿”å›çš„ç»“æœèµ‹å€¼ç»™ cloneã€‚å†ä¸º clone å¯¹è±¡ æ·»åŠ ä¸€ä¸ªæ–°æ–¹æ³• sayHi()ï¼Œæœ€åè¿”å› clone å¯¹è±¡ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> person = &#123;</span><br><span class=\"line\">\tname: <span class=\"string\">\"Nicholas\"</span>,</span><br><span class=\"line\">\tfriends: [<span class=\"string\">\"Shelby\"</span>, <span class=\"string\">\"Court\"</span>, <span class=\"string\">\"Van\"</span>]</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> anotherPerson = createAnother(person); </span><br><span class=\"line\">anotherPerson.sayHi(); <span class=\"comment\">//\"hi\"</span></span><br></pre></td></tr></table></figure>\n\n<p>è¿™ä¸ªä¾‹å­ä¸­çš„ä»£ç åŸºäº person è¿”å›äº†ä¸€ä¸ªæ–°å¯¹è±¡â€”â€”anotherPersonã€‚æ–°å¯¹è±¡ä¸ä»…å…·æœ‰ person çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œè€Œä¸”è¿˜æœ‰è‡ªå·±çš„ sayHi()æ–¹æ³•ã€‚</p>\n<p>åœ¨ä¸»è¦è€ƒè™‘å¯¹è±¡è€Œä¸æ˜¯è‡ªå®šä¹‰ç±»å‹å’Œæ„é€ å‡½æ•°çš„æƒ…å†µä¸‹ï¼Œå¯„ç”Ÿå¼ç»§æ‰¿ä¹Ÿæ˜¯ä¸€ç§æœ‰ç”¨çš„æ¨¡å¼ã€‚å‰é¢ç¤º èŒƒç»§æ‰¿æ¨¡å¼æ—¶ä½¿ç”¨çš„ object()å‡½æ•°ä¸æ˜¯å¿…éœ€çš„;ä»»ä½•èƒ½å¤Ÿè¿”å›æ–°å¯¹è±¡çš„å‡½æ•°éƒ½é€‚ç”¨äºæ­¤æ¨¡å¼ã€‚</p>\n<blockquote>\n<p>ä½¿ç”¨å¯„ç”Ÿç»§æ‰¿, ç”±äºä¸èƒ½åšåˆ°å‡½æ•°å¤ç”¨è€Œé™ä½æ•ˆç‡, è¿™ç‚¹å’Œæ„é€ å‡½æ•°ç»§æ‰¿å¾ˆåƒ</p>\n</blockquote>\n<h5 id=\"ä¼˜ç‚¹-4\"><a href=\"#ä¼˜ç‚¹-4\" class=\"headerlink\" title=\"ä¼˜ç‚¹\"></a>ä¼˜ç‚¹</h5><ul>\n<li>å†ä¸ç”¨åˆ›å»ºæ„é€ å‡½æ•°çš„æƒ…å†µä¸‹ï¼Œå®ç°äº†åŸå‹é“¾ç»§æ‰¿ï¼Œä»£ç é‡å‡å°‘ä¸€éƒ¨åˆ†</li>\n<li>å¯ä»¥ç»™å¤‡ä»½çš„å¯¹è±¡æ·»åŠ ä¸€äº›å±æ€§</li>\n</ul>\n<h5 id=\"ç¼ºç‚¹-4\"><a href=\"#ç¼ºç‚¹-4\" class=\"headerlink\" title=\"ç¼ºç‚¹\"></a>ç¼ºç‚¹</h5><p>ç±»ä¼¼æ„é€ å‡½æ•°ä¸€æ ·ï¼Œåˆ›å»ºå¯„ç”Ÿçš„æ–¹æ³•éœ€è¦åœ¨cloneå¯¹è±¡ä¸Šé¢æ·»åŠ ä¸€äº›æƒ³è¦çš„å±æ€§ï¼Œè¿™äº›å±æ€§æ˜¯æ”¾åœ¨cloneä¸Šé¢çš„ä¸€äº›ç§æœ‰çš„å±æ€§</p>\n<h4 id=\"å¯„ç”Ÿç»„åˆç»§æ‰¿-ç»ˆææ–¹æ¡ˆ\"><a href=\"#å¯„ç”Ÿç»„åˆç»§æ‰¿-ç»ˆææ–¹æ¡ˆ\" class=\"headerlink\" title=\"å¯„ç”Ÿç»„åˆç»§æ‰¿(ç»ˆææ–¹æ¡ˆ\"></a>å¯„ç”Ÿç»„åˆç»§æ‰¿(ç»ˆææ–¹æ¡ˆ</h4><p>å‰é¢è¯´è¿‡ï¼Œç»„åˆç»§æ‰¿æ˜¯ JavaScript æœ€å¸¸ç”¨çš„ç»§æ‰¿æ¨¡å¼;ä¸è¿‡ï¼Œå®ƒä¹Ÿæœ‰è‡ªå·±çš„ä¸è¶³ã€‚ç»„åˆç»§æ‰¿æœ€å¤§çš„ é—®é¢˜å°±æ˜¯æ— è®ºä»€ä¹ˆæƒ…å†µä¸‹ï¼Œéƒ½ä¼šè°ƒç”¨ä¸¤æ¬¡è¶…ç±»å‹æ„é€ å‡½æ•°:ä¸€æ¬¡æ˜¯åœ¨åˆ›å»ºå­ç±»å‹åŸå‹çš„æ—¶å€™ï¼Œå¦ä¸€æ¬¡æ˜¯ åœ¨å­ç±»å‹æ„é€ å‡½æ•°å†…éƒ¨ã€‚æ²¡é”™ï¼Œå­ç±»å‹æœ€ç»ˆä¼šåŒ…å«è¶…ç±»å‹å¯¹è±¡çš„å…¨éƒ¨å®ä¾‹å±æ€§ï¼Œä½†æˆ‘ä»¬ä¸å¾—ä¸åœ¨è°ƒç”¨å­ ç±»å‹æ„é€ å‡½æ•°æ—¶é‡å†™è¿™äº›å±æ€§ã€‚å†æ¥çœ‹ä¸€çœ‹ä¸‹é¢ç»„åˆç»§æ‰¿çš„ä¾‹å­ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">A</span>(<span class=\"params\">name</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.array = [<span class=\"string\">'1'</span>,<span class=\"string\">'2'</span>,<span class=\"string\">'3'</span>]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">A.prototype.sayName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;<span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name)&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">B</span>(<span class=\"params\">name, age</span>)</span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  A.call(<span class=\"keyword\">this</span>, name) <span class=\"comment\">//ç¬¬äºŒæ¬¡è°ƒç”¨</span></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.age = age</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">B.prototype.sayAge = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;<span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.age)&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">B.prototype = <span class=\"keyword\">new</span> A() <span class=\"comment\">// ç¬¬ä¸€æ¬¡è°ƒç”¨</span></span><br><span class=\"line\">B.prototype.constructor = B</span><br></pre></td></tr></table></figure>\n\n<p>ç¬¬ä¸€æ¬¡è°ƒç”¨Aæ„é€ å‡½æ•°çš„æ—¶å€™, Bçš„åŸå‹ä¸Šå°±æ‹¥æœ‰äº†Açš„ä¸¤ä¸ªå±æ€§å’Œä¸€ä¸ªæ–¹æ³•;</p>\n<p>ç¬¬äºŒæ¬¡è°ƒç”¨Açš„æ„é€ å‡½æ•°æ—¶, ä¸ºBçš„å®ä¾‹åˆ›å»ºäº†Açš„ä¸¤ä¸ªçš„å±æ€§å’Œä¸€ä¸ªæ–¹æ³•, äºæ˜¯å®ä¾‹çš„ä¸¤ä¸ªå±æ€§å’Œä¸€ä¸ªæ–¹æ³•å°±å±è”½äº†åŸå‹ä¸Šçš„å®ä¾‹å’Œæ–¹æ³•; </p>\n<p>æ˜¯ä¸æ˜¯æ„Ÿè§‰æœ‰ç‚¹ç‚¹æµªè´¹, ä¸è¿‡å¥½åœ¨æˆ‘ä»¬å·²ç»æ‰¾åˆ°è§£å†³æ–¹æ¡ˆâ€”&gt;å¯„ç”Ÿç»„åˆç»§æ‰¿</p>\n<p>ä¸¾ä¸€ä¸ªéå¸¸ç®€å•çš„ğŸŒ°, å¹¶ä¸”æˆ‘å°½é‡é€å­—é€å¥çš„è®²æ¸…æ¥š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">object</span>(<span class=\"params\">o</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">F</span>(<span class=\"params\"></span>)</span>&#123;&#125;</span><br><span class=\"line\">  F.prototype = o</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> F</span><br><span class=\"line\">&#125; <span class=\"comment\">//ä¹Ÿå¯ä»¥ç”¨Object.createæ›¿ä»£</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">B</span>(<span class=\"params\">name</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.colors = [<span class=\"string\">\"red\"</span>, <span class=\"string\">\"blue\"</span>, <span class=\"string\">\"green\"</span>];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">B.prototype.sayName = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123; <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">A</span>(<span class=\"params\">name, age</span>)</span>&#123; </span><br><span class=\"line\">  B.call(<span class=\"keyword\">this</span>, name); <span class=\"comment\">// åªè°ƒç”¨äº†è¿™ä¸€æ¬¡</span></span><br><span class=\"line\">\t<span class=\"keyword\">this</span>.age = age; </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">inheritPrototype</span>(<span class=\"params\">A, B</span>)</span>&#123; </span><br><span class=\"line\">  <span class=\"comment\">//è®©prototypeå¯ä»¥æ‹¿åˆ°Bçš„å±æ€§å’Œæ–¹æ³•...è¿™æ˜¯åŸå‹å¼ç»§æ‰¿</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> prototype = object(B.prototype); </span><br><span class=\"line\">  <span class=\"comment\">//ç”±äºé‡å†™äº†åŸå‹, æ‰€ä»¥æ­¤æ—¶çš„constructorä¼šæŒ‡å‘Object, æ‰€ä»¥å¿…é¡»æŒ‡å®šä¸€ä¸‹constructor...é‚£ä¸ºä»€ä¹ˆä¼šä¸¢å¤±å‘¢?å› ä¸ºæˆ‘ä»¬ç©¿ç»™objectè¿™ä¸ªæ–¹æ³•çš„æ˜¯ä¸€ä¸ªå¯¹è±¡, è€Œå¯¹è±¡çš„æ„é€ å‡½æ•°å°±æ˜¯Object; åœ¨åŸå‹é‚£ä¸€å°èŠ‚æˆ‘ä»¬è¯´è¿‡äº†, åŸå‹ä¹Ÿæ˜¯å¯¹è±¡;</span></span><br><span class=\"line\">  prototype.constructor = A; </span><br><span class=\"line\">  <span class=\"comment\">// ç»§æ‰¿å±æ€§ä¹‹åå°±éœ€è¦å°†åŸå‹ç»™æŒ‡å‘å›å», ä¸ºäº†åŸå‹é“¾çš„æ­£ç¡®æŒ‡å‘</span></span><br><span class=\"line\">  A.prototype = prototype;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">inheritPrototype(A, B);</span><br><span class=\"line\"></span><br><span class=\"line\">A.prototype.sayAge = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123; </span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.age);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>åŸºæœ¬æ€æƒ³ï¼šé€šè¿‡å€Ÿç”¨æ„é€ å‡½æ•°æ¥ç»§æ‰¿å±æ€§ï¼Œé€šè¿‡åŸå‹é“¾çš„æ··æˆå½¢å¼æ¥ç»§æ‰¿æ–¹æ³•ã€‚å®é™…ä¸Šæ˜¯<strong>åœ¨ç»„åˆç»§æ‰¿çš„åŸºç¡€ä¸Šï¼Œç”¨è¶…ç±»å‹åŸå‹çš„å‰¯æœ¬ä»£æ›¿è°ƒç”¨è¶…ç±»å‹çš„æ„é€ å‡½æ•°ç»™å­ç±»å‹æŒ‡å®šåŸå‹</strong>ã€‚</p>\n<p>æœ¬è´¨ä¸Šï¼Œæ˜¯ä½¿ç”¨å¯„ç”Ÿå¼ç»§æ‰¿æ¥ç»§æ‰¿è¶…ç±»å‹çš„åŸå‹ï¼Œç„¶åå†å°†ç»“æœæŒ‡å®šç»™å­ç±»å‹çš„åŸå‹ã€‚</p>\n<p>ä¼˜ç‚¹ï¼šåªè°ƒç”¨äº†ä¸€æ¬¡è¶…ç±»å‹çš„æ„é€ å‡½æ•°ï¼Œå¹¶ä¸”å› æ­¤é¿å…äº†åœ¨å­ç±»å‹çš„åŸå‹ä¸Šåˆ›å»ºä¸å¿…è¦çš„ã€å¤šä½™çš„å±æ€§ã€‚ä¸æ­¤åŒæ—¶ï¼ŒåŸå‹é“¾è¿˜èƒ½ä¿æŒä¸å˜ã€‚å› æ­¤ï¼Œè¿˜èƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨<code>instanceof</code>å’Œ<code>isPrototypeOf()</code>ã€‚æ™®éè®¤ä¸ºå¯„ç”Ÿç»„åˆå¼ç»§æ‰¿æ˜¯å¼•ç”¨ç±»å‹<strong>æœ€ç†æƒ³</strong>çš„ç»§æ‰¿æ–¹å¼ã€‚</p>\n<h5 id=\"ä¼˜ç‚¹-5\"><a href=\"#ä¼˜ç‚¹-5\" class=\"headerlink\" title=\"ä¼˜ç‚¹\"></a>ä¼˜ç‚¹</h5><ul>\n<li>åœ¨å°‘ä¸€æ¬¡å®ä¾‹åŒ–çˆ¶ç±»çš„æƒ…å†µä¸‹ï¼Œå®ç°äº†åŸå‹é“¾ç»§æ‰¿å’Œå€Ÿç”¨æ„é€ å‡½æ•°</li>\n<li>å‡å°‘äº†åŸå‹é“¾æŸ¥æ‰¾çš„æ¬¡æ•°ï¼ˆå­ç±»ç›´æ¥ç»§æ‰¿è¶…ç±»çš„prototypeï¼Œè€Œä¸æ˜¯çˆ¶ç±»çš„å®ä¾‹ï¼‰</li>\n</ul>\n<h5 id=\"ç¼ºç‚¹-5\"><a href=\"#ç¼ºç‚¹-5\" class=\"headerlink\" title=\"ç¼ºç‚¹\"></a>ç¼ºç‚¹</h5><p>æš‚æ— </p>\n<h4 id=\"classç»§æ‰¿\"><a href=\"#classç»§æ‰¿\" class=\"headerlink\" title=\"classç»§æ‰¿\"></a>classç»§æ‰¿</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Parent</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">constructor</span>(name)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    getName()&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Child</span> <span class=\"keyword\">extends</span> <span class=\"title\">Parent</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">constructor</span>(val)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>(val);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> child = <span class=\"keyword\">new</span> Child(<span class=\"string\">'zhangsan'</span>);</span><br><span class=\"line\">child.getName();  <span class=\"comment\">//zhangsan</span></span><br><span class=\"line\">child <span class=\"keyword\">instanceof</span> Parent <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>è¯´æ˜ï¼š</strong>æ ¸å¿ƒåœ¨äºä½¿ç”¨ extends è¡¨æ˜ç»§æ‰¿è‡ªå“ªä¸ªçˆ¶ç±»ï¼Œå¹¶ä¸”åœ¨å­ç±»æ„é€ å‡½æ•°ä¸­å¿…é¡»è°ƒç”¨ superã€‚<br>class çš„æœ¬è´¨è¿˜æ˜¯å‡½æ•°ï¼Œè¿™ç§è¡¨è¾¾ä¸è¿‡æ˜¯ä¸€ç§è¯­æ³•ç³–ã€‚</p>\n<p>è¿™é‡Œå°±ä¸å±•å¼€äº†.</p>\n"},{"title":"ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this","date":"2020-07-16T14:02:55.000Z","cover":"/image/cover/web.jpeg","_content":"\n\næœ€è¿‘åœ¨å†™ã€é‡æ‹¾å‰ç«¯ã€‘ç³»åˆ—ï¼Œä¸‹é¢æœ‰å‡ ä¸ªå¿«é€Ÿé€šé“ï¼Œå¤§å®¶è‡ªå–\n\n[ã€é‡è¯†å‰ç«¯ã€‘åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿](https://juejin.im/post/6850418113944420359)\n\n[ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—](https://juejin.im/post/6850418117508759566)\n\n[ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this](https://juejin.im/post/6854573215658803208)\n\n[ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šJavaScriptçš„æ‰§è¡Œæœºåˆ¶](https://juejin.im/post/6859911609633767438)\n\n[ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC](https://juejin.im/post/6860375101322461198)\n\n[ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ](https://juejin.im/post/6865204092877144077)\n\n## å‰è¨€\n\nå…¶å®è¯´èµ·thisï¼Œè¿™ä¸ªå‡ ä¹æ˜¯å‰ç«¯é¢è¯•å¿…è€ƒé¢˜ï¼Œä¹Ÿæ˜¯å‰ç«¯æœ€å¤šâ€œè„‘ç»æ€¥è½¬å¼¯â€çš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯è®©æ— æ•°å‰ç«¯äººçƒ¦æ¼çš„åœ°æ–¹ã€‚ä»Šå¤©æˆ‘ä»¬å°±å½»åº•çš„æ·±å…¥thisï¼Œå…¨é¢çš„æ”»ç ´å®ƒï¼\n\n## ç»‘å®šè§„åˆ™\n\næˆ‘ä»¬æ¥çœ‹çœ‹åœ¨å‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨ä½ç½®å¦‚ä½•å†³å®š this çš„ç»‘å®šå¯¹è±¡ã€‚\n\nä½ å¿…é¡»æ‰¾åˆ°è°ƒç”¨ä½ç½®ï¼Œç„¶ååˆ¤æ–­éœ€è¦åº”ç”¨ä¸‹é¢å››æ¡è§„åˆ™ä¸­çš„å“ªä¸€æ¡ã€‚æˆ‘ä»¬é¦–å…ˆä¼šåˆ†åˆ«è§£é‡Š è¿™å››æ¡è§„åˆ™ï¼Œç„¶åè§£é‡Šå¤šæ¡è§„åˆ™éƒ½å¯ç”¨æ—¶å®ƒä»¬çš„ä¼˜å…ˆçº§å¦‚ä½•æ’åˆ—ã€‚\n\nthisçš„ç»‘å®šè§„åˆ™æ€»å…±æœ‰ä»¥ä¸‹5ç§ï¼š\n\n1. é»˜è®¤ç»‘å®šï¼ˆæœ€ä»¤äººå¤´ç–¼çš„ï¼‰\n   1. ä¸¥æ ¼æ¨¡å¼\n   2. éä¸¥æ ¼æ¨¡å¼\n2. éšå¼ç»‘å®š\n3. æ˜¾å¼ç»‘å®š\n   1. bind\n   2. call\n   3. apply\n4. newç»‘å®š\n\n### é»˜è®¤ç»‘å®š\n\né»˜è®¤ç»‘å®šé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æ²¡äººè¦çš„â€œå­¤å„¿â€å°±ä¼šåº”ç”¨é»˜è®¤ç»‘å®šã€‚\n\næ€è€ƒğŸ¤”ä¸€ä¸‹ğŸ‘‡çš„ä»£ç ä¼šè¾“å‡ºä»€ä¹ˆï¼Ÿ\n\n```js\nvar a = 'out'\nfunction fnc() {\n  var a = 'in'\n  console.log(this.a)\n}\nfnc();\n```\n\n**ç­”æ¡ˆæ˜¯ï¼š'out'**\n\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°å½“è°ƒç”¨ `fnc()` æ—¶ï¼Œ`this.a` è¢«è§£ææˆäº†å…¨å±€å˜é‡ `a`ã€‚ä¸ºä»€ä¹ˆ?å› ä¸ºåœ¨æœ¬ ä¾‹ä¸­ï¼Œå‡½æ•°è°ƒç”¨æ—¶åº”ç”¨äº† `this` çš„é»˜è®¤ç»‘å®šï¼Œå› æ­¤ `this` æŒ‡å‘å…¨å±€å¯¹è±¡ã€‚\n\né‚£æˆ‘ä»¬æ€ä¹ˆçŸ¥é“ä»–æ˜¯åº”ç”¨äº†é»˜è®¤ç»‘å®šå‘¢ï¼Ÿ\n\næˆ‘ä»¬å‘ç° `fnc` ä»–åªæ˜¯å­¤é›¶é›¶çš„è¢«è°ƒç”¨ï¼Œæ²¡æœ‰ä»»ä½•çš„ä¿®é¥°*ï¼ˆè°ƒç”¨ä½ç½®æ˜¯å¦æœ‰ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œæˆ–è€…è¯´æ˜¯å¦è¢«æŸä¸ªå¯¹è±¡æ‹¥æœ‰æˆ–è€…åŒ…å«ï¼Œä¸è¿‡è¿™ç§è¯´æ³•å¯èƒ½ä¼šé€ æˆä¸€äº›è¯¯å¯¼ã€‚ï¼‰*ï¼Œæ‰€ä»¥å®ƒå°±ç›¸å½“äºæ˜¯æ²¡æœ‰äººè¦çš„`å­©å­`ï¼Œåªèƒ½å»`ç¦åˆ©é™¢`---é»˜è®¤ç»‘å®šã€‚\n\nè¿™æ ·è¯´å¯èƒ½è¿˜ä¸å¤ªæ˜ç™½é»˜è®¤ç»‘å®šç©¶ç«Ÿæ˜¯æ€ä¹ˆä¸€å›äº‹ã€‚ç­‰åˆ°åé¢çš„è§„åˆ™ä»‹ç»çš„å¤šäº†ï¼Œä½ å°±ä¼šå‘ç°æ²¡æœ‰åº”ç”¨å…¶ä»–è§„åˆ™çš„â€œå­¤å„¿â€åªèƒ½æ¥ç¦åˆ©é™¢ ---é»˜è®¤ç»‘å®šçš„æ€€æŠ±\n\n#### ä¸¥æ ¼æ¨¡å¼\n\nåœ¨ä¸¥æ ¼ä¸‹ï¼Œé»˜è®¤ç»‘å®šä¸æ˜¯ç»‘å®šåˆ°`window`ï¼Œè€Œæ˜¯`undefined`ã€‚\n\n```js\nvar a = 'out'\nfunction fnc() {\n\t\"use strict\";\n\n  var a = 'in'\n  console.log(this.a)\n}\nfnc();\n```\n\n**ç­”æ¡ˆæ˜¯ï¼šæŠ¥é”™**\n\nä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºæˆ‘ä»¬æƒ³åœ¨`undefined`é‡Œé¢æ‰¾`a`ï¼Œé‚£è‚¯å®šæ˜¯æŠ¥é”™çš„\n\n### éšå¼ç»‘å®š\n\néšå¼ç»‘å®šï¼Œé¡¾åæ€ä¹‰å°±æ˜¯æ‚„æ‚„çš„ç»‘å®šï¼Œæˆ–è€…è¯´å…¬è®¤çš„ï¼Œä½†æ˜¯æ²¡æœ‰æ˜è¯´çš„ç»‘å®šã€‚å°±å¥½æ¯”ä¸€ä¸ªç”·äººå’Œä¸€ä¸ªå¥³äººæ‰‹ç‰µæ‰‹èµ°åœ¨ä¸€èµ·ï¼Œä»–ä»¬åŸºæœ¬ä¸Šå¯ä»¥è®¤å®šå°±æ˜¯åœ¨æƒ…ä¾£ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰å¯èƒ½ä¼šæ˜¯â€œå·æƒ…â€ï¼ˆæ˜ å°„åˆ°éšå¼ç»‘å®šçš„éšå¼ä¸¢å¤±ï¼Œç­‰ä¼šä¼šè¯´åˆ°ã€‚ï¼‰\n\næ€è€ƒğŸ¤”ä¸€ä¸‹ğŸ‘‡çš„ä»£ç ä¼šè¾“å‡ºä»€ä¹ˆï¼Ÿ\n\n```js\nvar a = 'out'\nfunction fnc() {\n  console.log(this.a)\n}\nvar obj = {\n  a: 'in',\n  fnc: fnc\n}\nobj.fnc();\n```\n\n**ç­”æ¡ˆæ˜¯ï¼š'in'**\n\næˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°ï¼Œ`fnc` æ˜¯åœ¨ä»€ä¹ˆæƒ…å†µä¸‹è¢«è°ƒç”¨çš„ï¼Ÿæ˜¯`obj` è°ƒç”¨çš„ï¼Œè¯´æ˜è¿™ä¸ª`fnc`å·²ç»æœ‰ä¸»äº†ï¼ŒæŠ¤èŠ±ä½¿è€…æ˜¯`obj`ï¼Œæ‰€ä»¥`fnc`è¯´çš„è¯è‚¯å®šæ˜¯å‘ç€`obj`çš„ï¼Œèƒ³è†Šè‚˜ä¸ä¼šå¾€å¤–æ‹ã€‚\n\nå…¶å®è¿™é‡Œé¢æœ‰ä¸€ä¸ªå°çš„ç‚¹éœ€è¦æ³¨æ„ï¼Œé‚£å°±æ˜¯å¦‚æœæ˜¯å¤šä¸ªå¯¹è±¡å¼•ç”¨çš„è°ƒç”¨ï¼Œé‚£è¿™ä¸ªæ—¶å€™çš„æ‰§è¡Œä¸Šä¸‹æ–‡åˆæ˜¯è°çš„å‘¢ï¼Ÿ\n\nå…¶å®æˆ‘ä»¬ç”¨å¸¸ç†å°±å¯ä»¥è§£é‡Šè¿™ä¸ªé—®é¢˜ï¼ŒAå«Bå»åƒé¥­ï¼Œä½†æ˜¯Bæƒ³å«Cä¸€èµ·å»ï¼Œç»“æœAå’ŒBèµ·äº†å†²çªï¼Œä½ ä½œä¸ºè¿™ä¸ªCä½ ä¼šå‘ç€è°ï¼Ÿé‚£è‚¯å®šæ˜¯Bï¼Œå› ä¸ºæœ‰Cå«ä½ å»ï¼Œä½ ä»¬æ‰ä¼šå‡ºç°åœ¨è¿™åœºèšä¼šã€‚æ‰€ä»¥è¿™ä¸ªé—®é¢˜ä¸éš¾å›ç­”ã€‚æˆ‘ä»¬ç›´æ¥çœ‹ä¸€ä¸ªä¾‹å­ğŸŒ°\n\n```js\nvar name = 'aa'\nfunction fnc() {\n  console.log(this.name)\n}\nvar bb = {\n  name: 'bb',\n  fnc: fnc\n}\nvar cc = {\n  name: 'cc',\n  bb: bb\n}\ncc.bb.fnc();\n```\n\n**ç­”æ¡ˆæ˜¯ï¼šbb**\n\nä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºèƒ½è®©`fnc`è¢«è°ƒç”¨çš„æ˜¯`bb`ï¼Œæ²¡æœ‰`bb`ï¼Œ`fnc`æ ¹æœ¬æ²¡æœ‰æœºä¼šç™»åœºã€‚\n\n#### éšå¼ä¸¢å¤±\n\nå‰é¢è¯´è¿‡ï¼Œè™½ç„¶å¾ˆå¤šä¸œè¥¿è¡¨ä¸Šé¢çœ‹èµ·æ¥éƒ½å¾ˆæ­£å¸¸ï¼Œä½†æ˜¯ä¹Ÿæœ‰å¯èƒ½æœ‰ä¸€äº›å…¶ä»–çŠ¶å†µçš„å‡ºç°ã€‚æ¯”å¦‚éšå¼ç»‘å®šé‡Œé¢çš„éšå¼ä¸¢å¤±ã€‚\n\næˆ‘ä»¬æŠŠä¹‹å‰çš„ä¾‹å­ä¿®æ”¹ä¸€ä¸‹\n\n```js\nvar name = 'aa'\nfunction fnc() {\n  console.log(this.name)\n}\nvar bb = {\n  name: 'bb',\n  fnc: fnc\n}\nvar cc = {\n  name: 'cc',\n  bb: bb\n}\nvar aa = cc.bb.fnc;\naa()\n```\n\n**ç­”æ¡ˆæ˜¯ï¼šaa**\n\nä¸ºä»€ä¹ˆï¼Ÿè¿™ä¸ªå…¶å®ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œè¿™ä¸ª`fnc`å¹¶æ²¡æœ‰è¢«`bb`è°ƒç”¨ï¼ŒçœŸæ­£è°ƒç”¨çš„åœ°æ–¹æ˜¯åœ¨`window`é‡Œé¢å£°æ˜çš„ä¸€ä¸ªå˜é‡`aa`ã€‚æ‰€ä»¥`bb`ä¸¢å¤±äº†`fnc`çš„ä¿¡ä»»ï¼Œ`fnc`æ— å¤„å¯å»ï¼Œåªèƒ½å»å­¤å„¿é™¢ã€‚\n\nè¿˜æ˜¯åˆšåˆšåƒé¥­çš„ä¾‹å­ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹åœºæ™¯å°±å¾ˆå¥½ç†è§£äº†ã€‚\n\nAå«Bå»åƒé¥­ï¼ŒBæŠŠCçš„è”ç³»æ–¹å¼ä¸å°å¿ƒå¼„ä¸¢äº†ï¼Œç»“æœè¢«ä¸€ä¸ªé™Œç”ŸäººDæ¡å»äº†ï¼Œåˆšåˆšå¥½Dä¹Ÿè¦å‚åŠ èšä¼šï¼Œå°±æ‰“ç”µè¯å«äº†Dä¸€èµ·å‚åŠ èšä¼šã€‚ä½†æ˜¯Cä¸è®¤è¯†Dï¼Œå«ä»–å»çš„ä¸æ˜¯ç†ŸäººBï¼Œæ‰€ä»¥è°ä¹Ÿä¿¡ä¸è¿‡ã€‚æœ€ç»ˆåªèƒ½åº”ç”¨é»˜è®¤è§„åˆ™--é»˜è®¤ç»‘å®šäº†ã€‚\n\n\n\nè¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯éå¸¸å¸¸è§çš„ï¼Œä¹Ÿæ˜¯éšå¼ä¸¢å¤±ï¼Œé‚£å°±æ˜¯å›è°ƒå‡½æ•°ã€‚\n\nçœ‹ä¸‹é¢çš„ä¾‹å­ï¼š\n\n```js\nvar name = 'window'\nfunction fnc() {\n  console.log(this.name)\n}\nfunction ffnncc(fn) {\n  fn()\n}\nvar obj = {\n  name: 'obj',\n  fnc: fnc,\n}\nffnncc(obj.fnc)\n```\n\n**ç­”æ¡ˆæ˜¯ï¼šwidnow**\n\nä¸ºä»€ä¹ˆï¼Ÿè¿™å’Œä¹‹å‰çš„é‚£ä¸ªä¾‹å­ä¸€æ ·ï¼Œè¡¨é¢ä¸Šçœ‹èµ·æ¥å¥½åƒæ˜¯`obj`è°ƒç”¨çš„ï¼Œä½†æ˜¯å…¶å®æ˜¯`obj`æŠŠè°ƒç”¨`fnc`çš„æ–¹æ³•è½¬äº¤ç»™äº†åˆ«äººï¼Œç”±`fnc`ä¸è®¤è¯†çš„æ¥è°ƒç”¨äº†ã€‚\n\nå†æ¥çœ‹ä¸€ä¸ªé¢è¯•é¢˜ç»å¸¸è€ƒçš„é¢˜ç›®ï¼š\n\n```js\nvar name = 'window'\nfunction fnc() {\n  console.log(this.name)\n}\nvar obj = {\n  name: 'obj',\n  fnc: fnc,\n}\nsetTimeout(obj.fnc, 100)\n```\n\n**ç­”æ¡ˆæ˜¯ï¼šwidnow**\n\næˆ‘ç›¸ä¿¡ä¸ç”¨è§£é‡Šä½ ä¹Ÿæ‰¾åˆ°ä¸ºä»€ä¹ˆäº†å§ï¼Ÿ`fnc`çš„è”ç³»æ–¹å¼è¢«`obj`è½¬äº¤ç»™åˆ«äººäº†ï¼\n\nå“ˆå“ˆå“ˆå“ˆï¼Œæœ‰æ²¡æœ‰æ„Ÿè§‰thiså…¶å®ä¹Ÿä¸è¿‡å¦‚æ­¤ï¼Œso easyï¼\n\n> æ€è€ƒé¢˜ï¼šé‚£ä¹ˆreactä¸­çš„å‡½æ•°è°ƒç”¨ä¸ºä»€ä¹ˆè¦ç”¨ç®­å¤´å‡½æ•°æˆ–è€…ä¸ºä»€ä¹ˆè¦åœ¨constructoré‡Œé¢bindä¸€ä¸‹ã€‚\n\n### æ˜¾å¼ç»‘å®š\n\næˆ‘ä»¬åˆšåˆšçœ‹åˆ°çš„æ˜¯éšå¼ç»‘å®šï¼Œæ˜¯å·å·æ‘¸æ‘¸çš„é‚£ç§ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±ä»‹ç»ä¸€ä¸‹æ˜¾å¼ç»‘å®šï¼Œå…‰æ˜æ­£å¤§çš„é‚£ç§ã€‚\n\né‚£ä¹ˆå¦‚æœæˆ‘ä»¬ä¸æƒ³åœ¨å¯¹è±¡å†…éƒ¨åŒ…å«å‡½æ•°å¼•ç”¨ï¼Œè€Œæƒ³åœ¨æŸä¸ªå¯¹è±¡ä¸Šå¼ºåˆ¶è°ƒç”¨å‡½æ•°ï¼Œè¯¥æ€ä¹ˆ\n\nåšå‘¢?\n\nJavaScript ä¸­çš„â€œæ‰€æœ‰â€å‡½æ•°éƒ½æœ‰ä¸€äº›æœ‰ç”¨çš„ç‰¹æ€§(è¿™å’Œå®ƒä»¬çš„ [[ åŸå‹ ]] æœ‰å…³â€”â€”ä¹‹åæˆ‘ ä»¬ä¼šè¯¦ç»†ä»‹ç»åŸå‹)ï¼Œå¯ä»¥ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å…·ä½“ç‚¹è¯´ï¼Œå¯ä»¥ä½¿ç”¨å‡½æ•°çš„ call(..) å’Œ apply(..) æ–¹æ³•ã€‚ä¸¥æ ¼æ¥è¯´ï¼ŒJavaScript çš„å®¿ä¸»ç¯å¢ƒæœ‰æ—¶ä¼šæä¾›ä¸€äº›éå¸¸ç‰¹æ®Šçš„å‡½æ•°ï¼Œå®ƒä»¬ å¹¶æ²¡æœ‰è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚ä½†æ˜¯è¿™æ ·çš„å‡½æ•°éå¸¸ç½•è§ï¼ŒJavaScript æä¾›çš„ç»å¤§å¤šæ•°å‡½æ•°ä»¥åŠä½ è‡ª å·±åˆ›å»ºçš„æ‰€æœ‰å‡½æ•°éƒ½å¯ä»¥ä½¿ç”¨ call(..) å’Œ apply(..) æ–¹æ³•ã€‚\n\nçœ‹ä¸‹é¢çš„ä¾‹å­ï¼š\n\n```js\nvar a = 'window'\nfunction foo() { \n\tconsole.log( this.a );\n}\nvar obj = { \n\ta:'obj'\n};\nfoo.call( obj );\nfoo()\n```\n\n**ç­”æ¡ˆçš„å…ˆåé¡ºåºæ˜¯ï¼šobjï¼Œwindow**\n\né€šè¿‡ foo.call(..)ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è°ƒç”¨ foo æ—¶å¼ºåˆ¶æŠŠå®ƒçš„ this ç»‘å®šåˆ° obj ä¸Šã€‚\n\nå¯æƒœï¼Œæ˜¾å¼ç»‘å®šä»ç„¶æ— æ³•è§£å†³æˆ‘ä»¬ä¹‹å‰æå‡ºçš„ä¸¢å¤±ç»‘å®šé—®é¢˜ã€‚\n\n```js\nfunction sayHi(){\n    console.log('Hello,', this.name);\n}\nvar person = {\n    name: 'YvetteLau',\n    sayHi: sayHi\n}\nvar name = 'Wiliam';\nvar Hi = function(fn) {\n    fn();\n}\nHi.call(person, person.sayHi); \n```\n\n**ç­”æ¡ˆæ˜¯ï¼šHello, Wiliam**\n\nå…¶å®æˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œè¿™ä¸ª`fn`ä¸æ˜¯ç›´æ¥è¢«è°ƒç”¨çš„ï¼Œæ‰€ä»¥é€ æˆäº†éšå¼ä¸¢å¤±ã€‚æˆ‘ä»¬çš„`call`ç»‘å®šçš„`person`å…¶å®ç»‘å®šåœ¨äº†`Hi`ä¸Šé¢äº†ï¼Œä¸ä¿¡çš„è¯æˆ‘ä»¬æ”¹ä¸€ä¸‹ä½ å°±ä¼šå‘ç°äº†ã€‚\n\n```js\nfunction sayHi(){\n    console.log('Hello,', this.name);\n}\nvar person = {\n    name: 'YvetteLau',\n    sayHi: sayHi\n}\nvar name = 'Wiliam';\nvar Hi = function(fn) {\n  \tconsole.log(this.name)\n    fn();\n}\nHi.call(person, person.sayHi); \n```\n\nè¾“å‡ºäº†ä»€ä¹ˆï¼Ÿ\n\n**YvetteLau**\n\n**Hello, Wiliam**\n\né‚£ä¹ˆå’‹åŠå‘¢ï¼Ÿåˆ«æ€•æ˜¾ç¤ºç»‘å®šçš„å˜å¼‚ç‰ˆï¼Œç¡¬ç»‘å®šå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\n\n#### ç¡¬ç»‘å®š\n\nç¡¬ç»‘å®šå…¶å®å°±æ˜¯åœ¨æœ€åä¸€å±‚ç»™ä»–è¿›è¡Œæ˜¾ç¤ºç»‘å®šã€‚\n\nè¯·çœ‹ä»£ç ï¼š\n\n```js\nfunction sayHi(){\n    console.log('Hello,', this.name);\n}\nvar person = {\n    name: 'YvetteLau',\n    sayHi: sayHi\n}\nvar name = 'Wiliam';\nvar Hi = function(fn) {\n  \tconsole.log(this.name)\n    fn.call(person);\n}\nHi(person.sayHi); \n```\n\nè¾“å‡ºäº†ä»€ä¹ˆï¼Ÿ\n\n**YvetteLau**\n\n**Hello, Wiliam**\n\nè™½ç„¶æˆ‘ä»¬è°ƒç”¨`Hi`çš„æ—¶å€™ï¼Œåœ¨`call`ä¹‹å‰`this`è¿˜æ˜¯æŒ‡å‘äº†`window`ï¼Œä½†æ˜¯æˆ‘ä»¬ç”¨`call`ç»™ä»–ç»‘å®šä¸Šäº†`person`ã€‚æ— è®ºä¹‹åå¦‚ä½•è°ƒç”¨å‡½æ•° `fn`ï¼Œå®ƒ æ€»ä¼šæ‰‹åŠ¨åœ¨ `person` ä¸Šè°ƒç”¨ `fn`ã€‚è¿™ç§ç»‘å®šæ˜¯ä¸€ç§æ˜¾å¼çš„å¼ºåˆ¶ç»‘å®šï¼Œå› æ­¤æˆ‘ä»¬ç§°ä¹‹ä¸ºç¡¬ç»‘å®šã€‚\n\n```js\nfunction foo() {\n    console.log( this.a );\n}\n\nvar obj = {\n    a: 2\n};\n\nvar bar = function() {\n    foo.call( obj );\n};\n\nbar(); // 2\nsetTimeout( bar, 100 ); // 2\n\n// ç¡¬ç»‘å®šçš„barä¸å¯èƒ½å†ä¿®æ”¹å®ƒçš„this\nbar.call( window ); // 2\n```\n\nå…¸å‹åº”ç”¨åœºæ™¯æ˜¯åˆ›å»ºä¸€ä¸ªåŒ…è£¹å‡½æ•°ï¼Œè´Ÿè´£æ¥æ”¶å‚æ•°å¹¶è¿”å›å€¼ã€‚\n\n```js\nfunction foo(something) {\n    console.log( this.a, something );\n    return this.a + something;\n}\n\nvar obj = {\n    a: 2\n};\n\nvar bar = function() {\n    return foo.apply( obj, arguments );\n};\n\nvar b = bar( 3 ); // 2 3\nconsole.log( b ); // 5\n```\n\nåˆ›å»ºä¸€ä¸ªå¯ä»¥é‡å¤ä½¿ç”¨çš„è¾…åŠ©å‡½æ•°ã€‚\n\n```js\nfunction foo(something) {\n    console.log( this.a, something );\n    return this.a + something;\n}\n\n// ç®€å•çš„è¾…åŠ©ç»‘å®šå‡½æ•°\nfunction bind(fn, obj) {\n    return function() {\n        return fn.apply( obj, arguments );\n    }\n}\n\nvar obj = {\n    a: 2\n};\n\nvar bar = bind( foo, obj );\n\nvar b = bar( 3 ); // 2 3\nconsole.log( b ); // 5\n```\n\nES5å†…ç½®äº†`Function.prototype.bind`ï¼Œbindä¼šè¿”å›ä¸€ä¸ªç¡¬ç»‘å®šçš„æ–°å‡½æ•°ï¼Œç”¨æ³•å¦‚ä¸‹ã€‚\n\n```js\nfunction foo(something) {\n    console.log( this.a, something );\n    return this.a + something;\n}\n\nvar obj = {\n    a: 2\n};\n\nvar bar = foo.bind( obj );\n\nvar b = bar( 3 ); // 2 3\nconsole.log( b ); // 5\n```\n\nAPIè°ƒç”¨çš„â€œä¸Šä¸‹æ–‡â€\n\nJSè®¸å¤šå†…ç½®å‡½æ•°æä¾›äº†ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œè¢«ç§°ä¹‹ä¸ºâ€œä¸Šä¸‹æ–‡â€ï¼ˆcontextï¼‰ï¼Œå…¶ä½œç”¨å’Œ`bind(..)`ä¸€æ ·ï¼Œç¡®ä¿å›è°ƒå‡½æ•°ä½¿ç”¨æŒ‡å®šçš„thisã€‚è¿™äº›å‡½æ•°å®é™…ä¸Šé€šè¿‡`call(..)`å’Œ`apply(..)`å®ç°äº†æ˜¾å¼ç»‘å®šã€‚\n\n```js\nfunction foo(el) {\n\tconsole.log( el, this.id );\n}\n\nvar obj = {\n    id: \"awesome\"\n}\n\nvar myArray = [1, 2, 3]\n// è°ƒç”¨foo(..)æ—¶æŠŠthisç»‘å®šåˆ°obj\nmyArray.forEach( foo, obj );\n// 1 awesome 2 awesome 3 awesome\n```\n\n### new ç»‘å®š\n\nä½¿ç”¨ new æ¥è°ƒç”¨å‡½æ•°ï¼Œæˆ–è€…è¯´å‘ç”Ÿæ„é€ å‡½æ•°è°ƒç”¨æ—¶ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œä¸‹é¢çš„æ“ä½œã€‚\n\n1. åˆ›å»º(æˆ–è€…è¯´æ„é€ )ä¸€ä¸ªå…¨æ–°çš„å¯¹è±¡ã€‚\n2. è¿™ä¸ªæ–°å¯¹è±¡ä¼šè¢«æ‰§è¡Œ[[åŸå‹]]è¿æ¥ã€‚\n3. è¿™ä¸ªæ–°å¯¹è±¡ä¼šç»‘å®šåˆ°å‡½æ•°è°ƒç”¨çš„thisã€‚\n4. å¦‚æœå‡½æ•°æ²¡æœ‰è¿”å›å…¶ä»–å¯¹è±¡ï¼Œé‚£ä¹ˆnewè¡¨è¾¾å¼ä¸­çš„å‡½æ•°è°ƒç”¨ä¼šè‡ªåŠ¨è¿”å›è¿™ä¸ªæ–°å¯¹è±¡ã€‚\n\næ€è€ƒä¸‹é¢çš„ä»£ç :\n\n```js\nvar a = 4\nfunction foo(a) { \n  this.a = a;\n}\nvar bar = new foo(2); \nconsole.log( bar.a );  // 2\n```\n\nä½¿ç”¨`new`æ¥è°ƒç”¨`foo(..)`æ—¶ï¼Œä¼šæ„é€ ä¸€ä¸ªæ–°å¯¹è±¡å¹¶æŠŠå®ƒï¼ˆ`bar`ï¼‰ç»‘å®šåˆ°`foo(..)`è°ƒç”¨ä¸­çš„thisã€‚\n\n### ç»‘å®šä¼˜å…ˆçº§\n\nçœ‹å®Œè§„åˆ™ï¼Œæˆ‘ä»¬è‚¯å®šæƒ³çŸ¥é“å¦‚æœè¿™äº›è§„åˆ™æ’åœ¨ä¸€èµ·ï¼Œæˆ‘ä»¬åˆè¯¥å¬è°çš„å‘¢ï¼Ÿ\n\næ¯«æ— ç–‘é—®ï¼Œé»˜è®¤ç»‘å®šçš„ä¼˜å…ˆçº§æ˜¯å››æ¡è§„åˆ™ä¸­æœ€ä½çš„ï¼Œå› ä¸ºæ˜¯æ²¡äººåº”ç”¨ä»»ä½•è§„åˆ™æ‰ä¼šå»åº”ç”¨é»˜è®¤ç»‘å®šã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…ˆä¸è€ƒè™‘å®ƒã€‚ éšå¼ç»‘å®šå’Œæ˜¾å¼ç»‘å®šå“ªä¸ªä¼˜å…ˆçº§æ›´é«˜?æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹:\n\n\n\n```js\nfunction foo() { \n\tconsole.log( this.a );\n}\nvar obj1 = { \n\ta: 2,\n\tfoo: foo \n};\nvar obj2 = { \n\ta: 3,\n\tfoo: foo \n};\nobj1.foo(); // 2 \nobj2.foo(); // 3\nobj1.foo.call( obj2 ); // 3 \nobj2.foo.call( obj1 ); // 2\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œæ˜¾å¼ç»‘å®šä¼˜å…ˆçº§æ›´é«˜ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨åˆ¤æ–­æ—¶åº”å½“å…ˆè€ƒè™‘æ˜¯å¦å¯ä»¥åº”ç”¨æ˜¾å¼ç»‘å®šã€‚ ç°åœ¨æˆ‘ä»¬éœ€è¦ææ¸…æ¥š new ç»‘å®šå’Œéšå¼ç»‘å®šçš„ä¼˜å…ˆçº§è°é«˜è°ä½:\n\n```js\nfunction foo(something) { \t\n\tthis.a = something;\n}\nvar obj1 = { \n\tfoo: foo\n};\nvar obj2 = {};\nobj1.foo( 2 );\nconsole.log( obj1.a ); // 2\nobj1.foo.call( obj2, 3 ); \nconsole.log( obj2.a ); // 3\nvar bar = new obj1.foo( 4 ); \nconsole.log( obj1.a ); // 2 \nconsole.log( bar.a ); // 4\n```\n\nå¯ä»¥çœ‹åˆ° new ç»‘å®šæ¯”éšå¼ç»‘å®šä¼˜å…ˆçº§é«˜ã€‚ä½†æ˜¯ new ç»‘å®šå’Œæ˜¾å¼ç»‘å®šè°çš„ä¼˜å…ˆçº§æ›´é«˜å‘¢?\n\n> new å’Œ call/apply æ— æ³•ä¸€èµ·ä½¿ç”¨ï¼Œå› æ­¤æ— æ³•é€šè¿‡ new foo.call(obj1) æ¥ç›´æ¥ è¿›è¡Œæµ‹è¯•ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¡¬ç»‘å®šæ¥æµ‹è¯•å®ƒä¿©çš„ä¼˜å…ˆçº§ã€‚\n>\n> è¿™æ˜¯å› ä¸ºå‡½æ•°å†…éƒ¨æœ‰ä¸¤ä¸ªä¸åŒçš„æ–¹æ³•ï¼š`[[Call]]`å’Œ`[[Constructor]]`ã€‚ å½“ä½¿ç”¨æ™®é€šå‡½æ•°è°ƒç”¨æ—¶ï¼Œ`[[Call]]`ä¼šè¢«æ‰§è¡Œã€‚å½“ä½¿ç”¨æ„é€ å‡½æ•°è°ƒç”¨æ—¶ï¼Œ`[[Constructor]]`ä¼šè¢«æ‰§è¡Œã€‚`call`ã€`apply`ã€`bind`å’Œç®­å¤´å‡½æ•°å†…éƒ¨æ²¡æœ‰`[[Constructor]]`æ–¹æ³•ã€‚\n\n```js\n\nfunction foo(something) { \n\tthis.a = something;\n}\nvar obj1 = {};\nvar bar = foo.bind( obj1 ); \nbar( 2 );\nconsole.log( obj1.a ); // 2\nvar baz = new bar(3); \nconsole.log( obj1.a ); // 2 \nconsole.log( baz.a ); // 3\n```\n\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°newæŠŠbindçš„ç¡¬ç»‘å®šç»™é¡¶æ‰äº†\n\næ‰€ä»¥new  > ç¡¬ç»‘å®š\n\n#### æ€»ç»“\n\n> new ç»‘å®š > æ˜¾ç¤ºç»‘å®š > éšå¼ç»‘å®š > é»˜è®¤ç»‘å®š\n\n### ç»‘å®šä¾‹å¤–\n\n#### è¢«å¿½ç•¥çš„this\n\næŠŠ`null`æˆ–è€…`undefined`ä½œä¸º`this`çš„ç»‘å®šå¯¹è±¡ä¼ å…¥`call`ã€`apply`æˆ–è€…`bind`ï¼Œè¿™äº›å€¼åœ¨è°ƒç”¨æ—¶ä¼šè¢«å¿½ç•¥ï¼Œå®é™…åº”ç”¨çš„æ˜¯é»˜è®¤è§„åˆ™ã€‚\n\nä¸‹é¢ä¸¤ç§æƒ…å†µä¸‹ä¼šä¼ å…¥`null`\n\n- ä½¿ç”¨`apply(..)`æ¥â€œå±•å¼€â€ä¸€ä¸ªæ•°ç»„ï¼Œå¹¶å½“ä½œå‚æ•°ä¼ å…¥ä¸€ä¸ªå‡½æ•°\n- `bind(..)`å¯ä»¥å¯¹å‚æ•°è¿›è¡ŒæŸ¯é‡ŒåŒ–ï¼ˆé¢„å…ˆè®¾ç½®ä¸€äº›å‚æ•°ï¼‰\n\n```js\nfunction foo(a, b) {\n    console.log( \"a:\" + a + \"ï¼Œb:\" + b );\n}\n\n// æŠŠæ•°ç»„â€å±•å¼€â€œæˆå‚æ•°\nfoo.apply( null, [2, 3] ); // a:2ï¼Œb:3\n\n// ä½¿ç”¨bind(..)è¿›è¡ŒæŸ¯é‡ŒåŒ–\nvar bar = foo.bind( null, 2 );\nbar( 3 ); // a:2ï¼Œb:3 \n```\n\næ€»æ˜¯ä¼ å…¥`null`æ¥å¿½ç•¥thisç»‘å®šå¯èƒ½äº§ç”Ÿä¸€äº›å‰¯ä½œç”¨ã€‚å¦‚æœæŸä¸ªå‡½æ•°ç¡®å®ä½¿ç”¨äº†thisï¼Œé‚£é»˜è®¤ç»‘å®šè§„åˆ™ä¼šæŠŠthisç»‘å®šåˆ°å…¨å±€å¯¹è±¡ä¸­ã€‚\n\n> æ›´å®‰å…¨çš„this\n\nå®‰å…¨çš„åšæ³•å°±æ˜¯ä¼ å…¥ä¸€ä¸ªç‰¹æ®Šçš„å¯¹è±¡ï¼ˆç©ºå¯¹è±¡ï¼‰ï¼ŒæŠŠthisç»‘å®šåˆ°è¿™ä¸ªå¯¹è±¡ä¸ä¼šå¯¹ä½ çš„ç¨‹åºäº§ç”Ÿä»»ä½•å‰¯ä½œç”¨ã€‚\n\nJSä¸­åˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡æœ€ç®€å•çš„æ–¹æ³•æ˜¯**`Object.create(null)`**ï¼Œè¿™ä¸ªå’Œ`{}`å¾ˆåƒï¼Œä½†æ˜¯å¹¶ä¸ä¼šåˆ›å»º`Object.prototype`è¿™ä¸ªå§”æ‰˜ï¼Œæ‰€ä»¥æ¯”`{}`æ›´ç©ºã€‚\n\n```js\nfunction foo(a, b) {\n    console.log( \"a:\" + a + \"ï¼Œb:\" + b );\n}\n\n// æˆ‘ä»¬çš„ç©ºå¯¹è±¡\nvar Ã¸ = Object.create( null );\n\n// æŠŠæ•°ç»„â€å±•å¼€â€œæˆå‚æ•°\nfoo.apply( Ã¸, [2, 3] ); // a:2ï¼Œb:3\n\n// ä½¿ç”¨bind(..)è¿›è¡ŒæŸ¯é‡ŒåŒ–\nvar bar = foo.bind( Ã¸, 2 );\nbar( 3 ); // a:2ï¼Œb:3 \n```\n\n#### é—´æ¥å¼•ç”¨\n\né—´æ¥å¼•ç”¨ä¸‹ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°ä¼šåº”ç”¨é»˜è®¤ç»‘å®šè§„åˆ™ã€‚é—´æ¥å¼•ç”¨æœ€å®¹æ˜“åœ¨**èµ‹å€¼**æ—¶å‘ç”Ÿã€‚\n\n```js\n// p.foo = o.fooçš„è¿”å›å€¼æ˜¯ç›®æ ‡å‡½æ•°çš„å¼•ç”¨ï¼Œæ‰€ä»¥è°ƒç”¨ä½ç½®æ˜¯foo()è€Œä¸æ˜¯p.foo()æˆ–è€…o.foo()\nfunction foo() {\n    console.log( this.a );\n}\n\nvar a = 2;\nvar o = { a: 3, foo: foo };\nvar p = { a: 4};\n\no.foo(); // 3\n(p.foo = o.foo)(); // 2\n```\n\n####  è½¯ç»‘å®š\n\n- ç¡¬ç»‘å®šå¯ä»¥æŠŠthiså¼ºåˆ¶ç»‘å®šåˆ°æŒ‡å®šçš„å¯¹è±¡ï¼ˆ`new`é™¤å¤–ï¼‰ï¼Œé˜²æ­¢å‡½æ•°è°ƒç”¨åº”ç”¨é»˜è®¤ç»‘å®šè§„åˆ™ã€‚ä½†æ˜¯ä¼šé™ä½å‡½æ•°çš„çµæ´»æ€§ï¼Œä½¿ç”¨**ç¡¬ç»‘å®šä¹‹åå°±æ— æ³•ä½¿ç”¨éšå¼ç»‘å®šæˆ–è€…æ˜¾å¼ç»‘å®šæ¥ä¿®æ”¹this**ã€‚\n- **å¦‚æœç»™é»˜è®¤ç»‘å®šæŒ‡å®šä¸€ä¸ªå…¨å±€å¯¹è±¡å’Œundefinedä»¥å¤–çš„å€¼**ï¼Œé‚£å°±å¯ä»¥å®ç°å’Œç¡¬ç»‘å®šç›¸åŒçš„æ•ˆæœï¼ŒåŒæ—¶ä¿ç•™éšå¼ç»‘å®šæˆ–è€…æ˜¾ç¤ºç»‘å®šä¿®æ”¹thisçš„èƒ½åŠ›ã€‚\n\n```js\n// é»˜è®¤ç»‘å®šè§„åˆ™ï¼Œä¼˜å…ˆçº§æ’æœ€å\n// å¦‚æœthisç»‘å®šåˆ°å…¨å±€å¯¹è±¡æˆ–è€…undefinedï¼Œé‚£å°±æŠŠæŒ‡å®šçš„é»˜è®¤å¯¹è±¡objç»‘å®šåˆ°this,å¦åˆ™ä¸ä¼šä¿®æ”¹this\nif(!Function.prototype.softBind) {\n    Function.prototype.softBind = function(obj) {\n        var fn = this;\n        // æ•è·æ‰€æœ‰curriedå‚æ•°\n        var curried = [].slice.call( arguments, 1 ); \n        var bound = function() {\n            return fn.apply(\n            \t(!this || this === (window || global)) ? \n                \tobj : this,\n                curried.concat.apply( curried, arguments )\n            );\n        };\n        bound.prototype = Object.create( fn.prototype );\n        return bound;\n    };\n}\n```\n\nä½¿ç”¨ï¼šè½¯ç»‘å®šç‰ˆæœ¬çš„foo()å¯ä»¥æ‰‹åŠ¨å°†thisç»‘å®šåˆ°obj2æˆ–è€…obj3ä¸Šï¼Œä½†å¦‚æœåº”ç”¨é»˜è®¤ç»‘å®šï¼Œåˆ™ä¼šå°†thisç»‘å®šåˆ°objã€‚\n\n```js\nfunction foo() {\n    console.log(\"name:\" + this.name);\n}\n\nvar obj = { name: \"obj\" },\n    obj2 = { name: \"obj2\" },\n    obj3 = { name: \"obj3\" };\n\n// é»˜è®¤ç»‘å®šï¼Œåº”ç”¨è½¯ç»‘å®šï¼Œè½¯ç»‘å®šæŠŠthisç»‘å®šåˆ°é»˜è®¤å¯¹è±¡obj\nvar fooOBJ = foo.softBind( obj );\nfooOBJ(); // name: obj \n\n// éšå¼ç»‘å®šè§„åˆ™\nobj2.foo = foo.softBind( obj );\nobj2.foo(); // name: obj2 <---- çœ‹ï¼ï¼ï¼\n\n// æ˜¾å¼ç»‘å®šè§„åˆ™\nfooOBJ.call( obj3 ); // name: obj3 <---- çœ‹ï¼ï¼ï¼\n\n// ç»‘å®šä¸¢å¤±ï¼Œåº”ç”¨è½¯ç»‘å®š\nsetTimeout( obj2.foo, 10 ); // name: obj\n```\n\n### ç®­å¤´å‡½æ•°\n\nES6æ–°å¢ä¸€ç§ç‰¹æ®Šå‡½æ•°ç±»å‹ï¼šç®­å¤´å‡½æ•°ï¼Œç®­å¤´å‡½æ•°æ— æ³•ä½¿ç”¨ä¸Šè¿°å››æ¡è§„åˆ™ï¼Œè€Œæ˜¯æ ¹æ®å¤–å±‚ï¼ˆå‡½æ•°æˆ–è€…å…¨å±€ï¼‰ä½œç”¨åŸŸï¼ˆ**è¯æ³•ä½œç”¨åŸŸ**ï¼‰æ¥å†³å®šthisã€‚\n\n- `foo()`å†…éƒ¨åˆ›å»ºçš„ç®­å¤´å‡½æ•°ä¼šæ•è·è°ƒç”¨æ—¶`foo()`çš„thisã€‚ç”±äº`foo()`çš„thisç»‘å®šåˆ°`obj1`ï¼Œ`bar`(å¼•ç”¨ç®­å¤´å‡½æ•°)çš„thisä¹Ÿä¼šç»‘å®šåˆ°`obj1`ï¼Œ**ç®­å¤´å‡½æ•°çš„ç»‘å®šæ— æ³•è¢«ä¿®æ”¹**(`new`ä¹Ÿä¸è¡Œ)ã€‚\n\n```js\nfunction foo() {\n    // è¿”å›ä¸€ä¸ªç®­å¤´å‡½æ•°\n    return (a) => {\n        // thisç»§æ‰¿è‡ªfoo()\n        console.log( this.a );\n    };\n}\n\nvar obj1 = {\n    a: 2\n};\n\nvar obj2 = {\n    a: 3\n}\n\nvar bar = foo.call( obj1 );\nbar.call( obj2 ); // 2ï¼Œä¸æ˜¯3ï¼\n```\n\n\n\nç®­å¤´å‡½æ•°æœ€å¸¸ç”¨äºå›è°ƒå‡½æ•°ä¸­ï¼Œä¾‹å¦‚äº‹ä»¶å¤„ç†å™¨æˆ–è€…å®šæ—¶å™¨ï¼š\n\n\n\n```js\n\nfunction foo() { \n  setTimeout(() => {\n    // è¿™é‡Œçš„ this åœ¨æ­¤æ³•ä¸Šç»§æ‰¿è‡ª foo()\n    console.log( this.a ); },100);\n  }\nvar obj = { \n\ta:2\n};\nfoo.call( obj ); // 2\n\n```\n\n\n\nES6ä¹‹å‰å’Œç®­å¤´å‡½æ•°ç±»ä¼¼çš„æ¨¡å¼ï¼Œé‡‡ç”¨çš„æ˜¯è¯æ³•ä½œç”¨åŸŸå–ä»£äº†ä¼ ç»Ÿçš„thisæœºåˆ¶ã€‚\n\n\n\n```js\nfunction foo() {\n    var self = this; // lexical capture of this\n    setTimeout( function() {\n        console.log( self.a ); // selfåªæ˜¯ç»§æ‰¿äº†foo()å‡½æ•°çš„thisç»‘å®š\n    }, 100 );\n}\n\nvar obj = {\n    a: 2\n};\n\nfoo.call(obj); // 2\n```\n\n## å®ç°callå’Œapply\n\n### äº†è§£callå’Œapply\n\nä¸ºä»€ä¹ˆä¼šæœ‰callå’Œapplyï¼Ÿ callå’Œapplyä¸¤ä¸ªæ–¹æ³•çš„ä½œç”¨åŸºæœ¬ç›¸åŒï¼Œå®ƒä»¬éƒ½æ˜¯ä¸ºäº†æ”¹å˜æŸä¸ªå‡½æ•°**æ‰§è¡Œæ—¶çš„ä¸Šä¸‹æ–‡**ï¼ˆcontextï¼‰è€Œå»ºç«‹çš„ï¼Œ ä»–çš„çœŸæ­£å¼ºå¤§ä¹‹å¤„å°±æ˜¯èƒ½å¤Ÿæ‰©å……å‡½æ•°èµ–ä»¥è¿è¡Œçš„ä½œç”¨åŸŸã€‚é€šä¿—ä¸€ç‚¹è®²ï¼Œå°±æ˜¯æ”¹å˜å‡½æ•°ä½“å†…éƒ¨**this çš„æŒ‡å‘**ã€‚\n\n\n\nä¸¾ä¸ªæ —å­ï¼š\n\n```\nwindow.color = \"red\";\nvar o = {color: \"blue\"};\nfunction sayColor(){\n\talert(this.color);\n}\nsayColor();//red\nsayColor.call(this);//redï¼ŒæŠŠå‡½æ•°ä½“sayColorå†…éƒ¨çš„thisï¼Œç»‘åˆ°å½“å‰ç¯å¢ƒï¼ˆä½œç”¨åŸŸï¼‰(è¿™æ®µä»£ç æ‰€å¤„çš„ç¯å¢ƒ)\nsayColor.call(window);//redï¼ŒæŠŠå‡½æ•°ä½“sayColorå†…éƒ¨çš„thisï¼Œç»‘åˆ°windowï¼ˆå…¨å±€ä½œç”¨åŸŸï¼‰\nsayColor.call(o);//blueå¤åˆ¶ä»£ç \n```\n\n\n\n> **è§£é‡Šï¼š**ä¸Šé¢çš„æ —å­ï¼Œå¾ˆæ˜æ˜¾å‡½æ•°sayColoræ˜¯åœ¨å…¨å±€ä½œç”¨åŸŸï¼ˆç¯å¢ƒ/windowï¼‰ä¸­è°ƒç”¨çš„ï¼Œè€Œå…¨å±€ä½œç”¨åŸŸä¸­æœ‰ä¸€ä¸ªcolorå±æ€§ï¼Œå€¼ä¸º\"red\"ï¼ŒsayColor.call(this)è¿™ä¸€è¡Œä»£ç å°±æ˜¯è¡¨ç¤º**æŠŠå‡½æ•°ä½“sayColorå†…éƒ¨çš„thisï¼Œç»‘åˆ°å½“å‰ç¯å¢ƒï¼ˆä½œç”¨åŸŸï¼‰**ï¼Œè€ŒsayColor.call(window)è¿™ä¸€è¡Œä»£ç å°±æ˜¯è¡¨ç¤º**æŠŠå‡½æ•°ä½“sayColorå†…éƒ¨çš„thisï¼Œç»‘åˆ°windowï¼ˆå…¨å±€ä½œç”¨åŸŸï¼‰**ï¼Œä¹‹æ‰€ä»¥è¿™ä¸¤è¡Œçš„è¾“å‡ºéƒ½æ˜¯\"red\"å°±æ˜¯å› ä¸ºä»–å½“å‰ä½œç”¨åŸŸçš„thiså°±æ˜¯windowï¼ˆthis === windowï¼‰ï¼› æœ€åï¼ŒsayColor.call(o)è¿™ä¸€è¡Œä»£ç å°±è¡¨ç¤º**æŠŠå‡½æ•°ä½“sayColorå†…éƒ¨çš„thisï¼Œç»‘åˆ°oè¿™ä¸ªå¯¹è±¡çš„æ‰§è¡Œç¯å¢ƒï¼ˆä¸Šä¸‹æ–‡ï¼‰ä¸­æ¥**ï¼Œä¹Ÿå°±æ˜¯è¯´sayColorå†…éƒ¨çš„thisâ€”â€”>**o**\n\n### callå’Œapplyçš„åŒºåˆ«\n\n`call()` å’Œ `apply()`çš„åŒºåˆ«åœ¨äºï¼Œ`call()`æ–¹æ³•æ¥å—çš„æ˜¯**è‹¥å¹²ä¸ªå‚æ•°çš„åˆ—è¡¨**ï¼Œè€Œ`apply()`æ–¹æ³•æ¥å—çš„æ˜¯**ä¸€ä¸ªåŒ…å«å¤šä¸ªå‚æ•°çš„æ•°ç»„**\n\nä¸¾ä¸ªä¾‹å­ï¼š\n\n```js\nvar func = function(arg1, arg2) {\n     ...\n};\n\nfunc.call(this, arg1, arg2); // ä½¿ç”¨ callï¼Œå‚æ•°åˆ—è¡¨\nfunc.apply(this, [arg1, arg2]) // ä½¿ç”¨ applyï¼Œå‚æ•°æ•°ç»„\n```\n\n### åº”ç”¨åœºæ™¯\n\nå…¶å®è¿™äº›åº”ç”¨åœºæ™¯éƒ½æœ‰æ–°çš„æ–¹æ³•å¯ä»¥å¿«é€Ÿè§£å†³ï¼Œ æˆ‘åªæ˜¯æƒ³å‘Šè¯‰å¤§å®¶ä¸€äº›å°çš„çŸ¥è¯†ç‚¹ï¼Œ è€Œä¸”è¿™äº›ä¸œè¥¿è™½ç„¶æœ‰æ–°çš„æ–¹æ³•ä»£æ›¿ï¼Œä½†æ˜¯é¢è¯•çš„æ—¶å€™å¾ˆå¯èƒ½ä¼šè¢«é—®åˆ°ã€‚\n\n#### åˆå¹¶ä¸¤ä¸ªæ•°ç»„\n\n\n\n```js\nvar a = ['a', 'aa'];\nvar b = ['b', 'bb'];\n\nArray.prototype.push.apply(a, b);\nconsole.log(a) // ['a', 'aa', 'b', 'bb']\n```\n\nå…¶å®ç°åœ¨æœ‰`concat`æ¥ä»£æ›¿äº†ã€‚æˆ–è€…å…¶ä»–å¥‡æ·«æŠ€å·§ã€‚ä½†æ˜¯ï¼Œéƒ½ä¸æ˜¯æˆ‘ä»¬çš„é‡ç‚¹ã€‚\n\n> å½“ç¬¬äºŒä¸ªæ•°ç»„(å¦‚ç¤ºä¾‹ä¸­çš„ b )å¤ªå¤§æ—¶ä¸è¦ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ¥åˆå¹¶æ•°ç»„ï¼Œå› ä¸º**ä¸€ä¸ªå‡½æ•°èƒ½å¤Ÿæ¥å—çš„å‚æ•°ä¸ªæ•°æ˜¯æœ‰é™åˆ¶**çš„ã€‚ä¸åŒçš„å¼•æ“æœ‰ä¸åŒçš„é™åˆ¶ï¼ŒJSæ ¸å¿ƒé™åˆ¶åœ¨ 65535ï¼Œæœ‰äº›å¼•æ“ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæœ‰äº›ä¸æŠ›å‡ºå¼‚å¸¸ä½†ä¸¢å¤±å¤šä½™å‚æ•°ã€‚\n\né‚£ä¹ˆè¦å¦‚ä½•è§£å†³å‘¢ï¼Ÿ\n\næˆ‘ä»¬å¯ä»¥æŠŠæ•°ç»„è¿›è¡Œåˆ‡å‰²ã€‚ç„¶ååˆ†æ‰¹æ¬¡çš„è°ƒç”¨ã€‚\n\n\n\n```js\nfunction myConcat(arr1, arr2, max = 32768) {\n  for(var i = 0; i < arr2.length; i += max) {\n    Array.prototype.push.apply(\n    \tarr1,\n      arr2.slice(i, i + max) // å°çš„çŸ¥è¯†ç‚¹ï¼Œç¬¬äºŒä¸ªå‚æ•°å¤§äºæ•°ç»„é•¿åº¦å°±ä¸€ç›´å–åˆ°æ•°ç»„çš„æœ«å°¾\n    )\n  }\n}\n\nvar a = [-2, -1];\nvar b = [];\nfor(var i = 0; i < 999999; i ++) {\n  b.push(i)\n}\n\nArray.prototype.push.apply(a, b) // Uncaught RangeError: Maximum call stack size exceeded\n\n\nmyConcat(a, b)\n```\n\n#### éªŒè¯æ˜¯å¦æ˜¯æ•°ç»„\n\n#### \n\n```js\nvar arr = [];\nObject.prototype.toString.call(arr); // [object Array]\n//æŠŠå‡½æ•°ä½“Object.prototype.toString()æ–¹æ³•å†…éƒ¨çš„thisï¼Œç»‘åˆ°arrçš„æ‰§è¡Œç¯å¢ƒï¼ˆä½œç”¨åŸŸï¼‰å¤åˆ¶ä»£ç \n```\n\n\n\n#### åŒæ ·æ˜¯æ£€æµ‹å¯¹è±¡ç±»å‹ï¼Œarr.toString()çš„ç»“æœå’ŒObject.prototype.toString.call(arr)çš„ç»“æœä¸ä¸€æ ·ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ\n\n> è¿™æ˜¯å› ä¸ºtoString()ä¸ºObjectçš„åŸå‹æ–¹æ³•ï¼Œè€ŒArray ï¼Œfunctionç­‰å¼•ç”¨ç±»å‹ä½œä¸ºObjectçš„å®ä¾‹ï¼Œéƒ½é‡å†™äº†toStringæ–¹æ³•ã€‚ä¸åŒçš„å¯¹è±¡ç±»å‹è°ƒç”¨toStringæ–¹æ³•æ—¶ï¼Œæ ¹æ®åŸå‹é“¾çš„çŸ¥è¯†ï¼Œè°ƒç”¨çš„æ˜¯å¯¹åº”çš„**é‡å†™**ä¹‹åçš„toStringæ–¹æ³•ï¼ˆfunctionç±»å‹è¿”å›å†…å®¹ä¸ºå‡½æ•°ä½“çš„å­—ç¬¦ä¸²ï¼ŒArrayç±»å‹è¿”å›å…ƒç´ ç»„æˆçš„å­—ç¬¦ä¸².....ï¼‰ï¼Œè€Œä¸ä¼šå»è°ƒç”¨Objectä¸ŠåŸå‹toStringæ–¹æ³•ï¼Œæ‰€ä»¥é‡‡ç”¨arr.toString()ä¸èƒ½å¾—åˆ°å…¶å¯¹è±¡ç±»å‹ï¼Œåªèƒ½å°†arrè½¬æ¢ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼›å› æ­¤ï¼Œåœ¨æƒ³è¦å¾—åˆ°å¯¹è±¡çš„å…·ä½“ç±»å‹æ—¶ï¼Œåº”è¯¥è°ƒç”¨Objectä¸ŠåŸå‹toStringæ–¹æ³•ã€‚\n\n#### ç±»æ•°ç»„å¯¹è±¡ï¼ˆArray-like Objectï¼‰ä½¿ç”¨æ•°ç»„æ–¹æ³•\n\n```js\nvar domNodes = document.getElementsByTagName(\"*\");\ndomNodes.unshift(\"h1\");\n// TypeError: domNodes.unshift is not a function\n\nvar domNodeArrays = Array.prototype.slice.call(domNodes);\ndomNodeArrays.unshift(\"h1\"); // 505 ä¸åŒç¯å¢ƒä¸‹æ•°æ®ä¸åŒ\n// (505) [\"h1\", html.gr__hujiang_com, head, meta, ...] \n```\n\nç±»æ•°ç»„å¯¹è±¡æœ‰ä¸‹é¢ä¸¤ä¸ªç‰¹æ€§\n\n- 1ã€å…·æœ‰ï¼šæŒ‡å‘å¯¹è±¡å…ƒç´ çš„æ•°å­—ç´¢å¼•ä¸‹æ ‡å’Œ `length` å±æ€§\n- 2ã€ä¸å…·æœ‰ï¼šæ¯”å¦‚ `push` ã€`shift`ã€ `forEach` ä»¥åŠ `indexOf`ç­‰æ•°ç»„å¯¹è±¡å…·æœ‰çš„æ–¹æ³•\n\nè¦è¯´æ˜çš„æ˜¯ï¼Œç±»æ•°ç»„å¯¹è±¡æ˜¯ä¸€ä¸ª**å¯¹è±¡**ã€‚JSä¸­å­˜åœ¨ä¸€ç§åä¸º**ç±»æ•°ç»„**çš„å¯¹è±¡ç»“æ„ï¼Œæ¯”å¦‚ `arguments` å¯¹è±¡ï¼Œè¿˜æœ‰DOM API è¿”å›çš„ `NodeList` å¯¹è±¡éƒ½å±äºç±»æ•°ç»„å¯¹è±¡ï¼Œç±»æ•°ç»„å¯¹è±¡ä¸èƒ½ä½¿ç”¨ `push/pop/shift/unshift` ç­‰æ•°ç»„æ–¹æ³•ï¼Œé€šè¿‡ `Array.prototype.slice.call` è½¬æ¢æˆçœŸæ­£çš„æ•°ç»„ï¼Œå°±å¯ä»¥ä½¿ç”¨ `Array`ä¸‹æ‰€æœ‰æ–¹æ³•ã€‚\n\n**ç±»æ•°ç»„å¯¹è±¡è½¬æ•°ç»„**çš„å…¶ä»–æ–¹æ³•ï¼š\n\n```js\n// ä¸Šé¢ä»£ç ç­‰åŒäº\nvar arr = [].slice.call(arguments)ï¼›\n\nES6:\nlet arr = Array.from(arguments);\nlet arr = [...arguments];\n```\n\n`Array.from()` å¯ä»¥å°†ä¸¤ç±»å¯¹è±¡è½¬ä¸ºçœŸæ­£çš„æ•°ç»„ï¼š**ç±»æ•°ç»„**å¯¹è±¡å’Œ**å¯éå†**ï¼ˆiterableï¼‰å¯¹è±¡ï¼ˆåŒ…æ‹¬ES6æ–°å¢çš„æ•°æ®ç»“æ„ Set å’Œ Mapï¼‰ã€‚\n\n### å®ç°call\n\nè¿™é‡Œä¼šä½¿ç”¨éšå¼ç»‘å®šæ¥å®ç°ã€‚\n\nå…ˆä¸¢å‡ºæˆ‘ä»¬è¦æµ‹è¯•çš„ä¾‹å­ï¼š\n\n```js\nvar a = 1;\nfunction f () {\n  console.log(this.a)\n}\nvar b = {\n  a: 2\n}\nf(); // 1\nf.call(b) // 2\n```\n\nOK, æˆ‘ä»¬ç°åœ¨å°±æ¥å®ç°ä»¥ä¸‹è‡ªå®šä¹‰çš„callã€‚åº”ç”¨éšå¼ç»‘å®šçš„è¯å°±å¯ä»¥ç›´æ¥ç»‘å®šä¸Šäº†ã€‚\n\n```js\n\nvar a = 1;\nfunction f () {\n  console.log(this.a)\n}\n\nFunction.prototype.myCall = function (context) {\n  context.fn = f;\n  context.fn();\n  delete context.fn;\n}\n\nvar b = {\n  a: 2\n}\nf(); // 1\nf.myCall(b) // 2\n```\n\nå¾ˆæ½‡æ´’çš„å®Œæˆäº†ã€‚ä½†æ˜¯å¥½åƒä¸èƒ½æ¥å—å‚æ•°è¯¶ï¼Œæ¥å—å‚æ•°åˆè¦è€ƒè™‘è¾¹ç•Œæƒ…å†µï¼Œæ¯”å¦‚`undefined`ï¼Œ`null`ä¹‹ç±»çš„ã€‚è€Œä¸”ï¼ï¼è€Œä¸”ï¼ï¼è€Œä¸”`call`ä¸ä¼ çš„è¯æ˜¯é»˜è®¤åº”ç”¨`window`çš„ï¼›\n\næ‰€ä»¥ä»–æœ‰æˆ‘ä»¬ä¹Ÿè¦æœ‰ï¼å†²ï¼\n\n```js\nFunction.prototype.myCall = function(context) {\n  // å–å¾—ä¼ å…¥çš„å¯¹è±¡ï¼ˆæ‰§è¡Œä¸Šä¸‹æ–‡ï¼‰ï¼Œæ¯”å¦‚ä¸Šæ–‡çš„fooå¯¹è±¡ï¼Œè¿™é‡Œçš„contextå°±ç›¸å½“äºä¸Šæ–‡çš„foo\n  // ä¸ä¼ ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œé»˜è®¤æ˜¯window,\n  var context = context || window;\n  // ç»™contextæ·»åŠ ä¸€ä¸ªå±æ€§ï¼Œè¿™æ—¶çš„thisæŒ‡å‘è°ƒç”¨myCallçš„å‡½æ•°ï¼Œæ¯”å¦‚ä¸Šæ–‡çš„barå‡½æ•°\n  context.fn = this;//è¿™é‡Œçš„context.fnå°±ç›¸å½“äºä¸Šæ–‡çš„barå‡½æ•°\n  // é€šè¿‡å±•å¼€è¿ç®—ç¬¦å’Œè§£æ„èµ‹å€¼å–å‡ºcontextåé¢çš„å‚æ•°ï¼Œä¸Šæ–‡çš„ä¾‹å­æ²¡æœ‰ä¼ å…¥å‚æ•°åˆ—è¡¨\n  var args = [...arguments].slice(1);\n  // æ‰§è¡Œå‡½æ•°ï¼ˆç›¸å½“äºä¸Šæ–‡çš„bar(...args)ï¼‰\n  var result = context.fn(...args);\n  // åˆ é™¤å‡½æ•°\n  delete context.fn;\n  return result;\n};\n\n```\n\n###  å®ç°apply\n\nå› ä¸ºä»–ä»¬ä¸¤å…„å¼Ÿå°±å‚æ•°ä¸ä¸€æ ·æ‰€ä»¥å°±ä¸è§£é‡Šäº†ï¼Œç›´æ¥çœ‹ä»£ç å§ã€‚\n\n```js\nFunction.prototype.myApply = function(context) {\n      var context = context || window;\n      context.fn = this;\n      var result;\n      // åˆ¤æ–­ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¦å­˜åœ¨ï¼Œä¹Ÿå°±æ˜¯contextåé¢æœ‰æ²¡æœ‰ä¸€ä¸ªæ•°ç»„\n      // å¦‚æœå­˜åœ¨ï¼Œåˆ™éœ€è¦å±•å¼€ç¬¬äºŒä¸ªå‚æ•°\n      if (arguments[1]) {\n        result = context.fn(...arguments[1]);\n      } else {\n        result = context.fn();\n      }\n      delete context.fn;\n      return result;\n}\n\n```\n\n\n\n## å®ç°bind\n\n#### äº†è§£bind\n\n> `bind() æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œåœ¨ `bind()` è¢«è°ƒç”¨æ—¶ï¼Œè¿™ä¸ªæ–°å‡½æ•°çš„ `this` è¢«æŒ‡å®šä¸º `bind()` çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè€Œå…¶ä½™å‚æ•°å°†ä½œä¸ºæ–°å‡½æ•°çš„å‚æ•°ï¼Œä¾›è°ƒç”¨æ—¶ä½¿ç”¨ã€‚\n>\n> è¯­æ³•ï¼š`fun.bind(thisArg[, arg1[, arg2[, ...]]])`\n>\n> MDN\n\n#### bindå’Œapplyï¼Œcallä¸¤å…„å¼Ÿçš„åŒºåˆ«\n\n`bind` æ–¹æ³•ä¸ `call / apply` æœ€å¤§çš„ä¸åŒå°±æ˜¯å‰è€…è¿”å›ä¸€ä¸ªç»‘å®šä¸Šä¸‹æ–‡çš„**å‡½æ•°**ï¼Œè€Œåä¸¤è€…æ˜¯**ç›´æ¥æ‰§è¡Œ**äº†å‡½æ•°ã€‚\n\nä¸Šä»£ç ï¼\n\n```js\nvar value = 2;\n\nvar foo = {\n    value: 1\n};\n\nfunction bar(name, age) {\n    return {\n\t\tvalue: this.value,\n\t\tname: name,\n\t\tage: age\n    }\n};\n\nbar.call(foo, \"Jack\", 20); // ç›´æ¥æ‰§è¡Œäº†å‡½æ•°\n// {value: 1, name: \"Jack\", age: 20}\n\nvar bindFoo1 = bar.bind(foo, \"Jack\", 20); // è¿”å›ä¸€ä¸ªå‡½æ•°\nbindFoo1();\n// {value: 1, name: \"Jack\", age: 20}\n\nvar bindFoo2 = bar.bind(foo, \"Jack\"); // è¿”å›ä¸€ä¸ªå‡½æ•°\nbindFoo2(20);\n// {value: 1, name: \"Jack\", age: 20}\n```\n\né€šè¿‡ä¸Šè¿°ä»£ç å¯ä»¥çœ‹å‡º`bind` æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š\n\n- 1ã€å¯ä»¥æŒ‡å®š`this`\n- 2ã€è¿”å›ä¸€ä¸ªå‡½æ•°\n- 3ã€å¯ä»¥ä¼ å…¥å‚æ•°\n- 4ã€æŸ¯é‡ŒåŒ–\n\n#### å®ç°bind\n\nç›´æ¥å¼€å¹²ï¼\n\n```js\nFunction.prototype.myBind = function (context) {\n  var that = this; // è¿™é‡Œåˆ©ç”¨çš„é—­åŒ…ä¿å­˜äº†æ­¤æ—¶æ­¤åˆ»çš„thisï¼Œå¦åˆ™åé¢è°ƒç”¨çš„è¯ä¼šéšå¼ä¸¢å¤±\n  return function () { \n    return that.apply(context)\n  }\n}\n\n// æµ‹è¯•ç”¨ä¾‹\nvar value = 2;\nvar foo = {\n    value: 1\n};\n\nfunction bar() {\n\treturn this.value;\n}\n\nvar bindFoo = bar.myBind(foo);\n\nconsole.log(bindFoo()); // 1\n```\n\nOk,æ¥ä¸‹æ¥æˆ‘ä»¬å¤„ç†ä¸€ä¸‹å‚æ•°å’ŒæŸ¯é‡ŒåŒ–å§ã€‚\n\n```js\nFunction.prototype.myBind = function (context) {\n  // å› ä¸ºå‚æ•°æ˜¯ç±»æ•°ç»„æ²¡æœ‰sliceæ–¹æ³•ï¼Œé€šè¿‡callç»‘å®šthisä¹‹åä½¿ç”¨sliceæ‹·è´æ•°ç»„ï¼Œé™¤äº†ç¬¬ä¸€ä¸ªéœ€è¦ç»‘å®šçš„this ä¹‹å¤–ï¼Œä¸‹é¢ä¼šç”¨åˆ°\n  var args = Array.prototype.slice.call(arguments, 1)\n  var that = this; // è¿™é‡Œåˆ©ç”¨çš„é—­åŒ…ä¿å­˜äº†æ­¤æ—¶æ­¤åˆ»çš„thisï¼Œå¦åˆ™åé¢è°ƒç”¨çš„è¯ä¼šéšå¼ä¸¢å¤±\n  return function () { \n    // å’Œä¸Šé¢ä¸€æ ·æ‹·è´å‚æ•°\n    var nowArgs = Array.prototype.slice.call(arguments)\n    return that.apply(context, args.concat(nowArgs))\n  }\n}\n// æµ‹è¯•ç”¨ä¾‹\nvar value = 2;\n\nvar foo = {\n    value: 1\n};\n\nfunction bar(name, age) {\n    return {\n\t\tvalue: this.value,\n\t\tname: name,\n\t\tage: age\n    }\n};\n\nvar bindFoo = bar.myBind(foo, \"Jack\");\nbindFoo(20);\n// {value: 1, name: \"Jack\", age: 20}\n\n```\n\nåˆ°ç°åœ¨å·²ç»å®Œæˆå¤§éƒ¨åˆ†äº†ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªéš¾ç‚¹ï¼Œ`bind` æœ‰ä»¥ä¸‹ä¸€ä¸ªç‰¹æ€§\n\n> ä¸€ä¸ªç»‘å®šå‡½æ•°ä¹Ÿèƒ½ä½¿ç”¨newæ“ä½œç¬¦åˆ›å»ºå¯¹è±¡ï¼šè¿™ç§è¡Œä¸ºå°±åƒæŠŠåŸå‡½æ•°å½“æˆæ„é€ å™¨ï¼Œæä¾›çš„ this å€¼è¢«å¿½ç•¥ï¼ŒåŒæ—¶è°ƒç”¨æ—¶çš„å‚æ•°è¢«æä¾›ç»™æ¨¡æ‹Ÿå‡½æ•°ã€‚\n\nä¸¾ä¾‹è¯´æ˜ï¼šæ­£è§„çš„bind\n\n```js\nvar value = 2;\nvar foo = {\n    value: 1\n};\nfunction bar(name, age) {\n    this.habit = 'shopping';\n    console.log(this.value);\n    console.log(name);\n    console.log(age);\n}\nbar.prototype.friend = 'kevin';\n\nvar bindFoo = bar.bind(foo, 'Jack');\nvar obj = new bindFoo(20);\n// undefined\n// Jack\n// 20\n\nobj.habit;\n// shopping\n\nobj.friend;\n// kevin\n```\n\nä¸Šé¢ä¾‹å­ä¸­ï¼Œè¿è¡Œç»“æœ`this.value` è¾“å‡ºä¸º `undefined`ï¼Œè¿™ä¸æ˜¯å…¨å±€`value` ä¹Ÿä¸æ˜¯`foo`å¯¹è±¡ä¸­çš„`value`ï¼Œè¿™è¯´æ˜ `bind` çš„ `this` å¯¹è±¡å¤±æ•ˆäº†ï¼Œ`new` çš„å®ç°ä¸­ç”Ÿæˆä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè¿™ä¸ªæ—¶å€™çš„ `this`æŒ‡å‘çš„æ˜¯ `obj`ã€‚\n\næ‰€ä»¥æˆ‘ä»¬è¿”å›çš„æ—¶å€™éœ€è¦åˆ¤æ–­ä¸€ä¸‹ä»–æ˜¯ä¸æ˜¯ä½œä¸ºäº†æ„é€ å‡½æ•°è¿”å›ï¼Œå¦‚æœæ˜¯å°±è¿”å›å½“å‰çš„thisï¼Œå¦‚æœä¸æ˜¯å°±ç»‘å®šå½“å‰è¾“å…¥çš„`context`\n\n```js\nFunction.prototype.myBind = function (context) {\n  // å› ä¸ºå‚æ•°æ˜¯ç±»æ•°ç»„æ²¡æœ‰sliceæ–¹æ³•ï¼Œé€šè¿‡callç»‘å®šthisä¹‹åä½¿ç”¨sliceæ‹·è´æ•°ç»„ï¼Œé™¤äº†ç¬¬ä¸€ä¸ªéœ€è¦ç»‘å®šçš„this ä¹‹å¤–ï¼Œä¸‹é¢ä¼šç”¨åˆ°\n  var args = Array.prototype.slice.call(arguments, 1)\n  var that = this; // è¿™é‡Œåˆ©ç”¨çš„é—­åŒ…ä¿å­˜äº†æ­¤æ—¶æ­¤åˆ»çš„thisï¼Œå¦åˆ™åé¢è°ƒç”¨çš„è¯ä¼šéšå¼ä¸¢å¤±\n  var fnc = function () { \n    // å’Œä¸Šé¢ä¸€æ ·æ‹·è´å‚æ•°\n    var nowArgs = Array.prototype.slice.call(arguments)\n    //å½“ä½œä¸ºæ„é€ å‡½æ•°æ—¶ï¼Œthis æŒ‡å‘å®ä¾‹ï¼Œæ­¤æ—¶ this instanceof fBound ç»“æœä¸º trueï¼Œå¯ä»¥è®©å®ä¾‹è·å¾—æ¥è‡ªç»‘å®šå‡½æ•°çš„å€¼ï¼Œå³ä¸Šä¾‹ä¸­å®ä¾‹ä¼šå…·æœ‰ habit å±æ€§ã€‚\n//å½“ä½œä¸ºæ™®é€šå‡½æ•°æ—¶ï¼Œthis æŒ‡å‘ windowï¼Œæ­¤æ—¶ç»“æœä¸º falseï¼Œå°†ç»‘å®šå‡½æ•°çš„ this æŒ‡å‘ context\n    return that.apply(\n      this instanceof fnc ? this : context, \n      args.concat(nowArgs)\n    )\n  }\n  // ä¿®æ”¹è¿”å›å‡½æ•°çš„ prototype ä¸ºç»‘å®šå‡½æ•°çš„ prototypeï¼Œå®ä¾‹å°±å¯ä»¥ç»§æ‰¿ç»‘å®šå‡½æ•°çš„åŸå‹ä¸­çš„å€¼ï¼Œå³ä¸Šä¾‹ä¸­ obj å¯ä»¥è·å–åˆ° bar åŸå‹ä¸Šçš„ friendã€‚\n  fnc.prototype = this.prototype\n  return fnc\n}\n```\n\nä½†æ˜¯å…¶å®è¿™æ ·ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘å¦‚æœå®ä¾‹ä¿®æ”¹äº†åŸå‹ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„ç»§æ‰¿å°±ä¼šå‡ºç°é—®é¢˜ã€‚\n\nè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦æ‹·è´ä¸€ä¸‹æˆ‘ä»¬åŸå‹ä¸Šé¢çš„å‚æ•°ã€‚ä¼šç”¨åˆ°\n\n> é“æ ¼æ‹‰æ–¯Â·å…‹ç½—å…‹ç¦å¾·åœ¨ 2006 å¹´å†™äº†ä¸€ç¯‡æ–‡ç« ï¼Œé¢˜ä¸º Prototypal Inheritance in JavaScript (JavaScript 10 ä¸­çš„åŸå‹å¼ç»§æ‰¿)ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œä»–ä»‹ç»äº†ä¸€ç§å®ç°ç»§æ‰¿çš„æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•å¹¶æ²¡æœ‰ä½¿ç”¨ä¸¥æ ¼æ„ä¹‰ä¸Šçš„ æ„é€ å‡½æ•°ã€‚ä»–çš„æƒ³æ³•æ˜¯å€ŸåŠ©åŸå‹å¯ä»¥åŸºäºå·²æœ‰çš„å¯¹è±¡åˆ›å»ºæ–°å¯¹è±¡ï¼ŒåŒæ—¶è¿˜ä¸å¿…å› æ­¤åˆ›å»ºè‡ªå®šä¹‰ç±»å‹ã€‚ä¸º äº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œä»–ç»™å‡ºäº†å¦‚ä¸‹å‡½æ•°ã€‚\n>\n> ```js\n> function object(o){\n>   function F(){}\n>   F.prototype = o\n>   return new F\n> }\n> ```\n>\n> çœ‹èµ·æ¥éå¸¸ç®€å•\n>\n> å…ˆåœ¨`object`å‡½æ•°å†…éƒ¨åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„æ„é€ å‡½æ•°`F`, ç„¶åå°†ä¼ å…¥çš„è¿™ä¸ªå¯¹è±¡`o`ä½œä¸ºè¿™ä¸ªä¸´æ—¶æ„é€ å‡½æ•°çš„åŸå‹, æœ€åè¿”å›è¿™ä¸ªä¸´æ—¶æ„é€ å‡½æ•°çš„å®ä¾‹. \n>\n> ç®€å•æ¥è¯´å°±æ˜¯`object`å¯¹ä¼ å…¥çš„å¯¹è±¡è¿›è¡Œäº†æµ…å¤åˆ¶.\n\nè¿™å¥è¯åœ¨æˆ‘çš„ã€ŠåŸå‹åŸå‹é“¾å’Œç»§æ‰¿ã€‹é‡Œé¢æœ‰å…·ä½“çš„ä»‹ç»ã€‚æƒ³çœ‹çš„è¯å¯ä»¥ç‚¹å‡»å¤´åƒæŸ¥æ‰¾æ–‡ç« ã€‚\n\nè¿™è¾¹å¯ä»¥ç›´æ¥ä½¿ç”¨ES5çš„ `Object.create()`æ–¹æ³•ç”Ÿæˆä¸€ä¸ªæ–°å¯¹è±¡\n\n```js\nfBound.prototype = Object.create(this.prototype);\n```\n\nä¸è¿‡ `bind` å’Œ `Object.create()`éƒ½æ˜¯ES5æ–¹æ³•ï¼Œéƒ¨åˆ†IEæµè§ˆå™¨ï¼ˆIE < 9ï¼‰å¹¶ä¸æ”¯æŒï¼ŒPolyfillä¸­ä¸èƒ½ç”¨ `Object.create()`å®ç° `bind`ï¼Œä¸è¿‡åŸç†æ˜¯ä¸€æ ·çš„ã€‚\n\nokã€‚é‚£æˆ‘ä»¬å°±ä¿®æ”¹ä¸€ä¸‹\n\n```js\nFunction.prototype.myBind = function (context) {\n  // å› ä¸ºå‚æ•°æ˜¯ç±»æ•°ç»„æ²¡æœ‰sliceæ–¹æ³•ï¼Œé€šè¿‡callç»‘å®šthisä¹‹åä½¿ç”¨sliceæ‹·è´æ•°ç»„ï¼Œé™¤äº†ç¬¬ä¸€ä¸ªéœ€è¦ç»‘å®šçš„this ä¹‹å¤–ï¼Œä¸‹é¢ä¼šç”¨åˆ°\n  var args = Array.prototype.slice.call(arguments, 1)\n  var that = this; // è¿™é‡Œåˆ©ç”¨çš„é—­åŒ…ä¿å­˜äº†æ­¤æ—¶æ­¤åˆ»çš„thisï¼Œå¦åˆ™åé¢è°ƒç”¨çš„è¯ä¼šéšå¼ä¸¢å¤±\n  var fNOP = function () {};\n  var fnc = function () { \n    // å’Œä¸Šé¢ä¸€æ ·æ‹·è´å‚æ•°\n    var nowArgs = Array.prototype.slice.call(arguments)\n    //å½“ä½œä¸ºæ„é€ å‡½æ•°æ—¶ï¼Œthis æŒ‡å‘å®ä¾‹ï¼Œæ­¤æ—¶ this instanceof fBound ç»“æœä¸º trueï¼Œå¯ä»¥è®©å®ä¾‹è·å¾—æ¥è‡ªç»‘å®šå‡½æ•°çš„å€¼ï¼Œå³ä¸Šä¾‹ä¸­å®ä¾‹ä¼šå…·æœ‰ habit å±æ€§ã€‚\n//å½“ä½œä¸ºæ™®é€šå‡½æ•°æ—¶ï¼Œthis æŒ‡å‘ windowï¼Œæ­¤æ—¶ç»“æœä¸º falseï¼Œå°†ç»‘å®šå‡½æ•°çš„ this æŒ‡å‘ context\n    return that.apply(\n      this instanceof fNOP ? this : context, \n      args.concat(nowArgs)\n    )\n  }\n  // ä¿®æ”¹è¿”å›å‡½æ•°çš„ prototype ä¸ºç»‘å®šå‡½æ•°çš„ prototypeï¼Œå®ä¾‹å°±å¯ä»¥ç»§æ‰¿ç»‘å®šå‡½æ•°çš„åŸå‹ä¸­çš„å€¼ï¼Œå³ä¸Šä¾‹ä¸­ obj å¯ä»¥è·å–åˆ° bar åŸå‹ä¸Šçš„ friendã€‚\n  fNOP.prototype = this.prototype\n  fnc.prototype = new FNOP()\n  return fnc\n}\n```\n\nåˆ°è¿™é‡Œå…¶å®å·²ç»å·®ä¸å¤šäº†ï¼Œçªç„¶æƒ³èµ·æ¥è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯è°ƒç”¨ `bind` çš„ä¸æ˜¯å‡½æ•°ï¼Œè¿™æ—¶å€™éœ€è¦æŠ›å‡ºå¼‚å¸¸ã€‚\n\n```js\nif (typeof this !== \"function\") {\n  throw new Error(\"Function.prototype.bind - what is trying to be bound is not callable\");\n}\n```\n\næ‰€ä»¥\n\n#### é¡¶é…\n\n```js\nFunction.prototype.myBind = function (context) {\n  if (typeof this !== \"function\") {\n  \tthrow new Error(\"Function.prototype.bind - what is trying to \tbe bound is not callable\");\n\t}\n  // å› ä¸ºå‚æ•°æ˜¯ç±»æ•°ç»„æ²¡æœ‰sliceæ–¹æ³•ï¼Œé€šè¿‡callç»‘å®šthisä¹‹åä½¿ç”¨sliceæ‹·è´æ•°ç»„ï¼Œé™¤äº†ç¬¬ä¸€ä¸ªéœ€è¦ç»‘å®šçš„this ä¹‹å¤–ï¼Œä¸‹é¢ä¼šç”¨åˆ°\n  var args = Array.prototype.slice.call(arguments, 1)\n  var that = this; // è¿™é‡Œåˆ©ç”¨çš„é—­åŒ…ä¿å­˜äº†æ­¤æ—¶æ­¤åˆ»çš„thisï¼Œå¦åˆ™åé¢è°ƒç”¨çš„è¯ä¼šéšå¼ä¸¢å¤±\n  var fNOP = function () {};\n  var fnc = function () { \n    // å’Œä¸Šé¢ä¸€æ ·æ‹·è´å‚æ•°\n    var nowArgs = Array.prototype.slice.call(arguments)\n    //å½“ä½œä¸ºæ„é€ å‡½æ•°æ—¶ï¼Œthis æŒ‡å‘å®ä¾‹ï¼Œæ­¤æ—¶ this instanceof fBound ç»“æœä¸º trueï¼Œå¯ä»¥è®©å®ä¾‹è·å¾—æ¥è‡ªç»‘å®šå‡½æ•°çš„å€¼ï¼Œå³ä¸Šä¾‹ä¸­å®ä¾‹ä¼šå…·æœ‰ habit å±æ€§ã€‚\n//å½“ä½œä¸ºæ™®é€šå‡½æ•°æ—¶ï¼Œthis æŒ‡å‘ windowï¼Œæ­¤æ—¶ç»“æœä¸º falseï¼Œå°†ç»‘å®šå‡½æ•°çš„ this æŒ‡å‘ context\n    return that.apply(\n      this instanceof fNOP ? this : context, \n      args.concat(nowArgs)\n    )\n  }\n  // ä¿®æ”¹è¿”å›å‡½æ•°çš„ prototype ä¸ºç»‘å®šå‡½æ•°çš„ prototypeï¼Œå®ä¾‹å°±å¯ä»¥ç»§æ‰¿ç»‘å®šå‡½æ•°çš„åŸå‹ä¸­çš„å€¼ï¼Œå³ä¸Šä¾‹ä¸­ obj å¯ä»¥è·å–åˆ° bar åŸå‹ä¸Šçš„ friendã€‚\n  fNOP.prototype = this.prototype\n  fnc.prototype = new FNOP()\n  return fnc\n}\n```\n\n\n\n\n\n## å®ç°new\n\n#### äº†è§£new\n\n> **new è¿ç®—ç¬¦**åˆ›å»ºä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„å¯¹è±¡ç±»å‹çš„å®ä¾‹æˆ–å…·æœ‰æ„é€ å‡½æ•°çš„å†…ç½®å¯¹è±¡çš„å®ä¾‹ã€‚ â€”â€”ï¼ˆæ¥è‡ªäºMDNï¼‰\n\næˆ‘ä»¬å…ˆè¯•è¯•ç°åœ¨æœ‰çš„newï¼Œä»–æœ‰ä»€ä¹ˆåŠŸèƒ½ï¼Œç„¶åæˆ‘ä»¬æ€»ç»“ä¹‹åï¼Œåœ¨å¼€å§‹å®ç°ã€‚\n\nçœ‹ä¸ªğŸŒ°ï¼š\n\n```js\nfunction NEW (a) {\n  this.a = a;\n}\nNEW.prototype.sayA = function () {\n  console.log(this.a+'b')\n}\nvar A = new NEW(1);\nA.sayA()\nA.a\n\n```\n\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°Aæ˜¯NEWçš„ä¸€ä¸ªå®ä¾‹ã€‚ç»§æ‰¿äº†æ„é€ å‡½æ•°ï¼ˆNEWï¼‰çš„å±æ€§å’ŒåŸå‹ä¸Šçš„å±æ€§ï¼ˆsayAï¼‰ã€‚\n\n> **`new`** å…³é”®å­—ä¼šè¿›è¡Œå¦‚ä¸‹çš„æ“ä½œï¼š\n>\n> 1. åˆ›å»ºä¸€ä¸ªç©ºçš„ç®€å•JavaScriptå¯¹è±¡ï¼ˆå³{}ï¼‰ï¼›\n> 2. é“¾æ¥è¯¥å¯¹è±¡ï¼ˆå³è®¾ç½®è¯¥å¯¹è±¡çš„æ„é€ å‡½æ•°ï¼‰åˆ°å¦ä¸€ä¸ªå¯¹è±¡ ï¼›\n> 3. å°†æ­¥éª¤1æ–°åˆ›å»ºçš„å¯¹è±¡ä½œä¸º`this`çš„ä¸Šä¸‹æ–‡ ï¼›\n> 4. å¦‚æœè¯¥å‡½æ•°æ²¡æœ‰è¿”å›å¯¹è±¡ï¼Œåˆ™è¿”å›`this`ã€‚\n>\n> MDN\n\n\n\n#### å®ç°ä¸€ä¸ªnew\n\nè¯´å¹²å°±å¹²ï¼š\n\n```js\n// new æ˜¯å…³é”®è¯ï¼Œä¸å¯ä»¥ç›´æ¥è¦†ç›–ã€‚è¿™é‡Œä½¿ç”¨ create æ¥æ¨¡æ‹Ÿå®ç° new çš„æ•ˆæœã€‚\nfunction create () {\n  // 1.\n  var obj = new Object();\n  \n  // è·å–æ„é€ å‡½æ•°\n  // å› ä¸ºargumentsæ˜¯ä¸€ä¸ªç±»æ•°ç»„å¯¹è±¡ï¼Œæ²¡æœ‰unshiftæ–¹æ³•ï¼Œæ‰€ä»¥ç”¨äº†callï¼Œæˆ‘ä»¬æ²¡æœ‰newè¿™å…³é”®å­—ï¼Œåªèƒ½æ¨¡æ‹Ÿï¼Œæ‰€ä»¥çš„ä¸€ä¸ªå‚æ•°æˆ‘ä»¬è®¤ä¸ºä»–éœ€è¦ä¼ é€’ä¸€ä¸ªæ„é€ å‡½æ•°ã€‚\n  var Con = [].unshift.call(arguments)\n  \n  // 2.\n  obj.__proto__ = Con.prototype \n  \n  // 3ã€ ç»‘å®šthisã€‚å› ä¸ºä¹‹å‰argumentså·²ç»è¢«æˆ‘ä»¬åˆ é™¤äº†ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥å‰©ä¸‹çš„å°±æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„å‚æ•°äº†ã€‚\n  Con.apply(obj, arguments)\n  \n  // 4. ç®€é™‹ç‰ˆ\n  return obj\n  \n}\n```\n\næ„é€ å‡½æ•°è¿”å›å€¼æœ‰å¦‚ä¸‹ä¸‰ç§æƒ…å†µï¼š\n\n- 1ã€è¿”å›ä¸€ä¸ªå¯¹è±¡\n- 2ã€æ²¡æœ‰ `return`ï¼Œå³è¿”å› `undefined`\n- 3ã€è¿”å›`undefined` ä»¥å¤–çš„åŸºæœ¬ç±»å‹\n\n```js\nfunction create() {\n\t// 1ã€è·å¾—æ„é€ å‡½æ•°ï¼ŒåŒæ—¶åˆ é™¤ arguments ä¸­ç¬¬ä¸€ä¸ªå‚æ•°\n    Con = [].shift.call(arguments);\n\t// 2ã€åˆ›å»ºä¸€ä¸ªç©ºçš„å¯¹è±¡å¹¶é“¾æ¥åˆ°åŸå‹ï¼Œobj å¯ä»¥è®¿é—®æ„é€ å‡½æ•°åŸå‹ä¸­çš„å±æ€§\n    var obj = Object.create(Con.prototype);\n\t// 3ã€ç»‘å®š this å®ç°ç»§æ‰¿ï¼Œobj å¯ä»¥è®¿é—®åˆ°æ„é€ å‡½æ•°ä¸­çš„å±æ€§\n    var ret = Con.apply(obj, arguments);\n\t// 4ã€ä¼˜å…ˆè¿”å›æ„é€ å‡½æ•°è¿”å›çš„å¯¹è±¡\n\treturn ret instanceof Object ? ret : obj;\n};\n```\n\n","source":"_posts/ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this.md","raw":"---\ntitle: ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this\ndate: 2020-07-16 22:02:55\ntags: [this, JavaScript]\ncategory: [é‡æ‹¾å‰ç«¯]\ncover: /image/cover/web.jpeg\n---\n\n\næœ€è¿‘åœ¨å†™ã€é‡æ‹¾å‰ç«¯ã€‘ç³»åˆ—ï¼Œä¸‹é¢æœ‰å‡ ä¸ªå¿«é€Ÿé€šé“ï¼Œå¤§å®¶è‡ªå–\n\n[ã€é‡è¯†å‰ç«¯ã€‘åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿](https://juejin.im/post/6850418113944420359)\n\n[ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—](https://juejin.im/post/6850418117508759566)\n\n[ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this](https://juejin.im/post/6854573215658803208)\n\n[ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šJavaScriptçš„æ‰§è¡Œæœºåˆ¶](https://juejin.im/post/6859911609633767438)\n\n[ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC](https://juejin.im/post/6860375101322461198)\n\n[ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ](https://juejin.im/post/6865204092877144077)\n\n## å‰è¨€\n\nå…¶å®è¯´èµ·thisï¼Œè¿™ä¸ªå‡ ä¹æ˜¯å‰ç«¯é¢è¯•å¿…è€ƒé¢˜ï¼Œä¹Ÿæ˜¯å‰ç«¯æœ€å¤šâ€œè„‘ç»æ€¥è½¬å¼¯â€çš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯è®©æ— æ•°å‰ç«¯äººçƒ¦æ¼çš„åœ°æ–¹ã€‚ä»Šå¤©æˆ‘ä»¬å°±å½»åº•çš„æ·±å…¥thisï¼Œå…¨é¢çš„æ”»ç ´å®ƒï¼\n\n## ç»‘å®šè§„åˆ™\n\næˆ‘ä»¬æ¥çœ‹çœ‹åœ¨å‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨ä½ç½®å¦‚ä½•å†³å®š this çš„ç»‘å®šå¯¹è±¡ã€‚\n\nä½ å¿…é¡»æ‰¾åˆ°è°ƒç”¨ä½ç½®ï¼Œç„¶ååˆ¤æ–­éœ€è¦åº”ç”¨ä¸‹é¢å››æ¡è§„åˆ™ä¸­çš„å“ªä¸€æ¡ã€‚æˆ‘ä»¬é¦–å…ˆä¼šåˆ†åˆ«è§£é‡Š è¿™å››æ¡è§„åˆ™ï¼Œç„¶åè§£é‡Šå¤šæ¡è§„åˆ™éƒ½å¯ç”¨æ—¶å®ƒä»¬çš„ä¼˜å…ˆçº§å¦‚ä½•æ’åˆ—ã€‚\n\nthisçš„ç»‘å®šè§„åˆ™æ€»å…±æœ‰ä»¥ä¸‹5ç§ï¼š\n\n1. é»˜è®¤ç»‘å®šï¼ˆæœ€ä»¤äººå¤´ç–¼çš„ï¼‰\n   1. ä¸¥æ ¼æ¨¡å¼\n   2. éä¸¥æ ¼æ¨¡å¼\n2. éšå¼ç»‘å®š\n3. æ˜¾å¼ç»‘å®š\n   1. bind\n   2. call\n   3. apply\n4. newç»‘å®š\n\n### é»˜è®¤ç»‘å®š\n\né»˜è®¤ç»‘å®šé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æ²¡äººè¦çš„â€œå­¤å„¿â€å°±ä¼šåº”ç”¨é»˜è®¤ç»‘å®šã€‚\n\næ€è€ƒğŸ¤”ä¸€ä¸‹ğŸ‘‡çš„ä»£ç ä¼šè¾“å‡ºä»€ä¹ˆï¼Ÿ\n\n```js\nvar a = 'out'\nfunction fnc() {\n  var a = 'in'\n  console.log(this.a)\n}\nfnc();\n```\n\n**ç­”æ¡ˆæ˜¯ï¼š'out'**\n\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°å½“è°ƒç”¨ `fnc()` æ—¶ï¼Œ`this.a` è¢«è§£ææˆäº†å…¨å±€å˜é‡ `a`ã€‚ä¸ºä»€ä¹ˆ?å› ä¸ºåœ¨æœ¬ ä¾‹ä¸­ï¼Œå‡½æ•°è°ƒç”¨æ—¶åº”ç”¨äº† `this` çš„é»˜è®¤ç»‘å®šï¼Œå› æ­¤ `this` æŒ‡å‘å…¨å±€å¯¹è±¡ã€‚\n\né‚£æˆ‘ä»¬æ€ä¹ˆçŸ¥é“ä»–æ˜¯åº”ç”¨äº†é»˜è®¤ç»‘å®šå‘¢ï¼Ÿ\n\næˆ‘ä»¬å‘ç° `fnc` ä»–åªæ˜¯å­¤é›¶é›¶çš„è¢«è°ƒç”¨ï¼Œæ²¡æœ‰ä»»ä½•çš„ä¿®é¥°*ï¼ˆè°ƒç”¨ä½ç½®æ˜¯å¦æœ‰ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œæˆ–è€…è¯´æ˜¯å¦è¢«æŸä¸ªå¯¹è±¡æ‹¥æœ‰æˆ–è€…åŒ…å«ï¼Œä¸è¿‡è¿™ç§è¯´æ³•å¯èƒ½ä¼šé€ æˆä¸€äº›è¯¯å¯¼ã€‚ï¼‰*ï¼Œæ‰€ä»¥å®ƒå°±ç›¸å½“äºæ˜¯æ²¡æœ‰äººè¦çš„`å­©å­`ï¼Œåªèƒ½å»`ç¦åˆ©é™¢`---é»˜è®¤ç»‘å®šã€‚\n\nè¿™æ ·è¯´å¯èƒ½è¿˜ä¸å¤ªæ˜ç™½é»˜è®¤ç»‘å®šç©¶ç«Ÿæ˜¯æ€ä¹ˆä¸€å›äº‹ã€‚ç­‰åˆ°åé¢çš„è§„åˆ™ä»‹ç»çš„å¤šäº†ï¼Œä½ å°±ä¼šå‘ç°æ²¡æœ‰åº”ç”¨å…¶ä»–è§„åˆ™çš„â€œå­¤å„¿â€åªèƒ½æ¥ç¦åˆ©é™¢ ---é»˜è®¤ç»‘å®šçš„æ€€æŠ±\n\n#### ä¸¥æ ¼æ¨¡å¼\n\nåœ¨ä¸¥æ ¼ä¸‹ï¼Œé»˜è®¤ç»‘å®šä¸æ˜¯ç»‘å®šåˆ°`window`ï¼Œè€Œæ˜¯`undefined`ã€‚\n\n```js\nvar a = 'out'\nfunction fnc() {\n\t\"use strict\";\n\n  var a = 'in'\n  console.log(this.a)\n}\nfnc();\n```\n\n**ç­”æ¡ˆæ˜¯ï¼šæŠ¥é”™**\n\nä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºæˆ‘ä»¬æƒ³åœ¨`undefined`é‡Œé¢æ‰¾`a`ï¼Œé‚£è‚¯å®šæ˜¯æŠ¥é”™çš„\n\n### éšå¼ç»‘å®š\n\néšå¼ç»‘å®šï¼Œé¡¾åæ€ä¹‰å°±æ˜¯æ‚„æ‚„çš„ç»‘å®šï¼Œæˆ–è€…è¯´å…¬è®¤çš„ï¼Œä½†æ˜¯æ²¡æœ‰æ˜è¯´çš„ç»‘å®šã€‚å°±å¥½æ¯”ä¸€ä¸ªç”·äººå’Œä¸€ä¸ªå¥³äººæ‰‹ç‰µæ‰‹èµ°åœ¨ä¸€èµ·ï¼Œä»–ä»¬åŸºæœ¬ä¸Šå¯ä»¥è®¤å®šå°±æ˜¯åœ¨æƒ…ä¾£ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰å¯èƒ½ä¼šæ˜¯â€œå·æƒ…â€ï¼ˆæ˜ å°„åˆ°éšå¼ç»‘å®šçš„éšå¼ä¸¢å¤±ï¼Œç­‰ä¼šä¼šè¯´åˆ°ã€‚ï¼‰\n\næ€è€ƒğŸ¤”ä¸€ä¸‹ğŸ‘‡çš„ä»£ç ä¼šè¾“å‡ºä»€ä¹ˆï¼Ÿ\n\n```js\nvar a = 'out'\nfunction fnc() {\n  console.log(this.a)\n}\nvar obj = {\n  a: 'in',\n  fnc: fnc\n}\nobj.fnc();\n```\n\n**ç­”æ¡ˆæ˜¯ï¼š'in'**\n\næˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°ï¼Œ`fnc` æ˜¯åœ¨ä»€ä¹ˆæƒ…å†µä¸‹è¢«è°ƒç”¨çš„ï¼Ÿæ˜¯`obj` è°ƒç”¨çš„ï¼Œè¯´æ˜è¿™ä¸ª`fnc`å·²ç»æœ‰ä¸»äº†ï¼ŒæŠ¤èŠ±ä½¿è€…æ˜¯`obj`ï¼Œæ‰€ä»¥`fnc`è¯´çš„è¯è‚¯å®šæ˜¯å‘ç€`obj`çš„ï¼Œèƒ³è†Šè‚˜ä¸ä¼šå¾€å¤–æ‹ã€‚\n\nå…¶å®è¿™é‡Œé¢æœ‰ä¸€ä¸ªå°çš„ç‚¹éœ€è¦æ³¨æ„ï¼Œé‚£å°±æ˜¯å¦‚æœæ˜¯å¤šä¸ªå¯¹è±¡å¼•ç”¨çš„è°ƒç”¨ï¼Œé‚£è¿™ä¸ªæ—¶å€™çš„æ‰§è¡Œä¸Šä¸‹æ–‡åˆæ˜¯è°çš„å‘¢ï¼Ÿ\n\nå…¶å®æˆ‘ä»¬ç”¨å¸¸ç†å°±å¯ä»¥è§£é‡Šè¿™ä¸ªé—®é¢˜ï¼ŒAå«Bå»åƒé¥­ï¼Œä½†æ˜¯Bæƒ³å«Cä¸€èµ·å»ï¼Œç»“æœAå’ŒBèµ·äº†å†²çªï¼Œä½ ä½œä¸ºè¿™ä¸ªCä½ ä¼šå‘ç€è°ï¼Ÿé‚£è‚¯å®šæ˜¯Bï¼Œå› ä¸ºæœ‰Cå«ä½ å»ï¼Œä½ ä»¬æ‰ä¼šå‡ºç°åœ¨è¿™åœºèšä¼šã€‚æ‰€ä»¥è¿™ä¸ªé—®é¢˜ä¸éš¾å›ç­”ã€‚æˆ‘ä»¬ç›´æ¥çœ‹ä¸€ä¸ªä¾‹å­ğŸŒ°\n\n```js\nvar name = 'aa'\nfunction fnc() {\n  console.log(this.name)\n}\nvar bb = {\n  name: 'bb',\n  fnc: fnc\n}\nvar cc = {\n  name: 'cc',\n  bb: bb\n}\ncc.bb.fnc();\n```\n\n**ç­”æ¡ˆæ˜¯ï¼šbb**\n\nä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºèƒ½è®©`fnc`è¢«è°ƒç”¨çš„æ˜¯`bb`ï¼Œæ²¡æœ‰`bb`ï¼Œ`fnc`æ ¹æœ¬æ²¡æœ‰æœºä¼šç™»åœºã€‚\n\n#### éšå¼ä¸¢å¤±\n\nå‰é¢è¯´è¿‡ï¼Œè™½ç„¶å¾ˆå¤šä¸œè¥¿è¡¨ä¸Šé¢çœ‹èµ·æ¥éƒ½å¾ˆæ­£å¸¸ï¼Œä½†æ˜¯ä¹Ÿæœ‰å¯èƒ½æœ‰ä¸€äº›å…¶ä»–çŠ¶å†µçš„å‡ºç°ã€‚æ¯”å¦‚éšå¼ç»‘å®šé‡Œé¢çš„éšå¼ä¸¢å¤±ã€‚\n\næˆ‘ä»¬æŠŠä¹‹å‰çš„ä¾‹å­ä¿®æ”¹ä¸€ä¸‹\n\n```js\nvar name = 'aa'\nfunction fnc() {\n  console.log(this.name)\n}\nvar bb = {\n  name: 'bb',\n  fnc: fnc\n}\nvar cc = {\n  name: 'cc',\n  bb: bb\n}\nvar aa = cc.bb.fnc;\naa()\n```\n\n**ç­”æ¡ˆæ˜¯ï¼šaa**\n\nä¸ºä»€ä¹ˆï¼Ÿè¿™ä¸ªå…¶å®ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œè¿™ä¸ª`fnc`å¹¶æ²¡æœ‰è¢«`bb`è°ƒç”¨ï¼ŒçœŸæ­£è°ƒç”¨çš„åœ°æ–¹æ˜¯åœ¨`window`é‡Œé¢å£°æ˜çš„ä¸€ä¸ªå˜é‡`aa`ã€‚æ‰€ä»¥`bb`ä¸¢å¤±äº†`fnc`çš„ä¿¡ä»»ï¼Œ`fnc`æ— å¤„å¯å»ï¼Œåªèƒ½å»å­¤å„¿é™¢ã€‚\n\nè¿˜æ˜¯åˆšåˆšåƒé¥­çš„ä¾‹å­ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹åœºæ™¯å°±å¾ˆå¥½ç†è§£äº†ã€‚\n\nAå«Bå»åƒé¥­ï¼ŒBæŠŠCçš„è”ç³»æ–¹å¼ä¸å°å¿ƒå¼„ä¸¢äº†ï¼Œç»“æœè¢«ä¸€ä¸ªé™Œç”ŸäººDæ¡å»äº†ï¼Œåˆšåˆšå¥½Dä¹Ÿè¦å‚åŠ èšä¼šï¼Œå°±æ‰“ç”µè¯å«äº†Dä¸€èµ·å‚åŠ èšä¼šã€‚ä½†æ˜¯Cä¸è®¤è¯†Dï¼Œå«ä»–å»çš„ä¸æ˜¯ç†ŸäººBï¼Œæ‰€ä»¥è°ä¹Ÿä¿¡ä¸è¿‡ã€‚æœ€ç»ˆåªèƒ½åº”ç”¨é»˜è®¤è§„åˆ™--é»˜è®¤ç»‘å®šäº†ã€‚\n\n\n\nè¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯éå¸¸å¸¸è§çš„ï¼Œä¹Ÿæ˜¯éšå¼ä¸¢å¤±ï¼Œé‚£å°±æ˜¯å›è°ƒå‡½æ•°ã€‚\n\nçœ‹ä¸‹é¢çš„ä¾‹å­ï¼š\n\n```js\nvar name = 'window'\nfunction fnc() {\n  console.log(this.name)\n}\nfunction ffnncc(fn) {\n  fn()\n}\nvar obj = {\n  name: 'obj',\n  fnc: fnc,\n}\nffnncc(obj.fnc)\n```\n\n**ç­”æ¡ˆæ˜¯ï¼šwidnow**\n\nä¸ºä»€ä¹ˆï¼Ÿè¿™å’Œä¹‹å‰çš„é‚£ä¸ªä¾‹å­ä¸€æ ·ï¼Œè¡¨é¢ä¸Šçœ‹èµ·æ¥å¥½åƒæ˜¯`obj`è°ƒç”¨çš„ï¼Œä½†æ˜¯å…¶å®æ˜¯`obj`æŠŠè°ƒç”¨`fnc`çš„æ–¹æ³•è½¬äº¤ç»™äº†åˆ«äººï¼Œç”±`fnc`ä¸è®¤è¯†çš„æ¥è°ƒç”¨äº†ã€‚\n\nå†æ¥çœ‹ä¸€ä¸ªé¢è¯•é¢˜ç»å¸¸è€ƒçš„é¢˜ç›®ï¼š\n\n```js\nvar name = 'window'\nfunction fnc() {\n  console.log(this.name)\n}\nvar obj = {\n  name: 'obj',\n  fnc: fnc,\n}\nsetTimeout(obj.fnc, 100)\n```\n\n**ç­”æ¡ˆæ˜¯ï¼šwidnow**\n\næˆ‘ç›¸ä¿¡ä¸ç”¨è§£é‡Šä½ ä¹Ÿæ‰¾åˆ°ä¸ºä»€ä¹ˆäº†å§ï¼Ÿ`fnc`çš„è”ç³»æ–¹å¼è¢«`obj`è½¬äº¤ç»™åˆ«äººäº†ï¼\n\nå“ˆå“ˆå“ˆå“ˆï¼Œæœ‰æ²¡æœ‰æ„Ÿè§‰thiså…¶å®ä¹Ÿä¸è¿‡å¦‚æ­¤ï¼Œso easyï¼\n\n> æ€è€ƒé¢˜ï¼šé‚£ä¹ˆreactä¸­çš„å‡½æ•°è°ƒç”¨ä¸ºä»€ä¹ˆè¦ç”¨ç®­å¤´å‡½æ•°æˆ–è€…ä¸ºä»€ä¹ˆè¦åœ¨constructoré‡Œé¢bindä¸€ä¸‹ã€‚\n\n### æ˜¾å¼ç»‘å®š\n\næˆ‘ä»¬åˆšåˆšçœ‹åˆ°çš„æ˜¯éšå¼ç»‘å®šï¼Œæ˜¯å·å·æ‘¸æ‘¸çš„é‚£ç§ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±ä»‹ç»ä¸€ä¸‹æ˜¾å¼ç»‘å®šï¼Œå…‰æ˜æ­£å¤§çš„é‚£ç§ã€‚\n\né‚£ä¹ˆå¦‚æœæˆ‘ä»¬ä¸æƒ³åœ¨å¯¹è±¡å†…éƒ¨åŒ…å«å‡½æ•°å¼•ç”¨ï¼Œè€Œæƒ³åœ¨æŸä¸ªå¯¹è±¡ä¸Šå¼ºåˆ¶è°ƒç”¨å‡½æ•°ï¼Œè¯¥æ€ä¹ˆ\n\nåšå‘¢?\n\nJavaScript ä¸­çš„â€œæ‰€æœ‰â€å‡½æ•°éƒ½æœ‰ä¸€äº›æœ‰ç”¨çš„ç‰¹æ€§(è¿™å’Œå®ƒä»¬çš„ [[ åŸå‹ ]] æœ‰å…³â€”â€”ä¹‹åæˆ‘ ä»¬ä¼šè¯¦ç»†ä»‹ç»åŸå‹)ï¼Œå¯ä»¥ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å…·ä½“ç‚¹è¯´ï¼Œå¯ä»¥ä½¿ç”¨å‡½æ•°çš„ call(..) å’Œ apply(..) æ–¹æ³•ã€‚ä¸¥æ ¼æ¥è¯´ï¼ŒJavaScript çš„å®¿ä¸»ç¯å¢ƒæœ‰æ—¶ä¼šæä¾›ä¸€äº›éå¸¸ç‰¹æ®Šçš„å‡½æ•°ï¼Œå®ƒä»¬ å¹¶æ²¡æœ‰è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚ä½†æ˜¯è¿™æ ·çš„å‡½æ•°éå¸¸ç½•è§ï¼ŒJavaScript æä¾›çš„ç»å¤§å¤šæ•°å‡½æ•°ä»¥åŠä½ è‡ª å·±åˆ›å»ºçš„æ‰€æœ‰å‡½æ•°éƒ½å¯ä»¥ä½¿ç”¨ call(..) å’Œ apply(..) æ–¹æ³•ã€‚\n\nçœ‹ä¸‹é¢çš„ä¾‹å­ï¼š\n\n```js\nvar a = 'window'\nfunction foo() { \n\tconsole.log( this.a );\n}\nvar obj = { \n\ta:'obj'\n};\nfoo.call( obj );\nfoo()\n```\n\n**ç­”æ¡ˆçš„å…ˆåé¡ºåºæ˜¯ï¼šobjï¼Œwindow**\n\né€šè¿‡ foo.call(..)ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è°ƒç”¨ foo æ—¶å¼ºåˆ¶æŠŠå®ƒçš„ this ç»‘å®šåˆ° obj ä¸Šã€‚\n\nå¯æƒœï¼Œæ˜¾å¼ç»‘å®šä»ç„¶æ— æ³•è§£å†³æˆ‘ä»¬ä¹‹å‰æå‡ºçš„ä¸¢å¤±ç»‘å®šé—®é¢˜ã€‚\n\n```js\nfunction sayHi(){\n    console.log('Hello,', this.name);\n}\nvar person = {\n    name: 'YvetteLau',\n    sayHi: sayHi\n}\nvar name = 'Wiliam';\nvar Hi = function(fn) {\n    fn();\n}\nHi.call(person, person.sayHi); \n```\n\n**ç­”æ¡ˆæ˜¯ï¼šHello, Wiliam**\n\nå…¶å®æˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œè¿™ä¸ª`fn`ä¸æ˜¯ç›´æ¥è¢«è°ƒç”¨çš„ï¼Œæ‰€ä»¥é€ æˆäº†éšå¼ä¸¢å¤±ã€‚æˆ‘ä»¬çš„`call`ç»‘å®šçš„`person`å…¶å®ç»‘å®šåœ¨äº†`Hi`ä¸Šé¢äº†ï¼Œä¸ä¿¡çš„è¯æˆ‘ä»¬æ”¹ä¸€ä¸‹ä½ å°±ä¼šå‘ç°äº†ã€‚\n\n```js\nfunction sayHi(){\n    console.log('Hello,', this.name);\n}\nvar person = {\n    name: 'YvetteLau',\n    sayHi: sayHi\n}\nvar name = 'Wiliam';\nvar Hi = function(fn) {\n  \tconsole.log(this.name)\n    fn();\n}\nHi.call(person, person.sayHi); \n```\n\nè¾“å‡ºäº†ä»€ä¹ˆï¼Ÿ\n\n**YvetteLau**\n\n**Hello, Wiliam**\n\né‚£ä¹ˆå’‹åŠå‘¢ï¼Ÿåˆ«æ€•æ˜¾ç¤ºç»‘å®šçš„å˜å¼‚ç‰ˆï¼Œç¡¬ç»‘å®šå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\n\n#### ç¡¬ç»‘å®š\n\nç¡¬ç»‘å®šå…¶å®å°±æ˜¯åœ¨æœ€åä¸€å±‚ç»™ä»–è¿›è¡Œæ˜¾ç¤ºç»‘å®šã€‚\n\nè¯·çœ‹ä»£ç ï¼š\n\n```js\nfunction sayHi(){\n    console.log('Hello,', this.name);\n}\nvar person = {\n    name: 'YvetteLau',\n    sayHi: sayHi\n}\nvar name = 'Wiliam';\nvar Hi = function(fn) {\n  \tconsole.log(this.name)\n    fn.call(person);\n}\nHi(person.sayHi); \n```\n\nè¾“å‡ºäº†ä»€ä¹ˆï¼Ÿ\n\n**YvetteLau**\n\n**Hello, Wiliam**\n\nè™½ç„¶æˆ‘ä»¬è°ƒç”¨`Hi`çš„æ—¶å€™ï¼Œåœ¨`call`ä¹‹å‰`this`è¿˜æ˜¯æŒ‡å‘äº†`window`ï¼Œä½†æ˜¯æˆ‘ä»¬ç”¨`call`ç»™ä»–ç»‘å®šä¸Šäº†`person`ã€‚æ— è®ºä¹‹åå¦‚ä½•è°ƒç”¨å‡½æ•° `fn`ï¼Œå®ƒ æ€»ä¼šæ‰‹åŠ¨åœ¨ `person` ä¸Šè°ƒç”¨ `fn`ã€‚è¿™ç§ç»‘å®šæ˜¯ä¸€ç§æ˜¾å¼çš„å¼ºåˆ¶ç»‘å®šï¼Œå› æ­¤æˆ‘ä»¬ç§°ä¹‹ä¸ºç¡¬ç»‘å®šã€‚\n\n```js\nfunction foo() {\n    console.log( this.a );\n}\n\nvar obj = {\n    a: 2\n};\n\nvar bar = function() {\n    foo.call( obj );\n};\n\nbar(); // 2\nsetTimeout( bar, 100 ); // 2\n\n// ç¡¬ç»‘å®šçš„barä¸å¯èƒ½å†ä¿®æ”¹å®ƒçš„this\nbar.call( window ); // 2\n```\n\nå…¸å‹åº”ç”¨åœºæ™¯æ˜¯åˆ›å»ºä¸€ä¸ªåŒ…è£¹å‡½æ•°ï¼Œè´Ÿè´£æ¥æ”¶å‚æ•°å¹¶è¿”å›å€¼ã€‚\n\n```js\nfunction foo(something) {\n    console.log( this.a, something );\n    return this.a + something;\n}\n\nvar obj = {\n    a: 2\n};\n\nvar bar = function() {\n    return foo.apply( obj, arguments );\n};\n\nvar b = bar( 3 ); // 2 3\nconsole.log( b ); // 5\n```\n\nåˆ›å»ºä¸€ä¸ªå¯ä»¥é‡å¤ä½¿ç”¨çš„è¾…åŠ©å‡½æ•°ã€‚\n\n```js\nfunction foo(something) {\n    console.log( this.a, something );\n    return this.a + something;\n}\n\n// ç®€å•çš„è¾…åŠ©ç»‘å®šå‡½æ•°\nfunction bind(fn, obj) {\n    return function() {\n        return fn.apply( obj, arguments );\n    }\n}\n\nvar obj = {\n    a: 2\n};\n\nvar bar = bind( foo, obj );\n\nvar b = bar( 3 ); // 2 3\nconsole.log( b ); // 5\n```\n\nES5å†…ç½®äº†`Function.prototype.bind`ï¼Œbindä¼šè¿”å›ä¸€ä¸ªç¡¬ç»‘å®šçš„æ–°å‡½æ•°ï¼Œç”¨æ³•å¦‚ä¸‹ã€‚\n\n```js\nfunction foo(something) {\n    console.log( this.a, something );\n    return this.a + something;\n}\n\nvar obj = {\n    a: 2\n};\n\nvar bar = foo.bind( obj );\n\nvar b = bar( 3 ); // 2 3\nconsole.log( b ); // 5\n```\n\nAPIè°ƒç”¨çš„â€œä¸Šä¸‹æ–‡â€\n\nJSè®¸å¤šå†…ç½®å‡½æ•°æä¾›äº†ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œè¢«ç§°ä¹‹ä¸ºâ€œä¸Šä¸‹æ–‡â€ï¼ˆcontextï¼‰ï¼Œå…¶ä½œç”¨å’Œ`bind(..)`ä¸€æ ·ï¼Œç¡®ä¿å›è°ƒå‡½æ•°ä½¿ç”¨æŒ‡å®šçš„thisã€‚è¿™äº›å‡½æ•°å®é™…ä¸Šé€šè¿‡`call(..)`å’Œ`apply(..)`å®ç°äº†æ˜¾å¼ç»‘å®šã€‚\n\n```js\nfunction foo(el) {\n\tconsole.log( el, this.id );\n}\n\nvar obj = {\n    id: \"awesome\"\n}\n\nvar myArray = [1, 2, 3]\n// è°ƒç”¨foo(..)æ—¶æŠŠthisç»‘å®šåˆ°obj\nmyArray.forEach( foo, obj );\n// 1 awesome 2 awesome 3 awesome\n```\n\n### new ç»‘å®š\n\nä½¿ç”¨ new æ¥è°ƒç”¨å‡½æ•°ï¼Œæˆ–è€…è¯´å‘ç”Ÿæ„é€ å‡½æ•°è°ƒç”¨æ—¶ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œä¸‹é¢çš„æ“ä½œã€‚\n\n1. åˆ›å»º(æˆ–è€…è¯´æ„é€ )ä¸€ä¸ªå…¨æ–°çš„å¯¹è±¡ã€‚\n2. è¿™ä¸ªæ–°å¯¹è±¡ä¼šè¢«æ‰§è¡Œ[[åŸå‹]]è¿æ¥ã€‚\n3. è¿™ä¸ªæ–°å¯¹è±¡ä¼šç»‘å®šåˆ°å‡½æ•°è°ƒç”¨çš„thisã€‚\n4. å¦‚æœå‡½æ•°æ²¡æœ‰è¿”å›å…¶ä»–å¯¹è±¡ï¼Œé‚£ä¹ˆnewè¡¨è¾¾å¼ä¸­çš„å‡½æ•°è°ƒç”¨ä¼šè‡ªåŠ¨è¿”å›è¿™ä¸ªæ–°å¯¹è±¡ã€‚\n\næ€è€ƒä¸‹é¢çš„ä»£ç :\n\n```js\nvar a = 4\nfunction foo(a) { \n  this.a = a;\n}\nvar bar = new foo(2); \nconsole.log( bar.a );  // 2\n```\n\nä½¿ç”¨`new`æ¥è°ƒç”¨`foo(..)`æ—¶ï¼Œä¼šæ„é€ ä¸€ä¸ªæ–°å¯¹è±¡å¹¶æŠŠå®ƒï¼ˆ`bar`ï¼‰ç»‘å®šåˆ°`foo(..)`è°ƒç”¨ä¸­çš„thisã€‚\n\n### ç»‘å®šä¼˜å…ˆçº§\n\nçœ‹å®Œè§„åˆ™ï¼Œæˆ‘ä»¬è‚¯å®šæƒ³çŸ¥é“å¦‚æœè¿™äº›è§„åˆ™æ’åœ¨ä¸€èµ·ï¼Œæˆ‘ä»¬åˆè¯¥å¬è°çš„å‘¢ï¼Ÿ\n\næ¯«æ— ç–‘é—®ï¼Œé»˜è®¤ç»‘å®šçš„ä¼˜å…ˆçº§æ˜¯å››æ¡è§„åˆ™ä¸­æœ€ä½çš„ï¼Œå› ä¸ºæ˜¯æ²¡äººåº”ç”¨ä»»ä½•è§„åˆ™æ‰ä¼šå»åº”ç”¨é»˜è®¤ç»‘å®šã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…ˆä¸è€ƒè™‘å®ƒã€‚ éšå¼ç»‘å®šå’Œæ˜¾å¼ç»‘å®šå“ªä¸ªä¼˜å…ˆçº§æ›´é«˜?æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹:\n\n\n\n```js\nfunction foo() { \n\tconsole.log( this.a );\n}\nvar obj1 = { \n\ta: 2,\n\tfoo: foo \n};\nvar obj2 = { \n\ta: 3,\n\tfoo: foo \n};\nobj1.foo(); // 2 \nobj2.foo(); // 3\nobj1.foo.call( obj2 ); // 3 \nobj2.foo.call( obj1 ); // 2\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œæ˜¾å¼ç»‘å®šä¼˜å…ˆçº§æ›´é«˜ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨åˆ¤æ–­æ—¶åº”å½“å…ˆè€ƒè™‘æ˜¯å¦å¯ä»¥åº”ç”¨æ˜¾å¼ç»‘å®šã€‚ ç°åœ¨æˆ‘ä»¬éœ€è¦ææ¸…æ¥š new ç»‘å®šå’Œéšå¼ç»‘å®šçš„ä¼˜å…ˆçº§è°é«˜è°ä½:\n\n```js\nfunction foo(something) { \t\n\tthis.a = something;\n}\nvar obj1 = { \n\tfoo: foo\n};\nvar obj2 = {};\nobj1.foo( 2 );\nconsole.log( obj1.a ); // 2\nobj1.foo.call( obj2, 3 ); \nconsole.log( obj2.a ); // 3\nvar bar = new obj1.foo( 4 ); \nconsole.log( obj1.a ); // 2 \nconsole.log( bar.a ); // 4\n```\n\nå¯ä»¥çœ‹åˆ° new ç»‘å®šæ¯”éšå¼ç»‘å®šä¼˜å…ˆçº§é«˜ã€‚ä½†æ˜¯ new ç»‘å®šå’Œæ˜¾å¼ç»‘å®šè°çš„ä¼˜å…ˆçº§æ›´é«˜å‘¢?\n\n> new å’Œ call/apply æ— æ³•ä¸€èµ·ä½¿ç”¨ï¼Œå› æ­¤æ— æ³•é€šè¿‡ new foo.call(obj1) æ¥ç›´æ¥ è¿›è¡Œæµ‹è¯•ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¡¬ç»‘å®šæ¥æµ‹è¯•å®ƒä¿©çš„ä¼˜å…ˆçº§ã€‚\n>\n> è¿™æ˜¯å› ä¸ºå‡½æ•°å†…éƒ¨æœ‰ä¸¤ä¸ªä¸åŒçš„æ–¹æ³•ï¼š`[[Call]]`å’Œ`[[Constructor]]`ã€‚ å½“ä½¿ç”¨æ™®é€šå‡½æ•°è°ƒç”¨æ—¶ï¼Œ`[[Call]]`ä¼šè¢«æ‰§è¡Œã€‚å½“ä½¿ç”¨æ„é€ å‡½æ•°è°ƒç”¨æ—¶ï¼Œ`[[Constructor]]`ä¼šè¢«æ‰§è¡Œã€‚`call`ã€`apply`ã€`bind`å’Œç®­å¤´å‡½æ•°å†…éƒ¨æ²¡æœ‰`[[Constructor]]`æ–¹æ³•ã€‚\n\n```js\n\nfunction foo(something) { \n\tthis.a = something;\n}\nvar obj1 = {};\nvar bar = foo.bind( obj1 ); \nbar( 2 );\nconsole.log( obj1.a ); // 2\nvar baz = new bar(3); \nconsole.log( obj1.a ); // 2 \nconsole.log( baz.a ); // 3\n```\n\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°newæŠŠbindçš„ç¡¬ç»‘å®šç»™é¡¶æ‰äº†\n\næ‰€ä»¥new  > ç¡¬ç»‘å®š\n\n#### æ€»ç»“\n\n> new ç»‘å®š > æ˜¾ç¤ºç»‘å®š > éšå¼ç»‘å®š > é»˜è®¤ç»‘å®š\n\n### ç»‘å®šä¾‹å¤–\n\n#### è¢«å¿½ç•¥çš„this\n\næŠŠ`null`æˆ–è€…`undefined`ä½œä¸º`this`çš„ç»‘å®šå¯¹è±¡ä¼ å…¥`call`ã€`apply`æˆ–è€…`bind`ï¼Œè¿™äº›å€¼åœ¨è°ƒç”¨æ—¶ä¼šè¢«å¿½ç•¥ï¼Œå®é™…åº”ç”¨çš„æ˜¯é»˜è®¤è§„åˆ™ã€‚\n\nä¸‹é¢ä¸¤ç§æƒ…å†µä¸‹ä¼šä¼ å…¥`null`\n\n- ä½¿ç”¨`apply(..)`æ¥â€œå±•å¼€â€ä¸€ä¸ªæ•°ç»„ï¼Œå¹¶å½“ä½œå‚æ•°ä¼ å…¥ä¸€ä¸ªå‡½æ•°\n- `bind(..)`å¯ä»¥å¯¹å‚æ•°è¿›è¡ŒæŸ¯é‡ŒåŒ–ï¼ˆé¢„å…ˆè®¾ç½®ä¸€äº›å‚æ•°ï¼‰\n\n```js\nfunction foo(a, b) {\n    console.log( \"a:\" + a + \"ï¼Œb:\" + b );\n}\n\n// æŠŠæ•°ç»„â€å±•å¼€â€œæˆå‚æ•°\nfoo.apply( null, [2, 3] ); // a:2ï¼Œb:3\n\n// ä½¿ç”¨bind(..)è¿›è¡ŒæŸ¯é‡ŒåŒ–\nvar bar = foo.bind( null, 2 );\nbar( 3 ); // a:2ï¼Œb:3 \n```\n\næ€»æ˜¯ä¼ å…¥`null`æ¥å¿½ç•¥thisç»‘å®šå¯èƒ½äº§ç”Ÿä¸€äº›å‰¯ä½œç”¨ã€‚å¦‚æœæŸä¸ªå‡½æ•°ç¡®å®ä½¿ç”¨äº†thisï¼Œé‚£é»˜è®¤ç»‘å®šè§„åˆ™ä¼šæŠŠthisç»‘å®šåˆ°å…¨å±€å¯¹è±¡ä¸­ã€‚\n\n> æ›´å®‰å…¨çš„this\n\nå®‰å…¨çš„åšæ³•å°±æ˜¯ä¼ å…¥ä¸€ä¸ªç‰¹æ®Šçš„å¯¹è±¡ï¼ˆç©ºå¯¹è±¡ï¼‰ï¼ŒæŠŠthisç»‘å®šåˆ°è¿™ä¸ªå¯¹è±¡ä¸ä¼šå¯¹ä½ çš„ç¨‹åºäº§ç”Ÿä»»ä½•å‰¯ä½œç”¨ã€‚\n\nJSä¸­åˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡æœ€ç®€å•çš„æ–¹æ³•æ˜¯**`Object.create(null)`**ï¼Œè¿™ä¸ªå’Œ`{}`å¾ˆåƒï¼Œä½†æ˜¯å¹¶ä¸ä¼šåˆ›å»º`Object.prototype`è¿™ä¸ªå§”æ‰˜ï¼Œæ‰€ä»¥æ¯”`{}`æ›´ç©ºã€‚\n\n```js\nfunction foo(a, b) {\n    console.log( \"a:\" + a + \"ï¼Œb:\" + b );\n}\n\n// æˆ‘ä»¬çš„ç©ºå¯¹è±¡\nvar Ã¸ = Object.create( null );\n\n// æŠŠæ•°ç»„â€å±•å¼€â€œæˆå‚æ•°\nfoo.apply( Ã¸, [2, 3] ); // a:2ï¼Œb:3\n\n// ä½¿ç”¨bind(..)è¿›è¡ŒæŸ¯é‡ŒåŒ–\nvar bar = foo.bind( Ã¸, 2 );\nbar( 3 ); // a:2ï¼Œb:3 \n```\n\n#### é—´æ¥å¼•ç”¨\n\né—´æ¥å¼•ç”¨ä¸‹ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°ä¼šåº”ç”¨é»˜è®¤ç»‘å®šè§„åˆ™ã€‚é—´æ¥å¼•ç”¨æœ€å®¹æ˜“åœ¨**èµ‹å€¼**æ—¶å‘ç”Ÿã€‚\n\n```js\n// p.foo = o.fooçš„è¿”å›å€¼æ˜¯ç›®æ ‡å‡½æ•°çš„å¼•ç”¨ï¼Œæ‰€ä»¥è°ƒç”¨ä½ç½®æ˜¯foo()è€Œä¸æ˜¯p.foo()æˆ–è€…o.foo()\nfunction foo() {\n    console.log( this.a );\n}\n\nvar a = 2;\nvar o = { a: 3, foo: foo };\nvar p = { a: 4};\n\no.foo(); // 3\n(p.foo = o.foo)(); // 2\n```\n\n####  è½¯ç»‘å®š\n\n- ç¡¬ç»‘å®šå¯ä»¥æŠŠthiså¼ºåˆ¶ç»‘å®šåˆ°æŒ‡å®šçš„å¯¹è±¡ï¼ˆ`new`é™¤å¤–ï¼‰ï¼Œé˜²æ­¢å‡½æ•°è°ƒç”¨åº”ç”¨é»˜è®¤ç»‘å®šè§„åˆ™ã€‚ä½†æ˜¯ä¼šé™ä½å‡½æ•°çš„çµæ´»æ€§ï¼Œä½¿ç”¨**ç¡¬ç»‘å®šä¹‹åå°±æ— æ³•ä½¿ç”¨éšå¼ç»‘å®šæˆ–è€…æ˜¾å¼ç»‘å®šæ¥ä¿®æ”¹this**ã€‚\n- **å¦‚æœç»™é»˜è®¤ç»‘å®šæŒ‡å®šä¸€ä¸ªå…¨å±€å¯¹è±¡å’Œundefinedä»¥å¤–çš„å€¼**ï¼Œé‚£å°±å¯ä»¥å®ç°å’Œç¡¬ç»‘å®šç›¸åŒçš„æ•ˆæœï¼ŒåŒæ—¶ä¿ç•™éšå¼ç»‘å®šæˆ–è€…æ˜¾ç¤ºç»‘å®šä¿®æ”¹thisçš„èƒ½åŠ›ã€‚\n\n```js\n// é»˜è®¤ç»‘å®šè§„åˆ™ï¼Œä¼˜å…ˆçº§æ’æœ€å\n// å¦‚æœthisç»‘å®šåˆ°å…¨å±€å¯¹è±¡æˆ–è€…undefinedï¼Œé‚£å°±æŠŠæŒ‡å®šçš„é»˜è®¤å¯¹è±¡objç»‘å®šåˆ°this,å¦åˆ™ä¸ä¼šä¿®æ”¹this\nif(!Function.prototype.softBind) {\n    Function.prototype.softBind = function(obj) {\n        var fn = this;\n        // æ•è·æ‰€æœ‰curriedå‚æ•°\n        var curried = [].slice.call( arguments, 1 ); \n        var bound = function() {\n            return fn.apply(\n            \t(!this || this === (window || global)) ? \n                \tobj : this,\n                curried.concat.apply( curried, arguments )\n            );\n        };\n        bound.prototype = Object.create( fn.prototype );\n        return bound;\n    };\n}\n```\n\nä½¿ç”¨ï¼šè½¯ç»‘å®šç‰ˆæœ¬çš„foo()å¯ä»¥æ‰‹åŠ¨å°†thisç»‘å®šåˆ°obj2æˆ–è€…obj3ä¸Šï¼Œä½†å¦‚æœåº”ç”¨é»˜è®¤ç»‘å®šï¼Œåˆ™ä¼šå°†thisç»‘å®šåˆ°objã€‚\n\n```js\nfunction foo() {\n    console.log(\"name:\" + this.name);\n}\n\nvar obj = { name: \"obj\" },\n    obj2 = { name: \"obj2\" },\n    obj3 = { name: \"obj3\" };\n\n// é»˜è®¤ç»‘å®šï¼Œåº”ç”¨è½¯ç»‘å®šï¼Œè½¯ç»‘å®šæŠŠthisç»‘å®šåˆ°é»˜è®¤å¯¹è±¡obj\nvar fooOBJ = foo.softBind( obj );\nfooOBJ(); // name: obj \n\n// éšå¼ç»‘å®šè§„åˆ™\nobj2.foo = foo.softBind( obj );\nobj2.foo(); // name: obj2 <---- çœ‹ï¼ï¼ï¼\n\n// æ˜¾å¼ç»‘å®šè§„åˆ™\nfooOBJ.call( obj3 ); // name: obj3 <---- çœ‹ï¼ï¼ï¼\n\n// ç»‘å®šä¸¢å¤±ï¼Œåº”ç”¨è½¯ç»‘å®š\nsetTimeout( obj2.foo, 10 ); // name: obj\n```\n\n### ç®­å¤´å‡½æ•°\n\nES6æ–°å¢ä¸€ç§ç‰¹æ®Šå‡½æ•°ç±»å‹ï¼šç®­å¤´å‡½æ•°ï¼Œç®­å¤´å‡½æ•°æ— æ³•ä½¿ç”¨ä¸Šè¿°å››æ¡è§„åˆ™ï¼Œè€Œæ˜¯æ ¹æ®å¤–å±‚ï¼ˆå‡½æ•°æˆ–è€…å…¨å±€ï¼‰ä½œç”¨åŸŸï¼ˆ**è¯æ³•ä½œç”¨åŸŸ**ï¼‰æ¥å†³å®šthisã€‚\n\n- `foo()`å†…éƒ¨åˆ›å»ºçš„ç®­å¤´å‡½æ•°ä¼šæ•è·è°ƒç”¨æ—¶`foo()`çš„thisã€‚ç”±äº`foo()`çš„thisç»‘å®šåˆ°`obj1`ï¼Œ`bar`(å¼•ç”¨ç®­å¤´å‡½æ•°)çš„thisä¹Ÿä¼šç»‘å®šåˆ°`obj1`ï¼Œ**ç®­å¤´å‡½æ•°çš„ç»‘å®šæ— æ³•è¢«ä¿®æ”¹**(`new`ä¹Ÿä¸è¡Œ)ã€‚\n\n```js\nfunction foo() {\n    // è¿”å›ä¸€ä¸ªç®­å¤´å‡½æ•°\n    return (a) => {\n        // thisç»§æ‰¿è‡ªfoo()\n        console.log( this.a );\n    };\n}\n\nvar obj1 = {\n    a: 2\n};\n\nvar obj2 = {\n    a: 3\n}\n\nvar bar = foo.call( obj1 );\nbar.call( obj2 ); // 2ï¼Œä¸æ˜¯3ï¼\n```\n\n\n\nç®­å¤´å‡½æ•°æœ€å¸¸ç”¨äºå›è°ƒå‡½æ•°ä¸­ï¼Œä¾‹å¦‚äº‹ä»¶å¤„ç†å™¨æˆ–è€…å®šæ—¶å™¨ï¼š\n\n\n\n```js\n\nfunction foo() { \n  setTimeout(() => {\n    // è¿™é‡Œçš„ this åœ¨æ­¤æ³•ä¸Šç»§æ‰¿è‡ª foo()\n    console.log( this.a ); },100);\n  }\nvar obj = { \n\ta:2\n};\nfoo.call( obj ); // 2\n\n```\n\n\n\nES6ä¹‹å‰å’Œç®­å¤´å‡½æ•°ç±»ä¼¼çš„æ¨¡å¼ï¼Œé‡‡ç”¨çš„æ˜¯è¯æ³•ä½œç”¨åŸŸå–ä»£äº†ä¼ ç»Ÿçš„thisæœºåˆ¶ã€‚\n\n\n\n```js\nfunction foo() {\n    var self = this; // lexical capture of this\n    setTimeout( function() {\n        console.log( self.a ); // selfåªæ˜¯ç»§æ‰¿äº†foo()å‡½æ•°çš„thisç»‘å®š\n    }, 100 );\n}\n\nvar obj = {\n    a: 2\n};\n\nfoo.call(obj); // 2\n```\n\n## å®ç°callå’Œapply\n\n### äº†è§£callå’Œapply\n\nä¸ºä»€ä¹ˆä¼šæœ‰callå’Œapplyï¼Ÿ callå’Œapplyä¸¤ä¸ªæ–¹æ³•çš„ä½œç”¨åŸºæœ¬ç›¸åŒï¼Œå®ƒä»¬éƒ½æ˜¯ä¸ºäº†æ”¹å˜æŸä¸ªå‡½æ•°**æ‰§è¡Œæ—¶çš„ä¸Šä¸‹æ–‡**ï¼ˆcontextï¼‰è€Œå»ºç«‹çš„ï¼Œ ä»–çš„çœŸæ­£å¼ºå¤§ä¹‹å¤„å°±æ˜¯èƒ½å¤Ÿæ‰©å……å‡½æ•°èµ–ä»¥è¿è¡Œçš„ä½œç”¨åŸŸã€‚é€šä¿—ä¸€ç‚¹è®²ï¼Œå°±æ˜¯æ”¹å˜å‡½æ•°ä½“å†…éƒ¨**this çš„æŒ‡å‘**ã€‚\n\n\n\nä¸¾ä¸ªæ —å­ï¼š\n\n```\nwindow.color = \"red\";\nvar o = {color: \"blue\"};\nfunction sayColor(){\n\talert(this.color);\n}\nsayColor();//red\nsayColor.call(this);//redï¼ŒæŠŠå‡½æ•°ä½“sayColorå†…éƒ¨çš„thisï¼Œç»‘åˆ°å½“å‰ç¯å¢ƒï¼ˆä½œç”¨åŸŸï¼‰(è¿™æ®µä»£ç æ‰€å¤„çš„ç¯å¢ƒ)\nsayColor.call(window);//redï¼ŒæŠŠå‡½æ•°ä½“sayColorå†…éƒ¨çš„thisï¼Œç»‘åˆ°windowï¼ˆå…¨å±€ä½œç”¨åŸŸï¼‰\nsayColor.call(o);//blueå¤åˆ¶ä»£ç \n```\n\n\n\n> **è§£é‡Šï¼š**ä¸Šé¢çš„æ —å­ï¼Œå¾ˆæ˜æ˜¾å‡½æ•°sayColoræ˜¯åœ¨å…¨å±€ä½œç”¨åŸŸï¼ˆç¯å¢ƒ/windowï¼‰ä¸­è°ƒç”¨çš„ï¼Œè€Œå…¨å±€ä½œç”¨åŸŸä¸­æœ‰ä¸€ä¸ªcolorå±æ€§ï¼Œå€¼ä¸º\"red\"ï¼ŒsayColor.call(this)è¿™ä¸€è¡Œä»£ç å°±æ˜¯è¡¨ç¤º**æŠŠå‡½æ•°ä½“sayColorå†…éƒ¨çš„thisï¼Œç»‘åˆ°å½“å‰ç¯å¢ƒï¼ˆä½œç”¨åŸŸï¼‰**ï¼Œè€ŒsayColor.call(window)è¿™ä¸€è¡Œä»£ç å°±æ˜¯è¡¨ç¤º**æŠŠå‡½æ•°ä½“sayColorå†…éƒ¨çš„thisï¼Œç»‘åˆ°windowï¼ˆå…¨å±€ä½œç”¨åŸŸï¼‰**ï¼Œä¹‹æ‰€ä»¥è¿™ä¸¤è¡Œçš„è¾“å‡ºéƒ½æ˜¯\"red\"å°±æ˜¯å› ä¸ºä»–å½“å‰ä½œç”¨åŸŸçš„thiså°±æ˜¯windowï¼ˆthis === windowï¼‰ï¼› æœ€åï¼ŒsayColor.call(o)è¿™ä¸€è¡Œä»£ç å°±è¡¨ç¤º**æŠŠå‡½æ•°ä½“sayColorå†…éƒ¨çš„thisï¼Œç»‘åˆ°oè¿™ä¸ªå¯¹è±¡çš„æ‰§è¡Œç¯å¢ƒï¼ˆä¸Šä¸‹æ–‡ï¼‰ä¸­æ¥**ï¼Œä¹Ÿå°±æ˜¯è¯´sayColorå†…éƒ¨çš„thisâ€”â€”>**o**\n\n### callå’Œapplyçš„åŒºåˆ«\n\n`call()` å’Œ `apply()`çš„åŒºåˆ«åœ¨äºï¼Œ`call()`æ–¹æ³•æ¥å—çš„æ˜¯**è‹¥å¹²ä¸ªå‚æ•°çš„åˆ—è¡¨**ï¼Œè€Œ`apply()`æ–¹æ³•æ¥å—çš„æ˜¯**ä¸€ä¸ªåŒ…å«å¤šä¸ªå‚æ•°çš„æ•°ç»„**\n\nä¸¾ä¸ªä¾‹å­ï¼š\n\n```js\nvar func = function(arg1, arg2) {\n     ...\n};\n\nfunc.call(this, arg1, arg2); // ä½¿ç”¨ callï¼Œå‚æ•°åˆ—è¡¨\nfunc.apply(this, [arg1, arg2]) // ä½¿ç”¨ applyï¼Œå‚æ•°æ•°ç»„\n```\n\n### åº”ç”¨åœºæ™¯\n\nå…¶å®è¿™äº›åº”ç”¨åœºæ™¯éƒ½æœ‰æ–°çš„æ–¹æ³•å¯ä»¥å¿«é€Ÿè§£å†³ï¼Œ æˆ‘åªæ˜¯æƒ³å‘Šè¯‰å¤§å®¶ä¸€äº›å°çš„çŸ¥è¯†ç‚¹ï¼Œ è€Œä¸”è¿™äº›ä¸œè¥¿è™½ç„¶æœ‰æ–°çš„æ–¹æ³•ä»£æ›¿ï¼Œä½†æ˜¯é¢è¯•çš„æ—¶å€™å¾ˆå¯èƒ½ä¼šè¢«é—®åˆ°ã€‚\n\n#### åˆå¹¶ä¸¤ä¸ªæ•°ç»„\n\n\n\n```js\nvar a = ['a', 'aa'];\nvar b = ['b', 'bb'];\n\nArray.prototype.push.apply(a, b);\nconsole.log(a) // ['a', 'aa', 'b', 'bb']\n```\n\nå…¶å®ç°åœ¨æœ‰`concat`æ¥ä»£æ›¿äº†ã€‚æˆ–è€…å…¶ä»–å¥‡æ·«æŠ€å·§ã€‚ä½†æ˜¯ï¼Œéƒ½ä¸æ˜¯æˆ‘ä»¬çš„é‡ç‚¹ã€‚\n\n> å½“ç¬¬äºŒä¸ªæ•°ç»„(å¦‚ç¤ºä¾‹ä¸­çš„ b )å¤ªå¤§æ—¶ä¸è¦ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ¥åˆå¹¶æ•°ç»„ï¼Œå› ä¸º**ä¸€ä¸ªå‡½æ•°èƒ½å¤Ÿæ¥å—çš„å‚æ•°ä¸ªæ•°æ˜¯æœ‰é™åˆ¶**çš„ã€‚ä¸åŒçš„å¼•æ“æœ‰ä¸åŒçš„é™åˆ¶ï¼ŒJSæ ¸å¿ƒé™åˆ¶åœ¨ 65535ï¼Œæœ‰äº›å¼•æ“ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæœ‰äº›ä¸æŠ›å‡ºå¼‚å¸¸ä½†ä¸¢å¤±å¤šä½™å‚æ•°ã€‚\n\né‚£ä¹ˆè¦å¦‚ä½•è§£å†³å‘¢ï¼Ÿ\n\næˆ‘ä»¬å¯ä»¥æŠŠæ•°ç»„è¿›è¡Œåˆ‡å‰²ã€‚ç„¶ååˆ†æ‰¹æ¬¡çš„è°ƒç”¨ã€‚\n\n\n\n```js\nfunction myConcat(arr1, arr2, max = 32768) {\n  for(var i = 0; i < arr2.length; i += max) {\n    Array.prototype.push.apply(\n    \tarr1,\n      arr2.slice(i, i + max) // å°çš„çŸ¥è¯†ç‚¹ï¼Œç¬¬äºŒä¸ªå‚æ•°å¤§äºæ•°ç»„é•¿åº¦å°±ä¸€ç›´å–åˆ°æ•°ç»„çš„æœ«å°¾\n    )\n  }\n}\n\nvar a = [-2, -1];\nvar b = [];\nfor(var i = 0; i < 999999; i ++) {\n  b.push(i)\n}\n\nArray.prototype.push.apply(a, b) // Uncaught RangeError: Maximum call stack size exceeded\n\n\nmyConcat(a, b)\n```\n\n#### éªŒè¯æ˜¯å¦æ˜¯æ•°ç»„\n\n#### \n\n```js\nvar arr = [];\nObject.prototype.toString.call(arr); // [object Array]\n//æŠŠå‡½æ•°ä½“Object.prototype.toString()æ–¹æ³•å†…éƒ¨çš„thisï¼Œç»‘åˆ°arrçš„æ‰§è¡Œç¯å¢ƒï¼ˆä½œç”¨åŸŸï¼‰å¤åˆ¶ä»£ç \n```\n\n\n\n#### åŒæ ·æ˜¯æ£€æµ‹å¯¹è±¡ç±»å‹ï¼Œarr.toString()çš„ç»“æœå’ŒObject.prototype.toString.call(arr)çš„ç»“æœä¸ä¸€æ ·ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ\n\n> è¿™æ˜¯å› ä¸ºtoString()ä¸ºObjectçš„åŸå‹æ–¹æ³•ï¼Œè€ŒArray ï¼Œfunctionç­‰å¼•ç”¨ç±»å‹ä½œä¸ºObjectçš„å®ä¾‹ï¼Œéƒ½é‡å†™äº†toStringæ–¹æ³•ã€‚ä¸åŒçš„å¯¹è±¡ç±»å‹è°ƒç”¨toStringæ–¹æ³•æ—¶ï¼Œæ ¹æ®åŸå‹é“¾çš„çŸ¥è¯†ï¼Œè°ƒç”¨çš„æ˜¯å¯¹åº”çš„**é‡å†™**ä¹‹åçš„toStringæ–¹æ³•ï¼ˆfunctionç±»å‹è¿”å›å†…å®¹ä¸ºå‡½æ•°ä½“çš„å­—ç¬¦ä¸²ï¼ŒArrayç±»å‹è¿”å›å…ƒç´ ç»„æˆçš„å­—ç¬¦ä¸².....ï¼‰ï¼Œè€Œä¸ä¼šå»è°ƒç”¨Objectä¸ŠåŸå‹toStringæ–¹æ³•ï¼Œæ‰€ä»¥é‡‡ç”¨arr.toString()ä¸èƒ½å¾—åˆ°å…¶å¯¹è±¡ç±»å‹ï¼Œåªèƒ½å°†arrè½¬æ¢ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼›å› æ­¤ï¼Œåœ¨æƒ³è¦å¾—åˆ°å¯¹è±¡çš„å…·ä½“ç±»å‹æ—¶ï¼Œåº”è¯¥è°ƒç”¨Objectä¸ŠåŸå‹toStringæ–¹æ³•ã€‚\n\n#### ç±»æ•°ç»„å¯¹è±¡ï¼ˆArray-like Objectï¼‰ä½¿ç”¨æ•°ç»„æ–¹æ³•\n\n```js\nvar domNodes = document.getElementsByTagName(\"*\");\ndomNodes.unshift(\"h1\");\n// TypeError: domNodes.unshift is not a function\n\nvar domNodeArrays = Array.prototype.slice.call(domNodes);\ndomNodeArrays.unshift(\"h1\"); // 505 ä¸åŒç¯å¢ƒä¸‹æ•°æ®ä¸åŒ\n// (505) [\"h1\", html.gr__hujiang_com, head, meta, ...] \n```\n\nç±»æ•°ç»„å¯¹è±¡æœ‰ä¸‹é¢ä¸¤ä¸ªç‰¹æ€§\n\n- 1ã€å…·æœ‰ï¼šæŒ‡å‘å¯¹è±¡å…ƒç´ çš„æ•°å­—ç´¢å¼•ä¸‹æ ‡å’Œ `length` å±æ€§\n- 2ã€ä¸å…·æœ‰ï¼šæ¯”å¦‚ `push` ã€`shift`ã€ `forEach` ä»¥åŠ `indexOf`ç­‰æ•°ç»„å¯¹è±¡å…·æœ‰çš„æ–¹æ³•\n\nè¦è¯´æ˜çš„æ˜¯ï¼Œç±»æ•°ç»„å¯¹è±¡æ˜¯ä¸€ä¸ª**å¯¹è±¡**ã€‚JSä¸­å­˜åœ¨ä¸€ç§åä¸º**ç±»æ•°ç»„**çš„å¯¹è±¡ç»“æ„ï¼Œæ¯”å¦‚ `arguments` å¯¹è±¡ï¼Œè¿˜æœ‰DOM API è¿”å›çš„ `NodeList` å¯¹è±¡éƒ½å±äºç±»æ•°ç»„å¯¹è±¡ï¼Œç±»æ•°ç»„å¯¹è±¡ä¸èƒ½ä½¿ç”¨ `push/pop/shift/unshift` ç­‰æ•°ç»„æ–¹æ³•ï¼Œé€šè¿‡ `Array.prototype.slice.call` è½¬æ¢æˆçœŸæ­£çš„æ•°ç»„ï¼Œå°±å¯ä»¥ä½¿ç”¨ `Array`ä¸‹æ‰€æœ‰æ–¹æ³•ã€‚\n\n**ç±»æ•°ç»„å¯¹è±¡è½¬æ•°ç»„**çš„å…¶ä»–æ–¹æ³•ï¼š\n\n```js\n// ä¸Šé¢ä»£ç ç­‰åŒäº\nvar arr = [].slice.call(arguments)ï¼›\n\nES6:\nlet arr = Array.from(arguments);\nlet arr = [...arguments];\n```\n\n`Array.from()` å¯ä»¥å°†ä¸¤ç±»å¯¹è±¡è½¬ä¸ºçœŸæ­£çš„æ•°ç»„ï¼š**ç±»æ•°ç»„**å¯¹è±¡å’Œ**å¯éå†**ï¼ˆiterableï¼‰å¯¹è±¡ï¼ˆåŒ…æ‹¬ES6æ–°å¢çš„æ•°æ®ç»“æ„ Set å’Œ Mapï¼‰ã€‚\n\n### å®ç°call\n\nè¿™é‡Œä¼šä½¿ç”¨éšå¼ç»‘å®šæ¥å®ç°ã€‚\n\nå…ˆä¸¢å‡ºæˆ‘ä»¬è¦æµ‹è¯•çš„ä¾‹å­ï¼š\n\n```js\nvar a = 1;\nfunction f () {\n  console.log(this.a)\n}\nvar b = {\n  a: 2\n}\nf(); // 1\nf.call(b) // 2\n```\n\nOK, æˆ‘ä»¬ç°åœ¨å°±æ¥å®ç°ä»¥ä¸‹è‡ªå®šä¹‰çš„callã€‚åº”ç”¨éšå¼ç»‘å®šçš„è¯å°±å¯ä»¥ç›´æ¥ç»‘å®šä¸Šäº†ã€‚\n\n```js\n\nvar a = 1;\nfunction f () {\n  console.log(this.a)\n}\n\nFunction.prototype.myCall = function (context) {\n  context.fn = f;\n  context.fn();\n  delete context.fn;\n}\n\nvar b = {\n  a: 2\n}\nf(); // 1\nf.myCall(b) // 2\n```\n\nå¾ˆæ½‡æ´’çš„å®Œæˆäº†ã€‚ä½†æ˜¯å¥½åƒä¸èƒ½æ¥å—å‚æ•°è¯¶ï¼Œæ¥å—å‚æ•°åˆè¦è€ƒè™‘è¾¹ç•Œæƒ…å†µï¼Œæ¯”å¦‚`undefined`ï¼Œ`null`ä¹‹ç±»çš„ã€‚è€Œä¸”ï¼ï¼è€Œä¸”ï¼ï¼è€Œä¸”`call`ä¸ä¼ çš„è¯æ˜¯é»˜è®¤åº”ç”¨`window`çš„ï¼›\n\næ‰€ä»¥ä»–æœ‰æˆ‘ä»¬ä¹Ÿè¦æœ‰ï¼å†²ï¼\n\n```js\nFunction.prototype.myCall = function(context) {\n  // å–å¾—ä¼ å…¥çš„å¯¹è±¡ï¼ˆæ‰§è¡Œä¸Šä¸‹æ–‡ï¼‰ï¼Œæ¯”å¦‚ä¸Šæ–‡çš„fooå¯¹è±¡ï¼Œè¿™é‡Œçš„contextå°±ç›¸å½“äºä¸Šæ–‡çš„foo\n  // ä¸ä¼ ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œé»˜è®¤æ˜¯window,\n  var context = context || window;\n  // ç»™contextæ·»åŠ ä¸€ä¸ªå±æ€§ï¼Œè¿™æ—¶çš„thisæŒ‡å‘è°ƒç”¨myCallçš„å‡½æ•°ï¼Œæ¯”å¦‚ä¸Šæ–‡çš„barå‡½æ•°\n  context.fn = this;//è¿™é‡Œçš„context.fnå°±ç›¸å½“äºä¸Šæ–‡çš„barå‡½æ•°\n  // é€šè¿‡å±•å¼€è¿ç®—ç¬¦å’Œè§£æ„èµ‹å€¼å–å‡ºcontextåé¢çš„å‚æ•°ï¼Œä¸Šæ–‡çš„ä¾‹å­æ²¡æœ‰ä¼ å…¥å‚æ•°åˆ—è¡¨\n  var args = [...arguments].slice(1);\n  // æ‰§è¡Œå‡½æ•°ï¼ˆç›¸å½“äºä¸Šæ–‡çš„bar(...args)ï¼‰\n  var result = context.fn(...args);\n  // åˆ é™¤å‡½æ•°\n  delete context.fn;\n  return result;\n};\n\n```\n\n###  å®ç°apply\n\nå› ä¸ºä»–ä»¬ä¸¤å…„å¼Ÿå°±å‚æ•°ä¸ä¸€æ ·æ‰€ä»¥å°±ä¸è§£é‡Šäº†ï¼Œç›´æ¥çœ‹ä»£ç å§ã€‚\n\n```js\nFunction.prototype.myApply = function(context) {\n      var context = context || window;\n      context.fn = this;\n      var result;\n      // åˆ¤æ–­ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¦å­˜åœ¨ï¼Œä¹Ÿå°±æ˜¯contextåé¢æœ‰æ²¡æœ‰ä¸€ä¸ªæ•°ç»„\n      // å¦‚æœå­˜åœ¨ï¼Œåˆ™éœ€è¦å±•å¼€ç¬¬äºŒä¸ªå‚æ•°\n      if (arguments[1]) {\n        result = context.fn(...arguments[1]);\n      } else {\n        result = context.fn();\n      }\n      delete context.fn;\n      return result;\n}\n\n```\n\n\n\n## å®ç°bind\n\n#### äº†è§£bind\n\n> `bind() æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œåœ¨ `bind()` è¢«è°ƒç”¨æ—¶ï¼Œè¿™ä¸ªæ–°å‡½æ•°çš„ `this` è¢«æŒ‡å®šä¸º `bind()` çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè€Œå…¶ä½™å‚æ•°å°†ä½œä¸ºæ–°å‡½æ•°çš„å‚æ•°ï¼Œä¾›è°ƒç”¨æ—¶ä½¿ç”¨ã€‚\n>\n> è¯­æ³•ï¼š`fun.bind(thisArg[, arg1[, arg2[, ...]]])`\n>\n> MDN\n\n#### bindå’Œapplyï¼Œcallä¸¤å…„å¼Ÿçš„åŒºåˆ«\n\n`bind` æ–¹æ³•ä¸ `call / apply` æœ€å¤§çš„ä¸åŒå°±æ˜¯å‰è€…è¿”å›ä¸€ä¸ªç»‘å®šä¸Šä¸‹æ–‡çš„**å‡½æ•°**ï¼Œè€Œåä¸¤è€…æ˜¯**ç›´æ¥æ‰§è¡Œ**äº†å‡½æ•°ã€‚\n\nä¸Šä»£ç ï¼\n\n```js\nvar value = 2;\n\nvar foo = {\n    value: 1\n};\n\nfunction bar(name, age) {\n    return {\n\t\tvalue: this.value,\n\t\tname: name,\n\t\tage: age\n    }\n};\n\nbar.call(foo, \"Jack\", 20); // ç›´æ¥æ‰§è¡Œäº†å‡½æ•°\n// {value: 1, name: \"Jack\", age: 20}\n\nvar bindFoo1 = bar.bind(foo, \"Jack\", 20); // è¿”å›ä¸€ä¸ªå‡½æ•°\nbindFoo1();\n// {value: 1, name: \"Jack\", age: 20}\n\nvar bindFoo2 = bar.bind(foo, \"Jack\"); // è¿”å›ä¸€ä¸ªå‡½æ•°\nbindFoo2(20);\n// {value: 1, name: \"Jack\", age: 20}\n```\n\né€šè¿‡ä¸Šè¿°ä»£ç å¯ä»¥çœ‹å‡º`bind` æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š\n\n- 1ã€å¯ä»¥æŒ‡å®š`this`\n- 2ã€è¿”å›ä¸€ä¸ªå‡½æ•°\n- 3ã€å¯ä»¥ä¼ å…¥å‚æ•°\n- 4ã€æŸ¯é‡ŒåŒ–\n\n#### å®ç°bind\n\nç›´æ¥å¼€å¹²ï¼\n\n```js\nFunction.prototype.myBind = function (context) {\n  var that = this; // è¿™é‡Œåˆ©ç”¨çš„é—­åŒ…ä¿å­˜äº†æ­¤æ—¶æ­¤åˆ»çš„thisï¼Œå¦åˆ™åé¢è°ƒç”¨çš„è¯ä¼šéšå¼ä¸¢å¤±\n  return function () { \n    return that.apply(context)\n  }\n}\n\n// æµ‹è¯•ç”¨ä¾‹\nvar value = 2;\nvar foo = {\n    value: 1\n};\n\nfunction bar() {\n\treturn this.value;\n}\n\nvar bindFoo = bar.myBind(foo);\n\nconsole.log(bindFoo()); // 1\n```\n\nOk,æ¥ä¸‹æ¥æˆ‘ä»¬å¤„ç†ä¸€ä¸‹å‚æ•°å’ŒæŸ¯é‡ŒåŒ–å§ã€‚\n\n```js\nFunction.prototype.myBind = function (context) {\n  // å› ä¸ºå‚æ•°æ˜¯ç±»æ•°ç»„æ²¡æœ‰sliceæ–¹æ³•ï¼Œé€šè¿‡callç»‘å®šthisä¹‹åä½¿ç”¨sliceæ‹·è´æ•°ç»„ï¼Œé™¤äº†ç¬¬ä¸€ä¸ªéœ€è¦ç»‘å®šçš„this ä¹‹å¤–ï¼Œä¸‹é¢ä¼šç”¨åˆ°\n  var args = Array.prototype.slice.call(arguments, 1)\n  var that = this; // è¿™é‡Œåˆ©ç”¨çš„é—­åŒ…ä¿å­˜äº†æ­¤æ—¶æ­¤åˆ»çš„thisï¼Œå¦åˆ™åé¢è°ƒç”¨çš„è¯ä¼šéšå¼ä¸¢å¤±\n  return function () { \n    // å’Œä¸Šé¢ä¸€æ ·æ‹·è´å‚æ•°\n    var nowArgs = Array.prototype.slice.call(arguments)\n    return that.apply(context, args.concat(nowArgs))\n  }\n}\n// æµ‹è¯•ç”¨ä¾‹\nvar value = 2;\n\nvar foo = {\n    value: 1\n};\n\nfunction bar(name, age) {\n    return {\n\t\tvalue: this.value,\n\t\tname: name,\n\t\tage: age\n    }\n};\n\nvar bindFoo = bar.myBind(foo, \"Jack\");\nbindFoo(20);\n// {value: 1, name: \"Jack\", age: 20}\n\n```\n\nåˆ°ç°åœ¨å·²ç»å®Œæˆå¤§éƒ¨åˆ†äº†ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªéš¾ç‚¹ï¼Œ`bind` æœ‰ä»¥ä¸‹ä¸€ä¸ªç‰¹æ€§\n\n> ä¸€ä¸ªç»‘å®šå‡½æ•°ä¹Ÿèƒ½ä½¿ç”¨newæ“ä½œç¬¦åˆ›å»ºå¯¹è±¡ï¼šè¿™ç§è¡Œä¸ºå°±åƒæŠŠåŸå‡½æ•°å½“æˆæ„é€ å™¨ï¼Œæä¾›çš„ this å€¼è¢«å¿½ç•¥ï¼ŒåŒæ—¶è°ƒç”¨æ—¶çš„å‚æ•°è¢«æä¾›ç»™æ¨¡æ‹Ÿå‡½æ•°ã€‚\n\nä¸¾ä¾‹è¯´æ˜ï¼šæ­£è§„çš„bind\n\n```js\nvar value = 2;\nvar foo = {\n    value: 1\n};\nfunction bar(name, age) {\n    this.habit = 'shopping';\n    console.log(this.value);\n    console.log(name);\n    console.log(age);\n}\nbar.prototype.friend = 'kevin';\n\nvar bindFoo = bar.bind(foo, 'Jack');\nvar obj = new bindFoo(20);\n// undefined\n// Jack\n// 20\n\nobj.habit;\n// shopping\n\nobj.friend;\n// kevin\n```\n\nä¸Šé¢ä¾‹å­ä¸­ï¼Œè¿è¡Œç»“æœ`this.value` è¾“å‡ºä¸º `undefined`ï¼Œè¿™ä¸æ˜¯å…¨å±€`value` ä¹Ÿä¸æ˜¯`foo`å¯¹è±¡ä¸­çš„`value`ï¼Œè¿™è¯´æ˜ `bind` çš„ `this` å¯¹è±¡å¤±æ•ˆäº†ï¼Œ`new` çš„å®ç°ä¸­ç”Ÿæˆä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè¿™ä¸ªæ—¶å€™çš„ `this`æŒ‡å‘çš„æ˜¯ `obj`ã€‚\n\næ‰€ä»¥æˆ‘ä»¬è¿”å›çš„æ—¶å€™éœ€è¦åˆ¤æ–­ä¸€ä¸‹ä»–æ˜¯ä¸æ˜¯ä½œä¸ºäº†æ„é€ å‡½æ•°è¿”å›ï¼Œå¦‚æœæ˜¯å°±è¿”å›å½“å‰çš„thisï¼Œå¦‚æœä¸æ˜¯å°±ç»‘å®šå½“å‰è¾“å…¥çš„`context`\n\n```js\nFunction.prototype.myBind = function (context) {\n  // å› ä¸ºå‚æ•°æ˜¯ç±»æ•°ç»„æ²¡æœ‰sliceæ–¹æ³•ï¼Œé€šè¿‡callç»‘å®šthisä¹‹åä½¿ç”¨sliceæ‹·è´æ•°ç»„ï¼Œé™¤äº†ç¬¬ä¸€ä¸ªéœ€è¦ç»‘å®šçš„this ä¹‹å¤–ï¼Œä¸‹é¢ä¼šç”¨åˆ°\n  var args = Array.prototype.slice.call(arguments, 1)\n  var that = this; // è¿™é‡Œåˆ©ç”¨çš„é—­åŒ…ä¿å­˜äº†æ­¤æ—¶æ­¤åˆ»çš„thisï¼Œå¦åˆ™åé¢è°ƒç”¨çš„è¯ä¼šéšå¼ä¸¢å¤±\n  var fnc = function () { \n    // å’Œä¸Šé¢ä¸€æ ·æ‹·è´å‚æ•°\n    var nowArgs = Array.prototype.slice.call(arguments)\n    //å½“ä½œä¸ºæ„é€ å‡½æ•°æ—¶ï¼Œthis æŒ‡å‘å®ä¾‹ï¼Œæ­¤æ—¶ this instanceof fBound ç»“æœä¸º trueï¼Œå¯ä»¥è®©å®ä¾‹è·å¾—æ¥è‡ªç»‘å®šå‡½æ•°çš„å€¼ï¼Œå³ä¸Šä¾‹ä¸­å®ä¾‹ä¼šå…·æœ‰ habit å±æ€§ã€‚\n//å½“ä½œä¸ºæ™®é€šå‡½æ•°æ—¶ï¼Œthis æŒ‡å‘ windowï¼Œæ­¤æ—¶ç»“æœä¸º falseï¼Œå°†ç»‘å®šå‡½æ•°çš„ this æŒ‡å‘ context\n    return that.apply(\n      this instanceof fnc ? this : context, \n      args.concat(nowArgs)\n    )\n  }\n  // ä¿®æ”¹è¿”å›å‡½æ•°çš„ prototype ä¸ºç»‘å®šå‡½æ•°çš„ prototypeï¼Œå®ä¾‹å°±å¯ä»¥ç»§æ‰¿ç»‘å®šå‡½æ•°çš„åŸå‹ä¸­çš„å€¼ï¼Œå³ä¸Šä¾‹ä¸­ obj å¯ä»¥è·å–åˆ° bar åŸå‹ä¸Šçš„ friendã€‚\n  fnc.prototype = this.prototype\n  return fnc\n}\n```\n\nä½†æ˜¯å…¶å®è¿™æ ·ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘å¦‚æœå®ä¾‹ä¿®æ”¹äº†åŸå‹ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„ç»§æ‰¿å°±ä¼šå‡ºç°é—®é¢˜ã€‚\n\nè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦æ‹·è´ä¸€ä¸‹æˆ‘ä»¬åŸå‹ä¸Šé¢çš„å‚æ•°ã€‚ä¼šç”¨åˆ°\n\n> é“æ ¼æ‹‰æ–¯Â·å…‹ç½—å…‹ç¦å¾·åœ¨ 2006 å¹´å†™äº†ä¸€ç¯‡æ–‡ç« ï¼Œé¢˜ä¸º Prototypal Inheritance in JavaScript (JavaScript 10 ä¸­çš„åŸå‹å¼ç»§æ‰¿)ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œä»–ä»‹ç»äº†ä¸€ç§å®ç°ç»§æ‰¿çš„æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•å¹¶æ²¡æœ‰ä½¿ç”¨ä¸¥æ ¼æ„ä¹‰ä¸Šçš„ æ„é€ å‡½æ•°ã€‚ä»–çš„æƒ³æ³•æ˜¯å€ŸåŠ©åŸå‹å¯ä»¥åŸºäºå·²æœ‰çš„å¯¹è±¡åˆ›å»ºæ–°å¯¹è±¡ï¼ŒåŒæ—¶è¿˜ä¸å¿…å› æ­¤åˆ›å»ºè‡ªå®šä¹‰ç±»å‹ã€‚ä¸º äº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œä»–ç»™å‡ºäº†å¦‚ä¸‹å‡½æ•°ã€‚\n>\n> ```js\n> function object(o){\n>   function F(){}\n>   F.prototype = o\n>   return new F\n> }\n> ```\n>\n> çœ‹èµ·æ¥éå¸¸ç®€å•\n>\n> å…ˆåœ¨`object`å‡½æ•°å†…éƒ¨åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„æ„é€ å‡½æ•°`F`, ç„¶åå°†ä¼ å…¥çš„è¿™ä¸ªå¯¹è±¡`o`ä½œä¸ºè¿™ä¸ªä¸´æ—¶æ„é€ å‡½æ•°çš„åŸå‹, æœ€åè¿”å›è¿™ä¸ªä¸´æ—¶æ„é€ å‡½æ•°çš„å®ä¾‹. \n>\n> ç®€å•æ¥è¯´å°±æ˜¯`object`å¯¹ä¼ å…¥çš„å¯¹è±¡è¿›è¡Œäº†æµ…å¤åˆ¶.\n\nè¿™å¥è¯åœ¨æˆ‘çš„ã€ŠåŸå‹åŸå‹é“¾å’Œç»§æ‰¿ã€‹é‡Œé¢æœ‰å…·ä½“çš„ä»‹ç»ã€‚æƒ³çœ‹çš„è¯å¯ä»¥ç‚¹å‡»å¤´åƒæŸ¥æ‰¾æ–‡ç« ã€‚\n\nè¿™è¾¹å¯ä»¥ç›´æ¥ä½¿ç”¨ES5çš„ `Object.create()`æ–¹æ³•ç”Ÿæˆä¸€ä¸ªæ–°å¯¹è±¡\n\n```js\nfBound.prototype = Object.create(this.prototype);\n```\n\nä¸è¿‡ `bind` å’Œ `Object.create()`éƒ½æ˜¯ES5æ–¹æ³•ï¼Œéƒ¨åˆ†IEæµè§ˆå™¨ï¼ˆIE < 9ï¼‰å¹¶ä¸æ”¯æŒï¼ŒPolyfillä¸­ä¸èƒ½ç”¨ `Object.create()`å®ç° `bind`ï¼Œä¸è¿‡åŸç†æ˜¯ä¸€æ ·çš„ã€‚\n\nokã€‚é‚£æˆ‘ä»¬å°±ä¿®æ”¹ä¸€ä¸‹\n\n```js\nFunction.prototype.myBind = function (context) {\n  // å› ä¸ºå‚æ•°æ˜¯ç±»æ•°ç»„æ²¡æœ‰sliceæ–¹æ³•ï¼Œé€šè¿‡callç»‘å®šthisä¹‹åä½¿ç”¨sliceæ‹·è´æ•°ç»„ï¼Œé™¤äº†ç¬¬ä¸€ä¸ªéœ€è¦ç»‘å®šçš„this ä¹‹å¤–ï¼Œä¸‹é¢ä¼šç”¨åˆ°\n  var args = Array.prototype.slice.call(arguments, 1)\n  var that = this; // è¿™é‡Œåˆ©ç”¨çš„é—­åŒ…ä¿å­˜äº†æ­¤æ—¶æ­¤åˆ»çš„thisï¼Œå¦åˆ™åé¢è°ƒç”¨çš„è¯ä¼šéšå¼ä¸¢å¤±\n  var fNOP = function () {};\n  var fnc = function () { \n    // å’Œä¸Šé¢ä¸€æ ·æ‹·è´å‚æ•°\n    var nowArgs = Array.prototype.slice.call(arguments)\n    //å½“ä½œä¸ºæ„é€ å‡½æ•°æ—¶ï¼Œthis æŒ‡å‘å®ä¾‹ï¼Œæ­¤æ—¶ this instanceof fBound ç»“æœä¸º trueï¼Œå¯ä»¥è®©å®ä¾‹è·å¾—æ¥è‡ªç»‘å®šå‡½æ•°çš„å€¼ï¼Œå³ä¸Šä¾‹ä¸­å®ä¾‹ä¼šå…·æœ‰ habit å±æ€§ã€‚\n//å½“ä½œä¸ºæ™®é€šå‡½æ•°æ—¶ï¼Œthis æŒ‡å‘ windowï¼Œæ­¤æ—¶ç»“æœä¸º falseï¼Œå°†ç»‘å®šå‡½æ•°çš„ this æŒ‡å‘ context\n    return that.apply(\n      this instanceof fNOP ? this : context, \n      args.concat(nowArgs)\n    )\n  }\n  // ä¿®æ”¹è¿”å›å‡½æ•°çš„ prototype ä¸ºç»‘å®šå‡½æ•°çš„ prototypeï¼Œå®ä¾‹å°±å¯ä»¥ç»§æ‰¿ç»‘å®šå‡½æ•°çš„åŸå‹ä¸­çš„å€¼ï¼Œå³ä¸Šä¾‹ä¸­ obj å¯ä»¥è·å–åˆ° bar åŸå‹ä¸Šçš„ friendã€‚\n  fNOP.prototype = this.prototype\n  fnc.prototype = new FNOP()\n  return fnc\n}\n```\n\nåˆ°è¿™é‡Œå…¶å®å·²ç»å·®ä¸å¤šäº†ï¼Œçªç„¶æƒ³èµ·æ¥è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯è°ƒç”¨ `bind` çš„ä¸æ˜¯å‡½æ•°ï¼Œè¿™æ—¶å€™éœ€è¦æŠ›å‡ºå¼‚å¸¸ã€‚\n\n```js\nif (typeof this !== \"function\") {\n  throw new Error(\"Function.prototype.bind - what is trying to be bound is not callable\");\n}\n```\n\næ‰€ä»¥\n\n#### é¡¶é…\n\n```js\nFunction.prototype.myBind = function (context) {\n  if (typeof this !== \"function\") {\n  \tthrow new Error(\"Function.prototype.bind - what is trying to \tbe bound is not callable\");\n\t}\n  // å› ä¸ºå‚æ•°æ˜¯ç±»æ•°ç»„æ²¡æœ‰sliceæ–¹æ³•ï¼Œé€šè¿‡callç»‘å®šthisä¹‹åä½¿ç”¨sliceæ‹·è´æ•°ç»„ï¼Œé™¤äº†ç¬¬ä¸€ä¸ªéœ€è¦ç»‘å®šçš„this ä¹‹å¤–ï¼Œä¸‹é¢ä¼šç”¨åˆ°\n  var args = Array.prototype.slice.call(arguments, 1)\n  var that = this; // è¿™é‡Œåˆ©ç”¨çš„é—­åŒ…ä¿å­˜äº†æ­¤æ—¶æ­¤åˆ»çš„thisï¼Œå¦åˆ™åé¢è°ƒç”¨çš„è¯ä¼šéšå¼ä¸¢å¤±\n  var fNOP = function () {};\n  var fnc = function () { \n    // å’Œä¸Šé¢ä¸€æ ·æ‹·è´å‚æ•°\n    var nowArgs = Array.prototype.slice.call(arguments)\n    //å½“ä½œä¸ºæ„é€ å‡½æ•°æ—¶ï¼Œthis æŒ‡å‘å®ä¾‹ï¼Œæ­¤æ—¶ this instanceof fBound ç»“æœä¸º trueï¼Œå¯ä»¥è®©å®ä¾‹è·å¾—æ¥è‡ªç»‘å®šå‡½æ•°çš„å€¼ï¼Œå³ä¸Šä¾‹ä¸­å®ä¾‹ä¼šå…·æœ‰ habit å±æ€§ã€‚\n//å½“ä½œä¸ºæ™®é€šå‡½æ•°æ—¶ï¼Œthis æŒ‡å‘ windowï¼Œæ­¤æ—¶ç»“æœä¸º falseï¼Œå°†ç»‘å®šå‡½æ•°çš„ this æŒ‡å‘ context\n    return that.apply(\n      this instanceof fNOP ? this : context, \n      args.concat(nowArgs)\n    )\n  }\n  // ä¿®æ”¹è¿”å›å‡½æ•°çš„ prototype ä¸ºç»‘å®šå‡½æ•°çš„ prototypeï¼Œå®ä¾‹å°±å¯ä»¥ç»§æ‰¿ç»‘å®šå‡½æ•°çš„åŸå‹ä¸­çš„å€¼ï¼Œå³ä¸Šä¾‹ä¸­ obj å¯ä»¥è·å–åˆ° bar åŸå‹ä¸Šçš„ friendã€‚\n  fNOP.prototype = this.prototype\n  fnc.prototype = new FNOP()\n  return fnc\n}\n```\n\n\n\n\n\n## å®ç°new\n\n#### äº†è§£new\n\n> **new è¿ç®—ç¬¦**åˆ›å»ºä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„å¯¹è±¡ç±»å‹çš„å®ä¾‹æˆ–å…·æœ‰æ„é€ å‡½æ•°çš„å†…ç½®å¯¹è±¡çš„å®ä¾‹ã€‚ â€”â€”ï¼ˆæ¥è‡ªäºMDNï¼‰\n\næˆ‘ä»¬å…ˆè¯•è¯•ç°åœ¨æœ‰çš„newï¼Œä»–æœ‰ä»€ä¹ˆåŠŸèƒ½ï¼Œç„¶åæˆ‘ä»¬æ€»ç»“ä¹‹åï¼Œåœ¨å¼€å§‹å®ç°ã€‚\n\nçœ‹ä¸ªğŸŒ°ï¼š\n\n```js\nfunction NEW (a) {\n  this.a = a;\n}\nNEW.prototype.sayA = function () {\n  console.log(this.a+'b')\n}\nvar A = new NEW(1);\nA.sayA()\nA.a\n\n```\n\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°Aæ˜¯NEWçš„ä¸€ä¸ªå®ä¾‹ã€‚ç»§æ‰¿äº†æ„é€ å‡½æ•°ï¼ˆNEWï¼‰çš„å±æ€§å’ŒåŸå‹ä¸Šçš„å±æ€§ï¼ˆsayAï¼‰ã€‚\n\n> **`new`** å…³é”®å­—ä¼šè¿›è¡Œå¦‚ä¸‹çš„æ“ä½œï¼š\n>\n> 1. åˆ›å»ºä¸€ä¸ªç©ºçš„ç®€å•JavaScriptå¯¹è±¡ï¼ˆå³{}ï¼‰ï¼›\n> 2. é“¾æ¥è¯¥å¯¹è±¡ï¼ˆå³è®¾ç½®è¯¥å¯¹è±¡çš„æ„é€ å‡½æ•°ï¼‰åˆ°å¦ä¸€ä¸ªå¯¹è±¡ ï¼›\n> 3. å°†æ­¥éª¤1æ–°åˆ›å»ºçš„å¯¹è±¡ä½œä¸º`this`çš„ä¸Šä¸‹æ–‡ ï¼›\n> 4. å¦‚æœè¯¥å‡½æ•°æ²¡æœ‰è¿”å›å¯¹è±¡ï¼Œåˆ™è¿”å›`this`ã€‚\n>\n> MDN\n\n\n\n#### å®ç°ä¸€ä¸ªnew\n\nè¯´å¹²å°±å¹²ï¼š\n\n```js\n// new æ˜¯å…³é”®è¯ï¼Œä¸å¯ä»¥ç›´æ¥è¦†ç›–ã€‚è¿™é‡Œä½¿ç”¨ create æ¥æ¨¡æ‹Ÿå®ç° new çš„æ•ˆæœã€‚\nfunction create () {\n  // 1.\n  var obj = new Object();\n  \n  // è·å–æ„é€ å‡½æ•°\n  // å› ä¸ºargumentsæ˜¯ä¸€ä¸ªç±»æ•°ç»„å¯¹è±¡ï¼Œæ²¡æœ‰unshiftæ–¹æ³•ï¼Œæ‰€ä»¥ç”¨äº†callï¼Œæˆ‘ä»¬æ²¡æœ‰newè¿™å…³é”®å­—ï¼Œåªèƒ½æ¨¡æ‹Ÿï¼Œæ‰€ä»¥çš„ä¸€ä¸ªå‚æ•°æˆ‘ä»¬è®¤ä¸ºä»–éœ€è¦ä¼ é€’ä¸€ä¸ªæ„é€ å‡½æ•°ã€‚\n  var Con = [].unshift.call(arguments)\n  \n  // 2.\n  obj.__proto__ = Con.prototype \n  \n  // 3ã€ ç»‘å®šthisã€‚å› ä¸ºä¹‹å‰argumentså·²ç»è¢«æˆ‘ä»¬åˆ é™¤äº†ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥å‰©ä¸‹çš„å°±æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„å‚æ•°äº†ã€‚\n  Con.apply(obj, arguments)\n  \n  // 4. ç®€é™‹ç‰ˆ\n  return obj\n  \n}\n```\n\næ„é€ å‡½æ•°è¿”å›å€¼æœ‰å¦‚ä¸‹ä¸‰ç§æƒ…å†µï¼š\n\n- 1ã€è¿”å›ä¸€ä¸ªå¯¹è±¡\n- 2ã€æ²¡æœ‰ `return`ï¼Œå³è¿”å› `undefined`\n- 3ã€è¿”å›`undefined` ä»¥å¤–çš„åŸºæœ¬ç±»å‹\n\n```js\nfunction create() {\n\t// 1ã€è·å¾—æ„é€ å‡½æ•°ï¼ŒåŒæ—¶åˆ é™¤ arguments ä¸­ç¬¬ä¸€ä¸ªå‚æ•°\n    Con = [].shift.call(arguments);\n\t// 2ã€åˆ›å»ºä¸€ä¸ªç©ºçš„å¯¹è±¡å¹¶é“¾æ¥åˆ°åŸå‹ï¼Œobj å¯ä»¥è®¿é—®æ„é€ å‡½æ•°åŸå‹ä¸­çš„å±æ€§\n    var obj = Object.create(Con.prototype);\n\t// 3ã€ç»‘å®š this å®ç°ç»§æ‰¿ï¼Œobj å¯ä»¥è®¿é—®åˆ°æ„é€ å‡½æ•°ä¸­çš„å±æ€§\n    var ret = Con.apply(obj, arguments);\n\t// 4ã€ä¼˜å…ˆè¿”å›æ„é€ å‡½æ•°è¿”å›çš„å¯¹è±¡\n\treturn ret instanceof Object ? ret : obj;\n};\n```\n\n","slug":"ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this","published":1,"updated":"2021-06-24T14:00:06.852Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra8l001rlwrd3343aisg","content":"<p>æœ€è¿‘åœ¨å†™ã€é‡æ‹¾å‰ç«¯ã€‘ç³»åˆ—ï¼Œä¸‹é¢æœ‰å‡ ä¸ªå¿«é€Ÿé€šé“ï¼Œå¤§å®¶è‡ªå–</p>\n<p><a href=\"https://juejin.im/post/6850418113944420359\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿</a></p>\n<p><a href=\"https://juejin.im/post/6850418117508759566\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—</a></p>\n<p><a href=\"https://juejin.im/post/6854573215658803208\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this</a></p>\n<p><a href=\"https://juejin.im/post/6859911609633767438\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šJavaScriptçš„æ‰§è¡Œæœºåˆ¶</a></p>\n<p><a href=\"https://juejin.im/post/6860375101322461198\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC</a></p>\n<p><a href=\"https://juejin.im/post/6865204092877144077\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ</a></p>\n<h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><p>å…¶å®è¯´èµ·thisï¼Œè¿™ä¸ªå‡ ä¹æ˜¯å‰ç«¯é¢è¯•å¿…è€ƒé¢˜ï¼Œä¹Ÿæ˜¯å‰ç«¯æœ€å¤šâ€œè„‘ç»æ€¥è½¬å¼¯â€çš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯è®©æ— æ•°å‰ç«¯äººçƒ¦æ¼çš„åœ°æ–¹ã€‚ä»Šå¤©æˆ‘ä»¬å°±å½»åº•çš„æ·±å…¥thisï¼Œå…¨é¢çš„æ”»ç ´å®ƒï¼</p>\n<h2 id=\"ç»‘å®šè§„åˆ™\"><a href=\"#ç»‘å®šè§„åˆ™\" class=\"headerlink\" title=\"ç»‘å®šè§„åˆ™\"></a>ç»‘å®šè§„åˆ™</h2><p>æˆ‘ä»¬æ¥çœ‹çœ‹åœ¨å‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨ä½ç½®å¦‚ä½•å†³å®š this çš„ç»‘å®šå¯¹è±¡ã€‚</p>\n<p>ä½ å¿…é¡»æ‰¾åˆ°è°ƒç”¨ä½ç½®ï¼Œç„¶ååˆ¤æ–­éœ€è¦åº”ç”¨ä¸‹é¢å››æ¡è§„åˆ™ä¸­çš„å“ªä¸€æ¡ã€‚æˆ‘ä»¬é¦–å…ˆä¼šåˆ†åˆ«è§£é‡Š è¿™å››æ¡è§„åˆ™ï¼Œç„¶åè§£é‡Šå¤šæ¡è§„åˆ™éƒ½å¯ç”¨æ—¶å®ƒä»¬çš„ä¼˜å…ˆçº§å¦‚ä½•æ’åˆ—ã€‚</p>\n<p>thisçš„ç»‘å®šè§„åˆ™æ€»å…±æœ‰ä»¥ä¸‹5ç§ï¼š</p>\n<ol>\n<li>é»˜è®¤ç»‘å®šï¼ˆæœ€ä»¤äººå¤´ç–¼çš„ï¼‰<ol>\n<li>ä¸¥æ ¼æ¨¡å¼</li>\n<li>éä¸¥æ ¼æ¨¡å¼</li>\n</ol>\n</li>\n<li>éšå¼ç»‘å®š</li>\n<li>æ˜¾å¼ç»‘å®š<ol>\n<li>bind</li>\n<li>call</li>\n<li>apply</li>\n</ol>\n</li>\n<li>newç»‘å®š</li>\n</ol>\n<h3 id=\"é»˜è®¤ç»‘å®š\"><a href=\"#é»˜è®¤ç»‘å®š\" class=\"headerlink\" title=\"é»˜è®¤ç»‘å®š\"></a>é»˜è®¤ç»‘å®š</h3><p>é»˜è®¤ç»‘å®šé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æ²¡äººè¦çš„â€œå­¤å„¿â€å°±ä¼šåº”ç”¨é»˜è®¤ç»‘å®šã€‚</p>\n<p>æ€è€ƒğŸ¤”ä¸€ä¸‹ğŸ‘‡çš„ä»£ç ä¼šè¾“å‡ºä»€ä¹ˆï¼Ÿ</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"string\">'out'</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fnc</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> a = <span class=\"string\">'in'</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.a)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">fnc();</span><br></pre></td></tr></table></figure>\n\n<p><strong>ç­”æ¡ˆæ˜¯ï¼šâ€™outâ€™</strong></p>\n<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å½“è°ƒç”¨ <code>fnc()</code> æ—¶ï¼Œ<code>this.a</code> è¢«è§£ææˆäº†å…¨å±€å˜é‡ <code>a</code>ã€‚ä¸ºä»€ä¹ˆ?å› ä¸ºåœ¨æœ¬ ä¾‹ä¸­ï¼Œå‡½æ•°è°ƒç”¨æ—¶åº”ç”¨äº† <code>this</code> çš„é»˜è®¤ç»‘å®šï¼Œå› æ­¤ <code>this</code> æŒ‡å‘å…¨å±€å¯¹è±¡ã€‚</p>\n<p>é‚£æˆ‘ä»¬æ€ä¹ˆçŸ¥é“ä»–æ˜¯åº”ç”¨äº†é»˜è®¤ç»‘å®šå‘¢ï¼Ÿ</p>\n<p>æˆ‘ä»¬å‘ç° <code>fnc</code> ä»–åªæ˜¯å­¤é›¶é›¶çš„è¢«è°ƒç”¨ï¼Œæ²¡æœ‰ä»»ä½•çš„ä¿®é¥°<em>ï¼ˆè°ƒç”¨ä½ç½®æ˜¯å¦æœ‰ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œæˆ–è€…è¯´æ˜¯å¦è¢«æŸä¸ªå¯¹è±¡æ‹¥æœ‰æˆ–è€…åŒ…å«ï¼Œä¸è¿‡è¿™ç§è¯´æ³•å¯èƒ½ä¼šé€ æˆä¸€äº›è¯¯å¯¼ã€‚ï¼‰</em>ï¼Œæ‰€ä»¥å®ƒå°±ç›¸å½“äºæ˜¯æ²¡æœ‰äººè¦çš„<code>å­©å­</code>ï¼Œåªèƒ½å»<code>ç¦åˆ©é™¢</code>â€”é»˜è®¤ç»‘å®šã€‚</p>\n<p>è¿™æ ·è¯´å¯èƒ½è¿˜ä¸å¤ªæ˜ç™½é»˜è®¤ç»‘å®šç©¶ç«Ÿæ˜¯æ€ä¹ˆä¸€å›äº‹ã€‚ç­‰åˆ°åé¢çš„è§„åˆ™ä»‹ç»çš„å¤šäº†ï¼Œä½ å°±ä¼šå‘ç°æ²¡æœ‰åº”ç”¨å…¶ä»–è§„åˆ™çš„â€œå­¤å„¿â€åªèƒ½æ¥ç¦åˆ©é™¢ â€”é»˜è®¤ç»‘å®šçš„æ€€æŠ±</p>\n<h4 id=\"ä¸¥æ ¼æ¨¡å¼\"><a href=\"#ä¸¥æ ¼æ¨¡å¼\" class=\"headerlink\" title=\"ä¸¥æ ¼æ¨¡å¼\"></a>ä¸¥æ ¼æ¨¡å¼</h4><p>åœ¨ä¸¥æ ¼ä¸‹ï¼Œé»˜è®¤ç»‘å®šä¸æ˜¯ç»‘å®šåˆ°<code>window</code>ï¼Œè€Œæ˜¯<code>undefined</code>ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"string\">'out'</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fnc</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"><span class=\"meta\">\t\"use strict\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> a = <span class=\"string\">'in'</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.a)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">fnc();</span><br></pre></td></tr></table></figure>\n\n<p><strong>ç­”æ¡ˆæ˜¯ï¼šæŠ¥é”™</strong></p>\n<p>ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºæˆ‘ä»¬æƒ³åœ¨<code>undefined</code>é‡Œé¢æ‰¾<code>a</code>ï¼Œé‚£è‚¯å®šæ˜¯æŠ¥é”™çš„</p>\n<h3 id=\"éšå¼ç»‘å®š\"><a href=\"#éšå¼ç»‘å®š\" class=\"headerlink\" title=\"éšå¼ç»‘å®š\"></a>éšå¼ç»‘å®š</h3><p>éšå¼ç»‘å®šï¼Œé¡¾åæ€ä¹‰å°±æ˜¯æ‚„æ‚„çš„ç»‘å®šï¼Œæˆ–è€…è¯´å…¬è®¤çš„ï¼Œä½†æ˜¯æ²¡æœ‰æ˜è¯´çš„ç»‘å®šã€‚å°±å¥½æ¯”ä¸€ä¸ªç”·äººå’Œä¸€ä¸ªå¥³äººæ‰‹ç‰µæ‰‹èµ°åœ¨ä¸€èµ·ï¼Œä»–ä»¬åŸºæœ¬ä¸Šå¯ä»¥è®¤å®šå°±æ˜¯åœ¨æƒ…ä¾£ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰å¯èƒ½ä¼šæ˜¯â€œå·æƒ…â€ï¼ˆæ˜ å°„åˆ°éšå¼ç»‘å®šçš„éšå¼ä¸¢å¤±ï¼Œç­‰ä¼šä¼šè¯´åˆ°ã€‚ï¼‰</p>\n<p>æ€è€ƒğŸ¤”ä¸€ä¸‹ğŸ‘‡çš„ä»£ç ä¼šè¾“å‡ºä»€ä¹ˆï¼Ÿ</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"string\">'out'</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fnc</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.a)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">  a: <span class=\"string\">'in'</span>,</span><br><span class=\"line\">  fnc: fnc</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">obj.fnc();</span><br></pre></td></tr></table></figure>\n\n<p><strong>ç­”æ¡ˆæ˜¯ï¼šâ€™inâ€™</strong></p>\n<p>æˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°ï¼Œ<code>fnc</code> æ˜¯åœ¨ä»€ä¹ˆæƒ…å†µä¸‹è¢«è°ƒç”¨çš„ï¼Ÿæ˜¯<code>obj</code> è°ƒç”¨çš„ï¼Œè¯´æ˜è¿™ä¸ª<code>fnc</code>å·²ç»æœ‰ä¸»äº†ï¼ŒæŠ¤èŠ±ä½¿è€…æ˜¯<code>obj</code>ï¼Œæ‰€ä»¥<code>fnc</code>è¯´çš„è¯è‚¯å®šæ˜¯å‘ç€<code>obj</code>çš„ï¼Œèƒ³è†Šè‚˜ä¸ä¼šå¾€å¤–æ‹ã€‚</p>\n<p>å…¶å®è¿™é‡Œé¢æœ‰ä¸€ä¸ªå°çš„ç‚¹éœ€è¦æ³¨æ„ï¼Œé‚£å°±æ˜¯å¦‚æœæ˜¯å¤šä¸ªå¯¹è±¡å¼•ç”¨çš„è°ƒç”¨ï¼Œé‚£è¿™ä¸ªæ—¶å€™çš„æ‰§è¡Œä¸Šä¸‹æ–‡åˆæ˜¯è°çš„å‘¢ï¼Ÿ</p>\n<p>å…¶å®æˆ‘ä»¬ç”¨å¸¸ç†å°±å¯ä»¥è§£é‡Šè¿™ä¸ªé—®é¢˜ï¼ŒAå«Bå»åƒé¥­ï¼Œä½†æ˜¯Bæƒ³å«Cä¸€èµ·å»ï¼Œç»“æœAå’ŒBèµ·äº†å†²çªï¼Œä½ ä½œä¸ºè¿™ä¸ªCä½ ä¼šå‘ç€è°ï¼Ÿé‚£è‚¯å®šæ˜¯Bï¼Œå› ä¸ºæœ‰Cå«ä½ å»ï¼Œä½ ä»¬æ‰ä¼šå‡ºç°åœ¨è¿™åœºèšä¼šã€‚æ‰€ä»¥è¿™ä¸ªé—®é¢˜ä¸éš¾å›ç­”ã€‚æˆ‘ä»¬ç›´æ¥çœ‹ä¸€ä¸ªä¾‹å­ğŸŒ°</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">'aa'</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fnc</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> bb = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">'bb'</span>,</span><br><span class=\"line\">  fnc: fnc</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> cc = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">'cc'</span>,</span><br><span class=\"line\">  bb: bb</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">cc.bb.fnc();</span><br></pre></td></tr></table></figure>\n\n<p><strong>ç­”æ¡ˆæ˜¯ï¼šbb</strong></p>\n<p>ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºèƒ½è®©<code>fnc</code>è¢«è°ƒç”¨çš„æ˜¯<code>bb</code>ï¼Œæ²¡æœ‰<code>bb</code>ï¼Œ<code>fnc</code>æ ¹æœ¬æ²¡æœ‰æœºä¼šç™»åœºã€‚</p>\n<h4 id=\"éšå¼ä¸¢å¤±\"><a href=\"#éšå¼ä¸¢å¤±\" class=\"headerlink\" title=\"éšå¼ä¸¢å¤±\"></a>éšå¼ä¸¢å¤±</h4><p>å‰é¢è¯´è¿‡ï¼Œè™½ç„¶å¾ˆå¤šä¸œè¥¿è¡¨ä¸Šé¢çœ‹èµ·æ¥éƒ½å¾ˆæ­£å¸¸ï¼Œä½†æ˜¯ä¹Ÿæœ‰å¯èƒ½æœ‰ä¸€äº›å…¶ä»–çŠ¶å†µçš„å‡ºç°ã€‚æ¯”å¦‚éšå¼ç»‘å®šé‡Œé¢çš„éšå¼ä¸¢å¤±ã€‚</p>\n<p>æˆ‘ä»¬æŠŠä¹‹å‰çš„ä¾‹å­ä¿®æ”¹ä¸€ä¸‹</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">'aa'</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fnc</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> bb = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">'bb'</span>,</span><br><span class=\"line\">  fnc: fnc</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> cc = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">'cc'</span>,</span><br><span class=\"line\">  bb: bb</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> aa = cc.bb.fnc;</span><br><span class=\"line\">aa()</span><br></pre></td></tr></table></figure>\n\n<p><strong>ç­”æ¡ˆæ˜¯ï¼šaa</strong></p>\n<p>ä¸ºä»€ä¹ˆï¼Ÿè¿™ä¸ªå…¶å®ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œè¿™ä¸ª<code>fnc</code>å¹¶æ²¡æœ‰è¢«<code>bb</code>è°ƒç”¨ï¼ŒçœŸæ­£è°ƒç”¨çš„åœ°æ–¹æ˜¯åœ¨<code>window</code>é‡Œé¢å£°æ˜çš„ä¸€ä¸ªå˜é‡<code>aa</code>ã€‚æ‰€ä»¥<code>bb</code>ä¸¢å¤±äº†<code>fnc</code>çš„ä¿¡ä»»ï¼Œ<code>fnc</code>æ— å¤„å¯å»ï¼Œåªèƒ½å»å­¤å„¿é™¢ã€‚</p>\n<p>è¿˜æ˜¯åˆšåˆšåƒé¥­çš„ä¾‹å­ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹åœºæ™¯å°±å¾ˆå¥½ç†è§£äº†ã€‚</p>\n<p>Aå«Bå»åƒé¥­ï¼ŒBæŠŠCçš„è”ç³»æ–¹å¼ä¸å°å¿ƒå¼„ä¸¢äº†ï¼Œç»“æœè¢«ä¸€ä¸ªé™Œç”ŸäººDæ¡å»äº†ï¼Œåˆšåˆšå¥½Dä¹Ÿè¦å‚åŠ èšä¼šï¼Œå°±æ‰“ç”µè¯å«äº†Dä¸€èµ·å‚åŠ èšä¼šã€‚ä½†æ˜¯Cä¸è®¤è¯†Dï¼Œå«ä»–å»çš„ä¸æ˜¯ç†ŸäººBï¼Œæ‰€ä»¥è°ä¹Ÿä¿¡ä¸è¿‡ã€‚æœ€ç»ˆåªèƒ½åº”ç”¨é»˜è®¤è§„åˆ™â€“é»˜è®¤ç»‘å®šäº†ã€‚</p>\n<p>è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯éå¸¸å¸¸è§çš„ï¼Œä¹Ÿæ˜¯éšå¼ä¸¢å¤±ï¼Œé‚£å°±æ˜¯å›è°ƒå‡½æ•°ã€‚</p>\n<p>çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">'window'</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fnc</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">ffnncc</span>(<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">  fn()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">'obj'</span>,</span><br><span class=\"line\">  fnc: fnc,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">ffnncc(obj.fnc)</span><br></pre></td></tr></table></figure>\n\n<p><strong>ç­”æ¡ˆæ˜¯ï¼šwidnow</strong></p>\n<p>ä¸ºä»€ä¹ˆï¼Ÿè¿™å’Œä¹‹å‰çš„é‚£ä¸ªä¾‹å­ä¸€æ ·ï¼Œè¡¨é¢ä¸Šçœ‹èµ·æ¥å¥½åƒæ˜¯<code>obj</code>è°ƒç”¨çš„ï¼Œä½†æ˜¯å…¶å®æ˜¯<code>obj</code>æŠŠè°ƒç”¨<code>fnc</code>çš„æ–¹æ³•è½¬äº¤ç»™äº†åˆ«äººï¼Œç”±<code>fnc</code>ä¸è®¤è¯†çš„æ¥è°ƒç”¨äº†ã€‚</p>\n<p>å†æ¥çœ‹ä¸€ä¸ªé¢è¯•é¢˜ç»å¸¸è€ƒçš„é¢˜ç›®ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">'window'</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fnc</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">'obj'</span>,</span><br><span class=\"line\">  fnc: fnc,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">setTimeout(obj.fnc, <span class=\"number\">100</span>)</span><br></pre></td></tr></table></figure>\n\n<p><strong>ç­”æ¡ˆæ˜¯ï¼šwidnow</strong></p>\n<p>æˆ‘ç›¸ä¿¡ä¸ç”¨è§£é‡Šä½ ä¹Ÿæ‰¾åˆ°ä¸ºä»€ä¹ˆäº†å§ï¼Ÿ<code>fnc</code>çš„è”ç³»æ–¹å¼è¢«<code>obj</code>è½¬äº¤ç»™åˆ«äººäº†ï¼</p>\n<p>å“ˆå“ˆå“ˆå“ˆï¼Œæœ‰æ²¡æœ‰æ„Ÿè§‰thiså…¶å®ä¹Ÿä¸è¿‡å¦‚æ­¤ï¼Œso easyï¼</p>\n<blockquote>\n<p>æ€è€ƒé¢˜ï¼šé‚£ä¹ˆreactä¸­çš„å‡½æ•°è°ƒç”¨ä¸ºä»€ä¹ˆè¦ç”¨ç®­å¤´å‡½æ•°æˆ–è€…ä¸ºä»€ä¹ˆè¦åœ¨constructoré‡Œé¢bindä¸€ä¸‹ã€‚</p>\n</blockquote>\n<h3 id=\"æ˜¾å¼ç»‘å®š\"><a href=\"#æ˜¾å¼ç»‘å®š\" class=\"headerlink\" title=\"æ˜¾å¼ç»‘å®š\"></a>æ˜¾å¼ç»‘å®š</h3><p>æˆ‘ä»¬åˆšåˆšçœ‹åˆ°çš„æ˜¯éšå¼ç»‘å®šï¼Œæ˜¯å·å·æ‘¸æ‘¸çš„é‚£ç§ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±ä»‹ç»ä¸€ä¸‹æ˜¾å¼ç»‘å®šï¼Œå…‰æ˜æ­£å¤§çš„é‚£ç§ã€‚</p>\n<p>é‚£ä¹ˆå¦‚æœæˆ‘ä»¬ä¸æƒ³åœ¨å¯¹è±¡å†…éƒ¨åŒ…å«å‡½æ•°å¼•ç”¨ï¼Œè€Œæƒ³åœ¨æŸä¸ªå¯¹è±¡ä¸Šå¼ºåˆ¶è°ƒç”¨å‡½æ•°ï¼Œè¯¥æ€ä¹ˆ</p>\n<p>åšå‘¢?</p>\n<p>JavaScript ä¸­çš„â€œæ‰€æœ‰â€å‡½æ•°éƒ½æœ‰ä¸€äº›æœ‰ç”¨çš„ç‰¹æ€§(è¿™å’Œå®ƒä»¬çš„ [[ åŸå‹ ]] æœ‰å…³â€”â€”ä¹‹åæˆ‘ ä»¬ä¼šè¯¦ç»†ä»‹ç»åŸå‹)ï¼Œå¯ä»¥ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å…·ä½“ç‚¹è¯´ï¼Œå¯ä»¥ä½¿ç”¨å‡½æ•°çš„ call(..) å’Œ apply(..) æ–¹æ³•ã€‚ä¸¥æ ¼æ¥è¯´ï¼ŒJavaScript çš„å®¿ä¸»ç¯å¢ƒæœ‰æ—¶ä¼šæä¾›ä¸€äº›éå¸¸ç‰¹æ®Šçš„å‡½æ•°ï¼Œå®ƒä»¬ å¹¶æ²¡æœ‰è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚ä½†æ˜¯è¿™æ ·çš„å‡½æ•°éå¸¸ç½•è§ï¼ŒJavaScript æä¾›çš„ç»å¤§å¤šæ•°å‡½æ•°ä»¥åŠä½ è‡ª å·±åˆ›å»ºçš„æ‰€æœ‰å‡½æ•°éƒ½å¯ä»¥ä½¿ç”¨ call(..) å’Œ apply(..) æ–¹æ³•ã€‚</p>\n<p>çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"string\">'window'</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">\t<span class=\"built_in\">console</span>.log( <span class=\"keyword\">this</span>.a );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123; </span><br><span class=\"line\">\ta:<span class=\"string\">'obj'</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">foo.call( obj );</span><br><span class=\"line\">foo()</span><br></pre></td></tr></table></figure>\n\n<p><strong>ç­”æ¡ˆçš„å…ˆåé¡ºåºæ˜¯ï¼šobjï¼Œwindow</strong></p>\n<p>é€šè¿‡ foo.call(..)ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è°ƒç”¨ foo æ—¶å¼ºåˆ¶æŠŠå®ƒçš„ this ç»‘å®šåˆ° obj ä¸Šã€‚</p>\n<p>å¯æƒœï¼Œæ˜¾å¼ç»‘å®šä»ç„¶æ— æ³•è§£å†³æˆ‘ä»¬ä¹‹å‰æå‡ºçš„ä¸¢å¤±ç»‘å®šé—®é¢˜ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sayHi</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Hello,'</span>, <span class=\"keyword\">this</span>.name);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> person = &#123;</span><br><span class=\"line\">    name: <span class=\"string\">'YvetteLau'</span>,</span><br><span class=\"line\">    sayHi: sayHi</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">'Wiliam'</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> Hi = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">    fn();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Hi.call(person, person.sayHi);</span><br></pre></td></tr></table></figure>\n\n<p><strong>ç­”æ¡ˆæ˜¯ï¼šHello, Wiliam</strong></p>\n<p>å…¶å®æˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œè¿™ä¸ª<code>fn</code>ä¸æ˜¯ç›´æ¥è¢«è°ƒç”¨çš„ï¼Œæ‰€ä»¥é€ æˆäº†éšå¼ä¸¢å¤±ã€‚æˆ‘ä»¬çš„<code>call</code>ç»‘å®šçš„<code>person</code>å…¶å®ç»‘å®šåœ¨äº†<code>Hi</code>ä¸Šé¢äº†ï¼Œä¸ä¿¡çš„è¯æˆ‘ä»¬æ”¹ä¸€ä¸‹ä½ å°±ä¼šå‘ç°äº†ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sayHi</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Hello,'</span>, <span class=\"keyword\">this</span>.name);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> person = &#123;</span><br><span class=\"line\">    name: <span class=\"string\">'YvetteLau'</span>,</span><br><span class=\"line\">    sayHi: sayHi</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">'Wiliam'</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> Hi = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">  \t<span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name)</span><br><span class=\"line\">    fn();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Hi.call(person, person.sayHi);</span><br></pre></td></tr></table></figure>\n\n<p>è¾“å‡ºäº†ä»€ä¹ˆï¼Ÿ</p>\n<p><strong>YvetteLau</strong></p>\n<p><strong>Hello, Wiliam</strong></p>\n<p>é‚£ä¹ˆå’‹åŠå‘¢ï¼Ÿåˆ«æ€•æ˜¾ç¤ºç»‘å®šçš„å˜å¼‚ç‰ˆï¼Œç¡¬ç»‘å®šå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>\n<h4 id=\"ç¡¬ç»‘å®š\"><a href=\"#ç¡¬ç»‘å®š\" class=\"headerlink\" title=\"ç¡¬ç»‘å®š\"></a>ç¡¬ç»‘å®š</h4><p>ç¡¬ç»‘å®šå…¶å®å°±æ˜¯åœ¨æœ€åä¸€å±‚ç»™ä»–è¿›è¡Œæ˜¾ç¤ºç»‘å®šã€‚</p>\n<p>è¯·çœ‹ä»£ç ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sayHi</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Hello,'</span>, <span class=\"keyword\">this</span>.name);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> person = &#123;</span><br><span class=\"line\">    name: <span class=\"string\">'YvetteLau'</span>,</span><br><span class=\"line\">    sayHi: sayHi</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">'Wiliam'</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> Hi = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">  \t<span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name)</span><br><span class=\"line\">    fn.call(person);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Hi(person.sayHi);</span><br></pre></td></tr></table></figure>\n\n<p>è¾“å‡ºäº†ä»€ä¹ˆï¼Ÿ</p>\n<p><strong>YvetteLau</strong></p>\n<p><strong>Hello, Wiliam</strong></p>\n<p>è™½ç„¶æˆ‘ä»¬è°ƒç”¨<code>Hi</code>çš„æ—¶å€™ï¼Œåœ¨<code>call</code>ä¹‹å‰<code>this</code>è¿˜æ˜¯æŒ‡å‘äº†<code>window</code>ï¼Œä½†æ˜¯æˆ‘ä»¬ç”¨<code>call</code>ç»™ä»–ç»‘å®šä¸Šäº†<code>person</code>ã€‚æ— è®ºä¹‹åå¦‚ä½•è°ƒç”¨å‡½æ•° <code>fn</code>ï¼Œå®ƒ æ€»ä¼šæ‰‹åŠ¨åœ¨ <code>person</code> ä¸Šè°ƒç”¨ <code>fn</code>ã€‚è¿™ç§ç»‘å®šæ˜¯ä¸€ç§æ˜¾å¼çš„å¼ºåˆ¶ç»‘å®šï¼Œå› æ­¤æˆ‘ä»¬ç§°ä¹‹ä¸ºç¡¬ç»‘å®šã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( <span class=\"keyword\">this</span>.a );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">    a: <span class=\"number\">2</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> bar = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    foo.call( obj );</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">bar(); <span class=\"comment\">// 2</span></span><br><span class=\"line\">setTimeout( bar, <span class=\"number\">100</span> ); <span class=\"comment\">// 2</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ç¡¬ç»‘å®šçš„barä¸å¯èƒ½å†ä¿®æ”¹å®ƒçš„this</span></span><br><span class=\"line\">bar.call( <span class=\"built_in\">window</span> ); <span class=\"comment\">// 2</span></span><br></pre></td></tr></table></figure>\n\n<p>å…¸å‹åº”ç”¨åœºæ™¯æ˜¯åˆ›å»ºä¸€ä¸ªåŒ…è£¹å‡½æ•°ï¼Œè´Ÿè´£æ¥æ”¶å‚æ•°å¹¶è¿”å›å€¼ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">something</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( <span class=\"keyword\">this</span>.a, something );</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.a + something;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">    a: <span class=\"number\">2</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> bar = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> foo.apply( obj, <span class=\"built_in\">arguments</span> );</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> b = bar( <span class=\"number\">3</span> ); <span class=\"comment\">// 2 3</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( b ); <span class=\"comment\">// 5</span></span><br></pre></td></tr></table></figure>\n\n<p>åˆ›å»ºä¸€ä¸ªå¯ä»¥é‡å¤ä½¿ç”¨çš„è¾…åŠ©å‡½æ•°ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">something</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( <span class=\"keyword\">this</span>.a, something );</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.a + something;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ç®€å•çš„è¾…åŠ©ç»‘å®šå‡½æ•°</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bind</span>(<span class=\"params\">fn, obj</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> fn.apply( obj, <span class=\"built_in\">arguments</span> );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">    a: <span class=\"number\">2</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> bar = bind( foo, obj );</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> b = bar( <span class=\"number\">3</span> ); <span class=\"comment\">// 2 3</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( b ); <span class=\"comment\">// 5</span></span><br></pre></td></tr></table></figure>\n\n<p>ES5å†…ç½®äº†<code>Function.prototype.bind</code>ï¼Œbindä¼šè¿”å›ä¸€ä¸ªç¡¬ç»‘å®šçš„æ–°å‡½æ•°ï¼Œç”¨æ³•å¦‚ä¸‹ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">something</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( <span class=\"keyword\">this</span>.a, something );</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.a + something;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">    a: <span class=\"number\">2</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> bar = foo.bind( obj );</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> b = bar( <span class=\"number\">3</span> ); <span class=\"comment\">// 2 3</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( b ); <span class=\"comment\">// 5</span></span><br></pre></td></tr></table></figure>\n\n<p>APIè°ƒç”¨çš„â€œä¸Šä¸‹æ–‡â€</p>\n<p>JSè®¸å¤šå†…ç½®å‡½æ•°æä¾›äº†ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œè¢«ç§°ä¹‹ä¸ºâ€œä¸Šä¸‹æ–‡â€ï¼ˆcontextï¼‰ï¼Œå…¶ä½œç”¨å’Œ<code>bind(..)</code>ä¸€æ ·ï¼Œç¡®ä¿å›è°ƒå‡½æ•°ä½¿ç”¨æŒ‡å®šçš„thisã€‚è¿™äº›å‡½æ•°å®é™…ä¸Šé€šè¿‡<code>call(..)</code>å’Œ<code>apply(..)</code>å®ç°äº†æ˜¾å¼ç»‘å®šã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">el</span>) </span>&#123;</span><br><span class=\"line\">\t<span class=\"built_in\">console</span>.log( el, <span class=\"keyword\">this</span>.id );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">    id: <span class=\"string\">\"awesome\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> myArray = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\"><span class=\"comment\">// è°ƒç”¨foo(..)æ—¶æŠŠthisç»‘å®šåˆ°obj</span></span><br><span class=\"line\">myArray.forEach( foo, obj );</span><br><span class=\"line\"><span class=\"comment\">// 1 awesome 2 awesome 3 awesome</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"new-ç»‘å®š\"><a href=\"#new-ç»‘å®š\" class=\"headerlink\" title=\"new ç»‘å®š\"></a>new ç»‘å®š</h3><p>ä½¿ç”¨ new æ¥è°ƒç”¨å‡½æ•°ï¼Œæˆ–è€…è¯´å‘ç”Ÿæ„é€ å‡½æ•°è°ƒç”¨æ—¶ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œä¸‹é¢çš„æ“ä½œã€‚</p>\n<ol>\n<li>åˆ›å»º(æˆ–è€…è¯´æ„é€ )ä¸€ä¸ªå…¨æ–°çš„å¯¹è±¡ã€‚</li>\n<li>è¿™ä¸ªæ–°å¯¹è±¡ä¼šè¢«æ‰§è¡Œ[[åŸå‹]]è¿æ¥ã€‚</li>\n<li>è¿™ä¸ªæ–°å¯¹è±¡ä¼šç»‘å®šåˆ°å‡½æ•°è°ƒç”¨çš„thisã€‚</li>\n<li>å¦‚æœå‡½æ•°æ²¡æœ‰è¿”å›å…¶ä»–å¯¹è±¡ï¼Œé‚£ä¹ˆnewè¡¨è¾¾å¼ä¸­çš„å‡½æ•°è°ƒç”¨ä¼šè‡ªåŠ¨è¿”å›è¿™ä¸ªæ–°å¯¹è±¡ã€‚</li>\n</ol>\n<p>æ€è€ƒä¸‹é¢çš„ä»£ç :</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">a</span>) </span>&#123; </span><br><span class=\"line\">  <span class=\"keyword\">this</span>.a = a;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> bar = <span class=\"keyword\">new</span> foo(<span class=\"number\">2</span>); </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( bar.a );  <span class=\"comment\">// 2</span></span><br></pre></td></tr></table></figure>\n\n<p>ä½¿ç”¨<code>new</code>æ¥è°ƒç”¨<code>foo(..)</code>æ—¶ï¼Œä¼šæ„é€ ä¸€ä¸ªæ–°å¯¹è±¡å¹¶æŠŠå®ƒï¼ˆ<code>bar</code>ï¼‰ç»‘å®šåˆ°<code>foo(..)</code>è°ƒç”¨ä¸­çš„thisã€‚</p>\n<h3 id=\"ç»‘å®šä¼˜å…ˆçº§\"><a href=\"#ç»‘å®šä¼˜å…ˆçº§\" class=\"headerlink\" title=\"ç»‘å®šä¼˜å…ˆçº§\"></a>ç»‘å®šä¼˜å…ˆçº§</h3><p>çœ‹å®Œè§„åˆ™ï¼Œæˆ‘ä»¬è‚¯å®šæƒ³çŸ¥é“å¦‚æœè¿™äº›è§„åˆ™æ’åœ¨ä¸€èµ·ï¼Œæˆ‘ä»¬åˆè¯¥å¬è°çš„å‘¢ï¼Ÿ</p>\n<p>æ¯«æ— ç–‘é—®ï¼Œé»˜è®¤ç»‘å®šçš„ä¼˜å…ˆçº§æ˜¯å››æ¡è§„åˆ™ä¸­æœ€ä½çš„ï¼Œå› ä¸ºæ˜¯æ²¡äººåº”ç”¨ä»»ä½•è§„åˆ™æ‰ä¼šå»åº”ç”¨é»˜è®¤ç»‘å®šã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…ˆä¸è€ƒè™‘å®ƒã€‚ éšå¼ç»‘å®šå’Œæ˜¾å¼ç»‘å®šå“ªä¸ªä¼˜å…ˆçº§æ›´é«˜?æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">\t<span class=\"built_in\">console</span>.log( <span class=\"keyword\">this</span>.a );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj1 = &#123; </span><br><span class=\"line\">\ta: <span class=\"number\">2</span>,</span><br><span class=\"line\">\tfoo: foo </span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj2 = &#123; </span><br><span class=\"line\">\ta: <span class=\"number\">3</span>,</span><br><span class=\"line\">\tfoo: foo </span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">obj1.foo(); <span class=\"comment\">// 2 </span></span><br><span class=\"line\">obj2.foo(); <span class=\"comment\">// 3</span></span><br><span class=\"line\">obj1.foo.call( obj2 ); <span class=\"comment\">// 3 </span></span><br><span class=\"line\">obj2.foo.call( obj1 ); <span class=\"comment\">// 2</span></span><br></pre></td></tr></table></figure>\n\n<p>å¯ä»¥çœ‹åˆ°ï¼Œæ˜¾å¼ç»‘å®šä¼˜å…ˆçº§æ›´é«˜ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨åˆ¤æ–­æ—¶åº”å½“å…ˆè€ƒè™‘æ˜¯å¦å¯ä»¥åº”ç”¨æ˜¾å¼ç»‘å®šã€‚ ç°åœ¨æˆ‘ä»¬éœ€è¦ææ¸…æ¥š new ç»‘å®šå’Œéšå¼ç»‘å®šçš„ä¼˜å…ˆçº§è°é«˜è°ä½:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">something</span>) </span>&#123; \t</span><br><span class=\"line\">\t<span class=\"keyword\">this</span>.a = something;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj1 = &#123; </span><br><span class=\"line\">\tfoo: foo</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj2 = &#123;&#125;;</span><br><span class=\"line\">obj1.foo( <span class=\"number\">2</span> );</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( obj1.a ); <span class=\"comment\">// 2</span></span><br><span class=\"line\">obj1.foo.call( obj2, <span class=\"number\">3</span> ); </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( obj2.a ); <span class=\"comment\">// 3</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> bar = <span class=\"keyword\">new</span> obj1.foo( <span class=\"number\">4</span> ); </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( obj1.a ); <span class=\"comment\">// 2 </span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( bar.a ); <span class=\"comment\">// 4</span></span><br></pre></td></tr></table></figure>\n\n<p>å¯ä»¥çœ‹åˆ° new ç»‘å®šæ¯”éšå¼ç»‘å®šä¼˜å…ˆçº§é«˜ã€‚ä½†æ˜¯ new ç»‘å®šå’Œæ˜¾å¼ç»‘å®šè°çš„ä¼˜å…ˆçº§æ›´é«˜å‘¢?</p>\n<blockquote>\n<p>new å’Œ call/apply æ— æ³•ä¸€èµ·ä½¿ç”¨ï¼Œå› æ­¤æ— æ³•é€šè¿‡ new foo.call(obj1) æ¥ç›´æ¥ è¿›è¡Œæµ‹è¯•ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¡¬ç»‘å®šæ¥æµ‹è¯•å®ƒä¿©çš„ä¼˜å…ˆçº§ã€‚</p>\n<p>è¿™æ˜¯å› ä¸ºå‡½æ•°å†…éƒ¨æœ‰ä¸¤ä¸ªä¸åŒçš„æ–¹æ³•ï¼š<code>[[Call]]</code>å’Œ<code>[[Constructor]]</code>ã€‚ å½“ä½¿ç”¨æ™®é€šå‡½æ•°è°ƒç”¨æ—¶ï¼Œ<code>[[Call]]</code>ä¼šè¢«æ‰§è¡Œã€‚å½“ä½¿ç”¨æ„é€ å‡½æ•°è°ƒç”¨æ—¶ï¼Œ<code>[[Constructor]]</code>ä¼šè¢«æ‰§è¡Œã€‚<code>call</code>ã€<code>apply</code>ã€<code>bind</code>å’Œç®­å¤´å‡½æ•°å†…éƒ¨æ²¡æœ‰<code>[[Constructor]]</code>æ–¹æ³•ã€‚</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">something</span>) </span>&#123; </span><br><span class=\"line\">\t<span class=\"keyword\">this</span>.a = something;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj1 = &#123;&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> bar = foo.bind( obj1 ); </span><br><span class=\"line\">bar( <span class=\"number\">2</span> );</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( obj1.a ); <span class=\"comment\">// 2</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> baz = <span class=\"keyword\">new</span> bar(<span class=\"number\">3</span>); </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( obj1.a ); <span class=\"comment\">// 2 </span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( baz.a ); <span class=\"comment\">// 3</span></span><br></pre></td></tr></table></figure>\n\n<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°newæŠŠbindçš„ç¡¬ç»‘å®šç»™é¡¶æ‰äº†</p>\n<p>æ‰€ä»¥new  &gt; ç¡¬ç»‘å®š</p>\n<h4 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h4><blockquote>\n<p>new ç»‘å®š &gt; æ˜¾ç¤ºç»‘å®š &gt; éšå¼ç»‘å®š &gt; é»˜è®¤ç»‘å®š</p>\n</blockquote>\n<h3 id=\"ç»‘å®šä¾‹å¤–\"><a href=\"#ç»‘å®šä¾‹å¤–\" class=\"headerlink\" title=\"ç»‘å®šä¾‹å¤–\"></a>ç»‘å®šä¾‹å¤–</h3><h4 id=\"è¢«å¿½ç•¥çš„this\"><a href=\"#è¢«å¿½ç•¥çš„this\" class=\"headerlink\" title=\"è¢«å¿½ç•¥çš„this\"></a>è¢«å¿½ç•¥çš„this</h4><p>æŠŠ<code>null</code>æˆ–è€…<code>undefined</code>ä½œä¸º<code>this</code>çš„ç»‘å®šå¯¹è±¡ä¼ å…¥<code>call</code>ã€<code>apply</code>æˆ–è€…<code>bind</code>ï¼Œè¿™äº›å€¼åœ¨è°ƒç”¨æ—¶ä¼šè¢«å¿½ç•¥ï¼Œå®é™…åº”ç”¨çš„æ˜¯é»˜è®¤è§„åˆ™ã€‚</p>\n<p>ä¸‹é¢ä¸¤ç§æƒ…å†µä¸‹ä¼šä¼ å…¥<code>null</code></p>\n<ul>\n<li>ä½¿ç”¨<code>apply(..)</code>æ¥â€œå±•å¼€â€ä¸€ä¸ªæ•°ç»„ï¼Œå¹¶å½“ä½œå‚æ•°ä¼ å…¥ä¸€ä¸ªå‡½æ•°</li>\n<li><code>bind(..)</code>å¯ä»¥å¯¹å‚æ•°è¿›è¡ŒæŸ¯é‡ŒåŒ–ï¼ˆé¢„å…ˆè®¾ç½®ä¸€äº›å‚æ•°ï¼‰</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">a, b</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( <span class=\"string\">\"a:\"</span> + a + <span class=\"string\">\"ï¼Œb:\"</span> + b );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æŠŠæ•°ç»„â€å±•å¼€â€œæˆå‚æ•°</span></span><br><span class=\"line\">foo.apply( <span class=\"literal\">null</span>, [<span class=\"number\">2</span>, <span class=\"number\">3</span>] ); <span class=\"comment\">// a:2ï¼Œb:3</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ä½¿ç”¨bind(..)è¿›è¡ŒæŸ¯é‡ŒåŒ–</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> bar = foo.bind( <span class=\"literal\">null</span>, <span class=\"number\">2</span> );</span><br><span class=\"line\">bar( <span class=\"number\">3</span> ); <span class=\"comment\">// a:2ï¼Œb:3</span></span><br></pre></td></tr></table></figure>\n\n<p>æ€»æ˜¯ä¼ å…¥<code>null</code>æ¥å¿½ç•¥thisç»‘å®šå¯èƒ½äº§ç”Ÿä¸€äº›å‰¯ä½œç”¨ã€‚å¦‚æœæŸä¸ªå‡½æ•°ç¡®å®ä½¿ç”¨äº†thisï¼Œé‚£é»˜è®¤ç»‘å®šè§„åˆ™ä¼šæŠŠthisç»‘å®šåˆ°å…¨å±€å¯¹è±¡ä¸­ã€‚</p>\n<blockquote>\n<p>æ›´å®‰å…¨çš„this</p>\n</blockquote>\n<p>å®‰å…¨çš„åšæ³•å°±æ˜¯ä¼ å…¥ä¸€ä¸ªç‰¹æ®Šçš„å¯¹è±¡ï¼ˆç©ºå¯¹è±¡ï¼‰ï¼ŒæŠŠthisç»‘å®šåˆ°è¿™ä¸ªå¯¹è±¡ä¸ä¼šå¯¹ä½ çš„ç¨‹åºäº§ç”Ÿä»»ä½•å‰¯ä½œç”¨ã€‚</p>\n<p>JSä¸­åˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡æœ€ç®€å•çš„æ–¹æ³•æ˜¯<strong><code>Object.create(null)</code></strong>ï¼Œè¿™ä¸ªå’Œ<code>{}</code>å¾ˆåƒï¼Œä½†æ˜¯å¹¶ä¸ä¼šåˆ›å»º<code>Object.prototype</code>è¿™ä¸ªå§”æ‰˜ï¼Œæ‰€ä»¥æ¯”<code>{}</code>æ›´ç©ºã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">a, b</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( <span class=\"string\">\"a:\"</span> + a + <span class=\"string\">\"ï¼Œb:\"</span> + b );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æˆ‘ä»¬çš„ç©ºå¯¹è±¡</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Ã¸ = <span class=\"built_in\">Object</span>.create( <span class=\"literal\">null</span> );</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æŠŠæ•°ç»„â€å±•å¼€â€œæˆå‚æ•°</span></span><br><span class=\"line\">foo.apply( Ã¸, [<span class=\"number\">2</span>, <span class=\"number\">3</span>] ); <span class=\"comment\">// a:2ï¼Œb:3</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ä½¿ç”¨bind(..)è¿›è¡ŒæŸ¯é‡ŒåŒ–</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> bar = foo.bind( Ã¸, <span class=\"number\">2</span> );</span><br><span class=\"line\">bar( <span class=\"number\">3</span> ); <span class=\"comment\">// a:2ï¼Œb:3</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"é—´æ¥å¼•ç”¨\"><a href=\"#é—´æ¥å¼•ç”¨\" class=\"headerlink\" title=\"é—´æ¥å¼•ç”¨\"></a>é—´æ¥å¼•ç”¨</h4><p>é—´æ¥å¼•ç”¨ä¸‹ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°ä¼šåº”ç”¨é»˜è®¤ç»‘å®šè§„åˆ™ã€‚é—´æ¥å¼•ç”¨æœ€å®¹æ˜“åœ¨<strong>èµ‹å€¼</strong>æ—¶å‘ç”Ÿã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// p.foo = o.fooçš„è¿”å›å€¼æ˜¯ç›®æ ‡å‡½æ•°çš„å¼•ç”¨ï¼Œæ‰€ä»¥è°ƒç”¨ä½ç½®æ˜¯foo()è€Œä¸æ˜¯p.foo()æˆ–è€…o.foo()</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( <span class=\"keyword\">this</span>.a );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> o = &#123; <span class=\"attr\">a</span>: <span class=\"number\">3</span>, <span class=\"attr\">foo</span>: foo &#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> p = &#123; <span class=\"attr\">a</span>: <span class=\"number\">4</span>&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">o.foo(); <span class=\"comment\">// 3</span></span><br><span class=\"line\">(p.foo = o.foo)(); <span class=\"comment\">// 2</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"è½¯ç»‘å®š\"><a href=\"#è½¯ç»‘å®š\" class=\"headerlink\" title=\"è½¯ç»‘å®š\"></a>è½¯ç»‘å®š</h4><ul>\n<li>ç¡¬ç»‘å®šå¯ä»¥æŠŠthiså¼ºåˆ¶ç»‘å®šåˆ°æŒ‡å®šçš„å¯¹è±¡ï¼ˆ<code>new</code>é™¤å¤–ï¼‰ï¼Œé˜²æ­¢å‡½æ•°è°ƒç”¨åº”ç”¨é»˜è®¤ç»‘å®šè§„åˆ™ã€‚ä½†æ˜¯ä¼šé™ä½å‡½æ•°çš„çµæ´»æ€§ï¼Œä½¿ç”¨<strong>ç¡¬ç»‘å®šä¹‹åå°±æ— æ³•ä½¿ç”¨éšå¼ç»‘å®šæˆ–è€…æ˜¾å¼ç»‘å®šæ¥ä¿®æ”¹this</strong>ã€‚</li>\n<li><strong>å¦‚æœç»™é»˜è®¤ç»‘å®šæŒ‡å®šä¸€ä¸ªå…¨å±€å¯¹è±¡å’Œundefinedä»¥å¤–çš„å€¼</strong>ï¼Œé‚£å°±å¯ä»¥å®ç°å’Œç¡¬ç»‘å®šç›¸åŒçš„æ•ˆæœï¼ŒåŒæ—¶ä¿ç•™éšå¼ç»‘å®šæˆ–è€…æ˜¾ç¤ºç»‘å®šä¿®æ”¹thisçš„èƒ½åŠ›ã€‚</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// é»˜è®¤ç»‘å®šè§„åˆ™ï¼Œä¼˜å…ˆçº§æ’æœ€å</span></span><br><span class=\"line\"><span class=\"comment\">// å¦‚æœthisç»‘å®šåˆ°å…¨å±€å¯¹è±¡æˆ–è€…undefinedï¼Œé‚£å°±æŠŠæŒ‡å®šçš„é»˜è®¤å¯¹è±¡objç»‘å®šåˆ°this,å¦åˆ™ä¸ä¼šä¿®æ”¹this</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>(!<span class=\"built_in\">Function</span>.prototype.softBind) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">Function</span>.prototype.softBind = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">obj</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> fn = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">        <span class=\"comment\">// æ•è·æ‰€æœ‰curriedå‚æ•°</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> curried = [].slice.call( <span class=\"built_in\">arguments</span>, <span class=\"number\">1</span> ); </span><br><span class=\"line\">        <span class=\"keyword\">var</span> bound = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> fn.apply(</span><br><span class=\"line\">            \t(!<span class=\"keyword\">this</span> || <span class=\"keyword\">this</span> === (<span class=\"built_in\">window</span> || global)) ? </span><br><span class=\"line\">                \tobj : <span class=\"keyword\">this</span>,</span><br><span class=\"line\">                curried.concat.apply( curried, <span class=\"built_in\">arguments</span> )</span><br><span class=\"line\">            );</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        bound.prototype = <span class=\"built_in\">Object</span>.create( fn.prototype );</span><br><span class=\"line\">        <span class=\"keyword\">return</span> bound;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä½¿ç”¨ï¼šè½¯ç»‘å®šç‰ˆæœ¬çš„foo()å¯ä»¥æ‰‹åŠ¨å°†thisç»‘å®šåˆ°obj2æˆ–è€…obj3ä¸Šï¼Œä½†å¦‚æœåº”ç”¨é»˜è®¤ç»‘å®šï¼Œåˆ™ä¼šå°†thisç»‘å®šåˆ°objã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"name:\"</span> + <span class=\"keyword\">this</span>.name);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123; <span class=\"attr\">name</span>: <span class=\"string\">\"obj\"</span> &#125;,</span><br><span class=\"line\">    obj2 = &#123; <span class=\"attr\">name</span>: <span class=\"string\">\"obj2\"</span> &#125;,</span><br><span class=\"line\">    obj3 = &#123; <span class=\"attr\">name</span>: <span class=\"string\">\"obj3\"</span> &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// é»˜è®¤ç»‘å®šï¼Œåº”ç”¨è½¯ç»‘å®šï¼Œè½¯ç»‘å®šæŠŠthisç»‘å®šåˆ°é»˜è®¤å¯¹è±¡obj</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fooOBJ = foo.softBind( obj );</span><br><span class=\"line\">fooOBJ(); <span class=\"comment\">// name: obj </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// éšå¼ç»‘å®šè§„åˆ™</span></span><br><span class=\"line\">obj2.foo = foo.softBind( obj );</span><br><span class=\"line\">obj2.foo(); <span class=\"comment\">// name: obj2 &lt;---- çœ‹ï¼ï¼ï¼</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æ˜¾å¼ç»‘å®šè§„åˆ™</span></span><br><span class=\"line\">fooOBJ.call( obj3 ); <span class=\"comment\">// name: obj3 &lt;---- çœ‹ï¼ï¼ï¼</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ç»‘å®šä¸¢å¤±ï¼Œåº”ç”¨è½¯ç»‘å®š</span></span><br><span class=\"line\">setTimeout( obj2.foo, <span class=\"number\">10</span> ); <span class=\"comment\">// name: obj</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ç®­å¤´å‡½æ•°\"><a href=\"#ç®­å¤´å‡½æ•°\" class=\"headerlink\" title=\"ç®­å¤´å‡½æ•°\"></a>ç®­å¤´å‡½æ•°</h3><p>ES6æ–°å¢ä¸€ç§ç‰¹æ®Šå‡½æ•°ç±»å‹ï¼šç®­å¤´å‡½æ•°ï¼Œç®­å¤´å‡½æ•°æ— æ³•ä½¿ç”¨ä¸Šè¿°å››æ¡è§„åˆ™ï¼Œè€Œæ˜¯æ ¹æ®å¤–å±‚ï¼ˆå‡½æ•°æˆ–è€…å…¨å±€ï¼‰ä½œç”¨åŸŸï¼ˆ<strong>è¯æ³•ä½œç”¨åŸŸ</strong>ï¼‰æ¥å†³å®šthisã€‚</p>\n<ul>\n<li><code>foo()</code>å†…éƒ¨åˆ›å»ºçš„ç®­å¤´å‡½æ•°ä¼šæ•è·è°ƒç”¨æ—¶<code>foo()</code>çš„thisã€‚ç”±äº<code>foo()</code>çš„thisç»‘å®šåˆ°<code>obj1</code>ï¼Œ<code>bar</code>(å¼•ç”¨ç®­å¤´å‡½æ•°)çš„thisä¹Ÿä¼šç»‘å®šåˆ°<code>obj1</code>ï¼Œ<strong>ç®­å¤´å‡½æ•°çš„ç»‘å®šæ— æ³•è¢«ä¿®æ”¹</strong>(<code>new</code>ä¹Ÿä¸è¡Œ)ã€‚</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// è¿”å›ä¸€ä¸ªç®­å¤´å‡½æ•°</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\">(<span class=\"params\">a</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// thisç»§æ‰¿è‡ªfoo()</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log( <span class=\"keyword\">this</span>.a );</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj1 = &#123;</span><br><span class=\"line\">    a: <span class=\"number\">2</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj2 = &#123;</span><br><span class=\"line\">    a: <span class=\"number\">3</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> bar = foo.call( obj1 );</span><br><span class=\"line\">bar.call( obj2 ); <span class=\"comment\">// 2ï¼Œä¸æ˜¯3ï¼</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>ç®­å¤´å‡½æ•°æœ€å¸¸ç”¨äºå›è°ƒå‡½æ•°ä¸­ï¼Œä¾‹å¦‚äº‹ä»¶å¤„ç†å™¨æˆ–è€…å®šæ—¶å™¨ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">  setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// è¿™é‡Œçš„ this åœ¨æ­¤æ³•ä¸Šç»§æ‰¿è‡ª foo()</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( <span class=\"keyword\">this</span>.a ); &#125;,<span class=\"number\">100</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123; </span><br><span class=\"line\">\ta:<span class=\"number\">2</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">foo.call( obj ); <span class=\"comment\">// 2</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>ES6ä¹‹å‰å’Œç®­å¤´å‡½æ•°ç±»ä¼¼çš„æ¨¡å¼ï¼Œé‡‡ç”¨çš„æ˜¯è¯æ³•ä½œç”¨åŸŸå–ä»£äº†ä¼ ç»Ÿçš„thisæœºåˆ¶ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> self = <span class=\"keyword\">this</span>; <span class=\"comment\">// lexical capture of this</span></span><br><span class=\"line\">    setTimeout( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log( self.a ); <span class=\"comment\">// selfåªæ˜¯ç»§æ‰¿äº†foo()å‡½æ•°çš„thisç»‘å®š</span></span><br><span class=\"line\">    &#125;, <span class=\"number\">100</span> );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">    a: <span class=\"number\">2</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">foo.call(obj); <span class=\"comment\">// 2</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"å®ç°callå’Œapply\"><a href=\"#å®ç°callå’Œapply\" class=\"headerlink\" title=\"å®ç°callå’Œapply\"></a>å®ç°callå’Œapply</h2><h3 id=\"äº†è§£callå’Œapply\"><a href=\"#äº†è§£callå’Œapply\" class=\"headerlink\" title=\"äº†è§£callå’Œapply\"></a>äº†è§£callå’Œapply</h3><p>ä¸ºä»€ä¹ˆä¼šæœ‰callå’Œapplyï¼Ÿ callå’Œapplyä¸¤ä¸ªæ–¹æ³•çš„ä½œç”¨åŸºæœ¬ç›¸åŒï¼Œå®ƒä»¬éƒ½æ˜¯ä¸ºäº†æ”¹å˜æŸä¸ªå‡½æ•°<strong>æ‰§è¡Œæ—¶çš„ä¸Šä¸‹æ–‡</strong>ï¼ˆcontextï¼‰è€Œå»ºç«‹çš„ï¼Œ ä»–çš„çœŸæ­£å¼ºå¤§ä¹‹å¤„å°±æ˜¯èƒ½å¤Ÿæ‰©å……å‡½æ•°èµ–ä»¥è¿è¡Œçš„ä½œç”¨åŸŸã€‚é€šä¿—ä¸€ç‚¹è®²ï¼Œå°±æ˜¯æ”¹å˜å‡½æ•°ä½“å†…éƒ¨<strong>this çš„æŒ‡å‘</strong>ã€‚</p>\n<p>ä¸¾ä¸ªæ —å­ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">window.color &#x3D; &quot;red&quot;;</span><br><span class=\"line\">var o &#x3D; &#123;color: &quot;blue&quot;&#125;;</span><br><span class=\"line\">function sayColor()&#123;</span><br><span class=\"line\">\talert(this.color);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">sayColor();&#x2F;&#x2F;red</span><br><span class=\"line\">sayColor.call(this);&#x2F;&#x2F;redï¼ŒæŠŠå‡½æ•°ä½“sayColorå†…éƒ¨çš„thisï¼Œç»‘åˆ°å½“å‰ç¯å¢ƒï¼ˆä½œç”¨åŸŸï¼‰(è¿™æ®µä»£ç æ‰€å¤„çš„ç¯å¢ƒ)</span><br><span class=\"line\">sayColor.call(window);&#x2F;&#x2F;redï¼ŒæŠŠå‡½æ•°ä½“sayColorå†…éƒ¨çš„thisï¼Œç»‘åˆ°windowï¼ˆå…¨å±€ä½œç”¨åŸŸï¼‰</span><br><span class=\"line\">sayColor.call(o);&#x2F;&#x2F;blueå¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>\n\n\n\n<blockquote>\n<p><strong>è§£é‡Šï¼š</strong>ä¸Šé¢çš„æ —å­ï¼Œå¾ˆæ˜æ˜¾å‡½æ•°sayColoræ˜¯åœ¨å…¨å±€ä½œç”¨åŸŸï¼ˆç¯å¢ƒ/windowï¼‰ä¸­è°ƒç”¨çš„ï¼Œè€Œå…¨å±€ä½œç”¨åŸŸä¸­æœ‰ä¸€ä¸ªcolorå±æ€§ï¼Œå€¼ä¸ºâ€redâ€ï¼ŒsayColor.call(this)è¿™ä¸€è¡Œä»£ç å°±æ˜¯è¡¨ç¤º<strong>æŠŠå‡½æ•°ä½“sayColorå†…éƒ¨çš„thisï¼Œç»‘åˆ°å½“å‰ç¯å¢ƒï¼ˆä½œç”¨åŸŸï¼‰</strong>ï¼Œè€ŒsayColor.call(window)è¿™ä¸€è¡Œä»£ç å°±æ˜¯è¡¨ç¤º<strong>æŠŠå‡½æ•°ä½“sayColorå†…éƒ¨çš„thisï¼Œç»‘åˆ°windowï¼ˆå…¨å±€ä½œç”¨åŸŸï¼‰</strong>ï¼Œä¹‹æ‰€ä»¥è¿™ä¸¤è¡Œçš„è¾“å‡ºéƒ½æ˜¯â€redâ€å°±æ˜¯å› ä¸ºä»–å½“å‰ä½œç”¨åŸŸçš„thiså°±æ˜¯windowï¼ˆthis === windowï¼‰ï¼› æœ€åï¼ŒsayColor.call(o)è¿™ä¸€è¡Œä»£ç å°±è¡¨ç¤º<strong>æŠŠå‡½æ•°ä½“sayColorå†…éƒ¨çš„thisï¼Œç»‘åˆ°oè¿™ä¸ªå¯¹è±¡çš„æ‰§è¡Œç¯å¢ƒï¼ˆä¸Šä¸‹æ–‡ï¼‰ä¸­æ¥</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´sayColorå†…éƒ¨çš„thisâ€”â€”&gt;<strong>o</strong></p>\n</blockquote>\n<h3 id=\"callå’Œapplyçš„åŒºåˆ«\"><a href=\"#callå’Œapplyçš„åŒºåˆ«\" class=\"headerlink\" title=\"callå’Œapplyçš„åŒºåˆ«\"></a>callå’Œapplyçš„åŒºåˆ«</h3><p><code>call()</code> å’Œ <code>apply()</code>çš„åŒºåˆ«åœ¨äºï¼Œ<code>call()</code>æ–¹æ³•æ¥å—çš„æ˜¯<strong>è‹¥å¹²ä¸ªå‚æ•°çš„åˆ—è¡¨</strong>ï¼Œè€Œ<code>apply()</code>æ–¹æ³•æ¥å—çš„æ˜¯<strong>ä¸€ä¸ªåŒ…å«å¤šä¸ªå‚æ•°çš„æ•°ç»„</strong></p>\n<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> func = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">arg1, arg2</span>) </span>&#123;</span><br><span class=\"line\">     ...</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">func.call(<span class=\"keyword\">this</span>, arg1, arg2); <span class=\"comment\">// ä½¿ç”¨ callï¼Œå‚æ•°åˆ—è¡¨</span></span><br><span class=\"line\">func.apply(<span class=\"keyword\">this</span>, [arg1, arg2]) <span class=\"comment\">// ä½¿ç”¨ applyï¼Œå‚æ•°æ•°ç»„</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"åº”ç”¨åœºæ™¯\"><a href=\"#åº”ç”¨åœºæ™¯\" class=\"headerlink\" title=\"åº”ç”¨åœºæ™¯\"></a>åº”ç”¨åœºæ™¯</h3><p>å…¶å®è¿™äº›åº”ç”¨åœºæ™¯éƒ½æœ‰æ–°çš„æ–¹æ³•å¯ä»¥å¿«é€Ÿè§£å†³ï¼Œ æˆ‘åªæ˜¯æƒ³å‘Šè¯‰å¤§å®¶ä¸€äº›å°çš„çŸ¥è¯†ç‚¹ï¼Œ è€Œä¸”è¿™äº›ä¸œè¥¿è™½ç„¶æœ‰æ–°çš„æ–¹æ³•ä»£æ›¿ï¼Œä½†æ˜¯é¢è¯•çš„æ—¶å€™å¾ˆå¯èƒ½ä¼šè¢«é—®åˆ°ã€‚</p>\n<h4 id=\"åˆå¹¶ä¸¤ä¸ªæ•°ç»„\"><a href=\"#åˆå¹¶ä¸¤ä¸ªæ•°ç»„\" class=\"headerlink\" title=\"åˆå¹¶ä¸¤ä¸ªæ•°ç»„\"></a>åˆå¹¶ä¸¤ä¸ªæ•°ç»„</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"string\">'a'</span>, <span class=\"string\">'aa'</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = [<span class=\"string\">'b'</span>, <span class=\"string\">'bb'</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Array</span>.prototype.push.apply(a, b);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a) <span class=\"comment\">// ['a', 'aa', 'b', 'bb']</span></span><br></pre></td></tr></table></figure>\n\n<p>å…¶å®ç°åœ¨æœ‰<code>concat</code>æ¥ä»£æ›¿äº†ã€‚æˆ–è€…å…¶ä»–å¥‡æ·«æŠ€å·§ã€‚ä½†æ˜¯ï¼Œéƒ½ä¸æ˜¯æˆ‘ä»¬çš„é‡ç‚¹ã€‚</p>\n<blockquote>\n<p>å½“ç¬¬äºŒä¸ªæ•°ç»„(å¦‚ç¤ºä¾‹ä¸­çš„ b )å¤ªå¤§æ—¶ä¸è¦ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ¥åˆå¹¶æ•°ç»„ï¼Œå› ä¸º<strong>ä¸€ä¸ªå‡½æ•°èƒ½å¤Ÿæ¥å—çš„å‚æ•°ä¸ªæ•°æ˜¯æœ‰é™åˆ¶</strong>çš„ã€‚ä¸åŒçš„å¼•æ“æœ‰ä¸åŒçš„é™åˆ¶ï¼ŒJSæ ¸å¿ƒé™åˆ¶åœ¨ 65535ï¼Œæœ‰äº›å¼•æ“ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæœ‰äº›ä¸æŠ›å‡ºå¼‚å¸¸ä½†ä¸¢å¤±å¤šä½™å‚æ•°ã€‚</p>\n</blockquote>\n<p>é‚£ä¹ˆè¦å¦‚ä½•è§£å†³å‘¢ï¼Ÿ</p>\n<p>æˆ‘ä»¬å¯ä»¥æŠŠæ•°ç»„è¿›è¡Œåˆ‡å‰²ã€‚ç„¶ååˆ†æ‰¹æ¬¡çš„è°ƒç”¨ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">myConcat</span>(<span class=\"params\">arr1, arr2, max = <span class=\"number\">32768</span></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; arr2.length; i += max) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">Array</span>.prototype.push.apply(</span><br><span class=\"line\">    \tarr1,</span><br><span class=\"line\">      arr2.slice(i, i + max) <span class=\"comment\">// å°çš„çŸ¥è¯†ç‚¹ï¼Œç¬¬äºŒä¸ªå‚æ•°å¤§äºæ•°ç»„é•¿åº¦å°±ä¸€ç›´å–åˆ°æ•°ç»„çš„æœ«å°¾</span></span><br><span class=\"line\">    )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"number\">-2</span>, <span class=\"number\">-1</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = [];</span><br><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">999999</span>; i ++) &#123;</span><br><span class=\"line\">  b.push(i)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Array</span>.prototype.push.apply(a, b) <span class=\"comment\">// Uncaught RangeError: Maximum call stack size exceeded</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">myConcat(a, b)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"éªŒè¯æ˜¯å¦æ˜¯æ•°ç»„\"><a href=\"#éªŒè¯æ˜¯å¦æ˜¯æ•°ç»„\" class=\"headerlink\" title=\"éªŒè¯æ˜¯å¦æ˜¯æ•°ç»„\"></a>éªŒè¯æ˜¯å¦æ˜¯æ•°ç»„</h4><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [];</span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(arr); <span class=\"comment\">// [object Array]</span></span><br><span class=\"line\"><span class=\"comment\">//æŠŠå‡½æ•°ä½“Object.prototype.toString()æ–¹æ³•å†…éƒ¨çš„thisï¼Œç»‘åˆ°arrçš„æ‰§è¡Œç¯å¢ƒï¼ˆä½œç”¨åŸŸï¼‰å¤åˆ¶ä»£ç </span></span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"åŒæ ·æ˜¯æ£€æµ‹å¯¹è±¡ç±»å‹ï¼Œarr-toString-çš„ç»“æœå’ŒObject-prototype-toString-call-arr-çš„ç»“æœä¸ä¸€æ ·ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ\"><a href=\"#åŒæ ·æ˜¯æ£€æµ‹å¯¹è±¡ç±»å‹ï¼Œarr-toString-çš„ç»“æœå’ŒObject-prototype-toString-call-arr-çš„ç»“æœä¸ä¸€æ ·ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ\" class=\"headerlink\" title=\"åŒæ ·æ˜¯æ£€æµ‹å¯¹è±¡ç±»å‹ï¼Œarr.toString()çš„ç»“æœå’ŒObject.prototype.toString.call(arr)çš„ç»“æœä¸ä¸€æ ·ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ\"></a>åŒæ ·æ˜¯æ£€æµ‹å¯¹è±¡ç±»å‹ï¼Œarr.toString()çš„ç»“æœå’ŒObject.prototype.toString.call(arr)çš„ç»“æœä¸ä¸€æ ·ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ</h4><blockquote>\n<p>è¿™æ˜¯å› ä¸ºtoString()ä¸ºObjectçš„åŸå‹æ–¹æ³•ï¼Œè€ŒArray ï¼Œfunctionç­‰å¼•ç”¨ç±»å‹ä½œä¸ºObjectçš„å®ä¾‹ï¼Œéƒ½é‡å†™äº†toStringæ–¹æ³•ã€‚ä¸åŒçš„å¯¹è±¡ç±»å‹è°ƒç”¨toStringæ–¹æ³•æ—¶ï¼Œæ ¹æ®åŸå‹é“¾çš„çŸ¥è¯†ï¼Œè°ƒç”¨çš„æ˜¯å¯¹åº”çš„<strong>é‡å†™</strong>ä¹‹åçš„toStringæ–¹æ³•ï¼ˆfunctionç±»å‹è¿”å›å†…å®¹ä¸ºå‡½æ•°ä½“çš„å­—ç¬¦ä¸²ï¼ŒArrayç±»å‹è¿”å›å…ƒç´ ç»„æˆçš„å­—ç¬¦ä¸²â€¦..ï¼‰ï¼Œè€Œä¸ä¼šå»è°ƒç”¨Objectä¸ŠåŸå‹toStringæ–¹æ³•ï¼Œæ‰€ä»¥é‡‡ç”¨arr.toString()ä¸èƒ½å¾—åˆ°å…¶å¯¹è±¡ç±»å‹ï¼Œåªèƒ½å°†arrè½¬æ¢ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼›å› æ­¤ï¼Œåœ¨æƒ³è¦å¾—åˆ°å¯¹è±¡çš„å…·ä½“ç±»å‹æ—¶ï¼Œåº”è¯¥è°ƒç”¨Objectä¸ŠåŸå‹toStringæ–¹æ³•ã€‚</p>\n</blockquote>\n<h4 id=\"ç±»æ•°ç»„å¯¹è±¡ï¼ˆArray-like-Objectï¼‰ä½¿ç”¨æ•°ç»„æ–¹æ³•\"><a href=\"#ç±»æ•°ç»„å¯¹è±¡ï¼ˆArray-like-Objectï¼‰ä½¿ç”¨æ•°ç»„æ–¹æ³•\" class=\"headerlink\" title=\"ç±»æ•°ç»„å¯¹è±¡ï¼ˆArray-like Objectï¼‰ä½¿ç”¨æ•°ç»„æ–¹æ³•\"></a>ç±»æ•°ç»„å¯¹è±¡ï¼ˆArray-like Objectï¼‰ä½¿ç”¨æ•°ç»„æ–¹æ³•</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> domNodes = <span class=\"built_in\">document</span>.getElementsByTagName(<span class=\"string\">\"*\"</span>);</span><br><span class=\"line\">domNodes.unshift(<span class=\"string\">\"h1\"</span>);</span><br><span class=\"line\"><span class=\"comment\">// TypeError: domNodes.unshift is not a function</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> domNodeArrays = <span class=\"built_in\">Array</span>.prototype.slice.call(domNodes);</span><br><span class=\"line\">domNodeArrays.unshift(<span class=\"string\">\"h1\"</span>); <span class=\"comment\">// 505 ä¸åŒç¯å¢ƒä¸‹æ•°æ®ä¸åŒ</span></span><br><span class=\"line\"><span class=\"comment\">// (505) [\"h1\", html.gr__hujiang_com, head, meta, ...]</span></span><br></pre></td></tr></table></figure>\n\n<p>ç±»æ•°ç»„å¯¹è±¡æœ‰ä¸‹é¢ä¸¤ä¸ªç‰¹æ€§</p>\n<ul>\n<li>1ã€å…·æœ‰ï¼šæŒ‡å‘å¯¹è±¡å…ƒç´ çš„æ•°å­—ç´¢å¼•ä¸‹æ ‡å’Œ <code>length</code> å±æ€§</li>\n<li>2ã€ä¸å…·æœ‰ï¼šæ¯”å¦‚ <code>push</code> ã€<code>shift</code>ã€ <code>forEach</code> ä»¥åŠ <code>indexOf</code>ç­‰æ•°ç»„å¯¹è±¡å…·æœ‰çš„æ–¹æ³•</li>\n</ul>\n<p>è¦è¯´æ˜çš„æ˜¯ï¼Œç±»æ•°ç»„å¯¹è±¡æ˜¯ä¸€ä¸ª<strong>å¯¹è±¡</strong>ã€‚JSä¸­å­˜åœ¨ä¸€ç§åä¸º<strong>ç±»æ•°ç»„</strong>çš„å¯¹è±¡ç»“æ„ï¼Œæ¯”å¦‚ <code>arguments</code> å¯¹è±¡ï¼Œè¿˜æœ‰DOM API è¿”å›çš„ <code>NodeList</code> å¯¹è±¡éƒ½å±äºç±»æ•°ç»„å¯¹è±¡ï¼Œç±»æ•°ç»„å¯¹è±¡ä¸èƒ½ä½¿ç”¨ <code>push/pop/shift/unshift</code> ç­‰æ•°ç»„æ–¹æ³•ï¼Œé€šè¿‡ <code>Array.prototype.slice.call</code> è½¬æ¢æˆçœŸæ­£çš„æ•°ç»„ï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>Array</code>ä¸‹æ‰€æœ‰æ–¹æ³•ã€‚</p>\n<p><strong>ç±»æ•°ç»„å¯¹è±¡è½¬æ•°ç»„</strong>çš„å…¶ä»–æ–¹æ³•ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ä¸Šé¢ä»£ç ç­‰åŒäº</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [].slice.call(<span class=\"built_in\">arguments</span>)ï¼›</span><br><span class=\"line\"></span><br><span class=\"line\">ES6:</span><br><span class=\"line\"><span class=\"keyword\">let</span> arr = <span class=\"built_in\">Array</span>.from(<span class=\"built_in\">arguments</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> arr = [...arguments];</span><br></pre></td></tr></table></figure>\n\n<p><code>Array.from()</code> å¯ä»¥å°†ä¸¤ç±»å¯¹è±¡è½¬ä¸ºçœŸæ­£çš„æ•°ç»„ï¼š<strong>ç±»æ•°ç»„</strong>å¯¹è±¡å’Œ<strong>å¯éå†</strong>ï¼ˆiterableï¼‰å¯¹è±¡ï¼ˆåŒ…æ‹¬ES6æ–°å¢çš„æ•°æ®ç»“æ„ Set å’Œ Mapï¼‰ã€‚</p>\n<h3 id=\"å®ç°call\"><a href=\"#å®ç°call\" class=\"headerlink\" title=\"å®ç°call\"></a>å®ç°call</h3><p>è¿™é‡Œä¼šä½¿ç”¨éšå¼ç»‘å®šæ¥å®ç°ã€‚</p>\n<p>å…ˆä¸¢å‡ºæˆ‘ä»¬è¦æµ‹è¯•çš„ä¾‹å­ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.a)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = &#123;</span><br><span class=\"line\">  a: <span class=\"number\">2</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">f(); <span class=\"comment\">// 1</span></span><br><span class=\"line\">f.call(b) <span class=\"comment\">// 2</span></span><br></pre></td></tr></table></figure>\n\n<p>OK, æˆ‘ä»¬ç°åœ¨å°±æ¥å®ç°ä»¥ä¸‹è‡ªå®šä¹‰çš„callã€‚åº”ç”¨éšå¼ç»‘å®šçš„è¯å°±å¯ä»¥ç›´æ¥ç»‘å®šä¸Šäº†ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.a)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.myCall = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">context</span>) </span>&#123;</span><br><span class=\"line\">  context.fn = f;</span><br><span class=\"line\">  context.fn();</span><br><span class=\"line\">  <span class=\"keyword\">delete</span> context.fn;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> b = &#123;</span><br><span class=\"line\">  a: <span class=\"number\">2</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">f(); <span class=\"comment\">// 1</span></span><br><span class=\"line\">f.myCall(b) <span class=\"comment\">// 2</span></span><br></pre></td></tr></table></figure>\n\n<p>å¾ˆæ½‡æ´’çš„å®Œæˆäº†ã€‚ä½†æ˜¯å¥½åƒä¸èƒ½æ¥å—å‚æ•°è¯¶ï¼Œæ¥å—å‚æ•°åˆè¦è€ƒè™‘è¾¹ç•Œæƒ…å†µï¼Œæ¯”å¦‚<code>undefined</code>ï¼Œ<code>null</code>ä¹‹ç±»çš„ã€‚è€Œä¸”ï¼ï¼è€Œä¸”ï¼ï¼è€Œä¸”<code>call</code>ä¸ä¼ çš„è¯æ˜¯é»˜è®¤åº”ç”¨<code>window</code>çš„ï¼›</p>\n<p>æ‰€ä»¥ä»–æœ‰æˆ‘ä»¬ä¹Ÿè¦æœ‰ï¼å†²ï¼</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.myCall = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">context</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// å–å¾—ä¼ å…¥çš„å¯¹è±¡ï¼ˆæ‰§è¡Œä¸Šä¸‹æ–‡ï¼‰ï¼Œæ¯”å¦‚ä¸Šæ–‡çš„fooå¯¹è±¡ï¼Œè¿™é‡Œçš„contextå°±ç›¸å½“äºä¸Šæ–‡çš„foo</span></span><br><span class=\"line\">  <span class=\"comment\">// ä¸ä¼ ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œé»˜è®¤æ˜¯window,</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> context = context || <span class=\"built_in\">window</span>;</span><br><span class=\"line\">  <span class=\"comment\">// ç»™contextæ·»åŠ ä¸€ä¸ªå±æ€§ï¼Œè¿™æ—¶çš„thisæŒ‡å‘è°ƒç”¨myCallçš„å‡½æ•°ï¼Œæ¯”å¦‚ä¸Šæ–‡çš„barå‡½æ•°</span></span><br><span class=\"line\">  context.fn = <span class=\"keyword\">this</span>;<span class=\"comment\">//è¿™é‡Œçš„context.fnå°±ç›¸å½“äºä¸Šæ–‡çš„barå‡½æ•°</span></span><br><span class=\"line\">  <span class=\"comment\">// é€šè¿‡å±•å¼€è¿ç®—ç¬¦å’Œè§£æ„èµ‹å€¼å–å‡ºcontextåé¢çš„å‚æ•°ï¼Œä¸Šæ–‡çš„ä¾‹å­æ²¡æœ‰ä¼ å…¥å‚æ•°åˆ—è¡¨</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> args = [...arguments].slice(<span class=\"number\">1</span>);</span><br><span class=\"line\">  <span class=\"comment\">// æ‰§è¡Œå‡½æ•°ï¼ˆç›¸å½“äºä¸Šæ–‡çš„bar(...args)ï¼‰</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> result = context.fn(...args);</span><br><span class=\"line\">  <span class=\"comment\">// åˆ é™¤å‡½æ•°</span></span><br><span class=\"line\">  <span class=\"keyword\">delete</span> context.fn;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"å®ç°apply\"><a href=\"#å®ç°apply\" class=\"headerlink\" title=\"å®ç°apply\"></a>å®ç°apply</h3><p>å› ä¸ºä»–ä»¬ä¸¤å…„å¼Ÿå°±å‚æ•°ä¸ä¸€æ ·æ‰€ä»¥å°±ä¸è§£é‡Šäº†ï¼Œç›´æ¥çœ‹ä»£ç å§ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.myApply = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">context</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> context = context || <span class=\"built_in\">window</span>;</span><br><span class=\"line\">      context.fn = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> result;</span><br><span class=\"line\">      <span class=\"comment\">// åˆ¤æ–­ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¦å­˜åœ¨ï¼Œä¹Ÿå°±æ˜¯contextåé¢æœ‰æ²¡æœ‰ä¸€ä¸ªæ•°ç»„</span></span><br><span class=\"line\">      <span class=\"comment\">// å¦‚æœå­˜åœ¨ï¼Œåˆ™éœ€è¦å±•å¼€ç¬¬äºŒä¸ªå‚æ•°</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"built_in\">arguments</span>[<span class=\"number\">1</span>]) &#123;</span><br><span class=\"line\">        result = context.fn(...arguments[<span class=\"number\">1</span>]);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        result = context.fn();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">delete</span> context.fn;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"å®ç°bind\"><a href=\"#å®ç°bind\" class=\"headerlink\" title=\"å®ç°bind\"></a>å®ç°bind</h2><h4 id=\"äº†è§£bind\"><a href=\"#äº†è§£bind\" class=\"headerlink\" title=\"äº†è§£bind\"></a>äº†è§£bind</h4><blockquote>\n<p><code>bind() æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œåœ¨</code>bind()<code>è¢«è°ƒç”¨æ—¶ï¼Œè¿™ä¸ªæ–°å‡½æ•°çš„</code>this<code>è¢«æŒ‡å®šä¸º</code>bind()` çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè€Œå…¶ä½™å‚æ•°å°†ä½œä¸ºæ–°å‡½æ•°çš„å‚æ•°ï¼Œä¾›è°ƒç”¨æ—¶ä½¿ç”¨ã€‚</p>\n<p>è¯­æ³•ï¼š<code>fun.bind(thisArg[, arg1[, arg2[, ...]]])</code></p>\n<p>MDN</p>\n</blockquote>\n<h4 id=\"bindå’Œapplyï¼Œcallä¸¤å…„å¼Ÿçš„åŒºåˆ«\"><a href=\"#bindå’Œapplyï¼Œcallä¸¤å…„å¼Ÿçš„åŒºåˆ«\" class=\"headerlink\" title=\"bindå’Œapplyï¼Œcallä¸¤å…„å¼Ÿçš„åŒºåˆ«\"></a>bindå’Œapplyï¼Œcallä¸¤å…„å¼Ÿçš„åŒºåˆ«</h4><p><code>bind</code> æ–¹æ³•ä¸ <code>call / apply</code> æœ€å¤§çš„ä¸åŒå°±æ˜¯å‰è€…è¿”å›ä¸€ä¸ªç»‘å®šä¸Šä¸‹æ–‡çš„<strong>å‡½æ•°</strong>ï¼Œè€Œåä¸¤è€…æ˜¯<strong>ç›´æ¥æ‰§è¡Œ</strong>äº†å‡½æ•°ã€‚</p>\n<p>ä¸Šä»£ç ï¼</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> value = <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> foo = &#123;</span><br><span class=\"line\">    value: <span class=\"number\">1</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bar</span>(<span class=\"params\">name, age</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">\t\tvalue: <span class=\"keyword\">this</span>.value,</span><br><span class=\"line\">\t\tname: name,</span><br><span class=\"line\">\t\tage: age</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">bar.call(foo, <span class=\"string\">\"Jack\"</span>, <span class=\"number\">20</span>); <span class=\"comment\">// ç›´æ¥æ‰§è¡Œäº†å‡½æ•°</span></span><br><span class=\"line\"><span class=\"comment\">// &#123;value: 1, name: \"Jack\", age: 20&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> bindFoo1 = bar.bind(foo, <span class=\"string\">\"Jack\"</span>, <span class=\"number\">20</span>); <span class=\"comment\">// è¿”å›ä¸€ä¸ªå‡½æ•°</span></span><br><span class=\"line\">bindFoo1();</span><br><span class=\"line\"><span class=\"comment\">// &#123;value: 1, name: \"Jack\", age: 20&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> bindFoo2 = bar.bind(foo, <span class=\"string\">\"Jack\"</span>); <span class=\"comment\">// è¿”å›ä¸€ä¸ªå‡½æ•°</span></span><br><span class=\"line\">bindFoo2(<span class=\"number\">20</span>);</span><br><span class=\"line\"><span class=\"comment\">// &#123;value: 1, name: \"Jack\", age: 20&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>é€šè¿‡ä¸Šè¿°ä»£ç å¯ä»¥çœ‹å‡º<code>bind</code> æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š</p>\n<ul>\n<li>1ã€å¯ä»¥æŒ‡å®š<code>this</code></li>\n<li>2ã€è¿”å›ä¸€ä¸ªå‡½æ•°</li>\n<li>3ã€å¯ä»¥ä¼ å…¥å‚æ•°</li>\n<li>4ã€æŸ¯é‡ŒåŒ–</li>\n</ul>\n<h4 id=\"å®ç°bind-1\"><a href=\"#å®ç°bind-1\" class=\"headerlink\" title=\"å®ç°bind\"></a>å®ç°bind</h4><p>ç›´æ¥å¼€å¹²ï¼</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.myBind = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">context</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> that = <span class=\"keyword\">this</span>; <span class=\"comment\">// è¿™é‡Œåˆ©ç”¨çš„é—­åŒ…ä¿å­˜äº†æ­¤æ—¶æ­¤åˆ»çš„thisï¼Œå¦åˆ™åé¢è°ƒç”¨çš„è¯ä¼šéšå¼ä¸¢å¤±</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">    <span class=\"keyword\">return</span> that.apply(context)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æµ‹è¯•ç”¨ä¾‹</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> value = <span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> foo = &#123;</span><br><span class=\"line\">    value: <span class=\"number\">1</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bar</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.value;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> bindFoo = bar.myBind(foo);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(bindFoo()); <span class=\"comment\">// 1</span></span><br></pre></td></tr></table></figure>\n\n<p>Ok,æ¥ä¸‹æ¥æˆ‘ä»¬å¤„ç†ä¸€ä¸‹å‚æ•°å’ŒæŸ¯é‡ŒåŒ–å§ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.myBind = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">context</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// å› ä¸ºå‚æ•°æ˜¯ç±»æ•°ç»„æ²¡æœ‰sliceæ–¹æ³•ï¼Œé€šè¿‡callç»‘å®šthisä¹‹åä½¿ç”¨sliceæ‹·è´æ•°ç»„ï¼Œé™¤äº†ç¬¬ä¸€ä¸ªéœ€è¦ç»‘å®šçš„this ä¹‹å¤–ï¼Œä¸‹é¢ä¼šç”¨åˆ°</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> args = <span class=\"built_in\">Array</span>.prototype.slice.call(<span class=\"built_in\">arguments</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">  <span class=\"keyword\">var</span> that = <span class=\"keyword\">this</span>; <span class=\"comment\">// è¿™é‡Œåˆ©ç”¨çš„é—­åŒ…ä¿å­˜äº†æ­¤æ—¶æ­¤åˆ»çš„thisï¼Œå¦åˆ™åé¢è°ƒç”¨çš„è¯ä¼šéšå¼ä¸¢å¤±</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">    <span class=\"comment\">// å’Œä¸Šé¢ä¸€æ ·æ‹·è´å‚æ•°</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> nowArgs = <span class=\"built_in\">Array</span>.prototype.slice.call(<span class=\"built_in\">arguments</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> that.apply(context, args.concat(nowArgs))</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// æµ‹è¯•ç”¨ä¾‹</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> value = <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> foo = &#123;</span><br><span class=\"line\">    value: <span class=\"number\">1</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bar</span>(<span class=\"params\">name, age</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">\t\tvalue: <span class=\"keyword\">this</span>.value,</span><br><span class=\"line\">\t\tname: name,</span><br><span class=\"line\">\t\tage: age</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> bindFoo = bar.myBind(foo, <span class=\"string\">\"Jack\"</span>);</span><br><span class=\"line\">bindFoo(<span class=\"number\">20</span>);</span><br><span class=\"line\"><span class=\"comment\">// &#123;value: 1, name: \"Jack\", age: 20&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>åˆ°ç°åœ¨å·²ç»å®Œæˆå¤§éƒ¨åˆ†äº†ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªéš¾ç‚¹ï¼Œ<code>bind</code> æœ‰ä»¥ä¸‹ä¸€ä¸ªç‰¹æ€§</p>\n<blockquote>\n<p>ä¸€ä¸ªç»‘å®šå‡½æ•°ä¹Ÿèƒ½ä½¿ç”¨newæ“ä½œç¬¦åˆ›å»ºå¯¹è±¡ï¼šè¿™ç§è¡Œä¸ºå°±åƒæŠŠåŸå‡½æ•°å½“æˆæ„é€ å™¨ï¼Œæä¾›çš„ this å€¼è¢«å¿½ç•¥ï¼ŒåŒæ—¶è°ƒç”¨æ—¶çš„å‚æ•°è¢«æä¾›ç»™æ¨¡æ‹Ÿå‡½æ•°ã€‚</p>\n</blockquote>\n<p>ä¸¾ä¾‹è¯´æ˜ï¼šæ­£è§„çš„bind</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> value = <span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> foo = &#123;</span><br><span class=\"line\">    value: <span class=\"number\">1</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bar</span>(<span class=\"params\">name, age</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.habit = <span class=\"string\">'shopping'</span>;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.value);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(name);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(age);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">bar.prototype.friend = <span class=\"string\">'kevin'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> bindFoo = bar.bind(foo, <span class=\"string\">'Jack'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = <span class=\"keyword\">new</span> bindFoo(<span class=\"number\">20</span>);</span><br><span class=\"line\"><span class=\"comment\">// undefined</span></span><br><span class=\"line\"><span class=\"comment\">// Jack</span></span><br><span class=\"line\"><span class=\"comment\">// 20</span></span><br><span class=\"line\"></span><br><span class=\"line\">obj.habit;</span><br><span class=\"line\"><span class=\"comment\">// shopping</span></span><br><span class=\"line\"></span><br><span class=\"line\">obj.friend;</span><br><span class=\"line\"><span class=\"comment\">// kevin</span></span><br></pre></td></tr></table></figure>\n\n<p>ä¸Šé¢ä¾‹å­ä¸­ï¼Œè¿è¡Œç»“æœ<code>this.value</code> è¾“å‡ºä¸º <code>undefined</code>ï¼Œè¿™ä¸æ˜¯å…¨å±€<code>value</code> ä¹Ÿä¸æ˜¯<code>foo</code>å¯¹è±¡ä¸­çš„<code>value</code>ï¼Œè¿™è¯´æ˜ <code>bind</code> çš„ <code>this</code> å¯¹è±¡å¤±æ•ˆäº†ï¼Œ<code>new</code> çš„å®ç°ä¸­ç”Ÿæˆä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè¿™ä¸ªæ—¶å€™çš„ <code>this</code>æŒ‡å‘çš„æ˜¯ <code>obj</code>ã€‚</p>\n<p>æ‰€ä»¥æˆ‘ä»¬è¿”å›çš„æ—¶å€™éœ€è¦åˆ¤æ–­ä¸€ä¸‹ä»–æ˜¯ä¸æ˜¯ä½œä¸ºäº†æ„é€ å‡½æ•°è¿”å›ï¼Œå¦‚æœæ˜¯å°±è¿”å›å½“å‰çš„thisï¼Œå¦‚æœä¸æ˜¯å°±ç»‘å®šå½“å‰è¾“å…¥çš„<code>context</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.myBind = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">context</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// å› ä¸ºå‚æ•°æ˜¯ç±»æ•°ç»„æ²¡æœ‰sliceæ–¹æ³•ï¼Œé€šè¿‡callç»‘å®šthisä¹‹åä½¿ç”¨sliceæ‹·è´æ•°ç»„ï¼Œé™¤äº†ç¬¬ä¸€ä¸ªéœ€è¦ç»‘å®šçš„this ä¹‹å¤–ï¼Œä¸‹é¢ä¼šç”¨åˆ°</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> args = <span class=\"built_in\">Array</span>.prototype.slice.call(<span class=\"built_in\">arguments</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">  <span class=\"keyword\">var</span> that = <span class=\"keyword\">this</span>; <span class=\"comment\">// è¿™é‡Œåˆ©ç”¨çš„é—­åŒ…ä¿å­˜äº†æ­¤æ—¶æ­¤åˆ»çš„thisï¼Œå¦åˆ™åé¢è°ƒç”¨çš„è¯ä¼šéšå¼ä¸¢å¤±</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> fnc = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">    <span class=\"comment\">// å’Œä¸Šé¢ä¸€æ ·æ‹·è´å‚æ•°</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> nowArgs = <span class=\"built_in\">Array</span>.prototype.slice.call(<span class=\"built_in\">arguments</span>)</span><br><span class=\"line\">    <span class=\"comment\">//å½“ä½œä¸ºæ„é€ å‡½æ•°æ—¶ï¼Œthis æŒ‡å‘å®ä¾‹ï¼Œæ­¤æ—¶ this instanceof fBound ç»“æœä¸º trueï¼Œå¯ä»¥è®©å®ä¾‹è·å¾—æ¥è‡ªç»‘å®šå‡½æ•°çš„å€¼ï¼Œå³ä¸Šä¾‹ä¸­å®ä¾‹ä¼šå…·æœ‰ habit å±æ€§ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">//å½“ä½œä¸ºæ™®é€šå‡½æ•°æ—¶ï¼Œthis æŒ‡å‘ windowï¼Œæ­¤æ—¶ç»“æœä¸º falseï¼Œå°†ç»‘å®šå‡½æ•°çš„ this æŒ‡å‘ context</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> that.apply(</span><br><span class=\"line\">      <span class=\"keyword\">this</span> <span class=\"keyword\">instanceof</span> fnc ? <span class=\"keyword\">this</span> : context, </span><br><span class=\"line\">      args.concat(nowArgs)</span><br><span class=\"line\">    )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// ä¿®æ”¹è¿”å›å‡½æ•°çš„ prototype ä¸ºç»‘å®šå‡½æ•°çš„ prototypeï¼Œå®ä¾‹å°±å¯ä»¥ç»§æ‰¿ç»‘å®šå‡½æ•°çš„åŸå‹ä¸­çš„å€¼ï¼Œå³ä¸Šä¾‹ä¸­ obj å¯ä»¥è·å–åˆ° bar åŸå‹ä¸Šçš„ friendã€‚</span></span><br><span class=\"line\">  fnc.prototype = <span class=\"keyword\">this</span>.prototype</span><br><span class=\"line\">  <span class=\"keyword\">return</span> fnc</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä½†æ˜¯å…¶å®è¿™æ ·ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘å¦‚æœå®ä¾‹ä¿®æ”¹äº†åŸå‹ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„ç»§æ‰¿å°±ä¼šå‡ºç°é—®é¢˜ã€‚</p>\n<p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦æ‹·è´ä¸€ä¸‹æˆ‘ä»¬åŸå‹ä¸Šé¢çš„å‚æ•°ã€‚ä¼šç”¨åˆ°</p>\n<blockquote>\n<p>é“æ ¼æ‹‰æ–¯Â·å…‹ç½—å…‹ç¦å¾·åœ¨ 2006 å¹´å†™äº†ä¸€ç¯‡æ–‡ç« ï¼Œé¢˜ä¸º Prototypal Inheritance in JavaScript (JavaScript 10 ä¸­çš„åŸå‹å¼ç»§æ‰¿)ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œä»–ä»‹ç»äº†ä¸€ç§å®ç°ç»§æ‰¿çš„æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•å¹¶æ²¡æœ‰ä½¿ç”¨ä¸¥æ ¼æ„ä¹‰ä¸Šçš„ æ„é€ å‡½æ•°ã€‚ä»–çš„æƒ³æ³•æ˜¯å€ŸåŠ©åŸå‹å¯ä»¥åŸºäºå·²æœ‰çš„å¯¹è±¡åˆ›å»ºæ–°å¯¹è±¡ï¼ŒåŒæ—¶è¿˜ä¸å¿…å› æ­¤åˆ›å»ºè‡ªå®šä¹‰ç±»å‹ã€‚ä¸º äº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œä»–ç»™å‡ºäº†å¦‚ä¸‹å‡½æ•°ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">object</span>(<span class=\"params\">o</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">F</span>(<span class=\"params\"></span>)</span>&#123;&#125;</span><br><span class=\"line\">  F.prototype = o</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> F</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>çœ‹èµ·æ¥éå¸¸ç®€å•</p>\n<p>å…ˆåœ¨<code>object</code>å‡½æ•°å†…éƒ¨åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„æ„é€ å‡½æ•°<code>F</code>, ç„¶åå°†ä¼ å…¥çš„è¿™ä¸ªå¯¹è±¡<code>o</code>ä½œä¸ºè¿™ä¸ªä¸´æ—¶æ„é€ å‡½æ•°çš„åŸå‹, æœ€åè¿”å›è¿™ä¸ªä¸´æ—¶æ„é€ å‡½æ•°çš„å®ä¾‹. </p>\n<p>ç®€å•æ¥è¯´å°±æ˜¯<code>object</code>å¯¹ä¼ å…¥çš„å¯¹è±¡è¿›è¡Œäº†æµ…å¤åˆ¶.</p>\n</blockquote>\n<p>è¿™å¥è¯åœ¨æˆ‘çš„ã€ŠåŸå‹åŸå‹é“¾å’Œç»§æ‰¿ã€‹é‡Œé¢æœ‰å…·ä½“çš„ä»‹ç»ã€‚æƒ³çœ‹çš„è¯å¯ä»¥ç‚¹å‡»å¤´åƒæŸ¥æ‰¾æ–‡ç« ã€‚</p>\n<p>è¿™è¾¹å¯ä»¥ç›´æ¥ä½¿ç”¨ES5çš„ <code>Object.create()</code>æ–¹æ³•ç”Ÿæˆä¸€ä¸ªæ–°å¯¹è±¡</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fBound.prototype = <span class=\"built_in\">Object</span>.create(<span class=\"keyword\">this</span>.prototype);</span><br></pre></td></tr></table></figure>\n\n<p>ä¸è¿‡ <code>bind</code> å’Œ <code>Object.create()</code>éƒ½æ˜¯ES5æ–¹æ³•ï¼Œéƒ¨åˆ†IEæµè§ˆå™¨ï¼ˆIE &lt; 9ï¼‰å¹¶ä¸æ”¯æŒï¼ŒPolyfillä¸­ä¸èƒ½ç”¨ <code>Object.create()</code>å®ç° <code>bind</code>ï¼Œä¸è¿‡åŸç†æ˜¯ä¸€æ ·çš„ã€‚</p>\n<p>okã€‚é‚£æˆ‘ä»¬å°±ä¿®æ”¹ä¸€ä¸‹</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.myBind = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">context</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// å› ä¸ºå‚æ•°æ˜¯ç±»æ•°ç»„æ²¡æœ‰sliceæ–¹æ³•ï¼Œé€šè¿‡callç»‘å®šthisä¹‹åä½¿ç”¨sliceæ‹·è´æ•°ç»„ï¼Œé™¤äº†ç¬¬ä¸€ä¸ªéœ€è¦ç»‘å®šçš„this ä¹‹å¤–ï¼Œä¸‹é¢ä¼šç”¨åˆ°</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> args = <span class=\"built_in\">Array</span>.prototype.slice.call(<span class=\"built_in\">arguments</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">  <span class=\"keyword\">var</span> that = <span class=\"keyword\">this</span>; <span class=\"comment\">// è¿™é‡Œåˆ©ç”¨çš„é—­åŒ…ä¿å­˜äº†æ­¤æ—¶æ­¤åˆ»çš„thisï¼Œå¦åˆ™åé¢è°ƒç”¨çš„è¯ä¼šéšå¼ä¸¢å¤±</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> fNOP = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;&#125;;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> fnc = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">    <span class=\"comment\">// å’Œä¸Šé¢ä¸€æ ·æ‹·è´å‚æ•°</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> nowArgs = <span class=\"built_in\">Array</span>.prototype.slice.call(<span class=\"built_in\">arguments</span>)</span><br><span class=\"line\">    <span class=\"comment\">//å½“ä½œä¸ºæ„é€ å‡½æ•°æ—¶ï¼Œthis æŒ‡å‘å®ä¾‹ï¼Œæ­¤æ—¶ this instanceof fBound ç»“æœä¸º trueï¼Œå¯ä»¥è®©å®ä¾‹è·å¾—æ¥è‡ªç»‘å®šå‡½æ•°çš„å€¼ï¼Œå³ä¸Šä¾‹ä¸­å®ä¾‹ä¼šå…·æœ‰ habit å±æ€§ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">//å½“ä½œä¸ºæ™®é€šå‡½æ•°æ—¶ï¼Œthis æŒ‡å‘ windowï¼Œæ­¤æ—¶ç»“æœä¸º falseï¼Œå°†ç»‘å®šå‡½æ•°çš„ this æŒ‡å‘ context</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> that.apply(</span><br><span class=\"line\">      <span class=\"keyword\">this</span> <span class=\"keyword\">instanceof</span> fNOP ? <span class=\"keyword\">this</span> : context, </span><br><span class=\"line\">      args.concat(nowArgs)</span><br><span class=\"line\">    )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// ä¿®æ”¹è¿”å›å‡½æ•°çš„ prototype ä¸ºç»‘å®šå‡½æ•°çš„ prototypeï¼Œå®ä¾‹å°±å¯ä»¥ç»§æ‰¿ç»‘å®šå‡½æ•°çš„åŸå‹ä¸­çš„å€¼ï¼Œå³ä¸Šä¾‹ä¸­ obj å¯ä»¥è·å–åˆ° bar åŸå‹ä¸Šçš„ friendã€‚</span></span><br><span class=\"line\">  fNOP.prototype = <span class=\"keyword\">this</span>.prototype</span><br><span class=\"line\">  fnc.prototype = <span class=\"keyword\">new</span> FNOP()</span><br><span class=\"line\">  <span class=\"keyword\">return</span> fnc</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>åˆ°è¿™é‡Œå…¶å®å·²ç»å·®ä¸å¤šäº†ï¼Œçªç„¶æƒ³èµ·æ¥è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯è°ƒç”¨ <code>bind</code> çš„ä¸æ˜¯å‡½æ•°ï¼Œè¿™æ—¶å€™éœ€è¦æŠ›å‡ºå¼‚å¸¸ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> <span class=\"keyword\">this</span> !== <span class=\"string\">\"function\"</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">\"Function.prototype.bind - what is trying to be bound is not callable\"</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æ‰€ä»¥</p>\n<h4 id=\"é¡¶é…\"><a href=\"#é¡¶é…\" class=\"headerlink\" title=\"é¡¶é…\"></a>é¡¶é…</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.myBind = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">context</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> <span class=\"keyword\">this</span> !== <span class=\"string\">\"function\"</span>) &#123;</span><br><span class=\"line\">  \t<span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">\"Function.prototype.bind - what is trying to \tbe bound is not callable\"</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">  <span class=\"comment\">// å› ä¸ºå‚æ•°æ˜¯ç±»æ•°ç»„æ²¡æœ‰sliceæ–¹æ³•ï¼Œé€šè¿‡callç»‘å®šthisä¹‹åä½¿ç”¨sliceæ‹·è´æ•°ç»„ï¼Œé™¤äº†ç¬¬ä¸€ä¸ªéœ€è¦ç»‘å®šçš„this ä¹‹å¤–ï¼Œä¸‹é¢ä¼šç”¨åˆ°</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> args = <span class=\"built_in\">Array</span>.prototype.slice.call(<span class=\"built_in\">arguments</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">  <span class=\"keyword\">var</span> that = <span class=\"keyword\">this</span>; <span class=\"comment\">// è¿™é‡Œåˆ©ç”¨çš„é—­åŒ…ä¿å­˜äº†æ­¤æ—¶æ­¤åˆ»çš„thisï¼Œå¦åˆ™åé¢è°ƒç”¨çš„è¯ä¼šéšå¼ä¸¢å¤±</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> fNOP = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;&#125;;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> fnc = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">    <span class=\"comment\">// å’Œä¸Šé¢ä¸€æ ·æ‹·è´å‚æ•°</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> nowArgs = <span class=\"built_in\">Array</span>.prototype.slice.call(<span class=\"built_in\">arguments</span>)</span><br><span class=\"line\">    <span class=\"comment\">//å½“ä½œä¸ºæ„é€ å‡½æ•°æ—¶ï¼Œthis æŒ‡å‘å®ä¾‹ï¼Œæ­¤æ—¶ this instanceof fBound ç»“æœä¸º trueï¼Œå¯ä»¥è®©å®ä¾‹è·å¾—æ¥è‡ªç»‘å®šå‡½æ•°çš„å€¼ï¼Œå³ä¸Šä¾‹ä¸­å®ä¾‹ä¼šå…·æœ‰ habit å±æ€§ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">//å½“ä½œä¸ºæ™®é€šå‡½æ•°æ—¶ï¼Œthis æŒ‡å‘ windowï¼Œæ­¤æ—¶ç»“æœä¸º falseï¼Œå°†ç»‘å®šå‡½æ•°çš„ this æŒ‡å‘ context</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> that.apply(</span><br><span class=\"line\">      <span class=\"keyword\">this</span> <span class=\"keyword\">instanceof</span> fNOP ? <span class=\"keyword\">this</span> : context, </span><br><span class=\"line\">      args.concat(nowArgs)</span><br><span class=\"line\">    )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// ä¿®æ”¹è¿”å›å‡½æ•°çš„ prototype ä¸ºç»‘å®šå‡½æ•°çš„ prototypeï¼Œå®ä¾‹å°±å¯ä»¥ç»§æ‰¿ç»‘å®šå‡½æ•°çš„åŸå‹ä¸­çš„å€¼ï¼Œå³ä¸Šä¾‹ä¸­ obj å¯ä»¥è·å–åˆ° bar åŸå‹ä¸Šçš„ friendã€‚</span></span><br><span class=\"line\">  fNOP.prototype = <span class=\"keyword\">this</span>.prototype</span><br><span class=\"line\">  fnc.prototype = <span class=\"keyword\">new</span> FNOP()</span><br><span class=\"line\">  <span class=\"keyword\">return</span> fnc</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"å®ç°new\"><a href=\"#å®ç°new\" class=\"headerlink\" title=\"å®ç°new\"></a>å®ç°new</h2><h4 id=\"äº†è§£new\"><a href=\"#äº†è§£new\" class=\"headerlink\" title=\"äº†è§£new\"></a>äº†è§£new</h4><blockquote>\n<p><strong>new è¿ç®—ç¬¦</strong>åˆ›å»ºä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„å¯¹è±¡ç±»å‹çš„å®ä¾‹æˆ–å…·æœ‰æ„é€ å‡½æ•°çš„å†…ç½®å¯¹è±¡çš„å®ä¾‹ã€‚ â€”â€”ï¼ˆæ¥è‡ªäºMDNï¼‰</p>\n</blockquote>\n<p>æˆ‘ä»¬å…ˆè¯•è¯•ç°åœ¨æœ‰çš„newï¼Œä»–æœ‰ä»€ä¹ˆåŠŸèƒ½ï¼Œç„¶åæˆ‘ä»¬æ€»ç»“ä¹‹åï¼Œåœ¨å¼€å§‹å®ç°ã€‚</p>\n<p>çœ‹ä¸ªğŸŒ°ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">NEW</span> (<span class=\"params\">a</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.a = a;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">NEW.prototype.sayA = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.a+<span class=\"string\">'b'</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> A = <span class=\"keyword\">new</span> NEW(<span class=\"number\">1</span>);</span><br><span class=\"line\">A.sayA()</span><br><span class=\"line\">A.a</span><br></pre></td></tr></table></figure>\n\n<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°Aæ˜¯NEWçš„ä¸€ä¸ªå®ä¾‹ã€‚ç»§æ‰¿äº†æ„é€ å‡½æ•°ï¼ˆNEWï¼‰çš„å±æ€§å’ŒåŸå‹ä¸Šçš„å±æ€§ï¼ˆsayAï¼‰ã€‚</p>\n<blockquote>\n<p><strong><code>new</code></strong> å…³é”®å­—ä¼šè¿›è¡Œå¦‚ä¸‹çš„æ“ä½œï¼š</p>\n<ol>\n<li>åˆ›å»ºä¸€ä¸ªç©ºçš„ç®€å•JavaScriptå¯¹è±¡ï¼ˆå³{}ï¼‰ï¼›</li>\n<li>é“¾æ¥è¯¥å¯¹è±¡ï¼ˆå³è®¾ç½®è¯¥å¯¹è±¡çš„æ„é€ å‡½æ•°ï¼‰åˆ°å¦ä¸€ä¸ªå¯¹è±¡ ï¼›</li>\n<li>å°†æ­¥éª¤1æ–°åˆ›å»ºçš„å¯¹è±¡ä½œä¸º<code>this</code>çš„ä¸Šä¸‹æ–‡ ï¼›</li>\n<li>å¦‚æœè¯¥å‡½æ•°æ²¡æœ‰è¿”å›å¯¹è±¡ï¼Œåˆ™è¿”å›<code>this</code>ã€‚</li>\n</ol>\n<p>MDN</p>\n</blockquote>\n<h4 id=\"å®ç°ä¸€ä¸ªnew\"><a href=\"#å®ç°ä¸€ä¸ªnew\" class=\"headerlink\" title=\"å®ç°ä¸€ä¸ªnew\"></a>å®ç°ä¸€ä¸ªnew</h4><p>è¯´å¹²å°±å¹²ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// new æ˜¯å…³é”®è¯ï¼Œä¸å¯ä»¥ç›´æ¥è¦†ç›–ã€‚è¿™é‡Œä½¿ç”¨ create æ¥æ¨¡æ‹Ÿå®ç° new çš„æ•ˆæœã€‚</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">create</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 1.</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> obj = <span class=\"keyword\">new</span> <span class=\"built_in\">Object</span>();</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// è·å–æ„é€ å‡½æ•°</span></span><br><span class=\"line\">  <span class=\"comment\">// å› ä¸ºargumentsæ˜¯ä¸€ä¸ªç±»æ•°ç»„å¯¹è±¡ï¼Œæ²¡æœ‰unshiftæ–¹æ³•ï¼Œæ‰€ä»¥ç”¨äº†callï¼Œæˆ‘ä»¬æ²¡æœ‰newè¿™å…³é”®å­—ï¼Œåªèƒ½æ¨¡æ‹Ÿï¼Œæ‰€ä»¥çš„ä¸€ä¸ªå‚æ•°æˆ‘ä»¬è®¤ä¸ºä»–éœ€è¦ä¼ é€’ä¸€ä¸ªæ„é€ å‡½æ•°ã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> Con = [].unshift.call(<span class=\"built_in\">arguments</span>)</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// 2.</span></span><br><span class=\"line\">  obj.__proto__ = Con.prototype </span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// 3ã€ ç»‘å®šthisã€‚å› ä¸ºä¹‹å‰argumentså·²ç»è¢«æˆ‘ä»¬åˆ é™¤äº†ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥å‰©ä¸‹çš„å°±æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„å‚æ•°äº†ã€‚</span></span><br><span class=\"line\">  Con.apply(obj, <span class=\"built_in\">arguments</span>)</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// 4. ç®€é™‹ç‰ˆ</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> obj</span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æ„é€ å‡½æ•°è¿”å›å€¼æœ‰å¦‚ä¸‹ä¸‰ç§æƒ…å†µï¼š</p>\n<ul>\n<li>1ã€è¿”å›ä¸€ä¸ªå¯¹è±¡</li>\n<li>2ã€æ²¡æœ‰ <code>return</code>ï¼Œå³è¿”å› <code>undefined</code></li>\n<li>3ã€è¿”å›<code>undefined</code> ä»¥å¤–çš„åŸºæœ¬ç±»å‹</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">create</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">\t<span class=\"comment\">// 1ã€è·å¾—æ„é€ å‡½æ•°ï¼ŒåŒæ—¶åˆ é™¤ arguments ä¸­ç¬¬ä¸€ä¸ªå‚æ•°</span></span><br><span class=\"line\">    Con = [].shift.call(<span class=\"built_in\">arguments</span>);</span><br><span class=\"line\">\t<span class=\"comment\">// 2ã€åˆ›å»ºä¸€ä¸ªç©ºçš„å¯¹è±¡å¹¶é“¾æ¥åˆ°åŸå‹ï¼Œobj å¯ä»¥è®¿é—®æ„é€ å‡½æ•°åŸå‹ä¸­çš„å±æ€§</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> obj = <span class=\"built_in\">Object</span>.create(Con.prototype);</span><br><span class=\"line\">\t<span class=\"comment\">// 3ã€ç»‘å®š this å®ç°ç»§æ‰¿ï¼Œobj å¯ä»¥è®¿é—®åˆ°æ„é€ å‡½æ•°ä¸­çš„å±æ€§</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> ret = Con.apply(obj, <span class=\"built_in\">arguments</span>);</span><br><span class=\"line\">\t<span class=\"comment\">// 4ã€ä¼˜å…ˆè¿”å›æ„é€ å‡½æ•°è¿”å›çš„å¯¹è±¡</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> ret <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Object</span> ? ret : obj;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<p>æœ€è¿‘åœ¨å†™ã€é‡æ‹¾å‰ç«¯ã€‘ç³»åˆ—ï¼Œä¸‹é¢æœ‰å‡ ä¸ªå¿«é€Ÿé€šé“ï¼Œå¤§å®¶è‡ªå–</p>\n<p><a href=\"https://juejin.im/post/6850418113944420359\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿</a></p>\n<p><a href=\"https://juejin.im/post/6850418117508759566\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—</a></p>\n<p><a href=\"https://juejin.im/post/6854573215658803208\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this</a></p>\n<p><a href=\"https://juejin.im/post/6859911609633767438\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šJavaScriptçš„æ‰§è¡Œæœºåˆ¶</a></p>\n<p><a href=\"https://juejin.im/post/6860375101322461198\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC</a></p>\n<p><a href=\"https://juejin.im/post/6865204092877144077\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ</a></p>\n<h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><p>å…¶å®è¯´èµ·thisï¼Œè¿™ä¸ªå‡ ä¹æ˜¯å‰ç«¯é¢è¯•å¿…è€ƒé¢˜ï¼Œä¹Ÿæ˜¯å‰ç«¯æœ€å¤šâ€œè„‘ç»æ€¥è½¬å¼¯â€çš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯è®©æ— æ•°å‰ç«¯äººçƒ¦æ¼çš„åœ°æ–¹ã€‚ä»Šå¤©æˆ‘ä»¬å°±å½»åº•çš„æ·±å…¥thisï¼Œå…¨é¢çš„æ”»ç ´å®ƒï¼</p>\n<h2 id=\"ç»‘å®šè§„åˆ™\"><a href=\"#ç»‘å®šè§„åˆ™\" class=\"headerlink\" title=\"ç»‘å®šè§„åˆ™\"></a>ç»‘å®šè§„åˆ™</h2><p>æˆ‘ä»¬æ¥çœ‹çœ‹åœ¨å‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨ä½ç½®å¦‚ä½•å†³å®š this çš„ç»‘å®šå¯¹è±¡ã€‚</p>\n<p>ä½ å¿…é¡»æ‰¾åˆ°è°ƒç”¨ä½ç½®ï¼Œç„¶ååˆ¤æ–­éœ€è¦åº”ç”¨ä¸‹é¢å››æ¡è§„åˆ™ä¸­çš„å“ªä¸€æ¡ã€‚æˆ‘ä»¬é¦–å…ˆä¼šåˆ†åˆ«è§£é‡Š è¿™å››æ¡è§„åˆ™ï¼Œç„¶åè§£é‡Šå¤šæ¡è§„åˆ™éƒ½å¯ç”¨æ—¶å®ƒä»¬çš„ä¼˜å…ˆçº§å¦‚ä½•æ’åˆ—ã€‚</p>\n<p>thisçš„ç»‘å®šè§„åˆ™æ€»å…±æœ‰ä»¥ä¸‹5ç§ï¼š</p>\n<ol>\n<li>é»˜è®¤ç»‘å®šï¼ˆæœ€ä»¤äººå¤´ç–¼çš„ï¼‰<ol>\n<li>ä¸¥æ ¼æ¨¡å¼</li>\n<li>éä¸¥æ ¼æ¨¡å¼</li>\n</ol>\n</li>\n<li>éšå¼ç»‘å®š</li>\n<li>æ˜¾å¼ç»‘å®š<ol>\n<li>bind</li>\n<li>call</li>\n<li>apply</li>\n</ol>\n</li>\n<li>newç»‘å®š</li>\n</ol>\n<h3 id=\"é»˜è®¤ç»‘å®š\"><a href=\"#é»˜è®¤ç»‘å®š\" class=\"headerlink\" title=\"é»˜è®¤ç»‘å®š\"></a>é»˜è®¤ç»‘å®š</h3><p>é»˜è®¤ç»‘å®šé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æ²¡äººè¦çš„â€œå­¤å„¿â€å°±ä¼šåº”ç”¨é»˜è®¤ç»‘å®šã€‚</p>\n<p>æ€è€ƒğŸ¤”ä¸€ä¸‹ğŸ‘‡çš„ä»£ç ä¼šè¾“å‡ºä»€ä¹ˆï¼Ÿ</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"string\">'out'</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fnc</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> a = <span class=\"string\">'in'</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.a)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">fnc();</span><br></pre></td></tr></table></figure>\n\n<p><strong>ç­”æ¡ˆæ˜¯ï¼šâ€™outâ€™</strong></p>\n<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å½“è°ƒç”¨ <code>fnc()</code> æ—¶ï¼Œ<code>this.a</code> è¢«è§£ææˆäº†å…¨å±€å˜é‡ <code>a</code>ã€‚ä¸ºä»€ä¹ˆ?å› ä¸ºåœ¨æœ¬ ä¾‹ä¸­ï¼Œå‡½æ•°è°ƒç”¨æ—¶åº”ç”¨äº† <code>this</code> çš„é»˜è®¤ç»‘å®šï¼Œå› æ­¤ <code>this</code> æŒ‡å‘å…¨å±€å¯¹è±¡ã€‚</p>\n<p>é‚£æˆ‘ä»¬æ€ä¹ˆçŸ¥é“ä»–æ˜¯åº”ç”¨äº†é»˜è®¤ç»‘å®šå‘¢ï¼Ÿ</p>\n<p>æˆ‘ä»¬å‘ç° <code>fnc</code> ä»–åªæ˜¯å­¤é›¶é›¶çš„è¢«è°ƒç”¨ï¼Œæ²¡æœ‰ä»»ä½•çš„ä¿®é¥°<em>ï¼ˆè°ƒç”¨ä½ç½®æ˜¯å¦æœ‰ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œæˆ–è€…è¯´æ˜¯å¦è¢«æŸä¸ªå¯¹è±¡æ‹¥æœ‰æˆ–è€…åŒ…å«ï¼Œä¸è¿‡è¿™ç§è¯´æ³•å¯èƒ½ä¼šé€ æˆä¸€äº›è¯¯å¯¼ã€‚ï¼‰</em>ï¼Œæ‰€ä»¥å®ƒå°±ç›¸å½“äºæ˜¯æ²¡æœ‰äººè¦çš„<code>å­©å­</code>ï¼Œåªèƒ½å»<code>ç¦åˆ©é™¢</code>â€”é»˜è®¤ç»‘å®šã€‚</p>\n<p>è¿™æ ·è¯´å¯èƒ½è¿˜ä¸å¤ªæ˜ç™½é»˜è®¤ç»‘å®šç©¶ç«Ÿæ˜¯æ€ä¹ˆä¸€å›äº‹ã€‚ç­‰åˆ°åé¢çš„è§„åˆ™ä»‹ç»çš„å¤šäº†ï¼Œä½ å°±ä¼šå‘ç°æ²¡æœ‰åº”ç”¨å…¶ä»–è§„åˆ™çš„â€œå­¤å„¿â€åªèƒ½æ¥ç¦åˆ©é™¢ â€”é»˜è®¤ç»‘å®šçš„æ€€æŠ±</p>\n<h4 id=\"ä¸¥æ ¼æ¨¡å¼\"><a href=\"#ä¸¥æ ¼æ¨¡å¼\" class=\"headerlink\" title=\"ä¸¥æ ¼æ¨¡å¼\"></a>ä¸¥æ ¼æ¨¡å¼</h4><p>åœ¨ä¸¥æ ¼ä¸‹ï¼Œé»˜è®¤ç»‘å®šä¸æ˜¯ç»‘å®šåˆ°<code>window</code>ï¼Œè€Œæ˜¯<code>undefined</code>ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"string\">'out'</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fnc</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"><span class=\"meta\">\t\"use strict\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> a = <span class=\"string\">'in'</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.a)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">fnc();</span><br></pre></td></tr></table></figure>\n\n<p><strong>ç­”æ¡ˆæ˜¯ï¼šæŠ¥é”™</strong></p>\n<p>ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºæˆ‘ä»¬æƒ³åœ¨<code>undefined</code>é‡Œé¢æ‰¾<code>a</code>ï¼Œé‚£è‚¯å®šæ˜¯æŠ¥é”™çš„</p>\n<h3 id=\"éšå¼ç»‘å®š\"><a href=\"#éšå¼ç»‘å®š\" class=\"headerlink\" title=\"éšå¼ç»‘å®š\"></a>éšå¼ç»‘å®š</h3><p>éšå¼ç»‘å®šï¼Œé¡¾åæ€ä¹‰å°±æ˜¯æ‚„æ‚„çš„ç»‘å®šï¼Œæˆ–è€…è¯´å…¬è®¤çš„ï¼Œä½†æ˜¯æ²¡æœ‰æ˜è¯´çš„ç»‘å®šã€‚å°±å¥½æ¯”ä¸€ä¸ªç”·äººå’Œä¸€ä¸ªå¥³äººæ‰‹ç‰µæ‰‹èµ°åœ¨ä¸€èµ·ï¼Œä»–ä»¬åŸºæœ¬ä¸Šå¯ä»¥è®¤å®šå°±æ˜¯åœ¨æƒ…ä¾£ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰å¯èƒ½ä¼šæ˜¯â€œå·æƒ…â€ï¼ˆæ˜ å°„åˆ°éšå¼ç»‘å®šçš„éšå¼ä¸¢å¤±ï¼Œç­‰ä¼šä¼šè¯´åˆ°ã€‚ï¼‰</p>\n<p>æ€è€ƒğŸ¤”ä¸€ä¸‹ğŸ‘‡çš„ä»£ç ä¼šè¾“å‡ºä»€ä¹ˆï¼Ÿ</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"string\">'out'</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fnc</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.a)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">  a: <span class=\"string\">'in'</span>,</span><br><span class=\"line\">  fnc: fnc</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">obj.fnc();</span><br></pre></td></tr></table></figure>\n\n<p><strong>ç­”æ¡ˆæ˜¯ï¼šâ€™inâ€™</strong></p>\n<p>æˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°ï¼Œ<code>fnc</code> æ˜¯åœ¨ä»€ä¹ˆæƒ…å†µä¸‹è¢«è°ƒç”¨çš„ï¼Ÿæ˜¯<code>obj</code> è°ƒç”¨çš„ï¼Œè¯´æ˜è¿™ä¸ª<code>fnc</code>å·²ç»æœ‰ä¸»äº†ï¼ŒæŠ¤èŠ±ä½¿è€…æ˜¯<code>obj</code>ï¼Œæ‰€ä»¥<code>fnc</code>è¯´çš„è¯è‚¯å®šæ˜¯å‘ç€<code>obj</code>çš„ï¼Œèƒ³è†Šè‚˜ä¸ä¼šå¾€å¤–æ‹ã€‚</p>\n<p>å…¶å®è¿™é‡Œé¢æœ‰ä¸€ä¸ªå°çš„ç‚¹éœ€è¦æ³¨æ„ï¼Œé‚£å°±æ˜¯å¦‚æœæ˜¯å¤šä¸ªå¯¹è±¡å¼•ç”¨çš„è°ƒç”¨ï¼Œé‚£è¿™ä¸ªæ—¶å€™çš„æ‰§è¡Œä¸Šä¸‹æ–‡åˆæ˜¯è°çš„å‘¢ï¼Ÿ</p>\n<p>å…¶å®æˆ‘ä»¬ç”¨å¸¸ç†å°±å¯ä»¥è§£é‡Šè¿™ä¸ªé—®é¢˜ï¼ŒAå«Bå»åƒé¥­ï¼Œä½†æ˜¯Bæƒ³å«Cä¸€èµ·å»ï¼Œç»“æœAå’ŒBèµ·äº†å†²çªï¼Œä½ ä½œä¸ºè¿™ä¸ªCä½ ä¼šå‘ç€è°ï¼Ÿé‚£è‚¯å®šæ˜¯Bï¼Œå› ä¸ºæœ‰Cå«ä½ å»ï¼Œä½ ä»¬æ‰ä¼šå‡ºç°åœ¨è¿™åœºèšä¼šã€‚æ‰€ä»¥è¿™ä¸ªé—®é¢˜ä¸éš¾å›ç­”ã€‚æˆ‘ä»¬ç›´æ¥çœ‹ä¸€ä¸ªä¾‹å­ğŸŒ°</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">'aa'</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fnc</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> bb = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">'bb'</span>,</span><br><span class=\"line\">  fnc: fnc</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> cc = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">'cc'</span>,</span><br><span class=\"line\">  bb: bb</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">cc.bb.fnc();</span><br></pre></td></tr></table></figure>\n\n<p><strong>ç­”æ¡ˆæ˜¯ï¼šbb</strong></p>\n<p>ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºèƒ½è®©<code>fnc</code>è¢«è°ƒç”¨çš„æ˜¯<code>bb</code>ï¼Œæ²¡æœ‰<code>bb</code>ï¼Œ<code>fnc</code>æ ¹æœ¬æ²¡æœ‰æœºä¼šç™»åœºã€‚</p>\n<h4 id=\"éšå¼ä¸¢å¤±\"><a href=\"#éšå¼ä¸¢å¤±\" class=\"headerlink\" title=\"éšå¼ä¸¢å¤±\"></a>éšå¼ä¸¢å¤±</h4><p>å‰é¢è¯´è¿‡ï¼Œè™½ç„¶å¾ˆå¤šä¸œè¥¿è¡¨ä¸Šé¢çœ‹èµ·æ¥éƒ½å¾ˆæ­£å¸¸ï¼Œä½†æ˜¯ä¹Ÿæœ‰å¯èƒ½æœ‰ä¸€äº›å…¶ä»–çŠ¶å†µçš„å‡ºç°ã€‚æ¯”å¦‚éšå¼ç»‘å®šé‡Œé¢çš„éšå¼ä¸¢å¤±ã€‚</p>\n<p>æˆ‘ä»¬æŠŠä¹‹å‰çš„ä¾‹å­ä¿®æ”¹ä¸€ä¸‹</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">'aa'</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fnc</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> bb = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">'bb'</span>,</span><br><span class=\"line\">  fnc: fnc</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> cc = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">'cc'</span>,</span><br><span class=\"line\">  bb: bb</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> aa = cc.bb.fnc;</span><br><span class=\"line\">aa()</span><br></pre></td></tr></table></figure>\n\n<p><strong>ç­”æ¡ˆæ˜¯ï¼šaa</strong></p>\n<p>ä¸ºä»€ä¹ˆï¼Ÿè¿™ä¸ªå…¶å®ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œè¿™ä¸ª<code>fnc</code>å¹¶æ²¡æœ‰è¢«<code>bb</code>è°ƒç”¨ï¼ŒçœŸæ­£è°ƒç”¨çš„åœ°æ–¹æ˜¯åœ¨<code>window</code>é‡Œé¢å£°æ˜çš„ä¸€ä¸ªå˜é‡<code>aa</code>ã€‚æ‰€ä»¥<code>bb</code>ä¸¢å¤±äº†<code>fnc</code>çš„ä¿¡ä»»ï¼Œ<code>fnc</code>æ— å¤„å¯å»ï¼Œåªèƒ½å»å­¤å„¿é™¢ã€‚</p>\n<p>è¿˜æ˜¯åˆšåˆšåƒé¥­çš„ä¾‹å­ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹åœºæ™¯å°±å¾ˆå¥½ç†è§£äº†ã€‚</p>\n<p>Aå«Bå»åƒé¥­ï¼ŒBæŠŠCçš„è”ç³»æ–¹å¼ä¸å°å¿ƒå¼„ä¸¢äº†ï¼Œç»“æœè¢«ä¸€ä¸ªé™Œç”ŸäººDæ¡å»äº†ï¼Œåˆšåˆšå¥½Dä¹Ÿè¦å‚åŠ èšä¼šï¼Œå°±æ‰“ç”µè¯å«äº†Dä¸€èµ·å‚åŠ èšä¼šã€‚ä½†æ˜¯Cä¸è®¤è¯†Dï¼Œå«ä»–å»çš„ä¸æ˜¯ç†ŸäººBï¼Œæ‰€ä»¥è°ä¹Ÿä¿¡ä¸è¿‡ã€‚æœ€ç»ˆåªèƒ½åº”ç”¨é»˜è®¤è§„åˆ™â€“é»˜è®¤ç»‘å®šäº†ã€‚</p>\n<p>è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯éå¸¸å¸¸è§çš„ï¼Œä¹Ÿæ˜¯éšå¼ä¸¢å¤±ï¼Œé‚£å°±æ˜¯å›è°ƒå‡½æ•°ã€‚</p>\n<p>çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">'window'</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fnc</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">ffnncc</span>(<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">  fn()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">'obj'</span>,</span><br><span class=\"line\">  fnc: fnc,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">ffnncc(obj.fnc)</span><br></pre></td></tr></table></figure>\n\n<p><strong>ç­”æ¡ˆæ˜¯ï¼šwidnow</strong></p>\n<p>ä¸ºä»€ä¹ˆï¼Ÿè¿™å’Œä¹‹å‰çš„é‚£ä¸ªä¾‹å­ä¸€æ ·ï¼Œè¡¨é¢ä¸Šçœ‹èµ·æ¥å¥½åƒæ˜¯<code>obj</code>è°ƒç”¨çš„ï¼Œä½†æ˜¯å…¶å®æ˜¯<code>obj</code>æŠŠè°ƒç”¨<code>fnc</code>çš„æ–¹æ³•è½¬äº¤ç»™äº†åˆ«äººï¼Œç”±<code>fnc</code>ä¸è®¤è¯†çš„æ¥è°ƒç”¨äº†ã€‚</p>\n<p>å†æ¥çœ‹ä¸€ä¸ªé¢è¯•é¢˜ç»å¸¸è€ƒçš„é¢˜ç›®ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">'window'</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fnc</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">'obj'</span>,</span><br><span class=\"line\">  fnc: fnc,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">setTimeout(obj.fnc, <span class=\"number\">100</span>)</span><br></pre></td></tr></table></figure>\n\n<p><strong>ç­”æ¡ˆæ˜¯ï¼šwidnow</strong></p>\n<p>æˆ‘ç›¸ä¿¡ä¸ç”¨è§£é‡Šä½ ä¹Ÿæ‰¾åˆ°ä¸ºä»€ä¹ˆäº†å§ï¼Ÿ<code>fnc</code>çš„è”ç³»æ–¹å¼è¢«<code>obj</code>è½¬äº¤ç»™åˆ«äººäº†ï¼</p>\n<p>å“ˆå“ˆå“ˆå“ˆï¼Œæœ‰æ²¡æœ‰æ„Ÿè§‰thiså…¶å®ä¹Ÿä¸è¿‡å¦‚æ­¤ï¼Œso easyï¼</p>\n<blockquote>\n<p>æ€è€ƒé¢˜ï¼šé‚£ä¹ˆreactä¸­çš„å‡½æ•°è°ƒç”¨ä¸ºä»€ä¹ˆè¦ç”¨ç®­å¤´å‡½æ•°æˆ–è€…ä¸ºä»€ä¹ˆè¦åœ¨constructoré‡Œé¢bindä¸€ä¸‹ã€‚</p>\n</blockquote>\n<h3 id=\"æ˜¾å¼ç»‘å®š\"><a href=\"#æ˜¾å¼ç»‘å®š\" class=\"headerlink\" title=\"æ˜¾å¼ç»‘å®š\"></a>æ˜¾å¼ç»‘å®š</h3><p>æˆ‘ä»¬åˆšåˆšçœ‹åˆ°çš„æ˜¯éšå¼ç»‘å®šï¼Œæ˜¯å·å·æ‘¸æ‘¸çš„é‚£ç§ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±ä»‹ç»ä¸€ä¸‹æ˜¾å¼ç»‘å®šï¼Œå…‰æ˜æ­£å¤§çš„é‚£ç§ã€‚</p>\n<p>é‚£ä¹ˆå¦‚æœæˆ‘ä»¬ä¸æƒ³åœ¨å¯¹è±¡å†…éƒ¨åŒ…å«å‡½æ•°å¼•ç”¨ï¼Œè€Œæƒ³åœ¨æŸä¸ªå¯¹è±¡ä¸Šå¼ºåˆ¶è°ƒç”¨å‡½æ•°ï¼Œè¯¥æ€ä¹ˆ</p>\n<p>åšå‘¢?</p>\n<p>JavaScript ä¸­çš„â€œæ‰€æœ‰â€å‡½æ•°éƒ½æœ‰ä¸€äº›æœ‰ç”¨çš„ç‰¹æ€§(è¿™å’Œå®ƒä»¬çš„ [[ åŸå‹ ]] æœ‰å…³â€”â€”ä¹‹åæˆ‘ ä»¬ä¼šè¯¦ç»†ä»‹ç»åŸå‹)ï¼Œå¯ä»¥ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å…·ä½“ç‚¹è¯´ï¼Œå¯ä»¥ä½¿ç”¨å‡½æ•°çš„ call(..) å’Œ apply(..) æ–¹æ³•ã€‚ä¸¥æ ¼æ¥è¯´ï¼ŒJavaScript çš„å®¿ä¸»ç¯å¢ƒæœ‰æ—¶ä¼šæä¾›ä¸€äº›éå¸¸ç‰¹æ®Šçš„å‡½æ•°ï¼Œå®ƒä»¬ å¹¶æ²¡æœ‰è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚ä½†æ˜¯è¿™æ ·çš„å‡½æ•°éå¸¸ç½•è§ï¼ŒJavaScript æä¾›çš„ç»å¤§å¤šæ•°å‡½æ•°ä»¥åŠä½ è‡ª å·±åˆ›å»ºçš„æ‰€æœ‰å‡½æ•°éƒ½å¯ä»¥ä½¿ç”¨ call(..) å’Œ apply(..) æ–¹æ³•ã€‚</p>\n<p>çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"string\">'window'</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">\t<span class=\"built_in\">console</span>.log( <span class=\"keyword\">this</span>.a );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123; </span><br><span class=\"line\">\ta:<span class=\"string\">'obj'</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">foo.call( obj );</span><br><span class=\"line\">foo()</span><br></pre></td></tr></table></figure>\n\n<p><strong>ç­”æ¡ˆçš„å…ˆåé¡ºåºæ˜¯ï¼šobjï¼Œwindow</strong></p>\n<p>é€šè¿‡ foo.call(..)ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è°ƒç”¨ foo æ—¶å¼ºåˆ¶æŠŠå®ƒçš„ this ç»‘å®šåˆ° obj ä¸Šã€‚</p>\n<p>å¯æƒœï¼Œæ˜¾å¼ç»‘å®šä»ç„¶æ— æ³•è§£å†³æˆ‘ä»¬ä¹‹å‰æå‡ºçš„ä¸¢å¤±ç»‘å®šé—®é¢˜ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sayHi</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Hello,'</span>, <span class=\"keyword\">this</span>.name);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> person = &#123;</span><br><span class=\"line\">    name: <span class=\"string\">'YvetteLau'</span>,</span><br><span class=\"line\">    sayHi: sayHi</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">'Wiliam'</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> Hi = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">    fn();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Hi.call(person, person.sayHi);</span><br></pre></td></tr></table></figure>\n\n<p><strong>ç­”æ¡ˆæ˜¯ï¼šHello, Wiliam</strong></p>\n<p>å…¶å®æˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œè¿™ä¸ª<code>fn</code>ä¸æ˜¯ç›´æ¥è¢«è°ƒç”¨çš„ï¼Œæ‰€ä»¥é€ æˆäº†éšå¼ä¸¢å¤±ã€‚æˆ‘ä»¬çš„<code>call</code>ç»‘å®šçš„<code>person</code>å…¶å®ç»‘å®šåœ¨äº†<code>Hi</code>ä¸Šé¢äº†ï¼Œä¸ä¿¡çš„è¯æˆ‘ä»¬æ”¹ä¸€ä¸‹ä½ å°±ä¼šå‘ç°äº†ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sayHi</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Hello,'</span>, <span class=\"keyword\">this</span>.name);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> person = &#123;</span><br><span class=\"line\">    name: <span class=\"string\">'YvetteLau'</span>,</span><br><span class=\"line\">    sayHi: sayHi</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">'Wiliam'</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> Hi = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">  \t<span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name)</span><br><span class=\"line\">    fn();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Hi.call(person, person.sayHi);</span><br></pre></td></tr></table></figure>\n\n<p>è¾“å‡ºäº†ä»€ä¹ˆï¼Ÿ</p>\n<p><strong>YvetteLau</strong></p>\n<p><strong>Hello, Wiliam</strong></p>\n<p>é‚£ä¹ˆå’‹åŠå‘¢ï¼Ÿåˆ«æ€•æ˜¾ç¤ºç»‘å®šçš„å˜å¼‚ç‰ˆï¼Œç¡¬ç»‘å®šå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>\n<h4 id=\"ç¡¬ç»‘å®š\"><a href=\"#ç¡¬ç»‘å®š\" class=\"headerlink\" title=\"ç¡¬ç»‘å®š\"></a>ç¡¬ç»‘å®š</h4><p>ç¡¬ç»‘å®šå…¶å®å°±æ˜¯åœ¨æœ€åä¸€å±‚ç»™ä»–è¿›è¡Œæ˜¾ç¤ºç»‘å®šã€‚</p>\n<p>è¯·çœ‹ä»£ç ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sayHi</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Hello,'</span>, <span class=\"keyword\">this</span>.name);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> person = &#123;</span><br><span class=\"line\">    name: <span class=\"string\">'YvetteLau'</span>,</span><br><span class=\"line\">    sayHi: sayHi</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> name = <span class=\"string\">'Wiliam'</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> Hi = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">  \t<span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.name)</span><br><span class=\"line\">    fn.call(person);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Hi(person.sayHi);</span><br></pre></td></tr></table></figure>\n\n<p>è¾“å‡ºäº†ä»€ä¹ˆï¼Ÿ</p>\n<p><strong>YvetteLau</strong></p>\n<p><strong>Hello, Wiliam</strong></p>\n<p>è™½ç„¶æˆ‘ä»¬è°ƒç”¨<code>Hi</code>çš„æ—¶å€™ï¼Œåœ¨<code>call</code>ä¹‹å‰<code>this</code>è¿˜æ˜¯æŒ‡å‘äº†<code>window</code>ï¼Œä½†æ˜¯æˆ‘ä»¬ç”¨<code>call</code>ç»™ä»–ç»‘å®šä¸Šäº†<code>person</code>ã€‚æ— è®ºä¹‹åå¦‚ä½•è°ƒç”¨å‡½æ•° <code>fn</code>ï¼Œå®ƒ æ€»ä¼šæ‰‹åŠ¨åœ¨ <code>person</code> ä¸Šè°ƒç”¨ <code>fn</code>ã€‚è¿™ç§ç»‘å®šæ˜¯ä¸€ç§æ˜¾å¼çš„å¼ºåˆ¶ç»‘å®šï¼Œå› æ­¤æˆ‘ä»¬ç§°ä¹‹ä¸ºç¡¬ç»‘å®šã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( <span class=\"keyword\">this</span>.a );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">    a: <span class=\"number\">2</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> bar = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    foo.call( obj );</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">bar(); <span class=\"comment\">// 2</span></span><br><span class=\"line\">setTimeout( bar, <span class=\"number\">100</span> ); <span class=\"comment\">// 2</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ç¡¬ç»‘å®šçš„barä¸å¯èƒ½å†ä¿®æ”¹å®ƒçš„this</span></span><br><span class=\"line\">bar.call( <span class=\"built_in\">window</span> ); <span class=\"comment\">// 2</span></span><br></pre></td></tr></table></figure>\n\n<p>å…¸å‹åº”ç”¨åœºæ™¯æ˜¯åˆ›å»ºä¸€ä¸ªåŒ…è£¹å‡½æ•°ï¼Œè´Ÿè´£æ¥æ”¶å‚æ•°å¹¶è¿”å›å€¼ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">something</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( <span class=\"keyword\">this</span>.a, something );</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.a + something;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">    a: <span class=\"number\">2</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> bar = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> foo.apply( obj, <span class=\"built_in\">arguments</span> );</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> b = bar( <span class=\"number\">3</span> ); <span class=\"comment\">// 2 3</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( b ); <span class=\"comment\">// 5</span></span><br></pre></td></tr></table></figure>\n\n<p>åˆ›å»ºä¸€ä¸ªå¯ä»¥é‡å¤ä½¿ç”¨çš„è¾…åŠ©å‡½æ•°ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">something</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( <span class=\"keyword\">this</span>.a, something );</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.a + something;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ç®€å•çš„è¾…åŠ©ç»‘å®šå‡½æ•°</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bind</span>(<span class=\"params\">fn, obj</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> fn.apply( obj, <span class=\"built_in\">arguments</span> );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">    a: <span class=\"number\">2</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> bar = bind( foo, obj );</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> b = bar( <span class=\"number\">3</span> ); <span class=\"comment\">// 2 3</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( b ); <span class=\"comment\">// 5</span></span><br></pre></td></tr></table></figure>\n\n<p>ES5å†…ç½®äº†<code>Function.prototype.bind</code>ï¼Œbindä¼šè¿”å›ä¸€ä¸ªç¡¬ç»‘å®šçš„æ–°å‡½æ•°ï¼Œç”¨æ³•å¦‚ä¸‹ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">something</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( <span class=\"keyword\">this</span>.a, something );</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.a + something;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">    a: <span class=\"number\">2</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> bar = foo.bind( obj );</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> b = bar( <span class=\"number\">3</span> ); <span class=\"comment\">// 2 3</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( b ); <span class=\"comment\">// 5</span></span><br></pre></td></tr></table></figure>\n\n<p>APIè°ƒç”¨çš„â€œä¸Šä¸‹æ–‡â€</p>\n<p>JSè®¸å¤šå†…ç½®å‡½æ•°æä¾›äº†ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œè¢«ç§°ä¹‹ä¸ºâ€œä¸Šä¸‹æ–‡â€ï¼ˆcontextï¼‰ï¼Œå…¶ä½œç”¨å’Œ<code>bind(..)</code>ä¸€æ ·ï¼Œç¡®ä¿å›è°ƒå‡½æ•°ä½¿ç”¨æŒ‡å®šçš„thisã€‚è¿™äº›å‡½æ•°å®é™…ä¸Šé€šè¿‡<code>call(..)</code>å’Œ<code>apply(..)</code>å®ç°äº†æ˜¾å¼ç»‘å®šã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">el</span>) </span>&#123;</span><br><span class=\"line\">\t<span class=\"built_in\">console</span>.log( el, <span class=\"keyword\">this</span>.id );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">    id: <span class=\"string\">\"awesome\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> myArray = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\"><span class=\"comment\">// è°ƒç”¨foo(..)æ—¶æŠŠthisç»‘å®šåˆ°obj</span></span><br><span class=\"line\">myArray.forEach( foo, obj );</span><br><span class=\"line\"><span class=\"comment\">// 1 awesome 2 awesome 3 awesome</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"new-ç»‘å®š\"><a href=\"#new-ç»‘å®š\" class=\"headerlink\" title=\"new ç»‘å®š\"></a>new ç»‘å®š</h3><p>ä½¿ç”¨ new æ¥è°ƒç”¨å‡½æ•°ï¼Œæˆ–è€…è¯´å‘ç”Ÿæ„é€ å‡½æ•°è°ƒç”¨æ—¶ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œä¸‹é¢çš„æ“ä½œã€‚</p>\n<ol>\n<li>åˆ›å»º(æˆ–è€…è¯´æ„é€ )ä¸€ä¸ªå…¨æ–°çš„å¯¹è±¡ã€‚</li>\n<li>è¿™ä¸ªæ–°å¯¹è±¡ä¼šè¢«æ‰§è¡Œ[[åŸå‹]]è¿æ¥ã€‚</li>\n<li>è¿™ä¸ªæ–°å¯¹è±¡ä¼šç»‘å®šåˆ°å‡½æ•°è°ƒç”¨çš„thisã€‚</li>\n<li>å¦‚æœå‡½æ•°æ²¡æœ‰è¿”å›å…¶ä»–å¯¹è±¡ï¼Œé‚£ä¹ˆnewè¡¨è¾¾å¼ä¸­çš„å‡½æ•°è°ƒç”¨ä¼šè‡ªåŠ¨è¿”å›è¿™ä¸ªæ–°å¯¹è±¡ã€‚</li>\n</ol>\n<p>æ€è€ƒä¸‹é¢çš„ä»£ç :</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">a</span>) </span>&#123; </span><br><span class=\"line\">  <span class=\"keyword\">this</span>.a = a;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> bar = <span class=\"keyword\">new</span> foo(<span class=\"number\">2</span>); </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( bar.a );  <span class=\"comment\">// 2</span></span><br></pre></td></tr></table></figure>\n\n<p>ä½¿ç”¨<code>new</code>æ¥è°ƒç”¨<code>foo(..)</code>æ—¶ï¼Œä¼šæ„é€ ä¸€ä¸ªæ–°å¯¹è±¡å¹¶æŠŠå®ƒï¼ˆ<code>bar</code>ï¼‰ç»‘å®šåˆ°<code>foo(..)</code>è°ƒç”¨ä¸­çš„thisã€‚</p>\n<h3 id=\"ç»‘å®šä¼˜å…ˆçº§\"><a href=\"#ç»‘å®šä¼˜å…ˆçº§\" class=\"headerlink\" title=\"ç»‘å®šä¼˜å…ˆçº§\"></a>ç»‘å®šä¼˜å…ˆçº§</h3><p>çœ‹å®Œè§„åˆ™ï¼Œæˆ‘ä»¬è‚¯å®šæƒ³çŸ¥é“å¦‚æœè¿™äº›è§„åˆ™æ’åœ¨ä¸€èµ·ï¼Œæˆ‘ä»¬åˆè¯¥å¬è°çš„å‘¢ï¼Ÿ</p>\n<p>æ¯«æ— ç–‘é—®ï¼Œé»˜è®¤ç»‘å®šçš„ä¼˜å…ˆçº§æ˜¯å››æ¡è§„åˆ™ä¸­æœ€ä½çš„ï¼Œå› ä¸ºæ˜¯æ²¡äººåº”ç”¨ä»»ä½•è§„åˆ™æ‰ä¼šå»åº”ç”¨é»˜è®¤ç»‘å®šã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…ˆä¸è€ƒè™‘å®ƒã€‚ éšå¼ç»‘å®šå’Œæ˜¾å¼ç»‘å®šå“ªä¸ªä¼˜å…ˆçº§æ›´é«˜?æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">\t<span class=\"built_in\">console</span>.log( <span class=\"keyword\">this</span>.a );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj1 = &#123; </span><br><span class=\"line\">\ta: <span class=\"number\">2</span>,</span><br><span class=\"line\">\tfoo: foo </span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj2 = &#123; </span><br><span class=\"line\">\ta: <span class=\"number\">3</span>,</span><br><span class=\"line\">\tfoo: foo </span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">obj1.foo(); <span class=\"comment\">// 2 </span></span><br><span class=\"line\">obj2.foo(); <span class=\"comment\">// 3</span></span><br><span class=\"line\">obj1.foo.call( obj2 ); <span class=\"comment\">// 3 </span></span><br><span class=\"line\">obj2.foo.call( obj1 ); <span class=\"comment\">// 2</span></span><br></pre></td></tr></table></figure>\n\n<p>å¯ä»¥çœ‹åˆ°ï¼Œæ˜¾å¼ç»‘å®šä¼˜å…ˆçº§æ›´é«˜ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨åˆ¤æ–­æ—¶åº”å½“å…ˆè€ƒè™‘æ˜¯å¦å¯ä»¥åº”ç”¨æ˜¾å¼ç»‘å®šã€‚ ç°åœ¨æˆ‘ä»¬éœ€è¦ææ¸…æ¥š new ç»‘å®šå’Œéšå¼ç»‘å®šçš„ä¼˜å…ˆçº§è°é«˜è°ä½:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">something</span>) </span>&#123; \t</span><br><span class=\"line\">\t<span class=\"keyword\">this</span>.a = something;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj1 = &#123; </span><br><span class=\"line\">\tfoo: foo</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj2 = &#123;&#125;;</span><br><span class=\"line\">obj1.foo( <span class=\"number\">2</span> );</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( obj1.a ); <span class=\"comment\">// 2</span></span><br><span class=\"line\">obj1.foo.call( obj2, <span class=\"number\">3</span> ); </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( obj2.a ); <span class=\"comment\">// 3</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> bar = <span class=\"keyword\">new</span> obj1.foo( <span class=\"number\">4</span> ); </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( obj1.a ); <span class=\"comment\">// 2 </span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( bar.a ); <span class=\"comment\">// 4</span></span><br></pre></td></tr></table></figure>\n\n<p>å¯ä»¥çœ‹åˆ° new ç»‘å®šæ¯”éšå¼ç»‘å®šä¼˜å…ˆçº§é«˜ã€‚ä½†æ˜¯ new ç»‘å®šå’Œæ˜¾å¼ç»‘å®šè°çš„ä¼˜å…ˆçº§æ›´é«˜å‘¢?</p>\n<blockquote>\n<p>new å’Œ call/apply æ— æ³•ä¸€èµ·ä½¿ç”¨ï¼Œå› æ­¤æ— æ³•é€šè¿‡ new foo.call(obj1) æ¥ç›´æ¥ è¿›è¡Œæµ‹è¯•ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¡¬ç»‘å®šæ¥æµ‹è¯•å®ƒä¿©çš„ä¼˜å…ˆçº§ã€‚</p>\n<p>è¿™æ˜¯å› ä¸ºå‡½æ•°å†…éƒ¨æœ‰ä¸¤ä¸ªä¸åŒçš„æ–¹æ³•ï¼š<code>[[Call]]</code>å’Œ<code>[[Constructor]]</code>ã€‚ å½“ä½¿ç”¨æ™®é€šå‡½æ•°è°ƒç”¨æ—¶ï¼Œ<code>[[Call]]</code>ä¼šè¢«æ‰§è¡Œã€‚å½“ä½¿ç”¨æ„é€ å‡½æ•°è°ƒç”¨æ—¶ï¼Œ<code>[[Constructor]]</code>ä¼šè¢«æ‰§è¡Œã€‚<code>call</code>ã€<code>apply</code>ã€<code>bind</code>å’Œç®­å¤´å‡½æ•°å†…éƒ¨æ²¡æœ‰<code>[[Constructor]]</code>æ–¹æ³•ã€‚</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">something</span>) </span>&#123; </span><br><span class=\"line\">\t<span class=\"keyword\">this</span>.a = something;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj1 = &#123;&#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> bar = foo.bind( obj1 ); </span><br><span class=\"line\">bar( <span class=\"number\">2</span> );</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( obj1.a ); <span class=\"comment\">// 2</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> baz = <span class=\"keyword\">new</span> bar(<span class=\"number\">3</span>); </span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( obj1.a ); <span class=\"comment\">// 2 </span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log( baz.a ); <span class=\"comment\">// 3</span></span><br></pre></td></tr></table></figure>\n\n<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°newæŠŠbindçš„ç¡¬ç»‘å®šç»™é¡¶æ‰äº†</p>\n<p>æ‰€ä»¥new  &gt; ç¡¬ç»‘å®š</p>\n<h4 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h4><blockquote>\n<p>new ç»‘å®š &gt; æ˜¾ç¤ºç»‘å®š &gt; éšå¼ç»‘å®š &gt; é»˜è®¤ç»‘å®š</p>\n</blockquote>\n<h3 id=\"ç»‘å®šä¾‹å¤–\"><a href=\"#ç»‘å®šä¾‹å¤–\" class=\"headerlink\" title=\"ç»‘å®šä¾‹å¤–\"></a>ç»‘å®šä¾‹å¤–</h3><h4 id=\"è¢«å¿½ç•¥çš„this\"><a href=\"#è¢«å¿½ç•¥çš„this\" class=\"headerlink\" title=\"è¢«å¿½ç•¥çš„this\"></a>è¢«å¿½ç•¥çš„this</h4><p>æŠŠ<code>null</code>æˆ–è€…<code>undefined</code>ä½œä¸º<code>this</code>çš„ç»‘å®šå¯¹è±¡ä¼ å…¥<code>call</code>ã€<code>apply</code>æˆ–è€…<code>bind</code>ï¼Œè¿™äº›å€¼åœ¨è°ƒç”¨æ—¶ä¼šè¢«å¿½ç•¥ï¼Œå®é™…åº”ç”¨çš„æ˜¯é»˜è®¤è§„åˆ™ã€‚</p>\n<p>ä¸‹é¢ä¸¤ç§æƒ…å†µä¸‹ä¼šä¼ å…¥<code>null</code></p>\n<ul>\n<li>ä½¿ç”¨<code>apply(..)</code>æ¥â€œå±•å¼€â€ä¸€ä¸ªæ•°ç»„ï¼Œå¹¶å½“ä½œå‚æ•°ä¼ å…¥ä¸€ä¸ªå‡½æ•°</li>\n<li><code>bind(..)</code>å¯ä»¥å¯¹å‚æ•°è¿›è¡ŒæŸ¯é‡ŒåŒ–ï¼ˆé¢„å…ˆè®¾ç½®ä¸€äº›å‚æ•°ï¼‰</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">a, b</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( <span class=\"string\">\"a:\"</span> + a + <span class=\"string\">\"ï¼Œb:\"</span> + b );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æŠŠæ•°ç»„â€å±•å¼€â€œæˆå‚æ•°</span></span><br><span class=\"line\">foo.apply( <span class=\"literal\">null</span>, [<span class=\"number\">2</span>, <span class=\"number\">3</span>] ); <span class=\"comment\">// a:2ï¼Œb:3</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ä½¿ç”¨bind(..)è¿›è¡ŒæŸ¯é‡ŒåŒ–</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> bar = foo.bind( <span class=\"literal\">null</span>, <span class=\"number\">2</span> );</span><br><span class=\"line\">bar( <span class=\"number\">3</span> ); <span class=\"comment\">// a:2ï¼Œb:3</span></span><br></pre></td></tr></table></figure>\n\n<p>æ€»æ˜¯ä¼ å…¥<code>null</code>æ¥å¿½ç•¥thisç»‘å®šå¯èƒ½äº§ç”Ÿä¸€äº›å‰¯ä½œç”¨ã€‚å¦‚æœæŸä¸ªå‡½æ•°ç¡®å®ä½¿ç”¨äº†thisï¼Œé‚£é»˜è®¤ç»‘å®šè§„åˆ™ä¼šæŠŠthisç»‘å®šåˆ°å…¨å±€å¯¹è±¡ä¸­ã€‚</p>\n<blockquote>\n<p>æ›´å®‰å…¨çš„this</p>\n</blockquote>\n<p>å®‰å…¨çš„åšæ³•å°±æ˜¯ä¼ å…¥ä¸€ä¸ªç‰¹æ®Šçš„å¯¹è±¡ï¼ˆç©ºå¯¹è±¡ï¼‰ï¼ŒæŠŠthisç»‘å®šåˆ°è¿™ä¸ªå¯¹è±¡ä¸ä¼šå¯¹ä½ çš„ç¨‹åºäº§ç”Ÿä»»ä½•å‰¯ä½œç”¨ã€‚</p>\n<p>JSä¸­åˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡æœ€ç®€å•çš„æ–¹æ³•æ˜¯<strong><code>Object.create(null)</code></strong>ï¼Œè¿™ä¸ªå’Œ<code>{}</code>å¾ˆåƒï¼Œä½†æ˜¯å¹¶ä¸ä¼šåˆ›å»º<code>Object.prototype</code>è¿™ä¸ªå§”æ‰˜ï¼Œæ‰€ä»¥æ¯”<code>{}</code>æ›´ç©ºã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">a, b</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( <span class=\"string\">\"a:\"</span> + a + <span class=\"string\">\"ï¼Œb:\"</span> + b );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æˆ‘ä»¬çš„ç©ºå¯¹è±¡</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> Ã¸ = <span class=\"built_in\">Object</span>.create( <span class=\"literal\">null</span> );</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æŠŠæ•°ç»„â€å±•å¼€â€œæˆå‚æ•°</span></span><br><span class=\"line\">foo.apply( Ã¸, [<span class=\"number\">2</span>, <span class=\"number\">3</span>] ); <span class=\"comment\">// a:2ï¼Œb:3</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ä½¿ç”¨bind(..)è¿›è¡ŒæŸ¯é‡ŒåŒ–</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> bar = foo.bind( Ã¸, <span class=\"number\">2</span> );</span><br><span class=\"line\">bar( <span class=\"number\">3</span> ); <span class=\"comment\">// a:2ï¼Œb:3</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"é—´æ¥å¼•ç”¨\"><a href=\"#é—´æ¥å¼•ç”¨\" class=\"headerlink\" title=\"é—´æ¥å¼•ç”¨\"></a>é—´æ¥å¼•ç”¨</h4><p>é—´æ¥å¼•ç”¨ä¸‹ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°ä¼šåº”ç”¨é»˜è®¤ç»‘å®šè§„åˆ™ã€‚é—´æ¥å¼•ç”¨æœ€å®¹æ˜“åœ¨<strong>èµ‹å€¼</strong>æ—¶å‘ç”Ÿã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// p.foo = o.fooçš„è¿”å›å€¼æ˜¯ç›®æ ‡å‡½æ•°çš„å¼•ç”¨ï¼Œæ‰€ä»¥è°ƒç”¨ä½ç½®æ˜¯foo()è€Œä¸æ˜¯p.foo()æˆ–è€…o.foo()</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( <span class=\"keyword\">this</span>.a );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> o = &#123; <span class=\"attr\">a</span>: <span class=\"number\">3</span>, <span class=\"attr\">foo</span>: foo &#125;;</span><br><span class=\"line\"><span class=\"keyword\">var</span> p = &#123; <span class=\"attr\">a</span>: <span class=\"number\">4</span>&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">o.foo(); <span class=\"comment\">// 3</span></span><br><span class=\"line\">(p.foo = o.foo)(); <span class=\"comment\">// 2</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"è½¯ç»‘å®š\"><a href=\"#è½¯ç»‘å®š\" class=\"headerlink\" title=\"è½¯ç»‘å®š\"></a>è½¯ç»‘å®š</h4><ul>\n<li>ç¡¬ç»‘å®šå¯ä»¥æŠŠthiså¼ºåˆ¶ç»‘å®šåˆ°æŒ‡å®šçš„å¯¹è±¡ï¼ˆ<code>new</code>é™¤å¤–ï¼‰ï¼Œé˜²æ­¢å‡½æ•°è°ƒç”¨åº”ç”¨é»˜è®¤ç»‘å®šè§„åˆ™ã€‚ä½†æ˜¯ä¼šé™ä½å‡½æ•°çš„çµæ´»æ€§ï¼Œä½¿ç”¨<strong>ç¡¬ç»‘å®šä¹‹åå°±æ— æ³•ä½¿ç”¨éšå¼ç»‘å®šæˆ–è€…æ˜¾å¼ç»‘å®šæ¥ä¿®æ”¹this</strong>ã€‚</li>\n<li><strong>å¦‚æœç»™é»˜è®¤ç»‘å®šæŒ‡å®šä¸€ä¸ªå…¨å±€å¯¹è±¡å’Œundefinedä»¥å¤–çš„å€¼</strong>ï¼Œé‚£å°±å¯ä»¥å®ç°å’Œç¡¬ç»‘å®šç›¸åŒçš„æ•ˆæœï¼ŒåŒæ—¶ä¿ç•™éšå¼ç»‘å®šæˆ–è€…æ˜¾ç¤ºç»‘å®šä¿®æ”¹thisçš„èƒ½åŠ›ã€‚</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// é»˜è®¤ç»‘å®šè§„åˆ™ï¼Œä¼˜å…ˆçº§æ’æœ€å</span></span><br><span class=\"line\"><span class=\"comment\">// å¦‚æœthisç»‘å®šåˆ°å…¨å±€å¯¹è±¡æˆ–è€…undefinedï¼Œé‚£å°±æŠŠæŒ‡å®šçš„é»˜è®¤å¯¹è±¡objç»‘å®šåˆ°this,å¦åˆ™ä¸ä¼šä¿®æ”¹this</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>(!<span class=\"built_in\">Function</span>.prototype.softBind) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">Function</span>.prototype.softBind = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">obj</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> fn = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">        <span class=\"comment\">// æ•è·æ‰€æœ‰curriedå‚æ•°</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> curried = [].slice.call( <span class=\"built_in\">arguments</span>, <span class=\"number\">1</span> ); </span><br><span class=\"line\">        <span class=\"keyword\">var</span> bound = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> fn.apply(</span><br><span class=\"line\">            \t(!<span class=\"keyword\">this</span> || <span class=\"keyword\">this</span> === (<span class=\"built_in\">window</span> || global)) ? </span><br><span class=\"line\">                \tobj : <span class=\"keyword\">this</span>,</span><br><span class=\"line\">                curried.concat.apply( curried, <span class=\"built_in\">arguments</span> )</span><br><span class=\"line\">            );</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        bound.prototype = <span class=\"built_in\">Object</span>.create( fn.prototype );</span><br><span class=\"line\">        <span class=\"keyword\">return</span> bound;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä½¿ç”¨ï¼šè½¯ç»‘å®šç‰ˆæœ¬çš„foo()å¯ä»¥æ‰‹åŠ¨å°†thisç»‘å®šåˆ°obj2æˆ–è€…obj3ä¸Šï¼Œä½†å¦‚æœåº”ç”¨é»˜è®¤ç»‘å®šï¼Œåˆ™ä¼šå°†thisç»‘å®šåˆ°objã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"name:\"</span> + <span class=\"keyword\">this</span>.name);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123; <span class=\"attr\">name</span>: <span class=\"string\">\"obj\"</span> &#125;,</span><br><span class=\"line\">    obj2 = &#123; <span class=\"attr\">name</span>: <span class=\"string\">\"obj2\"</span> &#125;,</span><br><span class=\"line\">    obj3 = &#123; <span class=\"attr\">name</span>: <span class=\"string\">\"obj3\"</span> &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// é»˜è®¤ç»‘å®šï¼Œåº”ç”¨è½¯ç»‘å®šï¼Œè½¯ç»‘å®šæŠŠthisç»‘å®šåˆ°é»˜è®¤å¯¹è±¡obj</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fooOBJ = foo.softBind( obj );</span><br><span class=\"line\">fooOBJ(); <span class=\"comment\">// name: obj </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// éšå¼ç»‘å®šè§„åˆ™</span></span><br><span class=\"line\">obj2.foo = foo.softBind( obj );</span><br><span class=\"line\">obj2.foo(); <span class=\"comment\">// name: obj2 &lt;---- çœ‹ï¼ï¼ï¼</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æ˜¾å¼ç»‘å®šè§„åˆ™</span></span><br><span class=\"line\">fooOBJ.call( obj3 ); <span class=\"comment\">// name: obj3 &lt;---- çœ‹ï¼ï¼ï¼</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ç»‘å®šä¸¢å¤±ï¼Œåº”ç”¨è½¯ç»‘å®š</span></span><br><span class=\"line\">setTimeout( obj2.foo, <span class=\"number\">10</span> ); <span class=\"comment\">// name: obj</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ç®­å¤´å‡½æ•°\"><a href=\"#ç®­å¤´å‡½æ•°\" class=\"headerlink\" title=\"ç®­å¤´å‡½æ•°\"></a>ç®­å¤´å‡½æ•°</h3><p>ES6æ–°å¢ä¸€ç§ç‰¹æ®Šå‡½æ•°ç±»å‹ï¼šç®­å¤´å‡½æ•°ï¼Œç®­å¤´å‡½æ•°æ— æ³•ä½¿ç”¨ä¸Šè¿°å››æ¡è§„åˆ™ï¼Œè€Œæ˜¯æ ¹æ®å¤–å±‚ï¼ˆå‡½æ•°æˆ–è€…å…¨å±€ï¼‰ä½œç”¨åŸŸï¼ˆ<strong>è¯æ³•ä½œç”¨åŸŸ</strong>ï¼‰æ¥å†³å®šthisã€‚</p>\n<ul>\n<li><code>foo()</code>å†…éƒ¨åˆ›å»ºçš„ç®­å¤´å‡½æ•°ä¼šæ•è·è°ƒç”¨æ—¶<code>foo()</code>çš„thisã€‚ç”±äº<code>foo()</code>çš„thisç»‘å®šåˆ°<code>obj1</code>ï¼Œ<code>bar</code>(å¼•ç”¨ç®­å¤´å‡½æ•°)çš„thisä¹Ÿä¼šç»‘å®šåˆ°<code>obj1</code>ï¼Œ<strong>ç®­å¤´å‡½æ•°çš„ç»‘å®šæ— æ³•è¢«ä¿®æ”¹</strong>(<code>new</code>ä¹Ÿä¸è¡Œ)ã€‚</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// è¿”å›ä¸€ä¸ªç®­å¤´å‡½æ•°</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\">(<span class=\"params\">a</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// thisç»§æ‰¿è‡ªfoo()</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log( <span class=\"keyword\">this</span>.a );</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj1 = &#123;</span><br><span class=\"line\">    a: <span class=\"number\">2</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj2 = &#123;</span><br><span class=\"line\">    a: <span class=\"number\">3</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> bar = foo.call( obj1 );</span><br><span class=\"line\">bar.call( obj2 ); <span class=\"comment\">// 2ï¼Œä¸æ˜¯3ï¼</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>ç®­å¤´å‡½æ•°æœ€å¸¸ç”¨äºå›è°ƒå‡½æ•°ä¸­ï¼Œä¾‹å¦‚äº‹ä»¶å¤„ç†å™¨æˆ–è€…å®šæ—¶å™¨ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">  setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// è¿™é‡Œçš„ this åœ¨æ­¤æ³•ä¸Šç»§æ‰¿è‡ª foo()</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( <span class=\"keyword\">this</span>.a ); &#125;,<span class=\"number\">100</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123; </span><br><span class=\"line\">\ta:<span class=\"number\">2</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">foo.call( obj ); <span class=\"comment\">// 2</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>ES6ä¹‹å‰å’Œç®­å¤´å‡½æ•°ç±»ä¼¼çš„æ¨¡å¼ï¼Œé‡‡ç”¨çš„æ˜¯è¯æ³•ä½œç”¨åŸŸå–ä»£äº†ä¼ ç»Ÿçš„thisæœºåˆ¶ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> self = <span class=\"keyword\">this</span>; <span class=\"comment\">// lexical capture of this</span></span><br><span class=\"line\">    setTimeout( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log( self.a ); <span class=\"comment\">// selfåªæ˜¯ç»§æ‰¿äº†foo()å‡½æ•°çš„thisç»‘å®š</span></span><br><span class=\"line\">    &#125;, <span class=\"number\">100</span> );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = &#123;</span><br><span class=\"line\">    a: <span class=\"number\">2</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">foo.call(obj); <span class=\"comment\">// 2</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"å®ç°callå’Œapply\"><a href=\"#å®ç°callå’Œapply\" class=\"headerlink\" title=\"å®ç°callå’Œapply\"></a>å®ç°callå’Œapply</h2><h3 id=\"äº†è§£callå’Œapply\"><a href=\"#äº†è§£callå’Œapply\" class=\"headerlink\" title=\"äº†è§£callå’Œapply\"></a>äº†è§£callå’Œapply</h3><p>ä¸ºä»€ä¹ˆä¼šæœ‰callå’Œapplyï¼Ÿ callå’Œapplyä¸¤ä¸ªæ–¹æ³•çš„ä½œç”¨åŸºæœ¬ç›¸åŒï¼Œå®ƒä»¬éƒ½æ˜¯ä¸ºäº†æ”¹å˜æŸä¸ªå‡½æ•°<strong>æ‰§è¡Œæ—¶çš„ä¸Šä¸‹æ–‡</strong>ï¼ˆcontextï¼‰è€Œå»ºç«‹çš„ï¼Œ ä»–çš„çœŸæ­£å¼ºå¤§ä¹‹å¤„å°±æ˜¯èƒ½å¤Ÿæ‰©å……å‡½æ•°èµ–ä»¥è¿è¡Œçš„ä½œç”¨åŸŸã€‚é€šä¿—ä¸€ç‚¹è®²ï¼Œå°±æ˜¯æ”¹å˜å‡½æ•°ä½“å†…éƒ¨<strong>this çš„æŒ‡å‘</strong>ã€‚</p>\n<p>ä¸¾ä¸ªæ —å­ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">window.color &#x3D; &quot;red&quot;;</span><br><span class=\"line\">var o &#x3D; &#123;color: &quot;blue&quot;&#125;;</span><br><span class=\"line\">function sayColor()&#123;</span><br><span class=\"line\">\talert(this.color);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">sayColor();&#x2F;&#x2F;red</span><br><span class=\"line\">sayColor.call(this);&#x2F;&#x2F;redï¼ŒæŠŠå‡½æ•°ä½“sayColorå†…éƒ¨çš„thisï¼Œç»‘åˆ°å½“å‰ç¯å¢ƒï¼ˆä½œç”¨åŸŸï¼‰(è¿™æ®µä»£ç æ‰€å¤„çš„ç¯å¢ƒ)</span><br><span class=\"line\">sayColor.call(window);&#x2F;&#x2F;redï¼ŒæŠŠå‡½æ•°ä½“sayColorå†…éƒ¨çš„thisï¼Œç»‘åˆ°windowï¼ˆå…¨å±€ä½œç”¨åŸŸï¼‰</span><br><span class=\"line\">sayColor.call(o);&#x2F;&#x2F;blueå¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>\n\n\n\n<blockquote>\n<p><strong>è§£é‡Šï¼š</strong>ä¸Šé¢çš„æ —å­ï¼Œå¾ˆæ˜æ˜¾å‡½æ•°sayColoræ˜¯åœ¨å…¨å±€ä½œç”¨åŸŸï¼ˆç¯å¢ƒ/windowï¼‰ä¸­è°ƒç”¨çš„ï¼Œè€Œå…¨å±€ä½œç”¨åŸŸä¸­æœ‰ä¸€ä¸ªcolorå±æ€§ï¼Œå€¼ä¸ºâ€redâ€ï¼ŒsayColor.call(this)è¿™ä¸€è¡Œä»£ç å°±æ˜¯è¡¨ç¤º<strong>æŠŠå‡½æ•°ä½“sayColorå†…éƒ¨çš„thisï¼Œç»‘åˆ°å½“å‰ç¯å¢ƒï¼ˆä½œç”¨åŸŸï¼‰</strong>ï¼Œè€ŒsayColor.call(window)è¿™ä¸€è¡Œä»£ç å°±æ˜¯è¡¨ç¤º<strong>æŠŠå‡½æ•°ä½“sayColorå†…éƒ¨çš„thisï¼Œç»‘åˆ°windowï¼ˆå…¨å±€ä½œç”¨åŸŸï¼‰</strong>ï¼Œä¹‹æ‰€ä»¥è¿™ä¸¤è¡Œçš„è¾“å‡ºéƒ½æ˜¯â€redâ€å°±æ˜¯å› ä¸ºä»–å½“å‰ä½œç”¨åŸŸçš„thiså°±æ˜¯windowï¼ˆthis === windowï¼‰ï¼› æœ€åï¼ŒsayColor.call(o)è¿™ä¸€è¡Œä»£ç å°±è¡¨ç¤º<strong>æŠŠå‡½æ•°ä½“sayColorå†…éƒ¨çš„thisï¼Œç»‘åˆ°oè¿™ä¸ªå¯¹è±¡çš„æ‰§è¡Œç¯å¢ƒï¼ˆä¸Šä¸‹æ–‡ï¼‰ä¸­æ¥</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´sayColorå†…éƒ¨çš„thisâ€”â€”&gt;<strong>o</strong></p>\n</blockquote>\n<h3 id=\"callå’Œapplyçš„åŒºåˆ«\"><a href=\"#callå’Œapplyçš„åŒºåˆ«\" class=\"headerlink\" title=\"callå’Œapplyçš„åŒºåˆ«\"></a>callå’Œapplyçš„åŒºåˆ«</h3><p><code>call()</code> å’Œ <code>apply()</code>çš„åŒºåˆ«åœ¨äºï¼Œ<code>call()</code>æ–¹æ³•æ¥å—çš„æ˜¯<strong>è‹¥å¹²ä¸ªå‚æ•°çš„åˆ—è¡¨</strong>ï¼Œè€Œ<code>apply()</code>æ–¹æ³•æ¥å—çš„æ˜¯<strong>ä¸€ä¸ªåŒ…å«å¤šä¸ªå‚æ•°çš„æ•°ç»„</strong></p>\n<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> func = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">arg1, arg2</span>) </span>&#123;</span><br><span class=\"line\">     ...</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">func.call(<span class=\"keyword\">this</span>, arg1, arg2); <span class=\"comment\">// ä½¿ç”¨ callï¼Œå‚æ•°åˆ—è¡¨</span></span><br><span class=\"line\">func.apply(<span class=\"keyword\">this</span>, [arg1, arg2]) <span class=\"comment\">// ä½¿ç”¨ applyï¼Œå‚æ•°æ•°ç»„</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"åº”ç”¨åœºæ™¯\"><a href=\"#åº”ç”¨åœºæ™¯\" class=\"headerlink\" title=\"åº”ç”¨åœºæ™¯\"></a>åº”ç”¨åœºæ™¯</h3><p>å…¶å®è¿™äº›åº”ç”¨åœºæ™¯éƒ½æœ‰æ–°çš„æ–¹æ³•å¯ä»¥å¿«é€Ÿè§£å†³ï¼Œ æˆ‘åªæ˜¯æƒ³å‘Šè¯‰å¤§å®¶ä¸€äº›å°çš„çŸ¥è¯†ç‚¹ï¼Œ è€Œä¸”è¿™äº›ä¸œè¥¿è™½ç„¶æœ‰æ–°çš„æ–¹æ³•ä»£æ›¿ï¼Œä½†æ˜¯é¢è¯•çš„æ—¶å€™å¾ˆå¯èƒ½ä¼šè¢«é—®åˆ°ã€‚</p>\n<h4 id=\"åˆå¹¶ä¸¤ä¸ªæ•°ç»„\"><a href=\"#åˆå¹¶ä¸¤ä¸ªæ•°ç»„\" class=\"headerlink\" title=\"åˆå¹¶ä¸¤ä¸ªæ•°ç»„\"></a>åˆå¹¶ä¸¤ä¸ªæ•°ç»„</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"string\">'a'</span>, <span class=\"string\">'aa'</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = [<span class=\"string\">'b'</span>, <span class=\"string\">'bb'</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Array</span>.prototype.push.apply(a, b);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a) <span class=\"comment\">// ['a', 'aa', 'b', 'bb']</span></span><br></pre></td></tr></table></figure>\n\n<p>å…¶å®ç°åœ¨æœ‰<code>concat</code>æ¥ä»£æ›¿äº†ã€‚æˆ–è€…å…¶ä»–å¥‡æ·«æŠ€å·§ã€‚ä½†æ˜¯ï¼Œéƒ½ä¸æ˜¯æˆ‘ä»¬çš„é‡ç‚¹ã€‚</p>\n<blockquote>\n<p>å½“ç¬¬äºŒä¸ªæ•°ç»„(å¦‚ç¤ºä¾‹ä¸­çš„ b )å¤ªå¤§æ—¶ä¸è¦ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ¥åˆå¹¶æ•°ç»„ï¼Œå› ä¸º<strong>ä¸€ä¸ªå‡½æ•°èƒ½å¤Ÿæ¥å—çš„å‚æ•°ä¸ªæ•°æ˜¯æœ‰é™åˆ¶</strong>çš„ã€‚ä¸åŒçš„å¼•æ“æœ‰ä¸åŒçš„é™åˆ¶ï¼ŒJSæ ¸å¿ƒé™åˆ¶åœ¨ 65535ï¼Œæœ‰äº›å¼•æ“ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæœ‰äº›ä¸æŠ›å‡ºå¼‚å¸¸ä½†ä¸¢å¤±å¤šä½™å‚æ•°ã€‚</p>\n</blockquote>\n<p>é‚£ä¹ˆè¦å¦‚ä½•è§£å†³å‘¢ï¼Ÿ</p>\n<p>æˆ‘ä»¬å¯ä»¥æŠŠæ•°ç»„è¿›è¡Œåˆ‡å‰²ã€‚ç„¶ååˆ†æ‰¹æ¬¡çš„è°ƒç”¨ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">myConcat</span>(<span class=\"params\">arr1, arr2, max = <span class=\"number\">32768</span></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; arr2.length; i += max) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">Array</span>.prototype.push.apply(</span><br><span class=\"line\">    \tarr1,</span><br><span class=\"line\">      arr2.slice(i, i + max) <span class=\"comment\">// å°çš„çŸ¥è¯†ç‚¹ï¼Œç¬¬äºŒä¸ªå‚æ•°å¤§äºæ•°ç»„é•¿åº¦å°±ä¸€ç›´å–åˆ°æ•°ç»„çš„æœ«å°¾</span></span><br><span class=\"line\">    )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = [<span class=\"number\">-2</span>, <span class=\"number\">-1</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = [];</span><br><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">999999</span>; i ++) &#123;</span><br><span class=\"line\">  b.push(i)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Array</span>.prototype.push.apply(a, b) <span class=\"comment\">// Uncaught RangeError: Maximum call stack size exceeded</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">myConcat(a, b)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"éªŒè¯æ˜¯å¦æ˜¯æ•°ç»„\"><a href=\"#éªŒè¯æ˜¯å¦æ˜¯æ•°ç»„\" class=\"headerlink\" title=\"éªŒè¯æ˜¯å¦æ˜¯æ•°ç»„\"></a>éªŒè¯æ˜¯å¦æ˜¯æ•°ç»„</h4><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> arr = [];</span><br><span class=\"line\"><span class=\"built_in\">Object</span>.prototype.toString.call(arr); <span class=\"comment\">// [object Array]</span></span><br><span class=\"line\"><span class=\"comment\">//æŠŠå‡½æ•°ä½“Object.prototype.toString()æ–¹æ³•å†…éƒ¨çš„thisï¼Œç»‘åˆ°arrçš„æ‰§è¡Œç¯å¢ƒï¼ˆä½œç”¨åŸŸï¼‰å¤åˆ¶ä»£ç </span></span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"åŒæ ·æ˜¯æ£€æµ‹å¯¹è±¡ç±»å‹ï¼Œarr-toString-çš„ç»“æœå’ŒObject-prototype-toString-call-arr-çš„ç»“æœä¸ä¸€æ ·ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ\"><a href=\"#åŒæ ·æ˜¯æ£€æµ‹å¯¹è±¡ç±»å‹ï¼Œarr-toString-çš„ç»“æœå’ŒObject-prototype-toString-call-arr-çš„ç»“æœä¸ä¸€æ ·ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ\" class=\"headerlink\" title=\"åŒæ ·æ˜¯æ£€æµ‹å¯¹è±¡ç±»å‹ï¼Œarr.toString()çš„ç»“æœå’ŒObject.prototype.toString.call(arr)çš„ç»“æœä¸ä¸€æ ·ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ\"></a>åŒæ ·æ˜¯æ£€æµ‹å¯¹è±¡ç±»å‹ï¼Œarr.toString()çš„ç»“æœå’ŒObject.prototype.toString.call(arr)çš„ç»“æœä¸ä¸€æ ·ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ</h4><blockquote>\n<p>è¿™æ˜¯å› ä¸ºtoString()ä¸ºObjectçš„åŸå‹æ–¹æ³•ï¼Œè€ŒArray ï¼Œfunctionç­‰å¼•ç”¨ç±»å‹ä½œä¸ºObjectçš„å®ä¾‹ï¼Œéƒ½é‡å†™äº†toStringæ–¹æ³•ã€‚ä¸åŒçš„å¯¹è±¡ç±»å‹è°ƒç”¨toStringæ–¹æ³•æ—¶ï¼Œæ ¹æ®åŸå‹é“¾çš„çŸ¥è¯†ï¼Œè°ƒç”¨çš„æ˜¯å¯¹åº”çš„<strong>é‡å†™</strong>ä¹‹åçš„toStringæ–¹æ³•ï¼ˆfunctionç±»å‹è¿”å›å†…å®¹ä¸ºå‡½æ•°ä½“çš„å­—ç¬¦ä¸²ï¼ŒArrayç±»å‹è¿”å›å…ƒç´ ç»„æˆçš„å­—ç¬¦ä¸²â€¦..ï¼‰ï¼Œè€Œä¸ä¼šå»è°ƒç”¨Objectä¸ŠåŸå‹toStringæ–¹æ³•ï¼Œæ‰€ä»¥é‡‡ç”¨arr.toString()ä¸èƒ½å¾—åˆ°å…¶å¯¹è±¡ç±»å‹ï¼Œåªèƒ½å°†arrè½¬æ¢ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼›å› æ­¤ï¼Œåœ¨æƒ³è¦å¾—åˆ°å¯¹è±¡çš„å…·ä½“ç±»å‹æ—¶ï¼Œåº”è¯¥è°ƒç”¨Objectä¸ŠåŸå‹toStringæ–¹æ³•ã€‚</p>\n</blockquote>\n<h4 id=\"ç±»æ•°ç»„å¯¹è±¡ï¼ˆArray-like-Objectï¼‰ä½¿ç”¨æ•°ç»„æ–¹æ³•\"><a href=\"#ç±»æ•°ç»„å¯¹è±¡ï¼ˆArray-like-Objectï¼‰ä½¿ç”¨æ•°ç»„æ–¹æ³•\" class=\"headerlink\" title=\"ç±»æ•°ç»„å¯¹è±¡ï¼ˆArray-like Objectï¼‰ä½¿ç”¨æ•°ç»„æ–¹æ³•\"></a>ç±»æ•°ç»„å¯¹è±¡ï¼ˆArray-like Objectï¼‰ä½¿ç”¨æ•°ç»„æ–¹æ³•</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> domNodes = <span class=\"built_in\">document</span>.getElementsByTagName(<span class=\"string\">\"*\"</span>);</span><br><span class=\"line\">domNodes.unshift(<span class=\"string\">\"h1\"</span>);</span><br><span class=\"line\"><span class=\"comment\">// TypeError: domNodes.unshift is not a function</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> domNodeArrays = <span class=\"built_in\">Array</span>.prototype.slice.call(domNodes);</span><br><span class=\"line\">domNodeArrays.unshift(<span class=\"string\">\"h1\"</span>); <span class=\"comment\">// 505 ä¸åŒç¯å¢ƒä¸‹æ•°æ®ä¸åŒ</span></span><br><span class=\"line\"><span class=\"comment\">// (505) [\"h1\", html.gr__hujiang_com, head, meta, ...]</span></span><br></pre></td></tr></table></figure>\n\n<p>ç±»æ•°ç»„å¯¹è±¡æœ‰ä¸‹é¢ä¸¤ä¸ªç‰¹æ€§</p>\n<ul>\n<li>1ã€å…·æœ‰ï¼šæŒ‡å‘å¯¹è±¡å…ƒç´ çš„æ•°å­—ç´¢å¼•ä¸‹æ ‡å’Œ <code>length</code> å±æ€§</li>\n<li>2ã€ä¸å…·æœ‰ï¼šæ¯”å¦‚ <code>push</code> ã€<code>shift</code>ã€ <code>forEach</code> ä»¥åŠ <code>indexOf</code>ç­‰æ•°ç»„å¯¹è±¡å…·æœ‰çš„æ–¹æ³•</li>\n</ul>\n<p>è¦è¯´æ˜çš„æ˜¯ï¼Œç±»æ•°ç»„å¯¹è±¡æ˜¯ä¸€ä¸ª<strong>å¯¹è±¡</strong>ã€‚JSä¸­å­˜åœ¨ä¸€ç§åä¸º<strong>ç±»æ•°ç»„</strong>çš„å¯¹è±¡ç»“æ„ï¼Œæ¯”å¦‚ <code>arguments</code> å¯¹è±¡ï¼Œè¿˜æœ‰DOM API è¿”å›çš„ <code>NodeList</code> å¯¹è±¡éƒ½å±äºç±»æ•°ç»„å¯¹è±¡ï¼Œç±»æ•°ç»„å¯¹è±¡ä¸èƒ½ä½¿ç”¨ <code>push/pop/shift/unshift</code> ç­‰æ•°ç»„æ–¹æ³•ï¼Œé€šè¿‡ <code>Array.prototype.slice.call</code> è½¬æ¢æˆçœŸæ­£çš„æ•°ç»„ï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>Array</code>ä¸‹æ‰€æœ‰æ–¹æ³•ã€‚</p>\n<p><strong>ç±»æ•°ç»„å¯¹è±¡è½¬æ•°ç»„</strong>çš„å…¶ä»–æ–¹æ³•ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ä¸Šé¢ä»£ç ç­‰åŒäº</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> arr = [].slice.call(<span class=\"built_in\">arguments</span>)ï¼›</span><br><span class=\"line\"></span><br><span class=\"line\">ES6:</span><br><span class=\"line\"><span class=\"keyword\">let</span> arr = <span class=\"built_in\">Array</span>.from(<span class=\"built_in\">arguments</span>);</span><br><span class=\"line\"><span class=\"keyword\">let</span> arr = [...arguments];</span><br></pre></td></tr></table></figure>\n\n<p><code>Array.from()</code> å¯ä»¥å°†ä¸¤ç±»å¯¹è±¡è½¬ä¸ºçœŸæ­£çš„æ•°ç»„ï¼š<strong>ç±»æ•°ç»„</strong>å¯¹è±¡å’Œ<strong>å¯éå†</strong>ï¼ˆiterableï¼‰å¯¹è±¡ï¼ˆåŒ…æ‹¬ES6æ–°å¢çš„æ•°æ®ç»“æ„ Set å’Œ Mapï¼‰ã€‚</p>\n<h3 id=\"å®ç°call\"><a href=\"#å®ç°call\" class=\"headerlink\" title=\"å®ç°call\"></a>å®ç°call</h3><p>è¿™é‡Œä¼šä½¿ç”¨éšå¼ç»‘å®šæ¥å®ç°ã€‚</p>\n<p>å…ˆä¸¢å‡ºæˆ‘ä»¬è¦æµ‹è¯•çš„ä¾‹å­ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.a)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = &#123;</span><br><span class=\"line\">  a: <span class=\"number\">2</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">f(); <span class=\"comment\">// 1</span></span><br><span class=\"line\">f.call(b) <span class=\"comment\">// 2</span></span><br></pre></td></tr></table></figure>\n\n<p>OK, æˆ‘ä»¬ç°åœ¨å°±æ¥å®ç°ä»¥ä¸‹è‡ªå®šä¹‰çš„callã€‚åº”ç”¨éšå¼ç»‘å®šçš„è¯å°±å¯ä»¥ç›´æ¥ç»‘å®šä¸Šäº†ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">f</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.a)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.myCall = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">context</span>) </span>&#123;</span><br><span class=\"line\">  context.fn = f;</span><br><span class=\"line\">  context.fn();</span><br><span class=\"line\">  <span class=\"keyword\">delete</span> context.fn;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> b = &#123;</span><br><span class=\"line\">  a: <span class=\"number\">2</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">f(); <span class=\"comment\">// 1</span></span><br><span class=\"line\">f.myCall(b) <span class=\"comment\">// 2</span></span><br></pre></td></tr></table></figure>\n\n<p>å¾ˆæ½‡æ´’çš„å®Œæˆäº†ã€‚ä½†æ˜¯å¥½åƒä¸èƒ½æ¥å—å‚æ•°è¯¶ï¼Œæ¥å—å‚æ•°åˆè¦è€ƒè™‘è¾¹ç•Œæƒ…å†µï¼Œæ¯”å¦‚<code>undefined</code>ï¼Œ<code>null</code>ä¹‹ç±»çš„ã€‚è€Œä¸”ï¼ï¼è€Œä¸”ï¼ï¼è€Œä¸”<code>call</code>ä¸ä¼ çš„è¯æ˜¯é»˜è®¤åº”ç”¨<code>window</code>çš„ï¼›</p>\n<p>æ‰€ä»¥ä»–æœ‰æˆ‘ä»¬ä¹Ÿè¦æœ‰ï¼å†²ï¼</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.myCall = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">context</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// å–å¾—ä¼ å…¥çš„å¯¹è±¡ï¼ˆæ‰§è¡Œä¸Šä¸‹æ–‡ï¼‰ï¼Œæ¯”å¦‚ä¸Šæ–‡çš„fooå¯¹è±¡ï¼Œè¿™é‡Œçš„contextå°±ç›¸å½“äºä¸Šæ–‡çš„foo</span></span><br><span class=\"line\">  <span class=\"comment\">// ä¸ä¼ ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œé»˜è®¤æ˜¯window,</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> context = context || <span class=\"built_in\">window</span>;</span><br><span class=\"line\">  <span class=\"comment\">// ç»™contextæ·»åŠ ä¸€ä¸ªå±æ€§ï¼Œè¿™æ—¶çš„thisæŒ‡å‘è°ƒç”¨myCallçš„å‡½æ•°ï¼Œæ¯”å¦‚ä¸Šæ–‡çš„barå‡½æ•°</span></span><br><span class=\"line\">  context.fn = <span class=\"keyword\">this</span>;<span class=\"comment\">//è¿™é‡Œçš„context.fnå°±ç›¸å½“äºä¸Šæ–‡çš„barå‡½æ•°</span></span><br><span class=\"line\">  <span class=\"comment\">// é€šè¿‡å±•å¼€è¿ç®—ç¬¦å’Œè§£æ„èµ‹å€¼å–å‡ºcontextåé¢çš„å‚æ•°ï¼Œä¸Šæ–‡çš„ä¾‹å­æ²¡æœ‰ä¼ å…¥å‚æ•°åˆ—è¡¨</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> args = [...arguments].slice(<span class=\"number\">1</span>);</span><br><span class=\"line\">  <span class=\"comment\">// æ‰§è¡Œå‡½æ•°ï¼ˆç›¸å½“äºä¸Šæ–‡çš„bar(...args)ï¼‰</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> result = context.fn(...args);</span><br><span class=\"line\">  <span class=\"comment\">// åˆ é™¤å‡½æ•°</span></span><br><span class=\"line\">  <span class=\"keyword\">delete</span> context.fn;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"å®ç°apply\"><a href=\"#å®ç°apply\" class=\"headerlink\" title=\"å®ç°apply\"></a>å®ç°apply</h3><p>å› ä¸ºä»–ä»¬ä¸¤å…„å¼Ÿå°±å‚æ•°ä¸ä¸€æ ·æ‰€ä»¥å°±ä¸è§£é‡Šäº†ï¼Œç›´æ¥çœ‹ä»£ç å§ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.myApply = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">context</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> context = context || <span class=\"built_in\">window</span>;</span><br><span class=\"line\">      context.fn = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">      <span class=\"keyword\">var</span> result;</span><br><span class=\"line\">      <span class=\"comment\">// åˆ¤æ–­ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¦å­˜åœ¨ï¼Œä¹Ÿå°±æ˜¯contextåé¢æœ‰æ²¡æœ‰ä¸€ä¸ªæ•°ç»„</span></span><br><span class=\"line\">      <span class=\"comment\">// å¦‚æœå­˜åœ¨ï¼Œåˆ™éœ€è¦å±•å¼€ç¬¬äºŒä¸ªå‚æ•°</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"built_in\">arguments</span>[<span class=\"number\">1</span>]) &#123;</span><br><span class=\"line\">        result = context.fn(...arguments[<span class=\"number\">1</span>]);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        result = context.fn();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">delete</span> context.fn;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"å®ç°bind\"><a href=\"#å®ç°bind\" class=\"headerlink\" title=\"å®ç°bind\"></a>å®ç°bind</h2><h4 id=\"äº†è§£bind\"><a href=\"#äº†è§£bind\" class=\"headerlink\" title=\"äº†è§£bind\"></a>äº†è§£bind</h4><blockquote>\n<p><code>bind() æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œåœ¨</code>bind()<code>è¢«è°ƒç”¨æ—¶ï¼Œè¿™ä¸ªæ–°å‡½æ•°çš„</code>this<code>è¢«æŒ‡å®šä¸º</code>bind()` çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè€Œå…¶ä½™å‚æ•°å°†ä½œä¸ºæ–°å‡½æ•°çš„å‚æ•°ï¼Œä¾›è°ƒç”¨æ—¶ä½¿ç”¨ã€‚</p>\n<p>è¯­æ³•ï¼š<code>fun.bind(thisArg[, arg1[, arg2[, ...]]])</code></p>\n<p>MDN</p>\n</blockquote>\n<h4 id=\"bindå’Œapplyï¼Œcallä¸¤å…„å¼Ÿçš„åŒºåˆ«\"><a href=\"#bindå’Œapplyï¼Œcallä¸¤å…„å¼Ÿçš„åŒºåˆ«\" class=\"headerlink\" title=\"bindå’Œapplyï¼Œcallä¸¤å…„å¼Ÿçš„åŒºåˆ«\"></a>bindå’Œapplyï¼Œcallä¸¤å…„å¼Ÿçš„åŒºåˆ«</h4><p><code>bind</code> æ–¹æ³•ä¸ <code>call / apply</code> æœ€å¤§çš„ä¸åŒå°±æ˜¯å‰è€…è¿”å›ä¸€ä¸ªç»‘å®šä¸Šä¸‹æ–‡çš„<strong>å‡½æ•°</strong>ï¼Œè€Œåä¸¤è€…æ˜¯<strong>ç›´æ¥æ‰§è¡Œ</strong>äº†å‡½æ•°ã€‚</p>\n<p>ä¸Šä»£ç ï¼</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> value = <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> foo = &#123;</span><br><span class=\"line\">    value: <span class=\"number\">1</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bar</span>(<span class=\"params\">name, age</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">\t\tvalue: <span class=\"keyword\">this</span>.value,</span><br><span class=\"line\">\t\tname: name,</span><br><span class=\"line\">\t\tage: age</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">bar.call(foo, <span class=\"string\">\"Jack\"</span>, <span class=\"number\">20</span>); <span class=\"comment\">// ç›´æ¥æ‰§è¡Œäº†å‡½æ•°</span></span><br><span class=\"line\"><span class=\"comment\">// &#123;value: 1, name: \"Jack\", age: 20&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> bindFoo1 = bar.bind(foo, <span class=\"string\">\"Jack\"</span>, <span class=\"number\">20</span>); <span class=\"comment\">// è¿”å›ä¸€ä¸ªå‡½æ•°</span></span><br><span class=\"line\">bindFoo1();</span><br><span class=\"line\"><span class=\"comment\">// &#123;value: 1, name: \"Jack\", age: 20&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> bindFoo2 = bar.bind(foo, <span class=\"string\">\"Jack\"</span>); <span class=\"comment\">// è¿”å›ä¸€ä¸ªå‡½æ•°</span></span><br><span class=\"line\">bindFoo2(<span class=\"number\">20</span>);</span><br><span class=\"line\"><span class=\"comment\">// &#123;value: 1, name: \"Jack\", age: 20&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>é€šè¿‡ä¸Šè¿°ä»£ç å¯ä»¥çœ‹å‡º<code>bind</code> æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š</p>\n<ul>\n<li>1ã€å¯ä»¥æŒ‡å®š<code>this</code></li>\n<li>2ã€è¿”å›ä¸€ä¸ªå‡½æ•°</li>\n<li>3ã€å¯ä»¥ä¼ å…¥å‚æ•°</li>\n<li>4ã€æŸ¯é‡ŒåŒ–</li>\n</ul>\n<h4 id=\"å®ç°bind-1\"><a href=\"#å®ç°bind-1\" class=\"headerlink\" title=\"å®ç°bind\"></a>å®ç°bind</h4><p>ç›´æ¥å¼€å¹²ï¼</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.myBind = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">context</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> that = <span class=\"keyword\">this</span>; <span class=\"comment\">// è¿™é‡Œåˆ©ç”¨çš„é—­åŒ…ä¿å­˜äº†æ­¤æ—¶æ­¤åˆ»çš„thisï¼Œå¦åˆ™åé¢è°ƒç”¨çš„è¯ä¼šéšå¼ä¸¢å¤±</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">    <span class=\"keyword\">return</span> that.apply(context)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æµ‹è¯•ç”¨ä¾‹</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> value = <span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> foo = &#123;</span><br><span class=\"line\">    value: <span class=\"number\">1</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bar</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.value;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> bindFoo = bar.myBind(foo);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(bindFoo()); <span class=\"comment\">// 1</span></span><br></pre></td></tr></table></figure>\n\n<p>Ok,æ¥ä¸‹æ¥æˆ‘ä»¬å¤„ç†ä¸€ä¸‹å‚æ•°å’ŒæŸ¯é‡ŒåŒ–å§ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.myBind = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">context</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// å› ä¸ºå‚æ•°æ˜¯ç±»æ•°ç»„æ²¡æœ‰sliceæ–¹æ³•ï¼Œé€šè¿‡callç»‘å®šthisä¹‹åä½¿ç”¨sliceæ‹·è´æ•°ç»„ï¼Œé™¤äº†ç¬¬ä¸€ä¸ªéœ€è¦ç»‘å®šçš„this ä¹‹å¤–ï¼Œä¸‹é¢ä¼šç”¨åˆ°</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> args = <span class=\"built_in\">Array</span>.prototype.slice.call(<span class=\"built_in\">arguments</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">  <span class=\"keyword\">var</span> that = <span class=\"keyword\">this</span>; <span class=\"comment\">// è¿™é‡Œåˆ©ç”¨çš„é—­åŒ…ä¿å­˜äº†æ­¤æ—¶æ­¤åˆ»çš„thisï¼Œå¦åˆ™åé¢è°ƒç”¨çš„è¯ä¼šéšå¼ä¸¢å¤±</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">    <span class=\"comment\">// å’Œä¸Šé¢ä¸€æ ·æ‹·è´å‚æ•°</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> nowArgs = <span class=\"built_in\">Array</span>.prototype.slice.call(<span class=\"built_in\">arguments</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> that.apply(context, args.concat(nowArgs))</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// æµ‹è¯•ç”¨ä¾‹</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> value = <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> foo = &#123;</span><br><span class=\"line\">    value: <span class=\"number\">1</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bar</span>(<span class=\"params\">name, age</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">\t\tvalue: <span class=\"keyword\">this</span>.value,</span><br><span class=\"line\">\t\tname: name,</span><br><span class=\"line\">\t\tage: age</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> bindFoo = bar.myBind(foo, <span class=\"string\">\"Jack\"</span>);</span><br><span class=\"line\">bindFoo(<span class=\"number\">20</span>);</span><br><span class=\"line\"><span class=\"comment\">// &#123;value: 1, name: \"Jack\", age: 20&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>åˆ°ç°åœ¨å·²ç»å®Œæˆå¤§éƒ¨åˆ†äº†ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªéš¾ç‚¹ï¼Œ<code>bind</code> æœ‰ä»¥ä¸‹ä¸€ä¸ªç‰¹æ€§</p>\n<blockquote>\n<p>ä¸€ä¸ªç»‘å®šå‡½æ•°ä¹Ÿèƒ½ä½¿ç”¨newæ“ä½œç¬¦åˆ›å»ºå¯¹è±¡ï¼šè¿™ç§è¡Œä¸ºå°±åƒæŠŠåŸå‡½æ•°å½“æˆæ„é€ å™¨ï¼Œæä¾›çš„ this å€¼è¢«å¿½ç•¥ï¼ŒåŒæ—¶è°ƒç”¨æ—¶çš„å‚æ•°è¢«æä¾›ç»™æ¨¡æ‹Ÿå‡½æ•°ã€‚</p>\n</blockquote>\n<p>ä¸¾ä¾‹è¯´æ˜ï¼šæ­£è§„çš„bind</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> value = <span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> foo = &#123;</span><br><span class=\"line\">    value: <span class=\"number\">1</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bar</span>(<span class=\"params\">name, age</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.habit = <span class=\"string\">'shopping'</span>;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.value);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(name);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(age);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">bar.prototype.friend = <span class=\"string\">'kevin'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> bindFoo = bar.bind(foo, <span class=\"string\">'Jack'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> obj = <span class=\"keyword\">new</span> bindFoo(<span class=\"number\">20</span>);</span><br><span class=\"line\"><span class=\"comment\">// undefined</span></span><br><span class=\"line\"><span class=\"comment\">// Jack</span></span><br><span class=\"line\"><span class=\"comment\">// 20</span></span><br><span class=\"line\"></span><br><span class=\"line\">obj.habit;</span><br><span class=\"line\"><span class=\"comment\">// shopping</span></span><br><span class=\"line\"></span><br><span class=\"line\">obj.friend;</span><br><span class=\"line\"><span class=\"comment\">// kevin</span></span><br></pre></td></tr></table></figure>\n\n<p>ä¸Šé¢ä¾‹å­ä¸­ï¼Œè¿è¡Œç»“æœ<code>this.value</code> è¾“å‡ºä¸º <code>undefined</code>ï¼Œè¿™ä¸æ˜¯å…¨å±€<code>value</code> ä¹Ÿä¸æ˜¯<code>foo</code>å¯¹è±¡ä¸­çš„<code>value</code>ï¼Œè¿™è¯´æ˜ <code>bind</code> çš„ <code>this</code> å¯¹è±¡å¤±æ•ˆäº†ï¼Œ<code>new</code> çš„å®ç°ä¸­ç”Ÿæˆä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè¿™ä¸ªæ—¶å€™çš„ <code>this</code>æŒ‡å‘çš„æ˜¯ <code>obj</code>ã€‚</p>\n<p>æ‰€ä»¥æˆ‘ä»¬è¿”å›çš„æ—¶å€™éœ€è¦åˆ¤æ–­ä¸€ä¸‹ä»–æ˜¯ä¸æ˜¯ä½œä¸ºäº†æ„é€ å‡½æ•°è¿”å›ï¼Œå¦‚æœæ˜¯å°±è¿”å›å½“å‰çš„thisï¼Œå¦‚æœä¸æ˜¯å°±ç»‘å®šå½“å‰è¾“å…¥çš„<code>context</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.myBind = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">context</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// å› ä¸ºå‚æ•°æ˜¯ç±»æ•°ç»„æ²¡æœ‰sliceæ–¹æ³•ï¼Œé€šè¿‡callç»‘å®šthisä¹‹åä½¿ç”¨sliceæ‹·è´æ•°ç»„ï¼Œé™¤äº†ç¬¬ä¸€ä¸ªéœ€è¦ç»‘å®šçš„this ä¹‹å¤–ï¼Œä¸‹é¢ä¼šç”¨åˆ°</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> args = <span class=\"built_in\">Array</span>.prototype.slice.call(<span class=\"built_in\">arguments</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">  <span class=\"keyword\">var</span> that = <span class=\"keyword\">this</span>; <span class=\"comment\">// è¿™é‡Œåˆ©ç”¨çš„é—­åŒ…ä¿å­˜äº†æ­¤æ—¶æ­¤åˆ»çš„thisï¼Œå¦åˆ™åé¢è°ƒç”¨çš„è¯ä¼šéšå¼ä¸¢å¤±</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> fnc = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">    <span class=\"comment\">// å’Œä¸Šé¢ä¸€æ ·æ‹·è´å‚æ•°</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> nowArgs = <span class=\"built_in\">Array</span>.prototype.slice.call(<span class=\"built_in\">arguments</span>)</span><br><span class=\"line\">    <span class=\"comment\">//å½“ä½œä¸ºæ„é€ å‡½æ•°æ—¶ï¼Œthis æŒ‡å‘å®ä¾‹ï¼Œæ­¤æ—¶ this instanceof fBound ç»“æœä¸º trueï¼Œå¯ä»¥è®©å®ä¾‹è·å¾—æ¥è‡ªç»‘å®šå‡½æ•°çš„å€¼ï¼Œå³ä¸Šä¾‹ä¸­å®ä¾‹ä¼šå…·æœ‰ habit å±æ€§ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">//å½“ä½œä¸ºæ™®é€šå‡½æ•°æ—¶ï¼Œthis æŒ‡å‘ windowï¼Œæ­¤æ—¶ç»“æœä¸º falseï¼Œå°†ç»‘å®šå‡½æ•°çš„ this æŒ‡å‘ context</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> that.apply(</span><br><span class=\"line\">      <span class=\"keyword\">this</span> <span class=\"keyword\">instanceof</span> fnc ? <span class=\"keyword\">this</span> : context, </span><br><span class=\"line\">      args.concat(nowArgs)</span><br><span class=\"line\">    )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// ä¿®æ”¹è¿”å›å‡½æ•°çš„ prototype ä¸ºç»‘å®šå‡½æ•°çš„ prototypeï¼Œå®ä¾‹å°±å¯ä»¥ç»§æ‰¿ç»‘å®šå‡½æ•°çš„åŸå‹ä¸­çš„å€¼ï¼Œå³ä¸Šä¾‹ä¸­ obj å¯ä»¥è·å–åˆ° bar åŸå‹ä¸Šçš„ friendã€‚</span></span><br><span class=\"line\">  fnc.prototype = <span class=\"keyword\">this</span>.prototype</span><br><span class=\"line\">  <span class=\"keyword\">return</span> fnc</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä½†æ˜¯å…¶å®è¿™æ ·ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘å¦‚æœå®ä¾‹ä¿®æ”¹äº†åŸå‹ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„ç»§æ‰¿å°±ä¼šå‡ºç°é—®é¢˜ã€‚</p>\n<p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦æ‹·è´ä¸€ä¸‹æˆ‘ä»¬åŸå‹ä¸Šé¢çš„å‚æ•°ã€‚ä¼šç”¨åˆ°</p>\n<blockquote>\n<p>é“æ ¼æ‹‰æ–¯Â·å…‹ç½—å…‹ç¦å¾·åœ¨ 2006 å¹´å†™äº†ä¸€ç¯‡æ–‡ç« ï¼Œé¢˜ä¸º Prototypal Inheritance in JavaScript (JavaScript 10 ä¸­çš„åŸå‹å¼ç»§æ‰¿)ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œä»–ä»‹ç»äº†ä¸€ç§å®ç°ç»§æ‰¿çš„æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•å¹¶æ²¡æœ‰ä½¿ç”¨ä¸¥æ ¼æ„ä¹‰ä¸Šçš„ æ„é€ å‡½æ•°ã€‚ä»–çš„æƒ³æ³•æ˜¯å€ŸåŠ©åŸå‹å¯ä»¥åŸºäºå·²æœ‰çš„å¯¹è±¡åˆ›å»ºæ–°å¯¹è±¡ï¼ŒåŒæ—¶è¿˜ä¸å¿…å› æ­¤åˆ›å»ºè‡ªå®šä¹‰ç±»å‹ã€‚ä¸º äº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œä»–ç»™å‡ºäº†å¦‚ä¸‹å‡½æ•°ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">object</span>(<span class=\"params\">o</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">F</span>(<span class=\"params\"></span>)</span>&#123;&#125;</span><br><span class=\"line\">  F.prototype = o</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> F</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>çœ‹èµ·æ¥éå¸¸ç®€å•</p>\n<p>å…ˆåœ¨<code>object</code>å‡½æ•°å†…éƒ¨åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„æ„é€ å‡½æ•°<code>F</code>, ç„¶åå°†ä¼ å…¥çš„è¿™ä¸ªå¯¹è±¡<code>o</code>ä½œä¸ºè¿™ä¸ªä¸´æ—¶æ„é€ å‡½æ•°çš„åŸå‹, æœ€åè¿”å›è¿™ä¸ªä¸´æ—¶æ„é€ å‡½æ•°çš„å®ä¾‹. </p>\n<p>ç®€å•æ¥è¯´å°±æ˜¯<code>object</code>å¯¹ä¼ å…¥çš„å¯¹è±¡è¿›è¡Œäº†æµ…å¤åˆ¶.</p>\n</blockquote>\n<p>è¿™å¥è¯åœ¨æˆ‘çš„ã€ŠåŸå‹åŸå‹é“¾å’Œç»§æ‰¿ã€‹é‡Œé¢æœ‰å…·ä½“çš„ä»‹ç»ã€‚æƒ³çœ‹çš„è¯å¯ä»¥ç‚¹å‡»å¤´åƒæŸ¥æ‰¾æ–‡ç« ã€‚</p>\n<p>è¿™è¾¹å¯ä»¥ç›´æ¥ä½¿ç”¨ES5çš„ <code>Object.create()</code>æ–¹æ³•ç”Ÿæˆä¸€ä¸ªæ–°å¯¹è±¡</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fBound.prototype = <span class=\"built_in\">Object</span>.create(<span class=\"keyword\">this</span>.prototype);</span><br></pre></td></tr></table></figure>\n\n<p>ä¸è¿‡ <code>bind</code> å’Œ <code>Object.create()</code>éƒ½æ˜¯ES5æ–¹æ³•ï¼Œéƒ¨åˆ†IEæµè§ˆå™¨ï¼ˆIE &lt; 9ï¼‰å¹¶ä¸æ”¯æŒï¼ŒPolyfillä¸­ä¸èƒ½ç”¨ <code>Object.create()</code>å®ç° <code>bind</code>ï¼Œä¸è¿‡åŸç†æ˜¯ä¸€æ ·çš„ã€‚</p>\n<p>okã€‚é‚£æˆ‘ä»¬å°±ä¿®æ”¹ä¸€ä¸‹</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.myBind = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">context</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// å› ä¸ºå‚æ•°æ˜¯ç±»æ•°ç»„æ²¡æœ‰sliceæ–¹æ³•ï¼Œé€šè¿‡callç»‘å®šthisä¹‹åä½¿ç”¨sliceæ‹·è´æ•°ç»„ï¼Œé™¤äº†ç¬¬ä¸€ä¸ªéœ€è¦ç»‘å®šçš„this ä¹‹å¤–ï¼Œä¸‹é¢ä¼šç”¨åˆ°</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> args = <span class=\"built_in\">Array</span>.prototype.slice.call(<span class=\"built_in\">arguments</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">  <span class=\"keyword\">var</span> that = <span class=\"keyword\">this</span>; <span class=\"comment\">// è¿™é‡Œåˆ©ç”¨çš„é—­åŒ…ä¿å­˜äº†æ­¤æ—¶æ­¤åˆ»çš„thisï¼Œå¦åˆ™åé¢è°ƒç”¨çš„è¯ä¼šéšå¼ä¸¢å¤±</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> fNOP = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;&#125;;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> fnc = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">    <span class=\"comment\">// å’Œä¸Šé¢ä¸€æ ·æ‹·è´å‚æ•°</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> nowArgs = <span class=\"built_in\">Array</span>.prototype.slice.call(<span class=\"built_in\">arguments</span>)</span><br><span class=\"line\">    <span class=\"comment\">//å½“ä½œä¸ºæ„é€ å‡½æ•°æ—¶ï¼Œthis æŒ‡å‘å®ä¾‹ï¼Œæ­¤æ—¶ this instanceof fBound ç»“æœä¸º trueï¼Œå¯ä»¥è®©å®ä¾‹è·å¾—æ¥è‡ªç»‘å®šå‡½æ•°çš„å€¼ï¼Œå³ä¸Šä¾‹ä¸­å®ä¾‹ä¼šå…·æœ‰ habit å±æ€§ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">//å½“ä½œä¸ºæ™®é€šå‡½æ•°æ—¶ï¼Œthis æŒ‡å‘ windowï¼Œæ­¤æ—¶ç»“æœä¸º falseï¼Œå°†ç»‘å®šå‡½æ•°çš„ this æŒ‡å‘ context</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> that.apply(</span><br><span class=\"line\">      <span class=\"keyword\">this</span> <span class=\"keyword\">instanceof</span> fNOP ? <span class=\"keyword\">this</span> : context, </span><br><span class=\"line\">      args.concat(nowArgs)</span><br><span class=\"line\">    )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// ä¿®æ”¹è¿”å›å‡½æ•°çš„ prototype ä¸ºç»‘å®šå‡½æ•°çš„ prototypeï¼Œå®ä¾‹å°±å¯ä»¥ç»§æ‰¿ç»‘å®šå‡½æ•°çš„åŸå‹ä¸­çš„å€¼ï¼Œå³ä¸Šä¾‹ä¸­ obj å¯ä»¥è·å–åˆ° bar åŸå‹ä¸Šçš„ friendã€‚</span></span><br><span class=\"line\">  fNOP.prototype = <span class=\"keyword\">this</span>.prototype</span><br><span class=\"line\">  fnc.prototype = <span class=\"keyword\">new</span> FNOP()</span><br><span class=\"line\">  <span class=\"keyword\">return</span> fnc</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>åˆ°è¿™é‡Œå…¶å®å·²ç»å·®ä¸å¤šäº†ï¼Œçªç„¶æƒ³èµ·æ¥è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯è°ƒç”¨ <code>bind</code> çš„ä¸æ˜¯å‡½æ•°ï¼Œè¿™æ—¶å€™éœ€è¦æŠ›å‡ºå¼‚å¸¸ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> <span class=\"keyword\">this</span> !== <span class=\"string\">\"function\"</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">\"Function.prototype.bind - what is trying to be bound is not callable\"</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æ‰€ä»¥</p>\n<h4 id=\"é¡¶é…\"><a href=\"#é¡¶é…\" class=\"headerlink\" title=\"é¡¶é…\"></a>é¡¶é…</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Function</span>.prototype.myBind = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">context</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> <span class=\"keyword\">this</span> !== <span class=\"string\">\"function\"</span>) &#123;</span><br><span class=\"line\">  \t<span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(<span class=\"string\">\"Function.prototype.bind - what is trying to \tbe bound is not callable\"</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">  <span class=\"comment\">// å› ä¸ºå‚æ•°æ˜¯ç±»æ•°ç»„æ²¡æœ‰sliceæ–¹æ³•ï¼Œé€šè¿‡callç»‘å®šthisä¹‹åä½¿ç”¨sliceæ‹·è´æ•°ç»„ï¼Œé™¤äº†ç¬¬ä¸€ä¸ªéœ€è¦ç»‘å®šçš„this ä¹‹å¤–ï¼Œä¸‹é¢ä¼šç”¨åˆ°</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> args = <span class=\"built_in\">Array</span>.prototype.slice.call(<span class=\"built_in\">arguments</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">  <span class=\"keyword\">var</span> that = <span class=\"keyword\">this</span>; <span class=\"comment\">// è¿™é‡Œåˆ©ç”¨çš„é—­åŒ…ä¿å­˜äº†æ­¤æ—¶æ­¤åˆ»çš„thisï¼Œå¦åˆ™åé¢è°ƒç”¨çš„è¯ä¼šéšå¼ä¸¢å¤±</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> fNOP = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;&#125;;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> fnc = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">    <span class=\"comment\">// å’Œä¸Šé¢ä¸€æ ·æ‹·è´å‚æ•°</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> nowArgs = <span class=\"built_in\">Array</span>.prototype.slice.call(<span class=\"built_in\">arguments</span>)</span><br><span class=\"line\">    <span class=\"comment\">//å½“ä½œä¸ºæ„é€ å‡½æ•°æ—¶ï¼Œthis æŒ‡å‘å®ä¾‹ï¼Œæ­¤æ—¶ this instanceof fBound ç»“æœä¸º trueï¼Œå¯ä»¥è®©å®ä¾‹è·å¾—æ¥è‡ªç»‘å®šå‡½æ•°çš„å€¼ï¼Œå³ä¸Šä¾‹ä¸­å®ä¾‹ä¼šå…·æœ‰ habit å±æ€§ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">//å½“ä½œä¸ºæ™®é€šå‡½æ•°æ—¶ï¼Œthis æŒ‡å‘ windowï¼Œæ­¤æ—¶ç»“æœä¸º falseï¼Œå°†ç»‘å®šå‡½æ•°çš„ this æŒ‡å‘ context</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> that.apply(</span><br><span class=\"line\">      <span class=\"keyword\">this</span> <span class=\"keyword\">instanceof</span> fNOP ? <span class=\"keyword\">this</span> : context, </span><br><span class=\"line\">      args.concat(nowArgs)</span><br><span class=\"line\">    )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// ä¿®æ”¹è¿”å›å‡½æ•°çš„ prototype ä¸ºç»‘å®šå‡½æ•°çš„ prototypeï¼Œå®ä¾‹å°±å¯ä»¥ç»§æ‰¿ç»‘å®šå‡½æ•°çš„åŸå‹ä¸­çš„å€¼ï¼Œå³ä¸Šä¾‹ä¸­ obj å¯ä»¥è·å–åˆ° bar åŸå‹ä¸Šçš„ friendã€‚</span></span><br><span class=\"line\">  fNOP.prototype = <span class=\"keyword\">this</span>.prototype</span><br><span class=\"line\">  fnc.prototype = <span class=\"keyword\">new</span> FNOP()</span><br><span class=\"line\">  <span class=\"keyword\">return</span> fnc</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<h2 id=\"å®ç°new\"><a href=\"#å®ç°new\" class=\"headerlink\" title=\"å®ç°new\"></a>å®ç°new</h2><h4 id=\"äº†è§£new\"><a href=\"#äº†è§£new\" class=\"headerlink\" title=\"äº†è§£new\"></a>äº†è§£new</h4><blockquote>\n<p><strong>new è¿ç®—ç¬¦</strong>åˆ›å»ºä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„å¯¹è±¡ç±»å‹çš„å®ä¾‹æˆ–å…·æœ‰æ„é€ å‡½æ•°çš„å†…ç½®å¯¹è±¡çš„å®ä¾‹ã€‚ â€”â€”ï¼ˆæ¥è‡ªäºMDNï¼‰</p>\n</blockquote>\n<p>æˆ‘ä»¬å…ˆè¯•è¯•ç°åœ¨æœ‰çš„newï¼Œä»–æœ‰ä»€ä¹ˆåŠŸèƒ½ï¼Œç„¶åæˆ‘ä»¬æ€»ç»“ä¹‹åï¼Œåœ¨å¼€å§‹å®ç°ã€‚</p>\n<p>çœ‹ä¸ªğŸŒ°ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">NEW</span> (<span class=\"params\">a</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.a = a;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">NEW.prototype.sayA = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>.a+<span class=\"string\">'b'</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> A = <span class=\"keyword\">new</span> NEW(<span class=\"number\">1</span>);</span><br><span class=\"line\">A.sayA()</span><br><span class=\"line\">A.a</span><br></pre></td></tr></table></figure>\n\n<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°Aæ˜¯NEWçš„ä¸€ä¸ªå®ä¾‹ã€‚ç»§æ‰¿äº†æ„é€ å‡½æ•°ï¼ˆNEWï¼‰çš„å±æ€§å’ŒåŸå‹ä¸Šçš„å±æ€§ï¼ˆsayAï¼‰ã€‚</p>\n<blockquote>\n<p><strong><code>new</code></strong> å…³é”®å­—ä¼šè¿›è¡Œå¦‚ä¸‹çš„æ“ä½œï¼š</p>\n<ol>\n<li>åˆ›å»ºä¸€ä¸ªç©ºçš„ç®€å•JavaScriptå¯¹è±¡ï¼ˆå³{}ï¼‰ï¼›</li>\n<li>é“¾æ¥è¯¥å¯¹è±¡ï¼ˆå³è®¾ç½®è¯¥å¯¹è±¡çš„æ„é€ å‡½æ•°ï¼‰åˆ°å¦ä¸€ä¸ªå¯¹è±¡ ï¼›</li>\n<li>å°†æ­¥éª¤1æ–°åˆ›å»ºçš„å¯¹è±¡ä½œä¸º<code>this</code>çš„ä¸Šä¸‹æ–‡ ï¼›</li>\n<li>å¦‚æœè¯¥å‡½æ•°æ²¡æœ‰è¿”å›å¯¹è±¡ï¼Œåˆ™è¿”å›<code>this</code>ã€‚</li>\n</ol>\n<p>MDN</p>\n</blockquote>\n<h4 id=\"å®ç°ä¸€ä¸ªnew\"><a href=\"#å®ç°ä¸€ä¸ªnew\" class=\"headerlink\" title=\"å®ç°ä¸€ä¸ªnew\"></a>å®ç°ä¸€ä¸ªnew</h4><p>è¯´å¹²å°±å¹²ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// new æ˜¯å…³é”®è¯ï¼Œä¸å¯ä»¥ç›´æ¥è¦†ç›–ã€‚è¿™é‡Œä½¿ç”¨ create æ¥æ¨¡æ‹Ÿå®ç° new çš„æ•ˆæœã€‚</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">create</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 1.</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> obj = <span class=\"keyword\">new</span> <span class=\"built_in\">Object</span>();</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// è·å–æ„é€ å‡½æ•°</span></span><br><span class=\"line\">  <span class=\"comment\">// å› ä¸ºargumentsæ˜¯ä¸€ä¸ªç±»æ•°ç»„å¯¹è±¡ï¼Œæ²¡æœ‰unshiftæ–¹æ³•ï¼Œæ‰€ä»¥ç”¨äº†callï¼Œæˆ‘ä»¬æ²¡æœ‰newè¿™å…³é”®å­—ï¼Œåªèƒ½æ¨¡æ‹Ÿï¼Œæ‰€ä»¥çš„ä¸€ä¸ªå‚æ•°æˆ‘ä»¬è®¤ä¸ºä»–éœ€è¦ä¼ é€’ä¸€ä¸ªæ„é€ å‡½æ•°ã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> Con = [].unshift.call(<span class=\"built_in\">arguments</span>)</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// 2.</span></span><br><span class=\"line\">  obj.__proto__ = Con.prototype </span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// 3ã€ ç»‘å®šthisã€‚å› ä¸ºä¹‹å‰argumentså·²ç»è¢«æˆ‘ä»¬åˆ é™¤äº†ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥å‰©ä¸‹çš„å°±æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„å‚æ•°äº†ã€‚</span></span><br><span class=\"line\">  Con.apply(obj, <span class=\"built_in\">arguments</span>)</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">// 4. ç®€é™‹ç‰ˆ</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> obj</span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æ„é€ å‡½æ•°è¿”å›å€¼æœ‰å¦‚ä¸‹ä¸‰ç§æƒ…å†µï¼š</p>\n<ul>\n<li>1ã€è¿”å›ä¸€ä¸ªå¯¹è±¡</li>\n<li>2ã€æ²¡æœ‰ <code>return</code>ï¼Œå³è¿”å› <code>undefined</code></li>\n<li>3ã€è¿”å›<code>undefined</code> ä»¥å¤–çš„åŸºæœ¬ç±»å‹</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">create</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">\t<span class=\"comment\">// 1ã€è·å¾—æ„é€ å‡½æ•°ï¼ŒåŒæ—¶åˆ é™¤ arguments ä¸­ç¬¬ä¸€ä¸ªå‚æ•°</span></span><br><span class=\"line\">    Con = [].shift.call(<span class=\"built_in\">arguments</span>);</span><br><span class=\"line\">\t<span class=\"comment\">// 2ã€åˆ›å»ºä¸€ä¸ªç©ºçš„å¯¹è±¡å¹¶é“¾æ¥åˆ°åŸå‹ï¼Œobj å¯ä»¥è®¿é—®æ„é€ å‡½æ•°åŸå‹ä¸­çš„å±æ€§</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> obj = <span class=\"built_in\">Object</span>.create(Con.prototype);</span><br><span class=\"line\">\t<span class=\"comment\">// 3ã€ç»‘å®š this å®ç°ç»§æ‰¿ï¼Œobj å¯ä»¥è®¿é—®åˆ°æ„é€ å‡½æ•°ä¸­çš„å±æ€§</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> ret = Con.apply(obj, <span class=\"built_in\">arguments</span>);</span><br><span class=\"line\">\t<span class=\"comment\">// 4ã€ä¼˜å…ˆè¿”å›æ„é€ å‡½æ•°è¿”å›çš„å¯¹è±¡</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> ret <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Object</span> ? ret : obj;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n"},{"title":"ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC","date":"2020-08-12T10:03:34.000Z","cover":"/image/cover/web.jpeg","_content":"\n\næœ€è¿‘åœ¨å†™ã€é‡æ‹¾å‰ç«¯ã€‘ç³»åˆ—ï¼Œä¸‹é¢æœ‰å‡ ä¸ªå¿«é€Ÿé€šé“ï¼Œå¤§å®¶è‡ªå–\n\n[ã€é‡è¯†å‰ç«¯ã€‘åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿](https://juejin.im/post/6850418113944420359)\n\n[ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—](https://juejin.im/post/6850418117508759566)\n\n[ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this](https://juejin.im/post/6854573215658803208)\n\n[ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šJavaScriptçš„æ‰§è¡Œæœºåˆ¶](https://juejin.im/post/6859911609633767438)\n\n[ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC](https://juejin.im/post/6860375101322461198)\n\n[ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ](https://juejin.im/post/6865204092877144077)\n\n## å‰è¨€\n\nå…¶å®åœ¨é¢è¯•çš„è¿‡ç¨‹ä¸­å¾ˆæœ‰å¯èƒ½ä¼šè¢«é—®åˆ°â€œä»‹ç»ä¸€ä¸‹BFCâ€\n\né‚£ä»Šå¤©å°±ä¸€å£æ°”æŠŠBFCã€IFCã€GFC å’Œ FFCè¿™å››å…„å¼Ÿç»™åƒé€\n\nåƒé€é€\n\né‡ç‚¹ä»‹ç»ä¸€ä¸‹BFCï¼Œä»–çš„ä¸‰å…„å¼Ÿè¿™é‡Œåªåšä»‹ç»ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥ä¸Šç½‘å¤šæŸ¥æŸ¥èµ„æ–™ç„¶åå›æ¥æ•™æ•™æˆ‘ğŸ˜‚\n\n## å¼€å§‹\n\n### what\n\nå…¶å®åœ¨è¯´BFCå’Œä»–çš„ä¸‰å…„å¼Ÿä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ï¼Œä»€ä¹ˆæ˜¯FCï¼Ÿ\n\næ‰“æ–­ä¸€ä¸‹ã€‚è¯´FCä¹‹å‰æˆ‘å¸Œæœ›å…ˆè¯´ä¸€ä¸‹BOX\n\n#### BOX\n\nä¸€ä¸ªé¡µé¢æ˜¯ç”±å¾ˆå¤šå…ƒç´ ç»„æˆçš„ï¼Œè€Œè¿™äº›å…ƒç´ éƒ½æ˜¯ä¸€ä¸ªæ¥ä¸€ä¸ªç›’å­ã€‚é‚£æœ‰äººå°±è¯´äº†ï¼Œé‚£`border-radius: 50%`æï¼Ÿ\n\nOk, ç›´æ¥çœ‹ä¸‹å›¾å§ï¼š\n\n![demo1-1](/image/BFC/1.png)\n\nå†æ¥çœ‹ä¸€ä¸ªæ›´ç›´è§‚çš„å›¾ã€‚æ‰“å¼€Googleçš„é¦–é¡µï¼Œç„¶ååœ¨æ§åˆ¶å°è¾“å…¥\n\n```js\n[].forEach.call(document.querySelectorAll('*'), function(a){a.style.outline = \"1px solid red\";})\n```\n\n![demo2](/image/BFC/2.png)\n\næ‰€ä»¥ï¼Œå…¶å®é¡µé¢éƒ½æ˜¯ç”±ä¸€ä¸ªåˆä¸€ä¸ªçš„ç›’å­ç»„åˆè€Œæˆçš„ã€‚\n\næ˜ç¡®äº†è¿™ä¸ªï¼Œæˆ‘ä»¬å†æ¥è¯´è¯´FCæ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ã€‚\n\n#### FCï¼ˆFormatting Contextï¼‰\n\nå®ƒæ˜¯W3C CSS2.1è§„èŒƒä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼Œå®šä¹‰çš„æ˜¯é¡µé¢ä¸­çš„ä¸€å—æ¸²æŸ“åŒºåŸŸï¼Œå¹¶ä¸”æœ‰ä¸€å¥—æ¸²æŸ“è§„åˆ™ï¼Œå®ƒ**å†³å®šäº†å…¶å­å…ƒç´ å°†å¦‚ä½•å®šä½**ï¼Œä»¥åŠ**å’Œå…¶ä»–å…ƒç´ çš„å…³ç³»å’Œç›¸äº’ä½œç”¨**ã€‚\n\nå¸¸è§çš„`Formatting Context` æœ‰ï¼š`Block Formatting Context`ï¼ˆBFC | å—çº§æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼‰ å’Œ `Inline Formatting Context`ï¼ˆIFC |è¡Œå†…æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼‰ã€‚\n\n#### BFC\n\n> MDN: **å—æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼ˆBlock Formatting Contextï¼ŒBFCï¼‰** æ˜¯Webé¡µé¢çš„å¯è§†CSSæ¸²æŸ“çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯å—ç›’å­çš„å¸ƒå±€è¿‡ç¨‹å‘ç”Ÿçš„åŒºåŸŸï¼Œä¹Ÿæ˜¯æµ®åŠ¨å…ƒç´ ä¸å…¶ä»–å…ƒç´ äº¤äº’çš„åŒºåŸŸã€‚\n\n\n\n### why\n\né‚£ä¹ˆFCå››å…„å¼Ÿä»–ä»¬çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿå¯ä¸å¯ä»¥ä¸è¦ä»–ä»¬ï¼Ÿ\n\nå…¶å®ï¼Œæˆ‘ä»¬æ¢ä¸ªè§’åº¦æƒ³æƒ³å°±ä¼šèˆ’æœå¾ˆå¤šã€‚æ¯”å¦‚æˆ‘ä»¬å¼€è½¦ä¸Šè·¯ï¼Œå¦‚æœæ²¡æœ‰ğŸš¦ï¼Œé‚£ä¹ˆè·¯å†µå¯èƒ½ä¼šå˜å¾—å¾ˆç³Ÿï¼Œä¸åŒçš„è·¯å£çš„ğŸš¦çš„çº¢ç¯ç»¿ç¯æ—¶é—´éƒ½æ˜¯ç»è¿‡ç²¾å¿ƒè®¾è®¡çš„ï¼Œæ¯”å¦‚è½¦å¤šçš„æ–¹å‘ï¼Œçº¢ç¯æ—¶é—´å°±å°‘ä¸€äº›ï¼Œç»¿ç¯å¤šä¸€äº›ã€‚å¤§å®¶éƒ½æ˜¯ä¸ºäº†è®©è·¯å†µå˜å¾—æ›´å¥½ã€‚\n\nåè§‚FCå››å…„å¼Ÿï¼Œä»–ä»¬ä¹Ÿæ˜¯ä¸ºäº†è®©ä¸åŒæƒ…å†µä¸‹çš„CSSå¯ä»¥æ›´æœ‰ç§©åºçš„æ˜¾ç¤ºã€‚\n\n\n\n### how\n\né‚£ä¹ˆæˆ‘è¦æ€ä¹ˆæ ·æ‰å¯ä»¥åˆ¶é€ ä¸€ä¸ªBFCï¼Ÿ\n\n- æ ¹å…ƒç´ ï¼ˆ`<html>ï¼‰`\n- æµ®åŠ¨å…ƒç´ ï¼ˆå…ƒç´ çš„ [`float`](https://developer.mozilla.org/zh-CN/docs/Web/CSS/float) ä¸æ˜¯ `none`ï¼‰\n- ç»å¯¹å®šä½å…ƒç´ ï¼ˆå…ƒç´ çš„ [`position`](https://developer.mozilla.org/zh-CN/docs/Web/CSS/position) ä¸º `absolute` æˆ– `fixed`ï¼‰\n- è¡Œå†…å—å…ƒç´ ï¼ˆå…ƒç´ çš„ [`display`](https://developer.mozilla.org/zh-CN/docs/Web/CSS/display) ä¸º `inline-block`ï¼‰\n- è¡¨æ ¼å•å…ƒæ ¼ï¼ˆå…ƒç´ çš„ [`display`](https://developer.mozilla.org/zh-CN/docs/Web/CSS/display) ä¸º `table-cell`ï¼ŒHTMLè¡¨æ ¼å•å…ƒæ ¼é»˜è®¤ä¸ºè¯¥å€¼ï¼‰\n- è¡¨æ ¼æ ‡é¢˜ï¼ˆå…ƒç´ çš„ [`display`](https://developer.mozilla.org/zh-CN/docs/Web/CSS/display) ä¸º `table-caption`ï¼ŒHTMLè¡¨æ ¼æ ‡é¢˜é»˜è®¤ä¸ºè¯¥å€¼ï¼‰\n- åŒ¿åè¡¨æ ¼å•å…ƒæ ¼å…ƒç´ ï¼ˆå…ƒç´ çš„ [`display`](https://developer.mozilla.org/zh-CN/docs/Web/CSS/display) ä¸º `tableã€``table-row`ã€ `table-row-groupã€``table-header-groupã€``table-footer-group`ï¼ˆåˆ†åˆ«æ˜¯HTML tableã€rowã€tbodyã€theadã€tfoot çš„é»˜è®¤å±æ€§ï¼‰æˆ– `inline-table`ï¼‰\n- [`overflow`](https://developer.mozilla.org/zh-CN/docs/Web/CSS/overflow) å€¼ä¸ä¸º `visible` çš„å—å…ƒç´ \n- [`display`](https://developer.mozilla.org/zh-CN/docs/Web/CSS/display) å€¼ä¸º `flow-root` çš„å…ƒç´ \n- [`contain`](https://developer.mozilla.org/zh-CN/docs/Web/CSS/contain) å€¼ä¸º `layout`ã€`content `æˆ– paint çš„å…ƒç´ \n- å¼¹æ€§å…ƒç´ ï¼ˆ[`display`](https://developer.mozilla.org/zh-CN/docs/Web/CSS/display) ä¸º `flex` æˆ– `inline-flex `å…ƒç´ çš„ç›´æ¥å­å…ƒç´ ï¼‰\n- ç½‘æ ¼å…ƒç´ ï¼ˆ[`display`](https://developer.mozilla.org/zh-CN/docs/Web/CSS/display) ä¸º `grid` æˆ– `inline-grid` å…ƒç´ çš„ç›´æ¥å­å…ƒç´ ï¼‰\n- å¤šåˆ—å®¹å™¨ï¼ˆå…ƒç´ çš„ [`column-count`](https://developer.mozilla.org/zh-CN/docs/Web/CSS/column-count) æˆ– [`column-width`](https://developer.mozilla.org/zh-CN/docs/Web/CSS/column-width) ä¸ä¸º `autoï¼ŒåŒ…æ‹¬ ``column-count` ä¸º `1`ï¼‰\n- `column-span` ä¸º `all` çš„å…ƒç´ å§‹ç»ˆä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„BFCï¼Œå³ä½¿è¯¥å…ƒç´ æ²¡æœ‰åŒ…è£¹åœ¨ä¸€ä¸ªå¤šåˆ—å®¹å™¨ä¸­ï¼ˆ[æ ‡å‡†å˜æ›´](https://github.com/w3c/csswg-drafts/commit/a8634b96900279916bd6c505fda88dda71d8ec51)ï¼Œ[Chrome bug](https://bugs.chromium.org/p/chromium/issues/detail?id=709362)ï¼‰ã€‚\n\n\n\n### BFCå¯ä»¥åšäº›ä»€ä¹ˆï¼Ÿ\n\n#### è®©æµ®åŠ¨å†…å®¹å’Œå‘¨å›´çš„å†…å®¹ç­‰é«˜\n\n\n\nğŸŒ°ï¼š\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n<style>\n.box {\n    background-color: rgb(224, 206, 247);\n    border: 5px solid rebeccapurple;\n}\n\n.float {\n    float: left;\n    width: 200px;\n    height: 150px;\n    background-color: white;\n    border:1px solid black;\n    padding: 10px;\n}      \n</style>\n</head>\n<body>\n\n<div class=\"box\">\n    <div class=\"float\">I am a floated box!</div>\n    <p>I am content inside the container.</p>\n</div>\n\n<p>This is some text outside the div element.</p>\n\n</body>\n</html>\n\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œé‚£ä¸ªfloatæŠŠåº•ä¸‹çš„divç›–ä½äº†ã€‚\n\næˆ‘ä»¬éšä¾¿å¼„ä¸€ä¸ªBFCçš„ç‰¹æ€§ä¸­çš„ä¸€æ¡ï¼š[`overflow`](https://developer.mozilla.org/zh-CN/docs/Web/CSS/overflow) å€¼ä¸ä¸º `visible` çš„å—å…ƒç´ ã€‚\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n<style>\n.box {\n    background-color: rgb(224, 206, 247);\n    border: 5px solid rebeccapurple;\n    overflow: auto;\n}\n\n.float {\n    float: left;\n    width: 200px;\n    height: 150px;\n    background-color: white;\n    border:1px solid black;\n    padding: 10px;\n}          \n</style>\n</head>\n<body>\n\n<div class=\"box\">\n    <div class=\"float\">I am a floated box!</div>\n    <p>I am content inside the container.</p>\n</div>\n\n<p>This is some text outside the div element.</p>\n\n</body>\n</html>\n\n```\n\né‚£å°±è®¾ç½®æˆ`auto`å§~\n\næœ‰æ²¡æœ‰å¾ˆç¥å¥‡çš„å‘ç°ï¼ï¼ï¼\n\nå†å‘Šè¯‰å¤§å®¶ä¸€ä¸ªé»‘ç§‘æŠ€ï¼šè¡¨æ ¼æ ‡é¢˜ï¼ˆå…ƒç´ çš„ [`display`](https://developer.mozilla.org/zh-CN/docs/Web/CSS/display) ä¸º `table-caption`ï¼ŒHTMLè¡¨æ ¼æ ‡é¢˜é»˜è®¤ä¸ºè¯¥å€¼ï¼‰ã€‚è¿™ä¸ªæ˜¯æ²¡æœ‰å‰¯ä½œç”¨çš„å“¦ã€‚\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n<style>\n.box {\n    background-color: rgb(224, 206, 247);\n    border: 5px solid rebeccapurple;\n    display: table-caption;\n}\n\n.float {\n    float: left;\n    width: 200px;\n    height: 150px;\n    background-color: white;\n    border:1px solid black;\n    padding: 10px;\n}          \n</style>\n</head>\n<body>\n\n<div class=\"box\">\n    <div class=\"float\">I am a floated box!</div>\n    <p>I am content inside the container.</p>\n</div>\n\n<p>This is some text outside the div element.</p>\n\n</body>\n</html>\n\n```\n\nç»™ `<div>` `display: flow-root` å±æ€§åï¼Œ`<div>` ä¸­çš„æ‰€æœ‰å†…å®¹éƒ½ä¼šå‚ä¸ BFCï¼Œæµ®åŠ¨çš„å†…å®¹ä¸ä¼šä»åº•éƒ¨æº¢å‡ºã€‚\n\nå…³äºå€¼ `flow-root `çš„è¿™ä¸ªåå­—ï¼Œå½“ä½ æ˜ç™½ä½ å®é™…ä¸Šæ˜¯åœ¨åˆ›å»ºä¸€ä¸ªè¡Œä¸ºç±»ä¼¼äºæ ¹å…ƒç´  ï¼ˆæµè§ˆå™¨ä¸­çš„`<html>`å…ƒç´ ï¼‰ çš„ä¸œè¥¿æ—¶ï¼Œå°±èƒ½å‘ç°è¿™ä¸ªåå­—çš„æ„ä¹‰äº†â€”â€”å³åˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œé‡Œé¢å°†è¿›è¡Œ flow layoutã€‚\n\n#### å¤–è¾¹è·å¡Œé™·\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n<style>\n.blue{\n  height: 50px;\n  margin: 50px 0;\n} \n.red-inner {\n  height: 50px;\n  margin: 50px 0;\n}\n\n.blue {\n  background: blue;\n}\n\n.red-outer {\n  overflow: hidden;\n  background: red;\n}        \n</style>\n</head>\n<body>\n<div class=\"blue\"></div>\n<div class=\"red-outer\">\n  <div class=\"red-inner\">red inner</div>\n</div>\n</body>\n</html>\n\n```\n\næ„å¤–çš„å‘ç°ï¼Œæˆ‘ä»¬ä¸¤ä¸ªmarginéƒ½æ˜¯50pxï¼Œç†è®ºä¸Šåº”è¯¥æ˜¯100pxå•Šï¼Œå¯æ˜¯çœ‹èµ·æ¥æ€ä¹ˆåªæœ‰50pxçš„æ ·å­ã€‚ã€‚ã€‚\n\né¦–å…ˆè¿™ä¸æ˜¯ CSS çš„ bugï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºä¸€ç§è§„èŒƒï¼Œ**å¦‚æœæƒ³è¦é¿å…å¤–è¾¹è·çš„é‡å ï¼Œå¯ä»¥å°†å…¶æ”¾åœ¨ä¸åŒçš„ BFC å®¹å™¨ä¸­ã€‚**\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n<style>\n.container {\n    overflow: hidden;\n}\np {\n    width: 100px;\n    height: 100px;\n    background: lightblue;\n    margin: 100px;\n}       \n</style>\n</head>\n<body>\n<div class=\"container\">\n    <p></p>\n</div>\n<div class=\"container\">\n    <p></p>\n</div>\n\n</body>\n</html>\n\n\n```\n\nè¿™æ—¶å€™ï¼Œä¸¤ä¸ªç›’å­è¾¹è·å°±å˜æˆäº† 200px\n\n### BFCçš„çº¦æŸæ¡ä»¶\n\n- å†…éƒ¨çš„Boxä¼šåœ¨å‚ç›´æ–¹å‘ä¸Šä¸€ä¸ªæ¥ä¸€ä¸ªçš„æ”¾ç½®\n- å‚ç›´æ–¹å‘ä¸Šçš„è·ç¦»ç”±marginå†³å®šã€‚ï¼ˆå®Œæ•´çš„è¯´æ³•æ˜¯ï¼šå±äºåŒä¸€ä¸ªBFCçš„ä¸¤ä¸ªç›¸é‚»Boxçš„marginä¼šå‘ç”Ÿé‡å ï¼ˆå¡Œé™·ï¼‰ï¼Œä¸æ–¹å‘æ— å…³ã€‚ï¼‰\n- æ¯ä¸ªå…ƒç´ çš„å·¦å¤–è¾¹è·ä¸åŒ…å«å—çš„å·¦è¾¹ç•Œç›¸æ¥è§¦ï¼ˆä»å·¦å‘å³ï¼‰ï¼Œå³ä½¿æµ®åŠ¨å…ƒç´ ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ï¼ˆè¿™è¯´æ˜BFCä¸­å­å…ƒç´ ä¸ä¼šè¶…å‡ºä»–çš„åŒ…å«å—ï¼Œè€Œpositionä¸ºabsoluteçš„å…ƒç´ å¯ä»¥è¶…å‡ºä»–çš„åŒ…å«å—è¾¹ç•Œï¼‰\n- BFCçš„åŒºåŸŸä¸ä¼šä¸floatçš„å…ƒç´ åŒºåŸŸé‡å \n- è®¡ç®—BFCçš„é«˜åº¦æ—¶ï¼Œæµ®åŠ¨å­å…ƒç´ ä¹Ÿå‚ä¸è®¡ç®—\n- BFCå°±æ˜¯é¡µé¢ä¸Šçš„ä¸€ä¸ªéš”ç¦»çš„ç‹¬ç«‹å®¹å™¨ï¼Œå®¹å™¨é‡Œé¢çš„å­å…ƒç´ ä¸ä¼šå½±å“åˆ°å¤–é¢å…ƒç´ ï¼Œåä¹‹äº¦ç„¶\n\n\n\n## è¡¥å……\n\n### **IFC**\n\n> IFC(Inline Formatting Contexts)ç›´è¯‘ä¸º\"å†…è”æ ¼å¼åŒ–ä¸Šä¸‹æ–‡\"ï¼ŒIFCçš„line boxï¼ˆçº¿æ¡†ï¼‰é«˜åº¦ç”±å…¶åŒ…å«è¡Œå†…å…ƒç´ ä¸­æœ€é«˜çš„å®é™…é«˜åº¦è®¡ç®—è€Œæ¥ï¼ˆä¸å—åˆ°ç«–ç›´æ–¹å‘çš„padding/marginå½±å“)\n> IFCä¸­çš„line boxä¸€èˆ¬å·¦å³éƒ½è´´ç´§æ•´ä¸ªIFCï¼Œä½†æ˜¯ä¼šå› ä¸ºfloatå…ƒç´ è€Œæ‰°ä¹±ã€‚floatå…ƒç´ ä¼šä½äºIFCä¸ä¸line boxä¹‹é—´ï¼Œä½¿å¾—line boxå®½åº¦ç¼©çŸ­ã€‚ åŒä¸ªifcä¸‹çš„å¤šä¸ªline boxé«˜åº¦ä¼šä¸åŒã€‚ IFCä¸­æ—¶ä¸å¯èƒ½æœ‰å—çº§å…ƒç´ çš„ï¼Œå½“æ’å…¥å—çº§å…ƒç´ æ—¶ï¼ˆå¦‚pä¸­æ’å…¥divï¼‰ä¼šäº§ç”Ÿä¸¤ä¸ªåŒ¿åå—ä¸divåˆ†éš”å¼€ï¼Œå³äº§ç”Ÿä¸¤ä¸ªIFCï¼Œæ¯ä¸ªIFCå¯¹å¤–è¡¨ç°ä¸ºå—çº§å…ƒç´ ï¼Œä¸divå‚ç›´æ’åˆ—ã€‚\n> é‚£ä¹ˆIFCä¸€èˆ¬æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ\n> æ°´å¹³å±…ä¸­ï¼šå½“ä¸€ä¸ªå—è¦åœ¨ç¯å¢ƒä¸­æ°´å¹³å±…ä¸­æ—¶ï¼Œè®¾ç½®å…¶ä¸ºinline-blockåˆ™ä¼šåœ¨å¤–å±‚äº§ç”ŸIFCï¼Œé€šè¿‡text-alignåˆ™å¯ä»¥ä½¿å…¶æ°´å¹³å±…ä¸­ã€‚\n> å‚ç›´å±…ä¸­ï¼šåˆ›å»ºä¸€ä¸ªIFCï¼Œç”¨å…¶ä¸­ä¸€ä¸ªå…ƒç´ æ’‘å¼€çˆ¶å…ƒç´ çš„é«˜åº¦ï¼Œç„¶åè®¾ç½®å…¶vertical-align:middleï¼Œå…¶ä»–è¡Œå†…å…ƒç´ åˆ™å¯ä»¥åœ¨æ­¤çˆ¶å…ƒç´ ä¸‹å‚ç›´å±…ä¸­ã€‚\n\n###  GFC\n\n> **GFC**\n> GFC(GridLayout Formatting Contexts)ç›´è¯‘ä¸º\"ç½‘æ ¼å¸ƒå±€æ ¼å¼åŒ–ä¸Šä¸‹æ–‡\"ï¼Œå½“ä¸ºä¸€ä¸ªå…ƒç´ è®¾ç½®displayå€¼ä¸ºgridçš„æ—¶å€™ï¼Œæ­¤å…ƒç´ å°†ä¼šè·å¾—ä¸€ä¸ªç‹¬ç«‹çš„æ¸²æŸ“åŒºåŸŸï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ç½‘æ ¼å®¹å™¨ï¼ˆgrid containerï¼‰ä¸Šå®šä¹‰ç½‘æ ¼å®šä¹‰è¡Œï¼ˆgrid definition rowsï¼‰å’Œç½‘æ ¼å®šä¹‰åˆ—ï¼ˆgrid definition columnsï¼‰å±æ€§å„åœ¨ç½‘æ ¼é¡¹ç›®ï¼ˆgrid itemï¼‰ä¸Šå®šä¹‰ç½‘æ ¼è¡Œï¼ˆgrid rowï¼‰å’Œç½‘æ ¼åˆ—ï¼ˆgrid columnsï¼‰ä¸ºæ¯ä¸€ä¸ªç½‘æ ¼é¡¹ç›®ï¼ˆgrid itemï¼‰å®šä¹‰ä½ç½®å’Œç©ºé—´ã€‚ \n> é‚£ä¹ˆGFCæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Œå’Œtableåˆæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿé¦–å…ˆåŒæ ·æ˜¯ä¸€ä¸ªäºŒç»´çš„è¡¨æ ¼ï¼Œä½†GridLayoutä¼šæœ‰æ›´åŠ ä¸°å¯Œçš„å±æ€§æ¥æ§åˆ¶è¡Œåˆ—ï¼Œæ§åˆ¶å¯¹é½ä»¥åŠæ›´ä¸ºç²¾ç»†çš„æ¸²æŸ“è¯­ä¹‰å’Œæ§åˆ¶ã€‚\n\n### FFC\n\n> **FFC**\n> FFC(Flex Formatting Contexts)ç›´è¯‘ä¸º\"è‡ªé€‚åº”æ ¼å¼åŒ–ä¸Šä¸‹æ–‡\"ï¼Œdisplayå€¼ä¸ºflexæˆ–è€…inline-flexçš„å…ƒç´ å°†ä¼šç”Ÿæˆè‡ªé€‚åº”å®¹å™¨ï¼ˆflex containerï¼‰ï¼Œå¯æƒœè¿™ä¸ªç‰›é€¼çš„å±æ€§åªæœ‰è°·æ­Œå’Œç«ç‹æ”¯æŒï¼Œä¸è¿‡åœ¨ç§»åŠ¨ç«¯ä¹Ÿè¶³å¤Ÿäº†ï¼Œè‡³å°‘safariå’Œchromeè¿˜æ˜¯OKçš„ï¼Œæ¯•ç«Ÿè¿™ä¿©åœ¨ç§»åŠ¨ç«¯æ‰æ˜¯ç‹é“ã€‚\n> Flex Box ç”±ä¼¸ç¼©å®¹å™¨å’Œä¼¸ç¼©é¡¹ç›®ç»„æˆã€‚é€šè¿‡è®¾ç½®å…ƒç´ çš„ display å±æ€§ä¸º flex æˆ– inline-flex å¯ä»¥å¾—åˆ°ä¸€ä¸ªä¼¸ç¼©å®¹å™¨ã€‚è®¾ç½®ä¸º flex çš„å®¹å™¨è¢«æ¸²æŸ“ä¸ºä¸€ä¸ªå—çº§å…ƒç´ ï¼Œè€Œè®¾ç½®ä¸º inline-flex çš„å®¹å™¨åˆ™æ¸²æŸ“ä¸ºä¸€ä¸ªè¡Œå†…å…ƒç´ ã€‚\n> ä¼¸ç¼©å®¹å™¨ä¸­çš„æ¯ä¸€ä¸ªå­å…ƒç´ éƒ½æ˜¯ä¸€ä¸ªä¼¸ç¼©é¡¹ç›®ã€‚ä¼¸ç¼©é¡¹ç›®å¯ä»¥æ˜¯ä»»æ„æ•°é‡çš„ã€‚ä¼¸ç¼©å®¹å™¨å¤–å’Œä¼¸ç¼©é¡¹ç›®å†…çš„ä¸€åˆ‡å…ƒç´ éƒ½ä¸å—å½±å“ã€‚ç®€å•åœ°è¯´ï¼ŒFlexbox å®šä¹‰äº†ä¼¸ç¼©å®¹å™¨å†…ä¼¸ç¼©é¡¹ç›®è¯¥å¦‚ä½•å¸ƒå±€ã€‚\n\n\n\n","source":"_posts/ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC.md","raw":"---\ntitle: ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC\ndate: 2020-08-12 18:03:34\ntags: [CSS]\ncategory: [é‡æ‹¾å‰ç«¯]\ncover: /image/cover/web.jpeg\n---\n\n\næœ€è¿‘åœ¨å†™ã€é‡æ‹¾å‰ç«¯ã€‘ç³»åˆ—ï¼Œä¸‹é¢æœ‰å‡ ä¸ªå¿«é€Ÿé€šé“ï¼Œå¤§å®¶è‡ªå–\n\n[ã€é‡è¯†å‰ç«¯ã€‘åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿](https://juejin.im/post/6850418113944420359)\n\n[ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—](https://juejin.im/post/6850418117508759566)\n\n[ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this](https://juejin.im/post/6854573215658803208)\n\n[ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šJavaScriptçš„æ‰§è¡Œæœºåˆ¶](https://juejin.im/post/6859911609633767438)\n\n[ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC](https://juejin.im/post/6860375101322461198)\n\n[ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ](https://juejin.im/post/6865204092877144077)\n\n## å‰è¨€\n\nå…¶å®åœ¨é¢è¯•çš„è¿‡ç¨‹ä¸­å¾ˆæœ‰å¯èƒ½ä¼šè¢«é—®åˆ°â€œä»‹ç»ä¸€ä¸‹BFCâ€\n\né‚£ä»Šå¤©å°±ä¸€å£æ°”æŠŠBFCã€IFCã€GFC å’Œ FFCè¿™å››å…„å¼Ÿç»™åƒé€\n\nåƒé€é€\n\né‡ç‚¹ä»‹ç»ä¸€ä¸‹BFCï¼Œä»–çš„ä¸‰å…„å¼Ÿè¿™é‡Œåªåšä»‹ç»ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥ä¸Šç½‘å¤šæŸ¥æŸ¥èµ„æ–™ç„¶åå›æ¥æ•™æ•™æˆ‘ğŸ˜‚\n\n## å¼€å§‹\n\n### what\n\nå…¶å®åœ¨è¯´BFCå’Œä»–çš„ä¸‰å…„å¼Ÿä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ï¼Œä»€ä¹ˆæ˜¯FCï¼Ÿ\n\næ‰“æ–­ä¸€ä¸‹ã€‚è¯´FCä¹‹å‰æˆ‘å¸Œæœ›å…ˆè¯´ä¸€ä¸‹BOX\n\n#### BOX\n\nä¸€ä¸ªé¡µé¢æ˜¯ç”±å¾ˆå¤šå…ƒç´ ç»„æˆçš„ï¼Œè€Œè¿™äº›å…ƒç´ éƒ½æ˜¯ä¸€ä¸ªæ¥ä¸€ä¸ªç›’å­ã€‚é‚£æœ‰äººå°±è¯´äº†ï¼Œé‚£`border-radius: 50%`æï¼Ÿ\n\nOk, ç›´æ¥çœ‹ä¸‹å›¾å§ï¼š\n\n![demo1-1](/image/BFC/1.png)\n\nå†æ¥çœ‹ä¸€ä¸ªæ›´ç›´è§‚çš„å›¾ã€‚æ‰“å¼€Googleçš„é¦–é¡µï¼Œç„¶ååœ¨æ§åˆ¶å°è¾“å…¥\n\n```js\n[].forEach.call(document.querySelectorAll('*'), function(a){a.style.outline = \"1px solid red\";})\n```\n\n![demo2](/image/BFC/2.png)\n\næ‰€ä»¥ï¼Œå…¶å®é¡µé¢éƒ½æ˜¯ç”±ä¸€ä¸ªåˆä¸€ä¸ªçš„ç›’å­ç»„åˆè€Œæˆçš„ã€‚\n\næ˜ç¡®äº†è¿™ä¸ªï¼Œæˆ‘ä»¬å†æ¥è¯´è¯´FCæ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ã€‚\n\n#### FCï¼ˆFormatting Contextï¼‰\n\nå®ƒæ˜¯W3C CSS2.1è§„èŒƒä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼Œå®šä¹‰çš„æ˜¯é¡µé¢ä¸­çš„ä¸€å—æ¸²æŸ“åŒºåŸŸï¼Œå¹¶ä¸”æœ‰ä¸€å¥—æ¸²æŸ“è§„åˆ™ï¼Œå®ƒ**å†³å®šäº†å…¶å­å…ƒç´ å°†å¦‚ä½•å®šä½**ï¼Œä»¥åŠ**å’Œå…¶ä»–å…ƒç´ çš„å…³ç³»å’Œç›¸äº’ä½œç”¨**ã€‚\n\nå¸¸è§çš„`Formatting Context` æœ‰ï¼š`Block Formatting Context`ï¼ˆBFC | å—çº§æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼‰ å’Œ `Inline Formatting Context`ï¼ˆIFC |è¡Œå†…æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼‰ã€‚\n\n#### BFC\n\n> MDN: **å—æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼ˆBlock Formatting Contextï¼ŒBFCï¼‰** æ˜¯Webé¡µé¢çš„å¯è§†CSSæ¸²æŸ“çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯å—ç›’å­çš„å¸ƒå±€è¿‡ç¨‹å‘ç”Ÿçš„åŒºåŸŸï¼Œä¹Ÿæ˜¯æµ®åŠ¨å…ƒç´ ä¸å…¶ä»–å…ƒç´ äº¤äº’çš„åŒºåŸŸã€‚\n\n\n\n### why\n\né‚£ä¹ˆFCå››å…„å¼Ÿä»–ä»¬çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿå¯ä¸å¯ä»¥ä¸è¦ä»–ä»¬ï¼Ÿ\n\nå…¶å®ï¼Œæˆ‘ä»¬æ¢ä¸ªè§’åº¦æƒ³æƒ³å°±ä¼šèˆ’æœå¾ˆå¤šã€‚æ¯”å¦‚æˆ‘ä»¬å¼€è½¦ä¸Šè·¯ï¼Œå¦‚æœæ²¡æœ‰ğŸš¦ï¼Œé‚£ä¹ˆè·¯å†µå¯èƒ½ä¼šå˜å¾—å¾ˆç³Ÿï¼Œä¸åŒçš„è·¯å£çš„ğŸš¦çš„çº¢ç¯ç»¿ç¯æ—¶é—´éƒ½æ˜¯ç»è¿‡ç²¾å¿ƒè®¾è®¡çš„ï¼Œæ¯”å¦‚è½¦å¤šçš„æ–¹å‘ï¼Œçº¢ç¯æ—¶é—´å°±å°‘ä¸€äº›ï¼Œç»¿ç¯å¤šä¸€äº›ã€‚å¤§å®¶éƒ½æ˜¯ä¸ºäº†è®©è·¯å†µå˜å¾—æ›´å¥½ã€‚\n\nåè§‚FCå››å…„å¼Ÿï¼Œä»–ä»¬ä¹Ÿæ˜¯ä¸ºäº†è®©ä¸åŒæƒ…å†µä¸‹çš„CSSå¯ä»¥æ›´æœ‰ç§©åºçš„æ˜¾ç¤ºã€‚\n\n\n\n### how\n\né‚£ä¹ˆæˆ‘è¦æ€ä¹ˆæ ·æ‰å¯ä»¥åˆ¶é€ ä¸€ä¸ªBFCï¼Ÿ\n\n- æ ¹å…ƒç´ ï¼ˆ`<html>ï¼‰`\n- æµ®åŠ¨å…ƒç´ ï¼ˆå…ƒç´ çš„ [`float`](https://developer.mozilla.org/zh-CN/docs/Web/CSS/float) ä¸æ˜¯ `none`ï¼‰\n- ç»å¯¹å®šä½å…ƒç´ ï¼ˆå…ƒç´ çš„ [`position`](https://developer.mozilla.org/zh-CN/docs/Web/CSS/position) ä¸º `absolute` æˆ– `fixed`ï¼‰\n- è¡Œå†…å—å…ƒç´ ï¼ˆå…ƒç´ çš„ [`display`](https://developer.mozilla.org/zh-CN/docs/Web/CSS/display) ä¸º `inline-block`ï¼‰\n- è¡¨æ ¼å•å…ƒæ ¼ï¼ˆå…ƒç´ çš„ [`display`](https://developer.mozilla.org/zh-CN/docs/Web/CSS/display) ä¸º `table-cell`ï¼ŒHTMLè¡¨æ ¼å•å…ƒæ ¼é»˜è®¤ä¸ºè¯¥å€¼ï¼‰\n- è¡¨æ ¼æ ‡é¢˜ï¼ˆå…ƒç´ çš„ [`display`](https://developer.mozilla.org/zh-CN/docs/Web/CSS/display) ä¸º `table-caption`ï¼ŒHTMLè¡¨æ ¼æ ‡é¢˜é»˜è®¤ä¸ºè¯¥å€¼ï¼‰\n- åŒ¿åè¡¨æ ¼å•å…ƒæ ¼å…ƒç´ ï¼ˆå…ƒç´ çš„ [`display`](https://developer.mozilla.org/zh-CN/docs/Web/CSS/display) ä¸º `tableã€``table-row`ã€ `table-row-groupã€``table-header-groupã€``table-footer-group`ï¼ˆåˆ†åˆ«æ˜¯HTML tableã€rowã€tbodyã€theadã€tfoot çš„é»˜è®¤å±æ€§ï¼‰æˆ– `inline-table`ï¼‰\n- [`overflow`](https://developer.mozilla.org/zh-CN/docs/Web/CSS/overflow) å€¼ä¸ä¸º `visible` çš„å—å…ƒç´ \n- [`display`](https://developer.mozilla.org/zh-CN/docs/Web/CSS/display) å€¼ä¸º `flow-root` çš„å…ƒç´ \n- [`contain`](https://developer.mozilla.org/zh-CN/docs/Web/CSS/contain) å€¼ä¸º `layout`ã€`content `æˆ– paint çš„å…ƒç´ \n- å¼¹æ€§å…ƒç´ ï¼ˆ[`display`](https://developer.mozilla.org/zh-CN/docs/Web/CSS/display) ä¸º `flex` æˆ– `inline-flex `å…ƒç´ çš„ç›´æ¥å­å…ƒç´ ï¼‰\n- ç½‘æ ¼å…ƒç´ ï¼ˆ[`display`](https://developer.mozilla.org/zh-CN/docs/Web/CSS/display) ä¸º `grid` æˆ– `inline-grid` å…ƒç´ çš„ç›´æ¥å­å…ƒç´ ï¼‰\n- å¤šåˆ—å®¹å™¨ï¼ˆå…ƒç´ çš„ [`column-count`](https://developer.mozilla.org/zh-CN/docs/Web/CSS/column-count) æˆ– [`column-width`](https://developer.mozilla.org/zh-CN/docs/Web/CSS/column-width) ä¸ä¸º `autoï¼ŒåŒ…æ‹¬ ``column-count` ä¸º `1`ï¼‰\n- `column-span` ä¸º `all` çš„å…ƒç´ å§‹ç»ˆä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„BFCï¼Œå³ä½¿è¯¥å…ƒç´ æ²¡æœ‰åŒ…è£¹åœ¨ä¸€ä¸ªå¤šåˆ—å®¹å™¨ä¸­ï¼ˆ[æ ‡å‡†å˜æ›´](https://github.com/w3c/csswg-drafts/commit/a8634b96900279916bd6c505fda88dda71d8ec51)ï¼Œ[Chrome bug](https://bugs.chromium.org/p/chromium/issues/detail?id=709362)ï¼‰ã€‚\n\n\n\n### BFCå¯ä»¥åšäº›ä»€ä¹ˆï¼Ÿ\n\n#### è®©æµ®åŠ¨å†…å®¹å’Œå‘¨å›´çš„å†…å®¹ç­‰é«˜\n\n\n\nğŸŒ°ï¼š\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n<style>\n.box {\n    background-color: rgb(224, 206, 247);\n    border: 5px solid rebeccapurple;\n}\n\n.float {\n    float: left;\n    width: 200px;\n    height: 150px;\n    background-color: white;\n    border:1px solid black;\n    padding: 10px;\n}      \n</style>\n</head>\n<body>\n\n<div class=\"box\">\n    <div class=\"float\">I am a floated box!</div>\n    <p>I am content inside the container.</p>\n</div>\n\n<p>This is some text outside the div element.</p>\n\n</body>\n</html>\n\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œé‚£ä¸ªfloatæŠŠåº•ä¸‹çš„divç›–ä½äº†ã€‚\n\næˆ‘ä»¬éšä¾¿å¼„ä¸€ä¸ªBFCçš„ç‰¹æ€§ä¸­çš„ä¸€æ¡ï¼š[`overflow`](https://developer.mozilla.org/zh-CN/docs/Web/CSS/overflow) å€¼ä¸ä¸º `visible` çš„å—å…ƒç´ ã€‚\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n<style>\n.box {\n    background-color: rgb(224, 206, 247);\n    border: 5px solid rebeccapurple;\n    overflow: auto;\n}\n\n.float {\n    float: left;\n    width: 200px;\n    height: 150px;\n    background-color: white;\n    border:1px solid black;\n    padding: 10px;\n}          \n</style>\n</head>\n<body>\n\n<div class=\"box\">\n    <div class=\"float\">I am a floated box!</div>\n    <p>I am content inside the container.</p>\n</div>\n\n<p>This is some text outside the div element.</p>\n\n</body>\n</html>\n\n```\n\né‚£å°±è®¾ç½®æˆ`auto`å§~\n\næœ‰æ²¡æœ‰å¾ˆç¥å¥‡çš„å‘ç°ï¼ï¼ï¼\n\nå†å‘Šè¯‰å¤§å®¶ä¸€ä¸ªé»‘ç§‘æŠ€ï¼šè¡¨æ ¼æ ‡é¢˜ï¼ˆå…ƒç´ çš„ [`display`](https://developer.mozilla.org/zh-CN/docs/Web/CSS/display) ä¸º `table-caption`ï¼ŒHTMLè¡¨æ ¼æ ‡é¢˜é»˜è®¤ä¸ºè¯¥å€¼ï¼‰ã€‚è¿™ä¸ªæ˜¯æ²¡æœ‰å‰¯ä½œç”¨çš„å“¦ã€‚\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n<style>\n.box {\n    background-color: rgb(224, 206, 247);\n    border: 5px solid rebeccapurple;\n    display: table-caption;\n}\n\n.float {\n    float: left;\n    width: 200px;\n    height: 150px;\n    background-color: white;\n    border:1px solid black;\n    padding: 10px;\n}          \n</style>\n</head>\n<body>\n\n<div class=\"box\">\n    <div class=\"float\">I am a floated box!</div>\n    <p>I am content inside the container.</p>\n</div>\n\n<p>This is some text outside the div element.</p>\n\n</body>\n</html>\n\n```\n\nç»™ `<div>` `display: flow-root` å±æ€§åï¼Œ`<div>` ä¸­çš„æ‰€æœ‰å†…å®¹éƒ½ä¼šå‚ä¸ BFCï¼Œæµ®åŠ¨çš„å†…å®¹ä¸ä¼šä»åº•éƒ¨æº¢å‡ºã€‚\n\nå…³äºå€¼ `flow-root `çš„è¿™ä¸ªåå­—ï¼Œå½“ä½ æ˜ç™½ä½ å®é™…ä¸Šæ˜¯åœ¨åˆ›å»ºä¸€ä¸ªè¡Œä¸ºç±»ä¼¼äºæ ¹å…ƒç´  ï¼ˆæµè§ˆå™¨ä¸­çš„`<html>`å…ƒç´ ï¼‰ çš„ä¸œè¥¿æ—¶ï¼Œå°±èƒ½å‘ç°è¿™ä¸ªåå­—çš„æ„ä¹‰äº†â€”â€”å³åˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œé‡Œé¢å°†è¿›è¡Œ flow layoutã€‚\n\n#### å¤–è¾¹è·å¡Œé™·\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n<style>\n.blue{\n  height: 50px;\n  margin: 50px 0;\n} \n.red-inner {\n  height: 50px;\n  margin: 50px 0;\n}\n\n.blue {\n  background: blue;\n}\n\n.red-outer {\n  overflow: hidden;\n  background: red;\n}        \n</style>\n</head>\n<body>\n<div class=\"blue\"></div>\n<div class=\"red-outer\">\n  <div class=\"red-inner\">red inner</div>\n</div>\n</body>\n</html>\n\n```\n\næ„å¤–çš„å‘ç°ï¼Œæˆ‘ä»¬ä¸¤ä¸ªmarginéƒ½æ˜¯50pxï¼Œç†è®ºä¸Šåº”è¯¥æ˜¯100pxå•Šï¼Œå¯æ˜¯çœ‹èµ·æ¥æ€ä¹ˆåªæœ‰50pxçš„æ ·å­ã€‚ã€‚ã€‚\n\né¦–å…ˆè¿™ä¸æ˜¯ CSS çš„ bugï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºä¸€ç§è§„èŒƒï¼Œ**å¦‚æœæƒ³è¦é¿å…å¤–è¾¹è·çš„é‡å ï¼Œå¯ä»¥å°†å…¶æ”¾åœ¨ä¸åŒçš„ BFC å®¹å™¨ä¸­ã€‚**\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n<style>\n.container {\n    overflow: hidden;\n}\np {\n    width: 100px;\n    height: 100px;\n    background: lightblue;\n    margin: 100px;\n}       \n</style>\n</head>\n<body>\n<div class=\"container\">\n    <p></p>\n</div>\n<div class=\"container\">\n    <p></p>\n</div>\n\n</body>\n</html>\n\n\n```\n\nè¿™æ—¶å€™ï¼Œä¸¤ä¸ªç›’å­è¾¹è·å°±å˜æˆäº† 200px\n\n### BFCçš„çº¦æŸæ¡ä»¶\n\n- å†…éƒ¨çš„Boxä¼šåœ¨å‚ç›´æ–¹å‘ä¸Šä¸€ä¸ªæ¥ä¸€ä¸ªçš„æ”¾ç½®\n- å‚ç›´æ–¹å‘ä¸Šçš„è·ç¦»ç”±marginå†³å®šã€‚ï¼ˆå®Œæ•´çš„è¯´æ³•æ˜¯ï¼šå±äºåŒä¸€ä¸ªBFCçš„ä¸¤ä¸ªç›¸é‚»Boxçš„marginä¼šå‘ç”Ÿé‡å ï¼ˆå¡Œé™·ï¼‰ï¼Œä¸æ–¹å‘æ— å…³ã€‚ï¼‰\n- æ¯ä¸ªå…ƒç´ çš„å·¦å¤–è¾¹è·ä¸åŒ…å«å—çš„å·¦è¾¹ç•Œç›¸æ¥è§¦ï¼ˆä»å·¦å‘å³ï¼‰ï¼Œå³ä½¿æµ®åŠ¨å…ƒç´ ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ï¼ˆè¿™è¯´æ˜BFCä¸­å­å…ƒç´ ä¸ä¼šè¶…å‡ºä»–çš„åŒ…å«å—ï¼Œè€Œpositionä¸ºabsoluteçš„å…ƒç´ å¯ä»¥è¶…å‡ºä»–çš„åŒ…å«å—è¾¹ç•Œï¼‰\n- BFCçš„åŒºåŸŸä¸ä¼šä¸floatçš„å…ƒç´ åŒºåŸŸé‡å \n- è®¡ç®—BFCçš„é«˜åº¦æ—¶ï¼Œæµ®åŠ¨å­å…ƒç´ ä¹Ÿå‚ä¸è®¡ç®—\n- BFCå°±æ˜¯é¡µé¢ä¸Šçš„ä¸€ä¸ªéš”ç¦»çš„ç‹¬ç«‹å®¹å™¨ï¼Œå®¹å™¨é‡Œé¢çš„å­å…ƒç´ ä¸ä¼šå½±å“åˆ°å¤–é¢å…ƒç´ ï¼Œåä¹‹äº¦ç„¶\n\n\n\n## è¡¥å……\n\n### **IFC**\n\n> IFC(Inline Formatting Contexts)ç›´è¯‘ä¸º\"å†…è”æ ¼å¼åŒ–ä¸Šä¸‹æ–‡\"ï¼ŒIFCçš„line boxï¼ˆçº¿æ¡†ï¼‰é«˜åº¦ç”±å…¶åŒ…å«è¡Œå†…å…ƒç´ ä¸­æœ€é«˜çš„å®é™…é«˜åº¦è®¡ç®—è€Œæ¥ï¼ˆä¸å—åˆ°ç«–ç›´æ–¹å‘çš„padding/marginå½±å“)\n> IFCä¸­çš„line boxä¸€èˆ¬å·¦å³éƒ½è´´ç´§æ•´ä¸ªIFCï¼Œä½†æ˜¯ä¼šå› ä¸ºfloatå…ƒç´ è€Œæ‰°ä¹±ã€‚floatå…ƒç´ ä¼šä½äºIFCä¸ä¸line boxä¹‹é—´ï¼Œä½¿å¾—line boxå®½åº¦ç¼©çŸ­ã€‚ åŒä¸ªifcä¸‹çš„å¤šä¸ªline boxé«˜åº¦ä¼šä¸åŒã€‚ IFCä¸­æ—¶ä¸å¯èƒ½æœ‰å—çº§å…ƒç´ çš„ï¼Œå½“æ’å…¥å—çº§å…ƒç´ æ—¶ï¼ˆå¦‚pä¸­æ’å…¥divï¼‰ä¼šäº§ç”Ÿä¸¤ä¸ªåŒ¿åå—ä¸divåˆ†éš”å¼€ï¼Œå³äº§ç”Ÿä¸¤ä¸ªIFCï¼Œæ¯ä¸ªIFCå¯¹å¤–è¡¨ç°ä¸ºå—çº§å…ƒç´ ï¼Œä¸divå‚ç›´æ’åˆ—ã€‚\n> é‚£ä¹ˆIFCä¸€èˆ¬æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ\n> æ°´å¹³å±…ä¸­ï¼šå½“ä¸€ä¸ªå—è¦åœ¨ç¯å¢ƒä¸­æ°´å¹³å±…ä¸­æ—¶ï¼Œè®¾ç½®å…¶ä¸ºinline-blockåˆ™ä¼šåœ¨å¤–å±‚äº§ç”ŸIFCï¼Œé€šè¿‡text-alignåˆ™å¯ä»¥ä½¿å…¶æ°´å¹³å±…ä¸­ã€‚\n> å‚ç›´å±…ä¸­ï¼šåˆ›å»ºä¸€ä¸ªIFCï¼Œç”¨å…¶ä¸­ä¸€ä¸ªå…ƒç´ æ’‘å¼€çˆ¶å…ƒç´ çš„é«˜åº¦ï¼Œç„¶åè®¾ç½®å…¶vertical-align:middleï¼Œå…¶ä»–è¡Œå†…å…ƒç´ åˆ™å¯ä»¥åœ¨æ­¤çˆ¶å…ƒç´ ä¸‹å‚ç›´å±…ä¸­ã€‚\n\n###  GFC\n\n> **GFC**\n> GFC(GridLayout Formatting Contexts)ç›´è¯‘ä¸º\"ç½‘æ ¼å¸ƒå±€æ ¼å¼åŒ–ä¸Šä¸‹æ–‡\"ï¼Œå½“ä¸ºä¸€ä¸ªå…ƒç´ è®¾ç½®displayå€¼ä¸ºgridçš„æ—¶å€™ï¼Œæ­¤å…ƒç´ å°†ä¼šè·å¾—ä¸€ä¸ªç‹¬ç«‹çš„æ¸²æŸ“åŒºåŸŸï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ç½‘æ ¼å®¹å™¨ï¼ˆgrid containerï¼‰ä¸Šå®šä¹‰ç½‘æ ¼å®šä¹‰è¡Œï¼ˆgrid definition rowsï¼‰å’Œç½‘æ ¼å®šä¹‰åˆ—ï¼ˆgrid definition columnsï¼‰å±æ€§å„åœ¨ç½‘æ ¼é¡¹ç›®ï¼ˆgrid itemï¼‰ä¸Šå®šä¹‰ç½‘æ ¼è¡Œï¼ˆgrid rowï¼‰å’Œç½‘æ ¼åˆ—ï¼ˆgrid columnsï¼‰ä¸ºæ¯ä¸€ä¸ªç½‘æ ¼é¡¹ç›®ï¼ˆgrid itemï¼‰å®šä¹‰ä½ç½®å’Œç©ºé—´ã€‚ \n> é‚£ä¹ˆGFCæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Œå’Œtableåˆæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿé¦–å…ˆåŒæ ·æ˜¯ä¸€ä¸ªäºŒç»´çš„è¡¨æ ¼ï¼Œä½†GridLayoutä¼šæœ‰æ›´åŠ ä¸°å¯Œçš„å±æ€§æ¥æ§åˆ¶è¡Œåˆ—ï¼Œæ§åˆ¶å¯¹é½ä»¥åŠæ›´ä¸ºç²¾ç»†çš„æ¸²æŸ“è¯­ä¹‰å’Œæ§åˆ¶ã€‚\n\n### FFC\n\n> **FFC**\n> FFC(Flex Formatting Contexts)ç›´è¯‘ä¸º\"è‡ªé€‚åº”æ ¼å¼åŒ–ä¸Šä¸‹æ–‡\"ï¼Œdisplayå€¼ä¸ºflexæˆ–è€…inline-flexçš„å…ƒç´ å°†ä¼šç”Ÿæˆè‡ªé€‚åº”å®¹å™¨ï¼ˆflex containerï¼‰ï¼Œå¯æƒœè¿™ä¸ªç‰›é€¼çš„å±æ€§åªæœ‰è°·æ­Œå’Œç«ç‹æ”¯æŒï¼Œä¸è¿‡åœ¨ç§»åŠ¨ç«¯ä¹Ÿè¶³å¤Ÿäº†ï¼Œè‡³å°‘safariå’Œchromeè¿˜æ˜¯OKçš„ï¼Œæ¯•ç«Ÿè¿™ä¿©åœ¨ç§»åŠ¨ç«¯æ‰æ˜¯ç‹é“ã€‚\n> Flex Box ç”±ä¼¸ç¼©å®¹å™¨å’Œä¼¸ç¼©é¡¹ç›®ç»„æˆã€‚é€šè¿‡è®¾ç½®å…ƒç´ çš„ display å±æ€§ä¸º flex æˆ– inline-flex å¯ä»¥å¾—åˆ°ä¸€ä¸ªä¼¸ç¼©å®¹å™¨ã€‚è®¾ç½®ä¸º flex çš„å®¹å™¨è¢«æ¸²æŸ“ä¸ºä¸€ä¸ªå—çº§å…ƒç´ ï¼Œè€Œè®¾ç½®ä¸º inline-flex çš„å®¹å™¨åˆ™æ¸²æŸ“ä¸ºä¸€ä¸ªè¡Œå†…å…ƒç´ ã€‚\n> ä¼¸ç¼©å®¹å™¨ä¸­çš„æ¯ä¸€ä¸ªå­å…ƒç´ éƒ½æ˜¯ä¸€ä¸ªä¼¸ç¼©é¡¹ç›®ã€‚ä¼¸ç¼©é¡¹ç›®å¯ä»¥æ˜¯ä»»æ„æ•°é‡çš„ã€‚ä¼¸ç¼©å®¹å™¨å¤–å’Œä¼¸ç¼©é¡¹ç›®å†…çš„ä¸€åˆ‡å…ƒç´ éƒ½ä¸å—å½±å“ã€‚ç®€å•åœ°è¯´ï¼ŒFlexbox å®šä¹‰äº†ä¼¸ç¼©å®¹å™¨å†…ä¼¸ç¼©é¡¹ç›®è¯¥å¦‚ä½•å¸ƒå±€ã€‚\n\n\n\n","slug":"ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC","published":1,"updated":"2021-06-24T14:00:06.851Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra8n001ulwrd5dv7hesr","content":"<p>æœ€è¿‘åœ¨å†™ã€é‡æ‹¾å‰ç«¯ã€‘ç³»åˆ—ï¼Œä¸‹é¢æœ‰å‡ ä¸ªå¿«é€Ÿé€šé“ï¼Œå¤§å®¶è‡ªå–</p>\n<p><a href=\"https://juejin.im/post/6850418113944420359\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿</a></p>\n<p><a href=\"https://juejin.im/post/6850418117508759566\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—</a></p>\n<p><a href=\"https://juejin.im/post/6854573215658803208\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this</a></p>\n<p><a href=\"https://juejin.im/post/6859911609633767438\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šJavaScriptçš„æ‰§è¡Œæœºåˆ¶</a></p>\n<p><a href=\"https://juejin.im/post/6860375101322461198\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC</a></p>\n<p><a href=\"https://juejin.im/post/6865204092877144077\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ</a></p>\n<h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><p>å…¶å®åœ¨é¢è¯•çš„è¿‡ç¨‹ä¸­å¾ˆæœ‰å¯èƒ½ä¼šè¢«é—®åˆ°â€œä»‹ç»ä¸€ä¸‹BFCâ€</p>\n<p>é‚£ä»Šå¤©å°±ä¸€å£æ°”æŠŠBFCã€IFCã€GFC å’Œ FFCè¿™å››å…„å¼Ÿç»™åƒé€</p>\n<p>åƒé€é€</p>\n<p>é‡ç‚¹ä»‹ç»ä¸€ä¸‹BFCï¼Œä»–çš„ä¸‰å…„å¼Ÿè¿™é‡Œåªåšä»‹ç»ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥ä¸Šç½‘å¤šæŸ¥æŸ¥èµ„æ–™ç„¶åå›æ¥æ•™æ•™æˆ‘ğŸ˜‚</p>\n<h2 id=\"å¼€å§‹\"><a href=\"#å¼€å§‹\" class=\"headerlink\" title=\"å¼€å§‹\"></a>å¼€å§‹</h2><h3 id=\"what\"><a href=\"#what\" class=\"headerlink\" title=\"what\"></a>what</h3><p>å…¶å®åœ¨è¯´BFCå’Œä»–çš„ä¸‰å…„å¼Ÿä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ï¼Œä»€ä¹ˆæ˜¯FCï¼Ÿ</p>\n<p>æ‰“æ–­ä¸€ä¸‹ã€‚è¯´FCä¹‹å‰æˆ‘å¸Œæœ›å…ˆè¯´ä¸€ä¸‹BOX</p>\n<h4 id=\"BOX\"><a href=\"#BOX\" class=\"headerlink\" title=\"BOX\"></a>BOX</h4><p>ä¸€ä¸ªé¡µé¢æ˜¯ç”±å¾ˆå¤šå…ƒç´ ç»„æˆçš„ï¼Œè€Œè¿™äº›å…ƒç´ éƒ½æ˜¯ä¸€ä¸ªæ¥ä¸€ä¸ªç›’å­ã€‚é‚£æœ‰äººå°±è¯´äº†ï¼Œé‚£<code>border-radius: 50%</code>æï¼Ÿ</p>\n<p>Ok, ç›´æ¥çœ‹ä¸‹å›¾å§ï¼š</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/BFC/1.png\"  alt=\"demo1-1\"></p>\n<p>å†æ¥çœ‹ä¸€ä¸ªæ›´ç›´è§‚çš„å›¾ã€‚æ‰“å¼€Googleçš„é¦–é¡µï¼Œç„¶ååœ¨æ§åˆ¶å°è¾“å…¥</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[].forEach.call(<span class=\"built_in\">document</span>.querySelectorAll(<span class=\"string\">'*'</span>), <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">a</span>)</span>&#123;a.style.outline = <span class=\"string\">\"1px solid red\"</span>;&#125;)</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/BFC/2.png\"  alt=\"demo2\"></p>\n<p>æ‰€ä»¥ï¼Œå…¶å®é¡µé¢éƒ½æ˜¯ç”±ä¸€ä¸ªåˆä¸€ä¸ªçš„ç›’å­ç»„åˆè€Œæˆçš„ã€‚</p>\n<p>æ˜ç¡®äº†è¿™ä¸ªï¼Œæˆ‘ä»¬å†æ¥è¯´è¯´FCæ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ã€‚</p>\n<h4 id=\"FCï¼ˆFormatting-Contextï¼‰\"><a href=\"#FCï¼ˆFormatting-Contextï¼‰\" class=\"headerlink\" title=\"FCï¼ˆFormatting Contextï¼‰\"></a>FCï¼ˆFormatting Contextï¼‰</h4><p>å®ƒæ˜¯W3C CSS2.1è§„èŒƒä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼Œå®šä¹‰çš„æ˜¯é¡µé¢ä¸­çš„ä¸€å—æ¸²æŸ“åŒºåŸŸï¼Œå¹¶ä¸”æœ‰ä¸€å¥—æ¸²æŸ“è§„åˆ™ï¼Œå®ƒ<strong>å†³å®šäº†å…¶å­å…ƒç´ å°†å¦‚ä½•å®šä½</strong>ï¼Œä»¥åŠ<strong>å’Œå…¶ä»–å…ƒç´ çš„å…³ç³»å’Œç›¸äº’ä½œç”¨</strong>ã€‚</p>\n<p>å¸¸è§çš„<code>Formatting Context</code> æœ‰ï¼š<code>Block Formatting Context</code>ï¼ˆBFC | å—çº§æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼‰ å’Œ <code>Inline Formatting Context</code>ï¼ˆIFC |è¡Œå†…æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼‰ã€‚</p>\n<h4 id=\"BFC\"><a href=\"#BFC\" class=\"headerlink\" title=\"BFC\"></a>BFC</h4><blockquote>\n<p>MDN: <strong>å—æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼ˆBlock Formatting Contextï¼ŒBFCï¼‰</strong> æ˜¯Webé¡µé¢çš„å¯è§†CSSæ¸²æŸ“çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯å—ç›’å­çš„å¸ƒå±€è¿‡ç¨‹å‘ç”Ÿçš„åŒºåŸŸï¼Œä¹Ÿæ˜¯æµ®åŠ¨å…ƒç´ ä¸å…¶ä»–å…ƒç´ äº¤äº’çš„åŒºåŸŸã€‚</p>\n</blockquote>\n<h3 id=\"why\"><a href=\"#why\" class=\"headerlink\" title=\"why\"></a>why</h3><p>é‚£ä¹ˆFCå››å…„å¼Ÿä»–ä»¬çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿå¯ä¸å¯ä»¥ä¸è¦ä»–ä»¬ï¼Ÿ</p>\n<p>å…¶å®ï¼Œæˆ‘ä»¬æ¢ä¸ªè§’åº¦æƒ³æƒ³å°±ä¼šèˆ’æœå¾ˆå¤šã€‚æ¯”å¦‚æˆ‘ä»¬å¼€è½¦ä¸Šè·¯ï¼Œå¦‚æœæ²¡æœ‰ğŸš¦ï¼Œé‚£ä¹ˆè·¯å†µå¯èƒ½ä¼šå˜å¾—å¾ˆç³Ÿï¼Œä¸åŒçš„è·¯å£çš„ğŸš¦çš„çº¢ç¯ç»¿ç¯æ—¶é—´éƒ½æ˜¯ç»è¿‡ç²¾å¿ƒè®¾è®¡çš„ï¼Œæ¯”å¦‚è½¦å¤šçš„æ–¹å‘ï¼Œçº¢ç¯æ—¶é—´å°±å°‘ä¸€äº›ï¼Œç»¿ç¯å¤šä¸€äº›ã€‚å¤§å®¶éƒ½æ˜¯ä¸ºäº†è®©è·¯å†µå˜å¾—æ›´å¥½ã€‚</p>\n<p>åè§‚FCå››å…„å¼Ÿï¼Œä»–ä»¬ä¹Ÿæ˜¯ä¸ºäº†è®©ä¸åŒæƒ…å†µä¸‹çš„CSSå¯ä»¥æ›´æœ‰ç§©åºçš„æ˜¾ç¤ºã€‚</p>\n<h3 id=\"how\"><a href=\"#how\" class=\"headerlink\" title=\"how\"></a>how</h3><p>é‚£ä¹ˆæˆ‘è¦æ€ä¹ˆæ ·æ‰å¯ä»¥åˆ¶é€ ä¸€ä¸ªBFCï¼Ÿ</p>\n<ul>\n<li>æ ¹å…ƒç´ ï¼ˆ<code>&lt;html&gt;ï¼‰</code></li>\n<li>æµ®åŠ¨å…ƒç´ ï¼ˆå…ƒç´ çš„ <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/float\" target=\"_blank\" rel=\"noopener\"><code>float</code></a> ä¸æ˜¯ <code>none</code>ï¼‰</li>\n<li>ç»å¯¹å®šä½å…ƒç´ ï¼ˆå…ƒç´ çš„ <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/position\" target=\"_blank\" rel=\"noopener\"><code>position</code></a> ä¸º <code>absolute</code> æˆ– <code>fixed</code>ï¼‰</li>\n<li>è¡Œå†…å—å…ƒç´ ï¼ˆå…ƒç´ çš„ <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/display\" target=\"_blank\" rel=\"noopener\"><code>display</code></a> ä¸º <code>inline-block</code>ï¼‰</li>\n<li>è¡¨æ ¼å•å…ƒæ ¼ï¼ˆå…ƒç´ çš„ <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/display\" target=\"_blank\" rel=\"noopener\"><code>display</code></a> ä¸º <code>table-cell</code>ï¼ŒHTMLè¡¨æ ¼å•å…ƒæ ¼é»˜è®¤ä¸ºè¯¥å€¼ï¼‰</li>\n<li>è¡¨æ ¼æ ‡é¢˜ï¼ˆå…ƒç´ çš„ <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/display\" target=\"_blank\" rel=\"noopener\"><code>display</code></a> ä¸º <code>table-caption</code>ï¼ŒHTMLè¡¨æ ¼æ ‡é¢˜é»˜è®¤ä¸ºè¯¥å€¼ï¼‰</li>\n<li>åŒ¿åè¡¨æ ¼å•å…ƒæ ¼å…ƒç´ ï¼ˆå…ƒç´ çš„ <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/display\" target=\"_blank\" rel=\"noopener\"><code>display</code></a> ä¸º <code>tableã€``table-row</code>ã€ <code>table-row-groupã€``table-header-groupã€``table-footer-group</code>ï¼ˆåˆ†åˆ«æ˜¯HTML tableã€rowã€tbodyã€theadã€tfoot çš„é»˜è®¤å±æ€§ï¼‰æˆ– <code>inline-table</code>ï¼‰</li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/overflow\" target=\"_blank\" rel=\"noopener\"><code>overflow</code></a> å€¼ä¸ä¸º <code>visible</code> çš„å—å…ƒç´ </li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/display\" target=\"_blank\" rel=\"noopener\"><code>display</code></a> å€¼ä¸º <code>flow-root</code> çš„å…ƒç´ </li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/contain\" target=\"_blank\" rel=\"noopener\"><code>contain</code></a> å€¼ä¸º <code>layout</code>ã€<code>content</code>æˆ– paint çš„å…ƒç´ </li>\n<li>å¼¹æ€§å…ƒç´ ï¼ˆ<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/display\" target=\"_blank\" rel=\"noopener\"><code>display</code></a> ä¸º <code>flex</code> æˆ– <code>inline-flex</code>å…ƒç´ çš„ç›´æ¥å­å…ƒç´ ï¼‰</li>\n<li>ç½‘æ ¼å…ƒç´ ï¼ˆ<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/display\" target=\"_blank\" rel=\"noopener\"><code>display</code></a> ä¸º <code>grid</code> æˆ– <code>inline-grid</code> å…ƒç´ çš„ç›´æ¥å­å…ƒç´ ï¼‰</li>\n<li>å¤šåˆ—å®¹å™¨ï¼ˆå…ƒç´ çš„ <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/column-count\" target=\"_blank\" rel=\"noopener\"><code>column-count</code></a> æˆ– <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/column-width\" target=\"_blank\" rel=\"noopener\"><code>column-width</code></a> ä¸ä¸º <code>autoï¼ŒåŒ…æ‹¬ ``column-count</code> ä¸º <code>1</code>ï¼‰</li>\n<li><code>column-span</code> ä¸º <code>all</code> çš„å…ƒç´ å§‹ç»ˆä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„BFCï¼Œå³ä½¿è¯¥å…ƒç´ æ²¡æœ‰åŒ…è£¹åœ¨ä¸€ä¸ªå¤šåˆ—å®¹å™¨ä¸­ï¼ˆ<a href=\"https://github.com/w3c/csswg-drafts/commit/a8634b96900279916bd6c505fda88dda71d8ec51\" target=\"_blank\" rel=\"noopener\">æ ‡å‡†å˜æ›´</a>ï¼Œ<a href=\"https://bugs.chromium.org/p/chromium/issues/detail?id=709362\" target=\"_blank\" rel=\"noopener\">Chrome bug</a>ï¼‰ã€‚</li>\n</ul>\n<h3 id=\"BFCå¯ä»¥åšäº›ä»€ä¹ˆï¼Ÿ\"><a href=\"#BFCå¯ä»¥åšäº›ä»€ä¹ˆï¼Ÿ\" class=\"headerlink\" title=\"BFCå¯ä»¥åšäº›ä»€ä¹ˆï¼Ÿ\"></a>BFCå¯ä»¥åšäº›ä»€ä¹ˆï¼Ÿ</h3><h4 id=\"è®©æµ®åŠ¨å†…å®¹å’Œå‘¨å›´çš„å†…å®¹ç­‰é«˜\"><a href=\"#è®©æµ®åŠ¨å†…å®¹å’Œå‘¨å›´çš„å†…å®¹ç­‰é«˜\" class=\"headerlink\" title=\"è®©æµ®åŠ¨å†…å®¹å’Œå‘¨å›´çš„å†…å®¹ç­‰é«˜\"></a>è®©æµ®åŠ¨å†…å®¹å’Œå‘¨å›´çš„å†…å®¹ç­‰é«˜</h4><p>ğŸŒ°ï¼š</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"css\"><span class=\"selector-class\">.box</span> &#123;</span></span><br><span class=\"line\">    background-color: rgb(224, 206, 247);</span><br><span class=\"line\">    border: 5px solid rebeccapurple;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"css\"><span class=\"selector-class\">.float</span> &#123;</span></span><br><span class=\"line\">    float: left;</span><br><span class=\"line\">    width: 200px;</span><br><span class=\"line\">    height: 150px;</span><br><span class=\"line\">    background-color: white;</span><br><span class=\"line\"><span class=\"css\">    <span class=\"selector-tag\">border</span><span class=\"selector-pseudo\">:1px</span> <span class=\"selector-tag\">solid</span> <span class=\"selector-tag\">black</span>;</span></span><br><span class=\"line\">    padding: 10px;</span><br><span class=\"line\">&#125;      </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"box\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"float\"</span>&gt;</span>I am a floated box!<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>I am content inside the container.<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>This is some text outside the div element.<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>å¯ä»¥çœ‹åˆ°ï¼Œé‚£ä¸ªfloatæŠŠåº•ä¸‹çš„divç›–ä½äº†ã€‚</p>\n<p>æˆ‘ä»¬éšä¾¿å¼„ä¸€ä¸ªBFCçš„ç‰¹æ€§ä¸­çš„ä¸€æ¡ï¼š<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/overflow\" target=\"_blank\" rel=\"noopener\"><code>overflow</code></a> å€¼ä¸ä¸º <code>visible</code> çš„å—å…ƒç´ ã€‚</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"css\"><span class=\"selector-class\">.box</span> &#123;</span></span><br><span class=\"line\">    background-color: rgb(224, 206, 247);</span><br><span class=\"line\">    border: 5px solid rebeccapurple;</span><br><span class=\"line\">    overflow: auto;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"css\"><span class=\"selector-class\">.float</span> &#123;</span></span><br><span class=\"line\">    float: left;</span><br><span class=\"line\">    width: 200px;</span><br><span class=\"line\">    height: 150px;</span><br><span class=\"line\">    background-color: white;</span><br><span class=\"line\"><span class=\"css\">    <span class=\"selector-tag\">border</span><span class=\"selector-pseudo\">:1px</span> <span class=\"selector-tag\">solid</span> <span class=\"selector-tag\">black</span>;</span></span><br><span class=\"line\">    padding: 10px;</span><br><span class=\"line\">&#125;          </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"box\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"float\"</span>&gt;</span>I am a floated box!<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>I am content inside the container.<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>This is some text outside the div element.<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>é‚£å°±è®¾ç½®æˆ<code>auto</code>å§~</p>\n<p>æœ‰æ²¡æœ‰å¾ˆç¥å¥‡çš„å‘ç°ï¼ï¼ï¼</p>\n<p>å†å‘Šè¯‰å¤§å®¶ä¸€ä¸ªé»‘ç§‘æŠ€ï¼šè¡¨æ ¼æ ‡é¢˜ï¼ˆå…ƒç´ çš„ <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/display\" target=\"_blank\" rel=\"noopener\"><code>display</code></a> ä¸º <code>table-caption</code>ï¼ŒHTMLè¡¨æ ¼æ ‡é¢˜é»˜è®¤ä¸ºè¯¥å€¼ï¼‰ã€‚è¿™ä¸ªæ˜¯æ²¡æœ‰å‰¯ä½œç”¨çš„å“¦ã€‚</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"css\"><span class=\"selector-class\">.box</span> &#123;</span></span><br><span class=\"line\">    background-color: rgb(224, 206, 247);</span><br><span class=\"line\">    border: 5px solid rebeccapurple;</span><br><span class=\"line\">    display: table-caption;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"css\"><span class=\"selector-class\">.float</span> &#123;</span></span><br><span class=\"line\">    float: left;</span><br><span class=\"line\">    width: 200px;</span><br><span class=\"line\">    height: 150px;</span><br><span class=\"line\">    background-color: white;</span><br><span class=\"line\"><span class=\"css\">    <span class=\"selector-tag\">border</span><span class=\"selector-pseudo\">:1px</span> <span class=\"selector-tag\">solid</span> <span class=\"selector-tag\">black</span>;</span></span><br><span class=\"line\">    padding: 10px;</span><br><span class=\"line\">&#125;          </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"box\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"float\"</span>&gt;</span>I am a floated box!<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>I am content inside the container.<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>This is some text outside the div element.<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>ç»™ <code>&lt;div&gt;</code> <code>display: flow-root</code> å±æ€§åï¼Œ<code>&lt;div&gt;</code> ä¸­çš„æ‰€æœ‰å†…å®¹éƒ½ä¼šå‚ä¸ BFCï¼Œæµ®åŠ¨çš„å†…å®¹ä¸ä¼šä»åº•éƒ¨æº¢å‡ºã€‚</p>\n<p>å…³äºå€¼ <code>flow-root</code>çš„è¿™ä¸ªåå­—ï¼Œå½“ä½ æ˜ç™½ä½ å®é™…ä¸Šæ˜¯åœ¨åˆ›å»ºä¸€ä¸ªè¡Œä¸ºç±»ä¼¼äºæ ¹å…ƒç´  ï¼ˆæµè§ˆå™¨ä¸­çš„<code>&lt;html&gt;</code>å…ƒç´ ï¼‰ çš„ä¸œè¥¿æ—¶ï¼Œå°±èƒ½å‘ç°è¿™ä¸ªåå­—çš„æ„ä¹‰äº†â€”â€”å³åˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œé‡Œé¢å°†è¿›è¡Œ flow layoutã€‚</p>\n<h4 id=\"å¤–è¾¹è·å¡Œé™·\"><a href=\"#å¤–è¾¹è·å¡Œé™·\" class=\"headerlink\" title=\"å¤–è¾¹è·å¡Œé™·\"></a>å¤–è¾¹è·å¡Œé™·</h4><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"css\"><span class=\"selector-class\">.blue</span>&#123;</span></span><br><span class=\"line\">  height: 50px;</span><br><span class=\"line\">  margin: 50px 0;</span><br><span class=\"line\">&#125; </span><br><span class=\"line\"><span class=\"css\"><span class=\"selector-class\">.red-inner</span> &#123;</span></span><br><span class=\"line\">  height: 50px;</span><br><span class=\"line\">  margin: 50px 0;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"css\"><span class=\"selector-class\">.blue</span> &#123;</span></span><br><span class=\"line\">  background: blue;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"css\"><span class=\"selector-class\">.red-outer</span> &#123;</span></span><br><span class=\"line\">  overflow: hidden;</span><br><span class=\"line\">  background: red;</span><br><span class=\"line\">&#125;        </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"blue\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"red-outer\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"red-inner\"</span>&gt;</span>red inner<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>æ„å¤–çš„å‘ç°ï¼Œæˆ‘ä»¬ä¸¤ä¸ªmarginéƒ½æ˜¯50pxï¼Œç†è®ºä¸Šåº”è¯¥æ˜¯100pxå•Šï¼Œå¯æ˜¯çœ‹èµ·æ¥æ€ä¹ˆåªæœ‰50pxçš„æ ·å­ã€‚ã€‚ã€‚</p>\n<p>é¦–å…ˆè¿™ä¸æ˜¯ CSS çš„ bugï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºä¸€ç§è§„èŒƒï¼Œ<strong>å¦‚æœæƒ³è¦é¿å…å¤–è¾¹è·çš„é‡å ï¼Œå¯ä»¥å°†å…¶æ”¾åœ¨ä¸åŒçš„ BFC å®¹å™¨ä¸­ã€‚</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"css\"><span class=\"selector-class\">.container</span> &#123;</span></span><br><span class=\"line\">    overflow: hidden;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">p &#123;</span><br><span class=\"line\">    width: 100px;</span><br><span class=\"line\">    height: 100px;</span><br><span class=\"line\">    background: lightblue;</span><br><span class=\"line\">    margin: 100px;</span><br><span class=\"line\">&#125;       </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"container\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"container\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>è¿™æ—¶å€™ï¼Œä¸¤ä¸ªç›’å­è¾¹è·å°±å˜æˆäº† 200px</p>\n<h3 id=\"BFCçš„çº¦æŸæ¡ä»¶\"><a href=\"#BFCçš„çº¦æŸæ¡ä»¶\" class=\"headerlink\" title=\"BFCçš„çº¦æŸæ¡ä»¶\"></a>BFCçš„çº¦æŸæ¡ä»¶</h3><ul>\n<li>å†…éƒ¨çš„Boxä¼šåœ¨å‚ç›´æ–¹å‘ä¸Šä¸€ä¸ªæ¥ä¸€ä¸ªçš„æ”¾ç½®</li>\n<li>å‚ç›´æ–¹å‘ä¸Šçš„è·ç¦»ç”±marginå†³å®šã€‚ï¼ˆå®Œæ•´çš„è¯´æ³•æ˜¯ï¼šå±äºåŒä¸€ä¸ªBFCçš„ä¸¤ä¸ªç›¸é‚»Boxçš„marginä¼šå‘ç”Ÿé‡å ï¼ˆå¡Œé™·ï¼‰ï¼Œä¸æ–¹å‘æ— å…³ã€‚ï¼‰</li>\n<li>æ¯ä¸ªå…ƒç´ çš„å·¦å¤–è¾¹è·ä¸åŒ…å«å—çš„å·¦è¾¹ç•Œç›¸æ¥è§¦ï¼ˆä»å·¦å‘å³ï¼‰ï¼Œå³ä½¿æµ®åŠ¨å…ƒç´ ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ï¼ˆè¿™è¯´æ˜BFCä¸­å­å…ƒç´ ä¸ä¼šè¶…å‡ºä»–çš„åŒ…å«å—ï¼Œè€Œpositionä¸ºabsoluteçš„å…ƒç´ å¯ä»¥è¶…å‡ºä»–çš„åŒ…å«å—è¾¹ç•Œï¼‰</li>\n<li>BFCçš„åŒºåŸŸä¸ä¼šä¸floatçš„å…ƒç´ åŒºåŸŸé‡å </li>\n<li>è®¡ç®—BFCçš„é«˜åº¦æ—¶ï¼Œæµ®åŠ¨å­å…ƒç´ ä¹Ÿå‚ä¸è®¡ç®—</li>\n<li>BFCå°±æ˜¯é¡µé¢ä¸Šçš„ä¸€ä¸ªéš”ç¦»çš„ç‹¬ç«‹å®¹å™¨ï¼Œå®¹å™¨é‡Œé¢çš„å­å…ƒç´ ä¸ä¼šå½±å“åˆ°å¤–é¢å…ƒç´ ï¼Œåä¹‹äº¦ç„¶</li>\n</ul>\n<h2 id=\"è¡¥å……\"><a href=\"#è¡¥å……\" class=\"headerlink\" title=\"è¡¥å……\"></a>è¡¥å……</h2><h3 id=\"IFC\"><a href=\"#IFC\" class=\"headerlink\" title=\"IFC\"></a><strong>IFC</strong></h3><blockquote>\n<p>IFC(Inline Formatting Contexts)ç›´è¯‘ä¸ºâ€å†…è”æ ¼å¼åŒ–ä¸Šä¸‹æ–‡â€ï¼ŒIFCçš„line boxï¼ˆçº¿æ¡†ï¼‰é«˜åº¦ç”±å…¶åŒ…å«è¡Œå†…å…ƒç´ ä¸­æœ€é«˜çš„å®é™…é«˜åº¦è®¡ç®—è€Œæ¥ï¼ˆä¸å—åˆ°ç«–ç›´æ–¹å‘çš„padding/marginå½±å“)<br>IFCä¸­çš„line boxä¸€èˆ¬å·¦å³éƒ½è´´ç´§æ•´ä¸ªIFCï¼Œä½†æ˜¯ä¼šå› ä¸ºfloatå…ƒç´ è€Œæ‰°ä¹±ã€‚floatå…ƒç´ ä¼šä½äºIFCä¸ä¸line boxä¹‹é—´ï¼Œä½¿å¾—line boxå®½åº¦ç¼©çŸ­ã€‚ åŒä¸ªifcä¸‹çš„å¤šä¸ªline boxé«˜åº¦ä¼šä¸åŒã€‚ IFCä¸­æ—¶ä¸å¯èƒ½æœ‰å—çº§å…ƒç´ çš„ï¼Œå½“æ’å…¥å—çº§å…ƒç´ æ—¶ï¼ˆå¦‚pä¸­æ’å…¥divï¼‰ä¼šäº§ç”Ÿä¸¤ä¸ªåŒ¿åå—ä¸divåˆ†éš”å¼€ï¼Œå³äº§ç”Ÿä¸¤ä¸ªIFCï¼Œæ¯ä¸ªIFCå¯¹å¤–è¡¨ç°ä¸ºå—çº§å…ƒç´ ï¼Œä¸divå‚ç›´æ’åˆ—ã€‚<br>é‚£ä¹ˆIFCä¸€èˆ¬æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ<br>æ°´å¹³å±…ä¸­ï¼šå½“ä¸€ä¸ªå—è¦åœ¨ç¯å¢ƒä¸­æ°´å¹³å±…ä¸­æ—¶ï¼Œè®¾ç½®å…¶ä¸ºinline-blockåˆ™ä¼šåœ¨å¤–å±‚äº§ç”ŸIFCï¼Œé€šè¿‡text-alignåˆ™å¯ä»¥ä½¿å…¶æ°´å¹³å±…ä¸­ã€‚<br>å‚ç›´å±…ä¸­ï¼šåˆ›å»ºä¸€ä¸ªIFCï¼Œç”¨å…¶ä¸­ä¸€ä¸ªå…ƒç´ æ’‘å¼€çˆ¶å…ƒç´ çš„é«˜åº¦ï¼Œç„¶åè®¾ç½®å…¶vertical-align:middleï¼Œå…¶ä»–è¡Œå†…å…ƒç´ åˆ™å¯ä»¥åœ¨æ­¤çˆ¶å…ƒç´ ä¸‹å‚ç›´å±…ä¸­ã€‚</p>\n</blockquote>\n<h3 id=\"GFC\"><a href=\"#GFC\" class=\"headerlink\" title=\"GFC\"></a>GFC</h3><blockquote>\n<p><strong>GFC</strong><br>GFC(GridLayout Formatting Contexts)ç›´è¯‘ä¸ºâ€ç½‘æ ¼å¸ƒå±€æ ¼å¼åŒ–ä¸Šä¸‹æ–‡â€ï¼Œå½“ä¸ºä¸€ä¸ªå…ƒç´ è®¾ç½®displayå€¼ä¸ºgridçš„æ—¶å€™ï¼Œæ­¤å…ƒç´ å°†ä¼šè·å¾—ä¸€ä¸ªç‹¬ç«‹çš„æ¸²æŸ“åŒºåŸŸï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ç½‘æ ¼å®¹å™¨ï¼ˆgrid containerï¼‰ä¸Šå®šä¹‰ç½‘æ ¼å®šä¹‰è¡Œï¼ˆgrid definition rowsï¼‰å’Œç½‘æ ¼å®šä¹‰åˆ—ï¼ˆgrid definition columnsï¼‰å±æ€§å„åœ¨ç½‘æ ¼é¡¹ç›®ï¼ˆgrid itemï¼‰ä¸Šå®šä¹‰ç½‘æ ¼è¡Œï¼ˆgrid rowï¼‰å’Œç½‘æ ¼åˆ—ï¼ˆgrid columnsï¼‰ä¸ºæ¯ä¸€ä¸ªç½‘æ ¼é¡¹ç›®ï¼ˆgrid itemï¼‰å®šä¹‰ä½ç½®å’Œç©ºé—´ã€‚<br>é‚£ä¹ˆGFCæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Œå’Œtableåˆæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿé¦–å…ˆåŒæ ·æ˜¯ä¸€ä¸ªäºŒç»´çš„è¡¨æ ¼ï¼Œä½†GridLayoutä¼šæœ‰æ›´åŠ ä¸°å¯Œçš„å±æ€§æ¥æ§åˆ¶è¡Œåˆ—ï¼Œæ§åˆ¶å¯¹é½ä»¥åŠæ›´ä¸ºç²¾ç»†çš„æ¸²æŸ“è¯­ä¹‰å’Œæ§åˆ¶ã€‚</p>\n</blockquote>\n<h3 id=\"FFC\"><a href=\"#FFC\" class=\"headerlink\" title=\"FFC\"></a>FFC</h3><blockquote>\n<p><strong>FFC</strong><br>FFC(Flex Formatting Contexts)ç›´è¯‘ä¸ºâ€è‡ªé€‚åº”æ ¼å¼åŒ–ä¸Šä¸‹æ–‡â€ï¼Œdisplayå€¼ä¸ºflexæˆ–è€…inline-flexçš„å…ƒç´ å°†ä¼šç”Ÿæˆè‡ªé€‚åº”å®¹å™¨ï¼ˆflex containerï¼‰ï¼Œå¯æƒœè¿™ä¸ªç‰›é€¼çš„å±æ€§åªæœ‰è°·æ­Œå’Œç«ç‹æ”¯æŒï¼Œä¸è¿‡åœ¨ç§»åŠ¨ç«¯ä¹Ÿè¶³å¤Ÿäº†ï¼Œè‡³å°‘safariå’Œchromeè¿˜æ˜¯OKçš„ï¼Œæ¯•ç«Ÿè¿™ä¿©åœ¨ç§»åŠ¨ç«¯æ‰æ˜¯ç‹é“ã€‚<br>Flex Box ç”±ä¼¸ç¼©å®¹å™¨å’Œä¼¸ç¼©é¡¹ç›®ç»„æˆã€‚é€šè¿‡è®¾ç½®å…ƒç´ çš„ display å±æ€§ä¸º flex æˆ– inline-flex å¯ä»¥å¾—åˆ°ä¸€ä¸ªä¼¸ç¼©å®¹å™¨ã€‚è®¾ç½®ä¸º flex çš„å®¹å™¨è¢«æ¸²æŸ“ä¸ºä¸€ä¸ªå—çº§å…ƒç´ ï¼Œè€Œè®¾ç½®ä¸º inline-flex çš„å®¹å™¨åˆ™æ¸²æŸ“ä¸ºä¸€ä¸ªè¡Œå†…å…ƒç´ ã€‚<br>ä¼¸ç¼©å®¹å™¨ä¸­çš„æ¯ä¸€ä¸ªå­å…ƒç´ éƒ½æ˜¯ä¸€ä¸ªä¼¸ç¼©é¡¹ç›®ã€‚ä¼¸ç¼©é¡¹ç›®å¯ä»¥æ˜¯ä»»æ„æ•°é‡çš„ã€‚ä¼¸ç¼©å®¹å™¨å¤–å’Œä¼¸ç¼©é¡¹ç›®å†…çš„ä¸€åˆ‡å…ƒç´ éƒ½ä¸å—å½±å“ã€‚ç®€å•åœ°è¯´ï¼ŒFlexbox å®šä¹‰äº†ä¼¸ç¼©å®¹å™¨å†…ä¼¸ç¼©é¡¹ç›®è¯¥å¦‚ä½•å¸ƒå±€ã€‚</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<p>æœ€è¿‘åœ¨å†™ã€é‡æ‹¾å‰ç«¯ã€‘ç³»åˆ—ï¼Œä¸‹é¢æœ‰å‡ ä¸ªå¿«é€Ÿé€šé“ï¼Œå¤§å®¶è‡ªå–</p>\n<p><a href=\"https://juejin.im/post/6850418113944420359\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿</a></p>\n<p><a href=\"https://juejin.im/post/6850418117508759566\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—</a></p>\n<p><a href=\"https://juejin.im/post/6854573215658803208\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this</a></p>\n<p><a href=\"https://juejin.im/post/6859911609633767438\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šJavaScriptçš„æ‰§è¡Œæœºåˆ¶</a></p>\n<p><a href=\"https://juejin.im/post/6860375101322461198\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC</a></p>\n<p><a href=\"https://juejin.im/post/6865204092877144077\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ</a></p>\n<h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><p>å…¶å®åœ¨é¢è¯•çš„è¿‡ç¨‹ä¸­å¾ˆæœ‰å¯èƒ½ä¼šè¢«é—®åˆ°â€œä»‹ç»ä¸€ä¸‹BFCâ€</p>\n<p>é‚£ä»Šå¤©å°±ä¸€å£æ°”æŠŠBFCã€IFCã€GFC å’Œ FFCè¿™å››å…„å¼Ÿç»™åƒé€</p>\n<p>åƒé€é€</p>\n<p>é‡ç‚¹ä»‹ç»ä¸€ä¸‹BFCï¼Œä»–çš„ä¸‰å…„å¼Ÿè¿™é‡Œåªåšä»‹ç»ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥ä¸Šç½‘å¤šæŸ¥æŸ¥èµ„æ–™ç„¶åå›æ¥æ•™æ•™æˆ‘ğŸ˜‚</p>\n<h2 id=\"å¼€å§‹\"><a href=\"#å¼€å§‹\" class=\"headerlink\" title=\"å¼€å§‹\"></a>å¼€å§‹</h2><h3 id=\"what\"><a href=\"#what\" class=\"headerlink\" title=\"what\"></a>what</h3><p>å…¶å®åœ¨è¯´BFCå’Œä»–çš„ä¸‰å…„å¼Ÿä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ï¼Œä»€ä¹ˆæ˜¯FCï¼Ÿ</p>\n<p>æ‰“æ–­ä¸€ä¸‹ã€‚è¯´FCä¹‹å‰æˆ‘å¸Œæœ›å…ˆè¯´ä¸€ä¸‹BOX</p>\n<h4 id=\"BOX\"><a href=\"#BOX\" class=\"headerlink\" title=\"BOX\"></a>BOX</h4><p>ä¸€ä¸ªé¡µé¢æ˜¯ç”±å¾ˆå¤šå…ƒç´ ç»„æˆçš„ï¼Œè€Œè¿™äº›å…ƒç´ éƒ½æ˜¯ä¸€ä¸ªæ¥ä¸€ä¸ªç›’å­ã€‚é‚£æœ‰äººå°±è¯´äº†ï¼Œé‚£<code>border-radius: 50%</code>æï¼Ÿ</p>\n<p>Ok, ç›´æ¥çœ‹ä¸‹å›¾å§ï¼š</p>\n<p><img src=\"/image/BFC/1.png\" alt=\"demo1-1\"></p>\n<p>å†æ¥çœ‹ä¸€ä¸ªæ›´ç›´è§‚çš„å›¾ã€‚æ‰“å¼€Googleçš„é¦–é¡µï¼Œç„¶ååœ¨æ§åˆ¶å°è¾“å…¥</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[].forEach.call(<span class=\"built_in\">document</span>.querySelectorAll(<span class=\"string\">'*'</span>), <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">a</span>)</span>&#123;a.style.outline = <span class=\"string\">\"1px solid red\"</span>;&#125;)</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/image/BFC/2.png\" alt=\"demo2\"></p>\n<p>æ‰€ä»¥ï¼Œå…¶å®é¡µé¢éƒ½æ˜¯ç”±ä¸€ä¸ªåˆä¸€ä¸ªçš„ç›’å­ç»„åˆè€Œæˆçš„ã€‚</p>\n<p>æ˜ç¡®äº†è¿™ä¸ªï¼Œæˆ‘ä»¬å†æ¥è¯´è¯´FCæ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ã€‚</p>\n<h4 id=\"FCï¼ˆFormatting-Contextï¼‰\"><a href=\"#FCï¼ˆFormatting-Contextï¼‰\" class=\"headerlink\" title=\"FCï¼ˆFormatting Contextï¼‰\"></a>FCï¼ˆFormatting Contextï¼‰</h4><p>å®ƒæ˜¯W3C CSS2.1è§„èŒƒä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼Œå®šä¹‰çš„æ˜¯é¡µé¢ä¸­çš„ä¸€å—æ¸²æŸ“åŒºåŸŸï¼Œå¹¶ä¸”æœ‰ä¸€å¥—æ¸²æŸ“è§„åˆ™ï¼Œå®ƒ<strong>å†³å®šäº†å…¶å­å…ƒç´ å°†å¦‚ä½•å®šä½</strong>ï¼Œä»¥åŠ<strong>å’Œå…¶ä»–å…ƒç´ çš„å…³ç³»å’Œç›¸äº’ä½œç”¨</strong>ã€‚</p>\n<p>å¸¸è§çš„<code>Formatting Context</code> æœ‰ï¼š<code>Block Formatting Context</code>ï¼ˆBFC | å—çº§æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼‰ å’Œ <code>Inline Formatting Context</code>ï¼ˆIFC |è¡Œå†…æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼‰ã€‚</p>\n<h4 id=\"BFC\"><a href=\"#BFC\" class=\"headerlink\" title=\"BFC\"></a>BFC</h4><blockquote>\n<p>MDN: <strong>å—æ ¼å¼åŒ–ä¸Šä¸‹æ–‡ï¼ˆBlock Formatting Contextï¼ŒBFCï¼‰</strong> æ˜¯Webé¡µé¢çš„å¯è§†CSSæ¸²æŸ“çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯å—ç›’å­çš„å¸ƒå±€è¿‡ç¨‹å‘ç”Ÿçš„åŒºåŸŸï¼Œä¹Ÿæ˜¯æµ®åŠ¨å…ƒç´ ä¸å…¶ä»–å…ƒç´ äº¤äº’çš„åŒºåŸŸã€‚</p>\n</blockquote>\n<h3 id=\"why\"><a href=\"#why\" class=\"headerlink\" title=\"why\"></a>why</h3><p>é‚£ä¹ˆFCå››å…„å¼Ÿä»–ä»¬çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿå¯ä¸å¯ä»¥ä¸è¦ä»–ä»¬ï¼Ÿ</p>\n<p>å…¶å®ï¼Œæˆ‘ä»¬æ¢ä¸ªè§’åº¦æƒ³æƒ³å°±ä¼šèˆ’æœå¾ˆå¤šã€‚æ¯”å¦‚æˆ‘ä»¬å¼€è½¦ä¸Šè·¯ï¼Œå¦‚æœæ²¡æœ‰ğŸš¦ï¼Œé‚£ä¹ˆè·¯å†µå¯èƒ½ä¼šå˜å¾—å¾ˆç³Ÿï¼Œä¸åŒçš„è·¯å£çš„ğŸš¦çš„çº¢ç¯ç»¿ç¯æ—¶é—´éƒ½æ˜¯ç»è¿‡ç²¾å¿ƒè®¾è®¡çš„ï¼Œæ¯”å¦‚è½¦å¤šçš„æ–¹å‘ï¼Œçº¢ç¯æ—¶é—´å°±å°‘ä¸€äº›ï¼Œç»¿ç¯å¤šä¸€äº›ã€‚å¤§å®¶éƒ½æ˜¯ä¸ºäº†è®©è·¯å†µå˜å¾—æ›´å¥½ã€‚</p>\n<p>åè§‚FCå››å…„å¼Ÿï¼Œä»–ä»¬ä¹Ÿæ˜¯ä¸ºäº†è®©ä¸åŒæƒ…å†µä¸‹çš„CSSå¯ä»¥æ›´æœ‰ç§©åºçš„æ˜¾ç¤ºã€‚</p>\n<h3 id=\"how\"><a href=\"#how\" class=\"headerlink\" title=\"how\"></a>how</h3><p>é‚£ä¹ˆæˆ‘è¦æ€ä¹ˆæ ·æ‰å¯ä»¥åˆ¶é€ ä¸€ä¸ªBFCï¼Ÿ</p>\n<ul>\n<li>æ ¹å…ƒç´ ï¼ˆ<code>&lt;html&gt;ï¼‰</code></li>\n<li>æµ®åŠ¨å…ƒç´ ï¼ˆå…ƒç´ çš„ <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/float\" target=\"_blank\" rel=\"noopener\"><code>float</code></a> ä¸æ˜¯ <code>none</code>ï¼‰</li>\n<li>ç»å¯¹å®šä½å…ƒç´ ï¼ˆå…ƒç´ çš„ <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/position\" target=\"_blank\" rel=\"noopener\"><code>position</code></a> ä¸º <code>absolute</code> æˆ– <code>fixed</code>ï¼‰</li>\n<li>è¡Œå†…å—å…ƒç´ ï¼ˆå…ƒç´ çš„ <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/display\" target=\"_blank\" rel=\"noopener\"><code>display</code></a> ä¸º <code>inline-block</code>ï¼‰</li>\n<li>è¡¨æ ¼å•å…ƒæ ¼ï¼ˆå…ƒç´ çš„ <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/display\" target=\"_blank\" rel=\"noopener\"><code>display</code></a> ä¸º <code>table-cell</code>ï¼ŒHTMLè¡¨æ ¼å•å…ƒæ ¼é»˜è®¤ä¸ºè¯¥å€¼ï¼‰</li>\n<li>è¡¨æ ¼æ ‡é¢˜ï¼ˆå…ƒç´ çš„ <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/display\" target=\"_blank\" rel=\"noopener\"><code>display</code></a> ä¸º <code>table-caption</code>ï¼ŒHTMLè¡¨æ ¼æ ‡é¢˜é»˜è®¤ä¸ºè¯¥å€¼ï¼‰</li>\n<li>åŒ¿åè¡¨æ ¼å•å…ƒæ ¼å…ƒç´ ï¼ˆå…ƒç´ çš„ <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/display\" target=\"_blank\" rel=\"noopener\"><code>display</code></a> ä¸º <code>tableã€``table-row</code>ã€ <code>table-row-groupã€``table-header-groupã€``table-footer-group</code>ï¼ˆåˆ†åˆ«æ˜¯HTML tableã€rowã€tbodyã€theadã€tfoot çš„é»˜è®¤å±æ€§ï¼‰æˆ– <code>inline-table</code>ï¼‰</li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/overflow\" target=\"_blank\" rel=\"noopener\"><code>overflow</code></a> å€¼ä¸ä¸º <code>visible</code> çš„å—å…ƒç´ </li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/display\" target=\"_blank\" rel=\"noopener\"><code>display</code></a> å€¼ä¸º <code>flow-root</code> çš„å…ƒç´ </li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/contain\" target=\"_blank\" rel=\"noopener\"><code>contain</code></a> å€¼ä¸º <code>layout</code>ã€<code>content</code>æˆ– paint çš„å…ƒç´ </li>\n<li>å¼¹æ€§å…ƒç´ ï¼ˆ<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/display\" target=\"_blank\" rel=\"noopener\"><code>display</code></a> ä¸º <code>flex</code> æˆ– <code>inline-flex</code>å…ƒç´ çš„ç›´æ¥å­å…ƒç´ ï¼‰</li>\n<li>ç½‘æ ¼å…ƒç´ ï¼ˆ<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/display\" target=\"_blank\" rel=\"noopener\"><code>display</code></a> ä¸º <code>grid</code> æˆ– <code>inline-grid</code> å…ƒç´ çš„ç›´æ¥å­å…ƒç´ ï¼‰</li>\n<li>å¤šåˆ—å®¹å™¨ï¼ˆå…ƒç´ çš„ <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/column-count\" target=\"_blank\" rel=\"noopener\"><code>column-count</code></a> æˆ– <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/column-width\" target=\"_blank\" rel=\"noopener\"><code>column-width</code></a> ä¸ä¸º <code>autoï¼ŒåŒ…æ‹¬ ``column-count</code> ä¸º <code>1</code>ï¼‰</li>\n<li><code>column-span</code> ä¸º <code>all</code> çš„å…ƒç´ å§‹ç»ˆä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„BFCï¼Œå³ä½¿è¯¥å…ƒç´ æ²¡æœ‰åŒ…è£¹åœ¨ä¸€ä¸ªå¤šåˆ—å®¹å™¨ä¸­ï¼ˆ<a href=\"https://github.com/w3c/csswg-drafts/commit/a8634b96900279916bd6c505fda88dda71d8ec51\" target=\"_blank\" rel=\"noopener\">æ ‡å‡†å˜æ›´</a>ï¼Œ<a href=\"https://bugs.chromium.org/p/chromium/issues/detail?id=709362\" target=\"_blank\" rel=\"noopener\">Chrome bug</a>ï¼‰ã€‚</li>\n</ul>\n<h3 id=\"BFCå¯ä»¥åšäº›ä»€ä¹ˆï¼Ÿ\"><a href=\"#BFCå¯ä»¥åšäº›ä»€ä¹ˆï¼Ÿ\" class=\"headerlink\" title=\"BFCå¯ä»¥åšäº›ä»€ä¹ˆï¼Ÿ\"></a>BFCå¯ä»¥åšäº›ä»€ä¹ˆï¼Ÿ</h3><h4 id=\"è®©æµ®åŠ¨å†…å®¹å’Œå‘¨å›´çš„å†…å®¹ç­‰é«˜\"><a href=\"#è®©æµ®åŠ¨å†…å®¹å’Œå‘¨å›´çš„å†…å®¹ç­‰é«˜\" class=\"headerlink\" title=\"è®©æµ®åŠ¨å†…å®¹å’Œå‘¨å›´çš„å†…å®¹ç­‰é«˜\"></a>è®©æµ®åŠ¨å†…å®¹å’Œå‘¨å›´çš„å†…å®¹ç­‰é«˜</h4><p>ğŸŒ°ï¼š</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"css\"><span class=\"selector-class\">.box</span> &#123;</span></span><br><span class=\"line\">    background-color: rgb(224, 206, 247);</span><br><span class=\"line\">    border: 5px solid rebeccapurple;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"css\"><span class=\"selector-class\">.float</span> &#123;</span></span><br><span class=\"line\">    float: left;</span><br><span class=\"line\">    width: 200px;</span><br><span class=\"line\">    height: 150px;</span><br><span class=\"line\">    background-color: white;</span><br><span class=\"line\"><span class=\"css\">    <span class=\"selector-tag\">border</span><span class=\"selector-pseudo\">:1px</span> <span class=\"selector-tag\">solid</span> <span class=\"selector-tag\">black</span>;</span></span><br><span class=\"line\">    padding: 10px;</span><br><span class=\"line\">&#125;      </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"box\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"float\"</span>&gt;</span>I am a floated box!<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>I am content inside the container.<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>This is some text outside the div element.<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>å¯ä»¥çœ‹åˆ°ï¼Œé‚£ä¸ªfloatæŠŠåº•ä¸‹çš„divç›–ä½äº†ã€‚</p>\n<p>æˆ‘ä»¬éšä¾¿å¼„ä¸€ä¸ªBFCçš„ç‰¹æ€§ä¸­çš„ä¸€æ¡ï¼š<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/overflow\" target=\"_blank\" rel=\"noopener\"><code>overflow</code></a> å€¼ä¸ä¸º <code>visible</code> çš„å—å…ƒç´ ã€‚</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"css\"><span class=\"selector-class\">.box</span> &#123;</span></span><br><span class=\"line\">    background-color: rgb(224, 206, 247);</span><br><span class=\"line\">    border: 5px solid rebeccapurple;</span><br><span class=\"line\">    overflow: auto;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"css\"><span class=\"selector-class\">.float</span> &#123;</span></span><br><span class=\"line\">    float: left;</span><br><span class=\"line\">    width: 200px;</span><br><span class=\"line\">    height: 150px;</span><br><span class=\"line\">    background-color: white;</span><br><span class=\"line\"><span class=\"css\">    <span class=\"selector-tag\">border</span><span class=\"selector-pseudo\">:1px</span> <span class=\"selector-tag\">solid</span> <span class=\"selector-tag\">black</span>;</span></span><br><span class=\"line\">    padding: 10px;</span><br><span class=\"line\">&#125;          </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"box\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"float\"</span>&gt;</span>I am a floated box!<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>I am content inside the container.<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>This is some text outside the div element.<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>é‚£å°±è®¾ç½®æˆ<code>auto</code>å§~</p>\n<p>æœ‰æ²¡æœ‰å¾ˆç¥å¥‡çš„å‘ç°ï¼ï¼ï¼</p>\n<p>å†å‘Šè¯‰å¤§å®¶ä¸€ä¸ªé»‘ç§‘æŠ€ï¼šè¡¨æ ¼æ ‡é¢˜ï¼ˆå…ƒç´ çš„ <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/display\" target=\"_blank\" rel=\"noopener\"><code>display</code></a> ä¸º <code>table-caption</code>ï¼ŒHTMLè¡¨æ ¼æ ‡é¢˜é»˜è®¤ä¸ºè¯¥å€¼ï¼‰ã€‚è¿™ä¸ªæ˜¯æ²¡æœ‰å‰¯ä½œç”¨çš„å“¦ã€‚</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"css\"><span class=\"selector-class\">.box</span> &#123;</span></span><br><span class=\"line\">    background-color: rgb(224, 206, 247);</span><br><span class=\"line\">    border: 5px solid rebeccapurple;</span><br><span class=\"line\">    display: table-caption;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"css\"><span class=\"selector-class\">.float</span> &#123;</span></span><br><span class=\"line\">    float: left;</span><br><span class=\"line\">    width: 200px;</span><br><span class=\"line\">    height: 150px;</span><br><span class=\"line\">    background-color: white;</span><br><span class=\"line\"><span class=\"css\">    <span class=\"selector-tag\">border</span><span class=\"selector-pseudo\">:1px</span> <span class=\"selector-tag\">solid</span> <span class=\"selector-tag\">black</span>;</span></span><br><span class=\"line\">    padding: 10px;</span><br><span class=\"line\">&#125;          </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"box\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"float\"</span>&gt;</span>I am a floated box!<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>I am content inside the container.<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span>This is some text outside the div element.<span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>ç»™ <code>&lt;div&gt;</code> <code>display: flow-root</code> å±æ€§åï¼Œ<code>&lt;div&gt;</code> ä¸­çš„æ‰€æœ‰å†…å®¹éƒ½ä¼šå‚ä¸ BFCï¼Œæµ®åŠ¨çš„å†…å®¹ä¸ä¼šä»åº•éƒ¨æº¢å‡ºã€‚</p>\n<p>å…³äºå€¼ <code>flow-root</code>çš„è¿™ä¸ªåå­—ï¼Œå½“ä½ æ˜ç™½ä½ å®é™…ä¸Šæ˜¯åœ¨åˆ›å»ºä¸€ä¸ªè¡Œä¸ºç±»ä¼¼äºæ ¹å…ƒç´  ï¼ˆæµè§ˆå™¨ä¸­çš„<code>&lt;html&gt;</code>å…ƒç´ ï¼‰ çš„ä¸œè¥¿æ—¶ï¼Œå°±èƒ½å‘ç°è¿™ä¸ªåå­—çš„æ„ä¹‰äº†â€”â€”å³åˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œé‡Œé¢å°†è¿›è¡Œ flow layoutã€‚</p>\n<h4 id=\"å¤–è¾¹è·å¡Œé™·\"><a href=\"#å¤–è¾¹è·å¡Œé™·\" class=\"headerlink\" title=\"å¤–è¾¹è·å¡Œé™·\"></a>å¤–è¾¹è·å¡Œé™·</h4><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"css\"><span class=\"selector-class\">.blue</span>&#123;</span></span><br><span class=\"line\">  height: 50px;</span><br><span class=\"line\">  margin: 50px 0;</span><br><span class=\"line\">&#125; </span><br><span class=\"line\"><span class=\"css\"><span class=\"selector-class\">.red-inner</span> &#123;</span></span><br><span class=\"line\">  height: 50px;</span><br><span class=\"line\">  margin: 50px 0;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"css\"><span class=\"selector-class\">.blue</span> &#123;</span></span><br><span class=\"line\">  background: blue;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"css\"><span class=\"selector-class\">.red-outer</span> &#123;</span></span><br><span class=\"line\">  overflow: hidden;</span><br><span class=\"line\">  background: red;</span><br><span class=\"line\">&#125;        </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"blue\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"red-outer\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"red-inner\"</span>&gt;</span>red inner<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>æ„å¤–çš„å‘ç°ï¼Œæˆ‘ä»¬ä¸¤ä¸ªmarginéƒ½æ˜¯50pxï¼Œç†è®ºä¸Šåº”è¯¥æ˜¯100pxå•Šï¼Œå¯æ˜¯çœ‹èµ·æ¥æ€ä¹ˆåªæœ‰50pxçš„æ ·å­ã€‚ã€‚ã€‚</p>\n<p>é¦–å…ˆè¿™ä¸æ˜¯ CSS çš„ bugï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºä¸€ç§è§„èŒƒï¼Œ<strong>å¦‚æœæƒ³è¦é¿å…å¤–è¾¹è·çš„é‡å ï¼Œå¯ä»¥å°†å…¶æ”¾åœ¨ä¸åŒçš„ BFC å®¹å™¨ä¸­ã€‚</strong></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"css\"><span class=\"selector-class\">.container</span> &#123;</span></span><br><span class=\"line\">    overflow: hidden;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">p &#123;</span><br><span class=\"line\">    width: 100px;</span><br><span class=\"line\">    height: 100px;</span><br><span class=\"line\">    background: lightblue;</span><br><span class=\"line\">    margin: 100px;</span><br><span class=\"line\">&#125;       </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"container\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"container\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">p</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>è¿™æ—¶å€™ï¼Œä¸¤ä¸ªç›’å­è¾¹è·å°±å˜æˆäº† 200px</p>\n<h3 id=\"BFCçš„çº¦æŸæ¡ä»¶\"><a href=\"#BFCçš„çº¦æŸæ¡ä»¶\" class=\"headerlink\" title=\"BFCçš„çº¦æŸæ¡ä»¶\"></a>BFCçš„çº¦æŸæ¡ä»¶</h3><ul>\n<li>å†…éƒ¨çš„Boxä¼šåœ¨å‚ç›´æ–¹å‘ä¸Šä¸€ä¸ªæ¥ä¸€ä¸ªçš„æ”¾ç½®</li>\n<li>å‚ç›´æ–¹å‘ä¸Šçš„è·ç¦»ç”±marginå†³å®šã€‚ï¼ˆå®Œæ•´çš„è¯´æ³•æ˜¯ï¼šå±äºåŒä¸€ä¸ªBFCçš„ä¸¤ä¸ªç›¸é‚»Boxçš„marginä¼šå‘ç”Ÿé‡å ï¼ˆå¡Œé™·ï¼‰ï¼Œä¸æ–¹å‘æ— å…³ã€‚ï¼‰</li>\n<li>æ¯ä¸ªå…ƒç´ çš„å·¦å¤–è¾¹è·ä¸åŒ…å«å—çš„å·¦è¾¹ç•Œç›¸æ¥è§¦ï¼ˆä»å·¦å‘å³ï¼‰ï¼Œå³ä½¿æµ®åŠ¨å…ƒç´ ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ï¼ˆè¿™è¯´æ˜BFCä¸­å­å…ƒç´ ä¸ä¼šè¶…å‡ºä»–çš„åŒ…å«å—ï¼Œè€Œpositionä¸ºabsoluteçš„å…ƒç´ å¯ä»¥è¶…å‡ºä»–çš„åŒ…å«å—è¾¹ç•Œï¼‰</li>\n<li>BFCçš„åŒºåŸŸä¸ä¼šä¸floatçš„å…ƒç´ åŒºåŸŸé‡å </li>\n<li>è®¡ç®—BFCçš„é«˜åº¦æ—¶ï¼Œæµ®åŠ¨å­å…ƒç´ ä¹Ÿå‚ä¸è®¡ç®—</li>\n<li>BFCå°±æ˜¯é¡µé¢ä¸Šçš„ä¸€ä¸ªéš”ç¦»çš„ç‹¬ç«‹å®¹å™¨ï¼Œå®¹å™¨é‡Œé¢çš„å­å…ƒç´ ä¸ä¼šå½±å“åˆ°å¤–é¢å…ƒç´ ï¼Œåä¹‹äº¦ç„¶</li>\n</ul>\n<h2 id=\"è¡¥å……\"><a href=\"#è¡¥å……\" class=\"headerlink\" title=\"è¡¥å……\"></a>è¡¥å……</h2><h3 id=\"IFC\"><a href=\"#IFC\" class=\"headerlink\" title=\"IFC\"></a><strong>IFC</strong></h3><blockquote>\n<p>IFC(Inline Formatting Contexts)ç›´è¯‘ä¸ºâ€å†…è”æ ¼å¼åŒ–ä¸Šä¸‹æ–‡â€ï¼ŒIFCçš„line boxï¼ˆçº¿æ¡†ï¼‰é«˜åº¦ç”±å…¶åŒ…å«è¡Œå†…å…ƒç´ ä¸­æœ€é«˜çš„å®é™…é«˜åº¦è®¡ç®—è€Œæ¥ï¼ˆä¸å—åˆ°ç«–ç›´æ–¹å‘çš„padding/marginå½±å“)<br>IFCä¸­çš„line boxä¸€èˆ¬å·¦å³éƒ½è´´ç´§æ•´ä¸ªIFCï¼Œä½†æ˜¯ä¼šå› ä¸ºfloatå…ƒç´ è€Œæ‰°ä¹±ã€‚floatå…ƒç´ ä¼šä½äºIFCä¸ä¸line boxä¹‹é—´ï¼Œä½¿å¾—line boxå®½åº¦ç¼©çŸ­ã€‚ åŒä¸ªifcä¸‹çš„å¤šä¸ªline boxé«˜åº¦ä¼šä¸åŒã€‚ IFCä¸­æ—¶ä¸å¯èƒ½æœ‰å—çº§å…ƒç´ çš„ï¼Œå½“æ’å…¥å—çº§å…ƒç´ æ—¶ï¼ˆå¦‚pä¸­æ’å…¥divï¼‰ä¼šäº§ç”Ÿä¸¤ä¸ªåŒ¿åå—ä¸divåˆ†éš”å¼€ï¼Œå³äº§ç”Ÿä¸¤ä¸ªIFCï¼Œæ¯ä¸ªIFCå¯¹å¤–è¡¨ç°ä¸ºå—çº§å…ƒç´ ï¼Œä¸divå‚ç›´æ’åˆ—ã€‚<br>é‚£ä¹ˆIFCä¸€èˆ¬æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ<br>æ°´å¹³å±…ä¸­ï¼šå½“ä¸€ä¸ªå—è¦åœ¨ç¯å¢ƒä¸­æ°´å¹³å±…ä¸­æ—¶ï¼Œè®¾ç½®å…¶ä¸ºinline-blockåˆ™ä¼šåœ¨å¤–å±‚äº§ç”ŸIFCï¼Œé€šè¿‡text-alignåˆ™å¯ä»¥ä½¿å…¶æ°´å¹³å±…ä¸­ã€‚<br>å‚ç›´å±…ä¸­ï¼šåˆ›å»ºä¸€ä¸ªIFCï¼Œç”¨å…¶ä¸­ä¸€ä¸ªå…ƒç´ æ’‘å¼€çˆ¶å…ƒç´ çš„é«˜åº¦ï¼Œç„¶åè®¾ç½®å…¶vertical-align:middleï¼Œå…¶ä»–è¡Œå†…å…ƒç´ åˆ™å¯ä»¥åœ¨æ­¤çˆ¶å…ƒç´ ä¸‹å‚ç›´å±…ä¸­ã€‚</p>\n</blockquote>\n<h3 id=\"GFC\"><a href=\"#GFC\" class=\"headerlink\" title=\"GFC\"></a>GFC</h3><blockquote>\n<p><strong>GFC</strong><br>GFC(GridLayout Formatting Contexts)ç›´è¯‘ä¸ºâ€ç½‘æ ¼å¸ƒå±€æ ¼å¼åŒ–ä¸Šä¸‹æ–‡â€ï¼Œå½“ä¸ºä¸€ä¸ªå…ƒç´ è®¾ç½®displayå€¼ä¸ºgridçš„æ—¶å€™ï¼Œæ­¤å…ƒç´ å°†ä¼šè·å¾—ä¸€ä¸ªç‹¬ç«‹çš„æ¸²æŸ“åŒºåŸŸï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ç½‘æ ¼å®¹å™¨ï¼ˆgrid containerï¼‰ä¸Šå®šä¹‰ç½‘æ ¼å®šä¹‰è¡Œï¼ˆgrid definition rowsï¼‰å’Œç½‘æ ¼å®šä¹‰åˆ—ï¼ˆgrid definition columnsï¼‰å±æ€§å„åœ¨ç½‘æ ¼é¡¹ç›®ï¼ˆgrid itemï¼‰ä¸Šå®šä¹‰ç½‘æ ¼è¡Œï¼ˆgrid rowï¼‰å’Œç½‘æ ¼åˆ—ï¼ˆgrid columnsï¼‰ä¸ºæ¯ä¸€ä¸ªç½‘æ ¼é¡¹ç›®ï¼ˆgrid itemï¼‰å®šä¹‰ä½ç½®å’Œç©ºé—´ã€‚<br>é‚£ä¹ˆGFCæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Œå’Œtableåˆæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿé¦–å…ˆåŒæ ·æ˜¯ä¸€ä¸ªäºŒç»´çš„è¡¨æ ¼ï¼Œä½†GridLayoutä¼šæœ‰æ›´åŠ ä¸°å¯Œçš„å±æ€§æ¥æ§åˆ¶è¡Œåˆ—ï¼Œæ§åˆ¶å¯¹é½ä»¥åŠæ›´ä¸ºç²¾ç»†çš„æ¸²æŸ“è¯­ä¹‰å’Œæ§åˆ¶ã€‚</p>\n</blockquote>\n<h3 id=\"FFC\"><a href=\"#FFC\" class=\"headerlink\" title=\"FFC\"></a>FFC</h3><blockquote>\n<p><strong>FFC</strong><br>FFC(Flex Formatting Contexts)ç›´è¯‘ä¸ºâ€è‡ªé€‚åº”æ ¼å¼åŒ–ä¸Šä¸‹æ–‡â€ï¼Œdisplayå€¼ä¸ºflexæˆ–è€…inline-flexçš„å…ƒç´ å°†ä¼šç”Ÿæˆè‡ªé€‚åº”å®¹å™¨ï¼ˆflex containerï¼‰ï¼Œå¯æƒœè¿™ä¸ªç‰›é€¼çš„å±æ€§åªæœ‰è°·æ­Œå’Œç«ç‹æ”¯æŒï¼Œä¸è¿‡åœ¨ç§»åŠ¨ç«¯ä¹Ÿè¶³å¤Ÿäº†ï¼Œè‡³å°‘safariå’Œchromeè¿˜æ˜¯OKçš„ï¼Œæ¯•ç«Ÿè¿™ä¿©åœ¨ç§»åŠ¨ç«¯æ‰æ˜¯ç‹é“ã€‚<br>Flex Box ç”±ä¼¸ç¼©å®¹å™¨å’Œä¼¸ç¼©é¡¹ç›®ç»„æˆã€‚é€šè¿‡è®¾ç½®å…ƒç´ çš„ display å±æ€§ä¸º flex æˆ– inline-flex å¯ä»¥å¾—åˆ°ä¸€ä¸ªä¼¸ç¼©å®¹å™¨ã€‚è®¾ç½®ä¸º flex çš„å®¹å™¨è¢«æ¸²æŸ“ä¸ºä¸€ä¸ªå—çº§å…ƒç´ ï¼Œè€Œè®¾ç½®ä¸º inline-flex çš„å®¹å™¨åˆ™æ¸²æŸ“ä¸ºä¸€ä¸ªè¡Œå†…å…ƒç´ ã€‚<br>ä¼¸ç¼©å®¹å™¨ä¸­çš„æ¯ä¸€ä¸ªå­å…ƒç´ éƒ½æ˜¯ä¸€ä¸ªä¼¸ç¼©é¡¹ç›®ã€‚ä¼¸ç¼©é¡¹ç›®å¯ä»¥æ˜¯ä»»æ„æ•°é‡çš„ã€‚ä¼¸ç¼©å®¹å™¨å¤–å’Œä¼¸ç¼©é¡¹ç›®å†…çš„ä¸€åˆ‡å…ƒç´ éƒ½ä¸å—å½±å“ã€‚ç®€å•åœ°è¯´ï¼ŒFlexbox å®šä¹‰äº†ä¼¸ç¼©å®¹å™¨å†…ä¼¸ç¼©é¡¹ç›®è¯¥å¦‚ä½•å¸ƒå±€ã€‚</p>\n</blockquote>\n"},{"title":"ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—","date":"2020-07-15T10:18:21.000Z","cover":"/image/cover/web.jpeg","_content":"\n\næœ€è¿‘åœ¨å†™ã€é‡æ‹¾å‰ç«¯ã€‘ç³»åˆ—ï¼Œä¸‹é¢æœ‰å‡ ä¸ªå¿«é€Ÿé€šé“ï¼Œå¤§å®¶è‡ªå–\n\n[ã€é‡è¯†å‰ç«¯ã€‘åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿](https://juejin.im/post/6850418113944420359)\n\n[ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—](https://juejin.im/post/6850418117508759566)\n\n[ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this](https://juejin.im/post/6854573215658803208)\n\n[ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šJavaScriptçš„æ‰§è¡Œæœºåˆ¶](https://juejin.im/post/6859911609633767438)\n\n[ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC](https://juejin.im/post/6860375101322461198)\n\n[ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ](https://juejin.im/post/6865204092877144077)\n\n## å‰è¨€\n\nå›å¿†æˆ‘å‰å‡ å¹´çš„æ—¶å…‰ï¼Œå¤§é‡ä½¿ç”¨ JavaScript ä½†å´å®Œå…¨ä¸ç†è§£é—­åŒ…æ˜¯ä»€ä¹ˆã€‚æ€»æ˜¯æ„Ÿè§‰è¿™é—¨è¯­ è¨€æœ‰å…¶éšè”½çš„ä¸€é¢ï¼Œå¦‚æœèƒ½å¤ŸæŒæ¡å°†ä¼šåŠŸåŠ›å¤§æ¶¨ï¼Œä½†è®½åˆºçš„æ˜¯æˆ‘å§‹ç»ˆæ— æ³•æŒæ¡å…¶ä¸­çš„é—¨ é“ã€‚\n\n> JavaScriptä¸­é—­åŒ…æ— å¤„ä¸åœ¨ï¼Œä½ åªéœ€è¦èƒ½å¤Ÿè¯†åˆ«å¹¶æ‹¥æŠ±å®ƒã€‚\n>\n> æœ€åä½ æç„¶å¤§æ‚Ÿ:åŸæ¥åœ¨æˆ‘çš„ä»£ç ä¸­å·²ç»åˆ°å¤„éƒ½æ˜¯é—­åŒ…äº†ï¼Œç°åœ¨æˆ‘ç»ˆäºèƒ½ç†è§£å®ƒä»¬äº†ã€‚ç† è§£é—­åŒ…å°±å¥½åƒ Neo3 ç¬¬ä¸€æ¬¡è§åˆ°çŸ©é˜µ 4 ä¸€æ ·ã€‚\n\n## å®šä¹‰\n\nå½“å‡½æ•°å¯ä»¥è®°ä½å¹¶è®¿é—®æ‰€åœ¨çš„è¯æ³•ä½œç”¨åŸŸæ—¶ï¼Œå°±äº§ç”Ÿäº†é—­åŒ…ï¼Œå³ä½¿å‡½æ•°æ˜¯åœ¨å½“å‰è¯æ³•ä½œç”¨ åŸŸä¹‹å¤–æ‰§è¡Œã€‚\n\n```js\nfunction foo() { \n  var a = 2;\n\tfunction bar() { \n    console.log( a ); // 2\n\t}\n\tbar(); \n}\nfoo();\n```\n\nè¿™æ ·å¯èƒ½è¿˜ä¸å¤Ÿç›´è§‚ï¼Œæˆ‘ä»¬å†ä¿®æ”¹ä¸€ä¸‹ã€‚\n\n```js\nfunction foo() { \n  var a = 2;\n\tfunction bar() { \n    console.log( a ); // 2\n\t}\n\treturn bar; \n}\nvar baz = foo();\nbaz(); // 2 â€”â€” æœ‹å‹ï¼Œè¿™å°±æ˜¯é—­åŒ…çš„æ•ˆæœã€‚\n```\n\nå…¶å®ï¼Œåœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è°ƒç”¨å®Œ`foo`ä¹‹åï¼ŒJavaScriptæ£€æµ‹åˆ°åç»­ä¸ä¼šå†ç”¨åˆ°ä»–äº†ï¼Œ æ‰€ä»¥ä»–çš„å†…éƒ¨ä½œç”¨åŸŸå°±ä¼šè¢«å›æ”¶â™»ï¸ã€‚ï¼ˆæ¶‰åŠåˆ°åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œåç»­çš„æ–‡ç« æˆ‘ä»¬ä¼šè¯´åˆ°ã€‚ï¼‰\n\né—­åŒ…çš„ç¥å¥‡ä¹‹å¤„å°±åœ¨äºä»–å¯ä»¥é˜»æ­¢â™»ï¸çš„å‘ç”Ÿã€‚å› ä¸ºäº‹å®ä¸Šå†…éƒ¨ä½œç”¨åŸŸå·²ç„¶å­˜åœ¨ï¼Œé‚£ä¹ˆåˆæœ‰è°åœ¨ä½¿ç”¨å‘¢ï¼Ÿå“¦~æ˜¯æˆ‘ä»¬çš„`bar`åœ¨ä½¿ç”¨ã€‚\n\næ‹œ bar() æ‰€å£°æ˜çš„ä½ç½®æ‰€èµï¼Œå®ƒæ‹¥æœ‰æ¶µç›– foo() å†…éƒ¨ä½œç”¨åŸŸçš„é—­åŒ…ï¼Œä½¿å¾—è¯¥ä½œç”¨åŸŸèƒ½å¤Ÿä¸€ ç›´å­˜æ´»ï¼Œä»¥ä¾› bar() åœ¨ä¹‹åä»»ä½•æ—¶é—´è¿›è¡Œå¼•ç”¨ã€‚\n\nbar() ä¾ç„¶æŒæœ‰å¯¹è¯¥ä½œç”¨åŸŸçš„å¼•ç”¨ï¼Œè€Œè¿™ä¸ªå¼•ç”¨å°±å«ä½œé—­åŒ…ã€‚\n\næ‰€ä»¥æˆ‘è¯´è¯´æˆ‘è‡ªå·±çš„ç†è§£ï¼š\n\né—­åŒ…æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶çš„æ¦‚å¿µï¼Œå¦‚æœåªæ˜¯å£°æ˜æˆ–è€…å®šä¹‰ã€‚å³ä½¿ä»–ç¬¦åˆé—­åŒ…çš„è¦æ±‚é‚£ä»–ä¹Ÿä¸èƒ½æˆä¸ºä¸€ä¸ªçœŸæ­£çš„é—­åŒ…ã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºå†…å­˜åœ°å€å¹¶æ²¡æœ‰å¼€å§‹åˆ†é…ï¼Œé—­åŒ…åªæ˜¯åˆ†é…ä¹‹åé‚£ä¸€å—åœ°å€æ²¡æœ‰è¢«å›æ”¶è€Œå·²ã€‚\n\nå†å›åˆ°æˆ‘ä»¬æœ€å¼€å§‹çš„å‡½æ•°ï¼š\n\n```js\nfunction foo() { \n  var a = 2;\n\tfunction bar() { \n    console.log( a ); // 2\n\t}\n\tbar(); \n}\nfoo();\n```\n\nä¸€ä¸ªå‡½æ•°fooå†…æœ‰ä¸€ä¸ªå‡½æ•°barã€‚å¹¶ä¸”å‡½æ•°barç”¨åˆ°äº†å‡½æ•°fooçš„å˜é‡ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç§°è¿™ä¸ªå¼•ç”¨è¿‡ç¨‹ä¸ºâ€œé—­åŒ…â€ã€‚ä½†æ˜¯æˆ‘ä»¬è¿™ä¸ªå‡½æ•°fooå¿…é¡»è¢«è°ƒç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ä¾‹å­åœ°ä¸‹è°ƒç”¨äº†ä¸€ä¸‹å‡½æ•°fooã€‚\n\nå†å›åˆ°æˆ‘ä»¬é‚£ä¸ªè¾ƒä¸ºæ¸…æ™°çš„ä¾‹å­\n\n```js\nfunction foo() { \n  var a = 2;\n\tfunction bar() { \n    console.log( a ); // 2\n\t}\n\treturn bar; \n}\nvar baz = foo();\nbaz(); // 2 â€”â€” æœ‹å‹ï¼Œè¿™å°±æ˜¯é—­åŒ…çš„æ•ˆæœã€‚\n```\n\nè¿™ä¸ªåº”è¯¥æ˜¯å¤§ä¼—è®¤çŸ¥ä¸Šéå¸¸ç»å…¸çš„ä¸€ä¸ªé—­åŒ…äº†å§ï¼Ÿä½†æ˜¯å‡å¦‚è¯´è¿™ä¸ªfooå‡½æ•°æ²¡æœ‰è¢«è°ƒç”¨ï¼Œé‚£ä¹ˆæˆ‘è®¤ä¸ºä»–å°±ä¸æ˜¯ä¸€ä¸ªé—­åŒ…ã€‚\n\n## å®è·µ\n\n### å¸¸è§çš„é—­åŒ…\n\nå‰é¢çš„ä»£ç ç‰‡æ®µæœ‰ç‚¹æ­»æ¿ï¼Œå¹¶ä¸”ä¸ºäº†è§£é‡Šå¦‚ä½•ä½¿ç”¨é—­åŒ…è€Œäººä¸ºåœ°åœ¨ç»“æ„ä¸Šè¿›è¡Œäº†ä¿®é¥°ã€‚ä½ å·²ç»å†™è¿‡çš„ä»£ç ä¸­ä¸€å®šåˆ°å¤„éƒ½æ˜¯é—­åŒ…çš„èº«å½±ã€‚ ç°åœ¨è®©æˆ‘ä»¬æ¥ææ‡‚è¿™ä¸ªäº‹å®ã€‚\n\n```js\nfunction wait(message) {\n\tsetTimeout( \n\t\tfunction timer() { \n\t\t\tconsole.log( message );\n\t}, 1000 ); \n}\nwait( \"Hello, closure!\" );\n```\n\nè¿™ä¸ªä¾‹å­éå¸¸å¸¸è§ï¼Œä»£ç å¾ˆç®€å•ï¼Œå°±æ˜¯1ç§’é’Ÿä¹‹åè¾“å‡ºæˆ‘ä»¬ä¼ å…¥çš„å‚æ•°ã€‚\n\nä½†æ˜¯æˆ‘ä»¬ä»”ç»†çœ‹å°±èƒ½çœ‹è§é—­åŒ…çš„å½±å­ï¼Œä¸€ç§’é’Ÿä¹‹åï¼Œ`message`è¿˜æ˜¯å¯ä»¥è¢«`timer`è®¿é—®åˆ°ã€‚å¹¶æ²¡æœ‰è¢«å›æ”¶â™»ï¸æ‰ã€‚\n\n> è¿™å°±æ˜¯é—­åŒ…\n\næœ¬è´¨ä¸Šæ— è®ºä½•æ—¶ä½•åœ°ï¼Œå¦‚æœå°†å‡½æ•°(è®¿é—®å®ƒä»¬å„è‡ªçš„è¯æ³•ä½œç”¨åŸŸ)å½“ä½œç¬¬ä¸€ çº§çš„å€¼ç±»å‹å¹¶åˆ°å¤„ä¼ é€’ï¼Œä½ å°±ä¼šçœ‹åˆ°é—­åŒ…åœ¨è¿™äº›å‡½æ•°ä¸­çš„åº”ç”¨ã€‚åœ¨å®šæ—¶å™¨ã€äº‹ä»¶ç›‘å¬å™¨ã€ Ajax è¯·æ±‚ã€è·¨çª—å£é€šä¿¡ã€Web Workers æˆ–è€…ä»»ä½•å…¶ä»–çš„å¼‚æ­¥(æˆ–è€…åŒæ­¥)ä»»åŠ¡ä¸­ï¼Œåªè¦ä½¿ ç”¨äº†å›è°ƒå‡½æ•°ï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨ä½¿ç”¨é—­åŒ…!\n\n### é—­åŒ…ä¸å¾ªç¯\n\nè¯´åˆ°è¿™é‡Œè‚¯å®šæœ‰äººé©¬ä¸Šå°±æƒ³åˆ°äº†æœ€ç»å…¸çš„é¢è¯•é¢˜ï¼šè¯·å†™å‡ºä»¥ä¸‹çš„è¾“å‡ºå†…å®¹\n\n```js\nfor (var i=1; i<=5; i++) { \n\tsetTimeout( function timer() {\n\t\tconsole.log( i ); \n  }, i*1000 );\n}\n```\n\næ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯¹è¿™æ®µä»£ç è¡Œä¸ºçš„é¢„æœŸæ˜¯åˆ†åˆ«è¾“å‡ºæ•°å­— 1~5ï¼Œæ¯ç§’ä¸€æ¬¡ï¼Œæ¯æ¬¡ä¸€ä¸ªã€‚\n\nä½†å®é™…ä¸Šï¼Œè¿™æ®µä»£ç åœ¨è¿è¡Œæ—¶ä¼šä»¥æ¯ç§’ä¸€æ¬¡çš„é¢‘ç‡è¾“å‡ºäº”æ¬¡ 6ã€‚\n\nè¿™æ˜¯ä¸ºä»€ä¹ˆ?\n\nå› ä¸ºç­‰åˆ°æ‰§è¡Œ`console.log`çš„æ—¶å€™ï¼Œé‚£ä¸ªæ—¶å€™çš„iå·²ç»åœ¨forçš„è°ƒæ•™ä¸‹å˜æˆäº†6äº†ï¼Œæ‰€ä»¥ä»–ä»¬å»å–åªèƒ½å–åˆ°6ï¼›\n\nï¼ˆäº‹å®ä¸Šï¼Œ å½“å®šæ—¶å™¨è¿è¡Œæ—¶å³ä½¿æ¯ä¸ªè¿­ä»£ä¸­æ‰§è¡Œçš„æ˜¯setTimeout(.., 0)ï¼Œæ‰€æœ‰çš„å›è°ƒå‡½æ•°ä¾ç„¶æ˜¯åœ¨å¾ª ç¯ç»“æŸåæ‰ä¼šè¢«æ‰§è¡Œï¼Œå› æ­¤ä¼šæ¯æ¬¡è¾“å‡ºä¸€ä¸ª 6 å‡ºæ¥ã€‚è¿™ä¸ªæ¶‰åŠåˆ°æ—¶é—´å¾ªç¯ï¼Œåé¢çš„æ–‡ç« ä¼šå…·ä½“çš„å±•å¼€æ¥è®²ï¼‰\n\né€šè¿‡æˆ‘ä»¬åˆšåˆšçš„å­¦ä¹ çŸ¥é“ï¼Œå¦‚æœæˆ‘ä»¬åˆ›é€ äº†ä¸€ä¸ªé—­åŒ…ï¼Œè¿™æ ·çš„è¯è¿™ä¸ªiä¸å°±ä¸ä¼šè¢«å›æ”¶äº†å—ï¼Ÿ\n\nokï¼Œæˆ‘ä»¬è¯•è¯•\n\n```js\nfor (var i=1; i<=5; i++) { \n  (function() {\n\t\tsetTimeout( function timer() { \n      console.log( i );\n    }, i*1000 );\n  })();\n}\n\n```\n\nè¿™æ ·èƒ½è¡Œå—?è¯•è¯•å§ï¼Œåœ¨Chromeæˆ–è€…nodeé‡Œé¢è¯•è¯•å§ï¼Œæˆ‘ç­‰ç€ä½ ã€‚\n\næˆ‘ä¸å–å…³å­äº†ã€‚è¿™æ ·ä¸è¡Œã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆå‘¢?æˆ‘ä»¬ç°åœ¨æ˜¾ç„¶æ‹¥æœ‰æ›´å¤šçš„è¯æ³•ä½œç”¨åŸŸäº†ã€‚çš„ç¡® æ¯ä¸ªå»¶è¿Ÿå‡½æ•°éƒ½ä¼šå°† IIFE åœ¨æ¯æ¬¡è¿­ä»£ä¸­åˆ›å»ºçš„ä½œç”¨åŸŸå°é—­èµ·æ¥ã€‚\n\nå¦‚æœä½œç”¨åŸŸæ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆä»…ä»…å°†å®ƒä»¬è¿›è¡Œå°é—­æ˜¯ä¸å¤Ÿçš„ã€‚ä»”ç»†çœ‹ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„ IIFE åªæ˜¯ä¸€ ä¸ªä»€ä¹ˆéƒ½æ²¡æœ‰çš„ç©ºä½œç”¨åŸŸã€‚å®ƒéœ€è¦åŒ…å«ä¸€ç‚¹å®è´¨å†…å®¹æ‰èƒ½ä¸ºæˆ‘ä»¬æ‰€ç”¨ã€‚\n\nå®ƒéœ€è¦æœ‰è‡ªå·±çš„å˜é‡ï¼Œç”¨æ¥åœ¨æ¯ä¸ªè¿­ä»£ä¸­å‚¨å­˜ i çš„å€¼\n\n```js\n\nfor (var i=1; i<=5; i++) { \n  (function() {\n  \tvar j = i;\n  \tsetTimeout( function timer() {\n  \t\tconsole.log( j ); \n    },j *1000 );\n   })(); \n}\n```\n\nè¡Œäº†!å®ƒèƒ½æ­£å¸¸å·¥ä½œäº†!ã€‚\n\nå¯ä»¥å¯¹è¿™æ®µä»£ç è¿›è¡Œä¸€äº›æ”¹è¿›:\n\n```js\nfor (var i=1; i<=5; i++) { \n  (function(j) {\n  \tsetTimeout( function timer() {\n  \t\tconsole.log( j ); \n    },j *1000 );\n   })(i); \n}\n```\n\nå½“ç„¶ï¼Œè¿™äº› IIFE ä¹Ÿä¸è¿‡å°±æ˜¯å‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°† i ä¼ é€’è¿›å»ï¼Œå¦‚æœæ„¿æ„çš„è¯å¯ä»¥å°†å˜é‡\n\nåå®šä¸º jï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è¿˜å«ä½œ iã€‚æ— è®ºå¦‚ä½•è¿™æ®µä»£ç ç°åœ¨å¯ä»¥å·¥ä½œäº†ã€‚\n åœ¨è¿­ä»£å†…ä½¿ç”¨ IIFE ä¼šä¸ºæ¯ä¸ªè¿­ä»£éƒ½ç”Ÿæˆä¸€ä¸ªæ–°çš„ä½œç”¨åŸŸï¼Œä½¿å¾—å»¶è¿Ÿå‡½æ•°çš„å›è°ƒå¯ä»¥å°†æ–°çš„\n\nä½œç”¨åŸŸå°é—­åœ¨æ¯ä¸ªè¿­ä»£å†…éƒ¨ï¼Œæ¯ä¸ªè¿­ä»£ä¸­éƒ½ä¼šå«æœ‰ä¸€ä¸ªå…·æœ‰æ­£ç¡®å€¼çš„å˜é‡ä¾›æˆ‘ä»¬è®¿é—®ã€‚ é—®é¢˜è§£å†³å•¦!\n\nå½“ç„¶äº†ï¼Œè‚¯å®šæœ‰ç”¨å—çº§ä½œç”¨åŸŸ`let`çš„ï¼Œé‚£æ ·å…¶å®æ˜¯æ›´å®Œç¾çš„ã€‚\n\n```js\nfor (let i=1; i<=5; i++) { \n  \tsetTimeout( function timer() {\n  \t\tconsole.log( i ); \n    },1000 );\n}\n```\n\n### é—­åŒ…ä¸æ¨¡å—\n\nå¾ˆæ—©ä¹‹å‰ï¼Œæˆ‘ä»¬å¼•ç”¨çš„jsæ–‡ä»¶å†…éƒ¨çš„å˜é‡å…¶å®éƒ½æ˜¯æŒ‚è½½åœ¨windowä¸Šé¢çš„ï¼Œä¹…è€Œä¹…ä¹‹å˜é‡åå¾ˆå¯èƒ½ä¼šé‡å¤=>è¦†ç›–=>BUG=>éš¾ä»¥è¿½å¯»çš„BUG\n\næ‰€ä»¥å¾ˆéœ€è¦æ¨¡å—çš„è¿™ä¸ªæ¦‚å¿µæ¥è§£å†³ã€‚\n\næ¨¡å—çš„å‘å±•æˆ‘åˆ†ä¸ºä¸‰å—ï¼šä¸Šå¤æ—¶ä»£ï¼Œè¿‘ç°ä»£ï¼Œç°ä»£\n\n#### ä¸Šå¤æ—¶ä»£çš„æ¨¡å—\n\né—­åŒ…æœ€å¼ºå¤§çš„åŠŸèƒ½=>ã€Šæ¨¡å—ã€‹\n\nçœ‹ä¸ªä¾‹å­\n\n```js\nfunction a(){\n  var q = 1;\n  var w = [1, 2];\n  \n  function getQ(){\n    console.log(q)\n  }\n  \n  function getW(){\n    console.log(w)\n  }\n  return {\n    getQ: getQ,\n    getW: getW,\n  }\n}\n\nvar f = a(); \nf.getQ(); // 1\nf.getW(); // [1, 2]\n```\n\næˆ‘ä»¬ä»”ç»†çš„å‰–æä¸€ä¸‹è¿™æ®µä»£ç ï¼Œ `a`æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬ç”¨aåˆ›å»ºäº†ä¸€ä¸ªæ¨¡å—å®ä¾‹ã€‚æ³¨æ„ä¸€ä¸‹ï¼šå¦‚æœä¸æ‰§è¡Œ `getQ` æˆ–è€… `getW` è¿™ä¸ªé—­åŒ…å°±æ— æ³•åˆ›å»ºï¼Œå› ä¸ºåœ¨å‡½æ•°aå†…éƒ¨çš„getQå’ŒgetWéƒ½åªæ˜¯å¯¹å˜é‡qå’Œå˜äº†wçš„å¼•ç”¨å£°æ˜ï¼›æ²¡æœ‰å®å®åœ¨åœ¨çš„è°ƒç”¨å°±æ²¡æœ‰åˆ›å»ºä½œç”¨åŸŸï¼Œä¹Ÿæ²¡æœ‰å¼€è¾Ÿå†…å­˜ç©ºé—´ã€‚\n\nå¼•ç”¨ä¸€å¥ã€Šä½ ä¸çŸ¥é“çš„JavaScript-ä¸Šã€‹ä¸­çš„ä¸€å¥è¯ï¼š\n\n> å¦‚æœä¸æ‰§è¡Œ å¤–éƒ¨å‡½æ•°ï¼Œå†…éƒ¨ä½œç”¨åŸŸå’Œé—­åŒ…éƒ½æ— æ³•è¢«åˆ›å»ºã€‚\n\nå…¶æ¬¡ï¼Œa() è¿”å›ä¸€ä¸ªç”¨å¯¹è±¡å­—é¢é‡è¯­æ³• { key: value, ... } æ¥è¡¨ç¤ºçš„å¯¹è±¡ã€‚è¿™ ä¸ªè¿”å›çš„å¯¹è±¡ä¸­å«æœ‰å¯¹å†…éƒ¨å‡½æ•°è€Œä¸æ˜¯å†…éƒ¨æ•°æ®å˜é‡çš„å¼•ç”¨ã€‚æˆ‘ä»¬ä¿æŒå†…éƒ¨æ•°æ®å˜é‡æ˜¯éš è—ä¸”ç§æœ‰çš„çŠ¶æ€ã€‚å¯ä»¥å°†è¿™ä¸ªå¯¹è±¡ç±»å‹çš„è¿”å›å€¼çœ‹ä½œæœ¬è´¨ä¸Šæ˜¯æ¨¡å—çš„å…¬å…± APIã€‚\n\nè¿™ä¸ªå¯¹è±¡ç±»å‹çš„è¿”å›å€¼æœ€ç»ˆè¢«èµ‹å€¼ç»™å¤–éƒ¨çš„å˜é‡ fï¼Œç„¶åå°±å¯ä»¥é€šè¿‡å®ƒæ¥è®¿é—® API ä¸­çš„ å±æ€§æ–¹æ³•ï¼Œæ¯”å¦‚ f.getW()ã€‚\n\n> ä»æ¨¡å—ä¸­è¿”å›ä¸€ä¸ªå®é™…çš„å¯¹è±¡å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è¿”å›ä¸€ä¸ªå†…éƒ¨å‡½ æ•°ã€‚jQuery å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚jQuery å’Œ $ æ ‡è¯†ç¬¦å°±æ˜¯ jQuery æ¨¡å—çš„å…¬ å…± APIï¼Œä½†å®ƒä»¬æœ¬èº«éƒ½æ˜¯å‡½æ•°(ç”±äºå‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ï¼Œå®ƒä»¬æœ¬èº«ä¹Ÿå¯ä»¥æ‹¥æœ‰å± æ€§)ã€‚\n\nå…¶å®æˆ‘ä»¬è¿™æ ·æ¯æ¬¡è°ƒç”¨ä¸€æ¬¡`aå‡½æ•°`ç›¸å½“äºåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„æ¨¡å—å®ä¾‹ã€‚\n\nå‡å¦‚ï¼Œæ­¤æ—¶æˆ‘ä»¬å¸Œæœ›åªè¦ä¸€ä¸ªå®ä¾‹ï¼Œé‚£å’‹åŠå‘¢ï¼Ÿ\n\nå¤©é™çŒ›ç”·----IIFEï¼ˆç«‹å³æ‰§è¡Œå‡½æ•°ï¼‰\n\n=ã€‹\n\n```js\nvar f = (function a(){\n  var q = 1;\n  var w = [1, 2];\n  \n  function getQ(){\n    console.log(q)\n  }\n  \n  function getW(){\n    console.log(w)\n  }\n  return {\n    getQ: getQ,\n    getW: getW,\n  }\n})(); \n\nf.getQ(); // 1\nf.getW(); // [1, 2]\n```\n\nè¿™ä¸ªæ¨¡å—åªå±äºfä¸€ä¸ªäººï¼Œè¦ä¿®æ”¹åªèƒ½æ‰¾få¸®å¿™äº†ã€‚\n\næ—¢ç„¶æ¨¡å—ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé‚£æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥ä¼ å‚å‘€ï¼Ÿ\n\næ˜¯çš„ï¼Œç¨ä½œä¿®æ”¹å°±å¥½äº†ã€‚\n\n```js\nfunction a(id){\n  var q = 1;\n  var w = [1, 2];\n  \n  function getQ(){\n    console.log(q)\n  }\n  \n  function getW(){\n    console.log(w)\n  }\n  \n  function getId(){\n    console.log(id)\n  }\n  return {\n    getQ: getQ,\n    getW: getW,\n    getId: getId,\n  }\n}\n\nvar f = a(99); \nf.getQ(); // 1\nf.getW(); // [1, 2]\nf.getId(); // 99\n```\n\né‚£æˆ‘æƒ³ä¿®æ”¹æ¨¡å—å†…éƒ¨çš„ä¸œè¥¿å’‹åŠæï¼Ÿ\n\nå®‰æ’ï¼\n\n```js\nfunction a(id){\n  var q = 1;\n  var w = [1, 2];\n  \n  function getQ(){\n    console.log(q)\n  }\n  \n  function getW(){\n    console.log(w)\n  }\n  \n  function getId(){\n    console.log(id)\n  }\n  \n  function change(){\n    q = q + 1\n  }\n  return {\n    getQ: getQ,\n    getW: getW,\n    getId: getId,\n    change: change,\n  }\n}\n\nvar f = a(99); \nf.getQ(); // 1\nf.getW(); // [1, 2]\nf.getId(); // 99\nf.change(); // 99\nf.getQ(); // 2\n```\n\né€šè¿‡åœ¨æ¨¡å—å®ä¾‹çš„å†…éƒ¨ä¿ç•™å¯¹å…¬å…± API å¯¹è±¡çš„å†…éƒ¨å¼•ç”¨ï¼Œå¯ä»¥ä»å†…éƒ¨å¯¹æ¨¡å—å®ä¾‹è¿›è¡Œä¿® æ”¹ï¼ŒåŒ…æ‹¬æ·»åŠ æˆ–åˆ é™¤æ–¹æ³•å’Œå±æ€§ï¼Œä»¥åŠä¿®æ”¹å®ƒä»¬çš„å€¼ã€‚\n\n#### è¿‘ç°ä»£çš„æ¨¡å—\n\n##### AMDï¼ˆå¾ˆå°‘ç”¨åˆ°äº†ï¼‰\n\nAMD å³Asynchronous Module Definitionï¼Œä¸­æ–‡åæ˜¯å¼‚æ­¥æ¨¡å—å®šä¹‰çš„æ„æ€ã€‚å®ƒæ˜¯ä¸€ä¸ªåœ¨æµè§ˆå™¨ç«¯æ¨¡å—åŒ–å¼€å‘çš„è§„èŒƒ\n\nç”±äºä¸æ˜¯JavaScriptåŸç”Ÿæ”¯æŒï¼Œä½¿ç”¨AMDè§„èŒƒè¿›è¡Œé¡µé¢å¼€å‘éœ€è¦ç”¨åˆ°å¯¹åº”çš„åº“å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯å¤§åé¼é¼RequireJSï¼Œå®é™…ä¸ŠAMD æ˜¯ RequireJS åœ¨æ¨å¹¿è¿‡ç¨‹ä¸­å¯¹æ¨¡å—å®šä¹‰çš„è§„èŒƒåŒ–çš„äº§å‡º\n\nrequireJSä¸»è¦è§£å†³ä¸¤ä¸ªé—®é¢˜\n\n1ã€å¤šä¸ªjsæ–‡ä»¶å¯èƒ½æœ‰ä¾èµ–å…³ç³»ï¼Œè¢«ä¾èµ–çš„æ–‡ä»¶éœ€è¦æ—©äºä¾èµ–å®ƒçš„æ–‡ä»¶åŠ è½½åˆ°æµè§ˆå™¨ \n2ã€jsåŠ è½½çš„æ—¶å€™æµè§ˆå™¨ä¼šåœæ­¢é¡µé¢æ¸²æŸ“ï¼ŒåŠ è½½æ–‡ä»¶è¶Šå¤šï¼Œé¡µé¢å¤±å»å“åº”æ—¶é—´è¶Šé•¿ \nçœ‹ä¸€ä¸ªä½¿ç”¨requireJSçš„ä¾‹å­\n\n```js\n/* \n\n*  a.js \n\n*  åˆ›å»ºä¸€ä¸ªåä¸ºâ€œaâ€çš„æ¨¡å—\n\n*/\n\n\n\ndefine('a', function(require, exports, module) {   \n\n  exports.getTime = function() {   \n\n    return new Date();   \n\n  }  \n\n});\n\n\n\n/* \n\n*  b.js \n\n*  åˆ›å»ºä¸€ä¸ªåä¸ºâ€œbâ€çš„æ¨¡å—ï¼ŒåŒæ—¶ä½¿ç”¨ä¾èµ–requireã€exportså’Œåä¸ºâ€œaâ€çš„æ¨¡å—ï¼š\n\n*/\n\ndefine('b', ['require', 'exports', 'a'], function(require, exports, a) {   exports.test = function() {\n\n    return {   \n\n      now: a.getTime()    \n\n    };   \n\n  }  \n\n});\n\n\n\n/* main.js */\n\nrequire(['b'], function(b) {   \n\n  console.log(b.test());  \n\n});\n```\n\n**è¯­æ³•**\n\nrequireJSå®šä¹‰äº†ä¸€ä¸ªå‡½æ•° defineï¼Œå®ƒæ˜¯å…¨å±€å˜é‡ï¼Œç”¨æ¥å®šä¹‰æ¨¡å—\n\ndefine(id?, dependencies?, factory);\n\n1. idï¼šå¯é€‰å‚æ•°ï¼Œç”¨æ¥å®šä¹‰æ¨¡å—çš„æ ‡è¯†ï¼Œå¦‚æœæ²¡æœ‰æä¾›è¯¥å‚æ•°ï¼Œè„šæœ¬æ–‡ä»¶åï¼ˆå»æ‰æ‹“å±•åï¼‰\n2. dependenciesï¼šæ˜¯ä¸€ä¸ªå½“å‰æ¨¡å—ä¾èµ–çš„æ¨¡å—åç§°æ•°ç»„\n3. factoryï¼šå·¥å‚æ–¹æ³•ï¼Œæ¨¡å—åˆå§‹åŒ–è¦æ‰§è¡Œçš„å‡½æ•°æˆ–å¯¹è±¡ã€‚å¦‚æœä¸ºå‡½æ•°ï¼Œå®ƒåº”è¯¥åªè¢«æ‰§è¡Œä¸€æ¬¡ã€‚å¦‚æœæ˜¯å¯¹è±¡ï¼Œæ­¤å¯¹è±¡åº”è¯¥ä¸ºæ¨¡å—çš„è¾“å‡ºå€¼ \n   åœ¨é¡µé¢ä¸Šä½¿ç”¨requireå‡½æ•°åŠ è½½æ¨¡å—\n\nrequire([dependencies], function(){}); \nrequire()å‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°\n\n1. ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¡¨ç¤ºæ‰€ä¾èµ–çš„æ¨¡å—\n2. ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå½“å‰é¢æŒ‡å®šçš„æ¨¡å—éƒ½åŠ è½½æˆåŠŸåï¼Œå®ƒå°†è¢«è°ƒç”¨ã€‚åŠ è½½çš„æ¨¡å—ä¼šä»¥å‚æ•°å½¢å¼ä¼ å…¥è¯¥å‡½æ•°ï¼Œä»è€Œåœ¨å›è°ƒå‡½æ•°å†…éƒ¨å°±å¯ä»¥ä½¿ç”¨è¿™äº›æ¨¡å—\n\nrequire()å‡½æ•°åœ¨åŠ è½½ä¾èµ–çš„å‡½æ•°çš„æ—¶å€™æ˜¯å¼‚æ­¥åŠ è½½çš„ï¼Œè¿™æ ·æµè§ˆå™¨ä¸ä¼šå¤±å»å“åº”ï¼Œå®ƒæŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼Œåªæœ‰å‰é¢çš„æ¨¡å—éƒ½åŠ è½½æˆåŠŸåï¼Œæ‰ä¼šè¿è¡Œï¼Œè§£å†³äº†ä¾èµ–æ€§çš„é—®é¢˜ã€‚\n\n##### CMDï¼ˆå¾ˆå°‘ç”¨åˆ°äº†ï¼‰\n\nCMD å³Common Module Definitioné€šç”¨æ¨¡å—å®šä¹‰ï¼ŒCMDè§„èŒƒæ˜¯å›½å†…å‘å±•å‡ºæ¥çš„ï¼Œå°±åƒAMDæœ‰ä¸ªrequireJSï¼ŒCMDæœ‰ä¸ªæµè§ˆå™¨çš„å®ç°SeaJSï¼ŒSeaJSè¦è§£å†³çš„é—®é¢˜å’ŒrequireJSä¸€æ ·ï¼Œåªä¸è¿‡åœ¨æ¨¡å—å®šä¹‰æ–¹å¼å’Œæ¨¡å—åŠ è½½ï¼ˆå¯ä»¥è¯´è¿è¡Œã€è§£æï¼‰æ—¶æœºä¸Šæœ‰æ‰€ä¸åŒ \n**è¯­æ³•** \nSea.js æ¨å´‡ä¸€ä¸ªæ¨¡å—ä¸€ä¸ªæ–‡ä»¶ï¼Œéµå¾ªç»Ÿä¸€çš„å†™æ³• \ndefine(id?, deps?, factory) \nå› ä¸ºCMDæ¨å´‡\n\n1. ä¸€ä¸ªæ–‡ä»¶ä¸€ä¸ªæ¨¡å—ï¼Œæ‰€ä»¥ç»å¸¸å°±ç”¨æ–‡ä»¶åä½œä¸ºæ¨¡å—id\n2. CMDæ¨å´‡ä¾èµ–å°±è¿‘ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸åœ¨defineçš„å‚æ•°ä¸­å†™ä¾èµ–ï¼Œåœ¨factoryä¸­å†™\n\nfactoryæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæœ‰ä¸‰ä¸ªå‚æ•°ï¼Œfunction(require, exports, module)\n\n1. require æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œæ¥å— æ¨¡å—æ ‡è¯† ä½œä¸ºå”¯ä¸€å‚æ•°ï¼Œç”¨æ¥è·å–å…¶ä»–æ¨¡å—æä¾›çš„æ¥å£ï¼šrequire(id)\n2. exports æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨æ¥å‘å¤–æä¾›æ¨¡å—æ¥å£\n3. module æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¸Šé¢å­˜å‚¨äº†ä¸å½“å‰æ¨¡å—ç›¸å…³è”çš„ä¸€äº›å±æ€§å’Œæ–¹æ³•\n\nçœ‹ä¸ªä¾‹å­ï¼š\n\n```js\n/* \n\n*  a.js \n\n*  ä¸€ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—\n\n*/\n\ndefine(function(require, exports, module) {   \n\n  exports.getTime = function() {   \n\n    return new Date();   \n\n  }  \n\n});\n\n\n\n/* main.js */\n\ndefine(function(require, exports, module) {  \n\n  /* æŒ‰éœ€åŠ è½½a.js */ \n\n  var a = require('./a');    \n\n  console.log(a.getTime());  \n\n});\n```\n\n##### AMDå’ŒCMDçš„åŒºåˆ«\n\næœ€æ˜æ˜¾çš„åŒºåˆ«å°±æ˜¯åœ¨æ¨¡å—å®šä¹‰æ—¶å¯¹ä¾èµ–çš„å¤„ç†ä¸åŒ\n\n**1ã€AMDæ¨å´‡ä¾èµ–å‰ç½®ï¼Œåœ¨å®šä¹‰æ¨¡å—çš„æ—¶å€™å°±è¦å£°æ˜å…¶ä¾èµ–çš„æ¨¡å—** \n**2ã€CMDæ¨å´‡å°±è¿‘ä¾èµ–ï¼Œåªæœ‰åœ¨ç”¨åˆ°æŸä¸ªæ¨¡å—çš„æ—¶å€™å†å»require** \nè¿™ç§åŒºåˆ«å„æœ‰ä¼˜åŠ£ï¼Œåªæ˜¯è¯­æ³•ä¸Šçš„å·®è·ï¼Œè€Œä¸”requireJSå’ŒSeaJSéƒ½æ”¯æŒå¯¹æ–¹çš„å†™æ³•\n\nAMDå’ŒCMDæœ€å¤§çš„åŒºåˆ«æ˜¯å¯¹ä¾èµ–æ¨¡å—çš„æ‰§è¡Œæ—¶æœºå¤„ç†ä¸åŒï¼Œæ³¨æ„ä¸æ˜¯åŠ è½½çš„æ—¶æœºæˆ–è€…æ–¹å¼ä¸åŒ\n\nå¾ˆå¤šäººè¯´requireJSæ˜¯å¼‚æ­¥åŠ è½½æ¨¡å—ï¼ŒSeaJSæ˜¯åŒæ­¥åŠ è½½æ¨¡å—ï¼Œè¿™ä¹ˆç†è§£å®é™…ä¸Šæ˜¯ä¸å‡†ç¡®çš„ï¼Œå…¶å®åŠ è½½æ¨¡å—éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œåªä¸è¿‡AMDä¾èµ–å‰ç½®ï¼Œjså¯ä»¥æ–¹ä¾¿çŸ¥é“ä¾èµ–æ¨¡å—æ˜¯è°ï¼Œç«‹å³åŠ è½½ï¼Œè€ŒCMDå°±è¿‘ä¾èµ–ï¼Œéœ€è¦ä½¿ç”¨æŠŠæ¨¡å—å˜ä¸ºå­—ç¬¦ä¸²è§£æä¸€éæ‰çŸ¥é“ä¾èµ–äº†é‚£äº›æ¨¡å—ï¼Œè¿™ä¹Ÿæ˜¯å¾ˆå¤šäººè¯Ÿç—…CMDçš„ä¸€ç‚¹ï¼Œç‰ºç‰²æ€§èƒ½æ¥å¸¦æ¥å¼€å‘çš„ä¾¿åˆ©æ€§ï¼Œå®é™…ä¸Šè§£ææ¨¡å—ç”¨çš„æ—¶é—´çŸ­åˆ°å¯ä»¥å¿½ç•¥\n\nä¸ºä»€ä¹ˆæˆ‘ä»¬è¯´ä¸¤ä¸ªçš„åŒºåˆ«æ˜¯ä¾èµ–æ¨¡å—æ‰§è¡Œæ—¶æœºä¸åŒï¼Œä¸ºä»€ä¹ˆå¾ˆå¤šäººè®¤ä¸ºADMæ˜¯å¼‚æ­¥çš„ï¼ŒCMDæ˜¯åŒæ­¥çš„ï¼ˆé™¤äº†åå­—çš„åŸå› ã€‚ã€‚ã€‚ï¼‰\n\nåŒæ ·éƒ½æ˜¯å¼‚æ­¥åŠ è½½æ¨¡å—ï¼ŒAMDåœ¨åŠ è½½æ¨¡å—å®Œæˆåå°±ä¼šæ‰§è¡Œæ”¹æ¨¡å—ï¼Œæ‰€æœ‰æ¨¡å—éƒ½åŠ è½½æ‰§è¡Œå®Œåä¼šè¿›å…¥requireçš„å›è°ƒå‡½æ•°ï¼Œæ‰§è¡Œä¸»é€»è¾‘ï¼Œè¿™æ ·çš„æ•ˆæœå°±æ˜¯ä¾èµ–æ¨¡å—çš„æ‰§è¡Œé¡ºåºå’Œä¹¦å†™é¡ºåºä¸ä¸€å®šä¸€è‡´ï¼Œçœ‹ç½‘ç»œé€Ÿåº¦ï¼Œå“ªä¸ªå…ˆä¸‹è½½ä¸‹æ¥ï¼Œå“ªä¸ªå…ˆæ‰§è¡Œï¼Œä½†æ˜¯ä¸»é€»è¾‘ä¸€å®šåœ¨æ‰€æœ‰ä¾èµ–åŠ è½½å®Œæˆåæ‰æ‰§è¡Œ\n\nCMDåŠ è½½å®ŒæŸä¸ªä¾èµ–æ¨¡å—åå¹¶ä¸æ‰§è¡Œï¼Œåªæ˜¯ä¸‹è½½è€Œå·²ï¼Œåœ¨æ‰€æœ‰ä¾èµ–æ¨¡å—åŠ è½½å®Œæˆåè¿›å…¥ä¸»é€»è¾‘ï¼Œé‡åˆ°requireè¯­å¥çš„æ—¶å€™æ‰æ‰§è¡Œå¯¹åº”çš„æ¨¡å—ï¼Œè¿™æ ·æ¨¡å—çš„æ‰§è¡Œé¡ºåºå’Œä¹¦å†™é¡ºåºæ˜¯å®Œå…¨ä¸€è‡´çš„\n\nè¿™ä¹Ÿæ˜¯å¾ˆå¤šäººè¯´AMDç”¨æˆ·ä½“éªŒå¥½ï¼Œå› ä¸ºæ²¡æœ‰å»¶è¿Ÿï¼Œä¾èµ–æ¨¡å—æå‰æ‰§è¡Œäº†ï¼ŒCMDæ€§èƒ½å¥½ï¼Œå› ä¸ºåªæœ‰ç”¨æˆ·éœ€è¦çš„æ—¶å€™æ‰æ‰§è¡Œçš„åŸå› \n\n\n\n#### ç°ä»£çš„æ¨¡å—\n\n##### CommonJS\n\nCommonJS æœ€æ—©æ˜¯ Node åœ¨ä½¿ç”¨ï¼Œç›®å‰ä¹Ÿä»ç„¶å¹¿æ³›ä½¿ç”¨ï¼Œæ¯”å¦‚åœ¨ Webpack ä¸­ä½ å°±èƒ½è§åˆ°å®ƒï¼Œå½“ç„¶ç›®å‰åœ¨ Node ä¸­çš„æ¨¡å—ç®¡ç†å·²ç»å’Œ CommonJS æœ‰ä¸€äº›åŒºåˆ«äº†ã€‚\n\n```js\n// a.js\nmodule.exports = {\n    a: 1\n}\n// or \nexports.a = 1\n\n// b.js\nvar module = require('./a.js')\nmodule.a // -> log 1\n```\n\nå› ä¸º CommonJS è¿˜æ˜¯ä¼šä½¿ç”¨åˆ°çš„ï¼Œæ‰€ä»¥è¿™é‡Œä¼šå¯¹ä¸€äº›ç–‘éš¾ç‚¹è¿›è¡Œè§£æ\n\nå…ˆè¯´ `require` å§\n\n```js\nvar module = require('./a.js')\nmodule.a \n// è¿™é‡Œå…¶å®å°±æ˜¯åŒ…è£…äº†ä¸€å±‚ç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œè¿™æ ·å°±ä¸ä¼šæ±¡æŸ“å…¨å±€å˜é‡äº†ï¼Œ\n// é‡è¦çš„æ˜¯ module è¿™é‡Œï¼Œmodule æ˜¯ Node ç‹¬æœ‰çš„ä¸€ä¸ªå˜é‡\nmodule.exports = {\n    a: 1\n}\n// module åŸºæœ¬å®ç°\nvar module = {\n  id: 'xxxx', // æˆ‘æ€»å¾—çŸ¥é“æ€ä¹ˆå»æ‰¾åˆ°ä»–å§\n  exports: {} // exports å°±æ˜¯ä¸ªç©ºå¯¹è±¡\n}\n// è¿™ä¸ªæ˜¯ä¸ºä»€ä¹ˆ exports å’Œ module.exports ç”¨æ³•ç›¸ä¼¼çš„åŸå› \nvar exports = module.exports \nvar load = function (module) {\n    // å¯¼å‡ºçš„ä¸œè¥¿\n    var a = 1\n    module.exports = a\n    return module.exports\n};\n// ç„¶åå½“æˆ‘ require çš„æ—¶å€™å»æ‰¾åˆ°ç‹¬ç‰¹çš„\n// idï¼Œç„¶åå°†è¦ä½¿ç”¨çš„ä¸œè¥¿ç”¨ç«‹å³æ‰§è¡Œå‡½æ•°åŒ…è£…ä¸‹ï¼Œover\n```\n\nå¦å¤–è™½ç„¶ `exports` å’Œ `module.exports` ç”¨æ³•ç›¸ä¼¼ï¼Œä½†æ˜¯ä¸èƒ½å¯¹ `exports` ç›´æ¥èµ‹å€¼ã€‚å› ä¸º `var exports = module.exports` è¿™å¥ä»£ç è¡¨æ˜äº† `exports` å’Œ `module.exports` äº«æœ‰ç›¸åŒåœ°å€ï¼Œé€šè¿‡æ”¹å˜å¯¹è±¡çš„å±æ€§å€¼ä¼šå¯¹ä¸¤è€…éƒ½èµ·æ•ˆï¼Œä½†æ˜¯å¦‚æœç›´æ¥å¯¹ `exports` èµ‹å€¼å°±ä¼šå¯¼è‡´ä¸¤è€…ä¸å†æŒ‡å‘åŒä¸€ä¸ªå†…å­˜åœ°å€ï¼Œä¿®æ”¹å¹¶ä¸ä¼šå¯¹ `module.exports` èµ·æ•ˆã€‚\n\n##### ES Module\n\nES Module æ˜¯åŸç”Ÿå®ç°çš„æ¨¡å—åŒ–æ–¹æ¡ˆï¼Œä¸ CommonJS æœ‰ä»¥ä¸‹å‡ ä¸ªåŒºåˆ«\n\n- CommonJS æ”¯æŒåŠ¨æ€å¯¼å…¥ï¼Œä¹Ÿå°±æ˜¯ `require(${path}/xx.js)`ï¼Œåè€…ç›®å‰ä¸æ”¯æŒï¼Œä½†æ˜¯å·²æœ‰ææ¡ˆ\n- CommonJS æ˜¯åŒæ­¥å¯¼å…¥ï¼Œå› ä¸ºç”¨äºæœåŠ¡ç«¯ï¼Œæ–‡ä»¶éƒ½åœ¨æœ¬åœ°ï¼ŒåŒæ­¥å¯¼å…¥å³ä½¿å¡ä½ä¸»çº¿ç¨‹å½±å“ä¹Ÿä¸å¤§ã€‚è€Œåè€…æ˜¯å¼‚æ­¥å¯¼å…¥ï¼Œå› ä¸ºç”¨äºæµè§ˆå™¨ï¼Œéœ€è¦ä¸‹è½½æ–‡ä»¶ï¼Œå¦‚æœä¹Ÿé‡‡ç”¨åŒæ­¥å¯¼å…¥ä¼šå¯¹æ¸²æŸ“æœ‰å¾ˆå¤§å½±å“\n- CommonJS åœ¨å¯¼å‡ºæ—¶éƒ½æ˜¯å€¼æ‹·è´ï¼Œå°±ç®—å¯¼å‡ºçš„å€¼å˜äº†ï¼Œå¯¼å…¥çš„å€¼ä¹Ÿä¸ä¼šæ”¹å˜ï¼Œæ‰€ä»¥å¦‚æœæƒ³æ›´æ–°å€¼ï¼Œå¿…é¡»é‡æ–°å¯¼å…¥ä¸€æ¬¡ã€‚ä½†æ˜¯ ES Module é‡‡ç”¨å®æ—¶ç»‘å®šçš„æ–¹å¼ï¼Œå¯¼å…¥å¯¼å‡ºçš„å€¼éƒ½æŒ‡å‘åŒä¸€ä¸ªå†…å­˜åœ°å€ï¼Œæ‰€ä»¥å¯¼å…¥å€¼ä¼šè·Ÿéšå¯¼å‡ºå€¼å˜åŒ–\n- ES Module ä¼šç¼–è¯‘æˆ `require/exports` æ¥æ‰§è¡Œçš„\n\n```js\n// å¼•å…¥æ¨¡å— API\nimport XXX from './a.js'\nimport { XXX } from './a.js'\n// å¯¼å‡ºæ¨¡å— API\nexport function a() {}\nexport default function() {}\n```\n\n## æ€»ç»“\n\nå½“å‡½æ•°å¯ä»¥è®°ä½å¹¶è®¿é—®æ‰€åœ¨çš„è¯æ³•ä½œç”¨åŸŸï¼Œå³ä½¿å‡½æ•°æ˜¯åœ¨å½“å‰è¯æ³•ä½œç”¨åŸŸä¹‹å¤–æ‰§è¡Œï¼Œè¿™æ—¶ å°±äº§ç”Ÿäº†é—­åŒ…ã€‚\n\n\n\n> ç´¢å¼•ï¼šhttps://juejin.im/post/5a422b036fb9a045211ef789\n\n\n\n\n\n","source":"_posts/ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—.md","raw":"---\ntitle: ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—\ndate: 2020-07-15 18:18:21\ntags: [é—­åŒ…, JavaScript, æ¨¡å—]\ncategory: [é‡æ‹¾å‰ç«¯]\ncover: /image/cover/web.jpeg\n---\n\n\næœ€è¿‘åœ¨å†™ã€é‡æ‹¾å‰ç«¯ã€‘ç³»åˆ—ï¼Œä¸‹é¢æœ‰å‡ ä¸ªå¿«é€Ÿé€šé“ï¼Œå¤§å®¶è‡ªå–\n\n[ã€é‡è¯†å‰ç«¯ã€‘åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿](https://juejin.im/post/6850418113944420359)\n\n[ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—](https://juejin.im/post/6850418117508759566)\n\n[ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this](https://juejin.im/post/6854573215658803208)\n\n[ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šJavaScriptçš„æ‰§è¡Œæœºåˆ¶](https://juejin.im/post/6859911609633767438)\n\n[ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC](https://juejin.im/post/6860375101322461198)\n\n[ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ](https://juejin.im/post/6865204092877144077)\n\n## å‰è¨€\n\nå›å¿†æˆ‘å‰å‡ å¹´çš„æ—¶å…‰ï¼Œå¤§é‡ä½¿ç”¨ JavaScript ä½†å´å®Œå…¨ä¸ç†è§£é—­åŒ…æ˜¯ä»€ä¹ˆã€‚æ€»æ˜¯æ„Ÿè§‰è¿™é—¨è¯­ è¨€æœ‰å…¶éšè”½çš„ä¸€é¢ï¼Œå¦‚æœèƒ½å¤ŸæŒæ¡å°†ä¼šåŠŸåŠ›å¤§æ¶¨ï¼Œä½†è®½åˆºçš„æ˜¯æˆ‘å§‹ç»ˆæ— æ³•æŒæ¡å…¶ä¸­çš„é—¨ é“ã€‚\n\n> JavaScriptä¸­é—­åŒ…æ— å¤„ä¸åœ¨ï¼Œä½ åªéœ€è¦èƒ½å¤Ÿè¯†åˆ«å¹¶æ‹¥æŠ±å®ƒã€‚\n>\n> æœ€åä½ æç„¶å¤§æ‚Ÿ:åŸæ¥åœ¨æˆ‘çš„ä»£ç ä¸­å·²ç»åˆ°å¤„éƒ½æ˜¯é—­åŒ…äº†ï¼Œç°åœ¨æˆ‘ç»ˆäºèƒ½ç†è§£å®ƒä»¬äº†ã€‚ç† è§£é—­åŒ…å°±å¥½åƒ Neo3 ç¬¬ä¸€æ¬¡è§åˆ°çŸ©é˜µ 4 ä¸€æ ·ã€‚\n\n## å®šä¹‰\n\nå½“å‡½æ•°å¯ä»¥è®°ä½å¹¶è®¿é—®æ‰€åœ¨çš„è¯æ³•ä½œç”¨åŸŸæ—¶ï¼Œå°±äº§ç”Ÿäº†é—­åŒ…ï¼Œå³ä½¿å‡½æ•°æ˜¯åœ¨å½“å‰è¯æ³•ä½œç”¨ åŸŸä¹‹å¤–æ‰§è¡Œã€‚\n\n```js\nfunction foo() { \n  var a = 2;\n\tfunction bar() { \n    console.log( a ); // 2\n\t}\n\tbar(); \n}\nfoo();\n```\n\nè¿™æ ·å¯èƒ½è¿˜ä¸å¤Ÿç›´è§‚ï¼Œæˆ‘ä»¬å†ä¿®æ”¹ä¸€ä¸‹ã€‚\n\n```js\nfunction foo() { \n  var a = 2;\n\tfunction bar() { \n    console.log( a ); // 2\n\t}\n\treturn bar; \n}\nvar baz = foo();\nbaz(); // 2 â€”â€” æœ‹å‹ï¼Œè¿™å°±æ˜¯é—­åŒ…çš„æ•ˆæœã€‚\n```\n\nå…¶å®ï¼Œåœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è°ƒç”¨å®Œ`foo`ä¹‹åï¼ŒJavaScriptæ£€æµ‹åˆ°åç»­ä¸ä¼šå†ç”¨åˆ°ä»–äº†ï¼Œ æ‰€ä»¥ä»–çš„å†…éƒ¨ä½œç”¨åŸŸå°±ä¼šè¢«å›æ”¶â™»ï¸ã€‚ï¼ˆæ¶‰åŠåˆ°åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œåç»­çš„æ–‡ç« æˆ‘ä»¬ä¼šè¯´åˆ°ã€‚ï¼‰\n\né—­åŒ…çš„ç¥å¥‡ä¹‹å¤„å°±åœ¨äºä»–å¯ä»¥é˜»æ­¢â™»ï¸çš„å‘ç”Ÿã€‚å› ä¸ºäº‹å®ä¸Šå†…éƒ¨ä½œç”¨åŸŸå·²ç„¶å­˜åœ¨ï¼Œé‚£ä¹ˆåˆæœ‰è°åœ¨ä½¿ç”¨å‘¢ï¼Ÿå“¦~æ˜¯æˆ‘ä»¬çš„`bar`åœ¨ä½¿ç”¨ã€‚\n\næ‹œ bar() æ‰€å£°æ˜çš„ä½ç½®æ‰€èµï¼Œå®ƒæ‹¥æœ‰æ¶µç›– foo() å†…éƒ¨ä½œç”¨åŸŸçš„é—­åŒ…ï¼Œä½¿å¾—è¯¥ä½œç”¨åŸŸèƒ½å¤Ÿä¸€ ç›´å­˜æ´»ï¼Œä»¥ä¾› bar() åœ¨ä¹‹åä»»ä½•æ—¶é—´è¿›è¡Œå¼•ç”¨ã€‚\n\nbar() ä¾ç„¶æŒæœ‰å¯¹è¯¥ä½œç”¨åŸŸçš„å¼•ç”¨ï¼Œè€Œè¿™ä¸ªå¼•ç”¨å°±å«ä½œé—­åŒ…ã€‚\n\næ‰€ä»¥æˆ‘è¯´è¯´æˆ‘è‡ªå·±çš„ç†è§£ï¼š\n\né—­åŒ…æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶çš„æ¦‚å¿µï¼Œå¦‚æœåªæ˜¯å£°æ˜æˆ–è€…å®šä¹‰ã€‚å³ä½¿ä»–ç¬¦åˆé—­åŒ…çš„è¦æ±‚é‚£ä»–ä¹Ÿä¸èƒ½æˆä¸ºä¸€ä¸ªçœŸæ­£çš„é—­åŒ…ã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºå†…å­˜åœ°å€å¹¶æ²¡æœ‰å¼€å§‹åˆ†é…ï¼Œé—­åŒ…åªæ˜¯åˆ†é…ä¹‹åé‚£ä¸€å—åœ°å€æ²¡æœ‰è¢«å›æ”¶è€Œå·²ã€‚\n\nå†å›åˆ°æˆ‘ä»¬æœ€å¼€å§‹çš„å‡½æ•°ï¼š\n\n```js\nfunction foo() { \n  var a = 2;\n\tfunction bar() { \n    console.log( a ); // 2\n\t}\n\tbar(); \n}\nfoo();\n```\n\nä¸€ä¸ªå‡½æ•°fooå†…æœ‰ä¸€ä¸ªå‡½æ•°barã€‚å¹¶ä¸”å‡½æ•°barç”¨åˆ°äº†å‡½æ•°fooçš„å˜é‡ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç§°è¿™ä¸ªå¼•ç”¨è¿‡ç¨‹ä¸ºâ€œé—­åŒ…â€ã€‚ä½†æ˜¯æˆ‘ä»¬è¿™ä¸ªå‡½æ•°fooå¿…é¡»è¢«è°ƒç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ä¾‹å­åœ°ä¸‹è°ƒç”¨äº†ä¸€ä¸‹å‡½æ•°fooã€‚\n\nå†å›åˆ°æˆ‘ä»¬é‚£ä¸ªè¾ƒä¸ºæ¸…æ™°çš„ä¾‹å­\n\n```js\nfunction foo() { \n  var a = 2;\n\tfunction bar() { \n    console.log( a ); // 2\n\t}\n\treturn bar; \n}\nvar baz = foo();\nbaz(); // 2 â€”â€” æœ‹å‹ï¼Œè¿™å°±æ˜¯é—­åŒ…çš„æ•ˆæœã€‚\n```\n\nè¿™ä¸ªåº”è¯¥æ˜¯å¤§ä¼—è®¤çŸ¥ä¸Šéå¸¸ç»å…¸çš„ä¸€ä¸ªé—­åŒ…äº†å§ï¼Ÿä½†æ˜¯å‡å¦‚è¯´è¿™ä¸ªfooå‡½æ•°æ²¡æœ‰è¢«è°ƒç”¨ï¼Œé‚£ä¹ˆæˆ‘è®¤ä¸ºä»–å°±ä¸æ˜¯ä¸€ä¸ªé—­åŒ…ã€‚\n\n## å®è·µ\n\n### å¸¸è§çš„é—­åŒ…\n\nå‰é¢çš„ä»£ç ç‰‡æ®µæœ‰ç‚¹æ­»æ¿ï¼Œå¹¶ä¸”ä¸ºäº†è§£é‡Šå¦‚ä½•ä½¿ç”¨é—­åŒ…è€Œäººä¸ºåœ°åœ¨ç»“æ„ä¸Šè¿›è¡Œäº†ä¿®é¥°ã€‚ä½ å·²ç»å†™è¿‡çš„ä»£ç ä¸­ä¸€å®šåˆ°å¤„éƒ½æ˜¯é—­åŒ…çš„èº«å½±ã€‚ ç°åœ¨è®©æˆ‘ä»¬æ¥ææ‡‚è¿™ä¸ªäº‹å®ã€‚\n\n```js\nfunction wait(message) {\n\tsetTimeout( \n\t\tfunction timer() { \n\t\t\tconsole.log( message );\n\t}, 1000 ); \n}\nwait( \"Hello, closure!\" );\n```\n\nè¿™ä¸ªä¾‹å­éå¸¸å¸¸è§ï¼Œä»£ç å¾ˆç®€å•ï¼Œå°±æ˜¯1ç§’é’Ÿä¹‹åè¾“å‡ºæˆ‘ä»¬ä¼ å…¥çš„å‚æ•°ã€‚\n\nä½†æ˜¯æˆ‘ä»¬ä»”ç»†çœ‹å°±èƒ½çœ‹è§é—­åŒ…çš„å½±å­ï¼Œä¸€ç§’é’Ÿä¹‹åï¼Œ`message`è¿˜æ˜¯å¯ä»¥è¢«`timer`è®¿é—®åˆ°ã€‚å¹¶æ²¡æœ‰è¢«å›æ”¶â™»ï¸æ‰ã€‚\n\n> è¿™å°±æ˜¯é—­åŒ…\n\næœ¬è´¨ä¸Šæ— è®ºä½•æ—¶ä½•åœ°ï¼Œå¦‚æœå°†å‡½æ•°(è®¿é—®å®ƒä»¬å„è‡ªçš„è¯æ³•ä½œç”¨åŸŸ)å½“ä½œç¬¬ä¸€ çº§çš„å€¼ç±»å‹å¹¶åˆ°å¤„ä¼ é€’ï¼Œä½ å°±ä¼šçœ‹åˆ°é—­åŒ…åœ¨è¿™äº›å‡½æ•°ä¸­çš„åº”ç”¨ã€‚åœ¨å®šæ—¶å™¨ã€äº‹ä»¶ç›‘å¬å™¨ã€ Ajax è¯·æ±‚ã€è·¨çª—å£é€šä¿¡ã€Web Workers æˆ–è€…ä»»ä½•å…¶ä»–çš„å¼‚æ­¥(æˆ–è€…åŒæ­¥)ä»»åŠ¡ä¸­ï¼Œåªè¦ä½¿ ç”¨äº†å›è°ƒå‡½æ•°ï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨ä½¿ç”¨é—­åŒ…!\n\n### é—­åŒ…ä¸å¾ªç¯\n\nè¯´åˆ°è¿™é‡Œè‚¯å®šæœ‰äººé©¬ä¸Šå°±æƒ³åˆ°äº†æœ€ç»å…¸çš„é¢è¯•é¢˜ï¼šè¯·å†™å‡ºä»¥ä¸‹çš„è¾“å‡ºå†…å®¹\n\n```js\nfor (var i=1; i<=5; i++) { \n\tsetTimeout( function timer() {\n\t\tconsole.log( i ); \n  }, i*1000 );\n}\n```\n\næ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯¹è¿™æ®µä»£ç è¡Œä¸ºçš„é¢„æœŸæ˜¯åˆ†åˆ«è¾“å‡ºæ•°å­— 1~5ï¼Œæ¯ç§’ä¸€æ¬¡ï¼Œæ¯æ¬¡ä¸€ä¸ªã€‚\n\nä½†å®é™…ä¸Šï¼Œè¿™æ®µä»£ç åœ¨è¿è¡Œæ—¶ä¼šä»¥æ¯ç§’ä¸€æ¬¡çš„é¢‘ç‡è¾“å‡ºäº”æ¬¡ 6ã€‚\n\nè¿™æ˜¯ä¸ºä»€ä¹ˆ?\n\nå› ä¸ºç­‰åˆ°æ‰§è¡Œ`console.log`çš„æ—¶å€™ï¼Œé‚£ä¸ªæ—¶å€™çš„iå·²ç»åœ¨forçš„è°ƒæ•™ä¸‹å˜æˆäº†6äº†ï¼Œæ‰€ä»¥ä»–ä»¬å»å–åªèƒ½å–åˆ°6ï¼›\n\nï¼ˆäº‹å®ä¸Šï¼Œ å½“å®šæ—¶å™¨è¿è¡Œæ—¶å³ä½¿æ¯ä¸ªè¿­ä»£ä¸­æ‰§è¡Œçš„æ˜¯setTimeout(.., 0)ï¼Œæ‰€æœ‰çš„å›è°ƒå‡½æ•°ä¾ç„¶æ˜¯åœ¨å¾ª ç¯ç»“æŸåæ‰ä¼šè¢«æ‰§è¡Œï¼Œå› æ­¤ä¼šæ¯æ¬¡è¾“å‡ºä¸€ä¸ª 6 å‡ºæ¥ã€‚è¿™ä¸ªæ¶‰åŠåˆ°æ—¶é—´å¾ªç¯ï¼Œåé¢çš„æ–‡ç« ä¼šå…·ä½“çš„å±•å¼€æ¥è®²ï¼‰\n\né€šè¿‡æˆ‘ä»¬åˆšåˆšçš„å­¦ä¹ çŸ¥é“ï¼Œå¦‚æœæˆ‘ä»¬åˆ›é€ äº†ä¸€ä¸ªé—­åŒ…ï¼Œè¿™æ ·çš„è¯è¿™ä¸ªiä¸å°±ä¸ä¼šè¢«å›æ”¶äº†å—ï¼Ÿ\n\nokï¼Œæˆ‘ä»¬è¯•è¯•\n\n```js\nfor (var i=1; i<=5; i++) { \n  (function() {\n\t\tsetTimeout( function timer() { \n      console.log( i );\n    }, i*1000 );\n  })();\n}\n\n```\n\nè¿™æ ·èƒ½è¡Œå—?è¯•è¯•å§ï¼Œåœ¨Chromeæˆ–è€…nodeé‡Œé¢è¯•è¯•å§ï¼Œæˆ‘ç­‰ç€ä½ ã€‚\n\næˆ‘ä¸å–å…³å­äº†ã€‚è¿™æ ·ä¸è¡Œã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆå‘¢?æˆ‘ä»¬ç°åœ¨æ˜¾ç„¶æ‹¥æœ‰æ›´å¤šçš„è¯æ³•ä½œç”¨åŸŸäº†ã€‚çš„ç¡® æ¯ä¸ªå»¶è¿Ÿå‡½æ•°éƒ½ä¼šå°† IIFE åœ¨æ¯æ¬¡è¿­ä»£ä¸­åˆ›å»ºçš„ä½œç”¨åŸŸå°é—­èµ·æ¥ã€‚\n\nå¦‚æœä½œç”¨åŸŸæ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆä»…ä»…å°†å®ƒä»¬è¿›è¡Œå°é—­æ˜¯ä¸å¤Ÿçš„ã€‚ä»”ç»†çœ‹ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„ IIFE åªæ˜¯ä¸€ ä¸ªä»€ä¹ˆéƒ½æ²¡æœ‰çš„ç©ºä½œç”¨åŸŸã€‚å®ƒéœ€è¦åŒ…å«ä¸€ç‚¹å®è´¨å†…å®¹æ‰èƒ½ä¸ºæˆ‘ä»¬æ‰€ç”¨ã€‚\n\nå®ƒéœ€è¦æœ‰è‡ªå·±çš„å˜é‡ï¼Œç”¨æ¥åœ¨æ¯ä¸ªè¿­ä»£ä¸­å‚¨å­˜ i çš„å€¼\n\n```js\n\nfor (var i=1; i<=5; i++) { \n  (function() {\n  \tvar j = i;\n  \tsetTimeout( function timer() {\n  \t\tconsole.log( j ); \n    },j *1000 );\n   })(); \n}\n```\n\nè¡Œäº†!å®ƒèƒ½æ­£å¸¸å·¥ä½œäº†!ã€‚\n\nå¯ä»¥å¯¹è¿™æ®µä»£ç è¿›è¡Œä¸€äº›æ”¹è¿›:\n\n```js\nfor (var i=1; i<=5; i++) { \n  (function(j) {\n  \tsetTimeout( function timer() {\n  \t\tconsole.log( j ); \n    },j *1000 );\n   })(i); \n}\n```\n\nå½“ç„¶ï¼Œè¿™äº› IIFE ä¹Ÿä¸è¿‡å°±æ˜¯å‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°† i ä¼ é€’è¿›å»ï¼Œå¦‚æœæ„¿æ„çš„è¯å¯ä»¥å°†å˜é‡\n\nåå®šä¸º jï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è¿˜å«ä½œ iã€‚æ— è®ºå¦‚ä½•è¿™æ®µä»£ç ç°åœ¨å¯ä»¥å·¥ä½œäº†ã€‚\n åœ¨è¿­ä»£å†…ä½¿ç”¨ IIFE ä¼šä¸ºæ¯ä¸ªè¿­ä»£éƒ½ç”Ÿæˆä¸€ä¸ªæ–°çš„ä½œç”¨åŸŸï¼Œä½¿å¾—å»¶è¿Ÿå‡½æ•°çš„å›è°ƒå¯ä»¥å°†æ–°çš„\n\nä½œç”¨åŸŸå°é—­åœ¨æ¯ä¸ªè¿­ä»£å†…éƒ¨ï¼Œæ¯ä¸ªè¿­ä»£ä¸­éƒ½ä¼šå«æœ‰ä¸€ä¸ªå…·æœ‰æ­£ç¡®å€¼çš„å˜é‡ä¾›æˆ‘ä»¬è®¿é—®ã€‚ é—®é¢˜è§£å†³å•¦!\n\nå½“ç„¶äº†ï¼Œè‚¯å®šæœ‰ç”¨å—çº§ä½œç”¨åŸŸ`let`çš„ï¼Œé‚£æ ·å…¶å®æ˜¯æ›´å®Œç¾çš„ã€‚\n\n```js\nfor (let i=1; i<=5; i++) { \n  \tsetTimeout( function timer() {\n  \t\tconsole.log( i ); \n    },1000 );\n}\n```\n\n### é—­åŒ…ä¸æ¨¡å—\n\nå¾ˆæ—©ä¹‹å‰ï¼Œæˆ‘ä»¬å¼•ç”¨çš„jsæ–‡ä»¶å†…éƒ¨çš„å˜é‡å…¶å®éƒ½æ˜¯æŒ‚è½½åœ¨windowä¸Šé¢çš„ï¼Œä¹…è€Œä¹…ä¹‹å˜é‡åå¾ˆå¯èƒ½ä¼šé‡å¤=>è¦†ç›–=>BUG=>éš¾ä»¥è¿½å¯»çš„BUG\n\næ‰€ä»¥å¾ˆéœ€è¦æ¨¡å—çš„è¿™ä¸ªæ¦‚å¿µæ¥è§£å†³ã€‚\n\næ¨¡å—çš„å‘å±•æˆ‘åˆ†ä¸ºä¸‰å—ï¼šä¸Šå¤æ—¶ä»£ï¼Œè¿‘ç°ä»£ï¼Œç°ä»£\n\n#### ä¸Šå¤æ—¶ä»£çš„æ¨¡å—\n\né—­åŒ…æœ€å¼ºå¤§çš„åŠŸèƒ½=>ã€Šæ¨¡å—ã€‹\n\nçœ‹ä¸ªä¾‹å­\n\n```js\nfunction a(){\n  var q = 1;\n  var w = [1, 2];\n  \n  function getQ(){\n    console.log(q)\n  }\n  \n  function getW(){\n    console.log(w)\n  }\n  return {\n    getQ: getQ,\n    getW: getW,\n  }\n}\n\nvar f = a(); \nf.getQ(); // 1\nf.getW(); // [1, 2]\n```\n\næˆ‘ä»¬ä»”ç»†çš„å‰–æä¸€ä¸‹è¿™æ®µä»£ç ï¼Œ `a`æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬ç”¨aåˆ›å»ºäº†ä¸€ä¸ªæ¨¡å—å®ä¾‹ã€‚æ³¨æ„ä¸€ä¸‹ï¼šå¦‚æœä¸æ‰§è¡Œ `getQ` æˆ–è€… `getW` è¿™ä¸ªé—­åŒ…å°±æ— æ³•åˆ›å»ºï¼Œå› ä¸ºåœ¨å‡½æ•°aå†…éƒ¨çš„getQå’ŒgetWéƒ½åªæ˜¯å¯¹å˜é‡qå’Œå˜äº†wçš„å¼•ç”¨å£°æ˜ï¼›æ²¡æœ‰å®å®åœ¨åœ¨çš„è°ƒç”¨å°±æ²¡æœ‰åˆ›å»ºä½œç”¨åŸŸï¼Œä¹Ÿæ²¡æœ‰å¼€è¾Ÿå†…å­˜ç©ºé—´ã€‚\n\nå¼•ç”¨ä¸€å¥ã€Šä½ ä¸çŸ¥é“çš„JavaScript-ä¸Šã€‹ä¸­çš„ä¸€å¥è¯ï¼š\n\n> å¦‚æœä¸æ‰§è¡Œ å¤–éƒ¨å‡½æ•°ï¼Œå†…éƒ¨ä½œç”¨åŸŸå’Œé—­åŒ…éƒ½æ— æ³•è¢«åˆ›å»ºã€‚\n\nå…¶æ¬¡ï¼Œa() è¿”å›ä¸€ä¸ªç”¨å¯¹è±¡å­—é¢é‡è¯­æ³• { key: value, ... } æ¥è¡¨ç¤ºçš„å¯¹è±¡ã€‚è¿™ ä¸ªè¿”å›çš„å¯¹è±¡ä¸­å«æœ‰å¯¹å†…éƒ¨å‡½æ•°è€Œä¸æ˜¯å†…éƒ¨æ•°æ®å˜é‡çš„å¼•ç”¨ã€‚æˆ‘ä»¬ä¿æŒå†…éƒ¨æ•°æ®å˜é‡æ˜¯éš è—ä¸”ç§æœ‰çš„çŠ¶æ€ã€‚å¯ä»¥å°†è¿™ä¸ªå¯¹è±¡ç±»å‹çš„è¿”å›å€¼çœ‹ä½œæœ¬è´¨ä¸Šæ˜¯æ¨¡å—çš„å…¬å…± APIã€‚\n\nè¿™ä¸ªå¯¹è±¡ç±»å‹çš„è¿”å›å€¼æœ€ç»ˆè¢«èµ‹å€¼ç»™å¤–éƒ¨çš„å˜é‡ fï¼Œç„¶åå°±å¯ä»¥é€šè¿‡å®ƒæ¥è®¿é—® API ä¸­çš„ å±æ€§æ–¹æ³•ï¼Œæ¯”å¦‚ f.getW()ã€‚\n\n> ä»æ¨¡å—ä¸­è¿”å›ä¸€ä¸ªå®é™…çš„å¯¹è±¡å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è¿”å›ä¸€ä¸ªå†…éƒ¨å‡½ æ•°ã€‚jQuery å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚jQuery å’Œ $ æ ‡è¯†ç¬¦å°±æ˜¯ jQuery æ¨¡å—çš„å…¬ å…± APIï¼Œä½†å®ƒä»¬æœ¬èº«éƒ½æ˜¯å‡½æ•°(ç”±äºå‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ï¼Œå®ƒä»¬æœ¬èº«ä¹Ÿå¯ä»¥æ‹¥æœ‰å± æ€§)ã€‚\n\nå…¶å®æˆ‘ä»¬è¿™æ ·æ¯æ¬¡è°ƒç”¨ä¸€æ¬¡`aå‡½æ•°`ç›¸å½“äºåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„æ¨¡å—å®ä¾‹ã€‚\n\nå‡å¦‚ï¼Œæ­¤æ—¶æˆ‘ä»¬å¸Œæœ›åªè¦ä¸€ä¸ªå®ä¾‹ï¼Œé‚£å’‹åŠå‘¢ï¼Ÿ\n\nå¤©é™çŒ›ç”·----IIFEï¼ˆç«‹å³æ‰§è¡Œå‡½æ•°ï¼‰\n\n=ã€‹\n\n```js\nvar f = (function a(){\n  var q = 1;\n  var w = [1, 2];\n  \n  function getQ(){\n    console.log(q)\n  }\n  \n  function getW(){\n    console.log(w)\n  }\n  return {\n    getQ: getQ,\n    getW: getW,\n  }\n})(); \n\nf.getQ(); // 1\nf.getW(); // [1, 2]\n```\n\nè¿™ä¸ªæ¨¡å—åªå±äºfä¸€ä¸ªäººï¼Œè¦ä¿®æ”¹åªèƒ½æ‰¾få¸®å¿™äº†ã€‚\n\næ—¢ç„¶æ¨¡å—ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé‚£æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥ä¼ å‚å‘€ï¼Ÿ\n\næ˜¯çš„ï¼Œç¨ä½œä¿®æ”¹å°±å¥½äº†ã€‚\n\n```js\nfunction a(id){\n  var q = 1;\n  var w = [1, 2];\n  \n  function getQ(){\n    console.log(q)\n  }\n  \n  function getW(){\n    console.log(w)\n  }\n  \n  function getId(){\n    console.log(id)\n  }\n  return {\n    getQ: getQ,\n    getW: getW,\n    getId: getId,\n  }\n}\n\nvar f = a(99); \nf.getQ(); // 1\nf.getW(); // [1, 2]\nf.getId(); // 99\n```\n\né‚£æˆ‘æƒ³ä¿®æ”¹æ¨¡å—å†…éƒ¨çš„ä¸œè¥¿å’‹åŠæï¼Ÿ\n\nå®‰æ’ï¼\n\n```js\nfunction a(id){\n  var q = 1;\n  var w = [1, 2];\n  \n  function getQ(){\n    console.log(q)\n  }\n  \n  function getW(){\n    console.log(w)\n  }\n  \n  function getId(){\n    console.log(id)\n  }\n  \n  function change(){\n    q = q + 1\n  }\n  return {\n    getQ: getQ,\n    getW: getW,\n    getId: getId,\n    change: change,\n  }\n}\n\nvar f = a(99); \nf.getQ(); // 1\nf.getW(); // [1, 2]\nf.getId(); // 99\nf.change(); // 99\nf.getQ(); // 2\n```\n\né€šè¿‡åœ¨æ¨¡å—å®ä¾‹çš„å†…éƒ¨ä¿ç•™å¯¹å…¬å…± API å¯¹è±¡çš„å†…éƒ¨å¼•ç”¨ï¼Œå¯ä»¥ä»å†…éƒ¨å¯¹æ¨¡å—å®ä¾‹è¿›è¡Œä¿® æ”¹ï¼ŒåŒ…æ‹¬æ·»åŠ æˆ–åˆ é™¤æ–¹æ³•å’Œå±æ€§ï¼Œä»¥åŠä¿®æ”¹å®ƒä»¬çš„å€¼ã€‚\n\n#### è¿‘ç°ä»£çš„æ¨¡å—\n\n##### AMDï¼ˆå¾ˆå°‘ç”¨åˆ°äº†ï¼‰\n\nAMD å³Asynchronous Module Definitionï¼Œä¸­æ–‡åæ˜¯å¼‚æ­¥æ¨¡å—å®šä¹‰çš„æ„æ€ã€‚å®ƒæ˜¯ä¸€ä¸ªåœ¨æµè§ˆå™¨ç«¯æ¨¡å—åŒ–å¼€å‘çš„è§„èŒƒ\n\nç”±äºä¸æ˜¯JavaScriptåŸç”Ÿæ”¯æŒï¼Œä½¿ç”¨AMDè§„èŒƒè¿›è¡Œé¡µé¢å¼€å‘éœ€è¦ç”¨åˆ°å¯¹åº”çš„åº“å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯å¤§åé¼é¼RequireJSï¼Œå®é™…ä¸ŠAMD æ˜¯ RequireJS åœ¨æ¨å¹¿è¿‡ç¨‹ä¸­å¯¹æ¨¡å—å®šä¹‰çš„è§„èŒƒåŒ–çš„äº§å‡º\n\nrequireJSä¸»è¦è§£å†³ä¸¤ä¸ªé—®é¢˜\n\n1ã€å¤šä¸ªjsæ–‡ä»¶å¯èƒ½æœ‰ä¾èµ–å…³ç³»ï¼Œè¢«ä¾èµ–çš„æ–‡ä»¶éœ€è¦æ—©äºä¾èµ–å®ƒçš„æ–‡ä»¶åŠ è½½åˆ°æµè§ˆå™¨ \n2ã€jsåŠ è½½çš„æ—¶å€™æµè§ˆå™¨ä¼šåœæ­¢é¡µé¢æ¸²æŸ“ï¼ŒåŠ è½½æ–‡ä»¶è¶Šå¤šï¼Œé¡µé¢å¤±å»å“åº”æ—¶é—´è¶Šé•¿ \nçœ‹ä¸€ä¸ªä½¿ç”¨requireJSçš„ä¾‹å­\n\n```js\n/* \n\n*  a.js \n\n*  åˆ›å»ºä¸€ä¸ªåä¸ºâ€œaâ€çš„æ¨¡å—\n\n*/\n\n\n\ndefine('a', function(require, exports, module) {   \n\n  exports.getTime = function() {   \n\n    return new Date();   \n\n  }  \n\n});\n\n\n\n/* \n\n*  b.js \n\n*  åˆ›å»ºä¸€ä¸ªåä¸ºâ€œbâ€çš„æ¨¡å—ï¼ŒåŒæ—¶ä½¿ç”¨ä¾èµ–requireã€exportså’Œåä¸ºâ€œaâ€çš„æ¨¡å—ï¼š\n\n*/\n\ndefine('b', ['require', 'exports', 'a'], function(require, exports, a) {   exports.test = function() {\n\n    return {   \n\n      now: a.getTime()    \n\n    };   \n\n  }  \n\n});\n\n\n\n/* main.js */\n\nrequire(['b'], function(b) {   \n\n  console.log(b.test());  \n\n});\n```\n\n**è¯­æ³•**\n\nrequireJSå®šä¹‰äº†ä¸€ä¸ªå‡½æ•° defineï¼Œå®ƒæ˜¯å…¨å±€å˜é‡ï¼Œç”¨æ¥å®šä¹‰æ¨¡å—\n\ndefine(id?, dependencies?, factory);\n\n1. idï¼šå¯é€‰å‚æ•°ï¼Œç”¨æ¥å®šä¹‰æ¨¡å—çš„æ ‡è¯†ï¼Œå¦‚æœæ²¡æœ‰æä¾›è¯¥å‚æ•°ï¼Œè„šæœ¬æ–‡ä»¶åï¼ˆå»æ‰æ‹“å±•åï¼‰\n2. dependenciesï¼šæ˜¯ä¸€ä¸ªå½“å‰æ¨¡å—ä¾èµ–çš„æ¨¡å—åç§°æ•°ç»„\n3. factoryï¼šå·¥å‚æ–¹æ³•ï¼Œæ¨¡å—åˆå§‹åŒ–è¦æ‰§è¡Œçš„å‡½æ•°æˆ–å¯¹è±¡ã€‚å¦‚æœä¸ºå‡½æ•°ï¼Œå®ƒåº”è¯¥åªè¢«æ‰§è¡Œä¸€æ¬¡ã€‚å¦‚æœæ˜¯å¯¹è±¡ï¼Œæ­¤å¯¹è±¡åº”è¯¥ä¸ºæ¨¡å—çš„è¾“å‡ºå€¼ \n   åœ¨é¡µé¢ä¸Šä½¿ç”¨requireå‡½æ•°åŠ è½½æ¨¡å—\n\nrequire([dependencies], function(){}); \nrequire()å‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°\n\n1. ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¡¨ç¤ºæ‰€ä¾èµ–çš„æ¨¡å—\n2. ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå½“å‰é¢æŒ‡å®šçš„æ¨¡å—éƒ½åŠ è½½æˆåŠŸåï¼Œå®ƒå°†è¢«è°ƒç”¨ã€‚åŠ è½½çš„æ¨¡å—ä¼šä»¥å‚æ•°å½¢å¼ä¼ å…¥è¯¥å‡½æ•°ï¼Œä»è€Œåœ¨å›è°ƒå‡½æ•°å†…éƒ¨å°±å¯ä»¥ä½¿ç”¨è¿™äº›æ¨¡å—\n\nrequire()å‡½æ•°åœ¨åŠ è½½ä¾èµ–çš„å‡½æ•°çš„æ—¶å€™æ˜¯å¼‚æ­¥åŠ è½½çš„ï¼Œè¿™æ ·æµè§ˆå™¨ä¸ä¼šå¤±å»å“åº”ï¼Œå®ƒæŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼Œåªæœ‰å‰é¢çš„æ¨¡å—éƒ½åŠ è½½æˆåŠŸåï¼Œæ‰ä¼šè¿è¡Œï¼Œè§£å†³äº†ä¾èµ–æ€§çš„é—®é¢˜ã€‚\n\n##### CMDï¼ˆå¾ˆå°‘ç”¨åˆ°äº†ï¼‰\n\nCMD å³Common Module Definitioné€šç”¨æ¨¡å—å®šä¹‰ï¼ŒCMDè§„èŒƒæ˜¯å›½å†…å‘å±•å‡ºæ¥çš„ï¼Œå°±åƒAMDæœ‰ä¸ªrequireJSï¼ŒCMDæœ‰ä¸ªæµè§ˆå™¨çš„å®ç°SeaJSï¼ŒSeaJSè¦è§£å†³çš„é—®é¢˜å’ŒrequireJSä¸€æ ·ï¼Œåªä¸è¿‡åœ¨æ¨¡å—å®šä¹‰æ–¹å¼å’Œæ¨¡å—åŠ è½½ï¼ˆå¯ä»¥è¯´è¿è¡Œã€è§£æï¼‰æ—¶æœºä¸Šæœ‰æ‰€ä¸åŒ \n**è¯­æ³•** \nSea.js æ¨å´‡ä¸€ä¸ªæ¨¡å—ä¸€ä¸ªæ–‡ä»¶ï¼Œéµå¾ªç»Ÿä¸€çš„å†™æ³• \ndefine(id?, deps?, factory) \nå› ä¸ºCMDæ¨å´‡\n\n1. ä¸€ä¸ªæ–‡ä»¶ä¸€ä¸ªæ¨¡å—ï¼Œæ‰€ä»¥ç»å¸¸å°±ç”¨æ–‡ä»¶åä½œä¸ºæ¨¡å—id\n2. CMDæ¨å´‡ä¾èµ–å°±è¿‘ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸åœ¨defineçš„å‚æ•°ä¸­å†™ä¾èµ–ï¼Œåœ¨factoryä¸­å†™\n\nfactoryæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæœ‰ä¸‰ä¸ªå‚æ•°ï¼Œfunction(require, exports, module)\n\n1. require æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œæ¥å— æ¨¡å—æ ‡è¯† ä½œä¸ºå”¯ä¸€å‚æ•°ï¼Œç”¨æ¥è·å–å…¶ä»–æ¨¡å—æä¾›çš„æ¥å£ï¼šrequire(id)\n2. exports æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨æ¥å‘å¤–æä¾›æ¨¡å—æ¥å£\n3. module æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¸Šé¢å­˜å‚¨äº†ä¸å½“å‰æ¨¡å—ç›¸å…³è”çš„ä¸€äº›å±æ€§å’Œæ–¹æ³•\n\nçœ‹ä¸ªä¾‹å­ï¼š\n\n```js\n/* \n\n*  a.js \n\n*  ä¸€ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—\n\n*/\n\ndefine(function(require, exports, module) {   \n\n  exports.getTime = function() {   \n\n    return new Date();   \n\n  }  \n\n});\n\n\n\n/* main.js */\n\ndefine(function(require, exports, module) {  \n\n  /* æŒ‰éœ€åŠ è½½a.js */ \n\n  var a = require('./a');    \n\n  console.log(a.getTime());  \n\n});\n```\n\n##### AMDå’ŒCMDçš„åŒºåˆ«\n\næœ€æ˜æ˜¾çš„åŒºåˆ«å°±æ˜¯åœ¨æ¨¡å—å®šä¹‰æ—¶å¯¹ä¾èµ–çš„å¤„ç†ä¸åŒ\n\n**1ã€AMDæ¨å´‡ä¾èµ–å‰ç½®ï¼Œåœ¨å®šä¹‰æ¨¡å—çš„æ—¶å€™å°±è¦å£°æ˜å…¶ä¾èµ–çš„æ¨¡å—** \n**2ã€CMDæ¨å´‡å°±è¿‘ä¾èµ–ï¼Œåªæœ‰åœ¨ç”¨åˆ°æŸä¸ªæ¨¡å—çš„æ—¶å€™å†å»require** \nè¿™ç§åŒºåˆ«å„æœ‰ä¼˜åŠ£ï¼Œåªæ˜¯è¯­æ³•ä¸Šçš„å·®è·ï¼Œè€Œä¸”requireJSå’ŒSeaJSéƒ½æ”¯æŒå¯¹æ–¹çš„å†™æ³•\n\nAMDå’ŒCMDæœ€å¤§çš„åŒºåˆ«æ˜¯å¯¹ä¾èµ–æ¨¡å—çš„æ‰§è¡Œæ—¶æœºå¤„ç†ä¸åŒï¼Œæ³¨æ„ä¸æ˜¯åŠ è½½çš„æ—¶æœºæˆ–è€…æ–¹å¼ä¸åŒ\n\nå¾ˆå¤šäººè¯´requireJSæ˜¯å¼‚æ­¥åŠ è½½æ¨¡å—ï¼ŒSeaJSæ˜¯åŒæ­¥åŠ è½½æ¨¡å—ï¼Œè¿™ä¹ˆç†è§£å®é™…ä¸Šæ˜¯ä¸å‡†ç¡®çš„ï¼Œå…¶å®åŠ è½½æ¨¡å—éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œåªä¸è¿‡AMDä¾èµ–å‰ç½®ï¼Œjså¯ä»¥æ–¹ä¾¿çŸ¥é“ä¾èµ–æ¨¡å—æ˜¯è°ï¼Œç«‹å³åŠ è½½ï¼Œè€ŒCMDå°±è¿‘ä¾èµ–ï¼Œéœ€è¦ä½¿ç”¨æŠŠæ¨¡å—å˜ä¸ºå­—ç¬¦ä¸²è§£æä¸€éæ‰çŸ¥é“ä¾èµ–äº†é‚£äº›æ¨¡å—ï¼Œè¿™ä¹Ÿæ˜¯å¾ˆå¤šäººè¯Ÿç—…CMDçš„ä¸€ç‚¹ï¼Œç‰ºç‰²æ€§èƒ½æ¥å¸¦æ¥å¼€å‘çš„ä¾¿åˆ©æ€§ï¼Œå®é™…ä¸Šè§£ææ¨¡å—ç”¨çš„æ—¶é—´çŸ­åˆ°å¯ä»¥å¿½ç•¥\n\nä¸ºä»€ä¹ˆæˆ‘ä»¬è¯´ä¸¤ä¸ªçš„åŒºåˆ«æ˜¯ä¾èµ–æ¨¡å—æ‰§è¡Œæ—¶æœºä¸åŒï¼Œä¸ºä»€ä¹ˆå¾ˆå¤šäººè®¤ä¸ºADMæ˜¯å¼‚æ­¥çš„ï¼ŒCMDæ˜¯åŒæ­¥çš„ï¼ˆé™¤äº†åå­—çš„åŸå› ã€‚ã€‚ã€‚ï¼‰\n\nåŒæ ·éƒ½æ˜¯å¼‚æ­¥åŠ è½½æ¨¡å—ï¼ŒAMDåœ¨åŠ è½½æ¨¡å—å®Œæˆåå°±ä¼šæ‰§è¡Œæ”¹æ¨¡å—ï¼Œæ‰€æœ‰æ¨¡å—éƒ½åŠ è½½æ‰§è¡Œå®Œåä¼šè¿›å…¥requireçš„å›è°ƒå‡½æ•°ï¼Œæ‰§è¡Œä¸»é€»è¾‘ï¼Œè¿™æ ·çš„æ•ˆæœå°±æ˜¯ä¾èµ–æ¨¡å—çš„æ‰§è¡Œé¡ºåºå’Œä¹¦å†™é¡ºåºä¸ä¸€å®šä¸€è‡´ï¼Œçœ‹ç½‘ç»œé€Ÿåº¦ï¼Œå“ªä¸ªå…ˆä¸‹è½½ä¸‹æ¥ï¼Œå“ªä¸ªå…ˆæ‰§è¡Œï¼Œä½†æ˜¯ä¸»é€»è¾‘ä¸€å®šåœ¨æ‰€æœ‰ä¾èµ–åŠ è½½å®Œæˆåæ‰æ‰§è¡Œ\n\nCMDåŠ è½½å®ŒæŸä¸ªä¾èµ–æ¨¡å—åå¹¶ä¸æ‰§è¡Œï¼Œåªæ˜¯ä¸‹è½½è€Œå·²ï¼Œåœ¨æ‰€æœ‰ä¾èµ–æ¨¡å—åŠ è½½å®Œæˆåè¿›å…¥ä¸»é€»è¾‘ï¼Œé‡åˆ°requireè¯­å¥çš„æ—¶å€™æ‰æ‰§è¡Œå¯¹åº”çš„æ¨¡å—ï¼Œè¿™æ ·æ¨¡å—çš„æ‰§è¡Œé¡ºåºå’Œä¹¦å†™é¡ºåºæ˜¯å®Œå…¨ä¸€è‡´çš„\n\nè¿™ä¹Ÿæ˜¯å¾ˆå¤šäººè¯´AMDç”¨æˆ·ä½“éªŒå¥½ï¼Œå› ä¸ºæ²¡æœ‰å»¶è¿Ÿï¼Œä¾èµ–æ¨¡å—æå‰æ‰§è¡Œäº†ï¼ŒCMDæ€§èƒ½å¥½ï¼Œå› ä¸ºåªæœ‰ç”¨æˆ·éœ€è¦çš„æ—¶å€™æ‰æ‰§è¡Œçš„åŸå› \n\n\n\n#### ç°ä»£çš„æ¨¡å—\n\n##### CommonJS\n\nCommonJS æœ€æ—©æ˜¯ Node åœ¨ä½¿ç”¨ï¼Œç›®å‰ä¹Ÿä»ç„¶å¹¿æ³›ä½¿ç”¨ï¼Œæ¯”å¦‚åœ¨ Webpack ä¸­ä½ å°±èƒ½è§åˆ°å®ƒï¼Œå½“ç„¶ç›®å‰åœ¨ Node ä¸­çš„æ¨¡å—ç®¡ç†å·²ç»å’Œ CommonJS æœ‰ä¸€äº›åŒºåˆ«äº†ã€‚\n\n```js\n// a.js\nmodule.exports = {\n    a: 1\n}\n// or \nexports.a = 1\n\n// b.js\nvar module = require('./a.js')\nmodule.a // -> log 1\n```\n\nå› ä¸º CommonJS è¿˜æ˜¯ä¼šä½¿ç”¨åˆ°çš„ï¼Œæ‰€ä»¥è¿™é‡Œä¼šå¯¹ä¸€äº›ç–‘éš¾ç‚¹è¿›è¡Œè§£æ\n\nå…ˆè¯´ `require` å§\n\n```js\nvar module = require('./a.js')\nmodule.a \n// è¿™é‡Œå…¶å®å°±æ˜¯åŒ…è£…äº†ä¸€å±‚ç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œè¿™æ ·å°±ä¸ä¼šæ±¡æŸ“å…¨å±€å˜é‡äº†ï¼Œ\n// é‡è¦çš„æ˜¯ module è¿™é‡Œï¼Œmodule æ˜¯ Node ç‹¬æœ‰çš„ä¸€ä¸ªå˜é‡\nmodule.exports = {\n    a: 1\n}\n// module åŸºæœ¬å®ç°\nvar module = {\n  id: 'xxxx', // æˆ‘æ€»å¾—çŸ¥é“æ€ä¹ˆå»æ‰¾åˆ°ä»–å§\n  exports: {} // exports å°±æ˜¯ä¸ªç©ºå¯¹è±¡\n}\n// è¿™ä¸ªæ˜¯ä¸ºä»€ä¹ˆ exports å’Œ module.exports ç”¨æ³•ç›¸ä¼¼çš„åŸå› \nvar exports = module.exports \nvar load = function (module) {\n    // å¯¼å‡ºçš„ä¸œè¥¿\n    var a = 1\n    module.exports = a\n    return module.exports\n};\n// ç„¶åå½“æˆ‘ require çš„æ—¶å€™å»æ‰¾åˆ°ç‹¬ç‰¹çš„\n// idï¼Œç„¶åå°†è¦ä½¿ç”¨çš„ä¸œè¥¿ç”¨ç«‹å³æ‰§è¡Œå‡½æ•°åŒ…è£…ä¸‹ï¼Œover\n```\n\nå¦å¤–è™½ç„¶ `exports` å’Œ `module.exports` ç”¨æ³•ç›¸ä¼¼ï¼Œä½†æ˜¯ä¸èƒ½å¯¹ `exports` ç›´æ¥èµ‹å€¼ã€‚å› ä¸º `var exports = module.exports` è¿™å¥ä»£ç è¡¨æ˜äº† `exports` å’Œ `module.exports` äº«æœ‰ç›¸åŒåœ°å€ï¼Œé€šè¿‡æ”¹å˜å¯¹è±¡çš„å±æ€§å€¼ä¼šå¯¹ä¸¤è€…éƒ½èµ·æ•ˆï¼Œä½†æ˜¯å¦‚æœç›´æ¥å¯¹ `exports` èµ‹å€¼å°±ä¼šå¯¼è‡´ä¸¤è€…ä¸å†æŒ‡å‘åŒä¸€ä¸ªå†…å­˜åœ°å€ï¼Œä¿®æ”¹å¹¶ä¸ä¼šå¯¹ `module.exports` èµ·æ•ˆã€‚\n\n##### ES Module\n\nES Module æ˜¯åŸç”Ÿå®ç°çš„æ¨¡å—åŒ–æ–¹æ¡ˆï¼Œä¸ CommonJS æœ‰ä»¥ä¸‹å‡ ä¸ªåŒºåˆ«\n\n- CommonJS æ”¯æŒåŠ¨æ€å¯¼å…¥ï¼Œä¹Ÿå°±æ˜¯ `require(${path}/xx.js)`ï¼Œåè€…ç›®å‰ä¸æ”¯æŒï¼Œä½†æ˜¯å·²æœ‰ææ¡ˆ\n- CommonJS æ˜¯åŒæ­¥å¯¼å…¥ï¼Œå› ä¸ºç”¨äºæœåŠ¡ç«¯ï¼Œæ–‡ä»¶éƒ½åœ¨æœ¬åœ°ï¼ŒåŒæ­¥å¯¼å…¥å³ä½¿å¡ä½ä¸»çº¿ç¨‹å½±å“ä¹Ÿä¸å¤§ã€‚è€Œåè€…æ˜¯å¼‚æ­¥å¯¼å…¥ï¼Œå› ä¸ºç”¨äºæµè§ˆå™¨ï¼Œéœ€è¦ä¸‹è½½æ–‡ä»¶ï¼Œå¦‚æœä¹Ÿé‡‡ç”¨åŒæ­¥å¯¼å…¥ä¼šå¯¹æ¸²æŸ“æœ‰å¾ˆå¤§å½±å“\n- CommonJS åœ¨å¯¼å‡ºæ—¶éƒ½æ˜¯å€¼æ‹·è´ï¼Œå°±ç®—å¯¼å‡ºçš„å€¼å˜äº†ï¼Œå¯¼å…¥çš„å€¼ä¹Ÿä¸ä¼šæ”¹å˜ï¼Œæ‰€ä»¥å¦‚æœæƒ³æ›´æ–°å€¼ï¼Œå¿…é¡»é‡æ–°å¯¼å…¥ä¸€æ¬¡ã€‚ä½†æ˜¯ ES Module é‡‡ç”¨å®æ—¶ç»‘å®šçš„æ–¹å¼ï¼Œå¯¼å…¥å¯¼å‡ºçš„å€¼éƒ½æŒ‡å‘åŒä¸€ä¸ªå†…å­˜åœ°å€ï¼Œæ‰€ä»¥å¯¼å…¥å€¼ä¼šè·Ÿéšå¯¼å‡ºå€¼å˜åŒ–\n- ES Module ä¼šç¼–è¯‘æˆ `require/exports` æ¥æ‰§è¡Œçš„\n\n```js\n// å¼•å…¥æ¨¡å— API\nimport XXX from './a.js'\nimport { XXX } from './a.js'\n// å¯¼å‡ºæ¨¡å— API\nexport function a() {}\nexport default function() {}\n```\n\n## æ€»ç»“\n\nå½“å‡½æ•°å¯ä»¥è®°ä½å¹¶è®¿é—®æ‰€åœ¨çš„è¯æ³•ä½œç”¨åŸŸï¼Œå³ä½¿å‡½æ•°æ˜¯åœ¨å½“å‰è¯æ³•ä½œç”¨åŸŸä¹‹å¤–æ‰§è¡Œï¼Œè¿™æ—¶ å°±äº§ç”Ÿäº†é—­åŒ…ã€‚\n\n\n\n> ç´¢å¼•ï¼šhttps://juejin.im/post/5a422b036fb9a045211ef789\n\n\n\n\n\n","slug":"ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—","published":1,"updated":"2021-06-24T14:00:06.853Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra8p001wlwrdh7m9appx","content":"<p>æœ€è¿‘åœ¨å†™ã€é‡æ‹¾å‰ç«¯ã€‘ç³»åˆ—ï¼Œä¸‹é¢æœ‰å‡ ä¸ªå¿«é€Ÿé€šé“ï¼Œå¤§å®¶è‡ªå–</p>\n<p><a href=\"https://juejin.im/post/6850418113944420359\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿</a></p>\n<p><a href=\"https://juejin.im/post/6850418117508759566\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—</a></p>\n<p><a href=\"https://juejin.im/post/6854573215658803208\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this</a></p>\n<p><a href=\"https://juejin.im/post/6859911609633767438\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šJavaScriptçš„æ‰§è¡Œæœºåˆ¶</a></p>\n<p><a href=\"https://juejin.im/post/6860375101322461198\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC</a></p>\n<p><a href=\"https://juejin.im/post/6865204092877144077\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ</a></p>\n<h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><p>å›å¿†æˆ‘å‰å‡ å¹´çš„æ—¶å…‰ï¼Œå¤§é‡ä½¿ç”¨ JavaScript ä½†å´å®Œå…¨ä¸ç†è§£é—­åŒ…æ˜¯ä»€ä¹ˆã€‚æ€»æ˜¯æ„Ÿè§‰è¿™é—¨è¯­ è¨€æœ‰å…¶éšè”½çš„ä¸€é¢ï¼Œå¦‚æœèƒ½å¤ŸæŒæ¡å°†ä¼šåŠŸåŠ›å¤§æ¶¨ï¼Œä½†è®½åˆºçš„æ˜¯æˆ‘å§‹ç»ˆæ— æ³•æŒæ¡å…¶ä¸­çš„é—¨ é“ã€‚</p>\n<blockquote>\n<p>JavaScriptä¸­é—­åŒ…æ— å¤„ä¸åœ¨ï¼Œä½ åªéœ€è¦èƒ½å¤Ÿè¯†åˆ«å¹¶æ‹¥æŠ±å®ƒã€‚</p>\n<p>æœ€åä½ æç„¶å¤§æ‚Ÿ:åŸæ¥åœ¨æˆ‘çš„ä»£ç ä¸­å·²ç»åˆ°å¤„éƒ½æ˜¯é—­åŒ…äº†ï¼Œç°åœ¨æˆ‘ç»ˆäºèƒ½ç†è§£å®ƒä»¬äº†ã€‚ç† è§£é—­åŒ…å°±å¥½åƒ Neo3 ç¬¬ä¸€æ¬¡è§åˆ°çŸ©é˜µ 4 ä¸€æ ·ã€‚</p>\n</blockquote>\n<h2 id=\"å®šä¹‰\"><a href=\"#å®šä¹‰\" class=\"headerlink\" title=\"å®šä¹‰\"></a>å®šä¹‰</h2><p>å½“å‡½æ•°å¯ä»¥è®°ä½å¹¶è®¿é—®æ‰€åœ¨çš„è¯æ³•ä½œç”¨åŸŸæ—¶ï¼Œå°±äº§ç”Ÿäº†é—­åŒ…ï¼Œå³ä½¿å‡½æ•°æ˜¯åœ¨å½“å‰è¯æ³•ä½œç”¨ åŸŸä¹‹å¤–æ‰§è¡Œã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">  <span class=\"keyword\">var</span> a = <span class=\"number\">2</span>;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bar</span>(<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( a ); <span class=\"comment\">// 2</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tbar(); </span><br><span class=\"line\">&#125;</span><br><span class=\"line\">foo();</span><br></pre></td></tr></table></figure>\n\n<p>è¿™æ ·å¯èƒ½è¿˜ä¸å¤Ÿç›´è§‚ï¼Œæˆ‘ä»¬å†ä¿®æ”¹ä¸€ä¸‹ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">  <span class=\"keyword\">var</span> a = <span class=\"number\">2</span>;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bar</span>(<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( a ); <span class=\"comment\">// 2</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> bar; </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> baz = foo();</span><br><span class=\"line\">baz(); <span class=\"comment\">// 2 â€”â€” æœ‹å‹ï¼Œè¿™å°±æ˜¯é—­åŒ…çš„æ•ˆæœã€‚</span></span><br></pre></td></tr></table></figure>\n\n<p>å…¶å®ï¼Œåœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è°ƒç”¨å®Œ<code>foo</code>ä¹‹åï¼ŒJavaScriptæ£€æµ‹åˆ°åç»­ä¸ä¼šå†ç”¨åˆ°ä»–äº†ï¼Œ æ‰€ä»¥ä»–çš„å†…éƒ¨ä½œç”¨åŸŸå°±ä¼šè¢«å›æ”¶â™»ï¸ã€‚ï¼ˆæ¶‰åŠåˆ°åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œåç»­çš„æ–‡ç« æˆ‘ä»¬ä¼šè¯´åˆ°ã€‚ï¼‰</p>\n<p>é—­åŒ…çš„ç¥å¥‡ä¹‹å¤„å°±åœ¨äºä»–å¯ä»¥é˜»æ­¢â™»ï¸çš„å‘ç”Ÿã€‚å› ä¸ºäº‹å®ä¸Šå†…éƒ¨ä½œç”¨åŸŸå·²ç„¶å­˜åœ¨ï¼Œé‚£ä¹ˆåˆæœ‰è°åœ¨ä½¿ç”¨å‘¢ï¼Ÿå“¦~æ˜¯æˆ‘ä»¬çš„<code>bar</code>åœ¨ä½¿ç”¨ã€‚</p>\n<p>æ‹œ bar() æ‰€å£°æ˜çš„ä½ç½®æ‰€èµï¼Œå®ƒæ‹¥æœ‰æ¶µç›– foo() å†…éƒ¨ä½œç”¨åŸŸçš„é—­åŒ…ï¼Œä½¿å¾—è¯¥ä½œç”¨åŸŸèƒ½å¤Ÿä¸€ ç›´å­˜æ´»ï¼Œä»¥ä¾› bar() åœ¨ä¹‹åä»»ä½•æ—¶é—´è¿›è¡Œå¼•ç”¨ã€‚</p>\n<p>bar() ä¾ç„¶æŒæœ‰å¯¹è¯¥ä½œç”¨åŸŸçš„å¼•ç”¨ï¼Œè€Œè¿™ä¸ªå¼•ç”¨å°±å«ä½œé—­åŒ…ã€‚</p>\n<p>æ‰€ä»¥æˆ‘è¯´è¯´æˆ‘è‡ªå·±çš„ç†è§£ï¼š</p>\n<p>é—­åŒ…æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶çš„æ¦‚å¿µï¼Œå¦‚æœåªæ˜¯å£°æ˜æˆ–è€…å®šä¹‰ã€‚å³ä½¿ä»–ç¬¦åˆé—­åŒ…çš„è¦æ±‚é‚£ä»–ä¹Ÿä¸èƒ½æˆä¸ºä¸€ä¸ªçœŸæ­£çš„é—­åŒ…ã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºå†…å­˜åœ°å€å¹¶æ²¡æœ‰å¼€å§‹åˆ†é…ï¼Œé—­åŒ…åªæ˜¯åˆ†é…ä¹‹åé‚£ä¸€å—åœ°å€æ²¡æœ‰è¢«å›æ”¶è€Œå·²ã€‚</p>\n<p>å†å›åˆ°æˆ‘ä»¬æœ€å¼€å§‹çš„å‡½æ•°ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">  <span class=\"keyword\">var</span> a = <span class=\"number\">2</span>;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bar</span>(<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( a ); <span class=\"comment\">// 2</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tbar(); </span><br><span class=\"line\">&#125;</span><br><span class=\"line\">foo();</span><br></pre></td></tr></table></figure>\n\n<p>ä¸€ä¸ªå‡½æ•°fooå†…æœ‰ä¸€ä¸ªå‡½æ•°barã€‚å¹¶ä¸”å‡½æ•°barç”¨åˆ°äº†å‡½æ•°fooçš„å˜é‡ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç§°è¿™ä¸ªå¼•ç”¨è¿‡ç¨‹ä¸ºâ€œé—­åŒ…â€ã€‚ä½†æ˜¯æˆ‘ä»¬è¿™ä¸ªå‡½æ•°fooå¿…é¡»è¢«è°ƒç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ä¾‹å­åœ°ä¸‹è°ƒç”¨äº†ä¸€ä¸‹å‡½æ•°fooã€‚</p>\n<p>å†å›åˆ°æˆ‘ä»¬é‚£ä¸ªè¾ƒä¸ºæ¸…æ™°çš„ä¾‹å­</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">  <span class=\"keyword\">var</span> a = <span class=\"number\">2</span>;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bar</span>(<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( a ); <span class=\"comment\">// 2</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> bar; </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> baz = foo();</span><br><span class=\"line\">baz(); <span class=\"comment\">// 2 â€”â€” æœ‹å‹ï¼Œè¿™å°±æ˜¯é—­åŒ…çš„æ•ˆæœã€‚</span></span><br></pre></td></tr></table></figure>\n\n<p>è¿™ä¸ªåº”è¯¥æ˜¯å¤§ä¼—è®¤çŸ¥ä¸Šéå¸¸ç»å…¸çš„ä¸€ä¸ªé—­åŒ…äº†å§ï¼Ÿä½†æ˜¯å‡å¦‚è¯´è¿™ä¸ªfooå‡½æ•°æ²¡æœ‰è¢«è°ƒç”¨ï¼Œé‚£ä¹ˆæˆ‘è®¤ä¸ºä»–å°±ä¸æ˜¯ä¸€ä¸ªé—­åŒ…ã€‚</p>\n<h2 id=\"å®è·µ\"><a href=\"#å®è·µ\" class=\"headerlink\" title=\"å®è·µ\"></a>å®è·µ</h2><h3 id=\"å¸¸è§çš„é—­åŒ…\"><a href=\"#å¸¸è§çš„é—­åŒ…\" class=\"headerlink\" title=\"å¸¸è§çš„é—­åŒ…\"></a>å¸¸è§çš„é—­åŒ…</h3><p>å‰é¢çš„ä»£ç ç‰‡æ®µæœ‰ç‚¹æ­»æ¿ï¼Œå¹¶ä¸”ä¸ºäº†è§£é‡Šå¦‚ä½•ä½¿ç”¨é—­åŒ…è€Œäººä¸ºåœ°åœ¨ç»“æ„ä¸Šè¿›è¡Œäº†ä¿®é¥°ã€‚ä½ å·²ç»å†™è¿‡çš„ä»£ç ä¸­ä¸€å®šåˆ°å¤„éƒ½æ˜¯é—­åŒ…çš„èº«å½±ã€‚ ç°åœ¨è®©æˆ‘ä»¬æ¥ææ‡‚è¿™ä¸ªäº‹å®ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">wait</span>(<span class=\"params\">message</span>) </span>&#123;</span><br><span class=\"line\">\tsetTimeout( </span><br><span class=\"line\">\t\t<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">timer</span>(<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">\t\t\t<span class=\"built_in\">console</span>.log( message );</span><br><span class=\"line\">\t&#125;, <span class=\"number\">1000</span> ); </span><br><span class=\"line\">&#125;</span><br><span class=\"line\">wait( <span class=\"string\">\"Hello, closure!\"</span> );</span><br></pre></td></tr></table></figure>\n\n<p>è¿™ä¸ªä¾‹å­éå¸¸å¸¸è§ï¼Œä»£ç å¾ˆç®€å•ï¼Œå°±æ˜¯1ç§’é’Ÿä¹‹åè¾“å‡ºæˆ‘ä»¬ä¼ å…¥çš„å‚æ•°ã€‚</p>\n<p>ä½†æ˜¯æˆ‘ä»¬ä»”ç»†çœ‹å°±èƒ½çœ‹è§é—­åŒ…çš„å½±å­ï¼Œä¸€ç§’é’Ÿä¹‹åï¼Œ<code>message</code>è¿˜æ˜¯å¯ä»¥è¢«<code>timer</code>è®¿é—®åˆ°ã€‚å¹¶æ²¡æœ‰è¢«å›æ”¶â™»ï¸æ‰ã€‚</p>\n<blockquote>\n<p>è¿™å°±æ˜¯é—­åŒ…</p>\n</blockquote>\n<p>æœ¬è´¨ä¸Šæ— è®ºä½•æ—¶ä½•åœ°ï¼Œå¦‚æœå°†å‡½æ•°(è®¿é—®å®ƒä»¬å„è‡ªçš„è¯æ³•ä½œç”¨åŸŸ)å½“ä½œç¬¬ä¸€ çº§çš„å€¼ç±»å‹å¹¶åˆ°å¤„ä¼ é€’ï¼Œä½ å°±ä¼šçœ‹åˆ°é—­åŒ…åœ¨è¿™äº›å‡½æ•°ä¸­çš„åº”ç”¨ã€‚åœ¨å®šæ—¶å™¨ã€äº‹ä»¶ç›‘å¬å™¨ã€ Ajax è¯·æ±‚ã€è·¨çª—å£é€šä¿¡ã€Web Workers æˆ–è€…ä»»ä½•å…¶ä»–çš„å¼‚æ­¥(æˆ–è€…åŒæ­¥)ä»»åŠ¡ä¸­ï¼Œåªè¦ä½¿ ç”¨äº†å›è°ƒå‡½æ•°ï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨ä½¿ç”¨é—­åŒ…!</p>\n<h3 id=\"é—­åŒ…ä¸å¾ªç¯\"><a href=\"#é—­åŒ…ä¸å¾ªç¯\" class=\"headerlink\" title=\"é—­åŒ…ä¸å¾ªç¯\"></a>é—­åŒ…ä¸å¾ªç¯</h3><p>è¯´åˆ°è¿™é‡Œè‚¯å®šæœ‰äººé©¬ä¸Šå°±æƒ³åˆ°äº†æœ€ç»å…¸çš„é¢è¯•é¢˜ï¼šè¯·å†™å‡ºä»¥ä¸‹çš„è¾“å‡ºå†…å®¹</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i=<span class=\"number\">1</span>; i&lt;=<span class=\"number\">5</span>; i++) &#123; </span><br><span class=\"line\">\tsetTimeout( <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">timer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">console</span>.log( i ); </span><br><span class=\"line\">  &#125;, i*<span class=\"number\">1000</span> );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯¹è¿™æ®µä»£ç è¡Œä¸ºçš„é¢„æœŸæ˜¯åˆ†åˆ«è¾“å‡ºæ•°å­— 1~5ï¼Œæ¯ç§’ä¸€æ¬¡ï¼Œæ¯æ¬¡ä¸€ä¸ªã€‚</p>\n<p>ä½†å®é™…ä¸Šï¼Œè¿™æ®µä»£ç åœ¨è¿è¡Œæ—¶ä¼šä»¥æ¯ç§’ä¸€æ¬¡çš„é¢‘ç‡è¾“å‡ºäº”æ¬¡ 6ã€‚</p>\n<p>è¿™æ˜¯ä¸ºä»€ä¹ˆ?</p>\n<p>å› ä¸ºç­‰åˆ°æ‰§è¡Œ<code>console.log</code>çš„æ—¶å€™ï¼Œé‚£ä¸ªæ—¶å€™çš„iå·²ç»åœ¨forçš„è°ƒæ•™ä¸‹å˜æˆäº†6äº†ï¼Œæ‰€ä»¥ä»–ä»¬å»å–åªèƒ½å–åˆ°6ï¼›</p>\n<p>ï¼ˆäº‹å®ä¸Šï¼Œ å½“å®šæ—¶å™¨è¿è¡Œæ—¶å³ä½¿æ¯ä¸ªè¿­ä»£ä¸­æ‰§è¡Œçš„æ˜¯setTimeout(.., 0)ï¼Œæ‰€æœ‰çš„å›è°ƒå‡½æ•°ä¾ç„¶æ˜¯åœ¨å¾ª ç¯ç»“æŸåæ‰ä¼šè¢«æ‰§è¡Œï¼Œå› æ­¤ä¼šæ¯æ¬¡è¾“å‡ºä¸€ä¸ª 6 å‡ºæ¥ã€‚è¿™ä¸ªæ¶‰åŠåˆ°æ—¶é—´å¾ªç¯ï¼Œåé¢çš„æ–‡ç« ä¼šå…·ä½“çš„å±•å¼€æ¥è®²ï¼‰</p>\n<p>é€šè¿‡æˆ‘ä»¬åˆšåˆšçš„å­¦ä¹ çŸ¥é“ï¼Œå¦‚æœæˆ‘ä»¬åˆ›é€ äº†ä¸€ä¸ªé—­åŒ…ï¼Œè¿™æ ·çš„è¯è¿™ä¸ªiä¸å°±ä¸ä¼šè¢«å›æ”¶äº†å—ï¼Ÿ</p>\n<p>okï¼Œæˆ‘ä»¬è¯•è¯•</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i=<span class=\"number\">1</span>; i&lt;=<span class=\"number\">5</span>; i++) &#123; </span><br><span class=\"line\">  (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">\t\tsetTimeout( <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">timer</span>(<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log( i );</span><br><span class=\"line\">    &#125;, i*<span class=\"number\">1000</span> );</span><br><span class=\"line\">  &#125;)();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>è¿™æ ·èƒ½è¡Œå—?è¯•è¯•å§ï¼Œåœ¨Chromeæˆ–è€…nodeé‡Œé¢è¯•è¯•å§ï¼Œæˆ‘ç­‰ç€ä½ ã€‚</p>\n<p>æˆ‘ä¸å–å…³å­äº†ã€‚è¿™æ ·ä¸è¡Œã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆå‘¢?æˆ‘ä»¬ç°åœ¨æ˜¾ç„¶æ‹¥æœ‰æ›´å¤šçš„è¯æ³•ä½œç”¨åŸŸäº†ã€‚çš„ç¡® æ¯ä¸ªå»¶è¿Ÿå‡½æ•°éƒ½ä¼šå°† IIFE åœ¨æ¯æ¬¡è¿­ä»£ä¸­åˆ›å»ºçš„ä½œç”¨åŸŸå°é—­èµ·æ¥ã€‚</p>\n<p>å¦‚æœä½œç”¨åŸŸæ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆä»…ä»…å°†å®ƒä»¬è¿›è¡Œå°é—­æ˜¯ä¸å¤Ÿçš„ã€‚ä»”ç»†çœ‹ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„ IIFE åªæ˜¯ä¸€ ä¸ªä»€ä¹ˆéƒ½æ²¡æœ‰çš„ç©ºä½œç”¨åŸŸã€‚å®ƒéœ€è¦åŒ…å«ä¸€ç‚¹å®è´¨å†…å®¹æ‰èƒ½ä¸ºæˆ‘ä»¬æ‰€ç”¨ã€‚</p>\n<p>å®ƒéœ€è¦æœ‰è‡ªå·±çš„å˜é‡ï¼Œç”¨æ¥åœ¨æ¯ä¸ªè¿­ä»£ä¸­å‚¨å­˜ i çš„å€¼</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i=<span class=\"number\">1</span>; i&lt;=<span class=\"number\">5</span>; i++) &#123; </span><br><span class=\"line\">  (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  \t<span class=\"keyword\">var</span> j = i;</span><br><span class=\"line\">  \tsetTimeout( <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">timer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  \t\t<span class=\"built_in\">console</span>.log( j ); </span><br><span class=\"line\">    &#125;,j *<span class=\"number\">1000</span> );</span><br><span class=\"line\">   &#125;)(); </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>è¡Œäº†!å®ƒèƒ½æ­£å¸¸å·¥ä½œäº†!ã€‚</p>\n<p>å¯ä»¥å¯¹è¿™æ®µä»£ç è¿›è¡Œä¸€äº›æ”¹è¿›:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i=<span class=\"number\">1</span>; i&lt;=<span class=\"number\">5</span>; i++) &#123; </span><br><span class=\"line\">  (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">j</span>) </span>&#123;</span><br><span class=\"line\">  \tsetTimeout( <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">timer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  \t\t<span class=\"built_in\">console</span>.log( j ); </span><br><span class=\"line\">    &#125;,j *<span class=\"number\">1000</span> );</span><br><span class=\"line\">   &#125;)(i); </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å½“ç„¶ï¼Œè¿™äº› IIFE ä¹Ÿä¸è¿‡å°±æ˜¯å‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°† i ä¼ é€’è¿›å»ï¼Œå¦‚æœæ„¿æ„çš„è¯å¯ä»¥å°†å˜é‡</p>\n<p>åå®šä¸º jï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è¿˜å«ä½œ iã€‚æ— è®ºå¦‚ä½•è¿™æ®µä»£ç ç°åœ¨å¯ä»¥å·¥ä½œäº†ã€‚<br> åœ¨è¿­ä»£å†…ä½¿ç”¨ IIFE ä¼šä¸ºæ¯ä¸ªè¿­ä»£éƒ½ç”Ÿæˆä¸€ä¸ªæ–°çš„ä½œç”¨åŸŸï¼Œä½¿å¾—å»¶è¿Ÿå‡½æ•°çš„å›è°ƒå¯ä»¥å°†æ–°çš„</p>\n<p>ä½œç”¨åŸŸå°é—­åœ¨æ¯ä¸ªè¿­ä»£å†…éƒ¨ï¼Œæ¯ä¸ªè¿­ä»£ä¸­éƒ½ä¼šå«æœ‰ä¸€ä¸ªå…·æœ‰æ­£ç¡®å€¼çš„å˜é‡ä¾›æˆ‘ä»¬è®¿é—®ã€‚ é—®é¢˜è§£å†³å•¦!</p>\n<p>å½“ç„¶äº†ï¼Œè‚¯å®šæœ‰ç”¨å—çº§ä½œç”¨åŸŸ<code>let</code>çš„ï¼Œé‚£æ ·å…¶å®æ˜¯æ›´å®Œç¾çš„ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i=<span class=\"number\">1</span>; i&lt;=<span class=\"number\">5</span>; i++) &#123; </span><br><span class=\"line\">  \tsetTimeout( <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">timer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  \t\t<span class=\"built_in\">console</span>.log( i ); </span><br><span class=\"line\">    &#125;,<span class=\"number\">1000</span> );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"é—­åŒ…ä¸æ¨¡å—\"><a href=\"#é—­åŒ…ä¸æ¨¡å—\" class=\"headerlink\" title=\"é—­åŒ…ä¸æ¨¡å—\"></a>é—­åŒ…ä¸æ¨¡å—</h3><p>å¾ˆæ—©ä¹‹å‰ï¼Œæˆ‘ä»¬å¼•ç”¨çš„jsæ–‡ä»¶å†…éƒ¨çš„å˜é‡å…¶å®éƒ½æ˜¯æŒ‚è½½åœ¨windowä¸Šé¢çš„ï¼Œä¹…è€Œä¹…ä¹‹å˜é‡åå¾ˆå¯èƒ½ä¼šé‡å¤=&gt;è¦†ç›–=&gt;BUG=&gt;éš¾ä»¥è¿½å¯»çš„BUG</p>\n<p>æ‰€ä»¥å¾ˆéœ€è¦æ¨¡å—çš„è¿™ä¸ªæ¦‚å¿µæ¥è§£å†³ã€‚</p>\n<p>æ¨¡å—çš„å‘å±•æˆ‘åˆ†ä¸ºä¸‰å—ï¼šä¸Šå¤æ—¶ä»£ï¼Œè¿‘ç°ä»£ï¼Œç°ä»£</p>\n<h4 id=\"ä¸Šå¤æ—¶ä»£çš„æ¨¡å—\"><a href=\"#ä¸Šå¤æ—¶ä»£çš„æ¨¡å—\" class=\"headerlink\" title=\"ä¸Šå¤æ—¶ä»£çš„æ¨¡å—\"></a>ä¸Šå¤æ—¶ä»£çš„æ¨¡å—</h4><p>é—­åŒ…æœ€å¼ºå¤§çš„åŠŸèƒ½=&gt;ã€Šæ¨¡å—ã€‹</p>\n<p>çœ‹ä¸ªä¾‹å­</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> q = <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> w = [<span class=\"number\">1</span>, <span class=\"number\">2</span>];</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getQ</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(q)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getW</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(w)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    getQ: getQ,</span><br><span class=\"line\">    getW: getW,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> f = a(); </span><br><span class=\"line\">f.getQ(); <span class=\"comment\">// 1</span></span><br><span class=\"line\">f.getW(); <span class=\"comment\">// [1, 2]</span></span><br></pre></td></tr></table></figure>\n\n<p>æˆ‘ä»¬ä»”ç»†çš„å‰–æä¸€ä¸‹è¿™æ®µä»£ç ï¼Œ <code>a</code>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬ç”¨aåˆ›å»ºäº†ä¸€ä¸ªæ¨¡å—å®ä¾‹ã€‚æ³¨æ„ä¸€ä¸‹ï¼šå¦‚æœä¸æ‰§è¡Œ <code>getQ</code> æˆ–è€… <code>getW</code> è¿™ä¸ªé—­åŒ…å°±æ— æ³•åˆ›å»ºï¼Œå› ä¸ºåœ¨å‡½æ•°aå†…éƒ¨çš„getQå’ŒgetWéƒ½åªæ˜¯å¯¹å˜é‡qå’Œå˜äº†wçš„å¼•ç”¨å£°æ˜ï¼›æ²¡æœ‰å®å®åœ¨åœ¨çš„è°ƒç”¨å°±æ²¡æœ‰åˆ›å»ºä½œç”¨åŸŸï¼Œä¹Ÿæ²¡æœ‰å¼€è¾Ÿå†…å­˜ç©ºé—´ã€‚</p>\n<p>å¼•ç”¨ä¸€å¥ã€Šä½ ä¸çŸ¥é“çš„JavaScript-ä¸Šã€‹ä¸­çš„ä¸€å¥è¯ï¼š</p>\n<blockquote>\n<p>å¦‚æœä¸æ‰§è¡Œ å¤–éƒ¨å‡½æ•°ï¼Œå†…éƒ¨ä½œç”¨åŸŸå’Œé—­åŒ…éƒ½æ— æ³•è¢«åˆ›å»ºã€‚</p>\n</blockquote>\n<p>å…¶æ¬¡ï¼Œa() è¿”å›ä¸€ä¸ªç”¨å¯¹è±¡å­—é¢é‡è¯­æ³• { key: value, â€¦ } æ¥è¡¨ç¤ºçš„å¯¹è±¡ã€‚è¿™ ä¸ªè¿”å›çš„å¯¹è±¡ä¸­å«æœ‰å¯¹å†…éƒ¨å‡½æ•°è€Œä¸æ˜¯å†…éƒ¨æ•°æ®å˜é‡çš„å¼•ç”¨ã€‚æˆ‘ä»¬ä¿æŒå†…éƒ¨æ•°æ®å˜é‡æ˜¯éš è—ä¸”ç§æœ‰çš„çŠ¶æ€ã€‚å¯ä»¥å°†è¿™ä¸ªå¯¹è±¡ç±»å‹çš„è¿”å›å€¼çœ‹ä½œæœ¬è´¨ä¸Šæ˜¯æ¨¡å—çš„å…¬å…± APIã€‚</p>\n<p>è¿™ä¸ªå¯¹è±¡ç±»å‹çš„è¿”å›å€¼æœ€ç»ˆè¢«èµ‹å€¼ç»™å¤–éƒ¨çš„å˜é‡ fï¼Œç„¶åå°±å¯ä»¥é€šè¿‡å®ƒæ¥è®¿é—® API ä¸­çš„ å±æ€§æ–¹æ³•ï¼Œæ¯”å¦‚ f.getW()ã€‚</p>\n<blockquote>\n<p>ä»æ¨¡å—ä¸­è¿”å›ä¸€ä¸ªå®é™…çš„å¯¹è±¡å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è¿”å›ä¸€ä¸ªå†…éƒ¨å‡½ æ•°ã€‚jQuery å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚jQuery å’Œ $ æ ‡è¯†ç¬¦å°±æ˜¯ jQuery æ¨¡å—çš„å…¬ å…± APIï¼Œä½†å®ƒä»¬æœ¬èº«éƒ½æ˜¯å‡½æ•°(ç”±äºå‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ï¼Œå®ƒä»¬æœ¬èº«ä¹Ÿå¯ä»¥æ‹¥æœ‰å± æ€§)ã€‚</p>\n</blockquote>\n<p>å…¶å®æˆ‘ä»¬è¿™æ ·æ¯æ¬¡è°ƒç”¨ä¸€æ¬¡<code>aå‡½æ•°</code>ç›¸å½“äºåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„æ¨¡å—å®ä¾‹ã€‚</p>\n<p>å‡å¦‚ï¼Œæ­¤æ—¶æˆ‘ä»¬å¸Œæœ›åªè¦ä¸€ä¸ªå®ä¾‹ï¼Œé‚£å’‹åŠå‘¢ï¼Ÿ</p>\n<p>å¤©é™çŒ›ç”·â€”-IIFEï¼ˆç«‹å³æ‰§è¡Œå‡½æ•°ï¼‰</p>\n<p>=ã€‹</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> f = (<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> q = <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> w = [<span class=\"number\">1</span>, <span class=\"number\">2</span>];</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getQ</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(q)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getW</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(w)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    getQ: getQ,</span><br><span class=\"line\">    getW: getW,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)(); </span><br><span class=\"line\"></span><br><span class=\"line\">f.getQ(); <span class=\"comment\">// 1</span></span><br><span class=\"line\">f.getW(); <span class=\"comment\">// [1, 2]</span></span><br></pre></td></tr></table></figure>\n\n<p>è¿™ä¸ªæ¨¡å—åªå±äºfä¸€ä¸ªäººï¼Œè¦ä¿®æ”¹åªèƒ½æ‰¾få¸®å¿™äº†ã€‚</p>\n<p>æ—¢ç„¶æ¨¡å—ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé‚£æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥ä¼ å‚å‘€ï¼Ÿ</p>\n<p>æ˜¯çš„ï¼Œç¨ä½œä¿®æ”¹å°±å¥½äº†ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\">id</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> q = <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> w = [<span class=\"number\">1</span>, <span class=\"number\">2</span>];</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getQ</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(q)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getW</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(w)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getId</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(id)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    getQ: getQ,</span><br><span class=\"line\">    getW: getW,</span><br><span class=\"line\">    getId: getId,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> f = a(<span class=\"number\">99</span>); </span><br><span class=\"line\">f.getQ(); <span class=\"comment\">// 1</span></span><br><span class=\"line\">f.getW(); <span class=\"comment\">// [1, 2]</span></span><br><span class=\"line\">f.getId(); <span class=\"comment\">// 99</span></span><br></pre></td></tr></table></figure>\n\n<p>é‚£æˆ‘æƒ³ä¿®æ”¹æ¨¡å—å†…éƒ¨çš„ä¸œè¥¿å’‹åŠæï¼Ÿ</p>\n<p>å®‰æ’ï¼</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\">id</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> q = <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> w = [<span class=\"number\">1</span>, <span class=\"number\">2</span>];</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getQ</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(q)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getW</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(w)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getId</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(id)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">change</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    q = q + <span class=\"number\">1</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    getQ: getQ,</span><br><span class=\"line\">    getW: getW,</span><br><span class=\"line\">    getId: getId,</span><br><span class=\"line\">    change: change,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> f = a(<span class=\"number\">99</span>); </span><br><span class=\"line\">f.getQ(); <span class=\"comment\">// 1</span></span><br><span class=\"line\">f.getW(); <span class=\"comment\">// [1, 2]</span></span><br><span class=\"line\">f.getId(); <span class=\"comment\">// 99</span></span><br><span class=\"line\">f.change(); <span class=\"comment\">// 99</span></span><br><span class=\"line\">f.getQ(); <span class=\"comment\">// 2</span></span><br></pre></td></tr></table></figure>\n\n<p>é€šè¿‡åœ¨æ¨¡å—å®ä¾‹çš„å†…éƒ¨ä¿ç•™å¯¹å…¬å…± API å¯¹è±¡çš„å†…éƒ¨å¼•ç”¨ï¼Œå¯ä»¥ä»å†…éƒ¨å¯¹æ¨¡å—å®ä¾‹è¿›è¡Œä¿® æ”¹ï¼ŒåŒ…æ‹¬æ·»åŠ æˆ–åˆ é™¤æ–¹æ³•å’Œå±æ€§ï¼Œä»¥åŠä¿®æ”¹å®ƒä»¬çš„å€¼ã€‚</p>\n<h4 id=\"è¿‘ç°ä»£çš„æ¨¡å—\"><a href=\"#è¿‘ç°ä»£çš„æ¨¡å—\" class=\"headerlink\" title=\"è¿‘ç°ä»£çš„æ¨¡å—\"></a>è¿‘ç°ä»£çš„æ¨¡å—</h4><h5 id=\"AMDï¼ˆå¾ˆå°‘ç”¨åˆ°äº†ï¼‰\"><a href=\"#AMDï¼ˆå¾ˆå°‘ç”¨åˆ°äº†ï¼‰\" class=\"headerlink\" title=\"AMDï¼ˆå¾ˆå°‘ç”¨åˆ°äº†ï¼‰\"></a>AMDï¼ˆå¾ˆå°‘ç”¨åˆ°äº†ï¼‰</h5><p>AMD å³Asynchronous Module Definitionï¼Œä¸­æ–‡åæ˜¯å¼‚æ­¥æ¨¡å—å®šä¹‰çš„æ„æ€ã€‚å®ƒæ˜¯ä¸€ä¸ªåœ¨æµè§ˆå™¨ç«¯æ¨¡å—åŒ–å¼€å‘çš„è§„èŒƒ</p>\n<p>ç”±äºä¸æ˜¯JavaScriptåŸç”Ÿæ”¯æŒï¼Œä½¿ç”¨AMDè§„èŒƒè¿›è¡Œé¡µé¢å¼€å‘éœ€è¦ç”¨åˆ°å¯¹åº”çš„åº“å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯å¤§åé¼é¼RequireJSï¼Œå®é™…ä¸ŠAMD æ˜¯ RequireJS åœ¨æ¨å¹¿è¿‡ç¨‹ä¸­å¯¹æ¨¡å—å®šä¹‰çš„è§„èŒƒåŒ–çš„äº§å‡º</p>\n<p>requireJSä¸»è¦è§£å†³ä¸¤ä¸ªé—®é¢˜</p>\n<p>1ã€å¤šä¸ªjsæ–‡ä»¶å¯èƒ½æœ‰ä¾èµ–å…³ç³»ï¼Œè¢«ä¾èµ–çš„æ–‡ä»¶éœ€è¦æ—©äºä¾èµ–å®ƒçš„æ–‡ä»¶åŠ è½½åˆ°æµè§ˆå™¨<br>2ã€jsåŠ è½½çš„æ—¶å€™æµè§ˆå™¨ä¼šåœæ­¢é¡µé¢æ¸²æŸ“ï¼ŒåŠ è½½æ–‡ä»¶è¶Šå¤šï¼Œé¡µé¢å¤±å»å“åº”æ—¶é—´è¶Šé•¿<br>çœ‹ä¸€ä¸ªä½¿ç”¨requireJSçš„ä¾‹å­</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* </span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">*  a.js </span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">*  åˆ›å»ºä¸€ä¸ªåä¸ºâ€œaâ€çš„æ¨¡å—</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">define(<span class=\"string\">'a'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">require, exports, module</span>) </span>&#123;   </span><br><span class=\"line\"></span><br><span class=\"line\">  exports.getTime = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;   </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();   </span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;  </span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* </span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">*  b.js </span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">*  åˆ›å»ºä¸€ä¸ªåä¸ºâ€œbâ€çš„æ¨¡å—ï¼ŒåŒæ—¶ä½¿ç”¨ä¾èµ–requireã€exportså’Œåä¸ºâ€œaâ€çš„æ¨¡å—ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"></span><br><span class=\"line\">define(<span class=\"string\">'b'</span>, [<span class=\"string\">'require'</span>, <span class=\"string\">'exports'</span>, <span class=\"string\">'a'</span>], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">require, exports, a</span>) </span>&#123;   exports.test = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;   </span><br><span class=\"line\"></span><br><span class=\"line\">      now: a.getTime()    </span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;;   </span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;  </span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* main.js */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">require</span>([<span class=\"string\">'b'</span>], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">b</span>) </span>&#123;   </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(b.test());  </span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p><strong>è¯­æ³•</strong></p>\n<p>requireJSå®šä¹‰äº†ä¸€ä¸ªå‡½æ•° defineï¼Œå®ƒæ˜¯å…¨å±€å˜é‡ï¼Œç”¨æ¥å®šä¹‰æ¨¡å—</p>\n<p>define(id?, dependencies?, factory);</p>\n<ol>\n<li>idï¼šå¯é€‰å‚æ•°ï¼Œç”¨æ¥å®šä¹‰æ¨¡å—çš„æ ‡è¯†ï¼Œå¦‚æœæ²¡æœ‰æä¾›è¯¥å‚æ•°ï¼Œè„šæœ¬æ–‡ä»¶åï¼ˆå»æ‰æ‹“å±•åï¼‰</li>\n<li>dependenciesï¼šæ˜¯ä¸€ä¸ªå½“å‰æ¨¡å—ä¾èµ–çš„æ¨¡å—åç§°æ•°ç»„</li>\n<li>factoryï¼šå·¥å‚æ–¹æ³•ï¼Œæ¨¡å—åˆå§‹åŒ–è¦æ‰§è¡Œçš„å‡½æ•°æˆ–å¯¹è±¡ã€‚å¦‚æœä¸ºå‡½æ•°ï¼Œå®ƒåº”è¯¥åªè¢«æ‰§è¡Œä¸€æ¬¡ã€‚å¦‚æœæ˜¯å¯¹è±¡ï¼Œæ­¤å¯¹è±¡åº”è¯¥ä¸ºæ¨¡å—çš„è¾“å‡ºå€¼<br>åœ¨é¡µé¢ä¸Šä½¿ç”¨requireå‡½æ•°åŠ è½½æ¨¡å—</li>\n</ol>\n<p>require([dependencies], function(){});<br>require()å‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°</p>\n<ol>\n<li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¡¨ç¤ºæ‰€ä¾èµ–çš„æ¨¡å—</li>\n<li>ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå½“å‰é¢æŒ‡å®šçš„æ¨¡å—éƒ½åŠ è½½æˆåŠŸåï¼Œå®ƒå°†è¢«è°ƒç”¨ã€‚åŠ è½½çš„æ¨¡å—ä¼šä»¥å‚æ•°å½¢å¼ä¼ å…¥è¯¥å‡½æ•°ï¼Œä»è€Œåœ¨å›è°ƒå‡½æ•°å†…éƒ¨å°±å¯ä»¥ä½¿ç”¨è¿™äº›æ¨¡å—</li>\n</ol>\n<p>require()å‡½æ•°åœ¨åŠ è½½ä¾èµ–çš„å‡½æ•°çš„æ—¶å€™æ˜¯å¼‚æ­¥åŠ è½½çš„ï¼Œè¿™æ ·æµè§ˆå™¨ä¸ä¼šå¤±å»å“åº”ï¼Œå®ƒæŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼Œåªæœ‰å‰é¢çš„æ¨¡å—éƒ½åŠ è½½æˆåŠŸåï¼Œæ‰ä¼šè¿è¡Œï¼Œè§£å†³äº†ä¾èµ–æ€§çš„é—®é¢˜ã€‚</p>\n<h5 id=\"CMDï¼ˆå¾ˆå°‘ç”¨åˆ°äº†ï¼‰\"><a href=\"#CMDï¼ˆå¾ˆå°‘ç”¨åˆ°äº†ï¼‰\" class=\"headerlink\" title=\"CMDï¼ˆå¾ˆå°‘ç”¨åˆ°äº†ï¼‰\"></a>CMDï¼ˆå¾ˆå°‘ç”¨åˆ°äº†ï¼‰</h5><p>CMD å³Common Module Definitioné€šç”¨æ¨¡å—å®šä¹‰ï¼ŒCMDè§„èŒƒæ˜¯å›½å†…å‘å±•å‡ºæ¥çš„ï¼Œå°±åƒAMDæœ‰ä¸ªrequireJSï¼ŒCMDæœ‰ä¸ªæµè§ˆå™¨çš„å®ç°SeaJSï¼ŒSeaJSè¦è§£å†³çš„é—®é¢˜å’ŒrequireJSä¸€æ ·ï¼Œåªä¸è¿‡åœ¨æ¨¡å—å®šä¹‰æ–¹å¼å’Œæ¨¡å—åŠ è½½ï¼ˆå¯ä»¥è¯´è¿è¡Œã€è§£æï¼‰æ—¶æœºä¸Šæœ‰æ‰€ä¸åŒ<br><strong>è¯­æ³•</strong><br>Sea.js æ¨å´‡ä¸€ä¸ªæ¨¡å—ä¸€ä¸ªæ–‡ä»¶ï¼Œéµå¾ªç»Ÿä¸€çš„å†™æ³•<br>define(id?, deps?, factory)<br>å› ä¸ºCMDæ¨å´‡</p>\n<ol>\n<li>ä¸€ä¸ªæ–‡ä»¶ä¸€ä¸ªæ¨¡å—ï¼Œæ‰€ä»¥ç»å¸¸å°±ç”¨æ–‡ä»¶åä½œä¸ºæ¨¡å—id</li>\n<li>CMDæ¨å´‡ä¾èµ–å°±è¿‘ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸åœ¨defineçš„å‚æ•°ä¸­å†™ä¾èµ–ï¼Œåœ¨factoryä¸­å†™</li>\n</ol>\n<p>factoryæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæœ‰ä¸‰ä¸ªå‚æ•°ï¼Œfunction(require, exports, module)</p>\n<ol>\n<li>require æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œæ¥å— æ¨¡å—æ ‡è¯† ä½œä¸ºå”¯ä¸€å‚æ•°ï¼Œç”¨æ¥è·å–å…¶ä»–æ¨¡å—æä¾›çš„æ¥å£ï¼šrequire(id)</li>\n<li>exports æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨æ¥å‘å¤–æä¾›æ¨¡å—æ¥å£</li>\n<li>module æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¸Šé¢å­˜å‚¨äº†ä¸å½“å‰æ¨¡å—ç›¸å…³è”çš„ä¸€äº›å±æ€§å’Œæ–¹æ³•</li>\n</ol>\n<p>çœ‹ä¸ªä¾‹å­ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* </span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">*  a.js </span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">*  ä¸€ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">require, exports, module</span>) </span>&#123;   </span><br><span class=\"line\"></span><br><span class=\"line\">  exports.getTime = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;   </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();   </span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;  </span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* main.js */</span></span><br><span class=\"line\"></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">require, exports, module</span>) </span>&#123;  </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/* æŒ‰éœ€åŠ è½½a.js */</span> </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> a = <span class=\"built_in\">require</span>(<span class=\"string\">'./a'</span>);    </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(a.getTime());  </span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"AMDå’ŒCMDçš„åŒºåˆ«\"><a href=\"#AMDå’ŒCMDçš„åŒºåˆ«\" class=\"headerlink\" title=\"AMDå’ŒCMDçš„åŒºåˆ«\"></a>AMDå’ŒCMDçš„åŒºåˆ«</h5><p>æœ€æ˜æ˜¾çš„åŒºåˆ«å°±æ˜¯åœ¨æ¨¡å—å®šä¹‰æ—¶å¯¹ä¾èµ–çš„å¤„ç†ä¸åŒ</p>\n<p><strong>1ã€AMDæ¨å´‡ä¾èµ–å‰ç½®ï¼Œåœ¨å®šä¹‰æ¨¡å—çš„æ—¶å€™å°±è¦å£°æ˜å…¶ä¾èµ–çš„æ¨¡å—</strong><br><strong>2ã€CMDæ¨å´‡å°±è¿‘ä¾èµ–ï¼Œåªæœ‰åœ¨ç”¨åˆ°æŸä¸ªæ¨¡å—çš„æ—¶å€™å†å»require</strong><br>è¿™ç§åŒºåˆ«å„æœ‰ä¼˜åŠ£ï¼Œåªæ˜¯è¯­æ³•ä¸Šçš„å·®è·ï¼Œè€Œä¸”requireJSå’ŒSeaJSéƒ½æ”¯æŒå¯¹æ–¹çš„å†™æ³•</p>\n<p>AMDå’ŒCMDæœ€å¤§çš„åŒºåˆ«æ˜¯å¯¹ä¾èµ–æ¨¡å—çš„æ‰§è¡Œæ—¶æœºå¤„ç†ä¸åŒï¼Œæ³¨æ„ä¸æ˜¯åŠ è½½çš„æ—¶æœºæˆ–è€…æ–¹å¼ä¸åŒ</p>\n<p>å¾ˆå¤šäººè¯´requireJSæ˜¯å¼‚æ­¥åŠ è½½æ¨¡å—ï¼ŒSeaJSæ˜¯åŒæ­¥åŠ è½½æ¨¡å—ï¼Œè¿™ä¹ˆç†è§£å®é™…ä¸Šæ˜¯ä¸å‡†ç¡®çš„ï¼Œå…¶å®åŠ è½½æ¨¡å—éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œåªä¸è¿‡AMDä¾èµ–å‰ç½®ï¼Œjså¯ä»¥æ–¹ä¾¿çŸ¥é“ä¾èµ–æ¨¡å—æ˜¯è°ï¼Œç«‹å³åŠ è½½ï¼Œè€ŒCMDå°±è¿‘ä¾èµ–ï¼Œéœ€è¦ä½¿ç”¨æŠŠæ¨¡å—å˜ä¸ºå­—ç¬¦ä¸²è§£æä¸€éæ‰çŸ¥é“ä¾èµ–äº†é‚£äº›æ¨¡å—ï¼Œè¿™ä¹Ÿæ˜¯å¾ˆå¤šäººè¯Ÿç—…CMDçš„ä¸€ç‚¹ï¼Œç‰ºç‰²æ€§èƒ½æ¥å¸¦æ¥å¼€å‘çš„ä¾¿åˆ©æ€§ï¼Œå®é™…ä¸Šè§£ææ¨¡å—ç”¨çš„æ—¶é—´çŸ­åˆ°å¯ä»¥å¿½ç•¥</p>\n<p>ä¸ºä»€ä¹ˆæˆ‘ä»¬è¯´ä¸¤ä¸ªçš„åŒºåˆ«æ˜¯ä¾èµ–æ¨¡å—æ‰§è¡Œæ—¶æœºä¸åŒï¼Œä¸ºä»€ä¹ˆå¾ˆå¤šäººè®¤ä¸ºADMæ˜¯å¼‚æ­¥çš„ï¼ŒCMDæ˜¯åŒæ­¥çš„ï¼ˆé™¤äº†åå­—çš„åŸå› ã€‚ã€‚ã€‚ï¼‰</p>\n<p>åŒæ ·éƒ½æ˜¯å¼‚æ­¥åŠ è½½æ¨¡å—ï¼ŒAMDåœ¨åŠ è½½æ¨¡å—å®Œæˆåå°±ä¼šæ‰§è¡Œæ”¹æ¨¡å—ï¼Œæ‰€æœ‰æ¨¡å—éƒ½åŠ è½½æ‰§è¡Œå®Œåä¼šè¿›å…¥requireçš„å›è°ƒå‡½æ•°ï¼Œæ‰§è¡Œä¸»é€»è¾‘ï¼Œè¿™æ ·çš„æ•ˆæœå°±æ˜¯ä¾èµ–æ¨¡å—çš„æ‰§è¡Œé¡ºåºå’Œä¹¦å†™é¡ºåºä¸ä¸€å®šä¸€è‡´ï¼Œçœ‹ç½‘ç»œé€Ÿåº¦ï¼Œå“ªä¸ªå…ˆä¸‹è½½ä¸‹æ¥ï¼Œå“ªä¸ªå…ˆæ‰§è¡Œï¼Œä½†æ˜¯ä¸»é€»è¾‘ä¸€å®šåœ¨æ‰€æœ‰ä¾èµ–åŠ è½½å®Œæˆåæ‰æ‰§è¡Œ</p>\n<p>CMDåŠ è½½å®ŒæŸä¸ªä¾èµ–æ¨¡å—åå¹¶ä¸æ‰§è¡Œï¼Œåªæ˜¯ä¸‹è½½è€Œå·²ï¼Œåœ¨æ‰€æœ‰ä¾èµ–æ¨¡å—åŠ è½½å®Œæˆåè¿›å…¥ä¸»é€»è¾‘ï¼Œé‡åˆ°requireè¯­å¥çš„æ—¶å€™æ‰æ‰§è¡Œå¯¹åº”çš„æ¨¡å—ï¼Œè¿™æ ·æ¨¡å—çš„æ‰§è¡Œé¡ºåºå’Œä¹¦å†™é¡ºåºæ˜¯å®Œå…¨ä¸€è‡´çš„</p>\n<p>è¿™ä¹Ÿæ˜¯å¾ˆå¤šäººè¯´AMDç”¨æˆ·ä½“éªŒå¥½ï¼Œå› ä¸ºæ²¡æœ‰å»¶è¿Ÿï¼Œä¾èµ–æ¨¡å—æå‰æ‰§è¡Œäº†ï¼ŒCMDæ€§èƒ½å¥½ï¼Œå› ä¸ºåªæœ‰ç”¨æˆ·éœ€è¦çš„æ—¶å€™æ‰æ‰§è¡Œçš„åŸå› </p>\n<h4 id=\"ç°ä»£çš„æ¨¡å—\"><a href=\"#ç°ä»£çš„æ¨¡å—\" class=\"headerlink\" title=\"ç°ä»£çš„æ¨¡å—\"></a>ç°ä»£çš„æ¨¡å—</h4><h5 id=\"CommonJS\"><a href=\"#CommonJS\" class=\"headerlink\" title=\"CommonJS\"></a>CommonJS</h5><p>CommonJS æœ€æ—©æ˜¯ Node åœ¨ä½¿ç”¨ï¼Œç›®å‰ä¹Ÿä»ç„¶å¹¿æ³›ä½¿ç”¨ï¼Œæ¯”å¦‚åœ¨ Webpack ä¸­ä½ å°±èƒ½è§åˆ°å®ƒï¼Œå½“ç„¶ç›®å‰åœ¨ Node ä¸­çš„æ¨¡å—ç®¡ç†å·²ç»å’Œ CommonJS æœ‰ä¸€äº›åŒºåˆ«äº†ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// a.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    a: <span class=\"number\">1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// or </span></span><br><span class=\"line\">exports.a = <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// b.js</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"built_in\">module</span> = <span class=\"built_in\">require</span>(<span class=\"string\">'./a.js'</span>)</span><br><span class=\"line\"><span class=\"built_in\">module</span>.a <span class=\"comment\">// -&gt; log 1</span></span><br></pre></td></tr></table></figure>\n\n<p>å› ä¸º CommonJS è¿˜æ˜¯ä¼šä½¿ç”¨åˆ°çš„ï¼Œæ‰€ä»¥è¿™é‡Œä¼šå¯¹ä¸€äº›ç–‘éš¾ç‚¹è¿›è¡Œè§£æ</p>\n<p>å…ˆè¯´ <code>require</code> å§</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"built_in\">module</span> = <span class=\"built_in\">require</span>(<span class=\"string\">'./a.js'</span>)</span><br><span class=\"line\"><span class=\"built_in\">module</span>.a </span><br><span class=\"line\"><span class=\"comment\">// è¿™é‡Œå…¶å®å°±æ˜¯åŒ…è£…äº†ä¸€å±‚ç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œè¿™æ ·å°±ä¸ä¼šæ±¡æŸ“å…¨å±€å˜é‡äº†ï¼Œ</span></span><br><span class=\"line\"><span class=\"comment\">// é‡è¦çš„æ˜¯ module è¿™é‡Œï¼Œmodule æ˜¯ Node ç‹¬æœ‰çš„ä¸€ä¸ªå˜é‡</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    a: <span class=\"number\">1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// module åŸºæœ¬å®ç°</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"built_in\">module</span> = &#123;</span><br><span class=\"line\">  id: <span class=\"string\">'xxxx'</span>, <span class=\"comment\">// æˆ‘æ€»å¾—çŸ¥é“æ€ä¹ˆå»æ‰¾åˆ°ä»–å§</span></span><br><span class=\"line\">  exports: &#123;&#125; <span class=\"comment\">// exports å°±æ˜¯ä¸ªç©ºå¯¹è±¡</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// è¿™ä¸ªæ˜¯ä¸ºä»€ä¹ˆ exports å’Œ module.exports ç”¨æ³•ç›¸ä¼¼çš„åŸå› </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> exports = <span class=\"built_in\">module</span>.exports </span><br><span class=\"line\"><span class=\"keyword\">var</span> load = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">module</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// å¯¼å‡ºçš„ä¸œè¥¿</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> a = <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"built_in\">module</span>.exports = a</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">module</span>.exports</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"comment\">// ç„¶åå½“æˆ‘ require çš„æ—¶å€™å»æ‰¾åˆ°ç‹¬ç‰¹çš„</span></span><br><span class=\"line\"><span class=\"comment\">// idï¼Œç„¶åå°†è¦ä½¿ç”¨çš„ä¸œè¥¿ç”¨ç«‹å³æ‰§è¡Œå‡½æ•°åŒ…è£…ä¸‹ï¼Œover</span></span><br></pre></td></tr></table></figure>\n\n<p>å¦å¤–è™½ç„¶ <code>exports</code> å’Œ <code>module.exports</code> ç”¨æ³•ç›¸ä¼¼ï¼Œä½†æ˜¯ä¸èƒ½å¯¹ <code>exports</code> ç›´æ¥èµ‹å€¼ã€‚å› ä¸º <code>var exports = module.exports</code> è¿™å¥ä»£ç è¡¨æ˜äº† <code>exports</code> å’Œ <code>module.exports</code> äº«æœ‰ç›¸åŒåœ°å€ï¼Œé€šè¿‡æ”¹å˜å¯¹è±¡çš„å±æ€§å€¼ä¼šå¯¹ä¸¤è€…éƒ½èµ·æ•ˆï¼Œä½†æ˜¯å¦‚æœç›´æ¥å¯¹ <code>exports</code> èµ‹å€¼å°±ä¼šå¯¼è‡´ä¸¤è€…ä¸å†æŒ‡å‘åŒä¸€ä¸ªå†…å­˜åœ°å€ï¼Œä¿®æ”¹å¹¶ä¸ä¼šå¯¹ <code>module.exports</code> èµ·æ•ˆã€‚</p>\n<h5 id=\"ES-Module\"><a href=\"#ES-Module\" class=\"headerlink\" title=\"ES Module\"></a>ES Module</h5><p>ES Module æ˜¯åŸç”Ÿå®ç°çš„æ¨¡å—åŒ–æ–¹æ¡ˆï¼Œä¸ CommonJS æœ‰ä»¥ä¸‹å‡ ä¸ªåŒºåˆ«</p>\n<ul>\n<li>CommonJS æ”¯æŒåŠ¨æ€å¯¼å…¥ï¼Œä¹Ÿå°±æ˜¯ <code>require(${path}/xx.js)</code>ï¼Œåè€…ç›®å‰ä¸æ”¯æŒï¼Œä½†æ˜¯å·²æœ‰ææ¡ˆ</li>\n<li>CommonJS æ˜¯åŒæ­¥å¯¼å…¥ï¼Œå› ä¸ºç”¨äºæœåŠ¡ç«¯ï¼Œæ–‡ä»¶éƒ½åœ¨æœ¬åœ°ï¼ŒåŒæ­¥å¯¼å…¥å³ä½¿å¡ä½ä¸»çº¿ç¨‹å½±å“ä¹Ÿä¸å¤§ã€‚è€Œåè€…æ˜¯å¼‚æ­¥å¯¼å…¥ï¼Œå› ä¸ºç”¨äºæµè§ˆå™¨ï¼Œéœ€è¦ä¸‹è½½æ–‡ä»¶ï¼Œå¦‚æœä¹Ÿé‡‡ç”¨åŒæ­¥å¯¼å…¥ä¼šå¯¹æ¸²æŸ“æœ‰å¾ˆå¤§å½±å“</li>\n<li>CommonJS åœ¨å¯¼å‡ºæ—¶éƒ½æ˜¯å€¼æ‹·è´ï¼Œå°±ç®—å¯¼å‡ºçš„å€¼å˜äº†ï¼Œå¯¼å…¥çš„å€¼ä¹Ÿä¸ä¼šæ”¹å˜ï¼Œæ‰€ä»¥å¦‚æœæƒ³æ›´æ–°å€¼ï¼Œå¿…é¡»é‡æ–°å¯¼å…¥ä¸€æ¬¡ã€‚ä½†æ˜¯ ES Module é‡‡ç”¨å®æ—¶ç»‘å®šçš„æ–¹å¼ï¼Œå¯¼å…¥å¯¼å‡ºçš„å€¼éƒ½æŒ‡å‘åŒä¸€ä¸ªå†…å­˜åœ°å€ï¼Œæ‰€ä»¥å¯¼å…¥å€¼ä¼šè·Ÿéšå¯¼å‡ºå€¼å˜åŒ–</li>\n<li>ES Module ä¼šç¼–è¯‘æˆ <code>require/exports</code> æ¥æ‰§è¡Œçš„</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// å¼•å…¥æ¨¡å— API</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> XXX <span class=\"keyword\">from</span> <span class=\"string\">'./a.js'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; XXX &#125; <span class=\"keyword\">from</span> <span class=\"string\">'./a.js'</span></span><br><span class=\"line\"><span class=\"comment\">// å¯¼å‡ºæ¨¡å— API</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\"></span>) </span>&#123;&#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h2><p>å½“å‡½æ•°å¯ä»¥è®°ä½å¹¶è®¿é—®æ‰€åœ¨çš„è¯æ³•ä½œç”¨åŸŸï¼Œå³ä½¿å‡½æ•°æ˜¯åœ¨å½“å‰è¯æ³•ä½œç”¨åŸŸä¹‹å¤–æ‰§è¡Œï¼Œè¿™æ—¶ å°±äº§ç”Ÿäº†é—­åŒ…ã€‚</p>\n<blockquote>\n<p>ç´¢å¼•ï¼š<a href=\"https://juejin.im/post/5a422b036fb9a045211ef789\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/5a422b036fb9a045211ef789</a></p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<p>æœ€è¿‘åœ¨å†™ã€é‡æ‹¾å‰ç«¯ã€‘ç³»åˆ—ï¼Œä¸‹é¢æœ‰å‡ ä¸ªå¿«é€Ÿé€šé“ï¼Œå¤§å®¶è‡ªå–</p>\n<p><a href=\"https://juejin.im/post/6850418113944420359\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿</a></p>\n<p><a href=\"https://juejin.im/post/6850418117508759566\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—</a></p>\n<p><a href=\"https://juejin.im/post/6854573215658803208\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this</a></p>\n<p><a href=\"https://juejin.im/post/6859911609633767438\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šJavaScriptçš„æ‰§è¡Œæœºåˆ¶</a></p>\n<p><a href=\"https://juejin.im/post/6860375101322461198\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC</a></p>\n<p><a href=\"https://juejin.im/post/6865204092877144077\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ</a></p>\n<h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><p>å›å¿†æˆ‘å‰å‡ å¹´çš„æ—¶å…‰ï¼Œå¤§é‡ä½¿ç”¨ JavaScript ä½†å´å®Œå…¨ä¸ç†è§£é—­åŒ…æ˜¯ä»€ä¹ˆã€‚æ€»æ˜¯æ„Ÿè§‰è¿™é—¨è¯­ è¨€æœ‰å…¶éšè”½çš„ä¸€é¢ï¼Œå¦‚æœèƒ½å¤ŸæŒæ¡å°†ä¼šåŠŸåŠ›å¤§æ¶¨ï¼Œä½†è®½åˆºçš„æ˜¯æˆ‘å§‹ç»ˆæ— æ³•æŒæ¡å…¶ä¸­çš„é—¨ é“ã€‚</p>\n<blockquote>\n<p>JavaScriptä¸­é—­åŒ…æ— å¤„ä¸åœ¨ï¼Œä½ åªéœ€è¦èƒ½å¤Ÿè¯†åˆ«å¹¶æ‹¥æŠ±å®ƒã€‚</p>\n<p>æœ€åä½ æç„¶å¤§æ‚Ÿ:åŸæ¥åœ¨æˆ‘çš„ä»£ç ä¸­å·²ç»åˆ°å¤„éƒ½æ˜¯é—­åŒ…äº†ï¼Œç°åœ¨æˆ‘ç»ˆäºèƒ½ç†è§£å®ƒä»¬äº†ã€‚ç† è§£é—­åŒ…å°±å¥½åƒ Neo3 ç¬¬ä¸€æ¬¡è§åˆ°çŸ©é˜µ 4 ä¸€æ ·ã€‚</p>\n</blockquote>\n<h2 id=\"å®šä¹‰\"><a href=\"#å®šä¹‰\" class=\"headerlink\" title=\"å®šä¹‰\"></a>å®šä¹‰</h2><p>å½“å‡½æ•°å¯ä»¥è®°ä½å¹¶è®¿é—®æ‰€åœ¨çš„è¯æ³•ä½œç”¨åŸŸæ—¶ï¼Œå°±äº§ç”Ÿäº†é—­åŒ…ï¼Œå³ä½¿å‡½æ•°æ˜¯åœ¨å½“å‰è¯æ³•ä½œç”¨ åŸŸä¹‹å¤–æ‰§è¡Œã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">  <span class=\"keyword\">var</span> a = <span class=\"number\">2</span>;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bar</span>(<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( a ); <span class=\"comment\">// 2</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tbar(); </span><br><span class=\"line\">&#125;</span><br><span class=\"line\">foo();</span><br></pre></td></tr></table></figure>\n\n<p>è¿™æ ·å¯èƒ½è¿˜ä¸å¤Ÿç›´è§‚ï¼Œæˆ‘ä»¬å†ä¿®æ”¹ä¸€ä¸‹ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">  <span class=\"keyword\">var</span> a = <span class=\"number\">2</span>;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bar</span>(<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( a ); <span class=\"comment\">// 2</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> bar; </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> baz = foo();</span><br><span class=\"line\">baz(); <span class=\"comment\">// 2 â€”â€” æœ‹å‹ï¼Œè¿™å°±æ˜¯é—­åŒ…çš„æ•ˆæœã€‚</span></span><br></pre></td></tr></table></figure>\n\n<p>å…¶å®ï¼Œåœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è°ƒç”¨å®Œ<code>foo</code>ä¹‹åï¼ŒJavaScriptæ£€æµ‹åˆ°åç»­ä¸ä¼šå†ç”¨åˆ°ä»–äº†ï¼Œ æ‰€ä»¥ä»–çš„å†…éƒ¨ä½œç”¨åŸŸå°±ä¼šè¢«å›æ”¶â™»ï¸ã€‚ï¼ˆæ¶‰åŠåˆ°åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œåç»­çš„æ–‡ç« æˆ‘ä»¬ä¼šè¯´åˆ°ã€‚ï¼‰</p>\n<p>é—­åŒ…çš„ç¥å¥‡ä¹‹å¤„å°±åœ¨äºä»–å¯ä»¥é˜»æ­¢â™»ï¸çš„å‘ç”Ÿã€‚å› ä¸ºäº‹å®ä¸Šå†…éƒ¨ä½œç”¨åŸŸå·²ç„¶å­˜åœ¨ï¼Œé‚£ä¹ˆåˆæœ‰è°åœ¨ä½¿ç”¨å‘¢ï¼Ÿå“¦~æ˜¯æˆ‘ä»¬çš„<code>bar</code>åœ¨ä½¿ç”¨ã€‚</p>\n<p>æ‹œ bar() æ‰€å£°æ˜çš„ä½ç½®æ‰€èµï¼Œå®ƒæ‹¥æœ‰æ¶µç›– foo() å†…éƒ¨ä½œç”¨åŸŸçš„é—­åŒ…ï¼Œä½¿å¾—è¯¥ä½œç”¨åŸŸèƒ½å¤Ÿä¸€ ç›´å­˜æ´»ï¼Œä»¥ä¾› bar() åœ¨ä¹‹åä»»ä½•æ—¶é—´è¿›è¡Œå¼•ç”¨ã€‚</p>\n<p>bar() ä¾ç„¶æŒæœ‰å¯¹è¯¥ä½œç”¨åŸŸçš„å¼•ç”¨ï¼Œè€Œè¿™ä¸ªå¼•ç”¨å°±å«ä½œé—­åŒ…ã€‚</p>\n<p>æ‰€ä»¥æˆ‘è¯´è¯´æˆ‘è‡ªå·±çš„ç†è§£ï¼š</p>\n<p>é—­åŒ…æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶çš„æ¦‚å¿µï¼Œå¦‚æœåªæ˜¯å£°æ˜æˆ–è€…å®šä¹‰ã€‚å³ä½¿ä»–ç¬¦åˆé—­åŒ…çš„è¦æ±‚é‚£ä»–ä¹Ÿä¸èƒ½æˆä¸ºä¸€ä¸ªçœŸæ­£çš„é—­åŒ…ã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºå†…å­˜åœ°å€å¹¶æ²¡æœ‰å¼€å§‹åˆ†é…ï¼Œé—­åŒ…åªæ˜¯åˆ†é…ä¹‹åé‚£ä¸€å—åœ°å€æ²¡æœ‰è¢«å›æ”¶è€Œå·²ã€‚</p>\n<p>å†å›åˆ°æˆ‘ä»¬æœ€å¼€å§‹çš„å‡½æ•°ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">  <span class=\"keyword\">var</span> a = <span class=\"number\">2</span>;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bar</span>(<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( a ); <span class=\"comment\">// 2</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tbar(); </span><br><span class=\"line\">&#125;</span><br><span class=\"line\">foo();</span><br></pre></td></tr></table></figure>\n\n<p>ä¸€ä¸ªå‡½æ•°fooå†…æœ‰ä¸€ä¸ªå‡½æ•°barã€‚å¹¶ä¸”å‡½æ•°barç”¨åˆ°äº†å‡½æ•°fooçš„å˜é‡ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç§°è¿™ä¸ªå¼•ç”¨è¿‡ç¨‹ä¸ºâ€œé—­åŒ…â€ã€‚ä½†æ˜¯æˆ‘ä»¬è¿™ä¸ªå‡½æ•°fooå¿…é¡»è¢«è°ƒç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ä¾‹å­åœ°ä¸‹è°ƒç”¨äº†ä¸€ä¸‹å‡½æ•°fooã€‚</p>\n<p>å†å›åˆ°æˆ‘ä»¬é‚£ä¸ªè¾ƒä¸ºæ¸…æ™°çš„ä¾‹å­</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">  <span class=\"keyword\">var</span> a = <span class=\"number\">2</span>;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bar</span>(<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log( a ); <span class=\"comment\">// 2</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> bar; </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">var</span> baz = foo();</span><br><span class=\"line\">baz(); <span class=\"comment\">// 2 â€”â€” æœ‹å‹ï¼Œè¿™å°±æ˜¯é—­åŒ…çš„æ•ˆæœã€‚</span></span><br></pre></td></tr></table></figure>\n\n<p>è¿™ä¸ªåº”è¯¥æ˜¯å¤§ä¼—è®¤çŸ¥ä¸Šéå¸¸ç»å…¸çš„ä¸€ä¸ªé—­åŒ…äº†å§ï¼Ÿä½†æ˜¯å‡å¦‚è¯´è¿™ä¸ªfooå‡½æ•°æ²¡æœ‰è¢«è°ƒç”¨ï¼Œé‚£ä¹ˆæˆ‘è®¤ä¸ºä»–å°±ä¸æ˜¯ä¸€ä¸ªé—­åŒ…ã€‚</p>\n<h2 id=\"å®è·µ\"><a href=\"#å®è·µ\" class=\"headerlink\" title=\"å®è·µ\"></a>å®è·µ</h2><h3 id=\"å¸¸è§çš„é—­åŒ…\"><a href=\"#å¸¸è§çš„é—­åŒ…\" class=\"headerlink\" title=\"å¸¸è§çš„é—­åŒ…\"></a>å¸¸è§çš„é—­åŒ…</h3><p>å‰é¢çš„ä»£ç ç‰‡æ®µæœ‰ç‚¹æ­»æ¿ï¼Œå¹¶ä¸”ä¸ºäº†è§£é‡Šå¦‚ä½•ä½¿ç”¨é—­åŒ…è€Œäººä¸ºåœ°åœ¨ç»“æ„ä¸Šè¿›è¡Œäº†ä¿®é¥°ã€‚ä½ å·²ç»å†™è¿‡çš„ä»£ç ä¸­ä¸€å®šåˆ°å¤„éƒ½æ˜¯é—­åŒ…çš„èº«å½±ã€‚ ç°åœ¨è®©æˆ‘ä»¬æ¥ææ‡‚è¿™ä¸ªäº‹å®ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">wait</span>(<span class=\"params\">message</span>) </span>&#123;</span><br><span class=\"line\">\tsetTimeout( </span><br><span class=\"line\">\t\t<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">timer</span>(<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">\t\t\t<span class=\"built_in\">console</span>.log( message );</span><br><span class=\"line\">\t&#125;, <span class=\"number\">1000</span> ); </span><br><span class=\"line\">&#125;</span><br><span class=\"line\">wait( <span class=\"string\">\"Hello, closure!\"</span> );</span><br></pre></td></tr></table></figure>\n\n<p>è¿™ä¸ªä¾‹å­éå¸¸å¸¸è§ï¼Œä»£ç å¾ˆç®€å•ï¼Œå°±æ˜¯1ç§’é’Ÿä¹‹åè¾“å‡ºæˆ‘ä»¬ä¼ å…¥çš„å‚æ•°ã€‚</p>\n<p>ä½†æ˜¯æˆ‘ä»¬ä»”ç»†çœ‹å°±èƒ½çœ‹è§é—­åŒ…çš„å½±å­ï¼Œä¸€ç§’é’Ÿä¹‹åï¼Œ<code>message</code>è¿˜æ˜¯å¯ä»¥è¢«<code>timer</code>è®¿é—®åˆ°ã€‚å¹¶æ²¡æœ‰è¢«å›æ”¶â™»ï¸æ‰ã€‚</p>\n<blockquote>\n<p>è¿™å°±æ˜¯é—­åŒ…</p>\n</blockquote>\n<p>æœ¬è´¨ä¸Šæ— è®ºä½•æ—¶ä½•åœ°ï¼Œå¦‚æœå°†å‡½æ•°(è®¿é—®å®ƒä»¬å„è‡ªçš„è¯æ³•ä½œç”¨åŸŸ)å½“ä½œç¬¬ä¸€ çº§çš„å€¼ç±»å‹å¹¶åˆ°å¤„ä¼ é€’ï¼Œä½ å°±ä¼šçœ‹åˆ°é—­åŒ…åœ¨è¿™äº›å‡½æ•°ä¸­çš„åº”ç”¨ã€‚åœ¨å®šæ—¶å™¨ã€äº‹ä»¶ç›‘å¬å™¨ã€ Ajax è¯·æ±‚ã€è·¨çª—å£é€šä¿¡ã€Web Workers æˆ–è€…ä»»ä½•å…¶ä»–çš„å¼‚æ­¥(æˆ–è€…åŒæ­¥)ä»»åŠ¡ä¸­ï¼Œåªè¦ä½¿ ç”¨äº†å›è°ƒå‡½æ•°ï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨ä½¿ç”¨é—­åŒ…!</p>\n<h3 id=\"é—­åŒ…ä¸å¾ªç¯\"><a href=\"#é—­åŒ…ä¸å¾ªç¯\" class=\"headerlink\" title=\"é—­åŒ…ä¸å¾ªç¯\"></a>é—­åŒ…ä¸å¾ªç¯</h3><p>è¯´åˆ°è¿™é‡Œè‚¯å®šæœ‰äººé©¬ä¸Šå°±æƒ³åˆ°äº†æœ€ç»å…¸çš„é¢è¯•é¢˜ï¼šè¯·å†™å‡ºä»¥ä¸‹çš„è¾“å‡ºå†…å®¹</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i=<span class=\"number\">1</span>; i&lt;=<span class=\"number\">5</span>; i++) &#123; </span><br><span class=\"line\">\tsetTimeout( <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">timer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">console</span>.log( i ); </span><br><span class=\"line\">  &#125;, i*<span class=\"number\">1000</span> );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯¹è¿™æ®µä»£ç è¡Œä¸ºçš„é¢„æœŸæ˜¯åˆ†åˆ«è¾“å‡ºæ•°å­— 1~5ï¼Œæ¯ç§’ä¸€æ¬¡ï¼Œæ¯æ¬¡ä¸€ä¸ªã€‚</p>\n<p>ä½†å®é™…ä¸Šï¼Œè¿™æ®µä»£ç åœ¨è¿è¡Œæ—¶ä¼šä»¥æ¯ç§’ä¸€æ¬¡çš„é¢‘ç‡è¾“å‡ºäº”æ¬¡ 6ã€‚</p>\n<p>è¿™æ˜¯ä¸ºä»€ä¹ˆ?</p>\n<p>å› ä¸ºç­‰åˆ°æ‰§è¡Œ<code>console.log</code>çš„æ—¶å€™ï¼Œé‚£ä¸ªæ—¶å€™çš„iå·²ç»åœ¨forçš„è°ƒæ•™ä¸‹å˜æˆäº†6äº†ï¼Œæ‰€ä»¥ä»–ä»¬å»å–åªèƒ½å–åˆ°6ï¼›</p>\n<p>ï¼ˆäº‹å®ä¸Šï¼Œ å½“å®šæ—¶å™¨è¿è¡Œæ—¶å³ä½¿æ¯ä¸ªè¿­ä»£ä¸­æ‰§è¡Œçš„æ˜¯setTimeout(.., 0)ï¼Œæ‰€æœ‰çš„å›è°ƒå‡½æ•°ä¾ç„¶æ˜¯åœ¨å¾ª ç¯ç»“æŸåæ‰ä¼šè¢«æ‰§è¡Œï¼Œå› æ­¤ä¼šæ¯æ¬¡è¾“å‡ºä¸€ä¸ª 6 å‡ºæ¥ã€‚è¿™ä¸ªæ¶‰åŠåˆ°æ—¶é—´å¾ªç¯ï¼Œåé¢çš„æ–‡ç« ä¼šå…·ä½“çš„å±•å¼€æ¥è®²ï¼‰</p>\n<p>é€šè¿‡æˆ‘ä»¬åˆšåˆšçš„å­¦ä¹ çŸ¥é“ï¼Œå¦‚æœæˆ‘ä»¬åˆ›é€ äº†ä¸€ä¸ªé—­åŒ…ï¼Œè¿™æ ·çš„è¯è¿™ä¸ªiä¸å°±ä¸ä¼šè¢«å›æ”¶äº†å—ï¼Ÿ</p>\n<p>okï¼Œæˆ‘ä»¬è¯•è¯•</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i=<span class=\"number\">1</span>; i&lt;=<span class=\"number\">5</span>; i++) &#123; </span><br><span class=\"line\">  (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">\t\tsetTimeout( <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">timer</span>(<span class=\"params\"></span>) </span>&#123; </span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log( i );</span><br><span class=\"line\">    &#125;, i*<span class=\"number\">1000</span> );</span><br><span class=\"line\">  &#125;)();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>è¿™æ ·èƒ½è¡Œå—?è¯•è¯•å§ï¼Œåœ¨Chromeæˆ–è€…nodeé‡Œé¢è¯•è¯•å§ï¼Œæˆ‘ç­‰ç€ä½ ã€‚</p>\n<p>æˆ‘ä¸å–å…³å­äº†ã€‚è¿™æ ·ä¸è¡Œã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆå‘¢?æˆ‘ä»¬ç°åœ¨æ˜¾ç„¶æ‹¥æœ‰æ›´å¤šçš„è¯æ³•ä½œç”¨åŸŸäº†ã€‚çš„ç¡® æ¯ä¸ªå»¶è¿Ÿå‡½æ•°éƒ½ä¼šå°† IIFE åœ¨æ¯æ¬¡è¿­ä»£ä¸­åˆ›å»ºçš„ä½œç”¨åŸŸå°é—­èµ·æ¥ã€‚</p>\n<p>å¦‚æœä½œç”¨åŸŸæ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆä»…ä»…å°†å®ƒä»¬è¿›è¡Œå°é—­æ˜¯ä¸å¤Ÿçš„ã€‚ä»”ç»†çœ‹ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„ IIFE åªæ˜¯ä¸€ ä¸ªä»€ä¹ˆéƒ½æ²¡æœ‰çš„ç©ºä½œç”¨åŸŸã€‚å®ƒéœ€è¦åŒ…å«ä¸€ç‚¹å®è´¨å†…å®¹æ‰èƒ½ä¸ºæˆ‘ä»¬æ‰€ç”¨ã€‚</p>\n<p>å®ƒéœ€è¦æœ‰è‡ªå·±çš„å˜é‡ï¼Œç”¨æ¥åœ¨æ¯ä¸ªè¿­ä»£ä¸­å‚¨å­˜ i çš„å€¼</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i=<span class=\"number\">1</span>; i&lt;=<span class=\"number\">5</span>; i++) &#123; </span><br><span class=\"line\">  (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  \t<span class=\"keyword\">var</span> j = i;</span><br><span class=\"line\">  \tsetTimeout( <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">timer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  \t\t<span class=\"built_in\">console</span>.log( j ); </span><br><span class=\"line\">    &#125;,j *<span class=\"number\">1000</span> );</span><br><span class=\"line\">   &#125;)(); </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>è¡Œäº†!å®ƒèƒ½æ­£å¸¸å·¥ä½œäº†!ã€‚</p>\n<p>å¯ä»¥å¯¹è¿™æ®µä»£ç è¿›è¡Œä¸€äº›æ”¹è¿›:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i=<span class=\"number\">1</span>; i&lt;=<span class=\"number\">5</span>; i++) &#123; </span><br><span class=\"line\">  (<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">j</span>) </span>&#123;</span><br><span class=\"line\">  \tsetTimeout( <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">timer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  \t\t<span class=\"built_in\">console</span>.log( j ); </span><br><span class=\"line\">    &#125;,j *<span class=\"number\">1000</span> );</span><br><span class=\"line\">   &#125;)(i); </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å½“ç„¶ï¼Œè¿™äº› IIFE ä¹Ÿä¸è¿‡å°±æ˜¯å‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°† i ä¼ é€’è¿›å»ï¼Œå¦‚æœæ„¿æ„çš„è¯å¯ä»¥å°†å˜é‡</p>\n<p>åå®šä¸º jï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è¿˜å«ä½œ iã€‚æ— è®ºå¦‚ä½•è¿™æ®µä»£ç ç°åœ¨å¯ä»¥å·¥ä½œäº†ã€‚<br> åœ¨è¿­ä»£å†…ä½¿ç”¨ IIFE ä¼šä¸ºæ¯ä¸ªè¿­ä»£éƒ½ç”Ÿæˆä¸€ä¸ªæ–°çš„ä½œç”¨åŸŸï¼Œä½¿å¾—å»¶è¿Ÿå‡½æ•°çš„å›è°ƒå¯ä»¥å°†æ–°çš„</p>\n<p>ä½œç”¨åŸŸå°é—­åœ¨æ¯ä¸ªè¿­ä»£å†…éƒ¨ï¼Œæ¯ä¸ªè¿­ä»£ä¸­éƒ½ä¼šå«æœ‰ä¸€ä¸ªå…·æœ‰æ­£ç¡®å€¼çš„å˜é‡ä¾›æˆ‘ä»¬è®¿é—®ã€‚ é—®é¢˜è§£å†³å•¦!</p>\n<p>å½“ç„¶äº†ï¼Œè‚¯å®šæœ‰ç”¨å—çº§ä½œç”¨åŸŸ<code>let</code>çš„ï¼Œé‚£æ ·å…¶å®æ˜¯æ›´å®Œç¾çš„ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i=<span class=\"number\">1</span>; i&lt;=<span class=\"number\">5</span>; i++) &#123; </span><br><span class=\"line\">  \tsetTimeout( <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">timer</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  \t\t<span class=\"built_in\">console</span>.log( i ); </span><br><span class=\"line\">    &#125;,<span class=\"number\">1000</span> );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"é—­åŒ…ä¸æ¨¡å—\"><a href=\"#é—­åŒ…ä¸æ¨¡å—\" class=\"headerlink\" title=\"é—­åŒ…ä¸æ¨¡å—\"></a>é—­åŒ…ä¸æ¨¡å—</h3><p>å¾ˆæ—©ä¹‹å‰ï¼Œæˆ‘ä»¬å¼•ç”¨çš„jsæ–‡ä»¶å†…éƒ¨çš„å˜é‡å…¶å®éƒ½æ˜¯æŒ‚è½½åœ¨windowä¸Šé¢çš„ï¼Œä¹…è€Œä¹…ä¹‹å˜é‡åå¾ˆå¯èƒ½ä¼šé‡å¤=&gt;è¦†ç›–=&gt;BUG=&gt;éš¾ä»¥è¿½å¯»çš„BUG</p>\n<p>æ‰€ä»¥å¾ˆéœ€è¦æ¨¡å—çš„è¿™ä¸ªæ¦‚å¿µæ¥è§£å†³ã€‚</p>\n<p>æ¨¡å—çš„å‘å±•æˆ‘åˆ†ä¸ºä¸‰å—ï¼šä¸Šå¤æ—¶ä»£ï¼Œè¿‘ç°ä»£ï¼Œç°ä»£</p>\n<h4 id=\"ä¸Šå¤æ—¶ä»£çš„æ¨¡å—\"><a href=\"#ä¸Šå¤æ—¶ä»£çš„æ¨¡å—\" class=\"headerlink\" title=\"ä¸Šå¤æ—¶ä»£çš„æ¨¡å—\"></a>ä¸Šå¤æ—¶ä»£çš„æ¨¡å—</h4><p>é—­åŒ…æœ€å¼ºå¤§çš„åŠŸèƒ½=&gt;ã€Šæ¨¡å—ã€‹</p>\n<p>çœ‹ä¸ªä¾‹å­</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> q = <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> w = [<span class=\"number\">1</span>, <span class=\"number\">2</span>];</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getQ</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(q)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getW</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(w)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    getQ: getQ,</span><br><span class=\"line\">    getW: getW,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> f = a(); </span><br><span class=\"line\">f.getQ(); <span class=\"comment\">// 1</span></span><br><span class=\"line\">f.getW(); <span class=\"comment\">// [1, 2]</span></span><br></pre></td></tr></table></figure>\n\n<p>æˆ‘ä»¬ä»”ç»†çš„å‰–æä¸€ä¸‹è¿™æ®µä»£ç ï¼Œ <code>a</code>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬ç”¨aåˆ›å»ºäº†ä¸€ä¸ªæ¨¡å—å®ä¾‹ã€‚æ³¨æ„ä¸€ä¸‹ï¼šå¦‚æœä¸æ‰§è¡Œ <code>getQ</code> æˆ–è€… <code>getW</code> è¿™ä¸ªé—­åŒ…å°±æ— æ³•åˆ›å»ºï¼Œå› ä¸ºåœ¨å‡½æ•°aå†…éƒ¨çš„getQå’ŒgetWéƒ½åªæ˜¯å¯¹å˜é‡qå’Œå˜äº†wçš„å¼•ç”¨å£°æ˜ï¼›æ²¡æœ‰å®å®åœ¨åœ¨çš„è°ƒç”¨å°±æ²¡æœ‰åˆ›å»ºä½œç”¨åŸŸï¼Œä¹Ÿæ²¡æœ‰å¼€è¾Ÿå†…å­˜ç©ºé—´ã€‚</p>\n<p>å¼•ç”¨ä¸€å¥ã€Šä½ ä¸çŸ¥é“çš„JavaScript-ä¸Šã€‹ä¸­çš„ä¸€å¥è¯ï¼š</p>\n<blockquote>\n<p>å¦‚æœä¸æ‰§è¡Œ å¤–éƒ¨å‡½æ•°ï¼Œå†…éƒ¨ä½œç”¨åŸŸå’Œé—­åŒ…éƒ½æ— æ³•è¢«åˆ›å»ºã€‚</p>\n</blockquote>\n<p>å…¶æ¬¡ï¼Œa() è¿”å›ä¸€ä¸ªç”¨å¯¹è±¡å­—é¢é‡è¯­æ³• { key: value, â€¦ } æ¥è¡¨ç¤ºçš„å¯¹è±¡ã€‚è¿™ ä¸ªè¿”å›çš„å¯¹è±¡ä¸­å«æœ‰å¯¹å†…éƒ¨å‡½æ•°è€Œä¸æ˜¯å†…éƒ¨æ•°æ®å˜é‡çš„å¼•ç”¨ã€‚æˆ‘ä»¬ä¿æŒå†…éƒ¨æ•°æ®å˜é‡æ˜¯éš è—ä¸”ç§æœ‰çš„çŠ¶æ€ã€‚å¯ä»¥å°†è¿™ä¸ªå¯¹è±¡ç±»å‹çš„è¿”å›å€¼çœ‹ä½œæœ¬è´¨ä¸Šæ˜¯æ¨¡å—çš„å…¬å…± APIã€‚</p>\n<p>è¿™ä¸ªå¯¹è±¡ç±»å‹çš„è¿”å›å€¼æœ€ç»ˆè¢«èµ‹å€¼ç»™å¤–éƒ¨çš„å˜é‡ fï¼Œç„¶åå°±å¯ä»¥é€šè¿‡å®ƒæ¥è®¿é—® API ä¸­çš„ å±æ€§æ–¹æ³•ï¼Œæ¯”å¦‚ f.getW()ã€‚</p>\n<blockquote>\n<p>ä»æ¨¡å—ä¸­è¿”å›ä¸€ä¸ªå®é™…çš„å¯¹è±¡å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è¿”å›ä¸€ä¸ªå†…éƒ¨å‡½ æ•°ã€‚jQuery å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚jQuery å’Œ $ æ ‡è¯†ç¬¦å°±æ˜¯ jQuery æ¨¡å—çš„å…¬ å…± APIï¼Œä½†å®ƒä»¬æœ¬èº«éƒ½æ˜¯å‡½æ•°(ç”±äºå‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ï¼Œå®ƒä»¬æœ¬èº«ä¹Ÿå¯ä»¥æ‹¥æœ‰å± æ€§)ã€‚</p>\n</blockquote>\n<p>å…¶å®æˆ‘ä»¬è¿™æ ·æ¯æ¬¡è°ƒç”¨ä¸€æ¬¡<code>aå‡½æ•°</code>ç›¸å½“äºåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„æ¨¡å—å®ä¾‹ã€‚</p>\n<p>å‡å¦‚ï¼Œæ­¤æ—¶æˆ‘ä»¬å¸Œæœ›åªè¦ä¸€ä¸ªå®ä¾‹ï¼Œé‚£å’‹åŠå‘¢ï¼Ÿ</p>\n<p>å¤©é™çŒ›ç”·â€”-IIFEï¼ˆç«‹å³æ‰§è¡Œå‡½æ•°ï¼‰</p>\n<p>=ã€‹</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> f = (<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> q = <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> w = [<span class=\"number\">1</span>, <span class=\"number\">2</span>];</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getQ</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(q)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getW</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(w)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    getQ: getQ,</span><br><span class=\"line\">    getW: getW,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)(); </span><br><span class=\"line\"></span><br><span class=\"line\">f.getQ(); <span class=\"comment\">// 1</span></span><br><span class=\"line\">f.getW(); <span class=\"comment\">// [1, 2]</span></span><br></pre></td></tr></table></figure>\n\n<p>è¿™ä¸ªæ¨¡å—åªå±äºfä¸€ä¸ªäººï¼Œè¦ä¿®æ”¹åªèƒ½æ‰¾få¸®å¿™äº†ã€‚</p>\n<p>æ—¢ç„¶æ¨¡å—ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé‚£æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥ä¼ å‚å‘€ï¼Ÿ</p>\n<p>æ˜¯çš„ï¼Œç¨ä½œä¿®æ”¹å°±å¥½äº†ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\">id</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> q = <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> w = [<span class=\"number\">1</span>, <span class=\"number\">2</span>];</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getQ</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(q)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getW</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(w)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getId</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(id)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    getQ: getQ,</span><br><span class=\"line\">    getW: getW,</span><br><span class=\"line\">    getId: getId,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> f = a(<span class=\"number\">99</span>); </span><br><span class=\"line\">f.getQ(); <span class=\"comment\">// 1</span></span><br><span class=\"line\">f.getW(); <span class=\"comment\">// [1, 2]</span></span><br><span class=\"line\">f.getId(); <span class=\"comment\">// 99</span></span><br></pre></td></tr></table></figure>\n\n<p>é‚£æˆ‘æƒ³ä¿®æ”¹æ¨¡å—å†…éƒ¨çš„ä¸œè¥¿å’‹åŠæï¼Ÿ</p>\n<p>å®‰æ’ï¼</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\">id</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> q = <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> w = [<span class=\"number\">1</span>, <span class=\"number\">2</span>];</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getQ</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(q)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getW</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(w)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getId</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(id)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">change</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    q = q + <span class=\"number\">1</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    getQ: getQ,</span><br><span class=\"line\">    getW: getW,</span><br><span class=\"line\">    getId: getId,</span><br><span class=\"line\">    change: change,</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> f = a(<span class=\"number\">99</span>); </span><br><span class=\"line\">f.getQ(); <span class=\"comment\">// 1</span></span><br><span class=\"line\">f.getW(); <span class=\"comment\">// [1, 2]</span></span><br><span class=\"line\">f.getId(); <span class=\"comment\">// 99</span></span><br><span class=\"line\">f.change(); <span class=\"comment\">// 99</span></span><br><span class=\"line\">f.getQ(); <span class=\"comment\">// 2</span></span><br></pre></td></tr></table></figure>\n\n<p>é€šè¿‡åœ¨æ¨¡å—å®ä¾‹çš„å†…éƒ¨ä¿ç•™å¯¹å…¬å…± API å¯¹è±¡çš„å†…éƒ¨å¼•ç”¨ï¼Œå¯ä»¥ä»å†…éƒ¨å¯¹æ¨¡å—å®ä¾‹è¿›è¡Œä¿® æ”¹ï¼ŒåŒ…æ‹¬æ·»åŠ æˆ–åˆ é™¤æ–¹æ³•å’Œå±æ€§ï¼Œä»¥åŠä¿®æ”¹å®ƒä»¬çš„å€¼ã€‚</p>\n<h4 id=\"è¿‘ç°ä»£çš„æ¨¡å—\"><a href=\"#è¿‘ç°ä»£çš„æ¨¡å—\" class=\"headerlink\" title=\"è¿‘ç°ä»£çš„æ¨¡å—\"></a>è¿‘ç°ä»£çš„æ¨¡å—</h4><h5 id=\"AMDï¼ˆå¾ˆå°‘ç”¨åˆ°äº†ï¼‰\"><a href=\"#AMDï¼ˆå¾ˆå°‘ç”¨åˆ°äº†ï¼‰\" class=\"headerlink\" title=\"AMDï¼ˆå¾ˆå°‘ç”¨åˆ°äº†ï¼‰\"></a>AMDï¼ˆå¾ˆå°‘ç”¨åˆ°äº†ï¼‰</h5><p>AMD å³Asynchronous Module Definitionï¼Œä¸­æ–‡åæ˜¯å¼‚æ­¥æ¨¡å—å®šä¹‰çš„æ„æ€ã€‚å®ƒæ˜¯ä¸€ä¸ªåœ¨æµè§ˆå™¨ç«¯æ¨¡å—åŒ–å¼€å‘çš„è§„èŒƒ</p>\n<p>ç”±äºä¸æ˜¯JavaScriptåŸç”Ÿæ”¯æŒï¼Œä½¿ç”¨AMDè§„èŒƒè¿›è¡Œé¡µé¢å¼€å‘éœ€è¦ç”¨åˆ°å¯¹åº”çš„åº“å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯å¤§åé¼é¼RequireJSï¼Œå®é™…ä¸ŠAMD æ˜¯ RequireJS åœ¨æ¨å¹¿è¿‡ç¨‹ä¸­å¯¹æ¨¡å—å®šä¹‰çš„è§„èŒƒåŒ–çš„äº§å‡º</p>\n<p>requireJSä¸»è¦è§£å†³ä¸¤ä¸ªé—®é¢˜</p>\n<p>1ã€å¤šä¸ªjsæ–‡ä»¶å¯èƒ½æœ‰ä¾èµ–å…³ç³»ï¼Œè¢«ä¾èµ–çš„æ–‡ä»¶éœ€è¦æ—©äºä¾èµ–å®ƒçš„æ–‡ä»¶åŠ è½½åˆ°æµè§ˆå™¨<br>2ã€jsåŠ è½½çš„æ—¶å€™æµè§ˆå™¨ä¼šåœæ­¢é¡µé¢æ¸²æŸ“ï¼ŒåŠ è½½æ–‡ä»¶è¶Šå¤šï¼Œé¡µé¢å¤±å»å“åº”æ—¶é—´è¶Šé•¿<br>çœ‹ä¸€ä¸ªä½¿ç”¨requireJSçš„ä¾‹å­</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* </span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">*  a.js </span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">*  åˆ›å»ºä¸€ä¸ªåä¸ºâ€œaâ€çš„æ¨¡å—</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">define(<span class=\"string\">'a'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">require, exports, module</span>) </span>&#123;   </span><br><span class=\"line\"></span><br><span class=\"line\">  exports.getTime = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;   </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();   </span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;  </span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* </span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">*  b.js </span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">*  åˆ›å»ºä¸€ä¸ªåä¸ºâ€œbâ€çš„æ¨¡å—ï¼ŒåŒæ—¶ä½¿ç”¨ä¾èµ–requireã€exportså’Œåä¸ºâ€œaâ€çš„æ¨¡å—ï¼š</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"></span><br><span class=\"line\">define(<span class=\"string\">'b'</span>, [<span class=\"string\">'require'</span>, <span class=\"string\">'exports'</span>, <span class=\"string\">'a'</span>], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">require, exports, a</span>) </span>&#123;   exports.test = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;   </span><br><span class=\"line\"></span><br><span class=\"line\">      now: a.getTime()    </span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;;   </span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;  </span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* main.js */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">require</span>([<span class=\"string\">'b'</span>], <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">b</span>) </span>&#123;   </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(b.test());  </span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p><strong>è¯­æ³•</strong></p>\n<p>requireJSå®šä¹‰äº†ä¸€ä¸ªå‡½æ•° defineï¼Œå®ƒæ˜¯å…¨å±€å˜é‡ï¼Œç”¨æ¥å®šä¹‰æ¨¡å—</p>\n<p>define(id?, dependencies?, factory);</p>\n<ol>\n<li>idï¼šå¯é€‰å‚æ•°ï¼Œç”¨æ¥å®šä¹‰æ¨¡å—çš„æ ‡è¯†ï¼Œå¦‚æœæ²¡æœ‰æä¾›è¯¥å‚æ•°ï¼Œè„šæœ¬æ–‡ä»¶åï¼ˆå»æ‰æ‹“å±•åï¼‰</li>\n<li>dependenciesï¼šæ˜¯ä¸€ä¸ªå½“å‰æ¨¡å—ä¾èµ–çš„æ¨¡å—åç§°æ•°ç»„</li>\n<li>factoryï¼šå·¥å‚æ–¹æ³•ï¼Œæ¨¡å—åˆå§‹åŒ–è¦æ‰§è¡Œçš„å‡½æ•°æˆ–å¯¹è±¡ã€‚å¦‚æœä¸ºå‡½æ•°ï¼Œå®ƒåº”è¯¥åªè¢«æ‰§è¡Œä¸€æ¬¡ã€‚å¦‚æœæ˜¯å¯¹è±¡ï¼Œæ­¤å¯¹è±¡åº”è¯¥ä¸ºæ¨¡å—çš„è¾“å‡ºå€¼<br>åœ¨é¡µé¢ä¸Šä½¿ç”¨requireå‡½æ•°åŠ è½½æ¨¡å—</li>\n</ol>\n<p>require([dependencies], function(){});<br>require()å‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°</p>\n<ol>\n<li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¡¨ç¤ºæ‰€ä¾èµ–çš„æ¨¡å—</li>\n<li>ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå½“å‰é¢æŒ‡å®šçš„æ¨¡å—éƒ½åŠ è½½æˆåŠŸåï¼Œå®ƒå°†è¢«è°ƒç”¨ã€‚åŠ è½½çš„æ¨¡å—ä¼šä»¥å‚æ•°å½¢å¼ä¼ å…¥è¯¥å‡½æ•°ï¼Œä»è€Œåœ¨å›è°ƒå‡½æ•°å†…éƒ¨å°±å¯ä»¥ä½¿ç”¨è¿™äº›æ¨¡å—</li>\n</ol>\n<p>require()å‡½æ•°åœ¨åŠ è½½ä¾èµ–çš„å‡½æ•°çš„æ—¶å€™æ˜¯å¼‚æ­¥åŠ è½½çš„ï¼Œè¿™æ ·æµè§ˆå™¨ä¸ä¼šå¤±å»å“åº”ï¼Œå®ƒæŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼Œåªæœ‰å‰é¢çš„æ¨¡å—éƒ½åŠ è½½æˆåŠŸåï¼Œæ‰ä¼šè¿è¡Œï¼Œè§£å†³äº†ä¾èµ–æ€§çš„é—®é¢˜ã€‚</p>\n<h5 id=\"CMDï¼ˆå¾ˆå°‘ç”¨åˆ°äº†ï¼‰\"><a href=\"#CMDï¼ˆå¾ˆå°‘ç”¨åˆ°äº†ï¼‰\" class=\"headerlink\" title=\"CMDï¼ˆå¾ˆå°‘ç”¨åˆ°äº†ï¼‰\"></a>CMDï¼ˆå¾ˆå°‘ç”¨åˆ°äº†ï¼‰</h5><p>CMD å³Common Module Definitioné€šç”¨æ¨¡å—å®šä¹‰ï¼ŒCMDè§„èŒƒæ˜¯å›½å†…å‘å±•å‡ºæ¥çš„ï¼Œå°±åƒAMDæœ‰ä¸ªrequireJSï¼ŒCMDæœ‰ä¸ªæµè§ˆå™¨çš„å®ç°SeaJSï¼ŒSeaJSè¦è§£å†³çš„é—®é¢˜å’ŒrequireJSä¸€æ ·ï¼Œåªä¸è¿‡åœ¨æ¨¡å—å®šä¹‰æ–¹å¼å’Œæ¨¡å—åŠ è½½ï¼ˆå¯ä»¥è¯´è¿è¡Œã€è§£æï¼‰æ—¶æœºä¸Šæœ‰æ‰€ä¸åŒ<br><strong>è¯­æ³•</strong><br>Sea.js æ¨å´‡ä¸€ä¸ªæ¨¡å—ä¸€ä¸ªæ–‡ä»¶ï¼Œéµå¾ªç»Ÿä¸€çš„å†™æ³•<br>define(id?, deps?, factory)<br>å› ä¸ºCMDæ¨å´‡</p>\n<ol>\n<li>ä¸€ä¸ªæ–‡ä»¶ä¸€ä¸ªæ¨¡å—ï¼Œæ‰€ä»¥ç»å¸¸å°±ç”¨æ–‡ä»¶åä½œä¸ºæ¨¡å—id</li>\n<li>CMDæ¨å´‡ä¾èµ–å°±è¿‘ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸åœ¨defineçš„å‚æ•°ä¸­å†™ä¾èµ–ï¼Œåœ¨factoryä¸­å†™</li>\n</ol>\n<p>factoryæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæœ‰ä¸‰ä¸ªå‚æ•°ï¼Œfunction(require, exports, module)</p>\n<ol>\n<li>require æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œæ¥å— æ¨¡å—æ ‡è¯† ä½œä¸ºå”¯ä¸€å‚æ•°ï¼Œç”¨æ¥è·å–å…¶ä»–æ¨¡å—æä¾›çš„æ¥å£ï¼šrequire(id)</li>\n<li>exports æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨æ¥å‘å¤–æä¾›æ¨¡å—æ¥å£</li>\n<li>module æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¸Šé¢å­˜å‚¨äº†ä¸å½“å‰æ¨¡å—ç›¸å…³è”çš„ä¸€äº›å±æ€§å’Œæ–¹æ³•</li>\n</ol>\n<p>çœ‹ä¸ªä¾‹å­ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* </span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">*  a.js </span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">*  ä¸€ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">require, exports, module</span>) </span>&#123;   </span><br><span class=\"line\"></span><br><span class=\"line\">  exports.getTime = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;   </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();   </span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;  </span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* main.js */</span></span><br><span class=\"line\"></span><br><span class=\"line\">define(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">require, exports, module</span>) </span>&#123;  </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/* æŒ‰éœ€åŠ è½½a.js */</span> </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> a = <span class=\"built_in\">require</span>(<span class=\"string\">'./a'</span>);    </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(a.getTime());  </span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"AMDå’ŒCMDçš„åŒºåˆ«\"><a href=\"#AMDå’ŒCMDçš„åŒºåˆ«\" class=\"headerlink\" title=\"AMDå’ŒCMDçš„åŒºåˆ«\"></a>AMDå’ŒCMDçš„åŒºåˆ«</h5><p>æœ€æ˜æ˜¾çš„åŒºåˆ«å°±æ˜¯åœ¨æ¨¡å—å®šä¹‰æ—¶å¯¹ä¾èµ–çš„å¤„ç†ä¸åŒ</p>\n<p><strong>1ã€AMDæ¨å´‡ä¾èµ–å‰ç½®ï¼Œåœ¨å®šä¹‰æ¨¡å—çš„æ—¶å€™å°±è¦å£°æ˜å…¶ä¾èµ–çš„æ¨¡å—</strong><br><strong>2ã€CMDæ¨å´‡å°±è¿‘ä¾èµ–ï¼Œåªæœ‰åœ¨ç”¨åˆ°æŸä¸ªæ¨¡å—çš„æ—¶å€™å†å»require</strong><br>è¿™ç§åŒºåˆ«å„æœ‰ä¼˜åŠ£ï¼Œåªæ˜¯è¯­æ³•ä¸Šçš„å·®è·ï¼Œè€Œä¸”requireJSå’ŒSeaJSéƒ½æ”¯æŒå¯¹æ–¹çš„å†™æ³•</p>\n<p>AMDå’ŒCMDæœ€å¤§çš„åŒºåˆ«æ˜¯å¯¹ä¾èµ–æ¨¡å—çš„æ‰§è¡Œæ—¶æœºå¤„ç†ä¸åŒï¼Œæ³¨æ„ä¸æ˜¯åŠ è½½çš„æ—¶æœºæˆ–è€…æ–¹å¼ä¸åŒ</p>\n<p>å¾ˆå¤šäººè¯´requireJSæ˜¯å¼‚æ­¥åŠ è½½æ¨¡å—ï¼ŒSeaJSæ˜¯åŒæ­¥åŠ è½½æ¨¡å—ï¼Œè¿™ä¹ˆç†è§£å®é™…ä¸Šæ˜¯ä¸å‡†ç¡®çš„ï¼Œå…¶å®åŠ è½½æ¨¡å—éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œåªä¸è¿‡AMDä¾èµ–å‰ç½®ï¼Œjså¯ä»¥æ–¹ä¾¿çŸ¥é“ä¾èµ–æ¨¡å—æ˜¯è°ï¼Œç«‹å³åŠ è½½ï¼Œè€ŒCMDå°±è¿‘ä¾èµ–ï¼Œéœ€è¦ä½¿ç”¨æŠŠæ¨¡å—å˜ä¸ºå­—ç¬¦ä¸²è§£æä¸€éæ‰çŸ¥é“ä¾èµ–äº†é‚£äº›æ¨¡å—ï¼Œè¿™ä¹Ÿæ˜¯å¾ˆå¤šäººè¯Ÿç—…CMDçš„ä¸€ç‚¹ï¼Œç‰ºç‰²æ€§èƒ½æ¥å¸¦æ¥å¼€å‘çš„ä¾¿åˆ©æ€§ï¼Œå®é™…ä¸Šè§£ææ¨¡å—ç”¨çš„æ—¶é—´çŸ­åˆ°å¯ä»¥å¿½ç•¥</p>\n<p>ä¸ºä»€ä¹ˆæˆ‘ä»¬è¯´ä¸¤ä¸ªçš„åŒºåˆ«æ˜¯ä¾èµ–æ¨¡å—æ‰§è¡Œæ—¶æœºä¸åŒï¼Œä¸ºä»€ä¹ˆå¾ˆå¤šäººè®¤ä¸ºADMæ˜¯å¼‚æ­¥çš„ï¼ŒCMDæ˜¯åŒæ­¥çš„ï¼ˆé™¤äº†åå­—çš„åŸå› ã€‚ã€‚ã€‚ï¼‰</p>\n<p>åŒæ ·éƒ½æ˜¯å¼‚æ­¥åŠ è½½æ¨¡å—ï¼ŒAMDåœ¨åŠ è½½æ¨¡å—å®Œæˆåå°±ä¼šæ‰§è¡Œæ”¹æ¨¡å—ï¼Œæ‰€æœ‰æ¨¡å—éƒ½åŠ è½½æ‰§è¡Œå®Œåä¼šè¿›å…¥requireçš„å›è°ƒå‡½æ•°ï¼Œæ‰§è¡Œä¸»é€»è¾‘ï¼Œè¿™æ ·çš„æ•ˆæœå°±æ˜¯ä¾èµ–æ¨¡å—çš„æ‰§è¡Œé¡ºåºå’Œä¹¦å†™é¡ºåºä¸ä¸€å®šä¸€è‡´ï¼Œçœ‹ç½‘ç»œé€Ÿåº¦ï¼Œå“ªä¸ªå…ˆä¸‹è½½ä¸‹æ¥ï¼Œå“ªä¸ªå…ˆæ‰§è¡Œï¼Œä½†æ˜¯ä¸»é€»è¾‘ä¸€å®šåœ¨æ‰€æœ‰ä¾èµ–åŠ è½½å®Œæˆåæ‰æ‰§è¡Œ</p>\n<p>CMDåŠ è½½å®ŒæŸä¸ªä¾èµ–æ¨¡å—åå¹¶ä¸æ‰§è¡Œï¼Œåªæ˜¯ä¸‹è½½è€Œå·²ï¼Œåœ¨æ‰€æœ‰ä¾èµ–æ¨¡å—åŠ è½½å®Œæˆåè¿›å…¥ä¸»é€»è¾‘ï¼Œé‡åˆ°requireè¯­å¥çš„æ—¶å€™æ‰æ‰§è¡Œå¯¹åº”çš„æ¨¡å—ï¼Œè¿™æ ·æ¨¡å—çš„æ‰§è¡Œé¡ºåºå’Œä¹¦å†™é¡ºåºæ˜¯å®Œå…¨ä¸€è‡´çš„</p>\n<p>è¿™ä¹Ÿæ˜¯å¾ˆå¤šäººè¯´AMDç”¨æˆ·ä½“éªŒå¥½ï¼Œå› ä¸ºæ²¡æœ‰å»¶è¿Ÿï¼Œä¾èµ–æ¨¡å—æå‰æ‰§è¡Œäº†ï¼ŒCMDæ€§èƒ½å¥½ï¼Œå› ä¸ºåªæœ‰ç”¨æˆ·éœ€è¦çš„æ—¶å€™æ‰æ‰§è¡Œçš„åŸå› </p>\n<h4 id=\"ç°ä»£çš„æ¨¡å—\"><a href=\"#ç°ä»£çš„æ¨¡å—\" class=\"headerlink\" title=\"ç°ä»£çš„æ¨¡å—\"></a>ç°ä»£çš„æ¨¡å—</h4><h5 id=\"CommonJS\"><a href=\"#CommonJS\" class=\"headerlink\" title=\"CommonJS\"></a>CommonJS</h5><p>CommonJS æœ€æ—©æ˜¯ Node åœ¨ä½¿ç”¨ï¼Œç›®å‰ä¹Ÿä»ç„¶å¹¿æ³›ä½¿ç”¨ï¼Œæ¯”å¦‚åœ¨ Webpack ä¸­ä½ å°±èƒ½è§åˆ°å®ƒï¼Œå½“ç„¶ç›®å‰åœ¨ Node ä¸­çš„æ¨¡å—ç®¡ç†å·²ç»å’Œ CommonJS æœ‰ä¸€äº›åŒºåˆ«äº†ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// a.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    a: <span class=\"number\">1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// or </span></span><br><span class=\"line\">exports.a = <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// b.js</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"built_in\">module</span> = <span class=\"built_in\">require</span>(<span class=\"string\">'./a.js'</span>)</span><br><span class=\"line\"><span class=\"built_in\">module</span>.a <span class=\"comment\">// -&gt; log 1</span></span><br></pre></td></tr></table></figure>\n\n<p>å› ä¸º CommonJS è¿˜æ˜¯ä¼šä½¿ç”¨åˆ°çš„ï¼Œæ‰€ä»¥è¿™é‡Œä¼šå¯¹ä¸€äº›ç–‘éš¾ç‚¹è¿›è¡Œè§£æ</p>\n<p>å…ˆè¯´ <code>require</code> å§</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"built_in\">module</span> = <span class=\"built_in\">require</span>(<span class=\"string\">'./a.js'</span>)</span><br><span class=\"line\"><span class=\"built_in\">module</span>.a </span><br><span class=\"line\"><span class=\"comment\">// è¿™é‡Œå…¶å®å°±æ˜¯åŒ…è£…äº†ä¸€å±‚ç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œè¿™æ ·å°±ä¸ä¼šæ±¡æŸ“å…¨å±€å˜é‡äº†ï¼Œ</span></span><br><span class=\"line\"><span class=\"comment\">// é‡è¦çš„æ˜¯ module è¿™é‡Œï¼Œmodule æ˜¯ Node ç‹¬æœ‰çš„ä¸€ä¸ªå˜é‡</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    a: <span class=\"number\">1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// module åŸºæœ¬å®ç°</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> <span class=\"built_in\">module</span> = &#123;</span><br><span class=\"line\">  id: <span class=\"string\">'xxxx'</span>, <span class=\"comment\">// æˆ‘æ€»å¾—çŸ¥é“æ€ä¹ˆå»æ‰¾åˆ°ä»–å§</span></span><br><span class=\"line\">  exports: &#123;&#125; <span class=\"comment\">// exports å°±æ˜¯ä¸ªç©ºå¯¹è±¡</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// è¿™ä¸ªæ˜¯ä¸ºä»€ä¹ˆ exports å’Œ module.exports ç”¨æ³•ç›¸ä¼¼çš„åŸå› </span></span><br><span class=\"line\"><span class=\"keyword\">var</span> exports = <span class=\"built_in\">module</span>.exports </span><br><span class=\"line\"><span class=\"keyword\">var</span> load = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">module</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// å¯¼å‡ºçš„ä¸œè¥¿</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> a = <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"built_in\">module</span>.exports = a</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">module</span>.exports</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"comment\">// ç„¶åå½“æˆ‘ require çš„æ—¶å€™å»æ‰¾åˆ°ç‹¬ç‰¹çš„</span></span><br><span class=\"line\"><span class=\"comment\">// idï¼Œç„¶åå°†è¦ä½¿ç”¨çš„ä¸œè¥¿ç”¨ç«‹å³æ‰§è¡Œå‡½æ•°åŒ…è£…ä¸‹ï¼Œover</span></span><br></pre></td></tr></table></figure>\n\n<p>å¦å¤–è™½ç„¶ <code>exports</code> å’Œ <code>module.exports</code> ç”¨æ³•ç›¸ä¼¼ï¼Œä½†æ˜¯ä¸èƒ½å¯¹ <code>exports</code> ç›´æ¥èµ‹å€¼ã€‚å› ä¸º <code>var exports = module.exports</code> è¿™å¥ä»£ç è¡¨æ˜äº† <code>exports</code> å’Œ <code>module.exports</code> äº«æœ‰ç›¸åŒåœ°å€ï¼Œé€šè¿‡æ”¹å˜å¯¹è±¡çš„å±æ€§å€¼ä¼šå¯¹ä¸¤è€…éƒ½èµ·æ•ˆï¼Œä½†æ˜¯å¦‚æœç›´æ¥å¯¹ <code>exports</code> èµ‹å€¼å°±ä¼šå¯¼è‡´ä¸¤è€…ä¸å†æŒ‡å‘åŒä¸€ä¸ªå†…å­˜åœ°å€ï¼Œä¿®æ”¹å¹¶ä¸ä¼šå¯¹ <code>module.exports</code> èµ·æ•ˆã€‚</p>\n<h5 id=\"ES-Module\"><a href=\"#ES-Module\" class=\"headerlink\" title=\"ES Module\"></a>ES Module</h5><p>ES Module æ˜¯åŸç”Ÿå®ç°çš„æ¨¡å—åŒ–æ–¹æ¡ˆï¼Œä¸ CommonJS æœ‰ä»¥ä¸‹å‡ ä¸ªåŒºåˆ«</p>\n<ul>\n<li>CommonJS æ”¯æŒåŠ¨æ€å¯¼å…¥ï¼Œä¹Ÿå°±æ˜¯ <code>require(${path}/xx.js)</code>ï¼Œåè€…ç›®å‰ä¸æ”¯æŒï¼Œä½†æ˜¯å·²æœ‰ææ¡ˆ</li>\n<li>CommonJS æ˜¯åŒæ­¥å¯¼å…¥ï¼Œå› ä¸ºç”¨äºæœåŠ¡ç«¯ï¼Œæ–‡ä»¶éƒ½åœ¨æœ¬åœ°ï¼ŒåŒæ­¥å¯¼å…¥å³ä½¿å¡ä½ä¸»çº¿ç¨‹å½±å“ä¹Ÿä¸å¤§ã€‚è€Œåè€…æ˜¯å¼‚æ­¥å¯¼å…¥ï¼Œå› ä¸ºç”¨äºæµè§ˆå™¨ï¼Œéœ€è¦ä¸‹è½½æ–‡ä»¶ï¼Œå¦‚æœä¹Ÿé‡‡ç”¨åŒæ­¥å¯¼å…¥ä¼šå¯¹æ¸²æŸ“æœ‰å¾ˆå¤§å½±å“</li>\n<li>CommonJS åœ¨å¯¼å‡ºæ—¶éƒ½æ˜¯å€¼æ‹·è´ï¼Œå°±ç®—å¯¼å‡ºçš„å€¼å˜äº†ï¼Œå¯¼å…¥çš„å€¼ä¹Ÿä¸ä¼šæ”¹å˜ï¼Œæ‰€ä»¥å¦‚æœæƒ³æ›´æ–°å€¼ï¼Œå¿…é¡»é‡æ–°å¯¼å…¥ä¸€æ¬¡ã€‚ä½†æ˜¯ ES Module é‡‡ç”¨å®æ—¶ç»‘å®šçš„æ–¹å¼ï¼Œå¯¼å…¥å¯¼å‡ºçš„å€¼éƒ½æŒ‡å‘åŒä¸€ä¸ªå†…å­˜åœ°å€ï¼Œæ‰€ä»¥å¯¼å…¥å€¼ä¼šè·Ÿéšå¯¼å‡ºå€¼å˜åŒ–</li>\n<li>ES Module ä¼šç¼–è¯‘æˆ <code>require/exports</code> æ¥æ‰§è¡Œçš„</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// å¼•å…¥æ¨¡å— API</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> XXX <span class=\"keyword\">from</span> <span class=\"string\">'./a.js'</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; XXX &#125; <span class=\"keyword\">from</span> <span class=\"string\">'./a.js'</span></span><br><span class=\"line\"><span class=\"comment\">// å¯¼å‡ºæ¨¡å— API</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span>(<span class=\"params\"></span>) </span>&#123;&#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h2><p>å½“å‡½æ•°å¯ä»¥è®°ä½å¹¶è®¿é—®æ‰€åœ¨çš„è¯æ³•ä½œç”¨åŸŸï¼Œå³ä½¿å‡½æ•°æ˜¯åœ¨å½“å‰è¯æ³•ä½œç”¨åŸŸä¹‹å¤–æ‰§è¡Œï¼Œè¿™æ—¶ å°±äº§ç”Ÿäº†é—­åŒ…ã€‚</p>\n<blockquote>\n<p>ç´¢å¼•ï¼š<a href=\"https://juejin.im/post/5a422b036fb9a045211ef789\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/5a422b036fb9a045211ef789</a></p>\n</blockquote>\n"},{"title":"ã€é‡è¯†å‰ç«¯ã€‘åœ°å€æ ä¸­è¾“å…¥ç½‘å€åå‘ç”Ÿäº†ä»€ä¹ˆ","date":"2020-10-09T02:08:31.000Z","cover":"/image/cover/web.jpeg","_content":"\n# å‰è¨€\n\nä¸è¯´å¤ªå¤šåºŸè¯äº†ï¼Œè¿™ä¸ªé¢˜ç›®å…¶å®åŸºæœ¬ä¸Šæ˜¯ç°åœ¨é¢è¯•çš„é«˜é¢‘è€ƒç‚¹äº†ï¼Œç°åœ¨æˆ‘ä¹Ÿæƒ³è‡ªå·±è®¤è®¤çœŸçœŸçš„æ‹ä¸€éï¼Œåˆ°æ—¶å€™é¢è¯•ä¹Ÿå¯ä»¥æµåˆ©çš„å›ç­”ã€‚\n\n# å¼€å§‹\n\nlet's go\n\n## URLè§£æ\n\nå…¶å®æœ‰äººä¸€å¼€å§‹ä¼šæœ‰ç–‘æƒ‘ï¼Œè‡³å°‘æˆ‘ä¸€å¼€å§‹ä¹Ÿæœ‰ç–‘æƒ‘ï¼Œä¸æ˜¯åº”è¯¥å…ˆDNSè§£æå—ï¼Ÿ\n\nå…¶å®ä¸æ˜¯çš„ï¼Œç°åœ¨çš„æµè§ˆå™¨ä»–ä¼šä¼˜å…ˆè§£æä½ æ˜¯ä¸æ˜¯ä¸€ä¸ªåˆæ³•çš„URLï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿæ¯”å¦‚æˆ‘ä»¬åœ¨Chromeè¾“å…¥ä¸­æ–‡â€œDerrickæ˜¯å¸…å“¥å—â€ï¼Œè¿™æ ·çš„ä¸æ˜¯ä¸€ä¸ªæ­£å¸¸çš„åˆæ³•çš„URLï¼Œå°±ä¼šä¼˜å…ˆè°ƒç”¨ä½ é»˜è®¤çš„æœç´¢å¼•æ“å¼€å§‹æœç´¢ã€‚\n\nå½“ç„¶äº†ï¼Œåˆæ³•çš„URLåŒ…æ‹¬äº†åè®®å’Œç½‘ç»œåœ°å€ï¼Œæœ€å¸¸ç”¨çš„åè®®æ˜¯\n\n- HTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰\n- FTPï¼ˆæ–‡ä»¶ä¼ è¾“åè®®ï¼‰\n\nç½‘ç»œåœ°å€ä¹Ÿå¯ä»¥æ˜¯ipåœ°å€ï¼Œä»¥åŠç«¯å£å·ï¼Œæ²¡æœ‰ç«¯å£é»˜è®¤æ˜¯80ç«¯å£\n\n## DNSåŸŸåè§£æ\n\nè¿™ä¸€æ­¥å…¶å®ç®€å•æ¥è¯´å°±æ˜¯\"baidu.com\"è¿™ä¸ªåŸŸåï¼Œè§£ææˆä¸€ä¸ªæ•´ä¸ªçš„åœ°å€ã€‚\n\næ¯”å¦‚æˆ‘ä»¬çš„å®¶åº­ä½å€éƒ½æœ‰ä¸€ä¸ªé—¨ç‰Œå·ï¼Œxxå°åŒºxxæ ‹xxå·\n\nè¿™æ ·çš„ä¸€ä¸²æ ‡è¯†ç¬¦å°±å¯ä»¥ç²¾å‡†çš„æ‰¾åˆ°æˆ‘ä»¬çš„å®¶åº­ä½å€ï¼Œè€Œæ¯ä¸€ä¸ªipåœ°å€å°±æ˜¯è¿™æ ·çš„ä¸€ä¸ªé—¨ç‰Œå·ï¼Œæ¯”å¦‚`baidu.com`è¿™ä¸ªä¸æ˜¯ä¸€ä¸ªé—¨ç‰Œå·ï¼Œè¿™ä¸ªå¯ä»¥ç†è§£ä¸ºç™¾åº¦çš„å®¶ï¼Œä½ å‘Šè¯‰æµè§ˆå™¨ä½ è¦å»ç™¾åº¦çš„å®¶ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå¼€å§‹è¿›è¡ŒDNSè§£æä»–ä¼šè§£ææˆç™¾åº¦çš„é—¨ç‰Œå·ï¼Œç„¶åæ‰¾åˆ°ç™¾åº¦çš„å®¶ã€‚\n\n### ç¼“å­˜\n\nè¿™é‡Œé¢åˆä¼šæ¶‰åŠåˆ°ç¼“å­˜çš„æ¦‚å¿µï¼Œä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ\n\nå°±æ˜¯ä¹‹å‰æˆ‘æŸ¥è¿‡ç™¾åº¦çš„å®¶äº†ï¼Œå·²ç»è®°å½•ä¸‹æ¥ç™¾åº¦çš„å®¶çš„é—¨ç‰Œå·äº†ï¼Œå°±ä¸éœ€è¦é‡æ–°çš„è¿›è¡Œè§£æäº†ï¼Œç›´æ¥è¯»å–å°±å¥½äº†ï¼ŒèŠ‚çº¦æ—¶é—´ã€‚\n\n\n\nè¿™é‡Œé¢æ¶‰åŠçš„çŸ¥è¯†å¤ªå¤šäº†ï¼Œä¸åœ¨è¿™æ¬¡çš„è®¨è®ºèŒƒå›´å†…ã€‚æ‰€ä»¥åªç®€å•çš„è¯´ä¸€ä¸‹ã€‚\n\n![demo1](/image/åœ°å€æ /dns.png)\n\n\n\nä¸Šå›¾å…¶å®å¾ˆå¥½çš„è§£ç­”äº†DNSçš„æ•´ä¸ªè§£æè¿‡ç¨‹ã€‚\n\n1. ä»æµè§ˆå™¨è·å–ç¼“å­˜ç»“æœã€‚\n2. å¦‚æœæµè§ˆå™¨æ²¡æœ‰ç¼“å­˜å°±ä»æœ¬åœ°ç³»ç»Ÿçš„ç¼“å­˜ä¸­è¯»å–ï¼Œæ¯”å¦‚hostæ–‡ä»¶ç­‰ç­‰ï¼Œåƒæˆ‘ä»¬å¹³å¸¸ä¸ŠGitHubå¦‚æœæ…¢çš„è¯æˆ‘ä»¬éƒ½ä¼šä¿®æ”¹hostæ–‡ä»¶ï¼Œç»™ä»–é…ä¸€ä¸ªå¿«ä¸€ç‚¹çš„ipä¹‹ç±»çš„ç­‰ç­‰ã€‚\n3. ç„¶åæ˜¯å›¾é‡Œé¢æ²¡æœ‰æåˆ°çš„è·¯ç”±å™¨ç¼“å­˜ï¼Œä¸€èˆ¬çš„è·¯ç”±å™¨ä¹Ÿä¼šæœ‰è‡ªå·±çš„ç¼“å­˜ã€‚\n4. è·¯ç”±å™¨ä¹Ÿæ‰¾ä¸åˆ°åªèƒ½å¼€å§‹è§£æäº†ã€‚æœ¬åœ°åŸŸåæœåŠ¡å™¨ä¼šå‘æ ¹åŸŸåæœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œ å¦‚æœæ ¹åŸŸåæœåŠ¡å™¨ä¹Ÿä¸å­˜åœ¨è¯¥åŸŸåæ—¶ï¼Œ æœ¬åœ°åŸŸåä¼šå‘comé¡¶çº§åŸŸåæœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œ ä¾æ¬¡ç±»æ¨ä¸‹å»ã€‚ ç›´åˆ°æœ€åæ‰¾åˆ°ç›®æ ‡ç½‘å€æ‰€å¯¹åº”çš„ IPï¼Œ å¹¶å°†å…¶ç¼“å­˜åˆ°æœ¬åœ°ï¼Œ ä»¥ä¾›ä¸‹æ¬¡ä½¿ç”¨ã€‚\n\n\n\n### DNSé‡å®šå‘\n\nè¿™é‡Œé¡ºä¾¿è¯´ä¸€ä¸‹DNSçš„é‡å®šå‘å§\n\n> DNSæ¯æ¬¡è¿”å›çš„ipåœ°å€å¯èƒ½ä¼šä¸ä¸€æ ·ï¼Œå› ä¸ºä¸–ç•Œä¸Šä¸æ˜¯åªæœ‰ä¸€ä¸ªæœºå™¨å¯ä»¥å¤„ç†\"baidu.com\"çš„è¿™ä¸ªè¯·æ±‚ï¼Œæœ‰å¾ˆå¤šæœºå™¨å¯ä»¥å¤„ç†ï¼ŒDNSåªéœ€è¦è¿”å›å¯ä»¥å¤„ç†çš„æœºå™¨çš„ipåœ°å€å°±å¯ä»¥äº†ã€‚ä¾‹å¦‚å¯ä»¥æ ¹æ®æ¯å°æœºå™¨çš„è´Ÿè½½é‡ï¼Œ è¯¥æœºå™¨ç¦»ç”¨æˆ·åœ°ç†ä½ç½®çš„è·ç¦»ç­‰ç­‰ï¼Œ è¿™ç§è¿‡ç¨‹å°±æ˜¯DNSè´Ÿè½½å‡è¡¡ï¼Œ åˆå«åšDNSé‡å®šå‘ã€‚\n\nå¾ˆç®€å•ï¼Œå‡ ä¸ªä¾‹å­ï¼Œæ¯”å¦‚æˆ‘åœ¨æ•…å®«çš„åŒ—é—¨ï¼Œæ‰“å¼€åœ°å›¾è¦æŸ¥è¯¢æ•…å®«è‚¯å®šä¼šè®©æˆ‘ä»åŒ—é—¨è¿›å»ã€‚è€Œå¦‚æœæˆ‘åœ¨æ•…å®«çš„å—é—¨ï¼Œè¦å¯¼èˆªåˆ°æ•…å®«å°±ä¼šè®©æˆ‘ä»å—é—¨è¿›å»ã€‚\n\n### DNSæ±¡æŸ“\n\nDNS æ±¡æŸ“ï¼ˆDNS cache pollutionï¼‰ï¼Œ åˆç§°åŸŸåæœåŠ¡å™¨ç¼“å­˜æŠ•æ¯’ï¼ˆDNS cache poisoningï¼‰ï¼Œ æ˜¯æŒ‡ä¸€äº›åˆ»æ„åˆ¶é€ æˆ–æ— æ„ä¸­åˆ¶é€ å‡ºæ¥çš„åŸŸåæœåŠ¡å™¨æ•°æ®åŒ…ï¼Œ æŠŠåŸŸåæŒ‡å¾€**ä¸æ­£ç¡®çš„IPåœ°å€**ã€‚\n\næŸäº›ç½‘ç»œè¿è¥å•†ä¸ºäº†æŸäº›ç›®çš„ï¼Œ å¯¹DNSè¿›è¡Œäº†æŸäº›æ“ä½œï¼Œ å¯¼è‡´ä¸Šç½‘çš„ç”¨æˆ·æ— æ³•é€šè¿‡åŸŸåå–å¾—æ­£ç¡®çš„IPåœ°å€ã€‚ æŸäº›å›½å®¶æˆ–åœ°åŒºå‡ºäºæŸäº›ç›®çš„ä¸ºäº†é˜²æ­¢æŸç½‘ç«™è¢«è®¿é—®ï¼Œ è€Œä¸”å…¶åˆæŒæ¡éƒ¨åˆ†å›½é™…DNSæ ¹ç›®å½•æœåŠ¡å™¨æˆ–é•œåƒï¼Œ ä¹Ÿä¼šåˆ©ç”¨æ­¤æ–¹æ³•è¿›è¡Œå±è”½ã€‚ ï¼ˆGoogleã€ Facebookç­‰ï¼‰\n\nè‡³äºå¦‚æœé˜²æ­¢DNSæ±¡æŸ“ï¼Œ è¿™é‡Œåªè¯´ä¸€ä¸ªæ–¹æ³•å°±æ˜¯ä¿®æ”¹hostsæ–‡ä»¶ï¼Œ å…¶ä»–çš„è‡ªè¡Œæœç´¢å§ã€‚\n\n\n\n## TCPå»ºç«‹è¿æ¥\n\nå…¶å®æˆ‘ä»¬è§£æä¹‹åï¼Œæ‰¾åˆ°çœŸæ­£çš„æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å°±éœ€è¦è·å–ä»–çš„èµ„æºï¼Œæœ€ç®€å•çš„å°±æ˜¯è·å–ä»–çš„HTMLæ–‡ä»¶ï¼Œæ¥æ¸²æŸ“å¯¹å§ï¼Ÿæ€ä¹ˆè·å–å‘¢ï¼Œæˆ‘ä»¬éœ€è¦TCPè¿æ¥æ¥è·å–ã€‚\n\nè¿™é‡Œæ¶‰åŠåˆ°ä¸‰æ¬¡æ¡æ‰‹ï¼Œå’Œå››æ¬¡æŒ¥æ‰‹ä»¥åŠUDPçš„ä¸€äº›ç»†ä¸€ç‚¹çš„çŸ¥è¯†ç‚¹ã€‚\n\nè¯´TCPä¹‹å‰æˆ‘æƒ³æŠŠä¸€äº›é‡Œé¢å¯èƒ½ç”¨åˆ°çš„ä¸œè¥¿å…ˆè¯´è¯´æ¸…æ¥šï¼Œæ–¹ä¾¿æŸ¥æ‰¾ã€‚\n\n> ä½ç å³tcpæ ‡å¿—ä½ï¼Œæœ‰6ç§æ ‡ç¤ºï¼šSYN(synchronouså»ºç«‹è”æœº) ACK(acknowledgement ç¡®è®¤) PSH(pushä¼ é€) FIN(finishç»“æŸ) RST(reseté‡ç½®) URG(urgentç´§æ€¥)Sequence number(é¡ºåºå·ç ) Acknowledge number(ç¡®è®¤å·ç )\n\n### ä¸‰æ¬¡æ¡æ‰‹\n\n![demo2](/image/åœ°å€æ /woshou.png)\n\n\n\nä¸‰æ¬¡æ¡æ‰‹åŸºæœ¬ä¸Šå°±æ˜¯ğŸ‘†çš„å›¾ç‰‡äº†ï¼Œé‡Œé¢çš„ä½ç åœ¨ä¹‹å‰ä¹Ÿæœ‰è§£é‡Šã€‚\n\nè¿™é‡Œé‡ç‚¹è¯´ä¸€ä¸‹ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹ğŸ¤ï¼Œè€Œä¸æ˜¯ä¸¤æ¬¡æˆ–è€…å››æ¬¡ã€‚\n\nAåœ¨è¡—ä¸Šçœ‹è§äº†éš”äº†100ç±³çš„Bï¼Œï¼ˆæ­£å¸¸æƒ…å†µä¸‹å¦‚æœé¢å¯¹é¢äº¤æµæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯è¡—ä¸Šå¾ˆåµï¼Œå„ç§è½¦é¸£å£°ï¼Œåº—é“ºå¹¿å‘Šå£°ä¹‹ç±»çš„ã€‚ï¼‰æ‰€ä»¥Aæƒ³å’ŒBè¿›è¡Œå¯¹è¯ï¼Œï¼ˆåˆ«é—®é¢˜ä¸ºä»€ä¹ˆä¸æ‰“ç”µè¯ï¼ŒèŠ‚çº¦é’±ï¼ï¼‰\n\nAå–Šäº†Bä¸€å£°ï¼Œä¸çŸ¥é“Bå¬ä¸å¬å¾—è§ï¼Œæ‰€ä»¥åªèƒ½åœ¨è¿œå¤„ç­‰Bçš„å›åº”ã€‚\n\nBå¬è§äº†ï¼Œä¹Ÿå›åº”äº†Aï¼Œä½†æ˜¯ä»–ä¸çŸ¥é“Aèƒ½ä¸èƒ½å¬è§æ‰€ä»¥ä¹Ÿè¦ç­‰Aå›åº”ã€‚\n\nç„¶åAç»™å‡ºäº†å›åº”ï¼Œä¹‹åAå’ŒBå°±å¿«ä¹çš„äº¤æµèµ·æ¥ã€‚\n\nokï¼Œæˆ‘ä»¬å†æ¦‚æ‹¬ä¸€ä¸‹ã€‚\n\nå¯¹åº”åˆ°ä¸‰æ¬¡æ¡æ‰‹å°±æ˜¯A -> clientï¼›B->server\n\n1. ç¬¬ä¸€æ¬¡ğŸ¤ï¼ˆAå–ŠBï¼‰æ˜¯ä¸ºäº†ç¡®è®¤ä¸€ä¸‹Bèƒ½ä¸èƒ½å¬è§ï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯è¦ç¡®è®¤æœåŠ¡ç«¯çš„æ¥å—åŠŸèƒ½æ­£ä¸æ­£å¸¸\n2. ç¬¬äºŒæ¬¡ğŸ¤ï¼ˆBå–ŠAï¼‰æ˜¯å‘Šè¯‰Aï¼Œæˆ‘èƒ½å¬è§ï¼Œç°åœ¨æˆ‘ç°åœ¨çŸ¥é“ä½ èƒ½ä¸èƒ½å¬è§ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡ç«¯å‘Šè¯‰å®¢æˆ·ç«¯æˆ‘æ¥å—åŠŸèƒ½æ­£å¸¸ï¼Œç°åœ¨æˆ‘æƒ³çŸ¥é“ä½ æ¥æ”¶åŠŸèƒ½æ­£ä¸æ­£å¸¸ã€‚\n3. ç¬¬ä¸‰æ¬¡ğŸ¤ï¼ˆAå–ŠBï¼‰æ˜¯ä¸ºäº†å‘Šè¯‰Bæˆ‘å¬è§äº†ï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯è®©æœåŠ¡ç«¯çŸ¥é“å®¢æˆ·ç«¯çš„æ¥æ”¶åŠŸèƒ½æ­£å¸¸ï¼Œå¹¶ä¸”å¯ä»¥å¼€å§‹ä¼ è¾“ã€‚\n\nä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œå› ä¸ºåªæœ‰è¿™ä¸‰æ¬¡å¯ä»¥å®Œç¾çš„ç¡®è®¤åŒæ–¹çš„æ¥æ”¶å’Œå‘é€åŠŸèƒ½æ­£å¸¸ã€‚\n\nä¸ºä»€ä¹ˆä¸æ˜¯ä¸¤æ¬¡æ¡æ‰‹ï¼ŸæŒ‰ç…§ä¸Šé¢çš„è¯´æ³•ï¼ŒBç›´æ¥å¼€å§‹å‘é€æ•°æ®ï¼Œå¯æ˜¯ä»–æ ¹æœ¬ä¸çŸ¥é“Aèƒ½ä¸èƒ½æ¥æ”¶å•Šï¼Œå‘å‡ºå»å²‚ä¸æ˜¯æµªè´¹äº†ï¼Œå¯¹å§ï¼Ÿä¸‡ä¸€Aä¸èƒ½æ¥æ”¶å‘¢ï¼Ÿæ‰€ä»¥åªèƒ½ç­‰å¾…Açš„å›åº”\n\nä¸ºä»€ä¹ˆä¸æ˜¯å››æ¬¡æ¡æ‰‹ï¼Ÿå› ä¸ºä¸‰æ¬¡å°±å·²ç»å®Œæˆäº†ä»–ä»¬äº’ç›¸æƒ³çŸ¥é“çš„ä¿¡æ¯ä¸éœ€è¦ç»§ç»­æµªè´¹èµ„æºäº†ï¼Œèµ¶ç´§å¼€å§‹é€šä¿¡å§ï¼\n\n### å››æ¬¡æŒ¥æ‰‹\n\nå››æ¬¡æŒ¥æ‰‹å…¶å®åé¢æ‰ä¼šè®²åˆ°ï¼Œä½†æ˜¯å› ä¸ºçŸ¥è¯†ç‚¹æ˜¯ä¸€èµ·çš„ï¼Œæ‰€ä»¥å°±æ”¾åœ¨ä¸€èµ·è®²äº†\n\nè€è§„çŸ©ï¼Œçœ‹å›¾å’Œä¸Šé¢çš„ä½ç æ„æ€ï¼Œå°±ä¸å¤šè§£é‡Šäº†ã€‚\n\n![demo3](/image/åœ°å€æ /huishou.png)\n\n\n\nè¿™é‡Œé‡ç‚¹è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆæ˜¯å››æ¬¡æŒ¥æ‰‹ğŸ‘‹\n\nçœ‹å›¾æˆ‘ä»¬å¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹åˆ°å…¶å®å°±å¤šäº†ä¸€æ¬¡æœåŠ¡ç«¯å‘Šè¯‰å®¢æˆ·ç«¯è¦ç»ˆæ­¢çš„æ¶ˆæ¯ã€‚\n\nè¿˜æ˜¯ä¸¾åˆšåˆšAå’ŒBçš„ä¾‹å­å§ã€‚\n\nAè§‰å¾—å’ŒBèŠçš„å·®ä¸å¤šäº†ï¼Œæƒ³ç»“æŸå¯¹è¯ï¼Œå› ä¸ºå¤©è‰²å¾ˆæ™šäº†è¦å›å®¶åƒé¥­ğŸšäº†ã€‚\n\næ‰€ä»¥Aå‘Šè¯‰Bï¼Œæˆ‘æƒ³èµ°äº†ï¼Œä¸æƒ³èŠäº†ã€‚\n\nBæ”¶åˆ°åå‘Šè¯‰Aï¼Œå¥½çš„ï¼Œæˆ‘çŸ¥é“äº†ï¼Œä½†æ˜¯ä½ ç­‰æˆ‘ä¸€ä¸‹ï¼Œæˆ‘æ’’æ³¡å°¿ï¼Œæ’’å®Œä¸€èµ·èµ°ã€‚\n\nBæ’’å®Œå°¿ä¹‹åï¼Œå‘Šè¯‰Aæˆ‘æ’’å®Œå°¿äº†ã€‚\n\nAæ”¶åˆ°ä¸¤å¥è¯ï¼ˆ1.Bå¬åˆ°ğŸ‘‚Aæƒ³å›å®¶çš„æ¶ˆæ¯ï¼Œ2.Bæ’’å®Œå°¿ä¹‹åçš„ä¸€å¥è¯ï¼‰åï¼Œå‘Šè¯‰Bï¼Œæˆ‘èµ°äº†ã€‚\n\nBå¬åˆ°åä¹Ÿå›å®¶äº†ã€‚\n\nokï¼Œæˆ‘ä»¬å†æ¦‚æ‹¬ä¸€ä¸‹ã€‚\n\nå¯¹åº”åˆ°ä¸‰æ¬¡æ¡æ‰‹å°±æ˜¯A -> clientï¼›B->server\n\n1. ç¬¬ä¸€æ¬¡ğŸ‘‹ Aå‘Šè¯‰Bæˆ‘æƒ³å›å®¶åƒé¥­äº†ã€‚ä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯å‘Šè¯‰æœåŠ¡ç«¯ï¼Œæƒ³æ–­å¼€è¿æ¥äº†ã€‚\n2. ç¬¬äºŒæ¬¡ğŸ‘‹Bå‘Šè¯‰Aæˆ‘æ”¶åˆ°ä½ çš„æ¶ˆæ¯äº†ï¼Œä¸è¿‡æˆ‘å°¿æ‹‰å®Œå°±ä¸€èµ·å›å®¶å§ã€‚ä¹Ÿå°±æ˜¯æœåŠ¡ç«¯å‘Šè¯‰å®¢æˆ·ç«¯æˆ‘æ”¶åˆ°ä½ çš„æ¶ˆæ¯äº†ï¼Œä½†æ˜¯æˆ‘è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæ–‡ä»¶æ²¡æœ‰ä¼ è¾“å®Œï¼Œæå®šäº†å°±å…³é—­é“¾æ¥ã€‚\n3. ç¬¬ä¸‰æ¬¡ğŸ‘‹Bå‘Šè¯‰Aæˆ‘æ’’å®Œå°¿äº†ã€‚ä¹Ÿå°±æ˜¯æœåŠ¡ç«¯å‘Šè¯‰å®¢æˆ·ç«¯æˆ‘æ–‡ä»¶ä¼ è¾“å®Œäº†ï¼Œå¯ä»¥å…³é—­é“¾æ¥äº†ã€‚\n4. ç¬¬å››æ¬¡ğŸ‘‹Aå‘Šè¯‰Bä½ çš„ä¸¤å¥è¯éƒ½å¬åˆ°äº†ï¼ˆ1.Bå¬åˆ°äº†Aæƒ³å›å®¶çš„æ¶ˆæ¯ï¼Œ2.Bæ’’å®Œå°¿äº†ï¼‰ã€‚ä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯å‘Šè¯‰æœåŠ¡ç«¯æˆ‘å…³é—­é“¾æ¥äº†ï¼Œä½ ä¹Ÿåˆ«å‘äº†ã€‚\n\nåŒæ–¹ç»“æŸé“¾æ¥ã€‚\n\nç›¸æ¯”äºä¸‰æ¬¡æ¡æ‰‹ï¼Œå¤šå‡ºæ¥çš„é‚£ä¸€æ¬¡å›æ”¶å°±æ˜¯æœåŠ¡ç«¯éœ€è¦æœ‰ä¸€ä¸ªå…³é—­ä¼ è¾“çš„è¿™ä¹ˆä¸€ä¸ªè¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½éœ€è¦æ—¶é—´ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯éœ€è¦ç­‰å¾…ä¼ è¾“ã€‚\n\n### UDP\n\nè¿™é‡Œè™½ç„¶ä¸åœ¨èŒƒå›´å†…ï¼Œä½†æ˜¯æˆ‘æƒ³è®²éƒ½è®²äº†ï¼Œé¡ºä¾¿å§UDPä¸€èµ·è¯´å§ï¼\n\nUDPåè®®å…¨ç§°æ˜¯ç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼Œåœ¨ç½‘ç»œä¸­å®ƒä¸TCPåè®®ä¸€æ ·ç”¨äºå¤„ç†æ•°æ®åŒ…ï¼Œæ˜¯ä¸€ç§æ— è¿æ¥çš„åè®®ã€‚åœ¨OSIæ¨¡å‹ä¸­ï¼Œåœ¨ç¬¬å››å±‚â€”â€”ä¼ è¾“å±‚ï¼Œå¤„äºIPåè®®çš„ä¸Šä¸€å±‚ã€‚UDPæœ‰ä¸æä¾›æ•°æ®åŒ…åˆ†ç»„ã€ç»„è£…å’Œä¸èƒ½å¯¹æ•°æ®åŒ…è¿›è¡Œæ’åºçš„ç¼ºç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æŠ¥æ–‡å‘é€ä¹‹åï¼Œæ˜¯æ— æ³•å¾—çŸ¥å…¶æ˜¯å¦å®‰å…¨å®Œæ•´åˆ°è¾¾çš„ã€‚\n\nå®ƒæœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š\n\n#### 1.é¢å‘æ— è¿æ¥\n\né¦–å…ˆ UDP æ˜¯ä¸éœ€è¦å’Œ TCPä¸€æ ·åœ¨å‘é€æ•°æ®å‰è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥çš„ï¼Œæƒ³å‘æ•°æ®å°±å¯ä»¥å¼€å§‹å‘é€äº†ã€‚å¹¶ä¸”ä¹Ÿåªæ˜¯æ•°æ®æŠ¥æ–‡çš„æ¬è¿å·¥ï¼Œä¸ä¼šå¯¹æ•°æ®æŠ¥æ–‡è¿›è¡Œä»»ä½•æ‹†åˆ†å’Œæ‹¼æ¥æ“ä½œã€‚\n\nå…·ä½“æ¥è¯´å°±æ˜¯ï¼š\n\n- åœ¨å‘é€ç«¯ï¼Œåº”ç”¨å±‚å°†æ•°æ®ä¼ é€’ç»™ä¼ è¾“å±‚çš„ UDP åè®®ï¼ŒUDP åªä¼šç»™æ•°æ®å¢åŠ ä¸€ä¸ª UDP å¤´æ ‡è¯†ä¸‹æ˜¯ UDP åè®®ï¼Œç„¶åå°±ä¼ é€’ç»™ç½‘ç»œå±‚äº†\n- åœ¨æ¥æ”¶ç«¯ï¼Œç½‘ç»œå±‚å°†æ•°æ®ä¼ é€’ç»™ä¼ è¾“å±‚ï¼ŒUDP åªå»é™¤ IP æŠ¥æ–‡å¤´å°±ä¼ é€’ç»™åº”ç”¨å±‚ï¼Œä¸ä¼šä»»ä½•æ‹¼æ¥æ“ä½œ\n\n#### 2.æœ‰å•æ’­ï¼Œå¤šæ’­ï¼Œå¹¿æ’­çš„åŠŸèƒ½\n\nUDP ä¸æ­¢æ”¯æŒä¸€å¯¹ä¸€çš„ä¼ è¾“æ–¹å¼ï¼ŒåŒæ ·æ”¯æŒä¸€å¯¹å¤šï¼Œå¤šå¯¹å¤šï¼Œå¤šå¯¹ä¸€çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯è¯´ UDP æä¾›äº†å•æ’­ï¼Œå¤šæ’­ï¼Œå¹¿æ’­çš„åŠŸèƒ½ã€‚\n\n#### 3.UDPæ˜¯é¢å‘æŠ¥æ–‡çš„\n\nå‘é€æ–¹çš„UDPå¯¹åº”ç”¨ç¨‹åºäº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œåœ¨æ·»åŠ é¦–éƒ¨åå°±å‘ä¸‹äº¤ä»˜IPå±‚ã€‚UDPå¯¹åº”ç”¨å±‚äº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œæ—¢ä¸åˆå¹¶ï¼Œä¹Ÿä¸æ‹†åˆ†ï¼Œè€Œæ˜¯ä¿ç•™è¿™äº›æŠ¥æ–‡çš„è¾¹ç•Œã€‚å› æ­¤ï¼Œåº”ç”¨ç¨‹åºå¿…é¡»é€‰æ‹©åˆé€‚å¤§å°çš„æŠ¥æ–‡\n\n#### 4.ä¸å¯é æ€§\n\né¦–å…ˆä¸å¯é æ€§ä½“ç°åœ¨æ— è¿æ¥ä¸Šï¼Œé€šä¿¡éƒ½ä¸éœ€è¦å»ºç«‹è¿æ¥ï¼Œæƒ³å‘å°±å‘ï¼Œè¿™æ ·çš„æƒ…å†µè‚¯å®šä¸å¯é ã€‚\n\nå¹¶ä¸”æ”¶åˆ°ä»€ä¹ˆæ•°æ®å°±ä¼ é€’ä»€ä¹ˆæ•°æ®ï¼Œå¹¶ä¸”ä¹Ÿä¸ä¼šå¤‡ä»½æ•°æ®ï¼Œå‘é€æ•°æ®ä¹Ÿä¸ä¼šå…³å¿ƒå¯¹æ–¹æ˜¯å¦å·²ç»æ­£ç¡®æ¥æ”¶åˆ°æ•°æ®äº†ã€‚\n\nå†è€…ç½‘ç»œç¯å¢ƒæ—¶å¥½æ—¶åï¼Œä½†æ˜¯ UDP å› ä¸ºæ²¡æœ‰æ‹¥å¡æ§åˆ¶ï¼Œä¸€ç›´ä¼šä»¥æ’å®šçš„é€Ÿåº¦å‘é€æ•°æ®ã€‚å³ä½¿ç½‘ç»œæ¡ä»¶ä¸å¥½ï¼Œä¹Ÿä¸ä¼šå¯¹å‘é€é€Ÿç‡è¿›è¡Œè°ƒæ•´ã€‚è¿™æ ·å®ç°çš„å¼Šç«¯å°±æ˜¯åœ¨ç½‘ç»œæ¡ä»¶ä¸å¥½çš„æƒ…å†µä¸‹å¯èƒ½ä¼šå¯¼è‡´ä¸¢åŒ…ï¼Œä½†æ˜¯ä¼˜ç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œåœ¨æŸäº›å®æ—¶æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼ˆæ¯”å¦‚ç”µè¯ä¼šè®®ï¼‰å°±éœ€è¦ä½¿ç”¨ UDP è€Œä¸æ˜¯ TCPã€‚\n\nUDPåªæƒ³æŠŠæ•°æ®å‘å‡ºå»ï¼Œå…·ä½“æœ‰æ²¡æœ‰æˆåŠŸä»–ä¸å…³å¿ƒ\n\n#### 5.å¤´éƒ¨å¼€é”€å°ï¼Œä¼ è¾“æ•°æ®æŠ¥æ–‡æ—¶æ˜¯å¾ˆé«˜æ•ˆçš„ã€‚\n\nUDP å¤´éƒ¨åŒ…å«äº†ä»¥ä¸‹å‡ ä¸ªæ•°æ®ï¼š\n\n- ä¸¤ä¸ªåå…­ä½çš„ç«¯å£å·ï¼Œåˆ†åˆ«ä¸ºæºç«¯å£ï¼ˆå¯é€‰å­—æ®µï¼‰å’Œç›®æ ‡ç«¯å£\n- æ•´ä¸ªæ•°æ®æŠ¥æ–‡çš„é•¿åº¦\n- æ•´ä¸ªæ•°æ®æŠ¥æ–‡çš„æ£€éªŒå’Œï¼ˆIPv4 å¯é€‰ å­—æ®µï¼‰ï¼Œè¯¥å­—æ®µç”¨äºå‘ç°å¤´éƒ¨ä¿¡æ¯å’Œæ•°æ®ä¸­çš„é”™è¯¯\n\nå› æ­¤ UDP çš„å¤´éƒ¨å¼€é”€å°ï¼Œåªæœ‰å…«å­—èŠ‚ï¼Œç›¸æ¯” TCP çš„è‡³å°‘äºŒåå­—èŠ‚è¦å°‘å¾—å¤šï¼Œåœ¨ä¼ è¾“æ•°æ®æŠ¥æ–‡æ—¶æ˜¯å¾ˆé«˜æ•ˆçš„\n\n#### 6.æ€»ç»“\n\n\n\n|              | UDP                                        | TCP                                    |\n| ------------ | ------------------------------------------ | -------------------------------------- |\n| æ˜¯å¦è¿æ¥     | æ— è¿æ¥                                     | é¢å‘è¿æ¥                               |\n| æ˜¯å¦å¯é      | ä¸å¯é ä¼ è¾“ï¼Œä¸ä½¿ç”¨æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶       | å¯é ä¼ è¾“ï¼Œä½¿ç”¨æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶       |\n| è¿æ¥å¯¹è±¡ä¸ªæ•° | æ”¯æŒä¸€å¯¹ä¸€ï¼Œä¸€å¯¹å¤šï¼Œå¤šå¯¹ä¸€å’Œå¤šå¯¹å¤šäº¤äº’é€šä¿¡ | åªèƒ½æ˜¯ä¸€å¯¹ä¸€é€šä¿¡                       |\n| ä¼ è¾“æ–¹å¼     | é¢å‘æŠ¥æ–‡                                   | é¢å‘å­—èŠ‚æµ                             |\n| é¦–éƒ¨å¼€é”€     | é¦–éƒ¨å¼€é”€å°ï¼Œä»…8å­—èŠ‚                        | é¦–éƒ¨æœ€å°20å­—èŠ‚ï¼Œæœ€å¤§60å­—èŠ‚             |\n| é€‚ç”¨åœºæ™¯     | é€‚ç”¨äºå®æ—¶åº”ç”¨ï¼ˆIPç”µè¯ã€è§†é¢‘ä¼šè®®ã€ç›´æ’­ç­‰ï¼‰ | é€‚ç”¨äºè¦æ±‚å¯é ä¼ è¾“çš„åº”ç”¨ï¼Œä¾‹å¦‚æ–‡ä»¶ä¼ è¾“ |\n\n## SSL/TLSåŠ å¯†\n\nåœ¨HTTPè¯·æ±‚ä¹‹å‰ï¼Œå¦‚æœæœ‰åŠ å¯†çš„ï¼ˆå°±æ˜¯HTTPSï¼‰ï¼Œéœ€è¦å…ˆç¡®è®¤ä¸€ä¸‹åŒæ–¹æ˜¯å¦æ˜¯è‡ªå·±æƒ³è¦æ‰¾çš„é‚£ä¸ªäººã€‚\n\næ€ä¹ˆçŸ¥é“é‚£ä¸ªä»–æ˜¯ä¸æ˜¯è‡ªå·±è¦æ‰¾çš„äººå‘¢ï¼Ÿæœ‰ä¸¤ç§æ–¹æ³•ï¼šå¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†\n\n### å¯¹ç§°åŠ å¯†\n\nå¯¹ç§°åŠ å¯†å…¶å®å°±æ˜¯Aå’ŒBéƒ½æœ‰ä¸€ä¸ªè§£å¯†çš„è§„åˆ™ï¼ŒåŒæ–¹éƒ½å¿ƒçŸ¥è‚šæ˜ã€‚è¿™æ ·å°±å¯ä»¥è§£å¯†ã€‚\n\nå¯¹ç§°åŠ å¯†çš„ä¸€å¤§ç¼ºç‚¹æ˜¯å¯†é’¥çš„ç®¡ç†ä¸åˆ†é…ï¼Œæ¢å¥è¯è¯´ï¼Œå¦‚ä½•æŠŠå¯†é’¥å‘é€åˆ°éœ€è¦è§£å¯†ä½ çš„æ¶ˆæ¯çš„äººçš„æ‰‹é‡Œæ˜¯ä¸€ä¸ªé—®é¢˜ã€‚åœ¨å‘é€å¯†é’¥çš„è¿‡ç¨‹ä¸­ï¼Œå¯†é’¥æœ‰å¾ˆå¤§çš„é£é™©ä¼šè¢«é»‘å®¢ä»¬æ‹¦æˆªã€‚ç°å®ä¸­é€šå¸¸çš„åšæ³•æ˜¯å°†å¯¹ç§°åŠ å¯†çš„å¯†é’¥è¿›è¡Œéå¯¹ç§°åŠ å¯†ï¼Œç„¶åä¼ é€ç»™éœ€è¦å®ƒçš„äººã€‚\n\n### éå¯¹ç§°åŠ å¯†\n\né‚£ä¹ˆä»€ä¹ˆæ˜¯éå¯¹ç§°åŠ å¯†å‘¢ï¼Ÿ\n\néå¯¹ç§°åŠ å¯†ä¸ºæ•°æ®çš„åŠ å¯†ä¸è§£å¯†æä¾›äº†ä¸€ä¸ªéå¸¸å®‰å…¨çš„æ–¹æ³•ï¼Œå®ƒä½¿ç”¨äº†ä¸€å¯¹å¯†é’¥ï¼Œå…¬é’¥ï¼ˆpublic keyï¼‰å’Œç§é’¥ï¼ˆprivate keyï¼‰ã€‚ç§é’¥åªèƒ½ç”±ä¸€æ–¹å®‰å…¨ä¿ç®¡ï¼Œä¸èƒ½å¤–æ³„ï¼Œè€Œå…¬é’¥åˆ™å¯ä»¥å‘ç»™ä»»ä½•è¯·æ±‚å®ƒçš„äººã€‚éå¯¹ç§°åŠ å¯†ä½¿ç”¨è¿™å¯¹å¯†é’¥ä¸­çš„ä¸€ä¸ªè¿›è¡ŒåŠ å¯†ï¼Œè€Œè§£å¯†åˆ™éœ€è¦å¦ä¸€ä¸ªå¯†é’¥ã€‚æ¯”å¦‚ï¼Œä½ å‘é“¶è¡Œè¯·æ±‚å…¬é’¥ï¼Œé“¶è¡Œå°†å…¬é’¥å‘ç»™ä½ ï¼Œä½ ä½¿ç”¨å…¬é’¥å¯¹æ¶ˆæ¯åŠ å¯†ï¼Œé‚£ä¹ˆåªæœ‰ç§é’¥çš„æŒæœ‰äºº--é“¶è¡Œæ‰èƒ½å¯¹ä½ çš„æ¶ˆæ¯è§£å¯†ã€‚ä¸å¯¹ç§°åŠ å¯†ä¸åŒçš„æ˜¯ï¼Œé“¶è¡Œä¸éœ€è¦å°†ç§é’¥é€šè¿‡ç½‘ç»œå‘é€å‡ºå»ï¼Œå› æ­¤å®‰å…¨æ€§å¤§å¤§æé«˜ã€‚\n\n### æ€»ç»“\n\næ‰€ä»¥åŸºæœ¬ä¸Šéƒ½æ˜¯å…ˆç”¨éå¯¹ç§°åŠ å¯†ä¼ è¾“å¯¹ç§°åŠ å¯†çš„ç§˜é’¥ã€‚\n\n## HTTPè¯·æ±‚\n\nHTTPè¯·æ±‚å¾—åˆ°èµ„æºæ–‡ä»¶ï¼Œå¦‚æœæœ‰gzipå‹ç¼©çš„è¯è¿˜éœ€è¦è§£å‹ï¼Œç„¶åæ˜¯ä¸€äº›HTTPå°çš„é›¶ç¢çŸ¥è¯†ç‚¹ã€‚\n\n### HTTPæŠ¥æ–‡\n\nHTTP æŠ¥æ–‡æ˜¯ç”± è¯·æ±‚æŠ¥æ–‡+å“åº”æŠ¥æ–‡ å…±åŒç»„æˆ\n\n- è¯·æ±‚æŠ¥æ–‡ï¼š\n  - å®šä¹‰ï¼šæ‰€æœ‰ç»è¿‡ä¼ è¾“åè®®ï¼Œå®¢æˆ·ç«¯ä¼ é€’ç»™æœåŠ¡å™¨çš„å†…å®¹ï¼Œéƒ½è¢«æˆä¸ºè¯·æ±‚æŠ¥æ–‡\n  - åŒ…å«ï¼š\n    - èµ·å§‹è¡Œ\n    - è¯·æ±‚å¤´ï¼ˆè¯·æ±‚é¦–éƒ¨ï¼‰\n    - è¯·æ±‚ä¸»ä½“\n- å“åº”æŠ¥æ–‡ï¼š\n  - å®šä¹‰ï¼šæ‰€æœ‰ç»è¿‡ä¼ è¾“åè®®ï¼ŒæœåŠ¡å™¨è¿”å›ç»™å®¢æˆ·ç«¯çš„å†…å®¹ï¼Œéƒ½è¢«æˆä¸ºå“åº”æŠ¥æ–‡\n  - åŒ…å«ï¼š\n    - HTTPçŠ¶æ€ç \n    - å“åº”å¤´\n    - å“åº”ä¸»ä½“\n\n\n\n### HTTPçŠ¶æ€ç \n\n1~5å¼€å¤´ï¼Œä¸‰ä½æ•°å­—\n\n- 1 å¼€å¤´çš„ä»£è¡¨å¤„ç†ä¸­ï¼Œä¸€èˆ¬è§ä¸åˆ°\n- 2å¼€å¤´ï¼šéƒ½æ˜¯æˆåŠŸ\n  - 200ï¼šOKï¼šæˆåŠŸ\n  - 201ï¼šCREATEDï¼šä¸€èˆ¬åº”ç”¨äºå‘Šè¯‰æœåŠ¡å™¨åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œæœ€åæœåŠ¡å™¨åˆ›å»ºæˆåŠŸåè¿”å›çš„çŠ¶æ€ç \n  - 204ï¼šNO CONTENTï¼šå¯¹äºæŸäº›è¯·æ±‚ï¼ˆä¾‹å¦‚ï¼šPUTæˆ–è€…DELETEï¼‰ï¼ŒæœåŠ¡å™¨ä¸æƒ³å¤„ç†ï¼Œå¯ä»¥è¿”å›ç©ºå†…å®¹ï¼Œå¹¶ä¸”ç”¨204çŠ¶æ€ç å‘ŠçŸ¥\n- 3å¼€å¤´ï¼šä»£è¡¨æˆåŠŸï¼Œåªä¸è¿‡ä¸­é—´éœ€è¦ä¸­è½¬ä¸€ä¸‹\n  - 301ï¼šMoved Permanentlyï¼šæ°¸ä¹…é‡å®šå‘ï¼ˆæ°¸ä¹…è½¬ç§»ï¼‰\n  - 302ï¼šMoved Temporarilyï¼šä¸´æ—¶è½¬ç§»ï¼Œå¾ˆæ—©ä»¥å‰åŸºæœ¬ä¸Šç”¨302æ¥åšï¼Œä½†æ˜¯ç°åœ¨ä¸»è¦ç”¨307æ¥å¤„ç†è¿™ä¸ªäº‹æƒ…ï¼Œ\n  - 307çš„æ„æ€å°±æ˜¯ä¸´æ—¶é‡å®šå‘Temporary Redirect =>ä¸»è¦ç”¨äºï¼šæœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡ç­‰\n  - 304ï¼šNot Modifiedï¼šè®¾ç½®HTTPçš„åå•†ç¼“å­˜\n- 4å¼€å¤´ï¼šéƒ½æ˜¯å¤±è´¥\n  - 400ï¼šBad Requestï¼šä¼ é€’ç»™æœåŠ¡å™¨çš„å‚æ•°é”™è¯¯\n  - 401ï¼šUnauthorizedï¼šæ— æƒé™è®¿é—®\n  - 404ï¼šNot Foundï¼šè¯·æ±‚åœ°å€é”™è¯¯\n- 5å¼€å¤´ï¼šéƒ½æ˜¯å¤±è´¥\n  - 500ï¼šInternal Server Errorï¼šæœªçŸ¥æœåŠ¡å™¨é”™è¯¯\n  - 503ï¼šService Unavailableï¼šæœåŠ¡å™¨è¶…è´Ÿè·\n\n\n\n### HTTPè¯·æ±‚æ–¹å¼\n\nå…¶å®æ­£å¸¸ä¼šè¯´åˆ°ä»€ä¹ˆ`POST`, `GET`ä¹‹ç±»çš„ï¼Œä½†æ˜¯æˆ‘è¿™é‡Œæƒ³è¯´ä¸€ä¸‹corsé‡Œé¢çš„ä¸œè¥¿ã€‚\n\nè¿˜æ˜¯æœ¬ç€æ—¢ç„¶å­¦åˆ°è¿™é‡Œé¡ºè·¯æææ¸…æ¥š\n\næµè§ˆå™¨å°†CORSè¯·æ±‚åˆ†æˆä¸¤ç±»ï¼šç®€å•è¯·æ±‚ï¼ˆsimple requestï¼‰å’Œéç®€å•è¯·æ±‚ï¼ˆnot-so-simple requestï¼‰ã€‚\n\n#### ç®€å•è¯·æ±‚\n\nåªè¦åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤å¤§æ¡ä»¶ï¼Œå°±å±äºç®€å•è¯·æ±‚ã€‚\n\n> ï¼ˆ1) è¯·æ±‚æ–¹æ³•æ˜¯ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ä¹‹ä¸€ï¼š\n>\n> - HEAD\n> - GET\n> - POST\n>\n> ï¼ˆ2ï¼‰HTTPçš„å¤´ä¿¡æ¯ä¸è¶…å‡ºä»¥ä¸‹å‡ ç§å­—æ®µï¼š\n>\n> - Accept\n> - Accept-Language\n> - Content-Language\n> - Last-Event-ID\n> - Content-Typeï¼šåªé™äºä¸‰ä¸ªå€¼`application/x-www-form-urlencoded`ã€`multipart/form-data`ã€`text/plain`\n\n\n\n\n\n#### éç®€å•è¯·æ±‚\n\nå‡¡æ˜¯ä¸åŒæ—¶æ»¡è¶³ä¸Šé¢ä¸¤ä¸ªæ¡ä»¶ï¼Œå°±å±äºéç®€å•è¯·æ±‚ã€‚\n\néç®€å•è¯·æ±‚æ˜¯é‚£ç§å¯¹æœåŠ¡å™¨æœ‰ç‰¹æ®Šè¦æ±‚çš„è¯·æ±‚ï¼Œæ¯”å¦‚è¯·æ±‚æ–¹æ³•æ˜¯`PUT`æˆ–`DELETE`ï¼Œæˆ–è€…`Content-Type`å­—æ®µçš„ç±»å‹æ˜¯`application/json`ã€‚\n\néç®€å•è¯·æ±‚çš„CORSè¯·æ±‚ï¼Œä¼šåœ¨æ­£å¼é€šä¿¡ä¹‹å‰ï¼Œå¢åŠ ä¸€æ¬¡HTTPæŸ¥è¯¢è¯·æ±‚ï¼Œç§°ä¸º\"é¢„æ£€\"è¯·æ±‚ï¼ˆpreflightï¼‰ã€‚\n\næµè§ˆå™¨å…ˆè¯¢é—®æœåŠ¡å™¨ï¼Œå½“å‰ç½‘é¡µæ‰€åœ¨çš„åŸŸåæ˜¯å¦åœ¨æœåŠ¡å™¨çš„è®¸å¯åå•ä¹‹ä¸­ï¼Œä»¥åŠå¯ä»¥ä½¿ç”¨å“ªäº›HTTPåŠ¨è¯å’Œå¤´ä¿¡æ¯å­—æ®µã€‚åªæœ‰å¾—åˆ°è‚¯å®šç­”å¤ï¼Œæµè§ˆå™¨æ‰ä¼šå‘å‡ºæ­£å¼çš„`XMLHttpRequest`è¯·æ±‚ï¼Œå¦åˆ™å°±æŠ¥é”™ã€‚\n\nä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„è·¨åŸŸï¼Œè¿™ä¸ªé—®é¢˜å¯ä»¥äº¤ç”±åç«¯çš„åŒå­¦è®¾ç½®ç™½åå•æˆ–è€…è¿ç»´çš„åŒå­¦è®¾ç½®ã€‚\n\nå¦‚æœæ˜¯å‰ç«¯çš„åŒå­¦åšè¿™ç§è·¨åŸŸçš„é—®é¢˜çš„è¯ä¸å¤ªæ–¹ä¾¿\n\næ¯”å¦‚\n\n- **JSONP**\n\n- #### **document.domain + iframeè·¨åŸŸ**\n\n- ####  **location.hash + iframeè·¨åŸŸ**\n\n- ####  **window.name + iframeè·¨åŸŸ**\n\n- #### **postMessageè·¨åŸŸ**\n\nä½†æ˜¯åŸºæœ¬ä¸Šæˆ‘ä»¬å¸¸ç”¨çš„å°±æ˜¯`JSONP`\n\nå…·ä½“è¿™äº›æ–¹æ³•å’Œåœºæ™¯æœ‰æœºä¼šçš„è¯å…·ä½“è¯´ä¸€ä¸‹ã€‚\n\n## æ–­å¼€TCPè¿æ¥\n\nä¹Ÿå°±æ˜¯ä¹‹å‰çš„å››æ¬¡æŒ¥æ‰‹ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ä¸Šé¢çš„è¯´çš„å››æ¬¡æŒ¥æ‰‹\n\n## æµè§ˆå™¨æ¸²æŸ“é¡µé¢\n\næ–‡ä»¶è§£ç æˆåŠŸåä¼šæ­£å¼å¼€å§‹æ¸²æŸ“æµç¨‹ï¼Œå…ˆä¼šæ ¹æ® HTML æ„å»º DOM æ ‘ï¼Œæœ‰ CSS çš„è¯ä¼šå»æ„å»º CSSOM æ ‘ã€‚å¦‚æœé‡åˆ° script æ ‡ç­¾çš„è¯ï¼Œä¼šåˆ¤æ–­æ˜¯å¦å­˜åœ¨ async æˆ–è€… defer ï¼Œå‰è€…ä¼šå¹¶è¡Œè¿›è¡Œä¸‹è½½å¹¶æ‰§è¡Œ JSï¼Œåè€…ä¼šå…ˆä¸‹è½½æ–‡ä»¶ï¼Œç„¶åç­‰å¾… HTML è§£æå®Œæˆåé¡ºåºæ‰§è¡Œã€‚\n\nå¦‚æœä»¥ä¸Šéƒ½æ²¡æœ‰ï¼Œå°±ä¼šé˜»å¡ä½æ¸²æŸ“æµç¨‹ç›´åˆ° JS æ‰§è¡Œå®Œæ¯•ã€‚é‡åˆ°æ–‡ä»¶ä¸‹è½½çš„ä¼šå»ä¸‹è½½æ–‡ä»¶ï¼Œè¿™é‡Œå¦‚æœä½¿ç”¨ HTTP/2 åè®®çš„è¯ä¼šæå¤§çš„æé«˜å¤šå›¾çš„ä¸‹è½½æ•ˆç‡ã€‚\n\nCSSOM æ ‘å’Œ DOM æ ‘æ„å»ºå®Œæˆåä¼šå¼€å§‹ç”Ÿæˆ Render æ ‘ï¼Œè¿™ä¸€æ­¥å°±æ˜¯ç¡®å®šé¡µé¢å…ƒç´ çš„å¸ƒå±€ã€æ ·å¼ç­‰ç­‰è¯¸å¤šæ–¹é¢çš„ä¸œè¥¿\n\nåœ¨ç”Ÿæˆ Render æ ‘çš„è¿‡ç¨‹ä¸­ï¼Œæµè§ˆå™¨å°±å¼€å§‹è°ƒç”¨ GPU ç»˜åˆ¶ï¼Œåˆæˆå›¾å±‚ï¼Œå°†å†…å®¹æ˜¾ç¤ºåœ¨å±å¹•ä¸Šäº†ã€‚\n\n\n\n# æ€»ç»“\n\n1. URLè§£æ\n2. DNSè§£æ\n3. å»ºç«‹è¿æ¥\n4. å¦‚æœæœ‰åŠ å¯†çš„è¯è¦å…ˆè§£å¯†\n5. ç„¶åhttpè¯·æ±‚è·å–èµ„æº\n6. æ–­å¼€è¿æ¥\n7. å¾—åˆ°èµ„æºä¹‹åå¦‚æœæœ‰gzipå‹ç¼©è¦å…ˆè§£å‹\n8. ç„¶åå…ˆæ„å»ºDOMæ ‘ï¼ŒCSSæ ‘ã€‚ä¸‹è½½JSæ–‡ä»¶ï¼Œç„¶åä¸‹è½½å›¾ç‰‡ã€‚ç„¶åç”ŸæˆRenderæ ‘ï¼Œæœ€åç¡®å®šå¸ƒå±€ï¼ŒGPUç»˜åˆ¶ã€‚\n\n# ç´¢å¼•\n\n> https://www.ruanyifeng.com/blog/2016/04/cors.html\n>\n> å‰ç«¯é¢è¯•ä¹‹é“ï¼ˆæ˜é‡‘å°å†Œ\n>\n> https://juejin.im/post/6844904162166063118#heading-30","source":"_posts/ã€é‡è¯†å‰ç«¯ã€‘åœ°å€æ ä¸­è¾“å…¥ç½‘å€å.md","raw":"---\ntitle: ã€é‡è¯†å‰ç«¯ã€‘åœ°å€æ ä¸­è¾“å…¥ç½‘å€åå‘ç”Ÿäº†ä»€ä¹ˆ\ndate: 2020-10-09 10:08:31\ntags: [æµè§ˆå™¨]\ncategory: [é‡æ‹¾å‰ç«¯]\ncover: /image/cover/web.jpeg\n---\n\n# å‰è¨€\n\nä¸è¯´å¤ªå¤šåºŸè¯äº†ï¼Œè¿™ä¸ªé¢˜ç›®å…¶å®åŸºæœ¬ä¸Šæ˜¯ç°åœ¨é¢è¯•çš„é«˜é¢‘è€ƒç‚¹äº†ï¼Œç°åœ¨æˆ‘ä¹Ÿæƒ³è‡ªå·±è®¤è®¤çœŸçœŸçš„æ‹ä¸€éï¼Œåˆ°æ—¶å€™é¢è¯•ä¹Ÿå¯ä»¥æµåˆ©çš„å›ç­”ã€‚\n\n# å¼€å§‹\n\nlet's go\n\n## URLè§£æ\n\nå…¶å®æœ‰äººä¸€å¼€å§‹ä¼šæœ‰ç–‘æƒ‘ï¼Œè‡³å°‘æˆ‘ä¸€å¼€å§‹ä¹Ÿæœ‰ç–‘æƒ‘ï¼Œä¸æ˜¯åº”è¯¥å…ˆDNSè§£æå—ï¼Ÿ\n\nå…¶å®ä¸æ˜¯çš„ï¼Œç°åœ¨çš„æµè§ˆå™¨ä»–ä¼šä¼˜å…ˆè§£æä½ æ˜¯ä¸æ˜¯ä¸€ä¸ªåˆæ³•çš„URLï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿæ¯”å¦‚æˆ‘ä»¬åœ¨Chromeè¾“å…¥ä¸­æ–‡â€œDerrickæ˜¯å¸…å“¥å—â€ï¼Œè¿™æ ·çš„ä¸æ˜¯ä¸€ä¸ªæ­£å¸¸çš„åˆæ³•çš„URLï¼Œå°±ä¼šä¼˜å…ˆè°ƒç”¨ä½ é»˜è®¤çš„æœç´¢å¼•æ“å¼€å§‹æœç´¢ã€‚\n\nå½“ç„¶äº†ï¼Œåˆæ³•çš„URLåŒ…æ‹¬äº†åè®®å’Œç½‘ç»œåœ°å€ï¼Œæœ€å¸¸ç”¨çš„åè®®æ˜¯\n\n- HTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰\n- FTPï¼ˆæ–‡ä»¶ä¼ è¾“åè®®ï¼‰\n\nç½‘ç»œåœ°å€ä¹Ÿå¯ä»¥æ˜¯ipåœ°å€ï¼Œä»¥åŠç«¯å£å·ï¼Œæ²¡æœ‰ç«¯å£é»˜è®¤æ˜¯80ç«¯å£\n\n## DNSåŸŸåè§£æ\n\nè¿™ä¸€æ­¥å…¶å®ç®€å•æ¥è¯´å°±æ˜¯\"baidu.com\"è¿™ä¸ªåŸŸåï¼Œè§£ææˆä¸€ä¸ªæ•´ä¸ªçš„åœ°å€ã€‚\n\næ¯”å¦‚æˆ‘ä»¬çš„å®¶åº­ä½å€éƒ½æœ‰ä¸€ä¸ªé—¨ç‰Œå·ï¼Œxxå°åŒºxxæ ‹xxå·\n\nè¿™æ ·çš„ä¸€ä¸²æ ‡è¯†ç¬¦å°±å¯ä»¥ç²¾å‡†çš„æ‰¾åˆ°æˆ‘ä»¬çš„å®¶åº­ä½å€ï¼Œè€Œæ¯ä¸€ä¸ªipåœ°å€å°±æ˜¯è¿™æ ·çš„ä¸€ä¸ªé—¨ç‰Œå·ï¼Œæ¯”å¦‚`baidu.com`è¿™ä¸ªä¸æ˜¯ä¸€ä¸ªé—¨ç‰Œå·ï¼Œè¿™ä¸ªå¯ä»¥ç†è§£ä¸ºç™¾åº¦çš„å®¶ï¼Œä½ å‘Šè¯‰æµè§ˆå™¨ä½ è¦å»ç™¾åº¦çš„å®¶ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå¼€å§‹è¿›è¡ŒDNSè§£æä»–ä¼šè§£ææˆç™¾åº¦çš„é—¨ç‰Œå·ï¼Œç„¶åæ‰¾åˆ°ç™¾åº¦çš„å®¶ã€‚\n\n### ç¼“å­˜\n\nè¿™é‡Œé¢åˆä¼šæ¶‰åŠåˆ°ç¼“å­˜çš„æ¦‚å¿µï¼Œä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ\n\nå°±æ˜¯ä¹‹å‰æˆ‘æŸ¥è¿‡ç™¾åº¦çš„å®¶äº†ï¼Œå·²ç»è®°å½•ä¸‹æ¥ç™¾åº¦çš„å®¶çš„é—¨ç‰Œå·äº†ï¼Œå°±ä¸éœ€è¦é‡æ–°çš„è¿›è¡Œè§£æäº†ï¼Œç›´æ¥è¯»å–å°±å¥½äº†ï¼ŒèŠ‚çº¦æ—¶é—´ã€‚\n\n\n\nè¿™é‡Œé¢æ¶‰åŠçš„çŸ¥è¯†å¤ªå¤šäº†ï¼Œä¸åœ¨è¿™æ¬¡çš„è®¨è®ºèŒƒå›´å†…ã€‚æ‰€ä»¥åªç®€å•çš„è¯´ä¸€ä¸‹ã€‚\n\n![demo1](/image/åœ°å€æ /dns.png)\n\n\n\nä¸Šå›¾å…¶å®å¾ˆå¥½çš„è§£ç­”äº†DNSçš„æ•´ä¸ªè§£æè¿‡ç¨‹ã€‚\n\n1. ä»æµè§ˆå™¨è·å–ç¼“å­˜ç»“æœã€‚\n2. å¦‚æœæµè§ˆå™¨æ²¡æœ‰ç¼“å­˜å°±ä»æœ¬åœ°ç³»ç»Ÿçš„ç¼“å­˜ä¸­è¯»å–ï¼Œæ¯”å¦‚hostæ–‡ä»¶ç­‰ç­‰ï¼Œåƒæˆ‘ä»¬å¹³å¸¸ä¸ŠGitHubå¦‚æœæ…¢çš„è¯æˆ‘ä»¬éƒ½ä¼šä¿®æ”¹hostæ–‡ä»¶ï¼Œç»™ä»–é…ä¸€ä¸ªå¿«ä¸€ç‚¹çš„ipä¹‹ç±»çš„ç­‰ç­‰ã€‚\n3. ç„¶åæ˜¯å›¾é‡Œé¢æ²¡æœ‰æåˆ°çš„è·¯ç”±å™¨ç¼“å­˜ï¼Œä¸€èˆ¬çš„è·¯ç”±å™¨ä¹Ÿä¼šæœ‰è‡ªå·±çš„ç¼“å­˜ã€‚\n4. è·¯ç”±å™¨ä¹Ÿæ‰¾ä¸åˆ°åªèƒ½å¼€å§‹è§£æäº†ã€‚æœ¬åœ°åŸŸåæœåŠ¡å™¨ä¼šå‘æ ¹åŸŸåæœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œ å¦‚æœæ ¹åŸŸåæœåŠ¡å™¨ä¹Ÿä¸å­˜åœ¨è¯¥åŸŸåæ—¶ï¼Œ æœ¬åœ°åŸŸåä¼šå‘comé¡¶çº§åŸŸåæœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œ ä¾æ¬¡ç±»æ¨ä¸‹å»ã€‚ ç›´åˆ°æœ€åæ‰¾åˆ°ç›®æ ‡ç½‘å€æ‰€å¯¹åº”çš„ IPï¼Œ å¹¶å°†å…¶ç¼“å­˜åˆ°æœ¬åœ°ï¼Œ ä»¥ä¾›ä¸‹æ¬¡ä½¿ç”¨ã€‚\n\n\n\n### DNSé‡å®šå‘\n\nè¿™é‡Œé¡ºä¾¿è¯´ä¸€ä¸‹DNSçš„é‡å®šå‘å§\n\n> DNSæ¯æ¬¡è¿”å›çš„ipåœ°å€å¯èƒ½ä¼šä¸ä¸€æ ·ï¼Œå› ä¸ºä¸–ç•Œä¸Šä¸æ˜¯åªæœ‰ä¸€ä¸ªæœºå™¨å¯ä»¥å¤„ç†\"baidu.com\"çš„è¿™ä¸ªè¯·æ±‚ï¼Œæœ‰å¾ˆå¤šæœºå™¨å¯ä»¥å¤„ç†ï¼ŒDNSåªéœ€è¦è¿”å›å¯ä»¥å¤„ç†çš„æœºå™¨çš„ipåœ°å€å°±å¯ä»¥äº†ã€‚ä¾‹å¦‚å¯ä»¥æ ¹æ®æ¯å°æœºå™¨çš„è´Ÿè½½é‡ï¼Œ è¯¥æœºå™¨ç¦»ç”¨æˆ·åœ°ç†ä½ç½®çš„è·ç¦»ç­‰ç­‰ï¼Œ è¿™ç§è¿‡ç¨‹å°±æ˜¯DNSè´Ÿè½½å‡è¡¡ï¼Œ åˆå«åšDNSé‡å®šå‘ã€‚\n\nå¾ˆç®€å•ï¼Œå‡ ä¸ªä¾‹å­ï¼Œæ¯”å¦‚æˆ‘åœ¨æ•…å®«çš„åŒ—é—¨ï¼Œæ‰“å¼€åœ°å›¾è¦æŸ¥è¯¢æ•…å®«è‚¯å®šä¼šè®©æˆ‘ä»åŒ—é—¨è¿›å»ã€‚è€Œå¦‚æœæˆ‘åœ¨æ•…å®«çš„å—é—¨ï¼Œè¦å¯¼èˆªåˆ°æ•…å®«å°±ä¼šè®©æˆ‘ä»å—é—¨è¿›å»ã€‚\n\n### DNSæ±¡æŸ“\n\nDNS æ±¡æŸ“ï¼ˆDNS cache pollutionï¼‰ï¼Œ åˆç§°åŸŸåæœåŠ¡å™¨ç¼“å­˜æŠ•æ¯’ï¼ˆDNS cache poisoningï¼‰ï¼Œ æ˜¯æŒ‡ä¸€äº›åˆ»æ„åˆ¶é€ æˆ–æ— æ„ä¸­åˆ¶é€ å‡ºæ¥çš„åŸŸåæœåŠ¡å™¨æ•°æ®åŒ…ï¼Œ æŠŠåŸŸåæŒ‡å¾€**ä¸æ­£ç¡®çš„IPåœ°å€**ã€‚\n\næŸäº›ç½‘ç»œè¿è¥å•†ä¸ºäº†æŸäº›ç›®çš„ï¼Œ å¯¹DNSè¿›è¡Œäº†æŸäº›æ“ä½œï¼Œ å¯¼è‡´ä¸Šç½‘çš„ç”¨æˆ·æ— æ³•é€šè¿‡åŸŸåå–å¾—æ­£ç¡®çš„IPåœ°å€ã€‚ æŸäº›å›½å®¶æˆ–åœ°åŒºå‡ºäºæŸäº›ç›®çš„ä¸ºäº†é˜²æ­¢æŸç½‘ç«™è¢«è®¿é—®ï¼Œ è€Œä¸”å…¶åˆæŒæ¡éƒ¨åˆ†å›½é™…DNSæ ¹ç›®å½•æœåŠ¡å™¨æˆ–é•œåƒï¼Œ ä¹Ÿä¼šåˆ©ç”¨æ­¤æ–¹æ³•è¿›è¡Œå±è”½ã€‚ ï¼ˆGoogleã€ Facebookç­‰ï¼‰\n\nè‡³äºå¦‚æœé˜²æ­¢DNSæ±¡æŸ“ï¼Œ è¿™é‡Œåªè¯´ä¸€ä¸ªæ–¹æ³•å°±æ˜¯ä¿®æ”¹hostsæ–‡ä»¶ï¼Œ å…¶ä»–çš„è‡ªè¡Œæœç´¢å§ã€‚\n\n\n\n## TCPå»ºç«‹è¿æ¥\n\nå…¶å®æˆ‘ä»¬è§£æä¹‹åï¼Œæ‰¾åˆ°çœŸæ­£çš„æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å°±éœ€è¦è·å–ä»–çš„èµ„æºï¼Œæœ€ç®€å•çš„å°±æ˜¯è·å–ä»–çš„HTMLæ–‡ä»¶ï¼Œæ¥æ¸²æŸ“å¯¹å§ï¼Ÿæ€ä¹ˆè·å–å‘¢ï¼Œæˆ‘ä»¬éœ€è¦TCPè¿æ¥æ¥è·å–ã€‚\n\nè¿™é‡Œæ¶‰åŠåˆ°ä¸‰æ¬¡æ¡æ‰‹ï¼Œå’Œå››æ¬¡æŒ¥æ‰‹ä»¥åŠUDPçš„ä¸€äº›ç»†ä¸€ç‚¹çš„çŸ¥è¯†ç‚¹ã€‚\n\nè¯´TCPä¹‹å‰æˆ‘æƒ³æŠŠä¸€äº›é‡Œé¢å¯èƒ½ç”¨åˆ°çš„ä¸œè¥¿å…ˆè¯´è¯´æ¸…æ¥šï¼Œæ–¹ä¾¿æŸ¥æ‰¾ã€‚\n\n> ä½ç å³tcpæ ‡å¿—ä½ï¼Œæœ‰6ç§æ ‡ç¤ºï¼šSYN(synchronouså»ºç«‹è”æœº) ACK(acknowledgement ç¡®è®¤) PSH(pushä¼ é€) FIN(finishç»“æŸ) RST(reseté‡ç½®) URG(urgentç´§æ€¥)Sequence number(é¡ºåºå·ç ) Acknowledge number(ç¡®è®¤å·ç )\n\n### ä¸‰æ¬¡æ¡æ‰‹\n\n![demo2](/image/åœ°å€æ /woshou.png)\n\n\n\nä¸‰æ¬¡æ¡æ‰‹åŸºæœ¬ä¸Šå°±æ˜¯ğŸ‘†çš„å›¾ç‰‡äº†ï¼Œé‡Œé¢çš„ä½ç åœ¨ä¹‹å‰ä¹Ÿæœ‰è§£é‡Šã€‚\n\nè¿™é‡Œé‡ç‚¹è¯´ä¸€ä¸‹ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹ğŸ¤ï¼Œè€Œä¸æ˜¯ä¸¤æ¬¡æˆ–è€…å››æ¬¡ã€‚\n\nAåœ¨è¡—ä¸Šçœ‹è§äº†éš”äº†100ç±³çš„Bï¼Œï¼ˆæ­£å¸¸æƒ…å†µä¸‹å¦‚æœé¢å¯¹é¢äº¤æµæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯è¡—ä¸Šå¾ˆåµï¼Œå„ç§è½¦é¸£å£°ï¼Œåº—é“ºå¹¿å‘Šå£°ä¹‹ç±»çš„ã€‚ï¼‰æ‰€ä»¥Aæƒ³å’ŒBè¿›è¡Œå¯¹è¯ï¼Œï¼ˆåˆ«é—®é¢˜ä¸ºä»€ä¹ˆä¸æ‰“ç”µè¯ï¼ŒèŠ‚çº¦é’±ï¼ï¼‰\n\nAå–Šäº†Bä¸€å£°ï¼Œä¸çŸ¥é“Bå¬ä¸å¬å¾—è§ï¼Œæ‰€ä»¥åªèƒ½åœ¨è¿œå¤„ç­‰Bçš„å›åº”ã€‚\n\nBå¬è§äº†ï¼Œä¹Ÿå›åº”äº†Aï¼Œä½†æ˜¯ä»–ä¸çŸ¥é“Aèƒ½ä¸èƒ½å¬è§æ‰€ä»¥ä¹Ÿè¦ç­‰Aå›åº”ã€‚\n\nç„¶åAç»™å‡ºäº†å›åº”ï¼Œä¹‹åAå’ŒBå°±å¿«ä¹çš„äº¤æµèµ·æ¥ã€‚\n\nokï¼Œæˆ‘ä»¬å†æ¦‚æ‹¬ä¸€ä¸‹ã€‚\n\nå¯¹åº”åˆ°ä¸‰æ¬¡æ¡æ‰‹å°±æ˜¯A -> clientï¼›B->server\n\n1. ç¬¬ä¸€æ¬¡ğŸ¤ï¼ˆAå–ŠBï¼‰æ˜¯ä¸ºäº†ç¡®è®¤ä¸€ä¸‹Bèƒ½ä¸èƒ½å¬è§ï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯è¦ç¡®è®¤æœåŠ¡ç«¯çš„æ¥å—åŠŸèƒ½æ­£ä¸æ­£å¸¸\n2. ç¬¬äºŒæ¬¡ğŸ¤ï¼ˆBå–ŠAï¼‰æ˜¯å‘Šè¯‰Aï¼Œæˆ‘èƒ½å¬è§ï¼Œç°åœ¨æˆ‘ç°åœ¨çŸ¥é“ä½ èƒ½ä¸èƒ½å¬è§ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡ç«¯å‘Šè¯‰å®¢æˆ·ç«¯æˆ‘æ¥å—åŠŸèƒ½æ­£å¸¸ï¼Œç°åœ¨æˆ‘æƒ³çŸ¥é“ä½ æ¥æ”¶åŠŸèƒ½æ­£ä¸æ­£å¸¸ã€‚\n3. ç¬¬ä¸‰æ¬¡ğŸ¤ï¼ˆAå–ŠBï¼‰æ˜¯ä¸ºäº†å‘Šè¯‰Bæˆ‘å¬è§äº†ï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯è®©æœåŠ¡ç«¯çŸ¥é“å®¢æˆ·ç«¯çš„æ¥æ”¶åŠŸèƒ½æ­£å¸¸ï¼Œå¹¶ä¸”å¯ä»¥å¼€å§‹ä¼ è¾“ã€‚\n\nä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œå› ä¸ºåªæœ‰è¿™ä¸‰æ¬¡å¯ä»¥å®Œç¾çš„ç¡®è®¤åŒæ–¹çš„æ¥æ”¶å’Œå‘é€åŠŸèƒ½æ­£å¸¸ã€‚\n\nä¸ºä»€ä¹ˆä¸æ˜¯ä¸¤æ¬¡æ¡æ‰‹ï¼ŸæŒ‰ç…§ä¸Šé¢çš„è¯´æ³•ï¼ŒBç›´æ¥å¼€å§‹å‘é€æ•°æ®ï¼Œå¯æ˜¯ä»–æ ¹æœ¬ä¸çŸ¥é“Aèƒ½ä¸èƒ½æ¥æ”¶å•Šï¼Œå‘å‡ºå»å²‚ä¸æ˜¯æµªè´¹äº†ï¼Œå¯¹å§ï¼Ÿä¸‡ä¸€Aä¸èƒ½æ¥æ”¶å‘¢ï¼Ÿæ‰€ä»¥åªèƒ½ç­‰å¾…Açš„å›åº”\n\nä¸ºä»€ä¹ˆä¸æ˜¯å››æ¬¡æ¡æ‰‹ï¼Ÿå› ä¸ºä¸‰æ¬¡å°±å·²ç»å®Œæˆäº†ä»–ä»¬äº’ç›¸æƒ³çŸ¥é“çš„ä¿¡æ¯ä¸éœ€è¦ç»§ç»­æµªè´¹èµ„æºäº†ï¼Œèµ¶ç´§å¼€å§‹é€šä¿¡å§ï¼\n\n### å››æ¬¡æŒ¥æ‰‹\n\nå››æ¬¡æŒ¥æ‰‹å…¶å®åé¢æ‰ä¼šè®²åˆ°ï¼Œä½†æ˜¯å› ä¸ºçŸ¥è¯†ç‚¹æ˜¯ä¸€èµ·çš„ï¼Œæ‰€ä»¥å°±æ”¾åœ¨ä¸€èµ·è®²äº†\n\nè€è§„çŸ©ï¼Œçœ‹å›¾å’Œä¸Šé¢çš„ä½ç æ„æ€ï¼Œå°±ä¸å¤šè§£é‡Šäº†ã€‚\n\n![demo3](/image/åœ°å€æ /huishou.png)\n\n\n\nè¿™é‡Œé‡ç‚¹è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆæ˜¯å››æ¬¡æŒ¥æ‰‹ğŸ‘‹\n\nçœ‹å›¾æˆ‘ä»¬å¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹åˆ°å…¶å®å°±å¤šäº†ä¸€æ¬¡æœåŠ¡ç«¯å‘Šè¯‰å®¢æˆ·ç«¯è¦ç»ˆæ­¢çš„æ¶ˆæ¯ã€‚\n\nè¿˜æ˜¯ä¸¾åˆšåˆšAå’ŒBçš„ä¾‹å­å§ã€‚\n\nAè§‰å¾—å’ŒBèŠçš„å·®ä¸å¤šäº†ï¼Œæƒ³ç»“æŸå¯¹è¯ï¼Œå› ä¸ºå¤©è‰²å¾ˆæ™šäº†è¦å›å®¶åƒé¥­ğŸšäº†ã€‚\n\næ‰€ä»¥Aå‘Šè¯‰Bï¼Œæˆ‘æƒ³èµ°äº†ï¼Œä¸æƒ³èŠäº†ã€‚\n\nBæ”¶åˆ°åå‘Šè¯‰Aï¼Œå¥½çš„ï¼Œæˆ‘çŸ¥é“äº†ï¼Œä½†æ˜¯ä½ ç­‰æˆ‘ä¸€ä¸‹ï¼Œæˆ‘æ’’æ³¡å°¿ï¼Œæ’’å®Œä¸€èµ·èµ°ã€‚\n\nBæ’’å®Œå°¿ä¹‹åï¼Œå‘Šè¯‰Aæˆ‘æ’’å®Œå°¿äº†ã€‚\n\nAæ”¶åˆ°ä¸¤å¥è¯ï¼ˆ1.Bå¬åˆ°ğŸ‘‚Aæƒ³å›å®¶çš„æ¶ˆæ¯ï¼Œ2.Bæ’’å®Œå°¿ä¹‹åçš„ä¸€å¥è¯ï¼‰åï¼Œå‘Šè¯‰Bï¼Œæˆ‘èµ°äº†ã€‚\n\nBå¬åˆ°åä¹Ÿå›å®¶äº†ã€‚\n\nokï¼Œæˆ‘ä»¬å†æ¦‚æ‹¬ä¸€ä¸‹ã€‚\n\nå¯¹åº”åˆ°ä¸‰æ¬¡æ¡æ‰‹å°±æ˜¯A -> clientï¼›B->server\n\n1. ç¬¬ä¸€æ¬¡ğŸ‘‹ Aå‘Šè¯‰Bæˆ‘æƒ³å›å®¶åƒé¥­äº†ã€‚ä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯å‘Šè¯‰æœåŠ¡ç«¯ï¼Œæƒ³æ–­å¼€è¿æ¥äº†ã€‚\n2. ç¬¬äºŒæ¬¡ğŸ‘‹Bå‘Šè¯‰Aæˆ‘æ”¶åˆ°ä½ çš„æ¶ˆæ¯äº†ï¼Œä¸è¿‡æˆ‘å°¿æ‹‰å®Œå°±ä¸€èµ·å›å®¶å§ã€‚ä¹Ÿå°±æ˜¯æœåŠ¡ç«¯å‘Šè¯‰å®¢æˆ·ç«¯æˆ‘æ”¶åˆ°ä½ çš„æ¶ˆæ¯äº†ï¼Œä½†æ˜¯æˆ‘è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæ–‡ä»¶æ²¡æœ‰ä¼ è¾“å®Œï¼Œæå®šäº†å°±å…³é—­é“¾æ¥ã€‚\n3. ç¬¬ä¸‰æ¬¡ğŸ‘‹Bå‘Šè¯‰Aæˆ‘æ’’å®Œå°¿äº†ã€‚ä¹Ÿå°±æ˜¯æœåŠ¡ç«¯å‘Šè¯‰å®¢æˆ·ç«¯æˆ‘æ–‡ä»¶ä¼ è¾“å®Œäº†ï¼Œå¯ä»¥å…³é—­é“¾æ¥äº†ã€‚\n4. ç¬¬å››æ¬¡ğŸ‘‹Aå‘Šè¯‰Bä½ çš„ä¸¤å¥è¯éƒ½å¬åˆ°äº†ï¼ˆ1.Bå¬åˆ°äº†Aæƒ³å›å®¶çš„æ¶ˆæ¯ï¼Œ2.Bæ’’å®Œå°¿äº†ï¼‰ã€‚ä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯å‘Šè¯‰æœåŠ¡ç«¯æˆ‘å…³é—­é“¾æ¥äº†ï¼Œä½ ä¹Ÿåˆ«å‘äº†ã€‚\n\nåŒæ–¹ç»“æŸé“¾æ¥ã€‚\n\nç›¸æ¯”äºä¸‰æ¬¡æ¡æ‰‹ï¼Œå¤šå‡ºæ¥çš„é‚£ä¸€æ¬¡å›æ”¶å°±æ˜¯æœåŠ¡ç«¯éœ€è¦æœ‰ä¸€ä¸ªå…³é—­ä¼ è¾“çš„è¿™ä¹ˆä¸€ä¸ªè¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½éœ€è¦æ—¶é—´ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯éœ€è¦ç­‰å¾…ä¼ è¾“ã€‚\n\n### UDP\n\nè¿™é‡Œè™½ç„¶ä¸åœ¨èŒƒå›´å†…ï¼Œä½†æ˜¯æˆ‘æƒ³è®²éƒ½è®²äº†ï¼Œé¡ºä¾¿å§UDPä¸€èµ·è¯´å§ï¼\n\nUDPåè®®å…¨ç§°æ˜¯ç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼Œåœ¨ç½‘ç»œä¸­å®ƒä¸TCPåè®®ä¸€æ ·ç”¨äºå¤„ç†æ•°æ®åŒ…ï¼Œæ˜¯ä¸€ç§æ— è¿æ¥çš„åè®®ã€‚åœ¨OSIæ¨¡å‹ä¸­ï¼Œåœ¨ç¬¬å››å±‚â€”â€”ä¼ è¾“å±‚ï¼Œå¤„äºIPåè®®çš„ä¸Šä¸€å±‚ã€‚UDPæœ‰ä¸æä¾›æ•°æ®åŒ…åˆ†ç»„ã€ç»„è£…å’Œä¸èƒ½å¯¹æ•°æ®åŒ…è¿›è¡Œæ’åºçš„ç¼ºç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æŠ¥æ–‡å‘é€ä¹‹åï¼Œæ˜¯æ— æ³•å¾—çŸ¥å…¶æ˜¯å¦å®‰å…¨å®Œæ•´åˆ°è¾¾çš„ã€‚\n\nå®ƒæœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š\n\n#### 1.é¢å‘æ— è¿æ¥\n\né¦–å…ˆ UDP æ˜¯ä¸éœ€è¦å’Œ TCPä¸€æ ·åœ¨å‘é€æ•°æ®å‰è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥çš„ï¼Œæƒ³å‘æ•°æ®å°±å¯ä»¥å¼€å§‹å‘é€äº†ã€‚å¹¶ä¸”ä¹Ÿåªæ˜¯æ•°æ®æŠ¥æ–‡çš„æ¬è¿å·¥ï¼Œä¸ä¼šå¯¹æ•°æ®æŠ¥æ–‡è¿›è¡Œä»»ä½•æ‹†åˆ†å’Œæ‹¼æ¥æ“ä½œã€‚\n\nå…·ä½“æ¥è¯´å°±æ˜¯ï¼š\n\n- åœ¨å‘é€ç«¯ï¼Œåº”ç”¨å±‚å°†æ•°æ®ä¼ é€’ç»™ä¼ è¾“å±‚çš„ UDP åè®®ï¼ŒUDP åªä¼šç»™æ•°æ®å¢åŠ ä¸€ä¸ª UDP å¤´æ ‡è¯†ä¸‹æ˜¯ UDP åè®®ï¼Œç„¶åå°±ä¼ é€’ç»™ç½‘ç»œå±‚äº†\n- åœ¨æ¥æ”¶ç«¯ï¼Œç½‘ç»œå±‚å°†æ•°æ®ä¼ é€’ç»™ä¼ è¾“å±‚ï¼ŒUDP åªå»é™¤ IP æŠ¥æ–‡å¤´å°±ä¼ é€’ç»™åº”ç”¨å±‚ï¼Œä¸ä¼šä»»ä½•æ‹¼æ¥æ“ä½œ\n\n#### 2.æœ‰å•æ’­ï¼Œå¤šæ’­ï¼Œå¹¿æ’­çš„åŠŸèƒ½\n\nUDP ä¸æ­¢æ”¯æŒä¸€å¯¹ä¸€çš„ä¼ è¾“æ–¹å¼ï¼ŒåŒæ ·æ”¯æŒä¸€å¯¹å¤šï¼Œå¤šå¯¹å¤šï¼Œå¤šå¯¹ä¸€çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯è¯´ UDP æä¾›äº†å•æ’­ï¼Œå¤šæ’­ï¼Œå¹¿æ’­çš„åŠŸèƒ½ã€‚\n\n#### 3.UDPæ˜¯é¢å‘æŠ¥æ–‡çš„\n\nå‘é€æ–¹çš„UDPå¯¹åº”ç”¨ç¨‹åºäº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œåœ¨æ·»åŠ é¦–éƒ¨åå°±å‘ä¸‹äº¤ä»˜IPå±‚ã€‚UDPå¯¹åº”ç”¨å±‚äº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œæ—¢ä¸åˆå¹¶ï¼Œä¹Ÿä¸æ‹†åˆ†ï¼Œè€Œæ˜¯ä¿ç•™è¿™äº›æŠ¥æ–‡çš„è¾¹ç•Œã€‚å› æ­¤ï¼Œåº”ç”¨ç¨‹åºå¿…é¡»é€‰æ‹©åˆé€‚å¤§å°çš„æŠ¥æ–‡\n\n#### 4.ä¸å¯é æ€§\n\né¦–å…ˆä¸å¯é æ€§ä½“ç°åœ¨æ— è¿æ¥ä¸Šï¼Œé€šä¿¡éƒ½ä¸éœ€è¦å»ºç«‹è¿æ¥ï¼Œæƒ³å‘å°±å‘ï¼Œè¿™æ ·çš„æƒ…å†µè‚¯å®šä¸å¯é ã€‚\n\nå¹¶ä¸”æ”¶åˆ°ä»€ä¹ˆæ•°æ®å°±ä¼ é€’ä»€ä¹ˆæ•°æ®ï¼Œå¹¶ä¸”ä¹Ÿä¸ä¼šå¤‡ä»½æ•°æ®ï¼Œå‘é€æ•°æ®ä¹Ÿä¸ä¼šå…³å¿ƒå¯¹æ–¹æ˜¯å¦å·²ç»æ­£ç¡®æ¥æ”¶åˆ°æ•°æ®äº†ã€‚\n\nå†è€…ç½‘ç»œç¯å¢ƒæ—¶å¥½æ—¶åï¼Œä½†æ˜¯ UDP å› ä¸ºæ²¡æœ‰æ‹¥å¡æ§åˆ¶ï¼Œä¸€ç›´ä¼šä»¥æ’å®šçš„é€Ÿåº¦å‘é€æ•°æ®ã€‚å³ä½¿ç½‘ç»œæ¡ä»¶ä¸å¥½ï¼Œä¹Ÿä¸ä¼šå¯¹å‘é€é€Ÿç‡è¿›è¡Œè°ƒæ•´ã€‚è¿™æ ·å®ç°çš„å¼Šç«¯å°±æ˜¯åœ¨ç½‘ç»œæ¡ä»¶ä¸å¥½çš„æƒ…å†µä¸‹å¯èƒ½ä¼šå¯¼è‡´ä¸¢åŒ…ï¼Œä½†æ˜¯ä¼˜ç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œåœ¨æŸäº›å®æ—¶æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼ˆæ¯”å¦‚ç”µè¯ä¼šè®®ï¼‰å°±éœ€è¦ä½¿ç”¨ UDP è€Œä¸æ˜¯ TCPã€‚\n\nUDPåªæƒ³æŠŠæ•°æ®å‘å‡ºå»ï¼Œå…·ä½“æœ‰æ²¡æœ‰æˆåŠŸä»–ä¸å…³å¿ƒ\n\n#### 5.å¤´éƒ¨å¼€é”€å°ï¼Œä¼ è¾“æ•°æ®æŠ¥æ–‡æ—¶æ˜¯å¾ˆé«˜æ•ˆçš„ã€‚\n\nUDP å¤´éƒ¨åŒ…å«äº†ä»¥ä¸‹å‡ ä¸ªæ•°æ®ï¼š\n\n- ä¸¤ä¸ªåå…­ä½çš„ç«¯å£å·ï¼Œåˆ†åˆ«ä¸ºæºç«¯å£ï¼ˆå¯é€‰å­—æ®µï¼‰å’Œç›®æ ‡ç«¯å£\n- æ•´ä¸ªæ•°æ®æŠ¥æ–‡çš„é•¿åº¦\n- æ•´ä¸ªæ•°æ®æŠ¥æ–‡çš„æ£€éªŒå’Œï¼ˆIPv4 å¯é€‰ å­—æ®µï¼‰ï¼Œè¯¥å­—æ®µç”¨äºå‘ç°å¤´éƒ¨ä¿¡æ¯å’Œæ•°æ®ä¸­çš„é”™è¯¯\n\nå› æ­¤ UDP çš„å¤´éƒ¨å¼€é”€å°ï¼Œåªæœ‰å…«å­—èŠ‚ï¼Œç›¸æ¯” TCP çš„è‡³å°‘äºŒåå­—èŠ‚è¦å°‘å¾—å¤šï¼Œåœ¨ä¼ è¾“æ•°æ®æŠ¥æ–‡æ—¶æ˜¯å¾ˆé«˜æ•ˆçš„\n\n#### 6.æ€»ç»“\n\n\n\n|              | UDP                                        | TCP                                    |\n| ------------ | ------------------------------------------ | -------------------------------------- |\n| æ˜¯å¦è¿æ¥     | æ— è¿æ¥                                     | é¢å‘è¿æ¥                               |\n| æ˜¯å¦å¯é      | ä¸å¯é ä¼ è¾“ï¼Œä¸ä½¿ç”¨æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶       | å¯é ä¼ è¾“ï¼Œä½¿ç”¨æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶       |\n| è¿æ¥å¯¹è±¡ä¸ªæ•° | æ”¯æŒä¸€å¯¹ä¸€ï¼Œä¸€å¯¹å¤šï¼Œå¤šå¯¹ä¸€å’Œå¤šå¯¹å¤šäº¤äº’é€šä¿¡ | åªèƒ½æ˜¯ä¸€å¯¹ä¸€é€šä¿¡                       |\n| ä¼ è¾“æ–¹å¼     | é¢å‘æŠ¥æ–‡                                   | é¢å‘å­—èŠ‚æµ                             |\n| é¦–éƒ¨å¼€é”€     | é¦–éƒ¨å¼€é”€å°ï¼Œä»…8å­—èŠ‚                        | é¦–éƒ¨æœ€å°20å­—èŠ‚ï¼Œæœ€å¤§60å­—èŠ‚             |\n| é€‚ç”¨åœºæ™¯     | é€‚ç”¨äºå®æ—¶åº”ç”¨ï¼ˆIPç”µè¯ã€è§†é¢‘ä¼šè®®ã€ç›´æ’­ç­‰ï¼‰ | é€‚ç”¨äºè¦æ±‚å¯é ä¼ è¾“çš„åº”ç”¨ï¼Œä¾‹å¦‚æ–‡ä»¶ä¼ è¾“ |\n\n## SSL/TLSåŠ å¯†\n\nåœ¨HTTPè¯·æ±‚ä¹‹å‰ï¼Œå¦‚æœæœ‰åŠ å¯†çš„ï¼ˆå°±æ˜¯HTTPSï¼‰ï¼Œéœ€è¦å…ˆç¡®è®¤ä¸€ä¸‹åŒæ–¹æ˜¯å¦æ˜¯è‡ªå·±æƒ³è¦æ‰¾çš„é‚£ä¸ªäººã€‚\n\næ€ä¹ˆçŸ¥é“é‚£ä¸ªä»–æ˜¯ä¸æ˜¯è‡ªå·±è¦æ‰¾çš„äººå‘¢ï¼Ÿæœ‰ä¸¤ç§æ–¹æ³•ï¼šå¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†\n\n### å¯¹ç§°åŠ å¯†\n\nå¯¹ç§°åŠ å¯†å…¶å®å°±æ˜¯Aå’ŒBéƒ½æœ‰ä¸€ä¸ªè§£å¯†çš„è§„åˆ™ï¼ŒåŒæ–¹éƒ½å¿ƒçŸ¥è‚šæ˜ã€‚è¿™æ ·å°±å¯ä»¥è§£å¯†ã€‚\n\nå¯¹ç§°åŠ å¯†çš„ä¸€å¤§ç¼ºç‚¹æ˜¯å¯†é’¥çš„ç®¡ç†ä¸åˆ†é…ï¼Œæ¢å¥è¯è¯´ï¼Œå¦‚ä½•æŠŠå¯†é’¥å‘é€åˆ°éœ€è¦è§£å¯†ä½ çš„æ¶ˆæ¯çš„äººçš„æ‰‹é‡Œæ˜¯ä¸€ä¸ªé—®é¢˜ã€‚åœ¨å‘é€å¯†é’¥çš„è¿‡ç¨‹ä¸­ï¼Œå¯†é’¥æœ‰å¾ˆå¤§çš„é£é™©ä¼šè¢«é»‘å®¢ä»¬æ‹¦æˆªã€‚ç°å®ä¸­é€šå¸¸çš„åšæ³•æ˜¯å°†å¯¹ç§°åŠ å¯†çš„å¯†é’¥è¿›è¡Œéå¯¹ç§°åŠ å¯†ï¼Œç„¶åä¼ é€ç»™éœ€è¦å®ƒçš„äººã€‚\n\n### éå¯¹ç§°åŠ å¯†\n\né‚£ä¹ˆä»€ä¹ˆæ˜¯éå¯¹ç§°åŠ å¯†å‘¢ï¼Ÿ\n\néå¯¹ç§°åŠ å¯†ä¸ºæ•°æ®çš„åŠ å¯†ä¸è§£å¯†æä¾›äº†ä¸€ä¸ªéå¸¸å®‰å…¨çš„æ–¹æ³•ï¼Œå®ƒä½¿ç”¨äº†ä¸€å¯¹å¯†é’¥ï¼Œå…¬é’¥ï¼ˆpublic keyï¼‰å’Œç§é’¥ï¼ˆprivate keyï¼‰ã€‚ç§é’¥åªèƒ½ç”±ä¸€æ–¹å®‰å…¨ä¿ç®¡ï¼Œä¸èƒ½å¤–æ³„ï¼Œè€Œå…¬é’¥åˆ™å¯ä»¥å‘ç»™ä»»ä½•è¯·æ±‚å®ƒçš„äººã€‚éå¯¹ç§°åŠ å¯†ä½¿ç”¨è¿™å¯¹å¯†é’¥ä¸­çš„ä¸€ä¸ªè¿›è¡ŒåŠ å¯†ï¼Œè€Œè§£å¯†åˆ™éœ€è¦å¦ä¸€ä¸ªå¯†é’¥ã€‚æ¯”å¦‚ï¼Œä½ å‘é“¶è¡Œè¯·æ±‚å…¬é’¥ï¼Œé“¶è¡Œå°†å…¬é’¥å‘ç»™ä½ ï¼Œä½ ä½¿ç”¨å…¬é’¥å¯¹æ¶ˆæ¯åŠ å¯†ï¼Œé‚£ä¹ˆåªæœ‰ç§é’¥çš„æŒæœ‰äºº--é“¶è¡Œæ‰èƒ½å¯¹ä½ çš„æ¶ˆæ¯è§£å¯†ã€‚ä¸å¯¹ç§°åŠ å¯†ä¸åŒçš„æ˜¯ï¼Œé“¶è¡Œä¸éœ€è¦å°†ç§é’¥é€šè¿‡ç½‘ç»œå‘é€å‡ºå»ï¼Œå› æ­¤å®‰å…¨æ€§å¤§å¤§æé«˜ã€‚\n\n### æ€»ç»“\n\næ‰€ä»¥åŸºæœ¬ä¸Šéƒ½æ˜¯å…ˆç”¨éå¯¹ç§°åŠ å¯†ä¼ è¾“å¯¹ç§°åŠ å¯†çš„ç§˜é’¥ã€‚\n\n## HTTPè¯·æ±‚\n\nHTTPè¯·æ±‚å¾—åˆ°èµ„æºæ–‡ä»¶ï¼Œå¦‚æœæœ‰gzipå‹ç¼©çš„è¯è¿˜éœ€è¦è§£å‹ï¼Œç„¶åæ˜¯ä¸€äº›HTTPå°çš„é›¶ç¢çŸ¥è¯†ç‚¹ã€‚\n\n### HTTPæŠ¥æ–‡\n\nHTTP æŠ¥æ–‡æ˜¯ç”± è¯·æ±‚æŠ¥æ–‡+å“åº”æŠ¥æ–‡ å…±åŒç»„æˆ\n\n- è¯·æ±‚æŠ¥æ–‡ï¼š\n  - å®šä¹‰ï¼šæ‰€æœ‰ç»è¿‡ä¼ è¾“åè®®ï¼Œå®¢æˆ·ç«¯ä¼ é€’ç»™æœåŠ¡å™¨çš„å†…å®¹ï¼Œéƒ½è¢«æˆä¸ºè¯·æ±‚æŠ¥æ–‡\n  - åŒ…å«ï¼š\n    - èµ·å§‹è¡Œ\n    - è¯·æ±‚å¤´ï¼ˆè¯·æ±‚é¦–éƒ¨ï¼‰\n    - è¯·æ±‚ä¸»ä½“\n- å“åº”æŠ¥æ–‡ï¼š\n  - å®šä¹‰ï¼šæ‰€æœ‰ç»è¿‡ä¼ è¾“åè®®ï¼ŒæœåŠ¡å™¨è¿”å›ç»™å®¢æˆ·ç«¯çš„å†…å®¹ï¼Œéƒ½è¢«æˆä¸ºå“åº”æŠ¥æ–‡\n  - åŒ…å«ï¼š\n    - HTTPçŠ¶æ€ç \n    - å“åº”å¤´\n    - å“åº”ä¸»ä½“\n\n\n\n### HTTPçŠ¶æ€ç \n\n1~5å¼€å¤´ï¼Œä¸‰ä½æ•°å­—\n\n- 1 å¼€å¤´çš„ä»£è¡¨å¤„ç†ä¸­ï¼Œä¸€èˆ¬è§ä¸åˆ°\n- 2å¼€å¤´ï¼šéƒ½æ˜¯æˆåŠŸ\n  - 200ï¼šOKï¼šæˆåŠŸ\n  - 201ï¼šCREATEDï¼šä¸€èˆ¬åº”ç”¨äºå‘Šè¯‰æœåŠ¡å™¨åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œæœ€åæœåŠ¡å™¨åˆ›å»ºæˆåŠŸåè¿”å›çš„çŠ¶æ€ç \n  - 204ï¼šNO CONTENTï¼šå¯¹äºæŸäº›è¯·æ±‚ï¼ˆä¾‹å¦‚ï¼šPUTæˆ–è€…DELETEï¼‰ï¼ŒæœåŠ¡å™¨ä¸æƒ³å¤„ç†ï¼Œå¯ä»¥è¿”å›ç©ºå†…å®¹ï¼Œå¹¶ä¸”ç”¨204çŠ¶æ€ç å‘ŠçŸ¥\n- 3å¼€å¤´ï¼šä»£è¡¨æˆåŠŸï¼Œåªä¸è¿‡ä¸­é—´éœ€è¦ä¸­è½¬ä¸€ä¸‹\n  - 301ï¼šMoved Permanentlyï¼šæ°¸ä¹…é‡å®šå‘ï¼ˆæ°¸ä¹…è½¬ç§»ï¼‰\n  - 302ï¼šMoved Temporarilyï¼šä¸´æ—¶è½¬ç§»ï¼Œå¾ˆæ—©ä»¥å‰åŸºæœ¬ä¸Šç”¨302æ¥åšï¼Œä½†æ˜¯ç°åœ¨ä¸»è¦ç”¨307æ¥å¤„ç†è¿™ä¸ªäº‹æƒ…ï¼Œ\n  - 307çš„æ„æ€å°±æ˜¯ä¸´æ—¶é‡å®šå‘Temporary Redirect =>ä¸»è¦ç”¨äºï¼šæœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡ç­‰\n  - 304ï¼šNot Modifiedï¼šè®¾ç½®HTTPçš„åå•†ç¼“å­˜\n- 4å¼€å¤´ï¼šéƒ½æ˜¯å¤±è´¥\n  - 400ï¼šBad Requestï¼šä¼ é€’ç»™æœåŠ¡å™¨çš„å‚æ•°é”™è¯¯\n  - 401ï¼šUnauthorizedï¼šæ— æƒé™è®¿é—®\n  - 404ï¼šNot Foundï¼šè¯·æ±‚åœ°å€é”™è¯¯\n- 5å¼€å¤´ï¼šéƒ½æ˜¯å¤±è´¥\n  - 500ï¼šInternal Server Errorï¼šæœªçŸ¥æœåŠ¡å™¨é”™è¯¯\n  - 503ï¼šService Unavailableï¼šæœåŠ¡å™¨è¶…è´Ÿè·\n\n\n\n### HTTPè¯·æ±‚æ–¹å¼\n\nå…¶å®æ­£å¸¸ä¼šè¯´åˆ°ä»€ä¹ˆ`POST`, `GET`ä¹‹ç±»çš„ï¼Œä½†æ˜¯æˆ‘è¿™é‡Œæƒ³è¯´ä¸€ä¸‹corsé‡Œé¢çš„ä¸œè¥¿ã€‚\n\nè¿˜æ˜¯æœ¬ç€æ—¢ç„¶å­¦åˆ°è¿™é‡Œé¡ºè·¯æææ¸…æ¥š\n\næµè§ˆå™¨å°†CORSè¯·æ±‚åˆ†æˆä¸¤ç±»ï¼šç®€å•è¯·æ±‚ï¼ˆsimple requestï¼‰å’Œéç®€å•è¯·æ±‚ï¼ˆnot-so-simple requestï¼‰ã€‚\n\n#### ç®€å•è¯·æ±‚\n\nåªè¦åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤å¤§æ¡ä»¶ï¼Œå°±å±äºç®€å•è¯·æ±‚ã€‚\n\n> ï¼ˆ1) è¯·æ±‚æ–¹æ³•æ˜¯ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ä¹‹ä¸€ï¼š\n>\n> - HEAD\n> - GET\n> - POST\n>\n> ï¼ˆ2ï¼‰HTTPçš„å¤´ä¿¡æ¯ä¸è¶…å‡ºä»¥ä¸‹å‡ ç§å­—æ®µï¼š\n>\n> - Accept\n> - Accept-Language\n> - Content-Language\n> - Last-Event-ID\n> - Content-Typeï¼šåªé™äºä¸‰ä¸ªå€¼`application/x-www-form-urlencoded`ã€`multipart/form-data`ã€`text/plain`\n\n\n\n\n\n#### éç®€å•è¯·æ±‚\n\nå‡¡æ˜¯ä¸åŒæ—¶æ»¡è¶³ä¸Šé¢ä¸¤ä¸ªæ¡ä»¶ï¼Œå°±å±äºéç®€å•è¯·æ±‚ã€‚\n\néç®€å•è¯·æ±‚æ˜¯é‚£ç§å¯¹æœåŠ¡å™¨æœ‰ç‰¹æ®Šè¦æ±‚çš„è¯·æ±‚ï¼Œæ¯”å¦‚è¯·æ±‚æ–¹æ³•æ˜¯`PUT`æˆ–`DELETE`ï¼Œæˆ–è€…`Content-Type`å­—æ®µçš„ç±»å‹æ˜¯`application/json`ã€‚\n\néç®€å•è¯·æ±‚çš„CORSè¯·æ±‚ï¼Œä¼šåœ¨æ­£å¼é€šä¿¡ä¹‹å‰ï¼Œå¢åŠ ä¸€æ¬¡HTTPæŸ¥è¯¢è¯·æ±‚ï¼Œç§°ä¸º\"é¢„æ£€\"è¯·æ±‚ï¼ˆpreflightï¼‰ã€‚\n\næµè§ˆå™¨å…ˆè¯¢é—®æœåŠ¡å™¨ï¼Œå½“å‰ç½‘é¡µæ‰€åœ¨çš„åŸŸåæ˜¯å¦åœ¨æœåŠ¡å™¨çš„è®¸å¯åå•ä¹‹ä¸­ï¼Œä»¥åŠå¯ä»¥ä½¿ç”¨å“ªäº›HTTPåŠ¨è¯å’Œå¤´ä¿¡æ¯å­—æ®µã€‚åªæœ‰å¾—åˆ°è‚¯å®šç­”å¤ï¼Œæµè§ˆå™¨æ‰ä¼šå‘å‡ºæ­£å¼çš„`XMLHttpRequest`è¯·æ±‚ï¼Œå¦åˆ™å°±æŠ¥é”™ã€‚\n\nä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„è·¨åŸŸï¼Œè¿™ä¸ªé—®é¢˜å¯ä»¥äº¤ç”±åç«¯çš„åŒå­¦è®¾ç½®ç™½åå•æˆ–è€…è¿ç»´çš„åŒå­¦è®¾ç½®ã€‚\n\nå¦‚æœæ˜¯å‰ç«¯çš„åŒå­¦åšè¿™ç§è·¨åŸŸçš„é—®é¢˜çš„è¯ä¸å¤ªæ–¹ä¾¿\n\næ¯”å¦‚\n\n- **JSONP**\n\n- #### **document.domain + iframeè·¨åŸŸ**\n\n- ####  **location.hash + iframeè·¨åŸŸ**\n\n- ####  **window.name + iframeè·¨åŸŸ**\n\n- #### **postMessageè·¨åŸŸ**\n\nä½†æ˜¯åŸºæœ¬ä¸Šæˆ‘ä»¬å¸¸ç”¨çš„å°±æ˜¯`JSONP`\n\nå…·ä½“è¿™äº›æ–¹æ³•å’Œåœºæ™¯æœ‰æœºä¼šçš„è¯å…·ä½“è¯´ä¸€ä¸‹ã€‚\n\n## æ–­å¼€TCPè¿æ¥\n\nä¹Ÿå°±æ˜¯ä¹‹å‰çš„å››æ¬¡æŒ¥æ‰‹ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ä¸Šé¢çš„è¯´çš„å››æ¬¡æŒ¥æ‰‹\n\n## æµè§ˆå™¨æ¸²æŸ“é¡µé¢\n\næ–‡ä»¶è§£ç æˆåŠŸåä¼šæ­£å¼å¼€å§‹æ¸²æŸ“æµç¨‹ï¼Œå…ˆä¼šæ ¹æ® HTML æ„å»º DOM æ ‘ï¼Œæœ‰ CSS çš„è¯ä¼šå»æ„å»º CSSOM æ ‘ã€‚å¦‚æœé‡åˆ° script æ ‡ç­¾çš„è¯ï¼Œä¼šåˆ¤æ–­æ˜¯å¦å­˜åœ¨ async æˆ–è€… defer ï¼Œå‰è€…ä¼šå¹¶è¡Œè¿›è¡Œä¸‹è½½å¹¶æ‰§è¡Œ JSï¼Œåè€…ä¼šå…ˆä¸‹è½½æ–‡ä»¶ï¼Œç„¶åç­‰å¾… HTML è§£æå®Œæˆåé¡ºåºæ‰§è¡Œã€‚\n\nå¦‚æœä»¥ä¸Šéƒ½æ²¡æœ‰ï¼Œå°±ä¼šé˜»å¡ä½æ¸²æŸ“æµç¨‹ç›´åˆ° JS æ‰§è¡Œå®Œæ¯•ã€‚é‡åˆ°æ–‡ä»¶ä¸‹è½½çš„ä¼šå»ä¸‹è½½æ–‡ä»¶ï¼Œè¿™é‡Œå¦‚æœä½¿ç”¨ HTTP/2 åè®®çš„è¯ä¼šæå¤§çš„æé«˜å¤šå›¾çš„ä¸‹è½½æ•ˆç‡ã€‚\n\nCSSOM æ ‘å’Œ DOM æ ‘æ„å»ºå®Œæˆåä¼šå¼€å§‹ç”Ÿæˆ Render æ ‘ï¼Œè¿™ä¸€æ­¥å°±æ˜¯ç¡®å®šé¡µé¢å…ƒç´ çš„å¸ƒå±€ã€æ ·å¼ç­‰ç­‰è¯¸å¤šæ–¹é¢çš„ä¸œè¥¿\n\nåœ¨ç”Ÿæˆ Render æ ‘çš„è¿‡ç¨‹ä¸­ï¼Œæµè§ˆå™¨å°±å¼€å§‹è°ƒç”¨ GPU ç»˜åˆ¶ï¼Œåˆæˆå›¾å±‚ï¼Œå°†å†…å®¹æ˜¾ç¤ºåœ¨å±å¹•ä¸Šäº†ã€‚\n\n\n\n# æ€»ç»“\n\n1. URLè§£æ\n2. DNSè§£æ\n3. å»ºç«‹è¿æ¥\n4. å¦‚æœæœ‰åŠ å¯†çš„è¯è¦å…ˆè§£å¯†\n5. ç„¶åhttpè¯·æ±‚è·å–èµ„æº\n6. æ–­å¼€è¿æ¥\n7. å¾—åˆ°èµ„æºä¹‹åå¦‚æœæœ‰gzipå‹ç¼©è¦å…ˆè§£å‹\n8. ç„¶åå…ˆæ„å»ºDOMæ ‘ï¼ŒCSSæ ‘ã€‚ä¸‹è½½JSæ–‡ä»¶ï¼Œç„¶åä¸‹è½½å›¾ç‰‡ã€‚ç„¶åç”ŸæˆRenderæ ‘ï¼Œæœ€åç¡®å®šå¸ƒå±€ï¼ŒGPUç»˜åˆ¶ã€‚\n\n# ç´¢å¼•\n\n> https://www.ruanyifeng.com/blog/2016/04/cors.html\n>\n> å‰ç«¯é¢è¯•ä¹‹é“ï¼ˆæ˜é‡‘å°å†Œ\n>\n> https://juejin.im/post/6844904162166063118#heading-30","slug":"ã€é‡è¯†å‰ç«¯ã€‘åœ°å€æ ä¸­è¾“å…¥ç½‘å€å","published":1,"updated":"2021-06-24T14:00:06.852Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra8r0021lwrd3eocghnu","content":"<h1 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h1><p>ä¸è¯´å¤ªå¤šåºŸè¯äº†ï¼Œè¿™ä¸ªé¢˜ç›®å…¶å®åŸºæœ¬ä¸Šæ˜¯ç°åœ¨é¢è¯•çš„é«˜é¢‘è€ƒç‚¹äº†ï¼Œç°åœ¨æˆ‘ä¹Ÿæƒ³è‡ªå·±è®¤è®¤çœŸçœŸçš„æ‹ä¸€éï¼Œåˆ°æ—¶å€™é¢è¯•ä¹Ÿå¯ä»¥æµåˆ©çš„å›ç­”ã€‚</p>\n<h1 id=\"å¼€å§‹\"><a href=\"#å¼€å§‹\" class=\"headerlink\" title=\"å¼€å§‹\"></a>å¼€å§‹</h1><p>letâ€™s go</p>\n<h2 id=\"URLè§£æ\"><a href=\"#URLè§£æ\" class=\"headerlink\" title=\"URLè§£æ\"></a>URLè§£æ</h2><p>å…¶å®æœ‰äººä¸€å¼€å§‹ä¼šæœ‰ç–‘æƒ‘ï¼Œè‡³å°‘æˆ‘ä¸€å¼€å§‹ä¹Ÿæœ‰ç–‘æƒ‘ï¼Œä¸æ˜¯åº”è¯¥å…ˆDNSè§£æå—ï¼Ÿ</p>\n<p>å…¶å®ä¸æ˜¯çš„ï¼Œç°åœ¨çš„æµè§ˆå™¨ä»–ä¼šä¼˜å…ˆè§£æä½ æ˜¯ä¸æ˜¯ä¸€ä¸ªåˆæ³•çš„URLï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿæ¯”å¦‚æˆ‘ä»¬åœ¨Chromeè¾“å…¥ä¸­æ–‡â€œDerrickæ˜¯å¸…å“¥å—â€ï¼Œè¿™æ ·çš„ä¸æ˜¯ä¸€ä¸ªæ­£å¸¸çš„åˆæ³•çš„URLï¼Œå°±ä¼šä¼˜å…ˆè°ƒç”¨ä½ é»˜è®¤çš„æœç´¢å¼•æ“å¼€å§‹æœç´¢ã€‚</p>\n<p>å½“ç„¶äº†ï¼Œåˆæ³•çš„URLåŒ…æ‹¬äº†åè®®å’Œç½‘ç»œåœ°å€ï¼Œæœ€å¸¸ç”¨çš„åè®®æ˜¯</p>\n<ul>\n<li>HTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰</li>\n<li>FTPï¼ˆæ–‡ä»¶ä¼ è¾“åè®®ï¼‰</li>\n</ul>\n<p>ç½‘ç»œåœ°å€ä¹Ÿå¯ä»¥æ˜¯ipåœ°å€ï¼Œä»¥åŠç«¯å£å·ï¼Œæ²¡æœ‰ç«¯å£é»˜è®¤æ˜¯80ç«¯å£</p>\n<h2 id=\"DNSåŸŸåè§£æ\"><a href=\"#DNSåŸŸåè§£æ\" class=\"headerlink\" title=\"DNSåŸŸåè§£æ\"></a>DNSåŸŸåè§£æ</h2><p>è¿™ä¸€æ­¥å…¶å®ç®€å•æ¥è¯´å°±æ˜¯â€baidu.comâ€è¿™ä¸ªåŸŸåï¼Œè§£ææˆä¸€ä¸ªæ•´ä¸ªçš„åœ°å€ã€‚</p>\n<p>æ¯”å¦‚æˆ‘ä»¬çš„å®¶åº­ä½å€éƒ½æœ‰ä¸€ä¸ªé—¨ç‰Œå·ï¼Œxxå°åŒºxxæ ‹xxå·</p>\n<p>è¿™æ ·çš„ä¸€ä¸²æ ‡è¯†ç¬¦å°±å¯ä»¥ç²¾å‡†çš„æ‰¾åˆ°æˆ‘ä»¬çš„å®¶åº­ä½å€ï¼Œè€Œæ¯ä¸€ä¸ªipåœ°å€å°±æ˜¯è¿™æ ·çš„ä¸€ä¸ªé—¨ç‰Œå·ï¼Œæ¯”å¦‚<code>baidu.com</code>è¿™ä¸ªä¸æ˜¯ä¸€ä¸ªé—¨ç‰Œå·ï¼Œè¿™ä¸ªå¯ä»¥ç†è§£ä¸ºç™¾åº¦çš„å®¶ï¼Œä½ å‘Šè¯‰æµè§ˆå™¨ä½ è¦å»ç™¾åº¦çš„å®¶ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå¼€å§‹è¿›è¡ŒDNSè§£æä»–ä¼šè§£ææˆç™¾åº¦çš„é—¨ç‰Œå·ï¼Œç„¶åæ‰¾åˆ°ç™¾åº¦çš„å®¶ã€‚</p>\n<h3 id=\"ç¼“å­˜\"><a href=\"#ç¼“å­˜\" class=\"headerlink\" title=\"ç¼“å­˜\"></a>ç¼“å­˜</h3><p>è¿™é‡Œé¢åˆä¼šæ¶‰åŠåˆ°ç¼“å­˜çš„æ¦‚å¿µï¼Œä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p>\n<p>å°±æ˜¯ä¹‹å‰æˆ‘æŸ¥è¿‡ç™¾åº¦çš„å®¶äº†ï¼Œå·²ç»è®°å½•ä¸‹æ¥ç™¾åº¦çš„å®¶çš„é—¨ç‰Œå·äº†ï¼Œå°±ä¸éœ€è¦é‡æ–°çš„è¿›è¡Œè§£æäº†ï¼Œç›´æ¥è¯»å–å°±å¥½äº†ï¼ŒèŠ‚çº¦æ—¶é—´ã€‚</p>\n<p>è¿™é‡Œé¢æ¶‰åŠçš„çŸ¥è¯†å¤ªå¤šäº†ï¼Œä¸åœ¨è¿™æ¬¡çš„è®¨è®ºèŒƒå›´å†…ã€‚æ‰€ä»¥åªç®€å•çš„è¯´ä¸€ä¸‹ã€‚</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/%E5%9C%B0%E5%9D%80%E6%A0%8F/dns.png\"  alt=\"demo1\"></p>\n<p>ä¸Šå›¾å…¶å®å¾ˆå¥½çš„è§£ç­”äº†DNSçš„æ•´ä¸ªè§£æè¿‡ç¨‹ã€‚</p>\n<ol>\n<li>ä»æµè§ˆå™¨è·å–ç¼“å­˜ç»“æœã€‚</li>\n<li>å¦‚æœæµè§ˆå™¨æ²¡æœ‰ç¼“å­˜å°±ä»æœ¬åœ°ç³»ç»Ÿçš„ç¼“å­˜ä¸­è¯»å–ï¼Œæ¯”å¦‚hostæ–‡ä»¶ç­‰ç­‰ï¼Œåƒæˆ‘ä»¬å¹³å¸¸ä¸ŠGitHubå¦‚æœæ…¢çš„è¯æˆ‘ä»¬éƒ½ä¼šä¿®æ”¹hostæ–‡ä»¶ï¼Œç»™ä»–é…ä¸€ä¸ªå¿«ä¸€ç‚¹çš„ipä¹‹ç±»çš„ç­‰ç­‰ã€‚</li>\n<li>ç„¶åæ˜¯å›¾é‡Œé¢æ²¡æœ‰æåˆ°çš„è·¯ç”±å™¨ç¼“å­˜ï¼Œä¸€èˆ¬çš„è·¯ç”±å™¨ä¹Ÿä¼šæœ‰è‡ªå·±çš„ç¼“å­˜ã€‚</li>\n<li>è·¯ç”±å™¨ä¹Ÿæ‰¾ä¸åˆ°åªèƒ½å¼€å§‹è§£æäº†ã€‚æœ¬åœ°åŸŸåæœåŠ¡å™¨ä¼šå‘æ ¹åŸŸåæœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œ å¦‚æœæ ¹åŸŸåæœåŠ¡å™¨ä¹Ÿä¸å­˜åœ¨è¯¥åŸŸåæ—¶ï¼Œ æœ¬åœ°åŸŸåä¼šå‘comé¡¶çº§åŸŸåæœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œ ä¾æ¬¡ç±»æ¨ä¸‹å»ã€‚ ç›´åˆ°æœ€åæ‰¾åˆ°ç›®æ ‡ç½‘å€æ‰€å¯¹åº”çš„ IPï¼Œ å¹¶å°†å…¶ç¼“å­˜åˆ°æœ¬åœ°ï¼Œ ä»¥ä¾›ä¸‹æ¬¡ä½¿ç”¨ã€‚</li>\n</ol>\n<h3 id=\"DNSé‡å®šå‘\"><a href=\"#DNSé‡å®šå‘\" class=\"headerlink\" title=\"DNSé‡å®šå‘\"></a>DNSé‡å®šå‘</h3><p>è¿™é‡Œé¡ºä¾¿è¯´ä¸€ä¸‹DNSçš„é‡å®šå‘å§</p>\n<blockquote>\n<p>DNSæ¯æ¬¡è¿”å›çš„ipåœ°å€å¯èƒ½ä¼šä¸ä¸€æ ·ï¼Œå› ä¸ºä¸–ç•Œä¸Šä¸æ˜¯åªæœ‰ä¸€ä¸ªæœºå™¨å¯ä»¥å¤„ç†â€baidu.comâ€çš„è¿™ä¸ªè¯·æ±‚ï¼Œæœ‰å¾ˆå¤šæœºå™¨å¯ä»¥å¤„ç†ï¼ŒDNSåªéœ€è¦è¿”å›å¯ä»¥å¤„ç†çš„æœºå™¨çš„ipåœ°å€å°±å¯ä»¥äº†ã€‚ä¾‹å¦‚å¯ä»¥æ ¹æ®æ¯å°æœºå™¨çš„è´Ÿè½½é‡ï¼Œ è¯¥æœºå™¨ç¦»ç”¨æˆ·åœ°ç†ä½ç½®çš„è·ç¦»ç­‰ç­‰ï¼Œ è¿™ç§è¿‡ç¨‹å°±æ˜¯DNSè´Ÿè½½å‡è¡¡ï¼Œ åˆå«åšDNSé‡å®šå‘ã€‚</p>\n</blockquote>\n<p>å¾ˆç®€å•ï¼Œå‡ ä¸ªä¾‹å­ï¼Œæ¯”å¦‚æˆ‘åœ¨æ•…å®«çš„åŒ—é—¨ï¼Œæ‰“å¼€åœ°å›¾è¦æŸ¥è¯¢æ•…å®«è‚¯å®šä¼šè®©æˆ‘ä»åŒ—é—¨è¿›å»ã€‚è€Œå¦‚æœæˆ‘åœ¨æ•…å®«çš„å—é—¨ï¼Œè¦å¯¼èˆªåˆ°æ•…å®«å°±ä¼šè®©æˆ‘ä»å—é—¨è¿›å»ã€‚</p>\n<h3 id=\"DNSæ±¡æŸ“\"><a href=\"#DNSæ±¡æŸ“\" class=\"headerlink\" title=\"DNSæ±¡æŸ“\"></a>DNSæ±¡æŸ“</h3><p>DNS æ±¡æŸ“ï¼ˆDNS cache pollutionï¼‰ï¼Œ åˆç§°åŸŸåæœåŠ¡å™¨ç¼“å­˜æŠ•æ¯’ï¼ˆDNS cache poisoningï¼‰ï¼Œ æ˜¯æŒ‡ä¸€äº›åˆ»æ„åˆ¶é€ æˆ–æ— æ„ä¸­åˆ¶é€ å‡ºæ¥çš„åŸŸåæœåŠ¡å™¨æ•°æ®åŒ…ï¼Œ æŠŠåŸŸåæŒ‡å¾€<strong>ä¸æ­£ç¡®çš„IPåœ°å€</strong>ã€‚</p>\n<p>æŸäº›ç½‘ç»œè¿è¥å•†ä¸ºäº†æŸäº›ç›®çš„ï¼Œ å¯¹DNSè¿›è¡Œäº†æŸäº›æ“ä½œï¼Œ å¯¼è‡´ä¸Šç½‘çš„ç”¨æˆ·æ— æ³•é€šè¿‡åŸŸåå–å¾—æ­£ç¡®çš„IPåœ°å€ã€‚ æŸäº›å›½å®¶æˆ–åœ°åŒºå‡ºäºæŸäº›ç›®çš„ä¸ºäº†é˜²æ­¢æŸç½‘ç«™è¢«è®¿é—®ï¼Œ è€Œä¸”å…¶åˆæŒæ¡éƒ¨åˆ†å›½é™…DNSæ ¹ç›®å½•æœåŠ¡å™¨æˆ–é•œåƒï¼Œ ä¹Ÿä¼šåˆ©ç”¨æ­¤æ–¹æ³•è¿›è¡Œå±è”½ã€‚ ï¼ˆGoogleã€ Facebookç­‰ï¼‰</p>\n<p>è‡³äºå¦‚æœé˜²æ­¢DNSæ±¡æŸ“ï¼Œ è¿™é‡Œåªè¯´ä¸€ä¸ªæ–¹æ³•å°±æ˜¯ä¿®æ”¹hostsæ–‡ä»¶ï¼Œ å…¶ä»–çš„è‡ªè¡Œæœç´¢å§ã€‚</p>\n<h2 id=\"TCPå»ºç«‹è¿æ¥\"><a href=\"#TCPå»ºç«‹è¿æ¥\" class=\"headerlink\" title=\"TCPå»ºç«‹è¿æ¥\"></a>TCPå»ºç«‹è¿æ¥</h2><p>å…¶å®æˆ‘ä»¬è§£æä¹‹åï¼Œæ‰¾åˆ°çœŸæ­£çš„æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å°±éœ€è¦è·å–ä»–çš„èµ„æºï¼Œæœ€ç®€å•çš„å°±æ˜¯è·å–ä»–çš„HTMLæ–‡ä»¶ï¼Œæ¥æ¸²æŸ“å¯¹å§ï¼Ÿæ€ä¹ˆè·å–å‘¢ï¼Œæˆ‘ä»¬éœ€è¦TCPè¿æ¥æ¥è·å–ã€‚</p>\n<p>è¿™é‡Œæ¶‰åŠåˆ°ä¸‰æ¬¡æ¡æ‰‹ï¼Œå’Œå››æ¬¡æŒ¥æ‰‹ä»¥åŠUDPçš„ä¸€äº›ç»†ä¸€ç‚¹çš„çŸ¥è¯†ç‚¹ã€‚</p>\n<p>è¯´TCPä¹‹å‰æˆ‘æƒ³æŠŠä¸€äº›é‡Œé¢å¯èƒ½ç”¨åˆ°çš„ä¸œè¥¿å…ˆè¯´è¯´æ¸…æ¥šï¼Œæ–¹ä¾¿æŸ¥æ‰¾ã€‚</p>\n<blockquote>\n<p>ä½ç å³tcpæ ‡å¿—ä½ï¼Œæœ‰6ç§æ ‡ç¤ºï¼šSYN(synchronouså»ºç«‹è”æœº) ACK(acknowledgement ç¡®è®¤) PSH(pushä¼ é€) FIN(finishç»“æŸ) RST(reseté‡ç½®) URG(urgentç´§æ€¥)Sequence number(é¡ºåºå·ç ) Acknowledge number(ç¡®è®¤å·ç )</p>\n</blockquote>\n<h3 id=\"ä¸‰æ¬¡æ¡æ‰‹\"><a href=\"#ä¸‰æ¬¡æ¡æ‰‹\" class=\"headerlink\" title=\"ä¸‰æ¬¡æ¡æ‰‹\"></a>ä¸‰æ¬¡æ¡æ‰‹</h3><p><img src=\"/\" class=\"lazyload\" data-src=\"/image/%E5%9C%B0%E5%9D%80%E6%A0%8F/woshou.png\"  alt=\"demo2\"></p>\n<p>ä¸‰æ¬¡æ¡æ‰‹åŸºæœ¬ä¸Šå°±æ˜¯ğŸ‘†çš„å›¾ç‰‡äº†ï¼Œé‡Œé¢çš„ä½ç åœ¨ä¹‹å‰ä¹Ÿæœ‰è§£é‡Šã€‚</p>\n<p>è¿™é‡Œé‡ç‚¹è¯´ä¸€ä¸‹ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹ğŸ¤ï¼Œè€Œä¸æ˜¯ä¸¤æ¬¡æˆ–è€…å››æ¬¡ã€‚</p>\n<p>Aåœ¨è¡—ä¸Šçœ‹è§äº†éš”äº†100ç±³çš„Bï¼Œï¼ˆæ­£å¸¸æƒ…å†µä¸‹å¦‚æœé¢å¯¹é¢äº¤æµæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯è¡—ä¸Šå¾ˆåµï¼Œå„ç§è½¦é¸£å£°ï¼Œåº—é“ºå¹¿å‘Šå£°ä¹‹ç±»çš„ã€‚ï¼‰æ‰€ä»¥Aæƒ³å’ŒBè¿›è¡Œå¯¹è¯ï¼Œï¼ˆåˆ«é—®é¢˜ä¸ºä»€ä¹ˆä¸æ‰“ç”µè¯ï¼ŒèŠ‚çº¦é’±ï¼ï¼‰</p>\n<p>Aå–Šäº†Bä¸€å£°ï¼Œä¸çŸ¥é“Bå¬ä¸å¬å¾—è§ï¼Œæ‰€ä»¥åªèƒ½åœ¨è¿œå¤„ç­‰Bçš„å›åº”ã€‚</p>\n<p>Bå¬è§äº†ï¼Œä¹Ÿå›åº”äº†Aï¼Œä½†æ˜¯ä»–ä¸çŸ¥é“Aèƒ½ä¸èƒ½å¬è§æ‰€ä»¥ä¹Ÿè¦ç­‰Aå›åº”ã€‚</p>\n<p>ç„¶åAç»™å‡ºäº†å›åº”ï¼Œä¹‹åAå’ŒBå°±å¿«ä¹çš„äº¤æµèµ·æ¥ã€‚</p>\n<p>okï¼Œæˆ‘ä»¬å†æ¦‚æ‹¬ä¸€ä¸‹ã€‚</p>\n<p>å¯¹åº”åˆ°ä¸‰æ¬¡æ¡æ‰‹å°±æ˜¯A -&gt; clientï¼›B-&gt;server</p>\n<ol>\n<li>ç¬¬ä¸€æ¬¡ğŸ¤ï¼ˆAå–ŠBï¼‰æ˜¯ä¸ºäº†ç¡®è®¤ä¸€ä¸‹Bèƒ½ä¸èƒ½å¬è§ï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯è¦ç¡®è®¤æœåŠ¡ç«¯çš„æ¥å—åŠŸèƒ½æ­£ä¸æ­£å¸¸</li>\n<li>ç¬¬äºŒæ¬¡ğŸ¤ï¼ˆBå–ŠAï¼‰æ˜¯å‘Šè¯‰Aï¼Œæˆ‘èƒ½å¬è§ï¼Œç°åœ¨æˆ‘ç°åœ¨çŸ¥é“ä½ èƒ½ä¸èƒ½å¬è§ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡ç«¯å‘Šè¯‰å®¢æˆ·ç«¯æˆ‘æ¥å—åŠŸèƒ½æ­£å¸¸ï¼Œç°åœ¨æˆ‘æƒ³çŸ¥é“ä½ æ¥æ”¶åŠŸèƒ½æ­£ä¸æ­£å¸¸ã€‚</li>\n<li>ç¬¬ä¸‰æ¬¡ğŸ¤ï¼ˆAå–ŠBï¼‰æ˜¯ä¸ºäº†å‘Šè¯‰Bæˆ‘å¬è§äº†ï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯è®©æœåŠ¡ç«¯çŸ¥é“å®¢æˆ·ç«¯çš„æ¥æ”¶åŠŸèƒ½æ­£å¸¸ï¼Œå¹¶ä¸”å¯ä»¥å¼€å§‹ä¼ è¾“ã€‚</li>\n</ol>\n<p>ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œå› ä¸ºåªæœ‰è¿™ä¸‰æ¬¡å¯ä»¥å®Œç¾çš„ç¡®è®¤åŒæ–¹çš„æ¥æ”¶å’Œå‘é€åŠŸèƒ½æ­£å¸¸ã€‚</p>\n<p>ä¸ºä»€ä¹ˆä¸æ˜¯ä¸¤æ¬¡æ¡æ‰‹ï¼ŸæŒ‰ç…§ä¸Šé¢çš„è¯´æ³•ï¼ŒBç›´æ¥å¼€å§‹å‘é€æ•°æ®ï¼Œå¯æ˜¯ä»–æ ¹æœ¬ä¸çŸ¥é“Aèƒ½ä¸èƒ½æ¥æ”¶å•Šï¼Œå‘å‡ºå»å²‚ä¸æ˜¯æµªè´¹äº†ï¼Œå¯¹å§ï¼Ÿä¸‡ä¸€Aä¸èƒ½æ¥æ”¶å‘¢ï¼Ÿæ‰€ä»¥åªèƒ½ç­‰å¾…Açš„å›åº”</p>\n<p>ä¸ºä»€ä¹ˆä¸æ˜¯å››æ¬¡æ¡æ‰‹ï¼Ÿå› ä¸ºä¸‰æ¬¡å°±å·²ç»å®Œæˆäº†ä»–ä»¬äº’ç›¸æƒ³çŸ¥é“çš„ä¿¡æ¯ä¸éœ€è¦ç»§ç»­æµªè´¹èµ„æºäº†ï¼Œèµ¶ç´§å¼€å§‹é€šä¿¡å§ï¼</p>\n<h3 id=\"å››æ¬¡æŒ¥æ‰‹\"><a href=\"#å››æ¬¡æŒ¥æ‰‹\" class=\"headerlink\" title=\"å››æ¬¡æŒ¥æ‰‹\"></a>å››æ¬¡æŒ¥æ‰‹</h3><p>å››æ¬¡æŒ¥æ‰‹å…¶å®åé¢æ‰ä¼šè®²åˆ°ï¼Œä½†æ˜¯å› ä¸ºçŸ¥è¯†ç‚¹æ˜¯ä¸€èµ·çš„ï¼Œæ‰€ä»¥å°±æ”¾åœ¨ä¸€èµ·è®²äº†</p>\n<p>è€è§„çŸ©ï¼Œçœ‹å›¾å’Œä¸Šé¢çš„ä½ç æ„æ€ï¼Œå°±ä¸å¤šè§£é‡Šäº†ã€‚</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/%E5%9C%B0%E5%9D%80%E6%A0%8F/huishou.png\"  alt=\"demo3\"></p>\n<p>è¿™é‡Œé‡ç‚¹è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆæ˜¯å››æ¬¡æŒ¥æ‰‹ğŸ‘‹</p>\n<p>çœ‹å›¾æˆ‘ä»¬å¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹åˆ°å…¶å®å°±å¤šäº†ä¸€æ¬¡æœåŠ¡ç«¯å‘Šè¯‰å®¢æˆ·ç«¯è¦ç»ˆæ­¢çš„æ¶ˆæ¯ã€‚</p>\n<p>è¿˜æ˜¯ä¸¾åˆšåˆšAå’ŒBçš„ä¾‹å­å§ã€‚</p>\n<p>Aè§‰å¾—å’ŒBèŠçš„å·®ä¸å¤šäº†ï¼Œæƒ³ç»“æŸå¯¹è¯ï¼Œå› ä¸ºå¤©è‰²å¾ˆæ™šäº†è¦å›å®¶åƒé¥­ğŸšäº†ã€‚</p>\n<p>æ‰€ä»¥Aå‘Šè¯‰Bï¼Œæˆ‘æƒ³èµ°äº†ï¼Œä¸æƒ³èŠäº†ã€‚</p>\n<p>Bæ”¶åˆ°åå‘Šè¯‰Aï¼Œå¥½çš„ï¼Œæˆ‘çŸ¥é“äº†ï¼Œä½†æ˜¯ä½ ç­‰æˆ‘ä¸€ä¸‹ï¼Œæˆ‘æ’’æ³¡å°¿ï¼Œæ’’å®Œä¸€èµ·èµ°ã€‚</p>\n<p>Bæ’’å®Œå°¿ä¹‹åï¼Œå‘Šè¯‰Aæˆ‘æ’’å®Œå°¿äº†ã€‚</p>\n<p>Aæ”¶åˆ°ä¸¤å¥è¯ï¼ˆ1.Bå¬åˆ°ğŸ‘‚Aæƒ³å›å®¶çš„æ¶ˆæ¯ï¼Œ2.Bæ’’å®Œå°¿ä¹‹åçš„ä¸€å¥è¯ï¼‰åï¼Œå‘Šè¯‰Bï¼Œæˆ‘èµ°äº†ã€‚</p>\n<p>Bå¬åˆ°åä¹Ÿå›å®¶äº†ã€‚</p>\n<p>okï¼Œæˆ‘ä»¬å†æ¦‚æ‹¬ä¸€ä¸‹ã€‚</p>\n<p>å¯¹åº”åˆ°ä¸‰æ¬¡æ¡æ‰‹å°±æ˜¯A -&gt; clientï¼›B-&gt;server</p>\n<ol>\n<li>ç¬¬ä¸€æ¬¡ğŸ‘‹ Aå‘Šè¯‰Bæˆ‘æƒ³å›å®¶åƒé¥­äº†ã€‚ä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯å‘Šè¯‰æœåŠ¡ç«¯ï¼Œæƒ³æ–­å¼€è¿æ¥äº†ã€‚</li>\n<li>ç¬¬äºŒæ¬¡ğŸ‘‹Bå‘Šè¯‰Aæˆ‘æ”¶åˆ°ä½ çš„æ¶ˆæ¯äº†ï¼Œä¸è¿‡æˆ‘å°¿æ‹‰å®Œå°±ä¸€èµ·å›å®¶å§ã€‚ä¹Ÿå°±æ˜¯æœåŠ¡ç«¯å‘Šè¯‰å®¢æˆ·ç«¯æˆ‘æ”¶åˆ°ä½ çš„æ¶ˆæ¯äº†ï¼Œä½†æ˜¯æˆ‘è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæ–‡ä»¶æ²¡æœ‰ä¼ è¾“å®Œï¼Œæå®šäº†å°±å…³é—­é“¾æ¥ã€‚</li>\n<li>ç¬¬ä¸‰æ¬¡ğŸ‘‹Bå‘Šè¯‰Aæˆ‘æ’’å®Œå°¿äº†ã€‚ä¹Ÿå°±æ˜¯æœåŠ¡ç«¯å‘Šè¯‰å®¢æˆ·ç«¯æˆ‘æ–‡ä»¶ä¼ è¾“å®Œäº†ï¼Œå¯ä»¥å…³é—­é“¾æ¥äº†ã€‚</li>\n<li>ç¬¬å››æ¬¡ğŸ‘‹Aå‘Šè¯‰Bä½ çš„ä¸¤å¥è¯éƒ½å¬åˆ°äº†ï¼ˆ1.Bå¬åˆ°äº†Aæƒ³å›å®¶çš„æ¶ˆæ¯ï¼Œ2.Bæ’’å®Œå°¿äº†ï¼‰ã€‚ä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯å‘Šè¯‰æœåŠ¡ç«¯æˆ‘å…³é—­é“¾æ¥äº†ï¼Œä½ ä¹Ÿåˆ«å‘äº†ã€‚</li>\n</ol>\n<p>åŒæ–¹ç»“æŸé“¾æ¥ã€‚</p>\n<p>ç›¸æ¯”äºä¸‰æ¬¡æ¡æ‰‹ï¼Œå¤šå‡ºæ¥çš„é‚£ä¸€æ¬¡å›æ”¶å°±æ˜¯æœåŠ¡ç«¯éœ€è¦æœ‰ä¸€ä¸ªå…³é—­ä¼ è¾“çš„è¿™ä¹ˆä¸€ä¸ªè¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½éœ€è¦æ—¶é—´ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯éœ€è¦ç­‰å¾…ä¼ è¾“ã€‚</p>\n<h3 id=\"UDP\"><a href=\"#UDP\" class=\"headerlink\" title=\"UDP\"></a>UDP</h3><p>è¿™é‡Œè™½ç„¶ä¸åœ¨èŒƒå›´å†…ï¼Œä½†æ˜¯æˆ‘æƒ³è®²éƒ½è®²äº†ï¼Œé¡ºä¾¿å§UDPä¸€èµ·è¯´å§ï¼</p>\n<p>UDPåè®®å…¨ç§°æ˜¯ç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼Œåœ¨ç½‘ç»œä¸­å®ƒä¸TCPåè®®ä¸€æ ·ç”¨äºå¤„ç†æ•°æ®åŒ…ï¼Œæ˜¯ä¸€ç§æ— è¿æ¥çš„åè®®ã€‚åœ¨OSIæ¨¡å‹ä¸­ï¼Œåœ¨ç¬¬å››å±‚â€”â€”ä¼ è¾“å±‚ï¼Œå¤„äºIPåè®®çš„ä¸Šä¸€å±‚ã€‚UDPæœ‰ä¸æä¾›æ•°æ®åŒ…åˆ†ç»„ã€ç»„è£…å’Œä¸èƒ½å¯¹æ•°æ®åŒ…è¿›è¡Œæ’åºçš„ç¼ºç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æŠ¥æ–‡å‘é€ä¹‹åï¼Œæ˜¯æ— æ³•å¾—çŸ¥å…¶æ˜¯å¦å®‰å…¨å®Œæ•´åˆ°è¾¾çš„ã€‚</p>\n<p>å®ƒæœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š</p>\n<h4 id=\"1-é¢å‘æ— è¿æ¥\"><a href=\"#1-é¢å‘æ— è¿æ¥\" class=\"headerlink\" title=\"1.é¢å‘æ— è¿æ¥\"></a>1.é¢å‘æ— è¿æ¥</h4><p>é¦–å…ˆ UDP æ˜¯ä¸éœ€è¦å’Œ TCPä¸€æ ·åœ¨å‘é€æ•°æ®å‰è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥çš„ï¼Œæƒ³å‘æ•°æ®å°±å¯ä»¥å¼€å§‹å‘é€äº†ã€‚å¹¶ä¸”ä¹Ÿåªæ˜¯æ•°æ®æŠ¥æ–‡çš„æ¬è¿å·¥ï¼Œä¸ä¼šå¯¹æ•°æ®æŠ¥æ–‡è¿›è¡Œä»»ä½•æ‹†åˆ†å’Œæ‹¼æ¥æ“ä½œã€‚</p>\n<p>å…·ä½“æ¥è¯´å°±æ˜¯ï¼š</p>\n<ul>\n<li>åœ¨å‘é€ç«¯ï¼Œåº”ç”¨å±‚å°†æ•°æ®ä¼ é€’ç»™ä¼ è¾“å±‚çš„ UDP åè®®ï¼ŒUDP åªä¼šç»™æ•°æ®å¢åŠ ä¸€ä¸ª UDP å¤´æ ‡è¯†ä¸‹æ˜¯ UDP åè®®ï¼Œç„¶åå°±ä¼ é€’ç»™ç½‘ç»œå±‚äº†</li>\n<li>åœ¨æ¥æ”¶ç«¯ï¼Œç½‘ç»œå±‚å°†æ•°æ®ä¼ é€’ç»™ä¼ è¾“å±‚ï¼ŒUDP åªå»é™¤ IP æŠ¥æ–‡å¤´å°±ä¼ é€’ç»™åº”ç”¨å±‚ï¼Œä¸ä¼šä»»ä½•æ‹¼æ¥æ“ä½œ</li>\n</ul>\n<h4 id=\"2-æœ‰å•æ’­ï¼Œå¤šæ’­ï¼Œå¹¿æ’­çš„åŠŸèƒ½\"><a href=\"#2-æœ‰å•æ’­ï¼Œå¤šæ’­ï¼Œå¹¿æ’­çš„åŠŸèƒ½\" class=\"headerlink\" title=\"2.æœ‰å•æ’­ï¼Œå¤šæ’­ï¼Œå¹¿æ’­çš„åŠŸèƒ½\"></a>2.æœ‰å•æ’­ï¼Œå¤šæ’­ï¼Œå¹¿æ’­çš„åŠŸèƒ½</h4><p>UDP ä¸æ­¢æ”¯æŒä¸€å¯¹ä¸€çš„ä¼ è¾“æ–¹å¼ï¼ŒåŒæ ·æ”¯æŒä¸€å¯¹å¤šï¼Œå¤šå¯¹å¤šï¼Œå¤šå¯¹ä¸€çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯è¯´ UDP æä¾›äº†å•æ’­ï¼Œå¤šæ’­ï¼Œå¹¿æ’­çš„åŠŸèƒ½ã€‚</p>\n<h4 id=\"3-UDPæ˜¯é¢å‘æŠ¥æ–‡çš„\"><a href=\"#3-UDPæ˜¯é¢å‘æŠ¥æ–‡çš„\" class=\"headerlink\" title=\"3.UDPæ˜¯é¢å‘æŠ¥æ–‡çš„\"></a>3.UDPæ˜¯é¢å‘æŠ¥æ–‡çš„</h4><p>å‘é€æ–¹çš„UDPå¯¹åº”ç”¨ç¨‹åºäº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œåœ¨æ·»åŠ é¦–éƒ¨åå°±å‘ä¸‹äº¤ä»˜IPå±‚ã€‚UDPå¯¹åº”ç”¨å±‚äº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œæ—¢ä¸åˆå¹¶ï¼Œä¹Ÿä¸æ‹†åˆ†ï¼Œè€Œæ˜¯ä¿ç•™è¿™äº›æŠ¥æ–‡çš„è¾¹ç•Œã€‚å› æ­¤ï¼Œåº”ç”¨ç¨‹åºå¿…é¡»é€‰æ‹©åˆé€‚å¤§å°çš„æŠ¥æ–‡</p>\n<h4 id=\"4-ä¸å¯é æ€§\"><a href=\"#4-ä¸å¯é æ€§\" class=\"headerlink\" title=\"4.ä¸å¯é æ€§\"></a>4.ä¸å¯é æ€§</h4><p>é¦–å…ˆä¸å¯é æ€§ä½“ç°åœ¨æ— è¿æ¥ä¸Šï¼Œé€šä¿¡éƒ½ä¸éœ€è¦å»ºç«‹è¿æ¥ï¼Œæƒ³å‘å°±å‘ï¼Œè¿™æ ·çš„æƒ…å†µè‚¯å®šä¸å¯é ã€‚</p>\n<p>å¹¶ä¸”æ”¶åˆ°ä»€ä¹ˆæ•°æ®å°±ä¼ é€’ä»€ä¹ˆæ•°æ®ï¼Œå¹¶ä¸”ä¹Ÿä¸ä¼šå¤‡ä»½æ•°æ®ï¼Œå‘é€æ•°æ®ä¹Ÿä¸ä¼šå…³å¿ƒå¯¹æ–¹æ˜¯å¦å·²ç»æ­£ç¡®æ¥æ”¶åˆ°æ•°æ®äº†ã€‚</p>\n<p>å†è€…ç½‘ç»œç¯å¢ƒæ—¶å¥½æ—¶åï¼Œä½†æ˜¯ UDP å› ä¸ºæ²¡æœ‰æ‹¥å¡æ§åˆ¶ï¼Œä¸€ç›´ä¼šä»¥æ’å®šçš„é€Ÿåº¦å‘é€æ•°æ®ã€‚å³ä½¿ç½‘ç»œæ¡ä»¶ä¸å¥½ï¼Œä¹Ÿä¸ä¼šå¯¹å‘é€é€Ÿç‡è¿›è¡Œè°ƒæ•´ã€‚è¿™æ ·å®ç°çš„å¼Šç«¯å°±æ˜¯åœ¨ç½‘ç»œæ¡ä»¶ä¸å¥½çš„æƒ…å†µä¸‹å¯èƒ½ä¼šå¯¼è‡´ä¸¢åŒ…ï¼Œä½†æ˜¯ä¼˜ç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œåœ¨æŸäº›å®æ—¶æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼ˆæ¯”å¦‚ç”µè¯ä¼šè®®ï¼‰å°±éœ€è¦ä½¿ç”¨ UDP è€Œä¸æ˜¯ TCPã€‚</p>\n<p>UDPåªæƒ³æŠŠæ•°æ®å‘å‡ºå»ï¼Œå…·ä½“æœ‰æ²¡æœ‰æˆåŠŸä»–ä¸å…³å¿ƒ</p>\n<h4 id=\"5-å¤´éƒ¨å¼€é”€å°ï¼Œä¼ è¾“æ•°æ®æŠ¥æ–‡æ—¶æ˜¯å¾ˆé«˜æ•ˆçš„ã€‚\"><a href=\"#5-å¤´éƒ¨å¼€é”€å°ï¼Œä¼ è¾“æ•°æ®æŠ¥æ–‡æ—¶æ˜¯å¾ˆé«˜æ•ˆçš„ã€‚\" class=\"headerlink\" title=\"5.å¤´éƒ¨å¼€é”€å°ï¼Œä¼ è¾“æ•°æ®æŠ¥æ–‡æ—¶æ˜¯å¾ˆé«˜æ•ˆçš„ã€‚\"></a>5.å¤´éƒ¨å¼€é”€å°ï¼Œä¼ è¾“æ•°æ®æŠ¥æ–‡æ—¶æ˜¯å¾ˆé«˜æ•ˆçš„ã€‚</h4><p>UDP å¤´éƒ¨åŒ…å«äº†ä»¥ä¸‹å‡ ä¸ªæ•°æ®ï¼š</p>\n<ul>\n<li>ä¸¤ä¸ªåå…­ä½çš„ç«¯å£å·ï¼Œåˆ†åˆ«ä¸ºæºç«¯å£ï¼ˆå¯é€‰å­—æ®µï¼‰å’Œç›®æ ‡ç«¯å£</li>\n<li>æ•´ä¸ªæ•°æ®æŠ¥æ–‡çš„é•¿åº¦</li>\n<li>æ•´ä¸ªæ•°æ®æŠ¥æ–‡çš„æ£€éªŒå’Œï¼ˆIPv4 å¯é€‰ å­—æ®µï¼‰ï¼Œè¯¥å­—æ®µç”¨äºå‘ç°å¤´éƒ¨ä¿¡æ¯å’Œæ•°æ®ä¸­çš„é”™è¯¯</li>\n</ul>\n<p>å› æ­¤ UDP çš„å¤´éƒ¨å¼€é”€å°ï¼Œåªæœ‰å…«å­—èŠ‚ï¼Œç›¸æ¯” TCP çš„è‡³å°‘äºŒåå­—èŠ‚è¦å°‘å¾—å¤šï¼Œåœ¨ä¼ è¾“æ•°æ®æŠ¥æ–‡æ—¶æ˜¯å¾ˆé«˜æ•ˆçš„</p>\n<h4 id=\"6-æ€»ç»“\"><a href=\"#6-æ€»ç»“\" class=\"headerlink\" title=\"6.æ€»ç»“\"></a>6.æ€»ç»“</h4><table>\n<thead>\n<tr>\n<th></th>\n<th>UDP</th>\n<th>TCP</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>æ˜¯å¦è¿æ¥</td>\n<td>æ— è¿æ¥</td>\n<td>é¢å‘è¿æ¥</td>\n</tr>\n<tr>\n<td>æ˜¯å¦å¯é </td>\n<td>ä¸å¯é ä¼ è¾“ï¼Œä¸ä½¿ç”¨æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶</td>\n<td>å¯é ä¼ è¾“ï¼Œä½¿ç”¨æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶</td>\n</tr>\n<tr>\n<td>è¿æ¥å¯¹è±¡ä¸ªæ•°</td>\n<td>æ”¯æŒä¸€å¯¹ä¸€ï¼Œä¸€å¯¹å¤šï¼Œå¤šå¯¹ä¸€å’Œå¤šå¯¹å¤šäº¤äº’é€šä¿¡</td>\n<td>åªèƒ½æ˜¯ä¸€å¯¹ä¸€é€šä¿¡</td>\n</tr>\n<tr>\n<td>ä¼ è¾“æ–¹å¼</td>\n<td>é¢å‘æŠ¥æ–‡</td>\n<td>é¢å‘å­—èŠ‚æµ</td>\n</tr>\n<tr>\n<td>é¦–éƒ¨å¼€é”€</td>\n<td>é¦–éƒ¨å¼€é”€å°ï¼Œä»…8å­—èŠ‚</td>\n<td>é¦–éƒ¨æœ€å°20å­—èŠ‚ï¼Œæœ€å¤§60å­—èŠ‚</td>\n</tr>\n<tr>\n<td>é€‚ç”¨åœºæ™¯</td>\n<td>é€‚ç”¨äºå®æ—¶åº”ç”¨ï¼ˆIPç”µè¯ã€è§†é¢‘ä¼šè®®ã€ç›´æ’­ç­‰ï¼‰</td>\n<td>é€‚ç”¨äºè¦æ±‚å¯é ä¼ è¾“çš„åº”ç”¨ï¼Œä¾‹å¦‚æ–‡ä»¶ä¼ è¾“</td>\n</tr>\n</tbody></table>\n<h2 id=\"SSL-TLSåŠ å¯†\"><a href=\"#SSL-TLSåŠ å¯†\" class=\"headerlink\" title=\"SSL/TLSåŠ å¯†\"></a>SSL/TLSåŠ å¯†</h2><p>åœ¨HTTPè¯·æ±‚ä¹‹å‰ï¼Œå¦‚æœæœ‰åŠ å¯†çš„ï¼ˆå°±æ˜¯HTTPSï¼‰ï¼Œéœ€è¦å…ˆç¡®è®¤ä¸€ä¸‹åŒæ–¹æ˜¯å¦æ˜¯è‡ªå·±æƒ³è¦æ‰¾çš„é‚£ä¸ªäººã€‚</p>\n<p>æ€ä¹ˆçŸ¥é“é‚£ä¸ªä»–æ˜¯ä¸æ˜¯è‡ªå·±è¦æ‰¾çš„äººå‘¢ï¼Ÿæœ‰ä¸¤ç§æ–¹æ³•ï¼šå¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†</p>\n<h3 id=\"å¯¹ç§°åŠ å¯†\"><a href=\"#å¯¹ç§°åŠ å¯†\" class=\"headerlink\" title=\"å¯¹ç§°åŠ å¯†\"></a>å¯¹ç§°åŠ å¯†</h3><p>å¯¹ç§°åŠ å¯†å…¶å®å°±æ˜¯Aå’ŒBéƒ½æœ‰ä¸€ä¸ªè§£å¯†çš„è§„åˆ™ï¼ŒåŒæ–¹éƒ½å¿ƒçŸ¥è‚šæ˜ã€‚è¿™æ ·å°±å¯ä»¥è§£å¯†ã€‚</p>\n<p>å¯¹ç§°åŠ å¯†çš„ä¸€å¤§ç¼ºç‚¹æ˜¯å¯†é’¥çš„ç®¡ç†ä¸åˆ†é…ï¼Œæ¢å¥è¯è¯´ï¼Œå¦‚ä½•æŠŠå¯†é’¥å‘é€åˆ°éœ€è¦è§£å¯†ä½ çš„æ¶ˆæ¯çš„äººçš„æ‰‹é‡Œæ˜¯ä¸€ä¸ªé—®é¢˜ã€‚åœ¨å‘é€å¯†é’¥çš„è¿‡ç¨‹ä¸­ï¼Œå¯†é’¥æœ‰å¾ˆå¤§çš„é£é™©ä¼šè¢«é»‘å®¢ä»¬æ‹¦æˆªã€‚ç°å®ä¸­é€šå¸¸çš„åšæ³•æ˜¯å°†å¯¹ç§°åŠ å¯†çš„å¯†é’¥è¿›è¡Œéå¯¹ç§°åŠ å¯†ï¼Œç„¶åä¼ é€ç»™éœ€è¦å®ƒçš„äººã€‚</p>\n<h3 id=\"éå¯¹ç§°åŠ å¯†\"><a href=\"#éå¯¹ç§°åŠ å¯†\" class=\"headerlink\" title=\"éå¯¹ç§°åŠ å¯†\"></a>éå¯¹ç§°åŠ å¯†</h3><p>é‚£ä¹ˆä»€ä¹ˆæ˜¯éå¯¹ç§°åŠ å¯†å‘¢ï¼Ÿ</p>\n<p>éå¯¹ç§°åŠ å¯†ä¸ºæ•°æ®çš„åŠ å¯†ä¸è§£å¯†æä¾›äº†ä¸€ä¸ªéå¸¸å®‰å…¨çš„æ–¹æ³•ï¼Œå®ƒä½¿ç”¨äº†ä¸€å¯¹å¯†é’¥ï¼Œå…¬é’¥ï¼ˆpublic keyï¼‰å’Œç§é’¥ï¼ˆprivate keyï¼‰ã€‚ç§é’¥åªèƒ½ç”±ä¸€æ–¹å®‰å…¨ä¿ç®¡ï¼Œä¸èƒ½å¤–æ³„ï¼Œè€Œå…¬é’¥åˆ™å¯ä»¥å‘ç»™ä»»ä½•è¯·æ±‚å®ƒçš„äººã€‚éå¯¹ç§°åŠ å¯†ä½¿ç”¨è¿™å¯¹å¯†é’¥ä¸­çš„ä¸€ä¸ªè¿›è¡ŒåŠ å¯†ï¼Œè€Œè§£å¯†åˆ™éœ€è¦å¦ä¸€ä¸ªå¯†é’¥ã€‚æ¯”å¦‚ï¼Œä½ å‘é“¶è¡Œè¯·æ±‚å…¬é’¥ï¼Œé“¶è¡Œå°†å…¬é’¥å‘ç»™ä½ ï¼Œä½ ä½¿ç”¨å…¬é’¥å¯¹æ¶ˆæ¯åŠ å¯†ï¼Œé‚£ä¹ˆåªæœ‰ç§é’¥çš„æŒæœ‰äººâ€“é“¶è¡Œæ‰èƒ½å¯¹ä½ çš„æ¶ˆæ¯è§£å¯†ã€‚ä¸å¯¹ç§°åŠ å¯†ä¸åŒçš„æ˜¯ï¼Œé“¶è¡Œä¸éœ€è¦å°†ç§é’¥é€šè¿‡ç½‘ç»œå‘é€å‡ºå»ï¼Œå› æ­¤å®‰å…¨æ€§å¤§å¤§æé«˜ã€‚</p>\n<h3 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h3><p>æ‰€ä»¥åŸºæœ¬ä¸Šéƒ½æ˜¯å…ˆç”¨éå¯¹ç§°åŠ å¯†ä¼ è¾“å¯¹ç§°åŠ å¯†çš„ç§˜é’¥ã€‚</p>\n<h2 id=\"HTTPè¯·æ±‚\"><a href=\"#HTTPè¯·æ±‚\" class=\"headerlink\" title=\"HTTPè¯·æ±‚\"></a>HTTPè¯·æ±‚</h2><p>HTTPè¯·æ±‚å¾—åˆ°èµ„æºæ–‡ä»¶ï¼Œå¦‚æœæœ‰gzipå‹ç¼©çš„è¯è¿˜éœ€è¦è§£å‹ï¼Œç„¶åæ˜¯ä¸€äº›HTTPå°çš„é›¶ç¢çŸ¥è¯†ç‚¹ã€‚</p>\n<h3 id=\"HTTPæŠ¥æ–‡\"><a href=\"#HTTPæŠ¥æ–‡\" class=\"headerlink\" title=\"HTTPæŠ¥æ–‡\"></a>HTTPæŠ¥æ–‡</h3><p>HTTP æŠ¥æ–‡æ˜¯ç”± è¯·æ±‚æŠ¥æ–‡+å“åº”æŠ¥æ–‡ å…±åŒç»„æˆ</p>\n<ul>\n<li>è¯·æ±‚æŠ¥æ–‡ï¼š<ul>\n<li>å®šä¹‰ï¼šæ‰€æœ‰ç»è¿‡ä¼ è¾“åè®®ï¼Œå®¢æˆ·ç«¯ä¼ é€’ç»™æœåŠ¡å™¨çš„å†…å®¹ï¼Œéƒ½è¢«æˆä¸ºè¯·æ±‚æŠ¥æ–‡</li>\n<li>åŒ…å«ï¼š<ul>\n<li>èµ·å§‹è¡Œ</li>\n<li>è¯·æ±‚å¤´ï¼ˆè¯·æ±‚é¦–éƒ¨ï¼‰</li>\n<li>è¯·æ±‚ä¸»ä½“</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>å“åº”æŠ¥æ–‡ï¼š<ul>\n<li>å®šä¹‰ï¼šæ‰€æœ‰ç»è¿‡ä¼ è¾“åè®®ï¼ŒæœåŠ¡å™¨è¿”å›ç»™å®¢æˆ·ç«¯çš„å†…å®¹ï¼Œéƒ½è¢«æˆä¸ºå“åº”æŠ¥æ–‡</li>\n<li>åŒ…å«ï¼š<ul>\n<li>HTTPçŠ¶æ€ç </li>\n<li>å“åº”å¤´</li>\n<li>å“åº”ä¸»ä½“</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"HTTPçŠ¶æ€ç \"><a href=\"#HTTPçŠ¶æ€ç \" class=\"headerlink\" title=\"HTTPçŠ¶æ€ç \"></a>HTTPçŠ¶æ€ç </h3><p>1~5å¼€å¤´ï¼Œä¸‰ä½æ•°å­—</p>\n<ul>\n<li>1 å¼€å¤´çš„ä»£è¡¨å¤„ç†ä¸­ï¼Œä¸€èˆ¬è§ä¸åˆ°</li>\n<li>2å¼€å¤´ï¼šéƒ½æ˜¯æˆåŠŸ<ul>\n<li>200ï¼šOKï¼šæˆåŠŸ</li>\n<li>201ï¼šCREATEDï¼šä¸€èˆ¬åº”ç”¨äºå‘Šè¯‰æœåŠ¡å™¨åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œæœ€åæœåŠ¡å™¨åˆ›å»ºæˆåŠŸåè¿”å›çš„çŠ¶æ€ç </li>\n<li>204ï¼šNO CONTENTï¼šå¯¹äºæŸäº›è¯·æ±‚ï¼ˆä¾‹å¦‚ï¼šPUTæˆ–è€…DELETEï¼‰ï¼ŒæœåŠ¡å™¨ä¸æƒ³å¤„ç†ï¼Œå¯ä»¥è¿”å›ç©ºå†…å®¹ï¼Œå¹¶ä¸”ç”¨204çŠ¶æ€ç å‘ŠçŸ¥</li>\n</ul>\n</li>\n<li>3å¼€å¤´ï¼šä»£è¡¨æˆåŠŸï¼Œåªä¸è¿‡ä¸­é—´éœ€è¦ä¸­è½¬ä¸€ä¸‹<ul>\n<li>301ï¼šMoved Permanentlyï¼šæ°¸ä¹…é‡å®šå‘ï¼ˆæ°¸ä¹…è½¬ç§»ï¼‰</li>\n<li>302ï¼šMoved Temporarilyï¼šä¸´æ—¶è½¬ç§»ï¼Œå¾ˆæ—©ä»¥å‰åŸºæœ¬ä¸Šç”¨302æ¥åšï¼Œä½†æ˜¯ç°åœ¨ä¸»è¦ç”¨307æ¥å¤„ç†è¿™ä¸ªäº‹æƒ…ï¼Œ</li>\n<li>307çš„æ„æ€å°±æ˜¯ä¸´æ—¶é‡å®šå‘Temporary Redirect =&gt;ä¸»è¦ç”¨äºï¼šæœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡ç­‰</li>\n<li>304ï¼šNot Modifiedï¼šè®¾ç½®HTTPçš„åå•†ç¼“å­˜</li>\n</ul>\n</li>\n<li>4å¼€å¤´ï¼šéƒ½æ˜¯å¤±è´¥<ul>\n<li>400ï¼šBad Requestï¼šä¼ é€’ç»™æœåŠ¡å™¨çš„å‚æ•°é”™è¯¯</li>\n<li>401ï¼šUnauthorizedï¼šæ— æƒé™è®¿é—®</li>\n<li>404ï¼šNot Foundï¼šè¯·æ±‚åœ°å€é”™è¯¯</li>\n</ul>\n</li>\n<li>5å¼€å¤´ï¼šéƒ½æ˜¯å¤±è´¥<ul>\n<li>500ï¼šInternal Server Errorï¼šæœªçŸ¥æœåŠ¡å™¨é”™è¯¯</li>\n<li>503ï¼šService Unavailableï¼šæœåŠ¡å™¨è¶…è´Ÿè·</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"HTTPè¯·æ±‚æ–¹å¼\"><a href=\"#HTTPè¯·æ±‚æ–¹å¼\" class=\"headerlink\" title=\"HTTPè¯·æ±‚æ–¹å¼\"></a>HTTPè¯·æ±‚æ–¹å¼</h3><p>å…¶å®æ­£å¸¸ä¼šè¯´åˆ°ä»€ä¹ˆ<code>POST</code>, <code>GET</code>ä¹‹ç±»çš„ï¼Œä½†æ˜¯æˆ‘è¿™é‡Œæƒ³è¯´ä¸€ä¸‹corsé‡Œé¢çš„ä¸œè¥¿ã€‚</p>\n<p>è¿˜æ˜¯æœ¬ç€æ—¢ç„¶å­¦åˆ°è¿™é‡Œé¡ºè·¯æææ¸…æ¥š</p>\n<p>æµè§ˆå™¨å°†CORSè¯·æ±‚åˆ†æˆä¸¤ç±»ï¼šç®€å•è¯·æ±‚ï¼ˆsimple requestï¼‰å’Œéç®€å•è¯·æ±‚ï¼ˆnot-so-simple requestï¼‰ã€‚</p>\n<h4 id=\"ç®€å•è¯·æ±‚\"><a href=\"#ç®€å•è¯·æ±‚\" class=\"headerlink\" title=\"ç®€å•è¯·æ±‚\"></a>ç®€å•è¯·æ±‚</h4><p>åªè¦åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤å¤§æ¡ä»¶ï¼Œå°±å±äºç®€å•è¯·æ±‚ã€‚</p>\n<blockquote>\n<p>ï¼ˆ1) è¯·æ±‚æ–¹æ³•æ˜¯ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ä¹‹ä¸€ï¼š</p>\n<ul>\n<li>HEAD</li>\n<li>GET</li>\n<li>POST</li>\n</ul>\n<p>ï¼ˆ2ï¼‰HTTPçš„å¤´ä¿¡æ¯ä¸è¶…å‡ºä»¥ä¸‹å‡ ç§å­—æ®µï¼š</p>\n<ul>\n<li>Accept</li>\n<li>Accept-Language</li>\n<li>Content-Language</li>\n<li>Last-Event-ID</li>\n<li>Content-Typeï¼šåªé™äºä¸‰ä¸ªå€¼<code>application/x-www-form-urlencoded</code>ã€<code>multipart/form-data</code>ã€<code>text/plain</code></li>\n</ul>\n</blockquote>\n<h4 id=\"éç®€å•è¯·æ±‚\"><a href=\"#éç®€å•è¯·æ±‚\" class=\"headerlink\" title=\"éç®€å•è¯·æ±‚\"></a>éç®€å•è¯·æ±‚</h4><p>å‡¡æ˜¯ä¸åŒæ—¶æ»¡è¶³ä¸Šé¢ä¸¤ä¸ªæ¡ä»¶ï¼Œå°±å±äºéç®€å•è¯·æ±‚ã€‚</p>\n<p>éç®€å•è¯·æ±‚æ˜¯é‚£ç§å¯¹æœåŠ¡å™¨æœ‰ç‰¹æ®Šè¦æ±‚çš„è¯·æ±‚ï¼Œæ¯”å¦‚è¯·æ±‚æ–¹æ³•æ˜¯<code>PUT</code>æˆ–<code>DELETE</code>ï¼Œæˆ–è€…<code>Content-Type</code>å­—æ®µçš„ç±»å‹æ˜¯<code>application/json</code>ã€‚</p>\n<p>éç®€å•è¯·æ±‚çš„CORSè¯·æ±‚ï¼Œä¼šåœ¨æ­£å¼é€šä¿¡ä¹‹å‰ï¼Œå¢åŠ ä¸€æ¬¡HTTPæŸ¥è¯¢è¯·æ±‚ï¼Œç§°ä¸ºâ€é¢„æ£€â€è¯·æ±‚ï¼ˆpreflightï¼‰ã€‚</p>\n<p>æµè§ˆå™¨å…ˆè¯¢é—®æœåŠ¡å™¨ï¼Œå½“å‰ç½‘é¡µæ‰€åœ¨çš„åŸŸåæ˜¯å¦åœ¨æœåŠ¡å™¨çš„è®¸å¯åå•ä¹‹ä¸­ï¼Œä»¥åŠå¯ä»¥ä½¿ç”¨å“ªäº›HTTPåŠ¨è¯å’Œå¤´ä¿¡æ¯å­—æ®µã€‚åªæœ‰å¾—åˆ°è‚¯å®šç­”å¤ï¼Œæµè§ˆå™¨æ‰ä¼šå‘å‡ºæ­£å¼çš„<code>XMLHttpRequest</code>è¯·æ±‚ï¼Œå¦åˆ™å°±æŠ¥é”™ã€‚</p>\n<p>ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„è·¨åŸŸï¼Œè¿™ä¸ªé—®é¢˜å¯ä»¥äº¤ç”±åç«¯çš„åŒå­¦è®¾ç½®ç™½åå•æˆ–è€…è¿ç»´çš„åŒå­¦è®¾ç½®ã€‚</p>\n<p>å¦‚æœæ˜¯å‰ç«¯çš„åŒå­¦åšè¿™ç§è·¨åŸŸçš„é—®é¢˜çš„è¯ä¸å¤ªæ–¹ä¾¿</p>\n<p>æ¯”å¦‚</p>\n<ul>\n<li><p><strong>JSONP</strong></p>\n</li>\n<li><h4 id=\"document-domain-iframeè·¨åŸŸ\"><a href=\"#document-domain-iframeè·¨åŸŸ\" class=\"headerlink\" title=\"document.domain + iframeè·¨åŸŸ\"></a><strong>document.domain + iframeè·¨åŸŸ</strong></h4></li>\n<li><h4 id=\"location-hash-iframeè·¨åŸŸ\"><a href=\"#location-hash-iframeè·¨åŸŸ\" class=\"headerlink\" title=\"location.hash + iframeè·¨åŸŸ\"></a><strong>location.hash + iframeè·¨åŸŸ</strong></h4></li>\n<li><h4 id=\"window-name-iframeè·¨åŸŸ\"><a href=\"#window-name-iframeè·¨åŸŸ\" class=\"headerlink\" title=\"window.name + iframeè·¨åŸŸ\"></a><strong>window.name + iframeè·¨åŸŸ</strong></h4></li>\n<li><h4 id=\"postMessageè·¨åŸŸ\"><a href=\"#postMessageè·¨åŸŸ\" class=\"headerlink\" title=\"postMessageè·¨åŸŸ\"></a><strong>postMessageè·¨åŸŸ</strong></h4></li>\n</ul>\n<p>ä½†æ˜¯åŸºæœ¬ä¸Šæˆ‘ä»¬å¸¸ç”¨çš„å°±æ˜¯<code>JSONP</code></p>\n<p>å…·ä½“è¿™äº›æ–¹æ³•å’Œåœºæ™¯æœ‰æœºä¼šçš„è¯å…·ä½“è¯´ä¸€ä¸‹ã€‚</p>\n<h2 id=\"æ–­å¼€TCPè¿æ¥\"><a href=\"#æ–­å¼€TCPè¿æ¥\" class=\"headerlink\" title=\"æ–­å¼€TCPè¿æ¥\"></a>æ–­å¼€TCPè¿æ¥</h2><p>ä¹Ÿå°±æ˜¯ä¹‹å‰çš„å››æ¬¡æŒ¥æ‰‹ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ä¸Šé¢çš„è¯´çš„å››æ¬¡æŒ¥æ‰‹</p>\n<h2 id=\"æµè§ˆå™¨æ¸²æŸ“é¡µé¢\"><a href=\"#æµè§ˆå™¨æ¸²æŸ“é¡µé¢\" class=\"headerlink\" title=\"æµè§ˆå™¨æ¸²æŸ“é¡µé¢\"></a>æµè§ˆå™¨æ¸²æŸ“é¡µé¢</h2><p>æ–‡ä»¶è§£ç æˆåŠŸåä¼šæ­£å¼å¼€å§‹æ¸²æŸ“æµç¨‹ï¼Œå…ˆä¼šæ ¹æ® HTML æ„å»º DOM æ ‘ï¼Œæœ‰ CSS çš„è¯ä¼šå»æ„å»º CSSOM æ ‘ã€‚å¦‚æœé‡åˆ° script æ ‡ç­¾çš„è¯ï¼Œä¼šåˆ¤æ–­æ˜¯å¦å­˜åœ¨ async æˆ–è€… defer ï¼Œå‰è€…ä¼šå¹¶è¡Œè¿›è¡Œä¸‹è½½å¹¶æ‰§è¡Œ JSï¼Œåè€…ä¼šå…ˆä¸‹è½½æ–‡ä»¶ï¼Œç„¶åç­‰å¾… HTML è§£æå®Œæˆåé¡ºåºæ‰§è¡Œã€‚</p>\n<p>å¦‚æœä»¥ä¸Šéƒ½æ²¡æœ‰ï¼Œå°±ä¼šé˜»å¡ä½æ¸²æŸ“æµç¨‹ç›´åˆ° JS æ‰§è¡Œå®Œæ¯•ã€‚é‡åˆ°æ–‡ä»¶ä¸‹è½½çš„ä¼šå»ä¸‹è½½æ–‡ä»¶ï¼Œè¿™é‡Œå¦‚æœä½¿ç”¨ HTTP/2 åè®®çš„è¯ä¼šæå¤§çš„æé«˜å¤šå›¾çš„ä¸‹è½½æ•ˆç‡ã€‚</p>\n<p>CSSOM æ ‘å’Œ DOM æ ‘æ„å»ºå®Œæˆåä¼šå¼€å§‹ç”Ÿæˆ Render æ ‘ï¼Œè¿™ä¸€æ­¥å°±æ˜¯ç¡®å®šé¡µé¢å…ƒç´ çš„å¸ƒå±€ã€æ ·å¼ç­‰ç­‰è¯¸å¤šæ–¹é¢çš„ä¸œè¥¿</p>\n<p>åœ¨ç”Ÿæˆ Render æ ‘çš„è¿‡ç¨‹ä¸­ï¼Œæµè§ˆå™¨å°±å¼€å§‹è°ƒç”¨ GPU ç»˜åˆ¶ï¼Œåˆæˆå›¾å±‚ï¼Œå°†å†…å®¹æ˜¾ç¤ºåœ¨å±å¹•ä¸Šäº†ã€‚</p>\n<h1 id=\"æ€»ç»“-1\"><a href=\"#æ€»ç»“-1\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h1><ol>\n<li>URLè§£æ</li>\n<li>DNSè§£æ</li>\n<li>å»ºç«‹è¿æ¥</li>\n<li>å¦‚æœæœ‰åŠ å¯†çš„è¯è¦å…ˆè§£å¯†</li>\n<li>ç„¶åhttpè¯·æ±‚è·å–èµ„æº</li>\n<li>æ–­å¼€è¿æ¥</li>\n<li>å¾—åˆ°èµ„æºä¹‹åå¦‚æœæœ‰gzipå‹ç¼©è¦å…ˆè§£å‹</li>\n<li>ç„¶åå…ˆæ„å»ºDOMæ ‘ï¼ŒCSSæ ‘ã€‚ä¸‹è½½JSæ–‡ä»¶ï¼Œç„¶åä¸‹è½½å›¾ç‰‡ã€‚ç„¶åç”ŸæˆRenderæ ‘ï¼Œæœ€åç¡®å®šå¸ƒå±€ï¼ŒGPUç»˜åˆ¶ã€‚</li>\n</ol>\n<h1 id=\"ç´¢å¼•\"><a href=\"#ç´¢å¼•\" class=\"headerlink\" title=\"ç´¢å¼•\"></a>ç´¢å¼•</h1><blockquote>\n<p><a href=\"https://www.ruanyifeng.com/blog/2016/04/cors.html\" target=\"_blank\" rel=\"noopener\">https://www.ruanyifeng.com/blog/2016/04/cors.html</a></p>\n<p>å‰ç«¯é¢è¯•ä¹‹é“ï¼ˆæ˜é‡‘å°å†Œ</p>\n<p><a href=\"https://juejin.im/post/6844904162166063118#heading-30\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/6844904162166063118#heading-30</a></p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h1><p>ä¸è¯´å¤ªå¤šåºŸè¯äº†ï¼Œè¿™ä¸ªé¢˜ç›®å…¶å®åŸºæœ¬ä¸Šæ˜¯ç°åœ¨é¢è¯•çš„é«˜é¢‘è€ƒç‚¹äº†ï¼Œç°åœ¨æˆ‘ä¹Ÿæƒ³è‡ªå·±è®¤è®¤çœŸçœŸçš„æ‹ä¸€éï¼Œåˆ°æ—¶å€™é¢è¯•ä¹Ÿå¯ä»¥æµåˆ©çš„å›ç­”ã€‚</p>\n<h1 id=\"å¼€å§‹\"><a href=\"#å¼€å§‹\" class=\"headerlink\" title=\"å¼€å§‹\"></a>å¼€å§‹</h1><p>letâ€™s go</p>\n<h2 id=\"URLè§£æ\"><a href=\"#URLè§£æ\" class=\"headerlink\" title=\"URLè§£æ\"></a>URLè§£æ</h2><p>å…¶å®æœ‰äººä¸€å¼€å§‹ä¼šæœ‰ç–‘æƒ‘ï¼Œè‡³å°‘æˆ‘ä¸€å¼€å§‹ä¹Ÿæœ‰ç–‘æƒ‘ï¼Œä¸æ˜¯åº”è¯¥å…ˆDNSè§£æå—ï¼Ÿ</p>\n<p>å…¶å®ä¸æ˜¯çš„ï¼Œç°åœ¨çš„æµè§ˆå™¨ä»–ä¼šä¼˜å…ˆè§£æä½ æ˜¯ä¸æ˜¯ä¸€ä¸ªåˆæ³•çš„URLï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿæ¯”å¦‚æˆ‘ä»¬åœ¨Chromeè¾“å…¥ä¸­æ–‡â€œDerrickæ˜¯å¸…å“¥å—â€ï¼Œè¿™æ ·çš„ä¸æ˜¯ä¸€ä¸ªæ­£å¸¸çš„åˆæ³•çš„URLï¼Œå°±ä¼šä¼˜å…ˆè°ƒç”¨ä½ é»˜è®¤çš„æœç´¢å¼•æ“å¼€å§‹æœç´¢ã€‚</p>\n<p>å½“ç„¶äº†ï¼Œåˆæ³•çš„URLåŒ…æ‹¬äº†åè®®å’Œç½‘ç»œåœ°å€ï¼Œæœ€å¸¸ç”¨çš„åè®®æ˜¯</p>\n<ul>\n<li>HTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰</li>\n<li>FTPï¼ˆæ–‡ä»¶ä¼ è¾“åè®®ï¼‰</li>\n</ul>\n<p>ç½‘ç»œåœ°å€ä¹Ÿå¯ä»¥æ˜¯ipåœ°å€ï¼Œä»¥åŠç«¯å£å·ï¼Œæ²¡æœ‰ç«¯å£é»˜è®¤æ˜¯80ç«¯å£</p>\n<h2 id=\"DNSåŸŸåè§£æ\"><a href=\"#DNSåŸŸåè§£æ\" class=\"headerlink\" title=\"DNSåŸŸåè§£æ\"></a>DNSåŸŸåè§£æ</h2><p>è¿™ä¸€æ­¥å…¶å®ç®€å•æ¥è¯´å°±æ˜¯â€baidu.comâ€è¿™ä¸ªåŸŸåï¼Œè§£ææˆä¸€ä¸ªæ•´ä¸ªçš„åœ°å€ã€‚</p>\n<p>æ¯”å¦‚æˆ‘ä»¬çš„å®¶åº­ä½å€éƒ½æœ‰ä¸€ä¸ªé—¨ç‰Œå·ï¼Œxxå°åŒºxxæ ‹xxå·</p>\n<p>è¿™æ ·çš„ä¸€ä¸²æ ‡è¯†ç¬¦å°±å¯ä»¥ç²¾å‡†çš„æ‰¾åˆ°æˆ‘ä»¬çš„å®¶åº­ä½å€ï¼Œè€Œæ¯ä¸€ä¸ªipåœ°å€å°±æ˜¯è¿™æ ·çš„ä¸€ä¸ªé—¨ç‰Œå·ï¼Œæ¯”å¦‚<code>baidu.com</code>è¿™ä¸ªä¸æ˜¯ä¸€ä¸ªé—¨ç‰Œå·ï¼Œè¿™ä¸ªå¯ä»¥ç†è§£ä¸ºç™¾åº¦çš„å®¶ï¼Œä½ å‘Šè¯‰æµè§ˆå™¨ä½ è¦å»ç™¾åº¦çš„å®¶ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå¼€å§‹è¿›è¡ŒDNSè§£æä»–ä¼šè§£ææˆç™¾åº¦çš„é—¨ç‰Œå·ï¼Œç„¶åæ‰¾åˆ°ç™¾åº¦çš„å®¶ã€‚</p>\n<h3 id=\"ç¼“å­˜\"><a href=\"#ç¼“å­˜\" class=\"headerlink\" title=\"ç¼“å­˜\"></a>ç¼“å­˜</h3><p>è¿™é‡Œé¢åˆä¼šæ¶‰åŠåˆ°ç¼“å­˜çš„æ¦‚å¿µï¼Œä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p>\n<p>å°±æ˜¯ä¹‹å‰æˆ‘æŸ¥è¿‡ç™¾åº¦çš„å®¶äº†ï¼Œå·²ç»è®°å½•ä¸‹æ¥ç™¾åº¦çš„å®¶çš„é—¨ç‰Œå·äº†ï¼Œå°±ä¸éœ€è¦é‡æ–°çš„è¿›è¡Œè§£æäº†ï¼Œç›´æ¥è¯»å–å°±å¥½äº†ï¼ŒèŠ‚çº¦æ—¶é—´ã€‚</p>\n<p>è¿™é‡Œé¢æ¶‰åŠçš„çŸ¥è¯†å¤ªå¤šäº†ï¼Œä¸åœ¨è¿™æ¬¡çš„è®¨è®ºèŒƒå›´å†…ã€‚æ‰€ä»¥åªç®€å•çš„è¯´ä¸€ä¸‹ã€‚</p>\n<p><img src=\"/image/%E5%9C%B0%E5%9D%80%E6%A0%8F/dns.png\" alt=\"demo1\"></p>\n<p>ä¸Šå›¾å…¶å®å¾ˆå¥½çš„è§£ç­”äº†DNSçš„æ•´ä¸ªè§£æè¿‡ç¨‹ã€‚</p>\n<ol>\n<li>ä»æµè§ˆå™¨è·å–ç¼“å­˜ç»“æœã€‚</li>\n<li>å¦‚æœæµè§ˆå™¨æ²¡æœ‰ç¼“å­˜å°±ä»æœ¬åœ°ç³»ç»Ÿçš„ç¼“å­˜ä¸­è¯»å–ï¼Œæ¯”å¦‚hostæ–‡ä»¶ç­‰ç­‰ï¼Œåƒæˆ‘ä»¬å¹³å¸¸ä¸ŠGitHubå¦‚æœæ…¢çš„è¯æˆ‘ä»¬éƒ½ä¼šä¿®æ”¹hostæ–‡ä»¶ï¼Œç»™ä»–é…ä¸€ä¸ªå¿«ä¸€ç‚¹çš„ipä¹‹ç±»çš„ç­‰ç­‰ã€‚</li>\n<li>ç„¶åæ˜¯å›¾é‡Œé¢æ²¡æœ‰æåˆ°çš„è·¯ç”±å™¨ç¼“å­˜ï¼Œä¸€èˆ¬çš„è·¯ç”±å™¨ä¹Ÿä¼šæœ‰è‡ªå·±çš„ç¼“å­˜ã€‚</li>\n<li>è·¯ç”±å™¨ä¹Ÿæ‰¾ä¸åˆ°åªèƒ½å¼€å§‹è§£æäº†ã€‚æœ¬åœ°åŸŸåæœåŠ¡å™¨ä¼šå‘æ ¹åŸŸåæœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œ å¦‚æœæ ¹åŸŸåæœåŠ¡å™¨ä¹Ÿä¸å­˜åœ¨è¯¥åŸŸåæ—¶ï¼Œ æœ¬åœ°åŸŸåä¼šå‘comé¡¶çº§åŸŸåæœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œ ä¾æ¬¡ç±»æ¨ä¸‹å»ã€‚ ç›´åˆ°æœ€åæ‰¾åˆ°ç›®æ ‡ç½‘å€æ‰€å¯¹åº”çš„ IPï¼Œ å¹¶å°†å…¶ç¼“å­˜åˆ°æœ¬åœ°ï¼Œ ä»¥ä¾›ä¸‹æ¬¡ä½¿ç”¨ã€‚</li>\n</ol>\n<h3 id=\"DNSé‡å®šå‘\"><a href=\"#DNSé‡å®šå‘\" class=\"headerlink\" title=\"DNSé‡å®šå‘\"></a>DNSé‡å®šå‘</h3><p>è¿™é‡Œé¡ºä¾¿è¯´ä¸€ä¸‹DNSçš„é‡å®šå‘å§</p>\n<blockquote>\n<p>DNSæ¯æ¬¡è¿”å›çš„ipåœ°å€å¯èƒ½ä¼šä¸ä¸€æ ·ï¼Œå› ä¸ºä¸–ç•Œä¸Šä¸æ˜¯åªæœ‰ä¸€ä¸ªæœºå™¨å¯ä»¥å¤„ç†â€baidu.comâ€çš„è¿™ä¸ªè¯·æ±‚ï¼Œæœ‰å¾ˆå¤šæœºå™¨å¯ä»¥å¤„ç†ï¼ŒDNSåªéœ€è¦è¿”å›å¯ä»¥å¤„ç†çš„æœºå™¨çš„ipåœ°å€å°±å¯ä»¥äº†ã€‚ä¾‹å¦‚å¯ä»¥æ ¹æ®æ¯å°æœºå™¨çš„è´Ÿè½½é‡ï¼Œ è¯¥æœºå™¨ç¦»ç”¨æˆ·åœ°ç†ä½ç½®çš„è·ç¦»ç­‰ç­‰ï¼Œ è¿™ç§è¿‡ç¨‹å°±æ˜¯DNSè´Ÿè½½å‡è¡¡ï¼Œ åˆå«åšDNSé‡å®šå‘ã€‚</p>\n</blockquote>\n<p>å¾ˆç®€å•ï¼Œå‡ ä¸ªä¾‹å­ï¼Œæ¯”å¦‚æˆ‘åœ¨æ•…å®«çš„åŒ—é—¨ï¼Œæ‰“å¼€åœ°å›¾è¦æŸ¥è¯¢æ•…å®«è‚¯å®šä¼šè®©æˆ‘ä»åŒ—é—¨è¿›å»ã€‚è€Œå¦‚æœæˆ‘åœ¨æ•…å®«çš„å—é—¨ï¼Œè¦å¯¼èˆªåˆ°æ•…å®«å°±ä¼šè®©æˆ‘ä»å—é—¨è¿›å»ã€‚</p>\n<h3 id=\"DNSæ±¡æŸ“\"><a href=\"#DNSæ±¡æŸ“\" class=\"headerlink\" title=\"DNSæ±¡æŸ“\"></a>DNSæ±¡æŸ“</h3><p>DNS æ±¡æŸ“ï¼ˆDNS cache pollutionï¼‰ï¼Œ åˆç§°åŸŸåæœåŠ¡å™¨ç¼“å­˜æŠ•æ¯’ï¼ˆDNS cache poisoningï¼‰ï¼Œ æ˜¯æŒ‡ä¸€äº›åˆ»æ„åˆ¶é€ æˆ–æ— æ„ä¸­åˆ¶é€ å‡ºæ¥çš„åŸŸåæœåŠ¡å™¨æ•°æ®åŒ…ï¼Œ æŠŠåŸŸåæŒ‡å¾€<strong>ä¸æ­£ç¡®çš„IPåœ°å€</strong>ã€‚</p>\n<p>æŸäº›ç½‘ç»œè¿è¥å•†ä¸ºäº†æŸäº›ç›®çš„ï¼Œ å¯¹DNSè¿›è¡Œäº†æŸäº›æ“ä½œï¼Œ å¯¼è‡´ä¸Šç½‘çš„ç”¨æˆ·æ— æ³•é€šè¿‡åŸŸåå–å¾—æ­£ç¡®çš„IPåœ°å€ã€‚ æŸäº›å›½å®¶æˆ–åœ°åŒºå‡ºäºæŸäº›ç›®çš„ä¸ºäº†é˜²æ­¢æŸç½‘ç«™è¢«è®¿é—®ï¼Œ è€Œä¸”å…¶åˆæŒæ¡éƒ¨åˆ†å›½é™…DNSæ ¹ç›®å½•æœåŠ¡å™¨æˆ–é•œåƒï¼Œ ä¹Ÿä¼šåˆ©ç”¨æ­¤æ–¹æ³•è¿›è¡Œå±è”½ã€‚ ï¼ˆGoogleã€ Facebookç­‰ï¼‰</p>\n<p>è‡³äºå¦‚æœé˜²æ­¢DNSæ±¡æŸ“ï¼Œ è¿™é‡Œåªè¯´ä¸€ä¸ªæ–¹æ³•å°±æ˜¯ä¿®æ”¹hostsæ–‡ä»¶ï¼Œ å…¶ä»–çš„è‡ªè¡Œæœç´¢å§ã€‚</p>\n<h2 id=\"TCPå»ºç«‹è¿æ¥\"><a href=\"#TCPå»ºç«‹è¿æ¥\" class=\"headerlink\" title=\"TCPå»ºç«‹è¿æ¥\"></a>TCPå»ºç«‹è¿æ¥</h2><p>å…¶å®æˆ‘ä»¬è§£æä¹‹åï¼Œæ‰¾åˆ°çœŸæ­£çš„æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å°±éœ€è¦è·å–ä»–çš„èµ„æºï¼Œæœ€ç®€å•çš„å°±æ˜¯è·å–ä»–çš„HTMLæ–‡ä»¶ï¼Œæ¥æ¸²æŸ“å¯¹å§ï¼Ÿæ€ä¹ˆè·å–å‘¢ï¼Œæˆ‘ä»¬éœ€è¦TCPè¿æ¥æ¥è·å–ã€‚</p>\n<p>è¿™é‡Œæ¶‰åŠåˆ°ä¸‰æ¬¡æ¡æ‰‹ï¼Œå’Œå››æ¬¡æŒ¥æ‰‹ä»¥åŠUDPçš„ä¸€äº›ç»†ä¸€ç‚¹çš„çŸ¥è¯†ç‚¹ã€‚</p>\n<p>è¯´TCPä¹‹å‰æˆ‘æƒ³æŠŠä¸€äº›é‡Œé¢å¯èƒ½ç”¨åˆ°çš„ä¸œè¥¿å…ˆè¯´è¯´æ¸…æ¥šï¼Œæ–¹ä¾¿æŸ¥æ‰¾ã€‚</p>\n<blockquote>\n<p>ä½ç å³tcpæ ‡å¿—ä½ï¼Œæœ‰6ç§æ ‡ç¤ºï¼šSYN(synchronouså»ºç«‹è”æœº) ACK(acknowledgement ç¡®è®¤) PSH(pushä¼ é€) FIN(finishç»“æŸ) RST(reseté‡ç½®) URG(urgentç´§æ€¥)Sequence number(é¡ºåºå·ç ) Acknowledge number(ç¡®è®¤å·ç )</p>\n</blockquote>\n<h3 id=\"ä¸‰æ¬¡æ¡æ‰‹\"><a href=\"#ä¸‰æ¬¡æ¡æ‰‹\" class=\"headerlink\" title=\"ä¸‰æ¬¡æ¡æ‰‹\"></a>ä¸‰æ¬¡æ¡æ‰‹</h3><p><img src=\"/image/%E5%9C%B0%E5%9D%80%E6%A0%8F/woshou.png\" alt=\"demo2\"></p>\n<p>ä¸‰æ¬¡æ¡æ‰‹åŸºæœ¬ä¸Šå°±æ˜¯ğŸ‘†çš„å›¾ç‰‡äº†ï¼Œé‡Œé¢çš„ä½ç åœ¨ä¹‹å‰ä¹Ÿæœ‰è§£é‡Šã€‚</p>\n<p>è¿™é‡Œé‡ç‚¹è¯´ä¸€ä¸‹ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹ğŸ¤ï¼Œè€Œä¸æ˜¯ä¸¤æ¬¡æˆ–è€…å››æ¬¡ã€‚</p>\n<p>Aåœ¨è¡—ä¸Šçœ‹è§äº†éš”äº†100ç±³çš„Bï¼Œï¼ˆæ­£å¸¸æƒ…å†µä¸‹å¦‚æœé¢å¯¹é¢äº¤æµæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯è¡—ä¸Šå¾ˆåµï¼Œå„ç§è½¦é¸£å£°ï¼Œåº—é“ºå¹¿å‘Šå£°ä¹‹ç±»çš„ã€‚ï¼‰æ‰€ä»¥Aæƒ³å’ŒBè¿›è¡Œå¯¹è¯ï¼Œï¼ˆåˆ«é—®é¢˜ä¸ºä»€ä¹ˆä¸æ‰“ç”µè¯ï¼ŒèŠ‚çº¦é’±ï¼ï¼‰</p>\n<p>Aå–Šäº†Bä¸€å£°ï¼Œä¸çŸ¥é“Bå¬ä¸å¬å¾—è§ï¼Œæ‰€ä»¥åªèƒ½åœ¨è¿œå¤„ç­‰Bçš„å›åº”ã€‚</p>\n<p>Bå¬è§äº†ï¼Œä¹Ÿå›åº”äº†Aï¼Œä½†æ˜¯ä»–ä¸çŸ¥é“Aèƒ½ä¸èƒ½å¬è§æ‰€ä»¥ä¹Ÿè¦ç­‰Aå›åº”ã€‚</p>\n<p>ç„¶åAç»™å‡ºäº†å›åº”ï¼Œä¹‹åAå’ŒBå°±å¿«ä¹çš„äº¤æµèµ·æ¥ã€‚</p>\n<p>okï¼Œæˆ‘ä»¬å†æ¦‚æ‹¬ä¸€ä¸‹ã€‚</p>\n<p>å¯¹åº”åˆ°ä¸‰æ¬¡æ¡æ‰‹å°±æ˜¯A -&gt; clientï¼›B-&gt;server</p>\n<ol>\n<li>ç¬¬ä¸€æ¬¡ğŸ¤ï¼ˆAå–ŠBï¼‰æ˜¯ä¸ºäº†ç¡®è®¤ä¸€ä¸‹Bèƒ½ä¸èƒ½å¬è§ï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯è¦ç¡®è®¤æœåŠ¡ç«¯çš„æ¥å—åŠŸèƒ½æ­£ä¸æ­£å¸¸</li>\n<li>ç¬¬äºŒæ¬¡ğŸ¤ï¼ˆBå–ŠAï¼‰æ˜¯å‘Šè¯‰Aï¼Œæˆ‘èƒ½å¬è§ï¼Œç°åœ¨æˆ‘ç°åœ¨çŸ¥é“ä½ èƒ½ä¸èƒ½å¬è§ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡ç«¯å‘Šè¯‰å®¢æˆ·ç«¯æˆ‘æ¥å—åŠŸèƒ½æ­£å¸¸ï¼Œç°åœ¨æˆ‘æƒ³çŸ¥é“ä½ æ¥æ”¶åŠŸèƒ½æ­£ä¸æ­£å¸¸ã€‚</li>\n<li>ç¬¬ä¸‰æ¬¡ğŸ¤ï¼ˆAå–ŠBï¼‰æ˜¯ä¸ºäº†å‘Šè¯‰Bæˆ‘å¬è§äº†ï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯è®©æœåŠ¡ç«¯çŸ¥é“å®¢æˆ·ç«¯çš„æ¥æ”¶åŠŸèƒ½æ­£å¸¸ï¼Œå¹¶ä¸”å¯ä»¥å¼€å§‹ä¼ è¾“ã€‚</li>\n</ol>\n<p>ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œå› ä¸ºåªæœ‰è¿™ä¸‰æ¬¡å¯ä»¥å®Œç¾çš„ç¡®è®¤åŒæ–¹çš„æ¥æ”¶å’Œå‘é€åŠŸèƒ½æ­£å¸¸ã€‚</p>\n<p>ä¸ºä»€ä¹ˆä¸æ˜¯ä¸¤æ¬¡æ¡æ‰‹ï¼ŸæŒ‰ç…§ä¸Šé¢çš„è¯´æ³•ï¼ŒBç›´æ¥å¼€å§‹å‘é€æ•°æ®ï¼Œå¯æ˜¯ä»–æ ¹æœ¬ä¸çŸ¥é“Aèƒ½ä¸èƒ½æ¥æ”¶å•Šï¼Œå‘å‡ºå»å²‚ä¸æ˜¯æµªè´¹äº†ï¼Œå¯¹å§ï¼Ÿä¸‡ä¸€Aä¸èƒ½æ¥æ”¶å‘¢ï¼Ÿæ‰€ä»¥åªèƒ½ç­‰å¾…Açš„å›åº”</p>\n<p>ä¸ºä»€ä¹ˆä¸æ˜¯å››æ¬¡æ¡æ‰‹ï¼Ÿå› ä¸ºä¸‰æ¬¡å°±å·²ç»å®Œæˆäº†ä»–ä»¬äº’ç›¸æƒ³çŸ¥é“çš„ä¿¡æ¯ä¸éœ€è¦ç»§ç»­æµªè´¹èµ„æºäº†ï¼Œèµ¶ç´§å¼€å§‹é€šä¿¡å§ï¼</p>\n<h3 id=\"å››æ¬¡æŒ¥æ‰‹\"><a href=\"#å››æ¬¡æŒ¥æ‰‹\" class=\"headerlink\" title=\"å››æ¬¡æŒ¥æ‰‹\"></a>å››æ¬¡æŒ¥æ‰‹</h3><p>å››æ¬¡æŒ¥æ‰‹å…¶å®åé¢æ‰ä¼šè®²åˆ°ï¼Œä½†æ˜¯å› ä¸ºçŸ¥è¯†ç‚¹æ˜¯ä¸€èµ·çš„ï¼Œæ‰€ä»¥å°±æ”¾åœ¨ä¸€èµ·è®²äº†</p>\n<p>è€è§„çŸ©ï¼Œçœ‹å›¾å’Œä¸Šé¢çš„ä½ç æ„æ€ï¼Œå°±ä¸å¤šè§£é‡Šäº†ã€‚</p>\n<p><img src=\"/image/%E5%9C%B0%E5%9D%80%E6%A0%8F/huishou.png\" alt=\"demo3\"></p>\n<p>è¿™é‡Œé‡ç‚¹è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆæ˜¯å››æ¬¡æŒ¥æ‰‹ğŸ‘‹</p>\n<p>çœ‹å›¾æˆ‘ä»¬å¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹åˆ°å…¶å®å°±å¤šäº†ä¸€æ¬¡æœåŠ¡ç«¯å‘Šè¯‰å®¢æˆ·ç«¯è¦ç»ˆæ­¢çš„æ¶ˆæ¯ã€‚</p>\n<p>è¿˜æ˜¯ä¸¾åˆšåˆšAå’ŒBçš„ä¾‹å­å§ã€‚</p>\n<p>Aè§‰å¾—å’ŒBèŠçš„å·®ä¸å¤šäº†ï¼Œæƒ³ç»“æŸå¯¹è¯ï¼Œå› ä¸ºå¤©è‰²å¾ˆæ™šäº†è¦å›å®¶åƒé¥­ğŸšäº†ã€‚</p>\n<p>æ‰€ä»¥Aå‘Šè¯‰Bï¼Œæˆ‘æƒ³èµ°äº†ï¼Œä¸æƒ³èŠäº†ã€‚</p>\n<p>Bæ”¶åˆ°åå‘Šè¯‰Aï¼Œå¥½çš„ï¼Œæˆ‘çŸ¥é“äº†ï¼Œä½†æ˜¯ä½ ç­‰æˆ‘ä¸€ä¸‹ï¼Œæˆ‘æ’’æ³¡å°¿ï¼Œæ’’å®Œä¸€èµ·èµ°ã€‚</p>\n<p>Bæ’’å®Œå°¿ä¹‹åï¼Œå‘Šè¯‰Aæˆ‘æ’’å®Œå°¿äº†ã€‚</p>\n<p>Aæ”¶åˆ°ä¸¤å¥è¯ï¼ˆ1.Bå¬åˆ°ğŸ‘‚Aæƒ³å›å®¶çš„æ¶ˆæ¯ï¼Œ2.Bæ’’å®Œå°¿ä¹‹åçš„ä¸€å¥è¯ï¼‰åï¼Œå‘Šè¯‰Bï¼Œæˆ‘èµ°äº†ã€‚</p>\n<p>Bå¬åˆ°åä¹Ÿå›å®¶äº†ã€‚</p>\n<p>okï¼Œæˆ‘ä»¬å†æ¦‚æ‹¬ä¸€ä¸‹ã€‚</p>\n<p>å¯¹åº”åˆ°ä¸‰æ¬¡æ¡æ‰‹å°±æ˜¯A -&gt; clientï¼›B-&gt;server</p>\n<ol>\n<li>ç¬¬ä¸€æ¬¡ğŸ‘‹ Aå‘Šè¯‰Bæˆ‘æƒ³å›å®¶åƒé¥­äº†ã€‚ä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯å‘Šè¯‰æœåŠ¡ç«¯ï¼Œæƒ³æ–­å¼€è¿æ¥äº†ã€‚</li>\n<li>ç¬¬äºŒæ¬¡ğŸ‘‹Bå‘Šè¯‰Aæˆ‘æ”¶åˆ°ä½ çš„æ¶ˆæ¯äº†ï¼Œä¸è¿‡æˆ‘å°¿æ‹‰å®Œå°±ä¸€èµ·å›å®¶å§ã€‚ä¹Ÿå°±æ˜¯æœåŠ¡ç«¯å‘Šè¯‰å®¢æˆ·ç«¯æˆ‘æ”¶åˆ°ä½ çš„æ¶ˆæ¯äº†ï¼Œä½†æ˜¯æˆ‘è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæ–‡ä»¶æ²¡æœ‰ä¼ è¾“å®Œï¼Œæå®šäº†å°±å…³é—­é“¾æ¥ã€‚</li>\n<li>ç¬¬ä¸‰æ¬¡ğŸ‘‹Bå‘Šè¯‰Aæˆ‘æ’’å®Œå°¿äº†ã€‚ä¹Ÿå°±æ˜¯æœåŠ¡ç«¯å‘Šè¯‰å®¢æˆ·ç«¯æˆ‘æ–‡ä»¶ä¼ è¾“å®Œäº†ï¼Œå¯ä»¥å…³é—­é“¾æ¥äº†ã€‚</li>\n<li>ç¬¬å››æ¬¡ğŸ‘‹Aå‘Šè¯‰Bä½ çš„ä¸¤å¥è¯éƒ½å¬åˆ°äº†ï¼ˆ1.Bå¬åˆ°äº†Aæƒ³å›å®¶çš„æ¶ˆæ¯ï¼Œ2.Bæ’’å®Œå°¿äº†ï¼‰ã€‚ä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯å‘Šè¯‰æœåŠ¡ç«¯æˆ‘å…³é—­é“¾æ¥äº†ï¼Œä½ ä¹Ÿåˆ«å‘äº†ã€‚</li>\n</ol>\n<p>åŒæ–¹ç»“æŸé“¾æ¥ã€‚</p>\n<p>ç›¸æ¯”äºä¸‰æ¬¡æ¡æ‰‹ï¼Œå¤šå‡ºæ¥çš„é‚£ä¸€æ¬¡å›æ”¶å°±æ˜¯æœåŠ¡ç«¯éœ€è¦æœ‰ä¸€ä¸ªå…³é—­ä¼ è¾“çš„è¿™ä¹ˆä¸€ä¸ªè¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½éœ€è¦æ—¶é—´ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯éœ€è¦ç­‰å¾…ä¼ è¾“ã€‚</p>\n<h3 id=\"UDP\"><a href=\"#UDP\" class=\"headerlink\" title=\"UDP\"></a>UDP</h3><p>è¿™é‡Œè™½ç„¶ä¸åœ¨èŒƒå›´å†…ï¼Œä½†æ˜¯æˆ‘æƒ³è®²éƒ½è®²äº†ï¼Œé¡ºä¾¿å§UDPä¸€èµ·è¯´å§ï¼</p>\n<p>UDPåè®®å…¨ç§°æ˜¯ç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼Œåœ¨ç½‘ç»œä¸­å®ƒä¸TCPåè®®ä¸€æ ·ç”¨äºå¤„ç†æ•°æ®åŒ…ï¼Œæ˜¯ä¸€ç§æ— è¿æ¥çš„åè®®ã€‚åœ¨OSIæ¨¡å‹ä¸­ï¼Œåœ¨ç¬¬å››å±‚â€”â€”ä¼ è¾“å±‚ï¼Œå¤„äºIPåè®®çš„ä¸Šä¸€å±‚ã€‚UDPæœ‰ä¸æä¾›æ•°æ®åŒ…åˆ†ç»„ã€ç»„è£…å’Œä¸èƒ½å¯¹æ•°æ®åŒ…è¿›è¡Œæ’åºçš„ç¼ºç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æŠ¥æ–‡å‘é€ä¹‹åï¼Œæ˜¯æ— æ³•å¾—çŸ¥å…¶æ˜¯å¦å®‰å…¨å®Œæ•´åˆ°è¾¾çš„ã€‚</p>\n<p>å®ƒæœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š</p>\n<h4 id=\"1-é¢å‘æ— è¿æ¥\"><a href=\"#1-é¢å‘æ— è¿æ¥\" class=\"headerlink\" title=\"1.é¢å‘æ— è¿æ¥\"></a>1.é¢å‘æ— è¿æ¥</h4><p>é¦–å…ˆ UDP æ˜¯ä¸éœ€è¦å’Œ TCPä¸€æ ·åœ¨å‘é€æ•°æ®å‰è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥çš„ï¼Œæƒ³å‘æ•°æ®å°±å¯ä»¥å¼€å§‹å‘é€äº†ã€‚å¹¶ä¸”ä¹Ÿåªæ˜¯æ•°æ®æŠ¥æ–‡çš„æ¬è¿å·¥ï¼Œä¸ä¼šå¯¹æ•°æ®æŠ¥æ–‡è¿›è¡Œä»»ä½•æ‹†åˆ†å’Œæ‹¼æ¥æ“ä½œã€‚</p>\n<p>å…·ä½“æ¥è¯´å°±æ˜¯ï¼š</p>\n<ul>\n<li>åœ¨å‘é€ç«¯ï¼Œåº”ç”¨å±‚å°†æ•°æ®ä¼ é€’ç»™ä¼ è¾“å±‚çš„ UDP åè®®ï¼ŒUDP åªä¼šç»™æ•°æ®å¢åŠ ä¸€ä¸ª UDP å¤´æ ‡è¯†ä¸‹æ˜¯ UDP åè®®ï¼Œç„¶åå°±ä¼ é€’ç»™ç½‘ç»œå±‚äº†</li>\n<li>åœ¨æ¥æ”¶ç«¯ï¼Œç½‘ç»œå±‚å°†æ•°æ®ä¼ é€’ç»™ä¼ è¾“å±‚ï¼ŒUDP åªå»é™¤ IP æŠ¥æ–‡å¤´å°±ä¼ é€’ç»™åº”ç”¨å±‚ï¼Œä¸ä¼šä»»ä½•æ‹¼æ¥æ“ä½œ</li>\n</ul>\n<h4 id=\"2-æœ‰å•æ’­ï¼Œå¤šæ’­ï¼Œå¹¿æ’­çš„åŠŸèƒ½\"><a href=\"#2-æœ‰å•æ’­ï¼Œå¤šæ’­ï¼Œå¹¿æ’­çš„åŠŸèƒ½\" class=\"headerlink\" title=\"2.æœ‰å•æ’­ï¼Œå¤šæ’­ï¼Œå¹¿æ’­çš„åŠŸèƒ½\"></a>2.æœ‰å•æ’­ï¼Œå¤šæ’­ï¼Œå¹¿æ’­çš„åŠŸèƒ½</h4><p>UDP ä¸æ­¢æ”¯æŒä¸€å¯¹ä¸€çš„ä¼ è¾“æ–¹å¼ï¼ŒåŒæ ·æ”¯æŒä¸€å¯¹å¤šï¼Œå¤šå¯¹å¤šï¼Œå¤šå¯¹ä¸€çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯è¯´ UDP æä¾›äº†å•æ’­ï¼Œå¤šæ’­ï¼Œå¹¿æ’­çš„åŠŸèƒ½ã€‚</p>\n<h4 id=\"3-UDPæ˜¯é¢å‘æŠ¥æ–‡çš„\"><a href=\"#3-UDPæ˜¯é¢å‘æŠ¥æ–‡çš„\" class=\"headerlink\" title=\"3.UDPæ˜¯é¢å‘æŠ¥æ–‡çš„\"></a>3.UDPæ˜¯é¢å‘æŠ¥æ–‡çš„</h4><p>å‘é€æ–¹çš„UDPå¯¹åº”ç”¨ç¨‹åºäº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œåœ¨æ·»åŠ é¦–éƒ¨åå°±å‘ä¸‹äº¤ä»˜IPå±‚ã€‚UDPå¯¹åº”ç”¨å±‚äº¤ä¸‹æ¥çš„æŠ¥æ–‡ï¼Œæ—¢ä¸åˆå¹¶ï¼Œä¹Ÿä¸æ‹†åˆ†ï¼Œè€Œæ˜¯ä¿ç•™è¿™äº›æŠ¥æ–‡çš„è¾¹ç•Œã€‚å› æ­¤ï¼Œåº”ç”¨ç¨‹åºå¿…é¡»é€‰æ‹©åˆé€‚å¤§å°çš„æŠ¥æ–‡</p>\n<h4 id=\"4-ä¸å¯é æ€§\"><a href=\"#4-ä¸å¯é æ€§\" class=\"headerlink\" title=\"4.ä¸å¯é æ€§\"></a>4.ä¸å¯é æ€§</h4><p>é¦–å…ˆä¸å¯é æ€§ä½“ç°åœ¨æ— è¿æ¥ä¸Šï¼Œé€šä¿¡éƒ½ä¸éœ€è¦å»ºç«‹è¿æ¥ï¼Œæƒ³å‘å°±å‘ï¼Œè¿™æ ·çš„æƒ…å†µè‚¯å®šä¸å¯é ã€‚</p>\n<p>å¹¶ä¸”æ”¶åˆ°ä»€ä¹ˆæ•°æ®å°±ä¼ é€’ä»€ä¹ˆæ•°æ®ï¼Œå¹¶ä¸”ä¹Ÿä¸ä¼šå¤‡ä»½æ•°æ®ï¼Œå‘é€æ•°æ®ä¹Ÿä¸ä¼šå…³å¿ƒå¯¹æ–¹æ˜¯å¦å·²ç»æ­£ç¡®æ¥æ”¶åˆ°æ•°æ®äº†ã€‚</p>\n<p>å†è€…ç½‘ç»œç¯å¢ƒæ—¶å¥½æ—¶åï¼Œä½†æ˜¯ UDP å› ä¸ºæ²¡æœ‰æ‹¥å¡æ§åˆ¶ï¼Œä¸€ç›´ä¼šä»¥æ’å®šçš„é€Ÿåº¦å‘é€æ•°æ®ã€‚å³ä½¿ç½‘ç»œæ¡ä»¶ä¸å¥½ï¼Œä¹Ÿä¸ä¼šå¯¹å‘é€é€Ÿç‡è¿›è¡Œè°ƒæ•´ã€‚è¿™æ ·å®ç°çš„å¼Šç«¯å°±æ˜¯åœ¨ç½‘ç»œæ¡ä»¶ä¸å¥½çš„æƒ…å†µä¸‹å¯èƒ½ä¼šå¯¼è‡´ä¸¢åŒ…ï¼Œä½†æ˜¯ä¼˜ç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œåœ¨æŸäº›å®æ—¶æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼ˆæ¯”å¦‚ç”µè¯ä¼šè®®ï¼‰å°±éœ€è¦ä½¿ç”¨ UDP è€Œä¸æ˜¯ TCPã€‚</p>\n<p>UDPåªæƒ³æŠŠæ•°æ®å‘å‡ºå»ï¼Œå…·ä½“æœ‰æ²¡æœ‰æˆåŠŸä»–ä¸å…³å¿ƒ</p>\n<h4 id=\"5-å¤´éƒ¨å¼€é”€å°ï¼Œä¼ è¾“æ•°æ®æŠ¥æ–‡æ—¶æ˜¯å¾ˆé«˜æ•ˆçš„ã€‚\"><a href=\"#5-å¤´éƒ¨å¼€é”€å°ï¼Œä¼ è¾“æ•°æ®æŠ¥æ–‡æ—¶æ˜¯å¾ˆé«˜æ•ˆçš„ã€‚\" class=\"headerlink\" title=\"5.å¤´éƒ¨å¼€é”€å°ï¼Œä¼ è¾“æ•°æ®æŠ¥æ–‡æ—¶æ˜¯å¾ˆé«˜æ•ˆçš„ã€‚\"></a>5.å¤´éƒ¨å¼€é”€å°ï¼Œä¼ è¾“æ•°æ®æŠ¥æ–‡æ—¶æ˜¯å¾ˆé«˜æ•ˆçš„ã€‚</h4><p>UDP å¤´éƒ¨åŒ…å«äº†ä»¥ä¸‹å‡ ä¸ªæ•°æ®ï¼š</p>\n<ul>\n<li>ä¸¤ä¸ªåå…­ä½çš„ç«¯å£å·ï¼Œåˆ†åˆ«ä¸ºæºç«¯å£ï¼ˆå¯é€‰å­—æ®µï¼‰å’Œç›®æ ‡ç«¯å£</li>\n<li>æ•´ä¸ªæ•°æ®æŠ¥æ–‡çš„é•¿åº¦</li>\n<li>æ•´ä¸ªæ•°æ®æŠ¥æ–‡çš„æ£€éªŒå’Œï¼ˆIPv4 å¯é€‰ å­—æ®µï¼‰ï¼Œè¯¥å­—æ®µç”¨äºå‘ç°å¤´éƒ¨ä¿¡æ¯å’Œæ•°æ®ä¸­çš„é”™è¯¯</li>\n</ul>\n<p>å› æ­¤ UDP çš„å¤´éƒ¨å¼€é”€å°ï¼Œåªæœ‰å…«å­—èŠ‚ï¼Œç›¸æ¯” TCP çš„è‡³å°‘äºŒåå­—èŠ‚è¦å°‘å¾—å¤šï¼Œåœ¨ä¼ è¾“æ•°æ®æŠ¥æ–‡æ—¶æ˜¯å¾ˆé«˜æ•ˆçš„</p>\n<h4 id=\"6-æ€»ç»“\"><a href=\"#6-æ€»ç»“\" class=\"headerlink\" title=\"6.æ€»ç»“\"></a>6.æ€»ç»“</h4><table>\n<thead>\n<tr>\n<th></th>\n<th>UDP</th>\n<th>TCP</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>æ˜¯å¦è¿æ¥</td>\n<td>æ— è¿æ¥</td>\n<td>é¢å‘è¿æ¥</td>\n</tr>\n<tr>\n<td>æ˜¯å¦å¯é </td>\n<td>ä¸å¯é ä¼ è¾“ï¼Œä¸ä½¿ç”¨æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶</td>\n<td>å¯é ä¼ è¾“ï¼Œä½¿ç”¨æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶</td>\n</tr>\n<tr>\n<td>è¿æ¥å¯¹è±¡ä¸ªæ•°</td>\n<td>æ”¯æŒä¸€å¯¹ä¸€ï¼Œä¸€å¯¹å¤šï¼Œå¤šå¯¹ä¸€å’Œå¤šå¯¹å¤šäº¤äº’é€šä¿¡</td>\n<td>åªèƒ½æ˜¯ä¸€å¯¹ä¸€é€šä¿¡</td>\n</tr>\n<tr>\n<td>ä¼ è¾“æ–¹å¼</td>\n<td>é¢å‘æŠ¥æ–‡</td>\n<td>é¢å‘å­—èŠ‚æµ</td>\n</tr>\n<tr>\n<td>é¦–éƒ¨å¼€é”€</td>\n<td>é¦–éƒ¨å¼€é”€å°ï¼Œä»…8å­—èŠ‚</td>\n<td>é¦–éƒ¨æœ€å°20å­—èŠ‚ï¼Œæœ€å¤§60å­—èŠ‚</td>\n</tr>\n<tr>\n<td>é€‚ç”¨åœºæ™¯</td>\n<td>é€‚ç”¨äºå®æ—¶åº”ç”¨ï¼ˆIPç”µè¯ã€è§†é¢‘ä¼šè®®ã€ç›´æ’­ç­‰ï¼‰</td>\n<td>é€‚ç”¨äºè¦æ±‚å¯é ä¼ è¾“çš„åº”ç”¨ï¼Œä¾‹å¦‚æ–‡ä»¶ä¼ è¾“</td>\n</tr>\n</tbody></table>\n<h2 id=\"SSL-TLSåŠ å¯†\"><a href=\"#SSL-TLSåŠ å¯†\" class=\"headerlink\" title=\"SSL/TLSåŠ å¯†\"></a>SSL/TLSåŠ å¯†</h2><p>åœ¨HTTPè¯·æ±‚ä¹‹å‰ï¼Œå¦‚æœæœ‰åŠ å¯†çš„ï¼ˆå°±æ˜¯HTTPSï¼‰ï¼Œéœ€è¦å…ˆç¡®è®¤ä¸€ä¸‹åŒæ–¹æ˜¯å¦æ˜¯è‡ªå·±æƒ³è¦æ‰¾çš„é‚£ä¸ªäººã€‚</p>\n<p>æ€ä¹ˆçŸ¥é“é‚£ä¸ªä»–æ˜¯ä¸æ˜¯è‡ªå·±è¦æ‰¾çš„äººå‘¢ï¼Ÿæœ‰ä¸¤ç§æ–¹æ³•ï¼šå¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†</p>\n<h3 id=\"å¯¹ç§°åŠ å¯†\"><a href=\"#å¯¹ç§°åŠ å¯†\" class=\"headerlink\" title=\"å¯¹ç§°åŠ å¯†\"></a>å¯¹ç§°åŠ å¯†</h3><p>å¯¹ç§°åŠ å¯†å…¶å®å°±æ˜¯Aå’ŒBéƒ½æœ‰ä¸€ä¸ªè§£å¯†çš„è§„åˆ™ï¼ŒåŒæ–¹éƒ½å¿ƒçŸ¥è‚šæ˜ã€‚è¿™æ ·å°±å¯ä»¥è§£å¯†ã€‚</p>\n<p>å¯¹ç§°åŠ å¯†çš„ä¸€å¤§ç¼ºç‚¹æ˜¯å¯†é’¥çš„ç®¡ç†ä¸åˆ†é…ï¼Œæ¢å¥è¯è¯´ï¼Œå¦‚ä½•æŠŠå¯†é’¥å‘é€åˆ°éœ€è¦è§£å¯†ä½ çš„æ¶ˆæ¯çš„äººçš„æ‰‹é‡Œæ˜¯ä¸€ä¸ªé—®é¢˜ã€‚åœ¨å‘é€å¯†é’¥çš„è¿‡ç¨‹ä¸­ï¼Œå¯†é’¥æœ‰å¾ˆå¤§çš„é£é™©ä¼šè¢«é»‘å®¢ä»¬æ‹¦æˆªã€‚ç°å®ä¸­é€šå¸¸çš„åšæ³•æ˜¯å°†å¯¹ç§°åŠ å¯†çš„å¯†é’¥è¿›è¡Œéå¯¹ç§°åŠ å¯†ï¼Œç„¶åä¼ é€ç»™éœ€è¦å®ƒçš„äººã€‚</p>\n<h3 id=\"éå¯¹ç§°åŠ å¯†\"><a href=\"#éå¯¹ç§°åŠ å¯†\" class=\"headerlink\" title=\"éå¯¹ç§°åŠ å¯†\"></a>éå¯¹ç§°åŠ å¯†</h3><p>é‚£ä¹ˆä»€ä¹ˆæ˜¯éå¯¹ç§°åŠ å¯†å‘¢ï¼Ÿ</p>\n<p>éå¯¹ç§°åŠ å¯†ä¸ºæ•°æ®çš„åŠ å¯†ä¸è§£å¯†æä¾›äº†ä¸€ä¸ªéå¸¸å®‰å…¨çš„æ–¹æ³•ï¼Œå®ƒä½¿ç”¨äº†ä¸€å¯¹å¯†é’¥ï¼Œå…¬é’¥ï¼ˆpublic keyï¼‰å’Œç§é’¥ï¼ˆprivate keyï¼‰ã€‚ç§é’¥åªèƒ½ç”±ä¸€æ–¹å®‰å…¨ä¿ç®¡ï¼Œä¸èƒ½å¤–æ³„ï¼Œè€Œå…¬é’¥åˆ™å¯ä»¥å‘ç»™ä»»ä½•è¯·æ±‚å®ƒçš„äººã€‚éå¯¹ç§°åŠ å¯†ä½¿ç”¨è¿™å¯¹å¯†é’¥ä¸­çš„ä¸€ä¸ªè¿›è¡ŒåŠ å¯†ï¼Œè€Œè§£å¯†åˆ™éœ€è¦å¦ä¸€ä¸ªå¯†é’¥ã€‚æ¯”å¦‚ï¼Œä½ å‘é“¶è¡Œè¯·æ±‚å…¬é’¥ï¼Œé“¶è¡Œå°†å…¬é’¥å‘ç»™ä½ ï¼Œä½ ä½¿ç”¨å…¬é’¥å¯¹æ¶ˆæ¯åŠ å¯†ï¼Œé‚£ä¹ˆåªæœ‰ç§é’¥çš„æŒæœ‰äººâ€“é“¶è¡Œæ‰èƒ½å¯¹ä½ çš„æ¶ˆæ¯è§£å¯†ã€‚ä¸å¯¹ç§°åŠ å¯†ä¸åŒçš„æ˜¯ï¼Œé“¶è¡Œä¸éœ€è¦å°†ç§é’¥é€šè¿‡ç½‘ç»œå‘é€å‡ºå»ï¼Œå› æ­¤å®‰å…¨æ€§å¤§å¤§æé«˜ã€‚</p>\n<h3 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h3><p>æ‰€ä»¥åŸºæœ¬ä¸Šéƒ½æ˜¯å…ˆç”¨éå¯¹ç§°åŠ å¯†ä¼ è¾“å¯¹ç§°åŠ å¯†çš„ç§˜é’¥ã€‚</p>\n<h2 id=\"HTTPè¯·æ±‚\"><a href=\"#HTTPè¯·æ±‚\" class=\"headerlink\" title=\"HTTPè¯·æ±‚\"></a>HTTPè¯·æ±‚</h2><p>HTTPè¯·æ±‚å¾—åˆ°èµ„æºæ–‡ä»¶ï¼Œå¦‚æœæœ‰gzipå‹ç¼©çš„è¯è¿˜éœ€è¦è§£å‹ï¼Œç„¶åæ˜¯ä¸€äº›HTTPå°çš„é›¶ç¢çŸ¥è¯†ç‚¹ã€‚</p>\n<h3 id=\"HTTPæŠ¥æ–‡\"><a href=\"#HTTPæŠ¥æ–‡\" class=\"headerlink\" title=\"HTTPæŠ¥æ–‡\"></a>HTTPæŠ¥æ–‡</h3><p>HTTP æŠ¥æ–‡æ˜¯ç”± è¯·æ±‚æŠ¥æ–‡+å“åº”æŠ¥æ–‡ å…±åŒç»„æˆ</p>\n<ul>\n<li>è¯·æ±‚æŠ¥æ–‡ï¼š<ul>\n<li>å®šä¹‰ï¼šæ‰€æœ‰ç»è¿‡ä¼ è¾“åè®®ï¼Œå®¢æˆ·ç«¯ä¼ é€’ç»™æœåŠ¡å™¨çš„å†…å®¹ï¼Œéƒ½è¢«æˆä¸ºè¯·æ±‚æŠ¥æ–‡</li>\n<li>åŒ…å«ï¼š<ul>\n<li>èµ·å§‹è¡Œ</li>\n<li>è¯·æ±‚å¤´ï¼ˆè¯·æ±‚é¦–éƒ¨ï¼‰</li>\n<li>è¯·æ±‚ä¸»ä½“</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>å“åº”æŠ¥æ–‡ï¼š<ul>\n<li>å®šä¹‰ï¼šæ‰€æœ‰ç»è¿‡ä¼ è¾“åè®®ï¼ŒæœåŠ¡å™¨è¿”å›ç»™å®¢æˆ·ç«¯çš„å†…å®¹ï¼Œéƒ½è¢«æˆä¸ºå“åº”æŠ¥æ–‡</li>\n<li>åŒ…å«ï¼š<ul>\n<li>HTTPçŠ¶æ€ç </li>\n<li>å“åº”å¤´</li>\n<li>å“åº”ä¸»ä½“</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"HTTPçŠ¶æ€ç \"><a href=\"#HTTPçŠ¶æ€ç \" class=\"headerlink\" title=\"HTTPçŠ¶æ€ç \"></a>HTTPçŠ¶æ€ç </h3><p>1~5å¼€å¤´ï¼Œä¸‰ä½æ•°å­—</p>\n<ul>\n<li>1 å¼€å¤´çš„ä»£è¡¨å¤„ç†ä¸­ï¼Œä¸€èˆ¬è§ä¸åˆ°</li>\n<li>2å¼€å¤´ï¼šéƒ½æ˜¯æˆåŠŸ<ul>\n<li>200ï¼šOKï¼šæˆåŠŸ</li>\n<li>201ï¼šCREATEDï¼šä¸€èˆ¬åº”ç”¨äºå‘Šè¯‰æœåŠ¡å™¨åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œæœ€åæœåŠ¡å™¨åˆ›å»ºæˆåŠŸåè¿”å›çš„çŠ¶æ€ç </li>\n<li>204ï¼šNO CONTENTï¼šå¯¹äºæŸäº›è¯·æ±‚ï¼ˆä¾‹å¦‚ï¼šPUTæˆ–è€…DELETEï¼‰ï¼ŒæœåŠ¡å™¨ä¸æƒ³å¤„ç†ï¼Œå¯ä»¥è¿”å›ç©ºå†…å®¹ï¼Œå¹¶ä¸”ç”¨204çŠ¶æ€ç å‘ŠçŸ¥</li>\n</ul>\n</li>\n<li>3å¼€å¤´ï¼šä»£è¡¨æˆåŠŸï¼Œåªä¸è¿‡ä¸­é—´éœ€è¦ä¸­è½¬ä¸€ä¸‹<ul>\n<li>301ï¼šMoved Permanentlyï¼šæ°¸ä¹…é‡å®šå‘ï¼ˆæ°¸ä¹…è½¬ç§»ï¼‰</li>\n<li>302ï¼šMoved Temporarilyï¼šä¸´æ—¶è½¬ç§»ï¼Œå¾ˆæ—©ä»¥å‰åŸºæœ¬ä¸Šç”¨302æ¥åšï¼Œä½†æ˜¯ç°åœ¨ä¸»è¦ç”¨307æ¥å¤„ç†è¿™ä¸ªäº‹æƒ…ï¼Œ</li>\n<li>307çš„æ„æ€å°±æ˜¯ä¸´æ—¶é‡å®šå‘Temporary Redirect =&gt;ä¸»è¦ç”¨äºï¼šæœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡ç­‰</li>\n<li>304ï¼šNot Modifiedï¼šè®¾ç½®HTTPçš„åå•†ç¼“å­˜</li>\n</ul>\n</li>\n<li>4å¼€å¤´ï¼šéƒ½æ˜¯å¤±è´¥<ul>\n<li>400ï¼šBad Requestï¼šä¼ é€’ç»™æœåŠ¡å™¨çš„å‚æ•°é”™è¯¯</li>\n<li>401ï¼šUnauthorizedï¼šæ— æƒé™è®¿é—®</li>\n<li>404ï¼šNot Foundï¼šè¯·æ±‚åœ°å€é”™è¯¯</li>\n</ul>\n</li>\n<li>5å¼€å¤´ï¼šéƒ½æ˜¯å¤±è´¥<ul>\n<li>500ï¼šInternal Server Errorï¼šæœªçŸ¥æœåŠ¡å™¨é”™è¯¯</li>\n<li>503ï¼šService Unavailableï¼šæœåŠ¡å™¨è¶…è´Ÿè·</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"HTTPè¯·æ±‚æ–¹å¼\"><a href=\"#HTTPè¯·æ±‚æ–¹å¼\" class=\"headerlink\" title=\"HTTPè¯·æ±‚æ–¹å¼\"></a>HTTPè¯·æ±‚æ–¹å¼</h3><p>å…¶å®æ­£å¸¸ä¼šè¯´åˆ°ä»€ä¹ˆ<code>POST</code>, <code>GET</code>ä¹‹ç±»çš„ï¼Œä½†æ˜¯æˆ‘è¿™é‡Œæƒ³è¯´ä¸€ä¸‹corsé‡Œé¢çš„ä¸œè¥¿ã€‚</p>\n<p>è¿˜æ˜¯æœ¬ç€æ—¢ç„¶å­¦åˆ°è¿™é‡Œé¡ºè·¯æææ¸…æ¥š</p>\n<p>æµè§ˆå™¨å°†CORSè¯·æ±‚åˆ†æˆä¸¤ç±»ï¼šç®€å•è¯·æ±‚ï¼ˆsimple requestï¼‰å’Œéç®€å•è¯·æ±‚ï¼ˆnot-so-simple requestï¼‰ã€‚</p>\n<h4 id=\"ç®€å•è¯·æ±‚\"><a href=\"#ç®€å•è¯·æ±‚\" class=\"headerlink\" title=\"ç®€å•è¯·æ±‚\"></a>ç®€å•è¯·æ±‚</h4><p>åªè¦åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤å¤§æ¡ä»¶ï¼Œå°±å±äºç®€å•è¯·æ±‚ã€‚</p>\n<blockquote>\n<p>ï¼ˆ1) è¯·æ±‚æ–¹æ³•æ˜¯ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ä¹‹ä¸€ï¼š</p>\n<ul>\n<li>HEAD</li>\n<li>GET</li>\n<li>POST</li>\n</ul>\n<p>ï¼ˆ2ï¼‰HTTPçš„å¤´ä¿¡æ¯ä¸è¶…å‡ºä»¥ä¸‹å‡ ç§å­—æ®µï¼š</p>\n<ul>\n<li>Accept</li>\n<li>Accept-Language</li>\n<li>Content-Language</li>\n<li>Last-Event-ID</li>\n<li>Content-Typeï¼šåªé™äºä¸‰ä¸ªå€¼<code>application/x-www-form-urlencoded</code>ã€<code>multipart/form-data</code>ã€<code>text/plain</code></li>\n</ul>\n</blockquote>\n<h4 id=\"éç®€å•è¯·æ±‚\"><a href=\"#éç®€å•è¯·æ±‚\" class=\"headerlink\" title=\"éç®€å•è¯·æ±‚\"></a>éç®€å•è¯·æ±‚</h4><p>å‡¡æ˜¯ä¸åŒæ—¶æ»¡è¶³ä¸Šé¢ä¸¤ä¸ªæ¡ä»¶ï¼Œå°±å±äºéç®€å•è¯·æ±‚ã€‚</p>\n<p>éç®€å•è¯·æ±‚æ˜¯é‚£ç§å¯¹æœåŠ¡å™¨æœ‰ç‰¹æ®Šè¦æ±‚çš„è¯·æ±‚ï¼Œæ¯”å¦‚è¯·æ±‚æ–¹æ³•æ˜¯<code>PUT</code>æˆ–<code>DELETE</code>ï¼Œæˆ–è€…<code>Content-Type</code>å­—æ®µçš„ç±»å‹æ˜¯<code>application/json</code>ã€‚</p>\n<p>éç®€å•è¯·æ±‚çš„CORSè¯·æ±‚ï¼Œä¼šåœ¨æ­£å¼é€šä¿¡ä¹‹å‰ï¼Œå¢åŠ ä¸€æ¬¡HTTPæŸ¥è¯¢è¯·æ±‚ï¼Œç§°ä¸ºâ€é¢„æ£€â€è¯·æ±‚ï¼ˆpreflightï¼‰ã€‚</p>\n<p>æµè§ˆå™¨å…ˆè¯¢é—®æœåŠ¡å™¨ï¼Œå½“å‰ç½‘é¡µæ‰€åœ¨çš„åŸŸåæ˜¯å¦åœ¨æœåŠ¡å™¨çš„è®¸å¯åå•ä¹‹ä¸­ï¼Œä»¥åŠå¯ä»¥ä½¿ç”¨å“ªäº›HTTPåŠ¨è¯å’Œå¤´ä¿¡æ¯å­—æ®µã€‚åªæœ‰å¾—åˆ°è‚¯å®šç­”å¤ï¼Œæµè§ˆå™¨æ‰ä¼šå‘å‡ºæ­£å¼çš„<code>XMLHttpRequest</code>è¯·æ±‚ï¼Œå¦åˆ™å°±æŠ¥é”™ã€‚</p>\n<p>ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„è·¨åŸŸï¼Œè¿™ä¸ªé—®é¢˜å¯ä»¥äº¤ç”±åç«¯çš„åŒå­¦è®¾ç½®ç™½åå•æˆ–è€…è¿ç»´çš„åŒå­¦è®¾ç½®ã€‚</p>\n<p>å¦‚æœæ˜¯å‰ç«¯çš„åŒå­¦åšè¿™ç§è·¨åŸŸçš„é—®é¢˜çš„è¯ä¸å¤ªæ–¹ä¾¿</p>\n<p>æ¯”å¦‚</p>\n<ul>\n<li><p><strong>JSONP</strong></p>\n</li>\n<li><h4 id=\"document-domain-iframeè·¨åŸŸ\"><a href=\"#document-domain-iframeè·¨åŸŸ\" class=\"headerlink\" title=\"document.domain + iframeè·¨åŸŸ\"></a><strong>document.domain + iframeè·¨åŸŸ</strong></h4></li>\n<li><h4 id=\"location-hash-iframeè·¨åŸŸ\"><a href=\"#location-hash-iframeè·¨åŸŸ\" class=\"headerlink\" title=\"location.hash + iframeè·¨åŸŸ\"></a><strong>location.hash + iframeè·¨åŸŸ</strong></h4></li>\n<li><h4 id=\"window-name-iframeè·¨åŸŸ\"><a href=\"#window-name-iframeè·¨åŸŸ\" class=\"headerlink\" title=\"window.name + iframeè·¨åŸŸ\"></a><strong>window.name + iframeè·¨åŸŸ</strong></h4></li>\n<li><h4 id=\"postMessageè·¨åŸŸ\"><a href=\"#postMessageè·¨åŸŸ\" class=\"headerlink\" title=\"postMessageè·¨åŸŸ\"></a><strong>postMessageè·¨åŸŸ</strong></h4></li>\n</ul>\n<p>ä½†æ˜¯åŸºæœ¬ä¸Šæˆ‘ä»¬å¸¸ç”¨çš„å°±æ˜¯<code>JSONP</code></p>\n<p>å…·ä½“è¿™äº›æ–¹æ³•å’Œåœºæ™¯æœ‰æœºä¼šçš„è¯å…·ä½“è¯´ä¸€ä¸‹ã€‚</p>\n<h2 id=\"æ–­å¼€TCPè¿æ¥\"><a href=\"#æ–­å¼€TCPè¿æ¥\" class=\"headerlink\" title=\"æ–­å¼€TCPè¿æ¥\"></a>æ–­å¼€TCPè¿æ¥</h2><p>ä¹Ÿå°±æ˜¯ä¹‹å‰çš„å››æ¬¡æŒ¥æ‰‹ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ä¸Šé¢çš„è¯´çš„å››æ¬¡æŒ¥æ‰‹</p>\n<h2 id=\"æµè§ˆå™¨æ¸²æŸ“é¡µé¢\"><a href=\"#æµè§ˆå™¨æ¸²æŸ“é¡µé¢\" class=\"headerlink\" title=\"æµè§ˆå™¨æ¸²æŸ“é¡µé¢\"></a>æµè§ˆå™¨æ¸²æŸ“é¡µé¢</h2><p>æ–‡ä»¶è§£ç æˆåŠŸåä¼šæ­£å¼å¼€å§‹æ¸²æŸ“æµç¨‹ï¼Œå…ˆä¼šæ ¹æ® HTML æ„å»º DOM æ ‘ï¼Œæœ‰ CSS çš„è¯ä¼šå»æ„å»º CSSOM æ ‘ã€‚å¦‚æœé‡åˆ° script æ ‡ç­¾çš„è¯ï¼Œä¼šåˆ¤æ–­æ˜¯å¦å­˜åœ¨ async æˆ–è€… defer ï¼Œå‰è€…ä¼šå¹¶è¡Œè¿›è¡Œä¸‹è½½å¹¶æ‰§è¡Œ JSï¼Œåè€…ä¼šå…ˆä¸‹è½½æ–‡ä»¶ï¼Œç„¶åç­‰å¾… HTML è§£æå®Œæˆåé¡ºåºæ‰§è¡Œã€‚</p>\n<p>å¦‚æœä»¥ä¸Šéƒ½æ²¡æœ‰ï¼Œå°±ä¼šé˜»å¡ä½æ¸²æŸ“æµç¨‹ç›´åˆ° JS æ‰§è¡Œå®Œæ¯•ã€‚é‡åˆ°æ–‡ä»¶ä¸‹è½½çš„ä¼šå»ä¸‹è½½æ–‡ä»¶ï¼Œè¿™é‡Œå¦‚æœä½¿ç”¨ HTTP/2 åè®®çš„è¯ä¼šæå¤§çš„æé«˜å¤šå›¾çš„ä¸‹è½½æ•ˆç‡ã€‚</p>\n<p>CSSOM æ ‘å’Œ DOM æ ‘æ„å»ºå®Œæˆåä¼šå¼€å§‹ç”Ÿæˆ Render æ ‘ï¼Œè¿™ä¸€æ­¥å°±æ˜¯ç¡®å®šé¡µé¢å…ƒç´ çš„å¸ƒå±€ã€æ ·å¼ç­‰ç­‰è¯¸å¤šæ–¹é¢çš„ä¸œè¥¿</p>\n<p>åœ¨ç”Ÿæˆ Render æ ‘çš„è¿‡ç¨‹ä¸­ï¼Œæµè§ˆå™¨å°±å¼€å§‹è°ƒç”¨ GPU ç»˜åˆ¶ï¼Œåˆæˆå›¾å±‚ï¼Œå°†å†…å®¹æ˜¾ç¤ºåœ¨å±å¹•ä¸Šäº†ã€‚</p>\n<h1 id=\"æ€»ç»“-1\"><a href=\"#æ€»ç»“-1\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h1><ol>\n<li>URLè§£æ</li>\n<li>DNSè§£æ</li>\n<li>å»ºç«‹è¿æ¥</li>\n<li>å¦‚æœæœ‰åŠ å¯†çš„è¯è¦å…ˆè§£å¯†</li>\n<li>ç„¶åhttpè¯·æ±‚è·å–èµ„æº</li>\n<li>æ–­å¼€è¿æ¥</li>\n<li>å¾—åˆ°èµ„æºä¹‹åå¦‚æœæœ‰gzipå‹ç¼©è¦å…ˆè§£å‹</li>\n<li>ç„¶åå…ˆæ„å»ºDOMæ ‘ï¼ŒCSSæ ‘ã€‚ä¸‹è½½JSæ–‡ä»¶ï¼Œç„¶åä¸‹è½½å›¾ç‰‡ã€‚ç„¶åç”ŸæˆRenderæ ‘ï¼Œæœ€åç¡®å®šå¸ƒå±€ï¼ŒGPUç»˜åˆ¶ã€‚</li>\n</ol>\n<h1 id=\"ç´¢å¼•\"><a href=\"#ç´¢å¼•\" class=\"headerlink\" title=\"ç´¢å¼•\"></a>ç´¢å¼•</h1><blockquote>\n<p><a href=\"https://www.ruanyifeng.com/blog/2016/04/cors.html\" target=\"_blank\" rel=\"noopener\">https://www.ruanyifeng.com/blog/2016/04/cors.html</a></p>\n<p>å‰ç«¯é¢è¯•ä¹‹é“ï¼ˆæ˜é‡‘å°å†Œ</p>\n<p><a href=\"https://juejin.im/post/6844904162166063118#heading-30\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/6844904162166063118#heading-30</a></p>\n</blockquote>\n"},{"title":"ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ","date":"2020-08-25T15:05:00.000Z","cover":"/image/cover/web.jpeg","_content":"\næœ€è¿‘åœ¨å†™ã€é‡æ‹¾å‰ç«¯ã€‘ç³»åˆ—ï¼Œä¸‹é¢æœ‰å‡ ä¸ªå¿«é€Ÿé€šé“ï¼Œå¤§å®¶è‡ªå–\n\n[ã€é‡è¯†å‰ç«¯ã€‘åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿](https://juejin.im/post/6850418113944420359)\n\n[ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—](https://juejin.im/post/6850418117508759566)\n\n[ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this](https://juejin.im/post/6854573215658803208)\n\n[ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šJavaScriptçš„æ‰§è¡Œæœºåˆ¶](https://juejin.im/post/6859911609633767438)\n\n[ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC](https://juejin.im/post/6860375101322461198)\n\n[ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ](https://juejin.im/post/6865204092877144077)\n\n## å‰è¨€\n\nç”¨äºè®°å½•æœ¬äººçš„å­¦ä¹ è¿‡ç¨‹ï¼Œå¸Œæœ›å¯ä»¥å¸®åŠ©åˆ°å¤§å®¶~ğŸ¤ \n\nJavaScriptæœ‰è‡ªåŠ¨åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå¯èƒ½å› ä¸ºè¿™ä¸ªè‡ªåŠ¨è®©æˆ‘ä»¬å‰ç«¯å¼€å‘äººå‘˜å¿½ç•¥äº†å¯¹ä»–çš„è®¤è¯†ï¼ˆåŒ…æ‹¬æˆ‘è‡ªå·±ï¼‰ï¼Œä½†æ˜¯é˜¿é‡Œçš„é¢è¯•å®˜å¯ä¸ä¼šå’Œä½ å˜»å˜»å“ˆå“ˆã€‚\n\nâ€œåƒåœ¾å›æ”¶çš„æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿä»€ä¹ˆæ—¶å€™ä¼šå»è§¦å‘â€\n\næˆ‘ä¸€è„¸æ‡µé€¼....å•¥...è¿™ä¸ªä¸æ˜¯ä»–è‡ªå·±è¿è¡Œçš„å—...ğŸ¤•\n\nè¿˜æ˜¯è€è§„çŸ©ï¼Œé»„é‡‘åœˆæ³•åˆ™ï¼š\n\n### ä¸ºä»€ä¹ˆæœ‰åƒåœ¾å›æ”¶â™»ï¸ï¼Œæˆ–è€…è¯´åƒåœ¾å›æ”¶çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ\n\nè®¡ç®—æœºåœ¨å¯åŠ¨ä¸€ä¸ªç¨‹åºçš„æ—¶å€™ï¼Œä¼šä¸ºä»–åˆ†é…ä¸€å—å†…å­˜ï¼Œç”¨æ¥å­˜æ”¾ä»£ç ã€è¿è¡Œä¸­çš„æ•°æ®å’Œä¸€ä¸ªæ‰§è¡Œä»»åŠ¡çš„ä¸»çº¿ç¨‹ã€‚æˆ‘ä»¬çŸ¥é“ç”µè„‘çš„å†…å­˜å…¶å®æ˜¯æœ‰é™çš„ï¼Œæ¯”å¦‚å¸¸è§çš„8Gã€16Gç­‰ç­‰ï¼Œç”šè‡³è¿˜æœ‰ä¸€äº›ä»€ä¹ˆè™šæ‹Ÿå†…å­˜å°±è®¨è®ºäº†ã€‚æˆ‘ä»¬å…³æ³¨ç‚¹åœ¨äºå†…å­˜æ˜¯ä¸€ä¸ªç§ç¨€ç¼ºèµ„æºï¼Œå¯¹äºä¸ç”¨çš„ä¸œè¥¿æˆ‘ä»¬ä¸è¦#å ç€èŒ…å‘ä¸æ‹‰å±#ã€‚\n\n**æ‰€ä»¥åƒåœ¾å›æ”¶çš„ä½œç”¨å°±æ˜¯é‡Šæ”¾ä¸€ä¸‹ä¸å†ä½¿ç”¨çš„å†…å­˜ç©ºé—´ã€‚**\n\n### å†…å­˜çš„ç»“æ„\n\nJavaScriptä¸­ï¼Œåˆ†ä¸ºä¸¤ç§å†…å­˜ç©ºé—´\n\n- å †å†…å­˜->å­˜å‚¨å¼•ç”¨ç±»å‹\n- æ ˆå†…å­˜->å­˜å‚¨åŸºæœ¬ç±»å‹\n\n> åŸºæœ¬ç±»å‹åˆå«åŸå§‹ç±»å‹ï¼›å› ä¸ºæœ¬äººå·²ç»è¯´ä¹ æƒ¯äº†åŸºæœ¬ç±»å‹ï¼Œæ‰€ä»¥ä»¥ä¸‹éƒ½å«åšåŸºæœ¬ç±»å‹å“ˆã€‚\n\n\n\n## å¼•ç”¨ç±»å‹ã€åŸºæœ¬ç±»å‹ä¸å †æ ˆçš„çˆ±æ¨çº è‘›\n\n### å˜é‡å­˜æ”¾\n\n#### åŸºæœ¬ç±»å‹\n\næˆªæ­¢åŒ—äº¬æ—¶é—´2020å¹´8æœˆ25æ—¥ï¼›\n\nåœ¨[MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Data_structures)ä¸­æ˜¾ç¤ºçš„åŸºæœ¬ç±»å‹ï¼ˆåŸå§‹ç±»å‹ï¼‰æœ‰ä»¥ä¸‹7ç§\n\n- [Boolean](https://developer.mozilla.org/zh-CN/docs/Glossary/Boolean)\n- [Null](https://developer.mozilla.org/zh-CN/docs/Glossary/Null)\n- [Undefined](https://developer.mozilla.org/zh-CN/docs/Glossary/undefined)\n- [Number](https://developer.mozilla.org/zh-CN/docs/Glossary/Number)\n- [BigInt](https://developer.mozilla.org/zh-CN/docs/Glossary/BigInt)\n- [String](https://developer.mozilla.org/zh-CN/docs/Glossary/å­—ç¬¦ä¸²)\n- [Symbol](https://developer.mozilla.org/zh-CN/docs/Glossary/Symbol) \n\nåŸºæœ¬ç±»å‹æ˜¯å­˜å‚¨åœ¨æ ˆå†…å­˜é‡Œé¢çš„ã€‚æ ˆå†…å­˜é‡Œé¢è¿˜å­˜ç€æŒ‡å‘å †å†…å­˜çš„å†…å­˜åœ°å€ã€‚\n\n> PSï¼šé—­åŒ…ä¸­ï¼ŒåŸºæœ¬ç±»å‹ä¹Ÿæ˜¯å­˜æ”¾åœ¨å †å†…å­˜ä¸­çš„å“¦ï¼Œè¦æ³¨æ„ä¸€ä¸‹ã€‚\n\n#### å¼•ç”¨ç±»å‹\n\né™¤äº†åŸºæœ¬ç±»å‹çš„æ•°æ®ç»“æ„å°±æ˜¯å¼•ç”¨ç±»å‹ï¼ŒåŒ…æ‹¬ä»€ä¹ˆæ•°ç»„ï¼ˆArrayï¼‰ã€å‡½æ•°ï¼ˆFunctionï¼‰ã€å¯¹è±¡ï¼ˆObjectï¼‰ä¹‹ç±»çš„éƒ½æ˜¯å¼•ç”¨ç±»å‹ã€‚\n\nå¼•ç”¨ç±»å‹å’Œé—­åŒ…çš„å˜é‡éƒ½æ˜¯å­˜å‚¨åœ¨å †å†…å­˜ä¸­çš„ã€‚è€ŒæŒ‡é’ˆæˆ–è€…è¯´å†…å­˜åœ°å€æ˜¯å­˜åœ¨æ ˆå†…å­˜çš„ã€‚\n\n> å½“æŸ¥è¯¢å¼•ç”¨ç±»å‹çš„å˜é‡æ—¶ï¼Œ å…ˆä»**æ ˆä¸­è¯»å–å†…å­˜åœ°å€**ï¼Œ ç„¶åå†é€šè¿‡åœ°å€**æ‰¾åˆ°å †ä¸­çš„å€¼**ã€‚å¯¹äºè¿™ç§ï¼Œæˆ‘ä»¬æŠŠå®ƒå«åšæŒ‰å¼•ç”¨è®¿é—®ã€‚\n\nå¹²è¯´æœ‰ç‚¹éš¾ç†è§£ã€‚èº«ä¸ºé©¬è‰¯çš„æˆ‘ç»™å¤§å®¶ç”»ä¸€å¹…ç”»ï¼Œå¸®åŠ©ç†è§£ã€‚\n\n```js\nvar a = 123;\nvar b = true;\nvar c = null;\nvar d = '123';\nvar e = undefined;\nvar f = Symbol();\nvar g = 123n;\nvar h = new Date();\n// å­—å¤ªä¸‘äº†ã€‚ã€‚ã€‚ä»£ç å¯ä»¥çœ‹è¿™é‡Œ\n```\n\n![1](/image/æ·±å…¥å†…å­˜ä¸–ç•Œ/1.jpeg)\n\n\n\n### å †å†…å­˜å’Œæ ˆå†…å­˜çš„æ€»ç»“\n\n| **æ ˆå†…å­˜**                   | å †å†…å­˜                       |\n| ---------------------------- | ---------------------------- |\n| å­˜å‚¨åŸºç¡€æ•°æ®ç±»å‹ä»¥åŠå†…å­˜åœ°å€ | å­˜å‚¨å¼•ç”¨æ•°æ®ç±»å‹ä»¥åŠé—­åŒ…å˜é‡ |\n| æŒ‰å€¼è®¿é—®                     | æŒ‰å¼•ç”¨ï¼ˆå†…å­˜åœ°å€ï¼‰è®¿é—®       |\n| å­˜å‚¨çš„å€¼å¤§å°å›ºå®š             | å­˜å‚¨çš„å€¼å¤§å°ä¸å®šï¼Œå¯åŠ¨æ€è°ƒæ•´ |\n| ç”±ç³»ç»Ÿè‡ªåŠ¨åˆ†é…å†…å­˜ç©ºé—´       | ç”±ä»£ç è¿›è¡ŒæŒ‡å®šåˆ†é…           |\n| ç©ºé—´å°ï¼Œè¿è¡Œæ•ˆç‡é«˜           | ç©ºé—´å¤§ï¼Œè¿è¡Œæ•ˆç‡ç›¸å¯¹è¾ƒä½     |\n\n\n\n## æ·±æ‹·è´ã€æµ…æ‹·è´ã€èµ‹å€¼é“äººä¸‰é¡¹çš„ä¸è§£æ¸Šæº\n\n### èµ‹å€¼\n\nèµ‹å€¼åˆ†ä¸¤ç§æƒ…å†µï¼š\n\n1. åˆ›å»ºæ–°å€¼\n\n   ```js\n   var a = 123;\n   var b = [1, 2, 3];\n   ```\n\n   è¿™ç§å°±æ˜¯èµ‹æ–°å€¼çš„æƒ…å†µã€‚\n\n2. èµ‹å€¼å·²æœ‰çš„å˜é‡çš„å€¼\n\n   åœ¨ä¸Šé¢çš„ä¾‹å­åŸºç¡€ä¸Šä¿®æ”¹ä¸€ä¸‹ã€‚\n\n   ```js\n   var a = 123;\n   var b = [1, 2, 3];\n   var A = a;\n   var B = b;\n   ```\n\n   è¿™ç§æƒ…å†µå°±æ˜¯èµ‹å€¼å·²æœ‰å˜é‡ã€‚\n\nğŸ‘Œï¼Œæ¥ä¸‹æ¥æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œè¿˜æ˜¯æŠŠğŸ‘†çš„ğŸŒ°ä¿®æ”¹ä¸€ä¸‹\n\n```js\nvar a = 123;\nvar b = [1, 2, 3];\nvar A = a;\nvar B = b;\n\nA = 1234;\nconsole.log(a);\nconsole.log(A);\nB.push(4);\nconsole.log(b);\nconsole.log(B);\n```\n\n\n\nå¸¦ğŸ”¥è‡ªå·±æ‰“å¼€æ§åˆ¶å°ï¼Œå‚ä¸è¿›æ¥ï¼çœ‹å®Œä¹‹åç„¶åå†çœ‹çœ‹å’Œè‡ªå·±çš„ç†è§£æ˜¯ä¸æ˜¯ä¸€æ ·ï¼Œå¦‚æœæ˜¯ä¸€æ ·çš„è¯ï¼Œè¯´æ˜ä½ å¾ˆğŸ‘ï¼Œä¸æ˜¯çš„è¯å°±ä¸€èµ·æ¥çœ‹çœ‹ğŸ‘‡çš„è§£é‡Šå§ã€‚\n\næˆ‘ä»¬è§‚å¯Ÿä¹‹åå‘ç°ï¼Œæˆ‘ä»¬åªä¿®æ”¹äº†`B`ä½†æ˜¯ï¼Œæˆ‘ä»¬è‹±ä¿Šçš„`b`ä¹Ÿè¢«ä¿®æ”¹äº†ã€‚\n\nï¼Ÿï¼Ÿï¼Ÿï¼ˆè„‘è¡¥é»‘äººé—®å·è„¸ï¼‰\n\nå…¶å®æˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­è‚¯å®šæ˜¯ä¸å¸Œæœ›è¿™ç§æƒ…å†µçš„å‘ç”Ÿçš„ï¼Œæˆ‘ä»¬ä¿®æ”¹çš„åªæ˜¯`B`ï¼Œä¸å¸Œæœ›ä¿®æ”¹`b`çš„ï¼Œä¸ç„¶æˆ‘ä»¬è‚¯å®šä¼šå†™`b.push(4)`ã€‚\n\nè¿™æ—¶å°±éœ€è¦ç”¨åˆ°é“äººä¸‰é¡¹çš„å¦å¤–ä¸¤ä¸ªé¡¹ç›®ï¼šæµ…æ‹·è´å’Œæ·±æ‹·è´ã€‚\n\n### æµ…æ‹·è´å’Œæ·±æ‹·è´\n\nåˆšåˆšè¯´åˆ°å¼•ç”¨ç±»å‹å…¶å®æ˜¯æ”¾åœ¨å †å†…å­˜ä¸­çš„ï¼Œè€Œæ ˆå†…å­˜é‡Œé¢åªå­˜æŒ‡å‘å †å†…å­˜çš„åœ°å€ã€‚ï¼ˆæœ‰ç‚¹æ‹—å£....ğŸ§˜â€â™‚ï¸ï¼‰\n\næµ…æ‹·è´æµ…æ‹·è´ï¼Œé¡¾åæ€ä¹‰ã€‚å°±æ˜¯æµ…ä¸€ç‚¹çš„æ‹·è´ï¼Œæœ‰å¤šæµ…å‘¢ï¼Ÿ\n\nä¸€å±‚é‚£ä¹ˆæµ…ã€‚\n\nä¹Ÿå°±æ˜¯è¯´é™¤äº†ç¬¬ä¸€å±‚çš„ä¸œè¥¿ï¼Œç¬¬ä¸€å±‚ä¹‹å¤–æ›´æ·±çš„å±‚çº§å°±ä¸æ˜¯æ‹·è´äº†ï¼Œå«æ‹¿åˆ«äººçš„åœ°å€ã€‚\n\nå£è¯´æ— å‡­ï¼Œæˆ‘å¼„ä¸ªdemoç»™å¤§å®¶ğŸ”¥see seeã€‚\n\n![2](/image/æ·±å…¥å†…å­˜ä¸–ç•Œ/2.png)\n\nå¯ä»¥å¾ˆæ¸…æ™°ï¼Œæ¸…æ™°çš„ä¸èƒ½å†æ¸…æ™°çš„çœ‹åˆ°ï¼Œæµ…æ‹·è´å‡ºæ¥çš„å¯¹è±¡é‡Œé¢çš„å±æ€§`b`å…¶å®è¿˜æ˜¯æŒ‡å‘ä¹‹å‰çš„å¯¹è±¡ï¼Œä¹‹å‰è¯´è¿‡ï¼Œå†æ·±çš„ä»–å°±ä¸æ‹·è´äº†ï¼ŒéªŒè¯çš„è¯å°±äº¤ç»™å¤§å®¶äº†ï¼Œæ¯•ç«Ÿæˆ‘ä»¬æ˜¯ä¸€ä¸ªåŠ¨æ‰‹èŠ‚ç›®ç»„ï¼\n\né‚£ä¹ˆæµ…æ‹·è´æœ‰å“ªäº›æ–¹æ³•å‘¢ï¼Ÿ\n\n1. Object.assign()\n2. es6çš„æ‰©å±•è¿ç®—ç¬¦`{...xxx}`\n3. Array.prototype.slice()\n\n### æ·±æ‹·è´\n\nçœ‹çœ‹æˆ‘é‚£ä¸ªå®Œç¾çš„å›¾å°±å·²ç»çŸ¥é“äº†ï¼Œæ·±æ‹·è´å°±æ˜¯å®Œç¾çš„å¼„ä¸€ä¸ªä¸€æ¨¡ä¸€æ ·çš„å‡ºæ¥ã€‚\n\nå¸…å“¥å¸…å“¥ï¼Œæ·±æ‹·è´æœ‰å•¥åŠæ³•æï¼Ÿ\n\n1. JSON.parse(JSON.stringify(object))\n   1. ä¼šå¿½ç•¥ `undefined`\n   2.  ä¼šå¿½ç•¥ `symbol`\n   3. ä¸èƒ½åºåˆ—åŒ–å‡½æ•°\n   4. ä¸èƒ½è§£å†³å¾ªç¯å¼•ç”¨çš„å¯¹è±¡\n   5. ä¸èƒ½æ­£ç¡®å¤„ç†`new Date()\n   6. ä¸èƒ½å¤„ç†æ­£åˆ™\n2. è‡ªå·±å†™ä¸€ä¸ªé€’å½’ç„¶åç–¯ç‹‚æµ…æ‹·è´....\n3. ç»ˆææ–¹æ¡ˆï¼šlodashçš„[`cloneDeep`](https://www.lodashjs.com/docs/lodash.cloneDeep)\n\n### æ€»ç»“\n\n|        | å’ŒåŸæ•°æ®æ˜¯å¦æŒ‡å‘åŒä¸€å¯¹è±¡ | ç¬¬ä¸€å±‚æ•°æ®ä¸ºåŸºæœ¬æ•°æ®ç±»å‹ | åŸæ•°æ®ä¸­åŒ…å«å­å¯¹è±¡       |\n| ------ | ------------------------ | ------------------------ | ------------------------ |\n| èµ‹å€¼   | æ˜¯                       | æ”¹å˜ä¼šä½¿åŸæ•°æ®ä¸€èµ·æ”¹å˜   | æ”¹å˜ä¼šä½¿åŸæ•°æ®ä¸€èµ·æ”¹å˜   |\n| æµ…æ‹·è´ | å¦                       | æ”¹å˜ä¸ä¼šä½¿åŸæ•°æ®ä¸€èµ·æ”¹å˜ | æ”¹å˜ä¼šä½¿åŸæ•°æ®ä¸€èµ·æ”¹å˜   |\n| æ·±æ‹·è´ | å¦                       | æ”¹å˜ä¸ä¼šä½¿åŸæ•°æ®ä¸€èµ·æ”¹å˜ | æ”¹å˜ä¸ä¼šä½¿åŸæ•°æ®ä¸€èµ·æ”¹å˜ |\n\n ## åƒåœ¾å›æ”¶æœºåˆ¶â™»ï¸\n\nJavaScriptæœ‰è‡ªåŠ¨åƒåœ¾æ”¶é›†æœºåˆ¶ï¼Œåƒåœ¾æ”¶é›†å™¨ä¼šæ¯éš”ä¸€æ®µæ—¶é—´æˆ–è€…è¾¾åˆ°æŸä¸ªé˜ˆå€¼å°±æ‰§è¡Œä¸€æ¬¡é‡Šæ”¾æ“ä½œï¼Œæ‰¾å‡ºé‚£äº›ä¸å†ç»§ç»­ä½¿ç”¨çš„å€¼ï¼Œç„¶åé‡Šæ”¾å…¶å ç”¨çš„å†…å­˜ã€‚\n\n### åˆ¤æ–­æ–¹å¼\n\nJavaScriptæ˜¯æ€ä¹ˆåˆ¤æ–­æŸä¸ªå˜é‡æ˜¯å¦éœ€è¦è¢«å›æ”¶çš„ï¼Ÿ\n\næœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•\n\n### æ ‡è®°æ¸…é™¤\n\næ¯”å¦‚ä¸€ä¸ªå‡½æ•°å†…éƒ¨å£°æ˜çš„ä¸€ä¸ªå˜é‡ï¼Œä¸€æ—¦æˆ‘ä»¬çš„ä¸»çº¿ç¨‹ç¦»å¼€äº†è¿™ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å£°æ˜çš„ä¸€äº›å˜é‡å¤–éƒ¨å°±æ— æ³•ç”¨åˆ°ï¼Œé‚£ä¹ˆå°±ä¼šè¢«æ ‡è®°ä¸º\"ç¦»å¼€ç¯å¢ƒ\"ã€‚è¿™æ ·åœ¨ä¸‹ä¸€ä¸ªåƒåœ¾å›æ”¶å‘¨æœŸæ¥é¢†çš„æ—¶å€™ï¼Œå°±è‡ªåŠ¨é‡Šæ”¾äº†è¿™äº›å˜é‡å ç”¨çš„å†…å­˜ã€‚\n\n### å¼•ç”¨è®¡æ•°\n\nå¦ä¸€ç§ä¸å¤ªå¸¸è§çš„åƒåœ¾æ”¶é›†ç­–ç•¥å«åšå¼•ç”¨è®¡æ•°(reference counting)ã€‚å¼•ç”¨è®¡æ•°çš„å«ä¹‰æ˜¯è·Ÿè¸ªè®°å½•æ¯ ä¸ªå€¼è¢«å¼•ç”¨çš„æ¬¡æ•°ã€‚å½“å£°æ˜äº†ä¸€ä¸ªå˜é‡å¹¶å°†ä¸€ä¸ªå¼•ç”¨ç±»å‹å€¼èµ‹ç»™è¯¥å˜é‡æ—¶ï¼Œåˆ™è¿™ä¸ªå€¼çš„å¼•ç”¨æ¬¡æ•°å°±æ˜¯ 1ã€‚ å¦‚æœåŒä¸€ä¸ªå€¼åˆè¢«èµ‹ç»™å¦ä¸€ä¸ªå˜é‡ï¼Œåˆ™è¯¥å€¼çš„å¼•ç”¨æ¬¡æ•°åŠ  1ã€‚ç›¸åï¼Œå¦‚æœåŒ…å«å¯¹è¿™ä¸ªå€¼å¼•ç”¨çš„å˜é‡åˆå– å¾—äº†å¦å¤–ä¸€ä¸ªå€¼ï¼Œåˆ™è¿™ä¸ªå€¼çš„å¼•ç”¨æ¬¡æ•°å‡ 1ã€‚å½“è¿™ä¸ªå€¼çš„å¼•ç”¨æ¬¡æ•°å˜æˆ 0 æ—¶ï¼Œåˆ™è¯´æ˜æ²¡æœ‰åŠæ³•å†è®¿é—®è¿™ ä¸ªå€¼äº†ï¼Œå› è€Œå°±å¯ä»¥å°†å…¶å ç”¨çš„å†…å­˜ç©ºé—´å›æ”¶å›æ¥ã€‚è¿™æ ·ï¼Œå½“åƒåœ¾æ”¶é›†å™¨ä¸‹æ¬¡å†è¿è¡Œæ—¶ï¼Œå®ƒå°±ä¼šé‡Šæ”¾é‚£ äº›å¼•ç”¨æ¬¡æ•°ä¸ºé›¶çš„å€¼æ‰€å ç”¨çš„å†…å­˜ã€‚\n\nå¼•ç”¨è®¡æ•°æœ‰ä¸€ä¸ªéå¸¸ä¸¥é‡çš„BUGå°±æ˜¯ï¼Œå¦‚æœå­˜åœ¨å¾ªç¯å¼•ç”¨çš„è¯ï¼Œç³»ç»Ÿå°±æ— æ³•åˆ¤æ–­ä½ è¿™ä¸ªå†…å­˜åˆ°åº•è¦ä¸è¦å›æ”¶äº†ã€‚è€Œä¸”å¼•ç”¨çš„æ•°å­—æ°¸è¿œéƒ½ä¸ä¼šæ˜¯0ã€‚ä¸¾ä¸ªä¾‹å­\n\n```js\nvar element = document.getElementById(\"some_element\"); \nvar myObject = new Object();\nmyObject.element = element;\nelement.someObject = myObject;\n```\n\nè¿™æ ·çš„è¯`element`å’Œ`myObject`è¿™å¯¹æƒ…ä¾£å°±æ°¸è¿œå¦‚èƒ¶ä¼¼æ¼†ï¼Œç³»ç»Ÿæ— æ³•å°†ä»–ä»¬é€ä¸Šå¤©å ‚ã€‚\n\né‚£å’‹åŠï¼Ÿè¦æ‹†æ•£ä»–ä»¬æœ‰ä¸€ä¸ªä¸»æ„ï¼Œå°±æ˜¯åœ¨ä¸ç”¨çš„æ—¶å€™ç»™ä»–ä»¬ç½®ä¸º`null`\n\n```js\nmyObject.element = null; \nelement.someObject = null;\n```\n\nå°†å˜é‡è®¾ç½®ä¸º null æ„å‘³ç€åˆ‡æ–­å˜é‡ä¸å®ƒæ­¤å‰å¼•ç”¨çš„å€¼ä¹‹é—´çš„è¿æ¥ã€‚å½“åƒåœ¾æ”¶é›†å™¨ä¸‹æ¬¡è¿è¡Œæ—¶ï¼Œå°± ä¼šåˆ é™¤è¿™äº›å€¼å¹¶å›æ”¶å®ƒä»¬å ç”¨çš„å†…å­˜ã€‚\n\næ’æ’­ä¸€ä¸ªå°æ•…äº‹\n\n> IE çš„åƒåœ¾æ”¶é›†å™¨æ˜¯æ ¹æ®å†…å­˜åˆ†é…é‡è¿è¡Œçš„ï¼Œå…·ä½“ ä¸€ç‚¹è¯´å°±æ˜¯ 256 ä¸ªå˜é‡ã€4096 ä¸ªå¯¹è±¡(æˆ–æ•°ç»„)å­—é¢é‡å’Œæ•°ç»„å…ƒç´ (slot)æˆ–è€… 64KB çš„å­—ç¬¦ä¸²ã€‚è¾¾åˆ° ä¸Šè¿°ä»»ä½•ä¸€ä¸ªä¸´ç•Œå€¼ï¼Œåƒåœ¾æ”¶é›†å™¨å°±ä¼šè¿è¡Œã€‚è¿™ç§å®ç°æ–¹å¼çš„é—®é¢˜åœ¨äºï¼Œå¦‚æœä¸€ä¸ªè„šæœ¬ä¸­åŒ…å«é‚£ä¹ˆå¤šå˜ é‡ï¼Œé‚£ä¹ˆè¯¥è„šæœ¬å¾ˆå¯èƒ½ä¼šåœ¨å…¶ç”Ÿå‘½å‘¨æœŸä¸­ä¸€ç›´ä¿æœ‰é‚£ä¹ˆå¤šçš„å˜é‡ã€‚è€Œè¿™æ ·ä¸€æ¥ï¼Œåƒåœ¾æ”¶é›†å™¨å°±ä¸å¾—ä¸é¢‘ ç¹åœ°è¿è¡Œã€‚ç»“æœï¼Œç”±æ­¤å¼•å‘çš„ä¸¥é‡æ€§èƒ½é—®é¢˜ä¿ƒä½¿ IE7 é‡å†™äº†å…¶åƒåœ¾æ”¶é›†ä¾‹ç¨‹ã€‚\n>\n> éšç€ IE7 çš„å‘å¸ƒï¼Œå…¶ JavaScript å¼•æ“çš„åƒåœ¾æ”¶é›†ä¾‹ç¨‹æ”¹å˜äº†å·¥ä½œæ–¹å¼:è§¦å‘åƒåœ¾æ”¶é›†çš„å˜é‡åˆ†é…ã€ å­—é¢é‡å’Œ(æˆ–)æ•°ç»„å…ƒç´ çš„ä¸´ç•Œå€¼è¢«è°ƒæ•´ä¸ºåŠ¨æ€ä¿®æ­£ã€‚IE7 ä¸­çš„å„é¡¹ä¸´ç•Œå€¼åœ¨åˆå§‹æ—¶ä¸ IE6 ç›¸ç­‰ã€‚å¦‚æœ åƒåœ¾æ”¶é›†ä¾‹ç¨‹å›æ”¶çš„å†…å­˜åˆ†é…é‡ä½äº 15%ï¼Œåˆ™å˜é‡ã€å­—é¢é‡å’Œ(æˆ–)æ•°ç»„å…ƒç´ çš„ä¸´ç•Œå€¼å°±ä¼šåŠ å€ã€‚å¦‚æœ ä¾‹ç¨‹å›æ”¶äº† 85%çš„å†…å­˜åˆ†é…é‡ï¼Œåˆ™å°†å„ç§ä¸´ç•Œå€¼é‡ç½®å›é»˜è®¤å€¼ã€‚è¿™ä¸€çœ‹ä¼¼ç®€å•çš„è°ƒæ•´ï¼Œæå¤§åœ°æå‡äº† IE åœ¨è¿è¡ŒåŒ…å«å¤§é‡ JavaScript çš„é¡µé¢æ—¶çš„æ€§èƒ½ã€‚\n>\n> ----æ‘˜è‡ªJavaScripté«˜çº§ç¨‹åºè®¾è®¡\n\n## V8åƒåœ¾å›æ”¶ç­–ç•¥\n\n### ä»€ä¹ˆæ˜¯V8ï¼Ÿ\n\nç®€å•ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯V8ï¼Ÿ\n\n> **V8**æ˜¯ä¸€ä¸ªç”±[Google](https://zh.wikipedia.org/wiki/Google)å¼€å‘çš„[å¼€æº](https://zh.wikipedia.org/wiki/å¼€æº)[JavaScriptå¼•æ“](https://zh.wikipedia.org/wiki/JavaScriptå¼•æ“)ï¼Œç”¨äº[Google Chrome](https://zh.wikipedia.org/wiki/Google_Chrome)åŠ[Chromium](https://zh.wikipedia.org/wiki/Chromium)ä¸­[[2\\]](https://zh.wikipedia.org/wiki/V8_(JavaScriptå¼•æ“)#cite_note-comic-2)ã€‚\n>\n> ---æ‘˜è‡ªç»´åŸºç™¾ç§‘\n\næ—¢ç„¶V8æ˜¯Chromeçš„å¼•æ“ï¼Œé‚£ä¹ˆåˆ«çš„æµè§ˆå™¨å‘¢ï¼Ÿ\n\nä¸–ç•Œä¸Šä¸»è¦çš„æµè§ˆå™¨æœ‰ä»¥ä¸‹ä¸‰ç§ã€‚\n\n[**V8**](https://en.wikipedia.org/wiki/V8_(JavaScript_engine))â€”â€”å¼€æºï¼Œç”± Google å¼€å‘ï¼Œä½¿ç”¨ C++ ç¼–å†™\n\n**[SpiderMonkey](https://en.wikipedia.org/wiki/SpiderMonkey_(JavaScript_engine))**â€”â€”ç¬¬ä¸€ä¸ª JavaScript å¼•æ“ï¼Œè¯¥å¼•æ“è¿‡å»é©±åŠ¨ Netscape Navigatorï¼Œå¦‚ä»Šé©±åŠ¨ Firefox æµè§ˆå™¨ã€‚\n\n**[JavaScriptCore](https://en.wikipedia.org/wiki/JavaScriptCore)**â€”â€”å¼€æºï¼Œè‹¹æœå…¬å¸ä¸º Safair æµè§ˆå™¨å¼€å‘çš„\n\n\n\nokokokï¼Œæ”¶ï¼å›å½’åˆå¿ƒã€‚\n\n### V8çš„åƒåœ¾å›æ”¶ç­–ç•¥\n\næˆ‘ä»¬çš„ä¼Ÿå¤§çš„Chromeï¼Œæ ¹æ®ä¸åŒçš„æƒ…å†µæœ‰ä¸åŒçš„å¯¹ç­–ã€‚ä»–æŠŠå†…å­˜åˆ†æˆä¸¤å—\n\n- æ–°ç”Ÿä»£\n- è€ç”Ÿä»£\n\n#### åˆ†ä»£å†…å­˜\n\né»˜è®¤æƒ…å†µä¸‹ï¼Œ32ä½ç³»ç»Ÿæ–°ç”Ÿä»£å†…å­˜å¤§å°ä¸º16MBï¼Œè€ç”Ÿä»£å†…å­˜å¤§å°ä¸º700MBï¼Œ64ä½ç³»ç»Ÿä¸‹ï¼Œæ–°ç”Ÿä»£å†…å­˜å¤§å°ä¸º32MBï¼Œè€ç”Ÿä»£å†…å­˜å¤§å°ä¸º1.4GBã€‚\n\næ–°ç”Ÿä»£å¹³å‡åˆ†æˆä¸¤å—ç›¸ç­‰çš„å†…å­˜ç©ºé—´ï¼Œå«åšsemispaceï¼Œæ¯å—å†…å­˜å¤§å°8MBï¼ˆ32ä½ï¼‰æˆ–16MBï¼ˆ64ä½ï¼‰ã€‚\n\n\n\n#### æ–°ç”Ÿä»£ç®—æ³•\n\né¦–å…ˆï¼Œæˆ‘ä»¬ç§‘æ™®ä¸€ä¸‹ä»€ä¹ˆæ˜¯æ–°ç”Ÿä»£ã€‚\n\næ–°ç”Ÿä»£çš„å†…å­˜å‘¢ï¼Œå°±æ˜¯å­˜æ´»æ—¶é—´æ¯”è¾ƒçŸ­çš„å¯¹è±¡ã€‚å¦‚æœå­˜æ´»çš„æ—¶é—´æ¯”è¾ƒé•¿çš„è¯å°±ä¼šã€Šæ™‹å‡ã€‹ä¸ºè€ç”Ÿä»£ã€‚ç­‰ä¸€ä¸‹ä¼šç¨å¾®è¯¦ç»†çš„è¯´ä¸€ä¸‹ã€Šæ™‹å‡ã€‹è¿™ä¸ªæ¦‚å¿µã€‚\n\næ–°ç”Ÿä»£é‡‡ç”¨**Scavenge GC**åƒåœ¾å›æ”¶ç®—æ³•ï¼Œåœ¨ç®—æ³•å®ç°æ—¶ä¸»è¦é‡‡ç”¨**Cheney**ç®—æ³•ã€‚\n\nCheneyç®—æ³•å‘¢æ˜¯å°†å†…å­˜ä¸€åˆ†ä¸ºäºŒï¼Œä¸€å—æš‚æ—¶æŠŠä»–å«åšã€ŠFromã€‹ï¼Œå¦ä¸€å—æš‚æ—¶å«åšã€ŠToã€‹ã€‚çœ‹ä¸€ä¸‹ä¸‹å›¾ï¼Œå°±å¯ä»¥å¾ˆæ¸…æ™°çš„çŸ¥é“V8æ˜¯æ€ä¹ˆåˆ†å‰²å†…å­˜çš„ã€‚\n\n![3](/image/æ·±å…¥å†…å­˜ä¸–ç•Œ/3.png)\n\nå†…å­˜çš„åˆ°æ¥å…ˆè¿›å…¥Fromï¼Œç„¶åç­‰åˆ°Fromæ»¡äº†ä¹‹åï¼Œæ–°ç”Ÿä»£çš„GCå°±ä¼šå¯åŠ¨ã€‚\n\né¦–å…ˆé‡Šæ”¾æ‰ä¸€äº›ä¸å†ä½¿ç”¨çš„å†…å­˜ï¼Œç„¶åå°†Fromå’ŒToä¸¤ä¸ªåŠŸèƒ½è¿›è¡Œæ›´æ¢ï¼Œä¹Ÿå°±æ˜¯è¯´ä¹‹å‰çš„From -> To  ä¹‹å‰çš„  To -> Fromã€‚è¿™æ ·çš„è¯æ–°ç”Ÿä»£çš„ä¸€è½®GCå°±æ­¤ç»“æŸäº†ã€‚\n\nè¿™ç§ç®—æ³•æœ‰ç‚¹ç±»ä¼¼ç©ºé—´æ¢æ—¶é—´ï¼Œè€Œæ–°ç”Ÿä»£çš„å¯¹è±¡ç”Ÿå‘½ä¸€èˆ¬éƒ½æ˜¯æ¯”è¾ƒçŸ­çš„ï¼Œæ‰€ä»¥æ‰€ä»¥éå¸¸é€‚åˆæ–°ç”Ÿä»£ã€‚\n\n#### æ™‹å‡\n\nå¯¹è±¡çš„æ™‹å‡å…¶å®ä¸»è¦æœ‰ä¸¤ä¸ªè¦æ±‚ï¼Œå°±å¥½åƒåœ¨æ¥P6å‡P7æœ‰ä¸€å †çš„è¦æ±‚ä¸€æ ·ã€‚\n\n1. æ–°ç”Ÿä»£ç®—æ³•åˆšåˆšæˆ‘ä»¬å·²ç»å­¦ä¹ è¿‡äº†ï¼Œå°±æ˜¯Fromå’ŒToçš„äº’æ¢åŠŸèƒ½ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ä»–ç»å†äº†ä¸¤æ¬¡çš„æ–°ç”Ÿä»£çš„æ›´æ›¿ï¼Œè¿˜æ²¡æœ‰è¢«å›æ”¶å†…å­˜ï¼Œè¯´æ˜ä»–å¾ˆå¼ºã€‚å°±éœ€è¦æ™‹å‡ä¸ºè€ç”Ÿä»£ï¼Œè®©è€ç”Ÿä»£çš„ç®—æ³•æ¥å¯¹ä»˜ä»–ã€‚å°±å¥½åƒåœ¨é˜¿é‡Œçš„ä¸€ä¸ªP6ä¸¤è½®361éƒ½æ²¡æœ‰è¢«æ·˜æ±°è¯´æ˜ä»–å¾ˆæœ‰å®åŠ›ï¼Œæ‰€ä»¥ç›´æ¥å‡çº§ä»–ä¸ºP7ã€‚\n2. å¦‚æœä¸€ä¸ªå¯¹è±¡åœ¨Toçš„å†…å­˜å æ¯”è¶…è¿‡äº†25%ï¼Œåœ¨ç¬¬ä¸€æ¬¡æ›´æ›¿çš„æ—¶å€™å°±ç›´æ¥å°†ä»–æ™‹å‡ä¸ºè€ç”Ÿä»£äº†ã€‚å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæŠ€æœ¯å¤§ç‰›ï¼Œåƒé©¬äº‘ï¼Œä¸€å»é˜¿é‡Œå°±è¢«æ˜Ÿæ¢å‘ç°ï¼Œç›´æ¥å°±æ˜¯P7è¯„çº§ï¼Œä¸éœ€è¦ç»è¿‡ä»€ä¹ˆå¤æ‚çš„é¢è¯•æˆ–è€…ä»€ä¹ˆã€‚\n\n\n\n#### è€ç”Ÿä»£ç®—æ³•\n\næ ¹æ®åˆšåˆšå¯¹ã€Šæ™‹å‡ã€‹çš„äº†è§£ï¼Œæˆ‘ä»¬çŸ¥é“äº†åœ¨è€ç”Ÿä»£é‡Œé¢çš„å¯¹è±¡éƒ½æ˜¯ä¸€äº›éš¾ç¼ çš„é€‰æ‰‹ï¼Œæ¯”å¦‚æœ¬æ¥å°±å å†…å­˜æ¯”ä¾‹å¾ˆå¤§ï¼Œæˆ–è€…ç»å†è¿‡2æ¬¡çš„æ–°ç”Ÿä»£GCï¼Œä¾æ—§åšæŒºçš„é€‰æ‰‹ã€‚\n\næ‰€ä»¥ï¼ŒV8åœ¨è€ç”Ÿä»£ä¸­ä¸»è¦é‡‡ç”¨äº†**Mark-Sweep**å’Œ**Mark-Compact**ç›¸ç»“åˆçš„æ–¹å¼è¿›è¡Œåƒåœ¾å›æ”¶ã€‚\n\nåœ¨ä»‹ç»è€ç”Ÿä»£ç®—æ³•ä¹‹å‰ï¼Œå…ˆç§‘æ™®ä¸€ä¸‹**Mark-Sweep**å’Œ**Mark-Compact**ã€‚\n\n##### **Mark-Sweep**\n\nMark-Sweepæ˜¯æ ‡è®°æ¸…é™¤çš„æ„æ€ï¼Œå®ƒåˆ†ä¸ºæ ‡è®°å’Œæ¸…é™¤ä¸¤ä¸ªé˜¶æ®µã€‚\n\nä¸Scavengeä¸åŒï¼ŒMark-Sweepå¹¶ä¸ä¼šå°†å†…å­˜åˆ†ä¸ºä¸¤ä»½ï¼Œæ‰€ä»¥ä¸å­˜åœ¨æµªè´¹ä¸€åŠç©ºé—´çš„è¡Œä¸ºã€‚Mark-Sweepåœ¨æ ‡è®°é˜¶æ®µéå†å †å†…å­˜ä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼Œå¹¶æ ‡è®°æ´»ç€çš„å¯¹è±¡ï¼Œåœ¨éšåçš„æ¸…é™¤é˜¶æ®µï¼Œåªæ¸…é™¤æ²¡æœ‰è¢«æ ‡è®°çš„å¯¹è±¡ã€‚\n\nä¹Ÿå°±æ˜¯è¯´ï¼ŒScavengeåªå¤åˆ¶æ´»ç€çš„å¯¹è±¡ï¼Œè€ŒMark-Sweepåªæ¸…é™¤æ­»äº†çš„å¯¹è±¡ã€‚æ´»å¯¹è±¡åœ¨æ–°ç”Ÿä»£ä¸­åªå è¾ƒå°‘éƒ¨åˆ†ï¼Œæ­»å¯¹è±¡åœ¨è€ç”Ÿä»£ä¸­åªå è¾ƒå°‘éƒ¨åˆ†ï¼Œè¿™å°±æ˜¯ä¸¤ç§å›æ”¶æ–¹å¼éƒ½èƒ½é«˜æ•ˆå¤„ç†çš„åŸå› ã€‚\n\n> åœ¨æ ‡è®°å¤§å‹å¯¹å†…å­˜æ—¶ï¼Œå¯èƒ½éœ€è¦å‡ ç™¾æ¯«ç§’æ‰èƒ½å®Œæˆä¸€æ¬¡æ ‡è®°ã€‚è¿™å°±ä¼šå¯¼è‡´ä¸€äº›æ€§èƒ½ä¸Šçš„é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ2011 å¹´ï¼ŒV8 ä» stop-the-world æ ‡è®°åˆ‡æ¢åˆ°å¢é‡æ ‡å¿—ã€‚åœ¨å¢é‡æ ‡è®°æœŸé—´ï¼ŒGC å°†æ ‡è®°å·¥ä½œåˆ†è§£ä¸ºæ›´å°çš„æ¨¡å—ï¼Œå¯ä»¥è®© JS åº”ç”¨é€»è¾‘åœ¨æ¨¡å—é—´éš™æ‰§è¡Œä¸€ä¼šï¼Œä»è€Œä¸è‡³äºè®©åº”ç”¨å‡ºç°åœé¡¿æƒ…å†µã€‚ä½†åœ¨ 2018 å¹´ï¼ŒGC æŠ€æœ¯åˆæœ‰äº†ä¸€ä¸ªé‡å¤§çªç ´ï¼Œè¿™é¡¹æŠ€æœ¯åä¸ºå¹¶å‘æ ‡è®°ã€‚è¯¥æŠ€æœ¯å¯ä»¥è®© GC æ‰«æå’Œæ ‡è®°å¯¹è±¡æ—¶ï¼ŒåŒæ—¶å…è®¸ JS è¿è¡Œï¼Œä½ å¯ä»¥ç‚¹å‡» [è¯¥åšå®¢](https://v8project.blogspot.com/2018/06/concurrent-marking.html) è¯¦ç»†é˜…è¯»ã€‚\n\n\n\n##### **Mark-Compact**\n\nåœ¨æ¸…é™¤å®Œå¯¹è±¡åï¼Œè¿™äº›å¯¹è±¡åœ¨å†…å­˜å†…éƒ¨å°±ä¸æ˜¯è¿ç»­çš„ã€‚è¿™æ ·å†…å­˜åœ°å€å°±æ— æ³•å¾ˆå¥½åœ°åˆ©ç”¨èµ·æ¥ï¼Œå› ä¸ºä»–ä»¬éœ€è¦è¿ç»­çš„å†…å­˜ï¼Œæœ‰çš„å¤§çš„å¯¹è±¡å°±æ— æ³•å¡å…¥åˆšåˆšé‡Šæ”¾çš„å°å†…å­˜å½“ä¸­ã€‚\n\nè€ŒMark-Compactå°±æ˜¯ç”¨äºè§£å†³å†…å­˜ç¢ç‰‡çš„é—®é¢˜ï¼Œä»–ä¸»è¦å¹²çš„æ´»å°±æ˜¯ç§»åŠ¨è¿™äº›å¯¹è±¡ï¼Œè®©ä»–ä»¬å˜æˆç´§å‡‘èµ·æ¥ã€‚\n\næ¸…é™¤å¯¹è±¡åä¼šé€ æˆå †å†…å­˜å‡ºç°ç¢ç‰‡çš„æƒ…å†µï¼Œå½“ç¢ç‰‡è¶…è¿‡ä¸€å®šé™åˆ¶åä¼šå¯åŠ¨å‹ç¼©ç®—æ³•ã€‚åœ¨å‹ç¼©è¿‡ç¨‹ä¸­ï¼Œå°†æ´»çš„å¯¹è±¡åƒä¸€ç«¯ç§»åŠ¨ï¼Œç›´åˆ°æ‰€æœ‰å¯¹è±¡éƒ½ç§»åŠ¨å®Œæˆç„¶åæ¸…ç†æ‰ä¸éœ€è¦çš„å†…å­˜ã€‚\n\n##### æ€»ç»“\n\nåœ¨V8çš„å›æ”¶ç­–ç•¥ä¸­ï¼ŒMark-Sweepå’ŒMark-Conpactä¸¤è€…æ˜¯ç»“åˆä½¿ç”¨çš„ã€‚\n\nç”±äºMark-Conpactéœ€è¦ç§»åŠ¨å¯¹è±¡ï¼Œæ‰€ä»¥å®ƒçš„æ‰§è¡Œé€Ÿåº¦ä¸å¯èƒ½å¾ˆå¿«ï¼Œåœ¨å–èˆä¸Šï¼ŒV8ä¸»è¦ä½¿ç”¨Mark-Sweepï¼Œåœ¨ç©ºé—´ä¸è¶³ä»¥å¯¹ä»æ–°ç”Ÿä»£ä¸­æ™‹å‡è¿‡æ¥çš„å¯¹è±¡è¿›è¡Œåˆ†é…æ—¶ï¼Œæ‰ä½¿ç”¨Mark-Compactã€‚\n\n\n\n## JavaScriptå†…å­˜æ³„æ¼\n\n### ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼\n\nç¨‹åºçš„è¿è¡Œéœ€è¦å†…å­˜ã€‚åªè¦ç¨‹åºæå‡ºè¦æ±‚ï¼Œæ“ä½œç³»ç»Ÿæˆ–è€…è¿è¡Œæ—¶ï¼ˆruntimeï¼‰å°±å¿…é¡»ä¾›ç»™å†…å­˜ã€‚\n\nå¯¹äºæŒç»­è¿è¡Œçš„æœåŠ¡è¿›ç¨‹ï¼ˆdaemonï¼‰ï¼Œå¿…é¡»åŠæ—¶é‡Šæ”¾ä¸å†ç”¨åˆ°çš„å†…å­˜ã€‚å¦åˆ™ï¼Œå†…å­˜å ç”¨è¶Šæ¥è¶Šé«˜ï¼Œè½»åˆ™å½±å“ç³»ç»Ÿæ€§èƒ½ï¼Œé‡åˆ™å¯¼è‡´è¿›ç¨‹å´©æºƒã€‚\n\n**ä¸å†ç”¨åˆ°çš„å†…å­˜ï¼Œæ²¡æœ‰åŠæ—¶é‡Šæ”¾ï¼Œå°±å«åšå†…å­˜æ³„æ¼**ï¼ˆmemory leakï¼‰ã€‚\n\n### å¸¸è§çš„å†…å­˜æ³„æ¼\n\n1. å®šæ—¶å™¨æœªåŠæ—¶æ¸…é™¤\n\n2. æ„å¤–çš„å…¨å±€å˜é‡\n\n   ```js\n   function foo(arg) {\n       bar = \"this is a hidden global variable\";  // æ„å¤–æŒ‚åœ¨åœ¨ window å…¨å±€å˜é‡ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼\n   }\n   ```\n\n   è¿™é‡Œæ˜¯æƒ³è¯´ä¸€ä¸‹é«˜ç¨‹ï¼ˆJavaScripté«˜çº§ç¨‹åºè®¾è®¡ç¬¬ä¸‰ç‰ˆï¼‰é‡Œé¢çš„ä¸€ä¸ªéå¸¸ç»å…¸çš„demoã€‚\n\n3. é—­åŒ…çš„æ»¥ç”¨\n\n### WeakMapä¸WeakSet\n\nå…¶å®è¿™ä¸¤ä¸ªåœ¨è¿™ç¯‡æ–‡ç« é‡Œé¢çš„æ„ä¹‰ç›¸åŒï¼Œåªéœ€è¦ä»‹ç»ä¸€ä¸ªå°±è¡Œã€‚\n\næˆ‘ä»¬çŸ¥é“Mapæ˜¯ç®€å•çš„key-valueã€‚è€Œä¸”keyå¯ä»¥ä¸ºä»»æ„ç±»å‹ï¼Œæ¯”å¦‚å¼•ç”¨ç±»å‹ï¼Œå¦‚æœæˆ‘ä»¬çš„keyæ˜¯å¼•ç”¨ç±»å‹é‚£ä¹ˆä»–æ‰€å æ®çš„å†…å­˜å°±æ— æ³•è¢«é‡Šæ”¾äº†ã€‚\n\nåˆæœ‰åŒå­¦é—®é¢˜äº†ï¼Œæˆ‘æœ‰æ¯›ç—…å•Šï¼Œæˆ‘éè¦å¼•ç”¨ç±»å‹å—ï¼Ÿæˆ‘stringå’Œnumberä»–ä¸é¦™å—ï¼Ÿ\n\nåŸºæœ¬ä¸Šï¼Œå¦‚æœä½ è¦å¾€å¯¹è±¡ä¸Šæ·»åŠ æ•°æ®ï¼Œåˆä¸æƒ³å¹²æ‰°åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå°±å¯ä»¥ä½¿ç”¨ WeakMapã€‚ä¸€ä¸ªå…¸å‹åº”ç”¨åœºæ™¯æ˜¯ï¼Œåœ¨ç½‘é¡µçš„ DOM å…ƒç´ ä¸Šæ·»åŠ æ•°æ®ï¼Œå°±å¯ä»¥ä½¿ç”¨`WeakMap`ç»“æ„ã€‚å½“è¯¥ DOM å…ƒç´ è¢«æ¸…é™¤ï¼Œå…¶æ‰€å¯¹åº”çš„`WeakMap`è®°å½•å°±ä¼šè‡ªåŠ¨è¢«ç§»é™¤ã€‚\n\n```javascript\nconst wm = new WeakMap();\n\nconst element = document.getElementById('example');\n\nwm.set(element, 'some information');\nwm.get(element) // \"some information\"\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œå…ˆæ–°å»ºä¸€ä¸ª Weakmap å®ä¾‹ã€‚ç„¶åï¼Œå°†ä¸€ä¸ª DOM èŠ‚ç‚¹ä½œä¸ºé”®åå­˜å…¥è¯¥å®ä¾‹ï¼Œå¹¶å°†ä¸€äº›é™„åŠ ä¿¡æ¯ä½œä¸ºé”®å€¼ï¼Œä¸€èµ·å­˜æ”¾åœ¨ WeakMap é‡Œé¢ã€‚è¿™æ—¶ï¼ŒWeakMap é‡Œé¢å¯¹`element`çš„å¼•ç”¨å°±æ˜¯å¼±å¼•ç”¨ï¼Œä¸ä¼šè¢«è®¡å…¥åƒåœ¾å›æ”¶æœºåˆ¶ã€‚\n\nä¹Ÿå°±æ˜¯è¯´ï¼Œä¸Šé¢çš„ DOM èŠ‚ç‚¹å¯¹è±¡çš„å¼•ç”¨è®¡æ•°æ˜¯`1`ï¼Œè€Œä¸æ˜¯`2`ã€‚è¿™æ—¶ï¼Œä¸€æ—¦æ¶ˆé™¤å¯¹è¯¥èŠ‚ç‚¹çš„å¼•ç”¨ï¼Œå®ƒå ç”¨çš„å†…å­˜å°±ä¼šè¢«åƒåœ¾å›æ”¶æœºåˆ¶é‡Šæ”¾ã€‚Weakmap ä¿å­˜çš„è¿™ä¸ªé”®å€¼å¯¹ï¼Œä¹Ÿä¼šè‡ªåŠ¨æ¶ˆå¤±ã€‚\n\næ€»ä¹‹ï¼Œ`WeakMap`çš„ä¸“ç”¨åœºåˆå°±æ˜¯ï¼Œå®ƒçš„é”®æ‰€å¯¹åº”çš„å¯¹è±¡ï¼Œå¯èƒ½ä¼šåœ¨å°†æ¥æ¶ˆå¤±ã€‚`WeakMap`ç»“æ„æœ‰åŠ©äºé˜²æ­¢å†…å­˜æ³„æ¼ã€‚\n\næ›´å¤šçš„çŸ¥è¯†å°±ä¸è®¨è®ºäº†ï¼Œè¿™é‡Œæ˜¯å†…å­˜ä¸–ç•Œï¼ä¸æ˜¯ä»€ä¹ˆWeakMapä¸“åœºå“¦ã€‚\n\næ€ä¹ˆéªŒè¯ï¼Ÿemmmmm....è¿™é‡Œæˆ‘copyä¸€ä¸‹é˜®ä¸€å³°è€å¸ˆçš„å†…å®¹ã€‚\n\n### é˜®è€å¸ˆçš„demo\n\né¦–å…ˆï¼Œæ‰“å¼€ Node å‘½ä»¤è¡Œã€‚\n\n```bash\n$ node --expose-gc\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œ`--expose-gc`å‚æ•°è¡¨ç¤ºå…è®¸æ‰‹åŠ¨æ‰§è¡Œåƒåœ¾å›æ”¶æœºåˆ¶ã€‚\n\nç„¶åï¼Œæ‰§è¡Œä¸‹é¢çš„ä»£ç ã€‚\n\n```javascript\n// æ‰‹åŠ¨æ‰§è¡Œä¸€æ¬¡åƒåœ¾å›æ”¶ï¼Œä¿è¯è·å–çš„å†…å­˜ä½¿ç”¨çŠ¶æ€å‡†ç¡®\n> global.gc();\nundefined\n\n// æŸ¥çœ‹å†…å­˜å ç”¨çš„åˆå§‹çŠ¶æ€ï¼ŒheapUsed ä¸º 4M å·¦å³\n> process.memoryUsage();\n{ rss: 21106688,\n  heapTotal: 7376896,\n  heapUsed: 4153936,\n  external: 9059 }\n\n> let wm = new WeakMap();\nundefined\n\n// æ–°å»ºä¸€ä¸ªå˜é‡ keyï¼ŒæŒ‡å‘ä¸€ä¸ª 5*1024*1024 çš„æ•°ç»„\n> let key = new Array(5 * 1024 * 1024);\nundefined\n\n// è®¾ç½® WeakMap å®ä¾‹çš„é”®åï¼Œä¹ŸæŒ‡å‘ key æ•°ç»„\n// è¿™æ—¶ï¼Œkey æ•°ç»„å®é™…è¢«å¼•ç”¨äº†ä¸¤æ¬¡ï¼Œ\n// å˜é‡ key å¼•ç”¨ä¸€æ¬¡ï¼ŒWeakMap çš„é”®åå¼•ç”¨äº†ç¬¬äºŒæ¬¡\n// ä½†æ˜¯ï¼ŒWeakMap æ˜¯å¼±å¼•ç”¨ï¼Œå¯¹äºå¼•æ“æ¥è¯´ï¼Œå¼•ç”¨è®¡æ•°è¿˜æ˜¯1\n> wm.set(key, 1);\nWeakMap {}\n\n> global.gc();\nundefined\n\n// è¿™æ—¶å†…å­˜å ç”¨ heapUsed å¢åŠ åˆ° 45M äº†\n> process.memoryUsage();\n{ rss: 67538944,\n  heapTotal: 7376896,\n  heapUsed: 45782816,\n  external: 8945 }\n\n// æ¸…é™¤å˜é‡ key å¯¹æ•°ç»„çš„å¼•ç”¨ï¼Œ\n// ä½†æ²¡æœ‰æ‰‹åŠ¨æ¸…é™¤ WeakMap å®ä¾‹çš„é”®åå¯¹æ•°ç»„çš„å¼•ç”¨\n> key = null;\nnull\n\n// å†æ¬¡æ‰§è¡Œåƒåœ¾å›æ”¶\n> global.gc();\nundefined\n\n// å†…å­˜å ç”¨ heapUsed å˜å› 4M å·¦å³ï¼Œ\n// å¯ä»¥çœ‹åˆ° WeakMap çš„é”®åå¼•ç”¨æ²¡æœ‰é˜»æ­¢ gc å¯¹å†…å­˜çš„å›æ”¶\n> process.memoryUsage();\n{ rss: 20639744,\n  heapTotal: 8425472,\n  heapUsed: 3979792,\n  external: 8956 }\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œåªè¦å¤–éƒ¨çš„å¼•ç”¨æ¶ˆå¤±ï¼ŒWeakMap å†…éƒ¨çš„å¼•ç”¨ï¼Œå°±ä¼šè‡ªåŠ¨è¢«åƒåœ¾å›æ”¶æ¸…é™¤ã€‚ç”±æ­¤å¯è§ï¼Œæœ‰äº† WeakMap çš„å¸®åŠ©ï¼Œè§£å†³å†…å­˜æ³„æ¼å°±ä¼šç®€å•å¾ˆå¤šã€‚\n\n## çœ‹å®Œå‡ ä»¶äº‹\n\nå¦‚æœä½ è§‰å¾—å¯¹ä½ æœ‰å¸®åŠ©ï¼Œå°±å¸®æˆ‘ç‚¹ä¸ªèµå§ï¼Œä¹Ÿç®—æ˜¯å¯¹æˆ‘çš„è‚¯å®šã€‚è°¢è°¢ï¼Œå¦‚æœæœ‰é”™è¯¯çš„åœ°æ–¹æ¬¢è¿å¤§å®¶æŒ‡å‡ºæ¥ã€‚ä¸€èµ·è®¨è®ºå­¦ä¹ ã€‚æˆ‘æ˜¯Derrickï¼Œä¸€åæ­£åœ¨å»é˜¿é‡Œè·¯ä¸Šçš„å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆã€‚\n\n## reference\n\n> [https://muyiy.cn/blog/1/1.3.html#%E6%A0%88%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84](https://muyiy.cn/blog/1/1.3.html#æ ˆæ•°æ®ç»“æ„)\n>\n> http://www.ruanyifeng.com/blog/2017/04/memory-leak.html\n>\n> https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Map\n>\n> https://juejin.im/post/6844903615300108302\n>\n> https://juejin.im/post/6844903591510016007\n>\n> JavaScripté«˜çº§ç¨‹åºè®¾è®¡ï¼ˆç¬¬ä¸‰ç‰ˆï¼‰\n\n","source":"_posts/ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ.md","raw":"---\ntitle: ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ\ndate: 2020-08-25 23:05:00\ntags: [JavaScript]\ncategory: [é‡æ‹¾å‰ç«¯]\ncover: /image/cover/web.jpeg\n---\n\næœ€è¿‘åœ¨å†™ã€é‡æ‹¾å‰ç«¯ã€‘ç³»åˆ—ï¼Œä¸‹é¢æœ‰å‡ ä¸ªå¿«é€Ÿé€šé“ï¼Œå¤§å®¶è‡ªå–\n\n[ã€é‡è¯†å‰ç«¯ã€‘åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿](https://juejin.im/post/6850418113944420359)\n\n[ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—](https://juejin.im/post/6850418117508759566)\n\n[ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this](https://juejin.im/post/6854573215658803208)\n\n[ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šJavaScriptçš„æ‰§è¡Œæœºåˆ¶](https://juejin.im/post/6859911609633767438)\n\n[ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC](https://juejin.im/post/6860375101322461198)\n\n[ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ](https://juejin.im/post/6865204092877144077)\n\n## å‰è¨€\n\nç”¨äºè®°å½•æœ¬äººçš„å­¦ä¹ è¿‡ç¨‹ï¼Œå¸Œæœ›å¯ä»¥å¸®åŠ©åˆ°å¤§å®¶~ğŸ¤ \n\nJavaScriptæœ‰è‡ªåŠ¨åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå¯èƒ½å› ä¸ºè¿™ä¸ªè‡ªåŠ¨è®©æˆ‘ä»¬å‰ç«¯å¼€å‘äººå‘˜å¿½ç•¥äº†å¯¹ä»–çš„è®¤è¯†ï¼ˆåŒ…æ‹¬æˆ‘è‡ªå·±ï¼‰ï¼Œä½†æ˜¯é˜¿é‡Œçš„é¢è¯•å®˜å¯ä¸ä¼šå’Œä½ å˜»å˜»å“ˆå“ˆã€‚\n\nâ€œåƒåœ¾å›æ”¶çš„æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿä»€ä¹ˆæ—¶å€™ä¼šå»è§¦å‘â€\n\næˆ‘ä¸€è„¸æ‡µé€¼....å•¥...è¿™ä¸ªä¸æ˜¯ä»–è‡ªå·±è¿è¡Œçš„å—...ğŸ¤•\n\nè¿˜æ˜¯è€è§„çŸ©ï¼Œé»„é‡‘åœˆæ³•åˆ™ï¼š\n\n### ä¸ºä»€ä¹ˆæœ‰åƒåœ¾å›æ”¶â™»ï¸ï¼Œæˆ–è€…è¯´åƒåœ¾å›æ”¶çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ\n\nè®¡ç®—æœºåœ¨å¯åŠ¨ä¸€ä¸ªç¨‹åºçš„æ—¶å€™ï¼Œä¼šä¸ºä»–åˆ†é…ä¸€å—å†…å­˜ï¼Œç”¨æ¥å­˜æ”¾ä»£ç ã€è¿è¡Œä¸­çš„æ•°æ®å’Œä¸€ä¸ªæ‰§è¡Œä»»åŠ¡çš„ä¸»çº¿ç¨‹ã€‚æˆ‘ä»¬çŸ¥é“ç”µè„‘çš„å†…å­˜å…¶å®æ˜¯æœ‰é™çš„ï¼Œæ¯”å¦‚å¸¸è§çš„8Gã€16Gç­‰ç­‰ï¼Œç”šè‡³è¿˜æœ‰ä¸€äº›ä»€ä¹ˆè™šæ‹Ÿå†…å­˜å°±è®¨è®ºäº†ã€‚æˆ‘ä»¬å…³æ³¨ç‚¹åœ¨äºå†…å­˜æ˜¯ä¸€ä¸ªç§ç¨€ç¼ºèµ„æºï¼Œå¯¹äºä¸ç”¨çš„ä¸œè¥¿æˆ‘ä»¬ä¸è¦#å ç€èŒ…å‘ä¸æ‹‰å±#ã€‚\n\n**æ‰€ä»¥åƒåœ¾å›æ”¶çš„ä½œç”¨å°±æ˜¯é‡Šæ”¾ä¸€ä¸‹ä¸å†ä½¿ç”¨çš„å†…å­˜ç©ºé—´ã€‚**\n\n### å†…å­˜çš„ç»“æ„\n\nJavaScriptä¸­ï¼Œåˆ†ä¸ºä¸¤ç§å†…å­˜ç©ºé—´\n\n- å †å†…å­˜->å­˜å‚¨å¼•ç”¨ç±»å‹\n- æ ˆå†…å­˜->å­˜å‚¨åŸºæœ¬ç±»å‹\n\n> åŸºæœ¬ç±»å‹åˆå«åŸå§‹ç±»å‹ï¼›å› ä¸ºæœ¬äººå·²ç»è¯´ä¹ æƒ¯äº†åŸºæœ¬ç±»å‹ï¼Œæ‰€ä»¥ä»¥ä¸‹éƒ½å«åšåŸºæœ¬ç±»å‹å“ˆã€‚\n\n\n\n## å¼•ç”¨ç±»å‹ã€åŸºæœ¬ç±»å‹ä¸å †æ ˆçš„çˆ±æ¨çº è‘›\n\n### å˜é‡å­˜æ”¾\n\n#### åŸºæœ¬ç±»å‹\n\næˆªæ­¢åŒ—äº¬æ—¶é—´2020å¹´8æœˆ25æ—¥ï¼›\n\nåœ¨[MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Data_structures)ä¸­æ˜¾ç¤ºçš„åŸºæœ¬ç±»å‹ï¼ˆåŸå§‹ç±»å‹ï¼‰æœ‰ä»¥ä¸‹7ç§\n\n- [Boolean](https://developer.mozilla.org/zh-CN/docs/Glossary/Boolean)\n- [Null](https://developer.mozilla.org/zh-CN/docs/Glossary/Null)\n- [Undefined](https://developer.mozilla.org/zh-CN/docs/Glossary/undefined)\n- [Number](https://developer.mozilla.org/zh-CN/docs/Glossary/Number)\n- [BigInt](https://developer.mozilla.org/zh-CN/docs/Glossary/BigInt)\n- [String](https://developer.mozilla.org/zh-CN/docs/Glossary/å­—ç¬¦ä¸²)\n- [Symbol](https://developer.mozilla.org/zh-CN/docs/Glossary/Symbol) \n\nåŸºæœ¬ç±»å‹æ˜¯å­˜å‚¨åœ¨æ ˆå†…å­˜é‡Œé¢çš„ã€‚æ ˆå†…å­˜é‡Œé¢è¿˜å­˜ç€æŒ‡å‘å †å†…å­˜çš„å†…å­˜åœ°å€ã€‚\n\n> PSï¼šé—­åŒ…ä¸­ï¼ŒåŸºæœ¬ç±»å‹ä¹Ÿæ˜¯å­˜æ”¾åœ¨å †å†…å­˜ä¸­çš„å“¦ï¼Œè¦æ³¨æ„ä¸€ä¸‹ã€‚\n\n#### å¼•ç”¨ç±»å‹\n\né™¤äº†åŸºæœ¬ç±»å‹çš„æ•°æ®ç»“æ„å°±æ˜¯å¼•ç”¨ç±»å‹ï¼ŒåŒ…æ‹¬ä»€ä¹ˆæ•°ç»„ï¼ˆArrayï¼‰ã€å‡½æ•°ï¼ˆFunctionï¼‰ã€å¯¹è±¡ï¼ˆObjectï¼‰ä¹‹ç±»çš„éƒ½æ˜¯å¼•ç”¨ç±»å‹ã€‚\n\nå¼•ç”¨ç±»å‹å’Œé—­åŒ…çš„å˜é‡éƒ½æ˜¯å­˜å‚¨åœ¨å †å†…å­˜ä¸­çš„ã€‚è€ŒæŒ‡é’ˆæˆ–è€…è¯´å†…å­˜åœ°å€æ˜¯å­˜åœ¨æ ˆå†…å­˜çš„ã€‚\n\n> å½“æŸ¥è¯¢å¼•ç”¨ç±»å‹çš„å˜é‡æ—¶ï¼Œ å…ˆä»**æ ˆä¸­è¯»å–å†…å­˜åœ°å€**ï¼Œ ç„¶åå†é€šè¿‡åœ°å€**æ‰¾åˆ°å †ä¸­çš„å€¼**ã€‚å¯¹äºè¿™ç§ï¼Œæˆ‘ä»¬æŠŠå®ƒå«åšæŒ‰å¼•ç”¨è®¿é—®ã€‚\n\nå¹²è¯´æœ‰ç‚¹éš¾ç†è§£ã€‚èº«ä¸ºé©¬è‰¯çš„æˆ‘ç»™å¤§å®¶ç”»ä¸€å¹…ç”»ï¼Œå¸®åŠ©ç†è§£ã€‚\n\n```js\nvar a = 123;\nvar b = true;\nvar c = null;\nvar d = '123';\nvar e = undefined;\nvar f = Symbol();\nvar g = 123n;\nvar h = new Date();\n// å­—å¤ªä¸‘äº†ã€‚ã€‚ã€‚ä»£ç å¯ä»¥çœ‹è¿™é‡Œ\n```\n\n![1](/image/æ·±å…¥å†…å­˜ä¸–ç•Œ/1.jpeg)\n\n\n\n### å †å†…å­˜å’Œæ ˆå†…å­˜çš„æ€»ç»“\n\n| **æ ˆå†…å­˜**                   | å †å†…å­˜                       |\n| ---------------------------- | ---------------------------- |\n| å­˜å‚¨åŸºç¡€æ•°æ®ç±»å‹ä»¥åŠå†…å­˜åœ°å€ | å­˜å‚¨å¼•ç”¨æ•°æ®ç±»å‹ä»¥åŠé—­åŒ…å˜é‡ |\n| æŒ‰å€¼è®¿é—®                     | æŒ‰å¼•ç”¨ï¼ˆå†…å­˜åœ°å€ï¼‰è®¿é—®       |\n| å­˜å‚¨çš„å€¼å¤§å°å›ºå®š             | å­˜å‚¨çš„å€¼å¤§å°ä¸å®šï¼Œå¯åŠ¨æ€è°ƒæ•´ |\n| ç”±ç³»ç»Ÿè‡ªåŠ¨åˆ†é…å†…å­˜ç©ºé—´       | ç”±ä»£ç è¿›è¡ŒæŒ‡å®šåˆ†é…           |\n| ç©ºé—´å°ï¼Œè¿è¡Œæ•ˆç‡é«˜           | ç©ºé—´å¤§ï¼Œè¿è¡Œæ•ˆç‡ç›¸å¯¹è¾ƒä½     |\n\n\n\n## æ·±æ‹·è´ã€æµ…æ‹·è´ã€èµ‹å€¼é“äººä¸‰é¡¹çš„ä¸è§£æ¸Šæº\n\n### èµ‹å€¼\n\nèµ‹å€¼åˆ†ä¸¤ç§æƒ…å†µï¼š\n\n1. åˆ›å»ºæ–°å€¼\n\n   ```js\n   var a = 123;\n   var b = [1, 2, 3];\n   ```\n\n   è¿™ç§å°±æ˜¯èµ‹æ–°å€¼çš„æƒ…å†µã€‚\n\n2. èµ‹å€¼å·²æœ‰çš„å˜é‡çš„å€¼\n\n   åœ¨ä¸Šé¢çš„ä¾‹å­åŸºç¡€ä¸Šä¿®æ”¹ä¸€ä¸‹ã€‚\n\n   ```js\n   var a = 123;\n   var b = [1, 2, 3];\n   var A = a;\n   var B = b;\n   ```\n\n   è¿™ç§æƒ…å†µå°±æ˜¯èµ‹å€¼å·²æœ‰å˜é‡ã€‚\n\nğŸ‘Œï¼Œæ¥ä¸‹æ¥æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œè¿˜æ˜¯æŠŠğŸ‘†çš„ğŸŒ°ä¿®æ”¹ä¸€ä¸‹\n\n```js\nvar a = 123;\nvar b = [1, 2, 3];\nvar A = a;\nvar B = b;\n\nA = 1234;\nconsole.log(a);\nconsole.log(A);\nB.push(4);\nconsole.log(b);\nconsole.log(B);\n```\n\n\n\nå¸¦ğŸ”¥è‡ªå·±æ‰“å¼€æ§åˆ¶å°ï¼Œå‚ä¸è¿›æ¥ï¼çœ‹å®Œä¹‹åç„¶åå†çœ‹çœ‹å’Œè‡ªå·±çš„ç†è§£æ˜¯ä¸æ˜¯ä¸€æ ·ï¼Œå¦‚æœæ˜¯ä¸€æ ·çš„è¯ï¼Œè¯´æ˜ä½ å¾ˆğŸ‘ï¼Œä¸æ˜¯çš„è¯å°±ä¸€èµ·æ¥çœ‹çœ‹ğŸ‘‡çš„è§£é‡Šå§ã€‚\n\næˆ‘ä»¬è§‚å¯Ÿä¹‹åå‘ç°ï¼Œæˆ‘ä»¬åªä¿®æ”¹äº†`B`ä½†æ˜¯ï¼Œæˆ‘ä»¬è‹±ä¿Šçš„`b`ä¹Ÿè¢«ä¿®æ”¹äº†ã€‚\n\nï¼Ÿï¼Ÿï¼Ÿï¼ˆè„‘è¡¥é»‘äººé—®å·è„¸ï¼‰\n\nå…¶å®æˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­è‚¯å®šæ˜¯ä¸å¸Œæœ›è¿™ç§æƒ…å†µçš„å‘ç”Ÿçš„ï¼Œæˆ‘ä»¬ä¿®æ”¹çš„åªæ˜¯`B`ï¼Œä¸å¸Œæœ›ä¿®æ”¹`b`çš„ï¼Œä¸ç„¶æˆ‘ä»¬è‚¯å®šä¼šå†™`b.push(4)`ã€‚\n\nè¿™æ—¶å°±éœ€è¦ç”¨åˆ°é“äººä¸‰é¡¹çš„å¦å¤–ä¸¤ä¸ªé¡¹ç›®ï¼šæµ…æ‹·è´å’Œæ·±æ‹·è´ã€‚\n\n### æµ…æ‹·è´å’Œæ·±æ‹·è´\n\nåˆšåˆšè¯´åˆ°å¼•ç”¨ç±»å‹å…¶å®æ˜¯æ”¾åœ¨å †å†…å­˜ä¸­çš„ï¼Œè€Œæ ˆå†…å­˜é‡Œé¢åªå­˜æŒ‡å‘å †å†…å­˜çš„åœ°å€ã€‚ï¼ˆæœ‰ç‚¹æ‹—å£....ğŸ§˜â€â™‚ï¸ï¼‰\n\næµ…æ‹·è´æµ…æ‹·è´ï¼Œé¡¾åæ€ä¹‰ã€‚å°±æ˜¯æµ…ä¸€ç‚¹çš„æ‹·è´ï¼Œæœ‰å¤šæµ…å‘¢ï¼Ÿ\n\nä¸€å±‚é‚£ä¹ˆæµ…ã€‚\n\nä¹Ÿå°±æ˜¯è¯´é™¤äº†ç¬¬ä¸€å±‚çš„ä¸œè¥¿ï¼Œç¬¬ä¸€å±‚ä¹‹å¤–æ›´æ·±çš„å±‚çº§å°±ä¸æ˜¯æ‹·è´äº†ï¼Œå«æ‹¿åˆ«äººçš„åœ°å€ã€‚\n\nå£è¯´æ— å‡­ï¼Œæˆ‘å¼„ä¸ªdemoç»™å¤§å®¶ğŸ”¥see seeã€‚\n\n![2](/image/æ·±å…¥å†…å­˜ä¸–ç•Œ/2.png)\n\nå¯ä»¥å¾ˆæ¸…æ™°ï¼Œæ¸…æ™°çš„ä¸èƒ½å†æ¸…æ™°çš„çœ‹åˆ°ï¼Œæµ…æ‹·è´å‡ºæ¥çš„å¯¹è±¡é‡Œé¢çš„å±æ€§`b`å…¶å®è¿˜æ˜¯æŒ‡å‘ä¹‹å‰çš„å¯¹è±¡ï¼Œä¹‹å‰è¯´è¿‡ï¼Œå†æ·±çš„ä»–å°±ä¸æ‹·è´äº†ï¼ŒéªŒè¯çš„è¯å°±äº¤ç»™å¤§å®¶äº†ï¼Œæ¯•ç«Ÿæˆ‘ä»¬æ˜¯ä¸€ä¸ªåŠ¨æ‰‹èŠ‚ç›®ç»„ï¼\n\né‚£ä¹ˆæµ…æ‹·è´æœ‰å“ªäº›æ–¹æ³•å‘¢ï¼Ÿ\n\n1. Object.assign()\n2. es6çš„æ‰©å±•è¿ç®—ç¬¦`{...xxx}`\n3. Array.prototype.slice()\n\n### æ·±æ‹·è´\n\nçœ‹çœ‹æˆ‘é‚£ä¸ªå®Œç¾çš„å›¾å°±å·²ç»çŸ¥é“äº†ï¼Œæ·±æ‹·è´å°±æ˜¯å®Œç¾çš„å¼„ä¸€ä¸ªä¸€æ¨¡ä¸€æ ·çš„å‡ºæ¥ã€‚\n\nå¸…å“¥å¸…å“¥ï¼Œæ·±æ‹·è´æœ‰å•¥åŠæ³•æï¼Ÿ\n\n1. JSON.parse(JSON.stringify(object))\n   1. ä¼šå¿½ç•¥ `undefined`\n   2.  ä¼šå¿½ç•¥ `symbol`\n   3. ä¸èƒ½åºåˆ—åŒ–å‡½æ•°\n   4. ä¸èƒ½è§£å†³å¾ªç¯å¼•ç”¨çš„å¯¹è±¡\n   5. ä¸èƒ½æ­£ç¡®å¤„ç†`new Date()\n   6. ä¸èƒ½å¤„ç†æ­£åˆ™\n2. è‡ªå·±å†™ä¸€ä¸ªé€’å½’ç„¶åç–¯ç‹‚æµ…æ‹·è´....\n3. ç»ˆææ–¹æ¡ˆï¼šlodashçš„[`cloneDeep`](https://www.lodashjs.com/docs/lodash.cloneDeep)\n\n### æ€»ç»“\n\n|        | å’ŒåŸæ•°æ®æ˜¯å¦æŒ‡å‘åŒä¸€å¯¹è±¡ | ç¬¬ä¸€å±‚æ•°æ®ä¸ºåŸºæœ¬æ•°æ®ç±»å‹ | åŸæ•°æ®ä¸­åŒ…å«å­å¯¹è±¡       |\n| ------ | ------------------------ | ------------------------ | ------------------------ |\n| èµ‹å€¼   | æ˜¯                       | æ”¹å˜ä¼šä½¿åŸæ•°æ®ä¸€èµ·æ”¹å˜   | æ”¹å˜ä¼šä½¿åŸæ•°æ®ä¸€èµ·æ”¹å˜   |\n| æµ…æ‹·è´ | å¦                       | æ”¹å˜ä¸ä¼šä½¿åŸæ•°æ®ä¸€èµ·æ”¹å˜ | æ”¹å˜ä¼šä½¿åŸæ•°æ®ä¸€èµ·æ”¹å˜   |\n| æ·±æ‹·è´ | å¦                       | æ”¹å˜ä¸ä¼šä½¿åŸæ•°æ®ä¸€èµ·æ”¹å˜ | æ”¹å˜ä¸ä¼šä½¿åŸæ•°æ®ä¸€èµ·æ”¹å˜ |\n\n ## åƒåœ¾å›æ”¶æœºåˆ¶â™»ï¸\n\nJavaScriptæœ‰è‡ªåŠ¨åƒåœ¾æ”¶é›†æœºåˆ¶ï¼Œåƒåœ¾æ”¶é›†å™¨ä¼šæ¯éš”ä¸€æ®µæ—¶é—´æˆ–è€…è¾¾åˆ°æŸä¸ªé˜ˆå€¼å°±æ‰§è¡Œä¸€æ¬¡é‡Šæ”¾æ“ä½œï¼Œæ‰¾å‡ºé‚£äº›ä¸å†ç»§ç»­ä½¿ç”¨çš„å€¼ï¼Œç„¶åé‡Šæ”¾å…¶å ç”¨çš„å†…å­˜ã€‚\n\n### åˆ¤æ–­æ–¹å¼\n\nJavaScriptæ˜¯æ€ä¹ˆåˆ¤æ–­æŸä¸ªå˜é‡æ˜¯å¦éœ€è¦è¢«å›æ”¶çš„ï¼Ÿ\n\næœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•\n\n### æ ‡è®°æ¸…é™¤\n\næ¯”å¦‚ä¸€ä¸ªå‡½æ•°å†…éƒ¨å£°æ˜çš„ä¸€ä¸ªå˜é‡ï¼Œä¸€æ—¦æˆ‘ä»¬çš„ä¸»çº¿ç¨‹ç¦»å¼€äº†è¿™ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å£°æ˜çš„ä¸€äº›å˜é‡å¤–éƒ¨å°±æ— æ³•ç”¨åˆ°ï¼Œé‚£ä¹ˆå°±ä¼šè¢«æ ‡è®°ä¸º\"ç¦»å¼€ç¯å¢ƒ\"ã€‚è¿™æ ·åœ¨ä¸‹ä¸€ä¸ªåƒåœ¾å›æ”¶å‘¨æœŸæ¥é¢†çš„æ—¶å€™ï¼Œå°±è‡ªåŠ¨é‡Šæ”¾äº†è¿™äº›å˜é‡å ç”¨çš„å†…å­˜ã€‚\n\n### å¼•ç”¨è®¡æ•°\n\nå¦ä¸€ç§ä¸å¤ªå¸¸è§çš„åƒåœ¾æ”¶é›†ç­–ç•¥å«åšå¼•ç”¨è®¡æ•°(reference counting)ã€‚å¼•ç”¨è®¡æ•°çš„å«ä¹‰æ˜¯è·Ÿè¸ªè®°å½•æ¯ ä¸ªå€¼è¢«å¼•ç”¨çš„æ¬¡æ•°ã€‚å½“å£°æ˜äº†ä¸€ä¸ªå˜é‡å¹¶å°†ä¸€ä¸ªå¼•ç”¨ç±»å‹å€¼èµ‹ç»™è¯¥å˜é‡æ—¶ï¼Œåˆ™è¿™ä¸ªå€¼çš„å¼•ç”¨æ¬¡æ•°å°±æ˜¯ 1ã€‚ å¦‚æœåŒä¸€ä¸ªå€¼åˆè¢«èµ‹ç»™å¦ä¸€ä¸ªå˜é‡ï¼Œåˆ™è¯¥å€¼çš„å¼•ç”¨æ¬¡æ•°åŠ  1ã€‚ç›¸åï¼Œå¦‚æœåŒ…å«å¯¹è¿™ä¸ªå€¼å¼•ç”¨çš„å˜é‡åˆå– å¾—äº†å¦å¤–ä¸€ä¸ªå€¼ï¼Œåˆ™è¿™ä¸ªå€¼çš„å¼•ç”¨æ¬¡æ•°å‡ 1ã€‚å½“è¿™ä¸ªå€¼çš„å¼•ç”¨æ¬¡æ•°å˜æˆ 0 æ—¶ï¼Œåˆ™è¯´æ˜æ²¡æœ‰åŠæ³•å†è®¿é—®è¿™ ä¸ªå€¼äº†ï¼Œå› è€Œå°±å¯ä»¥å°†å…¶å ç”¨çš„å†…å­˜ç©ºé—´å›æ”¶å›æ¥ã€‚è¿™æ ·ï¼Œå½“åƒåœ¾æ”¶é›†å™¨ä¸‹æ¬¡å†è¿è¡Œæ—¶ï¼Œå®ƒå°±ä¼šé‡Šæ”¾é‚£ äº›å¼•ç”¨æ¬¡æ•°ä¸ºé›¶çš„å€¼æ‰€å ç”¨çš„å†…å­˜ã€‚\n\nå¼•ç”¨è®¡æ•°æœ‰ä¸€ä¸ªéå¸¸ä¸¥é‡çš„BUGå°±æ˜¯ï¼Œå¦‚æœå­˜åœ¨å¾ªç¯å¼•ç”¨çš„è¯ï¼Œç³»ç»Ÿå°±æ— æ³•åˆ¤æ–­ä½ è¿™ä¸ªå†…å­˜åˆ°åº•è¦ä¸è¦å›æ”¶äº†ã€‚è€Œä¸”å¼•ç”¨çš„æ•°å­—æ°¸è¿œéƒ½ä¸ä¼šæ˜¯0ã€‚ä¸¾ä¸ªä¾‹å­\n\n```js\nvar element = document.getElementById(\"some_element\"); \nvar myObject = new Object();\nmyObject.element = element;\nelement.someObject = myObject;\n```\n\nè¿™æ ·çš„è¯`element`å’Œ`myObject`è¿™å¯¹æƒ…ä¾£å°±æ°¸è¿œå¦‚èƒ¶ä¼¼æ¼†ï¼Œç³»ç»Ÿæ— æ³•å°†ä»–ä»¬é€ä¸Šå¤©å ‚ã€‚\n\né‚£å’‹åŠï¼Ÿè¦æ‹†æ•£ä»–ä»¬æœ‰ä¸€ä¸ªä¸»æ„ï¼Œå°±æ˜¯åœ¨ä¸ç”¨çš„æ—¶å€™ç»™ä»–ä»¬ç½®ä¸º`null`\n\n```js\nmyObject.element = null; \nelement.someObject = null;\n```\n\nå°†å˜é‡è®¾ç½®ä¸º null æ„å‘³ç€åˆ‡æ–­å˜é‡ä¸å®ƒæ­¤å‰å¼•ç”¨çš„å€¼ä¹‹é—´çš„è¿æ¥ã€‚å½“åƒåœ¾æ”¶é›†å™¨ä¸‹æ¬¡è¿è¡Œæ—¶ï¼Œå°± ä¼šåˆ é™¤è¿™äº›å€¼å¹¶å›æ”¶å®ƒä»¬å ç”¨çš„å†…å­˜ã€‚\n\næ’æ’­ä¸€ä¸ªå°æ•…äº‹\n\n> IE çš„åƒåœ¾æ”¶é›†å™¨æ˜¯æ ¹æ®å†…å­˜åˆ†é…é‡è¿è¡Œçš„ï¼Œå…·ä½“ ä¸€ç‚¹è¯´å°±æ˜¯ 256 ä¸ªå˜é‡ã€4096 ä¸ªå¯¹è±¡(æˆ–æ•°ç»„)å­—é¢é‡å’Œæ•°ç»„å…ƒç´ (slot)æˆ–è€… 64KB çš„å­—ç¬¦ä¸²ã€‚è¾¾åˆ° ä¸Šè¿°ä»»ä½•ä¸€ä¸ªä¸´ç•Œå€¼ï¼Œåƒåœ¾æ”¶é›†å™¨å°±ä¼šè¿è¡Œã€‚è¿™ç§å®ç°æ–¹å¼çš„é—®é¢˜åœ¨äºï¼Œå¦‚æœä¸€ä¸ªè„šæœ¬ä¸­åŒ…å«é‚£ä¹ˆå¤šå˜ é‡ï¼Œé‚£ä¹ˆè¯¥è„šæœ¬å¾ˆå¯èƒ½ä¼šåœ¨å…¶ç”Ÿå‘½å‘¨æœŸä¸­ä¸€ç›´ä¿æœ‰é‚£ä¹ˆå¤šçš„å˜é‡ã€‚è€Œè¿™æ ·ä¸€æ¥ï¼Œåƒåœ¾æ”¶é›†å™¨å°±ä¸å¾—ä¸é¢‘ ç¹åœ°è¿è¡Œã€‚ç»“æœï¼Œç”±æ­¤å¼•å‘çš„ä¸¥é‡æ€§èƒ½é—®é¢˜ä¿ƒä½¿ IE7 é‡å†™äº†å…¶åƒåœ¾æ”¶é›†ä¾‹ç¨‹ã€‚\n>\n> éšç€ IE7 çš„å‘å¸ƒï¼Œå…¶ JavaScript å¼•æ“çš„åƒåœ¾æ”¶é›†ä¾‹ç¨‹æ”¹å˜äº†å·¥ä½œæ–¹å¼:è§¦å‘åƒåœ¾æ”¶é›†çš„å˜é‡åˆ†é…ã€ å­—é¢é‡å’Œ(æˆ–)æ•°ç»„å…ƒç´ çš„ä¸´ç•Œå€¼è¢«è°ƒæ•´ä¸ºåŠ¨æ€ä¿®æ­£ã€‚IE7 ä¸­çš„å„é¡¹ä¸´ç•Œå€¼åœ¨åˆå§‹æ—¶ä¸ IE6 ç›¸ç­‰ã€‚å¦‚æœ åƒåœ¾æ”¶é›†ä¾‹ç¨‹å›æ”¶çš„å†…å­˜åˆ†é…é‡ä½äº 15%ï¼Œåˆ™å˜é‡ã€å­—é¢é‡å’Œ(æˆ–)æ•°ç»„å…ƒç´ çš„ä¸´ç•Œå€¼å°±ä¼šåŠ å€ã€‚å¦‚æœ ä¾‹ç¨‹å›æ”¶äº† 85%çš„å†…å­˜åˆ†é…é‡ï¼Œåˆ™å°†å„ç§ä¸´ç•Œå€¼é‡ç½®å›é»˜è®¤å€¼ã€‚è¿™ä¸€çœ‹ä¼¼ç®€å•çš„è°ƒæ•´ï¼Œæå¤§åœ°æå‡äº† IE åœ¨è¿è¡ŒåŒ…å«å¤§é‡ JavaScript çš„é¡µé¢æ—¶çš„æ€§èƒ½ã€‚\n>\n> ----æ‘˜è‡ªJavaScripté«˜çº§ç¨‹åºè®¾è®¡\n\n## V8åƒåœ¾å›æ”¶ç­–ç•¥\n\n### ä»€ä¹ˆæ˜¯V8ï¼Ÿ\n\nç®€å•ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯V8ï¼Ÿ\n\n> **V8**æ˜¯ä¸€ä¸ªç”±[Google](https://zh.wikipedia.org/wiki/Google)å¼€å‘çš„[å¼€æº](https://zh.wikipedia.org/wiki/å¼€æº)[JavaScriptå¼•æ“](https://zh.wikipedia.org/wiki/JavaScriptå¼•æ“)ï¼Œç”¨äº[Google Chrome](https://zh.wikipedia.org/wiki/Google_Chrome)åŠ[Chromium](https://zh.wikipedia.org/wiki/Chromium)ä¸­[[2\\]](https://zh.wikipedia.org/wiki/V8_(JavaScriptå¼•æ“)#cite_note-comic-2)ã€‚\n>\n> ---æ‘˜è‡ªç»´åŸºç™¾ç§‘\n\næ—¢ç„¶V8æ˜¯Chromeçš„å¼•æ“ï¼Œé‚£ä¹ˆåˆ«çš„æµè§ˆå™¨å‘¢ï¼Ÿ\n\nä¸–ç•Œä¸Šä¸»è¦çš„æµè§ˆå™¨æœ‰ä»¥ä¸‹ä¸‰ç§ã€‚\n\n[**V8**](https://en.wikipedia.org/wiki/V8_(JavaScript_engine))â€”â€”å¼€æºï¼Œç”± Google å¼€å‘ï¼Œä½¿ç”¨ C++ ç¼–å†™\n\n**[SpiderMonkey](https://en.wikipedia.org/wiki/SpiderMonkey_(JavaScript_engine))**â€”â€”ç¬¬ä¸€ä¸ª JavaScript å¼•æ“ï¼Œè¯¥å¼•æ“è¿‡å»é©±åŠ¨ Netscape Navigatorï¼Œå¦‚ä»Šé©±åŠ¨ Firefox æµè§ˆå™¨ã€‚\n\n**[JavaScriptCore](https://en.wikipedia.org/wiki/JavaScriptCore)**â€”â€”å¼€æºï¼Œè‹¹æœå…¬å¸ä¸º Safair æµè§ˆå™¨å¼€å‘çš„\n\n\n\nokokokï¼Œæ”¶ï¼å›å½’åˆå¿ƒã€‚\n\n### V8çš„åƒåœ¾å›æ”¶ç­–ç•¥\n\næˆ‘ä»¬çš„ä¼Ÿå¤§çš„Chromeï¼Œæ ¹æ®ä¸åŒçš„æƒ…å†µæœ‰ä¸åŒçš„å¯¹ç­–ã€‚ä»–æŠŠå†…å­˜åˆ†æˆä¸¤å—\n\n- æ–°ç”Ÿä»£\n- è€ç”Ÿä»£\n\n#### åˆ†ä»£å†…å­˜\n\né»˜è®¤æƒ…å†µä¸‹ï¼Œ32ä½ç³»ç»Ÿæ–°ç”Ÿä»£å†…å­˜å¤§å°ä¸º16MBï¼Œè€ç”Ÿä»£å†…å­˜å¤§å°ä¸º700MBï¼Œ64ä½ç³»ç»Ÿä¸‹ï¼Œæ–°ç”Ÿä»£å†…å­˜å¤§å°ä¸º32MBï¼Œè€ç”Ÿä»£å†…å­˜å¤§å°ä¸º1.4GBã€‚\n\næ–°ç”Ÿä»£å¹³å‡åˆ†æˆä¸¤å—ç›¸ç­‰çš„å†…å­˜ç©ºé—´ï¼Œå«åšsemispaceï¼Œæ¯å—å†…å­˜å¤§å°8MBï¼ˆ32ä½ï¼‰æˆ–16MBï¼ˆ64ä½ï¼‰ã€‚\n\n\n\n#### æ–°ç”Ÿä»£ç®—æ³•\n\né¦–å…ˆï¼Œæˆ‘ä»¬ç§‘æ™®ä¸€ä¸‹ä»€ä¹ˆæ˜¯æ–°ç”Ÿä»£ã€‚\n\næ–°ç”Ÿä»£çš„å†…å­˜å‘¢ï¼Œå°±æ˜¯å­˜æ´»æ—¶é—´æ¯”è¾ƒçŸ­çš„å¯¹è±¡ã€‚å¦‚æœå­˜æ´»çš„æ—¶é—´æ¯”è¾ƒé•¿çš„è¯å°±ä¼šã€Šæ™‹å‡ã€‹ä¸ºè€ç”Ÿä»£ã€‚ç­‰ä¸€ä¸‹ä¼šç¨å¾®è¯¦ç»†çš„è¯´ä¸€ä¸‹ã€Šæ™‹å‡ã€‹è¿™ä¸ªæ¦‚å¿µã€‚\n\næ–°ç”Ÿä»£é‡‡ç”¨**Scavenge GC**åƒåœ¾å›æ”¶ç®—æ³•ï¼Œåœ¨ç®—æ³•å®ç°æ—¶ä¸»è¦é‡‡ç”¨**Cheney**ç®—æ³•ã€‚\n\nCheneyç®—æ³•å‘¢æ˜¯å°†å†…å­˜ä¸€åˆ†ä¸ºäºŒï¼Œä¸€å—æš‚æ—¶æŠŠä»–å«åšã€ŠFromã€‹ï¼Œå¦ä¸€å—æš‚æ—¶å«åšã€ŠToã€‹ã€‚çœ‹ä¸€ä¸‹ä¸‹å›¾ï¼Œå°±å¯ä»¥å¾ˆæ¸…æ™°çš„çŸ¥é“V8æ˜¯æ€ä¹ˆåˆ†å‰²å†…å­˜çš„ã€‚\n\n![3](/image/æ·±å…¥å†…å­˜ä¸–ç•Œ/3.png)\n\nå†…å­˜çš„åˆ°æ¥å…ˆè¿›å…¥Fromï¼Œç„¶åç­‰åˆ°Fromæ»¡äº†ä¹‹åï¼Œæ–°ç”Ÿä»£çš„GCå°±ä¼šå¯åŠ¨ã€‚\n\né¦–å…ˆé‡Šæ”¾æ‰ä¸€äº›ä¸å†ä½¿ç”¨çš„å†…å­˜ï¼Œç„¶åå°†Fromå’ŒToä¸¤ä¸ªåŠŸèƒ½è¿›è¡Œæ›´æ¢ï¼Œä¹Ÿå°±æ˜¯è¯´ä¹‹å‰çš„From -> To  ä¹‹å‰çš„  To -> Fromã€‚è¿™æ ·çš„è¯æ–°ç”Ÿä»£çš„ä¸€è½®GCå°±æ­¤ç»“æŸäº†ã€‚\n\nè¿™ç§ç®—æ³•æœ‰ç‚¹ç±»ä¼¼ç©ºé—´æ¢æ—¶é—´ï¼Œè€Œæ–°ç”Ÿä»£çš„å¯¹è±¡ç”Ÿå‘½ä¸€èˆ¬éƒ½æ˜¯æ¯”è¾ƒçŸ­çš„ï¼Œæ‰€ä»¥æ‰€ä»¥éå¸¸é€‚åˆæ–°ç”Ÿä»£ã€‚\n\n#### æ™‹å‡\n\nå¯¹è±¡çš„æ™‹å‡å…¶å®ä¸»è¦æœ‰ä¸¤ä¸ªè¦æ±‚ï¼Œå°±å¥½åƒåœ¨æ¥P6å‡P7æœ‰ä¸€å †çš„è¦æ±‚ä¸€æ ·ã€‚\n\n1. æ–°ç”Ÿä»£ç®—æ³•åˆšåˆšæˆ‘ä»¬å·²ç»å­¦ä¹ è¿‡äº†ï¼Œå°±æ˜¯Fromå’ŒToçš„äº’æ¢åŠŸèƒ½ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ä»–ç»å†äº†ä¸¤æ¬¡çš„æ–°ç”Ÿä»£çš„æ›´æ›¿ï¼Œè¿˜æ²¡æœ‰è¢«å›æ”¶å†…å­˜ï¼Œè¯´æ˜ä»–å¾ˆå¼ºã€‚å°±éœ€è¦æ™‹å‡ä¸ºè€ç”Ÿä»£ï¼Œè®©è€ç”Ÿä»£çš„ç®—æ³•æ¥å¯¹ä»˜ä»–ã€‚å°±å¥½åƒåœ¨é˜¿é‡Œçš„ä¸€ä¸ªP6ä¸¤è½®361éƒ½æ²¡æœ‰è¢«æ·˜æ±°è¯´æ˜ä»–å¾ˆæœ‰å®åŠ›ï¼Œæ‰€ä»¥ç›´æ¥å‡çº§ä»–ä¸ºP7ã€‚\n2. å¦‚æœä¸€ä¸ªå¯¹è±¡åœ¨Toçš„å†…å­˜å æ¯”è¶…è¿‡äº†25%ï¼Œåœ¨ç¬¬ä¸€æ¬¡æ›´æ›¿çš„æ—¶å€™å°±ç›´æ¥å°†ä»–æ™‹å‡ä¸ºè€ç”Ÿä»£äº†ã€‚å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæŠ€æœ¯å¤§ç‰›ï¼Œåƒé©¬äº‘ï¼Œä¸€å»é˜¿é‡Œå°±è¢«æ˜Ÿæ¢å‘ç°ï¼Œç›´æ¥å°±æ˜¯P7è¯„çº§ï¼Œä¸éœ€è¦ç»è¿‡ä»€ä¹ˆå¤æ‚çš„é¢è¯•æˆ–è€…ä»€ä¹ˆã€‚\n\n\n\n#### è€ç”Ÿä»£ç®—æ³•\n\næ ¹æ®åˆšåˆšå¯¹ã€Šæ™‹å‡ã€‹çš„äº†è§£ï¼Œæˆ‘ä»¬çŸ¥é“äº†åœ¨è€ç”Ÿä»£é‡Œé¢çš„å¯¹è±¡éƒ½æ˜¯ä¸€äº›éš¾ç¼ çš„é€‰æ‰‹ï¼Œæ¯”å¦‚æœ¬æ¥å°±å å†…å­˜æ¯”ä¾‹å¾ˆå¤§ï¼Œæˆ–è€…ç»å†è¿‡2æ¬¡çš„æ–°ç”Ÿä»£GCï¼Œä¾æ—§åšæŒºçš„é€‰æ‰‹ã€‚\n\næ‰€ä»¥ï¼ŒV8åœ¨è€ç”Ÿä»£ä¸­ä¸»è¦é‡‡ç”¨äº†**Mark-Sweep**å’Œ**Mark-Compact**ç›¸ç»“åˆçš„æ–¹å¼è¿›è¡Œåƒåœ¾å›æ”¶ã€‚\n\nåœ¨ä»‹ç»è€ç”Ÿä»£ç®—æ³•ä¹‹å‰ï¼Œå…ˆç§‘æ™®ä¸€ä¸‹**Mark-Sweep**å’Œ**Mark-Compact**ã€‚\n\n##### **Mark-Sweep**\n\nMark-Sweepæ˜¯æ ‡è®°æ¸…é™¤çš„æ„æ€ï¼Œå®ƒåˆ†ä¸ºæ ‡è®°å’Œæ¸…é™¤ä¸¤ä¸ªé˜¶æ®µã€‚\n\nä¸Scavengeä¸åŒï¼ŒMark-Sweepå¹¶ä¸ä¼šå°†å†…å­˜åˆ†ä¸ºä¸¤ä»½ï¼Œæ‰€ä»¥ä¸å­˜åœ¨æµªè´¹ä¸€åŠç©ºé—´çš„è¡Œä¸ºã€‚Mark-Sweepåœ¨æ ‡è®°é˜¶æ®µéå†å †å†…å­˜ä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼Œå¹¶æ ‡è®°æ´»ç€çš„å¯¹è±¡ï¼Œåœ¨éšåçš„æ¸…é™¤é˜¶æ®µï¼Œåªæ¸…é™¤æ²¡æœ‰è¢«æ ‡è®°çš„å¯¹è±¡ã€‚\n\nä¹Ÿå°±æ˜¯è¯´ï¼ŒScavengeåªå¤åˆ¶æ´»ç€çš„å¯¹è±¡ï¼Œè€ŒMark-Sweepåªæ¸…é™¤æ­»äº†çš„å¯¹è±¡ã€‚æ´»å¯¹è±¡åœ¨æ–°ç”Ÿä»£ä¸­åªå è¾ƒå°‘éƒ¨åˆ†ï¼Œæ­»å¯¹è±¡åœ¨è€ç”Ÿä»£ä¸­åªå è¾ƒå°‘éƒ¨åˆ†ï¼Œè¿™å°±æ˜¯ä¸¤ç§å›æ”¶æ–¹å¼éƒ½èƒ½é«˜æ•ˆå¤„ç†çš„åŸå› ã€‚\n\n> åœ¨æ ‡è®°å¤§å‹å¯¹å†…å­˜æ—¶ï¼Œå¯èƒ½éœ€è¦å‡ ç™¾æ¯«ç§’æ‰èƒ½å®Œæˆä¸€æ¬¡æ ‡è®°ã€‚è¿™å°±ä¼šå¯¼è‡´ä¸€äº›æ€§èƒ½ä¸Šçš„é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ2011 å¹´ï¼ŒV8 ä» stop-the-world æ ‡è®°åˆ‡æ¢åˆ°å¢é‡æ ‡å¿—ã€‚åœ¨å¢é‡æ ‡è®°æœŸé—´ï¼ŒGC å°†æ ‡è®°å·¥ä½œåˆ†è§£ä¸ºæ›´å°çš„æ¨¡å—ï¼Œå¯ä»¥è®© JS åº”ç”¨é€»è¾‘åœ¨æ¨¡å—é—´éš™æ‰§è¡Œä¸€ä¼šï¼Œä»è€Œä¸è‡³äºè®©åº”ç”¨å‡ºç°åœé¡¿æƒ…å†µã€‚ä½†åœ¨ 2018 å¹´ï¼ŒGC æŠ€æœ¯åˆæœ‰äº†ä¸€ä¸ªé‡å¤§çªç ´ï¼Œè¿™é¡¹æŠ€æœ¯åä¸ºå¹¶å‘æ ‡è®°ã€‚è¯¥æŠ€æœ¯å¯ä»¥è®© GC æ‰«æå’Œæ ‡è®°å¯¹è±¡æ—¶ï¼ŒåŒæ—¶å…è®¸ JS è¿è¡Œï¼Œä½ å¯ä»¥ç‚¹å‡» [è¯¥åšå®¢](https://v8project.blogspot.com/2018/06/concurrent-marking.html) è¯¦ç»†é˜…è¯»ã€‚\n\n\n\n##### **Mark-Compact**\n\nåœ¨æ¸…é™¤å®Œå¯¹è±¡åï¼Œè¿™äº›å¯¹è±¡åœ¨å†…å­˜å†…éƒ¨å°±ä¸æ˜¯è¿ç»­çš„ã€‚è¿™æ ·å†…å­˜åœ°å€å°±æ— æ³•å¾ˆå¥½åœ°åˆ©ç”¨èµ·æ¥ï¼Œå› ä¸ºä»–ä»¬éœ€è¦è¿ç»­çš„å†…å­˜ï¼Œæœ‰çš„å¤§çš„å¯¹è±¡å°±æ— æ³•å¡å…¥åˆšåˆšé‡Šæ”¾çš„å°å†…å­˜å½“ä¸­ã€‚\n\nè€ŒMark-Compactå°±æ˜¯ç”¨äºè§£å†³å†…å­˜ç¢ç‰‡çš„é—®é¢˜ï¼Œä»–ä¸»è¦å¹²çš„æ´»å°±æ˜¯ç§»åŠ¨è¿™äº›å¯¹è±¡ï¼Œè®©ä»–ä»¬å˜æˆç´§å‡‘èµ·æ¥ã€‚\n\næ¸…é™¤å¯¹è±¡åä¼šé€ æˆå †å†…å­˜å‡ºç°ç¢ç‰‡çš„æƒ…å†µï¼Œå½“ç¢ç‰‡è¶…è¿‡ä¸€å®šé™åˆ¶åä¼šå¯åŠ¨å‹ç¼©ç®—æ³•ã€‚åœ¨å‹ç¼©è¿‡ç¨‹ä¸­ï¼Œå°†æ´»çš„å¯¹è±¡åƒä¸€ç«¯ç§»åŠ¨ï¼Œç›´åˆ°æ‰€æœ‰å¯¹è±¡éƒ½ç§»åŠ¨å®Œæˆç„¶åæ¸…ç†æ‰ä¸éœ€è¦çš„å†…å­˜ã€‚\n\n##### æ€»ç»“\n\nåœ¨V8çš„å›æ”¶ç­–ç•¥ä¸­ï¼ŒMark-Sweepå’ŒMark-Conpactä¸¤è€…æ˜¯ç»“åˆä½¿ç”¨çš„ã€‚\n\nç”±äºMark-Conpactéœ€è¦ç§»åŠ¨å¯¹è±¡ï¼Œæ‰€ä»¥å®ƒçš„æ‰§è¡Œé€Ÿåº¦ä¸å¯èƒ½å¾ˆå¿«ï¼Œåœ¨å–èˆä¸Šï¼ŒV8ä¸»è¦ä½¿ç”¨Mark-Sweepï¼Œåœ¨ç©ºé—´ä¸è¶³ä»¥å¯¹ä»æ–°ç”Ÿä»£ä¸­æ™‹å‡è¿‡æ¥çš„å¯¹è±¡è¿›è¡Œåˆ†é…æ—¶ï¼Œæ‰ä½¿ç”¨Mark-Compactã€‚\n\n\n\n## JavaScriptå†…å­˜æ³„æ¼\n\n### ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼\n\nç¨‹åºçš„è¿è¡Œéœ€è¦å†…å­˜ã€‚åªè¦ç¨‹åºæå‡ºè¦æ±‚ï¼Œæ“ä½œç³»ç»Ÿæˆ–è€…è¿è¡Œæ—¶ï¼ˆruntimeï¼‰å°±å¿…é¡»ä¾›ç»™å†…å­˜ã€‚\n\nå¯¹äºæŒç»­è¿è¡Œçš„æœåŠ¡è¿›ç¨‹ï¼ˆdaemonï¼‰ï¼Œå¿…é¡»åŠæ—¶é‡Šæ”¾ä¸å†ç”¨åˆ°çš„å†…å­˜ã€‚å¦åˆ™ï¼Œå†…å­˜å ç”¨è¶Šæ¥è¶Šé«˜ï¼Œè½»åˆ™å½±å“ç³»ç»Ÿæ€§èƒ½ï¼Œé‡åˆ™å¯¼è‡´è¿›ç¨‹å´©æºƒã€‚\n\n**ä¸å†ç”¨åˆ°çš„å†…å­˜ï¼Œæ²¡æœ‰åŠæ—¶é‡Šæ”¾ï¼Œå°±å«åšå†…å­˜æ³„æ¼**ï¼ˆmemory leakï¼‰ã€‚\n\n### å¸¸è§çš„å†…å­˜æ³„æ¼\n\n1. å®šæ—¶å™¨æœªåŠæ—¶æ¸…é™¤\n\n2. æ„å¤–çš„å…¨å±€å˜é‡\n\n   ```js\n   function foo(arg) {\n       bar = \"this is a hidden global variable\";  // æ„å¤–æŒ‚åœ¨åœ¨ window å…¨å±€å˜é‡ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼\n   }\n   ```\n\n   è¿™é‡Œæ˜¯æƒ³è¯´ä¸€ä¸‹é«˜ç¨‹ï¼ˆJavaScripté«˜çº§ç¨‹åºè®¾è®¡ç¬¬ä¸‰ç‰ˆï¼‰é‡Œé¢çš„ä¸€ä¸ªéå¸¸ç»å…¸çš„demoã€‚\n\n3. é—­åŒ…çš„æ»¥ç”¨\n\n### WeakMapä¸WeakSet\n\nå…¶å®è¿™ä¸¤ä¸ªåœ¨è¿™ç¯‡æ–‡ç« é‡Œé¢çš„æ„ä¹‰ç›¸åŒï¼Œåªéœ€è¦ä»‹ç»ä¸€ä¸ªå°±è¡Œã€‚\n\næˆ‘ä»¬çŸ¥é“Mapæ˜¯ç®€å•çš„key-valueã€‚è€Œä¸”keyå¯ä»¥ä¸ºä»»æ„ç±»å‹ï¼Œæ¯”å¦‚å¼•ç”¨ç±»å‹ï¼Œå¦‚æœæˆ‘ä»¬çš„keyæ˜¯å¼•ç”¨ç±»å‹é‚£ä¹ˆä»–æ‰€å æ®çš„å†…å­˜å°±æ— æ³•è¢«é‡Šæ”¾äº†ã€‚\n\nåˆæœ‰åŒå­¦é—®é¢˜äº†ï¼Œæˆ‘æœ‰æ¯›ç—…å•Šï¼Œæˆ‘éè¦å¼•ç”¨ç±»å‹å—ï¼Ÿæˆ‘stringå’Œnumberä»–ä¸é¦™å—ï¼Ÿ\n\nåŸºæœ¬ä¸Šï¼Œå¦‚æœä½ è¦å¾€å¯¹è±¡ä¸Šæ·»åŠ æ•°æ®ï¼Œåˆä¸æƒ³å¹²æ‰°åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå°±å¯ä»¥ä½¿ç”¨ WeakMapã€‚ä¸€ä¸ªå…¸å‹åº”ç”¨åœºæ™¯æ˜¯ï¼Œåœ¨ç½‘é¡µçš„ DOM å…ƒç´ ä¸Šæ·»åŠ æ•°æ®ï¼Œå°±å¯ä»¥ä½¿ç”¨`WeakMap`ç»“æ„ã€‚å½“è¯¥ DOM å…ƒç´ è¢«æ¸…é™¤ï¼Œå…¶æ‰€å¯¹åº”çš„`WeakMap`è®°å½•å°±ä¼šè‡ªåŠ¨è¢«ç§»é™¤ã€‚\n\n```javascript\nconst wm = new WeakMap();\n\nconst element = document.getElementById('example');\n\nwm.set(element, 'some information');\nwm.get(element) // \"some information\"\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œå…ˆæ–°å»ºä¸€ä¸ª Weakmap å®ä¾‹ã€‚ç„¶åï¼Œå°†ä¸€ä¸ª DOM èŠ‚ç‚¹ä½œä¸ºé”®åå­˜å…¥è¯¥å®ä¾‹ï¼Œå¹¶å°†ä¸€äº›é™„åŠ ä¿¡æ¯ä½œä¸ºé”®å€¼ï¼Œä¸€èµ·å­˜æ”¾åœ¨ WeakMap é‡Œé¢ã€‚è¿™æ—¶ï¼ŒWeakMap é‡Œé¢å¯¹`element`çš„å¼•ç”¨å°±æ˜¯å¼±å¼•ç”¨ï¼Œä¸ä¼šè¢«è®¡å…¥åƒåœ¾å›æ”¶æœºåˆ¶ã€‚\n\nä¹Ÿå°±æ˜¯è¯´ï¼Œä¸Šé¢çš„ DOM èŠ‚ç‚¹å¯¹è±¡çš„å¼•ç”¨è®¡æ•°æ˜¯`1`ï¼Œè€Œä¸æ˜¯`2`ã€‚è¿™æ—¶ï¼Œä¸€æ—¦æ¶ˆé™¤å¯¹è¯¥èŠ‚ç‚¹çš„å¼•ç”¨ï¼Œå®ƒå ç”¨çš„å†…å­˜å°±ä¼šè¢«åƒåœ¾å›æ”¶æœºåˆ¶é‡Šæ”¾ã€‚Weakmap ä¿å­˜çš„è¿™ä¸ªé”®å€¼å¯¹ï¼Œä¹Ÿä¼šè‡ªåŠ¨æ¶ˆå¤±ã€‚\n\næ€»ä¹‹ï¼Œ`WeakMap`çš„ä¸“ç”¨åœºåˆå°±æ˜¯ï¼Œå®ƒçš„é”®æ‰€å¯¹åº”çš„å¯¹è±¡ï¼Œå¯èƒ½ä¼šåœ¨å°†æ¥æ¶ˆå¤±ã€‚`WeakMap`ç»“æ„æœ‰åŠ©äºé˜²æ­¢å†…å­˜æ³„æ¼ã€‚\n\næ›´å¤šçš„çŸ¥è¯†å°±ä¸è®¨è®ºäº†ï¼Œè¿™é‡Œæ˜¯å†…å­˜ä¸–ç•Œï¼ä¸æ˜¯ä»€ä¹ˆWeakMapä¸“åœºå“¦ã€‚\n\næ€ä¹ˆéªŒè¯ï¼Ÿemmmmm....è¿™é‡Œæˆ‘copyä¸€ä¸‹é˜®ä¸€å³°è€å¸ˆçš„å†…å®¹ã€‚\n\n### é˜®è€å¸ˆçš„demo\n\né¦–å…ˆï¼Œæ‰“å¼€ Node å‘½ä»¤è¡Œã€‚\n\n```bash\n$ node --expose-gc\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œ`--expose-gc`å‚æ•°è¡¨ç¤ºå…è®¸æ‰‹åŠ¨æ‰§è¡Œåƒåœ¾å›æ”¶æœºåˆ¶ã€‚\n\nç„¶åï¼Œæ‰§è¡Œä¸‹é¢çš„ä»£ç ã€‚\n\n```javascript\n// æ‰‹åŠ¨æ‰§è¡Œä¸€æ¬¡åƒåœ¾å›æ”¶ï¼Œä¿è¯è·å–çš„å†…å­˜ä½¿ç”¨çŠ¶æ€å‡†ç¡®\n> global.gc();\nundefined\n\n// æŸ¥çœ‹å†…å­˜å ç”¨çš„åˆå§‹çŠ¶æ€ï¼ŒheapUsed ä¸º 4M å·¦å³\n> process.memoryUsage();\n{ rss: 21106688,\n  heapTotal: 7376896,\n  heapUsed: 4153936,\n  external: 9059 }\n\n> let wm = new WeakMap();\nundefined\n\n// æ–°å»ºä¸€ä¸ªå˜é‡ keyï¼ŒæŒ‡å‘ä¸€ä¸ª 5*1024*1024 çš„æ•°ç»„\n> let key = new Array(5 * 1024 * 1024);\nundefined\n\n// è®¾ç½® WeakMap å®ä¾‹çš„é”®åï¼Œä¹ŸæŒ‡å‘ key æ•°ç»„\n// è¿™æ—¶ï¼Œkey æ•°ç»„å®é™…è¢«å¼•ç”¨äº†ä¸¤æ¬¡ï¼Œ\n// å˜é‡ key å¼•ç”¨ä¸€æ¬¡ï¼ŒWeakMap çš„é”®åå¼•ç”¨äº†ç¬¬äºŒæ¬¡\n// ä½†æ˜¯ï¼ŒWeakMap æ˜¯å¼±å¼•ç”¨ï¼Œå¯¹äºå¼•æ“æ¥è¯´ï¼Œå¼•ç”¨è®¡æ•°è¿˜æ˜¯1\n> wm.set(key, 1);\nWeakMap {}\n\n> global.gc();\nundefined\n\n// è¿™æ—¶å†…å­˜å ç”¨ heapUsed å¢åŠ åˆ° 45M äº†\n> process.memoryUsage();\n{ rss: 67538944,\n  heapTotal: 7376896,\n  heapUsed: 45782816,\n  external: 8945 }\n\n// æ¸…é™¤å˜é‡ key å¯¹æ•°ç»„çš„å¼•ç”¨ï¼Œ\n// ä½†æ²¡æœ‰æ‰‹åŠ¨æ¸…é™¤ WeakMap å®ä¾‹çš„é”®åå¯¹æ•°ç»„çš„å¼•ç”¨\n> key = null;\nnull\n\n// å†æ¬¡æ‰§è¡Œåƒåœ¾å›æ”¶\n> global.gc();\nundefined\n\n// å†…å­˜å ç”¨ heapUsed å˜å› 4M å·¦å³ï¼Œ\n// å¯ä»¥çœ‹åˆ° WeakMap çš„é”®åå¼•ç”¨æ²¡æœ‰é˜»æ­¢ gc å¯¹å†…å­˜çš„å›æ”¶\n> process.memoryUsage();\n{ rss: 20639744,\n  heapTotal: 8425472,\n  heapUsed: 3979792,\n  external: 8956 }\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œåªè¦å¤–éƒ¨çš„å¼•ç”¨æ¶ˆå¤±ï¼ŒWeakMap å†…éƒ¨çš„å¼•ç”¨ï¼Œå°±ä¼šè‡ªåŠ¨è¢«åƒåœ¾å›æ”¶æ¸…é™¤ã€‚ç”±æ­¤å¯è§ï¼Œæœ‰äº† WeakMap çš„å¸®åŠ©ï¼Œè§£å†³å†…å­˜æ³„æ¼å°±ä¼šç®€å•å¾ˆå¤šã€‚\n\n## çœ‹å®Œå‡ ä»¶äº‹\n\nå¦‚æœä½ è§‰å¾—å¯¹ä½ æœ‰å¸®åŠ©ï¼Œå°±å¸®æˆ‘ç‚¹ä¸ªèµå§ï¼Œä¹Ÿç®—æ˜¯å¯¹æˆ‘çš„è‚¯å®šã€‚è°¢è°¢ï¼Œå¦‚æœæœ‰é”™è¯¯çš„åœ°æ–¹æ¬¢è¿å¤§å®¶æŒ‡å‡ºæ¥ã€‚ä¸€èµ·è®¨è®ºå­¦ä¹ ã€‚æˆ‘æ˜¯Derrickï¼Œä¸€åæ­£åœ¨å»é˜¿é‡Œè·¯ä¸Šçš„å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆã€‚\n\n## reference\n\n> [https://muyiy.cn/blog/1/1.3.html#%E6%A0%88%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84](https://muyiy.cn/blog/1/1.3.html#æ ˆæ•°æ®ç»“æ„)\n>\n> http://www.ruanyifeng.com/blog/2017/04/memory-leak.html\n>\n> https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Map\n>\n> https://juejin.im/post/6844903615300108302\n>\n> https://juejin.im/post/6844903591510016007\n>\n> JavaScripté«˜çº§ç¨‹åºè®¾è®¡ï¼ˆç¬¬ä¸‰ç‰ˆï¼‰\n\n","slug":"ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ","published":1,"updated":"2021-06-24T14:00:06.853Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra8s0024lwrdh8gvdkxa","content":"<p>æœ€è¿‘åœ¨å†™ã€é‡æ‹¾å‰ç«¯ã€‘ç³»åˆ—ï¼Œä¸‹é¢æœ‰å‡ ä¸ªå¿«é€Ÿé€šé“ï¼Œå¤§å®¶è‡ªå–</p>\n<p><a href=\"https://juejin.im/post/6850418113944420359\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿</a></p>\n<p><a href=\"https://juejin.im/post/6850418117508759566\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—</a></p>\n<p><a href=\"https://juejin.im/post/6854573215658803208\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this</a></p>\n<p><a href=\"https://juejin.im/post/6859911609633767438\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šJavaScriptçš„æ‰§è¡Œæœºåˆ¶</a></p>\n<p><a href=\"https://juejin.im/post/6860375101322461198\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC</a></p>\n<p><a href=\"https://juejin.im/post/6865204092877144077\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ</a></p>\n<h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><p>ç”¨äºè®°å½•æœ¬äººçš„å­¦ä¹ è¿‡ç¨‹ï¼Œå¸Œæœ›å¯ä»¥å¸®åŠ©åˆ°å¤§å®¶~ğŸ¤ </p>\n<p>JavaScriptæœ‰è‡ªåŠ¨åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå¯èƒ½å› ä¸ºè¿™ä¸ªè‡ªåŠ¨è®©æˆ‘ä»¬å‰ç«¯å¼€å‘äººå‘˜å¿½ç•¥äº†å¯¹ä»–çš„è®¤è¯†ï¼ˆåŒ…æ‹¬æˆ‘è‡ªå·±ï¼‰ï¼Œä½†æ˜¯é˜¿é‡Œçš„é¢è¯•å®˜å¯ä¸ä¼šå’Œä½ å˜»å˜»å“ˆå“ˆã€‚</p>\n<p>â€œåƒåœ¾å›æ”¶çš„æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿä»€ä¹ˆæ—¶å€™ä¼šå»è§¦å‘â€</p>\n<p>æˆ‘ä¸€è„¸æ‡µé€¼â€¦.å•¥â€¦è¿™ä¸ªä¸æ˜¯ä»–è‡ªå·±è¿è¡Œçš„å—â€¦ğŸ¤•</p>\n<p>è¿˜æ˜¯è€è§„çŸ©ï¼Œé»„é‡‘åœˆæ³•åˆ™ï¼š</p>\n<h3 id=\"ä¸ºä»€ä¹ˆæœ‰åƒåœ¾å›æ”¶â™»ï¸ï¼Œæˆ–è€…è¯´åƒåœ¾å›æ”¶çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ\"><a href=\"#ä¸ºä»€ä¹ˆæœ‰åƒåœ¾å›æ”¶â™»ï¸ï¼Œæˆ–è€…è¯´åƒåœ¾å›æ”¶çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆæœ‰åƒåœ¾å›æ”¶â™»ï¸ï¼Œæˆ–è€…è¯´åƒåœ¾å›æ”¶çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ\"></a>ä¸ºä»€ä¹ˆæœ‰åƒåœ¾å›æ”¶â™»ï¸ï¼Œæˆ–è€…è¯´åƒåœ¾å›æ”¶çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>è®¡ç®—æœºåœ¨å¯åŠ¨ä¸€ä¸ªç¨‹åºçš„æ—¶å€™ï¼Œä¼šä¸ºä»–åˆ†é…ä¸€å—å†…å­˜ï¼Œç”¨æ¥å­˜æ”¾ä»£ç ã€è¿è¡Œä¸­çš„æ•°æ®å’Œä¸€ä¸ªæ‰§è¡Œä»»åŠ¡çš„ä¸»çº¿ç¨‹ã€‚æˆ‘ä»¬çŸ¥é“ç”µè„‘çš„å†…å­˜å…¶å®æ˜¯æœ‰é™çš„ï¼Œæ¯”å¦‚å¸¸è§çš„8Gã€16Gç­‰ç­‰ï¼Œç”šè‡³è¿˜æœ‰ä¸€äº›ä»€ä¹ˆè™šæ‹Ÿå†…å­˜å°±è®¨è®ºäº†ã€‚æˆ‘ä»¬å…³æ³¨ç‚¹åœ¨äºå†…å­˜æ˜¯ä¸€ä¸ªç§ç¨€ç¼ºèµ„æºï¼Œå¯¹äºä¸ç”¨çš„ä¸œè¥¿æˆ‘ä»¬ä¸è¦#å ç€èŒ…å‘ä¸æ‹‰å±#ã€‚</p>\n<p><strong>æ‰€ä»¥åƒåœ¾å›æ”¶çš„ä½œç”¨å°±æ˜¯é‡Šæ”¾ä¸€ä¸‹ä¸å†ä½¿ç”¨çš„å†…å­˜ç©ºé—´ã€‚</strong></p>\n<h3 id=\"å†…å­˜çš„ç»“æ„\"><a href=\"#å†…å­˜çš„ç»“æ„\" class=\"headerlink\" title=\"å†…å­˜çš„ç»“æ„\"></a>å†…å­˜çš„ç»“æ„</h3><p>JavaScriptä¸­ï¼Œåˆ†ä¸ºä¸¤ç§å†…å­˜ç©ºé—´</p>\n<ul>\n<li>å †å†…å­˜-&gt;å­˜å‚¨å¼•ç”¨ç±»å‹</li>\n<li>æ ˆå†…å­˜-&gt;å­˜å‚¨åŸºæœ¬ç±»å‹</li>\n</ul>\n<blockquote>\n<p>åŸºæœ¬ç±»å‹åˆå«åŸå§‹ç±»å‹ï¼›å› ä¸ºæœ¬äººå·²ç»è¯´ä¹ æƒ¯äº†åŸºæœ¬ç±»å‹ï¼Œæ‰€ä»¥ä»¥ä¸‹éƒ½å«åšåŸºæœ¬ç±»å‹å“ˆã€‚</p>\n</blockquote>\n<h2 id=\"å¼•ç”¨ç±»å‹ã€åŸºæœ¬ç±»å‹ä¸å †æ ˆçš„çˆ±æ¨çº è‘›\"><a href=\"#å¼•ç”¨ç±»å‹ã€åŸºæœ¬ç±»å‹ä¸å †æ ˆçš„çˆ±æ¨çº è‘›\" class=\"headerlink\" title=\"å¼•ç”¨ç±»å‹ã€åŸºæœ¬ç±»å‹ä¸å †æ ˆçš„çˆ±æ¨çº è‘›\"></a>å¼•ç”¨ç±»å‹ã€åŸºæœ¬ç±»å‹ä¸å †æ ˆçš„çˆ±æ¨çº è‘›</h2><h3 id=\"å˜é‡å­˜æ”¾\"><a href=\"#å˜é‡å­˜æ”¾\" class=\"headerlink\" title=\"å˜é‡å­˜æ”¾\"></a>å˜é‡å­˜æ”¾</h3><h4 id=\"åŸºæœ¬ç±»å‹\"><a href=\"#åŸºæœ¬ç±»å‹\" class=\"headerlink\" title=\"åŸºæœ¬ç±»å‹\"></a>åŸºæœ¬ç±»å‹</h4><p>æˆªæ­¢åŒ—äº¬æ—¶é—´2020å¹´8æœˆ25æ—¥ï¼›</p>\n<p>åœ¨<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Data_structures\" target=\"_blank\" rel=\"noopener\">MDN</a>ä¸­æ˜¾ç¤ºçš„åŸºæœ¬ç±»å‹ï¼ˆåŸå§‹ç±»å‹ï¼‰æœ‰ä»¥ä¸‹7ç§</p>\n<ul>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Glossary/Boolean\" target=\"_blank\" rel=\"noopener\">Boolean</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Glossary/Null\" target=\"_blank\" rel=\"noopener\">Null</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Glossary/undefined\" target=\"_blank\" rel=\"noopener\">Undefined</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Glossary/Number\" target=\"_blank\" rel=\"noopener\">Number</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Glossary/BigInt\" target=\"_blank\" rel=\"noopener\">BigInt</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Glossary/å­—ç¬¦ä¸²\" target=\"_blank\" rel=\"noopener\">String</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Glossary/Symbol\" target=\"_blank\" rel=\"noopener\">Symbol</a> </li>\n</ul>\n<p>åŸºæœ¬ç±»å‹æ˜¯å­˜å‚¨åœ¨æ ˆå†…å­˜é‡Œé¢çš„ã€‚æ ˆå†…å­˜é‡Œé¢è¿˜å­˜ç€æŒ‡å‘å †å†…å­˜çš„å†…å­˜åœ°å€ã€‚</p>\n<blockquote>\n<p>PSï¼šé—­åŒ…ä¸­ï¼ŒåŸºæœ¬ç±»å‹ä¹Ÿæ˜¯å­˜æ”¾åœ¨å †å†…å­˜ä¸­çš„å“¦ï¼Œè¦æ³¨æ„ä¸€ä¸‹ã€‚</p>\n</blockquote>\n<h4 id=\"å¼•ç”¨ç±»å‹\"><a href=\"#å¼•ç”¨ç±»å‹\" class=\"headerlink\" title=\"å¼•ç”¨ç±»å‹\"></a>å¼•ç”¨ç±»å‹</h4><p>é™¤äº†åŸºæœ¬ç±»å‹çš„æ•°æ®ç»“æ„å°±æ˜¯å¼•ç”¨ç±»å‹ï¼ŒåŒ…æ‹¬ä»€ä¹ˆæ•°ç»„ï¼ˆArrayï¼‰ã€å‡½æ•°ï¼ˆFunctionï¼‰ã€å¯¹è±¡ï¼ˆObjectï¼‰ä¹‹ç±»çš„éƒ½æ˜¯å¼•ç”¨ç±»å‹ã€‚</p>\n<p>å¼•ç”¨ç±»å‹å’Œé—­åŒ…çš„å˜é‡éƒ½æ˜¯å­˜å‚¨åœ¨å †å†…å­˜ä¸­çš„ã€‚è€ŒæŒ‡é’ˆæˆ–è€…è¯´å†…å­˜åœ°å€æ˜¯å­˜åœ¨æ ˆå†…å­˜çš„ã€‚</p>\n<blockquote>\n<p>å½“æŸ¥è¯¢å¼•ç”¨ç±»å‹çš„å˜é‡æ—¶ï¼Œ å…ˆä»<strong>æ ˆä¸­è¯»å–å†…å­˜åœ°å€</strong>ï¼Œ ç„¶åå†é€šè¿‡åœ°å€<strong>æ‰¾åˆ°å †ä¸­çš„å€¼</strong>ã€‚å¯¹äºè¿™ç§ï¼Œæˆ‘ä»¬æŠŠå®ƒå«åšæŒ‰å¼•ç”¨è®¿é—®ã€‚</p>\n</blockquote>\n<p>å¹²è¯´æœ‰ç‚¹éš¾ç†è§£ã€‚èº«ä¸ºé©¬è‰¯çš„æˆ‘ç»™å¤§å®¶ç”»ä¸€å¹…ç”»ï¼Œå¸®åŠ©ç†è§£ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">123</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"literal\">true</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> c = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> d = <span class=\"string\">'123'</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> e = <span class=\"literal\">undefined</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> f = <span class=\"built_in\">Symbol</span>();</span><br><span class=\"line\"><span class=\"keyword\">var</span> g = <span class=\"number\">123n</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> h = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();</span><br><span class=\"line\"><span class=\"comment\">// å­—å¤ªä¸‘äº†ã€‚ã€‚ã€‚ä»£ç å¯ä»¥çœ‹è¿™é‡Œ</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/%E6%B7%B1%E5%85%A5%E5%86%85%E5%AD%98%E4%B8%96%E7%95%8C/1.jpeg\"  alt=\"1\"></p>\n<h3 id=\"å †å†…å­˜å’Œæ ˆå†…å­˜çš„æ€»ç»“\"><a href=\"#å †å†…å­˜å’Œæ ˆå†…å­˜çš„æ€»ç»“\" class=\"headerlink\" title=\"å †å†…å­˜å’Œæ ˆå†…å­˜çš„æ€»ç»“\"></a>å †å†…å­˜å’Œæ ˆå†…å­˜çš„æ€»ç»“</h3><table>\n<thead>\n<tr>\n<th><strong>æ ˆå†…å­˜</strong></th>\n<th>å †å†…å­˜</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>å­˜å‚¨åŸºç¡€æ•°æ®ç±»å‹ä»¥åŠå†…å­˜åœ°å€</td>\n<td>å­˜å‚¨å¼•ç”¨æ•°æ®ç±»å‹ä»¥åŠé—­åŒ…å˜é‡</td>\n</tr>\n<tr>\n<td>æŒ‰å€¼è®¿é—®</td>\n<td>æŒ‰å¼•ç”¨ï¼ˆå†…å­˜åœ°å€ï¼‰è®¿é—®</td>\n</tr>\n<tr>\n<td>å­˜å‚¨çš„å€¼å¤§å°å›ºå®š</td>\n<td>å­˜å‚¨çš„å€¼å¤§å°ä¸å®šï¼Œå¯åŠ¨æ€è°ƒæ•´</td>\n</tr>\n<tr>\n<td>ç”±ç³»ç»Ÿè‡ªåŠ¨åˆ†é…å†…å­˜ç©ºé—´</td>\n<td>ç”±ä»£ç è¿›è¡ŒæŒ‡å®šåˆ†é…</td>\n</tr>\n<tr>\n<td>ç©ºé—´å°ï¼Œè¿è¡Œæ•ˆç‡é«˜</td>\n<td>ç©ºé—´å¤§ï¼Œè¿è¡Œæ•ˆç‡ç›¸å¯¹è¾ƒä½</td>\n</tr>\n</tbody></table>\n<h2 id=\"æ·±æ‹·è´ã€æµ…æ‹·è´ã€èµ‹å€¼é“äººä¸‰é¡¹çš„ä¸è§£æ¸Šæº\"><a href=\"#æ·±æ‹·è´ã€æµ…æ‹·è´ã€èµ‹å€¼é“äººä¸‰é¡¹çš„ä¸è§£æ¸Šæº\" class=\"headerlink\" title=\"æ·±æ‹·è´ã€æµ…æ‹·è´ã€èµ‹å€¼é“äººä¸‰é¡¹çš„ä¸è§£æ¸Šæº\"></a>æ·±æ‹·è´ã€æµ…æ‹·è´ã€èµ‹å€¼é“äººä¸‰é¡¹çš„ä¸è§£æ¸Šæº</h2><h3 id=\"èµ‹å€¼\"><a href=\"#èµ‹å€¼\" class=\"headerlink\" title=\"èµ‹å€¼\"></a>èµ‹å€¼</h3><p>èµ‹å€¼åˆ†ä¸¤ç§æƒ…å†µï¼š</p>\n<ol>\n<li><p>åˆ›å»ºæ–°å€¼</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">123</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br></pre></td></tr></table></figure>\n\n<p>è¿™ç§å°±æ˜¯èµ‹æ–°å€¼çš„æƒ…å†µã€‚</p>\n</li>\n<li><p>èµ‹å€¼å·²æœ‰çš„å˜é‡çš„å€¼</p>\n<p>åœ¨ä¸Šé¢çš„ä¾‹å­åŸºç¡€ä¸Šä¿®æ”¹ä¸€ä¸‹ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">123</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> A = a;</span><br><span class=\"line\"><span class=\"keyword\">var</span> B = b;</span><br></pre></td></tr></table></figure>\n\n<p>è¿™ç§æƒ…å†µå°±æ˜¯èµ‹å€¼å·²æœ‰å˜é‡ã€‚</p>\n</li>\n</ol>\n<p>ğŸ‘Œï¼Œæ¥ä¸‹æ¥æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œè¿˜æ˜¯æŠŠğŸ‘†çš„ğŸŒ°ä¿®æ”¹ä¸€ä¸‹</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">123</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> A = a;</span><br><span class=\"line\"><span class=\"keyword\">var</span> B = b;</span><br><span class=\"line\"></span><br><span class=\"line\">A = <span class=\"number\">1234</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(A);</span><br><span class=\"line\">B.push(<span class=\"number\">4</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(B);</span><br></pre></td></tr></table></figure>\n\n\n\n<p>å¸¦ğŸ”¥è‡ªå·±æ‰“å¼€æ§åˆ¶å°ï¼Œå‚ä¸è¿›æ¥ï¼çœ‹å®Œä¹‹åç„¶åå†çœ‹çœ‹å’Œè‡ªå·±çš„ç†è§£æ˜¯ä¸æ˜¯ä¸€æ ·ï¼Œå¦‚æœæ˜¯ä¸€æ ·çš„è¯ï¼Œè¯´æ˜ä½ å¾ˆğŸ‘ï¼Œä¸æ˜¯çš„è¯å°±ä¸€èµ·æ¥çœ‹çœ‹ğŸ‘‡çš„è§£é‡Šå§ã€‚</p>\n<p>æˆ‘ä»¬è§‚å¯Ÿä¹‹åå‘ç°ï¼Œæˆ‘ä»¬åªä¿®æ”¹äº†<code>B</code>ä½†æ˜¯ï¼Œæˆ‘ä»¬è‹±ä¿Šçš„<code>b</code>ä¹Ÿè¢«ä¿®æ”¹äº†ã€‚</p>\n<p>ï¼Ÿï¼Ÿï¼Ÿï¼ˆè„‘è¡¥é»‘äººé—®å·è„¸ï¼‰</p>\n<p>å…¶å®æˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­è‚¯å®šæ˜¯ä¸å¸Œæœ›è¿™ç§æƒ…å†µçš„å‘ç”Ÿçš„ï¼Œæˆ‘ä»¬ä¿®æ”¹çš„åªæ˜¯<code>B</code>ï¼Œä¸å¸Œæœ›ä¿®æ”¹<code>b</code>çš„ï¼Œä¸ç„¶æˆ‘ä»¬è‚¯å®šä¼šå†™<code>b.push(4)</code>ã€‚</p>\n<p>è¿™æ—¶å°±éœ€è¦ç”¨åˆ°é“äººä¸‰é¡¹çš„å¦å¤–ä¸¤ä¸ªé¡¹ç›®ï¼šæµ…æ‹·è´å’Œæ·±æ‹·è´ã€‚</p>\n<h3 id=\"æµ…æ‹·è´å’Œæ·±æ‹·è´\"><a href=\"#æµ…æ‹·è´å’Œæ·±æ‹·è´\" class=\"headerlink\" title=\"æµ…æ‹·è´å’Œæ·±æ‹·è´\"></a>æµ…æ‹·è´å’Œæ·±æ‹·è´</h3><p>åˆšåˆšè¯´åˆ°å¼•ç”¨ç±»å‹å…¶å®æ˜¯æ”¾åœ¨å †å†…å­˜ä¸­çš„ï¼Œè€Œæ ˆå†…å­˜é‡Œé¢åªå­˜æŒ‡å‘å †å†…å­˜çš„åœ°å€ã€‚ï¼ˆæœ‰ç‚¹æ‹—å£â€¦.ğŸ§˜â€â™‚ï¸ï¼‰</p>\n<p>æµ…æ‹·è´æµ…æ‹·è´ï¼Œé¡¾åæ€ä¹‰ã€‚å°±æ˜¯æµ…ä¸€ç‚¹çš„æ‹·è´ï¼Œæœ‰å¤šæµ…å‘¢ï¼Ÿ</p>\n<p>ä¸€å±‚é‚£ä¹ˆæµ…ã€‚</p>\n<p>ä¹Ÿå°±æ˜¯è¯´é™¤äº†ç¬¬ä¸€å±‚çš„ä¸œè¥¿ï¼Œç¬¬ä¸€å±‚ä¹‹å¤–æ›´æ·±çš„å±‚çº§å°±ä¸æ˜¯æ‹·è´äº†ï¼Œå«æ‹¿åˆ«äººçš„åœ°å€ã€‚</p>\n<p>å£è¯´æ— å‡­ï¼Œæˆ‘å¼„ä¸ªdemoç»™å¤§å®¶ğŸ”¥see seeã€‚</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/%E6%B7%B1%E5%85%A5%E5%86%85%E5%AD%98%E4%B8%96%E7%95%8C/2.png\"  alt=\"2\"></p>\n<p>å¯ä»¥å¾ˆæ¸…æ™°ï¼Œæ¸…æ™°çš„ä¸èƒ½å†æ¸…æ™°çš„çœ‹åˆ°ï¼Œæµ…æ‹·è´å‡ºæ¥çš„å¯¹è±¡é‡Œé¢çš„å±æ€§<code>b</code>å…¶å®è¿˜æ˜¯æŒ‡å‘ä¹‹å‰çš„å¯¹è±¡ï¼Œä¹‹å‰è¯´è¿‡ï¼Œå†æ·±çš„ä»–å°±ä¸æ‹·è´äº†ï¼ŒéªŒè¯çš„è¯å°±äº¤ç»™å¤§å®¶äº†ï¼Œæ¯•ç«Ÿæˆ‘ä»¬æ˜¯ä¸€ä¸ªåŠ¨æ‰‹èŠ‚ç›®ç»„ï¼</p>\n<p>é‚£ä¹ˆæµ…æ‹·è´æœ‰å“ªäº›æ–¹æ³•å‘¢ï¼Ÿ</p>\n<ol>\n<li>Object.assign()</li>\n<li>es6çš„æ‰©å±•è¿ç®—ç¬¦<code>{...xxx}</code></li>\n<li>Array.prototype.slice()</li>\n</ol>\n<h3 id=\"æ·±æ‹·è´\"><a href=\"#æ·±æ‹·è´\" class=\"headerlink\" title=\"æ·±æ‹·è´\"></a>æ·±æ‹·è´</h3><p>çœ‹çœ‹æˆ‘é‚£ä¸ªå®Œç¾çš„å›¾å°±å·²ç»çŸ¥é“äº†ï¼Œæ·±æ‹·è´å°±æ˜¯å®Œç¾çš„å¼„ä¸€ä¸ªä¸€æ¨¡ä¸€æ ·çš„å‡ºæ¥ã€‚</p>\n<p>å¸…å“¥å¸…å“¥ï¼Œæ·±æ‹·è´æœ‰å•¥åŠæ³•æï¼Ÿ</p>\n<ol>\n<li>JSON.parse(JSON.stringify(object))<ol>\n<li>ä¼šå¿½ç•¥ <code>undefined</code></li>\n<li>ä¼šå¿½ç•¥ <code>symbol</code></li>\n<li>ä¸èƒ½åºåˆ—åŒ–å‡½æ•°</li>\n<li>ä¸èƒ½è§£å†³å¾ªç¯å¼•ç”¨çš„å¯¹è±¡</li>\n<li>ä¸èƒ½æ­£ç¡®å¤„ç†`new Date()</li>\n<li>ä¸èƒ½å¤„ç†æ­£åˆ™</li>\n</ol>\n</li>\n<li>è‡ªå·±å†™ä¸€ä¸ªé€’å½’ç„¶åç–¯ç‹‚æµ…æ‹·è´â€¦.</li>\n<li>ç»ˆææ–¹æ¡ˆï¼šlodashçš„<a href=\"https://www.lodashjs.com/docs/lodash.cloneDeep\" target=\"_blank\" rel=\"noopener\"><code>cloneDeep</code></a></li>\n</ol>\n<h3 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h3><table>\n<thead>\n<tr>\n<th></th>\n<th>å’ŒåŸæ•°æ®æ˜¯å¦æŒ‡å‘åŒä¸€å¯¹è±¡</th>\n<th>ç¬¬ä¸€å±‚æ•°æ®ä¸ºåŸºæœ¬æ•°æ®ç±»å‹</th>\n<th>åŸæ•°æ®ä¸­åŒ…å«å­å¯¹è±¡</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>èµ‹å€¼</td>\n<td>æ˜¯</td>\n<td>æ”¹å˜ä¼šä½¿åŸæ•°æ®ä¸€èµ·æ”¹å˜</td>\n<td>æ”¹å˜ä¼šä½¿åŸæ•°æ®ä¸€èµ·æ”¹å˜</td>\n</tr>\n<tr>\n<td>æµ…æ‹·è´</td>\n<td>å¦</td>\n<td>æ”¹å˜ä¸ä¼šä½¿åŸæ•°æ®ä¸€èµ·æ”¹å˜</td>\n<td>æ”¹å˜ä¼šä½¿åŸæ•°æ®ä¸€èµ·æ”¹å˜</td>\n</tr>\n<tr>\n<td>æ·±æ‹·è´</td>\n<td>å¦</td>\n<td>æ”¹å˜ä¸ä¼šä½¿åŸæ•°æ®ä¸€èµ·æ”¹å˜</td>\n<td>æ”¹å˜ä¸ä¼šä½¿åŸæ•°æ®ä¸€èµ·æ”¹å˜</td>\n</tr>\n</tbody></table>\n<h2 id=\"åƒåœ¾å›æ”¶æœºåˆ¶â™»ï¸\"><a href=\"#åƒåœ¾å›æ”¶æœºåˆ¶â™»ï¸\" class=\"headerlink\" title=\"åƒåœ¾å›æ”¶æœºåˆ¶â™»ï¸\"></a>åƒåœ¾å›æ”¶æœºåˆ¶â™»ï¸</h2><p>JavaScriptæœ‰è‡ªåŠ¨åƒåœ¾æ”¶é›†æœºåˆ¶ï¼Œåƒåœ¾æ”¶é›†å™¨ä¼šæ¯éš”ä¸€æ®µæ—¶é—´æˆ–è€…è¾¾åˆ°æŸä¸ªé˜ˆå€¼å°±æ‰§è¡Œä¸€æ¬¡é‡Šæ”¾æ“ä½œï¼Œæ‰¾å‡ºé‚£äº›ä¸å†ç»§ç»­ä½¿ç”¨çš„å€¼ï¼Œç„¶åé‡Šæ”¾å…¶å ç”¨çš„å†…å­˜ã€‚</p>\n<h3 id=\"åˆ¤æ–­æ–¹å¼\"><a href=\"#åˆ¤æ–­æ–¹å¼\" class=\"headerlink\" title=\"åˆ¤æ–­æ–¹å¼\"></a>åˆ¤æ–­æ–¹å¼</h3><p>JavaScriptæ˜¯æ€ä¹ˆåˆ¤æ–­æŸä¸ªå˜é‡æ˜¯å¦éœ€è¦è¢«å›æ”¶çš„ï¼Ÿ</p>\n<p>æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•</p>\n<h3 id=\"æ ‡è®°æ¸…é™¤\"><a href=\"#æ ‡è®°æ¸…é™¤\" class=\"headerlink\" title=\"æ ‡è®°æ¸…é™¤\"></a>æ ‡è®°æ¸…é™¤</h3><p>æ¯”å¦‚ä¸€ä¸ªå‡½æ•°å†…éƒ¨å£°æ˜çš„ä¸€ä¸ªå˜é‡ï¼Œä¸€æ—¦æˆ‘ä»¬çš„ä¸»çº¿ç¨‹ç¦»å¼€äº†è¿™ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å£°æ˜çš„ä¸€äº›å˜é‡å¤–éƒ¨å°±æ— æ³•ç”¨åˆ°ï¼Œé‚£ä¹ˆå°±ä¼šè¢«æ ‡è®°ä¸ºâ€ç¦»å¼€ç¯å¢ƒâ€ã€‚è¿™æ ·åœ¨ä¸‹ä¸€ä¸ªåƒåœ¾å›æ”¶å‘¨æœŸæ¥é¢†çš„æ—¶å€™ï¼Œå°±è‡ªåŠ¨é‡Šæ”¾äº†è¿™äº›å˜é‡å ç”¨çš„å†…å­˜ã€‚</p>\n<h3 id=\"å¼•ç”¨è®¡æ•°\"><a href=\"#å¼•ç”¨è®¡æ•°\" class=\"headerlink\" title=\"å¼•ç”¨è®¡æ•°\"></a>å¼•ç”¨è®¡æ•°</h3><p>å¦ä¸€ç§ä¸å¤ªå¸¸è§çš„åƒåœ¾æ”¶é›†ç­–ç•¥å«åšå¼•ç”¨è®¡æ•°(reference counting)ã€‚å¼•ç”¨è®¡æ•°çš„å«ä¹‰æ˜¯è·Ÿè¸ªè®°å½•æ¯ ä¸ªå€¼è¢«å¼•ç”¨çš„æ¬¡æ•°ã€‚å½“å£°æ˜äº†ä¸€ä¸ªå˜é‡å¹¶å°†ä¸€ä¸ªå¼•ç”¨ç±»å‹å€¼èµ‹ç»™è¯¥å˜é‡æ—¶ï¼Œåˆ™è¿™ä¸ªå€¼çš„å¼•ç”¨æ¬¡æ•°å°±æ˜¯ 1ã€‚ å¦‚æœåŒä¸€ä¸ªå€¼åˆè¢«èµ‹ç»™å¦ä¸€ä¸ªå˜é‡ï¼Œåˆ™è¯¥å€¼çš„å¼•ç”¨æ¬¡æ•°åŠ  1ã€‚ç›¸åï¼Œå¦‚æœåŒ…å«å¯¹è¿™ä¸ªå€¼å¼•ç”¨çš„å˜é‡åˆå– å¾—äº†å¦å¤–ä¸€ä¸ªå€¼ï¼Œåˆ™è¿™ä¸ªå€¼çš„å¼•ç”¨æ¬¡æ•°å‡ 1ã€‚å½“è¿™ä¸ªå€¼çš„å¼•ç”¨æ¬¡æ•°å˜æˆ 0 æ—¶ï¼Œåˆ™è¯´æ˜æ²¡æœ‰åŠæ³•å†è®¿é—®è¿™ ä¸ªå€¼äº†ï¼Œå› è€Œå°±å¯ä»¥å°†å…¶å ç”¨çš„å†…å­˜ç©ºé—´å›æ”¶å›æ¥ã€‚è¿™æ ·ï¼Œå½“åƒåœ¾æ”¶é›†å™¨ä¸‹æ¬¡å†è¿è¡Œæ—¶ï¼Œå®ƒå°±ä¼šé‡Šæ”¾é‚£ äº›å¼•ç”¨æ¬¡æ•°ä¸ºé›¶çš„å€¼æ‰€å ç”¨çš„å†…å­˜ã€‚</p>\n<p>å¼•ç”¨è®¡æ•°æœ‰ä¸€ä¸ªéå¸¸ä¸¥é‡çš„BUGå°±æ˜¯ï¼Œå¦‚æœå­˜åœ¨å¾ªç¯å¼•ç”¨çš„è¯ï¼Œç³»ç»Ÿå°±æ— æ³•åˆ¤æ–­ä½ è¿™ä¸ªå†…å­˜åˆ°åº•è¦ä¸è¦å›æ”¶äº†ã€‚è€Œä¸”å¼•ç”¨çš„æ•°å­—æ°¸è¿œéƒ½ä¸ä¼šæ˜¯0ã€‚ä¸¾ä¸ªä¾‹å­</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> element = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"some_element\"</span>); </span><br><span class=\"line\"><span class=\"keyword\">var</span> myObject = <span class=\"keyword\">new</span> <span class=\"built_in\">Object</span>();</span><br><span class=\"line\">myObject.element = element;</span><br><span class=\"line\">element.someObject = myObject;</span><br></pre></td></tr></table></figure>\n\n<p>è¿™æ ·çš„è¯<code>element</code>å’Œ<code>myObject</code>è¿™å¯¹æƒ…ä¾£å°±æ°¸è¿œå¦‚èƒ¶ä¼¼æ¼†ï¼Œç³»ç»Ÿæ— æ³•å°†ä»–ä»¬é€ä¸Šå¤©å ‚ã€‚</p>\n<p>é‚£å’‹åŠï¼Ÿè¦æ‹†æ•£ä»–ä»¬æœ‰ä¸€ä¸ªä¸»æ„ï¼Œå°±æ˜¯åœ¨ä¸ç”¨çš„æ—¶å€™ç»™ä»–ä»¬ç½®ä¸º<code>null</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">myObject.element = <span class=\"literal\">null</span>; </span><br><span class=\"line\">element.someObject = <span class=\"literal\">null</span>;</span><br></pre></td></tr></table></figure>\n\n<p>å°†å˜é‡è®¾ç½®ä¸º null æ„å‘³ç€åˆ‡æ–­å˜é‡ä¸å®ƒæ­¤å‰å¼•ç”¨çš„å€¼ä¹‹é—´çš„è¿æ¥ã€‚å½“åƒåœ¾æ”¶é›†å™¨ä¸‹æ¬¡è¿è¡Œæ—¶ï¼Œå°± ä¼šåˆ é™¤è¿™äº›å€¼å¹¶å›æ”¶å®ƒä»¬å ç”¨çš„å†…å­˜ã€‚</p>\n<p>æ’æ’­ä¸€ä¸ªå°æ•…äº‹</p>\n<blockquote>\n<p>IE çš„åƒåœ¾æ”¶é›†å™¨æ˜¯æ ¹æ®å†…å­˜åˆ†é…é‡è¿è¡Œçš„ï¼Œå…·ä½“ ä¸€ç‚¹è¯´å°±æ˜¯ 256 ä¸ªå˜é‡ã€4096 ä¸ªå¯¹è±¡(æˆ–æ•°ç»„)å­—é¢é‡å’Œæ•°ç»„å…ƒç´ (slot)æˆ–è€… 64KB çš„å­—ç¬¦ä¸²ã€‚è¾¾åˆ° ä¸Šè¿°ä»»ä½•ä¸€ä¸ªä¸´ç•Œå€¼ï¼Œåƒåœ¾æ”¶é›†å™¨å°±ä¼šè¿è¡Œã€‚è¿™ç§å®ç°æ–¹å¼çš„é—®é¢˜åœ¨äºï¼Œå¦‚æœä¸€ä¸ªè„šæœ¬ä¸­åŒ…å«é‚£ä¹ˆå¤šå˜ é‡ï¼Œé‚£ä¹ˆè¯¥è„šæœ¬å¾ˆå¯èƒ½ä¼šåœ¨å…¶ç”Ÿå‘½å‘¨æœŸä¸­ä¸€ç›´ä¿æœ‰é‚£ä¹ˆå¤šçš„å˜é‡ã€‚è€Œè¿™æ ·ä¸€æ¥ï¼Œåƒåœ¾æ”¶é›†å™¨å°±ä¸å¾—ä¸é¢‘ ç¹åœ°è¿è¡Œã€‚ç»“æœï¼Œç”±æ­¤å¼•å‘çš„ä¸¥é‡æ€§èƒ½é—®é¢˜ä¿ƒä½¿ IE7 é‡å†™äº†å…¶åƒåœ¾æ”¶é›†ä¾‹ç¨‹ã€‚</p>\n<p>éšç€ IE7 çš„å‘å¸ƒï¼Œå…¶ JavaScript å¼•æ“çš„åƒåœ¾æ”¶é›†ä¾‹ç¨‹æ”¹å˜äº†å·¥ä½œæ–¹å¼:è§¦å‘åƒåœ¾æ”¶é›†çš„å˜é‡åˆ†é…ã€ å­—é¢é‡å’Œ(æˆ–)æ•°ç»„å…ƒç´ çš„ä¸´ç•Œå€¼è¢«è°ƒæ•´ä¸ºåŠ¨æ€ä¿®æ­£ã€‚IE7 ä¸­çš„å„é¡¹ä¸´ç•Œå€¼åœ¨åˆå§‹æ—¶ä¸ IE6 ç›¸ç­‰ã€‚å¦‚æœ åƒåœ¾æ”¶é›†ä¾‹ç¨‹å›æ”¶çš„å†…å­˜åˆ†é…é‡ä½äº 15%ï¼Œåˆ™å˜é‡ã€å­—é¢é‡å’Œ(æˆ–)æ•°ç»„å…ƒç´ çš„ä¸´ç•Œå€¼å°±ä¼šåŠ å€ã€‚å¦‚æœ ä¾‹ç¨‹å›æ”¶äº† 85%çš„å†…å­˜åˆ†é…é‡ï¼Œåˆ™å°†å„ç§ä¸´ç•Œå€¼é‡ç½®å›é»˜è®¤å€¼ã€‚è¿™ä¸€çœ‹ä¼¼ç®€å•çš„è°ƒæ•´ï¼Œæå¤§åœ°æå‡äº† IE åœ¨è¿è¡ŒåŒ…å«å¤§é‡ JavaScript çš„é¡µé¢æ—¶çš„æ€§èƒ½ã€‚</p>\n<p>â€”-æ‘˜è‡ªJavaScripté«˜çº§ç¨‹åºè®¾è®¡</p>\n</blockquote>\n<h2 id=\"V8åƒåœ¾å›æ”¶ç­–ç•¥\"><a href=\"#V8åƒåœ¾å›æ”¶ç­–ç•¥\" class=\"headerlink\" title=\"V8åƒåœ¾å›æ”¶ç­–ç•¥\"></a>V8åƒåœ¾å›æ”¶ç­–ç•¥</h2><h3 id=\"ä»€ä¹ˆæ˜¯V8ï¼Ÿ\"><a href=\"#ä»€ä¹ˆæ˜¯V8ï¼Ÿ\" class=\"headerlink\" title=\"ä»€ä¹ˆæ˜¯V8ï¼Ÿ\"></a>ä»€ä¹ˆæ˜¯V8ï¼Ÿ</h3><p>ç®€å•ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯V8ï¼Ÿ</p>\n<blockquote>\n<p><strong>V8</strong>æ˜¯ä¸€ä¸ªç”±<a href=\"https://zh.wikipedia.org/wiki/Google\" target=\"_blank\" rel=\"noopener\">Google</a>å¼€å‘çš„<a href=\"https://zh.wikipedia.org/wiki/å¼€æº\" target=\"_blank\" rel=\"noopener\">å¼€æº</a><a href=\"https://zh.wikipedia.org/wiki/JavaScriptå¼•æ“\" target=\"_blank\" rel=\"noopener\">JavaScriptå¼•æ“</a>ï¼Œç”¨äº<a href=\"https://zh.wikipedia.org/wiki/Google_Chrome\" target=\"_blank\" rel=\"noopener\">Google Chrome</a>åŠ<a href=\"https://zh.wikipedia.org/wiki/Chromium\" target=\"_blank\" rel=\"noopener\">Chromium</a>ä¸­<a href=\"https://zh.wikipedia.org/wiki/V8_(JavaScriptå¼•æ“)#cite_note-comic-2\" target=\"_blank\" rel=\"noopener\">[2]</a>ã€‚</p>\n<p>â€”æ‘˜è‡ªç»´åŸºç™¾ç§‘</p>\n</blockquote>\n<p>æ—¢ç„¶V8æ˜¯Chromeçš„å¼•æ“ï¼Œé‚£ä¹ˆåˆ«çš„æµè§ˆå™¨å‘¢ï¼Ÿ</p>\n<p>ä¸–ç•Œä¸Šä¸»è¦çš„æµè§ˆå™¨æœ‰ä»¥ä¸‹ä¸‰ç§ã€‚</p>\n<p><a href=\"https://en.wikipedia.org/wiki/V8_(JavaScript_engine)\" target=\"_blank\" rel=\"noopener\"><strong>V8</strong></a>â€”â€”å¼€æºï¼Œç”± Google å¼€å‘ï¼Œä½¿ç”¨ C++ ç¼–å†™</p>\n<p><strong><a href=\"https://en.wikipedia.org/wiki/SpiderMonkey_(JavaScript_engine)\" target=\"_blank\" rel=\"noopener\">SpiderMonkey</a></strong>â€”â€”ç¬¬ä¸€ä¸ª JavaScript å¼•æ“ï¼Œè¯¥å¼•æ“è¿‡å»é©±åŠ¨ Netscape Navigatorï¼Œå¦‚ä»Šé©±åŠ¨ Firefox æµè§ˆå™¨ã€‚</p>\n<p><strong><a href=\"https://en.wikipedia.org/wiki/JavaScriptCore\" target=\"_blank\" rel=\"noopener\">JavaScriptCore</a></strong>â€”â€”å¼€æºï¼Œè‹¹æœå…¬å¸ä¸º Safair æµè§ˆå™¨å¼€å‘çš„</p>\n<p>okokokï¼Œæ”¶ï¼å›å½’åˆå¿ƒã€‚</p>\n<h3 id=\"V8çš„åƒåœ¾å›æ”¶ç­–ç•¥\"><a href=\"#V8çš„åƒåœ¾å›æ”¶ç­–ç•¥\" class=\"headerlink\" title=\"V8çš„åƒåœ¾å›æ”¶ç­–ç•¥\"></a>V8çš„åƒåœ¾å›æ”¶ç­–ç•¥</h3><p>æˆ‘ä»¬çš„ä¼Ÿå¤§çš„Chromeï¼Œæ ¹æ®ä¸åŒçš„æƒ…å†µæœ‰ä¸åŒçš„å¯¹ç­–ã€‚ä»–æŠŠå†…å­˜åˆ†æˆä¸¤å—</p>\n<ul>\n<li>æ–°ç”Ÿä»£</li>\n<li>è€ç”Ÿä»£</li>\n</ul>\n<h4 id=\"åˆ†ä»£å†…å­˜\"><a href=\"#åˆ†ä»£å†…å­˜\" class=\"headerlink\" title=\"åˆ†ä»£å†…å­˜\"></a>åˆ†ä»£å†…å­˜</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ32ä½ç³»ç»Ÿæ–°ç”Ÿä»£å†…å­˜å¤§å°ä¸º16MBï¼Œè€ç”Ÿä»£å†…å­˜å¤§å°ä¸º700MBï¼Œ64ä½ç³»ç»Ÿä¸‹ï¼Œæ–°ç”Ÿä»£å†…å­˜å¤§å°ä¸º32MBï¼Œè€ç”Ÿä»£å†…å­˜å¤§å°ä¸º1.4GBã€‚</p>\n<p>æ–°ç”Ÿä»£å¹³å‡åˆ†æˆä¸¤å—ç›¸ç­‰çš„å†…å­˜ç©ºé—´ï¼Œå«åšsemispaceï¼Œæ¯å—å†…å­˜å¤§å°8MBï¼ˆ32ä½ï¼‰æˆ–16MBï¼ˆ64ä½ï¼‰ã€‚</p>\n<h4 id=\"æ–°ç”Ÿä»£ç®—æ³•\"><a href=\"#æ–°ç”Ÿä»£ç®—æ³•\" class=\"headerlink\" title=\"æ–°ç”Ÿä»£ç®—æ³•\"></a>æ–°ç”Ÿä»£ç®—æ³•</h4><p>é¦–å…ˆï¼Œæˆ‘ä»¬ç§‘æ™®ä¸€ä¸‹ä»€ä¹ˆæ˜¯æ–°ç”Ÿä»£ã€‚</p>\n<p>æ–°ç”Ÿä»£çš„å†…å­˜å‘¢ï¼Œå°±æ˜¯å­˜æ´»æ—¶é—´æ¯”è¾ƒçŸ­çš„å¯¹è±¡ã€‚å¦‚æœå­˜æ´»çš„æ—¶é—´æ¯”è¾ƒé•¿çš„è¯å°±ä¼šã€Šæ™‹å‡ã€‹ä¸ºè€ç”Ÿä»£ã€‚ç­‰ä¸€ä¸‹ä¼šç¨å¾®è¯¦ç»†çš„è¯´ä¸€ä¸‹ã€Šæ™‹å‡ã€‹è¿™ä¸ªæ¦‚å¿µã€‚</p>\n<p>æ–°ç”Ÿä»£é‡‡ç”¨<strong>Scavenge GC</strong>åƒåœ¾å›æ”¶ç®—æ³•ï¼Œåœ¨ç®—æ³•å®ç°æ—¶ä¸»è¦é‡‡ç”¨<strong>Cheney</strong>ç®—æ³•ã€‚</p>\n<p>Cheneyç®—æ³•å‘¢æ˜¯å°†å†…å­˜ä¸€åˆ†ä¸ºäºŒï¼Œä¸€å—æš‚æ—¶æŠŠä»–å«åšã€ŠFromã€‹ï¼Œå¦ä¸€å—æš‚æ—¶å«åšã€ŠToã€‹ã€‚çœ‹ä¸€ä¸‹ä¸‹å›¾ï¼Œå°±å¯ä»¥å¾ˆæ¸…æ™°çš„çŸ¥é“V8æ˜¯æ€ä¹ˆåˆ†å‰²å†…å­˜çš„ã€‚</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/%E6%B7%B1%E5%85%A5%E5%86%85%E5%AD%98%E4%B8%96%E7%95%8C/3.png\"  alt=\"3\"></p>\n<p>å†…å­˜çš„åˆ°æ¥å…ˆè¿›å…¥Fromï¼Œç„¶åç­‰åˆ°Fromæ»¡äº†ä¹‹åï¼Œæ–°ç”Ÿä»£çš„GCå°±ä¼šå¯åŠ¨ã€‚</p>\n<p>é¦–å…ˆé‡Šæ”¾æ‰ä¸€äº›ä¸å†ä½¿ç”¨çš„å†…å­˜ï¼Œç„¶åå°†Fromå’ŒToä¸¤ä¸ªåŠŸèƒ½è¿›è¡Œæ›´æ¢ï¼Œä¹Ÿå°±æ˜¯è¯´ä¹‹å‰çš„From -&gt; To  ä¹‹å‰çš„  To -&gt; Fromã€‚è¿™æ ·çš„è¯æ–°ç”Ÿä»£çš„ä¸€è½®GCå°±æ­¤ç»“æŸäº†ã€‚</p>\n<p>è¿™ç§ç®—æ³•æœ‰ç‚¹ç±»ä¼¼ç©ºé—´æ¢æ—¶é—´ï¼Œè€Œæ–°ç”Ÿä»£çš„å¯¹è±¡ç”Ÿå‘½ä¸€èˆ¬éƒ½æ˜¯æ¯”è¾ƒçŸ­çš„ï¼Œæ‰€ä»¥æ‰€ä»¥éå¸¸é€‚åˆæ–°ç”Ÿä»£ã€‚</p>\n<h4 id=\"æ™‹å‡\"><a href=\"#æ™‹å‡\" class=\"headerlink\" title=\"æ™‹å‡\"></a>æ™‹å‡</h4><p>å¯¹è±¡çš„æ™‹å‡å…¶å®ä¸»è¦æœ‰ä¸¤ä¸ªè¦æ±‚ï¼Œå°±å¥½åƒåœ¨æ¥P6å‡P7æœ‰ä¸€å †çš„è¦æ±‚ä¸€æ ·ã€‚</p>\n<ol>\n<li>æ–°ç”Ÿä»£ç®—æ³•åˆšåˆšæˆ‘ä»¬å·²ç»å­¦ä¹ è¿‡äº†ï¼Œå°±æ˜¯Fromå’ŒToçš„äº’æ¢åŠŸèƒ½ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ä»–ç»å†äº†ä¸¤æ¬¡çš„æ–°ç”Ÿä»£çš„æ›´æ›¿ï¼Œè¿˜æ²¡æœ‰è¢«å›æ”¶å†…å­˜ï¼Œè¯´æ˜ä»–å¾ˆå¼ºã€‚å°±éœ€è¦æ™‹å‡ä¸ºè€ç”Ÿä»£ï¼Œè®©è€ç”Ÿä»£çš„ç®—æ³•æ¥å¯¹ä»˜ä»–ã€‚å°±å¥½åƒåœ¨é˜¿é‡Œçš„ä¸€ä¸ªP6ä¸¤è½®361éƒ½æ²¡æœ‰è¢«æ·˜æ±°è¯´æ˜ä»–å¾ˆæœ‰å®åŠ›ï¼Œæ‰€ä»¥ç›´æ¥å‡çº§ä»–ä¸ºP7ã€‚</li>\n<li>å¦‚æœä¸€ä¸ªå¯¹è±¡åœ¨Toçš„å†…å­˜å æ¯”è¶…è¿‡äº†25%ï¼Œåœ¨ç¬¬ä¸€æ¬¡æ›´æ›¿çš„æ—¶å€™å°±ç›´æ¥å°†ä»–æ™‹å‡ä¸ºè€ç”Ÿä»£äº†ã€‚å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæŠ€æœ¯å¤§ç‰›ï¼Œåƒé©¬äº‘ï¼Œä¸€å»é˜¿é‡Œå°±è¢«æ˜Ÿæ¢å‘ç°ï¼Œç›´æ¥å°±æ˜¯P7è¯„çº§ï¼Œä¸éœ€è¦ç»è¿‡ä»€ä¹ˆå¤æ‚çš„é¢è¯•æˆ–è€…ä»€ä¹ˆã€‚</li>\n</ol>\n<h4 id=\"è€ç”Ÿä»£ç®—æ³•\"><a href=\"#è€ç”Ÿä»£ç®—æ³•\" class=\"headerlink\" title=\"è€ç”Ÿä»£ç®—æ³•\"></a>è€ç”Ÿä»£ç®—æ³•</h4><p>æ ¹æ®åˆšåˆšå¯¹ã€Šæ™‹å‡ã€‹çš„äº†è§£ï¼Œæˆ‘ä»¬çŸ¥é“äº†åœ¨è€ç”Ÿä»£é‡Œé¢çš„å¯¹è±¡éƒ½æ˜¯ä¸€äº›éš¾ç¼ çš„é€‰æ‰‹ï¼Œæ¯”å¦‚æœ¬æ¥å°±å å†…å­˜æ¯”ä¾‹å¾ˆå¤§ï¼Œæˆ–è€…ç»å†è¿‡2æ¬¡çš„æ–°ç”Ÿä»£GCï¼Œä¾æ—§åšæŒºçš„é€‰æ‰‹ã€‚</p>\n<p>æ‰€ä»¥ï¼ŒV8åœ¨è€ç”Ÿä»£ä¸­ä¸»è¦é‡‡ç”¨äº†<strong>Mark-Sweep</strong>å’Œ<strong>Mark-Compact</strong>ç›¸ç»“åˆçš„æ–¹å¼è¿›è¡Œåƒåœ¾å›æ”¶ã€‚</p>\n<p>åœ¨ä»‹ç»è€ç”Ÿä»£ç®—æ³•ä¹‹å‰ï¼Œå…ˆç§‘æ™®ä¸€ä¸‹<strong>Mark-Sweep</strong>å’Œ<strong>Mark-Compact</strong>ã€‚</p>\n<h5 id=\"Mark-Sweep\"><a href=\"#Mark-Sweep\" class=\"headerlink\" title=\"Mark-Sweep\"></a><strong>Mark-Sweep</strong></h5><p>Mark-Sweepæ˜¯æ ‡è®°æ¸…é™¤çš„æ„æ€ï¼Œå®ƒåˆ†ä¸ºæ ‡è®°å’Œæ¸…é™¤ä¸¤ä¸ªé˜¶æ®µã€‚</p>\n<p>ä¸Scavengeä¸åŒï¼ŒMark-Sweepå¹¶ä¸ä¼šå°†å†…å­˜åˆ†ä¸ºä¸¤ä»½ï¼Œæ‰€ä»¥ä¸å­˜åœ¨æµªè´¹ä¸€åŠç©ºé—´çš„è¡Œä¸ºã€‚Mark-Sweepåœ¨æ ‡è®°é˜¶æ®µéå†å †å†…å­˜ä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼Œå¹¶æ ‡è®°æ´»ç€çš„å¯¹è±¡ï¼Œåœ¨éšåçš„æ¸…é™¤é˜¶æ®µï¼Œåªæ¸…é™¤æ²¡æœ‰è¢«æ ‡è®°çš„å¯¹è±¡ã€‚</p>\n<p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒScavengeåªå¤åˆ¶æ´»ç€çš„å¯¹è±¡ï¼Œè€ŒMark-Sweepåªæ¸…é™¤æ­»äº†çš„å¯¹è±¡ã€‚æ´»å¯¹è±¡åœ¨æ–°ç”Ÿä»£ä¸­åªå è¾ƒå°‘éƒ¨åˆ†ï¼Œæ­»å¯¹è±¡åœ¨è€ç”Ÿä»£ä¸­åªå è¾ƒå°‘éƒ¨åˆ†ï¼Œè¿™å°±æ˜¯ä¸¤ç§å›æ”¶æ–¹å¼éƒ½èƒ½é«˜æ•ˆå¤„ç†çš„åŸå› ã€‚</p>\n<blockquote>\n<p>åœ¨æ ‡è®°å¤§å‹å¯¹å†…å­˜æ—¶ï¼Œå¯èƒ½éœ€è¦å‡ ç™¾æ¯«ç§’æ‰èƒ½å®Œæˆä¸€æ¬¡æ ‡è®°ã€‚è¿™å°±ä¼šå¯¼è‡´ä¸€äº›æ€§èƒ½ä¸Šçš„é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ2011 å¹´ï¼ŒV8 ä» stop-the-world æ ‡è®°åˆ‡æ¢åˆ°å¢é‡æ ‡å¿—ã€‚åœ¨å¢é‡æ ‡è®°æœŸé—´ï¼ŒGC å°†æ ‡è®°å·¥ä½œåˆ†è§£ä¸ºæ›´å°çš„æ¨¡å—ï¼Œå¯ä»¥è®© JS åº”ç”¨é€»è¾‘åœ¨æ¨¡å—é—´éš™æ‰§è¡Œä¸€ä¼šï¼Œä»è€Œä¸è‡³äºè®©åº”ç”¨å‡ºç°åœé¡¿æƒ…å†µã€‚ä½†åœ¨ 2018 å¹´ï¼ŒGC æŠ€æœ¯åˆæœ‰äº†ä¸€ä¸ªé‡å¤§çªç ´ï¼Œè¿™é¡¹æŠ€æœ¯åä¸ºå¹¶å‘æ ‡è®°ã€‚è¯¥æŠ€æœ¯å¯ä»¥è®© GC æ‰«æå’Œæ ‡è®°å¯¹è±¡æ—¶ï¼ŒåŒæ—¶å…è®¸ JS è¿è¡Œï¼Œä½ å¯ä»¥ç‚¹å‡» <a href=\"https://v8project.blogspot.com/2018/06/concurrent-marking.html\" target=\"_blank\" rel=\"noopener\">è¯¥åšå®¢</a> è¯¦ç»†é˜…è¯»ã€‚</p>\n</blockquote>\n<h5 id=\"Mark-Compact\"><a href=\"#Mark-Compact\" class=\"headerlink\" title=\"Mark-Compact\"></a><strong>Mark-Compact</strong></h5><p>åœ¨æ¸…é™¤å®Œå¯¹è±¡åï¼Œè¿™äº›å¯¹è±¡åœ¨å†…å­˜å†…éƒ¨å°±ä¸æ˜¯è¿ç»­çš„ã€‚è¿™æ ·å†…å­˜åœ°å€å°±æ— æ³•å¾ˆå¥½åœ°åˆ©ç”¨èµ·æ¥ï¼Œå› ä¸ºä»–ä»¬éœ€è¦è¿ç»­çš„å†…å­˜ï¼Œæœ‰çš„å¤§çš„å¯¹è±¡å°±æ— æ³•å¡å…¥åˆšåˆšé‡Šæ”¾çš„å°å†…å­˜å½“ä¸­ã€‚</p>\n<p>è€ŒMark-Compactå°±æ˜¯ç”¨äºè§£å†³å†…å­˜ç¢ç‰‡çš„é—®é¢˜ï¼Œä»–ä¸»è¦å¹²çš„æ´»å°±æ˜¯ç§»åŠ¨è¿™äº›å¯¹è±¡ï¼Œè®©ä»–ä»¬å˜æˆç´§å‡‘èµ·æ¥ã€‚</p>\n<p>æ¸…é™¤å¯¹è±¡åä¼šé€ æˆå †å†…å­˜å‡ºç°ç¢ç‰‡çš„æƒ…å†µï¼Œå½“ç¢ç‰‡è¶…è¿‡ä¸€å®šé™åˆ¶åä¼šå¯åŠ¨å‹ç¼©ç®—æ³•ã€‚åœ¨å‹ç¼©è¿‡ç¨‹ä¸­ï¼Œå°†æ´»çš„å¯¹è±¡åƒä¸€ç«¯ç§»åŠ¨ï¼Œç›´åˆ°æ‰€æœ‰å¯¹è±¡éƒ½ç§»åŠ¨å®Œæˆç„¶åæ¸…ç†æ‰ä¸éœ€è¦çš„å†…å­˜ã€‚</p>\n<h5 id=\"æ€»ç»“-1\"><a href=\"#æ€»ç»“-1\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h5><p>åœ¨V8çš„å›æ”¶ç­–ç•¥ä¸­ï¼ŒMark-Sweepå’ŒMark-Conpactä¸¤è€…æ˜¯ç»“åˆä½¿ç”¨çš„ã€‚</p>\n<p>ç”±äºMark-Conpactéœ€è¦ç§»åŠ¨å¯¹è±¡ï¼Œæ‰€ä»¥å®ƒçš„æ‰§è¡Œé€Ÿåº¦ä¸å¯èƒ½å¾ˆå¿«ï¼Œåœ¨å–èˆä¸Šï¼ŒV8ä¸»è¦ä½¿ç”¨Mark-Sweepï¼Œåœ¨ç©ºé—´ä¸è¶³ä»¥å¯¹ä»æ–°ç”Ÿä»£ä¸­æ™‹å‡è¿‡æ¥çš„å¯¹è±¡è¿›è¡Œåˆ†é…æ—¶ï¼Œæ‰ä½¿ç”¨Mark-Compactã€‚</p>\n<h2 id=\"JavaScriptå†…å­˜æ³„æ¼\"><a href=\"#JavaScriptå†…å­˜æ³„æ¼\" class=\"headerlink\" title=\"JavaScriptå†…å­˜æ³„æ¼\"></a>JavaScriptå†…å­˜æ³„æ¼</h2><h3 id=\"ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼\"><a href=\"#ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼\" class=\"headerlink\" title=\"ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼\"></a>ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼</h3><p>ç¨‹åºçš„è¿è¡Œéœ€è¦å†…å­˜ã€‚åªè¦ç¨‹åºæå‡ºè¦æ±‚ï¼Œæ“ä½œç³»ç»Ÿæˆ–è€…è¿è¡Œæ—¶ï¼ˆruntimeï¼‰å°±å¿…é¡»ä¾›ç»™å†…å­˜ã€‚</p>\n<p>å¯¹äºæŒç»­è¿è¡Œçš„æœåŠ¡è¿›ç¨‹ï¼ˆdaemonï¼‰ï¼Œå¿…é¡»åŠæ—¶é‡Šæ”¾ä¸å†ç”¨åˆ°çš„å†…å­˜ã€‚å¦åˆ™ï¼Œå†…å­˜å ç”¨è¶Šæ¥è¶Šé«˜ï¼Œè½»åˆ™å½±å“ç³»ç»Ÿæ€§èƒ½ï¼Œé‡åˆ™å¯¼è‡´è¿›ç¨‹å´©æºƒã€‚</p>\n<p><strong>ä¸å†ç”¨åˆ°çš„å†…å­˜ï¼Œæ²¡æœ‰åŠæ—¶é‡Šæ”¾ï¼Œå°±å«åšå†…å­˜æ³„æ¼</strong>ï¼ˆmemory leakï¼‰ã€‚</p>\n<h3 id=\"å¸¸è§çš„å†…å­˜æ³„æ¼\"><a href=\"#å¸¸è§çš„å†…å­˜æ³„æ¼\" class=\"headerlink\" title=\"å¸¸è§çš„å†…å­˜æ³„æ¼\"></a>å¸¸è§çš„å†…å­˜æ³„æ¼</h3><ol>\n<li><p>å®šæ—¶å™¨æœªåŠæ—¶æ¸…é™¤</p>\n</li>\n<li><p>æ„å¤–çš„å…¨å±€å˜é‡</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">arg</span>) </span>&#123;</span><br><span class=\"line\">    bar = <span class=\"string\">\"this is a hidden global variable\"</span>;  <span class=\"comment\">// æ„å¤–æŒ‚åœ¨åœ¨ window å…¨å±€å˜é‡ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>è¿™é‡Œæ˜¯æƒ³è¯´ä¸€ä¸‹é«˜ç¨‹ï¼ˆJavaScripté«˜çº§ç¨‹åºè®¾è®¡ç¬¬ä¸‰ç‰ˆï¼‰é‡Œé¢çš„ä¸€ä¸ªéå¸¸ç»å…¸çš„demoã€‚</p>\n</li>\n<li><p>é—­åŒ…çš„æ»¥ç”¨</p>\n</li>\n</ol>\n<h3 id=\"WeakMapä¸WeakSet\"><a href=\"#WeakMapä¸WeakSet\" class=\"headerlink\" title=\"WeakMapä¸WeakSet\"></a>WeakMapä¸WeakSet</h3><p>å…¶å®è¿™ä¸¤ä¸ªåœ¨è¿™ç¯‡æ–‡ç« é‡Œé¢çš„æ„ä¹‰ç›¸åŒï¼Œåªéœ€è¦ä»‹ç»ä¸€ä¸ªå°±è¡Œã€‚</p>\n<p>æˆ‘ä»¬çŸ¥é“Mapæ˜¯ç®€å•çš„key-valueã€‚è€Œä¸”keyå¯ä»¥ä¸ºä»»æ„ç±»å‹ï¼Œæ¯”å¦‚å¼•ç”¨ç±»å‹ï¼Œå¦‚æœæˆ‘ä»¬çš„keyæ˜¯å¼•ç”¨ç±»å‹é‚£ä¹ˆä»–æ‰€å æ®çš„å†…å­˜å°±æ— æ³•è¢«é‡Šæ”¾äº†ã€‚</p>\n<p>åˆæœ‰åŒå­¦é—®é¢˜äº†ï¼Œæˆ‘æœ‰æ¯›ç—…å•Šï¼Œæˆ‘éè¦å¼•ç”¨ç±»å‹å—ï¼Ÿæˆ‘stringå’Œnumberä»–ä¸é¦™å—ï¼Ÿ</p>\n<p>åŸºæœ¬ä¸Šï¼Œå¦‚æœä½ è¦å¾€å¯¹è±¡ä¸Šæ·»åŠ æ•°æ®ï¼Œåˆä¸æƒ³å¹²æ‰°åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå°±å¯ä»¥ä½¿ç”¨ WeakMapã€‚ä¸€ä¸ªå…¸å‹åº”ç”¨åœºæ™¯æ˜¯ï¼Œåœ¨ç½‘é¡µçš„ DOM å…ƒç´ ä¸Šæ·»åŠ æ•°æ®ï¼Œå°±å¯ä»¥ä½¿ç”¨<code>WeakMap</code>ç»“æ„ã€‚å½“è¯¥ DOM å…ƒç´ è¢«æ¸…é™¤ï¼Œå…¶æ‰€å¯¹åº”çš„<code>WeakMap</code>è®°å½•å°±ä¼šè‡ªåŠ¨è¢«ç§»é™¤ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> wm = <span class=\"keyword\">new</span> <span class=\"built_in\">WeakMap</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> element = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'example'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">wm.set(element, <span class=\"string\">'some information'</span>);</span><br><span class=\"line\">wm.get(element) <span class=\"comment\">// \"some information\"</span></span><br></pre></td></tr></table></figure>\n\n<p>ä¸Šé¢ä»£ç ä¸­ï¼Œå…ˆæ–°å»ºä¸€ä¸ª Weakmap å®ä¾‹ã€‚ç„¶åï¼Œå°†ä¸€ä¸ª DOM èŠ‚ç‚¹ä½œä¸ºé”®åå­˜å…¥è¯¥å®ä¾‹ï¼Œå¹¶å°†ä¸€äº›é™„åŠ ä¿¡æ¯ä½œä¸ºé”®å€¼ï¼Œä¸€èµ·å­˜æ”¾åœ¨ WeakMap é‡Œé¢ã€‚è¿™æ—¶ï¼ŒWeakMap é‡Œé¢å¯¹<code>element</code>çš„å¼•ç”¨å°±æ˜¯å¼±å¼•ç”¨ï¼Œä¸ä¼šè¢«è®¡å…¥åƒåœ¾å›æ”¶æœºåˆ¶ã€‚</p>\n<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸Šé¢çš„ DOM èŠ‚ç‚¹å¯¹è±¡çš„å¼•ç”¨è®¡æ•°æ˜¯<code>1</code>ï¼Œè€Œä¸æ˜¯<code>2</code>ã€‚è¿™æ—¶ï¼Œä¸€æ—¦æ¶ˆé™¤å¯¹è¯¥èŠ‚ç‚¹çš„å¼•ç”¨ï¼Œå®ƒå ç”¨çš„å†…å­˜å°±ä¼šè¢«åƒåœ¾å›æ”¶æœºåˆ¶é‡Šæ”¾ã€‚Weakmap ä¿å­˜çš„è¿™ä¸ªé”®å€¼å¯¹ï¼Œä¹Ÿä¼šè‡ªåŠ¨æ¶ˆå¤±ã€‚</p>\n<p>æ€»ä¹‹ï¼Œ<code>WeakMap</code>çš„ä¸“ç”¨åœºåˆå°±æ˜¯ï¼Œå®ƒçš„é”®æ‰€å¯¹åº”çš„å¯¹è±¡ï¼Œå¯èƒ½ä¼šåœ¨å°†æ¥æ¶ˆå¤±ã€‚<code>WeakMap</code>ç»“æ„æœ‰åŠ©äºé˜²æ­¢å†…å­˜æ³„æ¼ã€‚</p>\n<p>æ›´å¤šçš„çŸ¥è¯†å°±ä¸è®¨è®ºäº†ï¼Œè¿™é‡Œæ˜¯å†…å­˜ä¸–ç•Œï¼ä¸æ˜¯ä»€ä¹ˆWeakMapä¸“åœºå“¦ã€‚</p>\n<p>æ€ä¹ˆéªŒè¯ï¼Ÿemmmmmâ€¦.è¿™é‡Œæˆ‘copyä¸€ä¸‹é˜®ä¸€å³°è€å¸ˆçš„å†…å®¹ã€‚</p>\n<h3 id=\"é˜®è€å¸ˆçš„demo\"><a href=\"#é˜®è€å¸ˆçš„demo\" class=\"headerlink\" title=\"é˜®è€å¸ˆçš„demo\"></a>é˜®è€å¸ˆçš„demo</h3><p>é¦–å…ˆï¼Œæ‰“å¼€ Node å‘½ä»¤è¡Œã€‚</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ node --expose-gc</span><br></pre></td></tr></table></figure>\n\n<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>--expose-gc</code>å‚æ•°è¡¨ç¤ºå…è®¸æ‰‹åŠ¨æ‰§è¡Œåƒåœ¾å›æ”¶æœºåˆ¶ã€‚</p>\n<p>ç„¶åï¼Œæ‰§è¡Œä¸‹é¢çš„ä»£ç ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// æ‰‹åŠ¨æ‰§è¡Œä¸€æ¬¡åƒåœ¾å›æ”¶ï¼Œä¿è¯è·å–çš„å†…å­˜ä½¿ç”¨çŠ¶æ€å‡†ç¡®</span></span><br><span class=\"line\">&gt; global.gc();</span><br><span class=\"line\"><span class=\"literal\">undefined</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æŸ¥çœ‹å†…å­˜å ç”¨çš„åˆå§‹çŠ¶æ€ï¼ŒheapUsed ä¸º 4M å·¦å³</span></span><br><span class=\"line\">&gt; process.memoryUsage();</span><br><span class=\"line\">&#123; <span class=\"attr\">rss</span>: <span class=\"number\">21106688</span>,</span><br><span class=\"line\">  heapTotal: <span class=\"number\">7376896</span>,</span><br><span class=\"line\">  heapUsed: <span class=\"number\">4153936</span>,</span><br><span class=\"line\">  external: <span class=\"number\">9059</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; <span class=\"keyword\">let</span> wm = <span class=\"keyword\">new</span> <span class=\"built_in\">WeakMap</span>();</span><br><span class=\"line\"><span class=\"literal\">undefined</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æ–°å»ºä¸€ä¸ªå˜é‡ keyï¼ŒæŒ‡å‘ä¸€ä¸ª 5*1024*1024 çš„æ•°ç»„</span></span><br><span class=\"line\">&gt; <span class=\"keyword\">let</span> key = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>(<span class=\"number\">5</span> * <span class=\"number\">1024</span> * <span class=\"number\">1024</span>);</span><br><span class=\"line\"><span class=\"literal\">undefined</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è®¾ç½® WeakMap å®ä¾‹çš„é”®åï¼Œä¹ŸæŒ‡å‘ key æ•°ç»„</span></span><br><span class=\"line\"><span class=\"comment\">// è¿™æ—¶ï¼Œkey æ•°ç»„å®é™…è¢«å¼•ç”¨äº†ä¸¤æ¬¡ï¼Œ</span></span><br><span class=\"line\"><span class=\"comment\">// å˜é‡ key å¼•ç”¨ä¸€æ¬¡ï¼ŒWeakMap çš„é”®åå¼•ç”¨äº†ç¬¬äºŒæ¬¡</span></span><br><span class=\"line\"><span class=\"comment\">// ä½†æ˜¯ï¼ŒWeakMap æ˜¯å¼±å¼•ç”¨ï¼Œå¯¹äºå¼•æ“æ¥è¯´ï¼Œå¼•ç”¨è®¡æ•°è¿˜æ˜¯1</span></span><br><span class=\"line\">&gt; wm.set(key, <span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"built_in\">WeakMap</span> &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; global.gc();</span><br><span class=\"line\"><span class=\"literal\">undefined</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è¿™æ—¶å†…å­˜å ç”¨ heapUsed å¢åŠ åˆ° 45M äº†</span></span><br><span class=\"line\">&gt; process.memoryUsage();</span><br><span class=\"line\">&#123; <span class=\"attr\">rss</span>: <span class=\"number\">67538944</span>,</span><br><span class=\"line\">  heapTotal: <span class=\"number\">7376896</span>,</span><br><span class=\"line\">  heapUsed: <span class=\"number\">45782816</span>,</span><br><span class=\"line\">  external: <span class=\"number\">8945</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æ¸…é™¤å˜é‡ key å¯¹æ•°ç»„çš„å¼•ç”¨ï¼Œ</span></span><br><span class=\"line\"><span class=\"comment\">// ä½†æ²¡æœ‰æ‰‹åŠ¨æ¸…é™¤ WeakMap å®ä¾‹çš„é”®åå¯¹æ•°ç»„çš„å¼•ç”¨</span></span><br><span class=\"line\">&gt; key = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"literal\">null</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// å†æ¬¡æ‰§è¡Œåƒåœ¾å›æ”¶</span></span><br><span class=\"line\">&gt; global.gc();</span><br><span class=\"line\"><span class=\"literal\">undefined</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// å†…å­˜å ç”¨ heapUsed å˜å› 4M å·¦å³ï¼Œ</span></span><br><span class=\"line\"><span class=\"comment\">// å¯ä»¥çœ‹åˆ° WeakMap çš„é”®åå¼•ç”¨æ²¡æœ‰é˜»æ­¢ gc å¯¹å†…å­˜çš„å›æ”¶</span></span><br><span class=\"line\">&gt; process.memoryUsage();</span><br><span class=\"line\">&#123; <span class=\"attr\">rss</span>: <span class=\"number\">20639744</span>,</span><br><span class=\"line\">  heapTotal: <span class=\"number\">8425472</span>,</span><br><span class=\"line\">  heapUsed: <span class=\"number\">3979792</span>,</span><br><span class=\"line\">  external: <span class=\"number\">8956</span> &#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä¸Šé¢ä»£ç ä¸­ï¼Œåªè¦å¤–éƒ¨çš„å¼•ç”¨æ¶ˆå¤±ï¼ŒWeakMap å†…éƒ¨çš„å¼•ç”¨ï¼Œå°±ä¼šè‡ªåŠ¨è¢«åƒåœ¾å›æ”¶æ¸…é™¤ã€‚ç”±æ­¤å¯è§ï¼Œæœ‰äº† WeakMap çš„å¸®åŠ©ï¼Œè§£å†³å†…å­˜æ³„æ¼å°±ä¼šç®€å•å¾ˆå¤šã€‚</p>\n<h2 id=\"çœ‹å®Œå‡ ä»¶äº‹\"><a href=\"#çœ‹å®Œå‡ ä»¶äº‹\" class=\"headerlink\" title=\"çœ‹å®Œå‡ ä»¶äº‹\"></a>çœ‹å®Œå‡ ä»¶äº‹</h2><p>å¦‚æœä½ è§‰å¾—å¯¹ä½ æœ‰å¸®åŠ©ï¼Œå°±å¸®æˆ‘ç‚¹ä¸ªèµå§ï¼Œä¹Ÿç®—æ˜¯å¯¹æˆ‘çš„è‚¯å®šã€‚è°¢è°¢ï¼Œå¦‚æœæœ‰é”™è¯¯çš„åœ°æ–¹æ¬¢è¿å¤§å®¶æŒ‡å‡ºæ¥ã€‚ä¸€èµ·è®¨è®ºå­¦ä¹ ã€‚æˆ‘æ˜¯Derrickï¼Œä¸€åæ­£åœ¨å»é˜¿é‡Œè·¯ä¸Šçš„å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆã€‚</p>\n<h2 id=\"reference\"><a href=\"#reference\" class=\"headerlink\" title=\"reference\"></a>reference</h2><blockquote>\n<p><a href=\"https://muyiy.cn/blog/1/1.3.html#æ ˆæ•°æ®ç»“æ„\" target=\"_blank\" rel=\"noopener\">https://muyiy.cn/blog/1/1.3.html#%E6%A0%88%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84</a></p>\n<p><a href=\"http://www.ruanyifeng.com/blog/2017/04/memory-leak.html\" target=\"_blank\" rel=\"noopener\">http://www.ruanyifeng.com/blog/2017/04/memory-leak.html</a></p>\n<p><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Map\" target=\"_blank\" rel=\"noopener\">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Map</a></p>\n<p><a href=\"https://juejin.im/post/6844903615300108302\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/6844903615300108302</a></p>\n<p><a href=\"https://juejin.im/post/6844903591510016007\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/6844903591510016007</a></p>\n<p>JavaScripté«˜çº§ç¨‹åºè®¾è®¡ï¼ˆç¬¬ä¸‰ç‰ˆï¼‰</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<p>æœ€è¿‘åœ¨å†™ã€é‡æ‹¾å‰ç«¯ã€‘ç³»åˆ—ï¼Œä¸‹é¢æœ‰å‡ ä¸ªå¿«é€Ÿé€šé“ï¼Œå¤§å®¶è‡ªå–</p>\n<p><a href=\"https://juejin.im/post/6850418113944420359\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿</a></p>\n<p><a href=\"https://juejin.im/post/6850418117508759566\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—</a></p>\n<p><a href=\"https://juejin.im/post/6854573215658803208\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this</a></p>\n<p><a href=\"https://juejin.im/post/6859911609633767438\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šJavaScriptçš„æ‰§è¡Œæœºåˆ¶</a></p>\n<p><a href=\"https://juejin.im/post/6860375101322461198\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC</a></p>\n<p><a href=\"https://juejin.im/post/6865204092877144077\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ</a></p>\n<h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><p>ç”¨äºè®°å½•æœ¬äººçš„å­¦ä¹ è¿‡ç¨‹ï¼Œå¸Œæœ›å¯ä»¥å¸®åŠ©åˆ°å¤§å®¶~ğŸ¤ </p>\n<p>JavaScriptæœ‰è‡ªåŠ¨åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå¯èƒ½å› ä¸ºè¿™ä¸ªè‡ªåŠ¨è®©æˆ‘ä»¬å‰ç«¯å¼€å‘äººå‘˜å¿½ç•¥äº†å¯¹ä»–çš„è®¤è¯†ï¼ˆåŒ…æ‹¬æˆ‘è‡ªå·±ï¼‰ï¼Œä½†æ˜¯é˜¿é‡Œçš„é¢è¯•å®˜å¯ä¸ä¼šå’Œä½ å˜»å˜»å“ˆå“ˆã€‚</p>\n<p>â€œåƒåœ¾å›æ”¶çš„æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿä»€ä¹ˆæ—¶å€™ä¼šå»è§¦å‘â€</p>\n<p>æˆ‘ä¸€è„¸æ‡µé€¼â€¦.å•¥â€¦è¿™ä¸ªä¸æ˜¯ä»–è‡ªå·±è¿è¡Œçš„å—â€¦ğŸ¤•</p>\n<p>è¿˜æ˜¯è€è§„çŸ©ï¼Œé»„é‡‘åœˆæ³•åˆ™ï¼š</p>\n<h3 id=\"ä¸ºä»€ä¹ˆæœ‰åƒåœ¾å›æ”¶â™»ï¸ï¼Œæˆ–è€…è¯´åƒåœ¾å›æ”¶çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ\"><a href=\"#ä¸ºä»€ä¹ˆæœ‰åƒåœ¾å›æ”¶â™»ï¸ï¼Œæˆ–è€…è¯´åƒåœ¾å›æ”¶çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆæœ‰åƒåœ¾å›æ”¶â™»ï¸ï¼Œæˆ–è€…è¯´åƒåœ¾å›æ”¶çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ\"></a>ä¸ºä»€ä¹ˆæœ‰åƒåœ¾å›æ”¶â™»ï¸ï¼Œæˆ–è€…è¯´åƒåœ¾å›æ”¶çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>è®¡ç®—æœºåœ¨å¯åŠ¨ä¸€ä¸ªç¨‹åºçš„æ—¶å€™ï¼Œä¼šä¸ºä»–åˆ†é…ä¸€å—å†…å­˜ï¼Œç”¨æ¥å­˜æ”¾ä»£ç ã€è¿è¡Œä¸­çš„æ•°æ®å’Œä¸€ä¸ªæ‰§è¡Œä»»åŠ¡çš„ä¸»çº¿ç¨‹ã€‚æˆ‘ä»¬çŸ¥é“ç”µè„‘çš„å†…å­˜å…¶å®æ˜¯æœ‰é™çš„ï¼Œæ¯”å¦‚å¸¸è§çš„8Gã€16Gç­‰ç­‰ï¼Œç”šè‡³è¿˜æœ‰ä¸€äº›ä»€ä¹ˆè™šæ‹Ÿå†…å­˜å°±è®¨è®ºäº†ã€‚æˆ‘ä»¬å…³æ³¨ç‚¹åœ¨äºå†…å­˜æ˜¯ä¸€ä¸ªç§ç¨€ç¼ºèµ„æºï¼Œå¯¹äºä¸ç”¨çš„ä¸œè¥¿æˆ‘ä»¬ä¸è¦#å ç€èŒ…å‘ä¸æ‹‰å±#ã€‚</p>\n<p><strong>æ‰€ä»¥åƒåœ¾å›æ”¶çš„ä½œç”¨å°±æ˜¯é‡Šæ”¾ä¸€ä¸‹ä¸å†ä½¿ç”¨çš„å†…å­˜ç©ºé—´ã€‚</strong></p>\n<h3 id=\"å†…å­˜çš„ç»“æ„\"><a href=\"#å†…å­˜çš„ç»“æ„\" class=\"headerlink\" title=\"å†…å­˜çš„ç»“æ„\"></a>å†…å­˜çš„ç»“æ„</h3><p>JavaScriptä¸­ï¼Œåˆ†ä¸ºä¸¤ç§å†…å­˜ç©ºé—´</p>\n<ul>\n<li>å †å†…å­˜-&gt;å­˜å‚¨å¼•ç”¨ç±»å‹</li>\n<li>æ ˆå†…å­˜-&gt;å­˜å‚¨åŸºæœ¬ç±»å‹</li>\n</ul>\n<blockquote>\n<p>åŸºæœ¬ç±»å‹åˆå«åŸå§‹ç±»å‹ï¼›å› ä¸ºæœ¬äººå·²ç»è¯´ä¹ æƒ¯äº†åŸºæœ¬ç±»å‹ï¼Œæ‰€ä»¥ä»¥ä¸‹éƒ½å«åšåŸºæœ¬ç±»å‹å“ˆã€‚</p>\n</blockquote>\n<h2 id=\"å¼•ç”¨ç±»å‹ã€åŸºæœ¬ç±»å‹ä¸å †æ ˆçš„çˆ±æ¨çº è‘›\"><a href=\"#å¼•ç”¨ç±»å‹ã€åŸºæœ¬ç±»å‹ä¸å †æ ˆçš„çˆ±æ¨çº è‘›\" class=\"headerlink\" title=\"å¼•ç”¨ç±»å‹ã€åŸºæœ¬ç±»å‹ä¸å †æ ˆçš„çˆ±æ¨çº è‘›\"></a>å¼•ç”¨ç±»å‹ã€åŸºæœ¬ç±»å‹ä¸å †æ ˆçš„çˆ±æ¨çº è‘›</h2><h3 id=\"å˜é‡å­˜æ”¾\"><a href=\"#å˜é‡å­˜æ”¾\" class=\"headerlink\" title=\"å˜é‡å­˜æ”¾\"></a>å˜é‡å­˜æ”¾</h3><h4 id=\"åŸºæœ¬ç±»å‹\"><a href=\"#åŸºæœ¬ç±»å‹\" class=\"headerlink\" title=\"åŸºæœ¬ç±»å‹\"></a>åŸºæœ¬ç±»å‹</h4><p>æˆªæ­¢åŒ—äº¬æ—¶é—´2020å¹´8æœˆ25æ—¥ï¼›</p>\n<p>åœ¨<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Data_structures\" target=\"_blank\" rel=\"noopener\">MDN</a>ä¸­æ˜¾ç¤ºçš„åŸºæœ¬ç±»å‹ï¼ˆåŸå§‹ç±»å‹ï¼‰æœ‰ä»¥ä¸‹7ç§</p>\n<ul>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Glossary/Boolean\" target=\"_blank\" rel=\"noopener\">Boolean</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Glossary/Null\" target=\"_blank\" rel=\"noopener\">Null</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Glossary/undefined\" target=\"_blank\" rel=\"noopener\">Undefined</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Glossary/Number\" target=\"_blank\" rel=\"noopener\">Number</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Glossary/BigInt\" target=\"_blank\" rel=\"noopener\">BigInt</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Glossary/å­—ç¬¦ä¸²\" target=\"_blank\" rel=\"noopener\">String</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Glossary/Symbol\" target=\"_blank\" rel=\"noopener\">Symbol</a> </li>\n</ul>\n<p>åŸºæœ¬ç±»å‹æ˜¯å­˜å‚¨åœ¨æ ˆå†…å­˜é‡Œé¢çš„ã€‚æ ˆå†…å­˜é‡Œé¢è¿˜å­˜ç€æŒ‡å‘å †å†…å­˜çš„å†…å­˜åœ°å€ã€‚</p>\n<blockquote>\n<p>PSï¼šé—­åŒ…ä¸­ï¼ŒåŸºæœ¬ç±»å‹ä¹Ÿæ˜¯å­˜æ”¾åœ¨å †å†…å­˜ä¸­çš„å“¦ï¼Œè¦æ³¨æ„ä¸€ä¸‹ã€‚</p>\n</blockquote>\n<h4 id=\"å¼•ç”¨ç±»å‹\"><a href=\"#å¼•ç”¨ç±»å‹\" class=\"headerlink\" title=\"å¼•ç”¨ç±»å‹\"></a>å¼•ç”¨ç±»å‹</h4><p>é™¤äº†åŸºæœ¬ç±»å‹çš„æ•°æ®ç»“æ„å°±æ˜¯å¼•ç”¨ç±»å‹ï¼ŒåŒ…æ‹¬ä»€ä¹ˆæ•°ç»„ï¼ˆArrayï¼‰ã€å‡½æ•°ï¼ˆFunctionï¼‰ã€å¯¹è±¡ï¼ˆObjectï¼‰ä¹‹ç±»çš„éƒ½æ˜¯å¼•ç”¨ç±»å‹ã€‚</p>\n<p>å¼•ç”¨ç±»å‹å’Œé—­åŒ…çš„å˜é‡éƒ½æ˜¯å­˜å‚¨åœ¨å †å†…å­˜ä¸­çš„ã€‚è€ŒæŒ‡é’ˆæˆ–è€…è¯´å†…å­˜åœ°å€æ˜¯å­˜åœ¨æ ˆå†…å­˜çš„ã€‚</p>\n<blockquote>\n<p>å½“æŸ¥è¯¢å¼•ç”¨ç±»å‹çš„å˜é‡æ—¶ï¼Œ å…ˆä»<strong>æ ˆä¸­è¯»å–å†…å­˜åœ°å€</strong>ï¼Œ ç„¶åå†é€šè¿‡åœ°å€<strong>æ‰¾åˆ°å †ä¸­çš„å€¼</strong>ã€‚å¯¹äºè¿™ç§ï¼Œæˆ‘ä»¬æŠŠå®ƒå«åšæŒ‰å¼•ç”¨è®¿é—®ã€‚</p>\n</blockquote>\n<p>å¹²è¯´æœ‰ç‚¹éš¾ç†è§£ã€‚èº«ä¸ºé©¬è‰¯çš„æˆ‘ç»™å¤§å®¶ç”»ä¸€å¹…ç”»ï¼Œå¸®åŠ©ç†è§£ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">123</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = <span class=\"literal\">true</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> c = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> d = <span class=\"string\">'123'</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> e = <span class=\"literal\">undefined</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> f = <span class=\"built_in\">Symbol</span>();</span><br><span class=\"line\"><span class=\"keyword\">var</span> g = <span class=\"number\">123n</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> h = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();</span><br><span class=\"line\"><span class=\"comment\">// å­—å¤ªä¸‘äº†ã€‚ã€‚ã€‚ä»£ç å¯ä»¥çœ‹è¿™é‡Œ</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/image/%E6%B7%B1%E5%85%A5%E5%86%85%E5%AD%98%E4%B8%96%E7%95%8C/1.jpeg\" alt=\"1\"></p>\n<h3 id=\"å †å†…å­˜å’Œæ ˆå†…å­˜çš„æ€»ç»“\"><a href=\"#å †å†…å­˜å’Œæ ˆå†…å­˜çš„æ€»ç»“\" class=\"headerlink\" title=\"å †å†…å­˜å’Œæ ˆå†…å­˜çš„æ€»ç»“\"></a>å †å†…å­˜å’Œæ ˆå†…å­˜çš„æ€»ç»“</h3><table>\n<thead>\n<tr>\n<th><strong>æ ˆå†…å­˜</strong></th>\n<th>å †å†…å­˜</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>å­˜å‚¨åŸºç¡€æ•°æ®ç±»å‹ä»¥åŠå†…å­˜åœ°å€</td>\n<td>å­˜å‚¨å¼•ç”¨æ•°æ®ç±»å‹ä»¥åŠé—­åŒ…å˜é‡</td>\n</tr>\n<tr>\n<td>æŒ‰å€¼è®¿é—®</td>\n<td>æŒ‰å¼•ç”¨ï¼ˆå†…å­˜åœ°å€ï¼‰è®¿é—®</td>\n</tr>\n<tr>\n<td>å­˜å‚¨çš„å€¼å¤§å°å›ºå®š</td>\n<td>å­˜å‚¨çš„å€¼å¤§å°ä¸å®šï¼Œå¯åŠ¨æ€è°ƒæ•´</td>\n</tr>\n<tr>\n<td>ç”±ç³»ç»Ÿè‡ªåŠ¨åˆ†é…å†…å­˜ç©ºé—´</td>\n<td>ç”±ä»£ç è¿›è¡ŒæŒ‡å®šåˆ†é…</td>\n</tr>\n<tr>\n<td>ç©ºé—´å°ï¼Œè¿è¡Œæ•ˆç‡é«˜</td>\n<td>ç©ºé—´å¤§ï¼Œè¿è¡Œæ•ˆç‡ç›¸å¯¹è¾ƒä½</td>\n</tr>\n</tbody></table>\n<h2 id=\"æ·±æ‹·è´ã€æµ…æ‹·è´ã€èµ‹å€¼é“äººä¸‰é¡¹çš„ä¸è§£æ¸Šæº\"><a href=\"#æ·±æ‹·è´ã€æµ…æ‹·è´ã€èµ‹å€¼é“äººä¸‰é¡¹çš„ä¸è§£æ¸Šæº\" class=\"headerlink\" title=\"æ·±æ‹·è´ã€æµ…æ‹·è´ã€èµ‹å€¼é“äººä¸‰é¡¹çš„ä¸è§£æ¸Šæº\"></a>æ·±æ‹·è´ã€æµ…æ‹·è´ã€èµ‹å€¼é“äººä¸‰é¡¹çš„ä¸è§£æ¸Šæº</h2><h3 id=\"èµ‹å€¼\"><a href=\"#èµ‹å€¼\" class=\"headerlink\" title=\"èµ‹å€¼\"></a>èµ‹å€¼</h3><p>èµ‹å€¼åˆ†ä¸¤ç§æƒ…å†µï¼š</p>\n<ol>\n<li><p>åˆ›å»ºæ–°å€¼</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">123</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br></pre></td></tr></table></figure>\n\n<p>è¿™ç§å°±æ˜¯èµ‹æ–°å€¼çš„æƒ…å†µã€‚</p>\n</li>\n<li><p>èµ‹å€¼å·²æœ‰çš„å˜é‡çš„å€¼</p>\n<p>åœ¨ä¸Šé¢çš„ä¾‹å­åŸºç¡€ä¸Šä¿®æ”¹ä¸€ä¸‹ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">123</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> A = a;</span><br><span class=\"line\"><span class=\"keyword\">var</span> B = b;</span><br></pre></td></tr></table></figure>\n\n<p>è¿™ç§æƒ…å†µå°±æ˜¯èµ‹å€¼å·²æœ‰å˜é‡ã€‚</p>\n</li>\n</ol>\n<p>ğŸ‘Œï¼Œæ¥ä¸‹æ¥æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œè¿˜æ˜¯æŠŠğŸ‘†çš„ğŸŒ°ä¿®æ”¹ä¸€ä¸‹</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = <span class=\"number\">123</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> b = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> A = a;</span><br><span class=\"line\"><span class=\"keyword\">var</span> B = b;</span><br><span class=\"line\"></span><br><span class=\"line\">A = <span class=\"number\">1234</span>;</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(a);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(A);</span><br><span class=\"line\">B.push(<span class=\"number\">4</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(b);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(B);</span><br></pre></td></tr></table></figure>\n\n\n\n<p>å¸¦ğŸ”¥è‡ªå·±æ‰“å¼€æ§åˆ¶å°ï¼Œå‚ä¸è¿›æ¥ï¼çœ‹å®Œä¹‹åç„¶åå†çœ‹çœ‹å’Œè‡ªå·±çš„ç†è§£æ˜¯ä¸æ˜¯ä¸€æ ·ï¼Œå¦‚æœæ˜¯ä¸€æ ·çš„è¯ï¼Œè¯´æ˜ä½ å¾ˆğŸ‘ï¼Œä¸æ˜¯çš„è¯å°±ä¸€èµ·æ¥çœ‹çœ‹ğŸ‘‡çš„è§£é‡Šå§ã€‚</p>\n<p>æˆ‘ä»¬è§‚å¯Ÿä¹‹åå‘ç°ï¼Œæˆ‘ä»¬åªä¿®æ”¹äº†<code>B</code>ä½†æ˜¯ï¼Œæˆ‘ä»¬è‹±ä¿Šçš„<code>b</code>ä¹Ÿè¢«ä¿®æ”¹äº†ã€‚</p>\n<p>ï¼Ÿï¼Ÿï¼Ÿï¼ˆè„‘è¡¥é»‘äººé—®å·è„¸ï¼‰</p>\n<p>å…¶å®æˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­è‚¯å®šæ˜¯ä¸å¸Œæœ›è¿™ç§æƒ…å†µçš„å‘ç”Ÿçš„ï¼Œæˆ‘ä»¬ä¿®æ”¹çš„åªæ˜¯<code>B</code>ï¼Œä¸å¸Œæœ›ä¿®æ”¹<code>b</code>çš„ï¼Œä¸ç„¶æˆ‘ä»¬è‚¯å®šä¼šå†™<code>b.push(4)</code>ã€‚</p>\n<p>è¿™æ—¶å°±éœ€è¦ç”¨åˆ°é“äººä¸‰é¡¹çš„å¦å¤–ä¸¤ä¸ªé¡¹ç›®ï¼šæµ…æ‹·è´å’Œæ·±æ‹·è´ã€‚</p>\n<h3 id=\"æµ…æ‹·è´å’Œæ·±æ‹·è´\"><a href=\"#æµ…æ‹·è´å’Œæ·±æ‹·è´\" class=\"headerlink\" title=\"æµ…æ‹·è´å’Œæ·±æ‹·è´\"></a>æµ…æ‹·è´å’Œæ·±æ‹·è´</h3><p>åˆšåˆšè¯´åˆ°å¼•ç”¨ç±»å‹å…¶å®æ˜¯æ”¾åœ¨å †å†…å­˜ä¸­çš„ï¼Œè€Œæ ˆå†…å­˜é‡Œé¢åªå­˜æŒ‡å‘å †å†…å­˜çš„åœ°å€ã€‚ï¼ˆæœ‰ç‚¹æ‹—å£â€¦.ğŸ§˜â€â™‚ï¸ï¼‰</p>\n<p>æµ…æ‹·è´æµ…æ‹·è´ï¼Œé¡¾åæ€ä¹‰ã€‚å°±æ˜¯æµ…ä¸€ç‚¹çš„æ‹·è´ï¼Œæœ‰å¤šæµ…å‘¢ï¼Ÿ</p>\n<p>ä¸€å±‚é‚£ä¹ˆæµ…ã€‚</p>\n<p>ä¹Ÿå°±æ˜¯è¯´é™¤äº†ç¬¬ä¸€å±‚çš„ä¸œè¥¿ï¼Œç¬¬ä¸€å±‚ä¹‹å¤–æ›´æ·±çš„å±‚çº§å°±ä¸æ˜¯æ‹·è´äº†ï¼Œå«æ‹¿åˆ«äººçš„åœ°å€ã€‚</p>\n<p>å£è¯´æ— å‡­ï¼Œæˆ‘å¼„ä¸ªdemoç»™å¤§å®¶ğŸ”¥see seeã€‚</p>\n<p><img src=\"/image/%E6%B7%B1%E5%85%A5%E5%86%85%E5%AD%98%E4%B8%96%E7%95%8C/2.png\" alt=\"2\"></p>\n<p>å¯ä»¥å¾ˆæ¸…æ™°ï¼Œæ¸…æ™°çš„ä¸èƒ½å†æ¸…æ™°çš„çœ‹åˆ°ï¼Œæµ…æ‹·è´å‡ºæ¥çš„å¯¹è±¡é‡Œé¢çš„å±æ€§<code>b</code>å…¶å®è¿˜æ˜¯æŒ‡å‘ä¹‹å‰çš„å¯¹è±¡ï¼Œä¹‹å‰è¯´è¿‡ï¼Œå†æ·±çš„ä»–å°±ä¸æ‹·è´äº†ï¼ŒéªŒè¯çš„è¯å°±äº¤ç»™å¤§å®¶äº†ï¼Œæ¯•ç«Ÿæˆ‘ä»¬æ˜¯ä¸€ä¸ªåŠ¨æ‰‹èŠ‚ç›®ç»„ï¼</p>\n<p>é‚£ä¹ˆæµ…æ‹·è´æœ‰å“ªäº›æ–¹æ³•å‘¢ï¼Ÿ</p>\n<ol>\n<li>Object.assign()</li>\n<li>es6çš„æ‰©å±•è¿ç®—ç¬¦<code>{...xxx}</code></li>\n<li>Array.prototype.slice()</li>\n</ol>\n<h3 id=\"æ·±æ‹·è´\"><a href=\"#æ·±æ‹·è´\" class=\"headerlink\" title=\"æ·±æ‹·è´\"></a>æ·±æ‹·è´</h3><p>çœ‹çœ‹æˆ‘é‚£ä¸ªå®Œç¾çš„å›¾å°±å·²ç»çŸ¥é“äº†ï¼Œæ·±æ‹·è´å°±æ˜¯å®Œç¾çš„å¼„ä¸€ä¸ªä¸€æ¨¡ä¸€æ ·çš„å‡ºæ¥ã€‚</p>\n<p>å¸…å“¥å¸…å“¥ï¼Œæ·±æ‹·è´æœ‰å•¥åŠæ³•æï¼Ÿ</p>\n<ol>\n<li>JSON.parse(JSON.stringify(object))<ol>\n<li>ä¼šå¿½ç•¥ <code>undefined</code></li>\n<li>ä¼šå¿½ç•¥ <code>symbol</code></li>\n<li>ä¸èƒ½åºåˆ—åŒ–å‡½æ•°</li>\n<li>ä¸èƒ½è§£å†³å¾ªç¯å¼•ç”¨çš„å¯¹è±¡</li>\n<li>ä¸èƒ½æ­£ç¡®å¤„ç†`new Date()</li>\n<li>ä¸èƒ½å¤„ç†æ­£åˆ™</li>\n</ol>\n</li>\n<li>è‡ªå·±å†™ä¸€ä¸ªé€’å½’ç„¶åç–¯ç‹‚æµ…æ‹·è´â€¦.</li>\n<li>ç»ˆææ–¹æ¡ˆï¼šlodashçš„<a href=\"https://www.lodashjs.com/docs/lodash.cloneDeep\" target=\"_blank\" rel=\"noopener\"><code>cloneDeep</code></a></li>\n</ol>\n<h3 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h3><table>\n<thead>\n<tr>\n<th></th>\n<th>å’ŒåŸæ•°æ®æ˜¯å¦æŒ‡å‘åŒä¸€å¯¹è±¡</th>\n<th>ç¬¬ä¸€å±‚æ•°æ®ä¸ºåŸºæœ¬æ•°æ®ç±»å‹</th>\n<th>åŸæ•°æ®ä¸­åŒ…å«å­å¯¹è±¡</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>èµ‹å€¼</td>\n<td>æ˜¯</td>\n<td>æ”¹å˜ä¼šä½¿åŸæ•°æ®ä¸€èµ·æ”¹å˜</td>\n<td>æ”¹å˜ä¼šä½¿åŸæ•°æ®ä¸€èµ·æ”¹å˜</td>\n</tr>\n<tr>\n<td>æµ…æ‹·è´</td>\n<td>å¦</td>\n<td>æ”¹å˜ä¸ä¼šä½¿åŸæ•°æ®ä¸€èµ·æ”¹å˜</td>\n<td>æ”¹å˜ä¼šä½¿åŸæ•°æ®ä¸€èµ·æ”¹å˜</td>\n</tr>\n<tr>\n<td>æ·±æ‹·è´</td>\n<td>å¦</td>\n<td>æ”¹å˜ä¸ä¼šä½¿åŸæ•°æ®ä¸€èµ·æ”¹å˜</td>\n<td>æ”¹å˜ä¸ä¼šä½¿åŸæ•°æ®ä¸€èµ·æ”¹å˜</td>\n</tr>\n</tbody></table>\n<h2 id=\"åƒåœ¾å›æ”¶æœºåˆ¶â™»ï¸\"><a href=\"#åƒåœ¾å›æ”¶æœºåˆ¶â™»ï¸\" class=\"headerlink\" title=\"åƒåœ¾å›æ”¶æœºåˆ¶â™»ï¸\"></a>åƒåœ¾å›æ”¶æœºåˆ¶â™»ï¸</h2><p>JavaScriptæœ‰è‡ªåŠ¨åƒåœ¾æ”¶é›†æœºåˆ¶ï¼Œåƒåœ¾æ”¶é›†å™¨ä¼šæ¯éš”ä¸€æ®µæ—¶é—´æˆ–è€…è¾¾åˆ°æŸä¸ªé˜ˆå€¼å°±æ‰§è¡Œä¸€æ¬¡é‡Šæ”¾æ“ä½œï¼Œæ‰¾å‡ºé‚£äº›ä¸å†ç»§ç»­ä½¿ç”¨çš„å€¼ï¼Œç„¶åé‡Šæ”¾å…¶å ç”¨çš„å†…å­˜ã€‚</p>\n<h3 id=\"åˆ¤æ–­æ–¹å¼\"><a href=\"#åˆ¤æ–­æ–¹å¼\" class=\"headerlink\" title=\"åˆ¤æ–­æ–¹å¼\"></a>åˆ¤æ–­æ–¹å¼</h3><p>JavaScriptæ˜¯æ€ä¹ˆåˆ¤æ–­æŸä¸ªå˜é‡æ˜¯å¦éœ€è¦è¢«å›æ”¶çš„ï¼Ÿ</p>\n<p>æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•</p>\n<h3 id=\"æ ‡è®°æ¸…é™¤\"><a href=\"#æ ‡è®°æ¸…é™¤\" class=\"headerlink\" title=\"æ ‡è®°æ¸…é™¤\"></a>æ ‡è®°æ¸…é™¤</h3><p>æ¯”å¦‚ä¸€ä¸ªå‡½æ•°å†…éƒ¨å£°æ˜çš„ä¸€ä¸ªå˜é‡ï¼Œä¸€æ—¦æˆ‘ä»¬çš„ä¸»çº¿ç¨‹ç¦»å¼€äº†è¿™ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å£°æ˜çš„ä¸€äº›å˜é‡å¤–éƒ¨å°±æ— æ³•ç”¨åˆ°ï¼Œé‚£ä¹ˆå°±ä¼šè¢«æ ‡è®°ä¸ºâ€ç¦»å¼€ç¯å¢ƒâ€ã€‚è¿™æ ·åœ¨ä¸‹ä¸€ä¸ªåƒåœ¾å›æ”¶å‘¨æœŸæ¥é¢†çš„æ—¶å€™ï¼Œå°±è‡ªåŠ¨é‡Šæ”¾äº†è¿™äº›å˜é‡å ç”¨çš„å†…å­˜ã€‚</p>\n<h3 id=\"å¼•ç”¨è®¡æ•°\"><a href=\"#å¼•ç”¨è®¡æ•°\" class=\"headerlink\" title=\"å¼•ç”¨è®¡æ•°\"></a>å¼•ç”¨è®¡æ•°</h3><p>å¦ä¸€ç§ä¸å¤ªå¸¸è§çš„åƒåœ¾æ”¶é›†ç­–ç•¥å«åšå¼•ç”¨è®¡æ•°(reference counting)ã€‚å¼•ç”¨è®¡æ•°çš„å«ä¹‰æ˜¯è·Ÿè¸ªè®°å½•æ¯ ä¸ªå€¼è¢«å¼•ç”¨çš„æ¬¡æ•°ã€‚å½“å£°æ˜äº†ä¸€ä¸ªå˜é‡å¹¶å°†ä¸€ä¸ªå¼•ç”¨ç±»å‹å€¼èµ‹ç»™è¯¥å˜é‡æ—¶ï¼Œåˆ™è¿™ä¸ªå€¼çš„å¼•ç”¨æ¬¡æ•°å°±æ˜¯ 1ã€‚ å¦‚æœåŒä¸€ä¸ªå€¼åˆè¢«èµ‹ç»™å¦ä¸€ä¸ªå˜é‡ï¼Œåˆ™è¯¥å€¼çš„å¼•ç”¨æ¬¡æ•°åŠ  1ã€‚ç›¸åï¼Œå¦‚æœåŒ…å«å¯¹è¿™ä¸ªå€¼å¼•ç”¨çš„å˜é‡åˆå– å¾—äº†å¦å¤–ä¸€ä¸ªå€¼ï¼Œåˆ™è¿™ä¸ªå€¼çš„å¼•ç”¨æ¬¡æ•°å‡ 1ã€‚å½“è¿™ä¸ªå€¼çš„å¼•ç”¨æ¬¡æ•°å˜æˆ 0 æ—¶ï¼Œåˆ™è¯´æ˜æ²¡æœ‰åŠæ³•å†è®¿é—®è¿™ ä¸ªå€¼äº†ï¼Œå› è€Œå°±å¯ä»¥å°†å…¶å ç”¨çš„å†…å­˜ç©ºé—´å›æ”¶å›æ¥ã€‚è¿™æ ·ï¼Œå½“åƒåœ¾æ”¶é›†å™¨ä¸‹æ¬¡å†è¿è¡Œæ—¶ï¼Œå®ƒå°±ä¼šé‡Šæ”¾é‚£ äº›å¼•ç”¨æ¬¡æ•°ä¸ºé›¶çš„å€¼æ‰€å ç”¨çš„å†…å­˜ã€‚</p>\n<p>å¼•ç”¨è®¡æ•°æœ‰ä¸€ä¸ªéå¸¸ä¸¥é‡çš„BUGå°±æ˜¯ï¼Œå¦‚æœå­˜åœ¨å¾ªç¯å¼•ç”¨çš„è¯ï¼Œç³»ç»Ÿå°±æ— æ³•åˆ¤æ–­ä½ è¿™ä¸ªå†…å­˜åˆ°åº•è¦ä¸è¦å›æ”¶äº†ã€‚è€Œä¸”å¼•ç”¨çš„æ•°å­—æ°¸è¿œéƒ½ä¸ä¼šæ˜¯0ã€‚ä¸¾ä¸ªä¾‹å­</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> element = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"some_element\"</span>); </span><br><span class=\"line\"><span class=\"keyword\">var</span> myObject = <span class=\"keyword\">new</span> <span class=\"built_in\">Object</span>();</span><br><span class=\"line\">myObject.element = element;</span><br><span class=\"line\">element.someObject = myObject;</span><br></pre></td></tr></table></figure>\n\n<p>è¿™æ ·çš„è¯<code>element</code>å’Œ<code>myObject</code>è¿™å¯¹æƒ…ä¾£å°±æ°¸è¿œå¦‚èƒ¶ä¼¼æ¼†ï¼Œç³»ç»Ÿæ— æ³•å°†ä»–ä»¬é€ä¸Šå¤©å ‚ã€‚</p>\n<p>é‚£å’‹åŠï¼Ÿè¦æ‹†æ•£ä»–ä»¬æœ‰ä¸€ä¸ªä¸»æ„ï¼Œå°±æ˜¯åœ¨ä¸ç”¨çš„æ—¶å€™ç»™ä»–ä»¬ç½®ä¸º<code>null</code></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">myObject.element = <span class=\"literal\">null</span>; </span><br><span class=\"line\">element.someObject = <span class=\"literal\">null</span>;</span><br></pre></td></tr></table></figure>\n\n<p>å°†å˜é‡è®¾ç½®ä¸º null æ„å‘³ç€åˆ‡æ–­å˜é‡ä¸å®ƒæ­¤å‰å¼•ç”¨çš„å€¼ä¹‹é—´çš„è¿æ¥ã€‚å½“åƒåœ¾æ”¶é›†å™¨ä¸‹æ¬¡è¿è¡Œæ—¶ï¼Œå°± ä¼šåˆ é™¤è¿™äº›å€¼å¹¶å›æ”¶å®ƒä»¬å ç”¨çš„å†…å­˜ã€‚</p>\n<p>æ’æ’­ä¸€ä¸ªå°æ•…äº‹</p>\n<blockquote>\n<p>IE çš„åƒåœ¾æ”¶é›†å™¨æ˜¯æ ¹æ®å†…å­˜åˆ†é…é‡è¿è¡Œçš„ï¼Œå…·ä½“ ä¸€ç‚¹è¯´å°±æ˜¯ 256 ä¸ªå˜é‡ã€4096 ä¸ªå¯¹è±¡(æˆ–æ•°ç»„)å­—é¢é‡å’Œæ•°ç»„å…ƒç´ (slot)æˆ–è€… 64KB çš„å­—ç¬¦ä¸²ã€‚è¾¾åˆ° ä¸Šè¿°ä»»ä½•ä¸€ä¸ªä¸´ç•Œå€¼ï¼Œåƒåœ¾æ”¶é›†å™¨å°±ä¼šè¿è¡Œã€‚è¿™ç§å®ç°æ–¹å¼çš„é—®é¢˜åœ¨äºï¼Œå¦‚æœä¸€ä¸ªè„šæœ¬ä¸­åŒ…å«é‚£ä¹ˆå¤šå˜ é‡ï¼Œé‚£ä¹ˆè¯¥è„šæœ¬å¾ˆå¯èƒ½ä¼šåœ¨å…¶ç”Ÿå‘½å‘¨æœŸä¸­ä¸€ç›´ä¿æœ‰é‚£ä¹ˆå¤šçš„å˜é‡ã€‚è€Œè¿™æ ·ä¸€æ¥ï¼Œåƒåœ¾æ”¶é›†å™¨å°±ä¸å¾—ä¸é¢‘ ç¹åœ°è¿è¡Œã€‚ç»“æœï¼Œç”±æ­¤å¼•å‘çš„ä¸¥é‡æ€§èƒ½é—®é¢˜ä¿ƒä½¿ IE7 é‡å†™äº†å…¶åƒåœ¾æ”¶é›†ä¾‹ç¨‹ã€‚</p>\n<p>éšç€ IE7 çš„å‘å¸ƒï¼Œå…¶ JavaScript å¼•æ“çš„åƒåœ¾æ”¶é›†ä¾‹ç¨‹æ”¹å˜äº†å·¥ä½œæ–¹å¼:è§¦å‘åƒåœ¾æ”¶é›†çš„å˜é‡åˆ†é…ã€ å­—é¢é‡å’Œ(æˆ–)æ•°ç»„å…ƒç´ çš„ä¸´ç•Œå€¼è¢«è°ƒæ•´ä¸ºåŠ¨æ€ä¿®æ­£ã€‚IE7 ä¸­çš„å„é¡¹ä¸´ç•Œå€¼åœ¨åˆå§‹æ—¶ä¸ IE6 ç›¸ç­‰ã€‚å¦‚æœ åƒåœ¾æ”¶é›†ä¾‹ç¨‹å›æ”¶çš„å†…å­˜åˆ†é…é‡ä½äº 15%ï¼Œåˆ™å˜é‡ã€å­—é¢é‡å’Œ(æˆ–)æ•°ç»„å…ƒç´ çš„ä¸´ç•Œå€¼å°±ä¼šåŠ å€ã€‚å¦‚æœ ä¾‹ç¨‹å›æ”¶äº† 85%çš„å†…å­˜åˆ†é…é‡ï¼Œåˆ™å°†å„ç§ä¸´ç•Œå€¼é‡ç½®å›é»˜è®¤å€¼ã€‚è¿™ä¸€çœ‹ä¼¼ç®€å•çš„è°ƒæ•´ï¼Œæå¤§åœ°æå‡äº† IE åœ¨è¿è¡ŒåŒ…å«å¤§é‡ JavaScript çš„é¡µé¢æ—¶çš„æ€§èƒ½ã€‚</p>\n<p>â€”-æ‘˜è‡ªJavaScripté«˜çº§ç¨‹åºè®¾è®¡</p>\n</blockquote>\n<h2 id=\"V8åƒåœ¾å›æ”¶ç­–ç•¥\"><a href=\"#V8åƒåœ¾å›æ”¶ç­–ç•¥\" class=\"headerlink\" title=\"V8åƒåœ¾å›æ”¶ç­–ç•¥\"></a>V8åƒåœ¾å›æ”¶ç­–ç•¥</h2><h3 id=\"ä»€ä¹ˆæ˜¯V8ï¼Ÿ\"><a href=\"#ä»€ä¹ˆæ˜¯V8ï¼Ÿ\" class=\"headerlink\" title=\"ä»€ä¹ˆæ˜¯V8ï¼Ÿ\"></a>ä»€ä¹ˆæ˜¯V8ï¼Ÿ</h3><p>ç®€å•ä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯V8ï¼Ÿ</p>\n<blockquote>\n<p><strong>V8</strong>æ˜¯ä¸€ä¸ªç”±<a href=\"https://zh.wikipedia.org/wiki/Google\" target=\"_blank\" rel=\"noopener\">Google</a>å¼€å‘çš„<a href=\"https://zh.wikipedia.org/wiki/å¼€æº\" target=\"_blank\" rel=\"noopener\">å¼€æº</a><a href=\"https://zh.wikipedia.org/wiki/JavaScriptå¼•æ“\" target=\"_blank\" rel=\"noopener\">JavaScriptå¼•æ“</a>ï¼Œç”¨äº<a href=\"https://zh.wikipedia.org/wiki/Google_Chrome\" target=\"_blank\" rel=\"noopener\">Google Chrome</a>åŠ<a href=\"https://zh.wikipedia.org/wiki/Chromium\" target=\"_blank\" rel=\"noopener\">Chromium</a>ä¸­<a href=\"https://zh.wikipedia.org/wiki/V8_(JavaScriptå¼•æ“)#cite_note-comic-2\" target=\"_blank\" rel=\"noopener\">[2]</a>ã€‚</p>\n<p>â€”æ‘˜è‡ªç»´åŸºç™¾ç§‘</p>\n</blockquote>\n<p>æ—¢ç„¶V8æ˜¯Chromeçš„å¼•æ“ï¼Œé‚£ä¹ˆåˆ«çš„æµè§ˆå™¨å‘¢ï¼Ÿ</p>\n<p>ä¸–ç•Œä¸Šä¸»è¦çš„æµè§ˆå™¨æœ‰ä»¥ä¸‹ä¸‰ç§ã€‚</p>\n<p><a href=\"https://en.wikipedia.org/wiki/V8_(JavaScript_engine)\" target=\"_blank\" rel=\"noopener\"><strong>V8</strong></a>â€”â€”å¼€æºï¼Œç”± Google å¼€å‘ï¼Œä½¿ç”¨ C++ ç¼–å†™</p>\n<p><strong><a href=\"https://en.wikipedia.org/wiki/SpiderMonkey_(JavaScript_engine)\" target=\"_blank\" rel=\"noopener\">SpiderMonkey</a></strong>â€”â€”ç¬¬ä¸€ä¸ª JavaScript å¼•æ“ï¼Œè¯¥å¼•æ“è¿‡å»é©±åŠ¨ Netscape Navigatorï¼Œå¦‚ä»Šé©±åŠ¨ Firefox æµè§ˆå™¨ã€‚</p>\n<p><strong><a href=\"https://en.wikipedia.org/wiki/JavaScriptCore\" target=\"_blank\" rel=\"noopener\">JavaScriptCore</a></strong>â€”â€”å¼€æºï¼Œè‹¹æœå…¬å¸ä¸º Safair æµè§ˆå™¨å¼€å‘çš„</p>\n<p>okokokï¼Œæ”¶ï¼å›å½’åˆå¿ƒã€‚</p>\n<h3 id=\"V8çš„åƒåœ¾å›æ”¶ç­–ç•¥\"><a href=\"#V8çš„åƒåœ¾å›æ”¶ç­–ç•¥\" class=\"headerlink\" title=\"V8çš„åƒåœ¾å›æ”¶ç­–ç•¥\"></a>V8çš„åƒåœ¾å›æ”¶ç­–ç•¥</h3><p>æˆ‘ä»¬çš„ä¼Ÿå¤§çš„Chromeï¼Œæ ¹æ®ä¸åŒçš„æƒ…å†µæœ‰ä¸åŒçš„å¯¹ç­–ã€‚ä»–æŠŠå†…å­˜åˆ†æˆä¸¤å—</p>\n<ul>\n<li>æ–°ç”Ÿä»£</li>\n<li>è€ç”Ÿä»£</li>\n</ul>\n<h4 id=\"åˆ†ä»£å†…å­˜\"><a href=\"#åˆ†ä»£å†…å­˜\" class=\"headerlink\" title=\"åˆ†ä»£å†…å­˜\"></a>åˆ†ä»£å†…å­˜</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ32ä½ç³»ç»Ÿæ–°ç”Ÿä»£å†…å­˜å¤§å°ä¸º16MBï¼Œè€ç”Ÿä»£å†…å­˜å¤§å°ä¸º700MBï¼Œ64ä½ç³»ç»Ÿä¸‹ï¼Œæ–°ç”Ÿä»£å†…å­˜å¤§å°ä¸º32MBï¼Œè€ç”Ÿä»£å†…å­˜å¤§å°ä¸º1.4GBã€‚</p>\n<p>æ–°ç”Ÿä»£å¹³å‡åˆ†æˆä¸¤å—ç›¸ç­‰çš„å†…å­˜ç©ºé—´ï¼Œå«åšsemispaceï¼Œæ¯å—å†…å­˜å¤§å°8MBï¼ˆ32ä½ï¼‰æˆ–16MBï¼ˆ64ä½ï¼‰ã€‚</p>\n<h4 id=\"æ–°ç”Ÿä»£ç®—æ³•\"><a href=\"#æ–°ç”Ÿä»£ç®—æ³•\" class=\"headerlink\" title=\"æ–°ç”Ÿä»£ç®—æ³•\"></a>æ–°ç”Ÿä»£ç®—æ³•</h4><p>é¦–å…ˆï¼Œæˆ‘ä»¬ç§‘æ™®ä¸€ä¸‹ä»€ä¹ˆæ˜¯æ–°ç”Ÿä»£ã€‚</p>\n<p>æ–°ç”Ÿä»£çš„å†…å­˜å‘¢ï¼Œå°±æ˜¯å­˜æ´»æ—¶é—´æ¯”è¾ƒçŸ­çš„å¯¹è±¡ã€‚å¦‚æœå­˜æ´»çš„æ—¶é—´æ¯”è¾ƒé•¿çš„è¯å°±ä¼šã€Šæ™‹å‡ã€‹ä¸ºè€ç”Ÿä»£ã€‚ç­‰ä¸€ä¸‹ä¼šç¨å¾®è¯¦ç»†çš„è¯´ä¸€ä¸‹ã€Šæ™‹å‡ã€‹è¿™ä¸ªæ¦‚å¿µã€‚</p>\n<p>æ–°ç”Ÿä»£é‡‡ç”¨<strong>Scavenge GC</strong>åƒåœ¾å›æ”¶ç®—æ³•ï¼Œåœ¨ç®—æ³•å®ç°æ—¶ä¸»è¦é‡‡ç”¨<strong>Cheney</strong>ç®—æ³•ã€‚</p>\n<p>Cheneyç®—æ³•å‘¢æ˜¯å°†å†…å­˜ä¸€åˆ†ä¸ºäºŒï¼Œä¸€å—æš‚æ—¶æŠŠä»–å«åšã€ŠFromã€‹ï¼Œå¦ä¸€å—æš‚æ—¶å«åšã€ŠToã€‹ã€‚çœ‹ä¸€ä¸‹ä¸‹å›¾ï¼Œå°±å¯ä»¥å¾ˆæ¸…æ™°çš„çŸ¥é“V8æ˜¯æ€ä¹ˆåˆ†å‰²å†…å­˜çš„ã€‚</p>\n<p><img src=\"/image/%E6%B7%B1%E5%85%A5%E5%86%85%E5%AD%98%E4%B8%96%E7%95%8C/3.png\" alt=\"3\"></p>\n<p>å†…å­˜çš„åˆ°æ¥å…ˆè¿›å…¥Fromï¼Œç„¶åç­‰åˆ°Fromæ»¡äº†ä¹‹åï¼Œæ–°ç”Ÿä»£çš„GCå°±ä¼šå¯åŠ¨ã€‚</p>\n<p>é¦–å…ˆé‡Šæ”¾æ‰ä¸€äº›ä¸å†ä½¿ç”¨çš„å†…å­˜ï¼Œç„¶åå°†Fromå’ŒToä¸¤ä¸ªåŠŸèƒ½è¿›è¡Œæ›´æ¢ï¼Œä¹Ÿå°±æ˜¯è¯´ä¹‹å‰çš„From -&gt; To  ä¹‹å‰çš„  To -&gt; Fromã€‚è¿™æ ·çš„è¯æ–°ç”Ÿä»£çš„ä¸€è½®GCå°±æ­¤ç»“æŸäº†ã€‚</p>\n<p>è¿™ç§ç®—æ³•æœ‰ç‚¹ç±»ä¼¼ç©ºé—´æ¢æ—¶é—´ï¼Œè€Œæ–°ç”Ÿä»£çš„å¯¹è±¡ç”Ÿå‘½ä¸€èˆ¬éƒ½æ˜¯æ¯”è¾ƒçŸ­çš„ï¼Œæ‰€ä»¥æ‰€ä»¥éå¸¸é€‚åˆæ–°ç”Ÿä»£ã€‚</p>\n<h4 id=\"æ™‹å‡\"><a href=\"#æ™‹å‡\" class=\"headerlink\" title=\"æ™‹å‡\"></a>æ™‹å‡</h4><p>å¯¹è±¡çš„æ™‹å‡å…¶å®ä¸»è¦æœ‰ä¸¤ä¸ªè¦æ±‚ï¼Œå°±å¥½åƒåœ¨æ¥P6å‡P7æœ‰ä¸€å †çš„è¦æ±‚ä¸€æ ·ã€‚</p>\n<ol>\n<li>æ–°ç”Ÿä»£ç®—æ³•åˆšåˆšæˆ‘ä»¬å·²ç»å­¦ä¹ è¿‡äº†ï¼Œå°±æ˜¯Fromå’ŒToçš„äº’æ¢åŠŸèƒ½ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ä»–ç»å†äº†ä¸¤æ¬¡çš„æ–°ç”Ÿä»£çš„æ›´æ›¿ï¼Œè¿˜æ²¡æœ‰è¢«å›æ”¶å†…å­˜ï¼Œè¯´æ˜ä»–å¾ˆå¼ºã€‚å°±éœ€è¦æ™‹å‡ä¸ºè€ç”Ÿä»£ï¼Œè®©è€ç”Ÿä»£çš„ç®—æ³•æ¥å¯¹ä»˜ä»–ã€‚å°±å¥½åƒåœ¨é˜¿é‡Œçš„ä¸€ä¸ªP6ä¸¤è½®361éƒ½æ²¡æœ‰è¢«æ·˜æ±°è¯´æ˜ä»–å¾ˆæœ‰å®åŠ›ï¼Œæ‰€ä»¥ç›´æ¥å‡çº§ä»–ä¸ºP7ã€‚</li>\n<li>å¦‚æœä¸€ä¸ªå¯¹è±¡åœ¨Toçš„å†…å­˜å æ¯”è¶…è¿‡äº†25%ï¼Œåœ¨ç¬¬ä¸€æ¬¡æ›´æ›¿çš„æ—¶å€™å°±ç›´æ¥å°†ä»–æ™‹å‡ä¸ºè€ç”Ÿä»£äº†ã€‚å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæŠ€æœ¯å¤§ç‰›ï¼Œåƒé©¬äº‘ï¼Œä¸€å»é˜¿é‡Œå°±è¢«æ˜Ÿæ¢å‘ç°ï¼Œç›´æ¥å°±æ˜¯P7è¯„çº§ï¼Œä¸éœ€è¦ç»è¿‡ä»€ä¹ˆå¤æ‚çš„é¢è¯•æˆ–è€…ä»€ä¹ˆã€‚</li>\n</ol>\n<h4 id=\"è€ç”Ÿä»£ç®—æ³•\"><a href=\"#è€ç”Ÿä»£ç®—æ³•\" class=\"headerlink\" title=\"è€ç”Ÿä»£ç®—æ³•\"></a>è€ç”Ÿä»£ç®—æ³•</h4><p>æ ¹æ®åˆšåˆšå¯¹ã€Šæ™‹å‡ã€‹çš„äº†è§£ï¼Œæˆ‘ä»¬çŸ¥é“äº†åœ¨è€ç”Ÿä»£é‡Œé¢çš„å¯¹è±¡éƒ½æ˜¯ä¸€äº›éš¾ç¼ çš„é€‰æ‰‹ï¼Œæ¯”å¦‚æœ¬æ¥å°±å å†…å­˜æ¯”ä¾‹å¾ˆå¤§ï¼Œæˆ–è€…ç»å†è¿‡2æ¬¡çš„æ–°ç”Ÿä»£GCï¼Œä¾æ—§åšæŒºçš„é€‰æ‰‹ã€‚</p>\n<p>æ‰€ä»¥ï¼ŒV8åœ¨è€ç”Ÿä»£ä¸­ä¸»è¦é‡‡ç”¨äº†<strong>Mark-Sweep</strong>å’Œ<strong>Mark-Compact</strong>ç›¸ç»“åˆçš„æ–¹å¼è¿›è¡Œåƒåœ¾å›æ”¶ã€‚</p>\n<p>åœ¨ä»‹ç»è€ç”Ÿä»£ç®—æ³•ä¹‹å‰ï¼Œå…ˆç§‘æ™®ä¸€ä¸‹<strong>Mark-Sweep</strong>å’Œ<strong>Mark-Compact</strong>ã€‚</p>\n<h5 id=\"Mark-Sweep\"><a href=\"#Mark-Sweep\" class=\"headerlink\" title=\"Mark-Sweep\"></a><strong>Mark-Sweep</strong></h5><p>Mark-Sweepæ˜¯æ ‡è®°æ¸…é™¤çš„æ„æ€ï¼Œå®ƒåˆ†ä¸ºæ ‡è®°å’Œæ¸…é™¤ä¸¤ä¸ªé˜¶æ®µã€‚</p>\n<p>ä¸Scavengeä¸åŒï¼ŒMark-Sweepå¹¶ä¸ä¼šå°†å†…å­˜åˆ†ä¸ºä¸¤ä»½ï¼Œæ‰€ä»¥ä¸å­˜åœ¨æµªè´¹ä¸€åŠç©ºé—´çš„è¡Œä¸ºã€‚Mark-Sweepåœ¨æ ‡è®°é˜¶æ®µéå†å †å†…å­˜ä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼Œå¹¶æ ‡è®°æ´»ç€çš„å¯¹è±¡ï¼Œåœ¨éšåçš„æ¸…é™¤é˜¶æ®µï¼Œåªæ¸…é™¤æ²¡æœ‰è¢«æ ‡è®°çš„å¯¹è±¡ã€‚</p>\n<p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒScavengeåªå¤åˆ¶æ´»ç€çš„å¯¹è±¡ï¼Œè€ŒMark-Sweepåªæ¸…é™¤æ­»äº†çš„å¯¹è±¡ã€‚æ´»å¯¹è±¡åœ¨æ–°ç”Ÿä»£ä¸­åªå è¾ƒå°‘éƒ¨åˆ†ï¼Œæ­»å¯¹è±¡åœ¨è€ç”Ÿä»£ä¸­åªå è¾ƒå°‘éƒ¨åˆ†ï¼Œè¿™å°±æ˜¯ä¸¤ç§å›æ”¶æ–¹å¼éƒ½èƒ½é«˜æ•ˆå¤„ç†çš„åŸå› ã€‚</p>\n<blockquote>\n<p>åœ¨æ ‡è®°å¤§å‹å¯¹å†…å­˜æ—¶ï¼Œå¯èƒ½éœ€è¦å‡ ç™¾æ¯«ç§’æ‰èƒ½å®Œæˆä¸€æ¬¡æ ‡è®°ã€‚è¿™å°±ä¼šå¯¼è‡´ä¸€äº›æ€§èƒ½ä¸Šçš„é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ2011 å¹´ï¼ŒV8 ä» stop-the-world æ ‡è®°åˆ‡æ¢åˆ°å¢é‡æ ‡å¿—ã€‚åœ¨å¢é‡æ ‡è®°æœŸé—´ï¼ŒGC å°†æ ‡è®°å·¥ä½œåˆ†è§£ä¸ºæ›´å°çš„æ¨¡å—ï¼Œå¯ä»¥è®© JS åº”ç”¨é€»è¾‘åœ¨æ¨¡å—é—´éš™æ‰§è¡Œä¸€ä¼šï¼Œä»è€Œä¸è‡³äºè®©åº”ç”¨å‡ºç°åœé¡¿æƒ…å†µã€‚ä½†åœ¨ 2018 å¹´ï¼ŒGC æŠ€æœ¯åˆæœ‰äº†ä¸€ä¸ªé‡å¤§çªç ´ï¼Œè¿™é¡¹æŠ€æœ¯åä¸ºå¹¶å‘æ ‡è®°ã€‚è¯¥æŠ€æœ¯å¯ä»¥è®© GC æ‰«æå’Œæ ‡è®°å¯¹è±¡æ—¶ï¼ŒåŒæ—¶å…è®¸ JS è¿è¡Œï¼Œä½ å¯ä»¥ç‚¹å‡» <a href=\"https://v8project.blogspot.com/2018/06/concurrent-marking.html\" target=\"_blank\" rel=\"noopener\">è¯¥åšå®¢</a> è¯¦ç»†é˜…è¯»ã€‚</p>\n</blockquote>\n<h5 id=\"Mark-Compact\"><a href=\"#Mark-Compact\" class=\"headerlink\" title=\"Mark-Compact\"></a><strong>Mark-Compact</strong></h5><p>åœ¨æ¸…é™¤å®Œå¯¹è±¡åï¼Œè¿™äº›å¯¹è±¡åœ¨å†…å­˜å†…éƒ¨å°±ä¸æ˜¯è¿ç»­çš„ã€‚è¿™æ ·å†…å­˜åœ°å€å°±æ— æ³•å¾ˆå¥½åœ°åˆ©ç”¨èµ·æ¥ï¼Œå› ä¸ºä»–ä»¬éœ€è¦è¿ç»­çš„å†…å­˜ï¼Œæœ‰çš„å¤§çš„å¯¹è±¡å°±æ— æ³•å¡å…¥åˆšåˆšé‡Šæ”¾çš„å°å†…å­˜å½“ä¸­ã€‚</p>\n<p>è€ŒMark-Compactå°±æ˜¯ç”¨äºè§£å†³å†…å­˜ç¢ç‰‡çš„é—®é¢˜ï¼Œä»–ä¸»è¦å¹²çš„æ´»å°±æ˜¯ç§»åŠ¨è¿™äº›å¯¹è±¡ï¼Œè®©ä»–ä»¬å˜æˆç´§å‡‘èµ·æ¥ã€‚</p>\n<p>æ¸…é™¤å¯¹è±¡åä¼šé€ æˆå †å†…å­˜å‡ºç°ç¢ç‰‡çš„æƒ…å†µï¼Œå½“ç¢ç‰‡è¶…è¿‡ä¸€å®šé™åˆ¶åä¼šå¯åŠ¨å‹ç¼©ç®—æ³•ã€‚åœ¨å‹ç¼©è¿‡ç¨‹ä¸­ï¼Œå°†æ´»çš„å¯¹è±¡åƒä¸€ç«¯ç§»åŠ¨ï¼Œç›´åˆ°æ‰€æœ‰å¯¹è±¡éƒ½ç§»åŠ¨å®Œæˆç„¶åæ¸…ç†æ‰ä¸éœ€è¦çš„å†…å­˜ã€‚</p>\n<h5 id=\"æ€»ç»“-1\"><a href=\"#æ€»ç»“-1\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h5><p>åœ¨V8çš„å›æ”¶ç­–ç•¥ä¸­ï¼ŒMark-Sweepå’ŒMark-Conpactä¸¤è€…æ˜¯ç»“åˆä½¿ç”¨çš„ã€‚</p>\n<p>ç”±äºMark-Conpactéœ€è¦ç§»åŠ¨å¯¹è±¡ï¼Œæ‰€ä»¥å®ƒçš„æ‰§è¡Œé€Ÿåº¦ä¸å¯èƒ½å¾ˆå¿«ï¼Œåœ¨å–èˆä¸Šï¼ŒV8ä¸»è¦ä½¿ç”¨Mark-Sweepï¼Œåœ¨ç©ºé—´ä¸è¶³ä»¥å¯¹ä»æ–°ç”Ÿä»£ä¸­æ™‹å‡è¿‡æ¥çš„å¯¹è±¡è¿›è¡Œåˆ†é…æ—¶ï¼Œæ‰ä½¿ç”¨Mark-Compactã€‚</p>\n<h2 id=\"JavaScriptå†…å­˜æ³„æ¼\"><a href=\"#JavaScriptå†…å­˜æ³„æ¼\" class=\"headerlink\" title=\"JavaScriptå†…å­˜æ³„æ¼\"></a>JavaScriptå†…å­˜æ³„æ¼</h2><h3 id=\"ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼\"><a href=\"#ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼\" class=\"headerlink\" title=\"ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼\"></a>ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼</h3><p>ç¨‹åºçš„è¿è¡Œéœ€è¦å†…å­˜ã€‚åªè¦ç¨‹åºæå‡ºè¦æ±‚ï¼Œæ“ä½œç³»ç»Ÿæˆ–è€…è¿è¡Œæ—¶ï¼ˆruntimeï¼‰å°±å¿…é¡»ä¾›ç»™å†…å­˜ã€‚</p>\n<p>å¯¹äºæŒç»­è¿è¡Œçš„æœåŠ¡è¿›ç¨‹ï¼ˆdaemonï¼‰ï¼Œå¿…é¡»åŠæ—¶é‡Šæ”¾ä¸å†ç”¨åˆ°çš„å†…å­˜ã€‚å¦åˆ™ï¼Œå†…å­˜å ç”¨è¶Šæ¥è¶Šé«˜ï¼Œè½»åˆ™å½±å“ç³»ç»Ÿæ€§èƒ½ï¼Œé‡åˆ™å¯¼è‡´è¿›ç¨‹å´©æºƒã€‚</p>\n<p><strong>ä¸å†ç”¨åˆ°çš„å†…å­˜ï¼Œæ²¡æœ‰åŠæ—¶é‡Šæ”¾ï¼Œå°±å«åšå†…å­˜æ³„æ¼</strong>ï¼ˆmemory leakï¼‰ã€‚</p>\n<h3 id=\"å¸¸è§çš„å†…å­˜æ³„æ¼\"><a href=\"#å¸¸è§çš„å†…å­˜æ³„æ¼\" class=\"headerlink\" title=\"å¸¸è§çš„å†…å­˜æ³„æ¼\"></a>å¸¸è§çš„å†…å­˜æ³„æ¼</h3><ol>\n<li><p>å®šæ—¶å™¨æœªåŠæ—¶æ¸…é™¤</p>\n</li>\n<li><p>æ„å¤–çš„å…¨å±€å˜é‡</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">foo</span>(<span class=\"params\">arg</span>) </span>&#123;</span><br><span class=\"line\">    bar = <span class=\"string\">\"this is a hidden global variable\"</span>;  <span class=\"comment\">// æ„å¤–æŒ‚åœ¨åœ¨ window å…¨å±€å˜é‡ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>è¿™é‡Œæ˜¯æƒ³è¯´ä¸€ä¸‹é«˜ç¨‹ï¼ˆJavaScripté«˜çº§ç¨‹åºè®¾è®¡ç¬¬ä¸‰ç‰ˆï¼‰é‡Œé¢çš„ä¸€ä¸ªéå¸¸ç»å…¸çš„demoã€‚</p>\n</li>\n<li><p>é—­åŒ…çš„æ»¥ç”¨</p>\n</li>\n</ol>\n<h3 id=\"WeakMapä¸WeakSet\"><a href=\"#WeakMapä¸WeakSet\" class=\"headerlink\" title=\"WeakMapä¸WeakSet\"></a>WeakMapä¸WeakSet</h3><p>å…¶å®è¿™ä¸¤ä¸ªåœ¨è¿™ç¯‡æ–‡ç« é‡Œé¢çš„æ„ä¹‰ç›¸åŒï¼Œåªéœ€è¦ä»‹ç»ä¸€ä¸ªå°±è¡Œã€‚</p>\n<p>æˆ‘ä»¬çŸ¥é“Mapæ˜¯ç®€å•çš„key-valueã€‚è€Œä¸”keyå¯ä»¥ä¸ºä»»æ„ç±»å‹ï¼Œæ¯”å¦‚å¼•ç”¨ç±»å‹ï¼Œå¦‚æœæˆ‘ä»¬çš„keyæ˜¯å¼•ç”¨ç±»å‹é‚£ä¹ˆä»–æ‰€å æ®çš„å†…å­˜å°±æ— æ³•è¢«é‡Šæ”¾äº†ã€‚</p>\n<p>åˆæœ‰åŒå­¦é—®é¢˜äº†ï¼Œæˆ‘æœ‰æ¯›ç—…å•Šï¼Œæˆ‘éè¦å¼•ç”¨ç±»å‹å—ï¼Ÿæˆ‘stringå’Œnumberä»–ä¸é¦™å—ï¼Ÿ</p>\n<p>åŸºæœ¬ä¸Šï¼Œå¦‚æœä½ è¦å¾€å¯¹è±¡ä¸Šæ·»åŠ æ•°æ®ï¼Œåˆä¸æƒ³å¹²æ‰°åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå°±å¯ä»¥ä½¿ç”¨ WeakMapã€‚ä¸€ä¸ªå…¸å‹åº”ç”¨åœºæ™¯æ˜¯ï¼Œåœ¨ç½‘é¡µçš„ DOM å…ƒç´ ä¸Šæ·»åŠ æ•°æ®ï¼Œå°±å¯ä»¥ä½¿ç”¨<code>WeakMap</code>ç»“æ„ã€‚å½“è¯¥ DOM å…ƒç´ è¢«æ¸…é™¤ï¼Œå…¶æ‰€å¯¹åº”çš„<code>WeakMap</code>è®°å½•å°±ä¼šè‡ªåŠ¨è¢«ç§»é™¤ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> wm = <span class=\"keyword\">new</span> <span class=\"built_in\">WeakMap</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> element = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'example'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">wm.set(element, <span class=\"string\">'some information'</span>);</span><br><span class=\"line\">wm.get(element) <span class=\"comment\">// \"some information\"</span></span><br></pre></td></tr></table></figure>\n\n<p>ä¸Šé¢ä»£ç ä¸­ï¼Œå…ˆæ–°å»ºä¸€ä¸ª Weakmap å®ä¾‹ã€‚ç„¶åï¼Œå°†ä¸€ä¸ª DOM èŠ‚ç‚¹ä½œä¸ºé”®åå­˜å…¥è¯¥å®ä¾‹ï¼Œå¹¶å°†ä¸€äº›é™„åŠ ä¿¡æ¯ä½œä¸ºé”®å€¼ï¼Œä¸€èµ·å­˜æ”¾åœ¨ WeakMap é‡Œé¢ã€‚è¿™æ—¶ï¼ŒWeakMap é‡Œé¢å¯¹<code>element</code>çš„å¼•ç”¨å°±æ˜¯å¼±å¼•ç”¨ï¼Œä¸ä¼šè¢«è®¡å…¥åƒåœ¾å›æ”¶æœºåˆ¶ã€‚</p>\n<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸Šé¢çš„ DOM èŠ‚ç‚¹å¯¹è±¡çš„å¼•ç”¨è®¡æ•°æ˜¯<code>1</code>ï¼Œè€Œä¸æ˜¯<code>2</code>ã€‚è¿™æ—¶ï¼Œä¸€æ—¦æ¶ˆé™¤å¯¹è¯¥èŠ‚ç‚¹çš„å¼•ç”¨ï¼Œå®ƒå ç”¨çš„å†…å­˜å°±ä¼šè¢«åƒåœ¾å›æ”¶æœºåˆ¶é‡Šæ”¾ã€‚Weakmap ä¿å­˜çš„è¿™ä¸ªé”®å€¼å¯¹ï¼Œä¹Ÿä¼šè‡ªåŠ¨æ¶ˆå¤±ã€‚</p>\n<p>æ€»ä¹‹ï¼Œ<code>WeakMap</code>çš„ä¸“ç”¨åœºåˆå°±æ˜¯ï¼Œå®ƒçš„é”®æ‰€å¯¹åº”çš„å¯¹è±¡ï¼Œå¯èƒ½ä¼šåœ¨å°†æ¥æ¶ˆå¤±ã€‚<code>WeakMap</code>ç»“æ„æœ‰åŠ©äºé˜²æ­¢å†…å­˜æ³„æ¼ã€‚</p>\n<p>æ›´å¤šçš„çŸ¥è¯†å°±ä¸è®¨è®ºäº†ï¼Œè¿™é‡Œæ˜¯å†…å­˜ä¸–ç•Œï¼ä¸æ˜¯ä»€ä¹ˆWeakMapä¸“åœºå“¦ã€‚</p>\n<p>æ€ä¹ˆéªŒè¯ï¼Ÿemmmmmâ€¦.è¿™é‡Œæˆ‘copyä¸€ä¸‹é˜®ä¸€å³°è€å¸ˆçš„å†…å®¹ã€‚</p>\n<h3 id=\"é˜®è€å¸ˆçš„demo\"><a href=\"#é˜®è€å¸ˆçš„demo\" class=\"headerlink\" title=\"é˜®è€å¸ˆçš„demo\"></a>é˜®è€å¸ˆçš„demo</h3><p>é¦–å…ˆï¼Œæ‰“å¼€ Node å‘½ä»¤è¡Œã€‚</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ node --expose-gc</span><br></pre></td></tr></table></figure>\n\n<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>--expose-gc</code>å‚æ•°è¡¨ç¤ºå…è®¸æ‰‹åŠ¨æ‰§è¡Œåƒåœ¾å›æ”¶æœºåˆ¶ã€‚</p>\n<p>ç„¶åï¼Œæ‰§è¡Œä¸‹é¢çš„ä»£ç ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// æ‰‹åŠ¨æ‰§è¡Œä¸€æ¬¡åƒåœ¾å›æ”¶ï¼Œä¿è¯è·å–çš„å†…å­˜ä½¿ç”¨çŠ¶æ€å‡†ç¡®</span></span><br><span class=\"line\">&gt; global.gc();</span><br><span class=\"line\"><span class=\"literal\">undefined</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æŸ¥çœ‹å†…å­˜å ç”¨çš„åˆå§‹çŠ¶æ€ï¼ŒheapUsed ä¸º 4M å·¦å³</span></span><br><span class=\"line\">&gt; process.memoryUsage();</span><br><span class=\"line\">&#123; <span class=\"attr\">rss</span>: <span class=\"number\">21106688</span>,</span><br><span class=\"line\">  heapTotal: <span class=\"number\">7376896</span>,</span><br><span class=\"line\">  heapUsed: <span class=\"number\">4153936</span>,</span><br><span class=\"line\">  external: <span class=\"number\">9059</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; <span class=\"keyword\">let</span> wm = <span class=\"keyword\">new</span> <span class=\"built_in\">WeakMap</span>();</span><br><span class=\"line\"><span class=\"literal\">undefined</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æ–°å»ºä¸€ä¸ªå˜é‡ keyï¼ŒæŒ‡å‘ä¸€ä¸ª 5*1024*1024 çš„æ•°ç»„</span></span><br><span class=\"line\">&gt; <span class=\"keyword\">let</span> key = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>(<span class=\"number\">5</span> * <span class=\"number\">1024</span> * <span class=\"number\">1024</span>);</span><br><span class=\"line\"><span class=\"literal\">undefined</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è®¾ç½® WeakMap å®ä¾‹çš„é”®åï¼Œä¹ŸæŒ‡å‘ key æ•°ç»„</span></span><br><span class=\"line\"><span class=\"comment\">// è¿™æ—¶ï¼Œkey æ•°ç»„å®é™…è¢«å¼•ç”¨äº†ä¸¤æ¬¡ï¼Œ</span></span><br><span class=\"line\"><span class=\"comment\">// å˜é‡ key å¼•ç”¨ä¸€æ¬¡ï¼ŒWeakMap çš„é”®åå¼•ç”¨äº†ç¬¬äºŒæ¬¡</span></span><br><span class=\"line\"><span class=\"comment\">// ä½†æ˜¯ï¼ŒWeakMap æ˜¯å¼±å¼•ç”¨ï¼Œå¯¹äºå¼•æ“æ¥è¯´ï¼Œå¼•ç”¨è®¡æ•°è¿˜æ˜¯1</span></span><br><span class=\"line\">&gt; wm.set(key, <span class=\"number\">1</span>);</span><br><span class=\"line\"><span class=\"built_in\">WeakMap</span> &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; global.gc();</span><br><span class=\"line\"><span class=\"literal\">undefined</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è¿™æ—¶å†…å­˜å ç”¨ heapUsed å¢åŠ åˆ° 45M äº†</span></span><br><span class=\"line\">&gt; process.memoryUsage();</span><br><span class=\"line\">&#123; <span class=\"attr\">rss</span>: <span class=\"number\">67538944</span>,</span><br><span class=\"line\">  heapTotal: <span class=\"number\">7376896</span>,</span><br><span class=\"line\">  heapUsed: <span class=\"number\">45782816</span>,</span><br><span class=\"line\">  external: <span class=\"number\">8945</span> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// æ¸…é™¤å˜é‡ key å¯¹æ•°ç»„çš„å¼•ç”¨ï¼Œ</span></span><br><span class=\"line\"><span class=\"comment\">// ä½†æ²¡æœ‰æ‰‹åŠ¨æ¸…é™¤ WeakMap å®ä¾‹çš„é”®åå¯¹æ•°ç»„çš„å¼•ç”¨</span></span><br><span class=\"line\">&gt; key = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"literal\">null</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// å†æ¬¡æ‰§è¡Œåƒåœ¾å›æ”¶</span></span><br><span class=\"line\">&gt; global.gc();</span><br><span class=\"line\"><span class=\"literal\">undefined</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// å†…å­˜å ç”¨ heapUsed å˜å› 4M å·¦å³ï¼Œ</span></span><br><span class=\"line\"><span class=\"comment\">// å¯ä»¥çœ‹åˆ° WeakMap çš„é”®åå¼•ç”¨æ²¡æœ‰é˜»æ­¢ gc å¯¹å†…å­˜çš„å›æ”¶</span></span><br><span class=\"line\">&gt; process.memoryUsage();</span><br><span class=\"line\">&#123; <span class=\"attr\">rss</span>: <span class=\"number\">20639744</span>,</span><br><span class=\"line\">  heapTotal: <span class=\"number\">8425472</span>,</span><br><span class=\"line\">  heapUsed: <span class=\"number\">3979792</span>,</span><br><span class=\"line\">  external: <span class=\"number\">8956</span> &#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä¸Šé¢ä»£ç ä¸­ï¼Œåªè¦å¤–éƒ¨çš„å¼•ç”¨æ¶ˆå¤±ï¼ŒWeakMap å†…éƒ¨çš„å¼•ç”¨ï¼Œå°±ä¼šè‡ªåŠ¨è¢«åƒåœ¾å›æ”¶æ¸…é™¤ã€‚ç”±æ­¤å¯è§ï¼Œæœ‰äº† WeakMap çš„å¸®åŠ©ï¼Œè§£å†³å†…å­˜æ³„æ¼å°±ä¼šç®€å•å¾ˆå¤šã€‚</p>\n<h2 id=\"çœ‹å®Œå‡ ä»¶äº‹\"><a href=\"#çœ‹å®Œå‡ ä»¶äº‹\" class=\"headerlink\" title=\"çœ‹å®Œå‡ ä»¶äº‹\"></a>çœ‹å®Œå‡ ä»¶äº‹</h2><p>å¦‚æœä½ è§‰å¾—å¯¹ä½ æœ‰å¸®åŠ©ï¼Œå°±å¸®æˆ‘ç‚¹ä¸ªèµå§ï¼Œä¹Ÿç®—æ˜¯å¯¹æˆ‘çš„è‚¯å®šã€‚è°¢è°¢ï¼Œå¦‚æœæœ‰é”™è¯¯çš„åœ°æ–¹æ¬¢è¿å¤§å®¶æŒ‡å‡ºæ¥ã€‚ä¸€èµ·è®¨è®ºå­¦ä¹ ã€‚æˆ‘æ˜¯Derrickï¼Œä¸€åæ­£åœ¨å»é˜¿é‡Œè·¯ä¸Šçš„å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆã€‚</p>\n<h2 id=\"reference\"><a href=\"#reference\" class=\"headerlink\" title=\"reference\"></a>reference</h2><blockquote>\n<p><a href=\"https://muyiy.cn/blog/1/1.3.html#æ ˆæ•°æ®ç»“æ„\" target=\"_blank\" rel=\"noopener\">https://muyiy.cn/blog/1/1.3.html#%E6%A0%88%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84</a></p>\n<p><a href=\"http://www.ruanyifeng.com/blog/2017/04/memory-leak.html\" target=\"_blank\" rel=\"noopener\">http://www.ruanyifeng.com/blog/2017/04/memory-leak.html</a></p>\n<p><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Map\" target=\"_blank\" rel=\"noopener\">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Map</a></p>\n<p><a href=\"https://juejin.im/post/6844903615300108302\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/6844903615300108302</a></p>\n<p><a href=\"https://juejin.im/post/6844903591510016007\" target=\"_blank\" rel=\"noopener\">https://juejin.im/post/6844903591510016007</a></p>\n<p>JavaScripté«˜çº§ç¨‹åºè®¾è®¡ï¼ˆç¬¬ä¸‰ç‰ˆï¼‰</p>\n</blockquote>\n"},{"title":"ã€é‡è¯†å‰ç«¯ã€‘æš´èµ°çš„å¼‚æ­¥ç¼–ç¨‹","date":"2020-08-28T14:47:09.000Z","cover":"/image/cover/web.jpeg","_content":"\næœ€è¿‘åœ¨å†™ã€é‡æ‹¾å‰ç«¯ã€‘ç³»åˆ—ï¼Œä¸‹é¢æœ‰å‡ ä¸ªå¿«é€Ÿé€šé“ï¼Œå¤§å®¶è‡ªå–\n\n[ã€é‡è¯†å‰ç«¯ã€‘åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿](https://juejin.im/post/6850418113944420359)\n\n[ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—](https://juejin.im/post/6850418117508759566)\n\n[ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this](https://juejin.im/post/6854573215658803208)\n\n[ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šJavaScriptçš„æ‰§è¡Œæœºåˆ¶](https://juejin.im/post/6859911609633767438)\n\n[ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC](https://juejin.im/post/6860375101322461198)\n\n[ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ](https://juejin.im/post/6865204092877144077)\n\n[ã€é‡è¯†å‰ç«¯ã€‘æš´èµ°çš„å¼‚æ­¥ç¼–ç¨‹](https://juejin.im/post/6867814019055484942)\n\n## å‰è¨€\n\nè€è§„çŸ©ï¼Œè¿˜æ˜¯å…ˆäº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯å¼‚æ­¥ã€‚å¼‚æ­¥å…¶å®æ˜¯ä¸€ä¸ªç›¸å¯¹æ¯”è¾ƒé«˜çº§çš„ä¸€ä¸ªæ¦‚å¿µã€‚\n\né€šå¸¸æ¥è¯´ï¼Œç¨‹åºéƒ½æ˜¯é¡ºåºæ‰§è¡Œï¼ŒåŒä¸€æ—¶åˆ»åªä¼šå‘ç”Ÿä¸€ä»¶äº‹ã€‚å¦‚æœä¸€ä¸ªå‡½æ•°ä¾èµ–äºå¦ä¸€ä¸ªå‡½æ•°çš„ç»“æœï¼Œå®ƒåªèƒ½ç­‰å¾…é‚£ä¸ªå‡½æ•°ç»“æŸæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œä»ç”¨æˆ·çš„è§’åº¦æ¥è¯´ï¼Œæ•´ä¸ªç¨‹åºæ‰ç®—è¿è¡Œå®Œæ¯•.\n\nå¦‚æœè¯´ä¸€ä¸ªäº‹æƒ…éœ€è¦ç­‰å¾…ä¸Šä¸€ä»¶äº‹æƒ…åšå®Œæ‰èƒ½åšï¼Œä½†æ˜¯ä»–ä»¬ä¹‹å‰åˆæ²¡æœ‰å¼ºè€¦åˆå…³ç³»ã€‚è¿™æ ·å°±åœ¨é‚£é‡Œå¹²ç­‰å°±æ¯«æ— æ„ä¹‰ã€‚ç‰¹åˆ«æ˜¯ç°åœ¨è®¡ç®—æœºæ™®ééƒ½æœ‰å¤šæ ¸CPUçš„æ—¶ä»£ã€‚\n\nä¸¾ä¸€ä¸ªå½¢è±¡çš„ğŸŒ°ã€‚\n\næˆ‘ä»¬ç°åœ¨è¦å»åƒæµ·åº•æï¼ˆæµ·åº•ææ‰“é’±ï¼ï¼‰ï¼Œæˆ‘ä»¬å‘ç°è¦æ’é˜Ÿï¼Œéœ€è¦æ’2ä¸ªå°æ—¶å·¦å³ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¦å¹²å˜›ï¼Ÿéš¾é“æ˜¯å¹²ç­‰å—ï¼Ÿè‚¯å®šä¸æ˜¯ï¼é‚£æ ·è ¢è ¢çš„ç¡¬ç­‰å¾ˆå‘†ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæ‹¿å‡ºæ‰‹æœºåˆ·åˆ·æœ‹å‹åœˆï¼Œæˆ–è€…ç©ä¸€æŠŠç´§å¼ åˆºæ¿€çš„ç‹è€…è£è€€åˆæˆ–è€…å»çœ‹ä¸€åœºç”µå½±ç­‰ç­‰....åœ¨æˆ‘ä»¬åšè¿™äº›äº‹æƒ…çš„æ—¶å€™æˆ‘ä»¬çš„æ’é˜Ÿå¹¶æ²¡æœ‰è¢«è€½è¯¯ï¼Œç”šè‡³å¯ä»¥å’ŒæœåŠ¡å‘˜è¯´å¿«åˆ°äº†æ‰“ä¸ªç”µè¯ç»™æˆ‘ï¼ˆè¿™ä¸ªæ˜¯å¸¸è§çš„callbackæ–¹æ³•ï¼Œå¾…ä¼šè®¨è®ºï¼‰\n\n> è¿™æ ·ä½ å¯ä»¥åŒæ—¶å®Œæˆå…¶ä»–å·¥ä½œï¼Œè¿™å°±æ˜¯**å¼‚æ­¥ç¼–ç¨‹**çš„å‡ºå‘ç‚¹ã€‚\n\næœ¬æ–‡æ€»ç»“äº†å‡ ä¸ªå¼‚æ­¥çš„æ–¹æ¡ˆï¼Œç†è§£å®ƒä»¬å¯ä»¥è®©ä½ å†™å‡ºç»“æ„æ›´åˆç†ã€æ€§èƒ½æ›´å‡ºè‰²ã€ç»´æŠ¤æ›´æ–¹ä¾¿çš„Javascriptç¨‹åºã€‚\n\n## å¼‚æ­¥callback\n\nä¸Šæ¥å°±æ˜¯ä¸€ä¸ªè‹±ä¿Šçš„ä¾‹å­\n\n```js\nvar response = fetch('myImage.png');\nvar blob = response.blob();\n```\n\næ²¡æœ‰äººå¯ä»¥å®Œç¾é¢„æµ‹åˆ°æ¯ç§ç½‘ç»œæƒ…å†µä¸‹è¿™ä¸ªresponseï¼Œæ˜¯å¦å¯ä»¥å®Œç¾è·å¾—fetchè·å¾—çš„å†…å®¹ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šæŠ¥é”™ã€‚\n\nè¿™ä¸ªæ—¶å€™æˆ‘ä»¬çš„callbackå°±âœ¨bu ling bu lingçš„ç™»åœºå•¦ã€‚\n\næœ‰äº›å°ä¼™ä¼´å¯èƒ½è§‰å¾—callbackä¼¼ä¹å’Œè‡ªå·±æ²¡æœ‰å¤ªå¤§å…³ç³»ã€‚ã€‚ã€‚emmmm....\n\n```js\nbtn.addEventListener('click', () => {\n  alert('You clicked me!');\n});\n```\n\nè¿™æ ·å‘¢ï¼Ÿæœ‰æ²¡æœ‰æ„Ÿè§‰æœ‰ç‚¹å„¿ç†Ÿæ‚‰äº†ï¼Œå…¶ä»–è¿™ä¸ªå°±ç›¸å½“äºreactä¸­çš„\n\n```html\n<div onclick={() =>{alert('You clicked me!');}}>\n\tç‚¹æˆ‘  \n</div>\n```\n\næ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œè¿™ä¸ªå…¶å®å°±æ˜¯æœ€å¸¸è§çš„callbackï¼ˆå›è°ƒå‡½æ•°ï¼‰ã€‚\n\nåˆæˆ–è€…æ¯”è¾ƒå¸¸è§çš„\n\n```js\nsetTimeout(() => {\n\talert('You clicked me!');\n}ï¼Œ2000)\n```\n\nå¾ˆå¸¸è§ï¼Œå¤§è‡´æ„æ€å°±æ˜¯2ç§’é’Ÿä¹‹åä¼šå›è°ƒä¸€ä¸‹è¿™ä¸ªåŒ¿åå‡½æ•°ï¼Œè™½ç„¶ä¸ä¸€å®šä¼šå‡†ç¡®æ‰§è¡Œï¼Œè¿™ä¸ªæ¶‰åŠåˆ°äº‹ä»¶å¾ªç¯ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å»æ‰¾ä¸€ä¸‹æˆ‘å‰é˜µå­å†™çš„äº‹ä»¶å¾ªç¯ğŸ˜Šã€‚\n\n## å‘å¸ƒ-è®¢é˜…æ¨¡å¼\n\nå‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼šåˆç§°ä¸ºè§‚å¯Ÿè€…æ¨¡å¼ï¼Œå®ƒå®šä¹‰å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€æ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å°†å¾—åˆ°é€šçŸ¥ã€‚\n\nåœ¨å†™Reactçš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªéå¸¸éå¸¸éå¸¸å¸¸è§çš„ğŸŒ°ï¼š\n\n```jsx\nimport React, {useState, useEffect} from 'react';\nconst test = () => {\n  const [derrick, setDerrick] = useState(0)\n  useEffect(()=> {\n    console.log(derrick)\n  }, [derrick])\n  return(\n    <button onClick={() => {setDerrick(derrick+1)}}>ç‚¹æˆ‘</button>\n  )\n}\n```\n\nuseEffectè®¢é˜…äº†derrickè¿™ä¸ªå˜é‡çš„å˜åŒ–ï¼Œç„¶åç›‘å¬åˆ°å˜åŒ–ä¹‹åå°±ä¼šè¿›è¡Œä¸€æ¬¡logï¼Œæ‰“å°å‡ºderrickå˜é‡çš„å€¼ã€‚\n\n## Promise\n\n### å›è°ƒæ•‘æ˜Ÿ\n\nä¹‹å‰ä»‹ç»è¿‡å›è°ƒå‡½æ•°è¿™ç§å¼‚æ­¥ç¼–ç¨‹ã€‚\n\nåŠ å…¥æˆ‘å¸Œæœ›åœ¨Aæ‰§è¡Œå®Œä¹‹åæ‰§è¡ŒBï¼Œç„¶åæ‰§è¡ŒCï¼Œç„¶åæ‰§è¡ŒD....æœ€åæ‰§è¡ŒZ\n\nå†™å‡ºæ¥çš„ä»£ç å¯èƒ½æ˜¯è¿™æ ·çš„\n\n```js\nvar sayhello = function (name, callback) {\n  setTimeout(function () {\n    console.log(name);\n    callback();\n  }, 1000);\n}\nsayhello(\"first\", function () {\n  sayhello(\"second\", function () {\n    sayhello(\"third\", function () {\n      console.log(\"end\");\n    });\n  });\n});\n```\n\nåƒæœ¬ä¾‹ä¸€æ ·åµŒå¥—å¤šä¸ªæ–¹æ³•è°ƒç”¨ä¼šåˆ›å»ºé”™ç»¼å¤æ‚çš„ä»£ç ï¼Œä¼šéš¾ä»¥ç†è§£ä¸è°ƒè¯•ã€‚å½“æƒ³è¦å®ç°æ›´å¤ æ‚çš„åŠŸèƒ½æ—¶ï¼Œå›è°ƒå‡½æ•°ä¹Ÿä¼šå­˜åœ¨é—®é¢˜:è‹¥æƒ³è®©ä¸¤ä¸ªå¼‚æ­¥æ“ä½œå¹¶è¡Œè¿è¡Œï¼Œå¹¶ä¸”åœ¨å®ƒä»¬éƒ½ç»“æŸå æé†’ä½ ï¼Œé‚£è¯¥æ€ä¹ˆåš?è‹¥æƒ³åŒæ—¶å¯åŠ¨ä¸¤ä¸ªå¼‚æ­¥æ“ä½œï¼Œä½†åªé‡‡ç”¨é¦–ä¸ªç»“æŸçš„ç»“æœï¼Œé‚£åˆè¯¥æ€ä¹ˆ åš?\n\nåœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œä½ éœ€è¦è¿½è¸ªå¤šä¸ªå›è°ƒå‡½æ•°å¹¶åšæ¸…ç†æ“ä½œï¼Œ ä¸è¿‡å¥½åœ¨promiseæ¨ªç©ºå‡ºä¸–æ‹¯æ•‘äº†ä¸–ç•Œã€‚\n\n### æ¶‰åŠé¢è¯•é¢˜\n\n> promiseç”¨è¿‡å—ï¼Ÿè¯·ä½ ä»‹ç»ä¸€ä¸‹promiseã€‚\n\nå…¶å®è¿™é‡Œå¾ˆå¤šåŒå­¦å¯èƒ½å°±ä¸çŸ¥é“æ€ä¹ˆä»‹ç»äº†ï¼Œå¯èƒ½åªåœç•™åœ¨æ€ä¹ˆç”¨ã€‚æˆ‘ä»¬å¯ä»¥ä»å‡ ä¸ªæ–¹é¢æ¥ä»‹ç»ã€‚\n\n- promiseæ˜¯ä»€ä¹ˆï¼Ÿ\n- promiseè§£å†³äº†ä»€ä¹ˆé—®é¢˜\n- promiseçš„ä¼˜ç¼ºç‚¹\n\n#### promiseæ˜¯ä»€ä¹ˆï¼Ÿ\n\næ‰€è°“`Promise`ï¼Œç®€å•è¯´å°±æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œé‡Œé¢ä¿å­˜ç€æŸä¸ªæœªæ¥æ‰ä¼šç»“æŸçš„äº‹ä»¶ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼‰çš„ç»“æœã€‚ä»è¯­æ³•ä¸Šè¯´ï¼ŒPromise æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä»å®ƒå¯ä»¥è·å–å¼‚æ­¥æ“ä½œçš„æ¶ˆæ¯ã€‚Promise æä¾›ç»Ÿä¸€çš„ APIï¼Œå„ç§å¼‚æ­¥æ“ä½œéƒ½å¯ä»¥ç”¨åŒæ ·çš„æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚\n\n#### promiseè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ\n\n1. è§£å†³å¯è¯»æ€§çš„é—®é¢˜\n2. è§£å†³ä¿¡ä»»é—®é¢˜\n\n##### å¯è¯»æ€§\n\nå¯è¯»æ€§ï¼Œä¹‹å‰çš„å›è°ƒåœ°ç‹±promiseå°±å¯ä»¥ä¼˜é›…çš„è§£å†³ã€‚(è¿˜æœ‰æ›´åŠ ä¼˜é›…çš„ï¼Œå¾…ä¼šä¼šä»‹ç»ã€‚)\n\n```js\nvar sayhello = function (name) {\n  return new Promise(function (resolve, reject) {\n    setTimeout(function () {\n      console.log(name);\n      resolve();ã€€ã€€//åœ¨å¼‚æ­¥æ“ä½œæ‰§è¡Œå®Œåæ‰§è¡Œ resolve() å‡½æ•°\n    }, 10000);\n  });\n}\nsayhello(\"first\").then(function () {\n  return sayhello(\"second\");ã€€ã€€//ä»ç„¶è¿”å›ä¸€ä¸ª Promise å¯¹è±¡\n}).then(function () {\n  return sayhello(\"third\");\n}).then(function () {\n  console.log('end');\n}).catch(function (err) {\n  console.log(err);\n})\n```\n\n##### ä¿¡ä»»é—®é¢˜\n\nè¿™ä¸ªé—®é¢˜å¯ä»¥ç”¨promiseçš„å‡ ä¸ªç‰¹ç‚¹æ¥è§£é‡Šï¼š\n\n> ï¼ˆ1ï¼‰å¯¹è±¡çš„çŠ¶æ€ä¸å—å¤–ç•Œå½±å“ã€‚`Promise`å¯¹è±¡ä»£è¡¨ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œæœ‰ä¸‰ç§çŠ¶æ€ï¼š`pending`ï¼ˆè¿›è¡Œä¸­ï¼‰ã€`fulfilled`ï¼ˆå·²æˆåŠŸï¼‰å’Œ`rejected`ï¼ˆå·²å¤±è´¥ï¼‰ã€‚åªæœ‰å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œå¯ä»¥å†³å®šå½“å‰æ˜¯å“ªä¸€ç§çŠ¶æ€ï¼Œä»»ä½•å…¶ä»–æ“ä½œéƒ½æ— æ³•æ”¹å˜è¿™ä¸ªçŠ¶æ€ã€‚è¿™ä¹Ÿæ˜¯`Promise`è¿™ä¸ªåå­—çš„ç”±æ¥ï¼Œå®ƒçš„è‹±è¯­æ„æ€å°±æ˜¯â€œæ‰¿è¯ºâ€ï¼Œè¡¨ç¤ºå…¶ä»–æ‰‹æ®µæ— æ³•æ”¹å˜ã€‚\n>\n> ï¼ˆ2ï¼‰ä¸€æ—¦çŠ¶æ€æ”¹å˜ï¼Œå°±ä¸ä¼šå†å˜ï¼Œä»»ä½•æ—¶å€™éƒ½å¯ä»¥å¾—åˆ°è¿™ä¸ªç»“æœã€‚`Promise`å¯¹è±¡çš„çŠ¶æ€æ”¹å˜ï¼Œåªæœ‰ä¸¤ç§å¯èƒ½ï¼šä»`pending`å˜ä¸º`fulfilled`å’Œä»`pending`å˜ä¸º`rejected`ã€‚åªè¦è¿™ä¸¤ç§æƒ…å†µå‘ç”Ÿï¼ŒçŠ¶æ€å°±å‡å›ºäº†ï¼Œä¸ä¼šå†å˜äº†ï¼Œä¼šä¸€ç›´ä¿æŒè¿™ä¸ªç»“æœï¼Œè¿™æ—¶å°±ç§°ä¸º resolvedï¼ˆå·²å®šå‹ï¼‰ã€‚å¦‚æœæ”¹å˜å·²ç»å‘ç”Ÿäº†ï¼Œä½ å†å¯¹`Promise`å¯¹è±¡æ·»åŠ å›è°ƒå‡½æ•°ï¼Œä¹Ÿä¼šç«‹å³å¾—åˆ°è¿™ä¸ªç»“æœã€‚è¿™ä¸äº‹ä»¶ï¼ˆEventï¼‰å®Œå…¨ä¸åŒï¼Œäº‹ä»¶çš„ç‰¹ç‚¹æ˜¯ï¼Œå¦‚æœä½ é”™è¿‡äº†å®ƒï¼Œå†å»ç›‘å¬ï¼Œæ˜¯å¾—ä¸åˆ°ç»“æœçš„ã€‚\n\nç”±äºPromiseåªèƒ½è¢«å†³è®®ä¸€æ¬¡ï¼Œä¸”å†³è®®ä¹‹åæ— æ³•æ”¹å˜ï¼Œæ‰€ä»¥ï¼Œå³ä¾¿æ˜¯å¤šæ¬¡å›è°ƒï¼Œä¹Ÿä¸ä¼šå½±å“ç»“æœï¼Œå†³è®®ä¹‹åçš„è°ƒç”¨éƒ½ä¼šè¢«å¿½ç•¥ã€‚\n\n```js\n//ä¿¡ä»»é—®é¢˜æ¼”ç¤º\n\n//å›è°ƒ\nfunction method(cb){\n    setTimeout(function(){\n        cb && cb();\n        //å› ä¸ºæŸäº›bugå¯¼è‡´æŸä¸ªå‡½æ•°å¤šæ‰§è¡Œäº†ä¸€æ¬¡\n        cb && cb();\n    },1000);\n}\n\n//promise\nfunction method2(){\n    return new Promise(resolve=>{\n        setTimeout(function(){\n            resolve();\n            //resolveæˆåŠŸè°ƒç”¨ä¸€æ¬¡ä¹‹åï¼Œåé¢çš„ä¸ä¼šå†æ‰§è¡Œ\n            resolve();\n        },1000);        \n    })\n}\n```\n\næ§åˆ¶åè½¬ã€‚ä½“ç°åœ¨å¯¹äºå‡½æ•°çš„æŠŠæ§ï¼Œæ¯”å¦‚thisç­‰ã€‚\n\n```js\n//å›è°ƒ\nfunction method(cb){\n    setTimeout(function(){\n        cb && cb.call({a:1,b:2});//æ‰§è¡Œå›è°ƒï¼Œä½†æ˜¯æ·»æ²¹åŠ é†‹\n    },1000);\n}\n\n//promise\nfunction method2(){\n    return new Promise(resolve=>{\n        setTimeout(function(){\n            resolve();//è°ƒç”¨çš„resolveéƒ½æ˜¯è‡ªå·±å†™çš„ï¼Œæ”¹å–„äº†æ§åˆ¶åè½¬çš„é—®é¢˜\n        },1000);        \n    })\n}\n```\n\n### æ‰‹æ’•A+è§„èŒƒçš„promise\n\n> é¢è¯•é¢˜ï¼šä½ çŸ¥é“promiseçš„A+è§„èŒƒå—ï¼Ÿï¼ˆæœ¬äººåœ¨æµ©é²¸ç§‘æŠ€è¢«é—®åˆ°çš„ï¼Œå½“æ—¶ç­”çš„æ”¯æ”¯å¾å¾ã€‚ã€‚ã€‚ï¼‰\n\næˆ‘ä½•æ­¢æ˜¯çŸ¥é“ï¼Œæˆ‘ç”šè‡³å¯ä»¥æ‰‹å†™ä¸€ä¸ªç¬¦åˆA+è§„èŒƒçš„promiseï¼\n\nA+è§„èŒƒå¿«é€Ÿå…¥å£ï¼Œ[ç‚¹æˆ‘](https://promisesaplus.com/)\n\n\n\n```js\nfunction MyPromise(executor) {\n  // æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚\n  let self = this;\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  self.status = 'pending';\n  // å­˜å‚¨æˆåŠŸçš„å€¼\n  self.value = null;\n  // å­˜å‚¨å¤±è´¥çš„å€¼\n  self.reason = null;\n  function resolve(value) {\n    // 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜\n    if(self.status === 'pending') {\n      // å­˜ä¸‹æˆåŠŸçš„å€¼\n      self.value = value\n      self.status = 'fulfilled';\n    }\n  }\n  function reject(reason) {\n    // 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜\n    if(self.status === 'pending') {\n      // å­˜ä¸‹å¤±è´¥çš„å€¼\n      self.reason = reason\n      self.status = 'rejected';\n    }\n  }\n  \n  executor(resolve, reject);\n}\n```\n\npromiseé‡Œé¢æœ€éš¾çš„å°±æ˜¯thenäº†ï¼Œæˆ‘ä»¬å¿…é¡»å°†è¿™ä¸ªæ–¹æ³•å†™åœ¨ä»–çš„åŸå‹é“¾ä¸Šé¢ï¼Œå¹¶ä¸”ä»–æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯æˆåŠŸçš„å›è°ƒï¼Œä¸€ä¸ªæ˜¯å¤±è´¥çš„å›è°ƒã€‚\n\nåºŸè¯ä¸å¤šè¯´ï¼Œå¼€å†²ï¼\n\n#### æ”¯æŒå¼‚æ­¥\n\nåœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åŠ ä¸¤ä¸ªå˜é‡ã€‚\n\n```js\nfunction MyPromise(executor) {\n  // æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚\n  let self = this;\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  self.status = 'pending';\n  // å­˜å‚¨æˆåŠŸçš„å€¼\n  self.value = null;\n  // å­˜å‚¨å¤±è´¥çš„å€¼\n  self.reason = null;\n  // å­˜å‚¨æˆåŠŸçš„å›è°ƒ\n  self.onResolved = [];\n  // å­˜å‚¨å¤±è´¥çš„å›è°ƒ\n  self.onRejected = [];\n  \n  function resolve(value) {\n    // 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜\n    if(self.status === 'pending') {\n      // å­˜ä¸‹æˆåŠŸçš„å€¼\n      self.value = value\n      self.status = 'fulfilled';\n    }\n  }\n  \n  function reject(reason) {\n    // 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜\n    if(self.status === 'pending') {\n      // å­˜ä¸‹å¤±è´¥çš„å€¼\n      self.reason = reason\n      self.status = 'rejected';\n    }\n  }\n  \n  executor(resolve, reject);\n}\n```\n\né¢œå€¼é«˜åˆç»†å¿ƒçš„åŒå­¦ä¼šå‘ç°ï¼Œæˆ‘å¤šåŠ äº†ä¸¤ä¸ªå˜é‡ã€‚\n\n```js\n// å­˜å‚¨æˆåŠŸçš„å›è°ƒ\nself.onResolved = [];\n// å­˜å‚¨å¤±è´¥çš„å›è°ƒ\nself.onRejected = [];\n```\n\nè¿™ä¸¤ä¸ªå˜é‡å‘¢ï¼Œä¹Ÿéå¸¸å¥½ç†è§£ï¼Œå°±æ˜¯å­˜å‚¨å›è°ƒçš„ã€‚é‚£ä¹ˆæœ‰ä¸€ä¸ªéå¸¸éå¸¸é‡è¦çš„é—®é¢˜ï¼Œæˆ‘å†™çš„æ—¶å€™ä¹Ÿå›°æ‰°äº†å¥½ä¹…ï¼Œä¸ºä»€ä¹ˆä¸€å®šè¦æ˜¯ä¸€ä¸ªæ•°ç»„å‘¢ï¼Ÿæˆ‘å­˜å‚¨ä¸ºä¸€ä¸ªå‡½æ•°ä¸è¡Œå—ï¼Ÿåˆ°æ—¶å€™æ‰§è¡Œå°±è¡Œå•¦ã€‚ã€‚ã€‚\n\nqsï¼Œå’Œæˆ‘æƒ³ä¸€æ ·çš„å¸…å“¥é“å¥³å¯èƒ½æ¯”è¾ƒå¤šã€‚è¿™é‡Œæˆ‘ç»Ÿä¸€å›å¤ï¼š\n\nå‡å¦‚è¯´ã€‚ä»¥ä¸‹çš„æƒ…å†µå‡ºç°çš„è¯ï¼Œå’‹åŠã€‚\n\n```js\nvar p = new Promise((resolve, reject)=>{\n    setTimeout(()=>{\n        resolve(4)\n    }, 1000)\n})\np.then((res)=>{\n    //4 res\n    console.log(res, 'res')\n})\np.then((res1)=>{\n    //4 res1\n    console.log(res1, 'res1')\n})\n```\n\nè¿™ç§æƒ…å†µå‡ºç°ï¼Œå¦‚æœæˆ‘ä»¬åªæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„`console.log(res, 'res')`è¿™è¾ˆå­éƒ½æ— æ³•é—®ä¸–ï¼Œä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºè¢«åé—¨çš„`console.log(res1, 'res')`ç»™è¦†ç›–äº†å‘€ã€‚å¯¹ä¸å¯¹ï¼Œå¦‚æœè¯´è¿™ä¸ª`resolve`ä»–å»¶è¿Ÿæ‰§è¡Œï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦åšçš„æ˜¯æŠŠ`then`å‡½æ•°ç»™ä¿å­˜ä¸‹æ¥ï¼Œç­‰åˆ°`resolve`è¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œä¾æ¬¡æ‰§è¡Œæˆ‘ä»¬æ‰€æœ‰åˆ›å»ºçš„`then`é‡Œé¢çš„å›è°ƒå‡½æ•°ã€‚\n\nå¬æ‡‚æŒå£°ï¼\n\næ²¡å¬æ‡‚çš„æ¥ç€å¾€ä¸‹çœ‹ï¼Œæˆ‘ä»¬æŠŠå‰©ä½™å·¥ä½œåšå®Œï¼Œç„¶åä¸¾ä¸€ä¸ªä¾‹å­ã€‚é©¬ä¸Šå°±èƒ½æ˜ç™½äº†ã€‚\n\nåˆšåˆšè¯´åˆ°ï¼Œæˆ‘ä»¬è¡¥å……ä¸¤ä¸ªå˜é‡ï¼Œç„¶åå†™ä¸‹æˆ‘ä»¬çš„`then`å‡½æ•°ã€‚\n\n```js\nMyPromise.prototype.then = function(onFulfilled, onRejected){\n  let self = this;\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  if(self.status === 'fulfilled') {\n    onFulfilled(self.value);\n  }\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  if(self.status === 'rejected') {\n    onRejected(self.reason);\n  }\n  // å¦‚æœæ˜¯pendingåº”è¯¥å­˜å‚¨å½“å‰çš„å›è°ƒå‡½æ•°\n  if(self.status === 'pending') {\n    self.onResolved.push(() => {onFulfilled(self.value)})\n    self.onRejected.push(() => {onRejected(self.reason)})\n  }\n}\n```\n\nç„¶åæˆ‘ä»¬è¿˜éœ€è¦åœ¨`resolve`æˆ–è€…`reject`çš„æ—¶å€™æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨èµ·æ¥çš„è¿™äº›å‡½æ•°ã€‚\n\nå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š\n\n```js\nfunction MyPromise(executor) {\n  // æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚\n  let self = this;\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  self.status = 'pending';\n  // å­˜å‚¨æˆåŠŸçš„å€¼\n  self.value = null;\n  // å­˜å‚¨å¤±è´¥çš„å€¼\n  self.reason = null;\n  // å­˜å‚¨æˆåŠŸçš„å›è°ƒ\n  self.onResolved = [];\n  // å­˜å‚¨å¤±è´¥çš„å›è°ƒ\n  self.onRejected = [];\n  \n  function resolve(value) {\n    // 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜\n    if(self.status === 'pending') {\n      // å­˜ä¸‹æˆåŠŸçš„å€¼\n      self.value = value\n      self.status = 'fulfilled';\n      // æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;\n      self.onResolved.forEach(fn => fn())\n    }\n  }\n  \n  function reject(reason) {\n    // 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜\n    if(self.status === 'pending') {\n      // å­˜ä¸‹å¤±è´¥çš„å€¼\n      self.reason = reason\n      self.status = 'rejected';\n      // æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;\n      self.onRejected.forEach(fn => fn())\n    }\n  }\n  \n  executor(resolve, reject);\n}\n\nMyPromise.prototype.then = function(onFulfilled, onRejected){\n  let self = this;\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  if(self.status === 'fulfilled') {\n    onFulfilled(self.value);\n  }\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  if(self.status === 'rejected') {\n    onRejected(self.reason);\n  }\n  // å¦‚æœæ˜¯pendingåº”è¯¥å­˜å‚¨å½“å‰çš„å›è°ƒå‡½æ•°\n  if(self.status === 'pending') {\n    self.onResolved.push(() => {onFulfilled(self.value)})\n    self.onRejected.push(() => {onRejected(self.reason)})\n  }\n}\n```\n\nOKã€‚æˆ‘ä»¬å…ˆè¯•è¯•æˆ‘ä»¬è‡ªå·±å†™çš„promiseã€‚è·‘ä¸€ä¸‹demoå§ã€‚ä¸ºäº†ç»™æ‡’åŒå­¦ä¾¿æ·çš„è°ƒè¯•ï¼Œç›´æ¥CVä¸‹é¢å°±å¥½å•¦ã€‚\n\n```js\nfunction MyPromise(executor) {\n  // æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚\n  let self = this;\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  self.status = 'pending';\n  // å­˜å‚¨æˆåŠŸçš„å€¼\n  self.value = null;\n  // å­˜å‚¨å¤±è´¥çš„å€¼\n  self.reason = null;\n  // å­˜å‚¨æˆåŠŸçš„å›è°ƒ\n  self.onResolved = [];\n  // å­˜å‚¨å¤±è´¥çš„å›è°ƒ\n  self.onRejected = [];\n  \n  function resolve(value) {\n    // 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜\n    if(self.status === 'pending') {\n      // å­˜ä¸‹æˆåŠŸçš„å€¼\n      self.value = value\n      self.status = 'fulfilled';\n      // æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;\n      self.onResolved.forEach(fn => fn())\n    }\n  }\n  \n  function reject(reason) {\n    // 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜\n    if(self.status === 'pending') {\n      // å­˜ä¸‹å¤±è´¥çš„å€¼\n      self.reason = reason\n      self.status = 'rejected';\n      // æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;\n      self.onRejected.forEach(fn => fn())\n    }\n  }\n\n  executor(resolve, reject);\n}\n\nMyPromise.prototype.then = function(onFulfilled, onRejected){\n  let self = this;\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  if(self.status === 'fulfilled') {\n    onFulfilled(self.value);\n  }\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  if(self.status === 'rejected') {\n    onRejected(self.reason);\n  }\n  // å¦‚æœæ˜¯pendingåº”è¯¥å­˜å‚¨å½“å‰çš„å›è°ƒå‡½æ•°\n  if(self.status === 'pending') {\n    self.onResolved.push(() => {\n      onFulfilled(self.value)\n    })\n    self.onRejected.push(() => {\n      onRejected(self.reason)\n    })\n  }\n}\n\nvar p = new MyPromise((resolve, reject)=>{\n  setTimeout(()=>{\n    resolve(4)\n  }, 1000)\n})\np.then((res)=>{\n  //4 res\n  console.log(res, 'res')\n})\np.then((res1)=>{\n  //4 res1\n  console.log(res1, 'res1')\n})\n```\n\nå—¯~å¦‚æ„¿è¾“å‡ºäº†ï¼Œé‚£å›åˆ°åˆšåˆšçš„é—®é¢˜ã€‚æˆ‘ä»¬æŠŠå›è°ƒçš„åœ°æ–¹ä¸è¦ç”¨æ•°ç»„è€Œç”¨å‡½æ•°å‘¢ï¼Ÿä¸ç”¨åŒå­¦ä»¬æ‰“å­—äº†ï¼Œç›´æ¥CVğŸ‘‡çš„ä»£ç å°±å¥½äº†ã€‚\n\n```js\nfunction MyPromise(executor) {\n  // æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚\n  let self = this;\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  self.status = 'pending';\n  // å­˜å‚¨æˆåŠŸçš„å€¼\n  self.value = null;\n  // å­˜å‚¨å¤±è´¥çš„å€¼\n  self.reason = null;\n  // å­˜å‚¨æˆåŠŸçš„å›è°ƒ\n  self.onResolved = [];\n  // å­˜å‚¨å¤±è´¥çš„å›è°ƒ\n  self.onRejected = [];\n  \n  function resolve(value) {\n    // 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜\n    if(self.status === 'pending') {\n      // å­˜ä¸‹æˆåŠŸçš„å€¼\n      self.value = value\n      self.status = 'fulfilled';\n      // æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;\n      self.onResolved.forEach(fn => fn())\n    }\n  }\n  \n  function reject(reason) {\n    // 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜\n    if(self.status === 'pending') {\n      // å­˜ä¸‹å¤±è´¥çš„å€¼\n      self.reason = reason\n      self.status = 'rejected';\n      // æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;\n      self.onRejected.forEach(fn => fn())\n    }\n  }\n\n  executor(resolve, reject);\n}\n\nMyPromise.prototype.then = function(onFulfilled, onRejected){\n  let self = this;\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  if(self.status === 'fulfilled') {\n    onFulfilled(self.value);\n  }\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  if(self.status === 'rejected') {\n    onRejected(self.reason);\n  }\n  // å¦‚æœæ˜¯pendingåº”è¯¥å­˜å‚¨å½“å‰çš„å›è°ƒå‡½æ•°\n  if(self.status === 'pending') {\n    self.onResolved.push(() => {\n      onFulfilled(self.value)\n    })\n    self.onRejected.push(() => {\n      onRejected(self.reason)\n    })\n  }\n}\n\nvar p = new MyPromise((resolve, reject)=>{\n  setTimeout(()=>{\n    resolve(4)\n  }, 1000)\n})\np.then((res)=>{\n  //4 res\n  console.log(res, 'res')\n})\np.then((res1)=>{\n  //4 res1\n  console.log(res1, 'res1')\n})\n```\n\næ˜¯ä¸æ˜¯åªæœ‰`console.log(res1, 'res1')`å•¦ï¼Ÿå› ä¸ºæ‰§è¡Œ`then`çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„resolveè¿˜æœ‰æ²¡æœ‰è¢«è°ƒç”¨ï¼Œå¦‚æœæˆ‘ä»¬æœ‰å¤šä¸ª`then`çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦æŠŠä»–ä»¬å­˜å‚¨èµ·æ¥ï¼Œç„¶åä¾æ¬¡è°ƒç”¨ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨åˆ°æ•°ç»„ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ˜¯åˆ«çš„æ–¹æ³•ï¼Œæ ¸å¿ƒæ€æƒ³å°±æ˜¯æŠŠä»–ä»¬å­˜èµ·æ¥ï¼Œåœ¨éœ€è¦è°ƒç”¨çš„æ—¶å€™è°ƒç”¨ã€‚\n\næ˜¯ä¸æ˜¯å¾ˆå¥½ç†è§£ï¼Ÿï¼ï¼\n\nå¬æ‡‚æŒå£°ï¼\n\nè€Œä¸”A+ä¹Ÿè¦æ±‚äº†ã€‚\n\n> `2.2.6:then` may be called multiple times on the same promise.\n>\n> ï¼ˆpromise çš„ `then` å¯ä»¥é“¾å¼è°ƒç”¨å¤šæ¬¡ï¼‰\n>\n> 2.2.6.1ï¼šIf/when `promise` is fulfilled, all respective `onFulfilled` callbacks must execute in the order of their originating calls to `then`.\n>\n> ï¼ˆå¦‚æœæˆ–å½“ promise è½¬æ€æ˜¯ fulfilled æ—¶ï¼Œæ‰€æœ‰çš„ onFulfilled å›è°ƒå›ä»¥ä»–ä»¬æ³¨å†Œæ—¶çš„é¡ºåºä¾æ¬¡æ‰§è¡Œï¼‰\n>\n> 2.2.6.2ï¼šIf/when `promise` is rejected, all respective `onRejected` callbacks must execute in the order of their originating calls to `then`.\n>\n> ï¼ˆå¦‚æœæˆ–å½“ promise è½¬æ€æ˜¯ rejected æ—¶ï¼Œæ‰€æœ‰çš„ onRejected å›è°ƒå›ä»¥ä»–ä»¬æ³¨å†Œæ—¶çš„é¡ºåºä¾æ¬¡æ‰§è¡Œï¼‰\n\næˆ‘ä»¬å¯¹promiseçš„ç†è§£æ›´è¿›ä¸€æ­¥äº†ã€‚è®°å¾—æŠŠä»£ç æ”¹å›å»ï¼Œç»§ç»­å¾€ä¸‹èµ°ã€‚\n\nåˆšåˆšæˆ‘ä»¬çš„demoè¿˜ä¸å¤Ÿé²æ£’ï¼Œè€Œä¸”æˆ‘ä»¬çš„æµ‹è¯•ç”¨ä¾‹éƒ½æ˜¯å®Œç¾æƒ…å†µä¸‹ã€‚\n\næ¥ä¸‹æ¥è¦å‰‘èµ°åé”‹äº†ã€‚\n\n> A+:\n>\n> 2.2.1ï¼šBoth `onFulfilled` and `onRejected` are optional arguments:\n>\n> ï¼ˆonFulfilled å’Œ onRejected éƒ½æ˜¯å¯é€‰å‚æ•°ï¼šï¼‰\n>\n> 2.2.1.1 If `onFulfilled` is not a function, it must be ignored.\n>\n> ï¼ˆå¦‚æœ onFulfilled ä¸æ˜¯å‡½æ•°ï¼Œå®ƒä¼šè¢«å¿½ç•¥ï¼‰\n>\n> 2.2.1.2 If `onRejected` is not a function, it must be ignored.\n>\n> ï¼ˆå¦‚æœ onRejected ä¸æ˜¯å‡½æ•°ï¼Œå®ƒä¼šè¢«å¿½ç•¥ï¼‰\n>\n> 2.2.7.2: If either `onFulfilled` or `onRejected` throws an exception `e`, `promise2` must be rejected with `e` as the reason.\n>\n> ï¼ˆå¦‚æœ onFulfilled æˆ– onRejected é‡ŒæŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸ï¼Œé‚£ä¹ˆ promise2 å¿…é¡»æ•è·è¿™ä¸ªé”™è¯¯ï¼ˆæ¥å—ä¸€ä¸ª reason å‚æ•°ï¼‰ï¼‰\n\næ‰€ä»¥æˆ‘ä»¬é¦–å…ˆè¦åšçš„å°±æ˜¯ï¼ŒæŠŠé”™è¯¯ç»™æå‰æ•è·ï¼Œç„¶åä¸¢ç»™`reject`\n\nemmm....æ¥ä¸‹æˆ‘è´´ä»£ç éƒ½æ˜¯ä¸€èµ·è´´äº†ï¼Œå› ä¸ºæˆ‘æ€•æœ‰åŒå­¦ä¼šæ‰é˜Ÿï¼Œé‡Œé¢ä¹Ÿä¼šæœ‰ç›¸åº”çš„æ³¨é‡Šå¸®åŠ©ä¼šèµ°ç¥çš„åŒå­¦è·Ÿç´§è¿™è¾†äº”è±å®å…‰ã€‚\n\n```js\nfunction MyPromise(executor) {\n  // æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚\n  let self = this;\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  self.status = 'pending';\n  // å­˜å‚¨æˆåŠŸçš„å€¼\n  self.value = null;\n  // å­˜å‚¨å¤±è´¥çš„å€¼\n  self.reason = null;\n  // å­˜å‚¨æˆåŠŸçš„å›è°ƒ\n  self.onResolved = [];\n  // å­˜å‚¨å¤±è´¥çš„å›è°ƒ\n  self.onRejected = [];\n  \n  function resolve(value) {\n    // 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜\n    if(self.status === 'pending') {\n      // å­˜ä¸‹æˆåŠŸçš„å€¼\n      self.value = value\n      self.status = 'fulfilled';\n      // æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;\n      self.onResolved.forEach(fn => fn())\n    }\n  }\n  \n  function reject(reason) {\n    // 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜\n    if(self.status === 'pending') {\n      // å­˜ä¸‹å¤±è´¥çš„å€¼\n      self.reason = reason\n      self.status = 'rejected';\n      // æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;\n      self.onRejected.forEach(fn => fn())\n    }\n  }\n  // æ•è·é”™è¯¯ä¼ ç»™rejectã€‚æ³•å¾‹è§„å®šï¼\n\ttry{\n  \texecutor(resolve, reject);\n  } catch(e) {\n    reject(e);\n  }\n}\n\nMyPromise.prototype.then = function(onFulfilled, onRejected){\n  let self = this;\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  // å¦‚æœä¸æ˜¯å‡½æ•°å°±å¿½ç•¥ 2.2.1.1\n  if(self.status === 'fulfilled') {\n    typeof onFulfilled === 'function' && onFulfilled(self.value);\n  }\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  if(self.status === 'rejected') {\n    typeof onFulfilled === 'function' && onRejected(self.reason);\n  }\n  // å¦‚æœæ˜¯pendingåº”è¯¥å­˜å‚¨å½“å‰çš„å›è°ƒå‡½æ•°\n  // å¦‚æœä¸æ˜¯å‡½æ•°å°±å¿½ç•¥ 2.2.1.2\n  if(self.status === 'pending') {\n    // å¦‚æœä¸æ˜¯å‡½æ•°å°±å¿½ç•¥ 2.2.1.1\n    typeof onFulfilled === 'function' && self.onResolved.push(() => {\n      onFulfilled(self.value)\n    })\n    // å¦‚æœä¸æ˜¯å‡½æ•°å°±å¿½ç•¥ 2.2.1.2\n    typeof onFulfilled === 'function' && self.onRejected.push(() => {\n      onRejected(self.reason)\n    })\n  }\n}\n```\n\n#### é“¾å¼è°ƒç”¨then\n\nå¼€å§‹å‡†å¤‡è¿›å…¥promiseçš„éš¾ç‚¹ä»¥åŠæ ¸å¿ƒç‚¹ï¼šé“¾å¼è°ƒç”¨ã€‚\n\n> 2.2.7ï¼š`then` must return a promise\n>\n> ï¼ˆthen æ–¹æ³•ä¸€å®šè¿”å›ä¸€ä¸ª promiseï¼‰\n\næˆ‘ä»¬éœ€è¦è¿”å›æ–°çš„promiseçš„è¯ï¼Œå¯ä»¥ç®€å•å®ç°ï¼Œå¿«é€Ÿè¿­ä»£ã€‚\n\n```js\nPromise.prototype.then = function (onFulfilled, onRejected) {\n    let promise2 = new Promise((resolve, reject)=>{\n    })\n    return promise2\n}\n```\n\n> 2.2.7.1ï¼šIf either `onFulfilled` or `onRejected` returns a value `x`, run the Promise Resolution Procedure `[[Resolve]](promise2, x)`.\n>\n> ï¼ˆå¦‚æœ onFulfilled æˆ– onRejected è¿”å›çš„æ˜¯ä¸€ä¸ª xï¼Œé‚£ä¹ˆå®ƒä¼šä»¥[[Resolve]](promise2, x)` å¤„ç†è§£æï¼‰\n>\n> 2.2.7.2ï¼šIf either `onFulfilled` or `onRejected` throws an exception `e`, `promise2` must be rejected with `e` as the reason.\n>\n> ï¼ˆå¦‚æœ onFulfilled æˆ– onRejected é‡ŒæŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸ï¼Œé‚£ä¹ˆ promise2 å¿…é¡»æ•è·è¿™ä¸ªé”™è¯¯ï¼ˆæ¥å—ä¸€ä¸ª reason å‚æ•°ï¼‰ï¼‰\n>\n> 2.2.7.3ï¼šIf `onFulfilled` is not a function and `promise1` is fulfilled, `promise2` must be fulfilled with the same value as `promise1`.\n>\n> ï¼ˆå¦‚æœ onFulfilled ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸” promise1 çŠ¶æ€æ˜¯ fulfilledï¼Œé‚£ä¹ˆ promise2 ä¸€å®šä¼šæ¥å—åˆ°ä¸ promse1 ä¸€æ ·çš„å€¼ valueï¼‰\n>\n> 2.2.7.4ï¼šIf `onRejected` is not a function and `promise1` is rejected, `promise2` must be rejected with the same reason as `promise1`.\n>\n> ï¼ˆå¦‚æœ onRejected ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸” promise1 çŠ¶æ€æ˜¯ rejectedï¼Œpromise2 ä¸€å®šä¼šæ¥å—åˆ°ä¸ promise1 ä¸€æ ·çš„å€¼ reasonï¼‰\n\næˆ‘ä»¬éœ€è¦å°†è¿”å›å†…å®¹promiseåŒ–ï¼Œéœ€è¦å¯¹onFulfilledå’ŒonRejectedè¿›è¡Œé”™è¯¯å¤„ç†ï¼Œè¿™ä¸ªæˆ‘ä»¬ä¹‹å‰å°±å¤„ç†è¿‡äº†ï¼Œå¦‚æœonFulfilledå’ŒonRejectedæ²¡æœ‰ä¼ å‚å°±ç»§ç»­ä¼ é€’ï¼ŒåŸç”ŸğŸŒ°æ¥ï¼š\n\n```js\nvar p = new Promise(function(resolve, reject){\n    setTimeout(function(){\n        resolve(3)\n    }, 1000)\n});\np.then(1,1)\n.then('','')\n.then()\n.then(function(res){\n    //3\n    console.log(res)\n})\n```\n\nè¿™é‡Œä¸ç®¡onFulfilledå’ŒonRejectedä¼ ä»€ä¹ˆå€¼ï¼Œåªè¦ä¸æ˜¯å‡½æ•°ï¼Œå°±ç»§ç»­å‘ä¸‹ä¼ å…¥ï¼Œç›´åˆ°æœ‰å‡½æ•°è¿›è¡Œæ¥æ”¶ï¼›è¦åšçš„äº‹æƒ…å¤ªå¤šäº†ï¼Œä¸å½“å½“æ˜¯åˆ¤æ–­å‡½æ•°è¿™ç§ç®€å•çš„åˆ¤æ–­äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æŠ½ç¦»ä¸€ä¸ªæ–°çš„å‡½æ•°æ¥å¤ç”¨ç»Ÿä¸€å¤„ç†ã€‚å› æ­¤æˆ‘ä»¬è¿›è¡Œå¦‚ä¸‹å®Œå–„ï¼š\n\n```js\nfunction MyPromise(executor) {\n  // æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚\n  let self = this;\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  self.status = 'pending';\n  // å­˜å‚¨æˆåŠŸçš„å€¼\n  self.value = null;\n  // å­˜å‚¨å¤±è´¥çš„å€¼\n  self.reason = null;\n  // å­˜å‚¨æˆåŠŸçš„å›è°ƒ\n  self.onResolved = [];\n  // å­˜å‚¨å¤±è´¥çš„å›è°ƒ\n  self.onRejected = [];\n  \n  function resolve(value) {\n    // 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜\n    if(self.status === 'pending') {\n      // å­˜ä¸‹æˆåŠŸçš„å€¼\n      self.value = value\n      self.status = 'fulfilled';\n      // æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;\n      self.onResolved.forEach(fn => fn())\n    }\n  }\n  \n  function reject(reason) {\n    // 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜\n    if(self.status === 'pending') {\n      // å­˜ä¸‹å¤±è´¥çš„å€¼\n      self.reason = reason\n      self.status = 'rejected';\n      // æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;\n      self.onRejected.forEach(fn => fn())\n    }\n  }\n  // æ•è·é”™è¯¯ä¼ ç»™rejectã€‚æ³•å¾‹è§„å®šï¼\n\ttry{\n  \texecutor(resolve, reject);\n  } catch(e) {\n    reject(e);\n  }\n}\n\nfunction resolvePromise(promise2, res, resolve, reject) {\n  // å¦‚æœpromise2å’Œç»“æœç›¸åŒï¼Œå°±è‡ªå·±æ— é™å¾ªç¯è°ƒç”¨è‡ªå·±çš„thenäº†ï¼Œæ­»äº¡å¾ªç¯ã€‚\n  // ä¸¾ä¸ªğŸŒ°ï¼švar a = function(){return a}ï¼Œè¿™ä¸ªthenåˆä¼šè‡ªå·±æ— é™è§¦å‘ã€‚æ‰€ä»¥å°±ç©å®Œäº†ã€‚\n  if(promise2 === res) {\n    return reject(new TypeError('å¾ªç¯å¼•ç”¨'))\n  }\n  if(\n    res !== null \n    && (typeof res === 'object') || typeof res === 'function')\n  ) {\n    try {\n      // ä¿å­˜æ˜¯å¦å·²ç»è°ƒç”¨è¿‡å‡½æ•°ã€‚\n      // 2.3.3.3.3 If both resolvePromise and rejectPromise are called, or multiple calls to the same argument are made, the first call takes precedence, and any further calls are ignored.(å¦‚æœ resolvePromise å’Œ rejectPromise å·²ç»è¢«è°ƒç”¨æˆ–ä»¥ç›¸åŒçš„å‚æ•°å¤šæ¬¡è°ƒç”¨çš„è¯å—ï¼Œä¼˜å…ˆç¬¬ä¸€æ¬¡çš„è°ƒç”¨ï¼Œå¹¶ä¸”ä¹‹åçš„è°ƒç”¨å…¨éƒ¨è¢«å¿½ç•¥ï¼ˆé¿å…å¤šæ¬¡è°ƒç”¨ï¼‰)\n      let used = false;\n      \n      // 2.3.3.1ï¼šLet then be x.then. [3.5](æŠŠ x.then èµ‹å€¼ç»™ then å˜é‡)\n      // å¯ä»¥æé˜²æœ‰äººæ¶æã€‚åƒğŸ‘‡\n      // Object.defineProperty(Promise, 'then', {\n      //    get: function(){\n      //        throw Error('error')\n      //    }\n      // })\n      // è¿™æ ·çš„è¯æˆ‘ä»¬å–å€¼å°±ä¼šæŠ¥é”™ã€‚\n      let then = res.then;\n      // å¦‚æœthenæ˜¯å‡½æ•°ï¼Œå°±é»˜è®¤æ˜¯promiseäº†   \n      if(typeof then === 'function') {\n        then.call(\n          res, \n          value => {\n            if(used) {\n              return;\n            }\n            used = true;\n            // é€’å½’è§£æï¼Œç›´åˆ°ä¸æ˜¯ä¸€ä¸ªpromiseä¸ºæ­¢\n            resolvePromise(promise2, value, resolve, reject);\n        \t},\n          reason => {\n            if(used) {\n              return;\n            }\n            used = true;\n            reject(reason);\n          }\n        )\n      }\n    } catch (e) {\n      if(used) {\n        return;\n      }\n      used = true;\n      reject(e);\n    }\n  } else {\n    // å¦‚æœä¸æ˜¯å‡½æ•°æˆ–è€…å¯¹è±¡ä¹Ÿä¸ä¸ºç©ºå°±ç›´æ¥ç»§ç»­ä¼ é€’è¿™ä¸ªå€¼ã€‚\n\t  resolve(res);  \n  }\n}\n\nMyPromise.prototype.then = function(onFulfilled, onRejected){\n  let self = this;\n  // åªæœ‰promiseæ‰å¯ä»¥æŒç»­çš„é“¾å¼è°ƒç”¨then,æ‰€ä»¥è¿™é‡Œå¼„äº†ä¸€ä¸ªæ–°çš„promise\n  let promise2 = new MyPromise((resolve, reject) => {\n    // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n    if(self.status === 'fulfilled') {\n      let res = onFulfilled(self.value);\n      resolvePromise(promise2, res, resolve, reject);\n    }\n    // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n    if(self.status === 'rejected') {\n      let res = onRejected(self.reason);\n      resolvePromise(promise2, res, resolve, reject);\n    }\n    // å¦‚æœæ˜¯pendingåº”è¯¥å­˜å‚¨å½“å‰çš„å›è°ƒå‡½æ•°\n    if(self.status === 'pending') {\n      self.onResolved.push(() => {\n        let res = onFulfilled(self.value);\n      resolvePromise(promise2, res, resolve, reject);\n      })\n      self.onRejected.push(() => {\n        let res = onRejected(self.reason);\n      resolvePromise(promise2, res, resolve, reject);\n      })\n    }\n  })\n}\n```\n\nä»¥ä¸Šå°±æ˜¯ç¬¦åˆ Promise/A+ è§„èŒƒçš„å®ç°äº†ï¼Œå¦‚æœä½ å¯¹äºè¿™éƒ¨åˆ†ä»£ç å°šæœ‰ç–‘é—®ï¼Œæ¬¢è¿åœ¨è¯„è®ºä¸­ä¸æˆ‘äº’åŠ¨ã€‚\n\n## Generator\n\n> é¢è¯•é¢˜ï¼šä»‹ç»ä¸€ä¸‹generatorå§ã€‚\n\nå¾ˆå¤šå°ä¼™ä¼´å¯èƒ½å’Œæˆ‘ä¸€æ ·ï¼Œåªæ˜¯ä¼šç”¨ï¼Œä½†æ˜¯ä½ ç¡¬è¦æˆ‘ä»‹ç»ï¼Œé‚£æˆ‘å’‹æï¼Ÿgeneratorçš„æ‹¼å†™æ˜¯g e n e r a t o rï¼Ÿ\n\nâ€œå“”â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€\n\nå…¶å®æˆ‘é‡æ¸©äº†ä¸€ä¸‹é˜®è€å¸ˆçš„es6è¯¾ç¨‹ï¼Œå‘ç°å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ¥ä»‹ç»ã€‚\n\n- å½¢å¼ä¸Š\n  - generatorå’Œæ™®é€šçš„å‡½æ•°ä¸åŒç‚¹åœ¨äºï¼Œå¯¹ä¸€ä¸ª`*`å·ï¼Œå‡½æ•°å†…éƒ¨ä½¿ç”¨äº†yieldè¡¨è¾¾å¼\n- è¯­æ³•ä¸Š\n  -  Generatorå‡½æ•°å°è£…äº†å¤šä¸ªå†…éƒ¨çŠ¶æ€(é€šè¿‡yieldè¡¨è¾¾å¼å®šä¹‰å†…éƒ¨çŠ¶æ€)ã€‚æ‰§è¡ŒGeneratorå‡½æ•°æ—¶ä¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡(Iteratorå¯¹è±¡)ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒGeneratoræ˜¯éå†å™¨å¯¹è±¡ç”Ÿæˆå‡½æ•°ï¼Œå‡½æ•°å†…éƒ¨å°è£…äº†å¤šä¸ªçŠ¶æ€ã€‚é€šè¿‡è¿”å›çš„Iteratorå¯¹è±¡ï¼Œå¯ä»¥ä¾æ¬¡éå†(è°ƒç”¨nextæ–¹æ³•)Generatorå‡½æ•°çš„æ¯ä¸ªå†…éƒ¨çŠ¶æ€ã€‚\n- è°ƒç”¨ä¸Š\n  -  æ™®é€šå‡½æ•°åœ¨è°ƒç”¨ä¹‹åä¼šç«‹å³æ‰§è¡Œï¼Œè€ŒGeneratorå‡½æ•°è°ƒç”¨ä¹‹åä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯ä¼šè¿”å›éå†å™¨å¯¹è±¡(Iteratorå¯¹è±¡)ã€‚é€šè¿‡Iteratorå¯¹è±¡çš„nextæ–¹æ³•æ¥éå†å†…éƒ¨yieldè¡¨è¾¾å¼å®šä¹‰çš„æ¯ä¸€ä¸ªçŠ¶æ€ã€‚\n\nå…¶å®æˆ‘è§‰å¾—ï¼Œå¦‚æœèƒ½æŠŠä¸‹é¢çš„è¿™ä¸ªæ¡ˆä¾‹å¼„æ¸…æ¥šï¼Œgeneratorå°±ç®—è¿‡å…³äº†ã€‚\n\n```js\nfunction *foo(x) {\n  let y = 2 * (yield (x + 1))\n  let z = yield (y / 3)\n  return (x + y + z)\n}\nlet it = foo(5)\nconsole.log(it.next())   // => {value: 6, done: false}\nconsole.log(it.next(12)) // => {value: 8, done: false}\nconsole.log(it.next(13)) // => {value: 42, done: true}\n```\n\n- é¦–å…ˆ `Generator` å‡½æ•°è°ƒç”¨å’Œæ™®é€šå‡½æ•°ä¸åŒï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªè¿­ä»£å™¨\n- å½“æ‰§è¡Œç¬¬ä¸€æ¬¡ `next` æ—¶ï¼Œä¼ å‚ä¼šè¢«å¿½ç•¥ï¼Œå¹¶ä¸”å‡½æ•°æš‚åœåœ¨ `yield (x + 1)` å¤„ï¼Œæ‰€ä»¥è¿”å› `5 + 1 = 6`\n- å½“æ‰§è¡Œç¬¬äºŒæ¬¡ `next` æ—¶ï¼Œä¼ å…¥çš„å‚æ•°ç­‰äºä¸Šä¸€ä¸ª `yield` çš„è¿”å›å€¼ï¼Œå¦‚æœä½ ä¸ä¼ å‚ï¼Œ`yield` æ°¸è¿œè¿”å› `undefined`ã€‚æ­¤æ—¶ `let y = 2 * 12`ï¼Œæ‰€ä»¥ç¬¬äºŒä¸ª `yield` ç­‰äº `2 * 12 / 3 = 8`\n- å½“æ‰§è¡Œç¬¬ä¸‰æ¬¡ `next` æ—¶ï¼Œä¼ å…¥çš„å‚æ•°ä¼šä¼ é€’ç»™ `z`ï¼Œæ‰€ä»¥ `z = 13, x = 5, y = 24`ï¼Œç›¸åŠ ç­‰äº `42`\n\n## async/await\n\n> ä»€ä¹ˆæ˜¯async/awaitï¼Ÿ\n\nå…¶å®å°±ä¸€å¥è¯ï¼š**async å‡½æ•°å°±æ˜¯ Generator å‡½æ•°çš„è¯­æ³•ç³–ã€‚**\n\ngeneratorï¼š\n\n```js\nvar gen = function* (){\n  var f1 = yield readFile('/etc/fstab');\n  var f2 = yield readFile('/etc/shells');\n  console.log(f1.toString());\n  console.log(f2.toString());\n};\n```\n\nAsync:\n\n```js\nvar asyncReadFile = async function (){\n  var f1 = await readFile('/etc/fstab');\n  var f2 = await readFile('/etc/shells');\n  console.log(f1.toString());\n  console.log(f2.toString());\n};\n```\n\nä¸€æ¯”è¾ƒå°±ä¼šå‘ç°ï¼Œasync å‡½æ•°å°±æ˜¯å°† Generator å‡½æ•°çš„æ˜Ÿå·ï¼ˆ*ï¼‰æ›¿æ¢æˆ asyncï¼Œå°† yield æ›¿æ¢æˆ awaitï¼Œä»…æ­¤è€Œå·²ã€‚\n\nasyncå¯¹generatorè¿›è¡Œäº†ä»¥ä¸‹ä¸‰ç‚¹çš„æ”¹è¿›ï¼š\n\n1. **å†…ç½®æ‰§è¡Œå™¨ã€‚** Generator å‡½æ•°çš„æ‰§è¡Œå¿…é¡»é æ‰§è¡Œå™¨ï¼Œæ‰€ä»¥æ‰æœ‰äº† co å‡½æ•°åº“ï¼Œè€Œ async å‡½æ•°è‡ªå¸¦æ‰§è¡Œå™¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œasync å‡½æ•°çš„æ‰§è¡Œï¼Œä¸æ™®é€šå‡½æ•°ä¸€æ¨¡ä¸€æ ·ï¼Œåªè¦ä¸€è¡Œã€‚\n2. **æ›´å¥½çš„è¯­ä¹‰ã€‚** async å’Œ awaitï¼Œæ¯”èµ·æ˜Ÿå·å’Œ yieldï¼Œè¯­ä¹‰æ›´æ¸…æ¥šäº†ã€‚async è¡¨ç¤ºå‡½æ•°é‡Œæœ‰å¼‚æ­¥æ“ä½œï¼Œawait è¡¨ç¤ºç´§è·Ÿåœ¨åé¢çš„è¡¨è¾¾å¼éœ€è¦ç­‰å¾…ç»“æœã€‚\n3. **æ›´å¹¿çš„é€‚ç”¨æ€§ã€‚** co å‡½æ•°åº“çº¦å®šï¼Œyield å‘½ä»¤åé¢åªèƒ½æ˜¯ Thunk å‡½æ•°æˆ– Promise å¯¹è±¡ï¼Œè€Œ async å‡½æ•°çš„ await å‘½ä»¤åé¢ï¼Œå¯ä»¥è·Ÿ Promise å¯¹è±¡å’ŒåŸå§‹ç±»å‹çš„å€¼ï¼ˆæ•°å€¼ã€å­—ç¬¦ä¸²å’Œå¸ƒå°”å€¼ï¼Œä½†è¿™æ—¶ç­‰åŒäºåŒæ­¥æ“ä½œï¼‰ã€‚\n\nä¸€ä¸ªå‡½æ•°å¦‚æœåŠ ä¸Šäº†asyncï¼Œé‚£ä¹ˆå°±ä¼šé»˜è®¤è¿”å›ä¸€ä¸ªpromise\n\n```js\nasync function fn(args){\n  // ...\n}\n\n// ç­‰åŒäº\n\nfunction fn(args){ \n  return spawn(function*() {\n    // ...\n  }); \n}\n```\n\n### æ³¨æ„\n\nawait å‘½ä»¤åé¢çš„ Promise å¯¹è±¡ï¼Œè¿è¡Œç»“æœå¯èƒ½æ˜¯ rejectedï¼Œæ‰€ä»¥æœ€å¥½æŠŠ await å‘½ä»¤æ”¾åœ¨ try...catch ä»£ç å—ä¸­ã€‚\n\n```js\nasync function myFunction() {\n  try {\n    await somethingThatReturnsAPromise();\n  } catch (err) {\n    console.log(err);\n  }\n}\n\n// å¦ä¸€ç§å†™æ³•\n\nasync function myFunction() {\n  await somethingThatReturnsAPromise().catch(function (err){\n    console.log(err);\n  });\n}\n```\n\nawait å‘½ä»¤åªèƒ½ç”¨åœ¨ async å‡½æ•°ä¹‹ä¸­ï¼Œå¦‚æœç”¨åœ¨æ™®é€šå‡½æ•°ï¼Œå°±ä¼šæŠ¥é”™ã€‚\n\n```js\nasync function dbFuc(db) {\n  let docs = [{}, {}, {}];\n\n  // æŠ¥é”™\n  docs.forEach(function (doc) {\n    await db.post(doc);\n  });\n}\n\n```\n\n\n\n## Reference\n\n> https://es6.ruanyifeng.com/#docs/generator\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","source":"_posts/ã€é‡è¯†å‰ç«¯ã€‘æš´èµ°çš„å¼‚æ­¥ç¼–ç¨‹.md","raw":"---\ntitle: ã€é‡è¯†å‰ç«¯ã€‘æš´èµ°çš„å¼‚æ­¥ç¼–ç¨‹\ndate: 2020-08-28 22:47:09\ntags: [JavaScript]\ncategory: [é‡æ‹¾å‰ç«¯]\ncover: /image/cover/web.jpeg\n---\n\næœ€è¿‘åœ¨å†™ã€é‡æ‹¾å‰ç«¯ã€‘ç³»åˆ—ï¼Œä¸‹é¢æœ‰å‡ ä¸ªå¿«é€Ÿé€šé“ï¼Œå¤§å®¶è‡ªå–\n\n[ã€é‡è¯†å‰ç«¯ã€‘åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿](https://juejin.im/post/6850418113944420359)\n\n[ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—](https://juejin.im/post/6850418117508759566)\n\n[ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this](https://juejin.im/post/6854573215658803208)\n\n[ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šJavaScriptçš„æ‰§è¡Œæœºåˆ¶](https://juejin.im/post/6859911609633767438)\n\n[ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC](https://juejin.im/post/6860375101322461198)\n\n[ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ](https://juejin.im/post/6865204092877144077)\n\n[ã€é‡è¯†å‰ç«¯ã€‘æš´èµ°çš„å¼‚æ­¥ç¼–ç¨‹](https://juejin.im/post/6867814019055484942)\n\n## å‰è¨€\n\nè€è§„çŸ©ï¼Œè¿˜æ˜¯å…ˆäº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯å¼‚æ­¥ã€‚å¼‚æ­¥å…¶å®æ˜¯ä¸€ä¸ªç›¸å¯¹æ¯”è¾ƒé«˜çº§çš„ä¸€ä¸ªæ¦‚å¿µã€‚\n\né€šå¸¸æ¥è¯´ï¼Œç¨‹åºéƒ½æ˜¯é¡ºåºæ‰§è¡Œï¼ŒåŒä¸€æ—¶åˆ»åªä¼šå‘ç”Ÿä¸€ä»¶äº‹ã€‚å¦‚æœä¸€ä¸ªå‡½æ•°ä¾èµ–äºå¦ä¸€ä¸ªå‡½æ•°çš„ç»“æœï¼Œå®ƒåªèƒ½ç­‰å¾…é‚£ä¸ªå‡½æ•°ç»“æŸæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œä»ç”¨æˆ·çš„è§’åº¦æ¥è¯´ï¼Œæ•´ä¸ªç¨‹åºæ‰ç®—è¿è¡Œå®Œæ¯•.\n\nå¦‚æœè¯´ä¸€ä¸ªäº‹æƒ…éœ€è¦ç­‰å¾…ä¸Šä¸€ä»¶äº‹æƒ…åšå®Œæ‰èƒ½åšï¼Œä½†æ˜¯ä»–ä»¬ä¹‹å‰åˆæ²¡æœ‰å¼ºè€¦åˆå…³ç³»ã€‚è¿™æ ·å°±åœ¨é‚£é‡Œå¹²ç­‰å°±æ¯«æ— æ„ä¹‰ã€‚ç‰¹åˆ«æ˜¯ç°åœ¨è®¡ç®—æœºæ™®ééƒ½æœ‰å¤šæ ¸CPUçš„æ—¶ä»£ã€‚\n\nä¸¾ä¸€ä¸ªå½¢è±¡çš„ğŸŒ°ã€‚\n\næˆ‘ä»¬ç°åœ¨è¦å»åƒæµ·åº•æï¼ˆæµ·åº•ææ‰“é’±ï¼ï¼‰ï¼Œæˆ‘ä»¬å‘ç°è¦æ’é˜Ÿï¼Œéœ€è¦æ’2ä¸ªå°æ—¶å·¦å³ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¦å¹²å˜›ï¼Ÿéš¾é“æ˜¯å¹²ç­‰å—ï¼Ÿè‚¯å®šä¸æ˜¯ï¼é‚£æ ·è ¢è ¢çš„ç¡¬ç­‰å¾ˆå‘†ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæ‹¿å‡ºæ‰‹æœºåˆ·åˆ·æœ‹å‹åœˆï¼Œæˆ–è€…ç©ä¸€æŠŠç´§å¼ åˆºæ¿€çš„ç‹è€…è£è€€åˆæˆ–è€…å»çœ‹ä¸€åœºç”µå½±ç­‰ç­‰....åœ¨æˆ‘ä»¬åšè¿™äº›äº‹æƒ…çš„æ—¶å€™æˆ‘ä»¬çš„æ’é˜Ÿå¹¶æ²¡æœ‰è¢«è€½è¯¯ï¼Œç”šè‡³å¯ä»¥å’ŒæœåŠ¡å‘˜è¯´å¿«åˆ°äº†æ‰“ä¸ªç”µè¯ç»™æˆ‘ï¼ˆè¿™ä¸ªæ˜¯å¸¸è§çš„callbackæ–¹æ³•ï¼Œå¾…ä¼šè®¨è®ºï¼‰\n\n> è¿™æ ·ä½ å¯ä»¥åŒæ—¶å®Œæˆå…¶ä»–å·¥ä½œï¼Œè¿™å°±æ˜¯**å¼‚æ­¥ç¼–ç¨‹**çš„å‡ºå‘ç‚¹ã€‚\n\næœ¬æ–‡æ€»ç»“äº†å‡ ä¸ªå¼‚æ­¥çš„æ–¹æ¡ˆï¼Œç†è§£å®ƒä»¬å¯ä»¥è®©ä½ å†™å‡ºç»“æ„æ›´åˆç†ã€æ€§èƒ½æ›´å‡ºè‰²ã€ç»´æŠ¤æ›´æ–¹ä¾¿çš„Javascriptç¨‹åºã€‚\n\n## å¼‚æ­¥callback\n\nä¸Šæ¥å°±æ˜¯ä¸€ä¸ªè‹±ä¿Šçš„ä¾‹å­\n\n```js\nvar response = fetch('myImage.png');\nvar blob = response.blob();\n```\n\næ²¡æœ‰äººå¯ä»¥å®Œç¾é¢„æµ‹åˆ°æ¯ç§ç½‘ç»œæƒ…å†µä¸‹è¿™ä¸ªresponseï¼Œæ˜¯å¦å¯ä»¥å®Œç¾è·å¾—fetchè·å¾—çš„å†…å®¹ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šæŠ¥é”™ã€‚\n\nè¿™ä¸ªæ—¶å€™æˆ‘ä»¬çš„callbackå°±âœ¨bu ling bu lingçš„ç™»åœºå•¦ã€‚\n\næœ‰äº›å°ä¼™ä¼´å¯èƒ½è§‰å¾—callbackä¼¼ä¹å’Œè‡ªå·±æ²¡æœ‰å¤ªå¤§å…³ç³»ã€‚ã€‚ã€‚emmmm....\n\n```js\nbtn.addEventListener('click', () => {\n  alert('You clicked me!');\n});\n```\n\nè¿™æ ·å‘¢ï¼Ÿæœ‰æ²¡æœ‰æ„Ÿè§‰æœ‰ç‚¹å„¿ç†Ÿæ‚‰äº†ï¼Œå…¶ä»–è¿™ä¸ªå°±ç›¸å½“äºreactä¸­çš„\n\n```html\n<div onclick={() =>{alert('You clicked me!');}}>\n\tç‚¹æˆ‘  \n</div>\n```\n\næ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œè¿™ä¸ªå…¶å®å°±æ˜¯æœ€å¸¸è§çš„callbackï¼ˆå›è°ƒå‡½æ•°ï¼‰ã€‚\n\nåˆæˆ–è€…æ¯”è¾ƒå¸¸è§çš„\n\n```js\nsetTimeout(() => {\n\talert('You clicked me!');\n}ï¼Œ2000)\n```\n\nå¾ˆå¸¸è§ï¼Œå¤§è‡´æ„æ€å°±æ˜¯2ç§’é’Ÿä¹‹åä¼šå›è°ƒä¸€ä¸‹è¿™ä¸ªåŒ¿åå‡½æ•°ï¼Œè™½ç„¶ä¸ä¸€å®šä¼šå‡†ç¡®æ‰§è¡Œï¼Œè¿™ä¸ªæ¶‰åŠåˆ°äº‹ä»¶å¾ªç¯ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å»æ‰¾ä¸€ä¸‹æˆ‘å‰é˜µå­å†™çš„äº‹ä»¶å¾ªç¯ğŸ˜Šã€‚\n\n## å‘å¸ƒ-è®¢é˜…æ¨¡å¼\n\nå‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼šåˆç§°ä¸ºè§‚å¯Ÿè€…æ¨¡å¼ï¼Œå®ƒå®šä¹‰å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€æ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å°†å¾—åˆ°é€šçŸ¥ã€‚\n\nåœ¨å†™Reactçš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªéå¸¸éå¸¸éå¸¸å¸¸è§çš„ğŸŒ°ï¼š\n\n```jsx\nimport React, {useState, useEffect} from 'react';\nconst test = () => {\n  const [derrick, setDerrick] = useState(0)\n  useEffect(()=> {\n    console.log(derrick)\n  }, [derrick])\n  return(\n    <button onClick={() => {setDerrick(derrick+1)}}>ç‚¹æˆ‘</button>\n  )\n}\n```\n\nuseEffectè®¢é˜…äº†derrickè¿™ä¸ªå˜é‡çš„å˜åŒ–ï¼Œç„¶åç›‘å¬åˆ°å˜åŒ–ä¹‹åå°±ä¼šè¿›è¡Œä¸€æ¬¡logï¼Œæ‰“å°å‡ºderrickå˜é‡çš„å€¼ã€‚\n\n## Promise\n\n### å›è°ƒæ•‘æ˜Ÿ\n\nä¹‹å‰ä»‹ç»è¿‡å›è°ƒå‡½æ•°è¿™ç§å¼‚æ­¥ç¼–ç¨‹ã€‚\n\nåŠ å…¥æˆ‘å¸Œæœ›åœ¨Aæ‰§è¡Œå®Œä¹‹åæ‰§è¡ŒBï¼Œç„¶åæ‰§è¡ŒCï¼Œç„¶åæ‰§è¡ŒD....æœ€åæ‰§è¡ŒZ\n\nå†™å‡ºæ¥çš„ä»£ç å¯èƒ½æ˜¯è¿™æ ·çš„\n\n```js\nvar sayhello = function (name, callback) {\n  setTimeout(function () {\n    console.log(name);\n    callback();\n  }, 1000);\n}\nsayhello(\"first\", function () {\n  sayhello(\"second\", function () {\n    sayhello(\"third\", function () {\n      console.log(\"end\");\n    });\n  });\n});\n```\n\nåƒæœ¬ä¾‹ä¸€æ ·åµŒå¥—å¤šä¸ªæ–¹æ³•è°ƒç”¨ä¼šåˆ›å»ºé”™ç»¼å¤æ‚çš„ä»£ç ï¼Œä¼šéš¾ä»¥ç†è§£ä¸è°ƒè¯•ã€‚å½“æƒ³è¦å®ç°æ›´å¤ æ‚çš„åŠŸèƒ½æ—¶ï¼Œå›è°ƒå‡½æ•°ä¹Ÿä¼šå­˜åœ¨é—®é¢˜:è‹¥æƒ³è®©ä¸¤ä¸ªå¼‚æ­¥æ“ä½œå¹¶è¡Œè¿è¡Œï¼Œå¹¶ä¸”åœ¨å®ƒä»¬éƒ½ç»“æŸå æé†’ä½ ï¼Œé‚£è¯¥æ€ä¹ˆåš?è‹¥æƒ³åŒæ—¶å¯åŠ¨ä¸¤ä¸ªå¼‚æ­¥æ“ä½œï¼Œä½†åªé‡‡ç”¨é¦–ä¸ªç»“æŸçš„ç»“æœï¼Œé‚£åˆè¯¥æ€ä¹ˆ åš?\n\nåœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œä½ éœ€è¦è¿½è¸ªå¤šä¸ªå›è°ƒå‡½æ•°å¹¶åšæ¸…ç†æ“ä½œï¼Œ ä¸è¿‡å¥½åœ¨promiseæ¨ªç©ºå‡ºä¸–æ‹¯æ•‘äº†ä¸–ç•Œã€‚\n\n### æ¶‰åŠé¢è¯•é¢˜\n\n> promiseç”¨è¿‡å—ï¼Ÿè¯·ä½ ä»‹ç»ä¸€ä¸‹promiseã€‚\n\nå…¶å®è¿™é‡Œå¾ˆå¤šåŒå­¦å¯èƒ½å°±ä¸çŸ¥é“æ€ä¹ˆä»‹ç»äº†ï¼Œå¯èƒ½åªåœç•™åœ¨æ€ä¹ˆç”¨ã€‚æˆ‘ä»¬å¯ä»¥ä»å‡ ä¸ªæ–¹é¢æ¥ä»‹ç»ã€‚\n\n- promiseæ˜¯ä»€ä¹ˆï¼Ÿ\n- promiseè§£å†³äº†ä»€ä¹ˆé—®é¢˜\n- promiseçš„ä¼˜ç¼ºç‚¹\n\n#### promiseæ˜¯ä»€ä¹ˆï¼Ÿ\n\næ‰€è°“`Promise`ï¼Œç®€å•è¯´å°±æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œé‡Œé¢ä¿å­˜ç€æŸä¸ªæœªæ¥æ‰ä¼šç»“æŸçš„äº‹ä»¶ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼‰çš„ç»“æœã€‚ä»è¯­æ³•ä¸Šè¯´ï¼ŒPromise æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä»å®ƒå¯ä»¥è·å–å¼‚æ­¥æ“ä½œçš„æ¶ˆæ¯ã€‚Promise æä¾›ç»Ÿä¸€çš„ APIï¼Œå„ç§å¼‚æ­¥æ“ä½œéƒ½å¯ä»¥ç”¨åŒæ ·çš„æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚\n\n#### promiseè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ\n\n1. è§£å†³å¯è¯»æ€§çš„é—®é¢˜\n2. è§£å†³ä¿¡ä»»é—®é¢˜\n\n##### å¯è¯»æ€§\n\nå¯è¯»æ€§ï¼Œä¹‹å‰çš„å›è°ƒåœ°ç‹±promiseå°±å¯ä»¥ä¼˜é›…çš„è§£å†³ã€‚(è¿˜æœ‰æ›´åŠ ä¼˜é›…çš„ï¼Œå¾…ä¼šä¼šä»‹ç»ã€‚)\n\n```js\nvar sayhello = function (name) {\n  return new Promise(function (resolve, reject) {\n    setTimeout(function () {\n      console.log(name);\n      resolve();ã€€ã€€//åœ¨å¼‚æ­¥æ“ä½œæ‰§è¡Œå®Œåæ‰§è¡Œ resolve() å‡½æ•°\n    }, 10000);\n  });\n}\nsayhello(\"first\").then(function () {\n  return sayhello(\"second\");ã€€ã€€//ä»ç„¶è¿”å›ä¸€ä¸ª Promise å¯¹è±¡\n}).then(function () {\n  return sayhello(\"third\");\n}).then(function () {\n  console.log('end');\n}).catch(function (err) {\n  console.log(err);\n})\n```\n\n##### ä¿¡ä»»é—®é¢˜\n\nè¿™ä¸ªé—®é¢˜å¯ä»¥ç”¨promiseçš„å‡ ä¸ªç‰¹ç‚¹æ¥è§£é‡Šï¼š\n\n> ï¼ˆ1ï¼‰å¯¹è±¡çš„çŠ¶æ€ä¸å—å¤–ç•Œå½±å“ã€‚`Promise`å¯¹è±¡ä»£è¡¨ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œæœ‰ä¸‰ç§çŠ¶æ€ï¼š`pending`ï¼ˆè¿›è¡Œä¸­ï¼‰ã€`fulfilled`ï¼ˆå·²æˆåŠŸï¼‰å’Œ`rejected`ï¼ˆå·²å¤±è´¥ï¼‰ã€‚åªæœ‰å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œå¯ä»¥å†³å®šå½“å‰æ˜¯å“ªä¸€ç§çŠ¶æ€ï¼Œä»»ä½•å…¶ä»–æ“ä½œéƒ½æ— æ³•æ”¹å˜è¿™ä¸ªçŠ¶æ€ã€‚è¿™ä¹Ÿæ˜¯`Promise`è¿™ä¸ªåå­—çš„ç”±æ¥ï¼Œå®ƒçš„è‹±è¯­æ„æ€å°±æ˜¯â€œæ‰¿è¯ºâ€ï¼Œè¡¨ç¤ºå…¶ä»–æ‰‹æ®µæ— æ³•æ”¹å˜ã€‚\n>\n> ï¼ˆ2ï¼‰ä¸€æ—¦çŠ¶æ€æ”¹å˜ï¼Œå°±ä¸ä¼šå†å˜ï¼Œä»»ä½•æ—¶å€™éƒ½å¯ä»¥å¾—åˆ°è¿™ä¸ªç»“æœã€‚`Promise`å¯¹è±¡çš„çŠ¶æ€æ”¹å˜ï¼Œåªæœ‰ä¸¤ç§å¯èƒ½ï¼šä»`pending`å˜ä¸º`fulfilled`å’Œä»`pending`å˜ä¸º`rejected`ã€‚åªè¦è¿™ä¸¤ç§æƒ…å†µå‘ç”Ÿï¼ŒçŠ¶æ€å°±å‡å›ºäº†ï¼Œä¸ä¼šå†å˜äº†ï¼Œä¼šä¸€ç›´ä¿æŒè¿™ä¸ªç»“æœï¼Œè¿™æ—¶å°±ç§°ä¸º resolvedï¼ˆå·²å®šå‹ï¼‰ã€‚å¦‚æœæ”¹å˜å·²ç»å‘ç”Ÿäº†ï¼Œä½ å†å¯¹`Promise`å¯¹è±¡æ·»åŠ å›è°ƒå‡½æ•°ï¼Œä¹Ÿä¼šç«‹å³å¾—åˆ°è¿™ä¸ªç»“æœã€‚è¿™ä¸äº‹ä»¶ï¼ˆEventï¼‰å®Œå…¨ä¸åŒï¼Œäº‹ä»¶çš„ç‰¹ç‚¹æ˜¯ï¼Œå¦‚æœä½ é”™è¿‡äº†å®ƒï¼Œå†å»ç›‘å¬ï¼Œæ˜¯å¾—ä¸åˆ°ç»“æœçš„ã€‚\n\nç”±äºPromiseåªèƒ½è¢«å†³è®®ä¸€æ¬¡ï¼Œä¸”å†³è®®ä¹‹åæ— æ³•æ”¹å˜ï¼Œæ‰€ä»¥ï¼Œå³ä¾¿æ˜¯å¤šæ¬¡å›è°ƒï¼Œä¹Ÿä¸ä¼šå½±å“ç»“æœï¼Œå†³è®®ä¹‹åçš„è°ƒç”¨éƒ½ä¼šè¢«å¿½ç•¥ã€‚\n\n```js\n//ä¿¡ä»»é—®é¢˜æ¼”ç¤º\n\n//å›è°ƒ\nfunction method(cb){\n    setTimeout(function(){\n        cb && cb();\n        //å› ä¸ºæŸäº›bugå¯¼è‡´æŸä¸ªå‡½æ•°å¤šæ‰§è¡Œäº†ä¸€æ¬¡\n        cb && cb();\n    },1000);\n}\n\n//promise\nfunction method2(){\n    return new Promise(resolve=>{\n        setTimeout(function(){\n            resolve();\n            //resolveæˆåŠŸè°ƒç”¨ä¸€æ¬¡ä¹‹åï¼Œåé¢çš„ä¸ä¼šå†æ‰§è¡Œ\n            resolve();\n        },1000);        \n    })\n}\n```\n\næ§åˆ¶åè½¬ã€‚ä½“ç°åœ¨å¯¹äºå‡½æ•°çš„æŠŠæ§ï¼Œæ¯”å¦‚thisç­‰ã€‚\n\n```js\n//å›è°ƒ\nfunction method(cb){\n    setTimeout(function(){\n        cb && cb.call({a:1,b:2});//æ‰§è¡Œå›è°ƒï¼Œä½†æ˜¯æ·»æ²¹åŠ é†‹\n    },1000);\n}\n\n//promise\nfunction method2(){\n    return new Promise(resolve=>{\n        setTimeout(function(){\n            resolve();//è°ƒç”¨çš„resolveéƒ½æ˜¯è‡ªå·±å†™çš„ï¼Œæ”¹å–„äº†æ§åˆ¶åè½¬çš„é—®é¢˜\n        },1000);        \n    })\n}\n```\n\n### æ‰‹æ’•A+è§„èŒƒçš„promise\n\n> é¢è¯•é¢˜ï¼šä½ çŸ¥é“promiseçš„A+è§„èŒƒå—ï¼Ÿï¼ˆæœ¬äººåœ¨æµ©é²¸ç§‘æŠ€è¢«é—®åˆ°çš„ï¼Œå½“æ—¶ç­”çš„æ”¯æ”¯å¾å¾ã€‚ã€‚ã€‚ï¼‰\n\næˆ‘ä½•æ­¢æ˜¯çŸ¥é“ï¼Œæˆ‘ç”šè‡³å¯ä»¥æ‰‹å†™ä¸€ä¸ªç¬¦åˆA+è§„èŒƒçš„promiseï¼\n\nA+è§„èŒƒå¿«é€Ÿå…¥å£ï¼Œ[ç‚¹æˆ‘](https://promisesaplus.com/)\n\n\n\n```js\nfunction MyPromise(executor) {\n  // æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚\n  let self = this;\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  self.status = 'pending';\n  // å­˜å‚¨æˆåŠŸçš„å€¼\n  self.value = null;\n  // å­˜å‚¨å¤±è´¥çš„å€¼\n  self.reason = null;\n  function resolve(value) {\n    // 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜\n    if(self.status === 'pending') {\n      // å­˜ä¸‹æˆåŠŸçš„å€¼\n      self.value = value\n      self.status = 'fulfilled';\n    }\n  }\n  function reject(reason) {\n    // 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜\n    if(self.status === 'pending') {\n      // å­˜ä¸‹å¤±è´¥çš„å€¼\n      self.reason = reason\n      self.status = 'rejected';\n    }\n  }\n  \n  executor(resolve, reject);\n}\n```\n\npromiseé‡Œé¢æœ€éš¾çš„å°±æ˜¯thenäº†ï¼Œæˆ‘ä»¬å¿…é¡»å°†è¿™ä¸ªæ–¹æ³•å†™åœ¨ä»–çš„åŸå‹é“¾ä¸Šé¢ï¼Œå¹¶ä¸”ä»–æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯æˆåŠŸçš„å›è°ƒï¼Œä¸€ä¸ªæ˜¯å¤±è´¥çš„å›è°ƒã€‚\n\nåºŸè¯ä¸å¤šè¯´ï¼Œå¼€å†²ï¼\n\n#### æ”¯æŒå¼‚æ­¥\n\nåœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åŠ ä¸¤ä¸ªå˜é‡ã€‚\n\n```js\nfunction MyPromise(executor) {\n  // æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚\n  let self = this;\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  self.status = 'pending';\n  // å­˜å‚¨æˆåŠŸçš„å€¼\n  self.value = null;\n  // å­˜å‚¨å¤±è´¥çš„å€¼\n  self.reason = null;\n  // å­˜å‚¨æˆåŠŸçš„å›è°ƒ\n  self.onResolved = [];\n  // å­˜å‚¨å¤±è´¥çš„å›è°ƒ\n  self.onRejected = [];\n  \n  function resolve(value) {\n    // 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜\n    if(self.status === 'pending') {\n      // å­˜ä¸‹æˆåŠŸçš„å€¼\n      self.value = value\n      self.status = 'fulfilled';\n    }\n  }\n  \n  function reject(reason) {\n    // 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜\n    if(self.status === 'pending') {\n      // å­˜ä¸‹å¤±è´¥çš„å€¼\n      self.reason = reason\n      self.status = 'rejected';\n    }\n  }\n  \n  executor(resolve, reject);\n}\n```\n\né¢œå€¼é«˜åˆç»†å¿ƒçš„åŒå­¦ä¼šå‘ç°ï¼Œæˆ‘å¤šåŠ äº†ä¸¤ä¸ªå˜é‡ã€‚\n\n```js\n// å­˜å‚¨æˆåŠŸçš„å›è°ƒ\nself.onResolved = [];\n// å­˜å‚¨å¤±è´¥çš„å›è°ƒ\nself.onRejected = [];\n```\n\nè¿™ä¸¤ä¸ªå˜é‡å‘¢ï¼Œä¹Ÿéå¸¸å¥½ç†è§£ï¼Œå°±æ˜¯å­˜å‚¨å›è°ƒçš„ã€‚é‚£ä¹ˆæœ‰ä¸€ä¸ªéå¸¸éå¸¸é‡è¦çš„é—®é¢˜ï¼Œæˆ‘å†™çš„æ—¶å€™ä¹Ÿå›°æ‰°äº†å¥½ä¹…ï¼Œä¸ºä»€ä¹ˆä¸€å®šè¦æ˜¯ä¸€ä¸ªæ•°ç»„å‘¢ï¼Ÿæˆ‘å­˜å‚¨ä¸ºä¸€ä¸ªå‡½æ•°ä¸è¡Œå—ï¼Ÿåˆ°æ—¶å€™æ‰§è¡Œå°±è¡Œå•¦ã€‚ã€‚ã€‚\n\nqsï¼Œå’Œæˆ‘æƒ³ä¸€æ ·çš„å¸…å“¥é“å¥³å¯èƒ½æ¯”è¾ƒå¤šã€‚è¿™é‡Œæˆ‘ç»Ÿä¸€å›å¤ï¼š\n\nå‡å¦‚è¯´ã€‚ä»¥ä¸‹çš„æƒ…å†µå‡ºç°çš„è¯ï¼Œå’‹åŠã€‚\n\n```js\nvar p = new Promise((resolve, reject)=>{\n    setTimeout(()=>{\n        resolve(4)\n    }, 1000)\n})\np.then((res)=>{\n    //4 res\n    console.log(res, 'res')\n})\np.then((res1)=>{\n    //4 res1\n    console.log(res1, 'res1')\n})\n```\n\nè¿™ç§æƒ…å†µå‡ºç°ï¼Œå¦‚æœæˆ‘ä»¬åªæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„`console.log(res, 'res')`è¿™è¾ˆå­éƒ½æ— æ³•é—®ä¸–ï¼Œä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºè¢«åé—¨çš„`console.log(res1, 'res')`ç»™è¦†ç›–äº†å‘€ã€‚å¯¹ä¸å¯¹ï¼Œå¦‚æœè¯´è¿™ä¸ª`resolve`ä»–å»¶è¿Ÿæ‰§è¡Œï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦åšçš„æ˜¯æŠŠ`then`å‡½æ•°ç»™ä¿å­˜ä¸‹æ¥ï¼Œç­‰åˆ°`resolve`è¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œä¾æ¬¡æ‰§è¡Œæˆ‘ä»¬æ‰€æœ‰åˆ›å»ºçš„`then`é‡Œé¢çš„å›è°ƒå‡½æ•°ã€‚\n\nå¬æ‡‚æŒå£°ï¼\n\næ²¡å¬æ‡‚çš„æ¥ç€å¾€ä¸‹çœ‹ï¼Œæˆ‘ä»¬æŠŠå‰©ä½™å·¥ä½œåšå®Œï¼Œç„¶åä¸¾ä¸€ä¸ªä¾‹å­ã€‚é©¬ä¸Šå°±èƒ½æ˜ç™½äº†ã€‚\n\nåˆšåˆšè¯´åˆ°ï¼Œæˆ‘ä»¬è¡¥å……ä¸¤ä¸ªå˜é‡ï¼Œç„¶åå†™ä¸‹æˆ‘ä»¬çš„`then`å‡½æ•°ã€‚\n\n```js\nMyPromise.prototype.then = function(onFulfilled, onRejected){\n  let self = this;\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  if(self.status === 'fulfilled') {\n    onFulfilled(self.value);\n  }\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  if(self.status === 'rejected') {\n    onRejected(self.reason);\n  }\n  // å¦‚æœæ˜¯pendingåº”è¯¥å­˜å‚¨å½“å‰çš„å›è°ƒå‡½æ•°\n  if(self.status === 'pending') {\n    self.onResolved.push(() => {onFulfilled(self.value)})\n    self.onRejected.push(() => {onRejected(self.reason)})\n  }\n}\n```\n\nç„¶åæˆ‘ä»¬è¿˜éœ€è¦åœ¨`resolve`æˆ–è€…`reject`çš„æ—¶å€™æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨èµ·æ¥çš„è¿™äº›å‡½æ•°ã€‚\n\nå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š\n\n```js\nfunction MyPromise(executor) {\n  // æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚\n  let self = this;\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  self.status = 'pending';\n  // å­˜å‚¨æˆåŠŸçš„å€¼\n  self.value = null;\n  // å­˜å‚¨å¤±è´¥çš„å€¼\n  self.reason = null;\n  // å­˜å‚¨æˆåŠŸçš„å›è°ƒ\n  self.onResolved = [];\n  // å­˜å‚¨å¤±è´¥çš„å›è°ƒ\n  self.onRejected = [];\n  \n  function resolve(value) {\n    // 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜\n    if(self.status === 'pending') {\n      // å­˜ä¸‹æˆåŠŸçš„å€¼\n      self.value = value\n      self.status = 'fulfilled';\n      // æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;\n      self.onResolved.forEach(fn => fn())\n    }\n  }\n  \n  function reject(reason) {\n    // 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜\n    if(self.status === 'pending') {\n      // å­˜ä¸‹å¤±è´¥çš„å€¼\n      self.reason = reason\n      self.status = 'rejected';\n      // æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;\n      self.onRejected.forEach(fn => fn())\n    }\n  }\n  \n  executor(resolve, reject);\n}\n\nMyPromise.prototype.then = function(onFulfilled, onRejected){\n  let self = this;\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  if(self.status === 'fulfilled') {\n    onFulfilled(self.value);\n  }\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  if(self.status === 'rejected') {\n    onRejected(self.reason);\n  }\n  // å¦‚æœæ˜¯pendingåº”è¯¥å­˜å‚¨å½“å‰çš„å›è°ƒå‡½æ•°\n  if(self.status === 'pending') {\n    self.onResolved.push(() => {onFulfilled(self.value)})\n    self.onRejected.push(() => {onRejected(self.reason)})\n  }\n}\n```\n\nOKã€‚æˆ‘ä»¬å…ˆè¯•è¯•æˆ‘ä»¬è‡ªå·±å†™çš„promiseã€‚è·‘ä¸€ä¸‹demoå§ã€‚ä¸ºäº†ç»™æ‡’åŒå­¦ä¾¿æ·çš„è°ƒè¯•ï¼Œç›´æ¥CVä¸‹é¢å°±å¥½å•¦ã€‚\n\n```js\nfunction MyPromise(executor) {\n  // æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚\n  let self = this;\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  self.status = 'pending';\n  // å­˜å‚¨æˆåŠŸçš„å€¼\n  self.value = null;\n  // å­˜å‚¨å¤±è´¥çš„å€¼\n  self.reason = null;\n  // å­˜å‚¨æˆåŠŸçš„å›è°ƒ\n  self.onResolved = [];\n  // å­˜å‚¨å¤±è´¥çš„å›è°ƒ\n  self.onRejected = [];\n  \n  function resolve(value) {\n    // 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜\n    if(self.status === 'pending') {\n      // å­˜ä¸‹æˆåŠŸçš„å€¼\n      self.value = value\n      self.status = 'fulfilled';\n      // æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;\n      self.onResolved.forEach(fn => fn())\n    }\n  }\n  \n  function reject(reason) {\n    // 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜\n    if(self.status === 'pending') {\n      // å­˜ä¸‹å¤±è´¥çš„å€¼\n      self.reason = reason\n      self.status = 'rejected';\n      // æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;\n      self.onRejected.forEach(fn => fn())\n    }\n  }\n\n  executor(resolve, reject);\n}\n\nMyPromise.prototype.then = function(onFulfilled, onRejected){\n  let self = this;\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  if(self.status === 'fulfilled') {\n    onFulfilled(self.value);\n  }\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  if(self.status === 'rejected') {\n    onRejected(self.reason);\n  }\n  // å¦‚æœæ˜¯pendingåº”è¯¥å­˜å‚¨å½“å‰çš„å›è°ƒå‡½æ•°\n  if(self.status === 'pending') {\n    self.onResolved.push(() => {\n      onFulfilled(self.value)\n    })\n    self.onRejected.push(() => {\n      onRejected(self.reason)\n    })\n  }\n}\n\nvar p = new MyPromise((resolve, reject)=>{\n  setTimeout(()=>{\n    resolve(4)\n  }, 1000)\n})\np.then((res)=>{\n  //4 res\n  console.log(res, 'res')\n})\np.then((res1)=>{\n  //4 res1\n  console.log(res1, 'res1')\n})\n```\n\nå—¯~å¦‚æ„¿è¾“å‡ºäº†ï¼Œé‚£å›åˆ°åˆšåˆšçš„é—®é¢˜ã€‚æˆ‘ä»¬æŠŠå›è°ƒçš„åœ°æ–¹ä¸è¦ç”¨æ•°ç»„è€Œç”¨å‡½æ•°å‘¢ï¼Ÿä¸ç”¨åŒå­¦ä»¬æ‰“å­—äº†ï¼Œç›´æ¥CVğŸ‘‡çš„ä»£ç å°±å¥½äº†ã€‚\n\n```js\nfunction MyPromise(executor) {\n  // æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚\n  let self = this;\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  self.status = 'pending';\n  // å­˜å‚¨æˆåŠŸçš„å€¼\n  self.value = null;\n  // å­˜å‚¨å¤±è´¥çš„å€¼\n  self.reason = null;\n  // å­˜å‚¨æˆåŠŸçš„å›è°ƒ\n  self.onResolved = [];\n  // å­˜å‚¨å¤±è´¥çš„å›è°ƒ\n  self.onRejected = [];\n  \n  function resolve(value) {\n    // 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜\n    if(self.status === 'pending') {\n      // å­˜ä¸‹æˆåŠŸçš„å€¼\n      self.value = value\n      self.status = 'fulfilled';\n      // æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;\n      self.onResolved.forEach(fn => fn())\n    }\n  }\n  \n  function reject(reason) {\n    // 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜\n    if(self.status === 'pending') {\n      // å­˜ä¸‹å¤±è´¥çš„å€¼\n      self.reason = reason\n      self.status = 'rejected';\n      // æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;\n      self.onRejected.forEach(fn => fn())\n    }\n  }\n\n  executor(resolve, reject);\n}\n\nMyPromise.prototype.then = function(onFulfilled, onRejected){\n  let self = this;\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  if(self.status === 'fulfilled') {\n    onFulfilled(self.value);\n  }\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  if(self.status === 'rejected') {\n    onRejected(self.reason);\n  }\n  // å¦‚æœæ˜¯pendingåº”è¯¥å­˜å‚¨å½“å‰çš„å›è°ƒå‡½æ•°\n  if(self.status === 'pending') {\n    self.onResolved.push(() => {\n      onFulfilled(self.value)\n    })\n    self.onRejected.push(() => {\n      onRejected(self.reason)\n    })\n  }\n}\n\nvar p = new MyPromise((resolve, reject)=>{\n  setTimeout(()=>{\n    resolve(4)\n  }, 1000)\n})\np.then((res)=>{\n  //4 res\n  console.log(res, 'res')\n})\np.then((res1)=>{\n  //4 res1\n  console.log(res1, 'res1')\n})\n```\n\næ˜¯ä¸æ˜¯åªæœ‰`console.log(res1, 'res1')`å•¦ï¼Ÿå› ä¸ºæ‰§è¡Œ`then`çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„resolveè¿˜æœ‰æ²¡æœ‰è¢«è°ƒç”¨ï¼Œå¦‚æœæˆ‘ä»¬æœ‰å¤šä¸ª`then`çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦æŠŠä»–ä»¬å­˜å‚¨èµ·æ¥ï¼Œç„¶åä¾æ¬¡è°ƒç”¨ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨åˆ°æ•°ç»„ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ˜¯åˆ«çš„æ–¹æ³•ï¼Œæ ¸å¿ƒæ€æƒ³å°±æ˜¯æŠŠä»–ä»¬å­˜èµ·æ¥ï¼Œåœ¨éœ€è¦è°ƒç”¨çš„æ—¶å€™è°ƒç”¨ã€‚\n\næ˜¯ä¸æ˜¯å¾ˆå¥½ç†è§£ï¼Ÿï¼ï¼\n\nå¬æ‡‚æŒå£°ï¼\n\nè€Œä¸”A+ä¹Ÿè¦æ±‚äº†ã€‚\n\n> `2.2.6:then` may be called multiple times on the same promise.\n>\n> ï¼ˆpromise çš„ `then` å¯ä»¥é“¾å¼è°ƒç”¨å¤šæ¬¡ï¼‰\n>\n> 2.2.6.1ï¼šIf/when `promise` is fulfilled, all respective `onFulfilled` callbacks must execute in the order of their originating calls to `then`.\n>\n> ï¼ˆå¦‚æœæˆ–å½“ promise è½¬æ€æ˜¯ fulfilled æ—¶ï¼Œæ‰€æœ‰çš„ onFulfilled å›è°ƒå›ä»¥ä»–ä»¬æ³¨å†Œæ—¶çš„é¡ºåºä¾æ¬¡æ‰§è¡Œï¼‰\n>\n> 2.2.6.2ï¼šIf/when `promise` is rejected, all respective `onRejected` callbacks must execute in the order of their originating calls to `then`.\n>\n> ï¼ˆå¦‚æœæˆ–å½“ promise è½¬æ€æ˜¯ rejected æ—¶ï¼Œæ‰€æœ‰çš„ onRejected å›è°ƒå›ä»¥ä»–ä»¬æ³¨å†Œæ—¶çš„é¡ºåºä¾æ¬¡æ‰§è¡Œï¼‰\n\næˆ‘ä»¬å¯¹promiseçš„ç†è§£æ›´è¿›ä¸€æ­¥äº†ã€‚è®°å¾—æŠŠä»£ç æ”¹å›å»ï¼Œç»§ç»­å¾€ä¸‹èµ°ã€‚\n\nåˆšåˆšæˆ‘ä»¬çš„demoè¿˜ä¸å¤Ÿé²æ£’ï¼Œè€Œä¸”æˆ‘ä»¬çš„æµ‹è¯•ç”¨ä¾‹éƒ½æ˜¯å®Œç¾æƒ…å†µä¸‹ã€‚\n\næ¥ä¸‹æ¥è¦å‰‘èµ°åé”‹äº†ã€‚\n\n> A+:\n>\n> 2.2.1ï¼šBoth `onFulfilled` and `onRejected` are optional arguments:\n>\n> ï¼ˆonFulfilled å’Œ onRejected éƒ½æ˜¯å¯é€‰å‚æ•°ï¼šï¼‰\n>\n> 2.2.1.1 If `onFulfilled` is not a function, it must be ignored.\n>\n> ï¼ˆå¦‚æœ onFulfilled ä¸æ˜¯å‡½æ•°ï¼Œå®ƒä¼šè¢«å¿½ç•¥ï¼‰\n>\n> 2.2.1.2 If `onRejected` is not a function, it must be ignored.\n>\n> ï¼ˆå¦‚æœ onRejected ä¸æ˜¯å‡½æ•°ï¼Œå®ƒä¼šè¢«å¿½ç•¥ï¼‰\n>\n> 2.2.7.2: If either `onFulfilled` or `onRejected` throws an exception `e`, `promise2` must be rejected with `e` as the reason.\n>\n> ï¼ˆå¦‚æœ onFulfilled æˆ– onRejected é‡ŒæŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸ï¼Œé‚£ä¹ˆ promise2 å¿…é¡»æ•è·è¿™ä¸ªé”™è¯¯ï¼ˆæ¥å—ä¸€ä¸ª reason å‚æ•°ï¼‰ï¼‰\n\næ‰€ä»¥æˆ‘ä»¬é¦–å…ˆè¦åšçš„å°±æ˜¯ï¼ŒæŠŠé”™è¯¯ç»™æå‰æ•è·ï¼Œç„¶åä¸¢ç»™`reject`\n\nemmm....æ¥ä¸‹æˆ‘è´´ä»£ç éƒ½æ˜¯ä¸€èµ·è´´äº†ï¼Œå› ä¸ºæˆ‘æ€•æœ‰åŒå­¦ä¼šæ‰é˜Ÿï¼Œé‡Œé¢ä¹Ÿä¼šæœ‰ç›¸åº”çš„æ³¨é‡Šå¸®åŠ©ä¼šèµ°ç¥çš„åŒå­¦è·Ÿç´§è¿™è¾†äº”è±å®å…‰ã€‚\n\n```js\nfunction MyPromise(executor) {\n  // æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚\n  let self = this;\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  self.status = 'pending';\n  // å­˜å‚¨æˆåŠŸçš„å€¼\n  self.value = null;\n  // å­˜å‚¨å¤±è´¥çš„å€¼\n  self.reason = null;\n  // å­˜å‚¨æˆåŠŸçš„å›è°ƒ\n  self.onResolved = [];\n  // å­˜å‚¨å¤±è´¥çš„å›è°ƒ\n  self.onRejected = [];\n  \n  function resolve(value) {\n    // 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜\n    if(self.status === 'pending') {\n      // å­˜ä¸‹æˆåŠŸçš„å€¼\n      self.value = value\n      self.status = 'fulfilled';\n      // æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;\n      self.onResolved.forEach(fn => fn())\n    }\n  }\n  \n  function reject(reason) {\n    // 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜\n    if(self.status === 'pending') {\n      // å­˜ä¸‹å¤±è´¥çš„å€¼\n      self.reason = reason\n      self.status = 'rejected';\n      // æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;\n      self.onRejected.forEach(fn => fn())\n    }\n  }\n  // æ•è·é”™è¯¯ä¼ ç»™rejectã€‚æ³•å¾‹è§„å®šï¼\n\ttry{\n  \texecutor(resolve, reject);\n  } catch(e) {\n    reject(e);\n  }\n}\n\nMyPromise.prototype.then = function(onFulfilled, onRejected){\n  let self = this;\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  // å¦‚æœä¸æ˜¯å‡½æ•°å°±å¿½ç•¥ 2.2.1.1\n  if(self.status === 'fulfilled') {\n    typeof onFulfilled === 'function' && onFulfilled(self.value);\n  }\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  if(self.status === 'rejected') {\n    typeof onFulfilled === 'function' && onRejected(self.reason);\n  }\n  // å¦‚æœæ˜¯pendingåº”è¯¥å­˜å‚¨å½“å‰çš„å›è°ƒå‡½æ•°\n  // å¦‚æœä¸æ˜¯å‡½æ•°å°±å¿½ç•¥ 2.2.1.2\n  if(self.status === 'pending') {\n    // å¦‚æœä¸æ˜¯å‡½æ•°å°±å¿½ç•¥ 2.2.1.1\n    typeof onFulfilled === 'function' && self.onResolved.push(() => {\n      onFulfilled(self.value)\n    })\n    // å¦‚æœä¸æ˜¯å‡½æ•°å°±å¿½ç•¥ 2.2.1.2\n    typeof onFulfilled === 'function' && self.onRejected.push(() => {\n      onRejected(self.reason)\n    })\n  }\n}\n```\n\n#### é“¾å¼è°ƒç”¨then\n\nå¼€å§‹å‡†å¤‡è¿›å…¥promiseçš„éš¾ç‚¹ä»¥åŠæ ¸å¿ƒç‚¹ï¼šé“¾å¼è°ƒç”¨ã€‚\n\n> 2.2.7ï¼š`then` must return a promise\n>\n> ï¼ˆthen æ–¹æ³•ä¸€å®šè¿”å›ä¸€ä¸ª promiseï¼‰\n\næˆ‘ä»¬éœ€è¦è¿”å›æ–°çš„promiseçš„è¯ï¼Œå¯ä»¥ç®€å•å®ç°ï¼Œå¿«é€Ÿè¿­ä»£ã€‚\n\n```js\nPromise.prototype.then = function (onFulfilled, onRejected) {\n    let promise2 = new Promise((resolve, reject)=>{\n    })\n    return promise2\n}\n```\n\n> 2.2.7.1ï¼šIf either `onFulfilled` or `onRejected` returns a value `x`, run the Promise Resolution Procedure `[[Resolve]](promise2, x)`.\n>\n> ï¼ˆå¦‚æœ onFulfilled æˆ– onRejected è¿”å›çš„æ˜¯ä¸€ä¸ª xï¼Œé‚£ä¹ˆå®ƒä¼šä»¥[[Resolve]](promise2, x)` å¤„ç†è§£æï¼‰\n>\n> 2.2.7.2ï¼šIf either `onFulfilled` or `onRejected` throws an exception `e`, `promise2` must be rejected with `e` as the reason.\n>\n> ï¼ˆå¦‚æœ onFulfilled æˆ– onRejected é‡ŒæŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸ï¼Œé‚£ä¹ˆ promise2 å¿…é¡»æ•è·è¿™ä¸ªé”™è¯¯ï¼ˆæ¥å—ä¸€ä¸ª reason å‚æ•°ï¼‰ï¼‰\n>\n> 2.2.7.3ï¼šIf `onFulfilled` is not a function and `promise1` is fulfilled, `promise2` must be fulfilled with the same value as `promise1`.\n>\n> ï¼ˆå¦‚æœ onFulfilled ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸” promise1 çŠ¶æ€æ˜¯ fulfilledï¼Œé‚£ä¹ˆ promise2 ä¸€å®šä¼šæ¥å—åˆ°ä¸ promse1 ä¸€æ ·çš„å€¼ valueï¼‰\n>\n> 2.2.7.4ï¼šIf `onRejected` is not a function and `promise1` is rejected, `promise2` must be rejected with the same reason as `promise1`.\n>\n> ï¼ˆå¦‚æœ onRejected ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸” promise1 çŠ¶æ€æ˜¯ rejectedï¼Œpromise2 ä¸€å®šä¼šæ¥å—åˆ°ä¸ promise1 ä¸€æ ·çš„å€¼ reasonï¼‰\n\næˆ‘ä»¬éœ€è¦å°†è¿”å›å†…å®¹promiseåŒ–ï¼Œéœ€è¦å¯¹onFulfilledå’ŒonRejectedè¿›è¡Œé”™è¯¯å¤„ç†ï¼Œè¿™ä¸ªæˆ‘ä»¬ä¹‹å‰å°±å¤„ç†è¿‡äº†ï¼Œå¦‚æœonFulfilledå’ŒonRejectedæ²¡æœ‰ä¼ å‚å°±ç»§ç»­ä¼ é€’ï¼ŒåŸç”ŸğŸŒ°æ¥ï¼š\n\n```js\nvar p = new Promise(function(resolve, reject){\n    setTimeout(function(){\n        resolve(3)\n    }, 1000)\n});\np.then(1,1)\n.then('','')\n.then()\n.then(function(res){\n    //3\n    console.log(res)\n})\n```\n\nè¿™é‡Œä¸ç®¡onFulfilledå’ŒonRejectedä¼ ä»€ä¹ˆå€¼ï¼Œåªè¦ä¸æ˜¯å‡½æ•°ï¼Œå°±ç»§ç»­å‘ä¸‹ä¼ å…¥ï¼Œç›´åˆ°æœ‰å‡½æ•°è¿›è¡Œæ¥æ”¶ï¼›è¦åšçš„äº‹æƒ…å¤ªå¤šäº†ï¼Œä¸å½“å½“æ˜¯åˆ¤æ–­å‡½æ•°è¿™ç§ç®€å•çš„åˆ¤æ–­äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æŠ½ç¦»ä¸€ä¸ªæ–°çš„å‡½æ•°æ¥å¤ç”¨ç»Ÿä¸€å¤„ç†ã€‚å› æ­¤æˆ‘ä»¬è¿›è¡Œå¦‚ä¸‹å®Œå–„ï¼š\n\n```js\nfunction MyPromise(executor) {\n  // æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚\n  let self = this;\n  // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n  self.status = 'pending';\n  // å­˜å‚¨æˆåŠŸçš„å€¼\n  self.value = null;\n  // å­˜å‚¨å¤±è´¥çš„å€¼\n  self.reason = null;\n  // å­˜å‚¨æˆåŠŸçš„å›è°ƒ\n  self.onResolved = [];\n  // å­˜å‚¨å¤±è´¥çš„å›è°ƒ\n  self.onRejected = [];\n  \n  function resolve(value) {\n    // 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜\n    if(self.status === 'pending') {\n      // å­˜ä¸‹æˆåŠŸçš„å€¼\n      self.value = value\n      self.status = 'fulfilled';\n      // æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;\n      self.onResolved.forEach(fn => fn())\n    }\n  }\n  \n  function reject(reason) {\n    // 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜\n    if(self.status === 'pending') {\n      // å­˜ä¸‹å¤±è´¥çš„å€¼\n      self.reason = reason\n      self.status = 'rejected';\n      // æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;\n      self.onRejected.forEach(fn => fn())\n    }\n  }\n  // æ•è·é”™è¯¯ä¼ ç»™rejectã€‚æ³•å¾‹è§„å®šï¼\n\ttry{\n  \texecutor(resolve, reject);\n  } catch(e) {\n    reject(e);\n  }\n}\n\nfunction resolvePromise(promise2, res, resolve, reject) {\n  // å¦‚æœpromise2å’Œç»“æœç›¸åŒï¼Œå°±è‡ªå·±æ— é™å¾ªç¯è°ƒç”¨è‡ªå·±çš„thenäº†ï¼Œæ­»äº¡å¾ªç¯ã€‚\n  // ä¸¾ä¸ªğŸŒ°ï¼švar a = function(){return a}ï¼Œè¿™ä¸ªthenåˆä¼šè‡ªå·±æ— é™è§¦å‘ã€‚æ‰€ä»¥å°±ç©å®Œäº†ã€‚\n  if(promise2 === res) {\n    return reject(new TypeError('å¾ªç¯å¼•ç”¨'))\n  }\n  if(\n    res !== null \n    && (typeof res === 'object') || typeof res === 'function')\n  ) {\n    try {\n      // ä¿å­˜æ˜¯å¦å·²ç»è°ƒç”¨è¿‡å‡½æ•°ã€‚\n      // 2.3.3.3.3 If both resolvePromise and rejectPromise are called, or multiple calls to the same argument are made, the first call takes precedence, and any further calls are ignored.(å¦‚æœ resolvePromise å’Œ rejectPromise å·²ç»è¢«è°ƒç”¨æˆ–ä»¥ç›¸åŒçš„å‚æ•°å¤šæ¬¡è°ƒç”¨çš„è¯å—ï¼Œä¼˜å…ˆç¬¬ä¸€æ¬¡çš„è°ƒç”¨ï¼Œå¹¶ä¸”ä¹‹åçš„è°ƒç”¨å…¨éƒ¨è¢«å¿½ç•¥ï¼ˆé¿å…å¤šæ¬¡è°ƒç”¨ï¼‰)\n      let used = false;\n      \n      // 2.3.3.1ï¼šLet then be x.then. [3.5](æŠŠ x.then èµ‹å€¼ç»™ then å˜é‡)\n      // å¯ä»¥æé˜²æœ‰äººæ¶æã€‚åƒğŸ‘‡\n      // Object.defineProperty(Promise, 'then', {\n      //    get: function(){\n      //        throw Error('error')\n      //    }\n      // })\n      // è¿™æ ·çš„è¯æˆ‘ä»¬å–å€¼å°±ä¼šæŠ¥é”™ã€‚\n      let then = res.then;\n      // å¦‚æœthenæ˜¯å‡½æ•°ï¼Œå°±é»˜è®¤æ˜¯promiseäº†   \n      if(typeof then === 'function') {\n        then.call(\n          res, \n          value => {\n            if(used) {\n              return;\n            }\n            used = true;\n            // é€’å½’è§£æï¼Œç›´åˆ°ä¸æ˜¯ä¸€ä¸ªpromiseä¸ºæ­¢\n            resolvePromise(promise2, value, resolve, reject);\n        \t},\n          reason => {\n            if(used) {\n              return;\n            }\n            used = true;\n            reject(reason);\n          }\n        )\n      }\n    } catch (e) {\n      if(used) {\n        return;\n      }\n      used = true;\n      reject(e);\n    }\n  } else {\n    // å¦‚æœä¸æ˜¯å‡½æ•°æˆ–è€…å¯¹è±¡ä¹Ÿä¸ä¸ºç©ºå°±ç›´æ¥ç»§ç»­ä¼ é€’è¿™ä¸ªå€¼ã€‚\n\t  resolve(res);  \n  }\n}\n\nMyPromise.prototype.then = function(onFulfilled, onRejected){\n  let self = this;\n  // åªæœ‰promiseæ‰å¯ä»¥æŒç»­çš„é“¾å¼è°ƒç”¨then,æ‰€ä»¥è¿™é‡Œå¼„äº†ä¸€ä¸ªæ–°çš„promise\n  let promise2 = new MyPromise((resolve, reject) => {\n    // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n    if(self.status === 'fulfilled') {\n      let res = onFulfilled(self.value);\n      resolvePromise(promise2, res, resolve, reject);\n    }\n    // å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending\n    if(self.status === 'rejected') {\n      let res = onRejected(self.reason);\n      resolvePromise(promise2, res, resolve, reject);\n    }\n    // å¦‚æœæ˜¯pendingåº”è¯¥å­˜å‚¨å½“å‰çš„å›è°ƒå‡½æ•°\n    if(self.status === 'pending') {\n      self.onResolved.push(() => {\n        let res = onFulfilled(self.value);\n      resolvePromise(promise2, res, resolve, reject);\n      })\n      self.onRejected.push(() => {\n        let res = onRejected(self.reason);\n      resolvePromise(promise2, res, resolve, reject);\n      })\n    }\n  })\n}\n```\n\nä»¥ä¸Šå°±æ˜¯ç¬¦åˆ Promise/A+ è§„èŒƒçš„å®ç°äº†ï¼Œå¦‚æœä½ å¯¹äºè¿™éƒ¨åˆ†ä»£ç å°šæœ‰ç–‘é—®ï¼Œæ¬¢è¿åœ¨è¯„è®ºä¸­ä¸æˆ‘äº’åŠ¨ã€‚\n\n## Generator\n\n> é¢è¯•é¢˜ï¼šä»‹ç»ä¸€ä¸‹generatorå§ã€‚\n\nå¾ˆå¤šå°ä¼™ä¼´å¯èƒ½å’Œæˆ‘ä¸€æ ·ï¼Œåªæ˜¯ä¼šç”¨ï¼Œä½†æ˜¯ä½ ç¡¬è¦æˆ‘ä»‹ç»ï¼Œé‚£æˆ‘å’‹æï¼Ÿgeneratorçš„æ‹¼å†™æ˜¯g e n e r a t o rï¼Ÿ\n\nâ€œå“”â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€\n\nå…¶å®æˆ‘é‡æ¸©äº†ä¸€ä¸‹é˜®è€å¸ˆçš„es6è¯¾ç¨‹ï¼Œå‘ç°å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ¥ä»‹ç»ã€‚\n\n- å½¢å¼ä¸Š\n  - generatorå’Œæ™®é€šçš„å‡½æ•°ä¸åŒç‚¹åœ¨äºï¼Œå¯¹ä¸€ä¸ª`*`å·ï¼Œå‡½æ•°å†…éƒ¨ä½¿ç”¨äº†yieldè¡¨è¾¾å¼\n- è¯­æ³•ä¸Š\n  -  Generatorå‡½æ•°å°è£…äº†å¤šä¸ªå†…éƒ¨çŠ¶æ€(é€šè¿‡yieldè¡¨è¾¾å¼å®šä¹‰å†…éƒ¨çŠ¶æ€)ã€‚æ‰§è¡ŒGeneratorå‡½æ•°æ—¶ä¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡(Iteratorå¯¹è±¡)ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒGeneratoræ˜¯éå†å™¨å¯¹è±¡ç”Ÿæˆå‡½æ•°ï¼Œå‡½æ•°å†…éƒ¨å°è£…äº†å¤šä¸ªçŠ¶æ€ã€‚é€šè¿‡è¿”å›çš„Iteratorå¯¹è±¡ï¼Œå¯ä»¥ä¾æ¬¡éå†(è°ƒç”¨nextæ–¹æ³•)Generatorå‡½æ•°çš„æ¯ä¸ªå†…éƒ¨çŠ¶æ€ã€‚\n- è°ƒç”¨ä¸Š\n  -  æ™®é€šå‡½æ•°åœ¨è°ƒç”¨ä¹‹åä¼šç«‹å³æ‰§è¡Œï¼Œè€ŒGeneratorå‡½æ•°è°ƒç”¨ä¹‹åä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯ä¼šè¿”å›éå†å™¨å¯¹è±¡(Iteratorå¯¹è±¡)ã€‚é€šè¿‡Iteratorå¯¹è±¡çš„nextæ–¹æ³•æ¥éå†å†…éƒ¨yieldè¡¨è¾¾å¼å®šä¹‰çš„æ¯ä¸€ä¸ªçŠ¶æ€ã€‚\n\nå…¶å®æˆ‘è§‰å¾—ï¼Œå¦‚æœèƒ½æŠŠä¸‹é¢çš„è¿™ä¸ªæ¡ˆä¾‹å¼„æ¸…æ¥šï¼Œgeneratorå°±ç®—è¿‡å…³äº†ã€‚\n\n```js\nfunction *foo(x) {\n  let y = 2 * (yield (x + 1))\n  let z = yield (y / 3)\n  return (x + y + z)\n}\nlet it = foo(5)\nconsole.log(it.next())   // => {value: 6, done: false}\nconsole.log(it.next(12)) // => {value: 8, done: false}\nconsole.log(it.next(13)) // => {value: 42, done: true}\n```\n\n- é¦–å…ˆ `Generator` å‡½æ•°è°ƒç”¨å’Œæ™®é€šå‡½æ•°ä¸åŒï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªè¿­ä»£å™¨\n- å½“æ‰§è¡Œç¬¬ä¸€æ¬¡ `next` æ—¶ï¼Œä¼ å‚ä¼šè¢«å¿½ç•¥ï¼Œå¹¶ä¸”å‡½æ•°æš‚åœåœ¨ `yield (x + 1)` å¤„ï¼Œæ‰€ä»¥è¿”å› `5 + 1 = 6`\n- å½“æ‰§è¡Œç¬¬äºŒæ¬¡ `next` æ—¶ï¼Œä¼ å…¥çš„å‚æ•°ç­‰äºä¸Šä¸€ä¸ª `yield` çš„è¿”å›å€¼ï¼Œå¦‚æœä½ ä¸ä¼ å‚ï¼Œ`yield` æ°¸è¿œè¿”å› `undefined`ã€‚æ­¤æ—¶ `let y = 2 * 12`ï¼Œæ‰€ä»¥ç¬¬äºŒä¸ª `yield` ç­‰äº `2 * 12 / 3 = 8`\n- å½“æ‰§è¡Œç¬¬ä¸‰æ¬¡ `next` æ—¶ï¼Œä¼ å…¥çš„å‚æ•°ä¼šä¼ é€’ç»™ `z`ï¼Œæ‰€ä»¥ `z = 13, x = 5, y = 24`ï¼Œç›¸åŠ ç­‰äº `42`\n\n## async/await\n\n> ä»€ä¹ˆæ˜¯async/awaitï¼Ÿ\n\nå…¶å®å°±ä¸€å¥è¯ï¼š**async å‡½æ•°å°±æ˜¯ Generator å‡½æ•°çš„è¯­æ³•ç³–ã€‚**\n\ngeneratorï¼š\n\n```js\nvar gen = function* (){\n  var f1 = yield readFile('/etc/fstab');\n  var f2 = yield readFile('/etc/shells');\n  console.log(f1.toString());\n  console.log(f2.toString());\n};\n```\n\nAsync:\n\n```js\nvar asyncReadFile = async function (){\n  var f1 = await readFile('/etc/fstab');\n  var f2 = await readFile('/etc/shells');\n  console.log(f1.toString());\n  console.log(f2.toString());\n};\n```\n\nä¸€æ¯”è¾ƒå°±ä¼šå‘ç°ï¼Œasync å‡½æ•°å°±æ˜¯å°† Generator å‡½æ•°çš„æ˜Ÿå·ï¼ˆ*ï¼‰æ›¿æ¢æˆ asyncï¼Œå°† yield æ›¿æ¢æˆ awaitï¼Œä»…æ­¤è€Œå·²ã€‚\n\nasyncå¯¹generatorè¿›è¡Œäº†ä»¥ä¸‹ä¸‰ç‚¹çš„æ”¹è¿›ï¼š\n\n1. **å†…ç½®æ‰§è¡Œå™¨ã€‚** Generator å‡½æ•°çš„æ‰§è¡Œå¿…é¡»é æ‰§è¡Œå™¨ï¼Œæ‰€ä»¥æ‰æœ‰äº† co å‡½æ•°åº“ï¼Œè€Œ async å‡½æ•°è‡ªå¸¦æ‰§è¡Œå™¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œasync å‡½æ•°çš„æ‰§è¡Œï¼Œä¸æ™®é€šå‡½æ•°ä¸€æ¨¡ä¸€æ ·ï¼Œåªè¦ä¸€è¡Œã€‚\n2. **æ›´å¥½çš„è¯­ä¹‰ã€‚** async å’Œ awaitï¼Œæ¯”èµ·æ˜Ÿå·å’Œ yieldï¼Œè¯­ä¹‰æ›´æ¸…æ¥šäº†ã€‚async è¡¨ç¤ºå‡½æ•°é‡Œæœ‰å¼‚æ­¥æ“ä½œï¼Œawait è¡¨ç¤ºç´§è·Ÿåœ¨åé¢çš„è¡¨è¾¾å¼éœ€è¦ç­‰å¾…ç»“æœã€‚\n3. **æ›´å¹¿çš„é€‚ç”¨æ€§ã€‚** co å‡½æ•°åº“çº¦å®šï¼Œyield å‘½ä»¤åé¢åªèƒ½æ˜¯ Thunk å‡½æ•°æˆ– Promise å¯¹è±¡ï¼Œè€Œ async å‡½æ•°çš„ await å‘½ä»¤åé¢ï¼Œå¯ä»¥è·Ÿ Promise å¯¹è±¡å’ŒåŸå§‹ç±»å‹çš„å€¼ï¼ˆæ•°å€¼ã€å­—ç¬¦ä¸²å’Œå¸ƒå°”å€¼ï¼Œä½†è¿™æ—¶ç­‰åŒäºåŒæ­¥æ“ä½œï¼‰ã€‚\n\nä¸€ä¸ªå‡½æ•°å¦‚æœåŠ ä¸Šäº†asyncï¼Œé‚£ä¹ˆå°±ä¼šé»˜è®¤è¿”å›ä¸€ä¸ªpromise\n\n```js\nasync function fn(args){\n  // ...\n}\n\n// ç­‰åŒäº\n\nfunction fn(args){ \n  return spawn(function*() {\n    // ...\n  }); \n}\n```\n\n### æ³¨æ„\n\nawait å‘½ä»¤åé¢çš„ Promise å¯¹è±¡ï¼Œè¿è¡Œç»“æœå¯èƒ½æ˜¯ rejectedï¼Œæ‰€ä»¥æœ€å¥½æŠŠ await å‘½ä»¤æ”¾åœ¨ try...catch ä»£ç å—ä¸­ã€‚\n\n```js\nasync function myFunction() {\n  try {\n    await somethingThatReturnsAPromise();\n  } catch (err) {\n    console.log(err);\n  }\n}\n\n// å¦ä¸€ç§å†™æ³•\n\nasync function myFunction() {\n  await somethingThatReturnsAPromise().catch(function (err){\n    console.log(err);\n  });\n}\n```\n\nawait å‘½ä»¤åªèƒ½ç”¨åœ¨ async å‡½æ•°ä¹‹ä¸­ï¼Œå¦‚æœç”¨åœ¨æ™®é€šå‡½æ•°ï¼Œå°±ä¼šæŠ¥é”™ã€‚\n\n```js\nasync function dbFuc(db) {\n  let docs = [{}, {}, {}];\n\n  // æŠ¥é”™\n  docs.forEach(function (doc) {\n    await db.post(doc);\n  });\n}\n\n```\n\n\n\n## Reference\n\n> https://es6.ruanyifeng.com/#docs/generator\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","slug":"ã€é‡è¯†å‰ç«¯ã€‘æš´èµ°çš„å¼‚æ­¥ç¼–ç¨‹","published":1,"updated":"2021-06-24T14:00:06.853Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra8t0028lwrd3exr9n33","content":"<p>æœ€è¿‘åœ¨å†™ã€é‡æ‹¾å‰ç«¯ã€‘ç³»åˆ—ï¼Œä¸‹é¢æœ‰å‡ ä¸ªå¿«é€Ÿé€šé“ï¼Œå¤§å®¶è‡ªå–</p>\n<p><a href=\"https://juejin.im/post/6850418113944420359\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿</a></p>\n<p><a href=\"https://juejin.im/post/6850418117508759566\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—</a></p>\n<p><a href=\"https://juejin.im/post/6854573215658803208\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this</a></p>\n<p><a href=\"https://juejin.im/post/6859911609633767438\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šJavaScriptçš„æ‰§è¡Œæœºåˆ¶</a></p>\n<p><a href=\"https://juejin.im/post/6860375101322461198\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC</a></p>\n<p><a href=\"https://juejin.im/post/6865204092877144077\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ</a></p>\n<p><a href=\"https://juejin.im/post/6867814019055484942\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘æš´èµ°çš„å¼‚æ­¥ç¼–ç¨‹</a></p>\n<h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><p>è€è§„çŸ©ï¼Œè¿˜æ˜¯å…ˆäº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯å¼‚æ­¥ã€‚å¼‚æ­¥å…¶å®æ˜¯ä¸€ä¸ªç›¸å¯¹æ¯”è¾ƒé«˜çº§çš„ä¸€ä¸ªæ¦‚å¿µã€‚</p>\n<p>é€šå¸¸æ¥è¯´ï¼Œç¨‹åºéƒ½æ˜¯é¡ºåºæ‰§è¡Œï¼ŒåŒä¸€æ—¶åˆ»åªä¼šå‘ç”Ÿä¸€ä»¶äº‹ã€‚å¦‚æœä¸€ä¸ªå‡½æ•°ä¾èµ–äºå¦ä¸€ä¸ªå‡½æ•°çš„ç»“æœï¼Œå®ƒåªèƒ½ç­‰å¾…é‚£ä¸ªå‡½æ•°ç»“æŸæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œä»ç”¨æˆ·çš„è§’åº¦æ¥è¯´ï¼Œæ•´ä¸ªç¨‹åºæ‰ç®—è¿è¡Œå®Œæ¯•.</p>\n<p>å¦‚æœè¯´ä¸€ä¸ªäº‹æƒ…éœ€è¦ç­‰å¾…ä¸Šä¸€ä»¶äº‹æƒ…åšå®Œæ‰èƒ½åšï¼Œä½†æ˜¯ä»–ä»¬ä¹‹å‰åˆæ²¡æœ‰å¼ºè€¦åˆå…³ç³»ã€‚è¿™æ ·å°±åœ¨é‚£é‡Œå¹²ç­‰å°±æ¯«æ— æ„ä¹‰ã€‚ç‰¹åˆ«æ˜¯ç°åœ¨è®¡ç®—æœºæ™®ééƒ½æœ‰å¤šæ ¸CPUçš„æ—¶ä»£ã€‚</p>\n<p>ä¸¾ä¸€ä¸ªå½¢è±¡çš„ğŸŒ°ã€‚</p>\n<p>æˆ‘ä»¬ç°åœ¨è¦å»åƒæµ·åº•æï¼ˆæµ·åº•ææ‰“é’±ï¼ï¼‰ï¼Œæˆ‘ä»¬å‘ç°è¦æ’é˜Ÿï¼Œéœ€è¦æ’2ä¸ªå°æ—¶å·¦å³ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¦å¹²å˜›ï¼Ÿéš¾é“æ˜¯å¹²ç­‰å—ï¼Ÿè‚¯å®šä¸æ˜¯ï¼é‚£æ ·è ¢è ¢çš„ç¡¬ç­‰å¾ˆå‘†ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæ‹¿å‡ºæ‰‹æœºåˆ·åˆ·æœ‹å‹åœˆï¼Œæˆ–è€…ç©ä¸€æŠŠç´§å¼ åˆºæ¿€çš„ç‹è€…è£è€€åˆæˆ–è€…å»çœ‹ä¸€åœºç”µå½±ç­‰ç­‰â€¦.åœ¨æˆ‘ä»¬åšè¿™äº›äº‹æƒ…çš„æ—¶å€™æˆ‘ä»¬çš„æ’é˜Ÿå¹¶æ²¡æœ‰è¢«è€½è¯¯ï¼Œç”šè‡³å¯ä»¥å’ŒæœåŠ¡å‘˜è¯´å¿«åˆ°äº†æ‰“ä¸ªç”µè¯ç»™æˆ‘ï¼ˆè¿™ä¸ªæ˜¯å¸¸è§çš„callbackæ–¹æ³•ï¼Œå¾…ä¼šè®¨è®ºï¼‰</p>\n<blockquote>\n<p>è¿™æ ·ä½ å¯ä»¥åŒæ—¶å®Œæˆå…¶ä»–å·¥ä½œï¼Œè¿™å°±æ˜¯<strong>å¼‚æ­¥ç¼–ç¨‹</strong>çš„å‡ºå‘ç‚¹ã€‚</p>\n</blockquote>\n<p>æœ¬æ–‡æ€»ç»“äº†å‡ ä¸ªå¼‚æ­¥çš„æ–¹æ¡ˆï¼Œç†è§£å®ƒä»¬å¯ä»¥è®©ä½ å†™å‡ºç»“æ„æ›´åˆç†ã€æ€§èƒ½æ›´å‡ºè‰²ã€ç»´æŠ¤æ›´æ–¹ä¾¿çš„Javascriptç¨‹åºã€‚</p>\n<h2 id=\"å¼‚æ­¥callback\"><a href=\"#å¼‚æ­¥callback\" class=\"headerlink\" title=\"å¼‚æ­¥callback\"></a>å¼‚æ­¥callback</h2><p>ä¸Šæ¥å°±æ˜¯ä¸€ä¸ªè‹±ä¿Šçš„ä¾‹å­</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> response = fetch(<span class=\"string\">'myImage.png'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> blob = response.blob();</span><br></pre></td></tr></table></figure>\n\n<p>æ²¡æœ‰äººå¯ä»¥å®Œç¾é¢„æµ‹åˆ°æ¯ç§ç½‘ç»œæƒ…å†µä¸‹è¿™ä¸ªresponseï¼Œæ˜¯å¦å¯ä»¥å®Œç¾è·å¾—fetchè·å¾—çš„å†…å®¹ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šæŠ¥é”™ã€‚</p>\n<p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬çš„callbackå°±âœ¨bu ling bu lingçš„ç™»åœºå•¦ã€‚</p>\n<p>æœ‰äº›å°ä¼™ä¼´å¯èƒ½è§‰å¾—callbackä¼¼ä¹å’Œè‡ªå·±æ²¡æœ‰å¤ªå¤§å…³ç³»ã€‚ã€‚ã€‚emmmmâ€¦.</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">btn.addEventListener(<span class=\"string\">'click'</span>, () =&gt; &#123;</span><br><span class=\"line\">  alert(<span class=\"string\">'You clicked me!'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>è¿™æ ·å‘¢ï¼Ÿæœ‰æ²¡æœ‰æ„Ÿè§‰æœ‰ç‚¹å„¿ç†Ÿæ‚‰äº†ï¼Œå…¶ä»–è¿™ä¸ªå°±ç›¸å½“äºreactä¸­çš„</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">onclick</span>=<span class=\"string\">&#123;()</span> =&gt;</span>&#123;alert('You clicked me!');&#125;&#125;&gt;</span><br><span class=\"line\">\tç‚¹æˆ‘  </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>æ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œè¿™ä¸ªå…¶å®å°±æ˜¯æœ€å¸¸è§çš„callbackï¼ˆå›è°ƒå‡½æ•°ï¼‰ã€‚</p>\n<p>åˆæˆ–è€…æ¯”è¾ƒå¸¸è§çš„</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">\talert(<span class=\"string\">'You clicked me!'</span>);</span><br><span class=\"line\">&#125;ï¼Œ<span class=\"number\">2000</span>)</span><br></pre></td></tr></table></figure>\n\n<p>å¾ˆå¸¸è§ï¼Œå¤§è‡´æ„æ€å°±æ˜¯2ç§’é’Ÿä¹‹åä¼šå›è°ƒä¸€ä¸‹è¿™ä¸ªåŒ¿åå‡½æ•°ï¼Œè™½ç„¶ä¸ä¸€å®šä¼šå‡†ç¡®æ‰§è¡Œï¼Œè¿™ä¸ªæ¶‰åŠåˆ°äº‹ä»¶å¾ªç¯ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å»æ‰¾ä¸€ä¸‹æˆ‘å‰é˜µå­å†™çš„äº‹ä»¶å¾ªç¯ğŸ˜Šã€‚</p>\n<h2 id=\"å‘å¸ƒ-è®¢é˜…æ¨¡å¼\"><a href=\"#å‘å¸ƒ-è®¢é˜…æ¨¡å¼\" class=\"headerlink\" title=\"å‘å¸ƒ-è®¢é˜…æ¨¡å¼\"></a>å‘å¸ƒ-è®¢é˜…æ¨¡å¼</h2><p>å‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼šåˆç§°ä¸ºè§‚å¯Ÿè€…æ¨¡å¼ï¼Œå®ƒå®šä¹‰å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€æ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å°†å¾—åˆ°é€šçŸ¥ã€‚</p>\n<p>åœ¨å†™Reactçš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªéå¸¸éå¸¸éå¸¸å¸¸è§çš„ğŸŒ°ï¼š</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123;useState, useEffect&#125; <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> test = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [derrick, setDerrick] = useState(<span class=\"number\">0</span>)</span><br><span class=\"line\">  useEffect(<span class=\"function\"><span class=\"params\">()</span>=&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(derrick)</span><br><span class=\"line\">  &#125;, [derrick])</span><br><span class=\"line\">  <span class=\"keyword\">return</span>(</span><br><span class=\"line\">    &lt;button onClick=&#123;() =&gt; &#123;setDerrick(derrick+<span class=\"number\">1</span>)&#125;&#125;&gt;ç‚¹æˆ‘&lt;<span class=\"regexp\">/button&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  )</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>useEffectè®¢é˜…äº†derrickè¿™ä¸ªå˜é‡çš„å˜åŒ–ï¼Œç„¶åç›‘å¬åˆ°å˜åŒ–ä¹‹åå°±ä¼šè¿›è¡Œä¸€æ¬¡logï¼Œæ‰“å°å‡ºderrickå˜é‡çš„å€¼ã€‚</p>\n<h2 id=\"Promise\"><a href=\"#Promise\" class=\"headerlink\" title=\"Promise\"></a>Promise</h2><h3 id=\"å›è°ƒæ•‘æ˜Ÿ\"><a href=\"#å›è°ƒæ•‘æ˜Ÿ\" class=\"headerlink\" title=\"å›è°ƒæ•‘æ˜Ÿ\"></a>å›è°ƒæ•‘æ˜Ÿ</h3><p>ä¹‹å‰ä»‹ç»è¿‡å›è°ƒå‡½æ•°è¿™ç§å¼‚æ­¥ç¼–ç¨‹ã€‚</p>\n<p>åŠ å…¥æˆ‘å¸Œæœ›åœ¨Aæ‰§è¡Œå®Œä¹‹åæ‰§è¡ŒBï¼Œç„¶åæ‰§è¡ŒCï¼Œç„¶åæ‰§è¡ŒDâ€¦.æœ€åæ‰§è¡ŒZ</p>\n<p>å†™å‡ºæ¥çš„ä»£ç å¯èƒ½æ˜¯è¿™æ ·çš„</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> sayhello = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">name, callback</span>) </span>&#123;</span><br><span class=\"line\">  setTimeout(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(name);</span><br><span class=\"line\">    callback();</span><br><span class=\"line\">  &#125;, <span class=\"number\">1000</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">sayhello(<span class=\"string\">\"first\"</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  sayhello(<span class=\"string\">\"second\"</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    sayhello(<span class=\"string\">\"third\"</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">\"end\"</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>åƒæœ¬ä¾‹ä¸€æ ·åµŒå¥—å¤šä¸ªæ–¹æ³•è°ƒç”¨ä¼šåˆ›å»ºé”™ç»¼å¤æ‚çš„ä»£ç ï¼Œä¼šéš¾ä»¥ç†è§£ä¸è°ƒè¯•ã€‚å½“æƒ³è¦å®ç°æ›´å¤ æ‚çš„åŠŸèƒ½æ—¶ï¼Œå›è°ƒå‡½æ•°ä¹Ÿä¼šå­˜åœ¨é—®é¢˜:è‹¥æƒ³è®©ä¸¤ä¸ªå¼‚æ­¥æ“ä½œå¹¶è¡Œè¿è¡Œï¼Œå¹¶ä¸”åœ¨å®ƒä»¬éƒ½ç»“æŸå æé†’ä½ ï¼Œé‚£è¯¥æ€ä¹ˆåš?è‹¥æƒ³åŒæ—¶å¯åŠ¨ä¸¤ä¸ªå¼‚æ­¥æ“ä½œï¼Œä½†åªé‡‡ç”¨é¦–ä¸ªç»“æŸçš„ç»“æœï¼Œé‚£åˆè¯¥æ€ä¹ˆ åš?</p>\n<p>åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œä½ éœ€è¦è¿½è¸ªå¤šä¸ªå›è°ƒå‡½æ•°å¹¶åšæ¸…ç†æ“ä½œï¼Œ ä¸è¿‡å¥½åœ¨promiseæ¨ªç©ºå‡ºä¸–æ‹¯æ•‘äº†ä¸–ç•Œã€‚</p>\n<h3 id=\"æ¶‰åŠé¢è¯•é¢˜\"><a href=\"#æ¶‰åŠé¢è¯•é¢˜\" class=\"headerlink\" title=\"æ¶‰åŠé¢è¯•é¢˜\"></a>æ¶‰åŠé¢è¯•é¢˜</h3><blockquote>\n<p>promiseç”¨è¿‡å—ï¼Ÿè¯·ä½ ä»‹ç»ä¸€ä¸‹promiseã€‚</p>\n</blockquote>\n<p>å…¶å®è¿™é‡Œå¾ˆå¤šåŒå­¦å¯èƒ½å°±ä¸çŸ¥é“æ€ä¹ˆä»‹ç»äº†ï¼Œå¯èƒ½åªåœç•™åœ¨æ€ä¹ˆç”¨ã€‚æˆ‘ä»¬å¯ä»¥ä»å‡ ä¸ªæ–¹é¢æ¥ä»‹ç»ã€‚</p>\n<ul>\n<li>promiseæ˜¯ä»€ä¹ˆï¼Ÿ</li>\n<li>promiseè§£å†³äº†ä»€ä¹ˆé—®é¢˜</li>\n<li>promiseçš„ä¼˜ç¼ºç‚¹</li>\n</ul>\n<h4 id=\"promiseæ˜¯ä»€ä¹ˆï¼Ÿ\"><a href=\"#promiseæ˜¯ä»€ä¹ˆï¼Ÿ\" class=\"headerlink\" title=\"promiseæ˜¯ä»€ä¹ˆï¼Ÿ\"></a>promiseæ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>æ‰€è°“<code>Promise</code>ï¼Œç®€å•è¯´å°±æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œé‡Œé¢ä¿å­˜ç€æŸä¸ªæœªæ¥æ‰ä¼šç»“æŸçš„äº‹ä»¶ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼‰çš„ç»“æœã€‚ä»è¯­æ³•ä¸Šè¯´ï¼ŒPromise æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä»å®ƒå¯ä»¥è·å–å¼‚æ­¥æ“ä½œçš„æ¶ˆæ¯ã€‚Promise æä¾›ç»Ÿä¸€çš„ APIï¼Œå„ç§å¼‚æ­¥æ“ä½œéƒ½å¯ä»¥ç”¨åŒæ ·çš„æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚</p>\n<h4 id=\"promiseè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ\"><a href=\"#promiseè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ\" class=\"headerlink\" title=\"promiseè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ\"></a>promiseè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h4><ol>\n<li>è§£å†³å¯è¯»æ€§çš„é—®é¢˜</li>\n<li>è§£å†³ä¿¡ä»»é—®é¢˜</li>\n</ol>\n<h5 id=\"å¯è¯»æ€§\"><a href=\"#å¯è¯»æ€§\" class=\"headerlink\" title=\"å¯è¯»æ€§\"></a>å¯è¯»æ€§</h5><p>å¯è¯»æ€§ï¼Œä¹‹å‰çš„å›è°ƒåœ°ç‹±promiseå°±å¯ä»¥ä¼˜é›…çš„è§£å†³ã€‚(è¿˜æœ‰æ›´åŠ ä¼˜é›…çš„ï¼Œå¾…ä¼šä¼šä»‹ç»ã€‚)</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> sayhello = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(name);</span><br><span class=\"line\">      resolve();ã€€ã€€<span class=\"comment\">//åœ¨å¼‚æ­¥æ“ä½œæ‰§è¡Œå®Œåæ‰§è¡Œ resolve() å‡½æ•°</span></span><br><span class=\"line\">    &#125;, <span class=\"number\">10000</span>);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">sayhello(<span class=\"string\">\"first\"</span>).then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> sayhello(<span class=\"string\">\"second\"</span>);ã€€ã€€<span class=\"comment\">//ä»ç„¶è¿”å›ä¸€ä¸ª Promise å¯¹è±¡</span></span><br><span class=\"line\">&#125;).then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> sayhello(<span class=\"string\">\"third\"</span>);</span><br><span class=\"line\">&#125;).then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'end'</span>);</span><br><span class=\"line\">&#125;).catch(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(err);</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"ä¿¡ä»»é—®é¢˜\"><a href=\"#ä¿¡ä»»é—®é¢˜\" class=\"headerlink\" title=\"ä¿¡ä»»é—®é¢˜\"></a>ä¿¡ä»»é—®é¢˜</h5><p>è¿™ä¸ªé—®é¢˜å¯ä»¥ç”¨promiseçš„å‡ ä¸ªç‰¹ç‚¹æ¥è§£é‡Šï¼š</p>\n<blockquote>\n<p>ï¼ˆ1ï¼‰å¯¹è±¡çš„çŠ¶æ€ä¸å—å¤–ç•Œå½±å“ã€‚<code>Promise</code>å¯¹è±¡ä»£è¡¨ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œæœ‰ä¸‰ç§çŠ¶æ€ï¼š<code>pending</code>ï¼ˆè¿›è¡Œä¸­ï¼‰ã€<code>fulfilled</code>ï¼ˆå·²æˆåŠŸï¼‰å’Œ<code>rejected</code>ï¼ˆå·²å¤±è´¥ï¼‰ã€‚åªæœ‰å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œå¯ä»¥å†³å®šå½“å‰æ˜¯å“ªä¸€ç§çŠ¶æ€ï¼Œä»»ä½•å…¶ä»–æ“ä½œéƒ½æ— æ³•æ”¹å˜è¿™ä¸ªçŠ¶æ€ã€‚è¿™ä¹Ÿæ˜¯<code>Promise</code>è¿™ä¸ªåå­—çš„ç”±æ¥ï¼Œå®ƒçš„è‹±è¯­æ„æ€å°±æ˜¯â€œæ‰¿è¯ºâ€ï¼Œè¡¨ç¤ºå…¶ä»–æ‰‹æ®µæ— æ³•æ”¹å˜ã€‚</p>\n<p>ï¼ˆ2ï¼‰ä¸€æ—¦çŠ¶æ€æ”¹å˜ï¼Œå°±ä¸ä¼šå†å˜ï¼Œä»»ä½•æ—¶å€™éƒ½å¯ä»¥å¾—åˆ°è¿™ä¸ªç»“æœã€‚<code>Promise</code>å¯¹è±¡çš„çŠ¶æ€æ”¹å˜ï¼Œåªæœ‰ä¸¤ç§å¯èƒ½ï¼šä»<code>pending</code>å˜ä¸º<code>fulfilled</code>å’Œä»<code>pending</code>å˜ä¸º<code>rejected</code>ã€‚åªè¦è¿™ä¸¤ç§æƒ…å†µå‘ç”Ÿï¼ŒçŠ¶æ€å°±å‡å›ºäº†ï¼Œä¸ä¼šå†å˜äº†ï¼Œä¼šä¸€ç›´ä¿æŒè¿™ä¸ªç»“æœï¼Œè¿™æ—¶å°±ç§°ä¸º resolvedï¼ˆå·²å®šå‹ï¼‰ã€‚å¦‚æœæ”¹å˜å·²ç»å‘ç”Ÿäº†ï¼Œä½ å†å¯¹<code>Promise</code>å¯¹è±¡æ·»åŠ å›è°ƒå‡½æ•°ï¼Œä¹Ÿä¼šç«‹å³å¾—åˆ°è¿™ä¸ªç»“æœã€‚è¿™ä¸äº‹ä»¶ï¼ˆEventï¼‰å®Œå…¨ä¸åŒï¼Œäº‹ä»¶çš„ç‰¹ç‚¹æ˜¯ï¼Œå¦‚æœä½ é”™è¿‡äº†å®ƒï¼Œå†å»ç›‘å¬ï¼Œæ˜¯å¾—ä¸åˆ°ç»“æœçš„ã€‚</p>\n</blockquote>\n<p>ç”±äºPromiseåªèƒ½è¢«å†³è®®ä¸€æ¬¡ï¼Œä¸”å†³è®®ä¹‹åæ— æ³•æ”¹å˜ï¼Œæ‰€ä»¥ï¼Œå³ä¾¿æ˜¯å¤šæ¬¡å›è°ƒï¼Œä¹Ÿä¸ä¼šå½±å“ç»“æœï¼Œå†³è®®ä¹‹åçš„è°ƒç”¨éƒ½ä¼šè¢«å¿½ç•¥ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//ä¿¡ä»»é—®é¢˜æ¼”ç¤º</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//å›è°ƒ</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">method</span>(<span class=\"params\">cb</span>)</span>&#123;</span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        cb &amp;&amp; cb();</span><br><span class=\"line\">        <span class=\"comment\">//å› ä¸ºæŸäº›bugå¯¼è‡´æŸä¸ªå‡½æ•°å¤šæ‰§è¡Œäº†ä¸€æ¬¡</span></span><br><span class=\"line\">        cb &amp;&amp; cb();</span><br><span class=\"line\">    &#125;,<span class=\"number\">1000</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//promise</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">method2</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span>=&gt;</span>&#123;</span><br><span class=\"line\">        setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            resolve();</span><br><span class=\"line\">            <span class=\"comment\">//resolveæˆåŠŸè°ƒç”¨ä¸€æ¬¡ä¹‹åï¼Œåé¢çš„ä¸ä¼šå†æ‰§è¡Œ</span></span><br><span class=\"line\">            resolve();</span><br><span class=\"line\">        &#125;,<span class=\"number\">1000</span>);        </span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æ§åˆ¶åè½¬ã€‚ä½“ç°åœ¨å¯¹äºå‡½æ•°çš„æŠŠæ§ï¼Œæ¯”å¦‚thisç­‰ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//å›è°ƒ</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">method</span>(<span class=\"params\">cb</span>)</span>&#123;</span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        cb &amp;&amp; cb.call(&#123;<span class=\"attr\">a</span>:<span class=\"number\">1</span>,<span class=\"attr\">b</span>:<span class=\"number\">2</span>&#125;);<span class=\"comment\">//æ‰§è¡Œå›è°ƒï¼Œä½†æ˜¯æ·»æ²¹åŠ é†‹</span></span><br><span class=\"line\">    &#125;,<span class=\"number\">1000</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//promise</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">method2</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span>=&gt;</span>&#123;</span><br><span class=\"line\">        setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            resolve();<span class=\"comment\">//è°ƒç”¨çš„resolveéƒ½æ˜¯è‡ªå·±å†™çš„ï¼Œæ”¹å–„äº†æ§åˆ¶åè½¬çš„é—®é¢˜</span></span><br><span class=\"line\">        &#125;,<span class=\"number\">1000</span>);        </span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"æ‰‹æ’•A-è§„èŒƒçš„promise\"><a href=\"#æ‰‹æ’•A-è§„èŒƒçš„promise\" class=\"headerlink\" title=\"æ‰‹æ’•A+è§„èŒƒçš„promise\"></a>æ‰‹æ’•A+è§„èŒƒçš„promise</h3><blockquote>\n<p>é¢è¯•é¢˜ï¼šä½ çŸ¥é“promiseçš„A+è§„èŒƒå—ï¼Ÿï¼ˆæœ¬äººåœ¨æµ©é²¸ç§‘æŠ€è¢«é—®åˆ°çš„ï¼Œå½“æ—¶ç­”çš„æ”¯æ”¯å¾å¾ã€‚ã€‚ã€‚ï¼‰</p>\n</blockquote>\n<p>æˆ‘ä½•æ­¢æ˜¯çŸ¥é“ï¼Œæˆ‘ç”šè‡³å¯ä»¥æ‰‹å†™ä¸€ä¸ªç¬¦åˆA+è§„èŒƒçš„promiseï¼</p>\n<p>A+è§„èŒƒå¿«é€Ÿå…¥å£ï¼Œ<a href=\"https://promisesaplus.com/\" target=\"_blank\" rel=\"noopener\">ç‚¹æˆ‘</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">MyPromise</span>(<span class=\"params\">executor</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  self.status = <span class=\"string\">'pending'</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨æˆåŠŸçš„å€¼</span></span><br><span class=\"line\">  self.value = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨å¤±è´¥çš„å€¼</span></span><br><span class=\"line\">  self.reason = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolve</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å­˜ä¸‹æˆåŠŸçš„å€¼</span></span><br><span class=\"line\">      self.value = value</span><br><span class=\"line\">      self.status = <span class=\"string\">'fulfilled'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">reject</span>(<span class=\"params\">reason</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å­˜ä¸‹å¤±è´¥çš„å€¼</span></span><br><span class=\"line\">      self.reason = reason</span><br><span class=\"line\">      self.status = <span class=\"string\">'rejected'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  executor(resolve, reject);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>promiseé‡Œé¢æœ€éš¾çš„å°±æ˜¯thenäº†ï¼Œæˆ‘ä»¬å¿…é¡»å°†è¿™ä¸ªæ–¹æ³•å†™åœ¨ä»–çš„åŸå‹é“¾ä¸Šé¢ï¼Œå¹¶ä¸”ä»–æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯æˆåŠŸçš„å›è°ƒï¼Œä¸€ä¸ªæ˜¯å¤±è´¥çš„å›è°ƒã€‚</p>\n<p>åºŸè¯ä¸å¤šè¯´ï¼Œå¼€å†²ï¼</p>\n<h4 id=\"æ”¯æŒå¼‚æ­¥\"><a href=\"#æ”¯æŒå¼‚æ­¥\" class=\"headerlink\" title=\"æ”¯æŒå¼‚æ­¥\"></a>æ”¯æŒå¼‚æ­¥</h4><p>åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åŠ ä¸¤ä¸ªå˜é‡ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">MyPromise</span>(<span class=\"params\">executor</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  self.status = <span class=\"string\">'pending'</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨æˆåŠŸçš„å€¼</span></span><br><span class=\"line\">  self.value = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨å¤±è´¥çš„å€¼</span></span><br><span class=\"line\">  self.reason = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨æˆåŠŸçš„å›è°ƒ</span></span><br><span class=\"line\">  self.onResolved = [];</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨å¤±è´¥çš„å›è°ƒ</span></span><br><span class=\"line\">  self.onRejected = [];</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolve</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å­˜ä¸‹æˆåŠŸçš„å€¼</span></span><br><span class=\"line\">      self.value = value</span><br><span class=\"line\">      self.status = <span class=\"string\">'fulfilled'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">reject</span>(<span class=\"params\">reason</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å­˜ä¸‹å¤±è´¥çš„å€¼</span></span><br><span class=\"line\">      self.reason = reason</span><br><span class=\"line\">      self.status = <span class=\"string\">'rejected'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  executor(resolve, reject);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>é¢œå€¼é«˜åˆç»†å¿ƒçš„åŒå­¦ä¼šå‘ç°ï¼Œæˆ‘å¤šåŠ äº†ä¸¤ä¸ªå˜é‡ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// å­˜å‚¨æˆåŠŸçš„å›è°ƒ</span></span><br><span class=\"line\">self.onResolved = [];</span><br><span class=\"line\"><span class=\"comment\">// å­˜å‚¨å¤±è´¥çš„å›è°ƒ</span></span><br><span class=\"line\">self.onRejected = [];</span><br></pre></td></tr></table></figure>\n\n<p>è¿™ä¸¤ä¸ªå˜é‡å‘¢ï¼Œä¹Ÿéå¸¸å¥½ç†è§£ï¼Œå°±æ˜¯å­˜å‚¨å›è°ƒçš„ã€‚é‚£ä¹ˆæœ‰ä¸€ä¸ªéå¸¸éå¸¸é‡è¦çš„é—®é¢˜ï¼Œæˆ‘å†™çš„æ—¶å€™ä¹Ÿå›°æ‰°äº†å¥½ä¹…ï¼Œä¸ºä»€ä¹ˆä¸€å®šè¦æ˜¯ä¸€ä¸ªæ•°ç»„å‘¢ï¼Ÿæˆ‘å­˜å‚¨ä¸ºä¸€ä¸ªå‡½æ•°ä¸è¡Œå—ï¼Ÿåˆ°æ—¶å€™æ‰§è¡Œå°±è¡Œå•¦ã€‚ã€‚ã€‚</p>\n<p>qsï¼Œå’Œæˆ‘æƒ³ä¸€æ ·çš„å¸…å“¥é“å¥³å¯èƒ½æ¯”è¾ƒå¤šã€‚è¿™é‡Œæˆ‘ç»Ÿä¸€å›å¤ï¼š</p>\n<p>å‡å¦‚è¯´ã€‚ä»¥ä¸‹çš„æƒ…å†µå‡ºç°çš„è¯ï¼Œå’‹åŠã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"params\">()</span>=&gt;</span>&#123;</span><br><span class=\"line\">        resolve(<span class=\"number\">4</span>)</span><br><span class=\"line\">    &#125;, <span class=\"number\">1000</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">p.then(<span class=\"function\">(<span class=\"params\">res</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//4 res</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(res, <span class=\"string\">'res'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">p.then(<span class=\"function\">(<span class=\"params\">res1</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//4 res1</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(res1, <span class=\"string\">'res1'</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>è¿™ç§æƒ…å†µå‡ºç°ï¼Œå¦‚æœæˆ‘ä»¬åªæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„<code>console.log(res, &#39;res&#39;)</code>è¿™è¾ˆå­éƒ½æ— æ³•é—®ä¸–ï¼Œä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºè¢«åé—¨çš„<code>console.log(res1, &#39;res&#39;)</code>ç»™è¦†ç›–äº†å‘€ã€‚å¯¹ä¸å¯¹ï¼Œå¦‚æœè¯´è¿™ä¸ª<code>resolve</code>ä»–å»¶è¿Ÿæ‰§è¡Œï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦åšçš„æ˜¯æŠŠ<code>then</code>å‡½æ•°ç»™ä¿å­˜ä¸‹æ¥ï¼Œç­‰åˆ°<code>resolve</code>è¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œä¾æ¬¡æ‰§è¡Œæˆ‘ä»¬æ‰€æœ‰åˆ›å»ºçš„<code>then</code>é‡Œé¢çš„å›è°ƒå‡½æ•°ã€‚</p>\n<p>å¬æ‡‚æŒå£°ï¼</p>\n<p>æ²¡å¬æ‡‚çš„æ¥ç€å¾€ä¸‹çœ‹ï¼Œæˆ‘ä»¬æŠŠå‰©ä½™å·¥ä½œåšå®Œï¼Œç„¶åä¸¾ä¸€ä¸ªä¾‹å­ã€‚é©¬ä¸Šå°±èƒ½æ˜ç™½äº†ã€‚</p>\n<p>åˆšåˆšè¯´åˆ°ï¼Œæˆ‘ä»¬è¡¥å……ä¸¤ä¸ªå˜é‡ï¼Œç„¶åå†™ä¸‹æˆ‘ä»¬çš„<code>then</code>å‡½æ•°ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MyPromise.prototype.then = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">onFulfilled, onRejected</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'fulfilled'</span>) &#123;</span><br><span class=\"line\">    onFulfilled(self.value);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'rejected'</span>) &#123;</span><br><span class=\"line\">    onRejected(self.reason);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœæ˜¯pendingåº”è¯¥å­˜å‚¨å½“å‰çš„å›è°ƒå‡½æ•°</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">    self.onResolved.push(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;onFulfilled(self.value)&#125;)</span><br><span class=\"line\">    self.onRejected.push(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;onRejected(self.reason)&#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ç„¶åæˆ‘ä»¬è¿˜éœ€è¦åœ¨<code>resolve</code>æˆ–è€…<code>reject</code>çš„æ—¶å€™æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨èµ·æ¥çš„è¿™äº›å‡½æ•°ã€‚</p>\n<p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">MyPromise</span>(<span class=\"params\">executor</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  self.status = <span class=\"string\">'pending'</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨æˆåŠŸçš„å€¼</span></span><br><span class=\"line\">  self.value = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨å¤±è´¥çš„å€¼</span></span><br><span class=\"line\">  self.reason = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨æˆåŠŸçš„å›è°ƒ</span></span><br><span class=\"line\">  self.onResolved = [];</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨å¤±è´¥çš„å›è°ƒ</span></span><br><span class=\"line\">  self.onRejected = [];</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolve</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å­˜ä¸‹æˆåŠŸçš„å€¼</span></span><br><span class=\"line\">      self.value = value</span><br><span class=\"line\">      self.status = <span class=\"string\">'fulfilled'</span>;</span><br><span class=\"line\">      <span class=\"comment\">// æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;</span></span><br><span class=\"line\">      self.onResolved.forEach(<span class=\"function\"><span class=\"params\">fn</span> =&gt;</span> fn())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">reject</span>(<span class=\"params\">reason</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å­˜ä¸‹å¤±è´¥çš„å€¼</span></span><br><span class=\"line\">      self.reason = reason</span><br><span class=\"line\">      self.status = <span class=\"string\">'rejected'</span>;</span><br><span class=\"line\">      <span class=\"comment\">// æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;</span></span><br><span class=\"line\">      self.onRejected.forEach(<span class=\"function\"><span class=\"params\">fn</span> =&gt;</span> fn())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  executor(resolve, reject);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">MyPromise.prototype.then = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">onFulfilled, onRejected</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'fulfilled'</span>) &#123;</span><br><span class=\"line\">    onFulfilled(self.value);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'rejected'</span>) &#123;</span><br><span class=\"line\">    onRejected(self.reason);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœæ˜¯pendingåº”è¯¥å­˜å‚¨å½“å‰çš„å›è°ƒå‡½æ•°</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">    self.onResolved.push(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;onFulfilled(self.value)&#125;)</span><br><span class=\"line\">    self.onRejected.push(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;onRejected(self.reason)&#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>OKã€‚æˆ‘ä»¬å…ˆè¯•è¯•æˆ‘ä»¬è‡ªå·±å†™çš„promiseã€‚è·‘ä¸€ä¸‹demoå§ã€‚ä¸ºäº†ç»™æ‡’åŒå­¦ä¾¿æ·çš„è°ƒè¯•ï¼Œç›´æ¥CVä¸‹é¢å°±å¥½å•¦ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">MyPromise</span>(<span class=\"params\">executor</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  self.status = <span class=\"string\">'pending'</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨æˆåŠŸçš„å€¼</span></span><br><span class=\"line\">  self.value = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨å¤±è´¥çš„å€¼</span></span><br><span class=\"line\">  self.reason = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨æˆåŠŸçš„å›è°ƒ</span></span><br><span class=\"line\">  self.onResolved = [];</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨å¤±è´¥çš„å›è°ƒ</span></span><br><span class=\"line\">  self.onRejected = [];</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolve</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å­˜ä¸‹æˆåŠŸçš„å€¼</span></span><br><span class=\"line\">      self.value = value</span><br><span class=\"line\">      self.status = <span class=\"string\">'fulfilled'</span>;</span><br><span class=\"line\">      <span class=\"comment\">// æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;</span></span><br><span class=\"line\">      self.onResolved.forEach(<span class=\"function\"><span class=\"params\">fn</span> =&gt;</span> fn())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">reject</span>(<span class=\"params\">reason</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å­˜ä¸‹å¤±è´¥çš„å€¼</span></span><br><span class=\"line\">      self.reason = reason</span><br><span class=\"line\">      self.status = <span class=\"string\">'rejected'</span>;</span><br><span class=\"line\">      <span class=\"comment\">// æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;</span></span><br><span class=\"line\">      self.onRejected.forEach(<span class=\"function\"><span class=\"params\">fn</span> =&gt;</span> fn())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  executor(resolve, reject);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">MyPromise.prototype.then = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">onFulfilled, onRejected</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'fulfilled'</span>) &#123;</span><br><span class=\"line\">    onFulfilled(self.value);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'rejected'</span>) &#123;</span><br><span class=\"line\">    onRejected(self.reason);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœæ˜¯pendingåº”è¯¥å­˜å‚¨å½“å‰çš„å›è°ƒå‡½æ•°</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">    self.onResolved.push(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      onFulfilled(self.value)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    self.onRejected.push(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      onRejected(self.reason)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> MyPromise(<span class=\"function\">(<span class=\"params\">resolve, reject</span>)=&gt;</span>&#123;</span><br><span class=\"line\">  setTimeout(<span class=\"function\"><span class=\"params\">()</span>=&gt;</span>&#123;</span><br><span class=\"line\">    resolve(<span class=\"number\">4</span>)</span><br><span class=\"line\">  &#125;, <span class=\"number\">1000</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">p.then(<span class=\"function\">(<span class=\"params\">res</span>)=&gt;</span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//4 res</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(res, <span class=\"string\">'res'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">p.then(<span class=\"function\">(<span class=\"params\">res1</span>)=&gt;</span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//4 res1</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(res1, <span class=\"string\">'res1'</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>å—¯~å¦‚æ„¿è¾“å‡ºäº†ï¼Œé‚£å›åˆ°åˆšåˆšçš„é—®é¢˜ã€‚æˆ‘ä»¬æŠŠå›è°ƒçš„åœ°æ–¹ä¸è¦ç”¨æ•°ç»„è€Œç”¨å‡½æ•°å‘¢ï¼Ÿä¸ç”¨åŒå­¦ä»¬æ‰“å­—äº†ï¼Œç›´æ¥CVğŸ‘‡çš„ä»£ç å°±å¥½äº†ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">MyPromise</span>(<span class=\"params\">executor</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  self.status = <span class=\"string\">'pending'</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨æˆåŠŸçš„å€¼</span></span><br><span class=\"line\">  self.value = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨å¤±è´¥çš„å€¼</span></span><br><span class=\"line\">  self.reason = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨æˆåŠŸçš„å›è°ƒ</span></span><br><span class=\"line\">  self.onResolved = [];</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨å¤±è´¥çš„å›è°ƒ</span></span><br><span class=\"line\">  self.onRejected = [];</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolve</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å­˜ä¸‹æˆåŠŸçš„å€¼</span></span><br><span class=\"line\">      self.value = value</span><br><span class=\"line\">      self.status = <span class=\"string\">'fulfilled'</span>;</span><br><span class=\"line\">      <span class=\"comment\">// æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;</span></span><br><span class=\"line\">      self.onResolved.forEach(<span class=\"function\"><span class=\"params\">fn</span> =&gt;</span> fn())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">reject</span>(<span class=\"params\">reason</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å­˜ä¸‹å¤±è´¥çš„å€¼</span></span><br><span class=\"line\">      self.reason = reason</span><br><span class=\"line\">      self.status = <span class=\"string\">'rejected'</span>;</span><br><span class=\"line\">      <span class=\"comment\">// æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;</span></span><br><span class=\"line\">      self.onRejected.forEach(<span class=\"function\"><span class=\"params\">fn</span> =&gt;</span> fn())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  executor(resolve, reject);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">MyPromise.prototype.then = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">onFulfilled, onRejected</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'fulfilled'</span>) &#123;</span><br><span class=\"line\">    onFulfilled(self.value);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'rejected'</span>) &#123;</span><br><span class=\"line\">    onRejected(self.reason);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœæ˜¯pendingåº”è¯¥å­˜å‚¨å½“å‰çš„å›è°ƒå‡½æ•°</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">    self.onResolved.push(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      onFulfilled(self.value)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    self.onRejected.push(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      onRejected(self.reason)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> MyPromise(<span class=\"function\">(<span class=\"params\">resolve, reject</span>)=&gt;</span>&#123;</span><br><span class=\"line\">  setTimeout(<span class=\"function\"><span class=\"params\">()</span>=&gt;</span>&#123;</span><br><span class=\"line\">    resolve(<span class=\"number\">4</span>)</span><br><span class=\"line\">  &#125;, <span class=\"number\">1000</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">p.then(<span class=\"function\">(<span class=\"params\">res</span>)=&gt;</span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//4 res</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(res, <span class=\"string\">'res'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">p.then(<span class=\"function\">(<span class=\"params\">res1</span>)=&gt;</span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//4 res1</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(res1, <span class=\"string\">'res1'</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>æ˜¯ä¸æ˜¯åªæœ‰<code>console.log(res1, &#39;res1&#39;)</code>å•¦ï¼Ÿå› ä¸ºæ‰§è¡Œ<code>then</code>çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„resolveè¿˜æœ‰æ²¡æœ‰è¢«è°ƒç”¨ï¼Œå¦‚æœæˆ‘ä»¬æœ‰å¤šä¸ª<code>then</code>çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦æŠŠä»–ä»¬å­˜å‚¨èµ·æ¥ï¼Œç„¶åä¾æ¬¡è°ƒç”¨ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨åˆ°æ•°ç»„ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ˜¯åˆ«çš„æ–¹æ³•ï¼Œæ ¸å¿ƒæ€æƒ³å°±æ˜¯æŠŠä»–ä»¬å­˜èµ·æ¥ï¼Œåœ¨éœ€è¦è°ƒç”¨çš„æ—¶å€™è°ƒç”¨ã€‚</p>\n<p>æ˜¯ä¸æ˜¯å¾ˆå¥½ç†è§£ï¼Ÿï¼ï¼</p>\n<p>å¬æ‡‚æŒå£°ï¼</p>\n<p>è€Œä¸”A+ä¹Ÿè¦æ±‚äº†ã€‚</p>\n<blockquote>\n<p><code>2.2.6:then</code> may be called multiple times on the same promise.</p>\n<p>ï¼ˆpromise çš„ <code>then</code> å¯ä»¥é“¾å¼è°ƒç”¨å¤šæ¬¡ï¼‰</p>\n<p>2.2.6.1ï¼šIf/when <code>promise</code> is fulfilled, all respective <code>onFulfilled</code> callbacks must execute in the order of their originating calls to <code>then</code>.</p>\n<p>ï¼ˆå¦‚æœæˆ–å½“ promise è½¬æ€æ˜¯ fulfilled æ—¶ï¼Œæ‰€æœ‰çš„ onFulfilled å›è°ƒå›ä»¥ä»–ä»¬æ³¨å†Œæ—¶çš„é¡ºåºä¾æ¬¡æ‰§è¡Œï¼‰</p>\n<p>2.2.6.2ï¼šIf/when <code>promise</code> is rejected, all respective <code>onRejected</code> callbacks must execute in the order of their originating calls to <code>then</code>.</p>\n<p>ï¼ˆå¦‚æœæˆ–å½“ promise è½¬æ€æ˜¯ rejected æ—¶ï¼Œæ‰€æœ‰çš„ onRejected å›è°ƒå›ä»¥ä»–ä»¬æ³¨å†Œæ—¶çš„é¡ºåºä¾æ¬¡æ‰§è¡Œï¼‰</p>\n</blockquote>\n<p>æˆ‘ä»¬å¯¹promiseçš„ç†è§£æ›´è¿›ä¸€æ­¥äº†ã€‚è®°å¾—æŠŠä»£ç æ”¹å›å»ï¼Œç»§ç»­å¾€ä¸‹èµ°ã€‚</p>\n<p>åˆšåˆšæˆ‘ä»¬çš„demoè¿˜ä¸å¤Ÿé²æ£’ï¼Œè€Œä¸”æˆ‘ä»¬çš„æµ‹è¯•ç”¨ä¾‹éƒ½æ˜¯å®Œç¾æƒ…å†µä¸‹ã€‚</p>\n<p>æ¥ä¸‹æ¥è¦å‰‘èµ°åé”‹äº†ã€‚</p>\n<blockquote>\n<p>A+:</p>\n<p>2.2.1ï¼šBoth <code>onFulfilled</code> and <code>onRejected</code> are optional arguments:</p>\n<p>ï¼ˆonFulfilled å’Œ onRejected éƒ½æ˜¯å¯é€‰å‚æ•°ï¼šï¼‰</p>\n<p>2.2.1.1 If <code>onFulfilled</code> is not a function, it must be ignored.</p>\n<p>ï¼ˆå¦‚æœ onFulfilled ä¸æ˜¯å‡½æ•°ï¼Œå®ƒä¼šè¢«å¿½ç•¥ï¼‰</p>\n<p>2.2.1.2 If <code>onRejected</code> is not a function, it must be ignored.</p>\n<p>ï¼ˆå¦‚æœ onRejected ä¸æ˜¯å‡½æ•°ï¼Œå®ƒä¼šè¢«å¿½ç•¥ï¼‰</p>\n<p>2.2.7.2: If either <code>onFulfilled</code> or <code>onRejected</code> throws an exception <code>e</code>, <code>promise2</code> must be rejected with <code>e</code> as the reason.</p>\n<p>ï¼ˆå¦‚æœ onFulfilled æˆ– onRejected é‡ŒæŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸ï¼Œé‚£ä¹ˆ promise2 å¿…é¡»æ•è·è¿™ä¸ªé”™è¯¯ï¼ˆæ¥å—ä¸€ä¸ª reason å‚æ•°ï¼‰ï¼‰</p>\n</blockquote>\n<p>æ‰€ä»¥æˆ‘ä»¬é¦–å…ˆè¦åšçš„å°±æ˜¯ï¼ŒæŠŠé”™è¯¯ç»™æå‰æ•è·ï¼Œç„¶åä¸¢ç»™<code>reject</code></p>\n<p>emmmâ€¦.æ¥ä¸‹æˆ‘è´´ä»£ç éƒ½æ˜¯ä¸€èµ·è´´äº†ï¼Œå› ä¸ºæˆ‘æ€•æœ‰åŒå­¦ä¼šæ‰é˜Ÿï¼Œé‡Œé¢ä¹Ÿä¼šæœ‰ç›¸åº”çš„æ³¨é‡Šå¸®åŠ©ä¼šèµ°ç¥çš„åŒå­¦è·Ÿç´§è¿™è¾†äº”è±å®å…‰ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">MyPromise</span>(<span class=\"params\">executor</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  self.status = <span class=\"string\">'pending'</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨æˆåŠŸçš„å€¼</span></span><br><span class=\"line\">  self.value = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨å¤±è´¥çš„å€¼</span></span><br><span class=\"line\">  self.reason = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨æˆåŠŸçš„å›è°ƒ</span></span><br><span class=\"line\">  self.onResolved = [];</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨å¤±è´¥çš„å›è°ƒ</span></span><br><span class=\"line\">  self.onRejected = [];</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolve</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å­˜ä¸‹æˆåŠŸçš„å€¼</span></span><br><span class=\"line\">      self.value = value</span><br><span class=\"line\">      self.status = <span class=\"string\">'fulfilled'</span>;</span><br><span class=\"line\">      <span class=\"comment\">// æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;</span></span><br><span class=\"line\">      self.onResolved.forEach(<span class=\"function\"><span class=\"params\">fn</span> =&gt;</span> fn())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">reject</span>(<span class=\"params\">reason</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å­˜ä¸‹å¤±è´¥çš„å€¼</span></span><br><span class=\"line\">      self.reason = reason</span><br><span class=\"line\">      self.status = <span class=\"string\">'rejected'</span>;</span><br><span class=\"line\">      <span class=\"comment\">// æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;</span></span><br><span class=\"line\">      self.onRejected.forEach(<span class=\"function\"><span class=\"params\">fn</span> =&gt;</span> fn())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// æ•è·é”™è¯¯ä¼ ç»™rejectã€‚æ³•å¾‹è§„å®šï¼</span></span><br><span class=\"line\">\t<span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">  \texecutor(resolve, reject);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span>(e) &#123;</span><br><span class=\"line\">    reject(e);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">MyPromise.prototype.then = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">onFulfilled, onRejected</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœä¸æ˜¯å‡½æ•°å°±å¿½ç•¥ 2.2.1.1</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'fulfilled'</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">typeof</span> onFulfilled === <span class=\"string\">'function'</span> &amp;&amp; onFulfilled(self.value);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'rejected'</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">typeof</span> onFulfilled === <span class=\"string\">'function'</span> &amp;&amp; onRejected(self.reason);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœæ˜¯pendingåº”è¯¥å­˜å‚¨å½“å‰çš„å›è°ƒå‡½æ•°</span></span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœä¸æ˜¯å‡½æ•°å°±å¿½ç•¥ 2.2.1.2</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœä¸æ˜¯å‡½æ•°å°±å¿½ç•¥ 2.2.1.1</span></span><br><span class=\"line\">    <span class=\"keyword\">typeof</span> onFulfilled === <span class=\"string\">'function'</span> &amp;&amp; self.onResolved.push(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      onFulfilled(self.value)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœä¸æ˜¯å‡½æ•°å°±å¿½ç•¥ 2.2.1.2</span></span><br><span class=\"line\">    <span class=\"keyword\">typeof</span> onFulfilled === <span class=\"string\">'function'</span> &amp;&amp; self.onRejected.push(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      onRejected(self.reason)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"é“¾å¼è°ƒç”¨then\"><a href=\"#é“¾å¼è°ƒç”¨then\" class=\"headerlink\" title=\"é“¾å¼è°ƒç”¨then\"></a>é“¾å¼è°ƒç”¨then</h4><p>å¼€å§‹å‡†å¤‡è¿›å…¥promiseçš„éš¾ç‚¹ä»¥åŠæ ¸å¿ƒç‚¹ï¼šé“¾å¼è°ƒç”¨ã€‚</p>\n<blockquote>\n<p>2.2.7ï¼š<code>then</code> must return a promise</p>\n<p>ï¼ˆthen æ–¹æ³•ä¸€å®šè¿”å›ä¸€ä¸ª promiseï¼‰</p>\n</blockquote>\n<p>æˆ‘ä»¬éœ€è¦è¿”å›æ–°çš„promiseçš„è¯ï¼Œå¯ä»¥ç®€å•å®ç°ï¼Œå¿«é€Ÿè¿­ä»£ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Promise</span>.prototype.then = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">onFulfilled, onRejected</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> promise2 = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> promise2</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>2.2.7.1ï¼šIf either <code>onFulfilled</code> or <code>onRejected</code> returns a value <code>x</code>, run the Promise Resolution Procedure <code>[[Resolve]](promise2, x)</code>.</p>\n<p>ï¼ˆå¦‚æœ onFulfilled æˆ– onRejected è¿”å›çš„æ˜¯ä¸€ä¸ª xï¼Œé‚£ä¹ˆå®ƒä¼šä»¥[[Resolve]](promise2, x)` å¤„ç†è§£æï¼‰</p>\n<p>2.2.7.2ï¼šIf either <code>onFulfilled</code> or <code>onRejected</code> throws an exception <code>e</code>, <code>promise2</code> must be rejected with <code>e</code> as the reason.</p>\n<p>ï¼ˆå¦‚æœ onFulfilled æˆ– onRejected é‡ŒæŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸ï¼Œé‚£ä¹ˆ promise2 å¿…é¡»æ•è·è¿™ä¸ªé”™è¯¯ï¼ˆæ¥å—ä¸€ä¸ª reason å‚æ•°ï¼‰ï¼‰</p>\n<p>2.2.7.3ï¼šIf <code>onFulfilled</code> is not a function and <code>promise1</code> is fulfilled, <code>promise2</code> must be fulfilled with the same value as <code>promise1</code>.</p>\n<p>ï¼ˆå¦‚æœ onFulfilled ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸” promise1 çŠ¶æ€æ˜¯ fulfilledï¼Œé‚£ä¹ˆ promise2 ä¸€å®šä¼šæ¥å—åˆ°ä¸ promse1 ä¸€æ ·çš„å€¼ valueï¼‰</p>\n<p>2.2.7.4ï¼šIf <code>onRejected</code> is not a function and <code>promise1</code> is rejected, <code>promise2</code> must be rejected with the same reason as <code>promise1</code>.</p>\n<p>ï¼ˆå¦‚æœ onRejected ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸” promise1 çŠ¶æ€æ˜¯ rejectedï¼Œpromise2 ä¸€å®šä¼šæ¥å—åˆ°ä¸ promise1 ä¸€æ ·çš„å€¼ reasonï¼‰</p>\n</blockquote>\n<p>æˆ‘ä»¬éœ€è¦å°†è¿”å›å†…å®¹promiseåŒ–ï¼Œéœ€è¦å¯¹onFulfilledå’ŒonRejectedè¿›è¡Œé”™è¯¯å¤„ç†ï¼Œè¿™ä¸ªæˆ‘ä»¬ä¹‹å‰å°±å¤„ç†è¿‡äº†ï¼Œå¦‚æœonFulfilledå’ŒonRejectedæ²¡æœ‰ä¼ å‚å°±ç»§ç»­ä¼ é€’ï¼ŒåŸç”ŸğŸŒ°æ¥ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>)</span>&#123;</span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        resolve(<span class=\"number\">3</span>)</span><br><span class=\"line\">    &#125;, <span class=\"number\">1000</span>)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">p.then(<span class=\"number\">1</span>,<span class=\"number\">1</span>)</span><br><span class=\"line\">.then(<span class=\"string\">''</span>,<span class=\"string\">''</span>)</span><br><span class=\"line\">.then()</span><br><span class=\"line\">.then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//3</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(res)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>è¿™é‡Œä¸ç®¡onFulfilledå’ŒonRejectedä¼ ä»€ä¹ˆå€¼ï¼Œåªè¦ä¸æ˜¯å‡½æ•°ï¼Œå°±ç»§ç»­å‘ä¸‹ä¼ å…¥ï¼Œç›´åˆ°æœ‰å‡½æ•°è¿›è¡Œæ¥æ”¶ï¼›è¦åšçš„äº‹æƒ…å¤ªå¤šäº†ï¼Œä¸å½“å½“æ˜¯åˆ¤æ–­å‡½æ•°è¿™ç§ç®€å•çš„åˆ¤æ–­äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æŠ½ç¦»ä¸€ä¸ªæ–°çš„å‡½æ•°æ¥å¤ç”¨ç»Ÿä¸€å¤„ç†ã€‚å› æ­¤æˆ‘ä»¬è¿›è¡Œå¦‚ä¸‹å®Œå–„ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">MyPromise</span>(<span class=\"params\">executor</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  self.status = <span class=\"string\">'pending'</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨æˆåŠŸçš„å€¼</span></span><br><span class=\"line\">  self.value = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨å¤±è´¥çš„å€¼</span></span><br><span class=\"line\">  self.reason = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨æˆåŠŸçš„å›è°ƒ</span></span><br><span class=\"line\">  self.onResolved = [];</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨å¤±è´¥çš„å›è°ƒ</span></span><br><span class=\"line\">  self.onRejected = [];</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolve</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å­˜ä¸‹æˆåŠŸçš„å€¼</span></span><br><span class=\"line\">      self.value = value</span><br><span class=\"line\">      self.status = <span class=\"string\">'fulfilled'</span>;</span><br><span class=\"line\">      <span class=\"comment\">// æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;</span></span><br><span class=\"line\">      self.onResolved.forEach(<span class=\"function\"><span class=\"params\">fn</span> =&gt;</span> fn())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">reject</span>(<span class=\"params\">reason</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å­˜ä¸‹å¤±è´¥çš„å€¼</span></span><br><span class=\"line\">      self.reason = reason</span><br><span class=\"line\">      self.status = <span class=\"string\">'rejected'</span>;</span><br><span class=\"line\">      <span class=\"comment\">// æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;</span></span><br><span class=\"line\">      self.onRejected.forEach(<span class=\"function\"><span class=\"params\">fn</span> =&gt;</span> fn())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// æ•è·é”™è¯¯ä¼ ç»™rejectã€‚æ³•å¾‹è§„å®šï¼</span></span><br><span class=\"line\">\t<span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">  \texecutor(resolve, reject);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span>(e) &#123;</span><br><span class=\"line\">    reject(e);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolvePromise</span>(<span class=\"params\">promise2, res, resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœpromise2å’Œç»“æœç›¸åŒï¼Œå°±è‡ªå·±æ— é™å¾ªç¯è°ƒç”¨è‡ªå·±çš„thenäº†ï¼Œæ­»äº¡å¾ªç¯ã€‚</span></span><br><span class=\"line\">  <span class=\"comment\">// ä¸¾ä¸ªğŸŒ°ï¼švar a = function()&#123;return a&#125;ï¼Œè¿™ä¸ªthenåˆä¼šè‡ªå·±æ— é™è§¦å‘ã€‚æ‰€ä»¥å°±ç©å®Œäº†ã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(promise2 === res) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> reject(<span class=\"keyword\">new</span> <span class=\"built_in\">TypeError</span>(<span class=\"string\">'å¾ªç¯å¼•ç”¨'</span>))</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(</span><br><span class=\"line\">    res !== <span class=\"literal\">null</span> </span><br><span class=\"line\">    &amp;&amp; (<span class=\"keyword\">typeof</span> res === <span class=\"string\">'object'</span>) || <span class=\"keyword\">typeof</span> res === <span class=\"string\">'function'</span>)</span><br><span class=\"line\">  ) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// ä¿å­˜æ˜¯å¦å·²ç»è°ƒç”¨è¿‡å‡½æ•°ã€‚</span></span><br><span class=\"line\">      <span class=\"comment\">// 2.3.3.3.3 If both resolvePromise and rejectPromise are called, or multiple calls to the same argument are made, the first call takes precedence, and any further calls are ignored.(å¦‚æœ resolvePromise å’Œ rejectPromise å·²ç»è¢«è°ƒç”¨æˆ–ä»¥ç›¸åŒçš„å‚æ•°å¤šæ¬¡è°ƒç”¨çš„è¯å—ï¼Œä¼˜å…ˆç¬¬ä¸€æ¬¡çš„è°ƒç”¨ï¼Œå¹¶ä¸”ä¹‹åçš„è°ƒç”¨å…¨éƒ¨è¢«å¿½ç•¥ï¼ˆé¿å…å¤šæ¬¡è°ƒç”¨ï¼‰)</span></span><br><span class=\"line\">      <span class=\"keyword\">let</span> used = <span class=\"literal\">false</span>;</span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"comment\">// 2.3.3.1ï¼šLet then be x.then. [3.5](æŠŠ x.then èµ‹å€¼ç»™ then å˜é‡)</span></span><br><span class=\"line\">      <span class=\"comment\">// å¯ä»¥æé˜²æœ‰äººæ¶æã€‚åƒğŸ‘‡</span></span><br><span class=\"line\">      <span class=\"comment\">// Object.defineProperty(Promise, 'then', &#123;</span></span><br><span class=\"line\">      <span class=\"comment\">//    get: function()&#123;</span></span><br><span class=\"line\">      <span class=\"comment\">//        throw Error('error')</span></span><br><span class=\"line\">      <span class=\"comment\">//    &#125;</span></span><br><span class=\"line\">      <span class=\"comment\">// &#125;)</span></span><br><span class=\"line\">      <span class=\"comment\">// è¿™æ ·çš„è¯æˆ‘ä»¬å–å€¼å°±ä¼šæŠ¥é”™ã€‚</span></span><br><span class=\"line\">      <span class=\"keyword\">let</span> then = res.then;</span><br><span class=\"line\">      <span class=\"comment\">// å¦‚æœthenæ˜¯å‡½æ•°ï¼Œå°±é»˜è®¤æ˜¯promiseäº†   </span></span><br><span class=\"line\">      <span class=\"keyword\">if</span>(<span class=\"keyword\">typeof</span> then === <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">        then.call(</span><br><span class=\"line\">          res, </span><br><span class=\"line\">          value =&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(used) &#123;</span><br><span class=\"line\">              <span class=\"keyword\">return</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            used = <span class=\"literal\">true</span>;</span><br><span class=\"line\">            <span class=\"comment\">// é€’å½’è§£æï¼Œç›´åˆ°ä¸æ˜¯ä¸€ä¸ªpromiseä¸ºæ­¢</span></span><br><span class=\"line\">            resolvePromise(promise2, value, resolve, reject);</span><br><span class=\"line\">        \t&#125;,</span><br><span class=\"line\">          reason =&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(used) &#123;</span><br><span class=\"line\">              <span class=\"keyword\">return</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            used = <span class=\"literal\">true</span>;</span><br><span class=\"line\">            reject(reason);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        )</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(used) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      used = <span class=\"literal\">true</span>;</span><br><span class=\"line\">      reject(e);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœä¸æ˜¯å‡½æ•°æˆ–è€…å¯¹è±¡ä¹Ÿä¸ä¸ºç©ºå°±ç›´æ¥ç»§ç»­ä¼ é€’è¿™ä¸ªå€¼ã€‚</span></span><br><span class=\"line\">\t  resolve(res);  </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">MyPromise.prototype.then = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">onFulfilled, onRejected</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"comment\">// åªæœ‰promiseæ‰å¯ä»¥æŒç»­çš„é“¾å¼è°ƒç”¨then,æ‰€ä»¥è¿™é‡Œå¼„äº†ä¸€ä¸ªæ–°çš„promise</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> promise2 = <span class=\"keyword\">new</span> MyPromise(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'fulfilled'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> res = onFulfilled(self.value);</span><br><span class=\"line\">      resolvePromise(promise2, res, resolve, reject);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'rejected'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> res = onRejected(self.reason);</span><br><span class=\"line\">      resolvePromise(promise2, res, resolve, reject);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœæ˜¯pendingåº”è¯¥å­˜å‚¨å½“å‰çš„å›è°ƒå‡½æ•°</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">      self.onResolved.push(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> res = onFulfilled(self.value);</span><br><span class=\"line\">      resolvePromise(promise2, res, resolve, reject);</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">      self.onRejected.push(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> res = onRejected(self.reason);</span><br><span class=\"line\">      resolvePromise(promise2, res, resolve, reject);</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä»¥ä¸Šå°±æ˜¯ç¬¦åˆ Promise/A+ è§„èŒƒçš„å®ç°äº†ï¼Œå¦‚æœä½ å¯¹äºè¿™éƒ¨åˆ†ä»£ç å°šæœ‰ç–‘é—®ï¼Œæ¬¢è¿åœ¨è¯„è®ºä¸­ä¸æˆ‘äº’åŠ¨ã€‚</p>\n<h2 id=\"Generator\"><a href=\"#Generator\" class=\"headerlink\" title=\"Generator\"></a>Generator</h2><blockquote>\n<p>é¢è¯•é¢˜ï¼šä»‹ç»ä¸€ä¸‹generatorå§ã€‚</p>\n</blockquote>\n<p>å¾ˆå¤šå°ä¼™ä¼´å¯èƒ½å’Œæˆ‘ä¸€æ ·ï¼Œåªæ˜¯ä¼šç”¨ï¼Œä½†æ˜¯ä½ ç¡¬è¦æˆ‘ä»‹ç»ï¼Œé‚£æˆ‘å’‹æï¼Ÿgeneratorçš„æ‹¼å†™æ˜¯g e n e r a t o rï¼Ÿ</p>\n<p>â€œå“”â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€</p>\n<p>å…¶å®æˆ‘é‡æ¸©äº†ä¸€ä¸‹é˜®è€å¸ˆçš„es6è¯¾ç¨‹ï¼Œå‘ç°å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ¥ä»‹ç»ã€‚</p>\n<ul>\n<li>å½¢å¼ä¸Š<ul>\n<li>generatorå’Œæ™®é€šçš„å‡½æ•°ä¸åŒç‚¹åœ¨äºï¼Œå¯¹ä¸€ä¸ª<code>*</code>å·ï¼Œå‡½æ•°å†…éƒ¨ä½¿ç”¨äº†yieldè¡¨è¾¾å¼</li>\n</ul>\n</li>\n<li>è¯­æ³•ä¸Š<ul>\n<li>Generatorå‡½æ•°å°è£…äº†å¤šä¸ªå†…éƒ¨çŠ¶æ€(é€šè¿‡yieldè¡¨è¾¾å¼å®šä¹‰å†…éƒ¨çŠ¶æ€)ã€‚æ‰§è¡ŒGeneratorå‡½æ•°æ—¶ä¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡(Iteratorå¯¹è±¡)ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒGeneratoræ˜¯éå†å™¨å¯¹è±¡ç”Ÿæˆå‡½æ•°ï¼Œå‡½æ•°å†…éƒ¨å°è£…äº†å¤šä¸ªçŠ¶æ€ã€‚é€šè¿‡è¿”å›çš„Iteratorå¯¹è±¡ï¼Œå¯ä»¥ä¾æ¬¡éå†(è°ƒç”¨nextæ–¹æ³•)Generatorå‡½æ•°çš„æ¯ä¸ªå†…éƒ¨çŠ¶æ€ã€‚</li>\n</ul>\n</li>\n<li>è°ƒç”¨ä¸Š<ul>\n<li>æ™®é€šå‡½æ•°åœ¨è°ƒç”¨ä¹‹åä¼šç«‹å³æ‰§è¡Œï¼Œè€ŒGeneratorå‡½æ•°è°ƒç”¨ä¹‹åä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯ä¼šè¿”å›éå†å™¨å¯¹è±¡(Iteratorå¯¹è±¡)ã€‚é€šè¿‡Iteratorå¯¹è±¡çš„nextæ–¹æ³•æ¥éå†å†…éƒ¨yieldè¡¨è¾¾å¼å®šä¹‰çš„æ¯ä¸€ä¸ªçŠ¶æ€ã€‚</li>\n</ul>\n</li>\n</ul>\n<p>å…¶å®æˆ‘è§‰å¾—ï¼Œå¦‚æœèƒ½æŠŠä¸‹é¢çš„è¿™ä¸ªæ¡ˆä¾‹å¼„æ¸…æ¥šï¼Œgeneratorå°±ç®—è¿‡å…³äº†ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> *<span class=\"title\">foo</span>(<span class=\"params\">x</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> y = <span class=\"number\">2</span> * (<span class=\"keyword\">yield</span> (x + <span class=\"number\">1</span>))</span><br><span class=\"line\">  <span class=\"keyword\">let</span> z = <span class=\"keyword\">yield</span> (y / <span class=\"number\">3</span>)</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (x + y + z)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> it = foo(<span class=\"number\">5</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(it.next())   <span class=\"comment\">// =&gt; &#123;value: 6, done: false&#125;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(it.next(<span class=\"number\">12</span>)) <span class=\"comment\">// =&gt; &#123;value: 8, done: false&#125;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(it.next(<span class=\"number\">13</span>)) <span class=\"comment\">// =&gt; &#123;value: 42, done: true&#125;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>é¦–å…ˆ <code>Generator</code> å‡½æ•°è°ƒç”¨å’Œæ™®é€šå‡½æ•°ä¸åŒï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªè¿­ä»£å™¨</li>\n<li>å½“æ‰§è¡Œç¬¬ä¸€æ¬¡ <code>next</code> æ—¶ï¼Œä¼ å‚ä¼šè¢«å¿½ç•¥ï¼Œå¹¶ä¸”å‡½æ•°æš‚åœåœ¨ <code>yield (x + 1)</code> å¤„ï¼Œæ‰€ä»¥è¿”å› <code>5 + 1 = 6</code></li>\n<li>å½“æ‰§è¡Œç¬¬äºŒæ¬¡ <code>next</code> æ—¶ï¼Œä¼ å…¥çš„å‚æ•°ç­‰äºä¸Šä¸€ä¸ª <code>yield</code> çš„è¿”å›å€¼ï¼Œå¦‚æœä½ ä¸ä¼ å‚ï¼Œ<code>yield</code> æ°¸è¿œè¿”å› <code>undefined</code>ã€‚æ­¤æ—¶ <code>let y = 2 * 12</code>ï¼Œæ‰€ä»¥ç¬¬äºŒä¸ª <code>yield</code> ç­‰äº <code>2 * 12 / 3 = 8</code></li>\n<li>å½“æ‰§è¡Œç¬¬ä¸‰æ¬¡ <code>next</code> æ—¶ï¼Œä¼ å…¥çš„å‚æ•°ä¼šä¼ é€’ç»™ <code>z</code>ï¼Œæ‰€ä»¥ <code>z = 13, x = 5, y = 24</code>ï¼Œç›¸åŠ ç­‰äº <code>42</code></li>\n</ul>\n<h2 id=\"async-await\"><a href=\"#async-await\" class=\"headerlink\" title=\"async/await\"></a>async/await</h2><blockquote>\n<p>ä»€ä¹ˆæ˜¯async/awaitï¼Ÿ</p>\n</blockquote>\n<p>å…¶å®å°±ä¸€å¥è¯ï¼š<strong>async å‡½æ•°å°±æ˜¯ Generator å‡½æ•°çš„è¯­æ³•ç³–ã€‚</strong></p>\n<p>generatorï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> gen = <span class=\"function\"><span class=\"keyword\">function</span>* (<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> f1 = <span class=\"keyword\">yield</span> readFile(<span class=\"string\">'/etc/fstab'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> f2 = <span class=\"keyword\">yield</span> readFile(<span class=\"string\">'/etc/shells'</span>);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(f1.toString());</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(f2.toString());</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>Async:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> asyncReadFile = <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> f1 = <span class=\"keyword\">await</span> readFile(<span class=\"string\">'/etc/fstab'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> f2 = <span class=\"keyword\">await</span> readFile(<span class=\"string\">'/etc/shells'</span>);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(f1.toString());</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(f2.toString());</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>ä¸€æ¯”è¾ƒå°±ä¼šå‘ç°ï¼Œasync å‡½æ•°å°±æ˜¯å°† Generator å‡½æ•°çš„æ˜Ÿå·ï¼ˆ*ï¼‰æ›¿æ¢æˆ asyncï¼Œå°† yield æ›¿æ¢æˆ awaitï¼Œä»…æ­¤è€Œå·²ã€‚</p>\n<p>asyncå¯¹generatorè¿›è¡Œäº†ä»¥ä¸‹ä¸‰ç‚¹çš„æ”¹è¿›ï¼š</p>\n<ol>\n<li><strong>å†…ç½®æ‰§è¡Œå™¨ã€‚</strong> Generator å‡½æ•°çš„æ‰§è¡Œå¿…é¡»é æ‰§è¡Œå™¨ï¼Œæ‰€ä»¥æ‰æœ‰äº† co å‡½æ•°åº“ï¼Œè€Œ async å‡½æ•°è‡ªå¸¦æ‰§è¡Œå™¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œasync å‡½æ•°çš„æ‰§è¡Œï¼Œä¸æ™®é€šå‡½æ•°ä¸€æ¨¡ä¸€æ ·ï¼Œåªè¦ä¸€è¡Œã€‚</li>\n<li><strong>æ›´å¥½çš„è¯­ä¹‰ã€‚</strong> async å’Œ awaitï¼Œæ¯”èµ·æ˜Ÿå·å’Œ yieldï¼Œè¯­ä¹‰æ›´æ¸…æ¥šäº†ã€‚async è¡¨ç¤ºå‡½æ•°é‡Œæœ‰å¼‚æ­¥æ“ä½œï¼Œawait è¡¨ç¤ºç´§è·Ÿåœ¨åé¢çš„è¡¨è¾¾å¼éœ€è¦ç­‰å¾…ç»“æœã€‚</li>\n<li><strong>æ›´å¹¿çš„é€‚ç”¨æ€§ã€‚</strong> co å‡½æ•°åº“çº¦å®šï¼Œyield å‘½ä»¤åé¢åªèƒ½æ˜¯ Thunk å‡½æ•°æˆ– Promise å¯¹è±¡ï¼Œè€Œ async å‡½æ•°çš„ await å‘½ä»¤åé¢ï¼Œå¯ä»¥è·Ÿ Promise å¯¹è±¡å’ŒåŸå§‹ç±»å‹çš„å€¼ï¼ˆæ•°å€¼ã€å­—ç¬¦ä¸²å’Œå¸ƒå°”å€¼ï¼Œä½†è¿™æ—¶ç­‰åŒäºåŒæ­¥æ“ä½œï¼‰ã€‚</li>\n</ol>\n<p>ä¸€ä¸ªå‡½æ•°å¦‚æœåŠ ä¸Šäº†asyncï¼Œé‚£ä¹ˆå°±ä¼šé»˜è®¤è¿”å›ä¸€ä¸ªpromise</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fn</span>(<span class=\"params\">args</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ç­‰åŒäº</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fn</span>(<span class=\"params\">args</span>)</span>&#123; </span><br><span class=\"line\">  <span class=\"keyword\">return</span> spawn(<span class=\"function\"><span class=\"keyword\">function</span>*(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">  &#125;); </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"æ³¨æ„\"><a href=\"#æ³¨æ„\" class=\"headerlink\" title=\"æ³¨æ„\"></a>æ³¨æ„</h3><p>await å‘½ä»¤åé¢çš„ Promise å¯¹è±¡ï¼Œè¿è¡Œç»“æœå¯èƒ½æ˜¯ rejectedï¼Œæ‰€ä»¥æœ€å¥½æŠŠ await å‘½ä»¤æ”¾åœ¨ tryâ€¦catch ä»£ç å—ä¸­ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">myFunction</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">await</span> somethingThatReturnsAPromise();</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span> (err) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(err);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// å¦ä¸€ç§å†™æ³•</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">myFunction</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">await</span> somethingThatReturnsAPromise().catch(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">err</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(err);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>await å‘½ä»¤åªèƒ½ç”¨åœ¨ async å‡½æ•°ä¹‹ä¸­ï¼Œå¦‚æœç”¨åœ¨æ™®é€šå‡½æ•°ï¼Œå°±ä¼šæŠ¥é”™ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">dbFuc</span>(<span class=\"params\">db</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> docs = [&#123;&#125;, &#123;&#125;, &#123;&#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// æŠ¥é”™</span></span><br><span class=\"line\">  docs.forEach(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">doc</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">await</span> db.post(doc);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"Reference\"><a href=\"#Reference\" class=\"headerlink\" title=\"Reference\"></a>Reference</h2><blockquote>\n<p><a href=\"https://es6.ruanyifeng.com/#docs/generator\" target=\"_blank\" rel=\"noopener\">https://es6.ruanyifeng.com/#docs/generator</a></p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<p>æœ€è¿‘åœ¨å†™ã€é‡æ‹¾å‰ç«¯ã€‘ç³»åˆ—ï¼Œä¸‹é¢æœ‰å‡ ä¸ªå¿«é€Ÿé€šé“ï¼Œå¤§å®¶è‡ªå–</p>\n<p><a href=\"https://juejin.im/post/6850418113944420359\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘åŸå‹/åŸå‹é“¾å’Œç»§æ‰¿</a></p>\n<p><a href=\"https://juejin.im/post/6850418117508759566\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘é—­åŒ…ä¸æ¨¡å—</a></p>\n<p><a href=\"https://juejin.im/post/6854573215658803208\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘å…¨é¢æ”»ç ´this</a></p>\n<p><a href=\"https://juejin.im/post/6859911609633767438\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘ä¸€æ¬¡æå®šJavaScriptçš„æ‰§è¡Œæœºåˆ¶</a></p>\n<p><a href=\"https://juejin.im/post/6860375101322461198\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘ä»€ä¹ˆæ˜¯BFCã€IFCã€GFC å’Œ FFC</a></p>\n<p><a href=\"https://juejin.im/post/6865204092877144077\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘æ·±å…¥å†…å­˜ä¸–ç•Œ</a></p>\n<p><a href=\"https://juejin.im/post/6867814019055484942\" target=\"_blank\" rel=\"noopener\">ã€é‡è¯†å‰ç«¯ã€‘æš´èµ°çš„å¼‚æ­¥ç¼–ç¨‹</a></p>\n<h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><p>è€è§„çŸ©ï¼Œè¿˜æ˜¯å…ˆäº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯å¼‚æ­¥ã€‚å¼‚æ­¥å…¶å®æ˜¯ä¸€ä¸ªç›¸å¯¹æ¯”è¾ƒé«˜çº§çš„ä¸€ä¸ªæ¦‚å¿µã€‚</p>\n<p>é€šå¸¸æ¥è¯´ï¼Œç¨‹åºéƒ½æ˜¯é¡ºåºæ‰§è¡Œï¼ŒåŒä¸€æ—¶åˆ»åªä¼šå‘ç”Ÿä¸€ä»¶äº‹ã€‚å¦‚æœä¸€ä¸ªå‡½æ•°ä¾èµ–äºå¦ä¸€ä¸ªå‡½æ•°çš„ç»“æœï¼Œå®ƒåªèƒ½ç­‰å¾…é‚£ä¸ªå‡½æ•°ç»“æŸæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œä»ç”¨æˆ·çš„è§’åº¦æ¥è¯´ï¼Œæ•´ä¸ªç¨‹åºæ‰ç®—è¿è¡Œå®Œæ¯•.</p>\n<p>å¦‚æœè¯´ä¸€ä¸ªäº‹æƒ…éœ€è¦ç­‰å¾…ä¸Šä¸€ä»¶äº‹æƒ…åšå®Œæ‰èƒ½åšï¼Œä½†æ˜¯ä»–ä»¬ä¹‹å‰åˆæ²¡æœ‰å¼ºè€¦åˆå…³ç³»ã€‚è¿™æ ·å°±åœ¨é‚£é‡Œå¹²ç­‰å°±æ¯«æ— æ„ä¹‰ã€‚ç‰¹åˆ«æ˜¯ç°åœ¨è®¡ç®—æœºæ™®ééƒ½æœ‰å¤šæ ¸CPUçš„æ—¶ä»£ã€‚</p>\n<p>ä¸¾ä¸€ä¸ªå½¢è±¡çš„ğŸŒ°ã€‚</p>\n<p>æˆ‘ä»¬ç°åœ¨è¦å»åƒæµ·åº•æï¼ˆæµ·åº•ææ‰“é’±ï¼ï¼‰ï¼Œæˆ‘ä»¬å‘ç°è¦æ’é˜Ÿï¼Œéœ€è¦æ’2ä¸ªå°æ—¶å·¦å³ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¦å¹²å˜›ï¼Ÿéš¾é“æ˜¯å¹²ç­‰å—ï¼Ÿè‚¯å®šä¸æ˜¯ï¼é‚£æ ·è ¢è ¢çš„ç¡¬ç­‰å¾ˆå‘†ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæ‹¿å‡ºæ‰‹æœºåˆ·åˆ·æœ‹å‹åœˆï¼Œæˆ–è€…ç©ä¸€æŠŠç´§å¼ åˆºæ¿€çš„ç‹è€…è£è€€åˆæˆ–è€…å»çœ‹ä¸€åœºç”µå½±ç­‰ç­‰â€¦.åœ¨æˆ‘ä»¬åšè¿™äº›äº‹æƒ…çš„æ—¶å€™æˆ‘ä»¬çš„æ’é˜Ÿå¹¶æ²¡æœ‰è¢«è€½è¯¯ï¼Œç”šè‡³å¯ä»¥å’ŒæœåŠ¡å‘˜è¯´å¿«åˆ°äº†æ‰“ä¸ªç”µè¯ç»™æˆ‘ï¼ˆè¿™ä¸ªæ˜¯å¸¸è§çš„callbackæ–¹æ³•ï¼Œå¾…ä¼šè®¨è®ºï¼‰</p>\n<blockquote>\n<p>è¿™æ ·ä½ å¯ä»¥åŒæ—¶å®Œæˆå…¶ä»–å·¥ä½œï¼Œè¿™å°±æ˜¯<strong>å¼‚æ­¥ç¼–ç¨‹</strong>çš„å‡ºå‘ç‚¹ã€‚</p>\n</blockquote>\n<p>æœ¬æ–‡æ€»ç»“äº†å‡ ä¸ªå¼‚æ­¥çš„æ–¹æ¡ˆï¼Œç†è§£å®ƒä»¬å¯ä»¥è®©ä½ å†™å‡ºç»“æ„æ›´åˆç†ã€æ€§èƒ½æ›´å‡ºè‰²ã€ç»´æŠ¤æ›´æ–¹ä¾¿çš„Javascriptç¨‹åºã€‚</p>\n<h2 id=\"å¼‚æ­¥callback\"><a href=\"#å¼‚æ­¥callback\" class=\"headerlink\" title=\"å¼‚æ­¥callback\"></a>å¼‚æ­¥callback</h2><p>ä¸Šæ¥å°±æ˜¯ä¸€ä¸ªè‹±ä¿Šçš„ä¾‹å­</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> response = fetch(<span class=\"string\">'myImage.png'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> blob = response.blob();</span><br></pre></td></tr></table></figure>\n\n<p>æ²¡æœ‰äººå¯ä»¥å®Œç¾é¢„æµ‹åˆ°æ¯ç§ç½‘ç»œæƒ…å†µä¸‹è¿™ä¸ªresponseï¼Œæ˜¯å¦å¯ä»¥å®Œç¾è·å¾—fetchè·å¾—çš„å†…å®¹ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šæŠ¥é”™ã€‚</p>\n<p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬çš„callbackå°±âœ¨bu ling bu lingçš„ç™»åœºå•¦ã€‚</p>\n<p>æœ‰äº›å°ä¼™ä¼´å¯èƒ½è§‰å¾—callbackä¼¼ä¹å’Œè‡ªå·±æ²¡æœ‰å¤ªå¤§å…³ç³»ã€‚ã€‚ã€‚emmmmâ€¦.</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">btn.addEventListener(<span class=\"string\">'click'</span>, () =&gt; &#123;</span><br><span class=\"line\">  alert(<span class=\"string\">'You clicked me!'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>è¿™æ ·å‘¢ï¼Ÿæœ‰æ²¡æœ‰æ„Ÿè§‰æœ‰ç‚¹å„¿ç†Ÿæ‚‰äº†ï¼Œå…¶ä»–è¿™ä¸ªå°±ç›¸å½“äºreactä¸­çš„</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">onclick</span>=<span class=\"string\">&#123;()</span> =&gt;</span>&#123;alert('You clicked me!');&#125;&#125;&gt;</span><br><span class=\"line\">\tç‚¹æˆ‘  </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>æ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œè¿™ä¸ªå…¶å®å°±æ˜¯æœ€å¸¸è§çš„callbackï¼ˆå›è°ƒå‡½æ•°ï¼‰ã€‚</p>\n<p>åˆæˆ–è€…æ¯”è¾ƒå¸¸è§çš„</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">\talert(<span class=\"string\">'You clicked me!'</span>);</span><br><span class=\"line\">&#125;ï¼Œ<span class=\"number\">2000</span>)</span><br></pre></td></tr></table></figure>\n\n<p>å¾ˆå¸¸è§ï¼Œå¤§è‡´æ„æ€å°±æ˜¯2ç§’é’Ÿä¹‹åä¼šå›è°ƒä¸€ä¸‹è¿™ä¸ªåŒ¿åå‡½æ•°ï¼Œè™½ç„¶ä¸ä¸€å®šä¼šå‡†ç¡®æ‰§è¡Œï¼Œè¿™ä¸ªæ¶‰åŠåˆ°äº‹ä»¶å¾ªç¯ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å»æ‰¾ä¸€ä¸‹æˆ‘å‰é˜µå­å†™çš„äº‹ä»¶å¾ªç¯ğŸ˜Šã€‚</p>\n<h2 id=\"å‘å¸ƒ-è®¢é˜…æ¨¡å¼\"><a href=\"#å‘å¸ƒ-è®¢é˜…æ¨¡å¼\" class=\"headerlink\" title=\"å‘å¸ƒ-è®¢é˜…æ¨¡å¼\"></a>å‘å¸ƒ-è®¢é˜…æ¨¡å¼</h2><p>å‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼šåˆç§°ä¸ºè§‚å¯Ÿè€…æ¨¡å¼ï¼Œå®ƒå®šä¹‰å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€æ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å°†å¾—åˆ°é€šçŸ¥ã€‚</p>\n<p>åœ¨å†™Reactçš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªéå¸¸éå¸¸éå¸¸å¸¸è§çš„ğŸŒ°ï¼š</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123;useState, useEffect&#125; <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> test = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [derrick, setDerrick] = useState(<span class=\"number\">0</span>)</span><br><span class=\"line\">  useEffect(<span class=\"function\"><span class=\"params\">()</span>=&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(derrick)</span><br><span class=\"line\">  &#125;, [derrick])</span><br><span class=\"line\">  <span class=\"keyword\">return</span>(</span><br><span class=\"line\">    &lt;button onClick=&#123;() =&gt; &#123;setDerrick(derrick+<span class=\"number\">1</span>)&#125;&#125;&gt;ç‚¹æˆ‘&lt;<span class=\"regexp\">/button&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  )</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>useEffectè®¢é˜…äº†derrickè¿™ä¸ªå˜é‡çš„å˜åŒ–ï¼Œç„¶åç›‘å¬åˆ°å˜åŒ–ä¹‹åå°±ä¼šè¿›è¡Œä¸€æ¬¡logï¼Œæ‰“å°å‡ºderrickå˜é‡çš„å€¼ã€‚</p>\n<h2 id=\"Promise\"><a href=\"#Promise\" class=\"headerlink\" title=\"Promise\"></a>Promise</h2><h3 id=\"å›è°ƒæ•‘æ˜Ÿ\"><a href=\"#å›è°ƒæ•‘æ˜Ÿ\" class=\"headerlink\" title=\"å›è°ƒæ•‘æ˜Ÿ\"></a>å›è°ƒæ•‘æ˜Ÿ</h3><p>ä¹‹å‰ä»‹ç»è¿‡å›è°ƒå‡½æ•°è¿™ç§å¼‚æ­¥ç¼–ç¨‹ã€‚</p>\n<p>åŠ å…¥æˆ‘å¸Œæœ›åœ¨Aæ‰§è¡Œå®Œä¹‹åæ‰§è¡ŒBï¼Œç„¶åæ‰§è¡ŒCï¼Œç„¶åæ‰§è¡ŒDâ€¦.æœ€åæ‰§è¡ŒZ</p>\n<p>å†™å‡ºæ¥çš„ä»£ç å¯èƒ½æ˜¯è¿™æ ·çš„</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> sayhello = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">name, callback</span>) </span>&#123;</span><br><span class=\"line\">  setTimeout(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(name);</span><br><span class=\"line\">    callback();</span><br><span class=\"line\">  &#125;, <span class=\"number\">1000</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">sayhello(<span class=\"string\">\"first\"</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  sayhello(<span class=\"string\">\"second\"</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    sayhello(<span class=\"string\">\"third\"</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(<span class=\"string\">\"end\"</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>åƒæœ¬ä¾‹ä¸€æ ·åµŒå¥—å¤šä¸ªæ–¹æ³•è°ƒç”¨ä¼šåˆ›å»ºé”™ç»¼å¤æ‚çš„ä»£ç ï¼Œä¼šéš¾ä»¥ç†è§£ä¸è°ƒè¯•ã€‚å½“æƒ³è¦å®ç°æ›´å¤ æ‚çš„åŠŸèƒ½æ—¶ï¼Œå›è°ƒå‡½æ•°ä¹Ÿä¼šå­˜åœ¨é—®é¢˜:è‹¥æƒ³è®©ä¸¤ä¸ªå¼‚æ­¥æ“ä½œå¹¶è¡Œè¿è¡Œï¼Œå¹¶ä¸”åœ¨å®ƒä»¬éƒ½ç»“æŸå æé†’ä½ ï¼Œé‚£è¯¥æ€ä¹ˆåš?è‹¥æƒ³åŒæ—¶å¯åŠ¨ä¸¤ä¸ªå¼‚æ­¥æ“ä½œï¼Œä½†åªé‡‡ç”¨é¦–ä¸ªç»“æŸçš„ç»“æœï¼Œé‚£åˆè¯¥æ€ä¹ˆ åš?</p>\n<p>åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œä½ éœ€è¦è¿½è¸ªå¤šä¸ªå›è°ƒå‡½æ•°å¹¶åšæ¸…ç†æ“ä½œï¼Œ ä¸è¿‡å¥½åœ¨promiseæ¨ªç©ºå‡ºä¸–æ‹¯æ•‘äº†ä¸–ç•Œã€‚</p>\n<h3 id=\"æ¶‰åŠé¢è¯•é¢˜\"><a href=\"#æ¶‰åŠé¢è¯•é¢˜\" class=\"headerlink\" title=\"æ¶‰åŠé¢è¯•é¢˜\"></a>æ¶‰åŠé¢è¯•é¢˜</h3><blockquote>\n<p>promiseç”¨è¿‡å—ï¼Ÿè¯·ä½ ä»‹ç»ä¸€ä¸‹promiseã€‚</p>\n</blockquote>\n<p>å…¶å®è¿™é‡Œå¾ˆå¤šåŒå­¦å¯èƒ½å°±ä¸çŸ¥é“æ€ä¹ˆä»‹ç»äº†ï¼Œå¯èƒ½åªåœç•™åœ¨æ€ä¹ˆç”¨ã€‚æˆ‘ä»¬å¯ä»¥ä»å‡ ä¸ªæ–¹é¢æ¥ä»‹ç»ã€‚</p>\n<ul>\n<li>promiseæ˜¯ä»€ä¹ˆï¼Ÿ</li>\n<li>promiseè§£å†³äº†ä»€ä¹ˆé—®é¢˜</li>\n<li>promiseçš„ä¼˜ç¼ºç‚¹</li>\n</ul>\n<h4 id=\"promiseæ˜¯ä»€ä¹ˆï¼Ÿ\"><a href=\"#promiseæ˜¯ä»€ä¹ˆï¼Ÿ\" class=\"headerlink\" title=\"promiseæ˜¯ä»€ä¹ˆï¼Ÿ\"></a>promiseæ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>æ‰€è°“<code>Promise</code>ï¼Œç®€å•è¯´å°±æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œé‡Œé¢ä¿å­˜ç€æŸä¸ªæœªæ¥æ‰ä¼šç»“æŸçš„äº‹ä»¶ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼‰çš„ç»“æœã€‚ä»è¯­æ³•ä¸Šè¯´ï¼ŒPromise æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä»å®ƒå¯ä»¥è·å–å¼‚æ­¥æ“ä½œçš„æ¶ˆæ¯ã€‚Promise æä¾›ç»Ÿä¸€çš„ APIï¼Œå„ç§å¼‚æ­¥æ“ä½œéƒ½å¯ä»¥ç”¨åŒæ ·çš„æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚</p>\n<h4 id=\"promiseè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ\"><a href=\"#promiseè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ\" class=\"headerlink\" title=\"promiseè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ\"></a>promiseè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h4><ol>\n<li>è§£å†³å¯è¯»æ€§çš„é—®é¢˜</li>\n<li>è§£å†³ä¿¡ä»»é—®é¢˜</li>\n</ol>\n<h5 id=\"å¯è¯»æ€§\"><a href=\"#å¯è¯»æ€§\" class=\"headerlink\" title=\"å¯è¯»æ€§\"></a>å¯è¯»æ€§</h5><p>å¯è¯»æ€§ï¼Œä¹‹å‰çš„å›è°ƒåœ°ç‹±promiseå°±å¯ä»¥ä¼˜é›…çš„è§£å†³ã€‚(è¿˜æœ‰æ›´åŠ ä¼˜é›…çš„ï¼Œå¾…ä¼šä¼šä»‹ç»ã€‚)</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> sayhello = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"built_in\">console</span>.log(name);</span><br><span class=\"line\">      resolve();ã€€ã€€<span class=\"comment\">//åœ¨å¼‚æ­¥æ“ä½œæ‰§è¡Œå®Œåæ‰§è¡Œ resolve() å‡½æ•°</span></span><br><span class=\"line\">    &#125;, <span class=\"number\">10000</span>);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">sayhello(<span class=\"string\">\"first\"</span>).then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> sayhello(<span class=\"string\">\"second\"</span>);ã€€ã€€<span class=\"comment\">//ä»ç„¶è¿”å›ä¸€ä¸ª Promise å¯¹è±¡</span></span><br><span class=\"line\">&#125;).then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> sayhello(<span class=\"string\">\"third\"</span>);</span><br><span class=\"line\">&#125;).then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'end'</span>);</span><br><span class=\"line\">&#125;).catch(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(err);</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"ä¿¡ä»»é—®é¢˜\"><a href=\"#ä¿¡ä»»é—®é¢˜\" class=\"headerlink\" title=\"ä¿¡ä»»é—®é¢˜\"></a>ä¿¡ä»»é—®é¢˜</h5><p>è¿™ä¸ªé—®é¢˜å¯ä»¥ç”¨promiseçš„å‡ ä¸ªç‰¹ç‚¹æ¥è§£é‡Šï¼š</p>\n<blockquote>\n<p>ï¼ˆ1ï¼‰å¯¹è±¡çš„çŠ¶æ€ä¸å—å¤–ç•Œå½±å“ã€‚<code>Promise</code>å¯¹è±¡ä»£è¡¨ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œæœ‰ä¸‰ç§çŠ¶æ€ï¼š<code>pending</code>ï¼ˆè¿›è¡Œä¸­ï¼‰ã€<code>fulfilled</code>ï¼ˆå·²æˆåŠŸï¼‰å’Œ<code>rejected</code>ï¼ˆå·²å¤±è´¥ï¼‰ã€‚åªæœ‰å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œå¯ä»¥å†³å®šå½“å‰æ˜¯å“ªä¸€ç§çŠ¶æ€ï¼Œä»»ä½•å…¶ä»–æ“ä½œéƒ½æ— æ³•æ”¹å˜è¿™ä¸ªçŠ¶æ€ã€‚è¿™ä¹Ÿæ˜¯<code>Promise</code>è¿™ä¸ªåå­—çš„ç”±æ¥ï¼Œå®ƒçš„è‹±è¯­æ„æ€å°±æ˜¯â€œæ‰¿è¯ºâ€ï¼Œè¡¨ç¤ºå…¶ä»–æ‰‹æ®µæ— æ³•æ”¹å˜ã€‚</p>\n<p>ï¼ˆ2ï¼‰ä¸€æ—¦çŠ¶æ€æ”¹å˜ï¼Œå°±ä¸ä¼šå†å˜ï¼Œä»»ä½•æ—¶å€™éƒ½å¯ä»¥å¾—åˆ°è¿™ä¸ªç»“æœã€‚<code>Promise</code>å¯¹è±¡çš„çŠ¶æ€æ”¹å˜ï¼Œåªæœ‰ä¸¤ç§å¯èƒ½ï¼šä»<code>pending</code>å˜ä¸º<code>fulfilled</code>å’Œä»<code>pending</code>å˜ä¸º<code>rejected</code>ã€‚åªè¦è¿™ä¸¤ç§æƒ…å†µå‘ç”Ÿï¼ŒçŠ¶æ€å°±å‡å›ºäº†ï¼Œä¸ä¼šå†å˜äº†ï¼Œä¼šä¸€ç›´ä¿æŒè¿™ä¸ªç»“æœï¼Œè¿™æ—¶å°±ç§°ä¸º resolvedï¼ˆå·²å®šå‹ï¼‰ã€‚å¦‚æœæ”¹å˜å·²ç»å‘ç”Ÿäº†ï¼Œä½ å†å¯¹<code>Promise</code>å¯¹è±¡æ·»åŠ å›è°ƒå‡½æ•°ï¼Œä¹Ÿä¼šç«‹å³å¾—åˆ°è¿™ä¸ªç»“æœã€‚è¿™ä¸äº‹ä»¶ï¼ˆEventï¼‰å®Œå…¨ä¸åŒï¼Œäº‹ä»¶çš„ç‰¹ç‚¹æ˜¯ï¼Œå¦‚æœä½ é”™è¿‡äº†å®ƒï¼Œå†å»ç›‘å¬ï¼Œæ˜¯å¾—ä¸åˆ°ç»“æœçš„ã€‚</p>\n</blockquote>\n<p>ç”±äºPromiseåªèƒ½è¢«å†³è®®ä¸€æ¬¡ï¼Œä¸”å†³è®®ä¹‹åæ— æ³•æ”¹å˜ï¼Œæ‰€ä»¥ï¼Œå³ä¾¿æ˜¯å¤šæ¬¡å›è°ƒï¼Œä¹Ÿä¸ä¼šå½±å“ç»“æœï¼Œå†³è®®ä¹‹åçš„è°ƒç”¨éƒ½ä¼šè¢«å¿½ç•¥ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//ä¿¡ä»»é—®é¢˜æ¼”ç¤º</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//å›è°ƒ</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">method</span>(<span class=\"params\">cb</span>)</span>&#123;</span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        cb &amp;&amp; cb();</span><br><span class=\"line\">        <span class=\"comment\">//å› ä¸ºæŸäº›bugå¯¼è‡´æŸä¸ªå‡½æ•°å¤šæ‰§è¡Œäº†ä¸€æ¬¡</span></span><br><span class=\"line\">        cb &amp;&amp; cb();</span><br><span class=\"line\">    &#125;,<span class=\"number\">1000</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//promise</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">method2</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span>=&gt;</span>&#123;</span><br><span class=\"line\">        setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            resolve();</span><br><span class=\"line\">            <span class=\"comment\">//resolveæˆåŠŸè°ƒç”¨ä¸€æ¬¡ä¹‹åï¼Œåé¢çš„ä¸ä¼šå†æ‰§è¡Œ</span></span><br><span class=\"line\">            resolve();</span><br><span class=\"line\">        &#125;,<span class=\"number\">1000</span>);        </span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æ§åˆ¶åè½¬ã€‚ä½“ç°åœ¨å¯¹äºå‡½æ•°çš„æŠŠæ§ï¼Œæ¯”å¦‚thisç­‰ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//å›è°ƒ</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">method</span>(<span class=\"params\">cb</span>)</span>&#123;</span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        cb &amp;&amp; cb.call(&#123;<span class=\"attr\">a</span>:<span class=\"number\">1</span>,<span class=\"attr\">b</span>:<span class=\"number\">2</span>&#125;);<span class=\"comment\">//æ‰§è¡Œå›è°ƒï¼Œä½†æ˜¯æ·»æ²¹åŠ é†‹</span></span><br><span class=\"line\">    &#125;,<span class=\"number\">1000</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//promise</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">method2</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"params\">resolve</span>=&gt;</span>&#123;</span><br><span class=\"line\">        setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            resolve();<span class=\"comment\">//è°ƒç”¨çš„resolveéƒ½æ˜¯è‡ªå·±å†™çš„ï¼Œæ”¹å–„äº†æ§åˆ¶åè½¬çš„é—®é¢˜</span></span><br><span class=\"line\">        &#125;,<span class=\"number\">1000</span>);        </span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"æ‰‹æ’•A-è§„èŒƒçš„promise\"><a href=\"#æ‰‹æ’•A-è§„èŒƒçš„promise\" class=\"headerlink\" title=\"æ‰‹æ’•A+è§„èŒƒçš„promise\"></a>æ‰‹æ’•A+è§„èŒƒçš„promise</h3><blockquote>\n<p>é¢è¯•é¢˜ï¼šä½ çŸ¥é“promiseçš„A+è§„èŒƒå—ï¼Ÿï¼ˆæœ¬äººåœ¨æµ©é²¸ç§‘æŠ€è¢«é—®åˆ°çš„ï¼Œå½“æ—¶ç­”çš„æ”¯æ”¯å¾å¾ã€‚ã€‚ã€‚ï¼‰</p>\n</blockquote>\n<p>æˆ‘ä½•æ­¢æ˜¯çŸ¥é“ï¼Œæˆ‘ç”šè‡³å¯ä»¥æ‰‹å†™ä¸€ä¸ªç¬¦åˆA+è§„èŒƒçš„promiseï¼</p>\n<p>A+è§„èŒƒå¿«é€Ÿå…¥å£ï¼Œ<a href=\"https://promisesaplus.com/\" target=\"_blank\" rel=\"noopener\">ç‚¹æˆ‘</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">MyPromise</span>(<span class=\"params\">executor</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  self.status = <span class=\"string\">'pending'</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨æˆåŠŸçš„å€¼</span></span><br><span class=\"line\">  self.value = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨å¤±è´¥çš„å€¼</span></span><br><span class=\"line\">  self.reason = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolve</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å­˜ä¸‹æˆåŠŸçš„å€¼</span></span><br><span class=\"line\">      self.value = value</span><br><span class=\"line\">      self.status = <span class=\"string\">'fulfilled'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">reject</span>(<span class=\"params\">reason</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å­˜ä¸‹å¤±è´¥çš„å€¼</span></span><br><span class=\"line\">      self.reason = reason</span><br><span class=\"line\">      self.status = <span class=\"string\">'rejected'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  executor(resolve, reject);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>promiseé‡Œé¢æœ€éš¾çš„å°±æ˜¯thenäº†ï¼Œæˆ‘ä»¬å¿…é¡»å°†è¿™ä¸ªæ–¹æ³•å†™åœ¨ä»–çš„åŸå‹é“¾ä¸Šé¢ï¼Œå¹¶ä¸”ä»–æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯æˆåŠŸçš„å›è°ƒï¼Œä¸€ä¸ªæ˜¯å¤±è´¥çš„å›è°ƒã€‚</p>\n<p>åºŸè¯ä¸å¤šè¯´ï¼Œå¼€å†²ï¼</p>\n<h4 id=\"æ”¯æŒå¼‚æ­¥\"><a href=\"#æ”¯æŒå¼‚æ­¥\" class=\"headerlink\" title=\"æ”¯æŒå¼‚æ­¥\"></a>æ”¯æŒå¼‚æ­¥</h4><p>åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åŠ ä¸¤ä¸ªå˜é‡ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">MyPromise</span>(<span class=\"params\">executor</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  self.status = <span class=\"string\">'pending'</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨æˆåŠŸçš„å€¼</span></span><br><span class=\"line\">  self.value = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨å¤±è´¥çš„å€¼</span></span><br><span class=\"line\">  self.reason = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨æˆåŠŸçš„å›è°ƒ</span></span><br><span class=\"line\">  self.onResolved = [];</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨å¤±è´¥çš„å›è°ƒ</span></span><br><span class=\"line\">  self.onRejected = [];</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolve</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å­˜ä¸‹æˆåŠŸçš„å€¼</span></span><br><span class=\"line\">      self.value = value</span><br><span class=\"line\">      self.status = <span class=\"string\">'fulfilled'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">reject</span>(<span class=\"params\">reason</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å­˜ä¸‹å¤±è´¥çš„å€¼</span></span><br><span class=\"line\">      self.reason = reason</span><br><span class=\"line\">      self.status = <span class=\"string\">'rejected'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  executor(resolve, reject);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>é¢œå€¼é«˜åˆç»†å¿ƒçš„åŒå­¦ä¼šå‘ç°ï¼Œæˆ‘å¤šåŠ äº†ä¸¤ä¸ªå˜é‡ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// å­˜å‚¨æˆåŠŸçš„å›è°ƒ</span></span><br><span class=\"line\">self.onResolved = [];</span><br><span class=\"line\"><span class=\"comment\">// å­˜å‚¨å¤±è´¥çš„å›è°ƒ</span></span><br><span class=\"line\">self.onRejected = [];</span><br></pre></td></tr></table></figure>\n\n<p>è¿™ä¸¤ä¸ªå˜é‡å‘¢ï¼Œä¹Ÿéå¸¸å¥½ç†è§£ï¼Œå°±æ˜¯å­˜å‚¨å›è°ƒçš„ã€‚é‚£ä¹ˆæœ‰ä¸€ä¸ªéå¸¸éå¸¸é‡è¦çš„é—®é¢˜ï¼Œæˆ‘å†™çš„æ—¶å€™ä¹Ÿå›°æ‰°äº†å¥½ä¹…ï¼Œä¸ºä»€ä¹ˆä¸€å®šè¦æ˜¯ä¸€ä¸ªæ•°ç»„å‘¢ï¼Ÿæˆ‘å­˜å‚¨ä¸ºä¸€ä¸ªå‡½æ•°ä¸è¡Œå—ï¼Ÿåˆ°æ—¶å€™æ‰§è¡Œå°±è¡Œå•¦ã€‚ã€‚ã€‚</p>\n<p>qsï¼Œå’Œæˆ‘æƒ³ä¸€æ ·çš„å¸…å“¥é“å¥³å¯èƒ½æ¯”è¾ƒå¤šã€‚è¿™é‡Œæˆ‘ç»Ÿä¸€å›å¤ï¼š</p>\n<p>å‡å¦‚è¯´ã€‚ä»¥ä¸‹çš„æƒ…å†µå‡ºç°çš„è¯ï¼Œå’‹åŠã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"params\">()</span>=&gt;</span>&#123;</span><br><span class=\"line\">        resolve(<span class=\"number\">4</span>)</span><br><span class=\"line\">    &#125;, <span class=\"number\">1000</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">p.then(<span class=\"function\">(<span class=\"params\">res</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//4 res</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(res, <span class=\"string\">'res'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">p.then(<span class=\"function\">(<span class=\"params\">res1</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//4 res1</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(res1, <span class=\"string\">'res1'</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>è¿™ç§æƒ…å†µå‡ºç°ï¼Œå¦‚æœæˆ‘ä»¬åªæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„<code>console.log(res, &#39;res&#39;)</code>è¿™è¾ˆå­éƒ½æ— æ³•é—®ä¸–ï¼Œä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºè¢«åé—¨çš„<code>console.log(res1, &#39;res&#39;)</code>ç»™è¦†ç›–äº†å‘€ã€‚å¯¹ä¸å¯¹ï¼Œå¦‚æœè¯´è¿™ä¸ª<code>resolve</code>ä»–å»¶è¿Ÿæ‰§è¡Œï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦åšçš„æ˜¯æŠŠ<code>then</code>å‡½æ•°ç»™ä¿å­˜ä¸‹æ¥ï¼Œç­‰åˆ°<code>resolve</code>è¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œä¾æ¬¡æ‰§è¡Œæˆ‘ä»¬æ‰€æœ‰åˆ›å»ºçš„<code>then</code>é‡Œé¢çš„å›è°ƒå‡½æ•°ã€‚</p>\n<p>å¬æ‡‚æŒå£°ï¼</p>\n<p>æ²¡å¬æ‡‚çš„æ¥ç€å¾€ä¸‹çœ‹ï¼Œæˆ‘ä»¬æŠŠå‰©ä½™å·¥ä½œåšå®Œï¼Œç„¶åä¸¾ä¸€ä¸ªä¾‹å­ã€‚é©¬ä¸Šå°±èƒ½æ˜ç™½äº†ã€‚</p>\n<p>åˆšåˆšè¯´åˆ°ï¼Œæˆ‘ä»¬è¡¥å……ä¸¤ä¸ªå˜é‡ï¼Œç„¶åå†™ä¸‹æˆ‘ä»¬çš„<code>then</code>å‡½æ•°ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MyPromise.prototype.then = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">onFulfilled, onRejected</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'fulfilled'</span>) &#123;</span><br><span class=\"line\">    onFulfilled(self.value);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'rejected'</span>) &#123;</span><br><span class=\"line\">    onRejected(self.reason);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœæ˜¯pendingåº”è¯¥å­˜å‚¨å½“å‰çš„å›è°ƒå‡½æ•°</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">    self.onResolved.push(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;onFulfilled(self.value)&#125;)</span><br><span class=\"line\">    self.onRejected.push(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;onRejected(self.reason)&#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ç„¶åæˆ‘ä»¬è¿˜éœ€è¦åœ¨<code>resolve</code>æˆ–è€…<code>reject</code>çš„æ—¶å€™æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨èµ·æ¥çš„è¿™äº›å‡½æ•°ã€‚</p>\n<p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">MyPromise</span>(<span class=\"params\">executor</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  self.status = <span class=\"string\">'pending'</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨æˆåŠŸçš„å€¼</span></span><br><span class=\"line\">  self.value = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨å¤±è´¥çš„å€¼</span></span><br><span class=\"line\">  self.reason = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨æˆåŠŸçš„å›è°ƒ</span></span><br><span class=\"line\">  self.onResolved = [];</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨å¤±è´¥çš„å›è°ƒ</span></span><br><span class=\"line\">  self.onRejected = [];</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolve</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å­˜ä¸‹æˆåŠŸçš„å€¼</span></span><br><span class=\"line\">      self.value = value</span><br><span class=\"line\">      self.status = <span class=\"string\">'fulfilled'</span>;</span><br><span class=\"line\">      <span class=\"comment\">// æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;</span></span><br><span class=\"line\">      self.onResolved.forEach(<span class=\"function\"><span class=\"params\">fn</span> =&gt;</span> fn())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">reject</span>(<span class=\"params\">reason</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å­˜ä¸‹å¤±è´¥çš„å€¼</span></span><br><span class=\"line\">      self.reason = reason</span><br><span class=\"line\">      self.status = <span class=\"string\">'rejected'</span>;</span><br><span class=\"line\">      <span class=\"comment\">// æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;</span></span><br><span class=\"line\">      self.onRejected.forEach(<span class=\"function\"><span class=\"params\">fn</span> =&gt;</span> fn())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  executor(resolve, reject);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">MyPromise.prototype.then = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">onFulfilled, onRejected</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'fulfilled'</span>) &#123;</span><br><span class=\"line\">    onFulfilled(self.value);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'rejected'</span>) &#123;</span><br><span class=\"line\">    onRejected(self.reason);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœæ˜¯pendingåº”è¯¥å­˜å‚¨å½“å‰çš„å›è°ƒå‡½æ•°</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">    self.onResolved.push(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;onFulfilled(self.value)&#125;)</span><br><span class=\"line\">    self.onRejected.push(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;onRejected(self.reason)&#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>OKã€‚æˆ‘ä»¬å…ˆè¯•è¯•æˆ‘ä»¬è‡ªå·±å†™çš„promiseã€‚è·‘ä¸€ä¸‹demoå§ã€‚ä¸ºäº†ç»™æ‡’åŒå­¦ä¾¿æ·çš„è°ƒè¯•ï¼Œç›´æ¥CVä¸‹é¢å°±å¥½å•¦ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">MyPromise</span>(<span class=\"params\">executor</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  self.status = <span class=\"string\">'pending'</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨æˆåŠŸçš„å€¼</span></span><br><span class=\"line\">  self.value = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨å¤±è´¥çš„å€¼</span></span><br><span class=\"line\">  self.reason = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨æˆåŠŸçš„å›è°ƒ</span></span><br><span class=\"line\">  self.onResolved = [];</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨å¤±è´¥çš„å›è°ƒ</span></span><br><span class=\"line\">  self.onRejected = [];</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolve</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å­˜ä¸‹æˆåŠŸçš„å€¼</span></span><br><span class=\"line\">      self.value = value</span><br><span class=\"line\">      self.status = <span class=\"string\">'fulfilled'</span>;</span><br><span class=\"line\">      <span class=\"comment\">// æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;</span></span><br><span class=\"line\">      self.onResolved.forEach(<span class=\"function\"><span class=\"params\">fn</span> =&gt;</span> fn())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">reject</span>(<span class=\"params\">reason</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å­˜ä¸‹å¤±è´¥çš„å€¼</span></span><br><span class=\"line\">      self.reason = reason</span><br><span class=\"line\">      self.status = <span class=\"string\">'rejected'</span>;</span><br><span class=\"line\">      <span class=\"comment\">// æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;</span></span><br><span class=\"line\">      self.onRejected.forEach(<span class=\"function\"><span class=\"params\">fn</span> =&gt;</span> fn())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  executor(resolve, reject);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">MyPromise.prototype.then = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">onFulfilled, onRejected</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'fulfilled'</span>) &#123;</span><br><span class=\"line\">    onFulfilled(self.value);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'rejected'</span>) &#123;</span><br><span class=\"line\">    onRejected(self.reason);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœæ˜¯pendingåº”è¯¥å­˜å‚¨å½“å‰çš„å›è°ƒå‡½æ•°</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">    self.onResolved.push(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      onFulfilled(self.value)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    self.onRejected.push(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      onRejected(self.reason)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> MyPromise(<span class=\"function\">(<span class=\"params\">resolve, reject</span>)=&gt;</span>&#123;</span><br><span class=\"line\">  setTimeout(<span class=\"function\"><span class=\"params\">()</span>=&gt;</span>&#123;</span><br><span class=\"line\">    resolve(<span class=\"number\">4</span>)</span><br><span class=\"line\">  &#125;, <span class=\"number\">1000</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">p.then(<span class=\"function\">(<span class=\"params\">res</span>)=&gt;</span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//4 res</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(res, <span class=\"string\">'res'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">p.then(<span class=\"function\">(<span class=\"params\">res1</span>)=&gt;</span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//4 res1</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(res1, <span class=\"string\">'res1'</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>å—¯~å¦‚æ„¿è¾“å‡ºäº†ï¼Œé‚£å›åˆ°åˆšåˆšçš„é—®é¢˜ã€‚æˆ‘ä»¬æŠŠå›è°ƒçš„åœ°æ–¹ä¸è¦ç”¨æ•°ç»„è€Œç”¨å‡½æ•°å‘¢ï¼Ÿä¸ç”¨åŒå­¦ä»¬æ‰“å­—äº†ï¼Œç›´æ¥CVğŸ‘‡çš„ä»£ç å°±å¥½äº†ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">MyPromise</span>(<span class=\"params\">executor</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  self.status = <span class=\"string\">'pending'</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨æˆåŠŸçš„å€¼</span></span><br><span class=\"line\">  self.value = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨å¤±è´¥çš„å€¼</span></span><br><span class=\"line\">  self.reason = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨æˆåŠŸçš„å›è°ƒ</span></span><br><span class=\"line\">  self.onResolved = [];</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨å¤±è´¥çš„å›è°ƒ</span></span><br><span class=\"line\">  self.onRejected = [];</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolve</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å­˜ä¸‹æˆåŠŸçš„å€¼</span></span><br><span class=\"line\">      self.value = value</span><br><span class=\"line\">      self.status = <span class=\"string\">'fulfilled'</span>;</span><br><span class=\"line\">      <span class=\"comment\">// æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;</span></span><br><span class=\"line\">      self.onResolved.forEach(<span class=\"function\"><span class=\"params\">fn</span> =&gt;</span> fn())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">reject</span>(<span class=\"params\">reason</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å­˜ä¸‹å¤±è´¥çš„å€¼</span></span><br><span class=\"line\">      self.reason = reason</span><br><span class=\"line\">      self.status = <span class=\"string\">'rejected'</span>;</span><br><span class=\"line\">      <span class=\"comment\">// æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;</span></span><br><span class=\"line\">      self.onRejected.forEach(<span class=\"function\"><span class=\"params\">fn</span> =&gt;</span> fn())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  executor(resolve, reject);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">MyPromise.prototype.then = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">onFulfilled, onRejected</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'fulfilled'</span>) &#123;</span><br><span class=\"line\">    onFulfilled(self.value);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'rejected'</span>) &#123;</span><br><span class=\"line\">    onRejected(self.reason);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœæ˜¯pendingåº”è¯¥å­˜å‚¨å½“å‰çš„å›è°ƒå‡½æ•°</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">    self.onResolved.push(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      onFulfilled(self.value)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    self.onRejected.push(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      onRejected(self.reason)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> MyPromise(<span class=\"function\">(<span class=\"params\">resolve, reject</span>)=&gt;</span>&#123;</span><br><span class=\"line\">  setTimeout(<span class=\"function\"><span class=\"params\">()</span>=&gt;</span>&#123;</span><br><span class=\"line\">    resolve(<span class=\"number\">4</span>)</span><br><span class=\"line\">  &#125;, <span class=\"number\">1000</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">p.then(<span class=\"function\">(<span class=\"params\">res</span>)=&gt;</span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//4 res</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(res, <span class=\"string\">'res'</span>)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">p.then(<span class=\"function\">(<span class=\"params\">res1</span>)=&gt;</span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">//4 res1</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(res1, <span class=\"string\">'res1'</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>æ˜¯ä¸æ˜¯åªæœ‰<code>console.log(res1, &#39;res1&#39;)</code>å•¦ï¼Ÿå› ä¸ºæ‰§è¡Œ<code>then</code>çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„resolveè¿˜æœ‰æ²¡æœ‰è¢«è°ƒç”¨ï¼Œå¦‚æœæˆ‘ä»¬æœ‰å¤šä¸ª<code>then</code>çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦æŠŠä»–ä»¬å­˜å‚¨èµ·æ¥ï¼Œç„¶åä¾æ¬¡è°ƒç”¨ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨åˆ°æ•°ç»„ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ˜¯åˆ«çš„æ–¹æ³•ï¼Œæ ¸å¿ƒæ€æƒ³å°±æ˜¯æŠŠä»–ä»¬å­˜èµ·æ¥ï¼Œåœ¨éœ€è¦è°ƒç”¨çš„æ—¶å€™è°ƒç”¨ã€‚</p>\n<p>æ˜¯ä¸æ˜¯å¾ˆå¥½ç†è§£ï¼Ÿï¼ï¼</p>\n<p>å¬æ‡‚æŒå£°ï¼</p>\n<p>è€Œä¸”A+ä¹Ÿè¦æ±‚äº†ã€‚</p>\n<blockquote>\n<p><code>2.2.6:then</code> may be called multiple times on the same promise.</p>\n<p>ï¼ˆpromise çš„ <code>then</code> å¯ä»¥é“¾å¼è°ƒç”¨å¤šæ¬¡ï¼‰</p>\n<p>2.2.6.1ï¼šIf/when <code>promise</code> is fulfilled, all respective <code>onFulfilled</code> callbacks must execute in the order of their originating calls to <code>then</code>.</p>\n<p>ï¼ˆå¦‚æœæˆ–å½“ promise è½¬æ€æ˜¯ fulfilled æ—¶ï¼Œæ‰€æœ‰çš„ onFulfilled å›è°ƒå›ä»¥ä»–ä»¬æ³¨å†Œæ—¶çš„é¡ºåºä¾æ¬¡æ‰§è¡Œï¼‰</p>\n<p>2.2.6.2ï¼šIf/when <code>promise</code> is rejected, all respective <code>onRejected</code> callbacks must execute in the order of their originating calls to <code>then</code>.</p>\n<p>ï¼ˆå¦‚æœæˆ–å½“ promise è½¬æ€æ˜¯ rejected æ—¶ï¼Œæ‰€æœ‰çš„ onRejected å›è°ƒå›ä»¥ä»–ä»¬æ³¨å†Œæ—¶çš„é¡ºåºä¾æ¬¡æ‰§è¡Œï¼‰</p>\n</blockquote>\n<p>æˆ‘ä»¬å¯¹promiseçš„ç†è§£æ›´è¿›ä¸€æ­¥äº†ã€‚è®°å¾—æŠŠä»£ç æ”¹å›å»ï¼Œç»§ç»­å¾€ä¸‹èµ°ã€‚</p>\n<p>åˆšåˆšæˆ‘ä»¬çš„demoè¿˜ä¸å¤Ÿé²æ£’ï¼Œè€Œä¸”æˆ‘ä»¬çš„æµ‹è¯•ç”¨ä¾‹éƒ½æ˜¯å®Œç¾æƒ…å†µä¸‹ã€‚</p>\n<p>æ¥ä¸‹æ¥è¦å‰‘èµ°åé”‹äº†ã€‚</p>\n<blockquote>\n<p>A+:</p>\n<p>2.2.1ï¼šBoth <code>onFulfilled</code> and <code>onRejected</code> are optional arguments:</p>\n<p>ï¼ˆonFulfilled å’Œ onRejected éƒ½æ˜¯å¯é€‰å‚æ•°ï¼šï¼‰</p>\n<p>2.2.1.1 If <code>onFulfilled</code> is not a function, it must be ignored.</p>\n<p>ï¼ˆå¦‚æœ onFulfilled ä¸æ˜¯å‡½æ•°ï¼Œå®ƒä¼šè¢«å¿½ç•¥ï¼‰</p>\n<p>2.2.1.2 If <code>onRejected</code> is not a function, it must be ignored.</p>\n<p>ï¼ˆå¦‚æœ onRejected ä¸æ˜¯å‡½æ•°ï¼Œå®ƒä¼šè¢«å¿½ç•¥ï¼‰</p>\n<p>2.2.7.2: If either <code>onFulfilled</code> or <code>onRejected</code> throws an exception <code>e</code>, <code>promise2</code> must be rejected with <code>e</code> as the reason.</p>\n<p>ï¼ˆå¦‚æœ onFulfilled æˆ– onRejected é‡ŒæŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸ï¼Œé‚£ä¹ˆ promise2 å¿…é¡»æ•è·è¿™ä¸ªé”™è¯¯ï¼ˆæ¥å—ä¸€ä¸ª reason å‚æ•°ï¼‰ï¼‰</p>\n</blockquote>\n<p>æ‰€ä»¥æˆ‘ä»¬é¦–å…ˆè¦åšçš„å°±æ˜¯ï¼ŒæŠŠé”™è¯¯ç»™æå‰æ•è·ï¼Œç„¶åä¸¢ç»™<code>reject</code></p>\n<p>emmmâ€¦.æ¥ä¸‹æˆ‘è´´ä»£ç éƒ½æ˜¯ä¸€èµ·è´´äº†ï¼Œå› ä¸ºæˆ‘æ€•æœ‰åŒå­¦ä¼šæ‰é˜Ÿï¼Œé‡Œé¢ä¹Ÿä¼šæœ‰ç›¸åº”çš„æ³¨é‡Šå¸®åŠ©ä¼šèµ°ç¥çš„åŒå­¦è·Ÿç´§è¿™è¾†äº”è±å®å…‰ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">MyPromise</span>(<span class=\"params\">executor</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  self.status = <span class=\"string\">'pending'</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨æˆåŠŸçš„å€¼</span></span><br><span class=\"line\">  self.value = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨å¤±è´¥çš„å€¼</span></span><br><span class=\"line\">  self.reason = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨æˆåŠŸçš„å›è°ƒ</span></span><br><span class=\"line\">  self.onResolved = [];</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨å¤±è´¥çš„å›è°ƒ</span></span><br><span class=\"line\">  self.onRejected = [];</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolve</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å­˜ä¸‹æˆåŠŸçš„å€¼</span></span><br><span class=\"line\">      self.value = value</span><br><span class=\"line\">      self.status = <span class=\"string\">'fulfilled'</span>;</span><br><span class=\"line\">      <span class=\"comment\">// æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;</span></span><br><span class=\"line\">      self.onResolved.forEach(<span class=\"function\"><span class=\"params\">fn</span> =&gt;</span> fn())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">reject</span>(<span class=\"params\">reason</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å­˜ä¸‹å¤±è´¥çš„å€¼</span></span><br><span class=\"line\">      self.reason = reason</span><br><span class=\"line\">      self.status = <span class=\"string\">'rejected'</span>;</span><br><span class=\"line\">      <span class=\"comment\">// æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;</span></span><br><span class=\"line\">      self.onRejected.forEach(<span class=\"function\"><span class=\"params\">fn</span> =&gt;</span> fn())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// æ•è·é”™è¯¯ä¼ ç»™rejectã€‚æ³•å¾‹è§„å®šï¼</span></span><br><span class=\"line\">\t<span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">  \texecutor(resolve, reject);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span>(e) &#123;</span><br><span class=\"line\">    reject(e);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">MyPromise.prototype.then = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">onFulfilled, onRejected</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœä¸æ˜¯å‡½æ•°å°±å¿½ç•¥ 2.2.1.1</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'fulfilled'</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">typeof</span> onFulfilled === <span class=\"string\">'function'</span> &amp;&amp; onFulfilled(self.value);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'rejected'</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">typeof</span> onFulfilled === <span class=\"string\">'function'</span> &amp;&amp; onRejected(self.reason);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœæ˜¯pendingåº”è¯¥å­˜å‚¨å½“å‰çš„å›è°ƒå‡½æ•°</span></span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœä¸æ˜¯å‡½æ•°å°±å¿½ç•¥ 2.2.1.2</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœä¸æ˜¯å‡½æ•°å°±å¿½ç•¥ 2.2.1.1</span></span><br><span class=\"line\">    <span class=\"keyword\">typeof</span> onFulfilled === <span class=\"string\">'function'</span> &amp;&amp; self.onResolved.push(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      onFulfilled(self.value)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœä¸æ˜¯å‡½æ•°å°±å¿½ç•¥ 2.2.1.2</span></span><br><span class=\"line\">    <span class=\"keyword\">typeof</span> onFulfilled === <span class=\"string\">'function'</span> &amp;&amp; self.onRejected.push(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      onRejected(self.reason)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"é“¾å¼è°ƒç”¨then\"><a href=\"#é“¾å¼è°ƒç”¨then\" class=\"headerlink\" title=\"é“¾å¼è°ƒç”¨then\"></a>é“¾å¼è°ƒç”¨then</h4><p>å¼€å§‹å‡†å¤‡è¿›å…¥promiseçš„éš¾ç‚¹ä»¥åŠæ ¸å¿ƒç‚¹ï¼šé“¾å¼è°ƒç”¨ã€‚</p>\n<blockquote>\n<p>2.2.7ï¼š<code>then</code> must return a promise</p>\n<p>ï¼ˆthen æ–¹æ³•ä¸€å®šè¿”å›ä¸€ä¸ª promiseï¼‰</p>\n</blockquote>\n<p>æˆ‘ä»¬éœ€è¦è¿”å›æ–°çš„promiseçš„è¯ï¼Œå¯ä»¥ç®€å•å®ç°ï¼Œå¿«é€Ÿè¿­ä»£ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Promise</span>.prototype.then = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">onFulfilled, onRejected</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> promise2 = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>)=&gt;</span>&#123;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> promise2</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>2.2.7.1ï¼šIf either <code>onFulfilled</code> or <code>onRejected</code> returns a value <code>x</code>, run the Promise Resolution Procedure <code>[[Resolve]](promise2, x)</code>.</p>\n<p>ï¼ˆå¦‚æœ onFulfilled æˆ– onRejected è¿”å›çš„æ˜¯ä¸€ä¸ª xï¼Œé‚£ä¹ˆå®ƒä¼šä»¥[[Resolve]](promise2, x)` å¤„ç†è§£æï¼‰</p>\n<p>2.2.7.2ï¼šIf either <code>onFulfilled</code> or <code>onRejected</code> throws an exception <code>e</code>, <code>promise2</code> must be rejected with <code>e</code> as the reason.</p>\n<p>ï¼ˆå¦‚æœ onFulfilled æˆ– onRejected é‡ŒæŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸ï¼Œé‚£ä¹ˆ promise2 å¿…é¡»æ•è·è¿™ä¸ªé”™è¯¯ï¼ˆæ¥å—ä¸€ä¸ª reason å‚æ•°ï¼‰ï¼‰</p>\n<p>2.2.7.3ï¼šIf <code>onFulfilled</code> is not a function and <code>promise1</code> is fulfilled, <code>promise2</code> must be fulfilled with the same value as <code>promise1</code>.</p>\n<p>ï¼ˆå¦‚æœ onFulfilled ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸” promise1 çŠ¶æ€æ˜¯ fulfilledï¼Œé‚£ä¹ˆ promise2 ä¸€å®šä¼šæ¥å—åˆ°ä¸ promse1 ä¸€æ ·çš„å€¼ valueï¼‰</p>\n<p>2.2.7.4ï¼šIf <code>onRejected</code> is not a function and <code>promise1</code> is rejected, <code>promise2</code> must be rejected with the same reason as <code>promise1</code>.</p>\n<p>ï¼ˆå¦‚æœ onRejected ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸” promise1 çŠ¶æ€æ˜¯ rejectedï¼Œpromise2 ä¸€å®šä¼šæ¥å—åˆ°ä¸ promise1 ä¸€æ ·çš„å€¼ reasonï¼‰</p>\n</blockquote>\n<p>æˆ‘ä»¬éœ€è¦å°†è¿”å›å†…å®¹promiseåŒ–ï¼Œéœ€è¦å¯¹onFulfilledå’ŒonRejectedè¿›è¡Œé”™è¯¯å¤„ç†ï¼Œè¿™ä¸ªæˆ‘ä»¬ä¹‹å‰å°±å¤„ç†è¿‡äº†ï¼Œå¦‚æœonFulfilledå’ŒonRejectedæ²¡æœ‰ä¼ å‚å°±ç»§ç»­ä¼ é€’ï¼ŒåŸç”ŸğŸŒ°æ¥ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve, reject</span>)</span>&#123;</span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        resolve(<span class=\"number\">3</span>)</span><br><span class=\"line\">    &#125;, <span class=\"number\">1000</span>)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">p.then(<span class=\"number\">1</span>,<span class=\"number\">1</span>)</span><br><span class=\"line\">.then(<span class=\"string\">''</span>,<span class=\"string\">''</span>)</span><br><span class=\"line\">.then()</span><br><span class=\"line\">.then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//3</span></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(res)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>è¿™é‡Œä¸ç®¡onFulfilledå’ŒonRejectedä¼ ä»€ä¹ˆå€¼ï¼Œåªè¦ä¸æ˜¯å‡½æ•°ï¼Œå°±ç»§ç»­å‘ä¸‹ä¼ å…¥ï¼Œç›´åˆ°æœ‰å‡½æ•°è¿›è¡Œæ¥æ”¶ï¼›è¦åšçš„äº‹æƒ…å¤ªå¤šäº†ï¼Œä¸å½“å½“æ˜¯åˆ¤æ–­å‡½æ•°è¿™ç§ç®€å•çš„åˆ¤æ–­äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æŠ½ç¦»ä¸€ä¸ªæ–°çš„å‡½æ•°æ¥å¤ç”¨ç»Ÿä¸€å¤„ç†ã€‚å› æ­¤æˆ‘ä»¬è¿›è¡Œå¦‚ä¸‹å®Œå–„ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">MyPromise</span>(<span class=\"params\">executor</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// æŠ¥é”™thisçš„æŒ‡å‘ï¼Œåé¢å¯èƒ½ä¼šæœ‰å›è°ƒå‡½æ•°ï¼Œç„¶åä¼šéšå¼ä¸¢å¤±å•Šä¹‹ç±»çš„ã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">  self.status = <span class=\"string\">'pending'</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨æˆåŠŸçš„å€¼</span></span><br><span class=\"line\">  self.value = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨å¤±è´¥çš„å€¼</span></span><br><span class=\"line\">  self.reason = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨æˆåŠŸçš„å›è°ƒ</span></span><br><span class=\"line\">  self.onResolved = [];</span><br><span class=\"line\">  <span class=\"comment\">// å­˜å‚¨å¤±è´¥çš„å›è°ƒ</span></span><br><span class=\"line\">  self.onRejected = [];</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolve</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å­˜ä¸‹æˆåŠŸçš„å€¼</span></span><br><span class=\"line\">      self.value = value</span><br><span class=\"line\">      self.status = <span class=\"string\">'fulfilled'</span>;</span><br><span class=\"line\">      <span class=\"comment\">// æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;</span></span><br><span class=\"line\">      self.onResolved.forEach(<span class=\"function\"><span class=\"params\">fn</span> =&gt;</span> fn())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">reject</span>(<span class=\"params\">reason</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 2.1.1è§„å®šåªæœ‰åœ¨pendingçŠ¶æ€çš„æ—¶å€™æ‰å¯ä»¥è½¬å˜</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å­˜ä¸‹å¤±è´¥çš„å€¼</span></span><br><span class=\"line\">      self.reason = reason</span><br><span class=\"line\">      self.status = <span class=\"string\">'rejected'</span>;</span><br><span class=\"line\">      <span class=\"comment\">// æ‰§è¡Œæˆ‘ä»¬å­˜å‚¨çš„å‡½æ•°;</span></span><br><span class=\"line\">      self.onRejected.forEach(<span class=\"function\"><span class=\"params\">fn</span> =&gt;</span> fn())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// æ•è·é”™è¯¯ä¼ ç»™rejectã€‚æ³•å¾‹è§„å®šï¼</span></span><br><span class=\"line\">\t<span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">  \texecutor(resolve, reject);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span>(e) &#123;</span><br><span class=\"line\">    reject(e);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolvePromise</span>(<span class=\"params\">promise2, res, resolve, reject</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœpromise2å’Œç»“æœç›¸åŒï¼Œå°±è‡ªå·±æ— é™å¾ªç¯è°ƒç”¨è‡ªå·±çš„thenäº†ï¼Œæ­»äº¡å¾ªç¯ã€‚</span></span><br><span class=\"line\">  <span class=\"comment\">// ä¸¾ä¸ªğŸŒ°ï¼švar a = function()&#123;return a&#125;ï¼Œè¿™ä¸ªthenåˆä¼šè‡ªå·±æ— é™è§¦å‘ã€‚æ‰€ä»¥å°±ç©å®Œäº†ã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(promise2 === res) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> reject(<span class=\"keyword\">new</span> <span class=\"built_in\">TypeError</span>(<span class=\"string\">'å¾ªç¯å¼•ç”¨'</span>))</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(</span><br><span class=\"line\">    res !== <span class=\"literal\">null</span> </span><br><span class=\"line\">    &amp;&amp; (<span class=\"keyword\">typeof</span> res === <span class=\"string\">'object'</span>) || <span class=\"keyword\">typeof</span> res === <span class=\"string\">'function'</span>)</span><br><span class=\"line\">  ) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// ä¿å­˜æ˜¯å¦å·²ç»è°ƒç”¨è¿‡å‡½æ•°ã€‚</span></span><br><span class=\"line\">      <span class=\"comment\">// 2.3.3.3.3 If both resolvePromise and rejectPromise are called, or multiple calls to the same argument are made, the first call takes precedence, and any further calls are ignored.(å¦‚æœ resolvePromise å’Œ rejectPromise å·²ç»è¢«è°ƒç”¨æˆ–ä»¥ç›¸åŒçš„å‚æ•°å¤šæ¬¡è°ƒç”¨çš„è¯å—ï¼Œä¼˜å…ˆç¬¬ä¸€æ¬¡çš„è°ƒç”¨ï¼Œå¹¶ä¸”ä¹‹åçš„è°ƒç”¨å…¨éƒ¨è¢«å¿½ç•¥ï¼ˆé¿å…å¤šæ¬¡è°ƒç”¨ï¼‰)</span></span><br><span class=\"line\">      <span class=\"keyword\">let</span> used = <span class=\"literal\">false</span>;</span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"comment\">// 2.3.3.1ï¼šLet then be x.then. [3.5](æŠŠ x.then èµ‹å€¼ç»™ then å˜é‡)</span></span><br><span class=\"line\">      <span class=\"comment\">// å¯ä»¥æé˜²æœ‰äººæ¶æã€‚åƒğŸ‘‡</span></span><br><span class=\"line\">      <span class=\"comment\">// Object.defineProperty(Promise, 'then', &#123;</span></span><br><span class=\"line\">      <span class=\"comment\">//    get: function()&#123;</span></span><br><span class=\"line\">      <span class=\"comment\">//        throw Error('error')</span></span><br><span class=\"line\">      <span class=\"comment\">//    &#125;</span></span><br><span class=\"line\">      <span class=\"comment\">// &#125;)</span></span><br><span class=\"line\">      <span class=\"comment\">// è¿™æ ·çš„è¯æˆ‘ä»¬å–å€¼å°±ä¼šæŠ¥é”™ã€‚</span></span><br><span class=\"line\">      <span class=\"keyword\">let</span> then = res.then;</span><br><span class=\"line\">      <span class=\"comment\">// å¦‚æœthenæ˜¯å‡½æ•°ï¼Œå°±é»˜è®¤æ˜¯promiseäº†   </span></span><br><span class=\"line\">      <span class=\"keyword\">if</span>(<span class=\"keyword\">typeof</span> then === <span class=\"string\">'function'</span>) &#123;</span><br><span class=\"line\">        then.call(</span><br><span class=\"line\">          res, </span><br><span class=\"line\">          value =&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(used) &#123;</span><br><span class=\"line\">              <span class=\"keyword\">return</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            used = <span class=\"literal\">true</span>;</span><br><span class=\"line\">            <span class=\"comment\">// é€’å½’è§£æï¼Œç›´åˆ°ä¸æ˜¯ä¸€ä¸ªpromiseä¸ºæ­¢</span></span><br><span class=\"line\">            resolvePromise(promise2, value, resolve, reject);</span><br><span class=\"line\">        \t&#125;,</span><br><span class=\"line\">          reason =&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(used) &#123;</span><br><span class=\"line\">              <span class=\"keyword\">return</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            used = <span class=\"literal\">true</span>;</span><br><span class=\"line\">            reject(reason);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        )</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(used) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      used = <span class=\"literal\">true</span>;</span><br><span class=\"line\">      reject(e);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœä¸æ˜¯å‡½æ•°æˆ–è€…å¯¹è±¡ä¹Ÿä¸ä¸ºç©ºå°±ç›´æ¥ç»§ç»­ä¼ é€’è¿™ä¸ªå€¼ã€‚</span></span><br><span class=\"line\">\t  resolve(res);  </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">MyPromise.prototype.then = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">onFulfilled, onRejected</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> self = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  <span class=\"comment\">// åªæœ‰promiseæ‰å¯ä»¥æŒç»­çš„é“¾å¼è°ƒç”¨then,æ‰€ä»¥è¿™é‡Œå¼„äº†ä¸€ä¸ªæ–°çš„promise</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> promise2 = <span class=\"keyword\">new</span> MyPromise(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'fulfilled'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> res = onFulfilled(self.value);</span><br><span class=\"line\">      resolvePromise(promise2, res, resolve, reject);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// å½“å‰çš„çŠ¶æ€ï¼ˆfulfilled/rejected/pendingï¼‰ï¼Œé»˜è®¤å€¼ä¸ºpending</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'rejected'</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> res = onRejected(self.reason);</span><br><span class=\"line\">      resolvePromise(promise2, res, resolve, reject);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœæ˜¯pendingåº”è¯¥å­˜å‚¨å½“å‰çš„å›è°ƒå‡½æ•°</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(self.status === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">      self.onResolved.push(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> res = onFulfilled(self.value);</span><br><span class=\"line\">      resolvePromise(promise2, res, resolve, reject);</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">      self.onRejected.push(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> res = onRejected(self.reason);</span><br><span class=\"line\">      resolvePromise(promise2, res, resolve, reject);</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä»¥ä¸Šå°±æ˜¯ç¬¦åˆ Promise/A+ è§„èŒƒçš„å®ç°äº†ï¼Œå¦‚æœä½ å¯¹äºè¿™éƒ¨åˆ†ä»£ç å°šæœ‰ç–‘é—®ï¼Œæ¬¢è¿åœ¨è¯„è®ºä¸­ä¸æˆ‘äº’åŠ¨ã€‚</p>\n<h2 id=\"Generator\"><a href=\"#Generator\" class=\"headerlink\" title=\"Generator\"></a>Generator</h2><blockquote>\n<p>é¢è¯•é¢˜ï¼šä»‹ç»ä¸€ä¸‹generatorå§ã€‚</p>\n</blockquote>\n<p>å¾ˆå¤šå°ä¼™ä¼´å¯èƒ½å’Œæˆ‘ä¸€æ ·ï¼Œåªæ˜¯ä¼šç”¨ï¼Œä½†æ˜¯ä½ ç¡¬è¦æˆ‘ä»‹ç»ï¼Œé‚£æˆ‘å’‹æï¼Ÿgeneratorçš„æ‹¼å†™æ˜¯g e n e r a t o rï¼Ÿ</p>\n<p>â€œå“”â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€</p>\n<p>å…¶å®æˆ‘é‡æ¸©äº†ä¸€ä¸‹é˜®è€å¸ˆçš„es6è¯¾ç¨‹ï¼Œå‘ç°å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ¥ä»‹ç»ã€‚</p>\n<ul>\n<li>å½¢å¼ä¸Š<ul>\n<li>generatorå’Œæ™®é€šçš„å‡½æ•°ä¸åŒç‚¹åœ¨äºï¼Œå¯¹ä¸€ä¸ª<code>*</code>å·ï¼Œå‡½æ•°å†…éƒ¨ä½¿ç”¨äº†yieldè¡¨è¾¾å¼</li>\n</ul>\n</li>\n<li>è¯­æ³•ä¸Š<ul>\n<li>Generatorå‡½æ•°å°è£…äº†å¤šä¸ªå†…éƒ¨çŠ¶æ€(é€šè¿‡yieldè¡¨è¾¾å¼å®šä¹‰å†…éƒ¨çŠ¶æ€)ã€‚æ‰§è¡ŒGeneratorå‡½æ•°æ—¶ä¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡(Iteratorå¯¹è±¡)ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒGeneratoræ˜¯éå†å™¨å¯¹è±¡ç”Ÿæˆå‡½æ•°ï¼Œå‡½æ•°å†…éƒ¨å°è£…äº†å¤šä¸ªçŠ¶æ€ã€‚é€šè¿‡è¿”å›çš„Iteratorå¯¹è±¡ï¼Œå¯ä»¥ä¾æ¬¡éå†(è°ƒç”¨nextæ–¹æ³•)Generatorå‡½æ•°çš„æ¯ä¸ªå†…éƒ¨çŠ¶æ€ã€‚</li>\n</ul>\n</li>\n<li>è°ƒç”¨ä¸Š<ul>\n<li>æ™®é€šå‡½æ•°åœ¨è°ƒç”¨ä¹‹åä¼šç«‹å³æ‰§è¡Œï¼Œè€ŒGeneratorå‡½æ•°è°ƒç”¨ä¹‹åä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯ä¼šè¿”å›éå†å™¨å¯¹è±¡(Iteratorå¯¹è±¡)ã€‚é€šè¿‡Iteratorå¯¹è±¡çš„nextæ–¹æ³•æ¥éå†å†…éƒ¨yieldè¡¨è¾¾å¼å®šä¹‰çš„æ¯ä¸€ä¸ªçŠ¶æ€ã€‚</li>\n</ul>\n</li>\n</ul>\n<p>å…¶å®æˆ‘è§‰å¾—ï¼Œå¦‚æœèƒ½æŠŠä¸‹é¢çš„è¿™ä¸ªæ¡ˆä¾‹å¼„æ¸…æ¥šï¼Œgeneratorå°±ç®—è¿‡å…³äº†ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> *<span class=\"title\">foo</span>(<span class=\"params\">x</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> y = <span class=\"number\">2</span> * (<span class=\"keyword\">yield</span> (x + <span class=\"number\">1</span>))</span><br><span class=\"line\">  <span class=\"keyword\">let</span> z = <span class=\"keyword\">yield</span> (y / <span class=\"number\">3</span>)</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (x + y + z)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> it = foo(<span class=\"number\">5</span>)</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(it.next())   <span class=\"comment\">// =&gt; &#123;value: 6, done: false&#125;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(it.next(<span class=\"number\">12</span>)) <span class=\"comment\">// =&gt; &#123;value: 8, done: false&#125;</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(it.next(<span class=\"number\">13</span>)) <span class=\"comment\">// =&gt; &#123;value: 42, done: true&#125;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>é¦–å…ˆ <code>Generator</code> å‡½æ•°è°ƒç”¨å’Œæ™®é€šå‡½æ•°ä¸åŒï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªè¿­ä»£å™¨</li>\n<li>å½“æ‰§è¡Œç¬¬ä¸€æ¬¡ <code>next</code> æ—¶ï¼Œä¼ å‚ä¼šè¢«å¿½ç•¥ï¼Œå¹¶ä¸”å‡½æ•°æš‚åœåœ¨ <code>yield (x + 1)</code> å¤„ï¼Œæ‰€ä»¥è¿”å› <code>5 + 1 = 6</code></li>\n<li>å½“æ‰§è¡Œç¬¬äºŒæ¬¡ <code>next</code> æ—¶ï¼Œä¼ å…¥çš„å‚æ•°ç­‰äºä¸Šä¸€ä¸ª <code>yield</code> çš„è¿”å›å€¼ï¼Œå¦‚æœä½ ä¸ä¼ å‚ï¼Œ<code>yield</code> æ°¸è¿œè¿”å› <code>undefined</code>ã€‚æ­¤æ—¶ <code>let y = 2 * 12</code>ï¼Œæ‰€ä»¥ç¬¬äºŒä¸ª <code>yield</code> ç­‰äº <code>2 * 12 / 3 = 8</code></li>\n<li>å½“æ‰§è¡Œç¬¬ä¸‰æ¬¡ <code>next</code> æ—¶ï¼Œä¼ å…¥çš„å‚æ•°ä¼šä¼ é€’ç»™ <code>z</code>ï¼Œæ‰€ä»¥ <code>z = 13, x = 5, y = 24</code>ï¼Œç›¸åŠ ç­‰äº <code>42</code></li>\n</ul>\n<h2 id=\"async-await\"><a href=\"#async-await\" class=\"headerlink\" title=\"async/await\"></a>async/await</h2><blockquote>\n<p>ä»€ä¹ˆæ˜¯async/awaitï¼Ÿ</p>\n</blockquote>\n<p>å…¶å®å°±ä¸€å¥è¯ï¼š<strong>async å‡½æ•°å°±æ˜¯ Generator å‡½æ•°çš„è¯­æ³•ç³–ã€‚</strong></p>\n<p>generatorï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> gen = <span class=\"function\"><span class=\"keyword\">function</span>* (<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> f1 = <span class=\"keyword\">yield</span> readFile(<span class=\"string\">'/etc/fstab'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> f2 = <span class=\"keyword\">yield</span> readFile(<span class=\"string\">'/etc/shells'</span>);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(f1.toString());</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(f2.toString());</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>Async:</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> asyncReadFile = <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> f1 = <span class=\"keyword\">await</span> readFile(<span class=\"string\">'/etc/fstab'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">var</span> f2 = <span class=\"keyword\">await</span> readFile(<span class=\"string\">'/etc/shells'</span>);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(f1.toString());</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(f2.toString());</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>ä¸€æ¯”è¾ƒå°±ä¼šå‘ç°ï¼Œasync å‡½æ•°å°±æ˜¯å°† Generator å‡½æ•°çš„æ˜Ÿå·ï¼ˆ*ï¼‰æ›¿æ¢æˆ asyncï¼Œå°† yield æ›¿æ¢æˆ awaitï¼Œä»…æ­¤è€Œå·²ã€‚</p>\n<p>asyncå¯¹generatorè¿›è¡Œäº†ä»¥ä¸‹ä¸‰ç‚¹çš„æ”¹è¿›ï¼š</p>\n<ol>\n<li><strong>å†…ç½®æ‰§è¡Œå™¨ã€‚</strong> Generator å‡½æ•°çš„æ‰§è¡Œå¿…é¡»é æ‰§è¡Œå™¨ï¼Œæ‰€ä»¥æ‰æœ‰äº† co å‡½æ•°åº“ï¼Œè€Œ async å‡½æ•°è‡ªå¸¦æ‰§è¡Œå™¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œasync å‡½æ•°çš„æ‰§è¡Œï¼Œä¸æ™®é€šå‡½æ•°ä¸€æ¨¡ä¸€æ ·ï¼Œåªè¦ä¸€è¡Œã€‚</li>\n<li><strong>æ›´å¥½çš„è¯­ä¹‰ã€‚</strong> async å’Œ awaitï¼Œæ¯”èµ·æ˜Ÿå·å’Œ yieldï¼Œè¯­ä¹‰æ›´æ¸…æ¥šäº†ã€‚async è¡¨ç¤ºå‡½æ•°é‡Œæœ‰å¼‚æ­¥æ“ä½œï¼Œawait è¡¨ç¤ºç´§è·Ÿåœ¨åé¢çš„è¡¨è¾¾å¼éœ€è¦ç­‰å¾…ç»“æœã€‚</li>\n<li><strong>æ›´å¹¿çš„é€‚ç”¨æ€§ã€‚</strong> co å‡½æ•°åº“çº¦å®šï¼Œyield å‘½ä»¤åé¢åªèƒ½æ˜¯ Thunk å‡½æ•°æˆ– Promise å¯¹è±¡ï¼Œè€Œ async å‡½æ•°çš„ await å‘½ä»¤åé¢ï¼Œå¯ä»¥è·Ÿ Promise å¯¹è±¡å’ŒåŸå§‹ç±»å‹çš„å€¼ï¼ˆæ•°å€¼ã€å­—ç¬¦ä¸²å’Œå¸ƒå°”å€¼ï¼Œä½†è¿™æ—¶ç­‰åŒäºåŒæ­¥æ“ä½œï¼‰ã€‚</li>\n</ol>\n<p>ä¸€ä¸ªå‡½æ•°å¦‚æœåŠ ä¸Šäº†asyncï¼Œé‚£ä¹ˆå°±ä¼šé»˜è®¤è¿”å›ä¸€ä¸ªpromise</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fn</span>(<span class=\"params\">args</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ç­‰åŒäº</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fn</span>(<span class=\"params\">args</span>)</span>&#123; </span><br><span class=\"line\">  <span class=\"keyword\">return</span> spawn(<span class=\"function\"><span class=\"keyword\">function</span>*(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">  &#125;); </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"æ³¨æ„\"><a href=\"#æ³¨æ„\" class=\"headerlink\" title=\"æ³¨æ„\"></a>æ³¨æ„</h3><p>await å‘½ä»¤åé¢çš„ Promise å¯¹è±¡ï¼Œè¿è¡Œç»“æœå¯èƒ½æ˜¯ rejectedï¼Œæ‰€ä»¥æœ€å¥½æŠŠ await å‘½ä»¤æ”¾åœ¨ tryâ€¦catch ä»£ç å—ä¸­ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">myFunction</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">await</span> somethingThatReturnsAPromise();</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span> (err) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(err);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// å¦ä¸€ç§å†™æ³•</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">myFunction</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">await</span> somethingThatReturnsAPromise().catch(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">err</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(err);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>await å‘½ä»¤åªèƒ½ç”¨åœ¨ async å‡½æ•°ä¹‹ä¸­ï¼Œå¦‚æœç”¨åœ¨æ™®é€šå‡½æ•°ï¼Œå°±ä¼šæŠ¥é”™ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">dbFuc</span>(<span class=\"params\">db</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> docs = [&#123;&#125;, &#123;&#125;, &#123;&#125;];</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// æŠ¥é”™</span></span><br><span class=\"line\">  docs.forEach(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">doc</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">await</span> db.post(doc);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"Reference\"><a href=\"#Reference\" class=\"headerlink\" title=\"Reference\"></a>Reference</h2><blockquote>\n<p><a href=\"https://es6.ruanyifeng.com/#docs/generator\" target=\"_blank\" rel=\"noopener\">https://es6.ruanyifeng.com/#docs/generator</a></p>\n</blockquote>\n"},{"title":"ã€é¢ç»ã€‘2å¹´å‰ç«¯æ­å·é¢è¯•é›†åˆ","date":"2020-10-28T13:53:09.000Z","cover":"/image/cover/bg.jpg","_content":"\n# å‰è¨€\n\nè¯´ä¸€ç‚¹åºŸè¯å§ï¼Œç®—æ˜¯åæ§½ã€‚\n\nç°åœ¨æ­å·çš„æ°›å›´å¾ˆæ€ªï¼ŒåŒä¼‘éƒ½å¯ä»¥æ‹¿å‡ºæ¥å¹çš„é‚£ç§ã€‚å”‰ï¼Œä¸è¿‡è™½ç„¶æ˜¯ç–«æƒ…ï¼Œå‰ç«¯çš„å²—ä½è¿˜æ˜¯è›®å¤šçš„ï¼Œæˆ‘åŸºæœ¬ä¸Šä¸€å¤©2ä¸ªé¢è¯•ã€‚åœ¨æœªæ¥ç§‘æŠ€åŸå’Œæ»¨æ±Ÿä¸¤å¤´è·‘ã€‚ä¸è¿‡ç°åœ¨å·²ç»å…¥èŒå•¦ã€‚\n\n# å…¬å¸åˆ—è¡¨\n\n- å®‰æ’ç§‘æŠ€ -> æŒ‚åœ¨4é¢å‰¯æ€»è£ã€‚\n  - çœ‹äº†çŸ¥ä¹ä¸Šé¢çš„è¯„ä»·ç„¶åå»é¢çš„å‰¯æ€»è£ï¼Œå‘ç°åŠ ç­ä¸¥é‡ï¼Œç„¶åæœŸæœ›è–ªèµ„å¼€çš„æ¯”è¾ƒé«˜ï¼Œè€Œä¸”å‰¯æ€»è£æœŸé—´ä¸€ç›´åœ¨æ‘†å¼„æ‰‹æœºä¸çŸ¥é“æ˜¯ä¸æ˜¯æ¯”è¾ƒå¿™ï¼Œåœºé¢ç»å¸¸å†·é™å¥½ä¸€ä¼šã€‚\n- åšåœ£ç”Ÿç‰© -> offerï¼Œä½†æ˜¯è–ªèµ„å¼€çš„æ¯”è¾ƒä½ï¼Œæ‰€ä»¥æ²¡å»\n- æ•°ç§¦ç§‘æŠ€ -> å·²ç»å…¥èŒå•¦\n- ç«çŸ³åˆ›é€  -> æŒ‚åœ¨HRé‚£è¾¹äº†ï¼Œä¼°è®¡æ˜¯æˆ‘è·³æ§½æ¯”è¾ƒé¢‘ç¹ï¼Œè€Œä¸”é‚£å¤©å¾ˆæ™šè¿‡å»çš„ï¼Œäººå¾ˆç–²æƒ«æ²¡ä»€ä¹ˆç²¾ç¥ï¼ŒHRè¿˜é—®æˆ‘å¹³å¸¸æ˜¯ä¸æ˜¯ä¹Ÿæ˜¯è¿™æ ·æ²¡ç²¾ç¥....å°´å°¬\n- åšè”æ™ºèƒ½ -> åé¢å‘ç°å‰ç«¯å›¢é˜Ÿåªæœ‰ä¸€ä¸ªäººï¼Œè€Œä¸”é¢è¯•å®˜å¥½åƒå·¥ä½œæ²¡å¤šä¹…ã€‚ã€‚ã€‚å…¨æ˜¯ç½‘ä¸Šçš„é¢˜ç›®ï¼ŒäºŒé¢å°±æ²¡å»äº†\n- å©šç¤¼çºª -> æŒ‚åœ¨2é¢ï¼Œå‰ç«¯leaderè§‰å¾—æˆ‘nodeä¸å¤ªç†Ÿæ‚‰ï¼Œå¹¿åº¦ä¸å¤Ÿ....\n- æ•°ç«‹ä¿¡æ¯ -> æŒ‚åœ¨äºŒé¢ï¼Œä¸çŸ¥é“å…·ä½“å“ªé‡Œä¸è¡Œ....æˆ‘æ„Ÿè§‰æˆ‘éƒ½ç­”ä¸Šæ¥äº†...\n- é˜¿é‡Œé›¶å”®äº‹ä¸šéƒ¨ -> ä¸€é¢å°±æŒ‚äº†ï¼Œé‚£ä¸ªæ—¶å€™åˆšåˆšååŠ¨è½¦åˆ°æ­å·ï¼Œç¡®å®ä¹Ÿæ²¡æ€ä¹ˆå‡†å¤‡ï¼Œå¾ˆå¯æƒœï¼\n- å…‰äº‘ç§‘æŠ€ -> æˆ‘æœŸæœ›å¼€çš„å¤ªé«˜äº†....ç„¶åæŒ‚åœ¨äº†HR\n\n# é¢ç»\n\n## é˜¿é‡Œ-é›¶å”®éƒ¨\n\n### 1é¢\n\n1. jsbridgeçš„åŸç†\n2. è·¨åŸŸçš„åœºæ™¯ä½ ç”¨åˆ°é‚£äº›ï¼Ÿ\n3. jsonpçš„åŸç†ï¼Œjsonpæ€ä¹ˆç”¨\n4. æœ‰æ•°æ®ç›¸å…³çš„å—ï¼Ÿæ¯”å¦‚PVï¼ŒUV\n5. px to remçš„åŸç†èƒ½è¯´ä¸€ä¸‹å—ï¼Ÿ\n6. å…·ä½“æ€ä¹ˆç®—çš„å¯ä»¥è¯´ä¸€ä¸‹å—ï¼Ÿ\n7. onClickæ˜¯ä»€ä¹ˆæ—¶å€™æ‰§è¡Œçš„ï¼Ÿ\n8. å¦‚æœæˆ‘å†™äº†ä¸€ä¸ªaddListenerï¼Œç„¶ååˆå†™äº†onCLickï¼Œè¿™ä¸ªæ—¶å€™ç‚¹å‡»ä¸€ä¸‹ä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…ï¼Ÿ\n9. å‰ç«¯æ€§èƒ½ä¼˜åŒ–\n10. happypackåŸç†\n11. reactçš„è™šæ‹ŸDOMç®—æ³•\n\n## å®‰æ’ç§‘æŠ€\n\n### 1é¢\n\n1. ç±»ç»„ä»¶å’Œå‡½æ•°å¼ç»„ä»¶çš„åŒºåˆ«ï¼Œæˆ–è€…è¯´ä¸€ä¸‹ä½ ä½¿ç”¨æœ€ç›´æ¥çš„æ„Ÿå—ï¼Œä»¥åŠä»–ä»¬çš„ä¼˜ç¼ºç‚¹\n2. æœ‰è¯•è¿‡è‡ªå·±å°è£…Hookå—ï¼Ÿ\n3. æ”¹å˜thisæŒ‡å‘çš„æ–¹å¼é™¤äº†bindä»¥åŠç®­å¤´å‡½æ•°è¿˜æœ‰å“ªäº›ï¼Ÿ\n4. ä¸ºä»€ä¹ˆReactä¸­onClickåœ¨ç‚¹å‡»çš„æ—¶å€™ä¼šæ‰§è¡Œï¼Ÿ\n5. Reactä¸­keyçš„ä½œç”¨\n6. React Fiberä½ äº†è§£å—ï¼Ÿ\n7. è¯´ä¸€ä¸‹è™šæ‹ŸDOMçš„ä¼˜ç¼ºç‚¹\n8. å¼€å‘ä¸­ç”¨åˆ°Reduxæ˜¯è‡ªå·±å°è£…çš„å—ï¼Ÿ\n9. Reactç±»ç»„ä»¶çš„extendså’ŒcreateElementæœ‰ä»€ä¹ˆåŒºåˆ«å—ï¼Ÿ\n10. ç»„ä»¶åå­—é¦–å­—æ¯ä¸ºä»€ä¹ˆä¸€å®šè¦å¤§å†™ï¼Ÿ\n11. ES5ä¸­åˆ¤æ–­æ•°ç»„æœ‰ä»€ä¹ˆæ–¹å¼ï¼Ÿ\n12. æ€ä¹ˆæ ·å¹¶å‘è¯·æ±‚ï¼Ÿ\n13. å‰ç«¯æ€§èƒ½ä¼˜åŒ–\n14. æœ‰ç”¨è¿‡Typescriptå—ï¼Ÿä»‹ç»ä¸€ä¸‹ä½ å¹³å¸¸å¸¸ç”¨çš„\n15. å·¥ä½œä¸­é‡åˆ°æœ€éš¾çš„é—®é¢˜\n16. å¹³å¸¸æ˜¯æ€ä¹ˆå­¦ä¹ çš„\n\n### 2é¢\n\næœ¬æ¥è¦é¢è¯•æˆ‘çš„äºŒé¢çš„é¢è¯•å®˜é›¶æ—¶æœ‰äº‹ï¼Œè¿™ä¸ªæ˜¯éš”å£ç»„çš„leaderã€‚ã€‚\n\n1. å°è£…ä¸€ä¸ªç½‘ç»œè¯·æ±‚æ˜¯æ€ä¹ˆå°è£…çš„ï¼Œè¦è¾¾åˆ°ä»€ä¹ˆæ ·çš„æ•ˆæœï¼ˆå› ä¸ºæˆ‘ç®€å†å†™äº†\n2. è¯´ä¸€ä¸‹ä½ å°è£…è¡¨å•ç»„ä»¶çš„æƒ³æ³•ï¼ˆä¹Ÿæ˜¯ç®€å†ã€‚ã€‚ã€‚\n3. è¯´ä¸€ä¸‹ä½ çš„é‰´æƒæ€è·¯ï¼ˆä¹Ÿæ˜¯ç®€å†\n4. ç°åœ¨Typescriptæœ‰ç”¨å—ï¼Ÿä½ è§‰å¾—è‡ªå·±Typescriptç”¨çš„æ€ä¹ˆæ ·ï¼Ÿ\n5. è¯´ä¸€ä¸‹Reactæœ€æ–°çš„ç”Ÿå‘½å‘¨æœŸ\n6. æœ‰å†™è¿‡Reduxçš„ä¸­é—´ä»¶å—ï¼Ÿ\n7. è¯´ä¸€ä¸‹React Fiberåšäº†ä¸€ä»¶ä»€ä¹ˆäº‹æƒ…\n\n### 3é¢\n\nå¿˜è®°å½•éŸ³äº†ã€‚ã€‚ã€‚é è®°å¿†åŠ›æƒ³æƒ³\n\n1. è¯´ä¸€ä¸‹äº‹ä»¶å¾ªç¯\n2. æˆ‘ä»¬å†™çš„onClickæ˜¯äº‹ä»¶æ•è·å—ï¼Ÿå’Œäº‹ä»¶å†’æ³¡çš„é¡ºåºæ˜¯æ€ä¹ˆæ ·çš„\n3. CSSçš„æƒé‡\n4. å¯¹äºè·¨åŸŸä½ æ˜¯æ€çœ‹å¾…çš„\n5. è¯´ä¸€ä¸‹ä½ å¯¹JavaScriptå†…å­˜çš„ç†è§£\n6. ä»‹ç»ä¸€ä¸‹Promiseå§\n7. è¾“å…¥URLåˆ°é¡µé¢æ¸²æŸ“å‘ç”Ÿäº†ä»€ä¹ˆ\n8. å¹³å¸¸æ˜¯æ€ä¹ˆå­¦ä¹ çš„ï¼Ÿ\n\né¢˜ç›®å¤ªå®½æ³›äº†ã€‚ã€‚ã€‚è€ƒå¯ŸçŸ¥è¯†æ·±åº¦ã€‚ã€‚\n\n### 4é¢\n\n1. ä¸ºä»€ä¹ˆä»ä¸Šå®¶å…¬å¸ç¦»èŒ\n2. è¯´ä¸€ä¸‹ä½ å¯¹åŠ ç­çš„ç†è§£\n3. å¯¹æœªæ¥çš„è§„åˆ’\n\n## åšåœ£ç”Ÿç‰©\n\n### 1é¢\n\n1. ç¦»èŒåŸå› \n2. é¡¹ç›®ä¸­å°è±¡ä¸­æ¯”è¾ƒæ·±åˆ»çš„\n3. å¯¹äºç§»åŠ¨ç«¯çš„é€‚é…\n4. é«˜æ¸…å±1pxçš„å…¼å®¹ï¼Œé«˜æ¸…å±å˜ç²—é—®é¢˜\n   1. è¦ç²¾ç¡®åˆ°æ¯ä¸€è¡Œã€‚ã€‚ã€‚\n5. è¯´ä¸€ä¸‹é˜²æŠ–èŠ‚æµçš„åŸç†\n6. JSæ‹–æ‹½åŸç†\n7. è¯´ä¸€ä¸‹flexçš„æ¯ä¸ªå±æ€§å¯¹åº”çš„æ„æ€\n8. CSSæ°´å¹³å‚ç›´å±…ä¸­\n9. æœ‰è‡ªå·±å†™è¿‡webpack loaderå’Œpluginå—ï¼Ÿä»–ä»¬çš„åŸç†å’ŒåŒºåˆ«\n\n### 2é¢\n\n1. Reactæºç æœ‰è¯»è¿‡å—ï¼Ÿ\n2. Fiberæ˜¯æ€ä¹ˆåšè°ƒåº¦çš„ï¼Œjsä¸æ˜¯å•çº¿ç¨‹å—ï¼Ÿæ˜¯æ€ä¹ˆæ‰“æ–­è®¡ç®—çš„ï¼Ÿ\n3. è¯´ä¸€ä¸‹ä½ å¹³å¸¸ç”¨çš„Hookså§\n4. ä»‹ç»å‰ç«¯æ€§èƒ½ä¼˜åŒ–\n5. å¯¹äºå‰ç«¯ä»£ç æ”»å‡»ä½ äº†è§£å“ªäº›ï¼Ÿ\n6. cookieçš„å­˜å‚¨æœ‰å“ªäº›æ–°çš„å±æ€§\n7. Http2æœ‰å“ªäº›æ–°åŠŸèƒ½\n8. httpå’Œhttpsæœ‰ä»€ä¹ˆåŒºåˆ«\n9. ä»‹ç»ä¸€ä¸‹éå¯¹ç§°åŠ å¯†\n10. JavaScriptç»§æ‰¿ç†Ÿæ‚‰å—ï¼Ÿæœ‰å“ªäº›æ–¹å¼ï¼Ÿ\n\n### 3é¢HR\n\nä¸Šæ¥å°±æºç æˆ‘ä»¥ä¸ºæˆ‘è¦å‡‰äº†ï¼Œä¸è¿‡åé¢éƒ½æœ‰å¤ä¹ åˆ°ï¼Œç®—æ˜¯æ‰³å›ä¸€åŸã€‚è°ˆè–ªã€‚\n\n## ç«çŸ³åˆ›é€ \n\næ˜¯ä¸€å®¶å‰ç«¯ä¸»å¯¼çš„å›¢é˜Ÿï¼Œå‰ç«¯äººè¶…çº§å¤š\n\n### 1é¢\n\n1. è¯´ä¸€ä¸‹ç§»åŠ¨ç«¯é€‚é…çš„åŸç†\n2. è¯´ä¸€ä¸‹å‰ç«¯æ€§èƒ½ä¼˜åŒ–\n3. å¹³å¸¸å¯¹äºè·¨åŸŸæ˜¯æ€ä¹ˆåšçš„\n4. webpackçš„pluginæœ‰åšè¿‡å—ï¼Ÿ\n5. JSçš„ç»§æ‰¿\n6. çœ‹ä½ æœ‰å°è£…è¿‡echartsï¼Œä½ æ˜¯æ€ä¹ˆå°è£…çš„\n7. Vueå’ŒReactçš„åŒºåˆ«\n8. è¯´ä¸€ä¸‹CSSåŠ¨ç”»\n9. è¯´ä¸€ä¸‹keyåœ¨Reactå’ŒVueä¸­çš„ä½œç”¨ï¼Œå¦‚æœæ²¡æœ‰ä¼šæ€ä¹ˆæ ·ï¼Ÿä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå…·ä½“\n10. RNæœ‰åšè¿‡å—ï¼ŸTaroå‘¢ï¼Ÿ\n11. ç°åœ¨æˆ‘æœ‰ä¸€ä¸ªæ•°ç»„ï¼Œæˆ‘æƒ³é’ˆå¯¹æ¯ä¸ªå…ƒç´ çš„åé¢éƒ½åŠ å…¥ä¸€ä¸ªæ–°çš„å…ƒç´ ï¼Œæœ‰å“ªäº›æ–¹æ³•\n12. å‡å¦‚æˆ‘ç”¨forçš„ç´¢å¼•æ¥åŠ ï¼Œä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ\n\n### 2é¢HR\n\nå¯èƒ½æ˜¯å¤ªæ™šäº†ï¼Œç«çŸ³æ˜¯ç¬¬ä¸‰å®¶é¢è¯•äº†ï¼Œè€Œä¸”æˆ‘åäº†å¾ˆä¹…çš„åœ°é“ï¼ŒHRå¯èƒ½è§‰å¾—æˆ‘äººæ²¡ç²¾ç¥ï¼Œä¹Ÿæœ‰å¯èƒ½æˆ‘ç¡®å®æœ‰æ¯›ç—…ã€‚ã€‚ã€‚\n\n## åšè”æ™ºèƒ½\n\n### 1é¢\n\nåŸºæœ¬ä¸Šéƒ½æ˜¯å¾ˆåŸºç¡€çš„é¢˜ç›®ã€‚æ„Ÿè§‰æ˜¯ä¹‹å‰å›¢é˜Ÿå…¨éƒ¨è·‘è·¯äº†ï¼Œåªæœ‰ä»–ä¸€ä¸ªå‰ç«¯ï¼Œè€Œä¸”åŠ ç­å¾ˆä¸¥é‡ï¼Œä»–çš„å¥½åƒæ‰åˆšåˆšæ¯•ä¸š....\n\n## å©šç¤¼çºª\n\n### 1é¢\n\n1. ä½ ç”¨è¿‡å“ªäº›Hook\n2. Hookçš„è§„åˆ™åŸç†\n3. ä¸ºä»€ä¹ˆè¦ç§»é™¤é‚£äº›ç”Ÿå‘½å‘¨æœŸ\n4. è¯´ä¸€ä¸‹æ—¶é—´å¾ªç¯\n5. setStateæ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥ï¼Ÿ\n6. setStateçš„å›è°ƒå‡½æ•°æ˜¯å®ä»»åŠ¡è¿˜æ˜¯å¾®ä»»åŠ¡\n7. webpackçƒ­æ›´æ–°åŸç†\n8. webpackçš„loaderçš„ä½œç”¨\n9. ä¸ºä»€ä¹ˆFiberå¯ä»¥ä¸­æ–­æ­£åœ¨è¿›è¡Œä¸­çš„è®¡ç®—ï¼Ÿ\n10. JSXç¼–è¯‘ä¹‹åæ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿ\n11. Reactä¸­é‚£äº›propsä¸èƒ½ä¼ é€’ï¼Œä¸ºä»€ä¹ˆï¼Ÿ\n12. å‡å¦‚æˆ‘è¦å°è£…ä¸€ä¸‹ä¸Šæ‹‰åŠ è½½çš„Hookè¦æ€ä¹ˆå°è£…ï¼Ÿ\n\n### 2é¢\n\n1. nodejs å¸¸ç”¨å‘½ä»¤ä½ çŸ¥é“å“ªäº›ï¼Ÿ\n2. ä»‹ç»ä¸€ä¸‹JavaScriptçš„å†…å­˜\n3. WeakMapå’ŒMapæœ‰ä»€ä¹ˆåŒºåˆ«\n4. Postå’ŒGetæœ‰ä»€ä¹ˆåŒºåˆ«\n5. è¿”å›çš„çŠ¶æ€ç ä¸€å®š200å°±æ˜¯å¯¹çš„å—ï¼Ÿ\n6. é‚£æˆ‘è¿”å›300ä¹Ÿå¯ä»¥æ˜¯å¯¹çš„å—ï¼Ÿ\n7. electronç”¨è¿‡å—ï¼Ÿ\n8. RNä¼šå—ï¼Ÿ\n9. Webpackçš„åŸç†\n10. ç°åœ¨è®©ä½ æ‰‹å†™ä¸€ä¸ªWebpackï¼Œä½ è¦æ€ä¹ˆæ¥å†™ï¼Ÿ\n11. Webpackä¼˜åŒ–çŸ¥é“å“ªäº›ï¼Ÿ\n\nå‡‰å‡‰ã€‚ã€‚ã€‚å¹¿åº¦ä¸å¤Ÿã€‚ã€‚ã€‚555\n\n## æ•°ç«‹ä¿¡æ¯\n\n### 1é¢\n\n1. ä»€ä¹ˆæ˜¯åŸå‹é“¾\n2. æ‰‹å†™å¯„ç”Ÿç»„åˆç»§æ‰¿\n3. thisæŒ‡å‘ä¼˜å…ˆçº§\n4. ä»€ä¹ˆå«åšé—­åŒ…ï¼Ÿ\n5. useEffectçš„å›è°ƒå‡½æ•°æ¯æ¬¡éƒ½ä¼šæ‰§è¡Œè¿˜æ˜¯åœ¨å¸è½½çš„æ—¶å€™æ‰§è¡Œï¼Ÿ\n6. ç±»ç»„ä»¶çš„thiså˜é‡ï¼Œåœ¨å‡½æ•°æ˜¯ç»„ä»¶ä¸­æ€ä¹ˆè¡¨ç¤ºï¼Ÿ\n7. setStateçš„é“¾è¡¨æ˜¯ç¯å½¢çš„å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ\n8. è·¨åŸŸ\n\n### 2é¢\n\n1. reduxæºç è¯»è¿‡å—ï¼Ÿ\n2. reduxä¸­é—´ä»¶çš„è®¾è®¡ç†å¿µæ˜¯ä»€ä¹ˆï¼Ÿ\n3. stickyç”¨è¿‡å—ï¼Ÿ\n4. px to remçš„è®¡ç®—åŸç†\n5. Webpackçš„tree shankingäº†è§£å—ï¼ŸåŸç†ï¼Ÿæ€ä¹ˆå†™ï¼Ÿ\n6. BFCä¸ºä»€ä¹ˆä¼šæœ‰é‚£äº›ç‰¹æ€§ï¼Ÿ\n7. Reactäº‹ä»¶é›†åˆåŸç†\n8. ä¸ºä»€ä¹ˆè™šæ‹ŸDOMå¯ä»¥åšè·¨å¹³å°\n\n## å…‰äº‘ç§‘æŠ€\n\n### 1é¢\n\n1. var let conståŒºåˆ«\n2. localStorage sessionStorage cookie tokenåŒºåˆ«\n3. tokençš„ç»„æˆ\n4. Reactä¸ºä»€ä¹ˆç§»é™¤é‚£äº›ç”Ÿå‘½å‘¨æœŸ\n5. Hookçš„è®¾è®¡ç†å¿µï¼ŒHookè§„åˆ™åŸç†\n6. keyçš„ä½œç”¨\n7. è¯´ä¸€ä¸‹ä½ äº†è§£çš„é—­åŒ…\n8. è‡ªå®šä¹‰loaderå†™è¿‡å—ï¼Ÿ\n9. è·¨åŸŸçš„æ–¹å¼æ–¹æ³•\n\n### 2é¢\n\n1. httpså’Œhttpçš„åŒºåˆ«\n2. httpè¯·æ±‚å¤´çš„ç»„æˆ\n3. cookieçš„ä½œç”¨\n4. cookieçš„æ–°çš„å±æ€§\n5. æ€ä¹ˆé˜»æ­¢ç¬¬ä¸‰æ–¹æ”»å‡»\n6. å‡å¦‚è®©ä½ è®¾è®¡ä¸€ä¸ªç§’æ€é¡µé¢ä½ ä¼šæƒ³åˆ°é‚£äº›åœºæ™¯å’Œåº”å¯¹æ–¹å¼\n\n# æ€»ç»“\n\næˆ‘ä¸ªäººè®¤ä¸ºå¿…è€ƒçš„å‡ ä¸ªç‚¹ï¼Œå¦‚æœå¤ä¹ å¥½äº†çš„è¯ã€‚1é¢åº”è¯¥é—®é¢˜ä¸å¤§\n\n1. URLåˆ°é¡µé¢æ¸²æŸ“è¿‡ç¨‹\n2. JavaScriptç»§æ‰¿\n3. é—­åŒ…\n4. Promise\n5. httpè¯·æ±‚å¤´ï¼Œç ï¼Œæ–¹æ³•ä¹‹é—´çš„åŒºåˆ«ï¼Œhttp2ï¼Œhttps\n6. è·¨åŸŸ\n7. React FiberåŸç†\n8. Hookè§„åˆ™åŸç†\n9. setStateæ˜¯å¦å¼‚æ­¥\n10. å‰ç«¯æ€§èƒ½ä¼˜åŒ–ï¼ˆWebpackï¼Œjsï¼Œcssï¼Œé‡ç»˜ï¼Œå›æµï¼Œé˜²æŠ–ï¼ŒèŠ‚æµ\n11. Reactç”Ÿå‘½å‘¨æœŸï¼Œå®˜æ–¹çš„Hooksçƒ‚ç†Ÿäºå¿ƒ\n12. Flexï¼ŒBFCï¼Œå±…ä¸­\n\n\n\n","source":"_posts/ã€é¢ç»ã€‘2å¹´å‰ç«¯æ­å·é¢è¯•é›†åˆ.md","raw":"---\ntitle: ã€é¢ç»ã€‘2å¹´å‰ç«¯æ­å·é¢è¯•é›†åˆ\ndate: 2020-10-28 21:53:09\ntags: [é¢ç»]\ncategories: [é¢ç»]\ncover: /image/cover/bg.jpg\n---\n\n# å‰è¨€\n\nè¯´ä¸€ç‚¹åºŸè¯å§ï¼Œç®—æ˜¯åæ§½ã€‚\n\nç°åœ¨æ­å·çš„æ°›å›´å¾ˆæ€ªï¼ŒåŒä¼‘éƒ½å¯ä»¥æ‹¿å‡ºæ¥å¹çš„é‚£ç§ã€‚å”‰ï¼Œä¸è¿‡è™½ç„¶æ˜¯ç–«æƒ…ï¼Œå‰ç«¯çš„å²—ä½è¿˜æ˜¯è›®å¤šçš„ï¼Œæˆ‘åŸºæœ¬ä¸Šä¸€å¤©2ä¸ªé¢è¯•ã€‚åœ¨æœªæ¥ç§‘æŠ€åŸå’Œæ»¨æ±Ÿä¸¤å¤´è·‘ã€‚ä¸è¿‡ç°åœ¨å·²ç»å…¥èŒå•¦ã€‚\n\n# å…¬å¸åˆ—è¡¨\n\n- å®‰æ’ç§‘æŠ€ -> æŒ‚åœ¨4é¢å‰¯æ€»è£ã€‚\n  - çœ‹äº†çŸ¥ä¹ä¸Šé¢çš„è¯„ä»·ç„¶åå»é¢çš„å‰¯æ€»è£ï¼Œå‘ç°åŠ ç­ä¸¥é‡ï¼Œç„¶åæœŸæœ›è–ªèµ„å¼€çš„æ¯”è¾ƒé«˜ï¼Œè€Œä¸”å‰¯æ€»è£æœŸé—´ä¸€ç›´åœ¨æ‘†å¼„æ‰‹æœºä¸çŸ¥é“æ˜¯ä¸æ˜¯æ¯”è¾ƒå¿™ï¼Œåœºé¢ç»å¸¸å†·é™å¥½ä¸€ä¼šã€‚\n- åšåœ£ç”Ÿç‰© -> offerï¼Œä½†æ˜¯è–ªèµ„å¼€çš„æ¯”è¾ƒä½ï¼Œæ‰€ä»¥æ²¡å»\n- æ•°ç§¦ç§‘æŠ€ -> å·²ç»å…¥èŒå•¦\n- ç«çŸ³åˆ›é€  -> æŒ‚åœ¨HRé‚£è¾¹äº†ï¼Œä¼°è®¡æ˜¯æˆ‘è·³æ§½æ¯”è¾ƒé¢‘ç¹ï¼Œè€Œä¸”é‚£å¤©å¾ˆæ™šè¿‡å»çš„ï¼Œäººå¾ˆç–²æƒ«æ²¡ä»€ä¹ˆç²¾ç¥ï¼ŒHRè¿˜é—®æˆ‘å¹³å¸¸æ˜¯ä¸æ˜¯ä¹Ÿæ˜¯è¿™æ ·æ²¡ç²¾ç¥....å°´å°¬\n- åšè”æ™ºèƒ½ -> åé¢å‘ç°å‰ç«¯å›¢é˜Ÿåªæœ‰ä¸€ä¸ªäººï¼Œè€Œä¸”é¢è¯•å®˜å¥½åƒå·¥ä½œæ²¡å¤šä¹…ã€‚ã€‚ã€‚å…¨æ˜¯ç½‘ä¸Šçš„é¢˜ç›®ï¼ŒäºŒé¢å°±æ²¡å»äº†\n- å©šç¤¼çºª -> æŒ‚åœ¨2é¢ï¼Œå‰ç«¯leaderè§‰å¾—æˆ‘nodeä¸å¤ªç†Ÿæ‚‰ï¼Œå¹¿åº¦ä¸å¤Ÿ....\n- æ•°ç«‹ä¿¡æ¯ -> æŒ‚åœ¨äºŒé¢ï¼Œä¸çŸ¥é“å…·ä½“å“ªé‡Œä¸è¡Œ....æˆ‘æ„Ÿè§‰æˆ‘éƒ½ç­”ä¸Šæ¥äº†...\n- é˜¿é‡Œé›¶å”®äº‹ä¸šéƒ¨ -> ä¸€é¢å°±æŒ‚äº†ï¼Œé‚£ä¸ªæ—¶å€™åˆšåˆšååŠ¨è½¦åˆ°æ­å·ï¼Œç¡®å®ä¹Ÿæ²¡æ€ä¹ˆå‡†å¤‡ï¼Œå¾ˆå¯æƒœï¼\n- å…‰äº‘ç§‘æŠ€ -> æˆ‘æœŸæœ›å¼€çš„å¤ªé«˜äº†....ç„¶åæŒ‚åœ¨äº†HR\n\n# é¢ç»\n\n## é˜¿é‡Œ-é›¶å”®éƒ¨\n\n### 1é¢\n\n1. jsbridgeçš„åŸç†\n2. è·¨åŸŸçš„åœºæ™¯ä½ ç”¨åˆ°é‚£äº›ï¼Ÿ\n3. jsonpçš„åŸç†ï¼Œjsonpæ€ä¹ˆç”¨\n4. æœ‰æ•°æ®ç›¸å…³çš„å—ï¼Ÿæ¯”å¦‚PVï¼ŒUV\n5. px to remçš„åŸç†èƒ½è¯´ä¸€ä¸‹å—ï¼Ÿ\n6. å…·ä½“æ€ä¹ˆç®—çš„å¯ä»¥è¯´ä¸€ä¸‹å—ï¼Ÿ\n7. onClickæ˜¯ä»€ä¹ˆæ—¶å€™æ‰§è¡Œçš„ï¼Ÿ\n8. å¦‚æœæˆ‘å†™äº†ä¸€ä¸ªaddListenerï¼Œç„¶ååˆå†™äº†onCLickï¼Œè¿™ä¸ªæ—¶å€™ç‚¹å‡»ä¸€ä¸‹ä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…ï¼Ÿ\n9. å‰ç«¯æ€§èƒ½ä¼˜åŒ–\n10. happypackåŸç†\n11. reactçš„è™šæ‹ŸDOMç®—æ³•\n\n## å®‰æ’ç§‘æŠ€\n\n### 1é¢\n\n1. ç±»ç»„ä»¶å’Œå‡½æ•°å¼ç»„ä»¶çš„åŒºåˆ«ï¼Œæˆ–è€…è¯´ä¸€ä¸‹ä½ ä½¿ç”¨æœ€ç›´æ¥çš„æ„Ÿå—ï¼Œä»¥åŠä»–ä»¬çš„ä¼˜ç¼ºç‚¹\n2. æœ‰è¯•è¿‡è‡ªå·±å°è£…Hookå—ï¼Ÿ\n3. æ”¹å˜thisæŒ‡å‘çš„æ–¹å¼é™¤äº†bindä»¥åŠç®­å¤´å‡½æ•°è¿˜æœ‰å“ªäº›ï¼Ÿ\n4. ä¸ºä»€ä¹ˆReactä¸­onClickåœ¨ç‚¹å‡»çš„æ—¶å€™ä¼šæ‰§è¡Œï¼Ÿ\n5. Reactä¸­keyçš„ä½œç”¨\n6. React Fiberä½ äº†è§£å—ï¼Ÿ\n7. è¯´ä¸€ä¸‹è™šæ‹ŸDOMçš„ä¼˜ç¼ºç‚¹\n8. å¼€å‘ä¸­ç”¨åˆ°Reduxæ˜¯è‡ªå·±å°è£…çš„å—ï¼Ÿ\n9. Reactç±»ç»„ä»¶çš„extendså’ŒcreateElementæœ‰ä»€ä¹ˆåŒºåˆ«å—ï¼Ÿ\n10. ç»„ä»¶åå­—é¦–å­—æ¯ä¸ºä»€ä¹ˆä¸€å®šè¦å¤§å†™ï¼Ÿ\n11. ES5ä¸­åˆ¤æ–­æ•°ç»„æœ‰ä»€ä¹ˆæ–¹å¼ï¼Ÿ\n12. æ€ä¹ˆæ ·å¹¶å‘è¯·æ±‚ï¼Ÿ\n13. å‰ç«¯æ€§èƒ½ä¼˜åŒ–\n14. æœ‰ç”¨è¿‡Typescriptå—ï¼Ÿä»‹ç»ä¸€ä¸‹ä½ å¹³å¸¸å¸¸ç”¨çš„\n15. å·¥ä½œä¸­é‡åˆ°æœ€éš¾çš„é—®é¢˜\n16. å¹³å¸¸æ˜¯æ€ä¹ˆå­¦ä¹ çš„\n\n### 2é¢\n\næœ¬æ¥è¦é¢è¯•æˆ‘çš„äºŒé¢çš„é¢è¯•å®˜é›¶æ—¶æœ‰äº‹ï¼Œè¿™ä¸ªæ˜¯éš”å£ç»„çš„leaderã€‚ã€‚\n\n1. å°è£…ä¸€ä¸ªç½‘ç»œè¯·æ±‚æ˜¯æ€ä¹ˆå°è£…çš„ï¼Œè¦è¾¾åˆ°ä»€ä¹ˆæ ·çš„æ•ˆæœï¼ˆå› ä¸ºæˆ‘ç®€å†å†™äº†\n2. è¯´ä¸€ä¸‹ä½ å°è£…è¡¨å•ç»„ä»¶çš„æƒ³æ³•ï¼ˆä¹Ÿæ˜¯ç®€å†ã€‚ã€‚ã€‚\n3. è¯´ä¸€ä¸‹ä½ çš„é‰´æƒæ€è·¯ï¼ˆä¹Ÿæ˜¯ç®€å†\n4. ç°åœ¨Typescriptæœ‰ç”¨å—ï¼Ÿä½ è§‰å¾—è‡ªå·±Typescriptç”¨çš„æ€ä¹ˆæ ·ï¼Ÿ\n5. è¯´ä¸€ä¸‹Reactæœ€æ–°çš„ç”Ÿå‘½å‘¨æœŸ\n6. æœ‰å†™è¿‡Reduxçš„ä¸­é—´ä»¶å—ï¼Ÿ\n7. è¯´ä¸€ä¸‹React Fiberåšäº†ä¸€ä»¶ä»€ä¹ˆäº‹æƒ…\n\n### 3é¢\n\nå¿˜è®°å½•éŸ³äº†ã€‚ã€‚ã€‚é è®°å¿†åŠ›æƒ³æƒ³\n\n1. è¯´ä¸€ä¸‹äº‹ä»¶å¾ªç¯\n2. æˆ‘ä»¬å†™çš„onClickæ˜¯äº‹ä»¶æ•è·å—ï¼Ÿå’Œäº‹ä»¶å†’æ³¡çš„é¡ºåºæ˜¯æ€ä¹ˆæ ·çš„\n3. CSSçš„æƒé‡\n4. å¯¹äºè·¨åŸŸä½ æ˜¯æ€çœ‹å¾…çš„\n5. è¯´ä¸€ä¸‹ä½ å¯¹JavaScriptå†…å­˜çš„ç†è§£\n6. ä»‹ç»ä¸€ä¸‹Promiseå§\n7. è¾“å…¥URLåˆ°é¡µé¢æ¸²æŸ“å‘ç”Ÿäº†ä»€ä¹ˆ\n8. å¹³å¸¸æ˜¯æ€ä¹ˆå­¦ä¹ çš„ï¼Ÿ\n\né¢˜ç›®å¤ªå®½æ³›äº†ã€‚ã€‚ã€‚è€ƒå¯ŸçŸ¥è¯†æ·±åº¦ã€‚ã€‚\n\n### 4é¢\n\n1. ä¸ºä»€ä¹ˆä»ä¸Šå®¶å…¬å¸ç¦»èŒ\n2. è¯´ä¸€ä¸‹ä½ å¯¹åŠ ç­çš„ç†è§£\n3. å¯¹æœªæ¥çš„è§„åˆ’\n\n## åšåœ£ç”Ÿç‰©\n\n### 1é¢\n\n1. ç¦»èŒåŸå› \n2. é¡¹ç›®ä¸­å°è±¡ä¸­æ¯”è¾ƒæ·±åˆ»çš„\n3. å¯¹äºç§»åŠ¨ç«¯çš„é€‚é…\n4. é«˜æ¸…å±1pxçš„å…¼å®¹ï¼Œé«˜æ¸…å±å˜ç²—é—®é¢˜\n   1. è¦ç²¾ç¡®åˆ°æ¯ä¸€è¡Œã€‚ã€‚ã€‚\n5. è¯´ä¸€ä¸‹é˜²æŠ–èŠ‚æµçš„åŸç†\n6. JSæ‹–æ‹½åŸç†\n7. è¯´ä¸€ä¸‹flexçš„æ¯ä¸ªå±æ€§å¯¹åº”çš„æ„æ€\n8. CSSæ°´å¹³å‚ç›´å±…ä¸­\n9. æœ‰è‡ªå·±å†™è¿‡webpack loaderå’Œpluginå—ï¼Ÿä»–ä»¬çš„åŸç†å’ŒåŒºåˆ«\n\n### 2é¢\n\n1. Reactæºç æœ‰è¯»è¿‡å—ï¼Ÿ\n2. Fiberæ˜¯æ€ä¹ˆåšè°ƒåº¦çš„ï¼Œjsä¸æ˜¯å•çº¿ç¨‹å—ï¼Ÿæ˜¯æ€ä¹ˆæ‰“æ–­è®¡ç®—çš„ï¼Ÿ\n3. è¯´ä¸€ä¸‹ä½ å¹³å¸¸ç”¨çš„Hookså§\n4. ä»‹ç»å‰ç«¯æ€§èƒ½ä¼˜åŒ–\n5. å¯¹äºå‰ç«¯ä»£ç æ”»å‡»ä½ äº†è§£å“ªäº›ï¼Ÿ\n6. cookieçš„å­˜å‚¨æœ‰å“ªäº›æ–°çš„å±æ€§\n7. Http2æœ‰å“ªäº›æ–°åŠŸèƒ½\n8. httpå’Œhttpsæœ‰ä»€ä¹ˆåŒºåˆ«\n9. ä»‹ç»ä¸€ä¸‹éå¯¹ç§°åŠ å¯†\n10. JavaScriptç»§æ‰¿ç†Ÿæ‚‰å—ï¼Ÿæœ‰å“ªäº›æ–¹å¼ï¼Ÿ\n\n### 3é¢HR\n\nä¸Šæ¥å°±æºç æˆ‘ä»¥ä¸ºæˆ‘è¦å‡‰äº†ï¼Œä¸è¿‡åé¢éƒ½æœ‰å¤ä¹ åˆ°ï¼Œç®—æ˜¯æ‰³å›ä¸€åŸã€‚è°ˆè–ªã€‚\n\n## ç«çŸ³åˆ›é€ \n\næ˜¯ä¸€å®¶å‰ç«¯ä¸»å¯¼çš„å›¢é˜Ÿï¼Œå‰ç«¯äººè¶…çº§å¤š\n\n### 1é¢\n\n1. è¯´ä¸€ä¸‹ç§»åŠ¨ç«¯é€‚é…çš„åŸç†\n2. è¯´ä¸€ä¸‹å‰ç«¯æ€§èƒ½ä¼˜åŒ–\n3. å¹³å¸¸å¯¹äºè·¨åŸŸæ˜¯æ€ä¹ˆåšçš„\n4. webpackçš„pluginæœ‰åšè¿‡å—ï¼Ÿ\n5. JSçš„ç»§æ‰¿\n6. çœ‹ä½ æœ‰å°è£…è¿‡echartsï¼Œä½ æ˜¯æ€ä¹ˆå°è£…çš„\n7. Vueå’ŒReactçš„åŒºåˆ«\n8. è¯´ä¸€ä¸‹CSSåŠ¨ç”»\n9. è¯´ä¸€ä¸‹keyåœ¨Reactå’ŒVueä¸­çš„ä½œç”¨ï¼Œå¦‚æœæ²¡æœ‰ä¼šæ€ä¹ˆæ ·ï¼Ÿä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå…·ä½“\n10. RNæœ‰åšè¿‡å—ï¼ŸTaroå‘¢ï¼Ÿ\n11. ç°åœ¨æˆ‘æœ‰ä¸€ä¸ªæ•°ç»„ï¼Œæˆ‘æƒ³é’ˆå¯¹æ¯ä¸ªå…ƒç´ çš„åé¢éƒ½åŠ å…¥ä¸€ä¸ªæ–°çš„å…ƒç´ ï¼Œæœ‰å“ªäº›æ–¹æ³•\n12. å‡å¦‚æˆ‘ç”¨forçš„ç´¢å¼•æ¥åŠ ï¼Œä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ\n\n### 2é¢HR\n\nå¯èƒ½æ˜¯å¤ªæ™šäº†ï¼Œç«çŸ³æ˜¯ç¬¬ä¸‰å®¶é¢è¯•äº†ï¼Œè€Œä¸”æˆ‘åäº†å¾ˆä¹…çš„åœ°é“ï¼ŒHRå¯èƒ½è§‰å¾—æˆ‘äººæ²¡ç²¾ç¥ï¼Œä¹Ÿæœ‰å¯èƒ½æˆ‘ç¡®å®æœ‰æ¯›ç—…ã€‚ã€‚ã€‚\n\n## åšè”æ™ºèƒ½\n\n### 1é¢\n\nåŸºæœ¬ä¸Šéƒ½æ˜¯å¾ˆåŸºç¡€çš„é¢˜ç›®ã€‚æ„Ÿè§‰æ˜¯ä¹‹å‰å›¢é˜Ÿå…¨éƒ¨è·‘è·¯äº†ï¼Œåªæœ‰ä»–ä¸€ä¸ªå‰ç«¯ï¼Œè€Œä¸”åŠ ç­å¾ˆä¸¥é‡ï¼Œä»–çš„å¥½åƒæ‰åˆšåˆšæ¯•ä¸š....\n\n## å©šç¤¼çºª\n\n### 1é¢\n\n1. ä½ ç”¨è¿‡å“ªäº›Hook\n2. Hookçš„è§„åˆ™åŸç†\n3. ä¸ºä»€ä¹ˆè¦ç§»é™¤é‚£äº›ç”Ÿå‘½å‘¨æœŸ\n4. è¯´ä¸€ä¸‹æ—¶é—´å¾ªç¯\n5. setStateæ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥ï¼Ÿ\n6. setStateçš„å›è°ƒå‡½æ•°æ˜¯å®ä»»åŠ¡è¿˜æ˜¯å¾®ä»»åŠ¡\n7. webpackçƒ­æ›´æ–°åŸç†\n8. webpackçš„loaderçš„ä½œç”¨\n9. ä¸ºä»€ä¹ˆFiberå¯ä»¥ä¸­æ–­æ­£åœ¨è¿›è¡Œä¸­çš„è®¡ç®—ï¼Ÿ\n10. JSXç¼–è¯‘ä¹‹åæ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿ\n11. Reactä¸­é‚£äº›propsä¸èƒ½ä¼ é€’ï¼Œä¸ºä»€ä¹ˆï¼Ÿ\n12. å‡å¦‚æˆ‘è¦å°è£…ä¸€ä¸‹ä¸Šæ‹‰åŠ è½½çš„Hookè¦æ€ä¹ˆå°è£…ï¼Ÿ\n\n### 2é¢\n\n1. nodejs å¸¸ç”¨å‘½ä»¤ä½ çŸ¥é“å“ªäº›ï¼Ÿ\n2. ä»‹ç»ä¸€ä¸‹JavaScriptçš„å†…å­˜\n3. WeakMapå’ŒMapæœ‰ä»€ä¹ˆåŒºåˆ«\n4. Postå’ŒGetæœ‰ä»€ä¹ˆåŒºåˆ«\n5. è¿”å›çš„çŠ¶æ€ç ä¸€å®š200å°±æ˜¯å¯¹çš„å—ï¼Ÿ\n6. é‚£æˆ‘è¿”å›300ä¹Ÿå¯ä»¥æ˜¯å¯¹çš„å—ï¼Ÿ\n7. electronç”¨è¿‡å—ï¼Ÿ\n8. RNä¼šå—ï¼Ÿ\n9. Webpackçš„åŸç†\n10. ç°åœ¨è®©ä½ æ‰‹å†™ä¸€ä¸ªWebpackï¼Œä½ è¦æ€ä¹ˆæ¥å†™ï¼Ÿ\n11. Webpackä¼˜åŒ–çŸ¥é“å“ªäº›ï¼Ÿ\n\nå‡‰å‡‰ã€‚ã€‚ã€‚å¹¿åº¦ä¸å¤Ÿã€‚ã€‚ã€‚555\n\n## æ•°ç«‹ä¿¡æ¯\n\n### 1é¢\n\n1. ä»€ä¹ˆæ˜¯åŸå‹é“¾\n2. æ‰‹å†™å¯„ç”Ÿç»„åˆç»§æ‰¿\n3. thisæŒ‡å‘ä¼˜å…ˆçº§\n4. ä»€ä¹ˆå«åšé—­åŒ…ï¼Ÿ\n5. useEffectçš„å›è°ƒå‡½æ•°æ¯æ¬¡éƒ½ä¼šæ‰§è¡Œè¿˜æ˜¯åœ¨å¸è½½çš„æ—¶å€™æ‰§è¡Œï¼Ÿ\n6. ç±»ç»„ä»¶çš„thiså˜é‡ï¼Œåœ¨å‡½æ•°æ˜¯ç»„ä»¶ä¸­æ€ä¹ˆè¡¨ç¤ºï¼Ÿ\n7. setStateçš„é“¾è¡¨æ˜¯ç¯å½¢çš„å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ\n8. è·¨åŸŸ\n\n### 2é¢\n\n1. reduxæºç è¯»è¿‡å—ï¼Ÿ\n2. reduxä¸­é—´ä»¶çš„è®¾è®¡ç†å¿µæ˜¯ä»€ä¹ˆï¼Ÿ\n3. stickyç”¨è¿‡å—ï¼Ÿ\n4. px to remçš„è®¡ç®—åŸç†\n5. Webpackçš„tree shankingäº†è§£å—ï¼ŸåŸç†ï¼Ÿæ€ä¹ˆå†™ï¼Ÿ\n6. BFCä¸ºä»€ä¹ˆä¼šæœ‰é‚£äº›ç‰¹æ€§ï¼Ÿ\n7. Reactäº‹ä»¶é›†åˆåŸç†\n8. ä¸ºä»€ä¹ˆè™šæ‹ŸDOMå¯ä»¥åšè·¨å¹³å°\n\n## å…‰äº‘ç§‘æŠ€\n\n### 1é¢\n\n1. var let conståŒºåˆ«\n2. localStorage sessionStorage cookie tokenåŒºåˆ«\n3. tokençš„ç»„æˆ\n4. Reactä¸ºä»€ä¹ˆç§»é™¤é‚£äº›ç”Ÿå‘½å‘¨æœŸ\n5. Hookçš„è®¾è®¡ç†å¿µï¼ŒHookè§„åˆ™åŸç†\n6. keyçš„ä½œç”¨\n7. è¯´ä¸€ä¸‹ä½ äº†è§£çš„é—­åŒ…\n8. è‡ªå®šä¹‰loaderå†™è¿‡å—ï¼Ÿ\n9. è·¨åŸŸçš„æ–¹å¼æ–¹æ³•\n\n### 2é¢\n\n1. httpså’Œhttpçš„åŒºåˆ«\n2. httpè¯·æ±‚å¤´çš„ç»„æˆ\n3. cookieçš„ä½œç”¨\n4. cookieçš„æ–°çš„å±æ€§\n5. æ€ä¹ˆé˜»æ­¢ç¬¬ä¸‰æ–¹æ”»å‡»\n6. å‡å¦‚è®©ä½ è®¾è®¡ä¸€ä¸ªç§’æ€é¡µé¢ä½ ä¼šæƒ³åˆ°é‚£äº›åœºæ™¯å’Œåº”å¯¹æ–¹å¼\n\n# æ€»ç»“\n\næˆ‘ä¸ªäººè®¤ä¸ºå¿…è€ƒçš„å‡ ä¸ªç‚¹ï¼Œå¦‚æœå¤ä¹ å¥½äº†çš„è¯ã€‚1é¢åº”è¯¥é—®é¢˜ä¸å¤§\n\n1. URLåˆ°é¡µé¢æ¸²æŸ“è¿‡ç¨‹\n2. JavaScriptç»§æ‰¿\n3. é—­åŒ…\n4. Promise\n5. httpè¯·æ±‚å¤´ï¼Œç ï¼Œæ–¹æ³•ä¹‹é—´çš„åŒºåˆ«ï¼Œhttp2ï¼Œhttps\n6. è·¨åŸŸ\n7. React FiberåŸç†\n8. Hookè§„åˆ™åŸç†\n9. setStateæ˜¯å¦å¼‚æ­¥\n10. å‰ç«¯æ€§èƒ½ä¼˜åŒ–ï¼ˆWebpackï¼Œjsï¼Œcssï¼Œé‡ç»˜ï¼Œå›æµï¼Œé˜²æŠ–ï¼ŒèŠ‚æµ\n11. Reactç”Ÿå‘½å‘¨æœŸï¼Œå®˜æ–¹çš„Hooksçƒ‚ç†Ÿäºå¿ƒ\n12. Flexï¼ŒBFCï¼Œå±…ä¸­\n\n\n\n","slug":"ã€é¢ç»ã€‘2å¹´å‰ç«¯æ­å·é¢è¯•é›†åˆ","published":1,"updated":"2021-06-24T14:00:06.854Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra8u0029lwrd6zz2auvz","content":"<h1 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h1><p>è¯´ä¸€ç‚¹åºŸè¯å§ï¼Œç®—æ˜¯åæ§½ã€‚</p>\n<p>ç°åœ¨æ­å·çš„æ°›å›´å¾ˆæ€ªï¼ŒåŒä¼‘éƒ½å¯ä»¥æ‹¿å‡ºæ¥å¹çš„é‚£ç§ã€‚å”‰ï¼Œä¸è¿‡è™½ç„¶æ˜¯ç–«æƒ…ï¼Œå‰ç«¯çš„å²—ä½è¿˜æ˜¯è›®å¤šçš„ï¼Œæˆ‘åŸºæœ¬ä¸Šä¸€å¤©2ä¸ªé¢è¯•ã€‚åœ¨æœªæ¥ç§‘æŠ€åŸå’Œæ»¨æ±Ÿä¸¤å¤´è·‘ã€‚ä¸è¿‡ç°åœ¨å·²ç»å…¥èŒå•¦ã€‚</p>\n<h1 id=\"å…¬å¸åˆ—è¡¨\"><a href=\"#å…¬å¸åˆ—è¡¨\" class=\"headerlink\" title=\"å…¬å¸åˆ—è¡¨\"></a>å…¬å¸åˆ—è¡¨</h1><ul>\n<li>å®‰æ’ç§‘æŠ€ -&gt; æŒ‚åœ¨4é¢å‰¯æ€»è£ã€‚<ul>\n<li>çœ‹äº†çŸ¥ä¹ä¸Šé¢çš„è¯„ä»·ç„¶åå»é¢çš„å‰¯æ€»è£ï¼Œå‘ç°åŠ ç­ä¸¥é‡ï¼Œç„¶åæœŸæœ›è–ªèµ„å¼€çš„æ¯”è¾ƒé«˜ï¼Œè€Œä¸”å‰¯æ€»è£æœŸé—´ä¸€ç›´åœ¨æ‘†å¼„æ‰‹æœºä¸çŸ¥é“æ˜¯ä¸æ˜¯æ¯”è¾ƒå¿™ï¼Œåœºé¢ç»å¸¸å†·é™å¥½ä¸€ä¼šã€‚</li>\n</ul>\n</li>\n<li>åšåœ£ç”Ÿç‰© -&gt; offerï¼Œä½†æ˜¯è–ªèµ„å¼€çš„æ¯”è¾ƒä½ï¼Œæ‰€ä»¥æ²¡å»</li>\n<li>æ•°ç§¦ç§‘æŠ€ -&gt; å·²ç»å…¥èŒå•¦</li>\n<li>ç«çŸ³åˆ›é€  -&gt; æŒ‚åœ¨HRé‚£è¾¹äº†ï¼Œä¼°è®¡æ˜¯æˆ‘è·³æ§½æ¯”è¾ƒé¢‘ç¹ï¼Œè€Œä¸”é‚£å¤©å¾ˆæ™šè¿‡å»çš„ï¼Œäººå¾ˆç–²æƒ«æ²¡ä»€ä¹ˆç²¾ç¥ï¼ŒHRè¿˜é—®æˆ‘å¹³å¸¸æ˜¯ä¸æ˜¯ä¹Ÿæ˜¯è¿™æ ·æ²¡ç²¾ç¥â€¦.å°´å°¬</li>\n<li>åšè”æ™ºèƒ½ -&gt; åé¢å‘ç°å‰ç«¯å›¢é˜Ÿåªæœ‰ä¸€ä¸ªäººï¼Œè€Œä¸”é¢è¯•å®˜å¥½åƒå·¥ä½œæ²¡å¤šä¹…ã€‚ã€‚ã€‚å…¨æ˜¯ç½‘ä¸Šçš„é¢˜ç›®ï¼ŒäºŒé¢å°±æ²¡å»äº†</li>\n<li>å©šç¤¼çºª -&gt; æŒ‚åœ¨2é¢ï¼Œå‰ç«¯leaderè§‰å¾—æˆ‘nodeä¸å¤ªç†Ÿæ‚‰ï¼Œå¹¿åº¦ä¸å¤Ÿâ€¦.</li>\n<li>æ•°ç«‹ä¿¡æ¯ -&gt; æŒ‚åœ¨äºŒé¢ï¼Œä¸çŸ¥é“å…·ä½“å“ªé‡Œä¸è¡Œâ€¦.æˆ‘æ„Ÿè§‰æˆ‘éƒ½ç­”ä¸Šæ¥äº†â€¦</li>\n<li>é˜¿é‡Œé›¶å”®äº‹ä¸šéƒ¨ -&gt; ä¸€é¢å°±æŒ‚äº†ï¼Œé‚£ä¸ªæ—¶å€™åˆšåˆšååŠ¨è½¦åˆ°æ­å·ï¼Œç¡®å®ä¹Ÿæ²¡æ€ä¹ˆå‡†å¤‡ï¼Œå¾ˆå¯æƒœï¼</li>\n<li>å…‰äº‘ç§‘æŠ€ -&gt; æˆ‘æœŸæœ›å¼€çš„å¤ªé«˜äº†â€¦.ç„¶åæŒ‚åœ¨äº†HR</li>\n</ul>\n<h1 id=\"é¢ç»\"><a href=\"#é¢ç»\" class=\"headerlink\" title=\"é¢ç»\"></a>é¢ç»</h1><h2 id=\"é˜¿é‡Œ-é›¶å”®éƒ¨\"><a href=\"#é˜¿é‡Œ-é›¶å”®éƒ¨\" class=\"headerlink\" title=\"é˜¿é‡Œ-é›¶å”®éƒ¨\"></a>é˜¿é‡Œ-é›¶å”®éƒ¨</h2><h3 id=\"1é¢\"><a href=\"#1é¢\" class=\"headerlink\" title=\"1é¢\"></a>1é¢</h3><ol>\n<li>jsbridgeçš„åŸç†</li>\n<li>è·¨åŸŸçš„åœºæ™¯ä½ ç”¨åˆ°é‚£äº›ï¼Ÿ</li>\n<li>jsonpçš„åŸç†ï¼Œjsonpæ€ä¹ˆç”¨</li>\n<li>æœ‰æ•°æ®ç›¸å…³çš„å—ï¼Ÿæ¯”å¦‚PVï¼ŒUV</li>\n<li>px to remçš„åŸç†èƒ½è¯´ä¸€ä¸‹å—ï¼Ÿ</li>\n<li>å…·ä½“æ€ä¹ˆç®—çš„å¯ä»¥è¯´ä¸€ä¸‹å—ï¼Ÿ</li>\n<li>onClickæ˜¯ä»€ä¹ˆæ—¶å€™æ‰§è¡Œçš„ï¼Ÿ</li>\n<li>å¦‚æœæˆ‘å†™äº†ä¸€ä¸ªaddListenerï¼Œç„¶ååˆå†™äº†onCLickï¼Œè¿™ä¸ªæ—¶å€™ç‚¹å‡»ä¸€ä¸‹ä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…ï¼Ÿ</li>\n<li>å‰ç«¯æ€§èƒ½ä¼˜åŒ–</li>\n<li>happypackåŸç†</li>\n<li>reactçš„è™šæ‹ŸDOMç®—æ³•</li>\n</ol>\n<h2 id=\"å®‰æ’ç§‘æŠ€\"><a href=\"#å®‰æ’ç§‘æŠ€\" class=\"headerlink\" title=\"å®‰æ’ç§‘æŠ€\"></a>å®‰æ’ç§‘æŠ€</h2><h3 id=\"1é¢-1\"><a href=\"#1é¢-1\" class=\"headerlink\" title=\"1é¢\"></a>1é¢</h3><ol>\n<li>ç±»ç»„ä»¶å’Œå‡½æ•°å¼ç»„ä»¶çš„åŒºåˆ«ï¼Œæˆ–è€…è¯´ä¸€ä¸‹ä½ ä½¿ç”¨æœ€ç›´æ¥çš„æ„Ÿå—ï¼Œä»¥åŠä»–ä»¬çš„ä¼˜ç¼ºç‚¹</li>\n<li>æœ‰è¯•è¿‡è‡ªå·±å°è£…Hookå—ï¼Ÿ</li>\n<li>æ”¹å˜thisæŒ‡å‘çš„æ–¹å¼é™¤äº†bindä»¥åŠç®­å¤´å‡½æ•°è¿˜æœ‰å“ªäº›ï¼Ÿ</li>\n<li>ä¸ºä»€ä¹ˆReactä¸­onClickåœ¨ç‚¹å‡»çš„æ—¶å€™ä¼šæ‰§è¡Œï¼Ÿ</li>\n<li>Reactä¸­keyçš„ä½œç”¨</li>\n<li>React Fiberä½ äº†è§£å—ï¼Ÿ</li>\n<li>è¯´ä¸€ä¸‹è™šæ‹ŸDOMçš„ä¼˜ç¼ºç‚¹</li>\n<li>å¼€å‘ä¸­ç”¨åˆ°Reduxæ˜¯è‡ªå·±å°è£…çš„å—ï¼Ÿ</li>\n<li>Reactç±»ç»„ä»¶çš„extendså’ŒcreateElementæœ‰ä»€ä¹ˆåŒºåˆ«å—ï¼Ÿ</li>\n<li>ç»„ä»¶åå­—é¦–å­—æ¯ä¸ºä»€ä¹ˆä¸€å®šè¦å¤§å†™ï¼Ÿ</li>\n<li>ES5ä¸­åˆ¤æ–­æ•°ç»„æœ‰ä»€ä¹ˆæ–¹å¼ï¼Ÿ</li>\n<li>æ€ä¹ˆæ ·å¹¶å‘è¯·æ±‚ï¼Ÿ</li>\n<li>å‰ç«¯æ€§èƒ½ä¼˜åŒ–</li>\n<li>æœ‰ç”¨è¿‡Typescriptå—ï¼Ÿä»‹ç»ä¸€ä¸‹ä½ å¹³å¸¸å¸¸ç”¨çš„</li>\n<li>å·¥ä½œä¸­é‡åˆ°æœ€éš¾çš„é—®é¢˜</li>\n<li>å¹³å¸¸æ˜¯æ€ä¹ˆå­¦ä¹ çš„</li>\n</ol>\n<h3 id=\"2é¢\"><a href=\"#2é¢\" class=\"headerlink\" title=\"2é¢\"></a>2é¢</h3><p>æœ¬æ¥è¦é¢è¯•æˆ‘çš„äºŒé¢çš„é¢è¯•å®˜é›¶æ—¶æœ‰äº‹ï¼Œè¿™ä¸ªæ˜¯éš”å£ç»„çš„leaderã€‚ã€‚</p>\n<ol>\n<li>å°è£…ä¸€ä¸ªç½‘ç»œè¯·æ±‚æ˜¯æ€ä¹ˆå°è£…çš„ï¼Œè¦è¾¾åˆ°ä»€ä¹ˆæ ·çš„æ•ˆæœï¼ˆå› ä¸ºæˆ‘ç®€å†å†™äº†</li>\n<li>è¯´ä¸€ä¸‹ä½ å°è£…è¡¨å•ç»„ä»¶çš„æƒ³æ³•ï¼ˆä¹Ÿæ˜¯ç®€å†ã€‚ã€‚ã€‚</li>\n<li>è¯´ä¸€ä¸‹ä½ çš„é‰´æƒæ€è·¯ï¼ˆä¹Ÿæ˜¯ç®€å†</li>\n<li>ç°åœ¨Typescriptæœ‰ç”¨å—ï¼Ÿä½ è§‰å¾—è‡ªå·±Typescriptç”¨çš„æ€ä¹ˆæ ·ï¼Ÿ</li>\n<li>è¯´ä¸€ä¸‹Reactæœ€æ–°çš„ç”Ÿå‘½å‘¨æœŸ</li>\n<li>æœ‰å†™è¿‡Reduxçš„ä¸­é—´ä»¶å—ï¼Ÿ</li>\n<li>è¯´ä¸€ä¸‹React Fiberåšäº†ä¸€ä»¶ä»€ä¹ˆäº‹æƒ…</li>\n</ol>\n<h3 id=\"3é¢\"><a href=\"#3é¢\" class=\"headerlink\" title=\"3é¢\"></a>3é¢</h3><p>å¿˜è®°å½•éŸ³äº†ã€‚ã€‚ã€‚é è®°å¿†åŠ›æƒ³æƒ³</p>\n<ol>\n<li>è¯´ä¸€ä¸‹äº‹ä»¶å¾ªç¯</li>\n<li>æˆ‘ä»¬å†™çš„onClickæ˜¯äº‹ä»¶æ•è·å—ï¼Ÿå’Œäº‹ä»¶å†’æ³¡çš„é¡ºåºæ˜¯æ€ä¹ˆæ ·çš„</li>\n<li>CSSçš„æƒé‡</li>\n<li>å¯¹äºè·¨åŸŸä½ æ˜¯æ€çœ‹å¾…çš„</li>\n<li>è¯´ä¸€ä¸‹ä½ å¯¹JavaScriptå†…å­˜çš„ç†è§£</li>\n<li>ä»‹ç»ä¸€ä¸‹Promiseå§</li>\n<li>è¾“å…¥URLåˆ°é¡µé¢æ¸²æŸ“å‘ç”Ÿäº†ä»€ä¹ˆ</li>\n<li>å¹³å¸¸æ˜¯æ€ä¹ˆå­¦ä¹ çš„ï¼Ÿ</li>\n</ol>\n<p>é¢˜ç›®å¤ªå®½æ³›äº†ã€‚ã€‚ã€‚è€ƒå¯ŸçŸ¥è¯†æ·±åº¦ã€‚ã€‚</p>\n<h3 id=\"4é¢\"><a href=\"#4é¢\" class=\"headerlink\" title=\"4é¢\"></a>4é¢</h3><ol>\n<li>ä¸ºä»€ä¹ˆä»ä¸Šå®¶å…¬å¸ç¦»èŒ</li>\n<li>è¯´ä¸€ä¸‹ä½ å¯¹åŠ ç­çš„ç†è§£</li>\n<li>å¯¹æœªæ¥çš„è§„åˆ’</li>\n</ol>\n<h2 id=\"åšåœ£ç”Ÿç‰©\"><a href=\"#åšåœ£ç”Ÿç‰©\" class=\"headerlink\" title=\"åšåœ£ç”Ÿç‰©\"></a>åšåœ£ç”Ÿç‰©</h2><h3 id=\"1é¢-2\"><a href=\"#1é¢-2\" class=\"headerlink\" title=\"1é¢\"></a>1é¢</h3><ol>\n<li>ç¦»èŒåŸå› </li>\n<li>é¡¹ç›®ä¸­å°è±¡ä¸­æ¯”è¾ƒæ·±åˆ»çš„</li>\n<li>å¯¹äºç§»åŠ¨ç«¯çš„é€‚é…</li>\n<li>é«˜æ¸…å±1pxçš„å…¼å®¹ï¼Œé«˜æ¸…å±å˜ç²—é—®é¢˜<ol>\n<li>è¦ç²¾ç¡®åˆ°æ¯ä¸€è¡Œã€‚ã€‚ã€‚</li>\n</ol>\n</li>\n<li>è¯´ä¸€ä¸‹é˜²æŠ–èŠ‚æµçš„åŸç†</li>\n<li>JSæ‹–æ‹½åŸç†</li>\n<li>è¯´ä¸€ä¸‹flexçš„æ¯ä¸ªå±æ€§å¯¹åº”çš„æ„æ€</li>\n<li>CSSæ°´å¹³å‚ç›´å±…ä¸­</li>\n<li>æœ‰è‡ªå·±å†™è¿‡webpack loaderå’Œpluginå—ï¼Ÿä»–ä»¬çš„åŸç†å’ŒåŒºåˆ«</li>\n</ol>\n<h3 id=\"2é¢-1\"><a href=\"#2é¢-1\" class=\"headerlink\" title=\"2é¢\"></a>2é¢</h3><ol>\n<li>Reactæºç æœ‰è¯»è¿‡å—ï¼Ÿ</li>\n<li>Fiberæ˜¯æ€ä¹ˆåšè°ƒåº¦çš„ï¼Œjsä¸æ˜¯å•çº¿ç¨‹å—ï¼Ÿæ˜¯æ€ä¹ˆæ‰“æ–­è®¡ç®—çš„ï¼Ÿ</li>\n<li>è¯´ä¸€ä¸‹ä½ å¹³å¸¸ç”¨çš„Hookså§</li>\n<li>ä»‹ç»å‰ç«¯æ€§èƒ½ä¼˜åŒ–</li>\n<li>å¯¹äºå‰ç«¯ä»£ç æ”»å‡»ä½ äº†è§£å“ªäº›ï¼Ÿ</li>\n<li>cookieçš„å­˜å‚¨æœ‰å“ªäº›æ–°çš„å±æ€§</li>\n<li>Http2æœ‰å“ªäº›æ–°åŠŸèƒ½</li>\n<li>httpå’Œhttpsæœ‰ä»€ä¹ˆåŒºåˆ«</li>\n<li>ä»‹ç»ä¸€ä¸‹éå¯¹ç§°åŠ å¯†</li>\n<li>JavaScriptç»§æ‰¿ç†Ÿæ‚‰å—ï¼Ÿæœ‰å“ªäº›æ–¹å¼ï¼Ÿ</li>\n</ol>\n<h3 id=\"3é¢HR\"><a href=\"#3é¢HR\" class=\"headerlink\" title=\"3é¢HR\"></a>3é¢HR</h3><p>ä¸Šæ¥å°±æºç æˆ‘ä»¥ä¸ºæˆ‘è¦å‡‰äº†ï¼Œä¸è¿‡åé¢éƒ½æœ‰å¤ä¹ åˆ°ï¼Œç®—æ˜¯æ‰³å›ä¸€åŸã€‚è°ˆè–ªã€‚</p>\n<h2 id=\"ç«çŸ³åˆ›é€ \"><a href=\"#ç«çŸ³åˆ›é€ \" class=\"headerlink\" title=\"ç«çŸ³åˆ›é€ \"></a>ç«çŸ³åˆ›é€ </h2><p>æ˜¯ä¸€å®¶å‰ç«¯ä¸»å¯¼çš„å›¢é˜Ÿï¼Œå‰ç«¯äººè¶…çº§å¤š</p>\n<h3 id=\"1é¢-3\"><a href=\"#1é¢-3\" class=\"headerlink\" title=\"1é¢\"></a>1é¢</h3><ol>\n<li>è¯´ä¸€ä¸‹ç§»åŠ¨ç«¯é€‚é…çš„åŸç†</li>\n<li>è¯´ä¸€ä¸‹å‰ç«¯æ€§èƒ½ä¼˜åŒ–</li>\n<li>å¹³å¸¸å¯¹äºè·¨åŸŸæ˜¯æ€ä¹ˆåšçš„</li>\n<li>webpackçš„pluginæœ‰åšè¿‡å—ï¼Ÿ</li>\n<li>JSçš„ç»§æ‰¿</li>\n<li>çœ‹ä½ æœ‰å°è£…è¿‡echartsï¼Œä½ æ˜¯æ€ä¹ˆå°è£…çš„</li>\n<li>Vueå’ŒReactçš„åŒºåˆ«</li>\n<li>è¯´ä¸€ä¸‹CSSåŠ¨ç”»</li>\n<li>è¯´ä¸€ä¸‹keyåœ¨Reactå’ŒVueä¸­çš„ä½œç”¨ï¼Œå¦‚æœæ²¡æœ‰ä¼šæ€ä¹ˆæ ·ï¼Ÿä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå…·ä½“</li>\n<li>RNæœ‰åšè¿‡å—ï¼ŸTaroå‘¢ï¼Ÿ</li>\n<li>ç°åœ¨æˆ‘æœ‰ä¸€ä¸ªæ•°ç»„ï¼Œæˆ‘æƒ³é’ˆå¯¹æ¯ä¸ªå…ƒç´ çš„åé¢éƒ½åŠ å…¥ä¸€ä¸ªæ–°çš„å…ƒç´ ï¼Œæœ‰å“ªäº›æ–¹æ³•</li>\n<li>å‡å¦‚æˆ‘ç”¨forçš„ç´¢å¼•æ¥åŠ ï¼Œä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</li>\n</ol>\n<h3 id=\"2é¢HR\"><a href=\"#2é¢HR\" class=\"headerlink\" title=\"2é¢HR\"></a>2é¢HR</h3><p>å¯èƒ½æ˜¯å¤ªæ™šäº†ï¼Œç«çŸ³æ˜¯ç¬¬ä¸‰å®¶é¢è¯•äº†ï¼Œè€Œä¸”æˆ‘åäº†å¾ˆä¹…çš„åœ°é“ï¼ŒHRå¯èƒ½è§‰å¾—æˆ‘äººæ²¡ç²¾ç¥ï¼Œä¹Ÿæœ‰å¯èƒ½æˆ‘ç¡®å®æœ‰æ¯›ç—…ã€‚ã€‚ã€‚</p>\n<h2 id=\"åšè”æ™ºèƒ½\"><a href=\"#åšè”æ™ºèƒ½\" class=\"headerlink\" title=\"åšè”æ™ºèƒ½\"></a>åšè”æ™ºèƒ½</h2><h3 id=\"1é¢-4\"><a href=\"#1é¢-4\" class=\"headerlink\" title=\"1é¢\"></a>1é¢</h3><p>åŸºæœ¬ä¸Šéƒ½æ˜¯å¾ˆåŸºç¡€çš„é¢˜ç›®ã€‚æ„Ÿè§‰æ˜¯ä¹‹å‰å›¢é˜Ÿå…¨éƒ¨è·‘è·¯äº†ï¼Œåªæœ‰ä»–ä¸€ä¸ªå‰ç«¯ï¼Œè€Œä¸”åŠ ç­å¾ˆä¸¥é‡ï¼Œä»–çš„å¥½åƒæ‰åˆšåˆšæ¯•ä¸šâ€¦.</p>\n<h2 id=\"å©šç¤¼çºª\"><a href=\"#å©šç¤¼çºª\" class=\"headerlink\" title=\"å©šç¤¼çºª\"></a>å©šç¤¼çºª</h2><h3 id=\"1é¢-5\"><a href=\"#1é¢-5\" class=\"headerlink\" title=\"1é¢\"></a>1é¢</h3><ol>\n<li>ä½ ç”¨è¿‡å“ªäº›Hook</li>\n<li>Hookçš„è§„åˆ™åŸç†</li>\n<li>ä¸ºä»€ä¹ˆè¦ç§»é™¤é‚£äº›ç”Ÿå‘½å‘¨æœŸ</li>\n<li>è¯´ä¸€ä¸‹æ—¶é—´å¾ªç¯</li>\n<li>setStateæ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥ï¼Ÿ</li>\n<li>setStateçš„å›è°ƒå‡½æ•°æ˜¯å®ä»»åŠ¡è¿˜æ˜¯å¾®ä»»åŠ¡</li>\n<li>webpackçƒ­æ›´æ–°åŸç†</li>\n<li>webpackçš„loaderçš„ä½œç”¨</li>\n<li>ä¸ºä»€ä¹ˆFiberå¯ä»¥ä¸­æ–­æ­£åœ¨è¿›è¡Œä¸­çš„è®¡ç®—ï¼Ÿ</li>\n<li>JSXç¼–è¯‘ä¹‹åæ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿ</li>\n<li>Reactä¸­é‚£äº›propsä¸èƒ½ä¼ é€’ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</li>\n<li>å‡å¦‚æˆ‘è¦å°è£…ä¸€ä¸‹ä¸Šæ‹‰åŠ è½½çš„Hookè¦æ€ä¹ˆå°è£…ï¼Ÿ</li>\n</ol>\n<h3 id=\"2é¢-2\"><a href=\"#2é¢-2\" class=\"headerlink\" title=\"2é¢\"></a>2é¢</h3><ol>\n<li>nodejs å¸¸ç”¨å‘½ä»¤ä½ çŸ¥é“å“ªäº›ï¼Ÿ</li>\n<li>ä»‹ç»ä¸€ä¸‹JavaScriptçš„å†…å­˜</li>\n<li>WeakMapå’ŒMapæœ‰ä»€ä¹ˆåŒºåˆ«</li>\n<li>Postå’ŒGetæœ‰ä»€ä¹ˆåŒºåˆ«</li>\n<li>è¿”å›çš„çŠ¶æ€ç ä¸€å®š200å°±æ˜¯å¯¹çš„å—ï¼Ÿ</li>\n<li>é‚£æˆ‘è¿”å›300ä¹Ÿå¯ä»¥æ˜¯å¯¹çš„å—ï¼Ÿ</li>\n<li>electronç”¨è¿‡å—ï¼Ÿ</li>\n<li>RNä¼šå—ï¼Ÿ</li>\n<li>Webpackçš„åŸç†</li>\n<li>ç°åœ¨è®©ä½ æ‰‹å†™ä¸€ä¸ªWebpackï¼Œä½ è¦æ€ä¹ˆæ¥å†™ï¼Ÿ</li>\n<li>Webpackä¼˜åŒ–çŸ¥é“å“ªäº›ï¼Ÿ</li>\n</ol>\n<p>å‡‰å‡‰ã€‚ã€‚ã€‚å¹¿åº¦ä¸å¤Ÿã€‚ã€‚ã€‚555</p>\n<h2 id=\"æ•°ç«‹ä¿¡æ¯\"><a href=\"#æ•°ç«‹ä¿¡æ¯\" class=\"headerlink\" title=\"æ•°ç«‹ä¿¡æ¯\"></a>æ•°ç«‹ä¿¡æ¯</h2><h3 id=\"1é¢-6\"><a href=\"#1é¢-6\" class=\"headerlink\" title=\"1é¢\"></a>1é¢</h3><ol>\n<li>ä»€ä¹ˆæ˜¯åŸå‹é“¾</li>\n<li>æ‰‹å†™å¯„ç”Ÿç»„åˆç»§æ‰¿</li>\n<li>thisæŒ‡å‘ä¼˜å…ˆçº§</li>\n<li>ä»€ä¹ˆå«åšé—­åŒ…ï¼Ÿ</li>\n<li>useEffectçš„å›è°ƒå‡½æ•°æ¯æ¬¡éƒ½ä¼šæ‰§è¡Œè¿˜æ˜¯åœ¨å¸è½½çš„æ—¶å€™æ‰§è¡Œï¼Ÿ</li>\n<li>ç±»ç»„ä»¶çš„thiså˜é‡ï¼Œåœ¨å‡½æ•°æ˜¯ç»„ä»¶ä¸­æ€ä¹ˆè¡¨ç¤ºï¼Ÿ</li>\n<li>setStateçš„é“¾è¡¨æ˜¯ç¯å½¢çš„å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</li>\n<li>è·¨åŸŸ</li>\n</ol>\n<h3 id=\"2é¢-3\"><a href=\"#2é¢-3\" class=\"headerlink\" title=\"2é¢\"></a>2é¢</h3><ol>\n<li>reduxæºç è¯»è¿‡å—ï¼Ÿ</li>\n<li>reduxä¸­é—´ä»¶çš„è®¾è®¡ç†å¿µæ˜¯ä»€ä¹ˆï¼Ÿ</li>\n<li>stickyç”¨è¿‡å—ï¼Ÿ</li>\n<li>px to remçš„è®¡ç®—åŸç†</li>\n<li>Webpackçš„tree shankingäº†è§£å—ï¼ŸåŸç†ï¼Ÿæ€ä¹ˆå†™ï¼Ÿ</li>\n<li>BFCä¸ºä»€ä¹ˆä¼šæœ‰é‚£äº›ç‰¹æ€§ï¼Ÿ</li>\n<li>Reactäº‹ä»¶é›†åˆåŸç†</li>\n<li>ä¸ºä»€ä¹ˆè™šæ‹ŸDOMå¯ä»¥åšè·¨å¹³å°</li>\n</ol>\n<h2 id=\"å…‰äº‘ç§‘æŠ€\"><a href=\"#å…‰äº‘ç§‘æŠ€\" class=\"headerlink\" title=\"å…‰äº‘ç§‘æŠ€\"></a>å…‰äº‘ç§‘æŠ€</h2><h3 id=\"1é¢-7\"><a href=\"#1é¢-7\" class=\"headerlink\" title=\"1é¢\"></a>1é¢</h3><ol>\n<li>var let conståŒºåˆ«</li>\n<li>localStorage sessionStorage cookie tokenåŒºåˆ«</li>\n<li>tokençš„ç»„æˆ</li>\n<li>Reactä¸ºä»€ä¹ˆç§»é™¤é‚£äº›ç”Ÿå‘½å‘¨æœŸ</li>\n<li>Hookçš„è®¾è®¡ç†å¿µï¼ŒHookè§„åˆ™åŸç†</li>\n<li>keyçš„ä½œç”¨</li>\n<li>è¯´ä¸€ä¸‹ä½ äº†è§£çš„é—­åŒ…</li>\n<li>è‡ªå®šä¹‰loaderå†™è¿‡å—ï¼Ÿ</li>\n<li>è·¨åŸŸçš„æ–¹å¼æ–¹æ³•</li>\n</ol>\n<h3 id=\"2é¢-4\"><a href=\"#2é¢-4\" class=\"headerlink\" title=\"2é¢\"></a>2é¢</h3><ol>\n<li>httpså’Œhttpçš„åŒºåˆ«</li>\n<li>httpè¯·æ±‚å¤´çš„ç»„æˆ</li>\n<li>cookieçš„ä½œç”¨</li>\n<li>cookieçš„æ–°çš„å±æ€§</li>\n<li>æ€ä¹ˆé˜»æ­¢ç¬¬ä¸‰æ–¹æ”»å‡»</li>\n<li>å‡å¦‚è®©ä½ è®¾è®¡ä¸€ä¸ªç§’æ€é¡µé¢ä½ ä¼šæƒ³åˆ°é‚£äº›åœºæ™¯å’Œåº”å¯¹æ–¹å¼</li>\n</ol>\n<h1 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h1><p>æˆ‘ä¸ªäººè®¤ä¸ºå¿…è€ƒçš„å‡ ä¸ªç‚¹ï¼Œå¦‚æœå¤ä¹ å¥½äº†çš„è¯ã€‚1é¢åº”è¯¥é—®é¢˜ä¸å¤§</p>\n<ol>\n<li>URLåˆ°é¡µé¢æ¸²æŸ“è¿‡ç¨‹</li>\n<li>JavaScriptç»§æ‰¿</li>\n<li>é—­åŒ…</li>\n<li>Promise</li>\n<li>httpè¯·æ±‚å¤´ï¼Œç ï¼Œæ–¹æ³•ä¹‹é—´çš„åŒºåˆ«ï¼Œhttp2ï¼Œhttps</li>\n<li>è·¨åŸŸ</li>\n<li>React FiberåŸç†</li>\n<li>Hookè§„åˆ™åŸç†</li>\n<li>setStateæ˜¯å¦å¼‚æ­¥</li>\n<li>å‰ç«¯æ€§èƒ½ä¼˜åŒ–ï¼ˆWebpackï¼Œjsï¼Œcssï¼Œé‡ç»˜ï¼Œå›æµï¼Œé˜²æŠ–ï¼ŒèŠ‚æµ</li>\n<li>Reactç”Ÿå‘½å‘¨æœŸï¼Œå®˜æ–¹çš„Hooksçƒ‚ç†Ÿäºå¿ƒ</li>\n<li>Flexï¼ŒBFCï¼Œå±…ä¸­</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h1><p>è¯´ä¸€ç‚¹åºŸè¯å§ï¼Œç®—æ˜¯åæ§½ã€‚</p>\n<p>ç°åœ¨æ­å·çš„æ°›å›´å¾ˆæ€ªï¼ŒåŒä¼‘éƒ½å¯ä»¥æ‹¿å‡ºæ¥å¹çš„é‚£ç§ã€‚å”‰ï¼Œä¸è¿‡è™½ç„¶æ˜¯ç–«æƒ…ï¼Œå‰ç«¯çš„å²—ä½è¿˜æ˜¯è›®å¤šçš„ï¼Œæˆ‘åŸºæœ¬ä¸Šä¸€å¤©2ä¸ªé¢è¯•ã€‚åœ¨æœªæ¥ç§‘æŠ€åŸå’Œæ»¨æ±Ÿä¸¤å¤´è·‘ã€‚ä¸è¿‡ç°åœ¨å·²ç»å…¥èŒå•¦ã€‚</p>\n<h1 id=\"å…¬å¸åˆ—è¡¨\"><a href=\"#å…¬å¸åˆ—è¡¨\" class=\"headerlink\" title=\"å…¬å¸åˆ—è¡¨\"></a>å…¬å¸åˆ—è¡¨</h1><ul>\n<li>å®‰æ’ç§‘æŠ€ -&gt; æŒ‚åœ¨4é¢å‰¯æ€»è£ã€‚<ul>\n<li>çœ‹äº†çŸ¥ä¹ä¸Šé¢çš„è¯„ä»·ç„¶åå»é¢çš„å‰¯æ€»è£ï¼Œå‘ç°åŠ ç­ä¸¥é‡ï¼Œç„¶åæœŸæœ›è–ªèµ„å¼€çš„æ¯”è¾ƒé«˜ï¼Œè€Œä¸”å‰¯æ€»è£æœŸé—´ä¸€ç›´åœ¨æ‘†å¼„æ‰‹æœºä¸çŸ¥é“æ˜¯ä¸æ˜¯æ¯”è¾ƒå¿™ï¼Œåœºé¢ç»å¸¸å†·é™å¥½ä¸€ä¼šã€‚</li>\n</ul>\n</li>\n<li>åšåœ£ç”Ÿç‰© -&gt; offerï¼Œä½†æ˜¯è–ªèµ„å¼€çš„æ¯”è¾ƒä½ï¼Œæ‰€ä»¥æ²¡å»</li>\n<li>æ•°ç§¦ç§‘æŠ€ -&gt; å·²ç»å…¥èŒå•¦</li>\n<li>ç«çŸ³åˆ›é€  -&gt; æŒ‚åœ¨HRé‚£è¾¹äº†ï¼Œä¼°è®¡æ˜¯æˆ‘è·³æ§½æ¯”è¾ƒé¢‘ç¹ï¼Œè€Œä¸”é‚£å¤©å¾ˆæ™šè¿‡å»çš„ï¼Œäººå¾ˆç–²æƒ«æ²¡ä»€ä¹ˆç²¾ç¥ï¼ŒHRè¿˜é—®æˆ‘å¹³å¸¸æ˜¯ä¸æ˜¯ä¹Ÿæ˜¯è¿™æ ·æ²¡ç²¾ç¥â€¦.å°´å°¬</li>\n<li>åšè”æ™ºèƒ½ -&gt; åé¢å‘ç°å‰ç«¯å›¢é˜Ÿåªæœ‰ä¸€ä¸ªäººï¼Œè€Œä¸”é¢è¯•å®˜å¥½åƒå·¥ä½œæ²¡å¤šä¹…ã€‚ã€‚ã€‚å…¨æ˜¯ç½‘ä¸Šçš„é¢˜ç›®ï¼ŒäºŒé¢å°±æ²¡å»äº†</li>\n<li>å©šç¤¼çºª -&gt; æŒ‚åœ¨2é¢ï¼Œå‰ç«¯leaderè§‰å¾—æˆ‘nodeä¸å¤ªç†Ÿæ‚‰ï¼Œå¹¿åº¦ä¸å¤Ÿâ€¦.</li>\n<li>æ•°ç«‹ä¿¡æ¯ -&gt; æŒ‚åœ¨äºŒé¢ï¼Œä¸çŸ¥é“å…·ä½“å“ªé‡Œä¸è¡Œâ€¦.æˆ‘æ„Ÿè§‰æˆ‘éƒ½ç­”ä¸Šæ¥äº†â€¦</li>\n<li>é˜¿é‡Œé›¶å”®äº‹ä¸šéƒ¨ -&gt; ä¸€é¢å°±æŒ‚äº†ï¼Œé‚£ä¸ªæ—¶å€™åˆšåˆšååŠ¨è½¦åˆ°æ­å·ï¼Œç¡®å®ä¹Ÿæ²¡æ€ä¹ˆå‡†å¤‡ï¼Œå¾ˆå¯æƒœï¼</li>\n<li>å…‰äº‘ç§‘æŠ€ -&gt; æˆ‘æœŸæœ›å¼€çš„å¤ªé«˜äº†â€¦.ç„¶åæŒ‚åœ¨äº†HR</li>\n</ul>\n<h1 id=\"é¢ç»\"><a href=\"#é¢ç»\" class=\"headerlink\" title=\"é¢ç»\"></a>é¢ç»</h1><h2 id=\"é˜¿é‡Œ-é›¶å”®éƒ¨\"><a href=\"#é˜¿é‡Œ-é›¶å”®éƒ¨\" class=\"headerlink\" title=\"é˜¿é‡Œ-é›¶å”®éƒ¨\"></a>é˜¿é‡Œ-é›¶å”®éƒ¨</h2><h3 id=\"1é¢\"><a href=\"#1é¢\" class=\"headerlink\" title=\"1é¢\"></a>1é¢</h3><ol>\n<li>jsbridgeçš„åŸç†</li>\n<li>è·¨åŸŸçš„åœºæ™¯ä½ ç”¨åˆ°é‚£äº›ï¼Ÿ</li>\n<li>jsonpçš„åŸç†ï¼Œjsonpæ€ä¹ˆç”¨</li>\n<li>æœ‰æ•°æ®ç›¸å…³çš„å—ï¼Ÿæ¯”å¦‚PVï¼ŒUV</li>\n<li>px to remçš„åŸç†èƒ½è¯´ä¸€ä¸‹å—ï¼Ÿ</li>\n<li>å…·ä½“æ€ä¹ˆç®—çš„å¯ä»¥è¯´ä¸€ä¸‹å—ï¼Ÿ</li>\n<li>onClickæ˜¯ä»€ä¹ˆæ—¶å€™æ‰§è¡Œçš„ï¼Ÿ</li>\n<li>å¦‚æœæˆ‘å†™äº†ä¸€ä¸ªaddListenerï¼Œç„¶ååˆå†™äº†onCLickï¼Œè¿™ä¸ªæ—¶å€™ç‚¹å‡»ä¸€ä¸‹ä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…ï¼Ÿ</li>\n<li>å‰ç«¯æ€§èƒ½ä¼˜åŒ–</li>\n<li>happypackåŸç†</li>\n<li>reactçš„è™šæ‹ŸDOMç®—æ³•</li>\n</ol>\n<h2 id=\"å®‰æ’ç§‘æŠ€\"><a href=\"#å®‰æ’ç§‘æŠ€\" class=\"headerlink\" title=\"å®‰æ’ç§‘æŠ€\"></a>å®‰æ’ç§‘æŠ€</h2><h3 id=\"1é¢-1\"><a href=\"#1é¢-1\" class=\"headerlink\" title=\"1é¢\"></a>1é¢</h3><ol>\n<li>ç±»ç»„ä»¶å’Œå‡½æ•°å¼ç»„ä»¶çš„åŒºåˆ«ï¼Œæˆ–è€…è¯´ä¸€ä¸‹ä½ ä½¿ç”¨æœ€ç›´æ¥çš„æ„Ÿå—ï¼Œä»¥åŠä»–ä»¬çš„ä¼˜ç¼ºç‚¹</li>\n<li>æœ‰è¯•è¿‡è‡ªå·±å°è£…Hookå—ï¼Ÿ</li>\n<li>æ”¹å˜thisæŒ‡å‘çš„æ–¹å¼é™¤äº†bindä»¥åŠç®­å¤´å‡½æ•°è¿˜æœ‰å“ªäº›ï¼Ÿ</li>\n<li>ä¸ºä»€ä¹ˆReactä¸­onClickåœ¨ç‚¹å‡»çš„æ—¶å€™ä¼šæ‰§è¡Œï¼Ÿ</li>\n<li>Reactä¸­keyçš„ä½œç”¨</li>\n<li>React Fiberä½ äº†è§£å—ï¼Ÿ</li>\n<li>è¯´ä¸€ä¸‹è™šæ‹ŸDOMçš„ä¼˜ç¼ºç‚¹</li>\n<li>å¼€å‘ä¸­ç”¨åˆ°Reduxæ˜¯è‡ªå·±å°è£…çš„å—ï¼Ÿ</li>\n<li>Reactç±»ç»„ä»¶çš„extendså’ŒcreateElementæœ‰ä»€ä¹ˆåŒºåˆ«å—ï¼Ÿ</li>\n<li>ç»„ä»¶åå­—é¦–å­—æ¯ä¸ºä»€ä¹ˆä¸€å®šè¦å¤§å†™ï¼Ÿ</li>\n<li>ES5ä¸­åˆ¤æ–­æ•°ç»„æœ‰ä»€ä¹ˆæ–¹å¼ï¼Ÿ</li>\n<li>æ€ä¹ˆæ ·å¹¶å‘è¯·æ±‚ï¼Ÿ</li>\n<li>å‰ç«¯æ€§èƒ½ä¼˜åŒ–</li>\n<li>æœ‰ç”¨è¿‡Typescriptå—ï¼Ÿä»‹ç»ä¸€ä¸‹ä½ å¹³å¸¸å¸¸ç”¨çš„</li>\n<li>å·¥ä½œä¸­é‡åˆ°æœ€éš¾çš„é—®é¢˜</li>\n<li>å¹³å¸¸æ˜¯æ€ä¹ˆå­¦ä¹ çš„</li>\n</ol>\n<h3 id=\"2é¢\"><a href=\"#2é¢\" class=\"headerlink\" title=\"2é¢\"></a>2é¢</h3><p>æœ¬æ¥è¦é¢è¯•æˆ‘çš„äºŒé¢çš„é¢è¯•å®˜é›¶æ—¶æœ‰äº‹ï¼Œè¿™ä¸ªæ˜¯éš”å£ç»„çš„leaderã€‚ã€‚</p>\n<ol>\n<li>å°è£…ä¸€ä¸ªç½‘ç»œè¯·æ±‚æ˜¯æ€ä¹ˆå°è£…çš„ï¼Œè¦è¾¾åˆ°ä»€ä¹ˆæ ·çš„æ•ˆæœï¼ˆå› ä¸ºæˆ‘ç®€å†å†™äº†</li>\n<li>è¯´ä¸€ä¸‹ä½ å°è£…è¡¨å•ç»„ä»¶çš„æƒ³æ³•ï¼ˆä¹Ÿæ˜¯ç®€å†ã€‚ã€‚ã€‚</li>\n<li>è¯´ä¸€ä¸‹ä½ çš„é‰´æƒæ€è·¯ï¼ˆä¹Ÿæ˜¯ç®€å†</li>\n<li>ç°åœ¨Typescriptæœ‰ç”¨å—ï¼Ÿä½ è§‰å¾—è‡ªå·±Typescriptç”¨çš„æ€ä¹ˆæ ·ï¼Ÿ</li>\n<li>è¯´ä¸€ä¸‹Reactæœ€æ–°çš„ç”Ÿå‘½å‘¨æœŸ</li>\n<li>æœ‰å†™è¿‡Reduxçš„ä¸­é—´ä»¶å—ï¼Ÿ</li>\n<li>è¯´ä¸€ä¸‹React Fiberåšäº†ä¸€ä»¶ä»€ä¹ˆäº‹æƒ…</li>\n</ol>\n<h3 id=\"3é¢\"><a href=\"#3é¢\" class=\"headerlink\" title=\"3é¢\"></a>3é¢</h3><p>å¿˜è®°å½•éŸ³äº†ã€‚ã€‚ã€‚é è®°å¿†åŠ›æƒ³æƒ³</p>\n<ol>\n<li>è¯´ä¸€ä¸‹äº‹ä»¶å¾ªç¯</li>\n<li>æˆ‘ä»¬å†™çš„onClickæ˜¯äº‹ä»¶æ•è·å—ï¼Ÿå’Œäº‹ä»¶å†’æ³¡çš„é¡ºåºæ˜¯æ€ä¹ˆæ ·çš„</li>\n<li>CSSçš„æƒé‡</li>\n<li>å¯¹äºè·¨åŸŸä½ æ˜¯æ€çœ‹å¾…çš„</li>\n<li>è¯´ä¸€ä¸‹ä½ å¯¹JavaScriptå†…å­˜çš„ç†è§£</li>\n<li>ä»‹ç»ä¸€ä¸‹Promiseå§</li>\n<li>è¾“å…¥URLåˆ°é¡µé¢æ¸²æŸ“å‘ç”Ÿäº†ä»€ä¹ˆ</li>\n<li>å¹³å¸¸æ˜¯æ€ä¹ˆå­¦ä¹ çš„ï¼Ÿ</li>\n</ol>\n<p>é¢˜ç›®å¤ªå®½æ³›äº†ã€‚ã€‚ã€‚è€ƒå¯ŸçŸ¥è¯†æ·±åº¦ã€‚ã€‚</p>\n<h3 id=\"4é¢\"><a href=\"#4é¢\" class=\"headerlink\" title=\"4é¢\"></a>4é¢</h3><ol>\n<li>ä¸ºä»€ä¹ˆä»ä¸Šå®¶å…¬å¸ç¦»èŒ</li>\n<li>è¯´ä¸€ä¸‹ä½ å¯¹åŠ ç­çš„ç†è§£</li>\n<li>å¯¹æœªæ¥çš„è§„åˆ’</li>\n</ol>\n<h2 id=\"åšåœ£ç”Ÿç‰©\"><a href=\"#åšåœ£ç”Ÿç‰©\" class=\"headerlink\" title=\"åšåœ£ç”Ÿç‰©\"></a>åšåœ£ç”Ÿç‰©</h2><h3 id=\"1é¢-2\"><a href=\"#1é¢-2\" class=\"headerlink\" title=\"1é¢\"></a>1é¢</h3><ol>\n<li>ç¦»èŒåŸå› </li>\n<li>é¡¹ç›®ä¸­å°è±¡ä¸­æ¯”è¾ƒæ·±åˆ»çš„</li>\n<li>å¯¹äºç§»åŠ¨ç«¯çš„é€‚é…</li>\n<li>é«˜æ¸…å±1pxçš„å…¼å®¹ï¼Œé«˜æ¸…å±å˜ç²—é—®é¢˜<ol>\n<li>è¦ç²¾ç¡®åˆ°æ¯ä¸€è¡Œã€‚ã€‚ã€‚</li>\n</ol>\n</li>\n<li>è¯´ä¸€ä¸‹é˜²æŠ–èŠ‚æµçš„åŸç†</li>\n<li>JSæ‹–æ‹½åŸç†</li>\n<li>è¯´ä¸€ä¸‹flexçš„æ¯ä¸ªå±æ€§å¯¹åº”çš„æ„æ€</li>\n<li>CSSæ°´å¹³å‚ç›´å±…ä¸­</li>\n<li>æœ‰è‡ªå·±å†™è¿‡webpack loaderå’Œpluginå—ï¼Ÿä»–ä»¬çš„åŸç†å’ŒåŒºåˆ«</li>\n</ol>\n<h3 id=\"2é¢-1\"><a href=\"#2é¢-1\" class=\"headerlink\" title=\"2é¢\"></a>2é¢</h3><ol>\n<li>Reactæºç æœ‰è¯»è¿‡å—ï¼Ÿ</li>\n<li>Fiberæ˜¯æ€ä¹ˆåšè°ƒåº¦çš„ï¼Œjsä¸æ˜¯å•çº¿ç¨‹å—ï¼Ÿæ˜¯æ€ä¹ˆæ‰“æ–­è®¡ç®—çš„ï¼Ÿ</li>\n<li>è¯´ä¸€ä¸‹ä½ å¹³å¸¸ç”¨çš„Hookså§</li>\n<li>ä»‹ç»å‰ç«¯æ€§èƒ½ä¼˜åŒ–</li>\n<li>å¯¹äºå‰ç«¯ä»£ç æ”»å‡»ä½ äº†è§£å“ªäº›ï¼Ÿ</li>\n<li>cookieçš„å­˜å‚¨æœ‰å“ªäº›æ–°çš„å±æ€§</li>\n<li>Http2æœ‰å“ªäº›æ–°åŠŸèƒ½</li>\n<li>httpå’Œhttpsæœ‰ä»€ä¹ˆåŒºåˆ«</li>\n<li>ä»‹ç»ä¸€ä¸‹éå¯¹ç§°åŠ å¯†</li>\n<li>JavaScriptç»§æ‰¿ç†Ÿæ‚‰å—ï¼Ÿæœ‰å“ªäº›æ–¹å¼ï¼Ÿ</li>\n</ol>\n<h3 id=\"3é¢HR\"><a href=\"#3é¢HR\" class=\"headerlink\" title=\"3é¢HR\"></a>3é¢HR</h3><p>ä¸Šæ¥å°±æºç æˆ‘ä»¥ä¸ºæˆ‘è¦å‡‰äº†ï¼Œä¸è¿‡åé¢éƒ½æœ‰å¤ä¹ åˆ°ï¼Œç®—æ˜¯æ‰³å›ä¸€åŸã€‚è°ˆè–ªã€‚</p>\n<h2 id=\"ç«çŸ³åˆ›é€ \"><a href=\"#ç«çŸ³åˆ›é€ \" class=\"headerlink\" title=\"ç«çŸ³åˆ›é€ \"></a>ç«çŸ³åˆ›é€ </h2><p>æ˜¯ä¸€å®¶å‰ç«¯ä¸»å¯¼çš„å›¢é˜Ÿï¼Œå‰ç«¯äººè¶…çº§å¤š</p>\n<h3 id=\"1é¢-3\"><a href=\"#1é¢-3\" class=\"headerlink\" title=\"1é¢\"></a>1é¢</h3><ol>\n<li>è¯´ä¸€ä¸‹ç§»åŠ¨ç«¯é€‚é…çš„åŸç†</li>\n<li>è¯´ä¸€ä¸‹å‰ç«¯æ€§èƒ½ä¼˜åŒ–</li>\n<li>å¹³å¸¸å¯¹äºè·¨åŸŸæ˜¯æ€ä¹ˆåšçš„</li>\n<li>webpackçš„pluginæœ‰åšè¿‡å—ï¼Ÿ</li>\n<li>JSçš„ç»§æ‰¿</li>\n<li>çœ‹ä½ æœ‰å°è£…è¿‡echartsï¼Œä½ æ˜¯æ€ä¹ˆå°è£…çš„</li>\n<li>Vueå’ŒReactçš„åŒºåˆ«</li>\n<li>è¯´ä¸€ä¸‹CSSåŠ¨ç”»</li>\n<li>è¯´ä¸€ä¸‹keyåœ¨Reactå’ŒVueä¸­çš„ä½œç”¨ï¼Œå¦‚æœæ²¡æœ‰ä¼šæ€ä¹ˆæ ·ï¼Ÿä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå…·ä½“</li>\n<li>RNæœ‰åšè¿‡å—ï¼ŸTaroå‘¢ï¼Ÿ</li>\n<li>ç°åœ¨æˆ‘æœ‰ä¸€ä¸ªæ•°ç»„ï¼Œæˆ‘æƒ³é’ˆå¯¹æ¯ä¸ªå…ƒç´ çš„åé¢éƒ½åŠ å…¥ä¸€ä¸ªæ–°çš„å…ƒç´ ï¼Œæœ‰å“ªäº›æ–¹æ³•</li>\n<li>å‡å¦‚æˆ‘ç”¨forçš„ç´¢å¼•æ¥åŠ ï¼Œä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</li>\n</ol>\n<h3 id=\"2é¢HR\"><a href=\"#2é¢HR\" class=\"headerlink\" title=\"2é¢HR\"></a>2é¢HR</h3><p>å¯èƒ½æ˜¯å¤ªæ™šäº†ï¼Œç«çŸ³æ˜¯ç¬¬ä¸‰å®¶é¢è¯•äº†ï¼Œè€Œä¸”æˆ‘åäº†å¾ˆä¹…çš„åœ°é“ï¼ŒHRå¯èƒ½è§‰å¾—æˆ‘äººæ²¡ç²¾ç¥ï¼Œä¹Ÿæœ‰å¯èƒ½æˆ‘ç¡®å®æœ‰æ¯›ç—…ã€‚ã€‚ã€‚</p>\n<h2 id=\"åšè”æ™ºèƒ½\"><a href=\"#åšè”æ™ºèƒ½\" class=\"headerlink\" title=\"åšè”æ™ºèƒ½\"></a>åšè”æ™ºèƒ½</h2><h3 id=\"1é¢-4\"><a href=\"#1é¢-4\" class=\"headerlink\" title=\"1é¢\"></a>1é¢</h3><p>åŸºæœ¬ä¸Šéƒ½æ˜¯å¾ˆåŸºç¡€çš„é¢˜ç›®ã€‚æ„Ÿè§‰æ˜¯ä¹‹å‰å›¢é˜Ÿå…¨éƒ¨è·‘è·¯äº†ï¼Œåªæœ‰ä»–ä¸€ä¸ªå‰ç«¯ï¼Œè€Œä¸”åŠ ç­å¾ˆä¸¥é‡ï¼Œä»–çš„å¥½åƒæ‰åˆšåˆšæ¯•ä¸šâ€¦.</p>\n<h2 id=\"å©šç¤¼çºª\"><a href=\"#å©šç¤¼çºª\" class=\"headerlink\" title=\"å©šç¤¼çºª\"></a>å©šç¤¼çºª</h2><h3 id=\"1é¢-5\"><a href=\"#1é¢-5\" class=\"headerlink\" title=\"1é¢\"></a>1é¢</h3><ol>\n<li>ä½ ç”¨è¿‡å“ªäº›Hook</li>\n<li>Hookçš„è§„åˆ™åŸç†</li>\n<li>ä¸ºä»€ä¹ˆè¦ç§»é™¤é‚£äº›ç”Ÿå‘½å‘¨æœŸ</li>\n<li>è¯´ä¸€ä¸‹æ—¶é—´å¾ªç¯</li>\n<li>setStateæ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥ï¼Ÿ</li>\n<li>setStateçš„å›è°ƒå‡½æ•°æ˜¯å®ä»»åŠ¡è¿˜æ˜¯å¾®ä»»åŠ¡</li>\n<li>webpackçƒ­æ›´æ–°åŸç†</li>\n<li>webpackçš„loaderçš„ä½œç”¨</li>\n<li>ä¸ºä»€ä¹ˆFiberå¯ä»¥ä¸­æ–­æ­£åœ¨è¿›è¡Œä¸­çš„è®¡ç®—ï¼Ÿ</li>\n<li>JSXç¼–è¯‘ä¹‹åæ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿ</li>\n<li>Reactä¸­é‚£äº›propsä¸èƒ½ä¼ é€’ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</li>\n<li>å‡å¦‚æˆ‘è¦å°è£…ä¸€ä¸‹ä¸Šæ‹‰åŠ è½½çš„Hookè¦æ€ä¹ˆå°è£…ï¼Ÿ</li>\n</ol>\n<h3 id=\"2é¢-2\"><a href=\"#2é¢-2\" class=\"headerlink\" title=\"2é¢\"></a>2é¢</h3><ol>\n<li>nodejs å¸¸ç”¨å‘½ä»¤ä½ çŸ¥é“å“ªäº›ï¼Ÿ</li>\n<li>ä»‹ç»ä¸€ä¸‹JavaScriptçš„å†…å­˜</li>\n<li>WeakMapå’ŒMapæœ‰ä»€ä¹ˆåŒºåˆ«</li>\n<li>Postå’ŒGetæœ‰ä»€ä¹ˆåŒºåˆ«</li>\n<li>è¿”å›çš„çŠ¶æ€ç ä¸€å®š200å°±æ˜¯å¯¹çš„å—ï¼Ÿ</li>\n<li>é‚£æˆ‘è¿”å›300ä¹Ÿå¯ä»¥æ˜¯å¯¹çš„å—ï¼Ÿ</li>\n<li>electronç”¨è¿‡å—ï¼Ÿ</li>\n<li>RNä¼šå—ï¼Ÿ</li>\n<li>Webpackçš„åŸç†</li>\n<li>ç°åœ¨è®©ä½ æ‰‹å†™ä¸€ä¸ªWebpackï¼Œä½ è¦æ€ä¹ˆæ¥å†™ï¼Ÿ</li>\n<li>Webpackä¼˜åŒ–çŸ¥é“å“ªäº›ï¼Ÿ</li>\n</ol>\n<p>å‡‰å‡‰ã€‚ã€‚ã€‚å¹¿åº¦ä¸å¤Ÿã€‚ã€‚ã€‚555</p>\n<h2 id=\"æ•°ç«‹ä¿¡æ¯\"><a href=\"#æ•°ç«‹ä¿¡æ¯\" class=\"headerlink\" title=\"æ•°ç«‹ä¿¡æ¯\"></a>æ•°ç«‹ä¿¡æ¯</h2><h3 id=\"1é¢-6\"><a href=\"#1é¢-6\" class=\"headerlink\" title=\"1é¢\"></a>1é¢</h3><ol>\n<li>ä»€ä¹ˆæ˜¯åŸå‹é“¾</li>\n<li>æ‰‹å†™å¯„ç”Ÿç»„åˆç»§æ‰¿</li>\n<li>thisæŒ‡å‘ä¼˜å…ˆçº§</li>\n<li>ä»€ä¹ˆå«åšé—­åŒ…ï¼Ÿ</li>\n<li>useEffectçš„å›è°ƒå‡½æ•°æ¯æ¬¡éƒ½ä¼šæ‰§è¡Œè¿˜æ˜¯åœ¨å¸è½½çš„æ—¶å€™æ‰§è¡Œï¼Ÿ</li>\n<li>ç±»ç»„ä»¶çš„thiså˜é‡ï¼Œåœ¨å‡½æ•°æ˜¯ç»„ä»¶ä¸­æ€ä¹ˆè¡¨ç¤ºï¼Ÿ</li>\n<li>setStateçš„é“¾è¡¨æ˜¯ç¯å½¢çš„å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</li>\n<li>è·¨åŸŸ</li>\n</ol>\n<h3 id=\"2é¢-3\"><a href=\"#2é¢-3\" class=\"headerlink\" title=\"2é¢\"></a>2é¢</h3><ol>\n<li>reduxæºç è¯»è¿‡å—ï¼Ÿ</li>\n<li>reduxä¸­é—´ä»¶çš„è®¾è®¡ç†å¿µæ˜¯ä»€ä¹ˆï¼Ÿ</li>\n<li>stickyç”¨è¿‡å—ï¼Ÿ</li>\n<li>px to remçš„è®¡ç®—åŸç†</li>\n<li>Webpackçš„tree shankingäº†è§£å—ï¼ŸåŸç†ï¼Ÿæ€ä¹ˆå†™ï¼Ÿ</li>\n<li>BFCä¸ºä»€ä¹ˆä¼šæœ‰é‚£äº›ç‰¹æ€§ï¼Ÿ</li>\n<li>Reactäº‹ä»¶é›†åˆåŸç†</li>\n<li>ä¸ºä»€ä¹ˆè™šæ‹ŸDOMå¯ä»¥åšè·¨å¹³å°</li>\n</ol>\n<h2 id=\"å…‰äº‘ç§‘æŠ€\"><a href=\"#å…‰äº‘ç§‘æŠ€\" class=\"headerlink\" title=\"å…‰äº‘ç§‘æŠ€\"></a>å…‰äº‘ç§‘æŠ€</h2><h3 id=\"1é¢-7\"><a href=\"#1é¢-7\" class=\"headerlink\" title=\"1é¢\"></a>1é¢</h3><ol>\n<li>var let conståŒºåˆ«</li>\n<li>localStorage sessionStorage cookie tokenåŒºåˆ«</li>\n<li>tokençš„ç»„æˆ</li>\n<li>Reactä¸ºä»€ä¹ˆç§»é™¤é‚£äº›ç”Ÿå‘½å‘¨æœŸ</li>\n<li>Hookçš„è®¾è®¡ç†å¿µï¼ŒHookè§„åˆ™åŸç†</li>\n<li>keyçš„ä½œç”¨</li>\n<li>è¯´ä¸€ä¸‹ä½ äº†è§£çš„é—­åŒ…</li>\n<li>è‡ªå®šä¹‰loaderå†™è¿‡å—ï¼Ÿ</li>\n<li>è·¨åŸŸçš„æ–¹å¼æ–¹æ³•</li>\n</ol>\n<h3 id=\"2é¢-4\"><a href=\"#2é¢-4\" class=\"headerlink\" title=\"2é¢\"></a>2é¢</h3><ol>\n<li>httpså’Œhttpçš„åŒºåˆ«</li>\n<li>httpè¯·æ±‚å¤´çš„ç»„æˆ</li>\n<li>cookieçš„ä½œç”¨</li>\n<li>cookieçš„æ–°çš„å±æ€§</li>\n<li>æ€ä¹ˆé˜»æ­¢ç¬¬ä¸‰æ–¹æ”»å‡»</li>\n<li>å‡å¦‚è®©ä½ è®¾è®¡ä¸€ä¸ªç§’æ€é¡µé¢ä½ ä¼šæƒ³åˆ°é‚£äº›åœºæ™¯å’Œåº”å¯¹æ–¹å¼</li>\n</ol>\n<h1 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h1><p>æˆ‘ä¸ªäººè®¤ä¸ºå¿…è€ƒçš„å‡ ä¸ªç‚¹ï¼Œå¦‚æœå¤ä¹ å¥½äº†çš„è¯ã€‚1é¢åº”è¯¥é—®é¢˜ä¸å¤§</p>\n<ol>\n<li>URLåˆ°é¡µé¢æ¸²æŸ“è¿‡ç¨‹</li>\n<li>JavaScriptç»§æ‰¿</li>\n<li>é—­åŒ…</li>\n<li>Promise</li>\n<li>httpè¯·æ±‚å¤´ï¼Œç ï¼Œæ–¹æ³•ä¹‹é—´çš„åŒºåˆ«ï¼Œhttp2ï¼Œhttps</li>\n<li>è·¨åŸŸ</li>\n<li>React FiberåŸç†</li>\n<li>Hookè§„åˆ™åŸç†</li>\n<li>setStateæ˜¯å¦å¼‚æ­¥</li>\n<li>å‰ç«¯æ€§èƒ½ä¼˜åŒ–ï¼ˆWebpackï¼Œjsï¼Œcssï¼Œé‡ç»˜ï¼Œå›æµï¼Œé˜²æŠ–ï¼ŒèŠ‚æµ</li>\n<li>Reactç”Ÿå‘½å‘¨æœŸï¼Œå®˜æ–¹çš„Hooksçƒ‚ç†Ÿäºå¿ƒ</li>\n<li>Flexï¼ŒBFCï¼Œå±…ä¸­</li>\n</ol>\n"},{"title":"ä½ çœŸçš„æ‡‚React Hookå—ï¼Ÿ","date":"2020-05-19T16:19:44.000Z","cover":"/image/cover/React.jpeg","_content":"## å‰è¨€\n\n1. è¯»è¿™ç¯‡æ–‡ç« çš„å‰ææ˜¯ä½ å·²ç»å¯¹React Hookæœ‰æ‰€äº†è§£çš„æƒ…å†µä¸‹ï¼Œå¦‚æœä½ è¿˜æ²¡æœ‰äº†è§£ï¼Œè¯·å…ˆç§»æ­¥å®˜ç½‘å­¦ä¹ ä¸€ä¸‹ã€‚\n   1. æœ€å¥½ä¸è¦å»ç½‘ä¸Šçœ‹åˆ«äººçš„æ€»ç»“ä¹‹ç±»çš„ï¼Œæ— éå°±æ˜¯è¶…çš„å®˜ç½‘çš„ï¼Œè€Œä¸”è¿™æ ·ä¼šè®©ä½ çš„è®¤çŸ¥ä»ä¸€å¼€å§‹å°±èµ°åã€‚\n2. è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯æ¢ç©¶Hookçš„åŠ¨æœºï¼Œä½¿ç”¨ä¸­çš„ä¸€äº›ç–‘é—®ï¼›\n   1. ä½¿ç”¨çš„è¯Reactå®˜ç½‘å·²ç»è®²å¾—å¾ˆè¯¦ç»†äº†ï¼Œè¿™é‡Œå°±ä¸å¤šèµ˜è¿°äº†ã€‚\n3. æœ‰éœ€è¦çœ‹æ¥ä¸‹æ¥çš„ç–‘éš¾ç‚¹çš„ä¼™ä¼´æ¬¢è¿ç›´æ¥è·³è¿‡æ¢ç©¶ç›´æ¥çœ‹å…·ä½“çš„ç–‘é—®ï¼›\n\n## æ¢ç©¶\n\nä¸»è¦ä»3ä¸ªæ–¹é¢ç ”ç©¶React Hook\n\næ ¹æ®é»„é‡‘æ€ç»´åœˆï¼ˆWhatã€Howã€Whyï¼‰\n\n### What\n\nä»€ä¹ˆæ˜¯Hookï¼Ÿ\n\næ‰“å¼€Googleç¿»è¯‘ï¼Œå¾—åˆ°çš„è§£é‡Šï¼š*é’©ã€é’©å­*\n\n> å†çœ‹çœ‹Reactå®˜ç½‘çš„è§£é‡Šï¼šThey let you use state and other React features without writing a class.ï¼ˆå®ƒå¯ä»¥è®©ä½ åœ¨ä¸ç¼–å†™ class çš„æƒ…å†µä¸‹ä½¿ç”¨ state ä»¥åŠå…¶ä»–çš„ React ç‰¹æ€§ã€‚ï¼‰\n\næ‰€ä»¥ï¼Œç»“åˆä¸€ä¸‹ã€‚æˆ‘ä¸ªäººçš„ç†è§£æ˜¯è¿™æ ·çš„ï¼šå¯¹äºå‡½æ•°å¼çš„ç»„ä»¶ï¼Œå¯ä»¥ç”¨é’©å­ï¼ˆHookï¼‰å°†æƒ³è¦çš„å¤–éƒ¨åŠŸèƒ½ç»™â€œé’©â€è¿›æ¥ã€‚\n\nåœ¨React Hookå‡ºæ¥ä¹‹å‰ï¼Œå‡½æ•°å¼ç»„ä»¶éƒ½æ˜¯æ— çŠ¶æ€çš„ç»„ä»¶ï¼Œæœ€å¤šå°±æ˜¯æ ¹æ®`props`æ¥åŠ ä¸€äº›åˆ¤æ–­çš„é€»è¾‘ï¼›è€Œåœ¨React Hookå‡ºæ¥ä¹‹åå°±å¯ä»¥åœ¨å‡½æ•°å¼ç»„ä»¶é‡Œé¢åŠ å…¥çŠ¶æ€ï¼ˆuseStateï¼‰ï¼Œç±»ç”Ÿå‘½å‘¨æœŸï¼ˆuseEffectï¼‰ï¼Œç”šè‡³æ˜¯ä¸€äº›è‡ªå·±çš„å¤ç”¨é€»è¾‘ï¼ˆè‡ªå®šä¹‰Hookï¼‰ç­‰ç­‰è¿™äº›å¤–éƒ¨çš„åŠŸèƒ½ã€‚\n\n\n\n### How\n\næ€ä¹ˆä½¿ç”¨Hookï¼Ÿ\n\nå¤§å®¶ä¸€èµ·çœ‹ä¸€ä¸‹å®˜ç½‘çš„ä¸€ä¸ªä¾‹å­ã€‚\n\né¢˜ç›®ï¼šæ˜¾ç¤ºä¸€ä¸ªè®¡æ•°å™¨ã€‚å½“ä½ ç‚¹å‡»æŒ‰é’®ï¼Œè®¡æ•°å™¨çš„å€¼å°±ä¼šå¢åŠ ã€‚\n\n#### Classç»„ä»¶\n\n\n\n```javascript\nclass Example extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      count: 0\n    };\n  }\n\n  render() {\n    return (\n      <div>\n        <p>You clicked {this.state.count} times</p>\n        <button onClick={() => this.setState({ count: this.state.count + 1 })}>\n          Click me\n        </button>\n      </div>\n    );\n  }\n}\n```\n\n\n\n#### React Hook\n\n\n\n```javascript\nimport React, { useState } from 'react';\n\nfunction Example() {\n  // å£°æ˜ä¸€ä¸ªå« \"count\" çš„ state å˜é‡  const [count, setCount] = useState(0);\n  return (\n    <div>\n      <p>You clicked {count} times</p>\n      <button onClick={() => setCount(count + 1)}>\n        Click me\n      </button>\n    </div>\n  );\n}\n```\n\n\n\nè¿™æ ·å°±ç®—æ˜¯å®Œæˆäº†ä¸€ä¸ªæœ€ç®€å•çš„React Hook å®è·µï¼Œå…³äºä¸€äº›å®˜æ–¹æä¾›çš„Hookæ™šç‚¹ä¼šä»‹ç»ã€‚\n\n\n\n### Why\n\n- ä¸ºä»€ä¹ˆä¼šæœ‰Hooksï¼Ÿ\n- Hookèƒ½è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ\n\nåšä»»ä½•ä¸€ä»¶äº‹æƒ…æˆ‘è§‰å¾—éƒ½åº”è¯¥ç†æ¸…è¿™ä¸ªä¸¤ä¸ªé—®é¢˜ï¼Œè¿™æ ·çš„è¯å°±ä¼šäº‹åŠåŠŸå€ã€‚\n\næˆ‘ä»¬å…ˆçœ‹çœ‹Reactå®˜æ–¹æ˜¯æ€ä¹ˆè§£é‡Šâ€œWhyâ€çš„\n\n> 1. åœ¨ç»„ä»¶ä¹‹é—´å¤ç”¨çŠ¶æ€é€»è¾‘å¾ˆéš¾\n> 2. å¤æ‚ç»„ä»¶å˜å¾—éš¾ä»¥ç†è§£\n> 3. éš¾ä»¥ç†è§£çš„ class\n\næœ¬äººä¸ªäººè®¤ä¸ºç¬¬ä¸‰ç‚¹æ˜¯æ¥å‡‘æ•°çš„....\n\nä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Ÿ\n\nå› ä¸ºReactç”¨äº†è¿™ä¹ˆä¹…äº†åŸºæœ¬éƒ½æ˜¯åœ¨ä½¿ç”¨Classç»„ä»¶ï¼Œè¿™ä¸ªæ˜¯åœ¨ä¹‹å‰ï¼Œå“ªæ€•æ˜¯ç°åœ¨å­¦ä¹ Reactçš„å¿…ç»ä¹‹è·¯å§ï¼æ‰€ä»¥ï¼Œè¿™ç‚¹æˆ‘æ¥ä¸‹æ¥å°±ä¼šè·³è¿‡äº†ğŸ˜‚\n\n### åœ¨ç»„ä»¶ä¹‹é—´æœç”¨çŠ¶æ€é€»è¾‘å¾ˆéš¾\n\nå…¶å®é«˜é˜¶ç»„ä»¶æˆ–è€…è¯´æ˜¯propséƒ½æ˜¯å¾ˆå¥½çš„è§£å†³äº†å¤æ‚çš„èšåˆä¸šåŠ¡é€»è¾‘ï¼Œé‚£ä¸ºä»€ä¹ˆè¯´åœ¨**ç»„ä»¶ä¹‹é—´æœç”¨çŠ¶æ€é€»è¾‘å¾ˆéš¾**å‘¢ï¼Ÿ\n\nå…¶å®é“ç†éå¸¸ç®€å•ã€‚\n\nä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£ã€‚\n\nåœºæ™¯ï¼šæœ‰ è¯·æ±‚Aï¼Œè¯·æ±‚Bï¼Œè¯·æ±‚Cï¼Œè¯·æ±‚Dã€‚ä»–ä»¬çš„è¯·æ±‚éƒ½æœ‰ç›¸äº’ä¾èµ–å…³ç³»æ¯”å¦‚ï¼Œå‘è¯·æ±‚Bçš„æ—¶å€™å¿…é¡»æ‹¿åˆ°è¯·æ±‚Açš„ç»“æœä¸­çš„æŸä¸ªå€¼ï¼Œè€Œè¯·æ±‚Cä¹Ÿå¿…é¡»æ‹¿åˆ°è¯·æ±‚Bçš„ç»“æœä¸­çš„æŸä¸ªå€¼ã€‚ä»¥æ­¤ç±»æ¨è¯·æ±‚Dã€‚\n\nPromiseå‡ºæ¥ä¹‹å‰æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿ\n\n```javascript\n$.ajax({\n    type:\"post\",\n    success: function(){//æˆåŠŸå›è°ƒ\n        //å†æ¬¡å¼‚æ­¥è¯·æ±‚\n        $.ajax({\n            type:\"post\",\n            url:\"...\",\n            success:function(){//æˆåŠŸå›è°ƒ\n              //å†æ¬¡å¼‚æ­¥è¯·æ±‚\n              $.ajax({\n                  type:\"post\",\n                  url:\"...\",\n                  success:function(){\n                      .......//å¦‚æ­¤å¾ªç¯\n                  }\n              })\n          }\n        })\n    }\n})\n```\n\nè¿™è¿˜åªæ˜¯3å±‚ï¼Œå¦‚æœæ˜¯100å±‚å‘¢ï¼Ÿé‚£çœ‹èµ·æ¥å°±éå¸¸çš„éš¾å—äº†ï¼\n\nPromiseè¾ƒå¥½çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜\n\n```javascript\nnew Promise(f1)\n .then(f2)\n .then(f3)\n .then(f4)\n .then(f5)\n .then(f5)\nâ€¦â€¦â€¦â€¦\n```\n\nç„¶åæ˜¯async/awaitã€‚è¿™é‡Œå°±ä¸å±•å¼€äº†ï¼Œæœ‰å…´è¶£çš„å¯ä»¥è‡ªå·±å»äº†è§£ä¸€ä¸‹ã€‚\n\nç»“è®º\n\nä¹‹æ‰€ä»¥è¿™ä¹ˆå¤§è´¹å‘¨ç« çš„è®²æ˜¯ä¸ºäº†è§£é‡Šï¼ŒReactä¸­çš„é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰ã€‚ä»–çš„é€»è¾‘å…¶å®å’Œå›è°ƒåœ°ç‹±ç±»ä¼¼ï¼Œä¸€ä¸ªä¸¤ä¸ªå…¶å®éƒ½è¿˜ç®—ä¼˜é›…æˆ–è€…è¯´èˆ’æœï¼Œä¸€æ—¦å¤šäº†çš„è¯ã€‚ã€‚ã€‚\n\n```javascript\nexport default withHover(\n  withTheme(\n    withAuth(\n      withRepos(Profile)\n    )\n  )\n)\n\n// å°±ä¼šå˜æˆè¿™æ ·ï¼Œä¸å¤Ÿä¼˜é›…\n<WithHover>\n  <WithTheme hovering={false}>\n    <WithAuth hovering={false} theme='dark'>\n      <WithRepos hovering={false} theme='dark' authed={true}>\n        <Profile \n          id='JavaScript'\n          loading={true} \n          repos={[]}\n          authed={true}\n          theme='dark'\n          hovering={false}\n        />\n      </WithRepos>\n    </WithAuth>\n  <WithTheme>\n</WithHover>\n```\n\nè€Œä¸”æ¯ä¸ªé«˜é˜¶ç»„ä»¶çš„é€»è¾‘å¤ç”¨æˆ‘ä»¬å¯èƒ½è¿˜è¦ä¸€ä¸ªä¸ªå»ç ”è¯»ã€‚\n\n\n\n### å¤æ‚ç»„ä»¶å˜å¾—éš¾ä»¥ç†è§£\n\nå…¶å®ï¼Œè¿™ç‚¹éå¸¸å¥½ç†è§£ã€‚ä¸¾ä¸€ä¸ªéå¸¸ç®€å•å¸¸è§çš„ä¾‹å­å¤§å®¶å°±ä¼šæ˜ç™½äº†ã€‚\n\nåœºæ™¯ï¼šå‡å¦‚æˆ‘æœ‰ä¸€ä¸ªå­ç»„ä»¶Childï¼Œä»–çš„åŠŸèƒ½æ˜¯è¿™æ ·çš„ï¼šçˆ¶ç»„å»ºä¼šç»™ä¸€ä¸ªidï¼Œåœ¨ç»„ä»¶åˆ›å»ºçš„æ—¶å€™è·å–ä¸€ä¸‹æœ‰å…³ä¿¡æ¯ï¼Œåœ¨idæ”¹å˜çš„æ—¶å€™å†é‡æ–°è·å–ã€‚\n\n#### Classç»„ä»¶\n\n```javascript\ncomponentDidMount () {\n    this.fetch(this.props.id)\n }\ncomponentDidUpdate (prevProps) {\n  if (prevProps.id !== this.props.id) {\n    this.fetch(this.props.id)\n  }\n}\nfetch = id => {\n  this.setState({ loading: true })\n  fetchInfo(id)\n    .then(info => this.setState({\n    info,\n    loading: false\n  }))\n}\n```\n\n#### React Hookï¼š\n\n```javascript\nconst fetch = id => {\n  this.setState({ loading: true })\n  fetchInfo(id)\n    .then(info => this.setState({\n    info,\n    loading: false\n  }))\n}\nuseEffect(() => {\n  fetch(this.props.id)\n}, [this.props.id])\n```\n\n\n\n### ç»“è®º\n\nç®€å•çš„è¯´ä¸€ä¸‹ä»–çš„ä¼˜ç‚¹å§ã€‚\n\n1. å¤ç”¨ä»£ç æ›´åŠ ç®€å•ï¼ˆéœ€è¦ä»€ä¹ˆå°±â€œé’©â€è¿›æ¥ï¼‰\n2. æ¸…çˆ½çš„ä»£ç é£æ ¼ï¼Œä¸€ç›®äº†ç„¶ã€‚ï¼ˆuseStateæ”¯æŒæ•°ç»„å’Œå¯¹è±¡ï¼Œå¯ä»¥æ¸…æ™°çš„å®šä¹‰ç‰¹æ®Šçš„å­—æ®µç­‰ç­‰ï¼‰\n3. ä»£ç é‡æ›´å°‘ï¼ˆå¯ä»¥çœ‹ä¸€ä¸‹æˆ‘ä¹‹å‰çš„å­çˆ¶ç»„å»ºçš„ä¾‹å­ï¼‰\n4. æ›´æ„¿æ„å»å†™ä¸€äº›å°ç»„ä»¶å¤ç”¨ï¼ˆæˆ‘ä¸ªäººå–œæ¬¢Reactå°±æ˜¯å› ä¸ºä»–çš„ç»„ä»¶å†™èµ·æ¥éå¸¸çš„é¡ºæ‰‹ï¼psï¼šæ²¡æœ‰è´¬ä½å…¶ä»–æ¡†æ¶çš„æ„æ€ã€‚ã€‚ï¼‰\n5. å…¶å®æˆ‘ä¸ªäººè®¤ä¸ºReact Hookåœ¨å®£æ‰¬ä¸€ä¸ªè§‚å¿µâ€œæŒ‰éœ€åŠ è½½â€ã€‚\n\n## useState\n\n### ä½¿ç”¨\n\nç®€å•çš„ä½¿ç”¨åœ¨ä¸Šé¢çš„æ¢ç©¶-Howé‡Œé¢æœ‰ä»‹ç»ï¼Œæ›´å¤šçš„åœ¨Reactå®˜ç½‘ä¹Ÿæœ‰ä»‹ç»ã€‚\n\n#### è¯·å›ç­”ä»¥ä¸‹ä»£ç çš„è¿è¡Œç»“æœ\n\n![](https://overreacted.io/46c55d5f1f749462b7a173f1e748e41e/counter.gif)\n\n```javascript\nfunction Counter() {\n  const [count, setCount] = useState(0);\n\n  function handleAlertClick() {\n    setTimeout(() => {\n      alert('You clicked on: ' + count);\n    }, 3000);\n  }\n\n  return (\n    <div>\n      <p>You clicked {count} times</p>\n      <button onClick={() => setCount(count + 1)}>\n        Click me\n      </button>\n      <button onClick={handleAlertClick}>\n        Show alert\n      </button>\n    </div>\n  );\n}\n```\n\nä½ çŒœalertä¼šå¼¹å‡ºä»€ä¹ˆå‘¢ï¼Ÿä¼šæ˜¯5å—ï¼Ÿâ€” è¿™ä¸ªå€¼æ˜¯alertçš„æ—¶å€™counterçš„å®æ—¶çŠ¶æ€ã€‚æˆ–è€…ä¼šæ˜¯3å—ï¼Ÿâ€” è¿™ä¸ªå€¼æ˜¯æˆ‘ç‚¹å‡»æ—¶å€™çš„çŠ¶æ€ã€‚\n\n> åˆ†å‰²çº¿\n\næ¥è‡ªå·± [è¯•è¯•å§ï¼](https://codesandbox.io/s/w2wxl3yo0l)\n\n#### ç­”æ¡ˆæ˜¯\n\n3\n\nè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿfunctionç»„å»ºç©¶ç«Ÿæ˜¯å¦‚æœå·¥ä½œçš„å‘¢ï¼Ÿ\n\næˆ‘ä»¬å‘ç°`count`åœ¨æ¯ä¸€æ¬¡å‡½æ•°è°ƒç”¨ä¸­éƒ½æ˜¯ä¸€ä¸ªå¸¸é‡å€¼ã€‚å€¼å¾—å¼ºè°ƒçš„æ˜¯ â€” **æˆ‘ä»¬çš„ç»„ä»¶å‡½æ•°æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šè¢«è°ƒç”¨ï¼Œä½†æ˜¯æ¯ä¸€æ¬¡è°ƒç”¨ä¸­`count`å€¼éƒ½æ˜¯å¸¸é‡ï¼Œå¹¶ä¸”å®ƒè¢«èµ‹äºˆäº†å½“å‰æ¸²æŸ“ä¸­çš„çŠ¶æ€å€¼ã€‚**\n\nè¿™å¹¶ä¸æ˜¯Reactç‰¹æœ‰çš„ï¼Œæ™®é€šçš„å‡½æ•°ä¹Ÿæœ‰ç±»ä¼¼çš„è¡Œä¸ºï¼š\n\n```jsx\nfunction sayHi(person) {\n  const name = person.name;  setTimeout(() => {\n    alert('Hello, ' + name);\n  }, 3000);\n}\n\nlet someone = {name: 'Dan'};\nsayHi(someone);\n\nsomeone = {name: 'Yuzhi'};\nsayHi(someone);\n\nsomeone = {name: 'Dominic'};\nsayHi(someone);\n```\n\nåœ¨ [è¿™ä¸ªä¾‹å­](https://codesandbox.io/s/mm6ww11lk8)ä¸­, å¤–å±‚çš„`someone`ä¼šè¢«èµ‹å€¼å¾ˆå¤šæ¬¡ï¼ˆå°±åƒåœ¨Reactä¸­ï¼Œ*å½“å‰*çš„ç»„ä»¶çŠ¶æ€ä¼šæ”¹å˜ä¸€æ ·ï¼‰ã€‚**ç„¶åï¼Œåœ¨`sayHi`å‡½æ•°ä¸­ï¼Œå±€éƒ¨å¸¸é‡`name`ä¼šå’ŒæŸæ¬¡è°ƒç”¨ä¸­çš„`person`å…³è”ã€‚**å› ä¸ºè¿™ä¸ªå¸¸é‡æ˜¯å±€éƒ¨çš„ï¼Œæ‰€ä»¥æ¯ä¸€æ¬¡è°ƒç”¨éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚ç»“æœå°±æ˜¯ï¼Œå½“å®šæ—¶å™¨å›è°ƒè§¦å‘çš„æ—¶å€™ï¼Œæ¯ä¸€ä¸ªalertéƒ½ä¼šå¼¹å‡ºå®ƒæ‹¥æœ‰çš„`name`ã€‚\n\nè¿™å°±è§£é‡Šäº†æˆ‘ä»¬çš„äº‹ä»¶å¤„ç†å‡½æ•°å¦‚ä½•æ•è·äº†ç‚¹å‡»æ—¶å€™çš„`count`å€¼ã€‚å¦‚æœæˆ‘ä»¬åº”ç”¨ç›¸åŒçš„æ›¿æ¢åŸç†ï¼Œæ¯ä¸€æ¬¡æ¸²æŸ“â€œçœ‹åˆ°â€çš„æ˜¯å®ƒè‡ªå·±çš„`count`ï¼š\n\n```jsx\n// During first render\nfunction Counter() {\n  const count = 0; // Returned by useState()  // ...\n  function handleAlertClick() {\n    setTimeout(() => {\n      alert('You clicked on: ' + count);\n    }, 3000);\n  }\n  // ...\n}\n\n// After a click, our function is called again\nfunction Counter() {\n  const count = 1; // Returned by useState()  // ...\n  function handleAlertClick() {\n    setTimeout(() => {\n      alert('You clicked on: ' + count);\n    }, 3000);\n  }\n  // ...\n}\n\n// After another click, our function is called again\nfunction Counter() {\n  const count = 2; // Returned by useState()  // ...\n  function handleAlertClick() {\n    setTimeout(() => {\n      alert('You clicked on: ' + count);\n    }, 3000);\n  }\n  // ...\n}\n```\n\næ‰€ä»¥å®é™…ä¸Šï¼Œæ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰ä¸€ä¸ªâ€œæ–°ç‰ˆæœ¬â€çš„`handleAlertClick`ã€‚æ¯ä¸€ä¸ªç‰ˆæœ¬çš„`handleAlertClick`â€œè®°ä½â€ äº†å®ƒè‡ªå·±çš„ `count`ï¼š\n\n```jsx\n// During first render\nfunction Counter() {\n  // ...\n  function handleAlertClick() {\n    setTimeout(() => {\n      alert('You clicked on: ' + 0);    }, 3000);\n  }\n  // ...\n  <button onClick={handleAlertClick} /> // The one with 0 inside  // ...\n}\n\n// After a click, our function is called again\nfunction Counter() {\n  // ...\n  function handleAlertClick() {\n    setTimeout(() => {\n      alert('You clicked on: ' + 1);    }, 3000);\n  }\n  // ...\n  <button onClick={handleAlertClick} /> // The one with 1 inside  // ...\n}\n\n// After another click, our function is called again\nfunction Counter() {\n  // ...\n  function handleAlertClick() {\n    setTimeout(() => {\n      alert('You clicked on: ' + 2);    }, 3000);\n  }\n  // ...\n  <button onClick={handleAlertClick} /> // The one with 2 inside  // ...\n}\n```\n\nè¿™å°±æ˜¯ä¸ºä»€ä¹ˆ[åœ¨è¿™ä¸ªdemoä¸­](https://codesandbox.io/s/w2wxl3yo0l)ä¸­ï¼Œäº‹ä»¶å¤„ç†å‡½æ•°â€œå±äºâ€æŸä¸€æ¬¡ç‰¹å®šçš„æ¸²æŸ“ï¼Œå½“ä½ ç‚¹å‡»çš„æ—¶å€™ï¼Œå®ƒä¼šä½¿ç”¨é‚£æ¬¡æ¸²æŸ“ä¸­`counter`çš„çŠ¶æ€å€¼ã€‚\n\n**åœ¨ä»»æ„ä¸€æ¬¡æ¸²æŸ“ä¸­ï¼Œpropså’Œstateæ˜¯å§‹ç»ˆä¿æŒä¸å˜çš„ã€‚**å¦‚æœpropså’Œstateåœ¨ä¸åŒçš„æ¸²æŸ“ä¸­æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œé‚£ä¹ˆä½¿ç”¨åˆ°å®ƒä»¬çš„ä»»ä½•å€¼ä¹Ÿæ˜¯ç‹¬ç«‹çš„ï¼ˆåŒ…æ‹¬äº‹ä»¶å¤„ç†å‡½æ•°ï¼‰ã€‚å®ƒä»¬éƒ½â€œå±äºâ€ä¸€æ¬¡ç‰¹å®šçš„æ¸²æŸ“ã€‚å³ä¾¿æ˜¯äº‹ä»¶å¤„ç†ä¸­çš„å¼‚æ­¥å‡½æ•°è°ƒç”¨â€œçœ‹åˆ°â€çš„ä¹Ÿæ˜¯è¿™æ¬¡æ¸²æŸ“ä¸­çš„`count`å€¼ã€‚\n\n#### è¯·å›ç­”ä»¥ä¸‹ä»£ç çš„è¿è¡Œç»“æœ\n\n```javascript\nfunction Counter() {\n  const [count, setCount] = useState(0);\n\n  const addCount = () => {\n    setCount(count+1)\n    setCount(count+2)\n    setCount(count+3)\n    setCount(count+4)\n    setCount(count+5)\n  }\n\n  console.log(count)\n  \n  return (\n    <div>\n      <button onClick={addCount}>\n        Click me\n      </button>\n    </div>\n  );\n}\n```\n\n> åˆ†å‰²çº¿\n\n#### ç­”æ¡ˆæ˜¯\n\n5\n\nä¸ºä»€ä¹ˆå‘¢ï¼Ÿ\n\nuseStateçš„æ›´æ–°ç©¶ç«Ÿæ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿ\n\næˆ‘ä»¬è¿›å…¥`ReactHooks.js`æ¥çœ‹çœ‹ï¼Œå‘ç°`useState`çš„å®ç°ç«Ÿç„¶å¼‚å¸¸ç®€å•ï¼Œåªæœ‰çŸ­çŸ­ä¸¤è¡Œ\n\n```js\n// ReactHooks.js\nexport function useState<S>(initialState: (() => S) | S) {\n  const dispatcher = resolveDispatcher();\n  return dispatcher.useState(initialState);\n}\n```\n\nå…¶å®å¯ä»¥è¿™æ ·ç†è§£useStateï¼ŒuseStateå…¶å®å°±æ˜¯useReducerçš„ä¸€ä¸ªè¯­æ³•ç³–ï¼›ä½†æ˜¯è¿™ä¸ªä¸åœ¨è¿™ä¸ªé—®é¢˜çš„è®¨è®ºèŒƒå›´å†…ï¼›\n\nå¥½ï¼Œæ”¶å›æ¥ã€‚\n\nå…¶å®æˆ‘ä»¬åœ¨`const [xx, setXx] = useState(xx)`çš„æ—¶å€™å°±ç”Ÿæˆä¸€ä¸ªé˜Ÿåˆ—ï¼Œæˆ‘ä»¬æš‚æ—¶å«å®ƒä¸ºqueueï¼›æ‰€æœ‰è¿™ä¸€è½®è¿è¡Œè¯»å–åˆ°çš„stateéƒ½è¢«æ”¾åˆ°ä¸€ä¸ªé“¾è¡¨çš„é˜Ÿåˆ—é‡Œé¢å»ï¼Œç„¶åå†ç”¨do-whileå¾ªç¯ï¼Œæ¯æ¬¡éƒ½æ˜¯æ‹¿åˆ°æœ€æ–°çš„å€¼ï¼Œä½†æ˜¯ä¸æ˜¯Object.assginçš„å½¢å¼ï¼Œè€Œæ˜¯ç›´æ¥èµ‹å€¼ã€‚è¯ä¸å¤šè¯´ç›´æ¥æºç ã€‚\n\n```js\nfunction updateReducer(reducer, initialArg, init) {\n// è·å–åˆå§‹åŒ–æ—¶çš„ hook\n  const hook = updateWorkInProgressHook();\n  const queue = hook.queue;\n\n  // å¼€å§‹æ¸²æŸ“æ›´æ–°\n  if (numberOfReRenders > 0) {\n    const dispatch = queue.dispatch;\n    if (renderPhaseUpdates !== null) {\n      // è·å–Hookå¯¹è±¡ä¸Šçš„ queueï¼Œå†…éƒ¨å­˜æœ‰æœ¬æ¬¡æ›´æ–°çš„ä¸€ç³»åˆ—æ•°æ®\n      const firstRenderPhaseUpdate = renderPhaseUpdates.get(queue);\n      if (firstRenderPhaseUpdate !== undefined) {\n        renderPhaseUpdates.delete(queue);\n        let newState = hook.memoizedState;\n        let update = firstRenderPhaseUpdate;\n        // è·å–æ›´æ–°åçš„state\n        do {\n          const action = update.action;\n          // æ­¤æ—¶çš„reduceræ˜¯basicStateReducerï¼Œç›´æ¥è¿”å›actionçš„å€¼\n          // æ³¨æ„ï¼Œè¿™é‡Œæ˜¯ç­‰äºå·æ‰€ä»¥\n          /**\n          *\n          * setObj({ a: 1, b: 1, c: 1 })\n        \t* setObj({ a: 2, b: 2 })\n        \t* setObj({ a: 3 })\n        \t*\n        \t* åˆ°æœ€åä¹Ÿåªæœ‰åªæœ‰{ a: 3 }ï¼Œè€Œbå’Œcå…¨æ²¡äº†\n          *\n          **/\n          newState = reducer(newState, action);\n          update = update.next;\n        } while (update !== null);\n        // å¯¹ æ›´æ–°hook.memoized \n        hook.memoizedState = newState;\n        // è¿”å›æ–°çš„ stateï¼ŒåŠæ›´æ–° hook çš„ dispatch æ–¹æ³•\n        return [newState, dispatch];\n      }\n    }\n  }\n```\n\n\n\n## useEffect/useLayoutEffect\n\n### æç¤º\n\nåœ¨å­¦ä¹ useEffectè¿™ä¸ªHookçš„æ—¶å€™ï¼Œæ·¡åŒ–ä½ çŸ¥é“çš„â€œç”Ÿå‘½å‘¨æœŸâ€è¿™ä¸ªæ¦‚å¿µã€‚\n\n#### useEffectå’ŒuseLayoutEffectä¸¤å…„å¼Ÿçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ\n\næ‰§è¡Œçš„æ—¶æœºä¸åŒ\n\né‚£ä¹ˆå…·ä½“å“ªé‡Œä¸åŒå‘¢ï¼Ÿ\n\nå…¶å®åœ¨åˆå§‹åŒ–useEffectå’ŒuseLayoutEffectæ˜¯æ²¡æœ‰åŒºåˆ«çš„ï¼Œä»–ä»¬çœŸæ­£çš„åŒºåˆ«åœ¨äºåˆå§‹åŒ–ä¹‹åï¼›\n\nä¸¾ä¸ªéå¸¸å½¢è±¡çš„ä¾‹å­ğŸŒ°ï¼š\n\né™¤äº†åˆå§‹åŒ–ä¹‹åçš„ä¸€è½®æ›´æ–°ï¼š\n\n> æµè§ˆå™¨ï¼šæˆ‘è¦ç»˜åˆ¶äº†ï¼\n>\n> Reactï¼šç­‰ç­‰ï¼Œæˆ‘æœ‰ä¸€ä¸ªå“¥ä»¬ä¸´æ—¶æœ‰äº‹è¦å¤„ç†ï¼Œä»–æ˜¯ï¼šuseLayoutEffect\n>\n> useLayoutEffectæ‰§è¡Œ....\n>\n> Reactï¼šå¥½äº†ï¼Œä½ å¯ä»¥å¼€å§‹ç»˜åˆ¶äº†ï½@æµè§ˆå™¨\n>\n> æµè§ˆå™¨ï¼šå¥½çš„\n>\n> æµè§ˆå™¨æ›´æ–°UI...\n>\n> æµè§ˆå™¨ï¼šæˆ‘æ›´æ–°å¥½äº†ã€‚ä½ æœ‰ä»€ä¹ˆäº‹è¦åšçš„å—ï¼Ÿ@React\n>\n> Reactï¼šæœ‰çš„ï¼ŒuseEffectä½ ä¸Š\n>\n> useEffectæ‰§è¡Œ....\n\nå¯èƒ½æœ‰ç‚¹åºŸè¯äº†ã€‚å…¶å®åŒºåˆ«å°±æ˜¯\n\n> useLayoutEffect()\n>\n> æµè§ˆå™¨ç»˜åˆ¶\n>\n> useEffect()\n\nè¿™æ ·å…¶å®å¤§å®¶ä¹Ÿèƒ½å¾ˆç›´æ¥çš„çœ‹åˆ°å¼Šç«¯äº†ã€‚é‚£å°±æ˜¯useLayoutEffectå¦‚æœæœ‰å¤§é‡çš„è®¡ç®—çš„è¯ï¼Œé‚£æ ·å¯èƒ½ä¼šé˜»å¡UIæ›´æ–°ï¼Œæˆ–è€…è¯´UIæ¸²æŸ“ã€‚æ‰€ä»¥è¿˜æ˜¯è¦è°¨æ…ä½¿ç”¨ã€‚\n\nä¸€èˆ¬æ¥è¯´ä»–ä»¬æ²¡æœ‰ä»€ä¹ˆå¤ªå¤§çš„åŒºåˆ«çš„ï¼Œå¦‚æœçœŸçš„è¦ä½¿ç”¨useLayoutEffectçš„è¯è¦è°¨æ…ä¸€äº›ã€‚ä¸ç„¶å¯èƒ½ä¼šå¯¼è‡´UIæ¸²æŸ“é˜»å¡ä¹‹ç±»çš„é—®é¢˜ã€‚\n\nä½†æ˜¯ï¼Œä¹Ÿä¸æ˜¯æ²¡æœ‰ä½¿ç”¨åœºæ™¯ã€‚\n\næ¯”å¦‚ä¸‹é¢çš„è¿™ä¸ªä»£ç å°±å¾ˆéœ€è¦useLayoutEffect\n\n```js\nfunction App() {\n  const [count, setCount] = useState(0);\n  \n  useLayoutEffect(() => {\n    if (count === 0) {\n      const randomNum = 10 + Math.random()*200\n      setCount(10 + Math.random()*200);\n    }\n  }, [count]);\n\n  return (\n      <div onClick={() => setCount(0)}>{count}</div>\n  );\n}\n\n//   æˆ‘æ˜¯åˆ†å‰²çº¿\n\nfunction App() {\n  const [count, setCount] = useState(0);\n  \n  useEffect(() => {\n    if (count === 0) {\n      const randomNum = 10 + Math.random()*200\n      setCount(10 + Math.random()*200);\n    }\n  }, [count]);\n\n  return (\n      <div onClick={() => setCount(0)}>{count}</div>\n  );\n}\n```\n\nå…¶å®æ˜ç™½çš„åŒå­¦ä¸€ä¸‹å°±çœ‹å‡ºæ¥äº†ï¼Œå¦‚æœä½¿ç”¨useEffectçš„è¯ä¼šå‡ºç°é—ªçƒï¼Œä¼šå…ˆå›åˆ°0ç„¶åå†æ›´æ–°æ–°çš„éšæœºæ•°ã€‚è€Œåè§‚useLayoutEffectåˆ™ä¸ä¼šï¼Œä»–ä¼šå¾ˆè‡ªç„¶çš„è¿‡æ¸¡ã€‚\n\næ€»ç»“ï¼š\n\nuseLayoutEffectçš„ä½¿ç”¨åœºæ™¯ä¸ºï¼šæœ‰ä¸€ä¸ªä¸­é—´çŠ¶æ€å¸Œæœ›éšè—çš„æ—¶å€™å†ä½¿ç”¨ã€‚\n\nå¤§éƒ¨åˆ†æƒ…å†µä¸‹useEffectå¯ä»¥é€‚ç”¨äº99%çš„åœºæ™¯ã€‚\n\n####  useEffectçš„é”™è¯¯äº‹ä¾‹ã€‚çœ‹çœ‹æœ‰æ²¡æœ‰ä½ \n\n```js\nfunction SearchResults() {\n  const [query, setQuery] = useState('react');\n\n  // Imagine this function is also long\n  function getFetchUrl() {\n    return 'https://hn.algolia.com/api/v1/search?query=' + query;\n  }\n\n  // Imagine this function is also long\n  async function fetchData() {\n    const result = await axios(getFetchUrl());\n    setData(result.data);\n  }\n\n  useEffect(() => {\n    fetchData();\n  }, []);\n\n  // ...\n}\n```\n\n#### ä¸ºä»€ä¹ˆé”™äº†ï¼Ÿ\n\nä¸éš¾çœ‹å‡ºä¸Šé¢ä»£ç çš„æ„æ€æ˜¯ã€‚æƒ³è¦æ¨¡ä»¿componentDidMountçš„ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨é¡µé¢æˆ–è€…ç»„ä»¶åŠ è½½ä¹‹åå‘é€ä¸€ä¸ªè¯·æ±‚ã€‚å’‹ä¸€çœ‹å¥½åƒæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼ˆå®é™…åœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­ä¹Ÿæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œåœ¨å†™è¿™ç¯‡æ–‡ç« ä¹‹å‰æˆ‘ä¹Ÿæ˜¯è¿™ä¹ˆåšçš„ã€‚ï¼‰\n\nä½†æ˜¯å¤§å®¶å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœè¿™ä¸ªå‡½æ•°ç»„ä»¶ï¼Œæ˜¯ç°åœ¨çš„5å€å¤§ï¼Œè¿™ä¸ªdidMounté‡Œé¢è°ƒç”¨çš„è¯·æ±‚ï¼Œæœªæ¥ä¾èµ–çš„ä¸œè¥¿ä½ éƒ½å¯ä»¥100%çš„å¯Ÿè§‰åˆ°å—ï¼Ÿ\n\næˆ‘è§‰å¾—éš¾ï¼éš¾å…ä¼šæœ‰ç–å¿½ã€‚åˆ°æ—¶å€™å¯èƒ½å°±ä¼šå‡ºç°stateæˆ–è€…propsè¯»å–é”™è¯¯çš„æƒ…å†µã€‚å› ä¸ºæ¯ä¸€æ¬¡renderçš„stateå’Œpropséƒ½æ˜¯ç‹¬ç«‹çš„ã€‚\n\né‚£ä¹ˆï¼Œè¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿ\n\næœ‰ä¸€ä¸ªå¾ˆåœŸçš„åŠæ³•ï¼Œç›´æ¥æŠŠå‡½æ•°æ‰”åˆ°useEffecté‡Œé¢å»\n\n```jsx\nfunction SearchResults() {\n  // ...\n  useEffect(() => {\n    // We moved these functions inside!    \n    function getFetchUrl() {\n      return 'https://hn.algolia.com/api/v1/search?query=react';\n    }\n    async function fetchData() {\n      const result = await axios(getFetchUrl());\n      setData(result.data);\n    }\n    fetchData();\n  }, []); // âœ… Deps are OK\n  // ...\n}\n```\n\né‚£é«˜çº§ç‚¹çš„åŠæ³•å‘¢ï¼Ÿ\n\n```js\nfunction SearchResults() {\n  // âœ… Preserves identity when its own deps are the same\n  const getFetchUrl = useCallback((query) => {\n    return 'https://hn.algolia.com/api/v1/search?query=' + query;\n  }, []);  // âœ… Callback deps are OK\n\n  useEffect(() => {\n    const url = getFetchUrl('react');\n    // ... Fetch data and do something ...\n  }, [getFetchUrl]); // âœ… Effect deps are OK\n\n  // ...\n}\n```\n\nå°†å‡½æ•°ç”¨useCallbackåŒ…è£¹ï¼Œè¿™æ ·çš„è¯æˆ‘ä»¬åªéœ€è¦åšuseEffectçš„ä¾èµ–é‡Œé¢å†™ä¸Šæˆ‘ä»¬çš„å‡½æ•°ï¼Œç„¶ååœ¨useCallbacké‡Œé¢å†™ä¸Šæˆ‘ä»¬çš„ä¾èµ–ã€‚\n\n#### æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ¯ä¸€æ¬¡effectéƒ½æ˜¯å…¨æ–°çš„stateå’Œpropsï¼Œé‚£æˆ‘è¦å¦‚ä½•è·å¾—ä¸Šä¸€è½®æ›´æ–°çš„stateå‘¢ï¼Ÿ\n\n\n\n```js\nfunction Counter() {\n  const [count, setCount] = useState(0);\n\n  const prevCountRef = useRef();\n  useEffect(() => {\n    prevCountRef.current = count;\n  });\n  const prevCount = prevCountRef.current;\n\n  return <h1>Now: {count}, before: {prevCount}</h1>;\n}\n```\n\nå…¶å®å¾ˆå¥½ç†è§£ï¼Œå¦‚æœçœ‹äº†å‰é¢useEffectå’ŒuseLayoutEffectåŒºåˆ«çš„åŒå­¦ä¸€ä¸‹å°±å¯ä»¥çŸ¥é“è¿™ä¸ªçš„å®ç°åŸç†ã€‚\n\né¦–å…ˆï¼Œåœ¨ä¸€åˆ‡éƒ½æ›´æ–°ä¹‹åï¼Œç„¶åä¼šä¼šæ‰§è¡ŒuseEffectå†…éƒ¨çš„å›è°ƒå‡½æ•°ï¼Œå°†prevCountç»™èµ‹å€¼ï¼Œç”±äºæ²¡æœ‰è§¦å‘æ¸²æŸ“ï¼Œæ‰€ä»¥åªæ˜¯å•çº¯çš„èµ‹å€¼ã€‚è¿™æ ·å°±çœ‹èµ·æ¥prevCountçš„å€¼æ°¸è¿œéƒ½æ…¢ä¸€æ­¥ã€‚\n\n### æ€»ç»“\n\nå…¶å®åœ¨å­¦ä¹ useEffectçš„æ—¶å€™ã€‚åº”è¯¥å¿˜è®°ä½ å¯¹Reactçš„ä¸€äº›çŸ¥è¯†ã€‚æ¯”å¦‚ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨å‡½æ•°ç»„ä»¶é‡Œé¢æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸè¿™ä¸ªæ¦‚å¿µäº†ã€‚\n\næ¯ä¸€æ¬¡çš„renderä»–éƒ½æœ‰è‡ªå·±çš„stateå’Œpropsã€‚stateå’Œpropsæ›´åº”è¯¥è¢«çœ‹ä½œä¸€ä¸ªå¸¸é‡ï¼Œå“ªæ€•æ˜¯const bar = xxè¿™æ ·çš„å¸¸é‡ã€‚è¿™æ ·ç†è§£èµ·æ¥useEffectè¿™ä¸ªå‰¯ä½œç”¨å…¶å®ä¼šæ›´åŠ é¡ºç•…ï¼Œä¹Ÿä¸å®¹æ˜“è¿›å…¥ä»–çš„â€œé™·é˜±â€\n\n## useRef\n\n### å‰è¨€\n\nä¸ºä»€ä¹ˆæˆ‘æŠŠuseRefå•ç‹¬æ‹å‡ºæ¥è¯´ï¼Œä¸æŠŠä»–å’Œ`useImperativeHandle`æ”¾åœ¨ä¸€èµ·è®²ï¼Œå› ä¸º\n\n> ï¼ˆå®˜ç½‘åŸè¯ï¼‰å®ƒåˆ›å»ºçš„æ˜¯ä¸€ä¸ªæ™®é€š Javascript å¯¹è±¡ã€‚è€Œ `useRef()` å’Œè‡ªå»ºä¸€ä¸ª `{current: ...}` å¯¹è±¡çš„å”¯ä¸€åŒºåˆ«æ˜¯ï¼Œ`useRef` ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“æ—¶è¿”å›åŒä¸€ä¸ª ref å¯¹è±¡ã€‚\n\nè®°ä½`useRef`ä¸å•å•ç”¨äºè·å–`DOMèŠ‚ç‚¹å’Œç»„ä»¶å®ä¾‹`ï¼Œè¿˜æœ‰ä¸€ä¸ªå·§å¦™çš„ç”¨æ³•å°±æ˜¯`ä½œä¸ºå®¹å™¨ä¿ç•™å¯å˜å˜é‡`ï¼Œå¯ä»¥è¿™æ ·è¯´ï¼š`æ— æ³•è‡ªå¦‚åœ°ä½¿ç”¨useRefä¼šè®©ä½ å¤±å»hookå°†è¿‘ä¸€åŠçš„èƒ½åŠ›`\n\n#### useRef ä¸ createRef çš„åŒºåˆ«\n\n`useRef` ä»…èƒ½ç”¨åœ¨ FunctionComponentï¼Œ`createRef` ä»…èƒ½ç”¨åœ¨ ClassComponentã€‚\n\n`useRef` ä»…èƒ½ç”¨åœ¨ FunctionComponentï¼Œ`createRef` ä»…èƒ½ç”¨åœ¨ ClassComponentã€‚\n\nç¬¬ä¸€å¥è¯æ˜¯æ˜¾ç„¶çš„ï¼Œå› ä¸º Hooks ä¸èƒ½ç”¨åœ¨ ClassComponentã€‚\n\nç¬¬äºŒå¥è¯çš„åŸå› æ˜¯ï¼Œ`createRef` å¹¶æ²¡æœ‰ Hooks çš„æ•ˆæœï¼Œå…¶å€¼ä¼šéšç€ FunctionComponent é‡å¤æ‰§è¡Œè€Œä¸æ–­è¢«åˆå§‹åŒ–ï¼š\n\n```\nfunction App() {\n  // é”™è¯¯ç”¨æ³•ï¼Œæ°¸è¿œä¹Ÿæ‹¿ä¸åˆ° ref\n  const valueRef = React.createRef();\n  return <div ref={valueRef} />;\n}\nå¤åˆ¶ä»£ç \n```\n\nä¸Šè¿° `valueRef` ä¼šéšç€ App å‡½æ•°çš„ Render è€Œé‡å¤åˆå§‹åŒ–ï¼Œ**è¿™ä¹Ÿæ˜¯ Hooks çš„ç‹¬ç‰¹ä¹‹å¤„ï¼Œè™½ç„¶ç”¨åœ¨æ™®é€šå‡½æ•°ä¸­ï¼Œä½†åœ¨ React å¼•æ“ä¸­ä¼šå¾—åˆ°è¶…å‡ºæ™®é€šå‡½æ•°çš„è¡¨ç°ï¼Œæ¯”å¦‚åˆå§‹åŒ–ä»…æ‰§è¡Œä¸€æ¬¡ï¼Œæˆ–è€…å¼•ç”¨ä¸å˜**ã€‚\n\nä¸ºä»€ä¹ˆ `createRef` å¯ä»¥åœ¨ ClassComponent æ­£å¸¸è¿è¡Œå‘¢ï¼Ÿè¿™æ˜¯å› ä¸º ClassComponent åˆ†ç¦»äº†ç”Ÿå‘½å‘¨æœŸï¼Œä½¿ä¾‹å¦‚ `componentDidMount` ç­‰åˆå§‹åŒ–æ—¶æœºä»…æ‰§è¡Œä¸€æ¬¡ã€‚\n\n#### å¦‚ä½•è§£å†³æ¯æ¬¡renderå¸¦æ¥ç±»é—­åŒ…é—®é¢˜ï¼Ÿ\n\né¦–å…ˆï¼Œé¢˜ç›®æ€ä¹ˆç†è§£ï¼Ÿ[é¢˜ç›®](https://codesandbox.io/s/w2wxl3yo0l)\n\nå¦‚æœæˆ‘ä»¬å¸Œæœ›ä»–alertçš„æ—¶å€™å¯ä»¥è·å–åˆ°æœ€æ–°çš„å€¼çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨useRefæ¥è§£å†³\n\n```js\nconst Counter = () => {\n  const [count, setCount] = useState<number>(0)\n  const countRef = useRef<number>(count)\n\n  useEffect(() => {\n    countRef.current = count\n  })\n\n  const handleCount = () => {\n    setTimeout(() => {\n      alert('current count: ' + countRef.current)\n    }, 3000);\n  }\n\n  //...\n}\n\nexport default Counter\n```\n\n\n\n## memo\n\n#### memoæ²¡æœ‰å›è°ƒå‡½æ•°çš„è¯æ˜¯æ€ä¹ˆæµ…æ¯”è¾ƒçš„ï¼Ÿ\n\nå…ˆæ¥çœ‹çœ‹memoæ²¡æœ‰å›è°ƒå‡½æ•°çš„æ—¶å€™ä»–åšäº†ä»€ä¹ˆã€‚\n\nmemoå®ƒæ˜¯ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰ä»–ä¸React.PureComponentååˆ†ç›¸ä¼¼ã€‚é™¤äº†ä½¿ç”¨çš„åœ°æ–¹ä¸åŒï¼ˆClassç»„ä»¶å’ŒFunctionç»„ä»¶ï¼‰ä¹‹å¤–å‡ ä¹ä¸€è‡´ã€‚\n\nMemoå†…éƒ¨å’ŒPureComponentä¸€æ ·ä½¿ç”¨Object.isç”¨äºå‰å¯¹æ¯”ï¼Œå¦‚æœä¼ å…¥çš„propså†…å­˜åœ°å€ä¸å˜çš„è¯ï¼Œé‚£å°±ä¸ä¼šæ¸²æŸ“äº†ï¼ˆæˆ–è€…è¯´å¤ç”¨æœ€è¿‘çš„ä¸€æ¬¡æ¸²æŸ“ï¼‰ã€‚\n\nä¸‹é¢å¯ä»¥çœ‹æºç äº‹ä¾‹\n\n```js\nfunction updateMemoComponent(\n  current: Fiber | null,\n  workInProgress: Fiber,\n  Component: any,\n  nextProps: any,\n  updateExpirationTime,\n  renderExpirationTime: ExpirationTime,\n): null | Fiber {\n\n  /* ...çœç•¥...*/\n\n  // åˆ¤æ–­æ›´æ–°çš„è¿‡æœŸæ—¶é—´æ˜¯å¦å°äºæ¸²æŸ“çš„è¿‡æœŸæ—¶é—´\n  if (updateExpirationTime < renderExpirationTime) {\n    const prevProps = currentChild.memoizedProps;\n\n    // å¦‚æœè‡ªå®šä¹‰äº†compareå‡½æ•°ï¼Œåˆ™é‡‡ç”¨è‡ªå®šä¹‰çš„compareå‡½æ•°ï¼Œå¦åˆ™é‡‡ç”¨å®˜æ–¹çš„shallowEqual(æµ…æ¯”è¾ƒ)å‡½æ•°ã€‚ï¼ˆä¸‹é¢æœ‰è§£æï¼‰\n    let compare = Component.compare;\n    compare = compare !== null ? compare : shallowEqual;\n\n    /**\n     * 1. åˆ¤æ–­å½“å‰ props ä¸ nextProps æ˜¯å¦ç›¸ç­‰ï¼›\n     * 2. åˆ¤æ–­å³å°†æ¸²æŸ“ç»„ä»¶çš„å¼•ç”¨æ˜¯å¦ä¸workInProgress Fiberä¸­çš„å¼•ç”¨æ˜¯å¦ä¸€è‡´ï¼›\n     *\n     * åªæœ‰ä¸¤è€…éƒ½ä¸ºçœŸï¼Œæ‰ä¼šé€€å‡ºæ¸²æŸ“ã€‚\n     */\n    if (compare(prevProps, nextProps) && current.ref === workInProgress.ref) {\n      // å¦‚æœéƒ½ä¸ºçœŸï¼Œåˆ™é€€å‡ºæ¸²æŸ“\n      return bailoutOnAlreadyFinishedWork(\n        current,\n        workInProgress,\n        renderExpirationTime,\n      );\n    }\n  }\n\n  /* ...çœç•¥...*/\n\n```\n\nshallowEqualï¼ˆæµ…æ¯”è¾ƒï¼‰\n\n```js\n// ç”¨åŸå‹é“¾çš„æ–¹æ³•\nconst hasOwn = Object.prototype.hasOwnProperty\n\n// è¿™ä¸ªå‡½æ•°å®é™…ä¸Šæ˜¯Object.is()çš„polyfill\nfunction is(x, y) {\n  if (x === y) {\n    return x !== 0 || y !== 0 || 1 / x === 1 / y\n  } else {\n    return x !== x && y !== y\n  }\n}\n\nexport default function shallowEqual(objA, objB) {\n  // é¦–å…ˆå¯¹åŸºæœ¬æ•°æ®ç±»å‹çš„æ¯”è¾ƒ\n  if (is(objA, objB)) return true\n  // ç”±äºObejct.is()å¯ä»¥å¯¹åŸºæœ¬æ•°æ®ç±»å‹åšä¸€ä¸ªç²¾ç¡®çš„æ¯”è¾ƒï¼Œ æ‰€ä»¥å¦‚æœä¸ç­‰\n  // åªæœ‰ä¸€ç§æƒ…å†µæ˜¯è¯¯åˆ¤çš„ï¼Œé‚£å°±æ˜¯object,æ‰€ä»¥åœ¨åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡éƒ½ä¸æ˜¯object\n  // ä¹‹åï¼Œå°±å¯ä»¥è¿”å›falseäº†\n  if (typeof objA !== 'object' || objA === null ||\n      typeof objB !== 'object' || objB === null) {\n    return false\n  }\n\n  // è¿‡æ»¤æ‰åŸºæœ¬æ•°æ®ç±»å‹ä¹‹åï¼Œå°±æ˜¯å¯¹å¯¹è±¡çš„æ¯”è¾ƒäº†\n  // é¦–å…ˆæ‹¿å‡ºkeyå€¼ï¼Œå¯¹keyçš„é•¿åº¦è¿›è¡Œå¯¹æ¯”\n\n  const keysA = Object.keys(objA)\n  const keysB = Object.keys(objB)\n\n  // é•¿åº¦ä¸ç­‰ç›´æ¥è¿”å›false\n  if (keysA.length !== keysB.length) return false\n  // keyç›¸ç­‰çš„æƒ…å†µä¸‹ï¼Œåœ¨å»å¾ªç¯æ¯”è¾ƒ\n  for (let i = 0; i < keysA.length; i++) {\n  // keyå€¼ç›¸ç­‰çš„æ—¶å€™\n  // å€Ÿç”¨åŸå‹é“¾ä¸ŠçœŸæ­£çš„ hasOwnProperty æ–¹æ³•ï¼Œåˆ¤æ–­ObjBé‡Œé¢æ˜¯å¦æœ‰Açš„keyçš„keyå€¼\n  // å±æ€§çš„é¡ºåºä¸å½±å“ç»“æœä¹Ÿå°±æ˜¯{name:'daisy', age:'24'} è·Ÿ{age:'24'ï¼Œname:'daisy' }æ˜¯ä¸€æ ·çš„\n  // æœ€åï¼Œå¯¹å¯¹è±¡çš„valueè¿›è¡Œä¸€ä¸ªåŸºæœ¬æ•°æ®ç±»å‹çš„æ¯”è¾ƒï¼Œè¿”å›ç»“æœ\n    if (!hasOwn.call(objB, keysA[i]) ||\n        !is(objA[keysA[i]], objB[keysA[i]])) {\n      return false\n    }\n  }\n\n  return truea\n}\n```\n\nç”±æºç å¯ä»¥çŸ¥é“ï¼ŒåŠ å…¥æ²¡æœ‰ä¼ ä¸€ä¸ªæ¯”è¾ƒçš„å›è°ƒå‡½æ•°ä¼šä½¿ç”¨å®˜æ–¹çš„æµ…æ¯”è¾ƒã€‚å…·ä½“çš„å¯ä»¥çœ‹æ³¨é‡Š\n\n#### memoçš„å›è°ƒå‡½æ•°\n\næˆ‘ä»¬éƒ½çŸ¥é“reactçš„ç”Ÿå‘½å‘¨æœŸä¸­æœ‰ä¸€ä¸ªshouldComponentUpdateã€‚åœ¨è¿™ä¸ªå‡½æ•°ä¸­è¿”å›trueçš„è¯å°±ä»£è¡¨æœ¬æ¬¡renderéœ€è¦æ‰§è¡Œï¼Œè€Œè¿”å›falseå°±å¯ä»¥è·³è¿‡æœ¬æ¬¡çš„renderã€‚\n\nè€Œmemoæ­£å¥½ç›¸åï¼Œè¿”å›trueè¡¨ç¤ºæœ¬æ¬¡è·³è¿‡ï¼Œè¿”å›falseå°±è¡¨ç¤ºæœ¬æ¬¡éœ€è¦æ‰§è¡Œrenderã€‚\n\nå…·ä½“æ€ä¹ˆç”¨å‘¢ï¼Ÿ\n\nå¤§å®¶å¯ä»¥è‡ªå·±è¿è¡Œä¸€ä¸‹ï¼Œçœ‹çœ‹æ•ˆæœã€‚ä¸€å®šè¦è‡ªå·±è¯•ä¸€ä¸‹ï¼Œä¸ç„¶å¾ˆå®¹æ˜“å’ŒshouldComponentUpdateå¼„æ··äº†ã€‚å­¦ä¹ è¿˜æ˜¯è¦è‡ªå·±åŠ¨æ‰‹æ‰è¡Œã€‚\n\n```js\nfunction ChangeLog({w = ''}){\n  // çœç•¥\n  console.log('====render====')\n}\nexport default memo(ChangeLog, (prevProps, nextProps) => {\n  if (prevProps.w !== nextProps.w) {\n    return false\n  }\n  return true\n});\n```\n\n## useMemo/useCallback\n\n ### å‰è¨€\n\nä¹‹æ‰€ä»¥æŠŠè¿™useMomo/useCallackä¸¤å…„å¼Ÿå’Œåœ¨ä¸€èµ·ã€‚æ˜¯å› ä¸ºä»–ä»¬å…¶å®ååˆ†ç›¸ä¼¼ã€‚\n\n> ä¸€ä¸ªæ˜¯ç¼“å­˜å˜é‡ï¼ˆuseMemoï¼‰ï¼Œä¸€ä¸ªæ˜¯ç¼“å­˜å‡½æ•°ï¼ˆuseCallbackï¼‰ã€‚\n\nå…¶å®è¿™ä¹ˆä¸€è¯´å°±æ¸…æ™°å¾ˆå¤šäº†ã€‚\n\nå…·ä½“çš„ä½¿ç”¨å’ŒuseEffectä¸€æ ·ï¼Œéƒ½æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè°ƒç”¨æ—¶çš„å›è°ƒå‡½æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è°ƒç”¨åˆ¤æ–­æ‰€ç›‘å¬çš„å€¼ï¼ˆå¯ä»¥æ˜¯å˜é‡ï¼Œä¹Ÿå¯ä»¥æ˜¯å‡½æ•°ï¼‰\n\n```js\nconst memoizedValue = useMemo(() => computeExpensiveValue(a, b), [a, b]);\nconst memoizedValue = useCallback(() => computeExpensiveValue(a, b), [a, b]);\n```\n\nuseMemo() è¿”å›çš„æ˜¯ä¸€ä¸ª memoized å€¼ï¼Œåªæœ‰å½“ä¾èµ–é¡¹ï¼ˆæ¯”å¦‚ä¸Šé¢çš„ a,b å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œæ‰ä¼šé‡æ–°è®¡ç®—è¿™ä¸ª memoized å€¼ï¼‰\n\nmemoized å€¼ä¸å˜çš„æƒ…å†µä¸‹ï¼Œä¸ä¼šé‡æ–°è§¦å‘æ¸²æŸ“é€»è¾‘ã€‚\n\nè¯´èµ·æ¸²æŸ“é€»è¾‘ï¼Œéœ€è¦è®°ä½çš„æ˜¯ useMemo() æ˜¯åœ¨ render æœŸé—´æ‰§è¡Œçš„ï¼Œæ‰€ä»¥ä¸èƒ½è¿›è¡Œä¸€äº›é¢å¤–çš„å‰¯æ“ä½œï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚ç­‰ã€‚\n\nå¦‚æœæ²¡æœ‰æä¾›ä¾èµ–æ•°ç»„ï¼ˆä¸Šé¢çš„ [a,b]ï¼‰åˆ™æ¯æ¬¡éƒ½ä¼šé‡æ–°è®¡ç®— memoized å€¼ï¼Œä¹Ÿå°±ä¼š re-redner\n\nuseCallbackä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œå°±ä¸å¤šèµ˜è¿°äº†ã€‚\n\n## useReducer/useContext\n\n### å‰è¨€\n\nå¸®ä»–ä»¬ä¸¤å…„å¼Ÿå’Œåœ¨ä¸€èµ·è¯´ä¸»è¦è¯´å› ä¸ºä»–ä»¬ä¸¤å…„å¼Ÿåœ¨ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯å¯ä»¥ä¸Reduxä¸€æˆ˜çš„ã€‚\n\nä½†æ˜¯ï¼ï¼\n\nä½†æ˜¯å•Šï¼Œä½†æ˜¯å¦‚æœä½ éœ€è¦ä¸­é—´ä»·ï¼Œæˆ–è€…è¯´éœ€è¦â€œæ—¶é—´æ—…è¡Œâ€ï¼Œåˆæˆ–è€…ä¸´æ—¶éœ€è¦è·¨é¡µé¢çº§çš„æ•°æ®å…±äº«ï¼Œé‚£ä½ è¿˜æ˜¯éœ€è¦reduxæ¥è§£å†³çš„ã€‚ä¸è¿‡åŸºæœ¬ä¸Šçš„åœºæ™¯æˆ‘ä»¬ä½¿ç”¨useReducerå’ŒuseContextå°±å¯ä»¥å®Œç¾çš„æ›¿ä»£reduxäº†ã€‚\n\n### æ€ä¹ˆåšï¼Ÿ\n\nå…¶å®ä¹‹å‰ç”±äºè¦èµ·ä¸€ä¸ªæ–°é¡¹ç›®ï¼Œä½†æ˜¯çªç„¶å‘ç°æœ‰ä¸€ä¸ªçˆ·çˆ·ç»„ä»¶çš„å€¼ä¸ºéœ€è¦é€šçŸ¥ç»™å­™å­ç»„ä»¶ï¼Œç„¶åå­™å­ç»„ä»¶å¯èƒ½ä¼šç”¨æ‰å›è°ƒå‡½æ•°è°ƒç”¨çˆ·çˆ·ç»„ä»¶çš„æ–¹æ³•ã€‚é‚£ä¸ªæ—¶å€™å…¶å®å·²ç»ç”¨Hookå†™äº†ä¸€åŠäº†ï¼Œæ‡’å¾—åŠ Reduxäº†ï¼Œåˆä¸æƒ³ä¸€å±‚å±‚ä¼ propsä¸‹å»ã€‚æ€ä¹ˆåŠï¼Ÿ\n\né€šè¿‡äº†è§£ï¼Œæˆ‘çŸ¥é“äº†useReducer/useContextåˆšåˆšå¥½å¯ä»¥è§£å†³æˆ‘çš„éœ€æ±‚ã€‚\n\n```js\nconst TodosDispatch = React.createContext(null);\n\nconst initialState = { bar: null };\n\nfunction reducer(state, action) {\n  switch (action.type) {\n    case 'setCenter':\n      return { ...state, bar: action.bar };\n    default:\n      return state\n  }\n}\n\n// è™½ç„¶è¿™ä¸ªæ˜¯è‡ªç»„ä»¶ï¼Œä½†æ˜¯å“ªæ€•æ˜¯æ›¾æ›¾æ›¾å­™å­ç»„ä»¶éƒ½å¯ä»¥ç›´æ¥ç”¨useContextæ‹¿åˆ°dispatch\nfunction DeepChild(props) {\n  // å¦‚æœæˆ‘ä»¬æƒ³è¦æ‰§è¡Œä¸€ä¸ª actionï¼Œæˆ‘ä»¬å¯ä»¥ä» context ä¸­è·å– dispatchã€‚\n  const dispatch = useContext(TodosDispatch);\n\n  function handleClick() {\n    dispatch({ type: 'add', text: 'hello' });\n  }\n\n  return (\n    <button onClick={handleClick}>Add todo</button>\n  );\n}\n\nfunction TodosApp() {\n  // æç¤ºï¼š`dispatch` ä¸ä¼šåœ¨é‡æ–°æ¸²æŸ“ä¹‹é—´å˜åŒ–\n  const [state, dispatch] = useReducer(reducer, initialState);\n\n  return (\n    <TodosDispatch.Provider value={dispatch}>\n      <DeepTree todos={todos} />\n    </TodosDispatch.Provider>\n  );\n}\n```\n\n## useImperativeHandle/forwardRef\n\nè¿™é‡Œå°±ä¸å¤šè¯´äº†ï¼ŒåŸºæœ¬ä¸Šæ²¡æœ‰ä»€ä¹ˆå‘ç‚¹å’Œç–‘éš¾ç‚¹ã€‚\n\nè¯´ä¸€ä¸‹åŸºæœ¬ç”¨æ³•å’Œant-design formä¸­çš„ä½¿ç”¨\n\n### æ­£å¸¸ä½¿ç”¨\n\n```js\nuseImperativeHandle(ref, createHandle, [deps])\n```\n\n`useImperativeHandle` å¯ä»¥è®©ä½ åœ¨ä½¿ç”¨ `ref` æ—¶è‡ªå®šä¹‰æš´éœ²ç»™çˆ¶ç»„ä»¶çš„å®ä¾‹å€¼ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåº”å½“é¿å…ä½¿ç”¨ ref è¿™æ ·çš„å‘½ä»¤å¼ä»£ç ã€‚`useImperativeHandle` åº”å½“ä¸ `forwardRef`ä¸€èµ·ä½¿ç”¨ï¼š\n\n```js\nfunction FancyInput(props, ref) {\n  const inputRef = useRef();\n  useImperativeHandle(ref, () => ({\n    focus: () => {\n      inputRef.current.focus();\n    }\n  }));\n  return <input ref={inputRef} ... />;\n}\nFancyInput = forwardRef(FancyInput);\n```\n\nåœ¨æœ¬ä¾‹ä¸­ï¼Œæ¸²æŸ“<FancyInput ref={inputRef} />çš„çˆ¶ç»„ä»¶å¯ä»¥è°ƒç”¨ `inputRef.current.focus()`ã€‚\n\n### ant-design form\n\n```js\n// refä»ç¬¬äºŒä¸ªå‚æ•°å–ï¼Œè¿™é‡Œéƒ½æ˜¯ä¸€è‡´çš„\nconst Example = (props,ref) => {\n  const bar = () => {}\n  useImperativeHandle(ref, () => ({\n    text: bar,\n  }));\n  return (\n    <>\n        <Form>\n    \t\t\t{//....}\n        </Form>\n    </>\n  );\n};\n\nexport default memo(Form.create()(forwardRef(Example)));\n\n```\n\n```js\n\nconst Parent = () => {\n  return (\n    <>\n      <Example\n      \t// æ³¨æ„è¿™ä¸ªä¸å†æ˜¯ä¼ refäº†ï¼Œè€Œæ˜¯ä¼ wrappedComponentRefã€‚å› ä¸ºantdçš„formä»–è¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè¿™ä¸ªæ˜¯ä»–è‡ªå®šä¹‰çš„ä¸€ä¸ªæ¥æ”¶refçš„å€¼\n        wrappedComponentRef={editTemplateRef}\n      />\n    </>\n  );\n};\n```\n\n\n\n## useDebugValue/è‡ªå®šä¹‰Hook\n\n### å‰è¨€\n\nuseDebugValueæ˜¯ä¸“é—¨ç”¨äºæœåŠ¡è‡ªå®šä¹‰çš„Hookçš„ã€‚\n\nå…·ä½“çœ‹çœ‹ä½¿ç”¨å°±å¥½\n\n\n\nuseDebugValueï¼Œç›®çš„æ˜¯èƒ½åœ¨reactçš„æµè§ˆå™¨è°ƒè¯•å·¥å…·ä¸Šæ˜¾ç¤ºä½ çš„è‡ªå®šä¹‰hooksï¼Œæˆ–è€…ç»™hooksæ ‡è®°ä¸€äº›ä¸œè¥¿\nå½“ä½¿ç”¨ä¸€ä¸ªå‚æ•°çš„æ—¶å€™ï¼Œå°±æ˜¯æŠŠç¬¬ä¸€ä¸ªå‚æ•°æ ‡è®°åœ¨reactçš„è°ƒè¯•å·¥å…·ä¸Š,ä¸‹é¢å†™ä¸€ä¸ªç®€å•çš„ä¾‹å­\n\n```js\nimport React, { useDebugValue, useState } from 'react';\n\nconst useTest = () => {\n    const [str, setStr] = useState<string>('');\n    useDebugValue('debug');\n    return {\n        str, setStr\n    }\n}\nexport default (): JSX.Element => {\n    const { str, setStr } = useTest();\n    return (\n        <>\n            <h2>{str}</h2>\n            <button onClick={() => {\n                setStr('é‡æ–°æ¸²æŸ“');\n            }}>è¿™æ˜¯ï¼Ÿï¼Ÿï¼Ÿ</button>\n        </>\n    );\n}\n```\n\n\n\n![](/image/ä½ çœŸçš„æ‡‚ReactHookå—/20190818212347571.png)\n\n\n\nä¼šåœ¨è‡ªå®šä¹‰çš„hooksæ ‡è®°åˆ°reactçš„è°ƒè¯•å·¥å…·ä¸Šé¢,ä¸»è¦ç”¨äºè°ƒè¯•å·¥å…·è°ƒè¯•ä½¿ç”¨\n\nå½“ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°çš„æƒ…å†µä¸‹ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œä¼šæŠŠç¬¬ä¸€ä¸ªå‚æ•°å½“æˆè‡ªå·±çš„å½¢å‚ä¼ å…¥ï¼Œè¿›è¡Œä¸€ç³»åˆ—çš„æ“ä½œï¼Œreturnå›å»ï¼Œç„¶åæ‰ä¼šåœ¨reactè°ƒè¯•å·¥å…·çš„hooksä¸­æ‰“å°å‡ºæ¥ï¼Œä¸ç„¶ä¸ä¼šæ˜¾ç¤º\n\n```js\nimport React, { useDebugValue, useState } from 'react';\n\nconst useTest = () => {\n    const [str, setStr] = useState<string>('');\n    useDebugValue(str, (value:string) => {\n        console.log(value);\n        return 'è¿™æ˜¯æ”¹é€ åçš„' + value;\n    });\n    return {\n        str, setStr\n    }\n}\nexport default (): JSX.Element => {\n    const { str, setStr } = useTest();\n    return (\n        <>\n\n            <h2>{str}</h2>\n\n            <button onClick={() => {\n                setStr('é‡æ–°æ¸²æŸ“');\n           }}>è¿™æ˜¯ï¼Ÿï¼Ÿï¼Ÿ</button>\n       </>\n    );\n}\n```\n\nç»“æœ:\n\n![](/image/ä½ çœŸçš„æ‡‚ReactHookå—/2019081821194714.png)\n\n\nåŒæ—¶åœ¨æ§åˆ¶å°ä¸Šæ‰“å°äº†ä¸€ä¸ªç©ºå­—ç¬¦\n\n\nç”±äºstrçš„åˆå§‹å€¼æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥æ‰“å°å°±æ˜¯ç©ºçš„äº†ï¼Œè¿™åªæ˜¯è°ƒè¯•ä½¿ç”¨ï¼Œhookså·®ä¸å¤šå°±è¿™äº›äº†ï¼Œæ²¡æœ‰å…¶ä»–çš„äº†\n\n\n\n## è§‚çœ‹ä¹‹å\n\nå¦‚æœæœ‰å“ªé‡Œå†™çš„ä¸å¯¹æˆ–è€…æœ‰ç–‘é—®çš„æ¬¢è¿å¤§å®¶åœ¨è¯„è®ºåŒºäº’åŠ¨ã€‚ğŸ™\n\n\n\n\n","source":"_posts/ä½ çœŸçš„æ‡‚React-Hookå—.md","raw":"---\ntitle: ä½ çœŸçš„æ‡‚React Hookå—ï¼Ÿ\ndate: 2020-05-20 00:19:44\ntags: [React, ReactHook]\ncategory: [React]\ncover: /image/cover/React.jpeg\n---\n## å‰è¨€\n\n1. è¯»è¿™ç¯‡æ–‡ç« çš„å‰ææ˜¯ä½ å·²ç»å¯¹React Hookæœ‰æ‰€äº†è§£çš„æƒ…å†µä¸‹ï¼Œå¦‚æœä½ è¿˜æ²¡æœ‰äº†è§£ï¼Œè¯·å…ˆç§»æ­¥å®˜ç½‘å­¦ä¹ ä¸€ä¸‹ã€‚\n   1. æœ€å¥½ä¸è¦å»ç½‘ä¸Šçœ‹åˆ«äººçš„æ€»ç»“ä¹‹ç±»çš„ï¼Œæ— éå°±æ˜¯è¶…çš„å®˜ç½‘çš„ï¼Œè€Œä¸”è¿™æ ·ä¼šè®©ä½ çš„è®¤çŸ¥ä»ä¸€å¼€å§‹å°±èµ°åã€‚\n2. è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯æ¢ç©¶Hookçš„åŠ¨æœºï¼Œä½¿ç”¨ä¸­çš„ä¸€äº›ç–‘é—®ï¼›\n   1. ä½¿ç”¨çš„è¯Reactå®˜ç½‘å·²ç»è®²å¾—å¾ˆè¯¦ç»†äº†ï¼Œè¿™é‡Œå°±ä¸å¤šèµ˜è¿°äº†ã€‚\n3. æœ‰éœ€è¦çœ‹æ¥ä¸‹æ¥çš„ç–‘éš¾ç‚¹çš„ä¼™ä¼´æ¬¢è¿ç›´æ¥è·³è¿‡æ¢ç©¶ç›´æ¥çœ‹å…·ä½“çš„ç–‘é—®ï¼›\n\n## æ¢ç©¶\n\nä¸»è¦ä»3ä¸ªæ–¹é¢ç ”ç©¶React Hook\n\næ ¹æ®é»„é‡‘æ€ç»´åœˆï¼ˆWhatã€Howã€Whyï¼‰\n\n### What\n\nä»€ä¹ˆæ˜¯Hookï¼Ÿ\n\næ‰“å¼€Googleç¿»è¯‘ï¼Œå¾—åˆ°çš„è§£é‡Šï¼š*é’©ã€é’©å­*\n\n> å†çœ‹çœ‹Reactå®˜ç½‘çš„è§£é‡Šï¼šThey let you use state and other React features without writing a class.ï¼ˆå®ƒå¯ä»¥è®©ä½ åœ¨ä¸ç¼–å†™ class çš„æƒ…å†µä¸‹ä½¿ç”¨ state ä»¥åŠå…¶ä»–çš„ React ç‰¹æ€§ã€‚ï¼‰\n\næ‰€ä»¥ï¼Œç»“åˆä¸€ä¸‹ã€‚æˆ‘ä¸ªäººçš„ç†è§£æ˜¯è¿™æ ·çš„ï¼šå¯¹äºå‡½æ•°å¼çš„ç»„ä»¶ï¼Œå¯ä»¥ç”¨é’©å­ï¼ˆHookï¼‰å°†æƒ³è¦çš„å¤–éƒ¨åŠŸèƒ½ç»™â€œé’©â€è¿›æ¥ã€‚\n\nåœ¨React Hookå‡ºæ¥ä¹‹å‰ï¼Œå‡½æ•°å¼ç»„ä»¶éƒ½æ˜¯æ— çŠ¶æ€çš„ç»„ä»¶ï¼Œæœ€å¤šå°±æ˜¯æ ¹æ®`props`æ¥åŠ ä¸€äº›åˆ¤æ–­çš„é€»è¾‘ï¼›è€Œåœ¨React Hookå‡ºæ¥ä¹‹åå°±å¯ä»¥åœ¨å‡½æ•°å¼ç»„ä»¶é‡Œé¢åŠ å…¥çŠ¶æ€ï¼ˆuseStateï¼‰ï¼Œç±»ç”Ÿå‘½å‘¨æœŸï¼ˆuseEffectï¼‰ï¼Œç”šè‡³æ˜¯ä¸€äº›è‡ªå·±çš„å¤ç”¨é€»è¾‘ï¼ˆè‡ªå®šä¹‰Hookï¼‰ç­‰ç­‰è¿™äº›å¤–éƒ¨çš„åŠŸèƒ½ã€‚\n\n\n\n### How\n\næ€ä¹ˆä½¿ç”¨Hookï¼Ÿ\n\nå¤§å®¶ä¸€èµ·çœ‹ä¸€ä¸‹å®˜ç½‘çš„ä¸€ä¸ªä¾‹å­ã€‚\n\né¢˜ç›®ï¼šæ˜¾ç¤ºä¸€ä¸ªè®¡æ•°å™¨ã€‚å½“ä½ ç‚¹å‡»æŒ‰é’®ï¼Œè®¡æ•°å™¨çš„å€¼å°±ä¼šå¢åŠ ã€‚\n\n#### Classç»„ä»¶\n\n\n\n```javascript\nclass Example extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      count: 0\n    };\n  }\n\n  render() {\n    return (\n      <div>\n        <p>You clicked {this.state.count} times</p>\n        <button onClick={() => this.setState({ count: this.state.count + 1 })}>\n          Click me\n        </button>\n      </div>\n    );\n  }\n}\n```\n\n\n\n#### React Hook\n\n\n\n```javascript\nimport React, { useState } from 'react';\n\nfunction Example() {\n  // å£°æ˜ä¸€ä¸ªå« \"count\" çš„ state å˜é‡  const [count, setCount] = useState(0);\n  return (\n    <div>\n      <p>You clicked {count} times</p>\n      <button onClick={() => setCount(count + 1)}>\n        Click me\n      </button>\n    </div>\n  );\n}\n```\n\n\n\nè¿™æ ·å°±ç®—æ˜¯å®Œæˆäº†ä¸€ä¸ªæœ€ç®€å•çš„React Hook å®è·µï¼Œå…³äºä¸€äº›å®˜æ–¹æä¾›çš„Hookæ™šç‚¹ä¼šä»‹ç»ã€‚\n\n\n\n### Why\n\n- ä¸ºä»€ä¹ˆä¼šæœ‰Hooksï¼Ÿ\n- Hookèƒ½è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ\n\nåšä»»ä½•ä¸€ä»¶äº‹æƒ…æˆ‘è§‰å¾—éƒ½åº”è¯¥ç†æ¸…è¿™ä¸ªä¸¤ä¸ªé—®é¢˜ï¼Œè¿™æ ·çš„è¯å°±ä¼šäº‹åŠåŠŸå€ã€‚\n\næˆ‘ä»¬å…ˆçœ‹çœ‹Reactå®˜æ–¹æ˜¯æ€ä¹ˆè§£é‡Šâ€œWhyâ€çš„\n\n> 1. åœ¨ç»„ä»¶ä¹‹é—´å¤ç”¨çŠ¶æ€é€»è¾‘å¾ˆéš¾\n> 2. å¤æ‚ç»„ä»¶å˜å¾—éš¾ä»¥ç†è§£\n> 3. éš¾ä»¥ç†è§£çš„ class\n\næœ¬äººä¸ªäººè®¤ä¸ºç¬¬ä¸‰ç‚¹æ˜¯æ¥å‡‘æ•°çš„....\n\nä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Ÿ\n\nå› ä¸ºReactç”¨äº†è¿™ä¹ˆä¹…äº†åŸºæœ¬éƒ½æ˜¯åœ¨ä½¿ç”¨Classç»„ä»¶ï¼Œè¿™ä¸ªæ˜¯åœ¨ä¹‹å‰ï¼Œå“ªæ€•æ˜¯ç°åœ¨å­¦ä¹ Reactçš„å¿…ç»ä¹‹è·¯å§ï¼æ‰€ä»¥ï¼Œè¿™ç‚¹æˆ‘æ¥ä¸‹æ¥å°±ä¼šè·³è¿‡äº†ğŸ˜‚\n\n### åœ¨ç»„ä»¶ä¹‹é—´æœç”¨çŠ¶æ€é€»è¾‘å¾ˆéš¾\n\nå…¶å®é«˜é˜¶ç»„ä»¶æˆ–è€…è¯´æ˜¯propséƒ½æ˜¯å¾ˆå¥½çš„è§£å†³äº†å¤æ‚çš„èšåˆä¸šåŠ¡é€»è¾‘ï¼Œé‚£ä¸ºä»€ä¹ˆè¯´åœ¨**ç»„ä»¶ä¹‹é—´æœç”¨çŠ¶æ€é€»è¾‘å¾ˆéš¾**å‘¢ï¼Ÿ\n\nå…¶å®é“ç†éå¸¸ç®€å•ã€‚\n\nä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£ã€‚\n\nåœºæ™¯ï¼šæœ‰ è¯·æ±‚Aï¼Œè¯·æ±‚Bï¼Œè¯·æ±‚Cï¼Œè¯·æ±‚Dã€‚ä»–ä»¬çš„è¯·æ±‚éƒ½æœ‰ç›¸äº’ä¾èµ–å…³ç³»æ¯”å¦‚ï¼Œå‘è¯·æ±‚Bçš„æ—¶å€™å¿…é¡»æ‹¿åˆ°è¯·æ±‚Açš„ç»“æœä¸­çš„æŸä¸ªå€¼ï¼Œè€Œè¯·æ±‚Cä¹Ÿå¿…é¡»æ‹¿åˆ°è¯·æ±‚Bçš„ç»“æœä¸­çš„æŸä¸ªå€¼ã€‚ä»¥æ­¤ç±»æ¨è¯·æ±‚Dã€‚\n\nPromiseå‡ºæ¥ä¹‹å‰æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿ\n\n```javascript\n$.ajax({\n    type:\"post\",\n    success: function(){//æˆåŠŸå›è°ƒ\n        //å†æ¬¡å¼‚æ­¥è¯·æ±‚\n        $.ajax({\n            type:\"post\",\n            url:\"...\",\n            success:function(){//æˆåŠŸå›è°ƒ\n              //å†æ¬¡å¼‚æ­¥è¯·æ±‚\n              $.ajax({\n                  type:\"post\",\n                  url:\"...\",\n                  success:function(){\n                      .......//å¦‚æ­¤å¾ªç¯\n                  }\n              })\n          }\n        })\n    }\n})\n```\n\nè¿™è¿˜åªæ˜¯3å±‚ï¼Œå¦‚æœæ˜¯100å±‚å‘¢ï¼Ÿé‚£çœ‹èµ·æ¥å°±éå¸¸çš„éš¾å—äº†ï¼\n\nPromiseè¾ƒå¥½çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜\n\n```javascript\nnew Promise(f1)\n .then(f2)\n .then(f3)\n .then(f4)\n .then(f5)\n .then(f5)\nâ€¦â€¦â€¦â€¦\n```\n\nç„¶åæ˜¯async/awaitã€‚è¿™é‡Œå°±ä¸å±•å¼€äº†ï¼Œæœ‰å…´è¶£çš„å¯ä»¥è‡ªå·±å»äº†è§£ä¸€ä¸‹ã€‚\n\nç»“è®º\n\nä¹‹æ‰€ä»¥è¿™ä¹ˆå¤§è´¹å‘¨ç« çš„è®²æ˜¯ä¸ºäº†è§£é‡Šï¼ŒReactä¸­çš„é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰ã€‚ä»–çš„é€»è¾‘å…¶å®å’Œå›è°ƒåœ°ç‹±ç±»ä¼¼ï¼Œä¸€ä¸ªä¸¤ä¸ªå…¶å®éƒ½è¿˜ç®—ä¼˜é›…æˆ–è€…è¯´èˆ’æœï¼Œä¸€æ—¦å¤šäº†çš„è¯ã€‚ã€‚ã€‚\n\n```javascript\nexport default withHover(\n  withTheme(\n    withAuth(\n      withRepos(Profile)\n    )\n  )\n)\n\n// å°±ä¼šå˜æˆè¿™æ ·ï¼Œä¸å¤Ÿä¼˜é›…\n<WithHover>\n  <WithTheme hovering={false}>\n    <WithAuth hovering={false} theme='dark'>\n      <WithRepos hovering={false} theme='dark' authed={true}>\n        <Profile \n          id='JavaScript'\n          loading={true} \n          repos={[]}\n          authed={true}\n          theme='dark'\n          hovering={false}\n        />\n      </WithRepos>\n    </WithAuth>\n  <WithTheme>\n</WithHover>\n```\n\nè€Œä¸”æ¯ä¸ªé«˜é˜¶ç»„ä»¶çš„é€»è¾‘å¤ç”¨æˆ‘ä»¬å¯èƒ½è¿˜è¦ä¸€ä¸ªä¸ªå»ç ”è¯»ã€‚\n\n\n\n### å¤æ‚ç»„ä»¶å˜å¾—éš¾ä»¥ç†è§£\n\nå…¶å®ï¼Œè¿™ç‚¹éå¸¸å¥½ç†è§£ã€‚ä¸¾ä¸€ä¸ªéå¸¸ç®€å•å¸¸è§çš„ä¾‹å­å¤§å®¶å°±ä¼šæ˜ç™½äº†ã€‚\n\nåœºæ™¯ï¼šå‡å¦‚æˆ‘æœ‰ä¸€ä¸ªå­ç»„ä»¶Childï¼Œä»–çš„åŠŸèƒ½æ˜¯è¿™æ ·çš„ï¼šçˆ¶ç»„å»ºä¼šç»™ä¸€ä¸ªidï¼Œåœ¨ç»„ä»¶åˆ›å»ºçš„æ—¶å€™è·å–ä¸€ä¸‹æœ‰å…³ä¿¡æ¯ï¼Œåœ¨idæ”¹å˜çš„æ—¶å€™å†é‡æ–°è·å–ã€‚\n\n#### Classç»„ä»¶\n\n```javascript\ncomponentDidMount () {\n    this.fetch(this.props.id)\n }\ncomponentDidUpdate (prevProps) {\n  if (prevProps.id !== this.props.id) {\n    this.fetch(this.props.id)\n  }\n}\nfetch = id => {\n  this.setState({ loading: true })\n  fetchInfo(id)\n    .then(info => this.setState({\n    info,\n    loading: false\n  }))\n}\n```\n\n#### React Hookï¼š\n\n```javascript\nconst fetch = id => {\n  this.setState({ loading: true })\n  fetchInfo(id)\n    .then(info => this.setState({\n    info,\n    loading: false\n  }))\n}\nuseEffect(() => {\n  fetch(this.props.id)\n}, [this.props.id])\n```\n\n\n\n### ç»“è®º\n\nç®€å•çš„è¯´ä¸€ä¸‹ä»–çš„ä¼˜ç‚¹å§ã€‚\n\n1. å¤ç”¨ä»£ç æ›´åŠ ç®€å•ï¼ˆéœ€è¦ä»€ä¹ˆå°±â€œé’©â€è¿›æ¥ï¼‰\n2. æ¸…çˆ½çš„ä»£ç é£æ ¼ï¼Œä¸€ç›®äº†ç„¶ã€‚ï¼ˆuseStateæ”¯æŒæ•°ç»„å’Œå¯¹è±¡ï¼Œå¯ä»¥æ¸…æ™°çš„å®šä¹‰ç‰¹æ®Šçš„å­—æ®µç­‰ç­‰ï¼‰\n3. ä»£ç é‡æ›´å°‘ï¼ˆå¯ä»¥çœ‹ä¸€ä¸‹æˆ‘ä¹‹å‰çš„å­çˆ¶ç»„å»ºçš„ä¾‹å­ï¼‰\n4. æ›´æ„¿æ„å»å†™ä¸€äº›å°ç»„ä»¶å¤ç”¨ï¼ˆæˆ‘ä¸ªäººå–œæ¬¢Reactå°±æ˜¯å› ä¸ºä»–çš„ç»„ä»¶å†™èµ·æ¥éå¸¸çš„é¡ºæ‰‹ï¼psï¼šæ²¡æœ‰è´¬ä½å…¶ä»–æ¡†æ¶çš„æ„æ€ã€‚ã€‚ï¼‰\n5. å…¶å®æˆ‘ä¸ªäººè®¤ä¸ºReact Hookåœ¨å®£æ‰¬ä¸€ä¸ªè§‚å¿µâ€œæŒ‰éœ€åŠ è½½â€ã€‚\n\n## useState\n\n### ä½¿ç”¨\n\nç®€å•çš„ä½¿ç”¨åœ¨ä¸Šé¢çš„æ¢ç©¶-Howé‡Œé¢æœ‰ä»‹ç»ï¼Œæ›´å¤šçš„åœ¨Reactå®˜ç½‘ä¹Ÿæœ‰ä»‹ç»ã€‚\n\n#### è¯·å›ç­”ä»¥ä¸‹ä»£ç çš„è¿è¡Œç»“æœ\n\n![](https://overreacted.io/46c55d5f1f749462b7a173f1e748e41e/counter.gif)\n\n```javascript\nfunction Counter() {\n  const [count, setCount] = useState(0);\n\n  function handleAlertClick() {\n    setTimeout(() => {\n      alert('You clicked on: ' + count);\n    }, 3000);\n  }\n\n  return (\n    <div>\n      <p>You clicked {count} times</p>\n      <button onClick={() => setCount(count + 1)}>\n        Click me\n      </button>\n      <button onClick={handleAlertClick}>\n        Show alert\n      </button>\n    </div>\n  );\n}\n```\n\nä½ çŒœalertä¼šå¼¹å‡ºä»€ä¹ˆå‘¢ï¼Ÿä¼šæ˜¯5å—ï¼Ÿâ€” è¿™ä¸ªå€¼æ˜¯alertçš„æ—¶å€™counterçš„å®æ—¶çŠ¶æ€ã€‚æˆ–è€…ä¼šæ˜¯3å—ï¼Ÿâ€” è¿™ä¸ªå€¼æ˜¯æˆ‘ç‚¹å‡»æ—¶å€™çš„çŠ¶æ€ã€‚\n\n> åˆ†å‰²çº¿\n\næ¥è‡ªå·± [è¯•è¯•å§ï¼](https://codesandbox.io/s/w2wxl3yo0l)\n\n#### ç­”æ¡ˆæ˜¯\n\n3\n\nè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿfunctionç»„å»ºç©¶ç«Ÿæ˜¯å¦‚æœå·¥ä½œçš„å‘¢ï¼Ÿ\n\næˆ‘ä»¬å‘ç°`count`åœ¨æ¯ä¸€æ¬¡å‡½æ•°è°ƒç”¨ä¸­éƒ½æ˜¯ä¸€ä¸ªå¸¸é‡å€¼ã€‚å€¼å¾—å¼ºè°ƒçš„æ˜¯ â€” **æˆ‘ä»¬çš„ç»„ä»¶å‡½æ•°æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šè¢«è°ƒç”¨ï¼Œä½†æ˜¯æ¯ä¸€æ¬¡è°ƒç”¨ä¸­`count`å€¼éƒ½æ˜¯å¸¸é‡ï¼Œå¹¶ä¸”å®ƒè¢«èµ‹äºˆäº†å½“å‰æ¸²æŸ“ä¸­çš„çŠ¶æ€å€¼ã€‚**\n\nè¿™å¹¶ä¸æ˜¯Reactç‰¹æœ‰çš„ï¼Œæ™®é€šçš„å‡½æ•°ä¹Ÿæœ‰ç±»ä¼¼çš„è¡Œä¸ºï¼š\n\n```jsx\nfunction sayHi(person) {\n  const name = person.name;  setTimeout(() => {\n    alert('Hello, ' + name);\n  }, 3000);\n}\n\nlet someone = {name: 'Dan'};\nsayHi(someone);\n\nsomeone = {name: 'Yuzhi'};\nsayHi(someone);\n\nsomeone = {name: 'Dominic'};\nsayHi(someone);\n```\n\nåœ¨ [è¿™ä¸ªä¾‹å­](https://codesandbox.io/s/mm6ww11lk8)ä¸­, å¤–å±‚çš„`someone`ä¼šè¢«èµ‹å€¼å¾ˆå¤šæ¬¡ï¼ˆå°±åƒåœ¨Reactä¸­ï¼Œ*å½“å‰*çš„ç»„ä»¶çŠ¶æ€ä¼šæ”¹å˜ä¸€æ ·ï¼‰ã€‚**ç„¶åï¼Œåœ¨`sayHi`å‡½æ•°ä¸­ï¼Œå±€éƒ¨å¸¸é‡`name`ä¼šå’ŒæŸæ¬¡è°ƒç”¨ä¸­çš„`person`å…³è”ã€‚**å› ä¸ºè¿™ä¸ªå¸¸é‡æ˜¯å±€éƒ¨çš„ï¼Œæ‰€ä»¥æ¯ä¸€æ¬¡è°ƒç”¨éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚ç»“æœå°±æ˜¯ï¼Œå½“å®šæ—¶å™¨å›è°ƒè§¦å‘çš„æ—¶å€™ï¼Œæ¯ä¸€ä¸ªalertéƒ½ä¼šå¼¹å‡ºå®ƒæ‹¥æœ‰çš„`name`ã€‚\n\nè¿™å°±è§£é‡Šäº†æˆ‘ä»¬çš„äº‹ä»¶å¤„ç†å‡½æ•°å¦‚ä½•æ•è·äº†ç‚¹å‡»æ—¶å€™çš„`count`å€¼ã€‚å¦‚æœæˆ‘ä»¬åº”ç”¨ç›¸åŒçš„æ›¿æ¢åŸç†ï¼Œæ¯ä¸€æ¬¡æ¸²æŸ“â€œçœ‹åˆ°â€çš„æ˜¯å®ƒè‡ªå·±çš„`count`ï¼š\n\n```jsx\n// During first render\nfunction Counter() {\n  const count = 0; // Returned by useState()  // ...\n  function handleAlertClick() {\n    setTimeout(() => {\n      alert('You clicked on: ' + count);\n    }, 3000);\n  }\n  // ...\n}\n\n// After a click, our function is called again\nfunction Counter() {\n  const count = 1; // Returned by useState()  // ...\n  function handleAlertClick() {\n    setTimeout(() => {\n      alert('You clicked on: ' + count);\n    }, 3000);\n  }\n  // ...\n}\n\n// After another click, our function is called again\nfunction Counter() {\n  const count = 2; // Returned by useState()  // ...\n  function handleAlertClick() {\n    setTimeout(() => {\n      alert('You clicked on: ' + count);\n    }, 3000);\n  }\n  // ...\n}\n```\n\næ‰€ä»¥å®é™…ä¸Šï¼Œæ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰ä¸€ä¸ªâ€œæ–°ç‰ˆæœ¬â€çš„`handleAlertClick`ã€‚æ¯ä¸€ä¸ªç‰ˆæœ¬çš„`handleAlertClick`â€œè®°ä½â€ äº†å®ƒè‡ªå·±çš„ `count`ï¼š\n\n```jsx\n// During first render\nfunction Counter() {\n  // ...\n  function handleAlertClick() {\n    setTimeout(() => {\n      alert('You clicked on: ' + 0);    }, 3000);\n  }\n  // ...\n  <button onClick={handleAlertClick} /> // The one with 0 inside  // ...\n}\n\n// After a click, our function is called again\nfunction Counter() {\n  // ...\n  function handleAlertClick() {\n    setTimeout(() => {\n      alert('You clicked on: ' + 1);    }, 3000);\n  }\n  // ...\n  <button onClick={handleAlertClick} /> // The one with 1 inside  // ...\n}\n\n// After another click, our function is called again\nfunction Counter() {\n  // ...\n  function handleAlertClick() {\n    setTimeout(() => {\n      alert('You clicked on: ' + 2);    }, 3000);\n  }\n  // ...\n  <button onClick={handleAlertClick} /> // The one with 2 inside  // ...\n}\n```\n\nè¿™å°±æ˜¯ä¸ºä»€ä¹ˆ[åœ¨è¿™ä¸ªdemoä¸­](https://codesandbox.io/s/w2wxl3yo0l)ä¸­ï¼Œäº‹ä»¶å¤„ç†å‡½æ•°â€œå±äºâ€æŸä¸€æ¬¡ç‰¹å®šçš„æ¸²æŸ“ï¼Œå½“ä½ ç‚¹å‡»çš„æ—¶å€™ï¼Œå®ƒä¼šä½¿ç”¨é‚£æ¬¡æ¸²æŸ“ä¸­`counter`çš„çŠ¶æ€å€¼ã€‚\n\n**åœ¨ä»»æ„ä¸€æ¬¡æ¸²æŸ“ä¸­ï¼Œpropså’Œstateæ˜¯å§‹ç»ˆä¿æŒä¸å˜çš„ã€‚**å¦‚æœpropså’Œstateåœ¨ä¸åŒçš„æ¸²æŸ“ä¸­æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œé‚£ä¹ˆä½¿ç”¨åˆ°å®ƒä»¬çš„ä»»ä½•å€¼ä¹Ÿæ˜¯ç‹¬ç«‹çš„ï¼ˆåŒ…æ‹¬äº‹ä»¶å¤„ç†å‡½æ•°ï¼‰ã€‚å®ƒä»¬éƒ½â€œå±äºâ€ä¸€æ¬¡ç‰¹å®šçš„æ¸²æŸ“ã€‚å³ä¾¿æ˜¯äº‹ä»¶å¤„ç†ä¸­çš„å¼‚æ­¥å‡½æ•°è°ƒç”¨â€œçœ‹åˆ°â€çš„ä¹Ÿæ˜¯è¿™æ¬¡æ¸²æŸ“ä¸­çš„`count`å€¼ã€‚\n\n#### è¯·å›ç­”ä»¥ä¸‹ä»£ç çš„è¿è¡Œç»“æœ\n\n```javascript\nfunction Counter() {\n  const [count, setCount] = useState(0);\n\n  const addCount = () => {\n    setCount(count+1)\n    setCount(count+2)\n    setCount(count+3)\n    setCount(count+4)\n    setCount(count+5)\n  }\n\n  console.log(count)\n  \n  return (\n    <div>\n      <button onClick={addCount}>\n        Click me\n      </button>\n    </div>\n  );\n}\n```\n\n> åˆ†å‰²çº¿\n\n#### ç­”æ¡ˆæ˜¯\n\n5\n\nä¸ºä»€ä¹ˆå‘¢ï¼Ÿ\n\nuseStateçš„æ›´æ–°ç©¶ç«Ÿæ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿ\n\næˆ‘ä»¬è¿›å…¥`ReactHooks.js`æ¥çœ‹çœ‹ï¼Œå‘ç°`useState`çš„å®ç°ç«Ÿç„¶å¼‚å¸¸ç®€å•ï¼Œåªæœ‰çŸ­çŸ­ä¸¤è¡Œ\n\n```js\n// ReactHooks.js\nexport function useState<S>(initialState: (() => S) | S) {\n  const dispatcher = resolveDispatcher();\n  return dispatcher.useState(initialState);\n}\n```\n\nå…¶å®å¯ä»¥è¿™æ ·ç†è§£useStateï¼ŒuseStateå…¶å®å°±æ˜¯useReducerçš„ä¸€ä¸ªè¯­æ³•ç³–ï¼›ä½†æ˜¯è¿™ä¸ªä¸åœ¨è¿™ä¸ªé—®é¢˜çš„è®¨è®ºèŒƒå›´å†…ï¼›\n\nå¥½ï¼Œæ”¶å›æ¥ã€‚\n\nå…¶å®æˆ‘ä»¬åœ¨`const [xx, setXx] = useState(xx)`çš„æ—¶å€™å°±ç”Ÿæˆä¸€ä¸ªé˜Ÿåˆ—ï¼Œæˆ‘ä»¬æš‚æ—¶å«å®ƒä¸ºqueueï¼›æ‰€æœ‰è¿™ä¸€è½®è¿è¡Œè¯»å–åˆ°çš„stateéƒ½è¢«æ”¾åˆ°ä¸€ä¸ªé“¾è¡¨çš„é˜Ÿåˆ—é‡Œé¢å»ï¼Œç„¶åå†ç”¨do-whileå¾ªç¯ï¼Œæ¯æ¬¡éƒ½æ˜¯æ‹¿åˆ°æœ€æ–°çš„å€¼ï¼Œä½†æ˜¯ä¸æ˜¯Object.assginçš„å½¢å¼ï¼Œè€Œæ˜¯ç›´æ¥èµ‹å€¼ã€‚è¯ä¸å¤šè¯´ç›´æ¥æºç ã€‚\n\n```js\nfunction updateReducer(reducer, initialArg, init) {\n// è·å–åˆå§‹åŒ–æ—¶çš„ hook\n  const hook = updateWorkInProgressHook();\n  const queue = hook.queue;\n\n  // å¼€å§‹æ¸²æŸ“æ›´æ–°\n  if (numberOfReRenders > 0) {\n    const dispatch = queue.dispatch;\n    if (renderPhaseUpdates !== null) {\n      // è·å–Hookå¯¹è±¡ä¸Šçš„ queueï¼Œå†…éƒ¨å­˜æœ‰æœ¬æ¬¡æ›´æ–°çš„ä¸€ç³»åˆ—æ•°æ®\n      const firstRenderPhaseUpdate = renderPhaseUpdates.get(queue);\n      if (firstRenderPhaseUpdate !== undefined) {\n        renderPhaseUpdates.delete(queue);\n        let newState = hook.memoizedState;\n        let update = firstRenderPhaseUpdate;\n        // è·å–æ›´æ–°åçš„state\n        do {\n          const action = update.action;\n          // æ­¤æ—¶çš„reduceræ˜¯basicStateReducerï¼Œç›´æ¥è¿”å›actionçš„å€¼\n          // æ³¨æ„ï¼Œè¿™é‡Œæ˜¯ç­‰äºå·æ‰€ä»¥\n          /**\n          *\n          * setObj({ a: 1, b: 1, c: 1 })\n        \t* setObj({ a: 2, b: 2 })\n        \t* setObj({ a: 3 })\n        \t*\n        \t* åˆ°æœ€åä¹Ÿåªæœ‰åªæœ‰{ a: 3 }ï¼Œè€Œbå’Œcå…¨æ²¡äº†\n          *\n          **/\n          newState = reducer(newState, action);\n          update = update.next;\n        } while (update !== null);\n        // å¯¹ æ›´æ–°hook.memoized \n        hook.memoizedState = newState;\n        // è¿”å›æ–°çš„ stateï¼ŒåŠæ›´æ–° hook çš„ dispatch æ–¹æ³•\n        return [newState, dispatch];\n      }\n    }\n  }\n```\n\n\n\n## useEffect/useLayoutEffect\n\n### æç¤º\n\nåœ¨å­¦ä¹ useEffectè¿™ä¸ªHookçš„æ—¶å€™ï¼Œæ·¡åŒ–ä½ çŸ¥é“çš„â€œç”Ÿå‘½å‘¨æœŸâ€è¿™ä¸ªæ¦‚å¿µã€‚\n\n#### useEffectå’ŒuseLayoutEffectä¸¤å…„å¼Ÿçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ\n\næ‰§è¡Œçš„æ—¶æœºä¸åŒ\n\né‚£ä¹ˆå…·ä½“å“ªé‡Œä¸åŒå‘¢ï¼Ÿ\n\nå…¶å®åœ¨åˆå§‹åŒ–useEffectå’ŒuseLayoutEffectæ˜¯æ²¡æœ‰åŒºåˆ«çš„ï¼Œä»–ä»¬çœŸæ­£çš„åŒºåˆ«åœ¨äºåˆå§‹åŒ–ä¹‹åï¼›\n\nä¸¾ä¸ªéå¸¸å½¢è±¡çš„ä¾‹å­ğŸŒ°ï¼š\n\né™¤äº†åˆå§‹åŒ–ä¹‹åçš„ä¸€è½®æ›´æ–°ï¼š\n\n> æµè§ˆå™¨ï¼šæˆ‘è¦ç»˜åˆ¶äº†ï¼\n>\n> Reactï¼šç­‰ç­‰ï¼Œæˆ‘æœ‰ä¸€ä¸ªå“¥ä»¬ä¸´æ—¶æœ‰äº‹è¦å¤„ç†ï¼Œä»–æ˜¯ï¼šuseLayoutEffect\n>\n> useLayoutEffectæ‰§è¡Œ....\n>\n> Reactï¼šå¥½äº†ï¼Œä½ å¯ä»¥å¼€å§‹ç»˜åˆ¶äº†ï½@æµè§ˆå™¨\n>\n> æµè§ˆå™¨ï¼šå¥½çš„\n>\n> æµè§ˆå™¨æ›´æ–°UI...\n>\n> æµè§ˆå™¨ï¼šæˆ‘æ›´æ–°å¥½äº†ã€‚ä½ æœ‰ä»€ä¹ˆäº‹è¦åšçš„å—ï¼Ÿ@React\n>\n> Reactï¼šæœ‰çš„ï¼ŒuseEffectä½ ä¸Š\n>\n> useEffectæ‰§è¡Œ....\n\nå¯èƒ½æœ‰ç‚¹åºŸè¯äº†ã€‚å…¶å®åŒºåˆ«å°±æ˜¯\n\n> useLayoutEffect()\n>\n> æµè§ˆå™¨ç»˜åˆ¶\n>\n> useEffect()\n\nè¿™æ ·å…¶å®å¤§å®¶ä¹Ÿèƒ½å¾ˆç›´æ¥çš„çœ‹åˆ°å¼Šç«¯äº†ã€‚é‚£å°±æ˜¯useLayoutEffectå¦‚æœæœ‰å¤§é‡çš„è®¡ç®—çš„è¯ï¼Œé‚£æ ·å¯èƒ½ä¼šé˜»å¡UIæ›´æ–°ï¼Œæˆ–è€…è¯´UIæ¸²æŸ“ã€‚æ‰€ä»¥è¿˜æ˜¯è¦è°¨æ…ä½¿ç”¨ã€‚\n\nä¸€èˆ¬æ¥è¯´ä»–ä»¬æ²¡æœ‰ä»€ä¹ˆå¤ªå¤§çš„åŒºåˆ«çš„ï¼Œå¦‚æœçœŸçš„è¦ä½¿ç”¨useLayoutEffectçš„è¯è¦è°¨æ…ä¸€äº›ã€‚ä¸ç„¶å¯èƒ½ä¼šå¯¼è‡´UIæ¸²æŸ“é˜»å¡ä¹‹ç±»çš„é—®é¢˜ã€‚\n\nä½†æ˜¯ï¼Œä¹Ÿä¸æ˜¯æ²¡æœ‰ä½¿ç”¨åœºæ™¯ã€‚\n\næ¯”å¦‚ä¸‹é¢çš„è¿™ä¸ªä»£ç å°±å¾ˆéœ€è¦useLayoutEffect\n\n```js\nfunction App() {\n  const [count, setCount] = useState(0);\n  \n  useLayoutEffect(() => {\n    if (count === 0) {\n      const randomNum = 10 + Math.random()*200\n      setCount(10 + Math.random()*200);\n    }\n  }, [count]);\n\n  return (\n      <div onClick={() => setCount(0)}>{count}</div>\n  );\n}\n\n//   æˆ‘æ˜¯åˆ†å‰²çº¿\n\nfunction App() {\n  const [count, setCount] = useState(0);\n  \n  useEffect(() => {\n    if (count === 0) {\n      const randomNum = 10 + Math.random()*200\n      setCount(10 + Math.random()*200);\n    }\n  }, [count]);\n\n  return (\n      <div onClick={() => setCount(0)}>{count}</div>\n  );\n}\n```\n\nå…¶å®æ˜ç™½çš„åŒå­¦ä¸€ä¸‹å°±çœ‹å‡ºæ¥äº†ï¼Œå¦‚æœä½¿ç”¨useEffectçš„è¯ä¼šå‡ºç°é—ªçƒï¼Œä¼šå…ˆå›åˆ°0ç„¶åå†æ›´æ–°æ–°çš„éšæœºæ•°ã€‚è€Œåè§‚useLayoutEffectåˆ™ä¸ä¼šï¼Œä»–ä¼šå¾ˆè‡ªç„¶çš„è¿‡æ¸¡ã€‚\n\næ€»ç»“ï¼š\n\nuseLayoutEffectçš„ä½¿ç”¨åœºæ™¯ä¸ºï¼šæœ‰ä¸€ä¸ªä¸­é—´çŠ¶æ€å¸Œæœ›éšè—çš„æ—¶å€™å†ä½¿ç”¨ã€‚\n\nå¤§éƒ¨åˆ†æƒ…å†µä¸‹useEffectå¯ä»¥é€‚ç”¨äº99%çš„åœºæ™¯ã€‚\n\n####  useEffectçš„é”™è¯¯äº‹ä¾‹ã€‚çœ‹çœ‹æœ‰æ²¡æœ‰ä½ \n\n```js\nfunction SearchResults() {\n  const [query, setQuery] = useState('react');\n\n  // Imagine this function is also long\n  function getFetchUrl() {\n    return 'https://hn.algolia.com/api/v1/search?query=' + query;\n  }\n\n  // Imagine this function is also long\n  async function fetchData() {\n    const result = await axios(getFetchUrl());\n    setData(result.data);\n  }\n\n  useEffect(() => {\n    fetchData();\n  }, []);\n\n  // ...\n}\n```\n\n#### ä¸ºä»€ä¹ˆé”™äº†ï¼Ÿ\n\nä¸éš¾çœ‹å‡ºä¸Šé¢ä»£ç çš„æ„æ€æ˜¯ã€‚æƒ³è¦æ¨¡ä»¿componentDidMountçš„ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨é¡µé¢æˆ–è€…ç»„ä»¶åŠ è½½ä¹‹åå‘é€ä¸€ä¸ªè¯·æ±‚ã€‚å’‹ä¸€çœ‹å¥½åƒæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼ˆå®é™…åœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­ä¹Ÿæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œåœ¨å†™è¿™ç¯‡æ–‡ç« ä¹‹å‰æˆ‘ä¹Ÿæ˜¯è¿™ä¹ˆåšçš„ã€‚ï¼‰\n\nä½†æ˜¯å¤§å®¶å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœè¿™ä¸ªå‡½æ•°ç»„ä»¶ï¼Œæ˜¯ç°åœ¨çš„5å€å¤§ï¼Œè¿™ä¸ªdidMounté‡Œé¢è°ƒç”¨çš„è¯·æ±‚ï¼Œæœªæ¥ä¾èµ–çš„ä¸œè¥¿ä½ éƒ½å¯ä»¥100%çš„å¯Ÿè§‰åˆ°å—ï¼Ÿ\n\næˆ‘è§‰å¾—éš¾ï¼éš¾å…ä¼šæœ‰ç–å¿½ã€‚åˆ°æ—¶å€™å¯èƒ½å°±ä¼šå‡ºç°stateæˆ–è€…propsè¯»å–é”™è¯¯çš„æƒ…å†µã€‚å› ä¸ºæ¯ä¸€æ¬¡renderçš„stateå’Œpropséƒ½æ˜¯ç‹¬ç«‹çš„ã€‚\n\né‚£ä¹ˆï¼Œè¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿ\n\næœ‰ä¸€ä¸ªå¾ˆåœŸçš„åŠæ³•ï¼Œç›´æ¥æŠŠå‡½æ•°æ‰”åˆ°useEffecté‡Œé¢å»\n\n```jsx\nfunction SearchResults() {\n  // ...\n  useEffect(() => {\n    // We moved these functions inside!    \n    function getFetchUrl() {\n      return 'https://hn.algolia.com/api/v1/search?query=react';\n    }\n    async function fetchData() {\n      const result = await axios(getFetchUrl());\n      setData(result.data);\n    }\n    fetchData();\n  }, []); // âœ… Deps are OK\n  // ...\n}\n```\n\né‚£é«˜çº§ç‚¹çš„åŠæ³•å‘¢ï¼Ÿ\n\n```js\nfunction SearchResults() {\n  // âœ… Preserves identity when its own deps are the same\n  const getFetchUrl = useCallback((query) => {\n    return 'https://hn.algolia.com/api/v1/search?query=' + query;\n  }, []);  // âœ… Callback deps are OK\n\n  useEffect(() => {\n    const url = getFetchUrl('react');\n    // ... Fetch data and do something ...\n  }, [getFetchUrl]); // âœ… Effect deps are OK\n\n  // ...\n}\n```\n\nå°†å‡½æ•°ç”¨useCallbackåŒ…è£¹ï¼Œè¿™æ ·çš„è¯æˆ‘ä»¬åªéœ€è¦åšuseEffectçš„ä¾èµ–é‡Œé¢å†™ä¸Šæˆ‘ä»¬çš„å‡½æ•°ï¼Œç„¶ååœ¨useCallbacké‡Œé¢å†™ä¸Šæˆ‘ä»¬çš„ä¾èµ–ã€‚\n\n#### æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ¯ä¸€æ¬¡effectéƒ½æ˜¯å…¨æ–°çš„stateå’Œpropsï¼Œé‚£æˆ‘è¦å¦‚ä½•è·å¾—ä¸Šä¸€è½®æ›´æ–°çš„stateå‘¢ï¼Ÿ\n\n\n\n```js\nfunction Counter() {\n  const [count, setCount] = useState(0);\n\n  const prevCountRef = useRef();\n  useEffect(() => {\n    prevCountRef.current = count;\n  });\n  const prevCount = prevCountRef.current;\n\n  return <h1>Now: {count}, before: {prevCount}</h1>;\n}\n```\n\nå…¶å®å¾ˆå¥½ç†è§£ï¼Œå¦‚æœçœ‹äº†å‰é¢useEffectå’ŒuseLayoutEffectåŒºåˆ«çš„åŒå­¦ä¸€ä¸‹å°±å¯ä»¥çŸ¥é“è¿™ä¸ªçš„å®ç°åŸç†ã€‚\n\né¦–å…ˆï¼Œåœ¨ä¸€åˆ‡éƒ½æ›´æ–°ä¹‹åï¼Œç„¶åä¼šä¼šæ‰§è¡ŒuseEffectå†…éƒ¨çš„å›è°ƒå‡½æ•°ï¼Œå°†prevCountç»™èµ‹å€¼ï¼Œç”±äºæ²¡æœ‰è§¦å‘æ¸²æŸ“ï¼Œæ‰€ä»¥åªæ˜¯å•çº¯çš„èµ‹å€¼ã€‚è¿™æ ·å°±çœ‹èµ·æ¥prevCountçš„å€¼æ°¸è¿œéƒ½æ…¢ä¸€æ­¥ã€‚\n\n### æ€»ç»“\n\nå…¶å®åœ¨å­¦ä¹ useEffectçš„æ—¶å€™ã€‚åº”è¯¥å¿˜è®°ä½ å¯¹Reactçš„ä¸€äº›çŸ¥è¯†ã€‚æ¯”å¦‚ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨å‡½æ•°ç»„ä»¶é‡Œé¢æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸè¿™ä¸ªæ¦‚å¿µäº†ã€‚\n\næ¯ä¸€æ¬¡çš„renderä»–éƒ½æœ‰è‡ªå·±çš„stateå’Œpropsã€‚stateå’Œpropsæ›´åº”è¯¥è¢«çœ‹ä½œä¸€ä¸ªå¸¸é‡ï¼Œå“ªæ€•æ˜¯const bar = xxè¿™æ ·çš„å¸¸é‡ã€‚è¿™æ ·ç†è§£èµ·æ¥useEffectè¿™ä¸ªå‰¯ä½œç”¨å…¶å®ä¼šæ›´åŠ é¡ºç•…ï¼Œä¹Ÿä¸å®¹æ˜“è¿›å…¥ä»–çš„â€œé™·é˜±â€\n\n## useRef\n\n### å‰è¨€\n\nä¸ºä»€ä¹ˆæˆ‘æŠŠuseRefå•ç‹¬æ‹å‡ºæ¥è¯´ï¼Œä¸æŠŠä»–å’Œ`useImperativeHandle`æ”¾åœ¨ä¸€èµ·è®²ï¼Œå› ä¸º\n\n> ï¼ˆå®˜ç½‘åŸè¯ï¼‰å®ƒåˆ›å»ºçš„æ˜¯ä¸€ä¸ªæ™®é€š Javascript å¯¹è±¡ã€‚è€Œ `useRef()` å’Œè‡ªå»ºä¸€ä¸ª `{current: ...}` å¯¹è±¡çš„å”¯ä¸€åŒºåˆ«æ˜¯ï¼Œ`useRef` ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“æ—¶è¿”å›åŒä¸€ä¸ª ref å¯¹è±¡ã€‚\n\nè®°ä½`useRef`ä¸å•å•ç”¨äºè·å–`DOMèŠ‚ç‚¹å’Œç»„ä»¶å®ä¾‹`ï¼Œè¿˜æœ‰ä¸€ä¸ªå·§å¦™çš„ç”¨æ³•å°±æ˜¯`ä½œä¸ºå®¹å™¨ä¿ç•™å¯å˜å˜é‡`ï¼Œå¯ä»¥è¿™æ ·è¯´ï¼š`æ— æ³•è‡ªå¦‚åœ°ä½¿ç”¨useRefä¼šè®©ä½ å¤±å»hookå°†è¿‘ä¸€åŠçš„èƒ½åŠ›`\n\n#### useRef ä¸ createRef çš„åŒºåˆ«\n\n`useRef` ä»…èƒ½ç”¨åœ¨ FunctionComponentï¼Œ`createRef` ä»…èƒ½ç”¨åœ¨ ClassComponentã€‚\n\n`useRef` ä»…èƒ½ç”¨åœ¨ FunctionComponentï¼Œ`createRef` ä»…èƒ½ç”¨åœ¨ ClassComponentã€‚\n\nç¬¬ä¸€å¥è¯æ˜¯æ˜¾ç„¶çš„ï¼Œå› ä¸º Hooks ä¸èƒ½ç”¨åœ¨ ClassComponentã€‚\n\nç¬¬äºŒå¥è¯çš„åŸå› æ˜¯ï¼Œ`createRef` å¹¶æ²¡æœ‰ Hooks çš„æ•ˆæœï¼Œå…¶å€¼ä¼šéšç€ FunctionComponent é‡å¤æ‰§è¡Œè€Œä¸æ–­è¢«åˆå§‹åŒ–ï¼š\n\n```\nfunction App() {\n  // é”™è¯¯ç”¨æ³•ï¼Œæ°¸è¿œä¹Ÿæ‹¿ä¸åˆ° ref\n  const valueRef = React.createRef();\n  return <div ref={valueRef} />;\n}\nå¤åˆ¶ä»£ç \n```\n\nä¸Šè¿° `valueRef` ä¼šéšç€ App å‡½æ•°çš„ Render è€Œé‡å¤åˆå§‹åŒ–ï¼Œ**è¿™ä¹Ÿæ˜¯ Hooks çš„ç‹¬ç‰¹ä¹‹å¤„ï¼Œè™½ç„¶ç”¨åœ¨æ™®é€šå‡½æ•°ä¸­ï¼Œä½†åœ¨ React å¼•æ“ä¸­ä¼šå¾—åˆ°è¶…å‡ºæ™®é€šå‡½æ•°çš„è¡¨ç°ï¼Œæ¯”å¦‚åˆå§‹åŒ–ä»…æ‰§è¡Œä¸€æ¬¡ï¼Œæˆ–è€…å¼•ç”¨ä¸å˜**ã€‚\n\nä¸ºä»€ä¹ˆ `createRef` å¯ä»¥åœ¨ ClassComponent æ­£å¸¸è¿è¡Œå‘¢ï¼Ÿè¿™æ˜¯å› ä¸º ClassComponent åˆ†ç¦»äº†ç”Ÿå‘½å‘¨æœŸï¼Œä½¿ä¾‹å¦‚ `componentDidMount` ç­‰åˆå§‹åŒ–æ—¶æœºä»…æ‰§è¡Œä¸€æ¬¡ã€‚\n\n#### å¦‚ä½•è§£å†³æ¯æ¬¡renderå¸¦æ¥ç±»é—­åŒ…é—®é¢˜ï¼Ÿ\n\né¦–å…ˆï¼Œé¢˜ç›®æ€ä¹ˆç†è§£ï¼Ÿ[é¢˜ç›®](https://codesandbox.io/s/w2wxl3yo0l)\n\nå¦‚æœæˆ‘ä»¬å¸Œæœ›ä»–alertçš„æ—¶å€™å¯ä»¥è·å–åˆ°æœ€æ–°çš„å€¼çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨useRefæ¥è§£å†³\n\n```js\nconst Counter = () => {\n  const [count, setCount] = useState<number>(0)\n  const countRef = useRef<number>(count)\n\n  useEffect(() => {\n    countRef.current = count\n  })\n\n  const handleCount = () => {\n    setTimeout(() => {\n      alert('current count: ' + countRef.current)\n    }, 3000);\n  }\n\n  //...\n}\n\nexport default Counter\n```\n\n\n\n## memo\n\n#### memoæ²¡æœ‰å›è°ƒå‡½æ•°çš„è¯æ˜¯æ€ä¹ˆæµ…æ¯”è¾ƒçš„ï¼Ÿ\n\nå…ˆæ¥çœ‹çœ‹memoæ²¡æœ‰å›è°ƒå‡½æ•°çš„æ—¶å€™ä»–åšäº†ä»€ä¹ˆã€‚\n\nmemoå®ƒæ˜¯ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰ä»–ä¸React.PureComponentååˆ†ç›¸ä¼¼ã€‚é™¤äº†ä½¿ç”¨çš„åœ°æ–¹ä¸åŒï¼ˆClassç»„ä»¶å’ŒFunctionç»„ä»¶ï¼‰ä¹‹å¤–å‡ ä¹ä¸€è‡´ã€‚\n\nMemoå†…éƒ¨å’ŒPureComponentä¸€æ ·ä½¿ç”¨Object.isç”¨äºå‰å¯¹æ¯”ï¼Œå¦‚æœä¼ å…¥çš„propså†…å­˜åœ°å€ä¸å˜çš„è¯ï¼Œé‚£å°±ä¸ä¼šæ¸²æŸ“äº†ï¼ˆæˆ–è€…è¯´å¤ç”¨æœ€è¿‘çš„ä¸€æ¬¡æ¸²æŸ“ï¼‰ã€‚\n\nä¸‹é¢å¯ä»¥çœ‹æºç äº‹ä¾‹\n\n```js\nfunction updateMemoComponent(\n  current: Fiber | null,\n  workInProgress: Fiber,\n  Component: any,\n  nextProps: any,\n  updateExpirationTime,\n  renderExpirationTime: ExpirationTime,\n): null | Fiber {\n\n  /* ...çœç•¥...*/\n\n  // åˆ¤æ–­æ›´æ–°çš„è¿‡æœŸæ—¶é—´æ˜¯å¦å°äºæ¸²æŸ“çš„è¿‡æœŸæ—¶é—´\n  if (updateExpirationTime < renderExpirationTime) {\n    const prevProps = currentChild.memoizedProps;\n\n    // å¦‚æœè‡ªå®šä¹‰äº†compareå‡½æ•°ï¼Œåˆ™é‡‡ç”¨è‡ªå®šä¹‰çš„compareå‡½æ•°ï¼Œå¦åˆ™é‡‡ç”¨å®˜æ–¹çš„shallowEqual(æµ…æ¯”è¾ƒ)å‡½æ•°ã€‚ï¼ˆä¸‹é¢æœ‰è§£æï¼‰\n    let compare = Component.compare;\n    compare = compare !== null ? compare : shallowEqual;\n\n    /**\n     * 1. åˆ¤æ–­å½“å‰ props ä¸ nextProps æ˜¯å¦ç›¸ç­‰ï¼›\n     * 2. åˆ¤æ–­å³å°†æ¸²æŸ“ç»„ä»¶çš„å¼•ç”¨æ˜¯å¦ä¸workInProgress Fiberä¸­çš„å¼•ç”¨æ˜¯å¦ä¸€è‡´ï¼›\n     *\n     * åªæœ‰ä¸¤è€…éƒ½ä¸ºçœŸï¼Œæ‰ä¼šé€€å‡ºæ¸²æŸ“ã€‚\n     */\n    if (compare(prevProps, nextProps) && current.ref === workInProgress.ref) {\n      // å¦‚æœéƒ½ä¸ºçœŸï¼Œåˆ™é€€å‡ºæ¸²æŸ“\n      return bailoutOnAlreadyFinishedWork(\n        current,\n        workInProgress,\n        renderExpirationTime,\n      );\n    }\n  }\n\n  /* ...çœç•¥...*/\n\n```\n\nshallowEqualï¼ˆæµ…æ¯”è¾ƒï¼‰\n\n```js\n// ç”¨åŸå‹é“¾çš„æ–¹æ³•\nconst hasOwn = Object.prototype.hasOwnProperty\n\n// è¿™ä¸ªå‡½æ•°å®é™…ä¸Šæ˜¯Object.is()çš„polyfill\nfunction is(x, y) {\n  if (x === y) {\n    return x !== 0 || y !== 0 || 1 / x === 1 / y\n  } else {\n    return x !== x && y !== y\n  }\n}\n\nexport default function shallowEqual(objA, objB) {\n  // é¦–å…ˆå¯¹åŸºæœ¬æ•°æ®ç±»å‹çš„æ¯”è¾ƒ\n  if (is(objA, objB)) return true\n  // ç”±äºObejct.is()å¯ä»¥å¯¹åŸºæœ¬æ•°æ®ç±»å‹åšä¸€ä¸ªç²¾ç¡®çš„æ¯”è¾ƒï¼Œ æ‰€ä»¥å¦‚æœä¸ç­‰\n  // åªæœ‰ä¸€ç§æƒ…å†µæ˜¯è¯¯åˆ¤çš„ï¼Œé‚£å°±æ˜¯object,æ‰€ä»¥åœ¨åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡éƒ½ä¸æ˜¯object\n  // ä¹‹åï¼Œå°±å¯ä»¥è¿”å›falseäº†\n  if (typeof objA !== 'object' || objA === null ||\n      typeof objB !== 'object' || objB === null) {\n    return false\n  }\n\n  // è¿‡æ»¤æ‰åŸºæœ¬æ•°æ®ç±»å‹ä¹‹åï¼Œå°±æ˜¯å¯¹å¯¹è±¡çš„æ¯”è¾ƒäº†\n  // é¦–å…ˆæ‹¿å‡ºkeyå€¼ï¼Œå¯¹keyçš„é•¿åº¦è¿›è¡Œå¯¹æ¯”\n\n  const keysA = Object.keys(objA)\n  const keysB = Object.keys(objB)\n\n  // é•¿åº¦ä¸ç­‰ç›´æ¥è¿”å›false\n  if (keysA.length !== keysB.length) return false\n  // keyç›¸ç­‰çš„æƒ…å†µä¸‹ï¼Œåœ¨å»å¾ªç¯æ¯”è¾ƒ\n  for (let i = 0; i < keysA.length; i++) {\n  // keyå€¼ç›¸ç­‰çš„æ—¶å€™\n  // å€Ÿç”¨åŸå‹é“¾ä¸ŠçœŸæ­£çš„ hasOwnProperty æ–¹æ³•ï¼Œåˆ¤æ–­ObjBé‡Œé¢æ˜¯å¦æœ‰Açš„keyçš„keyå€¼\n  // å±æ€§çš„é¡ºåºä¸å½±å“ç»“æœä¹Ÿå°±æ˜¯{name:'daisy', age:'24'} è·Ÿ{age:'24'ï¼Œname:'daisy' }æ˜¯ä¸€æ ·çš„\n  // æœ€åï¼Œå¯¹å¯¹è±¡çš„valueè¿›è¡Œä¸€ä¸ªåŸºæœ¬æ•°æ®ç±»å‹çš„æ¯”è¾ƒï¼Œè¿”å›ç»“æœ\n    if (!hasOwn.call(objB, keysA[i]) ||\n        !is(objA[keysA[i]], objB[keysA[i]])) {\n      return false\n    }\n  }\n\n  return truea\n}\n```\n\nç”±æºç å¯ä»¥çŸ¥é“ï¼ŒåŠ å…¥æ²¡æœ‰ä¼ ä¸€ä¸ªæ¯”è¾ƒçš„å›è°ƒå‡½æ•°ä¼šä½¿ç”¨å®˜æ–¹çš„æµ…æ¯”è¾ƒã€‚å…·ä½“çš„å¯ä»¥çœ‹æ³¨é‡Š\n\n#### memoçš„å›è°ƒå‡½æ•°\n\næˆ‘ä»¬éƒ½çŸ¥é“reactçš„ç”Ÿå‘½å‘¨æœŸä¸­æœ‰ä¸€ä¸ªshouldComponentUpdateã€‚åœ¨è¿™ä¸ªå‡½æ•°ä¸­è¿”å›trueçš„è¯å°±ä»£è¡¨æœ¬æ¬¡renderéœ€è¦æ‰§è¡Œï¼Œè€Œè¿”å›falseå°±å¯ä»¥è·³è¿‡æœ¬æ¬¡çš„renderã€‚\n\nè€Œmemoæ­£å¥½ç›¸åï¼Œè¿”å›trueè¡¨ç¤ºæœ¬æ¬¡è·³è¿‡ï¼Œè¿”å›falseå°±è¡¨ç¤ºæœ¬æ¬¡éœ€è¦æ‰§è¡Œrenderã€‚\n\nå…·ä½“æ€ä¹ˆç”¨å‘¢ï¼Ÿ\n\nå¤§å®¶å¯ä»¥è‡ªå·±è¿è¡Œä¸€ä¸‹ï¼Œçœ‹çœ‹æ•ˆæœã€‚ä¸€å®šè¦è‡ªå·±è¯•ä¸€ä¸‹ï¼Œä¸ç„¶å¾ˆå®¹æ˜“å’ŒshouldComponentUpdateå¼„æ··äº†ã€‚å­¦ä¹ è¿˜æ˜¯è¦è‡ªå·±åŠ¨æ‰‹æ‰è¡Œã€‚\n\n```js\nfunction ChangeLog({w = ''}){\n  // çœç•¥\n  console.log('====render====')\n}\nexport default memo(ChangeLog, (prevProps, nextProps) => {\n  if (prevProps.w !== nextProps.w) {\n    return false\n  }\n  return true\n});\n```\n\n## useMemo/useCallback\n\n ### å‰è¨€\n\nä¹‹æ‰€ä»¥æŠŠè¿™useMomo/useCallackä¸¤å…„å¼Ÿå’Œåœ¨ä¸€èµ·ã€‚æ˜¯å› ä¸ºä»–ä»¬å…¶å®ååˆ†ç›¸ä¼¼ã€‚\n\n> ä¸€ä¸ªæ˜¯ç¼“å­˜å˜é‡ï¼ˆuseMemoï¼‰ï¼Œä¸€ä¸ªæ˜¯ç¼“å­˜å‡½æ•°ï¼ˆuseCallbackï¼‰ã€‚\n\nå…¶å®è¿™ä¹ˆä¸€è¯´å°±æ¸…æ™°å¾ˆå¤šäº†ã€‚\n\nå…·ä½“çš„ä½¿ç”¨å’ŒuseEffectä¸€æ ·ï¼Œéƒ½æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè°ƒç”¨æ—¶çš„å›è°ƒå‡½æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è°ƒç”¨åˆ¤æ–­æ‰€ç›‘å¬çš„å€¼ï¼ˆå¯ä»¥æ˜¯å˜é‡ï¼Œä¹Ÿå¯ä»¥æ˜¯å‡½æ•°ï¼‰\n\n```js\nconst memoizedValue = useMemo(() => computeExpensiveValue(a, b), [a, b]);\nconst memoizedValue = useCallback(() => computeExpensiveValue(a, b), [a, b]);\n```\n\nuseMemo() è¿”å›çš„æ˜¯ä¸€ä¸ª memoized å€¼ï¼Œåªæœ‰å½“ä¾èµ–é¡¹ï¼ˆæ¯”å¦‚ä¸Šé¢çš„ a,b å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œæ‰ä¼šé‡æ–°è®¡ç®—è¿™ä¸ª memoized å€¼ï¼‰\n\nmemoized å€¼ä¸å˜çš„æƒ…å†µä¸‹ï¼Œä¸ä¼šé‡æ–°è§¦å‘æ¸²æŸ“é€»è¾‘ã€‚\n\nè¯´èµ·æ¸²æŸ“é€»è¾‘ï¼Œéœ€è¦è®°ä½çš„æ˜¯ useMemo() æ˜¯åœ¨ render æœŸé—´æ‰§è¡Œçš„ï¼Œæ‰€ä»¥ä¸èƒ½è¿›è¡Œä¸€äº›é¢å¤–çš„å‰¯æ“ä½œï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚ç­‰ã€‚\n\nå¦‚æœæ²¡æœ‰æä¾›ä¾èµ–æ•°ç»„ï¼ˆä¸Šé¢çš„ [a,b]ï¼‰åˆ™æ¯æ¬¡éƒ½ä¼šé‡æ–°è®¡ç®— memoized å€¼ï¼Œä¹Ÿå°±ä¼š re-redner\n\nuseCallbackä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œå°±ä¸å¤šèµ˜è¿°äº†ã€‚\n\n## useReducer/useContext\n\n### å‰è¨€\n\nå¸®ä»–ä»¬ä¸¤å…„å¼Ÿå’Œåœ¨ä¸€èµ·è¯´ä¸»è¦è¯´å› ä¸ºä»–ä»¬ä¸¤å…„å¼Ÿåœ¨ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯å¯ä»¥ä¸Reduxä¸€æˆ˜çš„ã€‚\n\nä½†æ˜¯ï¼ï¼\n\nä½†æ˜¯å•Šï¼Œä½†æ˜¯å¦‚æœä½ éœ€è¦ä¸­é—´ä»·ï¼Œæˆ–è€…è¯´éœ€è¦â€œæ—¶é—´æ—…è¡Œâ€ï¼Œåˆæˆ–è€…ä¸´æ—¶éœ€è¦è·¨é¡µé¢çº§çš„æ•°æ®å…±äº«ï¼Œé‚£ä½ è¿˜æ˜¯éœ€è¦reduxæ¥è§£å†³çš„ã€‚ä¸è¿‡åŸºæœ¬ä¸Šçš„åœºæ™¯æˆ‘ä»¬ä½¿ç”¨useReducerå’ŒuseContextå°±å¯ä»¥å®Œç¾çš„æ›¿ä»£reduxäº†ã€‚\n\n### æ€ä¹ˆåšï¼Ÿ\n\nå…¶å®ä¹‹å‰ç”±äºè¦èµ·ä¸€ä¸ªæ–°é¡¹ç›®ï¼Œä½†æ˜¯çªç„¶å‘ç°æœ‰ä¸€ä¸ªçˆ·çˆ·ç»„ä»¶çš„å€¼ä¸ºéœ€è¦é€šçŸ¥ç»™å­™å­ç»„ä»¶ï¼Œç„¶åå­™å­ç»„ä»¶å¯èƒ½ä¼šç”¨æ‰å›è°ƒå‡½æ•°è°ƒç”¨çˆ·çˆ·ç»„ä»¶çš„æ–¹æ³•ã€‚é‚£ä¸ªæ—¶å€™å…¶å®å·²ç»ç”¨Hookå†™äº†ä¸€åŠäº†ï¼Œæ‡’å¾—åŠ Reduxäº†ï¼Œåˆä¸æƒ³ä¸€å±‚å±‚ä¼ propsä¸‹å»ã€‚æ€ä¹ˆåŠï¼Ÿ\n\né€šè¿‡äº†è§£ï¼Œæˆ‘çŸ¥é“äº†useReducer/useContextåˆšåˆšå¥½å¯ä»¥è§£å†³æˆ‘çš„éœ€æ±‚ã€‚\n\n```js\nconst TodosDispatch = React.createContext(null);\n\nconst initialState = { bar: null };\n\nfunction reducer(state, action) {\n  switch (action.type) {\n    case 'setCenter':\n      return { ...state, bar: action.bar };\n    default:\n      return state\n  }\n}\n\n// è™½ç„¶è¿™ä¸ªæ˜¯è‡ªç»„ä»¶ï¼Œä½†æ˜¯å“ªæ€•æ˜¯æ›¾æ›¾æ›¾å­™å­ç»„ä»¶éƒ½å¯ä»¥ç›´æ¥ç”¨useContextæ‹¿åˆ°dispatch\nfunction DeepChild(props) {\n  // å¦‚æœæˆ‘ä»¬æƒ³è¦æ‰§è¡Œä¸€ä¸ª actionï¼Œæˆ‘ä»¬å¯ä»¥ä» context ä¸­è·å– dispatchã€‚\n  const dispatch = useContext(TodosDispatch);\n\n  function handleClick() {\n    dispatch({ type: 'add', text: 'hello' });\n  }\n\n  return (\n    <button onClick={handleClick}>Add todo</button>\n  );\n}\n\nfunction TodosApp() {\n  // æç¤ºï¼š`dispatch` ä¸ä¼šåœ¨é‡æ–°æ¸²æŸ“ä¹‹é—´å˜åŒ–\n  const [state, dispatch] = useReducer(reducer, initialState);\n\n  return (\n    <TodosDispatch.Provider value={dispatch}>\n      <DeepTree todos={todos} />\n    </TodosDispatch.Provider>\n  );\n}\n```\n\n## useImperativeHandle/forwardRef\n\nè¿™é‡Œå°±ä¸å¤šè¯´äº†ï¼ŒåŸºæœ¬ä¸Šæ²¡æœ‰ä»€ä¹ˆå‘ç‚¹å’Œç–‘éš¾ç‚¹ã€‚\n\nè¯´ä¸€ä¸‹åŸºæœ¬ç”¨æ³•å’Œant-design formä¸­çš„ä½¿ç”¨\n\n### æ­£å¸¸ä½¿ç”¨\n\n```js\nuseImperativeHandle(ref, createHandle, [deps])\n```\n\n`useImperativeHandle` å¯ä»¥è®©ä½ åœ¨ä½¿ç”¨ `ref` æ—¶è‡ªå®šä¹‰æš´éœ²ç»™çˆ¶ç»„ä»¶çš„å®ä¾‹å€¼ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåº”å½“é¿å…ä½¿ç”¨ ref è¿™æ ·çš„å‘½ä»¤å¼ä»£ç ã€‚`useImperativeHandle` åº”å½“ä¸ `forwardRef`ä¸€èµ·ä½¿ç”¨ï¼š\n\n```js\nfunction FancyInput(props, ref) {\n  const inputRef = useRef();\n  useImperativeHandle(ref, () => ({\n    focus: () => {\n      inputRef.current.focus();\n    }\n  }));\n  return <input ref={inputRef} ... />;\n}\nFancyInput = forwardRef(FancyInput);\n```\n\nåœ¨æœ¬ä¾‹ä¸­ï¼Œæ¸²æŸ“<FancyInput ref={inputRef} />çš„çˆ¶ç»„ä»¶å¯ä»¥è°ƒç”¨ `inputRef.current.focus()`ã€‚\n\n### ant-design form\n\n```js\n// refä»ç¬¬äºŒä¸ªå‚æ•°å–ï¼Œè¿™é‡Œéƒ½æ˜¯ä¸€è‡´çš„\nconst Example = (props,ref) => {\n  const bar = () => {}\n  useImperativeHandle(ref, () => ({\n    text: bar,\n  }));\n  return (\n    <>\n        <Form>\n    \t\t\t{//....}\n        </Form>\n    </>\n  );\n};\n\nexport default memo(Form.create()(forwardRef(Example)));\n\n```\n\n```js\n\nconst Parent = () => {\n  return (\n    <>\n      <Example\n      \t// æ³¨æ„è¿™ä¸ªä¸å†æ˜¯ä¼ refäº†ï¼Œè€Œæ˜¯ä¼ wrappedComponentRefã€‚å› ä¸ºantdçš„formä»–è¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè¿™ä¸ªæ˜¯ä»–è‡ªå®šä¹‰çš„ä¸€ä¸ªæ¥æ”¶refçš„å€¼\n        wrappedComponentRef={editTemplateRef}\n      />\n    </>\n  );\n};\n```\n\n\n\n## useDebugValue/è‡ªå®šä¹‰Hook\n\n### å‰è¨€\n\nuseDebugValueæ˜¯ä¸“é—¨ç”¨äºæœåŠ¡è‡ªå®šä¹‰çš„Hookçš„ã€‚\n\nå…·ä½“çœ‹çœ‹ä½¿ç”¨å°±å¥½\n\n\n\nuseDebugValueï¼Œç›®çš„æ˜¯èƒ½åœ¨reactçš„æµè§ˆå™¨è°ƒè¯•å·¥å…·ä¸Šæ˜¾ç¤ºä½ çš„è‡ªå®šä¹‰hooksï¼Œæˆ–è€…ç»™hooksæ ‡è®°ä¸€äº›ä¸œè¥¿\nå½“ä½¿ç”¨ä¸€ä¸ªå‚æ•°çš„æ—¶å€™ï¼Œå°±æ˜¯æŠŠç¬¬ä¸€ä¸ªå‚æ•°æ ‡è®°åœ¨reactçš„è°ƒè¯•å·¥å…·ä¸Š,ä¸‹é¢å†™ä¸€ä¸ªç®€å•çš„ä¾‹å­\n\n```js\nimport React, { useDebugValue, useState } from 'react';\n\nconst useTest = () => {\n    const [str, setStr] = useState<string>('');\n    useDebugValue('debug');\n    return {\n        str, setStr\n    }\n}\nexport default (): JSX.Element => {\n    const { str, setStr } = useTest();\n    return (\n        <>\n            <h2>{str}</h2>\n            <button onClick={() => {\n                setStr('é‡æ–°æ¸²æŸ“');\n            }}>è¿™æ˜¯ï¼Ÿï¼Ÿï¼Ÿ</button>\n        </>\n    );\n}\n```\n\n\n\n![](/image/ä½ çœŸçš„æ‡‚ReactHookå—/20190818212347571.png)\n\n\n\nä¼šåœ¨è‡ªå®šä¹‰çš„hooksæ ‡è®°åˆ°reactçš„è°ƒè¯•å·¥å…·ä¸Šé¢,ä¸»è¦ç”¨äºè°ƒè¯•å·¥å…·è°ƒè¯•ä½¿ç”¨\n\nå½“ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°çš„æƒ…å†µä¸‹ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œä¼šæŠŠç¬¬ä¸€ä¸ªå‚æ•°å½“æˆè‡ªå·±çš„å½¢å‚ä¼ å…¥ï¼Œè¿›è¡Œä¸€ç³»åˆ—çš„æ“ä½œï¼Œreturnå›å»ï¼Œç„¶åæ‰ä¼šåœ¨reactè°ƒè¯•å·¥å…·çš„hooksä¸­æ‰“å°å‡ºæ¥ï¼Œä¸ç„¶ä¸ä¼šæ˜¾ç¤º\n\n```js\nimport React, { useDebugValue, useState } from 'react';\n\nconst useTest = () => {\n    const [str, setStr] = useState<string>('');\n    useDebugValue(str, (value:string) => {\n        console.log(value);\n        return 'è¿™æ˜¯æ”¹é€ åçš„' + value;\n    });\n    return {\n        str, setStr\n    }\n}\nexport default (): JSX.Element => {\n    const { str, setStr } = useTest();\n    return (\n        <>\n\n            <h2>{str}</h2>\n\n            <button onClick={() => {\n                setStr('é‡æ–°æ¸²æŸ“');\n           }}>è¿™æ˜¯ï¼Ÿï¼Ÿï¼Ÿ</button>\n       </>\n    );\n}\n```\n\nç»“æœ:\n\n![](/image/ä½ çœŸçš„æ‡‚ReactHookå—/2019081821194714.png)\n\n\nåŒæ—¶åœ¨æ§åˆ¶å°ä¸Šæ‰“å°äº†ä¸€ä¸ªç©ºå­—ç¬¦\n\n\nç”±äºstrçš„åˆå§‹å€¼æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥æ‰“å°å°±æ˜¯ç©ºçš„äº†ï¼Œè¿™åªæ˜¯è°ƒè¯•ä½¿ç”¨ï¼Œhookså·®ä¸å¤šå°±è¿™äº›äº†ï¼Œæ²¡æœ‰å…¶ä»–çš„äº†\n\n\n\n## è§‚çœ‹ä¹‹å\n\nå¦‚æœæœ‰å“ªé‡Œå†™çš„ä¸å¯¹æˆ–è€…æœ‰ç–‘é—®çš„æ¬¢è¿å¤§å®¶åœ¨è¯„è®ºåŒºäº’åŠ¨ã€‚ğŸ™\n\n\n\n\n","slug":"ä½ çœŸçš„æ‡‚React-Hookå—","published":1,"updated":"2021-06-24T14:00:06.855Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra8w002dlwrdgcig9ihz","content":"<h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><ol>\n<li>è¯»è¿™ç¯‡æ–‡ç« çš„å‰ææ˜¯ä½ å·²ç»å¯¹React Hookæœ‰æ‰€äº†è§£çš„æƒ…å†µä¸‹ï¼Œå¦‚æœä½ è¿˜æ²¡æœ‰äº†è§£ï¼Œè¯·å…ˆç§»æ­¥å®˜ç½‘å­¦ä¹ ä¸€ä¸‹ã€‚<ol>\n<li>æœ€å¥½ä¸è¦å»ç½‘ä¸Šçœ‹åˆ«äººçš„æ€»ç»“ä¹‹ç±»çš„ï¼Œæ— éå°±æ˜¯è¶…çš„å®˜ç½‘çš„ï¼Œè€Œä¸”è¿™æ ·ä¼šè®©ä½ çš„è®¤çŸ¥ä»ä¸€å¼€å§‹å°±èµ°åã€‚</li>\n</ol>\n</li>\n<li>è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯æ¢ç©¶Hookçš„åŠ¨æœºï¼Œä½¿ç”¨ä¸­çš„ä¸€äº›ç–‘é—®ï¼›<ol>\n<li>ä½¿ç”¨çš„è¯Reactå®˜ç½‘å·²ç»è®²å¾—å¾ˆè¯¦ç»†äº†ï¼Œè¿™é‡Œå°±ä¸å¤šèµ˜è¿°äº†ã€‚</li>\n</ol>\n</li>\n<li>æœ‰éœ€è¦çœ‹æ¥ä¸‹æ¥çš„ç–‘éš¾ç‚¹çš„ä¼™ä¼´æ¬¢è¿ç›´æ¥è·³è¿‡æ¢ç©¶ç›´æ¥çœ‹å…·ä½“çš„ç–‘é—®ï¼›</li>\n</ol>\n<h2 id=\"æ¢ç©¶\"><a href=\"#æ¢ç©¶\" class=\"headerlink\" title=\"æ¢ç©¶\"></a>æ¢ç©¶</h2><p>ä¸»è¦ä»3ä¸ªæ–¹é¢ç ”ç©¶React Hook</p>\n<p>æ ¹æ®é»„é‡‘æ€ç»´åœˆï¼ˆWhatã€Howã€Whyï¼‰</p>\n<h3 id=\"What\"><a href=\"#What\" class=\"headerlink\" title=\"What\"></a>What</h3><p>ä»€ä¹ˆæ˜¯Hookï¼Ÿ</p>\n<p>æ‰“å¼€Googleç¿»è¯‘ï¼Œå¾—åˆ°çš„è§£é‡Šï¼š<em>é’©ã€é’©å­</em></p>\n<blockquote>\n<p>å†çœ‹çœ‹Reactå®˜ç½‘çš„è§£é‡Šï¼šThey let you use state and other React features without writing a class.ï¼ˆå®ƒå¯ä»¥è®©ä½ åœ¨ä¸ç¼–å†™ class çš„æƒ…å†µä¸‹ä½¿ç”¨ state ä»¥åŠå…¶ä»–çš„ React ç‰¹æ€§ã€‚ï¼‰</p>\n</blockquote>\n<p>æ‰€ä»¥ï¼Œç»“åˆä¸€ä¸‹ã€‚æˆ‘ä¸ªäººçš„ç†è§£æ˜¯è¿™æ ·çš„ï¼šå¯¹äºå‡½æ•°å¼çš„ç»„ä»¶ï¼Œå¯ä»¥ç”¨é’©å­ï¼ˆHookï¼‰å°†æƒ³è¦çš„å¤–éƒ¨åŠŸèƒ½ç»™â€œé’©â€è¿›æ¥ã€‚</p>\n<p>åœ¨React Hookå‡ºæ¥ä¹‹å‰ï¼Œå‡½æ•°å¼ç»„ä»¶éƒ½æ˜¯æ— çŠ¶æ€çš„ç»„ä»¶ï¼Œæœ€å¤šå°±æ˜¯æ ¹æ®<code>props</code>æ¥åŠ ä¸€äº›åˆ¤æ–­çš„é€»è¾‘ï¼›è€Œåœ¨React Hookå‡ºæ¥ä¹‹åå°±å¯ä»¥åœ¨å‡½æ•°å¼ç»„ä»¶é‡Œé¢åŠ å…¥çŠ¶æ€ï¼ˆuseStateï¼‰ï¼Œç±»ç”Ÿå‘½å‘¨æœŸï¼ˆuseEffectï¼‰ï¼Œç”šè‡³æ˜¯ä¸€äº›è‡ªå·±çš„å¤ç”¨é€»è¾‘ï¼ˆè‡ªå®šä¹‰Hookï¼‰ç­‰ç­‰è¿™äº›å¤–éƒ¨çš„åŠŸèƒ½ã€‚</p>\n<h3 id=\"How\"><a href=\"#How\" class=\"headerlink\" title=\"How\"></a>How</h3><p>æ€ä¹ˆä½¿ç”¨Hookï¼Ÿ</p>\n<p>å¤§å®¶ä¸€èµ·çœ‹ä¸€ä¸‹å®˜ç½‘çš„ä¸€ä¸ªä¾‹å­ã€‚</p>\n<p>é¢˜ç›®ï¼šæ˜¾ç¤ºä¸€ä¸ªè®¡æ•°å™¨ã€‚å½“ä½ ç‚¹å‡»æŒ‰é’®ï¼Œè®¡æ•°å™¨çš„å€¼å°±ä¼šå¢åŠ ã€‚</p>\n<h4 id=\"Classç»„ä»¶\"><a href=\"#Classç»„ä»¶\" class=\"headerlink\" title=\"Classç»„ä»¶\"></a>Classç»„ä»¶</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Example</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(props) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">super</span>(props);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.state = &#123;</span><br><span class=\"line\">      count: <span class=\"number\">0</span></span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;div&gt;</span><br><span class=\"line\">        &lt;p&gt;You clicked &#123;<span class=\"keyword\">this</span>.state.count&#125; times&lt;<span class=\"regexp\">/p&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        &lt;button onClick=&#123;() =&gt; this.setState(&#123; count: this.state.count + 1 &#125;)&#125;&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">          Click me</span></span><br><span class=\"line\"><span class=\"regexp\">        &lt;/</span>button&gt;</span><br><span class=\"line\">      &lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    );</span></span><br><span class=\"line\"><span class=\"regexp\">  &#125;</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"React-Hook\"><a href=\"#React-Hook\" class=\"headerlink\" title=\"React Hook\"></a>React Hook</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; useState &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Example</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// å£°æ˜ä¸€ä¸ªå« \"count\" çš„ state å˜é‡  const [count, setCount] = useState(0);</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    &lt;div&gt;</span><br><span class=\"line\">      &lt;p&gt;You clicked &#123;count&#125; times&lt;<span class=\"regexp\">/p&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        Click me</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;/</span>button&gt;</span><br><span class=\"line\">    &lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  );</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>è¿™æ ·å°±ç®—æ˜¯å®Œæˆäº†ä¸€ä¸ªæœ€ç®€å•çš„React Hook å®è·µï¼Œå…³äºä¸€äº›å®˜æ–¹æä¾›çš„Hookæ™šç‚¹ä¼šä»‹ç»ã€‚</p>\n<h3 id=\"Why\"><a href=\"#Why\" class=\"headerlink\" title=\"Why\"></a>Why</h3><ul>\n<li>ä¸ºä»€ä¹ˆä¼šæœ‰Hooksï¼Ÿ</li>\n<li>Hookèƒ½è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ</li>\n</ul>\n<p>åšä»»ä½•ä¸€ä»¶äº‹æƒ…æˆ‘è§‰å¾—éƒ½åº”è¯¥ç†æ¸…è¿™ä¸ªä¸¤ä¸ªé—®é¢˜ï¼Œè¿™æ ·çš„è¯å°±ä¼šäº‹åŠåŠŸå€ã€‚</p>\n<p>æˆ‘ä»¬å…ˆçœ‹çœ‹Reactå®˜æ–¹æ˜¯æ€ä¹ˆè§£é‡Šâ€œWhyâ€çš„</p>\n<blockquote>\n<ol>\n<li>åœ¨ç»„ä»¶ä¹‹é—´å¤ç”¨çŠ¶æ€é€»è¾‘å¾ˆéš¾</li>\n<li>å¤æ‚ç»„ä»¶å˜å¾—éš¾ä»¥ç†è§£</li>\n<li>éš¾ä»¥ç†è§£çš„ class</li>\n</ol>\n</blockquote>\n<p>æœ¬äººä¸ªäººè®¤ä¸ºç¬¬ä¸‰ç‚¹æ˜¯æ¥å‡‘æ•°çš„â€¦.</p>\n<p>ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Ÿ</p>\n<p>å› ä¸ºReactç”¨äº†è¿™ä¹ˆä¹…äº†åŸºæœ¬éƒ½æ˜¯åœ¨ä½¿ç”¨Classç»„ä»¶ï¼Œè¿™ä¸ªæ˜¯åœ¨ä¹‹å‰ï¼Œå“ªæ€•æ˜¯ç°åœ¨å­¦ä¹ Reactçš„å¿…ç»ä¹‹è·¯å§ï¼æ‰€ä»¥ï¼Œè¿™ç‚¹æˆ‘æ¥ä¸‹æ¥å°±ä¼šè·³è¿‡äº†ğŸ˜‚</p>\n<h3 id=\"åœ¨ç»„ä»¶ä¹‹é—´æœç”¨çŠ¶æ€é€»è¾‘å¾ˆéš¾\"><a href=\"#åœ¨ç»„ä»¶ä¹‹é—´æœç”¨çŠ¶æ€é€»è¾‘å¾ˆéš¾\" class=\"headerlink\" title=\"åœ¨ç»„ä»¶ä¹‹é—´æœç”¨çŠ¶æ€é€»è¾‘å¾ˆéš¾\"></a>åœ¨ç»„ä»¶ä¹‹é—´æœç”¨çŠ¶æ€é€»è¾‘å¾ˆéš¾</h3><p>å…¶å®é«˜é˜¶ç»„ä»¶æˆ–è€…è¯´æ˜¯propséƒ½æ˜¯å¾ˆå¥½çš„è§£å†³äº†å¤æ‚çš„èšåˆä¸šåŠ¡é€»è¾‘ï¼Œé‚£ä¸ºä»€ä¹ˆè¯´åœ¨<strong>ç»„ä»¶ä¹‹é—´æœç”¨çŠ¶æ€é€»è¾‘å¾ˆéš¾</strong>å‘¢ï¼Ÿ</p>\n<p>å…¶å®é“ç†éå¸¸ç®€å•ã€‚</p>\n<p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£ã€‚</p>\n<p>åœºæ™¯ï¼šæœ‰ è¯·æ±‚Aï¼Œè¯·æ±‚Bï¼Œè¯·æ±‚Cï¼Œè¯·æ±‚Dã€‚ä»–ä»¬çš„è¯·æ±‚éƒ½æœ‰ç›¸äº’ä¾èµ–å…³ç³»æ¯”å¦‚ï¼Œå‘è¯·æ±‚Bçš„æ—¶å€™å¿…é¡»æ‹¿åˆ°è¯·æ±‚Açš„ç»“æœä¸­çš„æŸä¸ªå€¼ï¼Œè€Œè¯·æ±‚Cä¹Ÿå¿…é¡»æ‹¿åˆ°è¯·æ±‚Bçš„ç»“æœä¸­çš„æŸä¸ªå€¼ã€‚ä»¥æ­¤ç±»æ¨è¯·æ±‚Dã€‚</p>\n<p>Promiseå‡ºæ¥ä¹‹å‰æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿ</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$.ajax(&#123;</span><br><span class=\"line\">    type:<span class=\"string\">\"post\"</span>,</span><br><span class=\"line\">    success: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;<span class=\"comment\">//æˆåŠŸå›è°ƒ</span></span><br><span class=\"line\">        <span class=\"comment\">//å†æ¬¡å¼‚æ­¥è¯·æ±‚</span></span><br><span class=\"line\">        $.ajax(&#123;</span><br><span class=\"line\">            type:<span class=\"string\">\"post\"</span>,</span><br><span class=\"line\">            url:<span class=\"string\">\"...\"</span>,</span><br><span class=\"line\">            success:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;<span class=\"comment\">//æˆåŠŸå›è°ƒ</span></span><br><span class=\"line\">              <span class=\"comment\">//å†æ¬¡å¼‚æ­¥è¯·æ±‚</span></span><br><span class=\"line\">              $.ajax(&#123;</span><br><span class=\"line\">                  type:<span class=\"string\">\"post\"</span>,</span><br><span class=\"line\">                  url:<span class=\"string\">\"...\"</span>,</span><br><span class=\"line\">                  success:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">                      .......<span class=\"comment\">//å¦‚æ­¤å¾ªç¯</span></span><br><span class=\"line\">                  &#125;</span><br><span class=\"line\">              &#125;)</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>è¿™è¿˜åªæ˜¯3å±‚ï¼Œå¦‚æœæ˜¯100å±‚å‘¢ï¼Ÿé‚£çœ‹èµ·æ¥å°±éå¸¸çš„éš¾å—äº†ï¼</p>\n<p>Promiseè¾ƒå¥½çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(f1)</span><br><span class=\"line\"> .then(f2)</span><br><span class=\"line\"> .then(f3)</span><br><span class=\"line\"> .then(f4)</span><br><span class=\"line\"> .then(f5)</span><br><span class=\"line\"> .then(f5)</span><br><span class=\"line\">â€¦â€¦â€¦â€¦</span><br></pre></td></tr></table></figure>\n\n<p>ç„¶åæ˜¯async/awaitã€‚è¿™é‡Œå°±ä¸å±•å¼€äº†ï¼Œæœ‰å…´è¶£çš„å¯ä»¥è‡ªå·±å»äº†è§£ä¸€ä¸‹ã€‚</p>\n<p>ç»“è®º</p>\n<p>ä¹‹æ‰€ä»¥è¿™ä¹ˆå¤§è´¹å‘¨ç« çš„è®²æ˜¯ä¸ºäº†è§£é‡Šï¼ŒReactä¸­çš„é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰ã€‚ä»–çš„é€»è¾‘å…¶å®å’Œå›è°ƒåœ°ç‹±ç±»ä¼¼ï¼Œä¸€ä¸ªä¸¤ä¸ªå…¶å®éƒ½è¿˜ç®—ä¼˜é›…æˆ–è€…è¯´èˆ’æœï¼Œä¸€æ—¦å¤šäº†çš„è¯ã€‚ã€‚ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> withHover(</span><br><span class=\"line\">  withTheme(</span><br><span class=\"line\">    withAuth(</span><br><span class=\"line\">      withRepos(Profile)</span><br><span class=\"line\">    )</span><br><span class=\"line\">  )</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// å°±ä¼šå˜æˆè¿™æ ·ï¼Œä¸å¤Ÿä¼˜é›…</span></span><br><span class=\"line\">&lt;WithHover&gt;</span><br><span class=\"line\">  &lt;WithTheme hovering=&#123;<span class=\"literal\">false</span>&#125;&gt;</span><br><span class=\"line\">    &lt;WithAuth hovering=&#123;<span class=\"literal\">false</span>&#125; theme=<span class=\"string\">'dark'</span>&gt;</span><br><span class=\"line\">      &lt;WithRepos hovering=&#123;<span class=\"literal\">false</span>&#125; theme=<span class=\"string\">'dark'</span> authed=&#123;<span class=\"literal\">true</span>&#125;&gt;</span><br><span class=\"line\">        &lt;Profile </span><br><span class=\"line\">          id=<span class=\"string\">'JavaScript'</span></span><br><span class=\"line\">          loading=&#123;<span class=\"literal\">true</span>&#125; </span><br><span class=\"line\">          repos=&#123;[]&#125;</span><br><span class=\"line\">          authed=&#123;<span class=\"literal\">true</span>&#125;</span><br><span class=\"line\">          theme=<span class=\"string\">'dark'</span></span><br><span class=\"line\">          hovering=&#123;<span class=\"literal\">false</span>&#125;</span><br><span class=\"line\">        /&gt;</span><br><span class=\"line\">      &lt;<span class=\"regexp\">/WithRepos&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;/</span>WithAuth&gt;</span><br><span class=\"line\">  &lt;WithTheme&gt;</span><br><span class=\"line\">&lt;<span class=\"regexp\">/WithHover&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>è€Œä¸”æ¯ä¸ªé«˜é˜¶ç»„ä»¶çš„é€»è¾‘å¤ç”¨æˆ‘ä»¬å¯èƒ½è¿˜è¦ä¸€ä¸ªä¸ªå»ç ”è¯»ã€‚</p>\n<h3 id=\"å¤æ‚ç»„ä»¶å˜å¾—éš¾ä»¥ç†è§£\"><a href=\"#å¤æ‚ç»„ä»¶å˜å¾—éš¾ä»¥ç†è§£\" class=\"headerlink\" title=\"å¤æ‚ç»„ä»¶å˜å¾—éš¾ä»¥ç†è§£\"></a>å¤æ‚ç»„ä»¶å˜å¾—éš¾ä»¥ç†è§£</h3><p>å…¶å®ï¼Œè¿™ç‚¹éå¸¸å¥½ç†è§£ã€‚ä¸¾ä¸€ä¸ªéå¸¸ç®€å•å¸¸è§çš„ä¾‹å­å¤§å®¶å°±ä¼šæ˜ç™½äº†ã€‚</p>\n<p>åœºæ™¯ï¼šå‡å¦‚æˆ‘æœ‰ä¸€ä¸ªå­ç»„ä»¶Childï¼Œä»–çš„åŠŸèƒ½æ˜¯è¿™æ ·çš„ï¼šçˆ¶ç»„å»ºä¼šç»™ä¸€ä¸ªidï¼Œåœ¨ç»„ä»¶åˆ›å»ºçš„æ—¶å€™è·å–ä¸€ä¸‹æœ‰å…³ä¿¡æ¯ï¼Œåœ¨idæ”¹å˜çš„æ—¶å€™å†é‡æ–°è·å–ã€‚</p>\n<h4 id=\"Classç»„ä»¶-1\"><a href=\"#Classç»„ä»¶-1\" class=\"headerlink\" title=\"Classç»„ä»¶\"></a>Classç»„ä»¶</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">componentDidMount () &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.fetch(<span class=\"keyword\">this</span>.props.id)</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\">componentDidUpdate (prevProps) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (prevProps.id !== <span class=\"keyword\">this</span>.props.id) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.fetch(<span class=\"keyword\">this</span>.props.id)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">fetch = <span class=\"function\"><span class=\"params\">id</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.setState(&#123; <span class=\"attr\">loading</span>: <span class=\"literal\">true</span> &#125;)</span><br><span class=\"line\">  fetchInfo(id)</span><br><span class=\"line\">    .then(<span class=\"function\"><span class=\"params\">info</span> =&gt;</span> <span class=\"keyword\">this</span>.setState(&#123;</span><br><span class=\"line\">    info,</span><br><span class=\"line\">    loading: <span class=\"literal\">false</span></span><br><span class=\"line\">  &#125;))</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"React-Hookï¼š\"><a href=\"#React-Hookï¼š\" class=\"headerlink\" title=\"React Hookï¼š\"></a>React Hookï¼š</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fetch = <span class=\"function\"><span class=\"params\">id</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.setState(&#123; <span class=\"attr\">loading</span>: <span class=\"literal\">true</span> &#125;)</span><br><span class=\"line\">  fetchInfo(id)</span><br><span class=\"line\">    .then(<span class=\"function\"><span class=\"params\">info</span> =&gt;</span> <span class=\"keyword\">this</span>.setState(&#123;</span><br><span class=\"line\">    info,</span><br><span class=\"line\">    loading: <span class=\"literal\">false</span></span><br><span class=\"line\">  &#125;))</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">useEffect(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">  fetch(<span class=\"keyword\">this</span>.props.id)</span><br><span class=\"line\">&#125;, [<span class=\"keyword\">this</span>.props.id])</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"ç»“è®º\"><a href=\"#ç»“è®º\" class=\"headerlink\" title=\"ç»“è®º\"></a>ç»“è®º</h3><p>ç®€å•çš„è¯´ä¸€ä¸‹ä»–çš„ä¼˜ç‚¹å§ã€‚</p>\n<ol>\n<li>å¤ç”¨ä»£ç æ›´åŠ ç®€å•ï¼ˆéœ€è¦ä»€ä¹ˆå°±â€œé’©â€è¿›æ¥ï¼‰</li>\n<li>æ¸…çˆ½çš„ä»£ç é£æ ¼ï¼Œä¸€ç›®äº†ç„¶ã€‚ï¼ˆuseStateæ”¯æŒæ•°ç»„å’Œå¯¹è±¡ï¼Œå¯ä»¥æ¸…æ™°çš„å®šä¹‰ç‰¹æ®Šçš„å­—æ®µç­‰ç­‰ï¼‰</li>\n<li>ä»£ç é‡æ›´å°‘ï¼ˆå¯ä»¥çœ‹ä¸€ä¸‹æˆ‘ä¹‹å‰çš„å­çˆ¶ç»„å»ºçš„ä¾‹å­ï¼‰</li>\n<li>æ›´æ„¿æ„å»å†™ä¸€äº›å°ç»„ä»¶å¤ç”¨ï¼ˆæˆ‘ä¸ªäººå–œæ¬¢Reactå°±æ˜¯å› ä¸ºä»–çš„ç»„ä»¶å†™èµ·æ¥éå¸¸çš„é¡ºæ‰‹ï¼psï¼šæ²¡æœ‰è´¬ä½å…¶ä»–æ¡†æ¶çš„æ„æ€ã€‚ã€‚ï¼‰</li>\n<li>å…¶å®æˆ‘ä¸ªäººè®¤ä¸ºReact Hookåœ¨å®£æ‰¬ä¸€ä¸ªè§‚å¿µâ€œæŒ‰éœ€åŠ è½½â€ã€‚</li>\n</ol>\n<h2 id=\"useState\"><a href=\"#useState\" class=\"headerlink\" title=\"useState\"></a>useState</h2><h3 id=\"ä½¿ç”¨\"><a href=\"#ä½¿ç”¨\" class=\"headerlink\" title=\"ä½¿ç”¨\"></a>ä½¿ç”¨</h3><p>ç®€å•çš„ä½¿ç”¨åœ¨ä¸Šé¢çš„æ¢ç©¶-Howé‡Œé¢æœ‰ä»‹ç»ï¼Œæ›´å¤šçš„åœ¨Reactå®˜ç½‘ä¹Ÿæœ‰ä»‹ç»ã€‚</p>\n<h4 id=\"è¯·å›ç­”ä»¥ä¸‹ä»£ç çš„è¿è¡Œç»“æœ\"><a href=\"#è¯·å›ç­”ä»¥ä¸‹ä»£ç çš„è¿è¡Œç»“æœ\" class=\"headerlink\" title=\"è¯·å›ç­”ä»¥ä¸‹ä»£ç çš„è¿è¡Œç»“æœ\"></a>è¯·å›ç­”ä»¥ä¸‹ä»£ç çš„è¿è¡Œç»“æœ</h4><p><img src=\"/\" class=\"lazyload\" data-src=\"https://overreacted.io/46c55d5f1f749462b7a173f1e748e41e/counter.gif\"  alt=\"\"></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Counter</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [count, setCount] = useState(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleAlertClick</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      alert(<span class=\"string\">'You clicked on: '</span> + count);</span><br><span class=\"line\">    &#125;, <span class=\"number\">3000</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    &lt;div&gt;</span><br><span class=\"line\">      &lt;p&gt;You clicked &#123;count&#125; times&lt;<span class=\"regexp\">/p&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        Click me</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;/</span>button&gt;</span><br><span class=\"line\">      &lt;button onClick=&#123;handleAlertClick&#125;&gt;</span><br><span class=\"line\">        Show alert</span><br><span class=\"line\">      &lt;<span class=\"regexp\">/button&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;/</span>div&gt;</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä½ çŒœalertä¼šå¼¹å‡ºä»€ä¹ˆå‘¢ï¼Ÿä¼šæ˜¯5å—ï¼Ÿâ€” è¿™ä¸ªå€¼æ˜¯alertçš„æ—¶å€™counterçš„å®æ—¶çŠ¶æ€ã€‚æˆ–è€…ä¼šæ˜¯3å—ï¼Ÿâ€” è¿™ä¸ªå€¼æ˜¯æˆ‘ç‚¹å‡»æ—¶å€™çš„çŠ¶æ€ã€‚</p>\n<blockquote>\n<p>åˆ†å‰²çº¿</p>\n</blockquote>\n<p>æ¥è‡ªå·± <a href=\"https://codesandbox.io/s/w2wxl3yo0l\" target=\"_blank\" rel=\"noopener\">è¯•è¯•å§ï¼</a></p>\n<h4 id=\"ç­”æ¡ˆæ˜¯\"><a href=\"#ç­”æ¡ˆæ˜¯\" class=\"headerlink\" title=\"ç­”æ¡ˆæ˜¯\"></a>ç­”æ¡ˆæ˜¯</h4><p>3</p>\n<p>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿfunctionç»„å»ºç©¶ç«Ÿæ˜¯å¦‚æœå·¥ä½œçš„å‘¢ï¼Ÿ</p>\n<p>æˆ‘ä»¬å‘ç°<code>count</code>åœ¨æ¯ä¸€æ¬¡å‡½æ•°è°ƒç”¨ä¸­éƒ½æ˜¯ä¸€ä¸ªå¸¸é‡å€¼ã€‚å€¼å¾—å¼ºè°ƒçš„æ˜¯ â€” <strong>æˆ‘ä»¬çš„ç»„ä»¶å‡½æ•°æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šè¢«è°ƒç”¨ï¼Œä½†æ˜¯æ¯ä¸€æ¬¡è°ƒç”¨ä¸­<code>count</code>å€¼éƒ½æ˜¯å¸¸é‡ï¼Œå¹¶ä¸”å®ƒè¢«èµ‹äºˆäº†å½“å‰æ¸²æŸ“ä¸­çš„çŠ¶æ€å€¼ã€‚</strong></p>\n<p>è¿™å¹¶ä¸æ˜¯Reactç‰¹æœ‰çš„ï¼Œæ™®é€šçš„å‡½æ•°ä¹Ÿæœ‰ç±»ä¼¼çš„è¡Œä¸ºï¼š</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sayHi</span>(<span class=\"params\">person</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> name = person.name;  setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    alert(<span class=\"string\">'Hello, '</span> + name);</span><br><span class=\"line\">  &#125;, <span class=\"number\">3000</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> someone = &#123;<span class=\"attr\">name</span>: <span class=\"string\">'Dan'</span>&#125;;</span><br><span class=\"line\">sayHi(someone);</span><br><span class=\"line\"></span><br><span class=\"line\">someone = &#123;<span class=\"attr\">name</span>: <span class=\"string\">'Yuzhi'</span>&#125;;</span><br><span class=\"line\">sayHi(someone);</span><br><span class=\"line\"></span><br><span class=\"line\">someone = &#123;<span class=\"attr\">name</span>: <span class=\"string\">'Dominic'</span>&#125;;</span><br><span class=\"line\">sayHi(someone);</span><br></pre></td></tr></table></figure>\n\n<p>åœ¨ <a href=\"https://codesandbox.io/s/mm6ww11lk8\" target=\"_blank\" rel=\"noopener\">è¿™ä¸ªä¾‹å­</a>ä¸­, å¤–å±‚çš„<code>someone</code>ä¼šè¢«èµ‹å€¼å¾ˆå¤šæ¬¡ï¼ˆå°±åƒåœ¨Reactä¸­ï¼Œ<em>å½“å‰</em>çš„ç»„ä»¶çŠ¶æ€ä¼šæ”¹å˜ä¸€æ ·ï¼‰ã€‚<strong>ç„¶åï¼Œåœ¨<code>sayHi</code>å‡½æ•°ä¸­ï¼Œå±€éƒ¨å¸¸é‡<code>name</code>ä¼šå’ŒæŸæ¬¡è°ƒç”¨ä¸­çš„<code>person</code>å…³è”ã€‚</strong>å› ä¸ºè¿™ä¸ªå¸¸é‡æ˜¯å±€éƒ¨çš„ï¼Œæ‰€ä»¥æ¯ä¸€æ¬¡è°ƒç”¨éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚ç»“æœå°±æ˜¯ï¼Œå½“å®šæ—¶å™¨å›è°ƒè§¦å‘çš„æ—¶å€™ï¼Œæ¯ä¸€ä¸ªalertéƒ½ä¼šå¼¹å‡ºå®ƒæ‹¥æœ‰çš„<code>name</code>ã€‚</p>\n<p>è¿™å°±è§£é‡Šäº†æˆ‘ä»¬çš„äº‹ä»¶å¤„ç†å‡½æ•°å¦‚ä½•æ•è·äº†ç‚¹å‡»æ—¶å€™çš„<code>count</code>å€¼ã€‚å¦‚æœæˆ‘ä»¬åº”ç”¨ç›¸åŒçš„æ›¿æ¢åŸç†ï¼Œæ¯ä¸€æ¬¡æ¸²æŸ“â€œçœ‹åˆ°â€çš„æ˜¯å®ƒè‡ªå·±çš„<code>count</code>ï¼š</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// During first render</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Counter</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> count = <span class=\"number\">0</span>; <span class=\"comment\">// Returned by useState()  // ...</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleAlertClick</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      alert(<span class=\"string\">'You clicked on: '</span> + count);</span><br><span class=\"line\">    &#125;, <span class=\"number\">3000</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// After a click, our function is called again</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Counter</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> count = <span class=\"number\">1</span>; <span class=\"comment\">// Returned by useState()  // ...</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleAlertClick</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      alert(<span class=\"string\">'You clicked on: '</span> + count);</span><br><span class=\"line\">    &#125;, <span class=\"number\">3000</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// After another click, our function is called again</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Counter</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> count = <span class=\"number\">2</span>; <span class=\"comment\">// Returned by useState()  // ...</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleAlertClick</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      alert(<span class=\"string\">'You clicked on: '</span> + count);</span><br><span class=\"line\">    &#125;, <span class=\"number\">3000</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æ‰€ä»¥å®é™…ä¸Šï¼Œæ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰ä¸€ä¸ªâ€œæ–°ç‰ˆæœ¬â€çš„<code>handleAlertClick</code>ã€‚æ¯ä¸€ä¸ªç‰ˆæœ¬çš„<code>handleAlertClick</code>â€œè®°ä½â€ äº†å®ƒè‡ªå·±çš„ <code>count</code>ï¼š</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// During first render</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Counter</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleAlertClick</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      alert(<span class=\"string\">'You clicked on: '</span> + <span class=\"number\">0</span>);    &#125;, <span class=\"number\">3000</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">  &lt;button onClick=&#123;handleAlertClick&#125; /&gt; <span class=\"comment\">// The one with 0 inside  // ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// After a click, our function is called again</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Counter</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleAlertClick</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      alert(<span class=\"string\">'You clicked on: '</span> + <span class=\"number\">1</span>);    &#125;, <span class=\"number\">3000</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">  &lt;button onClick=&#123;handleAlertClick&#125; /&gt; <span class=\"comment\">// The one with 1 inside  // ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// After another click, our function is called again</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Counter</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleAlertClick</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      alert(<span class=\"string\">'You clicked on: '</span> + <span class=\"number\">2</span>);    &#125;, <span class=\"number\">3000</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">  &lt;button onClick=&#123;handleAlertClick&#125; /&gt; <span class=\"comment\">// The one with 2 inside  // ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ<a href=\"https://codesandbox.io/s/w2wxl3yo0l\" target=\"_blank\" rel=\"noopener\">åœ¨è¿™ä¸ªdemoä¸­</a>ä¸­ï¼Œäº‹ä»¶å¤„ç†å‡½æ•°â€œå±äºâ€æŸä¸€æ¬¡ç‰¹å®šçš„æ¸²æŸ“ï¼Œå½“ä½ ç‚¹å‡»çš„æ—¶å€™ï¼Œå®ƒä¼šä½¿ç”¨é‚£æ¬¡æ¸²æŸ“ä¸­<code>counter</code>çš„çŠ¶æ€å€¼ã€‚</p>\n<p><strong>åœ¨ä»»æ„ä¸€æ¬¡æ¸²æŸ“ä¸­ï¼Œpropså’Œstateæ˜¯å§‹ç»ˆä¿æŒä¸å˜çš„ã€‚</strong>å¦‚æœpropså’Œstateåœ¨ä¸åŒçš„æ¸²æŸ“ä¸­æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œé‚£ä¹ˆä½¿ç”¨åˆ°å®ƒä»¬çš„ä»»ä½•å€¼ä¹Ÿæ˜¯ç‹¬ç«‹çš„ï¼ˆåŒ…æ‹¬äº‹ä»¶å¤„ç†å‡½æ•°ï¼‰ã€‚å®ƒä»¬éƒ½â€œå±äºâ€ä¸€æ¬¡ç‰¹å®šçš„æ¸²æŸ“ã€‚å³ä¾¿æ˜¯äº‹ä»¶å¤„ç†ä¸­çš„å¼‚æ­¥å‡½æ•°è°ƒç”¨â€œçœ‹åˆ°â€çš„ä¹Ÿæ˜¯è¿™æ¬¡æ¸²æŸ“ä¸­çš„<code>count</code>å€¼ã€‚</p>\n<h4 id=\"è¯·å›ç­”ä»¥ä¸‹ä»£ç çš„è¿è¡Œç»“æœ-1\"><a href=\"#è¯·å›ç­”ä»¥ä¸‹ä»£ç çš„è¿è¡Œç»“æœ-1\" class=\"headerlink\" title=\"è¯·å›ç­”ä»¥ä¸‹ä»£ç çš„è¿è¡Œç»“æœ\"></a>è¯·å›ç­”ä»¥ä¸‹ä»£ç çš„è¿è¡Œç»“æœ</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Counter</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [count, setCount] = useState(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> addCount = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    setCount(count+<span class=\"number\">1</span>)</span><br><span class=\"line\">    setCount(count+<span class=\"number\">2</span>)</span><br><span class=\"line\">    setCount(count+<span class=\"number\">3</span>)</span><br><span class=\"line\">    setCount(count+<span class=\"number\">4</span>)</span><br><span class=\"line\">    setCount(count+<span class=\"number\">5</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(count)</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    &lt;div&gt;</span><br><span class=\"line\">      &lt;button onClick=&#123;addCount&#125;&gt;</span><br><span class=\"line\">        Click me</span><br><span class=\"line\">      &lt;<span class=\"regexp\">/button&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;/</span>div&gt;</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>åˆ†å‰²çº¿</p>\n</blockquote>\n<h4 id=\"ç­”æ¡ˆæ˜¯-1\"><a href=\"#ç­”æ¡ˆæ˜¯-1\" class=\"headerlink\" title=\"ç­”æ¡ˆæ˜¯\"></a>ç­”æ¡ˆæ˜¯</h4><p>5</p>\n<p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>\n<p>useStateçš„æ›´æ–°ç©¶ç«Ÿæ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿ</p>\n<p>æˆ‘ä»¬è¿›å…¥<code>ReactHooks.js</code>æ¥çœ‹çœ‹ï¼Œå‘ç°<code>useState</code>çš„å®ç°ç«Ÿç„¶å¼‚å¸¸ç®€å•ï¼Œåªæœ‰çŸ­çŸ­ä¸¤è¡Œ</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ReactHooks.js</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">useState</span>&lt;<span class=\"title\">S</span>&gt;(<span class=\"params\">initialState: ((</span>) =&gt; <span class=\"title\">S</span>) | <span class=\"title\">S</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> dispatcher = resolveDispatcher();</span><br><span class=\"line\">  <span class=\"keyword\">return</span> dispatcher.useState(initialState);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å…¶å®å¯ä»¥è¿™æ ·ç†è§£useStateï¼ŒuseStateå…¶å®å°±æ˜¯useReducerçš„ä¸€ä¸ªè¯­æ³•ç³–ï¼›ä½†æ˜¯è¿™ä¸ªä¸åœ¨è¿™ä¸ªé—®é¢˜çš„è®¨è®ºèŒƒå›´å†…ï¼›</p>\n<p>å¥½ï¼Œæ”¶å›æ¥ã€‚</p>\n<p>å…¶å®æˆ‘ä»¬åœ¨<code>const [xx, setXx] = useState(xx)</code>çš„æ—¶å€™å°±ç”Ÿæˆä¸€ä¸ªé˜Ÿåˆ—ï¼Œæˆ‘ä»¬æš‚æ—¶å«å®ƒä¸ºqueueï¼›æ‰€æœ‰è¿™ä¸€è½®è¿è¡Œè¯»å–åˆ°çš„stateéƒ½è¢«æ”¾åˆ°ä¸€ä¸ªé“¾è¡¨çš„é˜Ÿåˆ—é‡Œé¢å»ï¼Œç„¶åå†ç”¨do-whileå¾ªç¯ï¼Œæ¯æ¬¡éƒ½æ˜¯æ‹¿åˆ°æœ€æ–°çš„å€¼ï¼Œä½†æ˜¯ä¸æ˜¯Object.assginçš„å½¢å¼ï¼Œè€Œæ˜¯ç›´æ¥èµ‹å€¼ã€‚è¯ä¸å¤šè¯´ç›´æ¥æºç ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">updateReducer</span>(<span class=\"params\">reducer, initialArg, init</span>) </span>&#123;</span><br><span class=\"line\"><span class=\"comment\">// è·å–åˆå§‹åŒ–æ—¶çš„ hook</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> hook = updateWorkInProgressHook();</span><br><span class=\"line\">  <span class=\"keyword\">const</span> queue = hook.queue;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// å¼€å§‹æ¸²æŸ“æ›´æ–°</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (numberOfReRenders &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> dispatch = queue.dispatch;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (renderPhaseUpdates !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// è·å–Hookå¯¹è±¡ä¸Šçš„ queueï¼Œå†…éƒ¨å­˜æœ‰æœ¬æ¬¡æ›´æ–°çš„ä¸€ç³»åˆ—æ•°æ®</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> firstRenderPhaseUpdate = renderPhaseUpdates.get(queue);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (firstRenderPhaseUpdate !== <span class=\"literal\">undefined</span>) &#123;</span><br><span class=\"line\">        renderPhaseUpdates.delete(queue);</span><br><span class=\"line\">        <span class=\"keyword\">let</span> newState = hook.memoizedState;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> update = firstRenderPhaseUpdate;</span><br><span class=\"line\">        <span class=\"comment\">// è·å–æ›´æ–°åçš„state</span></span><br><span class=\"line\">        <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">const</span> action = update.action;</span><br><span class=\"line\">          <span class=\"comment\">// æ­¤æ—¶çš„reduceræ˜¯basicStateReducerï¼Œç›´æ¥è¿”å›actionçš„å€¼</span></span><br><span class=\"line\">          <span class=\"comment\">// æ³¨æ„ï¼Œè¿™é‡Œæ˜¯ç­‰äºå·æ‰€ä»¥</span></span><br><span class=\"line\">          <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">          *</span></span><br><span class=\"line\"><span class=\"comment\">          * setObj(&#123; a: 1, b: 1, c: 1 &#125;)</span></span><br><span class=\"line\"><span class=\"comment\">        \t* setObj(&#123; a: 2, b: 2 &#125;)</span></span><br><span class=\"line\"><span class=\"comment\">        \t* setObj(&#123; a: 3 &#125;)</span></span><br><span class=\"line\"><span class=\"comment\">        \t*</span></span><br><span class=\"line\"><span class=\"comment\">        \t* åˆ°æœ€åä¹Ÿåªæœ‰åªæœ‰&#123; a: 3 &#125;ï¼Œè€Œbå’Œcå…¨æ²¡äº†</span></span><br><span class=\"line\"><span class=\"comment\">          *</span></span><br><span class=\"line\"><span class=\"comment\">          **/</span></span><br><span class=\"line\">          newState = reducer(newState, action);</span><br><span class=\"line\">          update = update.next;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">while</span> (update !== <span class=\"literal\">null</span>);</span><br><span class=\"line\">        <span class=\"comment\">// å¯¹ æ›´æ–°hook.memoized </span></span><br><span class=\"line\">        hook.memoizedState = newState;</span><br><span class=\"line\">        <span class=\"comment\">// è¿”å›æ–°çš„ stateï¼ŒåŠæ›´æ–° hook çš„ dispatch æ–¹æ³•</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> [newState, dispatch];</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"useEffect-useLayoutEffect\"><a href=\"#useEffect-useLayoutEffect\" class=\"headerlink\" title=\"useEffect/useLayoutEffect\"></a>useEffect/useLayoutEffect</h2><h3 id=\"æç¤º\"><a href=\"#æç¤º\" class=\"headerlink\" title=\"æç¤º\"></a>æç¤º</h3><p>åœ¨å­¦ä¹ useEffectè¿™ä¸ªHookçš„æ—¶å€™ï¼Œæ·¡åŒ–ä½ çŸ¥é“çš„â€œç”Ÿå‘½å‘¨æœŸâ€è¿™ä¸ªæ¦‚å¿µã€‚</p>\n<h4 id=\"useEffectå’ŒuseLayoutEffectä¸¤å…„å¼Ÿçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ\"><a href=\"#useEffectå’ŒuseLayoutEffectä¸¤å…„å¼Ÿçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ\" class=\"headerlink\" title=\"useEffectå’ŒuseLayoutEffectä¸¤å…„å¼Ÿçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ\"></a>useEffectå’ŒuseLayoutEffectä¸¤å…„å¼Ÿçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>æ‰§è¡Œçš„æ—¶æœºä¸åŒ</p>\n<p>é‚£ä¹ˆå…·ä½“å“ªé‡Œä¸åŒå‘¢ï¼Ÿ</p>\n<p>å…¶å®åœ¨åˆå§‹åŒ–useEffectå’ŒuseLayoutEffectæ˜¯æ²¡æœ‰åŒºåˆ«çš„ï¼Œä»–ä»¬çœŸæ­£çš„åŒºåˆ«åœ¨äºåˆå§‹åŒ–ä¹‹åï¼›</p>\n<p>ä¸¾ä¸ªéå¸¸å½¢è±¡çš„ä¾‹å­ğŸŒ°ï¼š</p>\n<p>é™¤äº†åˆå§‹åŒ–ä¹‹åçš„ä¸€è½®æ›´æ–°ï¼š</p>\n<blockquote>\n<p>æµè§ˆå™¨ï¼šæˆ‘è¦ç»˜åˆ¶äº†ï¼</p>\n<p>Reactï¼šç­‰ç­‰ï¼Œæˆ‘æœ‰ä¸€ä¸ªå“¥ä»¬ä¸´æ—¶æœ‰äº‹è¦å¤„ç†ï¼Œä»–æ˜¯ï¼šuseLayoutEffect</p>\n<p>useLayoutEffectæ‰§è¡Œâ€¦.</p>\n<p>Reactï¼šå¥½äº†ï¼Œä½ å¯ä»¥å¼€å§‹ç»˜åˆ¶äº†ï½@æµè§ˆå™¨</p>\n<p>æµè§ˆå™¨ï¼šå¥½çš„</p>\n<p>æµè§ˆå™¨æ›´æ–°UIâ€¦</p>\n<p>æµè§ˆå™¨ï¼šæˆ‘æ›´æ–°å¥½äº†ã€‚ä½ æœ‰ä»€ä¹ˆäº‹è¦åšçš„å—ï¼Ÿ@React</p>\n<p>Reactï¼šæœ‰çš„ï¼ŒuseEffectä½ ä¸Š</p>\n<p>useEffectæ‰§è¡Œâ€¦.</p>\n</blockquote>\n<p>å¯èƒ½æœ‰ç‚¹åºŸè¯äº†ã€‚å…¶å®åŒºåˆ«å°±æ˜¯</p>\n<blockquote>\n<p>useLayoutEffect()</p>\n<p>æµè§ˆå™¨ç»˜åˆ¶</p>\n<p>useEffect()</p>\n</blockquote>\n<p>è¿™æ ·å…¶å®å¤§å®¶ä¹Ÿèƒ½å¾ˆç›´æ¥çš„çœ‹åˆ°å¼Šç«¯äº†ã€‚é‚£å°±æ˜¯useLayoutEffectå¦‚æœæœ‰å¤§é‡çš„è®¡ç®—çš„è¯ï¼Œé‚£æ ·å¯èƒ½ä¼šé˜»å¡UIæ›´æ–°ï¼Œæˆ–è€…è¯´UIæ¸²æŸ“ã€‚æ‰€ä»¥è¿˜æ˜¯è¦è°¨æ…ä½¿ç”¨ã€‚</p>\n<p>ä¸€èˆ¬æ¥è¯´ä»–ä»¬æ²¡æœ‰ä»€ä¹ˆå¤ªå¤§çš„åŒºåˆ«çš„ï¼Œå¦‚æœçœŸçš„è¦ä½¿ç”¨useLayoutEffectçš„è¯è¦è°¨æ…ä¸€äº›ã€‚ä¸ç„¶å¯èƒ½ä¼šå¯¼è‡´UIæ¸²æŸ“é˜»å¡ä¹‹ç±»çš„é—®é¢˜ã€‚</p>\n<p>ä½†æ˜¯ï¼Œä¹Ÿä¸æ˜¯æ²¡æœ‰ä½¿ç”¨åœºæ™¯ã€‚</p>\n<p>æ¯”å¦‚ä¸‹é¢çš„è¿™ä¸ªä»£ç å°±å¾ˆéœ€è¦useLayoutEffect</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">App</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [count, setCount] = useState(<span class=\"number\">0</span>);</span><br><span class=\"line\">  </span><br><span class=\"line\">  useLayoutEffect(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (count === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> randomNum = <span class=\"number\">10</span> + <span class=\"built_in\">Math</span>.random()*<span class=\"number\">200</span></span><br><span class=\"line\">      setCount(<span class=\"number\">10</span> + <span class=\"built_in\">Math</span>.random()*<span class=\"number\">200</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;, [count]);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;div onClick=&#123;() =&gt; setCount(<span class=\"number\">0</span>)&#125;&gt;&#123;count&#125;&lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  );</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">/</span><span class=\"regexp\">/   æˆ‘æ˜¯åˆ†å‰²çº¿</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">function App() &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">  const [count, setCount] = useState(0);</span></span><br><span class=\"line\"><span class=\"regexp\">  </span></span><br><span class=\"line\"><span class=\"regexp\">  useEffect(() =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">    if (count === 0) &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">      const randomNum = 10 + Math.random()*200</span></span><br><span class=\"line\"><span class=\"regexp\">      setCount(10 + Math.random()*200);</span></span><br><span class=\"line\"><span class=\"regexp\">    &#125;</span></span><br><span class=\"line\"><span class=\"regexp\">  &#125;, [count]);</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">  return (</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;div onClick=&#123;() =&gt; setCount(0)&#125;&gt;&#123;count&#125;&lt;/</span>div&gt;</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å…¶å®æ˜ç™½çš„åŒå­¦ä¸€ä¸‹å°±çœ‹å‡ºæ¥äº†ï¼Œå¦‚æœä½¿ç”¨useEffectçš„è¯ä¼šå‡ºç°é—ªçƒï¼Œä¼šå…ˆå›åˆ°0ç„¶åå†æ›´æ–°æ–°çš„éšæœºæ•°ã€‚è€Œåè§‚useLayoutEffectåˆ™ä¸ä¼šï¼Œä»–ä¼šå¾ˆè‡ªç„¶çš„è¿‡æ¸¡ã€‚</p>\n<p>æ€»ç»“ï¼š</p>\n<p>useLayoutEffectçš„ä½¿ç”¨åœºæ™¯ä¸ºï¼šæœ‰ä¸€ä¸ªä¸­é—´çŠ¶æ€å¸Œæœ›éšè—çš„æ—¶å€™å†ä½¿ç”¨ã€‚</p>\n<p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹useEffectå¯ä»¥é€‚ç”¨äº99%çš„åœºæ™¯ã€‚</p>\n<h4 id=\"useEffectçš„é”™è¯¯äº‹ä¾‹ã€‚çœ‹çœ‹æœ‰æ²¡æœ‰ä½ \"><a href=\"#useEffectçš„é”™è¯¯äº‹ä¾‹ã€‚çœ‹çœ‹æœ‰æ²¡æœ‰ä½ \" class=\"headerlink\" title=\"useEffectçš„é”™è¯¯äº‹ä¾‹ã€‚çœ‹çœ‹æœ‰æ²¡æœ‰ä½ \"></a>useEffectçš„é”™è¯¯äº‹ä¾‹ã€‚çœ‹çœ‹æœ‰æ²¡æœ‰ä½ </h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">SearchResults</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [query, setQuery] = useState(<span class=\"string\">'react'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Imagine this function is also long</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getFetchUrl</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">'https://hn.algolia.com/api/v1/search?query='</span> + query;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Imagine this function is also long</span></span><br><span class=\"line\">  <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fetchData</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> result = <span class=\"keyword\">await</span> axios(getFetchUrl());</span><br><span class=\"line\">    setData(result.data);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  useEffect(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    fetchData();</span><br><span class=\"line\">  &#125;, []);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"ä¸ºä»€ä¹ˆé”™äº†ï¼Ÿ\"><a href=\"#ä¸ºä»€ä¹ˆé”™äº†ï¼Ÿ\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆé”™äº†ï¼Ÿ\"></a>ä¸ºä»€ä¹ˆé”™äº†ï¼Ÿ</h4><p>ä¸éš¾çœ‹å‡ºä¸Šé¢ä»£ç çš„æ„æ€æ˜¯ã€‚æƒ³è¦æ¨¡ä»¿componentDidMountçš„ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨é¡µé¢æˆ–è€…ç»„ä»¶åŠ è½½ä¹‹åå‘é€ä¸€ä¸ªè¯·æ±‚ã€‚å’‹ä¸€çœ‹å¥½åƒæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼ˆå®é™…åœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­ä¹Ÿæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œåœ¨å†™è¿™ç¯‡æ–‡ç« ä¹‹å‰æˆ‘ä¹Ÿæ˜¯è¿™ä¹ˆåšçš„ã€‚ï¼‰</p>\n<p>ä½†æ˜¯å¤§å®¶å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœè¿™ä¸ªå‡½æ•°ç»„ä»¶ï¼Œæ˜¯ç°åœ¨çš„5å€å¤§ï¼Œè¿™ä¸ªdidMounté‡Œé¢è°ƒç”¨çš„è¯·æ±‚ï¼Œæœªæ¥ä¾èµ–çš„ä¸œè¥¿ä½ éƒ½å¯ä»¥100%çš„å¯Ÿè§‰åˆ°å—ï¼Ÿ</p>\n<p>æˆ‘è§‰å¾—éš¾ï¼éš¾å…ä¼šæœ‰ç–å¿½ã€‚åˆ°æ—¶å€™å¯èƒ½å°±ä¼šå‡ºç°stateæˆ–è€…propsè¯»å–é”™è¯¯çš„æƒ…å†µã€‚å› ä¸ºæ¯ä¸€æ¬¡renderçš„stateå’Œpropséƒ½æ˜¯ç‹¬ç«‹çš„ã€‚</p>\n<p>é‚£ä¹ˆï¼Œè¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿ</p>\n<p>æœ‰ä¸€ä¸ªå¾ˆåœŸçš„åŠæ³•ï¼Œç›´æ¥æŠŠå‡½æ•°æ‰”åˆ°useEffecté‡Œé¢å»</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">SearchResults</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">  useEffect(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// We moved these functions inside!    </span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getFetchUrl</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">'https://hn.algolia.com/api/v1/search?query=react'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fetchData</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> result = <span class=\"keyword\">await</span> axios(getFetchUrl());</span><br><span class=\"line\">      setData(result.data);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    fetchData();</span><br><span class=\"line\">  &#125;, []); <span class=\"comment\">// âœ… Deps are OK</span></span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>é‚£é«˜çº§ç‚¹çš„åŠæ³•å‘¢ï¼Ÿ</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">SearchResults</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// âœ… Preserves identity when its own deps are the same</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> getFetchUrl = useCallback(<span class=\"function\">(<span class=\"params\">query</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">'https://hn.algolia.com/api/v1/search?query='</span> + query;</span><br><span class=\"line\">  &#125;, []);  <span class=\"comment\">// âœ… Callback deps are OK</span></span><br><span class=\"line\"></span><br><span class=\"line\">  useEffect(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> url = getFetchUrl(<span class=\"string\">'react'</span>);</span><br><span class=\"line\">    <span class=\"comment\">// ... Fetch data and do something ...</span></span><br><span class=\"line\">  &#125;, [getFetchUrl]); <span class=\"comment\">// âœ… Effect deps are OK</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å°†å‡½æ•°ç”¨useCallbackåŒ…è£¹ï¼Œè¿™æ ·çš„è¯æˆ‘ä»¬åªéœ€è¦åšuseEffectçš„ä¾èµ–é‡Œé¢å†™ä¸Šæˆ‘ä»¬çš„å‡½æ•°ï¼Œç„¶ååœ¨useCallbacké‡Œé¢å†™ä¸Šæˆ‘ä»¬çš„ä¾èµ–ã€‚</p>\n<h4 id=\"æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ¯ä¸€æ¬¡effectéƒ½æ˜¯å…¨æ–°çš„stateå’Œpropsï¼Œé‚£æˆ‘è¦å¦‚ä½•è·å¾—ä¸Šä¸€è½®æ›´æ–°çš„stateå‘¢ï¼Ÿ\"><a href=\"#æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ¯ä¸€æ¬¡effectéƒ½æ˜¯å…¨æ–°çš„stateå’Œpropsï¼Œé‚£æˆ‘è¦å¦‚ä½•è·å¾—ä¸Šä¸€è½®æ›´æ–°çš„stateå‘¢ï¼Ÿ\" class=\"headerlink\" title=\"æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ¯ä¸€æ¬¡effectéƒ½æ˜¯å…¨æ–°çš„stateå’Œpropsï¼Œé‚£æˆ‘è¦å¦‚ä½•è·å¾—ä¸Šä¸€è½®æ›´æ–°çš„stateå‘¢ï¼Ÿ\"></a>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ¯ä¸€æ¬¡effectéƒ½æ˜¯å…¨æ–°çš„stateå’Œpropsï¼Œé‚£æˆ‘è¦å¦‚ä½•è·å¾—ä¸Šä¸€è½®æ›´æ–°çš„stateå‘¢ï¼Ÿ</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Counter</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [count, setCount] = useState(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> prevCountRef = useRef();</span><br><span class=\"line\">  useEffect(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    prevCountRef.current = count;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> prevCount = prevCountRef.current;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Now: &#123;count&#125;, before: &#123;prevCount&#125;<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å…¶å®å¾ˆå¥½ç†è§£ï¼Œå¦‚æœçœ‹äº†å‰é¢useEffectå’ŒuseLayoutEffectåŒºåˆ«çš„åŒå­¦ä¸€ä¸‹å°±å¯ä»¥çŸ¥é“è¿™ä¸ªçš„å®ç°åŸç†ã€‚</p>\n<p>é¦–å…ˆï¼Œåœ¨ä¸€åˆ‡éƒ½æ›´æ–°ä¹‹åï¼Œç„¶åä¼šä¼šæ‰§è¡ŒuseEffectå†…éƒ¨çš„å›è°ƒå‡½æ•°ï¼Œå°†prevCountç»™èµ‹å€¼ï¼Œç”±äºæ²¡æœ‰è§¦å‘æ¸²æŸ“ï¼Œæ‰€ä»¥åªæ˜¯å•çº¯çš„èµ‹å€¼ã€‚è¿™æ ·å°±çœ‹èµ·æ¥prevCountçš„å€¼æ°¸è¿œéƒ½æ…¢ä¸€æ­¥ã€‚</p>\n<h3 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h3><p>å…¶å®åœ¨å­¦ä¹ useEffectçš„æ—¶å€™ã€‚åº”è¯¥å¿˜è®°ä½ å¯¹Reactçš„ä¸€äº›çŸ¥è¯†ã€‚æ¯”å¦‚ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨å‡½æ•°ç»„ä»¶é‡Œé¢æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸè¿™ä¸ªæ¦‚å¿µäº†ã€‚</p>\n<p>æ¯ä¸€æ¬¡çš„renderä»–éƒ½æœ‰è‡ªå·±çš„stateå’Œpropsã€‚stateå’Œpropsæ›´åº”è¯¥è¢«çœ‹ä½œä¸€ä¸ªå¸¸é‡ï¼Œå“ªæ€•æ˜¯const bar = xxè¿™æ ·çš„å¸¸é‡ã€‚è¿™æ ·ç†è§£èµ·æ¥useEffectè¿™ä¸ªå‰¯ä½œç”¨å…¶å®ä¼šæ›´åŠ é¡ºç•…ï¼Œä¹Ÿä¸å®¹æ˜“è¿›å…¥ä»–çš„â€œé™·é˜±â€</p>\n<h2 id=\"useRef\"><a href=\"#useRef\" class=\"headerlink\" title=\"useRef\"></a>useRef</h2><h3 id=\"å‰è¨€-1\"><a href=\"#å‰è¨€-1\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h3><p>ä¸ºä»€ä¹ˆæˆ‘æŠŠuseRefå•ç‹¬æ‹å‡ºæ¥è¯´ï¼Œä¸æŠŠä»–å’Œ<code>useImperativeHandle</code>æ”¾åœ¨ä¸€èµ·è®²ï¼Œå› ä¸º</p>\n<blockquote>\n<p>ï¼ˆå®˜ç½‘åŸè¯ï¼‰å®ƒåˆ›å»ºçš„æ˜¯ä¸€ä¸ªæ™®é€š Javascript å¯¹è±¡ã€‚è€Œ <code>useRef()</code> å’Œè‡ªå»ºä¸€ä¸ª <code>{current: ...}</code> å¯¹è±¡çš„å”¯ä¸€åŒºåˆ«æ˜¯ï¼Œ<code>useRef</code> ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“æ—¶è¿”å›åŒä¸€ä¸ª ref å¯¹è±¡ã€‚</p>\n</blockquote>\n<p>è®°ä½<code>useRef</code>ä¸å•å•ç”¨äºè·å–<code>DOMèŠ‚ç‚¹å’Œç»„ä»¶å®ä¾‹</code>ï¼Œè¿˜æœ‰ä¸€ä¸ªå·§å¦™çš„ç”¨æ³•å°±æ˜¯<code>ä½œä¸ºå®¹å™¨ä¿ç•™å¯å˜å˜é‡</code>ï¼Œå¯ä»¥è¿™æ ·è¯´ï¼š<code>æ— æ³•è‡ªå¦‚åœ°ä½¿ç”¨useRefä¼šè®©ä½ å¤±å»hookå°†è¿‘ä¸€åŠçš„èƒ½åŠ›</code></p>\n<h4 id=\"useRef-ä¸-createRef-çš„åŒºåˆ«\"><a href=\"#useRef-ä¸-createRef-çš„åŒºåˆ«\" class=\"headerlink\" title=\"useRef ä¸ createRef çš„åŒºåˆ«\"></a>useRef ä¸ createRef çš„åŒºåˆ«</h4><p><code>useRef</code> ä»…èƒ½ç”¨åœ¨ FunctionComponentï¼Œ<code>createRef</code> ä»…èƒ½ç”¨åœ¨ ClassComponentã€‚</p>\n<p><code>useRef</code> ä»…èƒ½ç”¨åœ¨ FunctionComponentï¼Œ<code>createRef</code> ä»…èƒ½ç”¨åœ¨ ClassComponentã€‚</p>\n<p>ç¬¬ä¸€å¥è¯æ˜¯æ˜¾ç„¶çš„ï¼Œå› ä¸º Hooks ä¸èƒ½ç”¨åœ¨ ClassComponentã€‚</p>\n<p>ç¬¬äºŒå¥è¯çš„åŸå› æ˜¯ï¼Œ<code>createRef</code> å¹¶æ²¡æœ‰ Hooks çš„æ•ˆæœï¼Œå…¶å€¼ä¼šéšç€ FunctionComponent é‡å¤æ‰§è¡Œè€Œä¸æ–­è¢«åˆå§‹åŒ–ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function App() &#123;</span><br><span class=\"line\">  &#x2F;&#x2F; é”™è¯¯ç”¨æ³•ï¼Œæ°¸è¿œä¹Ÿæ‹¿ä¸åˆ° ref</span><br><span class=\"line\">  const valueRef &#x3D; React.createRef();</span><br><span class=\"line\">  return &lt;div ref&#x3D;&#123;valueRef&#125; &#x2F;&gt;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>\n\n<p>ä¸Šè¿° <code>valueRef</code> ä¼šéšç€ App å‡½æ•°çš„ Render è€Œé‡å¤åˆå§‹åŒ–ï¼Œ<strong>è¿™ä¹Ÿæ˜¯ Hooks çš„ç‹¬ç‰¹ä¹‹å¤„ï¼Œè™½ç„¶ç”¨åœ¨æ™®é€šå‡½æ•°ä¸­ï¼Œä½†åœ¨ React å¼•æ“ä¸­ä¼šå¾—åˆ°è¶…å‡ºæ™®é€šå‡½æ•°çš„è¡¨ç°ï¼Œæ¯”å¦‚åˆå§‹åŒ–ä»…æ‰§è¡Œä¸€æ¬¡ï¼Œæˆ–è€…å¼•ç”¨ä¸å˜</strong>ã€‚</p>\n<p>ä¸ºä»€ä¹ˆ <code>createRef</code> å¯ä»¥åœ¨ ClassComponent æ­£å¸¸è¿è¡Œå‘¢ï¼Ÿè¿™æ˜¯å› ä¸º ClassComponent åˆ†ç¦»äº†ç”Ÿå‘½å‘¨æœŸï¼Œä½¿ä¾‹å¦‚ <code>componentDidMount</code> ç­‰åˆå§‹åŒ–æ—¶æœºä»…æ‰§è¡Œä¸€æ¬¡ã€‚</p>\n<h4 id=\"å¦‚ä½•è§£å†³æ¯æ¬¡renderå¸¦æ¥ç±»é—­åŒ…é—®é¢˜ï¼Ÿ\"><a href=\"#å¦‚ä½•è§£å†³æ¯æ¬¡renderå¸¦æ¥ç±»é—­åŒ…é—®é¢˜ï¼Ÿ\" class=\"headerlink\" title=\"å¦‚ä½•è§£å†³æ¯æ¬¡renderå¸¦æ¥ç±»é—­åŒ…é—®é¢˜ï¼Ÿ\"></a>å¦‚ä½•è§£å†³æ¯æ¬¡renderå¸¦æ¥ç±»é—­åŒ…é—®é¢˜ï¼Ÿ</h4><p>é¦–å…ˆï¼Œé¢˜ç›®æ€ä¹ˆç†è§£ï¼Ÿ<a href=\"https://codesandbox.io/s/w2wxl3yo0l\" target=\"_blank\" rel=\"noopener\">é¢˜ç›®</a></p>\n<p>å¦‚æœæˆ‘ä»¬å¸Œæœ›ä»–alertçš„æ—¶å€™å¯ä»¥è·å–åˆ°æœ€æ–°çš„å€¼çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨useRefæ¥è§£å†³</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> Counter = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [count, setCount] = useState&lt;number&gt;(<span class=\"number\">0</span>)</span><br><span class=\"line\">  <span class=\"keyword\">const</span> countRef = useRef&lt;number&gt;(count)</span><br><span class=\"line\"></span><br><span class=\"line\">  useEffect(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    countRef.current = count</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> handleCount = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      alert(<span class=\"string\">'current count: '</span> + countRef.current)</span><br><span class=\"line\">    &#125;, <span class=\"number\">3000</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> Counter</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"memo\"><a href=\"#memo\" class=\"headerlink\" title=\"memo\"></a>memo</h2><h4 id=\"memoæ²¡æœ‰å›è°ƒå‡½æ•°çš„è¯æ˜¯æ€ä¹ˆæµ…æ¯”è¾ƒçš„ï¼Ÿ\"><a href=\"#memoæ²¡æœ‰å›è°ƒå‡½æ•°çš„è¯æ˜¯æ€ä¹ˆæµ…æ¯”è¾ƒçš„ï¼Ÿ\" class=\"headerlink\" title=\"memoæ²¡æœ‰å›è°ƒå‡½æ•°çš„è¯æ˜¯æ€ä¹ˆæµ…æ¯”è¾ƒçš„ï¼Ÿ\"></a>memoæ²¡æœ‰å›è°ƒå‡½æ•°çš„è¯æ˜¯æ€ä¹ˆæµ…æ¯”è¾ƒçš„ï¼Ÿ</h4><p>å…ˆæ¥çœ‹çœ‹memoæ²¡æœ‰å›è°ƒå‡½æ•°çš„æ—¶å€™ä»–åšäº†ä»€ä¹ˆã€‚</p>\n<p>memoå®ƒæ˜¯ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰ä»–ä¸React.PureComponentååˆ†ç›¸ä¼¼ã€‚é™¤äº†ä½¿ç”¨çš„åœ°æ–¹ä¸åŒï¼ˆClassç»„ä»¶å’ŒFunctionç»„ä»¶ï¼‰ä¹‹å¤–å‡ ä¹ä¸€è‡´ã€‚</p>\n<p>Memoå†…éƒ¨å’ŒPureComponentä¸€æ ·ä½¿ç”¨Object.isç”¨äºå‰å¯¹æ¯”ï¼Œå¦‚æœä¼ å…¥çš„propså†…å­˜åœ°å€ä¸å˜çš„è¯ï¼Œé‚£å°±ä¸ä¼šæ¸²æŸ“äº†ï¼ˆæˆ–è€…è¯´å¤ç”¨æœ€è¿‘çš„ä¸€æ¬¡æ¸²æŸ“ï¼‰ã€‚</p>\n<p>ä¸‹é¢å¯ä»¥çœ‹æºç äº‹ä¾‹</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">updateMemoComponent</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  current: Fiber | null,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  workInProgress: Fiber,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  Component: any,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  nextProps: any,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  updateExpirationTime,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  renderExpirationTime: ExpirationTime,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\"></span>): <span class=\"title\">null</span> | <span class=\"title\">Fiber</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/* ...çœç•¥...*/</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// åˆ¤æ–­æ›´æ–°çš„è¿‡æœŸæ—¶é—´æ˜¯å¦å°äºæ¸²æŸ“çš„è¿‡æœŸæ—¶é—´</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (updateExpirationTime &lt; renderExpirationTime) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> prevProps = currentChild.memoizedProps;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœè‡ªå®šä¹‰äº†compareå‡½æ•°ï¼Œåˆ™é‡‡ç”¨è‡ªå®šä¹‰çš„compareå‡½æ•°ï¼Œå¦åˆ™é‡‡ç”¨å®˜æ–¹çš„shallowEqual(æµ…æ¯”è¾ƒ)å‡½æ•°ã€‚ï¼ˆä¸‹é¢æœ‰è§£æï¼‰</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> compare = Component.compare;</span><br><span class=\"line\">    compare = compare !== <span class=\"literal\">null</span> ? compare : shallowEqual;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 1. åˆ¤æ–­å½“å‰ props ä¸ nextProps æ˜¯å¦ç›¸ç­‰ï¼›</span></span><br><span class=\"line\"><span class=\"comment\">     * 2. åˆ¤æ–­å³å°†æ¸²æŸ“ç»„ä»¶çš„å¼•ç”¨æ˜¯å¦ä¸workInProgress Fiberä¸­çš„å¼•ç”¨æ˜¯å¦ä¸€è‡´ï¼›</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * åªæœ‰ä¸¤è€…éƒ½ä¸ºçœŸï¼Œæ‰ä¼šé€€å‡ºæ¸²æŸ“ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (compare(prevProps, nextProps) &amp;&amp; current.ref === workInProgress.ref) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å¦‚æœéƒ½ä¸ºçœŸï¼Œåˆ™é€€å‡ºæ¸²æŸ“</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> bailoutOnAlreadyFinishedWork(</span><br><span class=\"line\">        current,</span><br><span class=\"line\">        workInProgress,</span><br><span class=\"line\">        renderExpirationTime,</span><br><span class=\"line\">      );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/* ...çœç•¥...*/</span></span><br></pre></td></tr></table></figure>\n\n<p>shallowEqualï¼ˆæµ…æ¯”è¾ƒï¼‰</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ç”¨åŸå‹é“¾çš„æ–¹æ³•</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> hasOwn = <span class=\"built_in\">Object</span>.prototype.hasOwnProperty</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è¿™ä¸ªå‡½æ•°å®é™…ä¸Šæ˜¯Object.is()çš„polyfill</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">is</span>(<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (x === y) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x !== <span class=\"number\">0</span> || y !== <span class=\"number\">0</span> || <span class=\"number\">1</span> / x === <span class=\"number\">1</span> / y</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x !== x &amp;&amp; y !== y</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">shallowEqual</span>(<span class=\"params\">objA, objB</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// é¦–å…ˆå¯¹åŸºæœ¬æ•°æ®ç±»å‹çš„æ¯”è¾ƒ</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (is(objA, objB)) <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"comment\">// ç”±äºObejct.is()å¯ä»¥å¯¹åŸºæœ¬æ•°æ®ç±»å‹åšä¸€ä¸ªç²¾ç¡®çš„æ¯”è¾ƒï¼Œ æ‰€ä»¥å¦‚æœä¸ç­‰</span></span><br><span class=\"line\">  <span class=\"comment\">// åªæœ‰ä¸€ç§æƒ…å†µæ˜¯è¯¯åˆ¤çš„ï¼Œé‚£å°±æ˜¯object,æ‰€ä»¥åœ¨åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡éƒ½ä¸æ˜¯object</span></span><br><span class=\"line\">  <span class=\"comment\">// ä¹‹åï¼Œå°±å¯ä»¥è¿”å›falseäº†</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> objA !== <span class=\"string\">'object'</span> || objA === <span class=\"literal\">null</span> ||</span><br><span class=\"line\">      <span class=\"keyword\">typeof</span> objB !== <span class=\"string\">'object'</span> || objB === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// è¿‡æ»¤æ‰åŸºæœ¬æ•°æ®ç±»å‹ä¹‹åï¼Œå°±æ˜¯å¯¹å¯¹è±¡çš„æ¯”è¾ƒäº†</span></span><br><span class=\"line\">  <span class=\"comment\">// é¦–å…ˆæ‹¿å‡ºkeyå€¼ï¼Œå¯¹keyçš„é•¿åº¦è¿›è¡Œå¯¹æ¯”</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> keysA = <span class=\"built_in\">Object</span>.keys(objA)</span><br><span class=\"line\">  <span class=\"keyword\">const</span> keysB = <span class=\"built_in\">Object</span>.keys(objB)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// é•¿åº¦ä¸ç­‰ç›´æ¥è¿”å›false</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (keysA.length !== keysB.length) <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"comment\">// keyç›¸ç­‰çš„æƒ…å†µä¸‹ï¼Œåœ¨å»å¾ªç¯æ¯”è¾ƒ</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; keysA.length; i++) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// keyå€¼ç›¸ç­‰çš„æ—¶å€™</span></span><br><span class=\"line\">  <span class=\"comment\">// å€Ÿç”¨åŸå‹é“¾ä¸ŠçœŸæ­£çš„ hasOwnProperty æ–¹æ³•ï¼Œåˆ¤æ–­ObjBé‡Œé¢æ˜¯å¦æœ‰Açš„keyçš„keyå€¼</span></span><br><span class=\"line\">  <span class=\"comment\">// å±æ€§çš„é¡ºåºä¸å½±å“ç»“æœä¹Ÿå°±æ˜¯&#123;name:'daisy', age:'24'&#125; è·Ÿ&#123;age:'24'ï¼Œname:'daisy' &#125;æ˜¯ä¸€æ ·çš„</span></span><br><span class=\"line\">  <span class=\"comment\">// æœ€åï¼Œå¯¹å¯¹è±¡çš„valueè¿›è¡Œä¸€ä¸ªåŸºæœ¬æ•°æ®ç±»å‹çš„æ¯”è¾ƒï¼Œè¿”å›ç»“æœ</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!hasOwn.call(objB, keysA[i]) ||</span><br><span class=\"line\">        !is(objA[keysA[i]], objB[keysA[i]])) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> truea</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ç”±æºç å¯ä»¥çŸ¥é“ï¼ŒåŠ å…¥æ²¡æœ‰ä¼ ä¸€ä¸ªæ¯”è¾ƒçš„å›è°ƒå‡½æ•°ä¼šä½¿ç”¨å®˜æ–¹çš„æµ…æ¯”è¾ƒã€‚å…·ä½“çš„å¯ä»¥çœ‹æ³¨é‡Š</p>\n<h4 id=\"memoçš„å›è°ƒå‡½æ•°\"><a href=\"#memoçš„å›è°ƒå‡½æ•°\" class=\"headerlink\" title=\"memoçš„å›è°ƒå‡½æ•°\"></a>memoçš„å›è°ƒå‡½æ•°</h4><p>æˆ‘ä»¬éƒ½çŸ¥é“reactçš„ç”Ÿå‘½å‘¨æœŸä¸­æœ‰ä¸€ä¸ªshouldComponentUpdateã€‚åœ¨è¿™ä¸ªå‡½æ•°ä¸­è¿”å›trueçš„è¯å°±ä»£è¡¨æœ¬æ¬¡renderéœ€è¦æ‰§è¡Œï¼Œè€Œè¿”å›falseå°±å¯ä»¥è·³è¿‡æœ¬æ¬¡çš„renderã€‚</p>\n<p>è€Œmemoæ­£å¥½ç›¸åï¼Œè¿”å›trueè¡¨ç¤ºæœ¬æ¬¡è·³è¿‡ï¼Œè¿”å›falseå°±è¡¨ç¤ºæœ¬æ¬¡éœ€è¦æ‰§è¡Œrenderã€‚</p>\n<p>å…·ä½“æ€ä¹ˆç”¨å‘¢ï¼Ÿ</p>\n<p>å¤§å®¶å¯ä»¥è‡ªå·±è¿è¡Œä¸€ä¸‹ï¼Œçœ‹çœ‹æ•ˆæœã€‚ä¸€å®šè¦è‡ªå·±è¯•ä¸€ä¸‹ï¼Œä¸ç„¶å¾ˆå®¹æ˜“å’ŒshouldComponentUpdateå¼„æ··äº†ã€‚å­¦ä¹ è¿˜æ˜¯è¦è‡ªå·±åŠ¨æ‰‹æ‰è¡Œã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">ChangeLog</span>(<span class=\"params\">&#123;w = <span class=\"string\">''</span>&#125;</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// çœç•¥</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'====render===='</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> memo(ChangeLog, (prevProps, nextProps) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (prevProps.w !== nextProps.w) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"useMemo-useCallback\"><a href=\"#useMemo-useCallback\" class=\"headerlink\" title=\"useMemo/useCallback\"></a>useMemo/useCallback</h2><h3 id=\"å‰è¨€-2\"><a href=\"#å‰è¨€-2\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h3><p>ä¹‹æ‰€ä»¥æŠŠè¿™useMomo/useCallackä¸¤å…„å¼Ÿå’Œåœ¨ä¸€èµ·ã€‚æ˜¯å› ä¸ºä»–ä»¬å…¶å®ååˆ†ç›¸ä¼¼ã€‚</p>\n<blockquote>\n<p>ä¸€ä¸ªæ˜¯ç¼“å­˜å˜é‡ï¼ˆuseMemoï¼‰ï¼Œä¸€ä¸ªæ˜¯ç¼“å­˜å‡½æ•°ï¼ˆuseCallbackï¼‰ã€‚</p>\n</blockquote>\n<p>å…¶å®è¿™ä¹ˆä¸€è¯´å°±æ¸…æ™°å¾ˆå¤šäº†ã€‚</p>\n<p>å…·ä½“çš„ä½¿ç”¨å’ŒuseEffectä¸€æ ·ï¼Œéƒ½æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè°ƒç”¨æ—¶çš„å›è°ƒå‡½æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è°ƒç”¨åˆ¤æ–­æ‰€ç›‘å¬çš„å€¼ï¼ˆå¯ä»¥æ˜¯å˜é‡ï¼Œä¹Ÿå¯ä»¥æ˜¯å‡½æ•°ï¼‰</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> memoizedValue = useMemo(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> computeExpensiveValue(a, b), [a, b]);</span><br><span class=\"line\"><span class=\"keyword\">const</span> memoizedValue = useCallback(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> computeExpensiveValue(a, b), [a, b]);</span><br></pre></td></tr></table></figure>\n\n<p>useMemo() è¿”å›çš„æ˜¯ä¸€ä¸ª memoized å€¼ï¼Œåªæœ‰å½“ä¾èµ–é¡¹ï¼ˆæ¯”å¦‚ä¸Šé¢çš„ a,b å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œæ‰ä¼šé‡æ–°è®¡ç®—è¿™ä¸ª memoized å€¼ï¼‰</p>\n<p>memoized å€¼ä¸å˜çš„æƒ…å†µä¸‹ï¼Œä¸ä¼šé‡æ–°è§¦å‘æ¸²æŸ“é€»è¾‘ã€‚</p>\n<p>è¯´èµ·æ¸²æŸ“é€»è¾‘ï¼Œéœ€è¦è®°ä½çš„æ˜¯ useMemo() æ˜¯åœ¨ render æœŸé—´æ‰§è¡Œçš„ï¼Œæ‰€ä»¥ä¸èƒ½è¿›è¡Œä¸€äº›é¢å¤–çš„å‰¯æ“ä½œï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚ç­‰ã€‚</p>\n<p>å¦‚æœæ²¡æœ‰æä¾›ä¾èµ–æ•°ç»„ï¼ˆä¸Šé¢çš„ [a,b]ï¼‰åˆ™æ¯æ¬¡éƒ½ä¼šé‡æ–°è®¡ç®— memoized å€¼ï¼Œä¹Ÿå°±ä¼š re-redner</p>\n<p>useCallbackä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œå°±ä¸å¤šèµ˜è¿°äº†ã€‚</p>\n<h2 id=\"useReducer-useContext\"><a href=\"#useReducer-useContext\" class=\"headerlink\" title=\"useReducer/useContext\"></a>useReducer/useContext</h2><h3 id=\"å‰è¨€-3\"><a href=\"#å‰è¨€-3\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h3><p>å¸®ä»–ä»¬ä¸¤å…„å¼Ÿå’Œåœ¨ä¸€èµ·è¯´ä¸»è¦è¯´å› ä¸ºä»–ä»¬ä¸¤å…„å¼Ÿåœ¨ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯å¯ä»¥ä¸Reduxä¸€æˆ˜çš„ã€‚</p>\n<p>ä½†æ˜¯ï¼ï¼</p>\n<p>ä½†æ˜¯å•Šï¼Œä½†æ˜¯å¦‚æœä½ éœ€è¦ä¸­é—´ä»·ï¼Œæˆ–è€…è¯´éœ€è¦â€œæ—¶é—´æ—…è¡Œâ€ï¼Œåˆæˆ–è€…ä¸´æ—¶éœ€è¦è·¨é¡µé¢çº§çš„æ•°æ®å…±äº«ï¼Œé‚£ä½ è¿˜æ˜¯éœ€è¦reduxæ¥è§£å†³çš„ã€‚ä¸è¿‡åŸºæœ¬ä¸Šçš„åœºæ™¯æˆ‘ä»¬ä½¿ç”¨useReducerå’ŒuseContextå°±å¯ä»¥å®Œç¾çš„æ›¿ä»£reduxäº†ã€‚</p>\n<h3 id=\"æ€ä¹ˆåšï¼Ÿ\"><a href=\"#æ€ä¹ˆåšï¼Ÿ\" class=\"headerlink\" title=\"æ€ä¹ˆåšï¼Ÿ\"></a>æ€ä¹ˆåšï¼Ÿ</h3><p>å…¶å®ä¹‹å‰ç”±äºè¦èµ·ä¸€ä¸ªæ–°é¡¹ç›®ï¼Œä½†æ˜¯çªç„¶å‘ç°æœ‰ä¸€ä¸ªçˆ·çˆ·ç»„ä»¶çš„å€¼ä¸ºéœ€è¦é€šçŸ¥ç»™å­™å­ç»„ä»¶ï¼Œç„¶åå­™å­ç»„ä»¶å¯èƒ½ä¼šç”¨æ‰å›è°ƒå‡½æ•°è°ƒç”¨çˆ·çˆ·ç»„ä»¶çš„æ–¹æ³•ã€‚é‚£ä¸ªæ—¶å€™å…¶å®å·²ç»ç”¨Hookå†™äº†ä¸€åŠäº†ï¼Œæ‡’å¾—åŠ Reduxäº†ï¼Œåˆä¸æƒ³ä¸€å±‚å±‚ä¼ propsä¸‹å»ã€‚æ€ä¹ˆåŠï¼Ÿ</p>\n<p>é€šè¿‡äº†è§£ï¼Œæˆ‘çŸ¥é“äº†useReducer/useContextåˆšåˆšå¥½å¯ä»¥è§£å†³æˆ‘çš„éœ€æ±‚ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> TodosDispatch = React.createContext(<span class=\"literal\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> initialState = &#123; <span class=\"attr\">bar</span>: <span class=\"literal\">null</span> &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">reducer</span>(<span class=\"params\">state, action</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">switch</span> (action.type) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'setCenter'</span>:</span><br><span class=\"line\">      <span class=\"keyword\">return</span> &#123; ...state, <span class=\"attr\">bar</span>: action.bar &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">default</span>:</span><br><span class=\"line\">      <span class=\"keyword\">return</span> state</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è™½ç„¶è¿™ä¸ªæ˜¯è‡ªç»„ä»¶ï¼Œä½†æ˜¯å“ªæ€•æ˜¯æ›¾æ›¾æ›¾å­™å­ç»„ä»¶éƒ½å¯ä»¥ç›´æ¥ç”¨useContextæ‹¿åˆ°dispatch</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">DeepChild</span>(<span class=\"params\">props</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœæˆ‘ä»¬æƒ³è¦æ‰§è¡Œä¸€ä¸ª actionï¼Œæˆ‘ä»¬å¯ä»¥ä» context ä¸­è·å– dispatchã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> dispatch = useContext(TodosDispatch);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleClick</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    dispatch(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'add'</span>, <span class=\"attr\">text</span>: <span class=\"string\">'hello'</span> &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    &lt;button onClick=&#123;handleClick&#125;&gt;Add todo&lt;<span class=\"regexp\">/button&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  );</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">function TodosApp() &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">  /</span><span class=\"regexp\">/ æç¤ºï¼š`dispatch` ä¸ä¼šåœ¨é‡æ–°æ¸²æŸ“ä¹‹é—´å˜åŒ–</span></span><br><span class=\"line\"><span class=\"regexp\">  const [state, dispatch] = useReducer(reducer, initialState);</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">  return (</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;TodosDispatch.Provider value=&#123;dispatch&#125;&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;DeepTree todos=&#123;todos&#125; /</span>&gt;</span><br><span class=\"line\">    &lt;<span class=\"regexp\">/TodosDispatch.Provider&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  );</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"useImperativeHandle-forwardRef\"><a href=\"#useImperativeHandle-forwardRef\" class=\"headerlink\" title=\"useImperativeHandle/forwardRef\"></a>useImperativeHandle/forwardRef</h2><p>è¿™é‡Œå°±ä¸å¤šè¯´äº†ï¼ŒåŸºæœ¬ä¸Šæ²¡æœ‰ä»€ä¹ˆå‘ç‚¹å’Œç–‘éš¾ç‚¹ã€‚</p>\n<p>è¯´ä¸€ä¸‹åŸºæœ¬ç”¨æ³•å’Œant-design formä¸­çš„ä½¿ç”¨</p>\n<h3 id=\"æ­£å¸¸ä½¿ç”¨\"><a href=\"#æ­£å¸¸ä½¿ç”¨\" class=\"headerlink\" title=\"æ­£å¸¸ä½¿ç”¨\"></a>æ­£å¸¸ä½¿ç”¨</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useImperativeHandle(ref, createHandle, [deps])</span><br></pre></td></tr></table></figure>\n\n<p><code>useImperativeHandle</code> å¯ä»¥è®©ä½ åœ¨ä½¿ç”¨ <code>ref</code> æ—¶è‡ªå®šä¹‰æš´éœ²ç»™çˆ¶ç»„ä»¶çš„å®ä¾‹å€¼ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåº”å½“é¿å…ä½¿ç”¨ ref è¿™æ ·çš„å‘½ä»¤å¼ä»£ç ã€‚<code>useImperativeHandle</code> åº”å½“ä¸ <code>forwardRef</code>ä¸€èµ·ä½¿ç”¨ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">FancyInput</span>(<span class=\"params\">props, ref</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> inputRef = useRef();</span><br><span class=\"line\">  useImperativeHandle(ref, () =&gt; (&#123;</span><br><span class=\"line\">    focus: <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      inputRef.current.focus();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;));</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">ref</span>=<span class=\"string\">&#123;inputRef&#125;</span> <span class=\"attr\">...</span> /&gt;</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">FancyInput = forwardRef(FancyInput);</span><br></pre></td></tr></table></figure>\n\n<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œæ¸²æŸ“<FancyInput ref={inputRef} />çš„çˆ¶ç»„ä»¶å¯ä»¥è°ƒç”¨ <code>inputRef.current.focus()</code>ã€‚</p>\n<h3 id=\"ant-design-form\"><a href=\"#ant-design-form\" class=\"headerlink\" title=\"ant-design form\"></a>ant-design form</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// refä»ç¬¬äºŒä¸ªå‚æ•°å–ï¼Œè¿™é‡Œéƒ½æ˜¯ä¸€è‡´çš„</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> Example = <span class=\"function\">(<span class=\"params\">props,ref</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> bar = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;&#125;</span><br><span class=\"line\">  useImperativeHandle(ref, () =&gt; (&#123;</span><br><span class=\"line\">    text: bar,</span><br><span class=\"line\">  &#125;));</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    &lt;&gt;</span><br><span class=\"line\">        &lt;Form&gt;</span><br><span class=\"line\">    \t\t\t&#123;<span class=\"comment\">//....&#125;</span></span><br><span class=\"line\">        &lt;<span class=\"regexp\">/Form&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;/</span>&gt;</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> memo(Form.create()(forwardRef(Example)));</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> Parent = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    &lt;&gt;</span><br><span class=\"line\">      &lt;Example</span><br><span class=\"line\">      \t<span class=\"comment\">// æ³¨æ„è¿™ä¸ªä¸å†æ˜¯ä¼ refäº†ï¼Œè€Œæ˜¯ä¼ wrappedComponentRefã€‚å› ä¸ºantdçš„formä»–è¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè¿™ä¸ªæ˜¯ä»–è‡ªå®šä¹‰çš„ä¸€ä¸ªæ¥æ”¶refçš„å€¼</span></span><br><span class=\"line\">        wrappedComponentRef=&#123;editTemplateRef&#125;</span><br><span class=\"line\">      /&gt;</span><br><span class=\"line\">    &lt;<span class=\"regexp\">/&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  );</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"useDebugValue-è‡ªå®šä¹‰Hook\"><a href=\"#useDebugValue-è‡ªå®šä¹‰Hook\" class=\"headerlink\" title=\"useDebugValue/è‡ªå®šä¹‰Hook\"></a>useDebugValue/è‡ªå®šä¹‰Hook</h2><h3 id=\"å‰è¨€-4\"><a href=\"#å‰è¨€-4\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h3><p>useDebugValueæ˜¯ä¸“é—¨ç”¨äºæœåŠ¡è‡ªå®šä¹‰çš„Hookçš„ã€‚</p>\n<p>å…·ä½“çœ‹çœ‹ä½¿ç”¨å°±å¥½</p>\n<p>useDebugValueï¼Œç›®çš„æ˜¯èƒ½åœ¨reactçš„æµè§ˆå™¨è°ƒè¯•å·¥å…·ä¸Šæ˜¾ç¤ºä½ çš„è‡ªå®šä¹‰hooksï¼Œæˆ–è€…ç»™hooksæ ‡è®°ä¸€äº›ä¸œè¥¿<br>å½“ä½¿ç”¨ä¸€ä¸ªå‚æ•°çš„æ—¶å€™ï¼Œå°±æ˜¯æŠŠç¬¬ä¸€ä¸ªå‚æ•°æ ‡è®°åœ¨reactçš„è°ƒè¯•å·¥å…·ä¸Š,ä¸‹é¢å†™ä¸€ä¸ªç®€å•çš„ä¾‹å­</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; useDebugValue, useState &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> useTest = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> [str, setStr] = useState&lt;string&gt;(<span class=\"string\">''</span>);</span><br><span class=\"line\">    useDebugValue(<span class=\"string\">'debug'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        str, setStr</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> (): JSX.Element =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; str, setStr &#125; = useTest();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">        &lt;&gt;</span><br><span class=\"line\">            &lt;h2&gt;&#123;str&#125;&lt;<span class=\"regexp\">/h2&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">            &lt;button onClick=&#123;() =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">                setStr('é‡æ–°æ¸²æŸ“');</span></span><br><span class=\"line\"><span class=\"regexp\">            &#125;&#125;&gt;è¿™æ˜¯ï¼Ÿï¼Ÿï¼Ÿ&lt;/</span>button&gt;</span><br><span class=\"line\">        &lt;<span class=\"regexp\">/&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    );</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/%E4%BD%A0%E7%9C%9F%E7%9A%84%E6%87%82ReactHook%E5%90%97/20190818212347571.png\"  alt=\"\"></p>\n<p>ä¼šåœ¨è‡ªå®šä¹‰çš„hooksæ ‡è®°åˆ°reactçš„è°ƒè¯•å·¥å…·ä¸Šé¢,ä¸»è¦ç”¨äºè°ƒè¯•å·¥å…·è°ƒè¯•ä½¿ç”¨</p>\n<p>å½“ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°çš„æƒ…å†µä¸‹ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œä¼šæŠŠç¬¬ä¸€ä¸ªå‚æ•°å½“æˆè‡ªå·±çš„å½¢å‚ä¼ å…¥ï¼Œè¿›è¡Œä¸€ç³»åˆ—çš„æ“ä½œï¼Œreturnå›å»ï¼Œç„¶åæ‰ä¼šåœ¨reactè°ƒè¯•å·¥å…·çš„hooksä¸­æ‰“å°å‡ºæ¥ï¼Œä¸ç„¶ä¸ä¼šæ˜¾ç¤º</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; useDebugValue, useState &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> useTest = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> [str, setStr] = useState&lt;string&gt;(<span class=\"string\">''</span>);</span><br><span class=\"line\">    useDebugValue(str, (value:string) =&gt; &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(value);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">'è¿™æ˜¯æ”¹é€ åçš„'</span> + value;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        str, setStr</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> (): JSX.Element =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; str, setStr &#125; = useTest();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">        &lt;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">            &lt;h2&gt;&#123;str&#125;&lt;<span class=\"regexp\">/h2&gt;</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">            &lt;button onClick=&#123;() =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">                setStr('é‡æ–°æ¸²æŸ“');</span></span><br><span class=\"line\"><span class=\"regexp\">           &#125;&#125;&gt;è¿™æ˜¯ï¼Ÿï¼Ÿï¼Ÿ&lt;/</span>button&gt;</span><br><span class=\"line\">       &lt;<span class=\"regexp\">/&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    );</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>ç»“æœ:</p>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/%E4%BD%A0%E7%9C%9F%E7%9A%84%E6%87%82ReactHook%E5%90%97/2019081821194714.png\"  alt=\"\"></p>\n<p>åŒæ—¶åœ¨æ§åˆ¶å°ä¸Šæ‰“å°äº†ä¸€ä¸ªç©ºå­—ç¬¦</p>\n<p>ç”±äºstrçš„åˆå§‹å€¼æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥æ‰“å°å°±æ˜¯ç©ºçš„äº†ï¼Œè¿™åªæ˜¯è°ƒè¯•ä½¿ç”¨ï¼Œhookså·®ä¸å¤šå°±è¿™äº›äº†ï¼Œæ²¡æœ‰å…¶ä»–çš„äº†</p>\n<h2 id=\"è§‚çœ‹ä¹‹å\"><a href=\"#è§‚çœ‹ä¹‹å\" class=\"headerlink\" title=\"è§‚çœ‹ä¹‹å\"></a>è§‚çœ‹ä¹‹å</h2><p>å¦‚æœæœ‰å“ªé‡Œå†™çš„ä¸å¯¹æˆ–è€…æœ‰ç–‘é—®çš„æ¬¢è¿å¤§å®¶åœ¨è¯„è®ºåŒºäº’åŠ¨ã€‚ğŸ™</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><ol>\n<li>è¯»è¿™ç¯‡æ–‡ç« çš„å‰ææ˜¯ä½ å·²ç»å¯¹React Hookæœ‰æ‰€äº†è§£çš„æƒ…å†µä¸‹ï¼Œå¦‚æœä½ è¿˜æ²¡æœ‰äº†è§£ï¼Œè¯·å…ˆç§»æ­¥å®˜ç½‘å­¦ä¹ ä¸€ä¸‹ã€‚<ol>\n<li>æœ€å¥½ä¸è¦å»ç½‘ä¸Šçœ‹åˆ«äººçš„æ€»ç»“ä¹‹ç±»çš„ï¼Œæ— éå°±æ˜¯è¶…çš„å®˜ç½‘çš„ï¼Œè€Œä¸”è¿™æ ·ä¼šè®©ä½ çš„è®¤çŸ¥ä»ä¸€å¼€å§‹å°±èµ°åã€‚</li>\n</ol>\n</li>\n<li>è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯æ¢ç©¶Hookçš„åŠ¨æœºï¼Œä½¿ç”¨ä¸­çš„ä¸€äº›ç–‘é—®ï¼›<ol>\n<li>ä½¿ç”¨çš„è¯Reactå®˜ç½‘å·²ç»è®²å¾—å¾ˆè¯¦ç»†äº†ï¼Œè¿™é‡Œå°±ä¸å¤šèµ˜è¿°äº†ã€‚</li>\n</ol>\n</li>\n<li>æœ‰éœ€è¦çœ‹æ¥ä¸‹æ¥çš„ç–‘éš¾ç‚¹çš„ä¼™ä¼´æ¬¢è¿ç›´æ¥è·³è¿‡æ¢ç©¶ç›´æ¥çœ‹å…·ä½“çš„ç–‘é—®ï¼›</li>\n</ol>\n<h2 id=\"æ¢ç©¶\"><a href=\"#æ¢ç©¶\" class=\"headerlink\" title=\"æ¢ç©¶\"></a>æ¢ç©¶</h2><p>ä¸»è¦ä»3ä¸ªæ–¹é¢ç ”ç©¶React Hook</p>\n<p>æ ¹æ®é»„é‡‘æ€ç»´åœˆï¼ˆWhatã€Howã€Whyï¼‰</p>\n<h3 id=\"What\"><a href=\"#What\" class=\"headerlink\" title=\"What\"></a>What</h3><p>ä»€ä¹ˆæ˜¯Hookï¼Ÿ</p>\n<p>æ‰“å¼€Googleç¿»è¯‘ï¼Œå¾—åˆ°çš„è§£é‡Šï¼š<em>é’©ã€é’©å­</em></p>\n<blockquote>\n<p>å†çœ‹çœ‹Reactå®˜ç½‘çš„è§£é‡Šï¼šThey let you use state and other React features without writing a class.ï¼ˆå®ƒå¯ä»¥è®©ä½ åœ¨ä¸ç¼–å†™ class çš„æƒ…å†µä¸‹ä½¿ç”¨ state ä»¥åŠå…¶ä»–çš„ React ç‰¹æ€§ã€‚ï¼‰</p>\n</blockquote>\n<p>æ‰€ä»¥ï¼Œç»“åˆä¸€ä¸‹ã€‚æˆ‘ä¸ªäººçš„ç†è§£æ˜¯è¿™æ ·çš„ï¼šå¯¹äºå‡½æ•°å¼çš„ç»„ä»¶ï¼Œå¯ä»¥ç”¨é’©å­ï¼ˆHookï¼‰å°†æƒ³è¦çš„å¤–éƒ¨åŠŸèƒ½ç»™â€œé’©â€è¿›æ¥ã€‚</p>\n<p>åœ¨React Hookå‡ºæ¥ä¹‹å‰ï¼Œå‡½æ•°å¼ç»„ä»¶éƒ½æ˜¯æ— çŠ¶æ€çš„ç»„ä»¶ï¼Œæœ€å¤šå°±æ˜¯æ ¹æ®<code>props</code>æ¥åŠ ä¸€äº›åˆ¤æ–­çš„é€»è¾‘ï¼›è€Œåœ¨React Hookå‡ºæ¥ä¹‹åå°±å¯ä»¥åœ¨å‡½æ•°å¼ç»„ä»¶é‡Œé¢åŠ å…¥çŠ¶æ€ï¼ˆuseStateï¼‰ï¼Œç±»ç”Ÿå‘½å‘¨æœŸï¼ˆuseEffectï¼‰ï¼Œç”šè‡³æ˜¯ä¸€äº›è‡ªå·±çš„å¤ç”¨é€»è¾‘ï¼ˆè‡ªå®šä¹‰Hookï¼‰ç­‰ç­‰è¿™äº›å¤–éƒ¨çš„åŠŸèƒ½ã€‚</p>\n<h3 id=\"How\"><a href=\"#How\" class=\"headerlink\" title=\"How\"></a>How</h3><p>æ€ä¹ˆä½¿ç”¨Hookï¼Ÿ</p>\n<p>å¤§å®¶ä¸€èµ·çœ‹ä¸€ä¸‹å®˜ç½‘çš„ä¸€ä¸ªä¾‹å­ã€‚</p>\n<p>é¢˜ç›®ï¼šæ˜¾ç¤ºä¸€ä¸ªè®¡æ•°å™¨ã€‚å½“ä½ ç‚¹å‡»æŒ‰é’®ï¼Œè®¡æ•°å™¨çš„å€¼å°±ä¼šå¢åŠ ã€‚</p>\n<h4 id=\"Classç»„ä»¶\"><a href=\"#Classç»„ä»¶\" class=\"headerlink\" title=\"Classç»„ä»¶\"></a>Classç»„ä»¶</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Example</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">constructor</span>(props) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">super</span>(props);</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.state = &#123;</span><br><span class=\"line\">      count: <span class=\"number\">0</span></span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;div&gt;</span><br><span class=\"line\">        &lt;p&gt;You clicked &#123;<span class=\"keyword\">this</span>.state.count&#125; times&lt;<span class=\"regexp\">/p&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        &lt;button onClick=&#123;() =&gt; this.setState(&#123; count: this.state.count + 1 &#125;)&#125;&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">          Click me</span></span><br><span class=\"line\"><span class=\"regexp\">        &lt;/</span>button&gt;</span><br><span class=\"line\">      &lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    );</span></span><br><span class=\"line\"><span class=\"regexp\">  &#125;</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"React-Hook\"><a href=\"#React-Hook\" class=\"headerlink\" title=\"React Hook\"></a>React Hook</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; useState &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Example</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// å£°æ˜ä¸€ä¸ªå« \"count\" çš„ state å˜é‡  const [count, setCount] = useState(0);</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    &lt;div&gt;</span><br><span class=\"line\">      &lt;p&gt;You clicked &#123;count&#125; times&lt;<span class=\"regexp\">/p&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        Click me</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;/</span>button&gt;</span><br><span class=\"line\">    &lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  );</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p>è¿™æ ·å°±ç®—æ˜¯å®Œæˆäº†ä¸€ä¸ªæœ€ç®€å•çš„React Hook å®è·µï¼Œå…³äºä¸€äº›å®˜æ–¹æä¾›çš„Hookæ™šç‚¹ä¼šä»‹ç»ã€‚</p>\n<h3 id=\"Why\"><a href=\"#Why\" class=\"headerlink\" title=\"Why\"></a>Why</h3><ul>\n<li>ä¸ºä»€ä¹ˆä¼šæœ‰Hooksï¼Ÿ</li>\n<li>Hookèƒ½è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ</li>\n</ul>\n<p>åšä»»ä½•ä¸€ä»¶äº‹æƒ…æˆ‘è§‰å¾—éƒ½åº”è¯¥ç†æ¸…è¿™ä¸ªä¸¤ä¸ªé—®é¢˜ï¼Œè¿™æ ·çš„è¯å°±ä¼šäº‹åŠåŠŸå€ã€‚</p>\n<p>æˆ‘ä»¬å…ˆçœ‹çœ‹Reactå®˜æ–¹æ˜¯æ€ä¹ˆè§£é‡Šâ€œWhyâ€çš„</p>\n<blockquote>\n<ol>\n<li>åœ¨ç»„ä»¶ä¹‹é—´å¤ç”¨çŠ¶æ€é€»è¾‘å¾ˆéš¾</li>\n<li>å¤æ‚ç»„ä»¶å˜å¾—éš¾ä»¥ç†è§£</li>\n<li>éš¾ä»¥ç†è§£çš„ class</li>\n</ol>\n</blockquote>\n<p>æœ¬äººä¸ªäººè®¤ä¸ºç¬¬ä¸‰ç‚¹æ˜¯æ¥å‡‘æ•°çš„â€¦.</p>\n<p>ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Ÿ</p>\n<p>å› ä¸ºReactç”¨äº†è¿™ä¹ˆä¹…äº†åŸºæœ¬éƒ½æ˜¯åœ¨ä½¿ç”¨Classç»„ä»¶ï¼Œè¿™ä¸ªæ˜¯åœ¨ä¹‹å‰ï¼Œå“ªæ€•æ˜¯ç°åœ¨å­¦ä¹ Reactçš„å¿…ç»ä¹‹è·¯å§ï¼æ‰€ä»¥ï¼Œè¿™ç‚¹æˆ‘æ¥ä¸‹æ¥å°±ä¼šè·³è¿‡äº†ğŸ˜‚</p>\n<h3 id=\"åœ¨ç»„ä»¶ä¹‹é—´æœç”¨çŠ¶æ€é€»è¾‘å¾ˆéš¾\"><a href=\"#åœ¨ç»„ä»¶ä¹‹é—´æœç”¨çŠ¶æ€é€»è¾‘å¾ˆéš¾\" class=\"headerlink\" title=\"åœ¨ç»„ä»¶ä¹‹é—´æœç”¨çŠ¶æ€é€»è¾‘å¾ˆéš¾\"></a>åœ¨ç»„ä»¶ä¹‹é—´æœç”¨çŠ¶æ€é€»è¾‘å¾ˆéš¾</h3><p>å…¶å®é«˜é˜¶ç»„ä»¶æˆ–è€…è¯´æ˜¯propséƒ½æ˜¯å¾ˆå¥½çš„è§£å†³äº†å¤æ‚çš„èšåˆä¸šåŠ¡é€»è¾‘ï¼Œé‚£ä¸ºä»€ä¹ˆè¯´åœ¨<strong>ç»„ä»¶ä¹‹é—´æœç”¨çŠ¶æ€é€»è¾‘å¾ˆéš¾</strong>å‘¢ï¼Ÿ</p>\n<p>å…¶å®é“ç†éå¸¸ç®€å•ã€‚</p>\n<p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£ã€‚</p>\n<p>åœºæ™¯ï¼šæœ‰ è¯·æ±‚Aï¼Œè¯·æ±‚Bï¼Œè¯·æ±‚Cï¼Œè¯·æ±‚Dã€‚ä»–ä»¬çš„è¯·æ±‚éƒ½æœ‰ç›¸äº’ä¾èµ–å…³ç³»æ¯”å¦‚ï¼Œå‘è¯·æ±‚Bçš„æ—¶å€™å¿…é¡»æ‹¿åˆ°è¯·æ±‚Açš„ç»“æœä¸­çš„æŸä¸ªå€¼ï¼Œè€Œè¯·æ±‚Cä¹Ÿå¿…é¡»æ‹¿åˆ°è¯·æ±‚Bçš„ç»“æœä¸­çš„æŸä¸ªå€¼ã€‚ä»¥æ­¤ç±»æ¨è¯·æ±‚Dã€‚</p>\n<p>Promiseå‡ºæ¥ä¹‹å‰æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿ</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$.ajax(&#123;</span><br><span class=\"line\">    type:<span class=\"string\">\"post\"</span>,</span><br><span class=\"line\">    success: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;<span class=\"comment\">//æˆåŠŸå›è°ƒ</span></span><br><span class=\"line\">        <span class=\"comment\">//å†æ¬¡å¼‚æ­¥è¯·æ±‚</span></span><br><span class=\"line\">        $.ajax(&#123;</span><br><span class=\"line\">            type:<span class=\"string\">\"post\"</span>,</span><br><span class=\"line\">            url:<span class=\"string\">\"...\"</span>,</span><br><span class=\"line\">            success:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;<span class=\"comment\">//æˆåŠŸå›è°ƒ</span></span><br><span class=\"line\">              <span class=\"comment\">//å†æ¬¡å¼‚æ­¥è¯·æ±‚</span></span><br><span class=\"line\">              $.ajax(&#123;</span><br><span class=\"line\">                  type:<span class=\"string\">\"post\"</span>,</span><br><span class=\"line\">                  url:<span class=\"string\">\"...\"</span>,</span><br><span class=\"line\">                  success:<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">                      .......<span class=\"comment\">//å¦‚æ­¤å¾ªç¯</span></span><br><span class=\"line\">                  &#125;</span><br><span class=\"line\">              &#125;)</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>è¿™è¿˜åªæ˜¯3å±‚ï¼Œå¦‚æœæ˜¯100å±‚å‘¢ï¼Ÿé‚£çœ‹èµ·æ¥å°±éå¸¸çš„éš¾å—äº†ï¼</p>\n<p>Promiseè¾ƒå¥½çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(f1)</span><br><span class=\"line\"> .then(f2)</span><br><span class=\"line\"> .then(f3)</span><br><span class=\"line\"> .then(f4)</span><br><span class=\"line\"> .then(f5)</span><br><span class=\"line\"> .then(f5)</span><br><span class=\"line\">â€¦â€¦â€¦â€¦</span><br></pre></td></tr></table></figure>\n\n<p>ç„¶åæ˜¯async/awaitã€‚è¿™é‡Œå°±ä¸å±•å¼€äº†ï¼Œæœ‰å…´è¶£çš„å¯ä»¥è‡ªå·±å»äº†è§£ä¸€ä¸‹ã€‚</p>\n<p>ç»“è®º</p>\n<p>ä¹‹æ‰€ä»¥è¿™ä¹ˆå¤§è´¹å‘¨ç« çš„è®²æ˜¯ä¸ºäº†è§£é‡Šï¼ŒReactä¸­çš„é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰ã€‚ä»–çš„é€»è¾‘å…¶å®å’Œå›è°ƒåœ°ç‹±ç±»ä¼¼ï¼Œä¸€ä¸ªä¸¤ä¸ªå…¶å®éƒ½è¿˜ç®—ä¼˜é›…æˆ–è€…è¯´èˆ’æœï¼Œä¸€æ—¦å¤šäº†çš„è¯ã€‚ã€‚ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> withHover(</span><br><span class=\"line\">  withTheme(</span><br><span class=\"line\">    withAuth(</span><br><span class=\"line\">      withRepos(Profile)</span><br><span class=\"line\">    )</span><br><span class=\"line\">  )</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// å°±ä¼šå˜æˆè¿™æ ·ï¼Œä¸å¤Ÿä¼˜é›…</span></span><br><span class=\"line\">&lt;WithHover&gt;</span><br><span class=\"line\">  &lt;WithTheme hovering=&#123;<span class=\"literal\">false</span>&#125;&gt;</span><br><span class=\"line\">    &lt;WithAuth hovering=&#123;<span class=\"literal\">false</span>&#125; theme=<span class=\"string\">'dark'</span>&gt;</span><br><span class=\"line\">      &lt;WithRepos hovering=&#123;<span class=\"literal\">false</span>&#125; theme=<span class=\"string\">'dark'</span> authed=&#123;<span class=\"literal\">true</span>&#125;&gt;</span><br><span class=\"line\">        &lt;Profile </span><br><span class=\"line\">          id=<span class=\"string\">'JavaScript'</span></span><br><span class=\"line\">          loading=&#123;<span class=\"literal\">true</span>&#125; </span><br><span class=\"line\">          repos=&#123;[]&#125;</span><br><span class=\"line\">          authed=&#123;<span class=\"literal\">true</span>&#125;</span><br><span class=\"line\">          theme=<span class=\"string\">'dark'</span></span><br><span class=\"line\">          hovering=&#123;<span class=\"literal\">false</span>&#125;</span><br><span class=\"line\">        /&gt;</span><br><span class=\"line\">      &lt;<span class=\"regexp\">/WithRepos&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;/</span>WithAuth&gt;</span><br><span class=\"line\">  &lt;WithTheme&gt;</span><br><span class=\"line\">&lt;<span class=\"regexp\">/WithHover&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>è€Œä¸”æ¯ä¸ªé«˜é˜¶ç»„ä»¶çš„é€»è¾‘å¤ç”¨æˆ‘ä»¬å¯èƒ½è¿˜è¦ä¸€ä¸ªä¸ªå»ç ”è¯»ã€‚</p>\n<h3 id=\"å¤æ‚ç»„ä»¶å˜å¾—éš¾ä»¥ç†è§£\"><a href=\"#å¤æ‚ç»„ä»¶å˜å¾—éš¾ä»¥ç†è§£\" class=\"headerlink\" title=\"å¤æ‚ç»„ä»¶å˜å¾—éš¾ä»¥ç†è§£\"></a>å¤æ‚ç»„ä»¶å˜å¾—éš¾ä»¥ç†è§£</h3><p>å…¶å®ï¼Œè¿™ç‚¹éå¸¸å¥½ç†è§£ã€‚ä¸¾ä¸€ä¸ªéå¸¸ç®€å•å¸¸è§çš„ä¾‹å­å¤§å®¶å°±ä¼šæ˜ç™½äº†ã€‚</p>\n<p>åœºæ™¯ï¼šå‡å¦‚æˆ‘æœ‰ä¸€ä¸ªå­ç»„ä»¶Childï¼Œä»–çš„åŠŸèƒ½æ˜¯è¿™æ ·çš„ï¼šçˆ¶ç»„å»ºä¼šç»™ä¸€ä¸ªidï¼Œåœ¨ç»„ä»¶åˆ›å»ºçš„æ—¶å€™è·å–ä¸€ä¸‹æœ‰å…³ä¿¡æ¯ï¼Œåœ¨idæ”¹å˜çš„æ—¶å€™å†é‡æ–°è·å–ã€‚</p>\n<h4 id=\"Classç»„ä»¶-1\"><a href=\"#Classç»„ä»¶-1\" class=\"headerlink\" title=\"Classç»„ä»¶\"></a>Classç»„ä»¶</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">componentDidMount () &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.fetch(<span class=\"keyword\">this</span>.props.id)</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\">componentDidUpdate (prevProps) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (prevProps.id !== <span class=\"keyword\">this</span>.props.id) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.fetch(<span class=\"keyword\">this</span>.props.id)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">fetch = <span class=\"function\"><span class=\"params\">id</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.setState(&#123; <span class=\"attr\">loading</span>: <span class=\"literal\">true</span> &#125;)</span><br><span class=\"line\">  fetchInfo(id)</span><br><span class=\"line\">    .then(<span class=\"function\"><span class=\"params\">info</span> =&gt;</span> <span class=\"keyword\">this</span>.setState(&#123;</span><br><span class=\"line\">    info,</span><br><span class=\"line\">    loading: <span class=\"literal\">false</span></span><br><span class=\"line\">  &#125;))</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"React-Hookï¼š\"><a href=\"#React-Hookï¼š\" class=\"headerlink\" title=\"React Hookï¼š\"></a>React Hookï¼š</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fetch = <span class=\"function\"><span class=\"params\">id</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.setState(&#123; <span class=\"attr\">loading</span>: <span class=\"literal\">true</span> &#125;)</span><br><span class=\"line\">  fetchInfo(id)</span><br><span class=\"line\">    .then(<span class=\"function\"><span class=\"params\">info</span> =&gt;</span> <span class=\"keyword\">this</span>.setState(&#123;</span><br><span class=\"line\">    info,</span><br><span class=\"line\">    loading: <span class=\"literal\">false</span></span><br><span class=\"line\">  &#125;))</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">useEffect(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">  fetch(<span class=\"keyword\">this</span>.props.id)</span><br><span class=\"line\">&#125;, [<span class=\"keyword\">this</span>.props.id])</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"ç»“è®º\"><a href=\"#ç»“è®º\" class=\"headerlink\" title=\"ç»“è®º\"></a>ç»“è®º</h3><p>ç®€å•çš„è¯´ä¸€ä¸‹ä»–çš„ä¼˜ç‚¹å§ã€‚</p>\n<ol>\n<li>å¤ç”¨ä»£ç æ›´åŠ ç®€å•ï¼ˆéœ€è¦ä»€ä¹ˆå°±â€œé’©â€è¿›æ¥ï¼‰</li>\n<li>æ¸…çˆ½çš„ä»£ç é£æ ¼ï¼Œä¸€ç›®äº†ç„¶ã€‚ï¼ˆuseStateæ”¯æŒæ•°ç»„å’Œå¯¹è±¡ï¼Œå¯ä»¥æ¸…æ™°çš„å®šä¹‰ç‰¹æ®Šçš„å­—æ®µç­‰ç­‰ï¼‰</li>\n<li>ä»£ç é‡æ›´å°‘ï¼ˆå¯ä»¥çœ‹ä¸€ä¸‹æˆ‘ä¹‹å‰çš„å­çˆ¶ç»„å»ºçš„ä¾‹å­ï¼‰</li>\n<li>æ›´æ„¿æ„å»å†™ä¸€äº›å°ç»„ä»¶å¤ç”¨ï¼ˆæˆ‘ä¸ªäººå–œæ¬¢Reactå°±æ˜¯å› ä¸ºä»–çš„ç»„ä»¶å†™èµ·æ¥éå¸¸çš„é¡ºæ‰‹ï¼psï¼šæ²¡æœ‰è´¬ä½å…¶ä»–æ¡†æ¶çš„æ„æ€ã€‚ã€‚ï¼‰</li>\n<li>å…¶å®æˆ‘ä¸ªäººè®¤ä¸ºReact Hookåœ¨å®£æ‰¬ä¸€ä¸ªè§‚å¿µâ€œæŒ‰éœ€åŠ è½½â€ã€‚</li>\n</ol>\n<h2 id=\"useState\"><a href=\"#useState\" class=\"headerlink\" title=\"useState\"></a>useState</h2><h3 id=\"ä½¿ç”¨\"><a href=\"#ä½¿ç”¨\" class=\"headerlink\" title=\"ä½¿ç”¨\"></a>ä½¿ç”¨</h3><p>ç®€å•çš„ä½¿ç”¨åœ¨ä¸Šé¢çš„æ¢ç©¶-Howé‡Œé¢æœ‰ä»‹ç»ï¼Œæ›´å¤šçš„åœ¨Reactå®˜ç½‘ä¹Ÿæœ‰ä»‹ç»ã€‚</p>\n<h4 id=\"è¯·å›ç­”ä»¥ä¸‹ä»£ç çš„è¿è¡Œç»“æœ\"><a href=\"#è¯·å›ç­”ä»¥ä¸‹ä»£ç çš„è¿è¡Œç»“æœ\" class=\"headerlink\" title=\"è¯·å›ç­”ä»¥ä¸‹ä»£ç çš„è¿è¡Œç»“æœ\"></a>è¯·å›ç­”ä»¥ä¸‹ä»£ç çš„è¿è¡Œç»“æœ</h4><p><img src=\"https://overreacted.io/46c55d5f1f749462b7a173f1e748e41e/counter.gif\" alt=\"\"></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Counter</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [count, setCount] = useState(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleAlertClick</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      alert(<span class=\"string\">'You clicked on: '</span> + count);</span><br><span class=\"line\">    &#125;, <span class=\"number\">3000</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    &lt;div&gt;</span><br><span class=\"line\">      &lt;p&gt;You clicked &#123;count&#125; times&lt;<span class=\"regexp\">/p&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        Click me</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;/</span>button&gt;</span><br><span class=\"line\">      &lt;button onClick=&#123;handleAlertClick&#125;&gt;</span><br><span class=\"line\">        Show alert</span><br><span class=\"line\">      &lt;<span class=\"regexp\">/button&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;/</span>div&gt;</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä½ çŒœalertä¼šå¼¹å‡ºä»€ä¹ˆå‘¢ï¼Ÿä¼šæ˜¯5å—ï¼Ÿâ€” è¿™ä¸ªå€¼æ˜¯alertçš„æ—¶å€™counterçš„å®æ—¶çŠ¶æ€ã€‚æˆ–è€…ä¼šæ˜¯3å—ï¼Ÿâ€” è¿™ä¸ªå€¼æ˜¯æˆ‘ç‚¹å‡»æ—¶å€™çš„çŠ¶æ€ã€‚</p>\n<blockquote>\n<p>åˆ†å‰²çº¿</p>\n</blockquote>\n<p>æ¥è‡ªå·± <a href=\"https://codesandbox.io/s/w2wxl3yo0l\" target=\"_blank\" rel=\"noopener\">è¯•è¯•å§ï¼</a></p>\n<h4 id=\"ç­”æ¡ˆæ˜¯\"><a href=\"#ç­”æ¡ˆæ˜¯\" class=\"headerlink\" title=\"ç­”æ¡ˆæ˜¯\"></a>ç­”æ¡ˆæ˜¯</h4><p>3</p>\n<p>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿfunctionç»„å»ºç©¶ç«Ÿæ˜¯å¦‚æœå·¥ä½œçš„å‘¢ï¼Ÿ</p>\n<p>æˆ‘ä»¬å‘ç°<code>count</code>åœ¨æ¯ä¸€æ¬¡å‡½æ•°è°ƒç”¨ä¸­éƒ½æ˜¯ä¸€ä¸ªå¸¸é‡å€¼ã€‚å€¼å¾—å¼ºè°ƒçš„æ˜¯ â€” <strong>æˆ‘ä»¬çš„ç»„ä»¶å‡½æ•°æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šè¢«è°ƒç”¨ï¼Œä½†æ˜¯æ¯ä¸€æ¬¡è°ƒç”¨ä¸­<code>count</code>å€¼éƒ½æ˜¯å¸¸é‡ï¼Œå¹¶ä¸”å®ƒè¢«èµ‹äºˆäº†å½“å‰æ¸²æŸ“ä¸­çš„çŠ¶æ€å€¼ã€‚</strong></p>\n<p>è¿™å¹¶ä¸æ˜¯Reactç‰¹æœ‰çš„ï¼Œæ™®é€šçš„å‡½æ•°ä¹Ÿæœ‰ç±»ä¼¼çš„è¡Œä¸ºï¼š</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sayHi</span>(<span class=\"params\">person</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> name = person.name;  setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    alert(<span class=\"string\">'Hello, '</span> + name);</span><br><span class=\"line\">  &#125;, <span class=\"number\">3000</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> someone = &#123;<span class=\"attr\">name</span>: <span class=\"string\">'Dan'</span>&#125;;</span><br><span class=\"line\">sayHi(someone);</span><br><span class=\"line\"></span><br><span class=\"line\">someone = &#123;<span class=\"attr\">name</span>: <span class=\"string\">'Yuzhi'</span>&#125;;</span><br><span class=\"line\">sayHi(someone);</span><br><span class=\"line\"></span><br><span class=\"line\">someone = &#123;<span class=\"attr\">name</span>: <span class=\"string\">'Dominic'</span>&#125;;</span><br><span class=\"line\">sayHi(someone);</span><br></pre></td></tr></table></figure>\n\n<p>åœ¨ <a href=\"https://codesandbox.io/s/mm6ww11lk8\" target=\"_blank\" rel=\"noopener\">è¿™ä¸ªä¾‹å­</a>ä¸­, å¤–å±‚çš„<code>someone</code>ä¼šè¢«èµ‹å€¼å¾ˆå¤šæ¬¡ï¼ˆå°±åƒåœ¨Reactä¸­ï¼Œ<em>å½“å‰</em>çš„ç»„ä»¶çŠ¶æ€ä¼šæ”¹å˜ä¸€æ ·ï¼‰ã€‚<strong>ç„¶åï¼Œåœ¨<code>sayHi</code>å‡½æ•°ä¸­ï¼Œå±€éƒ¨å¸¸é‡<code>name</code>ä¼šå’ŒæŸæ¬¡è°ƒç”¨ä¸­çš„<code>person</code>å…³è”ã€‚</strong>å› ä¸ºè¿™ä¸ªå¸¸é‡æ˜¯å±€éƒ¨çš„ï¼Œæ‰€ä»¥æ¯ä¸€æ¬¡è°ƒç”¨éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚ç»“æœå°±æ˜¯ï¼Œå½“å®šæ—¶å™¨å›è°ƒè§¦å‘çš„æ—¶å€™ï¼Œæ¯ä¸€ä¸ªalertéƒ½ä¼šå¼¹å‡ºå®ƒæ‹¥æœ‰çš„<code>name</code>ã€‚</p>\n<p>è¿™å°±è§£é‡Šäº†æˆ‘ä»¬çš„äº‹ä»¶å¤„ç†å‡½æ•°å¦‚ä½•æ•è·äº†ç‚¹å‡»æ—¶å€™çš„<code>count</code>å€¼ã€‚å¦‚æœæˆ‘ä»¬åº”ç”¨ç›¸åŒçš„æ›¿æ¢åŸç†ï¼Œæ¯ä¸€æ¬¡æ¸²æŸ“â€œçœ‹åˆ°â€çš„æ˜¯å®ƒè‡ªå·±çš„<code>count</code>ï¼š</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// During first render</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Counter</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> count = <span class=\"number\">0</span>; <span class=\"comment\">// Returned by useState()  // ...</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleAlertClick</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      alert(<span class=\"string\">'You clicked on: '</span> + count);</span><br><span class=\"line\">    &#125;, <span class=\"number\">3000</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// After a click, our function is called again</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Counter</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> count = <span class=\"number\">1</span>; <span class=\"comment\">// Returned by useState()  // ...</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleAlertClick</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      alert(<span class=\"string\">'You clicked on: '</span> + count);</span><br><span class=\"line\">    &#125;, <span class=\"number\">3000</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// After another click, our function is called again</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Counter</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> count = <span class=\"number\">2</span>; <span class=\"comment\">// Returned by useState()  // ...</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleAlertClick</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      alert(<span class=\"string\">'You clicked on: '</span> + count);</span><br><span class=\"line\">    &#125;, <span class=\"number\">3000</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æ‰€ä»¥å®é™…ä¸Šï¼Œæ¯ä¸€æ¬¡æ¸²æŸ“éƒ½æœ‰ä¸€ä¸ªâ€œæ–°ç‰ˆæœ¬â€çš„<code>handleAlertClick</code>ã€‚æ¯ä¸€ä¸ªç‰ˆæœ¬çš„<code>handleAlertClick</code>â€œè®°ä½â€ äº†å®ƒè‡ªå·±çš„ <code>count</code>ï¼š</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// During first render</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Counter</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleAlertClick</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      alert(<span class=\"string\">'You clicked on: '</span> + <span class=\"number\">0</span>);    &#125;, <span class=\"number\">3000</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">  &lt;button onClick=&#123;handleAlertClick&#125; /&gt; <span class=\"comment\">// The one with 0 inside  // ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// After a click, our function is called again</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Counter</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleAlertClick</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      alert(<span class=\"string\">'You clicked on: '</span> + <span class=\"number\">1</span>);    &#125;, <span class=\"number\">3000</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">  &lt;button onClick=&#123;handleAlertClick&#125; /&gt; <span class=\"comment\">// The one with 1 inside  // ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// After another click, our function is called again</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Counter</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleAlertClick</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      alert(<span class=\"string\">'You clicked on: '</span> + <span class=\"number\">2</span>);    &#125;, <span class=\"number\">3000</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">  &lt;button onClick=&#123;handleAlertClick&#125; /&gt; <span class=\"comment\">// The one with 2 inside  // ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ<a href=\"https://codesandbox.io/s/w2wxl3yo0l\" target=\"_blank\" rel=\"noopener\">åœ¨è¿™ä¸ªdemoä¸­</a>ä¸­ï¼Œäº‹ä»¶å¤„ç†å‡½æ•°â€œå±äºâ€æŸä¸€æ¬¡ç‰¹å®šçš„æ¸²æŸ“ï¼Œå½“ä½ ç‚¹å‡»çš„æ—¶å€™ï¼Œå®ƒä¼šä½¿ç”¨é‚£æ¬¡æ¸²æŸ“ä¸­<code>counter</code>çš„çŠ¶æ€å€¼ã€‚</p>\n<p><strong>åœ¨ä»»æ„ä¸€æ¬¡æ¸²æŸ“ä¸­ï¼Œpropså’Œstateæ˜¯å§‹ç»ˆä¿æŒä¸å˜çš„ã€‚</strong>å¦‚æœpropså’Œstateåœ¨ä¸åŒçš„æ¸²æŸ“ä¸­æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œé‚£ä¹ˆä½¿ç”¨åˆ°å®ƒä»¬çš„ä»»ä½•å€¼ä¹Ÿæ˜¯ç‹¬ç«‹çš„ï¼ˆåŒ…æ‹¬äº‹ä»¶å¤„ç†å‡½æ•°ï¼‰ã€‚å®ƒä»¬éƒ½â€œå±äºâ€ä¸€æ¬¡ç‰¹å®šçš„æ¸²æŸ“ã€‚å³ä¾¿æ˜¯äº‹ä»¶å¤„ç†ä¸­çš„å¼‚æ­¥å‡½æ•°è°ƒç”¨â€œçœ‹åˆ°â€çš„ä¹Ÿæ˜¯è¿™æ¬¡æ¸²æŸ“ä¸­çš„<code>count</code>å€¼ã€‚</p>\n<h4 id=\"è¯·å›ç­”ä»¥ä¸‹ä»£ç çš„è¿è¡Œç»“æœ-1\"><a href=\"#è¯·å›ç­”ä»¥ä¸‹ä»£ç çš„è¿è¡Œç»“æœ-1\" class=\"headerlink\" title=\"è¯·å›ç­”ä»¥ä¸‹ä»£ç çš„è¿è¡Œç»“æœ\"></a>è¯·å›ç­”ä»¥ä¸‹ä»£ç çš„è¿è¡Œç»“æœ</h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Counter</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [count, setCount] = useState(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> addCount = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    setCount(count+<span class=\"number\">1</span>)</span><br><span class=\"line\">    setCount(count+<span class=\"number\">2</span>)</span><br><span class=\"line\">    setCount(count+<span class=\"number\">3</span>)</span><br><span class=\"line\">    setCount(count+<span class=\"number\">4</span>)</span><br><span class=\"line\">    setCount(count+<span class=\"number\">5</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(count)</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    &lt;div&gt;</span><br><span class=\"line\">      &lt;button onClick=&#123;addCount&#125;&gt;</span><br><span class=\"line\">        Click me</span><br><span class=\"line\">      &lt;<span class=\"regexp\">/button&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;/</span>div&gt;</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>åˆ†å‰²çº¿</p>\n</blockquote>\n<h4 id=\"ç­”æ¡ˆæ˜¯-1\"><a href=\"#ç­”æ¡ˆæ˜¯-1\" class=\"headerlink\" title=\"ç­”æ¡ˆæ˜¯\"></a>ç­”æ¡ˆæ˜¯</h4><p>5</p>\n<p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>\n<p>useStateçš„æ›´æ–°ç©¶ç«Ÿæ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿ</p>\n<p>æˆ‘ä»¬è¿›å…¥<code>ReactHooks.js</code>æ¥çœ‹çœ‹ï¼Œå‘ç°<code>useState</code>çš„å®ç°ç«Ÿç„¶å¼‚å¸¸ç®€å•ï¼Œåªæœ‰çŸ­çŸ­ä¸¤è¡Œ</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ReactHooks.js</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">useState</span>&lt;<span class=\"title\">S</span>&gt;(<span class=\"params\">initialState: ((</span>) =&gt; <span class=\"title\">S</span>) | <span class=\"title\">S</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> dispatcher = resolveDispatcher();</span><br><span class=\"line\">  <span class=\"keyword\">return</span> dispatcher.useState(initialState);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å…¶å®å¯ä»¥è¿™æ ·ç†è§£useStateï¼ŒuseStateå…¶å®å°±æ˜¯useReducerçš„ä¸€ä¸ªè¯­æ³•ç³–ï¼›ä½†æ˜¯è¿™ä¸ªä¸åœ¨è¿™ä¸ªé—®é¢˜çš„è®¨è®ºèŒƒå›´å†…ï¼›</p>\n<p>å¥½ï¼Œæ”¶å›æ¥ã€‚</p>\n<p>å…¶å®æˆ‘ä»¬åœ¨<code>const [xx, setXx] = useState(xx)</code>çš„æ—¶å€™å°±ç”Ÿæˆä¸€ä¸ªé˜Ÿåˆ—ï¼Œæˆ‘ä»¬æš‚æ—¶å«å®ƒä¸ºqueueï¼›æ‰€æœ‰è¿™ä¸€è½®è¿è¡Œè¯»å–åˆ°çš„stateéƒ½è¢«æ”¾åˆ°ä¸€ä¸ªé“¾è¡¨çš„é˜Ÿåˆ—é‡Œé¢å»ï¼Œç„¶åå†ç”¨do-whileå¾ªç¯ï¼Œæ¯æ¬¡éƒ½æ˜¯æ‹¿åˆ°æœ€æ–°çš„å€¼ï¼Œä½†æ˜¯ä¸æ˜¯Object.assginçš„å½¢å¼ï¼Œè€Œæ˜¯ç›´æ¥èµ‹å€¼ã€‚è¯ä¸å¤šè¯´ç›´æ¥æºç ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">updateReducer</span>(<span class=\"params\">reducer, initialArg, init</span>) </span>&#123;</span><br><span class=\"line\"><span class=\"comment\">// è·å–åˆå§‹åŒ–æ—¶çš„ hook</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> hook = updateWorkInProgressHook();</span><br><span class=\"line\">  <span class=\"keyword\">const</span> queue = hook.queue;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// å¼€å§‹æ¸²æŸ“æ›´æ–°</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (numberOfReRenders &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> dispatch = queue.dispatch;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (renderPhaseUpdates !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// è·å–Hookå¯¹è±¡ä¸Šçš„ queueï¼Œå†…éƒ¨å­˜æœ‰æœ¬æ¬¡æ›´æ–°çš„ä¸€ç³»åˆ—æ•°æ®</span></span><br><span class=\"line\">      <span class=\"keyword\">const</span> firstRenderPhaseUpdate = renderPhaseUpdates.get(queue);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (firstRenderPhaseUpdate !== <span class=\"literal\">undefined</span>) &#123;</span><br><span class=\"line\">        renderPhaseUpdates.delete(queue);</span><br><span class=\"line\">        <span class=\"keyword\">let</span> newState = hook.memoizedState;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> update = firstRenderPhaseUpdate;</span><br><span class=\"line\">        <span class=\"comment\">// è·å–æ›´æ–°åçš„state</span></span><br><span class=\"line\">        <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">const</span> action = update.action;</span><br><span class=\"line\">          <span class=\"comment\">// æ­¤æ—¶çš„reduceræ˜¯basicStateReducerï¼Œç›´æ¥è¿”å›actionçš„å€¼</span></span><br><span class=\"line\">          <span class=\"comment\">// æ³¨æ„ï¼Œè¿™é‡Œæ˜¯ç­‰äºå·æ‰€ä»¥</span></span><br><span class=\"line\">          <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">          *</span></span><br><span class=\"line\"><span class=\"comment\">          * setObj(&#123; a: 1, b: 1, c: 1 &#125;)</span></span><br><span class=\"line\"><span class=\"comment\">        \t* setObj(&#123; a: 2, b: 2 &#125;)</span></span><br><span class=\"line\"><span class=\"comment\">        \t* setObj(&#123; a: 3 &#125;)</span></span><br><span class=\"line\"><span class=\"comment\">        \t*</span></span><br><span class=\"line\"><span class=\"comment\">        \t* åˆ°æœ€åä¹Ÿåªæœ‰åªæœ‰&#123; a: 3 &#125;ï¼Œè€Œbå’Œcå…¨æ²¡äº†</span></span><br><span class=\"line\"><span class=\"comment\">          *</span></span><br><span class=\"line\"><span class=\"comment\">          **/</span></span><br><span class=\"line\">          newState = reducer(newState, action);</span><br><span class=\"line\">          update = update.next;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">while</span> (update !== <span class=\"literal\">null</span>);</span><br><span class=\"line\">        <span class=\"comment\">// å¯¹ æ›´æ–°hook.memoized </span></span><br><span class=\"line\">        hook.memoizedState = newState;</span><br><span class=\"line\">        <span class=\"comment\">// è¿”å›æ–°çš„ stateï¼ŒåŠæ›´æ–° hook çš„ dispatch æ–¹æ³•</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> [newState, dispatch];</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"useEffect-useLayoutEffect\"><a href=\"#useEffect-useLayoutEffect\" class=\"headerlink\" title=\"useEffect/useLayoutEffect\"></a>useEffect/useLayoutEffect</h2><h3 id=\"æç¤º\"><a href=\"#æç¤º\" class=\"headerlink\" title=\"æç¤º\"></a>æç¤º</h3><p>åœ¨å­¦ä¹ useEffectè¿™ä¸ªHookçš„æ—¶å€™ï¼Œæ·¡åŒ–ä½ çŸ¥é“çš„â€œç”Ÿå‘½å‘¨æœŸâ€è¿™ä¸ªæ¦‚å¿µã€‚</p>\n<h4 id=\"useEffectå’ŒuseLayoutEffectä¸¤å…„å¼Ÿçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ\"><a href=\"#useEffectå’ŒuseLayoutEffectä¸¤å…„å¼Ÿçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ\" class=\"headerlink\" title=\"useEffectå’ŒuseLayoutEffectä¸¤å…„å¼Ÿçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ\"></a>useEffectå’ŒuseLayoutEffectä¸¤å…„å¼Ÿçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>æ‰§è¡Œçš„æ—¶æœºä¸åŒ</p>\n<p>é‚£ä¹ˆå…·ä½“å“ªé‡Œä¸åŒå‘¢ï¼Ÿ</p>\n<p>å…¶å®åœ¨åˆå§‹åŒ–useEffectå’ŒuseLayoutEffectæ˜¯æ²¡æœ‰åŒºåˆ«çš„ï¼Œä»–ä»¬çœŸæ­£çš„åŒºåˆ«åœ¨äºåˆå§‹åŒ–ä¹‹åï¼›</p>\n<p>ä¸¾ä¸ªéå¸¸å½¢è±¡çš„ä¾‹å­ğŸŒ°ï¼š</p>\n<p>é™¤äº†åˆå§‹åŒ–ä¹‹åçš„ä¸€è½®æ›´æ–°ï¼š</p>\n<blockquote>\n<p>æµè§ˆå™¨ï¼šæˆ‘è¦ç»˜åˆ¶äº†ï¼</p>\n<p>Reactï¼šç­‰ç­‰ï¼Œæˆ‘æœ‰ä¸€ä¸ªå“¥ä»¬ä¸´æ—¶æœ‰äº‹è¦å¤„ç†ï¼Œä»–æ˜¯ï¼šuseLayoutEffect</p>\n<p>useLayoutEffectæ‰§è¡Œâ€¦.</p>\n<p>Reactï¼šå¥½äº†ï¼Œä½ å¯ä»¥å¼€å§‹ç»˜åˆ¶äº†ï½@æµè§ˆå™¨</p>\n<p>æµè§ˆå™¨ï¼šå¥½çš„</p>\n<p>æµè§ˆå™¨æ›´æ–°UIâ€¦</p>\n<p>æµè§ˆå™¨ï¼šæˆ‘æ›´æ–°å¥½äº†ã€‚ä½ æœ‰ä»€ä¹ˆäº‹è¦åšçš„å—ï¼Ÿ@React</p>\n<p>Reactï¼šæœ‰çš„ï¼ŒuseEffectä½ ä¸Š</p>\n<p>useEffectæ‰§è¡Œâ€¦.</p>\n</blockquote>\n<p>å¯èƒ½æœ‰ç‚¹åºŸè¯äº†ã€‚å…¶å®åŒºåˆ«å°±æ˜¯</p>\n<blockquote>\n<p>useLayoutEffect()</p>\n<p>æµè§ˆå™¨ç»˜åˆ¶</p>\n<p>useEffect()</p>\n</blockquote>\n<p>è¿™æ ·å…¶å®å¤§å®¶ä¹Ÿèƒ½å¾ˆç›´æ¥çš„çœ‹åˆ°å¼Šç«¯äº†ã€‚é‚£å°±æ˜¯useLayoutEffectå¦‚æœæœ‰å¤§é‡çš„è®¡ç®—çš„è¯ï¼Œé‚£æ ·å¯èƒ½ä¼šé˜»å¡UIæ›´æ–°ï¼Œæˆ–è€…è¯´UIæ¸²æŸ“ã€‚æ‰€ä»¥è¿˜æ˜¯è¦è°¨æ…ä½¿ç”¨ã€‚</p>\n<p>ä¸€èˆ¬æ¥è¯´ä»–ä»¬æ²¡æœ‰ä»€ä¹ˆå¤ªå¤§çš„åŒºåˆ«çš„ï¼Œå¦‚æœçœŸçš„è¦ä½¿ç”¨useLayoutEffectçš„è¯è¦è°¨æ…ä¸€äº›ã€‚ä¸ç„¶å¯èƒ½ä¼šå¯¼è‡´UIæ¸²æŸ“é˜»å¡ä¹‹ç±»çš„é—®é¢˜ã€‚</p>\n<p>ä½†æ˜¯ï¼Œä¹Ÿä¸æ˜¯æ²¡æœ‰ä½¿ç”¨åœºæ™¯ã€‚</p>\n<p>æ¯”å¦‚ä¸‹é¢çš„è¿™ä¸ªä»£ç å°±å¾ˆéœ€è¦useLayoutEffect</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">App</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [count, setCount] = useState(<span class=\"number\">0</span>);</span><br><span class=\"line\">  </span><br><span class=\"line\">  useLayoutEffect(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (count === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> randomNum = <span class=\"number\">10</span> + <span class=\"built_in\">Math</span>.random()*<span class=\"number\">200</span></span><br><span class=\"line\">      setCount(<span class=\"number\">10</span> + <span class=\"built_in\">Math</span>.random()*<span class=\"number\">200</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;, [count]);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">      &lt;div onClick=&#123;() =&gt; setCount(<span class=\"number\">0</span>)&#125;&gt;&#123;count&#125;&lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  );</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">/</span><span class=\"regexp\">/   æˆ‘æ˜¯åˆ†å‰²çº¿</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">function App() &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">  const [count, setCount] = useState(0);</span></span><br><span class=\"line\"><span class=\"regexp\">  </span></span><br><span class=\"line\"><span class=\"regexp\">  useEffect(() =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">    if (count === 0) &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">      const randomNum = 10 + Math.random()*200</span></span><br><span class=\"line\"><span class=\"regexp\">      setCount(10 + Math.random()*200);</span></span><br><span class=\"line\"><span class=\"regexp\">    &#125;</span></span><br><span class=\"line\"><span class=\"regexp\">  &#125;, [count]);</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">  return (</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;div onClick=&#123;() =&gt; setCount(0)&#125;&gt;&#123;count&#125;&lt;/</span>div&gt;</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å…¶å®æ˜ç™½çš„åŒå­¦ä¸€ä¸‹å°±çœ‹å‡ºæ¥äº†ï¼Œå¦‚æœä½¿ç”¨useEffectçš„è¯ä¼šå‡ºç°é—ªçƒï¼Œä¼šå…ˆå›åˆ°0ç„¶åå†æ›´æ–°æ–°çš„éšæœºæ•°ã€‚è€Œåè§‚useLayoutEffectåˆ™ä¸ä¼šï¼Œä»–ä¼šå¾ˆè‡ªç„¶çš„è¿‡æ¸¡ã€‚</p>\n<p>æ€»ç»“ï¼š</p>\n<p>useLayoutEffectçš„ä½¿ç”¨åœºæ™¯ä¸ºï¼šæœ‰ä¸€ä¸ªä¸­é—´çŠ¶æ€å¸Œæœ›éšè—çš„æ—¶å€™å†ä½¿ç”¨ã€‚</p>\n<p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹useEffectå¯ä»¥é€‚ç”¨äº99%çš„åœºæ™¯ã€‚</p>\n<h4 id=\"useEffectçš„é”™è¯¯äº‹ä¾‹ã€‚çœ‹çœ‹æœ‰æ²¡æœ‰ä½ \"><a href=\"#useEffectçš„é”™è¯¯äº‹ä¾‹ã€‚çœ‹çœ‹æœ‰æ²¡æœ‰ä½ \" class=\"headerlink\" title=\"useEffectçš„é”™è¯¯äº‹ä¾‹ã€‚çœ‹çœ‹æœ‰æ²¡æœ‰ä½ \"></a>useEffectçš„é”™è¯¯äº‹ä¾‹ã€‚çœ‹çœ‹æœ‰æ²¡æœ‰ä½ </h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">SearchResults</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [query, setQuery] = useState(<span class=\"string\">'react'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Imagine this function is also long</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getFetchUrl</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">'https://hn.algolia.com/api/v1/search?query='</span> + query;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Imagine this function is also long</span></span><br><span class=\"line\">  <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fetchData</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> result = <span class=\"keyword\">await</span> axios(getFetchUrl());</span><br><span class=\"line\">    setData(result.data);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  useEffect(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    fetchData();</span><br><span class=\"line\">  &#125;, []);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"ä¸ºä»€ä¹ˆé”™äº†ï¼Ÿ\"><a href=\"#ä¸ºä»€ä¹ˆé”™äº†ï¼Ÿ\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆé”™äº†ï¼Ÿ\"></a>ä¸ºä»€ä¹ˆé”™äº†ï¼Ÿ</h4><p>ä¸éš¾çœ‹å‡ºä¸Šé¢ä»£ç çš„æ„æ€æ˜¯ã€‚æƒ³è¦æ¨¡ä»¿componentDidMountçš„ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨é¡µé¢æˆ–è€…ç»„ä»¶åŠ è½½ä¹‹åå‘é€ä¸€ä¸ªè¯·æ±‚ã€‚å’‹ä¸€çœ‹å¥½åƒæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼ˆå®é™…åœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­ä¹Ÿæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œåœ¨å†™è¿™ç¯‡æ–‡ç« ä¹‹å‰æˆ‘ä¹Ÿæ˜¯è¿™ä¹ˆåšçš„ã€‚ï¼‰</p>\n<p>ä½†æ˜¯å¤§å®¶å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœè¿™ä¸ªå‡½æ•°ç»„ä»¶ï¼Œæ˜¯ç°åœ¨çš„5å€å¤§ï¼Œè¿™ä¸ªdidMounté‡Œé¢è°ƒç”¨çš„è¯·æ±‚ï¼Œæœªæ¥ä¾èµ–çš„ä¸œè¥¿ä½ éƒ½å¯ä»¥100%çš„å¯Ÿè§‰åˆ°å—ï¼Ÿ</p>\n<p>æˆ‘è§‰å¾—éš¾ï¼éš¾å…ä¼šæœ‰ç–å¿½ã€‚åˆ°æ—¶å€™å¯èƒ½å°±ä¼šå‡ºç°stateæˆ–è€…propsè¯»å–é”™è¯¯çš„æƒ…å†µã€‚å› ä¸ºæ¯ä¸€æ¬¡renderçš„stateå’Œpropséƒ½æ˜¯ç‹¬ç«‹çš„ã€‚</p>\n<p>é‚£ä¹ˆï¼Œè¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿ</p>\n<p>æœ‰ä¸€ä¸ªå¾ˆåœŸçš„åŠæ³•ï¼Œç›´æ¥æŠŠå‡½æ•°æ‰”åˆ°useEffecté‡Œé¢å»</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">SearchResults</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">  useEffect(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// We moved these functions inside!    </span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getFetchUrl</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">'https://hn.algolia.com/api/v1/search?query=react'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">fetchData</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> result = <span class=\"keyword\">await</span> axios(getFetchUrl());</span><br><span class=\"line\">      setData(result.data);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    fetchData();</span><br><span class=\"line\">  &#125;, []); <span class=\"comment\">// âœ… Deps are OK</span></span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>é‚£é«˜çº§ç‚¹çš„åŠæ³•å‘¢ï¼Ÿ</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">SearchResults</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// âœ… Preserves identity when its own deps are the same</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> getFetchUrl = useCallback(<span class=\"function\">(<span class=\"params\">query</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">'https://hn.algolia.com/api/v1/search?query='</span> + query;</span><br><span class=\"line\">  &#125;, []);  <span class=\"comment\">// âœ… Callback deps are OK</span></span><br><span class=\"line\"></span><br><span class=\"line\">  useEffect(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> url = getFetchUrl(<span class=\"string\">'react'</span>);</span><br><span class=\"line\">    <span class=\"comment\">// ... Fetch data and do something ...</span></span><br><span class=\"line\">  &#125;, [getFetchUrl]); <span class=\"comment\">// âœ… Effect deps are OK</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å°†å‡½æ•°ç”¨useCallbackåŒ…è£¹ï¼Œè¿™æ ·çš„è¯æˆ‘ä»¬åªéœ€è¦åšuseEffectçš„ä¾èµ–é‡Œé¢å†™ä¸Šæˆ‘ä»¬çš„å‡½æ•°ï¼Œç„¶ååœ¨useCallbacké‡Œé¢å†™ä¸Šæˆ‘ä»¬çš„ä¾èµ–ã€‚</p>\n<h4 id=\"æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ¯ä¸€æ¬¡effectéƒ½æ˜¯å…¨æ–°çš„stateå’Œpropsï¼Œé‚£æˆ‘è¦å¦‚ä½•è·å¾—ä¸Šä¸€è½®æ›´æ–°çš„stateå‘¢ï¼Ÿ\"><a href=\"#æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ¯ä¸€æ¬¡effectéƒ½æ˜¯å…¨æ–°çš„stateå’Œpropsï¼Œé‚£æˆ‘è¦å¦‚ä½•è·å¾—ä¸Šä¸€è½®æ›´æ–°çš„stateå‘¢ï¼Ÿ\" class=\"headerlink\" title=\"æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ¯ä¸€æ¬¡effectéƒ½æ˜¯å…¨æ–°çš„stateå’Œpropsï¼Œé‚£æˆ‘è¦å¦‚ä½•è·å¾—ä¸Šä¸€è½®æ›´æ–°çš„stateå‘¢ï¼Ÿ\"></a>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ¯ä¸€æ¬¡effectéƒ½æ˜¯å…¨æ–°çš„stateå’Œpropsï¼Œé‚£æˆ‘è¦å¦‚ä½•è·å¾—ä¸Šä¸€è½®æ›´æ–°çš„stateå‘¢ï¼Ÿ</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Counter</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [count, setCount] = useState(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> prevCountRef = useRef();</span><br><span class=\"line\">  useEffect(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    prevCountRef.current = count;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> prevCount = prevCountRef.current;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Now: &#123;count&#125;, before: &#123;prevCount&#125;<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å…¶å®å¾ˆå¥½ç†è§£ï¼Œå¦‚æœçœ‹äº†å‰é¢useEffectå’ŒuseLayoutEffectåŒºåˆ«çš„åŒå­¦ä¸€ä¸‹å°±å¯ä»¥çŸ¥é“è¿™ä¸ªçš„å®ç°åŸç†ã€‚</p>\n<p>é¦–å…ˆï¼Œåœ¨ä¸€åˆ‡éƒ½æ›´æ–°ä¹‹åï¼Œç„¶åä¼šä¼šæ‰§è¡ŒuseEffectå†…éƒ¨çš„å›è°ƒå‡½æ•°ï¼Œå°†prevCountç»™èµ‹å€¼ï¼Œç”±äºæ²¡æœ‰è§¦å‘æ¸²æŸ“ï¼Œæ‰€ä»¥åªæ˜¯å•çº¯çš„èµ‹å€¼ã€‚è¿™æ ·å°±çœ‹èµ·æ¥prevCountçš„å€¼æ°¸è¿œéƒ½æ…¢ä¸€æ­¥ã€‚</p>\n<h3 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h3><p>å…¶å®åœ¨å­¦ä¹ useEffectçš„æ—¶å€™ã€‚åº”è¯¥å¿˜è®°ä½ å¯¹Reactçš„ä¸€äº›çŸ¥è¯†ã€‚æ¯”å¦‚ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨å‡½æ•°ç»„ä»¶é‡Œé¢æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸè¿™ä¸ªæ¦‚å¿µäº†ã€‚</p>\n<p>æ¯ä¸€æ¬¡çš„renderä»–éƒ½æœ‰è‡ªå·±çš„stateå’Œpropsã€‚stateå’Œpropsæ›´åº”è¯¥è¢«çœ‹ä½œä¸€ä¸ªå¸¸é‡ï¼Œå“ªæ€•æ˜¯const bar = xxè¿™æ ·çš„å¸¸é‡ã€‚è¿™æ ·ç†è§£èµ·æ¥useEffectè¿™ä¸ªå‰¯ä½œç”¨å…¶å®ä¼šæ›´åŠ é¡ºç•…ï¼Œä¹Ÿä¸å®¹æ˜“è¿›å…¥ä»–çš„â€œé™·é˜±â€</p>\n<h2 id=\"useRef\"><a href=\"#useRef\" class=\"headerlink\" title=\"useRef\"></a>useRef</h2><h3 id=\"å‰è¨€-1\"><a href=\"#å‰è¨€-1\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h3><p>ä¸ºä»€ä¹ˆæˆ‘æŠŠuseRefå•ç‹¬æ‹å‡ºæ¥è¯´ï¼Œä¸æŠŠä»–å’Œ<code>useImperativeHandle</code>æ”¾åœ¨ä¸€èµ·è®²ï¼Œå› ä¸º</p>\n<blockquote>\n<p>ï¼ˆå®˜ç½‘åŸè¯ï¼‰å®ƒåˆ›å»ºçš„æ˜¯ä¸€ä¸ªæ™®é€š Javascript å¯¹è±¡ã€‚è€Œ <code>useRef()</code> å’Œè‡ªå»ºä¸€ä¸ª <code>{current: ...}</code> å¯¹è±¡çš„å”¯ä¸€åŒºåˆ«æ˜¯ï¼Œ<code>useRef</code> ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“æ—¶è¿”å›åŒä¸€ä¸ª ref å¯¹è±¡ã€‚</p>\n</blockquote>\n<p>è®°ä½<code>useRef</code>ä¸å•å•ç”¨äºè·å–<code>DOMèŠ‚ç‚¹å’Œç»„ä»¶å®ä¾‹</code>ï¼Œè¿˜æœ‰ä¸€ä¸ªå·§å¦™çš„ç”¨æ³•å°±æ˜¯<code>ä½œä¸ºå®¹å™¨ä¿ç•™å¯å˜å˜é‡</code>ï¼Œå¯ä»¥è¿™æ ·è¯´ï¼š<code>æ— æ³•è‡ªå¦‚åœ°ä½¿ç”¨useRefä¼šè®©ä½ å¤±å»hookå°†è¿‘ä¸€åŠçš„èƒ½åŠ›</code></p>\n<h4 id=\"useRef-ä¸-createRef-çš„åŒºåˆ«\"><a href=\"#useRef-ä¸-createRef-çš„åŒºåˆ«\" class=\"headerlink\" title=\"useRef ä¸ createRef çš„åŒºåˆ«\"></a>useRef ä¸ createRef çš„åŒºåˆ«</h4><p><code>useRef</code> ä»…èƒ½ç”¨åœ¨ FunctionComponentï¼Œ<code>createRef</code> ä»…èƒ½ç”¨åœ¨ ClassComponentã€‚</p>\n<p><code>useRef</code> ä»…èƒ½ç”¨åœ¨ FunctionComponentï¼Œ<code>createRef</code> ä»…èƒ½ç”¨åœ¨ ClassComponentã€‚</p>\n<p>ç¬¬ä¸€å¥è¯æ˜¯æ˜¾ç„¶çš„ï¼Œå› ä¸º Hooks ä¸èƒ½ç”¨åœ¨ ClassComponentã€‚</p>\n<p>ç¬¬äºŒå¥è¯çš„åŸå› æ˜¯ï¼Œ<code>createRef</code> å¹¶æ²¡æœ‰ Hooks çš„æ•ˆæœï¼Œå…¶å€¼ä¼šéšç€ FunctionComponent é‡å¤æ‰§è¡Œè€Œä¸æ–­è¢«åˆå§‹åŒ–ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function App() &#123;</span><br><span class=\"line\">  &#x2F;&#x2F; é”™è¯¯ç”¨æ³•ï¼Œæ°¸è¿œä¹Ÿæ‹¿ä¸åˆ° ref</span><br><span class=\"line\">  const valueRef &#x3D; React.createRef();</span><br><span class=\"line\">  return &lt;div ref&#x3D;&#123;valueRef&#125; &#x2F;&gt;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>\n\n<p>ä¸Šè¿° <code>valueRef</code> ä¼šéšç€ App å‡½æ•°çš„ Render è€Œé‡å¤åˆå§‹åŒ–ï¼Œ<strong>è¿™ä¹Ÿæ˜¯ Hooks çš„ç‹¬ç‰¹ä¹‹å¤„ï¼Œè™½ç„¶ç”¨åœ¨æ™®é€šå‡½æ•°ä¸­ï¼Œä½†åœ¨ React å¼•æ“ä¸­ä¼šå¾—åˆ°è¶…å‡ºæ™®é€šå‡½æ•°çš„è¡¨ç°ï¼Œæ¯”å¦‚åˆå§‹åŒ–ä»…æ‰§è¡Œä¸€æ¬¡ï¼Œæˆ–è€…å¼•ç”¨ä¸å˜</strong>ã€‚</p>\n<p>ä¸ºä»€ä¹ˆ <code>createRef</code> å¯ä»¥åœ¨ ClassComponent æ­£å¸¸è¿è¡Œå‘¢ï¼Ÿè¿™æ˜¯å› ä¸º ClassComponent åˆ†ç¦»äº†ç”Ÿå‘½å‘¨æœŸï¼Œä½¿ä¾‹å¦‚ <code>componentDidMount</code> ç­‰åˆå§‹åŒ–æ—¶æœºä»…æ‰§è¡Œä¸€æ¬¡ã€‚</p>\n<h4 id=\"å¦‚ä½•è§£å†³æ¯æ¬¡renderå¸¦æ¥ç±»é—­åŒ…é—®é¢˜ï¼Ÿ\"><a href=\"#å¦‚ä½•è§£å†³æ¯æ¬¡renderå¸¦æ¥ç±»é—­åŒ…é—®é¢˜ï¼Ÿ\" class=\"headerlink\" title=\"å¦‚ä½•è§£å†³æ¯æ¬¡renderå¸¦æ¥ç±»é—­åŒ…é—®é¢˜ï¼Ÿ\"></a>å¦‚ä½•è§£å†³æ¯æ¬¡renderå¸¦æ¥ç±»é—­åŒ…é—®é¢˜ï¼Ÿ</h4><p>é¦–å…ˆï¼Œé¢˜ç›®æ€ä¹ˆç†è§£ï¼Ÿ<a href=\"https://codesandbox.io/s/w2wxl3yo0l\" target=\"_blank\" rel=\"noopener\">é¢˜ç›®</a></p>\n<p>å¦‚æœæˆ‘ä»¬å¸Œæœ›ä»–alertçš„æ—¶å€™å¯ä»¥è·å–åˆ°æœ€æ–°çš„å€¼çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨useRefæ¥è§£å†³</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> Counter = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [count, setCount] = useState&lt;number&gt;(<span class=\"number\">0</span>)</span><br><span class=\"line\">  <span class=\"keyword\">const</span> countRef = useRef&lt;number&gt;(count)</span><br><span class=\"line\"></span><br><span class=\"line\">  useEffect(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    countRef.current = count</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> handleCount = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      alert(<span class=\"string\">'current count: '</span> + countRef.current)</span><br><span class=\"line\">    &#125;, <span class=\"number\">3000</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> Counter</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"memo\"><a href=\"#memo\" class=\"headerlink\" title=\"memo\"></a>memo</h2><h4 id=\"memoæ²¡æœ‰å›è°ƒå‡½æ•°çš„è¯æ˜¯æ€ä¹ˆæµ…æ¯”è¾ƒçš„ï¼Ÿ\"><a href=\"#memoæ²¡æœ‰å›è°ƒå‡½æ•°çš„è¯æ˜¯æ€ä¹ˆæµ…æ¯”è¾ƒçš„ï¼Ÿ\" class=\"headerlink\" title=\"memoæ²¡æœ‰å›è°ƒå‡½æ•°çš„è¯æ˜¯æ€ä¹ˆæµ…æ¯”è¾ƒçš„ï¼Ÿ\"></a>memoæ²¡æœ‰å›è°ƒå‡½æ•°çš„è¯æ˜¯æ€ä¹ˆæµ…æ¯”è¾ƒçš„ï¼Ÿ</h4><p>å…ˆæ¥çœ‹çœ‹memoæ²¡æœ‰å›è°ƒå‡½æ•°çš„æ—¶å€™ä»–åšäº†ä»€ä¹ˆã€‚</p>\n<p>memoå®ƒæ˜¯ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰ä»–ä¸React.PureComponentååˆ†ç›¸ä¼¼ã€‚é™¤äº†ä½¿ç”¨çš„åœ°æ–¹ä¸åŒï¼ˆClassç»„ä»¶å’ŒFunctionç»„ä»¶ï¼‰ä¹‹å¤–å‡ ä¹ä¸€è‡´ã€‚</p>\n<p>Memoå†…éƒ¨å’ŒPureComponentä¸€æ ·ä½¿ç”¨Object.isç”¨äºå‰å¯¹æ¯”ï¼Œå¦‚æœä¼ å…¥çš„propså†…å­˜åœ°å€ä¸å˜çš„è¯ï¼Œé‚£å°±ä¸ä¼šæ¸²æŸ“äº†ï¼ˆæˆ–è€…è¯´å¤ç”¨æœ€è¿‘çš„ä¸€æ¬¡æ¸²æŸ“ï¼‰ã€‚</p>\n<p>ä¸‹é¢å¯ä»¥çœ‹æºç äº‹ä¾‹</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">updateMemoComponent</span>(<span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  current: Fiber | null,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  workInProgress: Fiber,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  Component: any,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  nextProps: any,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  updateExpirationTime,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">  renderExpirationTime: ExpirationTime,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\"></span>): <span class=\"title\">null</span> | <span class=\"title\">Fiber</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/* ...çœç•¥...*/</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// åˆ¤æ–­æ›´æ–°çš„è¿‡æœŸæ—¶é—´æ˜¯å¦å°äºæ¸²æŸ“çš„è¿‡æœŸæ—¶é—´</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (updateExpirationTime &lt; renderExpirationTime) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> prevProps = currentChild.memoizedProps;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœè‡ªå®šä¹‰äº†compareå‡½æ•°ï¼Œåˆ™é‡‡ç”¨è‡ªå®šä¹‰çš„compareå‡½æ•°ï¼Œå¦åˆ™é‡‡ç”¨å®˜æ–¹çš„shallowEqual(æµ…æ¯”è¾ƒ)å‡½æ•°ã€‚ï¼ˆä¸‹é¢æœ‰è§£æï¼‰</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> compare = Component.compare;</span><br><span class=\"line\">    compare = compare !== <span class=\"literal\">null</span> ? compare : shallowEqual;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 1. åˆ¤æ–­å½“å‰ props ä¸ nextProps æ˜¯å¦ç›¸ç­‰ï¼›</span></span><br><span class=\"line\"><span class=\"comment\">     * 2. åˆ¤æ–­å³å°†æ¸²æŸ“ç»„ä»¶çš„å¼•ç”¨æ˜¯å¦ä¸workInProgress Fiberä¸­çš„å¼•ç”¨æ˜¯å¦ä¸€è‡´ï¼›</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * åªæœ‰ä¸¤è€…éƒ½ä¸ºçœŸï¼Œæ‰ä¼šé€€å‡ºæ¸²æŸ“ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (compare(prevProps, nextProps) &amp;&amp; current.ref === workInProgress.ref) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// å¦‚æœéƒ½ä¸ºçœŸï¼Œåˆ™é€€å‡ºæ¸²æŸ“</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> bailoutOnAlreadyFinishedWork(</span><br><span class=\"line\">        current,</span><br><span class=\"line\">        workInProgress,</span><br><span class=\"line\">        renderExpirationTime,</span><br><span class=\"line\">      );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/* ...çœç•¥...*/</span></span><br></pre></td></tr></table></figure>\n\n<p>shallowEqualï¼ˆæµ…æ¯”è¾ƒï¼‰</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ç”¨åŸå‹é“¾çš„æ–¹æ³•</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> hasOwn = <span class=\"built_in\">Object</span>.prototype.hasOwnProperty</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è¿™ä¸ªå‡½æ•°å®é™…ä¸Šæ˜¯Object.is()çš„polyfill</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">is</span>(<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (x === y) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x !== <span class=\"number\">0</span> || y !== <span class=\"number\">0</span> || <span class=\"number\">1</span> / x === <span class=\"number\">1</span> / y</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> x !== x &amp;&amp; y !== y</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">shallowEqual</span>(<span class=\"params\">objA, objB</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// é¦–å…ˆå¯¹åŸºæœ¬æ•°æ®ç±»å‹çš„æ¯”è¾ƒ</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (is(objA, objB)) <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"comment\">// ç”±äºObejct.is()å¯ä»¥å¯¹åŸºæœ¬æ•°æ®ç±»å‹åšä¸€ä¸ªç²¾ç¡®çš„æ¯”è¾ƒï¼Œ æ‰€ä»¥å¦‚æœä¸ç­‰</span></span><br><span class=\"line\">  <span class=\"comment\">// åªæœ‰ä¸€ç§æƒ…å†µæ˜¯è¯¯åˆ¤çš„ï¼Œé‚£å°±æ˜¯object,æ‰€ä»¥åœ¨åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡éƒ½ä¸æ˜¯object</span></span><br><span class=\"line\">  <span class=\"comment\">// ä¹‹åï¼Œå°±å¯ä»¥è¿”å›falseäº†</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> objA !== <span class=\"string\">'object'</span> || objA === <span class=\"literal\">null</span> ||</span><br><span class=\"line\">      <span class=\"keyword\">typeof</span> objB !== <span class=\"string\">'object'</span> || objB === <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// è¿‡æ»¤æ‰åŸºæœ¬æ•°æ®ç±»å‹ä¹‹åï¼Œå°±æ˜¯å¯¹å¯¹è±¡çš„æ¯”è¾ƒäº†</span></span><br><span class=\"line\">  <span class=\"comment\">// é¦–å…ˆæ‹¿å‡ºkeyå€¼ï¼Œå¯¹keyçš„é•¿åº¦è¿›è¡Œå¯¹æ¯”</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> keysA = <span class=\"built_in\">Object</span>.keys(objA)</span><br><span class=\"line\">  <span class=\"keyword\">const</span> keysB = <span class=\"built_in\">Object</span>.keys(objB)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// é•¿åº¦ä¸ç­‰ç›´æ¥è¿”å›false</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (keysA.length !== keysB.length) <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"comment\">// keyç›¸ç­‰çš„æƒ…å†µä¸‹ï¼Œåœ¨å»å¾ªç¯æ¯”è¾ƒ</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; keysA.length; i++) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// keyå€¼ç›¸ç­‰çš„æ—¶å€™</span></span><br><span class=\"line\">  <span class=\"comment\">// å€Ÿç”¨åŸå‹é“¾ä¸ŠçœŸæ­£çš„ hasOwnProperty æ–¹æ³•ï¼Œåˆ¤æ–­ObjBé‡Œé¢æ˜¯å¦æœ‰Açš„keyçš„keyå€¼</span></span><br><span class=\"line\">  <span class=\"comment\">// å±æ€§çš„é¡ºåºä¸å½±å“ç»“æœä¹Ÿå°±æ˜¯&#123;name:'daisy', age:'24'&#125; è·Ÿ&#123;age:'24'ï¼Œname:'daisy' &#125;æ˜¯ä¸€æ ·çš„</span></span><br><span class=\"line\">  <span class=\"comment\">// æœ€åï¼Œå¯¹å¯¹è±¡çš„valueè¿›è¡Œä¸€ä¸ªåŸºæœ¬æ•°æ®ç±»å‹çš„æ¯”è¾ƒï¼Œè¿”å›ç»“æœ</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!hasOwn.call(objB, keysA[i]) ||</span><br><span class=\"line\">        !is(objA[keysA[i]], objB[keysA[i]])) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> truea</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ç”±æºç å¯ä»¥çŸ¥é“ï¼ŒåŠ å…¥æ²¡æœ‰ä¼ ä¸€ä¸ªæ¯”è¾ƒçš„å›è°ƒå‡½æ•°ä¼šä½¿ç”¨å®˜æ–¹çš„æµ…æ¯”è¾ƒã€‚å…·ä½“çš„å¯ä»¥çœ‹æ³¨é‡Š</p>\n<h4 id=\"memoçš„å›è°ƒå‡½æ•°\"><a href=\"#memoçš„å›è°ƒå‡½æ•°\" class=\"headerlink\" title=\"memoçš„å›è°ƒå‡½æ•°\"></a>memoçš„å›è°ƒå‡½æ•°</h4><p>æˆ‘ä»¬éƒ½çŸ¥é“reactçš„ç”Ÿå‘½å‘¨æœŸä¸­æœ‰ä¸€ä¸ªshouldComponentUpdateã€‚åœ¨è¿™ä¸ªå‡½æ•°ä¸­è¿”å›trueçš„è¯å°±ä»£è¡¨æœ¬æ¬¡renderéœ€è¦æ‰§è¡Œï¼Œè€Œè¿”å›falseå°±å¯ä»¥è·³è¿‡æœ¬æ¬¡çš„renderã€‚</p>\n<p>è€Œmemoæ­£å¥½ç›¸åï¼Œè¿”å›trueè¡¨ç¤ºæœ¬æ¬¡è·³è¿‡ï¼Œè¿”å›falseå°±è¡¨ç¤ºæœ¬æ¬¡éœ€è¦æ‰§è¡Œrenderã€‚</p>\n<p>å…·ä½“æ€ä¹ˆç”¨å‘¢ï¼Ÿ</p>\n<p>å¤§å®¶å¯ä»¥è‡ªå·±è¿è¡Œä¸€ä¸‹ï¼Œçœ‹çœ‹æ•ˆæœã€‚ä¸€å®šè¦è‡ªå·±è¯•ä¸€ä¸‹ï¼Œä¸ç„¶å¾ˆå®¹æ˜“å’ŒshouldComponentUpdateå¼„æ··äº†ã€‚å­¦ä¹ è¿˜æ˜¯è¦è‡ªå·±åŠ¨æ‰‹æ‰è¡Œã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">ChangeLog</span>(<span class=\"params\">&#123;w = <span class=\"string\">''</span>&#125;</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// çœç•¥</span></span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'====render===='</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> memo(ChangeLog, (prevProps, nextProps) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (prevProps.w !== nextProps.w) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"useMemo-useCallback\"><a href=\"#useMemo-useCallback\" class=\"headerlink\" title=\"useMemo/useCallback\"></a>useMemo/useCallback</h2><h3 id=\"å‰è¨€-2\"><a href=\"#å‰è¨€-2\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h3><p>ä¹‹æ‰€ä»¥æŠŠè¿™useMomo/useCallackä¸¤å…„å¼Ÿå’Œåœ¨ä¸€èµ·ã€‚æ˜¯å› ä¸ºä»–ä»¬å…¶å®ååˆ†ç›¸ä¼¼ã€‚</p>\n<blockquote>\n<p>ä¸€ä¸ªæ˜¯ç¼“å­˜å˜é‡ï¼ˆuseMemoï¼‰ï¼Œä¸€ä¸ªæ˜¯ç¼“å­˜å‡½æ•°ï¼ˆuseCallbackï¼‰ã€‚</p>\n</blockquote>\n<p>å…¶å®è¿™ä¹ˆä¸€è¯´å°±æ¸…æ™°å¾ˆå¤šäº†ã€‚</p>\n<p>å…·ä½“çš„ä½¿ç”¨å’ŒuseEffectä¸€æ ·ï¼Œéƒ½æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè°ƒç”¨æ—¶çš„å›è°ƒå‡½æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è°ƒç”¨åˆ¤æ–­æ‰€ç›‘å¬çš„å€¼ï¼ˆå¯ä»¥æ˜¯å˜é‡ï¼Œä¹Ÿå¯ä»¥æ˜¯å‡½æ•°ï¼‰</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> memoizedValue = useMemo(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> computeExpensiveValue(a, b), [a, b]);</span><br><span class=\"line\"><span class=\"keyword\">const</span> memoizedValue = useCallback(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> computeExpensiveValue(a, b), [a, b]);</span><br></pre></td></tr></table></figure>\n\n<p>useMemo() è¿”å›çš„æ˜¯ä¸€ä¸ª memoized å€¼ï¼Œåªæœ‰å½“ä¾èµ–é¡¹ï¼ˆæ¯”å¦‚ä¸Šé¢çš„ a,b å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œæ‰ä¼šé‡æ–°è®¡ç®—è¿™ä¸ª memoized å€¼ï¼‰</p>\n<p>memoized å€¼ä¸å˜çš„æƒ…å†µä¸‹ï¼Œä¸ä¼šé‡æ–°è§¦å‘æ¸²æŸ“é€»è¾‘ã€‚</p>\n<p>è¯´èµ·æ¸²æŸ“é€»è¾‘ï¼Œéœ€è¦è®°ä½çš„æ˜¯ useMemo() æ˜¯åœ¨ render æœŸé—´æ‰§è¡Œçš„ï¼Œæ‰€ä»¥ä¸èƒ½è¿›è¡Œä¸€äº›é¢å¤–çš„å‰¯æ“ä½œï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚ç­‰ã€‚</p>\n<p>å¦‚æœæ²¡æœ‰æä¾›ä¾èµ–æ•°ç»„ï¼ˆä¸Šé¢çš„ [a,b]ï¼‰åˆ™æ¯æ¬¡éƒ½ä¼šé‡æ–°è®¡ç®— memoized å€¼ï¼Œä¹Ÿå°±ä¼š re-redner</p>\n<p>useCallbackä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œå°±ä¸å¤šèµ˜è¿°äº†ã€‚</p>\n<h2 id=\"useReducer-useContext\"><a href=\"#useReducer-useContext\" class=\"headerlink\" title=\"useReducer/useContext\"></a>useReducer/useContext</h2><h3 id=\"å‰è¨€-3\"><a href=\"#å‰è¨€-3\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h3><p>å¸®ä»–ä»¬ä¸¤å…„å¼Ÿå’Œåœ¨ä¸€èµ·è¯´ä¸»è¦è¯´å› ä¸ºä»–ä»¬ä¸¤å…„å¼Ÿåœ¨ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯å¯ä»¥ä¸Reduxä¸€æˆ˜çš„ã€‚</p>\n<p>ä½†æ˜¯ï¼ï¼</p>\n<p>ä½†æ˜¯å•Šï¼Œä½†æ˜¯å¦‚æœä½ éœ€è¦ä¸­é—´ä»·ï¼Œæˆ–è€…è¯´éœ€è¦â€œæ—¶é—´æ—…è¡Œâ€ï¼Œåˆæˆ–è€…ä¸´æ—¶éœ€è¦è·¨é¡µé¢çº§çš„æ•°æ®å…±äº«ï¼Œé‚£ä½ è¿˜æ˜¯éœ€è¦reduxæ¥è§£å†³çš„ã€‚ä¸è¿‡åŸºæœ¬ä¸Šçš„åœºæ™¯æˆ‘ä»¬ä½¿ç”¨useReducerå’ŒuseContextå°±å¯ä»¥å®Œç¾çš„æ›¿ä»£reduxäº†ã€‚</p>\n<h3 id=\"æ€ä¹ˆåšï¼Ÿ\"><a href=\"#æ€ä¹ˆåšï¼Ÿ\" class=\"headerlink\" title=\"æ€ä¹ˆåšï¼Ÿ\"></a>æ€ä¹ˆåšï¼Ÿ</h3><p>å…¶å®ä¹‹å‰ç”±äºè¦èµ·ä¸€ä¸ªæ–°é¡¹ç›®ï¼Œä½†æ˜¯çªç„¶å‘ç°æœ‰ä¸€ä¸ªçˆ·çˆ·ç»„ä»¶çš„å€¼ä¸ºéœ€è¦é€šçŸ¥ç»™å­™å­ç»„ä»¶ï¼Œç„¶åå­™å­ç»„ä»¶å¯èƒ½ä¼šç”¨æ‰å›è°ƒå‡½æ•°è°ƒç”¨çˆ·çˆ·ç»„ä»¶çš„æ–¹æ³•ã€‚é‚£ä¸ªæ—¶å€™å…¶å®å·²ç»ç”¨Hookå†™äº†ä¸€åŠäº†ï¼Œæ‡’å¾—åŠ Reduxäº†ï¼Œåˆä¸æƒ³ä¸€å±‚å±‚ä¼ propsä¸‹å»ã€‚æ€ä¹ˆåŠï¼Ÿ</p>\n<p>é€šè¿‡äº†è§£ï¼Œæˆ‘çŸ¥é“äº†useReducer/useContextåˆšåˆšå¥½å¯ä»¥è§£å†³æˆ‘çš„éœ€æ±‚ã€‚</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> TodosDispatch = React.createContext(<span class=\"literal\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> initialState = &#123; <span class=\"attr\">bar</span>: <span class=\"literal\">null</span> &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">reducer</span>(<span class=\"params\">state, action</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">switch</span> (action.type) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'setCenter'</span>:</span><br><span class=\"line\">      <span class=\"keyword\">return</span> &#123; ...state, <span class=\"attr\">bar</span>: action.bar &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">default</span>:</span><br><span class=\"line\">      <span class=\"keyword\">return</span> state</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è™½ç„¶è¿™ä¸ªæ˜¯è‡ªç»„ä»¶ï¼Œä½†æ˜¯å“ªæ€•æ˜¯æ›¾æ›¾æ›¾å­™å­ç»„ä»¶éƒ½å¯ä»¥ç›´æ¥ç”¨useContextæ‹¿åˆ°dispatch</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">DeepChild</span>(<span class=\"params\">props</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// å¦‚æœæˆ‘ä»¬æƒ³è¦æ‰§è¡Œä¸€ä¸ª actionï¼Œæˆ‘ä»¬å¯ä»¥ä» context ä¸­è·å– dispatchã€‚</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> dispatch = useContext(TodosDispatch);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleClick</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    dispatch(&#123; <span class=\"attr\">type</span>: <span class=\"string\">'add'</span>, <span class=\"attr\">text</span>: <span class=\"string\">'hello'</span> &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    &lt;button onClick=&#123;handleClick&#125;&gt;Add todo&lt;<span class=\"regexp\">/button&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  );</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">function TodosApp() &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">  /</span><span class=\"regexp\">/ æç¤ºï¼š`dispatch` ä¸ä¼šåœ¨é‡æ–°æ¸²æŸ“ä¹‹é—´å˜åŒ–</span></span><br><span class=\"line\"><span class=\"regexp\">  const [state, dispatch] = useReducer(reducer, initialState);</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">  return (</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;TodosDispatch.Provider value=&#123;dispatch&#125;&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">      &lt;DeepTree todos=&#123;todos&#125; /</span>&gt;</span><br><span class=\"line\">    &lt;<span class=\"regexp\">/TodosDispatch.Provider&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  );</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"useImperativeHandle-forwardRef\"><a href=\"#useImperativeHandle-forwardRef\" class=\"headerlink\" title=\"useImperativeHandle/forwardRef\"></a>useImperativeHandle/forwardRef</h2><p>è¿™é‡Œå°±ä¸å¤šè¯´äº†ï¼ŒåŸºæœ¬ä¸Šæ²¡æœ‰ä»€ä¹ˆå‘ç‚¹å’Œç–‘éš¾ç‚¹ã€‚</p>\n<p>è¯´ä¸€ä¸‹åŸºæœ¬ç”¨æ³•å’Œant-design formä¸­çš„ä½¿ç”¨</p>\n<h3 id=\"æ­£å¸¸ä½¿ç”¨\"><a href=\"#æ­£å¸¸ä½¿ç”¨\" class=\"headerlink\" title=\"æ­£å¸¸ä½¿ç”¨\"></a>æ­£å¸¸ä½¿ç”¨</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useImperativeHandle(ref, createHandle, [deps])</span><br></pre></td></tr></table></figure>\n\n<p><code>useImperativeHandle</code> å¯ä»¥è®©ä½ åœ¨ä½¿ç”¨ <code>ref</code> æ—¶è‡ªå®šä¹‰æš´éœ²ç»™çˆ¶ç»„ä»¶çš„å®ä¾‹å€¼ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåº”å½“é¿å…ä½¿ç”¨ ref è¿™æ ·çš„å‘½ä»¤å¼ä»£ç ã€‚<code>useImperativeHandle</code> åº”å½“ä¸ <code>forwardRef</code>ä¸€èµ·ä½¿ç”¨ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">FancyInput</span>(<span class=\"params\">props, ref</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> inputRef = useRef();</span><br><span class=\"line\">  useImperativeHandle(ref, () =&gt; (&#123;</span><br><span class=\"line\">    focus: <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">      inputRef.current.focus();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;));</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">ref</span>=<span class=\"string\">&#123;inputRef&#125;</span> <span class=\"attr\">...</span> /&gt;</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">FancyInput = forwardRef(FancyInput);</span><br></pre></td></tr></table></figure>\n\n<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œæ¸²æŸ“<FancyInput ref={inputRef} />çš„çˆ¶ç»„ä»¶å¯ä»¥è°ƒç”¨ <code>inputRef.current.focus()</code>ã€‚</p>\n<h3 id=\"ant-design-form\"><a href=\"#ant-design-form\" class=\"headerlink\" title=\"ant-design form\"></a>ant-design form</h3><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// refä»ç¬¬äºŒä¸ªå‚æ•°å–ï¼Œè¿™é‡Œéƒ½æ˜¯ä¸€è‡´çš„</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> Example = <span class=\"function\">(<span class=\"params\">props,ref</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> bar = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;&#125;</span><br><span class=\"line\">  useImperativeHandle(ref, () =&gt; (&#123;</span><br><span class=\"line\">    text: bar,</span><br><span class=\"line\">  &#125;));</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    &lt;&gt;</span><br><span class=\"line\">        &lt;Form&gt;</span><br><span class=\"line\">    \t\t\t&#123;<span class=\"comment\">//....&#125;</span></span><br><span class=\"line\">        &lt;<span class=\"regexp\">/Form&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;/</span>&gt;</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> memo(Form.create()(forwardRef(Example)));</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> Parent = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    &lt;&gt;</span><br><span class=\"line\">      &lt;Example</span><br><span class=\"line\">      \t<span class=\"comment\">// æ³¨æ„è¿™ä¸ªä¸å†æ˜¯ä¼ refäº†ï¼Œè€Œæ˜¯ä¼ wrappedComponentRefã€‚å› ä¸ºantdçš„formä»–è¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè¿™ä¸ªæ˜¯ä»–è‡ªå®šä¹‰çš„ä¸€ä¸ªæ¥æ”¶refçš„å€¼</span></span><br><span class=\"line\">        wrappedComponentRef=&#123;editTemplateRef&#125;</span><br><span class=\"line\">      /&gt;</span><br><span class=\"line\">    &lt;<span class=\"regexp\">/&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">  );</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"useDebugValue-è‡ªå®šä¹‰Hook\"><a href=\"#useDebugValue-è‡ªå®šä¹‰Hook\" class=\"headerlink\" title=\"useDebugValue/è‡ªå®šä¹‰Hook\"></a>useDebugValue/è‡ªå®šä¹‰Hook</h2><h3 id=\"å‰è¨€-4\"><a href=\"#å‰è¨€-4\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h3><p>useDebugValueæ˜¯ä¸“é—¨ç”¨äºæœåŠ¡è‡ªå®šä¹‰çš„Hookçš„ã€‚</p>\n<p>å…·ä½“çœ‹çœ‹ä½¿ç”¨å°±å¥½</p>\n<p>useDebugValueï¼Œç›®çš„æ˜¯èƒ½åœ¨reactçš„æµè§ˆå™¨è°ƒè¯•å·¥å…·ä¸Šæ˜¾ç¤ºä½ çš„è‡ªå®šä¹‰hooksï¼Œæˆ–è€…ç»™hooksæ ‡è®°ä¸€äº›ä¸œè¥¿<br>å½“ä½¿ç”¨ä¸€ä¸ªå‚æ•°çš„æ—¶å€™ï¼Œå°±æ˜¯æŠŠç¬¬ä¸€ä¸ªå‚æ•°æ ‡è®°åœ¨reactçš„è°ƒè¯•å·¥å…·ä¸Š,ä¸‹é¢å†™ä¸€ä¸ªç®€å•çš„ä¾‹å­</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; useDebugValue, useState &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> useTest = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> [str, setStr] = useState&lt;string&gt;(<span class=\"string\">''</span>);</span><br><span class=\"line\">    useDebugValue(<span class=\"string\">'debug'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        str, setStr</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> (): JSX.Element =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; str, setStr &#125; = useTest();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">        &lt;&gt;</span><br><span class=\"line\">            &lt;h2&gt;&#123;str&#125;&lt;<span class=\"regexp\">/h2&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">            &lt;button onClick=&#123;() =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">                setStr('é‡æ–°æ¸²æŸ“');</span></span><br><span class=\"line\"><span class=\"regexp\">            &#125;&#125;&gt;è¿™æ˜¯ï¼Ÿï¼Ÿï¼Ÿ&lt;/</span>button&gt;</span><br><span class=\"line\">        &lt;<span class=\"regexp\">/&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    );</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n\n\n<p><img src=\"/image/%E4%BD%A0%E7%9C%9F%E7%9A%84%E6%87%82ReactHook%E5%90%97/20190818212347571.png\" alt=\"\"></p>\n<p>ä¼šåœ¨è‡ªå®šä¹‰çš„hooksæ ‡è®°åˆ°reactçš„è°ƒè¯•å·¥å…·ä¸Šé¢,ä¸»è¦ç”¨äºè°ƒè¯•å·¥å…·è°ƒè¯•ä½¿ç”¨</p>\n<p>å½“ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°çš„æƒ…å†µä¸‹ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œä¼šæŠŠç¬¬ä¸€ä¸ªå‚æ•°å½“æˆè‡ªå·±çš„å½¢å‚ä¼ å…¥ï¼Œè¿›è¡Œä¸€ç³»åˆ—çš„æ“ä½œï¼Œreturnå›å»ï¼Œç„¶åæ‰ä¼šåœ¨reactè°ƒè¯•å·¥å…·çš„hooksä¸­æ‰“å°å‡ºæ¥ï¼Œä¸ç„¶ä¸ä¼šæ˜¾ç¤º</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; useDebugValue, useState &#125; <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> useTest = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> [str, setStr] = useState&lt;string&gt;(<span class=\"string\">''</span>);</span><br><span class=\"line\">    useDebugValue(str, (value:string) =&gt; &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(value);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">'è¿™æ˜¯æ”¹é€ åçš„'</span> + value;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">        str, setStr</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> (): JSX.Element =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; str, setStr &#125; = useTest();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (</span><br><span class=\"line\">        &lt;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">            &lt;h2&gt;&#123;str&#125;&lt;<span class=\"regexp\">/h2&gt;</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">            &lt;button onClick=&#123;() =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">                setStr('é‡æ–°æ¸²æŸ“');</span></span><br><span class=\"line\"><span class=\"regexp\">           &#125;&#125;&gt;è¿™æ˜¯ï¼Ÿï¼Ÿï¼Ÿ&lt;/</span>button&gt;</span><br><span class=\"line\">       &lt;<span class=\"regexp\">/&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    );</span></span><br><span class=\"line\"><span class=\"regexp\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>ç»“æœ:</p>\n<p><img src=\"/image/%E4%BD%A0%E7%9C%9F%E7%9A%84%E6%87%82ReactHook%E5%90%97/2019081821194714.png\" alt=\"\"></p>\n<p>åŒæ—¶åœ¨æ§åˆ¶å°ä¸Šæ‰“å°äº†ä¸€ä¸ªç©ºå­—ç¬¦</p>\n<p>ç”±äºstrçš„åˆå§‹å€¼æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥æ‰“å°å°±æ˜¯ç©ºçš„äº†ï¼Œè¿™åªæ˜¯è°ƒè¯•ä½¿ç”¨ï¼Œhookså·®ä¸å¤šå°±è¿™äº›äº†ï¼Œæ²¡æœ‰å…¶ä»–çš„äº†</p>\n<h2 id=\"è§‚çœ‹ä¹‹å\"><a href=\"#è§‚çœ‹ä¹‹å\" class=\"headerlink\" title=\"è§‚çœ‹ä¹‹å\"></a>è§‚çœ‹ä¹‹å</h2><p>å¦‚æœæœ‰å“ªé‡Œå†™çš„ä¸å¯¹æˆ–è€…æœ‰ç–‘é—®çš„æ¬¢è¿å¤§å®¶åœ¨è¯„è®ºåŒºäº’åŠ¨ã€‚ğŸ™</p>\n"},{"title":"ä»é›¶é…ç½®ä½ çš„Webpack","date":"2020-06-06T22:11:13.000Z","cover":"/image/cover/webpack.png","_content":"\n# ä»é›¶é…ç½®ä½ çš„Webpack\n\n## å‰è¨€\n\nä¸Šç¯‡æ–‡ç« ç®€å•çš„ä»‹ç»äº†ä¸€ä¸‹ï¼Œå‰ç«¯è¿›é˜¶ä¹‹è„šæ‰‹æ¶çš„æ­å»ºã€‚å…¶å®æˆ‘ä¸ªäººè®¤ä¸ºé‡è¦çš„è¿˜æ˜¯Webpackçš„é…ç½®å‡ºæ¥çš„templateï¼Œè‡³äºè„šæ‰‹æ¶çš„äº¤äº’ä½“éªŒå¯ä»¥åæœŸå»ä¼˜åŒ–ï¼Œä¹Ÿå¯ä»¥æ›´åŠ çš„ä¸ªæ€§åŒ–ã€‚ä½†æ˜¯æˆ‘ä»¬çš„æ ¸å¿ƒè¿˜æ˜¯æ”¾åœ¨Webpackç­‰ä¸€ç³»åˆ—çš„é…ç½®ä¸Šã€‚\n\nè¿™ç¯‡æ–‡ç« çš„ç›®çš„\n\n- å¯ä»¥ç»™è‡ªå·±ä¸€ä¸ªå›é¡¾çš„åœ°æ–¹\n- åŠ å¼ºå¯¹Webpackçš„ç†è§£ï¼Œæ¯ä¸ªçŸ¥è¯†ç‚¹éƒ½ä¼šè®¤è®¤çœŸçœŸçš„å½»æŸ¥ï¼å°½é‡è®©æ¯ä¸€æ­¥éƒ½æ˜¯éå¸¸æ¸…æ™°æ˜äº†çš„ï¼\n- å¦‚æœå¯ä»¥å¸®åŠ©åˆ°å¤§å®¶é‚£æ˜¯æ›´å¥½ä¸è¿‡äº†\n\nå¥½äº†ï¼Œæ”¶ï¼è¯ä¸å¤šè¯´å¼€å§‹ï¼\n\n\n\n## å‰æ\n\nç›¸ä¿¡æ¥åˆ°è¿™é‡Œçš„å°ä¼™ä¼´ï¼Œéƒ½æ˜¯æœ‰ä¸€äº›äº›å‰ç«¯çš„ç»éªŒäº†ï¼Œè‡³äºä»€ä¹ˆnodeå®‰è£…ç¯å¢ƒå˜é‡è¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚æœ¬äººä½¿ç”¨çš„æ˜¯mac osï¼Œå¦‚æœæ˜¯Windowsçš„å¹¶ä¸”ç¢°åˆ°é—®é¢˜çš„è¯ï¼Œå¯ä»¥ç•™è¨€ï¼Œæˆ–è€…ç›´æ¥Googleã€‚\n\n\n\n## å¼€å§‹\n\n### å»ºç«‹ä¸€ä¸ªç©ºçš„æ–‡ä»¶å¤¹ğŸ“\n\næ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œåä¸ºã€webpackInitã€‘\n\nå¹¶ä¸”ä½¿ç”¨ä½ çš„ç¼–è¾‘å™¨æ‰“å¼€ä»–ï¼Œç„¶åæ‰“å¼€å‘½ä»¤è¡Œæ‰§è¡Œï¼š\n\n```js\nnpm init -y\n```\n\nè¿™ä¸ªå‘½ä»¤æ˜¯nodeå¸®ä½ åˆå§‹åŒ–ä¸€ä¸ªé¡¹ç›®ç”¨çš„ï¼Œå¸®ä½ æ–°å»ºä¸€ä¸ª`package.json`ã€‚\n\nè‡³äº`-y`æ˜¯ç”¨äºé»˜è®¤éƒ½ä»¥**yes**ç»§ç»­æ‰§è¡Œã€‚å¦‚æœæƒ³äº†è§£ä¸€ä¸‹é‡Œé¢åˆ°åº•æœ‰ä»€ä¹ˆçš„åŒå­¦å¯ä»¥ä¸ç”¨*-y*ç»§ç»­è·‘ä¸€éã€‚å…¶å®é‡Œé¢çš„ä¸œè¥¿åæœŸéƒ½å¯ä»¥è‡ªå·±ä¿®æ”¹`package.json`ã€‚æ‰€ä»¥ä¸éœ€è¦å¤ªåœ¨æ„ã€‚\n\n### å®‰è£…WebpackğŸ”§\n\nç°åœ¨æ˜¯åŒ—äº¬æ—¶é—´ï¼š2020/06/07 06:42:49ã€‚\n\nWebpack5æœ‰Betaç‰ˆï¼Œè¿™é‡Œå°±ä¸è€ƒè™‘äº†ï¼Œåç»­ä¸Šæ­£å¼ç‰ˆçš„è¯æˆ‘åº”è¯¥ä¼šå‡ºæ–°çš„æ–‡ç« ä»‹ç»ã€‚\n\nå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ `webpack 4+` ç‰ˆæœ¬ï¼Œè¿˜éœ€è¦å®‰è£… `webpack-cli` ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\n\n```js\nnpm install --save-dev webpack webpack-cli\n```\n\nå› ä¸ºWebpackä¸»è¦æ˜¯ç¼–è¯‘æ—¶ä½¿ç”¨æ‰€ä»¥æ”¾åˆ°â€œdevDependenciesâ€ã€‚\n\nç¡®è®¤ä¸€ä¸‹ç°åœ¨çš„ç›®å½•ç»“æ„ï¼Œä»¥é˜²æœ‰åŒå­¦æ‰é˜Ÿï¼\n\n```diff\nwebpackInit\n  |- node_modules\n  |- package-lock.json\n  |- package.json\n```\n\nè¿™é‡Œè¯´ä¸‹é¢˜å¤–è¯ã€‚\n\n##### package.jsonå’Œpackage-lock.jsonçš„åŒºåˆ«\n\npackage.json æ–‡ä»¶åªèƒ½é”å®šå¤§ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯ç‰ˆæœ¬å·çš„ç¬¬ä¸€ä½ï¼Œå¹¶ä¸èƒ½é”å®šåé¢çš„å°ç‰ˆæœ¬ï¼Œ`npm install` éƒ½æ˜¯æ‹‰å–çš„è¯¥å¤§ç‰ˆæœ¬ä¸‹çš„æœ€æ–°çš„ç‰ˆæœ¬ï¼Œä¸ºäº†ç¨³å®šæ€§è€ƒè™‘æˆ‘ä»¬å‡ ä¹æ˜¯ä¸æ•¢éšæ„å‡çº§ä¾èµ–åŒ…çš„ï¼Œè¿™å°†å¯¼è‡´å¤šå‡ºæ¥å¾ˆå¤šå·¥ä½œé‡ï¼Œæµ‹è¯•/é€‚é…ç­‰ï¼Œæ‰€ä»¥ package-lock.json æ–‡ä»¶å‡ºæ¥äº†ï¼Œå½“ä½ æ¯æ¬¡å®‰è£…ä¸€ä¸ªä¾èµ–çš„æ—¶å€™å°±é”å®šåœ¨ä½ å®‰è£…çš„è¿™ä¸ªç‰ˆæœ¬ã€‚\n\né‚£å¦‚æœæˆ‘ä»¬å®‰è£…æ—¶çš„åŒ…æœ‰bugï¼Œåé¢éœ€è¦æ›´æ–°æ€ä¹ˆåŠï¼Ÿ\n\nåœ¨ä»¥å‰å¯èƒ½å°±æ˜¯ç›´æ¥æ”¹ package.json é‡Œé¢çš„ç‰ˆæœ¬ï¼Œç„¶åå† `npm install` äº†ï¼Œä½†æ˜¯ 5 ç‰ˆæœ¬åå°±ä¸æ”¯æŒè¿™æ ·åšäº†ï¼Œå› ä¸ºç‰ˆæœ¬å·²ç»é”å®šåœ¨ package-lock.json é‡Œäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½ `npm install xxx@x.x.x` è¿™æ ·å»æ›´æ–°æˆ‘ä»¬çš„ä¾èµ–ï¼Œç„¶å package-lock.json ä¹Ÿèƒ½éšä¹‹æ›´æ–°ã€‚\n\n### æ–°å»ºé…ç½®æ–‡ä»¶ğŸ“ƒ\n\næˆ‘ä»¬åœ¨æ ¹ç›®å½•æ–°å»ºæ–‡ä»¶å¤¹ã€configã€‘ç”¨äºå­˜å‚¨ä¸€äº›ç›¸å…³çš„é…ç½®æ–‡ä»¶ï¼Œç„¶ååœ¨ã€configã€‘é‡Œé¢æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ã€webpackã€‘è¡¨ç¤ºï¼Œä¸“é—¨ç”¨äºå­˜å‚¨webpackçš„é…ç½®æ–‡ä»¶ã€‚ç„¶ååœ¨ã€webpackã€‘è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹é¢æ–°å»ºæ–‡ä»¶ã€webpack.common.config.jsã€‘\n\nå¹¶æ•²å…¥ä»¥ä¸‹ä»£ç \n\n\n\n```javascript\nconst path = require('path');\n\nmodule.exports = {\n  // é…ç½®å…¥å£æ–‡ä»¶\n  entry: {\n    app: './src/index.js',\n  },\n  // æ‰“åŒ…ğŸ“¦ä¹‹åçš„å‡ºå£\n  output: {\n    // å¦‚æœä¸åŠ å“ˆå¸Œå€¼ï¼Œæµè§ˆå™¨ä¼šæœ‰ç¼“å­˜ï¼Œå¯èƒ½ä½ éƒ¨ç½²äº†ï¼Œä½†æ˜¯ç”¨æˆ·çœ‹åˆ°çš„è¿˜æ˜¯è€é¡µé¢\n    // 8æ˜¯hashçš„é•¿åº¦ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œwebpackä¼šè®¾ç½®é»˜è®¤å€¼ä¸º20ã€‚\n    filename: 'js/[name].[chunkhash:8].bundle.js',\n    /**\n     * Node.js ä¸­ï¼Œ__dirname æ€»æ˜¯æŒ‡å‘è¢«æ‰§è¡Œ js æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œ\n     * æ‰€ä»¥å½“ä½ åœ¨ /d1/d2/myscript.js æ–‡ä»¶ä¸­å†™äº† __dirnameï¼Œ å®ƒçš„å€¼å°±æ˜¯ /d1/d2 ã€‚\n     * path.resolve\n     * 1.path.resolve()æ–¹æ³•å¯ä»¥å°†è·¯å¾„æˆ–è€…è·¯å¾„ç‰‡æ®µè§£ææˆç»å¯¹è·¯å¾„\n     * 2.ä¼ å…¥è·¯å¾„ä»å³è‡³å·¦è§£æï¼Œé‡åˆ°ç¬¬ä¸€ä¸ªç»å¯¹è·¯å¾„æ˜¯å®Œæˆè§£æï¼Œä¾‹å¦‚path.resolve('/foo', '/bar', 'baz') å°†è¿”å› /bar/baz\n     * 3.å¦‚æœä¼ å…¥çš„ç»å¯¹è·¯å¾„ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå½“å‰ç›®å½•å°†è¢«ä½¿ç”¨\n     * 4.å½“ä¼ å…¥çš„å‚æ•°æ²¡æœ‰/æ—¶ï¼Œå°†è¢«ä¼ å…¥è§£æåˆ°å½“å‰æ ¹ç›®å½•\n     * 5.é›¶é•¿åº¦çš„è·¯å¾„å°†è¢«å¿½ç•¥\n     * 6.å¦‚æœæ²¡æœ‰ä¼ å…¥å‚æ•°ï¼Œå°†è¿”å›å½“å‰æ ¹ç›®å½•\n     * \n     * _dirnameè¡¨ç¤ºç»å¯¹è·¯å¾„\n     * æˆ‘ä»¬ç¢°åˆ°çš„./xxå°±æ˜¯ç›¸å¯¹è·¯å¾„\n     * 1.åªä¼ å…¥__dirnameä¹Ÿå¯ä»¥è‡ªåŠ¨è°ƒç”¨path.resolveæ–¹æ³•\n     * 2.å¯ä»¥æ‹¼æ¥è·¯å¾„å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ä¸è°ƒç”¨path.resolve()æ–¹æ³•æ‹¼æ¥å¤±è´¥\n     * 3.__dirnameä»£è¡¨çš„æ˜¯å½“å‰æ–‡ä»¶ï¼ˆa.jsï¼‰çš„ç»å¯¹è·¯å¾„\n     * 4.ä»å³è‡³å·¦è§£æï¼Œé‡åˆ°äº†ç»å¯¹è·¯å¾„/srcï¼Œå› æ­¤ç›´æ¥è¿”\n     */\n    path: path.resolve(__dirname, '../../dist')\n  }\n}\n```\n\n> webpack é…ç½®æ˜¯æ ‡å‡†çš„ Node.jsçš„CommonJS æ¨¡å—ï¼Œå®ƒé€šè¿‡requireæ¥å¼•å…¥å…¶ä»–æ¨¡å—ï¼Œé€šè¿‡module.exportså¯¼å‡ºæ¨¡å—ï¼Œç”± webpack æ ¹æ®å¯¹è±¡å®šä¹‰çš„å±æ€§è¿›è¡Œè§£æã€‚\n\nåœ¨æ ¹ç›®å½•æ–°å»ºã€srcã€‘æ–‡ä»¶å¤¹ğŸ“\n\nåœ¨ã€srcã€‘æ–‡ä»¶å¤¹ä¸‹æ–°å»ºæ–‡ä»¶index.js\n\nokğŸ‘Œï¼Œç¡®è®¤ä¸€ä¸‹ç›®å½•ç»“æ„\n\n```diff\nwebpackInit\n+ |- config\n+ \t|- webpack\n+     |- webpack.common.config.js\n  |- node_modules\n+ |- src\n+     |- index.js\n  |- package.json\n  |- package-lock.json\n```\n\né‚£æˆ‘ä»¬æ€ä¹ˆæ‰“åŒ…å‘¢ï¼Ÿåœ¨ `package.json` ä¸­é…ç½®å¦‚ä¸‹å±æ€§ï¼š\n\n```diff\n\"scripts\": {\n- \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\",\n+ \"start\": \"webpack --config ./config/webpack/webpack.common.config.js\"\n},\n\n```\n\nå¥½äº†ï¼Œæˆ‘ä»¬è¯•è¯•æ€ä¹ˆæ‰“åŒ…å§ï¼Œè™½ç„¶ä½ çš„ `index.js` ä¸­ä»€ä¹ˆä»£ç ä¹Ÿæ²¡æœ‰ã€‚\nåœ¨æ§åˆ¶å°ä¸­è¾“å…¥ä»¥ä¸‹ä»£ç ï¼š\n\n```\nnpm run start\n```\n\nnpm run xxxx ä¼šå»æ‰§è¡Œå½“å‰ç›®å½•ä¸‹package.jsoné‡Œé¢çš„scriptåŒåè„šæœ¬\n\næˆ‘ä»¬çš„ã€npm run startã€‘ç›¸å½“äºç›´æ¥æ‰§è¡Œäº†æˆ‘ä»¬å†™åœ¨ã€startã€‘é‡Œé¢çš„ä»£ç ã€‚\n\næ‰§è¡Œä¹‹åï¼Œä½ ä¼šå‘ç°æ ¹ç›®å½•å¤šå‡ºäº†ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼š `dist/js` ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªjsæ–‡ä»¶ï¼š `bundle.js` ï¼Œé‚£ä¹ˆè‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸç¼–è¯‘æ‰“åŒ…äº†ä¸€ä¸ªjsæ–‡ä»¶ï¼Œå³å…¥å£æ–‡ä»¶ï¼š `index.js` ã€‚\n\n### å®‰è£…React\n\nåœ¨æ§åˆ¶å°è¾“å…¥ä»¥ä¸‹ä»£ç ï¼š\n\n```\nnpm install --save react react-dom\n```\n\n--saveå°±æ˜¯è¿è¡Œæ—¶ä¼šç”¨åˆ°çš„ä»£ç \n\nå…·ä½“å’Œ--dev-saveçš„åŒºåˆ«å¯ä»¥è‡ªå·±Googleä¸€ä¸‹\n\nåœ¨ã€src/index.jsã€‘é‡Œé¢åŠ å…¥ä»¥ä¸‹ä»£ç \n\n```js\nimport React from 'react';\nimport ReactDOM from 'react-dom';\n\nconst App = () => (\n  <>\n    Hello Worldï¼\n  </>\n)\n\nReactDOM.render(<App />, document.getElementById('root'));\n```\n\nåœ¨æ ¹ç›®å½•åŠ å…¥æ–‡ä»¶å¤¹ã€publicã€‘ï¼Œç„¶ååœ¨ã€publicã€‘é‡Œé¢åŠ å…¥ã€index.htmlã€‘\n\nç›®å½•å¦‚ä¸‹ï¼š\n\n```diff\nwebpackInit\n+ |- public\n+ \t|- index.html\n  |- config\n  \t|- webpack\n      |- webpack.common.config.js\n  |- node_modules\n  |- src\n      |- index.js\n  |- package.json\n  |- package-lock.json\n```\n\nç„¶ååœ¨ã€index.htmlã€‘åŠ å…¥ä»¥ä¸‹ä»£ç ï¼š\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\">\n    <meta name=\"viewport\" content=\"initial-scale=1.0, user-scalable=no, width=device-width\">\n  <title>ä»é›¶é…ç½®Webpack</title>\n</head>\n<body>\n  <div id=\"root\"></div>\n</body>\n</html>\n```\n\nOK\n\nä¸‡äº‹ä¿±å¤‡ï¼Œæˆ‘ä»¬è¿è¡Œï¼š\n\n```\nnpm run start\n```\n\næ‰“åŒ…å¤±è´¥äº†ã€‚ã€‚ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ\n\n### ä½¿ç”¨babel\n\nä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸Šé¢å†™jsxä¼šæ‰“åŒ…ä¸äº†å‘¢ï¼Œå› ä¸ºwebpackæ ¹æœ¬è¯†åˆ«ä¸äº†jsxè¯­æ³•ï¼Œé‚£æ€ä¹ˆåŠï¼Ÿä½¿ç”¨loaderå¯¹æ–‡ä»¶è¿›è¡Œé¢„å¤„ç†ã€‚\nå…¶ä¸­ï¼Œbabel-loaderï¼Œå°±æ˜¯è¿™æ ·ä¸€ä¸ªé¢„å¤„ç†æ’ä»¶ï¼Œå®ƒåŠ è½½ ES2015+ ä»£ç ï¼Œç„¶åä½¿ç”¨ Babel è½¬è¯‘ä¸º ES5ã€‚é‚£å¼€å§‹é…ç½®å®ƒå§ï¼\n\né¦–å…ˆå®‰è£…babelç›¸å…³çš„æ¨¡å—ï¼š\n\n```\nnpm install --save-dev babel-loader @babel/preset-react @babel/preset-env @babel/core babel-plugin-import\n```\n\n- **babel-loaderï¼š**ä½¿ç”¨Babelå’Œwebpackæ¥è½¬è¯‘JavaScriptæ–‡ä»¶ã€‚\n- **@babel/preset-reactï¼š**è½¬è¯‘reactçš„JSX\n- **@babel/preset-envï¼š**è½¬è¯‘ES2015+çš„è¯­æ³•\n- **@babel/coreï¼š**babelçš„æ ¸å¿ƒæ¨¡å—\n- **babel-plugin-import**ï¼šæŒ‰éœ€åŠ è½½æ‰€éœ€è¦çš„babelè§£æ\n\nç†è®ºä¸Šæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ `webpack.common.config.js` ä¸­é…ç½®\"options\"ï¼Œä½†æœ€å¥½åœ¨å½“å‰æ ¹ç›®å½•ï¼Œæ³¨æ„ï¼Œä¸€å®šè¦æ˜¯æ ¹ç›®å½•ï¼ï¼ï¼ æ–°å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ `.babelrc` é…ç½®ç›¸å…³çš„\"presets\"ï¼š\n\n```js\n{\n  \"presets\": [\n    [\n      \"@babel/preset-env\",\n      {\n        \"targets\": {\n          // å¤§äºç›¸å…³æµè§ˆå™¨ç‰ˆæœ¬æ— éœ€ç”¨åˆ° preset-env\n          \"edge\": 17,\n          \"firefox\": 60,\n          \"chrome\": 67,\n          \"safari\": 11,\n          // å…¼å®¹åˆ°android4 ios6\n          \"browsers\": [\"Android >= 4.0\", \"ios >= 6\"]\n        }\n      }\n    ],\n    \"@babel/preset-react\"\n  ],\n  \"plugins\": [\n    [\"import\", { \"libraryName\": \"antd-mobile\", \"style\": \"css\" }] // `style: true` ä¼šåŠ è½½ less æ–‡ä»¶\n  ]\n}\n```\n\nè¿™é‡Œæœ‰å…³[bebelçš„é…ç½®](https://www.babeljs.cn/docs/babel-preset-env)å¯ä¸Šå®˜ç½‘æŸ¥è¯¢æ–‡æ¡£ã€‚\n\nå†ä¿®æ”¹ `webpack.common.config.js` ï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š\n\n```js\nconst path = require('path');\n\nmodule.exports = {\n  // é…ç½®å…¥å£æ–‡ä»¶\n  entry: {\n    app: './src/index.js',\n  },\n  // æ‰“åŒ…ğŸ“¦ä¹‹åçš„å‡ºå£\n  output: {\n    // å¦‚æœä¸åŠ å“ˆå¸Œå€¼ï¼Œæµè§ˆå™¨ä¼šæœ‰ç¼“å­˜ï¼Œå¯èƒ½ä½ éƒ¨ç½²äº†ï¼Œä½†æ˜¯ç”¨æˆ·çœ‹åˆ°çš„è¿˜æ˜¯è€é¡µé¢\n    // 8æ˜¯hashçš„é•¿åº¦ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œwebpackä¼šè®¾ç½®é»˜è®¤å€¼ä¸º20ã€‚\n    filename: 'js/[name].[chunkhash:8].bundle.js',\n    /**\n     * Node.js ä¸­ï¼Œ__dirname æ€»æ˜¯æŒ‡å‘è¢«æ‰§è¡Œ js æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œ\n     * æ‰€ä»¥å½“ä½ åœ¨ /d1/d2/myscript.js æ–‡ä»¶ä¸­å†™äº† __dirnameï¼Œ å®ƒçš„å€¼å°±æ˜¯ /d1/d2 ã€‚\n     * path.resolve\n     * 1.path.resolve()æ–¹æ³•å¯ä»¥å°†è·¯å¾„æˆ–è€…è·¯å¾„ç‰‡æ®µè§£ææˆç»å¯¹è·¯å¾„\n     * 2.ä¼ å…¥è·¯å¾„ä»å³è‡³å·¦è§£æï¼Œé‡åˆ°ç¬¬ä¸€ä¸ªç»å¯¹è·¯å¾„æ˜¯å®Œæˆè§£æï¼Œä¾‹å¦‚path.resolve('/foo', '/bar', 'baz') å°†è¿”å› /bar/baz\n     * 3.å¦‚æœä¼ å…¥çš„ç»å¯¹è·¯å¾„ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå½“å‰ç›®å½•å°†è¢«ä½¿ç”¨\n     * 4.å½“ä¼ å…¥çš„å‚æ•°æ²¡æœ‰/æ—¶ï¼Œå°†è¢«ä¼ å…¥è§£æåˆ°å½“å‰æ ¹ç›®å½•\n     * 5.é›¶é•¿åº¦çš„è·¯å¾„å°†è¢«å¿½ç•¥\n     * 6.å¦‚æœæ²¡æœ‰ä¼ å…¥å‚æ•°ï¼Œå°†è¿”å›å½“å‰æ ¹ç›®å½•\n     * \n     * _dirnameè¡¨ç¤ºç»å¯¹è·¯å¾„\n     * æˆ‘ä»¬ç¢°åˆ°çš„./xxå°±æ˜¯ç›¸å¯¹è·¯å¾„\n     * 1.åªä¼ å…¥__dirnameä¹Ÿå¯ä»¥è‡ªåŠ¨è°ƒç”¨path.resolveæ–¹æ³•\n     * 2.å¯ä»¥æ‹¼æ¥è·¯å¾„å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ä¸è°ƒç”¨path.resolve()æ–¹æ³•æ‹¼æ¥å¤±è´¥\n     * 3.__dirnameä»£è¡¨çš„æ˜¯å½“å‰æ–‡ä»¶ï¼ˆa.jsï¼‰çš„ç»å¯¹è·¯å¾„\n     * 4.ä»å³è‡³å·¦è§£æï¼Œé‡åˆ°äº†ç»å¯¹è·¯å¾„/srcï¼Œå› æ­¤ç›´æ¥è¿”\n     */\n    path: path.resolve(__dirname, '../../dist')\n  },\n  module: {\n    /**\n     * test è§„å®šäº†ä½œç”¨äºä»¥è§„åˆ™ä¸­åŒ¹é…åˆ°çš„åç¼€ç»“å°¾çš„æ–‡ä»¶ï¼Œ \n     * use å³æ˜¯ä½¿ç”¨ babel-loader å¿…é¡»çš„å±æ€§ï¼Œ \n     * exclude å‘Šè¯‰æˆ‘ä»¬ä¸éœ€è¦å»è½¬è¯‘\"node_modules\"è¿™é‡Œé¢çš„æ–‡ä»¶ã€‚\n     */\n    rules:[\n      {\n        test: /\\.(js|jsx)?$/,\n        // å¼€å¯ç¼“å­˜\n        options: { cacheDirectory: true },\n        loader: 'babel-loader',\n      },\n    ]\n  }\n}\n```\n\næ¥ä¸‹æ¥æ¿€åŠ¨äººå¿ƒçš„æ—¶åˆ»ï¼š\n\n```\nnpm run start\n```\n\næ˜¯ä¸æ˜¯èƒ½æ‰“åŒ…æˆåŠŸäº†å‘¢ï¼Ÿ\n\næ‰“å¼€ã€dist/ã€‘ä½ çš„htmlé¡µé¢ï¼Œçœ‹ä¸€ä¸‹æ˜¯å¦æ˜¯â€œHello Worldï¼â€å§ï¼\n\n### ä½¿ç”¨webpack-mergeğŸˆ´ï¸\n\næˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªåä¸º [webpack-merge](https://github.com/survivejs/webpack-merge) çš„å·¥å…·ã€‚é€šè¿‡â€œé€šç”¨â€é…ç½®ï¼Œæˆ‘ä»¬ä¸å¿…åœ¨ç¯å¢ƒç‰¹å®š(environment-specific)çš„é…ç½®ä¸­é‡å¤ä»£ç ã€‚ç®€å•æ¥è¯´å°±æ˜¯ç”Ÿäº§ç¯å¢ƒä¸åŒï¼Œæˆ‘ä»¬è¦ç»™çš„é…ç½®ä¹Ÿæœ‰æ‰€ä¸åŒï¼Œä½†æ˜¯å¯ä»¥å…±ç”¨ä¸€ä¸ªå…±æœ‰çš„é…ç½®ã€‚\n\næˆ‘ä»¬å…ˆä»å®‰è£… [webpack-merge](https://github.com/survivejs/webpack-merge) å¼€å§‹ï¼š\n\n```\nnpm install --save-dev webpack-merge\n```\n\nå®‰è£…ç»“æŸä¹‹åï¼Œæˆ‘ä»¬åœ¨ `config` è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸¤ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«ä¸º `webpack.prod.config.js` å’Œ `webpack.dev.config.js` ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶åˆ†åˆ«å¯¹åº”ç”Ÿäº§å’Œå¼€å‘ä¸¤ä¸ªç¯å¢ƒçš„é…ç½®ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥æ·»åŠ testç¯å¢ƒã€‚åå­—ä¹Ÿå¯ä»¥è‡ªå·±å–ï¼Œå°½é‡ä¿æŒä¸€è‡´ã€‚\n\n\n\nç°åœ¨çš„ç›®å½•ç»“æ„ï¼š\n\n```diff\n  webpackInit\n\t|- config\n\t\t|- webpack\n\t    |- webpack.common.config.js\n+     |- webpack.prod.config.js\n  çœç•¥\n```\n\nåœ¨ã€webpack.prod.config.jsã€‘åŠ å…¥\n\n```js\nconst merge = require('webpack-merge'); // ç‰ˆæœ¬ä¸º4.x\n// webpack-merge 5.xç‰ˆæœ¬åº”è¯¥æ”¹ä¸º const { merge } = require('webpack-merge');\nconst common = require('./webpack.common.config.js');\n\nmodule.exports = merge(common, {\n  mode: 'production',\n});\n```\n\nç„¶åä¿®æ”¹ã€package.jsonã€‘\n\n```diff\n{\n  \"name\": \"webpackInit\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"start\": \"webpack --config ./config/webpack/webpack.common.config.js\",\n+   \"build\": \"webpack --config ./config/webpack/webpack.prod.config.js\"\n  },\n  \"keywords\": [],\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"devDependencies\": {\n    \"@babel/core\": \"^7.10.2\",\n    \"@babel/preset-env\": \"^7.10.2\",\n    \"@babel/preset-react\": \"^7.10.1\",\n    \"babel-loader\": \"^8.1.0\",\n    \"babel-plugin-import\": \"^1.13.0\",\n    \"webpack\": \"^4.43.0\",\n    \"webpack-cli\": \"^3.3.11\",\n    \"webpack-merge\": \"^4.2.2\"\n  },\n  \"dependencies\": {\n    \"react\": \"^16.13.1\",\n    \"react-dom\": \"^16.13.1\"\n  }\n}\n\n```\n\nç„¶å\n\nåˆ é™¤ã€distæ–‡ä»¶å¤¹ã€‘\n\nä¹‹å\n\n```\nnpm run build\n```\n\næ˜¯ä¸æ˜¯ä¹Ÿbuildä¹Ÿæ‰“åŒ…æˆåŠŸäº†ï¼\n\nhtmlæ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥æ­£å¸¸è®¿é—®ï¼\n\nä½†æ˜¯æ²¡æœ‰æ˜¾ç¤ºHello Worldï¼Œä»”ç»†ä¸€çœ‹è¿˜æŠ¥é”™äº†ã€‚ã€‚ã€‚ä¸ºä»€ä¹ˆå‘¢ã€‚ã€‚å› ä¸º\n\n```\n// å¦‚æœä¸åŠ å“ˆå¸Œå€¼ï¼Œæµè§ˆå™¨ä¼šæœ‰ç¼“å­˜ï¼Œå¯èƒ½ä½ éƒ¨ç½²äº†ï¼Œä½†æ˜¯ç”¨æˆ·çœ‹åˆ°çš„è¿˜æ˜¯è€é¡µé¢\n    // 8æ˜¯hashçš„é•¿åº¦ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œwebpackä¼šè®¾ç½®é»˜è®¤å€¼ä¸º20ã€‚\n    filename: 'js/[name].[chunkhash:8].bundle.js',\n```\n\næˆ‘ä»¬ç»™jsæ–‡ä»¶è®¾ç½®äº†hashå€¼ã€‚ä¸èƒ½å¤Ÿç›´æ¥åœ¨htmlé‡Œé¢åŠ ä¸Šã€<script src=\"../dist/js/bundle.js\"></script>ã€‘è¿™ä¹ˆä¸€å¥ï¼Œè€Œä¸”æ¯æ¬¡ç”Ÿæˆçš„hashå€¼éƒ½ä¼šå˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦æ€ä¹ˆå¤„ç†è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ\n\n\n\n### ä½¿ç”¨[HtmlWebpackPlugin](https://www.webpackjs.com/plugins/html-webpack-plugin/)\n\n\n\nå®‰è£…[HtmlWebpackPlugin](https://www.webpackjs.com/plugins/html-webpack-plugin/)\n\nåœ¨æ§åˆ¶å°æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼š\n\n```\nnpm install --save-dev html-webpack-plugin\n```\n\nä¿®æ”¹ã€webpack.prod.config.jsã€‘\n\n```js\nconst merge = require('webpack-merge'); // ç‰ˆæœ¬ä¸º4.x\n// webpack-merge 5.xç‰ˆæœ¬åº”è¯¥æ”¹ä¸º const { merge } = require('webpack-merge');\nconst common = require('./webpack.common.config.js');\n\nconst HtmlWebpackPlugin = require('html-webpack-plugin');\n\nmodule.exports = merge(common, {\n  mode: 'production',\n  plugins: [\n    new HtmlWebpackPlugin({\n      filename: 'index.html', // æ‰“åŒ…ä¹‹åçš„htmlæ–‡ä»¶åå­—\n      // è¿™é‡Œæœ‰å°ä¼™ä¼´å¯èƒ½ä¼šç–‘æƒ‘ä¸ºä»€ä¹ˆä¸æ˜¯ '../public/index.html'\n      // æˆ‘çš„ç†è§£æ˜¯æ— è®ºä¸è¦ç”¨çš„templateæ˜¯ä¸æ˜¯åœ¨ä¸€ä¸ªç›®å½•ï¼Œéƒ½æ˜¯ä»æ ¹è·¯å¾„å¼€å§‹æŸ¥æ‰¾\n      template: 'public/index.html', // ä»¥æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„htmlä¸ºæ¨¡æ¿ç”Ÿæˆï¼Œä¸ç„¶æˆ‘ä»¬è¿˜è¦åˆ°æ‰“åŒ…ä¹‹åçš„htmlæ–‡ä»¶ä¸­å†™script\n      inject: 'body',// åœ¨bodyæœ€åº•éƒ¨å¼•å…¥jsæ–‡ä»¶ï¼Œå¦‚æœæ˜¯headï¼Œå°±æ˜¯åœ¨headä¸­å¼•å…¥js\n      minify: { // å‹ç¼©htmlæ–‡ä»¶\n        removeComments: true, // å»é™¤æ³¨é‡Š\n        collapseWhitespace: true, // å»é™¤ç©ºæ ¼\n      },\n    })\n  ]\n});\n```\n\n\n\nç°åœ¨æˆ‘ä»¬å†æ¥æ‰“åŒ…è¯•è¯•\n\n```\nnpm run build\n```\n\nçœ‹çœ‹distä¸­æ˜¯ä¸æ˜¯å¤šå‡ºäº†htmlæ–‡ä»¶ï¼Œå¹¶ä¸”è‡ªåŠ¨å¼•å…¥äº†scriptï¼Œç”¨æµè§ˆå™¨æ‰“å¼€å®ƒè¯•è¯•çœ‹æ˜¯ä¸æ˜¯èƒ½æ­£ç¡®è¾“å‡ºå†…å®¹äº†ï¼\n\nèµ·é£ï¼ï¼ğŸ›«ï¸\n\n### ä½¿ç”¨clean-webpack-plugin\n\næœ‰äº›åŒå­¦å·²ç»åŒå€¦äº†æ¯æ¬¡éƒ½éœ€è¦åˆ é™¤distæ–‡ä»¶å¤¹æ¥éªŒè¯æ˜¯å¦æˆåŠŸã€‚\n\nå…¶å®å‡å¦‚æˆ‘ä»¬ä¸åˆ é™¤çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹jsæ–‡ä»¶ï¼Œè¿™æ ·è®©webpackçŸ¥é“æˆ‘ä»¬æ”¹äº†ä¸œè¥¿ï¼Œä»–å°±ä¼šé‡æ–°æ‰“åŒ…ï¼Œä½†æ˜¯æˆ‘ä»¬æ¯æ¬¡æµ‹è¯•éƒ½æ²¡æœ‰å»ä¿®æ”¹ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åˆ é™¤ã€‚\n\nä½†æ˜¯ï¼Œå¦‚æœè¯´æˆ‘ä»¬ä¸å»åˆ é™¤distæ–‡ä»¶å¤¹çš„è¯ï¼Œæˆ‘ä»¬ä¿®æ”¹äº†ã€src/index.jsã€‘ã€‚ç„¶åå†é‡æ–°buildï¼Œå°±ä¼šå‘ç°ã€dist/jsã€‘ä¸‹é¢ä¼šåˆå¤šå‡ºä¸€ä¸ªjsæ–‡ä»¶ï¼Œè¿™æ ·çš„è¯æˆ‘ä»¬å°±éœ€è¦è§‚å¯Ÿæ—¥å¿—ï¼ŒæŸ¥çœ‹æ–°é²œâ€œå‡ºç‚‰â€çš„æ˜¯å“ªä¸€ä¸ªï¼Œç„¶ååˆ æ‰åˆ«çš„ã€‚è¿™æ ·éå¸¸éº»çƒ¦ã€‚\n\nOKï¼Œæˆ‘ä»¬ç°åœ¨å°±æ¥è§£å†³ä¸€ä¸‹è¿™ä¸ªé—®é¢˜\n\nå®‰è£…clean-webpack-plugin\n\n```\nnpm install --save-dev clean-webpack-plugin\n```\n\nä¿®æ”¹ã€webpck.prod.config.jsã€‘\n\n```diff\nconst merge = require('webpack-merge'); // ç‰ˆæœ¬ä¸º4.x\n// webpack-merge 5.xç‰ˆæœ¬åº”è¯¥æ”¹ä¸º const { merge } = require('webpack-merge');\nconst common = require('./webpack.common.config.js');\n\nconst HtmlWebpackPlugin = require('html-webpack-plugin');\n+ const { CleanWebpackPlugin } = require('clean-webpack-plugin');\n\nmodule.exports = merge(common, {\n  mode: 'production',\n  plugins: [\n    new HtmlWebpackPlugin({\n      filename: 'index.html', // æ‰“åŒ…ä¹‹åçš„htmlæ–‡ä»¶åå­—\n      // è¿™é‡Œæœ‰å°ä¼™ä¼´å¯èƒ½ä¼šç–‘æƒ‘ä¸ºä»€ä¹ˆä¸æ˜¯ '../public/index.html'\n      // æˆ‘çš„ç†è§£æ˜¯æ— è®ºä¸è¦ç”¨çš„templateæ˜¯ä¸æ˜¯åœ¨ä¸€ä¸ªç›®å½•ï¼Œéƒ½æ˜¯ä»æ ¹è·¯å¾„å¼€å§‹æŸ¥æ‰¾\n      template: 'public/index.html', // ä»¥æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„htmlä¸ºæ¨¡æ¿ç”Ÿæˆï¼Œä¸ç„¶æˆ‘ä»¬è¿˜è¦åˆ°æ‰“åŒ…ä¹‹åçš„htmlæ–‡ä»¶ä¸­å†™script\n      inject: 'body',// åœ¨bodyæœ€åº•éƒ¨å¼•å…¥jsæ–‡ä»¶ï¼Œå¦‚æœæ˜¯headï¼Œå°±æ˜¯åœ¨headä¸­å¼•å…¥js\n      minify: { // å‹ç¼©htmlæ–‡ä»¶\n        removeComments: true, // å»é™¤æ³¨é‡Š\n        collapseWhitespace: true, // å»é™¤ç©ºæ ¼\n      },\n    }),\n+   new CleanWebpackPlugin()\n  ]\n});\n```\n\næˆ‘ä»¬å…ˆæŸ¥çœ‹ç°åœ¨çš„jsæ–‡ä»¶å‰é¢çš„hashå€¼ã€‚ç„¶åæˆ‘ä»¬ä¿®æ”¹ã€src/index.jsã€‘ï¼Œéšä¾¿æ”¹æˆä»€ä¹ˆï¼Œå†é‡æ–°\n\n```\nnpm run build\n```\n\nå°±ä¼šå‘ç°æ–‡ä»¶å¹¶æ²¡æœ‰æ–°å¢ï¼Œè€Œä¸”æ¢äº†æ–°é²œçš„å“ˆå¸Œå€¼ã€‚\n\nå½“ç„¶äº†ï¼Œæˆ‘ä¹‹å‰è¯´çš„é‚£äº›è¯ï¼ŒåŒå­¦ä¸ç›¸ä¿¡çš„è¯ï¼Œå¯ä»¥æŠŠã€new CleanWebpackPlugin()ã€‘è¿™ä¸€è¡Œæ³¨é‡Šæ‰ï¼Œç„¶åå†ä¿®æ”¹ã€src/index.jsã€‘ï¼Œä¼šå‘ç°ã€dist/jsã€‘ä¸‹é¢çš„jsæ–‡ä»¶ä¼šå¢å¤šä¸€æ¡ã€‚\n\n### ä½¿ç”¨webpack-dev-server\n\næ—¢ç„¶åˆšåˆšéƒ½æåˆ°ä¼˜åŒ–äº†ï¼Œæˆ‘ä»¬æ¯æ¬¡éƒ½éœ€è¦buildä¸€ä¸‹ï¼Œæ„Ÿè§‰å¾ˆå‘†ã€‚è€Œwebpackå®˜æ–¹ä¹Ÿæä¾›çƒ­éƒ¨ç½²ï¼Œé‚£æˆ‘ä»¬ç°åœ¨å°±ä½¿ç”¨èµ·æ¥\n\nå®‰è£…webpack-dev-server\n\n```\nnpm install webpack-dev-server --save-dev\n```\n\næ–°å»ºæ–‡ä»¶ã€webpack.dev.config.jsã€‘ğŸ“ƒ\n\n```diff\n  webpackInit\n\t|- config\n\t\t|- webpack\n\t    |- webpack.common.config.js\n      |- webpack.prod.config.js\n+     |- webpack.dev.config.js\n  çœç•¥\n```\n\nç„¶ååŠ å…¥å¦‚ä¸‹ä»£ç \n\n```js\nconst path = require('path');\nconst merge = require('webpack-merge'); // ç‰ˆæœ¬ä¸º4.x\n// webpack-merge 5.xç‰ˆæœ¬åº”è¯¥æ”¹ä¸º const { merge } = require('webpack-merge');\nconst common = require('./webpack.common.config.js');\n\nconst webpack = require('webpack');\nconst HtmlWebpackPlugin = require('html-webpack-plugin');\n\nmodule.exports = merge(common, {\n  mode: 'development',\n  output: {\n    filename: 'js/[name].[hash:8].bundle.js',\n  },\n  devServer: {\n    contentBase: path.resolve(__dirname, '../dist'),\n    open: true,\n    port: 9000,\n    compress: true,\n    hot: true\n  },\n  plugins: [\n    new HtmlWebpackPlugin({\n      template: 'public/index.html',\n      inject: 'body',\n      hash: false\n    }),\n    new webpack.HotModuleReplacementPlugin()\n  ]\n});\n```\n\nä¿®æ”¹æ–‡ä»¶ã€package.jsonã€‘ğŸ“ƒ\n\n```diff\n\"scripts\": {\n-   \"start\": \"webpack --config ./config/webpack/webpack.common.config.js\",\n+   \"start\": \"webpack-dev-server --inline --config ./config/webpack/webpack.dev.config.js\",\n    \"build\": \"webpack --config ./config/webpack/webpack.prod.config.js\",\n  },\n```\n\nç„¶åæˆ‘ä»¬\n\n```\nnpm run start\n```\n\næ˜¯ä¸æ˜¯è‡ªåŠ¨å¼€äº†ä¸€ä¸ªç«¯å£ä¸º9000çš„ç½‘é¡µï¼Œä¸Šé¢æ˜¯æˆ‘ä»¬å†™çš„é¡µé¢å†…å®¹ï¼Œè¿™å’Œæˆ‘ä»¬çš„é…ç½®éƒ½æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚\nç°åœ¨ä½ éšæ„ä¿®æ”¹index.jsä¸­çš„ä»£ç ï¼Œå†å›åˆ°é¡µé¢çœ‹ä¸‹æ˜¯ä¸æ˜¯ä¹Ÿè·Ÿç€å˜äº†ï¼Œé‚£æˆ‘ä»¬å°±æ•´åˆwebpack-dev-serveræˆåŠŸï¼\n\n### ä½¿ç”¨source-map\n\nsource-mapå¯ä»¥å±•ç¤ºæˆ‘ä»¬ä»£ç çš„é”™è¯¯ä½ç½®ï¼Œå› ä¸ºæˆ‘ä»¬çš„ä»£ç éƒ½æ˜¯è¢«webpackæ‰“åŒ…è¿‡çš„ï¼Œåªæœ‰æœºå™¨çœ‹å¾—æ‡‚ï¼Œæˆ‘ä»¬äººç±»æ— æ³•æ­£å¸¸è¯†åˆ«ã€‚æ‰€ä»¥éœ€è¦ä»–ã€‚\n\næƒ³è¯•ä¸€ä¸‹æœªå¼€å¯æ˜¯ä»€ä¹ˆçŠ¶æ€çš„åŒå­¦å¯ä»¥è‡ªå·±æ•…æ„æŠŠä»£ç å†™é”™ï¼Œç„¶åçœ‹çœ‹æ§åˆ¶å°çš„æŠ¥é”™ã€‚\n\nå¼€å¯ä¹Ÿååˆ†ç®€å•ã€‚\n\nå®ƒçš„é…ç½®éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨ ã€webpack.dev.config.jsã€‘ ä¸­å¢åŠ ä¸€ä¸ª `devtool` å±æ€§å³å¯ï¼\n\n```diff\nmodule.exports = {\n+  devtool: 'cheap-module-eval-source-map',\n\t//...\n}\n```\n\nå› ä¸ºæˆ‘ä»¬åªæœ‰è‡ªå·±å†™ä»£ç çš„æ—¶å€™æ‰éœ€è¦æŸ¥çœ‹ï¼Œåˆ°ç”Ÿäº§ç¯å¢ƒå°±è¦å…³é—­å•¦ï¼Œä¸ç„¶æˆ‘ä»¬çš„æ™ºæ…§ç»“æ™¶å°±è¦è¢«ã€çªƒå–ã€‘å•¦ï¼æ‰€ä»¥æˆ‘æ”¾åœ¨äº†\n\n## ä¸­åœºä¼‘æ¯\n\nè¿™é‡Œå›é¡¾ä¸€ä¸‹çŸ¥è¯†ç‚¹ã€‚\n\n1. æˆ‘ä»¬å…ˆnpm init æ–°å»ºä¸€ä¸ªç©ºç™½é¡¹ç›®ã€‚\n2. ç„¶åå®‰è£…webpackï¼Œreactã€‚\n3. å‘ç°æ— æ³•ç¼–è¯‘jsxã€‚\n4. æ‰€ä»¥æˆ‘ä»¬å¯»æ±‚äº†babelçš„å¸®åŠ©ï¼Œå¹¶é…ç½®äº†æ‰€éœ€è¦è§£æçš„å†…å®¹ã€‚\n5. è§‰å¾—åœ¨htmlé‡Œé¢åŠ å…¥jså¾ˆå‘†ï¼Œæ‰€ä»¥å¼•å…¥äº†HtmlWebpackPlugin\n6. å› ä¸ºè§‰å¾—æ¯æ¬¡åˆ é™¤æ‰“åŒ…å‡ºæ¥çš„ä¸œè¥¿å¾ˆå‘†ï¼Œæ‰€ä»¥å¼•å…¥äº†clean-webpack-plugin\n7. å› ä¸ºæ¯æ¬¡éƒ½éœ€è¦é‡æ–°æ‰“åŒ…ï¼Œæ‰€ä»¥ä½¿ç”¨webpack-dev\n8. è‡³äºwebpack-mergeæ˜¯ä¸ºäº†æ‰“åŒ…å’Œç¼–è¯‘ä¸¤ä¸ªæˆ–è€…è¯´å¤šä¸ªçŠ¶æ€åšé¢„å¤‡çš„ï¼Œåœ¨ä¸Šè¿°çš„ä¾‹å­åªæœ‰æœ¬åœ°çš„devå’Œbuildä¸¤ä¸ªç¯å¢ƒã€‚\n\nåŸºæœ¬ä¸Šä¸Šè¿°çš„æ“ä½œè¿‡ç¨‹æˆ‘éƒ½æœ‰è§£é‡Šï¼Œæˆ–è€…æ˜¯æ³¨é‡Šï¼Œæˆ–è€…æ˜¯åœ¨æ–‡ç« ä¸­è¯´æ˜ã€‚å¤§å®¶å¯ä»¥è·Ÿç€èŠ‚å¥ä¸€æ­¥ä¸€æ­¥æ¥ï¼Œå› ä¸ºæˆ‘ä¹Ÿæ˜¯ä¸€è¾¹å†™blogä¸€è¾¹è·‘ä»£ç ä¸€è¾¹å›é¡¾çŸ¥è¯†ç‚¹ã€‚\n\nè‡³æ­¤ï¼Œwebpackç®—æ˜¯å‘Šä¸€â€¦â€¦\n\nè¯¶è¯¶è¯¶è¯¶ï¼jsæ˜¯å¯ä»¥è§£æäº†ï¼Œé‚£csså‘¢ï¼\n\nå“¦å“¦ï¼Œå¥½çš„ï¼Œé‚£æˆ‘ä»¬ç»§ç»­å¯ç¨‹\n\n## é‡æ–°èµ·èˆª\n\n### ä½¿ç”¨css-loaderå’Œstyle-loaderä¸¤å…„å¼Ÿ  \n\nå‡å¦‚æˆ‘ä»¬ç›´æ¥å¼•ç”¨cssçš„è¯ï¼Œä¼šæŠ¥é”™äº†ã€‚è¿™é‡Œå°±ä¸æ¼”ç¤ºäº†ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è‡ªå·±è¯•è¯•ã€‚\n\næ‰€ä»¥ï¼Œæˆ‘ä»¬å…ˆèµ°å‘½ä»¤è¡Œæ•²å‡»\n\n```\nnpm install --save-dev style-loader css-loader \n```\n\n#### ä¸¤å…„å¼Ÿçš„å…³ç³»\n\næ¥è¯´è¯´css-loaderå’Œstyle-loaderä»–ä»¬è¿™å¯¹é¸³é¸¯çš„å…³ç³»ã€‚\n\né¦–å…ˆcss-loaderä¼šæŠŠä½ çš„CSSæ–‡ä»¶è¿›è¡Œè§£æï¼Œå› ä¸ºwebpackæ˜¯ç”¨JSå†™çš„ï¼Œè¿è¡Œåœ¨nodeç¯å¢ƒï¼Œæ‰€ä»¥é»˜è®¤webpackæ‰“åŒ…çš„æ—¶å€™åªä¼šå¤„ç†JSä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼\n\næ‰€ä»¥æˆ‘ä»¬ä¹‹å‰çš„reacté‡Œé¢çš„jsxéœ€è¦babelçš„å¸®åŠ©ï¼Œæˆ–è€…è¯´éœ€è¦ã€babel-loaderã€‘çš„å¸®åŠ©ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„cssåŒæ ·éœ€è¦ã€css-loaderã€‘çš„å¸®åŠ©ï¼Œé‚£ä¹ˆåˆå…³ã€style-loaderã€‘ä»€ä¹ˆäº‹ï¼Ÿå¯ä¸å¯ä»¥ä¸è£…ä»–å‘¢ï¼Ÿ\n\nç­”æ¡ˆæ˜¯ï¼šå¯ä»¥çš„ï¼Œä½†æ˜¯ä½ ä½¿ç”¨èµ·æ¥ä¼šéå¸¸çš„éº»çƒ¦ã€‚æ€ä¹ˆä¸ªéº»çƒ¦æ³•å‘¢ï¼Ÿ\n\nå¦‚æœåªç”¨äº†ã€css-loaderã€‘è§£æå‡ºæ¥çš„æ˜¯è¿™æ ·çš„\n\n```\n[\"./src/index.css\", \".test{â†µ  color: red;â†µ}\", \"\"]\n```\n\nè¿™æ ·å’‹ç”¨å˜›ï¼Œä½ æ˜¯è§£æäº†ï¼Œå¯æ˜¯ä½ è§£æçš„æ˜¯ä¸ªXXã€‚\n\nè¿™ä¸ªæ—¶å€™å°±éœ€è¦æˆ‘ä»¬çš„å¤©é™çŒ›ç”·ã€style-loaderã€‘\n\nstyle-loader æ˜¯é€šè¿‡ä¸€ä¸ªJSè„šæœ¬åˆ›å»ºä¸€ä¸ªstyleæ ‡ç­¾ï¼Œé‡Œé¢åŒ…å«ä¸€äº›æ ·å¼ã€‚style-loaderæ˜¯ä¸èƒ½å•ç‹¬ä½¿ç”¨çš„ï¼Œåº”ä¸ºå®ƒå¹¶ä¸è´Ÿè´£è§£æ css ä¹‹å‰çš„ä¾èµ–å…³ç³»ï¼Œæ¯ä¸ªloaderçš„åŠŸèƒ½éƒ½æ˜¯å•ä¸€çš„ï¼Œå„è‡ªæ‹†åˆ†ç‹¬ç«‹ã€‚\n\n#### ä¸Šæ‰‹ï¼\n\nåŠ å…¥index.css\n\n```diff\nsrc\n+  |- index.css\n   |- indexjs\n```\n\nindex.cssæ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹\n\n```css\n.test{\n  color: red;\n}\n```\n\nä¿®æ”¹index.js\n\n```js\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css'\n\nconst App = () => (\n  <div className=\"test\">\n    Hello Worldï¼!\n  </div>\n)\n\nReactDOM.render(<App />, document.getElementById('root'));\n```\n\nä¿®æ”¹ã€webpack.common.config.jsã€‘ğŸ“ƒ\n\n```diff\n//...\nrules:[\n      {\n        test: /\\.(js|jsx)?$/,\n        // å¼€å¯ç¼“å­˜\n        options: { cacheDirectory: true },\n        loader: 'babel-loader',\n      },\n+      {\n+        test: /\\.css$/,\n+        use: [ \n+          'css-loader', \n+          'style-loader',\n+        ]\n+      }\n    ]\n    //....\n```\n\nè®°å¾—é‡æ–°è¿è¡Œï¼Œå› ä¸ºwebpackçš„é…ç½®ä»–è¯»å–ä¸€æ¬¡ï¼Œæ‰€ä»¥å¦‚æœä½ ä¿®æ”¹äº†é…ç½®ï¼Œéœ€è¦ã€ctrl+cã€‘å…³é—­é‡æ–°è¿è¡Œã€‚\n\nå˜¿å˜¿â€¦â€¦æ˜¯ä¸æ˜¯è¿è¡Œä¸äº†å•Šã€‚\n\nå…¶å®æˆ‘æ˜¯æ•…æ„çš„ï¼Œæˆ‘æƒ³å‘Šè¯‰å¤§å®¶ä¸€ä¸ªçŸ¥è¯†ç‚¹ã€‚\n\n> loaderçš„åŠ è½½é¡ºåºæ˜¯ä»å³å¾€å·¦ã€‚è¿™é‡Œçš„ç¼–è¯‘é¡ºåºæ˜¯å…ˆç”¨css-loaderå°†cssä»£ç ç¼–è¯‘ï¼Œå†äº¤ç»™style-loaderæ’å…¥åˆ°ç½‘é¡µé‡Œé¢å»ã€‚æ‰€ä»¥css-loaderåœ¨å³ï¼Œstyle-loaderåœ¨å·¦ã€‚\n\nè™½ç„¶æˆ‘ä»¬çš„æ•°ç»„æ¢è¡Œäº†ï¼Œä½†æ˜¯ä»”ç»†çœ‹ä¸éš¾çœ‹å‡ºé¡ºåºã€‚\n\næ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å°†ä»–ä»¬æ¢ä¸ªä½ç½®å°±å¯ä»¥äº†ã€‚ä»£ç æˆ‘å°±ä¸è´´äº†ã€‚\n\nç°åœ¨å¤§å®¶åº”è¯¥è®°å¿†å¾ˆæ·±åˆ»äº†å§ï¼\n\nå¤§å®¶é‡æ–°ã€ctrl+cã€‘å…³é—­é‡æ–°è¿è¡Œå°±è¡Œäº†ã€‚æˆ‘ä»¬çš„hello worldæ˜¯ä¸æ˜¯å˜çº¢å•¦ï½\n\n### å®‰è£…less-loader\n\nè¯´åˆ°cssï¼Œè¯´å¥å®åœ¨è¯ï¼Œæ²¡å‡ äººçœŸçš„æ˜¯åœ¨å†™çº¯cssçš„å§ï¼Ÿç°åœ¨è°ä¸æ˜¯lessï¼Œsassæˆ–è€…å…¶ä»–cssé¢„å¤„ç†å‘¢ï¼Ÿè€Œä¸”è¿™äº›é¢„å¤„ç†çš„å¥½å¤„æˆ‘å°±ä¸ç»†è¯´äº†ï¼Œæ„Ÿå…´è¶£çš„è‡ªå·±Googleå§ï¼Œæœ¬æ–‡ç”¨çš„æ˜¯lessï¼ˆå› ä¸ºant designç”¨çš„ä¹Ÿæ˜¯lessï¼Œå“ˆå“ˆï¼Œå‡è£…æ˜¯èš‚èšçš„ä¸€å‘˜ï¼‰\n\nåœ¨å‘½ä»¤è¡Œè¾“å…¥\n\n```\nnpm install --save-dev less less-loader\n```\n\nlessæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œç”¨ä»–è‚¯å®šè¦è£…ï¼Œless-loaderï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯lessçš„è§£æè€…ã€‚\n\nåœ¨ã€webpack.common.config.jsã€‘å¢åŠ \n\n```diff\n{\n        test: /\\.css$/,\n        use: [ \n          'style-loader',\n          'css-loader', \n        ]\n      },\n+      {\n+        test: /\\.less$/,\n+        use: [ \n+          'style-loader',\n+          'css-loader', \n+          'less-loader',\n+        ]\n+      }\n```\n\nä¾æ—§æ˜¯é¡ºåºé—®é¢˜ï¼Œå…ˆè§£ælessï¼ŒæŠŠlessè§£ææˆå¸¸è§„çš„cssï¼Œç„¶åå†è§£æcssï¼Œæœ€åæ’å…¥åˆ°ç½‘é¡µä¸­å»ã€‚\n\nä¿®æ”¹ã€index.jsã€‘å¼•å…¥è‡ªå·±å†™çš„ã€.lessã€‘æ–‡ä»¶\n\nå¤§å®¶é‡æ–°ã€ctrl+cã€‘å…³é—­é‡æ–°è¿è¡Œå°±è¡Œäº†ã€‚è‡³äºä½ å†™äº†ä»€ä¹ˆlessç‰¹æ€§ï¼Œåªè¦æœ‰æ•ˆæœå°±è¡Œäº†ã€‚\n\n### å®‰è£…url-loaderå’Œfile-loader\n\nè¯´å®ŒCSSï¼Œç¾ä¸½çš„ç½‘é¡µå½“ç„¶ç¦»ä¸å¼€æˆ‘ä»¬åŠ¨äººçš„å›¾ç‰‡å•¦ã€‚\n\nã€file-loaderã€‘çš„ä½œç”¨æ˜¯ï¼ŒæŠŠä½ çš„æ–‡ä»¶æ‰“åŒ…èµ·æ¥ï¼Œå’Œjsæ–‡ä»¶æ”¾åœ¨ä¸€èµ·ï¼Œè¿™æ ·ç”¨æˆ·è®¿é—®æˆ‘ä»¬çš„ç½‘é¡µçš„æ—¶å€™ï¼Œå…¶å®ä¹Ÿéœ€è¦è®¿é—®æˆ‘ä»¬çš„urlï¼Œæ—¢å¢åŠ äº†æœåŠ¡å™¨çš„å‹åŠ›ï¼Œä¹Ÿå¢åŠ äº†ç”¨æˆ·å‡çº§æµé‡çš„å‹åŠ›ï¼Œéœ€è¦å»ä¸‹è½½è¿™ä¸ªæ–‡ä»¶ã€‚\n\nã€url-loaderã€‘\n\nå¦‚æœé¡µé¢å›¾ç‰‡è¾ƒå¤šï¼Œå‘å¾ˆå¤šhttpè¯·æ±‚ï¼Œä¼šé™ä½é¡µé¢æ€§èƒ½ã€‚è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡url-loaderè§£å†³ã€‚url-loaderä¼šå°†å¼•å…¥çš„å›¾ç‰‡ç¼–ç ï¼Œç”ŸæˆdataURlå¹¶å°†å…¶æ‰“åŒ…åˆ°æ–‡ä»¶ä¸­ï¼Œæœ€ç»ˆåªéœ€è¦å¼•å…¥è¿™ä¸ªdataURLå°±èƒ½è®¿é—®å›¾ç‰‡äº†ã€‚\n\nurl-loaderå’Œfile-loaderä¸¤å…„å¼Ÿçš„æ­é…å¯ä»¥æœ‰æ•ˆçš„å‡å°‘ä¸å¿…è¦çš„urlè¯·æ±‚ï¼Œå› ä¸ºæœ‰çš„å›¾ç‰‡ä½ è¦å»è¯·æ±‚urlè·å–ï¼Œå¦‚æœå°çš„è¯å®Œå…¨å¯ä»¥ç”¨base64æ›¿ä»£ã€‚å¦‚æœå›¾ç‰‡å¾ˆå¤§çš„è¯å°±ç”¨file-loaderï¼Œè¿™æ ·å¯ä»¥å‡å°‘ç¼–ç çš„å‹åŠ›ã€‚\n\nåœ¨å‘½ä»¤è¡Œè¾“å…¥\n\n```\nnpm install file-loader url-loader --save-dev\n```\n\nä¿®æ”¹ã€webpack.common.config.jsã€‘ğŸ“ƒ\n\n```diff\nmodule: {\n  rules: [\n    //...\n+    {\n+      test: /\\.(jpg|png|gif)$/,\n+      use: {\n+        loader: 'url-loader',\n+        options: {\n+          name: '[name].[ext]', //è¾“å‡ºçš„æ–‡ä»¶å\n+          outputPath: 'images/', // è¾“å‡ºåˆ°distç›®å½•ä¸‹çš„è·¯å¾„ï¼ˆdist/images/ï¼‰\n\t\t\t\t\t\t/**\n             * å¦‚æœä½ è¿™ä¸ªå›¾ç‰‡æ–‡ä»¶å¤§äº8192bï¼Œå³8kbï¼Œé‚£æˆ‘url-loaderå°±ä¸ç”¨ï¼Œè½¬è€Œå»ä½¿ç”¨file-loaderï¼Œ\n             * æŠŠå›¾ç‰‡æ­£å¸¸æ‰“åŒ…æˆä¸€ä¸ªå•ç‹¬çš„å›¾ç‰‡æ–‡ä»¶åˆ°è®¾ç½®çš„ç›®å½•ä¸‹ï¼Œè‹¥æ˜¯å°äºäº†8kbï¼Œ\n             * é‚£å¥½ï¼Œæˆ‘å°±å°†å›¾ç‰‡æ‰“åŒ…æˆbase64çš„å›¾ç‰‡æ ¼å¼æ’å…¥åˆ°bundle.jsæ–‡ä»¶ä¸­ï¼Œ\n             * è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå‡å°‘äº†httpè¯·æ±‚ï¼Œä½†æ˜¯å¦‚æœæ–‡ä»¶è¿‡å¤§ï¼Œjsæ–‡ä»¶ä¹Ÿä¼šè¿‡å¤§ï¼Œ\n             * å¾—ä¸å¿å¤±ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆæœ‰limitçš„åŸå› ï¼\n             */\n+          limit: 8192,\n+        },\n+      }\n+    }\n  ]\n}\n```\n\n\n\n## è¿›é˜¶\n\nåŸºæœ¬ä¸Šæˆ‘ä»¬çš„webpackå¯ä»¥æ­£å¸¸è¿è¡Œäº†ï¼Œcssï¼Œjsï¼Œjsxéƒ½å¯ä»¥è§£æäº†ã€‚ä½†æ˜¯æˆ‘ä»¬éœ€è¦è€ƒè™‘ä¸€äº›è¿›é˜¶çš„ä¸œè¥¿ï¼Œä¼˜åŒ–ã€‚\n\n### ä½¿ç”¨uglifyjs-webpack-plugin\n\nåœ¨æ§åˆ¶å°æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼š\n\n```\nnpm install uglifyjs-webpack-plugin --save-dev\n```\n\nåœ¨ã€webpack.prod.config.jsã€‘æ·»åŠ ä»£ç \n\n```js\nconst UglifyJsPlugin = require('uglifyjs-webpack-plugin');\n\nmodule.exports = {\n//...\n  optimization: {\n    minimizer: [\n      new UglifyJsPlugin({\n        test: /\\.js(\\?.*)?$/i,  //æµ‹è¯•åŒ¹é…æ–‡ä»¶,\n        include: /\\/includes/, //åŒ…å«å“ªäº›æ–‡ä»¶\n        excluce: /\\/excludes/, //ä¸åŒ…å«å“ªäº›æ–‡ä»¶\n\n        cache: false,   //æ˜¯å¦å¯ç”¨æ–‡ä»¶ç¼“å­˜ï¼Œé»˜è®¤ç¼“å­˜åœ¨node_modules/.cache/uglifyjs-webpack-plugin.ç›®å½•\n        parallel: true,  //ä½¿ç”¨å¤šè¿›ç¨‹å¹¶è¡Œè¿è¡Œæ¥æé«˜æ„å»ºé€Ÿåº¦\n\n        //å…è®¸è¿‡æ»¤å“ªäº›å—åº”è¯¥è¢«uglifiedï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰å—éƒ½æ˜¯uglifiedï¼‰ã€‚ \n        //è¿”å›trueä»¥uglifyå—ï¼Œå¦åˆ™è¿”å›falseã€‚\n        chunkFilter: (chunk) => {\n            // `vendor` æ¨¡å—ä¸å‹ç¼©\n            if (chunk.name === 'vendor') {\n              return false;\n            }\n            return true;\n          }\n        }),\n  \n    ],\n  },\n  //..\n};\n```\n\n### ä½¿ç”¨splitChunks\n\nå…¶å®æˆ‘ä»¬å†™çš„ä»£ç ï¼Œæœ‰äº›åº“çš„ä»£ç æ˜¯ä¸éœ€è¦æ¯æ¬¡éƒ½ç¼–è¯‘çš„ï¼Œæœ€ç®€å•çš„ä¾‹å­å°±æ˜¯Reactï¼Œè¿™ä¸ªæˆ‘ä»¬å‡ ä¹æ¯ä¸ªjsæ–‡ä»¶éƒ½ä¼šç”¨åˆ°ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬å•ç‹¬æ‰“åŒ…ï¼Œè¿™æ ·åªéœ€è¦æ‰“åŒ…ä¸€æ¬¡ã€‚\n\nä¿®æ”¹ã€webpack.common.config.jsã€‘\n\n```diff\nentry: {\n     index: './src/index.js',\n+    common: ['react', 'react-dom']\n  },\n```\n\nä¿®æ”¹ã€webpack.prod.config.jsã€‘\n\n```js\nconst merge = require('webpack-merge'); // ç‰ˆæœ¬ä¸º4.x\n// webpack-merge 5.xç‰ˆæœ¬åº”è¯¥æ”¹ä¸º const { merge } = require('webpack-merge');\nconst common = require('./webpack.common.config.js');\n\nconst HtmlWebpackPlugin = require('html-webpack-plugin');\nconst { CleanWebpackPlugin } = require('clean-webpack-plugin');\n\nconst UglifyJsPlugin = require('uglifyjs-webpack-plugin');\n\nmodule.exports = merge(common, {\n  mode: 'production',\n  plugins: [\n    new HtmlWebpackPlugin({\n      filename: 'index.html', // æ‰“åŒ…ä¹‹åçš„htmlæ–‡ä»¶åå­—\n      // è¿™é‡Œæœ‰å°ä¼™ä¼´å¯èƒ½ä¼šç–‘æƒ‘ä¸ºä»€ä¹ˆä¸æ˜¯ '../public/index.html'\n      // æˆ‘çš„ç†è§£æ˜¯æ— è®ºä¸è¦ç”¨çš„templateæ˜¯ä¸æ˜¯åœ¨ä¸€ä¸ªç›®å½•ï¼Œéƒ½æ˜¯ä»æ ¹è·¯å¾„å¼€å§‹æŸ¥æ‰¾\n      template: 'public/index.html', // ä»¥æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„htmlä¸ºæ¨¡æ¿ç”Ÿæˆï¼Œä¸ç„¶æˆ‘ä»¬è¿˜è¦åˆ°æ‰“åŒ…ä¹‹åçš„htmlæ–‡ä»¶ä¸­å†™script\n      inject: 'body',// åœ¨bodyæœ€åº•éƒ¨å¼•å…¥jsæ–‡ä»¶ï¼Œå¦‚æœæ˜¯headï¼Œå°±æ˜¯åœ¨headä¸­å¼•å…¥js\n      minify: { // å‹ç¼©htmlæ–‡ä»¶\n        removeComments: true, // å»é™¤æ³¨é‡Š\n        collapseWhitespace: true, // å»é™¤ç©ºæ ¼\n      },\n    }),\n    new CleanWebpackPlugin()\n  ],\n  optimization: {\n    minimizer: [\n      new UglifyJsPlugin({\n        test: /\\.js(\\?.*)?$/i,  //æµ‹è¯•åŒ¹é…æ–‡ä»¶,\n        // include: /\\/includes/, //åŒ…å«å“ªäº›æ–‡ä»¶\n        // excluce: /\\/excludes/, //ä¸åŒ…å«å“ªäº›æ–‡ä»¶\n\n        //å…è®¸è¿‡æ»¤å“ªäº›å—åº”è¯¥è¢«uglifiedï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰å—éƒ½æ˜¯uglifiedï¼‰ã€‚ \n        //è¿”å›trueä»¥uglifyå—ï¼Œå¦åˆ™è¿”å›falseã€‚\n        chunkFilter: (chunk) => {\n            // `vendor` æ¨¡å—ä¸å‹ç¼©\n            if (chunk.name === 'vendor') {\n              return false;\n            }\n            return true;\n          }\n        }),\n  \n        cache: false,   //æ˜¯å¦å¯ç”¨æ–‡ä»¶ç¼“å­˜ï¼Œé»˜è®¤ç¼“å­˜åœ¨node_modules/.cache/uglifyjs-webpack-plugin.ç›®å½•\n        parallel: true,  //ä½¿ç”¨å¤šè¿›ç¨‹å¹¶è¡Œè¿è¡Œæ¥æé«˜æ„å»ºé€Ÿåº¦\n    ],\n    splitChunks: {\n      /**\n       * é»˜è®¤å€¼æ˜¯async\n       * æ‹†åˆ†æ¨¡å—çš„èŒƒå›´ï¼Œå®ƒæœ‰ä¸‰ä¸ªå€¼asyncã€initialå’Œallã€‚\n       * asyncè¡¨ç¤ºåªä»å¼‚æ­¥åŠ è½½å¾—æ¨¡å—ï¼ˆåŠ¨æ€åŠ è½½import()ï¼‰é‡Œé¢è¿›è¡Œæ‹†åˆ†\n       * initialè¡¨ç¤ºåªä»å…¥å£æ¨¡å—è¿›è¡Œæ‹†åˆ†\n       * allè¡¨ç¤ºä»¥ä¸Šä¸¤è€…éƒ½åŒ…æ‹¬\n       */\n      chunks: 'all',\n      // minSize: 30000, // ç”Ÿæˆchunkçš„æœ€å°å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚åªæœ‰å¤§äºè¿™ä¸ªæ•°å­—æ‰å¯ä»¥æˆä¸€ä¸ªchunk \n      // minRemainingSize: 0, // åªæœ‰å‰©ä¸‹ä¸€ä¸ªchunkçš„æ—¶å€™æ‰ä¼šç”Ÿæ•ˆï¼Œé»˜è®¤æ˜¯å’ŒminSizeä¸€æ ·çš„ï¼Œå¼€å‘çš„æ—¶å€™é»˜è®¤æ˜¯0\n      // maxSize: 0, // å‘Šè¯‰webpackå°è¯•å°†å¤§äºmaxSizeå­—èŠ‚çš„å—æ‹†åˆ†ä¸ºè¾ƒå°çš„éƒ¨åˆ†ã€‚\n      // minChunks: 1, // æ‹†åˆ†å‰å¿…é¡»å…±äº«æ¨¡å—çš„æœ€å°å—æ•°ã€‚\n      // maxAsyncRequests: 6, // æŒ‰éœ€åŠ è½½æ—¶æœ€å¤§å¹¶è¡Œè¯·æ±‚æ•°ã€‚\n      // maxInitialRequests: 4, // å…¥å£ç‚¹çš„æœ€å¤§å¹¶è¡Œè¯·æ±‚æ•°ã€‚å…¥å£æ–‡ä»¶\n      // automaticNameDelimiter: '~', // é»˜è®¤æƒ…å†µä¸‹ï¼Œwebpackå°†ä½¿ç”¨å—çš„æ¥æºå’Œåç§°ç”Ÿæˆåç§°ï¼ˆä¾‹å¦‚vendors~main.jsï¼‰ã€‚æ­¤é€‰é¡¹ä½¿æ‚¨å¯ä»¥æŒ‡å®šç”¨äºç”Ÿæˆåç§°çš„å®šç•Œç¬¦ã€‚\n      cacheGroups: {\n        /**\n         * å½“webpackå¤„ç†æ–‡ä»¶è·¯å¾„æ—¶ï¼Œå®ƒä»¬å§‹ç»ˆåŒ…å«/åœ¨Unixç³»ç»Ÿå’Œ\\Windowsä¸Šã€‚\n         * è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ[\\\\/]åœ¨{cacheGroup}.testå­—æ®µä¸­ä½¿ç”¨in æ¥è¡¨ç¤ºè·¯å¾„åˆ†éš”ç¬¦çš„åŸå› ã€‚\n         * /æˆ–\\in {cacheGroup}.testä¼šåœ¨è·¨å¹³å°ä½¿ç”¨æ—¶å¼•èµ·é—®é¢˜ã€‚\n         */\n        // defaultVendors: {\n        //   test: /[\\\\/]node_modules[\\\\/]/, // åˆ†å—ç›®æ ‡\n        //   priority: -10 // æƒé‡\n        // },\n        // default: {\n        //   minChunks: 2, // æœ€å°å¼•ç”¨\n        //   priority: -20, // æƒé‡\n        //   // å¦‚æœå½“å‰å—åŒ…å«å·²ä»ä¸»æ†ç»‘åŒ…ä¸­æ‹†åˆ†å‡ºçš„æ¨¡å—ï¼Œåˆ™å°†é‡ç”¨è¯¥æ¨¡å—ï¼Œè€Œä¸æ˜¯ç”Ÿæˆæ–°çš„æ¨¡å—ã€‚è¿™å¯èƒ½ä¼šå½±å“å—çš„ç»“æœæ–‡ä»¶åã€‚\n        //   reuseExistingChunk: true\n        // },\n        // ä¸Šè¿°çš„splitChunkså…¨æ˜¯webpack4æœªè®¾ç½®æƒ…å†µä¸‹çš„é»˜è®¤å€¼ï¼Œé™¤äº†chunksä»ã€asyncã€‘->ã€allã€‘å…¶ä»–éƒ½æ²¡æœ‰æ”¹\n        // okï¼Œæˆ‘ä»¬ç°åœ¨åŠ å…¥æˆ‘ä»¬è‡ªå·±æƒ³è¦çš„ä»£ç åˆ†å‰²\n        // å› ä¸ºæˆ‘å‡†å¤‡åŠ å…¥reactç­‰ä¸šåŠ¡åƒå˜ä¸‡åŒ–è€Œä¸ä¼šå˜çš„åº“\n        common: {\n          test: \"common\", // webpackæ‰«é¢çš„å…³é”®å­—\n          name: \"common\", // ç”Ÿæˆçš„åå­—\n          enforce: true // æ˜¯å¦ç¼“å­˜\n        },\n      }\n    }\n  },\n});\n```\n\nä¸æƒ³å†™diffå•¦ï¼Œç›´æ¥CVå•¦ã€‚ã€‚ã€‚\n\nä¸ºä»€ä¹ˆæˆ‘éœ€è¦æŠŠreactæå–å‡ºæ¥ï¼Œå› ä¸ºå“ªé‡Œéƒ½éœ€è¦ç”¨ï¼Œè€Œä¸”ä»–å‡ ä¹ä¸å¯èƒ½ä¼šå˜ï¼Œæ‰€ä»¥æˆ‘ç‰¹åˆ«æå‡ºæ¥åšäº†ç¼“å­˜ï¼Œå…¶ä½™çš„è¿˜æ˜¯ä½¿ç”¨çš„é»˜è®¤é…ç½®ï¼ˆé™¤äº†chunkæ”¹ä¸ºäº†â€˜allâ€™ï¼‰ã€‚\n\n> Tobias Koppers@Wsokraï¼šoptimization. splitchunks. chunks: althe only option you need for vendor and commons splitting in webpackBest combine it with html-webpack-plugin or equivalent html generation18120\n\nä½œè€…éƒ½å‘æ¨ç‰¹è¯´äº†ï¼Œé‚£æˆ‘ä»¬ä¹Ÿå°±æ¥å—å§ï½å°±æ”¹ä¸ªallï¼Œç„¶åè¡¥ä¸€ä¸‹reactï½\n\nå†é‡æ–°æ‰“åŒ…ï¼Œä½ ä¼šå‘ç°index.bundle.jsï¼ˆä¸è¢«ç¼“å­˜ï¼‰çš„hashå€¼å˜äº†ï¼Œä½†æ˜¯common.bundle.jsï¼ˆèƒ½è¢«ç¼“å­˜ï¼‰çš„hashå€¼æ²¡å˜ã€‚\n\n### ä½¿ç”¨mini-css-extract-plugin\n\njséƒ½ç‹¬ç«‹ğŸ“¦ï¼Œé‚£æˆ‘cssä¹Ÿè¦ï¼\n\nå…¶å®å¦‚æœæŠŠCSSæ‰“åŒ…æˆä¸€ä¸ªæ–‡ä»¶ç„¶åè®©htmlå¼•ç”¨çš„è¯å¯ä»¥å‡å°htmlæ–‡ä»¶çš„å¤§å°ï¼Œæš—åˆäº†HTTP2çš„å¤šè·¯å¤ç”¨ï¼Œå¤šæ–‡ä»¶å°æ•°é‡ã€‚åŒ…æ‹¬ä¹‹å‰çš„splitChunksé‡Œé¢æˆ‘ä»¬é…ç½®çš„reactä¹Ÿæ˜¯ä¸ºäº†HTTP2ã€‚\n\nåœ¨å‘½ä»¤è¡Œè¾“å…¥ï¼š\n\n```\nnpm install --save-dev mini-css-extract-plugin\n```\n\nä¿®æ”¹ã€webpack.common.config.jsã€‘\n\n```diff\n+ const MiniCssExtractPlugin = require('mini-css-extract-plugin');\n\n//...\nmodule:{\n    rules:[\n      {\n        test: /\\.css$/,\n        use: [ \n+          MiniCssExtractPlugin.loader,\n-          'style-loader',\n           'css-loader', \n        ]\n      },\n    ],\n  },\n+plugins: [\n+    new MiniCssExtractPlugin({\n+      filename: 'css/[name].[hash].css',\n+      chunkFilename: 'css/[id].[hash].css',\n+    }),\n  ]\n```\n\n\n\n### ä½¿ç”¨CSS Module\n\nå…¶å®å¾ˆç®€å•ï¼Œåªéœ€è¦ä¿®æ”¹ä¸€ä¸‹é…ç½®ã€wbpack.common.config.jsã€‘\n\n```diff\n{\n        test: /\\.css$/,\n        use: [ \n          MiniCssExtractPlugin.loader,\n-          'css-loader'\n+          {\n+            loader: 'css-loader',\n+            options: {\n+              // importLoaders: 1,\n+              modules: true,\n+            },\n+          },\n        ]\n      },\n```\n\n### ä½¿ç”¨PostCSS\n\n> postcss ä¸€ç§å¯¹cssç¼–è¯‘çš„å·¥å…·ï¼Œç±»ä¼¼babelå¯¹jsçš„å¤„ç†ï¼Œå¸¸è§çš„åŠŸèƒ½å¦‚ï¼š 1 . ä½¿ç”¨ä¸‹ä¸€ä»£cssè¯­æ³• 2 . è‡ªåŠ¨è¡¥å…¨æµè§ˆå™¨å‰ç¼€ 3 . è‡ªåŠ¨æŠŠpxä»£ä¸ºè½¬æ¢æˆrem 4 . css ä»£ç å‹ç¼©ç­‰ç­‰ postcss åªæ˜¯ä¸€ä¸ªå·¥å…·ï¼Œæœ¬èº«ä¸ä¼šå¯¹cssä¸€é¡¿æ“ä½œï¼Œå®ƒé€šè¿‡æ’ä»¶å®ç°åŠŸèƒ½ï¼Œautoprefixer å°±æ˜¯å…¶ä¸€ã€‚\n\nå®‰è£…postcss\n\n```\nnpm install postcss postcss-loader --save-dev\n```\n\nå®‰è£…postcssæŸä¸ªæ’ä»¶ï¼Œä»¥Autoprefixerä¸¾ä¾‹\n\n```\nnpm install postcss-aspect-ratio-mini postcss-write-svg postcss-px-to-viewport postcss-viewport-units postcss-flexbugs-fixes postcss-preset-env cssnano --save-dev\n```\n\nåœ¨æ ¹ç›®æ ‡æ–°å»ºæ–‡ä»¶ã€postcss.config.jsã€‘\n\n```js\n/* eslint-disable import/no-extraneous-dependencies */\n/* eslint-disable @typescript-eslint/no-var-requires */\nconst postcssAspectRatioMini = require('postcss-aspect-ratio-mini');\nconst postcssPxToViewport = require('postcss-px-to-viewport');\nconst postcssWriteSvg = require('postcss-write-svg');\nconst postcssViewportUnits = require('postcss-viewport-units');\nconst cssnano = require('cssnano');\nconst postcssPresetEnv = require('postcss-preset-env')\n\nconst postcssFlexbugsFixes = require('postcss-flexbugs-fixes')\n\nmodule.exports = {\n  plugins: [\n    postcssFlexbugsFixes,\n    // åœ¨è¿™ä¸ªä½ç½®åŠ å…¥æˆ‘ä»¬éœ€è¦é…ç½®çš„ä»£ç \n    // åœ¨è¿™ä¸ªä½ç½®åŠ å…¥æˆ‘ä»¬éœ€è¦é…ç½®çš„ä»£ç \n    // åœ¨è¿™ä¸ªä½ç½®åŠ å…¥æˆ‘ä»¬éœ€è¦é…ç½®çš„ä»£ç \n    postcssAspectRatioMini({}),\n    postcssPxToViewport({\n      viewportWidth: 750, // åŸºå‡†å®½åº¦ï¼ˆä¸€èˆ¬çš„è®¾è®¡éƒ½æ˜¯è¿™ä¸ªåŸºå‡†\n      viewportHeight: 1334, // åŸºå‡†é«˜åº¦ï¼ˆä¸€èˆ¬çš„è®¾è®¡éƒ½æ˜¯è¿™ä¸ªåŸºå‡†\n      unitPrecision: 3, // (Number) The decimal numbers to allow the REM units to grow to.\n      viewportUnit: 'vw', // (String) å•ä½\n      selectorBlackList: ['.list-ignore', /notTransform/], // å¸¦ä¸Šè¿™ä¸ªå•è¯çš„å°±ä¸ä¼šfixä¸ºvwå•ä½\n      minPixelValue: 1, // (Number) æœ€å°åƒç´ \n      mediaQuery: false, // (Boolean) å…è®¸åœ¨åª’ä½“æŸ¥è¯¢ä¸­è½¬æ¢pxã€‚\n      exclude: /(\\/|\\\\)(node_modules)(\\/|\\\\)/,\n    }),\n    postcssWriteSvg({\n      utf8: false\n    }),\n    postcssPresetEnv({}),\n    postcssViewportUnits({\n      filterRule: rule => rule.selector.includes('::after')\n        && rule.selector.includes('::before')\n        && rule.selector.includes(':after')\n        && rule.selector.includes(':before')\n    }),\n    cssnano({\n      \"cssnano-preset-advanced\": {\n        zindex: false,\n        autoprefixer: false\n      },\n    })\n  ]\n};\n```\n\nä¿®æ”¹ã€webpack.common.config.jsã€‘\n\n```diff\n{\n        test: /\\.css$/,\n        use: [ \n          'style-loader',\n          'css-loader', \n+          'postcss-loader'\n        ]\n      },\n      {\n        test: /\\.less$/,\n        use: [ \n          'style-loader',\n          'css-loader', \n          'less-loader',\n+          'postcss-loader'\n        ]\n      }\n```\n\nç„¶åï¼Œä¿®æ”¹æˆ‘ä»¬çš„cssæ–‡ä»¶ï¼Œçœ‹çœ‹æˆ‘ä»¬å†™çš„å•ä½ä¸ºpxçš„æœ‰æ²¡æœ‰è¢«æ”¹ä¸ºvwçš„è‡ªé€‚åº”å•ä½ã€‚\n\né¡ºä¾¿è¯•ä¸€ä¸‹å¸¦æœ‰ã€notTransformã€‘çš„æ˜¯ä¸æ˜¯è¿˜æ˜¯pxä½œä¸ºå•ä½ã€‚\n\n## ç»“æŸ\n\nåˆ°æ­¤ï¼Œæˆ‘ä»¬çš„webpacké…ç½®ï¼Œå°±ç®—æ˜¯å…¥é—¨äº†ï¼Œå¯¹äºwebpackçš„é…ç½®æˆ‘ä»¬è¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ã€‚å¤§å®¶åŠ æ²¹ï¼\n\nå¦‚æœæœ‰å“ªé‡Œå†™çš„ä¸å¥½æˆ–è€…å†™é”™äº†ï¼Œæ¬¢è¿å¤§å®¶åœ¨è¯„è®ºåŒºè®¨è®ºã€‚","source":"_posts/ä»é›¶é…ç½®ä½ çš„Webpack.md","raw":"---\ntitle: ä»é›¶é…ç½®ä½ çš„Webpack\ndate: 2020-06-07 06:11:13\ntags: [Webpack]\ncategory: [Webpack]\ncover: /image/cover/webpack.png\n---\n\n# ä»é›¶é…ç½®ä½ çš„Webpack\n\n## å‰è¨€\n\nä¸Šç¯‡æ–‡ç« ç®€å•çš„ä»‹ç»äº†ä¸€ä¸‹ï¼Œå‰ç«¯è¿›é˜¶ä¹‹è„šæ‰‹æ¶çš„æ­å»ºã€‚å…¶å®æˆ‘ä¸ªäººè®¤ä¸ºé‡è¦çš„è¿˜æ˜¯Webpackçš„é…ç½®å‡ºæ¥çš„templateï¼Œè‡³äºè„šæ‰‹æ¶çš„äº¤äº’ä½“éªŒå¯ä»¥åæœŸå»ä¼˜åŒ–ï¼Œä¹Ÿå¯ä»¥æ›´åŠ çš„ä¸ªæ€§åŒ–ã€‚ä½†æ˜¯æˆ‘ä»¬çš„æ ¸å¿ƒè¿˜æ˜¯æ”¾åœ¨Webpackç­‰ä¸€ç³»åˆ—çš„é…ç½®ä¸Šã€‚\n\nè¿™ç¯‡æ–‡ç« çš„ç›®çš„\n\n- å¯ä»¥ç»™è‡ªå·±ä¸€ä¸ªå›é¡¾çš„åœ°æ–¹\n- åŠ å¼ºå¯¹Webpackçš„ç†è§£ï¼Œæ¯ä¸ªçŸ¥è¯†ç‚¹éƒ½ä¼šè®¤è®¤çœŸçœŸçš„å½»æŸ¥ï¼å°½é‡è®©æ¯ä¸€æ­¥éƒ½æ˜¯éå¸¸æ¸…æ™°æ˜äº†çš„ï¼\n- å¦‚æœå¯ä»¥å¸®åŠ©åˆ°å¤§å®¶é‚£æ˜¯æ›´å¥½ä¸è¿‡äº†\n\nå¥½äº†ï¼Œæ”¶ï¼è¯ä¸å¤šè¯´å¼€å§‹ï¼\n\n\n\n## å‰æ\n\nç›¸ä¿¡æ¥åˆ°è¿™é‡Œçš„å°ä¼™ä¼´ï¼Œéƒ½æ˜¯æœ‰ä¸€äº›äº›å‰ç«¯çš„ç»éªŒäº†ï¼Œè‡³äºä»€ä¹ˆnodeå®‰è£…ç¯å¢ƒå˜é‡è¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚æœ¬äººä½¿ç”¨çš„æ˜¯mac osï¼Œå¦‚æœæ˜¯Windowsçš„å¹¶ä¸”ç¢°åˆ°é—®é¢˜çš„è¯ï¼Œå¯ä»¥ç•™è¨€ï¼Œæˆ–è€…ç›´æ¥Googleã€‚\n\n\n\n## å¼€å§‹\n\n### å»ºç«‹ä¸€ä¸ªç©ºçš„æ–‡ä»¶å¤¹ğŸ“\n\næ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œåä¸ºã€webpackInitã€‘\n\nå¹¶ä¸”ä½¿ç”¨ä½ çš„ç¼–è¾‘å™¨æ‰“å¼€ä»–ï¼Œç„¶åæ‰“å¼€å‘½ä»¤è¡Œæ‰§è¡Œï¼š\n\n```js\nnpm init -y\n```\n\nè¿™ä¸ªå‘½ä»¤æ˜¯nodeå¸®ä½ åˆå§‹åŒ–ä¸€ä¸ªé¡¹ç›®ç”¨çš„ï¼Œå¸®ä½ æ–°å»ºä¸€ä¸ª`package.json`ã€‚\n\nè‡³äº`-y`æ˜¯ç”¨äºé»˜è®¤éƒ½ä»¥**yes**ç»§ç»­æ‰§è¡Œã€‚å¦‚æœæƒ³äº†è§£ä¸€ä¸‹é‡Œé¢åˆ°åº•æœ‰ä»€ä¹ˆçš„åŒå­¦å¯ä»¥ä¸ç”¨*-y*ç»§ç»­è·‘ä¸€éã€‚å…¶å®é‡Œé¢çš„ä¸œè¥¿åæœŸéƒ½å¯ä»¥è‡ªå·±ä¿®æ”¹`package.json`ã€‚æ‰€ä»¥ä¸éœ€è¦å¤ªåœ¨æ„ã€‚\n\n### å®‰è£…WebpackğŸ”§\n\nç°åœ¨æ˜¯åŒ—äº¬æ—¶é—´ï¼š2020/06/07 06:42:49ã€‚\n\nWebpack5æœ‰Betaç‰ˆï¼Œè¿™é‡Œå°±ä¸è€ƒè™‘äº†ï¼Œåç»­ä¸Šæ­£å¼ç‰ˆçš„è¯æˆ‘åº”è¯¥ä¼šå‡ºæ–°çš„æ–‡ç« ä»‹ç»ã€‚\n\nå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ `webpack 4+` ç‰ˆæœ¬ï¼Œè¿˜éœ€è¦å®‰è£… `webpack-cli` ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\n\n```js\nnpm install --save-dev webpack webpack-cli\n```\n\nå› ä¸ºWebpackä¸»è¦æ˜¯ç¼–è¯‘æ—¶ä½¿ç”¨æ‰€ä»¥æ”¾åˆ°â€œdevDependenciesâ€ã€‚\n\nç¡®è®¤ä¸€ä¸‹ç°åœ¨çš„ç›®å½•ç»“æ„ï¼Œä»¥é˜²æœ‰åŒå­¦æ‰é˜Ÿï¼\n\n```diff\nwebpackInit\n  |- node_modules\n  |- package-lock.json\n  |- package.json\n```\n\nè¿™é‡Œè¯´ä¸‹é¢˜å¤–è¯ã€‚\n\n##### package.jsonå’Œpackage-lock.jsonçš„åŒºåˆ«\n\npackage.json æ–‡ä»¶åªèƒ½é”å®šå¤§ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯ç‰ˆæœ¬å·çš„ç¬¬ä¸€ä½ï¼Œå¹¶ä¸èƒ½é”å®šåé¢çš„å°ç‰ˆæœ¬ï¼Œ`npm install` éƒ½æ˜¯æ‹‰å–çš„è¯¥å¤§ç‰ˆæœ¬ä¸‹çš„æœ€æ–°çš„ç‰ˆæœ¬ï¼Œä¸ºäº†ç¨³å®šæ€§è€ƒè™‘æˆ‘ä»¬å‡ ä¹æ˜¯ä¸æ•¢éšæ„å‡çº§ä¾èµ–åŒ…çš„ï¼Œè¿™å°†å¯¼è‡´å¤šå‡ºæ¥å¾ˆå¤šå·¥ä½œé‡ï¼Œæµ‹è¯•/é€‚é…ç­‰ï¼Œæ‰€ä»¥ package-lock.json æ–‡ä»¶å‡ºæ¥äº†ï¼Œå½“ä½ æ¯æ¬¡å®‰è£…ä¸€ä¸ªä¾èµ–çš„æ—¶å€™å°±é”å®šåœ¨ä½ å®‰è£…çš„è¿™ä¸ªç‰ˆæœ¬ã€‚\n\né‚£å¦‚æœæˆ‘ä»¬å®‰è£…æ—¶çš„åŒ…æœ‰bugï¼Œåé¢éœ€è¦æ›´æ–°æ€ä¹ˆåŠï¼Ÿ\n\nåœ¨ä»¥å‰å¯èƒ½å°±æ˜¯ç›´æ¥æ”¹ package.json é‡Œé¢çš„ç‰ˆæœ¬ï¼Œç„¶åå† `npm install` äº†ï¼Œä½†æ˜¯ 5 ç‰ˆæœ¬åå°±ä¸æ”¯æŒè¿™æ ·åšäº†ï¼Œå› ä¸ºç‰ˆæœ¬å·²ç»é”å®šåœ¨ package-lock.json é‡Œäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½ `npm install xxx@x.x.x` è¿™æ ·å»æ›´æ–°æˆ‘ä»¬çš„ä¾èµ–ï¼Œç„¶å package-lock.json ä¹Ÿèƒ½éšä¹‹æ›´æ–°ã€‚\n\n### æ–°å»ºé…ç½®æ–‡ä»¶ğŸ“ƒ\n\næˆ‘ä»¬åœ¨æ ¹ç›®å½•æ–°å»ºæ–‡ä»¶å¤¹ã€configã€‘ç”¨äºå­˜å‚¨ä¸€äº›ç›¸å…³çš„é…ç½®æ–‡ä»¶ï¼Œç„¶ååœ¨ã€configã€‘é‡Œé¢æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ã€webpackã€‘è¡¨ç¤ºï¼Œä¸“é—¨ç”¨äºå­˜å‚¨webpackçš„é…ç½®æ–‡ä»¶ã€‚ç„¶ååœ¨ã€webpackã€‘è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹é¢æ–°å»ºæ–‡ä»¶ã€webpack.common.config.jsã€‘\n\nå¹¶æ•²å…¥ä»¥ä¸‹ä»£ç \n\n\n\n```javascript\nconst path = require('path');\n\nmodule.exports = {\n  // é…ç½®å…¥å£æ–‡ä»¶\n  entry: {\n    app: './src/index.js',\n  },\n  // æ‰“åŒ…ğŸ“¦ä¹‹åçš„å‡ºå£\n  output: {\n    // å¦‚æœä¸åŠ å“ˆå¸Œå€¼ï¼Œæµè§ˆå™¨ä¼šæœ‰ç¼“å­˜ï¼Œå¯èƒ½ä½ éƒ¨ç½²äº†ï¼Œä½†æ˜¯ç”¨æˆ·çœ‹åˆ°çš„è¿˜æ˜¯è€é¡µé¢\n    // 8æ˜¯hashçš„é•¿åº¦ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œwebpackä¼šè®¾ç½®é»˜è®¤å€¼ä¸º20ã€‚\n    filename: 'js/[name].[chunkhash:8].bundle.js',\n    /**\n     * Node.js ä¸­ï¼Œ__dirname æ€»æ˜¯æŒ‡å‘è¢«æ‰§è¡Œ js æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œ\n     * æ‰€ä»¥å½“ä½ åœ¨ /d1/d2/myscript.js æ–‡ä»¶ä¸­å†™äº† __dirnameï¼Œ å®ƒçš„å€¼å°±æ˜¯ /d1/d2 ã€‚\n     * path.resolve\n     * 1.path.resolve()æ–¹æ³•å¯ä»¥å°†è·¯å¾„æˆ–è€…è·¯å¾„ç‰‡æ®µè§£ææˆç»å¯¹è·¯å¾„\n     * 2.ä¼ å…¥è·¯å¾„ä»å³è‡³å·¦è§£æï¼Œé‡åˆ°ç¬¬ä¸€ä¸ªç»å¯¹è·¯å¾„æ˜¯å®Œæˆè§£æï¼Œä¾‹å¦‚path.resolve('/foo', '/bar', 'baz') å°†è¿”å› /bar/baz\n     * 3.å¦‚æœä¼ å…¥çš„ç»å¯¹è·¯å¾„ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå½“å‰ç›®å½•å°†è¢«ä½¿ç”¨\n     * 4.å½“ä¼ å…¥çš„å‚æ•°æ²¡æœ‰/æ—¶ï¼Œå°†è¢«ä¼ å…¥è§£æåˆ°å½“å‰æ ¹ç›®å½•\n     * 5.é›¶é•¿åº¦çš„è·¯å¾„å°†è¢«å¿½ç•¥\n     * 6.å¦‚æœæ²¡æœ‰ä¼ å…¥å‚æ•°ï¼Œå°†è¿”å›å½“å‰æ ¹ç›®å½•\n     * \n     * _dirnameè¡¨ç¤ºç»å¯¹è·¯å¾„\n     * æˆ‘ä»¬ç¢°åˆ°çš„./xxå°±æ˜¯ç›¸å¯¹è·¯å¾„\n     * 1.åªä¼ å…¥__dirnameä¹Ÿå¯ä»¥è‡ªåŠ¨è°ƒç”¨path.resolveæ–¹æ³•\n     * 2.å¯ä»¥æ‹¼æ¥è·¯å¾„å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ä¸è°ƒç”¨path.resolve()æ–¹æ³•æ‹¼æ¥å¤±è´¥\n     * 3.__dirnameä»£è¡¨çš„æ˜¯å½“å‰æ–‡ä»¶ï¼ˆa.jsï¼‰çš„ç»å¯¹è·¯å¾„\n     * 4.ä»å³è‡³å·¦è§£æï¼Œé‡åˆ°äº†ç»å¯¹è·¯å¾„/srcï¼Œå› æ­¤ç›´æ¥è¿”\n     */\n    path: path.resolve(__dirname, '../../dist')\n  }\n}\n```\n\n> webpack é…ç½®æ˜¯æ ‡å‡†çš„ Node.jsçš„CommonJS æ¨¡å—ï¼Œå®ƒé€šè¿‡requireæ¥å¼•å…¥å…¶ä»–æ¨¡å—ï¼Œé€šè¿‡module.exportså¯¼å‡ºæ¨¡å—ï¼Œç”± webpack æ ¹æ®å¯¹è±¡å®šä¹‰çš„å±æ€§è¿›è¡Œè§£æã€‚\n\nåœ¨æ ¹ç›®å½•æ–°å»ºã€srcã€‘æ–‡ä»¶å¤¹ğŸ“\n\nåœ¨ã€srcã€‘æ–‡ä»¶å¤¹ä¸‹æ–°å»ºæ–‡ä»¶index.js\n\nokğŸ‘Œï¼Œç¡®è®¤ä¸€ä¸‹ç›®å½•ç»“æ„\n\n```diff\nwebpackInit\n+ |- config\n+ \t|- webpack\n+     |- webpack.common.config.js\n  |- node_modules\n+ |- src\n+     |- index.js\n  |- package.json\n  |- package-lock.json\n```\n\né‚£æˆ‘ä»¬æ€ä¹ˆæ‰“åŒ…å‘¢ï¼Ÿåœ¨ `package.json` ä¸­é…ç½®å¦‚ä¸‹å±æ€§ï¼š\n\n```diff\n\"scripts\": {\n- \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\",\n+ \"start\": \"webpack --config ./config/webpack/webpack.common.config.js\"\n},\n\n```\n\nå¥½äº†ï¼Œæˆ‘ä»¬è¯•è¯•æ€ä¹ˆæ‰“åŒ…å§ï¼Œè™½ç„¶ä½ çš„ `index.js` ä¸­ä»€ä¹ˆä»£ç ä¹Ÿæ²¡æœ‰ã€‚\nåœ¨æ§åˆ¶å°ä¸­è¾“å…¥ä»¥ä¸‹ä»£ç ï¼š\n\n```\nnpm run start\n```\n\nnpm run xxxx ä¼šå»æ‰§è¡Œå½“å‰ç›®å½•ä¸‹package.jsoné‡Œé¢çš„scriptåŒåè„šæœ¬\n\næˆ‘ä»¬çš„ã€npm run startã€‘ç›¸å½“äºç›´æ¥æ‰§è¡Œäº†æˆ‘ä»¬å†™åœ¨ã€startã€‘é‡Œé¢çš„ä»£ç ã€‚\n\næ‰§è¡Œä¹‹åï¼Œä½ ä¼šå‘ç°æ ¹ç›®å½•å¤šå‡ºäº†ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼š `dist/js` ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªjsæ–‡ä»¶ï¼š `bundle.js` ï¼Œé‚£ä¹ˆè‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸç¼–è¯‘æ‰“åŒ…äº†ä¸€ä¸ªjsæ–‡ä»¶ï¼Œå³å…¥å£æ–‡ä»¶ï¼š `index.js` ã€‚\n\n### å®‰è£…React\n\nåœ¨æ§åˆ¶å°è¾“å…¥ä»¥ä¸‹ä»£ç ï¼š\n\n```\nnpm install --save react react-dom\n```\n\n--saveå°±æ˜¯è¿è¡Œæ—¶ä¼šç”¨åˆ°çš„ä»£ç \n\nå…·ä½“å’Œ--dev-saveçš„åŒºåˆ«å¯ä»¥è‡ªå·±Googleä¸€ä¸‹\n\nåœ¨ã€src/index.jsã€‘é‡Œé¢åŠ å…¥ä»¥ä¸‹ä»£ç \n\n```js\nimport React from 'react';\nimport ReactDOM from 'react-dom';\n\nconst App = () => (\n  <>\n    Hello Worldï¼\n  </>\n)\n\nReactDOM.render(<App />, document.getElementById('root'));\n```\n\nåœ¨æ ¹ç›®å½•åŠ å…¥æ–‡ä»¶å¤¹ã€publicã€‘ï¼Œç„¶ååœ¨ã€publicã€‘é‡Œé¢åŠ å…¥ã€index.htmlã€‘\n\nç›®å½•å¦‚ä¸‹ï¼š\n\n```diff\nwebpackInit\n+ |- public\n+ \t|- index.html\n  |- config\n  \t|- webpack\n      |- webpack.common.config.js\n  |- node_modules\n  |- src\n      |- index.js\n  |- package.json\n  |- package-lock.json\n```\n\nç„¶ååœ¨ã€index.htmlã€‘åŠ å…¥ä»¥ä¸‹ä»£ç ï¼š\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\">\n    <meta name=\"viewport\" content=\"initial-scale=1.0, user-scalable=no, width=device-width\">\n  <title>ä»é›¶é…ç½®Webpack</title>\n</head>\n<body>\n  <div id=\"root\"></div>\n</body>\n</html>\n```\n\nOK\n\nä¸‡äº‹ä¿±å¤‡ï¼Œæˆ‘ä»¬è¿è¡Œï¼š\n\n```\nnpm run start\n```\n\næ‰“åŒ…å¤±è´¥äº†ã€‚ã€‚ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ\n\n### ä½¿ç”¨babel\n\nä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸Šé¢å†™jsxä¼šæ‰“åŒ…ä¸äº†å‘¢ï¼Œå› ä¸ºwebpackæ ¹æœ¬è¯†åˆ«ä¸äº†jsxè¯­æ³•ï¼Œé‚£æ€ä¹ˆåŠï¼Ÿä½¿ç”¨loaderå¯¹æ–‡ä»¶è¿›è¡Œé¢„å¤„ç†ã€‚\nå…¶ä¸­ï¼Œbabel-loaderï¼Œå°±æ˜¯è¿™æ ·ä¸€ä¸ªé¢„å¤„ç†æ’ä»¶ï¼Œå®ƒåŠ è½½ ES2015+ ä»£ç ï¼Œç„¶åä½¿ç”¨ Babel è½¬è¯‘ä¸º ES5ã€‚é‚£å¼€å§‹é…ç½®å®ƒå§ï¼\n\né¦–å…ˆå®‰è£…babelç›¸å…³çš„æ¨¡å—ï¼š\n\n```\nnpm install --save-dev babel-loader @babel/preset-react @babel/preset-env @babel/core babel-plugin-import\n```\n\n- **babel-loaderï¼š**ä½¿ç”¨Babelå’Œwebpackæ¥è½¬è¯‘JavaScriptæ–‡ä»¶ã€‚\n- **@babel/preset-reactï¼š**è½¬è¯‘reactçš„JSX\n- **@babel/preset-envï¼š**è½¬è¯‘ES2015+çš„è¯­æ³•\n- **@babel/coreï¼š**babelçš„æ ¸å¿ƒæ¨¡å—\n- **babel-plugin-import**ï¼šæŒ‰éœ€åŠ è½½æ‰€éœ€è¦çš„babelè§£æ\n\nç†è®ºä¸Šæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ `webpack.common.config.js` ä¸­é…ç½®\"options\"ï¼Œä½†æœ€å¥½åœ¨å½“å‰æ ¹ç›®å½•ï¼Œæ³¨æ„ï¼Œä¸€å®šè¦æ˜¯æ ¹ç›®å½•ï¼ï¼ï¼ æ–°å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ `.babelrc` é…ç½®ç›¸å…³çš„\"presets\"ï¼š\n\n```js\n{\n  \"presets\": [\n    [\n      \"@babel/preset-env\",\n      {\n        \"targets\": {\n          // å¤§äºç›¸å…³æµè§ˆå™¨ç‰ˆæœ¬æ— éœ€ç”¨åˆ° preset-env\n          \"edge\": 17,\n          \"firefox\": 60,\n          \"chrome\": 67,\n          \"safari\": 11,\n          // å…¼å®¹åˆ°android4 ios6\n          \"browsers\": [\"Android >= 4.0\", \"ios >= 6\"]\n        }\n      }\n    ],\n    \"@babel/preset-react\"\n  ],\n  \"plugins\": [\n    [\"import\", { \"libraryName\": \"antd-mobile\", \"style\": \"css\" }] // `style: true` ä¼šåŠ è½½ less æ–‡ä»¶\n  ]\n}\n```\n\nè¿™é‡Œæœ‰å…³[bebelçš„é…ç½®](https://www.babeljs.cn/docs/babel-preset-env)å¯ä¸Šå®˜ç½‘æŸ¥è¯¢æ–‡æ¡£ã€‚\n\nå†ä¿®æ”¹ `webpack.common.config.js` ï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š\n\n```js\nconst path = require('path');\n\nmodule.exports = {\n  // é…ç½®å…¥å£æ–‡ä»¶\n  entry: {\n    app: './src/index.js',\n  },\n  // æ‰“åŒ…ğŸ“¦ä¹‹åçš„å‡ºå£\n  output: {\n    // å¦‚æœä¸åŠ å“ˆå¸Œå€¼ï¼Œæµè§ˆå™¨ä¼šæœ‰ç¼“å­˜ï¼Œå¯èƒ½ä½ éƒ¨ç½²äº†ï¼Œä½†æ˜¯ç”¨æˆ·çœ‹åˆ°çš„è¿˜æ˜¯è€é¡µé¢\n    // 8æ˜¯hashçš„é•¿åº¦ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œwebpackä¼šè®¾ç½®é»˜è®¤å€¼ä¸º20ã€‚\n    filename: 'js/[name].[chunkhash:8].bundle.js',\n    /**\n     * Node.js ä¸­ï¼Œ__dirname æ€»æ˜¯æŒ‡å‘è¢«æ‰§è¡Œ js æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œ\n     * æ‰€ä»¥å½“ä½ åœ¨ /d1/d2/myscript.js æ–‡ä»¶ä¸­å†™äº† __dirnameï¼Œ å®ƒçš„å€¼å°±æ˜¯ /d1/d2 ã€‚\n     * path.resolve\n     * 1.path.resolve()æ–¹æ³•å¯ä»¥å°†è·¯å¾„æˆ–è€…è·¯å¾„ç‰‡æ®µè§£ææˆç»å¯¹è·¯å¾„\n     * 2.ä¼ å…¥è·¯å¾„ä»å³è‡³å·¦è§£æï¼Œé‡åˆ°ç¬¬ä¸€ä¸ªç»å¯¹è·¯å¾„æ˜¯å®Œæˆè§£æï¼Œä¾‹å¦‚path.resolve('/foo', '/bar', 'baz') å°†è¿”å› /bar/baz\n     * 3.å¦‚æœä¼ å…¥çš„ç»å¯¹è·¯å¾„ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå½“å‰ç›®å½•å°†è¢«ä½¿ç”¨\n     * 4.å½“ä¼ å…¥çš„å‚æ•°æ²¡æœ‰/æ—¶ï¼Œå°†è¢«ä¼ å…¥è§£æåˆ°å½“å‰æ ¹ç›®å½•\n     * 5.é›¶é•¿åº¦çš„è·¯å¾„å°†è¢«å¿½ç•¥\n     * 6.å¦‚æœæ²¡æœ‰ä¼ å…¥å‚æ•°ï¼Œå°†è¿”å›å½“å‰æ ¹ç›®å½•\n     * \n     * _dirnameè¡¨ç¤ºç»å¯¹è·¯å¾„\n     * æˆ‘ä»¬ç¢°åˆ°çš„./xxå°±æ˜¯ç›¸å¯¹è·¯å¾„\n     * 1.åªä¼ å…¥__dirnameä¹Ÿå¯ä»¥è‡ªåŠ¨è°ƒç”¨path.resolveæ–¹æ³•\n     * 2.å¯ä»¥æ‹¼æ¥è·¯å¾„å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ä¸è°ƒç”¨path.resolve()æ–¹æ³•æ‹¼æ¥å¤±è´¥\n     * 3.__dirnameä»£è¡¨çš„æ˜¯å½“å‰æ–‡ä»¶ï¼ˆa.jsï¼‰çš„ç»å¯¹è·¯å¾„\n     * 4.ä»å³è‡³å·¦è§£æï¼Œé‡åˆ°äº†ç»å¯¹è·¯å¾„/srcï¼Œå› æ­¤ç›´æ¥è¿”\n     */\n    path: path.resolve(__dirname, '../../dist')\n  },\n  module: {\n    /**\n     * test è§„å®šäº†ä½œç”¨äºä»¥è§„åˆ™ä¸­åŒ¹é…åˆ°çš„åç¼€ç»“å°¾çš„æ–‡ä»¶ï¼Œ \n     * use å³æ˜¯ä½¿ç”¨ babel-loader å¿…é¡»çš„å±æ€§ï¼Œ \n     * exclude å‘Šè¯‰æˆ‘ä»¬ä¸éœ€è¦å»è½¬è¯‘\"node_modules\"è¿™é‡Œé¢çš„æ–‡ä»¶ã€‚\n     */\n    rules:[\n      {\n        test: /\\.(js|jsx)?$/,\n        // å¼€å¯ç¼“å­˜\n        options: { cacheDirectory: true },\n        loader: 'babel-loader',\n      },\n    ]\n  }\n}\n```\n\næ¥ä¸‹æ¥æ¿€åŠ¨äººå¿ƒçš„æ—¶åˆ»ï¼š\n\n```\nnpm run start\n```\n\næ˜¯ä¸æ˜¯èƒ½æ‰“åŒ…æˆåŠŸäº†å‘¢ï¼Ÿ\n\næ‰“å¼€ã€dist/ã€‘ä½ çš„htmlé¡µé¢ï¼Œçœ‹ä¸€ä¸‹æ˜¯å¦æ˜¯â€œHello Worldï¼â€å§ï¼\n\n### ä½¿ç”¨webpack-mergeğŸˆ´ï¸\n\næˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªåä¸º [webpack-merge](https://github.com/survivejs/webpack-merge) çš„å·¥å…·ã€‚é€šè¿‡â€œé€šç”¨â€é…ç½®ï¼Œæˆ‘ä»¬ä¸å¿…åœ¨ç¯å¢ƒç‰¹å®š(environment-specific)çš„é…ç½®ä¸­é‡å¤ä»£ç ã€‚ç®€å•æ¥è¯´å°±æ˜¯ç”Ÿäº§ç¯å¢ƒä¸åŒï¼Œæˆ‘ä»¬è¦ç»™çš„é…ç½®ä¹Ÿæœ‰æ‰€ä¸åŒï¼Œä½†æ˜¯å¯ä»¥å…±ç”¨ä¸€ä¸ªå…±æœ‰çš„é…ç½®ã€‚\n\næˆ‘ä»¬å…ˆä»å®‰è£… [webpack-merge](https://github.com/survivejs/webpack-merge) å¼€å§‹ï¼š\n\n```\nnpm install --save-dev webpack-merge\n```\n\nå®‰è£…ç»“æŸä¹‹åï¼Œæˆ‘ä»¬åœ¨ `config` è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸¤ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«ä¸º `webpack.prod.config.js` å’Œ `webpack.dev.config.js` ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶åˆ†åˆ«å¯¹åº”ç”Ÿäº§å’Œå¼€å‘ä¸¤ä¸ªç¯å¢ƒçš„é…ç½®ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥æ·»åŠ testç¯å¢ƒã€‚åå­—ä¹Ÿå¯ä»¥è‡ªå·±å–ï¼Œå°½é‡ä¿æŒä¸€è‡´ã€‚\n\n\n\nç°åœ¨çš„ç›®å½•ç»“æ„ï¼š\n\n```diff\n  webpackInit\n\t|- config\n\t\t|- webpack\n\t    |- webpack.common.config.js\n+     |- webpack.prod.config.js\n  çœç•¥\n```\n\nåœ¨ã€webpack.prod.config.jsã€‘åŠ å…¥\n\n```js\nconst merge = require('webpack-merge'); // ç‰ˆæœ¬ä¸º4.x\n// webpack-merge 5.xç‰ˆæœ¬åº”è¯¥æ”¹ä¸º const { merge } = require('webpack-merge');\nconst common = require('./webpack.common.config.js');\n\nmodule.exports = merge(common, {\n  mode: 'production',\n});\n```\n\nç„¶åä¿®æ”¹ã€package.jsonã€‘\n\n```diff\n{\n  \"name\": \"webpackInit\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"start\": \"webpack --config ./config/webpack/webpack.common.config.js\",\n+   \"build\": \"webpack --config ./config/webpack/webpack.prod.config.js\"\n  },\n  \"keywords\": [],\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"devDependencies\": {\n    \"@babel/core\": \"^7.10.2\",\n    \"@babel/preset-env\": \"^7.10.2\",\n    \"@babel/preset-react\": \"^7.10.1\",\n    \"babel-loader\": \"^8.1.0\",\n    \"babel-plugin-import\": \"^1.13.0\",\n    \"webpack\": \"^4.43.0\",\n    \"webpack-cli\": \"^3.3.11\",\n    \"webpack-merge\": \"^4.2.2\"\n  },\n  \"dependencies\": {\n    \"react\": \"^16.13.1\",\n    \"react-dom\": \"^16.13.1\"\n  }\n}\n\n```\n\nç„¶å\n\nåˆ é™¤ã€distæ–‡ä»¶å¤¹ã€‘\n\nä¹‹å\n\n```\nnpm run build\n```\n\næ˜¯ä¸æ˜¯ä¹Ÿbuildä¹Ÿæ‰“åŒ…æˆåŠŸäº†ï¼\n\nhtmlæ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥æ­£å¸¸è®¿é—®ï¼\n\nä½†æ˜¯æ²¡æœ‰æ˜¾ç¤ºHello Worldï¼Œä»”ç»†ä¸€çœ‹è¿˜æŠ¥é”™äº†ã€‚ã€‚ã€‚ä¸ºä»€ä¹ˆå‘¢ã€‚ã€‚å› ä¸º\n\n```\n// å¦‚æœä¸åŠ å“ˆå¸Œå€¼ï¼Œæµè§ˆå™¨ä¼šæœ‰ç¼“å­˜ï¼Œå¯èƒ½ä½ éƒ¨ç½²äº†ï¼Œä½†æ˜¯ç”¨æˆ·çœ‹åˆ°çš„è¿˜æ˜¯è€é¡µé¢\n    // 8æ˜¯hashçš„é•¿åº¦ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œwebpackä¼šè®¾ç½®é»˜è®¤å€¼ä¸º20ã€‚\n    filename: 'js/[name].[chunkhash:8].bundle.js',\n```\n\næˆ‘ä»¬ç»™jsæ–‡ä»¶è®¾ç½®äº†hashå€¼ã€‚ä¸èƒ½å¤Ÿç›´æ¥åœ¨htmlé‡Œé¢åŠ ä¸Šã€<script src=\"../dist/js/bundle.js\"></script>ã€‘è¿™ä¹ˆä¸€å¥ï¼Œè€Œä¸”æ¯æ¬¡ç”Ÿæˆçš„hashå€¼éƒ½ä¼šå˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦æ€ä¹ˆå¤„ç†è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ\n\n\n\n### ä½¿ç”¨[HtmlWebpackPlugin](https://www.webpackjs.com/plugins/html-webpack-plugin/)\n\n\n\nå®‰è£…[HtmlWebpackPlugin](https://www.webpackjs.com/plugins/html-webpack-plugin/)\n\nåœ¨æ§åˆ¶å°æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼š\n\n```\nnpm install --save-dev html-webpack-plugin\n```\n\nä¿®æ”¹ã€webpack.prod.config.jsã€‘\n\n```js\nconst merge = require('webpack-merge'); // ç‰ˆæœ¬ä¸º4.x\n// webpack-merge 5.xç‰ˆæœ¬åº”è¯¥æ”¹ä¸º const { merge } = require('webpack-merge');\nconst common = require('./webpack.common.config.js');\n\nconst HtmlWebpackPlugin = require('html-webpack-plugin');\n\nmodule.exports = merge(common, {\n  mode: 'production',\n  plugins: [\n    new HtmlWebpackPlugin({\n      filename: 'index.html', // æ‰“åŒ…ä¹‹åçš„htmlæ–‡ä»¶åå­—\n      // è¿™é‡Œæœ‰å°ä¼™ä¼´å¯èƒ½ä¼šç–‘æƒ‘ä¸ºä»€ä¹ˆä¸æ˜¯ '../public/index.html'\n      // æˆ‘çš„ç†è§£æ˜¯æ— è®ºä¸è¦ç”¨çš„templateæ˜¯ä¸æ˜¯åœ¨ä¸€ä¸ªç›®å½•ï¼Œéƒ½æ˜¯ä»æ ¹è·¯å¾„å¼€å§‹æŸ¥æ‰¾\n      template: 'public/index.html', // ä»¥æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„htmlä¸ºæ¨¡æ¿ç”Ÿæˆï¼Œä¸ç„¶æˆ‘ä»¬è¿˜è¦åˆ°æ‰“åŒ…ä¹‹åçš„htmlæ–‡ä»¶ä¸­å†™script\n      inject: 'body',// åœ¨bodyæœ€åº•éƒ¨å¼•å…¥jsæ–‡ä»¶ï¼Œå¦‚æœæ˜¯headï¼Œå°±æ˜¯åœ¨headä¸­å¼•å…¥js\n      minify: { // å‹ç¼©htmlæ–‡ä»¶\n        removeComments: true, // å»é™¤æ³¨é‡Š\n        collapseWhitespace: true, // å»é™¤ç©ºæ ¼\n      },\n    })\n  ]\n});\n```\n\n\n\nç°åœ¨æˆ‘ä»¬å†æ¥æ‰“åŒ…è¯•è¯•\n\n```\nnpm run build\n```\n\nçœ‹çœ‹distä¸­æ˜¯ä¸æ˜¯å¤šå‡ºäº†htmlæ–‡ä»¶ï¼Œå¹¶ä¸”è‡ªåŠ¨å¼•å…¥äº†scriptï¼Œç”¨æµè§ˆå™¨æ‰“å¼€å®ƒè¯•è¯•çœ‹æ˜¯ä¸æ˜¯èƒ½æ­£ç¡®è¾“å‡ºå†…å®¹äº†ï¼\n\nèµ·é£ï¼ï¼ğŸ›«ï¸\n\n### ä½¿ç”¨clean-webpack-plugin\n\næœ‰äº›åŒå­¦å·²ç»åŒå€¦äº†æ¯æ¬¡éƒ½éœ€è¦åˆ é™¤distæ–‡ä»¶å¤¹æ¥éªŒè¯æ˜¯å¦æˆåŠŸã€‚\n\nå…¶å®å‡å¦‚æˆ‘ä»¬ä¸åˆ é™¤çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹jsæ–‡ä»¶ï¼Œè¿™æ ·è®©webpackçŸ¥é“æˆ‘ä»¬æ”¹äº†ä¸œè¥¿ï¼Œä»–å°±ä¼šé‡æ–°æ‰“åŒ…ï¼Œä½†æ˜¯æˆ‘ä»¬æ¯æ¬¡æµ‹è¯•éƒ½æ²¡æœ‰å»ä¿®æ”¹ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åˆ é™¤ã€‚\n\nä½†æ˜¯ï¼Œå¦‚æœè¯´æˆ‘ä»¬ä¸å»åˆ é™¤distæ–‡ä»¶å¤¹çš„è¯ï¼Œæˆ‘ä»¬ä¿®æ”¹äº†ã€src/index.jsã€‘ã€‚ç„¶åå†é‡æ–°buildï¼Œå°±ä¼šå‘ç°ã€dist/jsã€‘ä¸‹é¢ä¼šåˆå¤šå‡ºä¸€ä¸ªjsæ–‡ä»¶ï¼Œè¿™æ ·çš„è¯æˆ‘ä»¬å°±éœ€è¦è§‚å¯Ÿæ—¥å¿—ï¼ŒæŸ¥çœ‹æ–°é²œâ€œå‡ºç‚‰â€çš„æ˜¯å“ªä¸€ä¸ªï¼Œç„¶ååˆ æ‰åˆ«çš„ã€‚è¿™æ ·éå¸¸éº»çƒ¦ã€‚\n\nOKï¼Œæˆ‘ä»¬ç°åœ¨å°±æ¥è§£å†³ä¸€ä¸‹è¿™ä¸ªé—®é¢˜\n\nå®‰è£…clean-webpack-plugin\n\n```\nnpm install --save-dev clean-webpack-plugin\n```\n\nä¿®æ”¹ã€webpck.prod.config.jsã€‘\n\n```diff\nconst merge = require('webpack-merge'); // ç‰ˆæœ¬ä¸º4.x\n// webpack-merge 5.xç‰ˆæœ¬åº”è¯¥æ”¹ä¸º const { merge } = require('webpack-merge');\nconst common = require('./webpack.common.config.js');\n\nconst HtmlWebpackPlugin = require('html-webpack-plugin');\n+ const { CleanWebpackPlugin } = require('clean-webpack-plugin');\n\nmodule.exports = merge(common, {\n  mode: 'production',\n  plugins: [\n    new HtmlWebpackPlugin({\n      filename: 'index.html', // æ‰“åŒ…ä¹‹åçš„htmlæ–‡ä»¶åå­—\n      // è¿™é‡Œæœ‰å°ä¼™ä¼´å¯èƒ½ä¼šç–‘æƒ‘ä¸ºä»€ä¹ˆä¸æ˜¯ '../public/index.html'\n      // æˆ‘çš„ç†è§£æ˜¯æ— è®ºä¸è¦ç”¨çš„templateæ˜¯ä¸æ˜¯åœ¨ä¸€ä¸ªç›®å½•ï¼Œéƒ½æ˜¯ä»æ ¹è·¯å¾„å¼€å§‹æŸ¥æ‰¾\n      template: 'public/index.html', // ä»¥æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„htmlä¸ºæ¨¡æ¿ç”Ÿæˆï¼Œä¸ç„¶æˆ‘ä»¬è¿˜è¦åˆ°æ‰“åŒ…ä¹‹åçš„htmlæ–‡ä»¶ä¸­å†™script\n      inject: 'body',// åœ¨bodyæœ€åº•éƒ¨å¼•å…¥jsæ–‡ä»¶ï¼Œå¦‚æœæ˜¯headï¼Œå°±æ˜¯åœ¨headä¸­å¼•å…¥js\n      minify: { // å‹ç¼©htmlæ–‡ä»¶\n        removeComments: true, // å»é™¤æ³¨é‡Š\n        collapseWhitespace: true, // å»é™¤ç©ºæ ¼\n      },\n    }),\n+   new CleanWebpackPlugin()\n  ]\n});\n```\n\næˆ‘ä»¬å…ˆæŸ¥çœ‹ç°åœ¨çš„jsæ–‡ä»¶å‰é¢çš„hashå€¼ã€‚ç„¶åæˆ‘ä»¬ä¿®æ”¹ã€src/index.jsã€‘ï¼Œéšä¾¿æ”¹æˆä»€ä¹ˆï¼Œå†é‡æ–°\n\n```\nnpm run build\n```\n\nå°±ä¼šå‘ç°æ–‡ä»¶å¹¶æ²¡æœ‰æ–°å¢ï¼Œè€Œä¸”æ¢äº†æ–°é²œçš„å“ˆå¸Œå€¼ã€‚\n\nå½“ç„¶äº†ï¼Œæˆ‘ä¹‹å‰è¯´çš„é‚£äº›è¯ï¼ŒåŒå­¦ä¸ç›¸ä¿¡çš„è¯ï¼Œå¯ä»¥æŠŠã€new CleanWebpackPlugin()ã€‘è¿™ä¸€è¡Œæ³¨é‡Šæ‰ï¼Œç„¶åå†ä¿®æ”¹ã€src/index.jsã€‘ï¼Œä¼šå‘ç°ã€dist/jsã€‘ä¸‹é¢çš„jsæ–‡ä»¶ä¼šå¢å¤šä¸€æ¡ã€‚\n\n### ä½¿ç”¨webpack-dev-server\n\næ—¢ç„¶åˆšåˆšéƒ½æåˆ°ä¼˜åŒ–äº†ï¼Œæˆ‘ä»¬æ¯æ¬¡éƒ½éœ€è¦buildä¸€ä¸‹ï¼Œæ„Ÿè§‰å¾ˆå‘†ã€‚è€Œwebpackå®˜æ–¹ä¹Ÿæä¾›çƒ­éƒ¨ç½²ï¼Œé‚£æˆ‘ä»¬ç°åœ¨å°±ä½¿ç”¨èµ·æ¥\n\nå®‰è£…webpack-dev-server\n\n```\nnpm install webpack-dev-server --save-dev\n```\n\næ–°å»ºæ–‡ä»¶ã€webpack.dev.config.jsã€‘ğŸ“ƒ\n\n```diff\n  webpackInit\n\t|- config\n\t\t|- webpack\n\t    |- webpack.common.config.js\n      |- webpack.prod.config.js\n+     |- webpack.dev.config.js\n  çœç•¥\n```\n\nç„¶ååŠ å…¥å¦‚ä¸‹ä»£ç \n\n```js\nconst path = require('path');\nconst merge = require('webpack-merge'); // ç‰ˆæœ¬ä¸º4.x\n// webpack-merge 5.xç‰ˆæœ¬åº”è¯¥æ”¹ä¸º const { merge } = require('webpack-merge');\nconst common = require('./webpack.common.config.js');\n\nconst webpack = require('webpack');\nconst HtmlWebpackPlugin = require('html-webpack-plugin');\n\nmodule.exports = merge(common, {\n  mode: 'development',\n  output: {\n    filename: 'js/[name].[hash:8].bundle.js',\n  },\n  devServer: {\n    contentBase: path.resolve(__dirname, '../dist'),\n    open: true,\n    port: 9000,\n    compress: true,\n    hot: true\n  },\n  plugins: [\n    new HtmlWebpackPlugin({\n      template: 'public/index.html',\n      inject: 'body',\n      hash: false\n    }),\n    new webpack.HotModuleReplacementPlugin()\n  ]\n});\n```\n\nä¿®æ”¹æ–‡ä»¶ã€package.jsonã€‘ğŸ“ƒ\n\n```diff\n\"scripts\": {\n-   \"start\": \"webpack --config ./config/webpack/webpack.common.config.js\",\n+   \"start\": \"webpack-dev-server --inline --config ./config/webpack/webpack.dev.config.js\",\n    \"build\": \"webpack --config ./config/webpack/webpack.prod.config.js\",\n  },\n```\n\nç„¶åæˆ‘ä»¬\n\n```\nnpm run start\n```\n\næ˜¯ä¸æ˜¯è‡ªåŠ¨å¼€äº†ä¸€ä¸ªç«¯å£ä¸º9000çš„ç½‘é¡µï¼Œä¸Šé¢æ˜¯æˆ‘ä»¬å†™çš„é¡µé¢å†…å®¹ï¼Œè¿™å’Œæˆ‘ä»¬çš„é…ç½®éƒ½æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚\nç°åœ¨ä½ éšæ„ä¿®æ”¹index.jsä¸­çš„ä»£ç ï¼Œå†å›åˆ°é¡µé¢çœ‹ä¸‹æ˜¯ä¸æ˜¯ä¹Ÿè·Ÿç€å˜äº†ï¼Œé‚£æˆ‘ä»¬å°±æ•´åˆwebpack-dev-serveræˆåŠŸï¼\n\n### ä½¿ç”¨source-map\n\nsource-mapå¯ä»¥å±•ç¤ºæˆ‘ä»¬ä»£ç çš„é”™è¯¯ä½ç½®ï¼Œå› ä¸ºæˆ‘ä»¬çš„ä»£ç éƒ½æ˜¯è¢«webpackæ‰“åŒ…è¿‡çš„ï¼Œåªæœ‰æœºå™¨çœ‹å¾—æ‡‚ï¼Œæˆ‘ä»¬äººç±»æ— æ³•æ­£å¸¸è¯†åˆ«ã€‚æ‰€ä»¥éœ€è¦ä»–ã€‚\n\næƒ³è¯•ä¸€ä¸‹æœªå¼€å¯æ˜¯ä»€ä¹ˆçŠ¶æ€çš„åŒå­¦å¯ä»¥è‡ªå·±æ•…æ„æŠŠä»£ç å†™é”™ï¼Œç„¶åçœ‹çœ‹æ§åˆ¶å°çš„æŠ¥é”™ã€‚\n\nå¼€å¯ä¹Ÿååˆ†ç®€å•ã€‚\n\nå®ƒçš„é…ç½®éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨ ã€webpack.dev.config.jsã€‘ ä¸­å¢åŠ ä¸€ä¸ª `devtool` å±æ€§å³å¯ï¼\n\n```diff\nmodule.exports = {\n+  devtool: 'cheap-module-eval-source-map',\n\t//...\n}\n```\n\nå› ä¸ºæˆ‘ä»¬åªæœ‰è‡ªå·±å†™ä»£ç çš„æ—¶å€™æ‰éœ€è¦æŸ¥çœ‹ï¼Œåˆ°ç”Ÿäº§ç¯å¢ƒå°±è¦å…³é—­å•¦ï¼Œä¸ç„¶æˆ‘ä»¬çš„æ™ºæ…§ç»“æ™¶å°±è¦è¢«ã€çªƒå–ã€‘å•¦ï¼æ‰€ä»¥æˆ‘æ”¾åœ¨äº†\n\n## ä¸­åœºä¼‘æ¯\n\nè¿™é‡Œå›é¡¾ä¸€ä¸‹çŸ¥è¯†ç‚¹ã€‚\n\n1. æˆ‘ä»¬å…ˆnpm init æ–°å»ºä¸€ä¸ªç©ºç™½é¡¹ç›®ã€‚\n2. ç„¶åå®‰è£…webpackï¼Œreactã€‚\n3. å‘ç°æ— æ³•ç¼–è¯‘jsxã€‚\n4. æ‰€ä»¥æˆ‘ä»¬å¯»æ±‚äº†babelçš„å¸®åŠ©ï¼Œå¹¶é…ç½®äº†æ‰€éœ€è¦è§£æçš„å†…å®¹ã€‚\n5. è§‰å¾—åœ¨htmlé‡Œé¢åŠ å…¥jså¾ˆå‘†ï¼Œæ‰€ä»¥å¼•å…¥äº†HtmlWebpackPlugin\n6. å› ä¸ºè§‰å¾—æ¯æ¬¡åˆ é™¤æ‰“åŒ…å‡ºæ¥çš„ä¸œè¥¿å¾ˆå‘†ï¼Œæ‰€ä»¥å¼•å…¥äº†clean-webpack-plugin\n7. å› ä¸ºæ¯æ¬¡éƒ½éœ€è¦é‡æ–°æ‰“åŒ…ï¼Œæ‰€ä»¥ä½¿ç”¨webpack-dev\n8. è‡³äºwebpack-mergeæ˜¯ä¸ºäº†æ‰“åŒ…å’Œç¼–è¯‘ä¸¤ä¸ªæˆ–è€…è¯´å¤šä¸ªçŠ¶æ€åšé¢„å¤‡çš„ï¼Œåœ¨ä¸Šè¿°çš„ä¾‹å­åªæœ‰æœ¬åœ°çš„devå’Œbuildä¸¤ä¸ªç¯å¢ƒã€‚\n\nåŸºæœ¬ä¸Šä¸Šè¿°çš„æ“ä½œè¿‡ç¨‹æˆ‘éƒ½æœ‰è§£é‡Šï¼Œæˆ–è€…æ˜¯æ³¨é‡Šï¼Œæˆ–è€…æ˜¯åœ¨æ–‡ç« ä¸­è¯´æ˜ã€‚å¤§å®¶å¯ä»¥è·Ÿç€èŠ‚å¥ä¸€æ­¥ä¸€æ­¥æ¥ï¼Œå› ä¸ºæˆ‘ä¹Ÿæ˜¯ä¸€è¾¹å†™blogä¸€è¾¹è·‘ä»£ç ä¸€è¾¹å›é¡¾çŸ¥è¯†ç‚¹ã€‚\n\nè‡³æ­¤ï¼Œwebpackç®—æ˜¯å‘Šä¸€â€¦â€¦\n\nè¯¶è¯¶è¯¶è¯¶ï¼jsæ˜¯å¯ä»¥è§£æäº†ï¼Œé‚£csså‘¢ï¼\n\nå“¦å“¦ï¼Œå¥½çš„ï¼Œé‚£æˆ‘ä»¬ç»§ç»­å¯ç¨‹\n\n## é‡æ–°èµ·èˆª\n\n### ä½¿ç”¨css-loaderå’Œstyle-loaderä¸¤å…„å¼Ÿ  \n\nå‡å¦‚æˆ‘ä»¬ç›´æ¥å¼•ç”¨cssçš„è¯ï¼Œä¼šæŠ¥é”™äº†ã€‚è¿™é‡Œå°±ä¸æ¼”ç¤ºäº†ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è‡ªå·±è¯•è¯•ã€‚\n\næ‰€ä»¥ï¼Œæˆ‘ä»¬å…ˆèµ°å‘½ä»¤è¡Œæ•²å‡»\n\n```\nnpm install --save-dev style-loader css-loader \n```\n\n#### ä¸¤å…„å¼Ÿçš„å…³ç³»\n\næ¥è¯´è¯´css-loaderå’Œstyle-loaderä»–ä»¬è¿™å¯¹é¸³é¸¯çš„å…³ç³»ã€‚\n\né¦–å…ˆcss-loaderä¼šæŠŠä½ çš„CSSæ–‡ä»¶è¿›è¡Œè§£æï¼Œå› ä¸ºwebpackæ˜¯ç”¨JSå†™çš„ï¼Œè¿è¡Œåœ¨nodeç¯å¢ƒï¼Œæ‰€ä»¥é»˜è®¤webpackæ‰“åŒ…çš„æ—¶å€™åªä¼šå¤„ç†JSä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼\n\næ‰€ä»¥æˆ‘ä»¬ä¹‹å‰çš„reacté‡Œé¢çš„jsxéœ€è¦babelçš„å¸®åŠ©ï¼Œæˆ–è€…è¯´éœ€è¦ã€babel-loaderã€‘çš„å¸®åŠ©ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„cssåŒæ ·éœ€è¦ã€css-loaderã€‘çš„å¸®åŠ©ï¼Œé‚£ä¹ˆåˆå…³ã€style-loaderã€‘ä»€ä¹ˆäº‹ï¼Ÿå¯ä¸å¯ä»¥ä¸è£…ä»–å‘¢ï¼Ÿ\n\nç­”æ¡ˆæ˜¯ï¼šå¯ä»¥çš„ï¼Œä½†æ˜¯ä½ ä½¿ç”¨èµ·æ¥ä¼šéå¸¸çš„éº»çƒ¦ã€‚æ€ä¹ˆä¸ªéº»çƒ¦æ³•å‘¢ï¼Ÿ\n\nå¦‚æœåªç”¨äº†ã€css-loaderã€‘è§£æå‡ºæ¥çš„æ˜¯è¿™æ ·çš„\n\n```\n[\"./src/index.css\", \".test{â†µ  color: red;â†µ}\", \"\"]\n```\n\nè¿™æ ·å’‹ç”¨å˜›ï¼Œä½ æ˜¯è§£æäº†ï¼Œå¯æ˜¯ä½ è§£æçš„æ˜¯ä¸ªXXã€‚\n\nè¿™ä¸ªæ—¶å€™å°±éœ€è¦æˆ‘ä»¬çš„å¤©é™çŒ›ç”·ã€style-loaderã€‘\n\nstyle-loader æ˜¯é€šè¿‡ä¸€ä¸ªJSè„šæœ¬åˆ›å»ºä¸€ä¸ªstyleæ ‡ç­¾ï¼Œé‡Œé¢åŒ…å«ä¸€äº›æ ·å¼ã€‚style-loaderæ˜¯ä¸èƒ½å•ç‹¬ä½¿ç”¨çš„ï¼Œåº”ä¸ºå®ƒå¹¶ä¸è´Ÿè´£è§£æ css ä¹‹å‰çš„ä¾èµ–å…³ç³»ï¼Œæ¯ä¸ªloaderçš„åŠŸèƒ½éƒ½æ˜¯å•ä¸€çš„ï¼Œå„è‡ªæ‹†åˆ†ç‹¬ç«‹ã€‚\n\n#### ä¸Šæ‰‹ï¼\n\nåŠ å…¥index.css\n\n```diff\nsrc\n+  |- index.css\n   |- indexjs\n```\n\nindex.cssæ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹\n\n```css\n.test{\n  color: red;\n}\n```\n\nä¿®æ”¹index.js\n\n```js\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css'\n\nconst App = () => (\n  <div className=\"test\">\n    Hello Worldï¼!\n  </div>\n)\n\nReactDOM.render(<App />, document.getElementById('root'));\n```\n\nä¿®æ”¹ã€webpack.common.config.jsã€‘ğŸ“ƒ\n\n```diff\n//...\nrules:[\n      {\n        test: /\\.(js|jsx)?$/,\n        // å¼€å¯ç¼“å­˜\n        options: { cacheDirectory: true },\n        loader: 'babel-loader',\n      },\n+      {\n+        test: /\\.css$/,\n+        use: [ \n+          'css-loader', \n+          'style-loader',\n+        ]\n+      }\n    ]\n    //....\n```\n\nè®°å¾—é‡æ–°è¿è¡Œï¼Œå› ä¸ºwebpackçš„é…ç½®ä»–è¯»å–ä¸€æ¬¡ï¼Œæ‰€ä»¥å¦‚æœä½ ä¿®æ”¹äº†é…ç½®ï¼Œéœ€è¦ã€ctrl+cã€‘å…³é—­é‡æ–°è¿è¡Œã€‚\n\nå˜¿å˜¿â€¦â€¦æ˜¯ä¸æ˜¯è¿è¡Œä¸äº†å•Šã€‚\n\nå…¶å®æˆ‘æ˜¯æ•…æ„çš„ï¼Œæˆ‘æƒ³å‘Šè¯‰å¤§å®¶ä¸€ä¸ªçŸ¥è¯†ç‚¹ã€‚\n\n> loaderçš„åŠ è½½é¡ºåºæ˜¯ä»å³å¾€å·¦ã€‚è¿™é‡Œçš„ç¼–è¯‘é¡ºåºæ˜¯å…ˆç”¨css-loaderå°†cssä»£ç ç¼–è¯‘ï¼Œå†äº¤ç»™style-loaderæ’å…¥åˆ°ç½‘é¡µé‡Œé¢å»ã€‚æ‰€ä»¥css-loaderåœ¨å³ï¼Œstyle-loaderåœ¨å·¦ã€‚\n\nè™½ç„¶æˆ‘ä»¬çš„æ•°ç»„æ¢è¡Œäº†ï¼Œä½†æ˜¯ä»”ç»†çœ‹ä¸éš¾çœ‹å‡ºé¡ºåºã€‚\n\næ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å°†ä»–ä»¬æ¢ä¸ªä½ç½®å°±å¯ä»¥äº†ã€‚ä»£ç æˆ‘å°±ä¸è´´äº†ã€‚\n\nç°åœ¨å¤§å®¶åº”è¯¥è®°å¿†å¾ˆæ·±åˆ»äº†å§ï¼\n\nå¤§å®¶é‡æ–°ã€ctrl+cã€‘å…³é—­é‡æ–°è¿è¡Œå°±è¡Œäº†ã€‚æˆ‘ä»¬çš„hello worldæ˜¯ä¸æ˜¯å˜çº¢å•¦ï½\n\n### å®‰è£…less-loader\n\nè¯´åˆ°cssï¼Œè¯´å¥å®åœ¨è¯ï¼Œæ²¡å‡ äººçœŸçš„æ˜¯åœ¨å†™çº¯cssçš„å§ï¼Ÿç°åœ¨è°ä¸æ˜¯lessï¼Œsassæˆ–è€…å…¶ä»–cssé¢„å¤„ç†å‘¢ï¼Ÿè€Œä¸”è¿™äº›é¢„å¤„ç†çš„å¥½å¤„æˆ‘å°±ä¸ç»†è¯´äº†ï¼Œæ„Ÿå…´è¶£çš„è‡ªå·±Googleå§ï¼Œæœ¬æ–‡ç”¨çš„æ˜¯lessï¼ˆå› ä¸ºant designç”¨çš„ä¹Ÿæ˜¯lessï¼Œå“ˆå“ˆï¼Œå‡è£…æ˜¯èš‚èšçš„ä¸€å‘˜ï¼‰\n\nåœ¨å‘½ä»¤è¡Œè¾“å…¥\n\n```\nnpm install --save-dev less less-loader\n```\n\nlessæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œç”¨ä»–è‚¯å®šè¦è£…ï¼Œless-loaderï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯lessçš„è§£æè€…ã€‚\n\nåœ¨ã€webpack.common.config.jsã€‘å¢åŠ \n\n```diff\n{\n        test: /\\.css$/,\n        use: [ \n          'style-loader',\n          'css-loader', \n        ]\n      },\n+      {\n+        test: /\\.less$/,\n+        use: [ \n+          'style-loader',\n+          'css-loader', \n+          'less-loader',\n+        ]\n+      }\n```\n\nä¾æ—§æ˜¯é¡ºåºé—®é¢˜ï¼Œå…ˆè§£ælessï¼ŒæŠŠlessè§£ææˆå¸¸è§„çš„cssï¼Œç„¶åå†è§£æcssï¼Œæœ€åæ’å…¥åˆ°ç½‘é¡µä¸­å»ã€‚\n\nä¿®æ”¹ã€index.jsã€‘å¼•å…¥è‡ªå·±å†™çš„ã€.lessã€‘æ–‡ä»¶\n\nå¤§å®¶é‡æ–°ã€ctrl+cã€‘å…³é—­é‡æ–°è¿è¡Œå°±è¡Œäº†ã€‚è‡³äºä½ å†™äº†ä»€ä¹ˆlessç‰¹æ€§ï¼Œåªè¦æœ‰æ•ˆæœå°±è¡Œäº†ã€‚\n\n### å®‰è£…url-loaderå’Œfile-loader\n\nè¯´å®ŒCSSï¼Œç¾ä¸½çš„ç½‘é¡µå½“ç„¶ç¦»ä¸å¼€æˆ‘ä»¬åŠ¨äººçš„å›¾ç‰‡å•¦ã€‚\n\nã€file-loaderã€‘çš„ä½œç”¨æ˜¯ï¼ŒæŠŠä½ çš„æ–‡ä»¶æ‰“åŒ…èµ·æ¥ï¼Œå’Œjsæ–‡ä»¶æ”¾åœ¨ä¸€èµ·ï¼Œè¿™æ ·ç”¨æˆ·è®¿é—®æˆ‘ä»¬çš„ç½‘é¡µçš„æ—¶å€™ï¼Œå…¶å®ä¹Ÿéœ€è¦è®¿é—®æˆ‘ä»¬çš„urlï¼Œæ—¢å¢åŠ äº†æœåŠ¡å™¨çš„å‹åŠ›ï¼Œä¹Ÿå¢åŠ äº†ç”¨æˆ·å‡çº§æµé‡çš„å‹åŠ›ï¼Œéœ€è¦å»ä¸‹è½½è¿™ä¸ªæ–‡ä»¶ã€‚\n\nã€url-loaderã€‘\n\nå¦‚æœé¡µé¢å›¾ç‰‡è¾ƒå¤šï¼Œå‘å¾ˆå¤šhttpè¯·æ±‚ï¼Œä¼šé™ä½é¡µé¢æ€§èƒ½ã€‚è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡url-loaderè§£å†³ã€‚url-loaderä¼šå°†å¼•å…¥çš„å›¾ç‰‡ç¼–ç ï¼Œç”ŸæˆdataURlå¹¶å°†å…¶æ‰“åŒ…åˆ°æ–‡ä»¶ä¸­ï¼Œæœ€ç»ˆåªéœ€è¦å¼•å…¥è¿™ä¸ªdataURLå°±èƒ½è®¿é—®å›¾ç‰‡äº†ã€‚\n\nurl-loaderå’Œfile-loaderä¸¤å…„å¼Ÿçš„æ­é…å¯ä»¥æœ‰æ•ˆçš„å‡å°‘ä¸å¿…è¦çš„urlè¯·æ±‚ï¼Œå› ä¸ºæœ‰çš„å›¾ç‰‡ä½ è¦å»è¯·æ±‚urlè·å–ï¼Œå¦‚æœå°çš„è¯å®Œå…¨å¯ä»¥ç”¨base64æ›¿ä»£ã€‚å¦‚æœå›¾ç‰‡å¾ˆå¤§çš„è¯å°±ç”¨file-loaderï¼Œè¿™æ ·å¯ä»¥å‡å°‘ç¼–ç çš„å‹åŠ›ã€‚\n\nåœ¨å‘½ä»¤è¡Œè¾“å…¥\n\n```\nnpm install file-loader url-loader --save-dev\n```\n\nä¿®æ”¹ã€webpack.common.config.jsã€‘ğŸ“ƒ\n\n```diff\nmodule: {\n  rules: [\n    //...\n+    {\n+      test: /\\.(jpg|png|gif)$/,\n+      use: {\n+        loader: 'url-loader',\n+        options: {\n+          name: '[name].[ext]', //è¾“å‡ºçš„æ–‡ä»¶å\n+          outputPath: 'images/', // è¾“å‡ºåˆ°distç›®å½•ä¸‹çš„è·¯å¾„ï¼ˆdist/images/ï¼‰\n\t\t\t\t\t\t/**\n             * å¦‚æœä½ è¿™ä¸ªå›¾ç‰‡æ–‡ä»¶å¤§äº8192bï¼Œå³8kbï¼Œé‚£æˆ‘url-loaderå°±ä¸ç”¨ï¼Œè½¬è€Œå»ä½¿ç”¨file-loaderï¼Œ\n             * æŠŠå›¾ç‰‡æ­£å¸¸æ‰“åŒ…æˆä¸€ä¸ªå•ç‹¬çš„å›¾ç‰‡æ–‡ä»¶åˆ°è®¾ç½®çš„ç›®å½•ä¸‹ï¼Œè‹¥æ˜¯å°äºäº†8kbï¼Œ\n             * é‚£å¥½ï¼Œæˆ‘å°±å°†å›¾ç‰‡æ‰“åŒ…æˆbase64çš„å›¾ç‰‡æ ¼å¼æ’å…¥åˆ°bundle.jsæ–‡ä»¶ä¸­ï¼Œ\n             * è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå‡å°‘äº†httpè¯·æ±‚ï¼Œä½†æ˜¯å¦‚æœæ–‡ä»¶è¿‡å¤§ï¼Œjsæ–‡ä»¶ä¹Ÿä¼šè¿‡å¤§ï¼Œ\n             * å¾—ä¸å¿å¤±ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆæœ‰limitçš„åŸå› ï¼\n             */\n+          limit: 8192,\n+        },\n+      }\n+    }\n  ]\n}\n```\n\n\n\n## è¿›é˜¶\n\nåŸºæœ¬ä¸Šæˆ‘ä»¬çš„webpackå¯ä»¥æ­£å¸¸è¿è¡Œäº†ï¼Œcssï¼Œjsï¼Œjsxéƒ½å¯ä»¥è§£æäº†ã€‚ä½†æ˜¯æˆ‘ä»¬éœ€è¦è€ƒè™‘ä¸€äº›è¿›é˜¶çš„ä¸œè¥¿ï¼Œä¼˜åŒ–ã€‚\n\n### ä½¿ç”¨uglifyjs-webpack-plugin\n\nåœ¨æ§åˆ¶å°æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼š\n\n```\nnpm install uglifyjs-webpack-plugin --save-dev\n```\n\nåœ¨ã€webpack.prod.config.jsã€‘æ·»åŠ ä»£ç \n\n```js\nconst UglifyJsPlugin = require('uglifyjs-webpack-plugin');\n\nmodule.exports = {\n//...\n  optimization: {\n    minimizer: [\n      new UglifyJsPlugin({\n        test: /\\.js(\\?.*)?$/i,  //æµ‹è¯•åŒ¹é…æ–‡ä»¶,\n        include: /\\/includes/, //åŒ…å«å“ªäº›æ–‡ä»¶\n        excluce: /\\/excludes/, //ä¸åŒ…å«å“ªäº›æ–‡ä»¶\n\n        cache: false,   //æ˜¯å¦å¯ç”¨æ–‡ä»¶ç¼“å­˜ï¼Œé»˜è®¤ç¼“å­˜åœ¨node_modules/.cache/uglifyjs-webpack-plugin.ç›®å½•\n        parallel: true,  //ä½¿ç”¨å¤šè¿›ç¨‹å¹¶è¡Œè¿è¡Œæ¥æé«˜æ„å»ºé€Ÿåº¦\n\n        //å…è®¸è¿‡æ»¤å“ªäº›å—åº”è¯¥è¢«uglifiedï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰å—éƒ½æ˜¯uglifiedï¼‰ã€‚ \n        //è¿”å›trueä»¥uglifyå—ï¼Œå¦åˆ™è¿”å›falseã€‚\n        chunkFilter: (chunk) => {\n            // `vendor` æ¨¡å—ä¸å‹ç¼©\n            if (chunk.name === 'vendor') {\n              return false;\n            }\n            return true;\n          }\n        }),\n  \n    ],\n  },\n  //..\n};\n```\n\n### ä½¿ç”¨splitChunks\n\nå…¶å®æˆ‘ä»¬å†™çš„ä»£ç ï¼Œæœ‰äº›åº“çš„ä»£ç æ˜¯ä¸éœ€è¦æ¯æ¬¡éƒ½ç¼–è¯‘çš„ï¼Œæœ€ç®€å•çš„ä¾‹å­å°±æ˜¯Reactï¼Œè¿™ä¸ªæˆ‘ä»¬å‡ ä¹æ¯ä¸ªjsæ–‡ä»¶éƒ½ä¼šç”¨åˆ°ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬å•ç‹¬æ‰“åŒ…ï¼Œè¿™æ ·åªéœ€è¦æ‰“åŒ…ä¸€æ¬¡ã€‚\n\nä¿®æ”¹ã€webpack.common.config.jsã€‘\n\n```diff\nentry: {\n     index: './src/index.js',\n+    common: ['react', 'react-dom']\n  },\n```\n\nä¿®æ”¹ã€webpack.prod.config.jsã€‘\n\n```js\nconst merge = require('webpack-merge'); // ç‰ˆæœ¬ä¸º4.x\n// webpack-merge 5.xç‰ˆæœ¬åº”è¯¥æ”¹ä¸º const { merge } = require('webpack-merge');\nconst common = require('./webpack.common.config.js');\n\nconst HtmlWebpackPlugin = require('html-webpack-plugin');\nconst { CleanWebpackPlugin } = require('clean-webpack-plugin');\n\nconst UglifyJsPlugin = require('uglifyjs-webpack-plugin');\n\nmodule.exports = merge(common, {\n  mode: 'production',\n  plugins: [\n    new HtmlWebpackPlugin({\n      filename: 'index.html', // æ‰“åŒ…ä¹‹åçš„htmlæ–‡ä»¶åå­—\n      // è¿™é‡Œæœ‰å°ä¼™ä¼´å¯èƒ½ä¼šç–‘æƒ‘ä¸ºä»€ä¹ˆä¸æ˜¯ '../public/index.html'\n      // æˆ‘çš„ç†è§£æ˜¯æ— è®ºä¸è¦ç”¨çš„templateæ˜¯ä¸æ˜¯åœ¨ä¸€ä¸ªç›®å½•ï¼Œéƒ½æ˜¯ä»æ ¹è·¯å¾„å¼€å§‹æŸ¥æ‰¾\n      template: 'public/index.html', // ä»¥æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„htmlä¸ºæ¨¡æ¿ç”Ÿæˆï¼Œä¸ç„¶æˆ‘ä»¬è¿˜è¦åˆ°æ‰“åŒ…ä¹‹åçš„htmlæ–‡ä»¶ä¸­å†™script\n      inject: 'body',// åœ¨bodyæœ€åº•éƒ¨å¼•å…¥jsæ–‡ä»¶ï¼Œå¦‚æœæ˜¯headï¼Œå°±æ˜¯åœ¨headä¸­å¼•å…¥js\n      minify: { // å‹ç¼©htmlæ–‡ä»¶\n        removeComments: true, // å»é™¤æ³¨é‡Š\n        collapseWhitespace: true, // å»é™¤ç©ºæ ¼\n      },\n    }),\n    new CleanWebpackPlugin()\n  ],\n  optimization: {\n    minimizer: [\n      new UglifyJsPlugin({\n        test: /\\.js(\\?.*)?$/i,  //æµ‹è¯•åŒ¹é…æ–‡ä»¶,\n        // include: /\\/includes/, //åŒ…å«å“ªäº›æ–‡ä»¶\n        // excluce: /\\/excludes/, //ä¸åŒ…å«å“ªäº›æ–‡ä»¶\n\n        //å…è®¸è¿‡æ»¤å“ªäº›å—åº”è¯¥è¢«uglifiedï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰å—éƒ½æ˜¯uglifiedï¼‰ã€‚ \n        //è¿”å›trueä»¥uglifyå—ï¼Œå¦åˆ™è¿”å›falseã€‚\n        chunkFilter: (chunk) => {\n            // `vendor` æ¨¡å—ä¸å‹ç¼©\n            if (chunk.name === 'vendor') {\n              return false;\n            }\n            return true;\n          }\n        }),\n  \n        cache: false,   //æ˜¯å¦å¯ç”¨æ–‡ä»¶ç¼“å­˜ï¼Œé»˜è®¤ç¼“å­˜åœ¨node_modules/.cache/uglifyjs-webpack-plugin.ç›®å½•\n        parallel: true,  //ä½¿ç”¨å¤šè¿›ç¨‹å¹¶è¡Œè¿è¡Œæ¥æé«˜æ„å»ºé€Ÿåº¦\n    ],\n    splitChunks: {\n      /**\n       * é»˜è®¤å€¼æ˜¯async\n       * æ‹†åˆ†æ¨¡å—çš„èŒƒå›´ï¼Œå®ƒæœ‰ä¸‰ä¸ªå€¼asyncã€initialå’Œallã€‚\n       * asyncè¡¨ç¤ºåªä»å¼‚æ­¥åŠ è½½å¾—æ¨¡å—ï¼ˆåŠ¨æ€åŠ è½½import()ï¼‰é‡Œé¢è¿›è¡Œæ‹†åˆ†\n       * initialè¡¨ç¤ºåªä»å…¥å£æ¨¡å—è¿›è¡Œæ‹†åˆ†\n       * allè¡¨ç¤ºä»¥ä¸Šä¸¤è€…éƒ½åŒ…æ‹¬\n       */\n      chunks: 'all',\n      // minSize: 30000, // ç”Ÿæˆchunkçš„æœ€å°å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚åªæœ‰å¤§äºè¿™ä¸ªæ•°å­—æ‰å¯ä»¥æˆä¸€ä¸ªchunk \n      // minRemainingSize: 0, // åªæœ‰å‰©ä¸‹ä¸€ä¸ªchunkçš„æ—¶å€™æ‰ä¼šç”Ÿæ•ˆï¼Œé»˜è®¤æ˜¯å’ŒminSizeä¸€æ ·çš„ï¼Œå¼€å‘çš„æ—¶å€™é»˜è®¤æ˜¯0\n      // maxSize: 0, // å‘Šè¯‰webpackå°è¯•å°†å¤§äºmaxSizeå­—èŠ‚çš„å—æ‹†åˆ†ä¸ºè¾ƒå°çš„éƒ¨åˆ†ã€‚\n      // minChunks: 1, // æ‹†åˆ†å‰å¿…é¡»å…±äº«æ¨¡å—çš„æœ€å°å—æ•°ã€‚\n      // maxAsyncRequests: 6, // æŒ‰éœ€åŠ è½½æ—¶æœ€å¤§å¹¶è¡Œè¯·æ±‚æ•°ã€‚\n      // maxInitialRequests: 4, // å…¥å£ç‚¹çš„æœ€å¤§å¹¶è¡Œè¯·æ±‚æ•°ã€‚å…¥å£æ–‡ä»¶\n      // automaticNameDelimiter: '~', // é»˜è®¤æƒ…å†µä¸‹ï¼Œwebpackå°†ä½¿ç”¨å—çš„æ¥æºå’Œåç§°ç”Ÿæˆåç§°ï¼ˆä¾‹å¦‚vendors~main.jsï¼‰ã€‚æ­¤é€‰é¡¹ä½¿æ‚¨å¯ä»¥æŒ‡å®šç”¨äºç”Ÿæˆåç§°çš„å®šç•Œç¬¦ã€‚\n      cacheGroups: {\n        /**\n         * å½“webpackå¤„ç†æ–‡ä»¶è·¯å¾„æ—¶ï¼Œå®ƒä»¬å§‹ç»ˆåŒ…å«/åœ¨Unixç³»ç»Ÿå’Œ\\Windowsä¸Šã€‚\n         * è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ[\\\\/]åœ¨{cacheGroup}.testå­—æ®µä¸­ä½¿ç”¨in æ¥è¡¨ç¤ºè·¯å¾„åˆ†éš”ç¬¦çš„åŸå› ã€‚\n         * /æˆ–\\in {cacheGroup}.testä¼šåœ¨è·¨å¹³å°ä½¿ç”¨æ—¶å¼•èµ·é—®é¢˜ã€‚\n         */\n        // defaultVendors: {\n        //   test: /[\\\\/]node_modules[\\\\/]/, // åˆ†å—ç›®æ ‡\n        //   priority: -10 // æƒé‡\n        // },\n        // default: {\n        //   minChunks: 2, // æœ€å°å¼•ç”¨\n        //   priority: -20, // æƒé‡\n        //   // å¦‚æœå½“å‰å—åŒ…å«å·²ä»ä¸»æ†ç»‘åŒ…ä¸­æ‹†åˆ†å‡ºçš„æ¨¡å—ï¼Œåˆ™å°†é‡ç”¨è¯¥æ¨¡å—ï¼Œè€Œä¸æ˜¯ç”Ÿæˆæ–°çš„æ¨¡å—ã€‚è¿™å¯èƒ½ä¼šå½±å“å—çš„ç»“æœæ–‡ä»¶åã€‚\n        //   reuseExistingChunk: true\n        // },\n        // ä¸Šè¿°çš„splitChunkså…¨æ˜¯webpack4æœªè®¾ç½®æƒ…å†µä¸‹çš„é»˜è®¤å€¼ï¼Œé™¤äº†chunksä»ã€asyncã€‘->ã€allã€‘å…¶ä»–éƒ½æ²¡æœ‰æ”¹\n        // okï¼Œæˆ‘ä»¬ç°åœ¨åŠ å…¥æˆ‘ä»¬è‡ªå·±æƒ³è¦çš„ä»£ç åˆ†å‰²\n        // å› ä¸ºæˆ‘å‡†å¤‡åŠ å…¥reactç­‰ä¸šåŠ¡åƒå˜ä¸‡åŒ–è€Œä¸ä¼šå˜çš„åº“\n        common: {\n          test: \"common\", // webpackæ‰«é¢çš„å…³é”®å­—\n          name: \"common\", // ç”Ÿæˆçš„åå­—\n          enforce: true // æ˜¯å¦ç¼“å­˜\n        },\n      }\n    }\n  },\n});\n```\n\nä¸æƒ³å†™diffå•¦ï¼Œç›´æ¥CVå•¦ã€‚ã€‚ã€‚\n\nä¸ºä»€ä¹ˆæˆ‘éœ€è¦æŠŠreactæå–å‡ºæ¥ï¼Œå› ä¸ºå“ªé‡Œéƒ½éœ€è¦ç”¨ï¼Œè€Œä¸”ä»–å‡ ä¹ä¸å¯èƒ½ä¼šå˜ï¼Œæ‰€ä»¥æˆ‘ç‰¹åˆ«æå‡ºæ¥åšäº†ç¼“å­˜ï¼Œå…¶ä½™çš„è¿˜æ˜¯ä½¿ç”¨çš„é»˜è®¤é…ç½®ï¼ˆé™¤äº†chunkæ”¹ä¸ºäº†â€˜allâ€™ï¼‰ã€‚\n\n> Tobias Koppers@Wsokraï¼šoptimization. splitchunks. chunks: althe only option you need for vendor and commons splitting in webpackBest combine it with html-webpack-plugin or equivalent html generation18120\n\nä½œè€…éƒ½å‘æ¨ç‰¹è¯´äº†ï¼Œé‚£æˆ‘ä»¬ä¹Ÿå°±æ¥å—å§ï½å°±æ”¹ä¸ªallï¼Œç„¶åè¡¥ä¸€ä¸‹reactï½\n\nå†é‡æ–°æ‰“åŒ…ï¼Œä½ ä¼šå‘ç°index.bundle.jsï¼ˆä¸è¢«ç¼“å­˜ï¼‰çš„hashå€¼å˜äº†ï¼Œä½†æ˜¯common.bundle.jsï¼ˆèƒ½è¢«ç¼“å­˜ï¼‰çš„hashå€¼æ²¡å˜ã€‚\n\n### ä½¿ç”¨mini-css-extract-plugin\n\njséƒ½ç‹¬ç«‹ğŸ“¦ï¼Œé‚£æˆ‘cssä¹Ÿè¦ï¼\n\nå…¶å®å¦‚æœæŠŠCSSæ‰“åŒ…æˆä¸€ä¸ªæ–‡ä»¶ç„¶åè®©htmlå¼•ç”¨çš„è¯å¯ä»¥å‡å°htmlæ–‡ä»¶çš„å¤§å°ï¼Œæš—åˆäº†HTTP2çš„å¤šè·¯å¤ç”¨ï¼Œå¤šæ–‡ä»¶å°æ•°é‡ã€‚åŒ…æ‹¬ä¹‹å‰çš„splitChunksé‡Œé¢æˆ‘ä»¬é…ç½®çš„reactä¹Ÿæ˜¯ä¸ºäº†HTTP2ã€‚\n\nåœ¨å‘½ä»¤è¡Œè¾“å…¥ï¼š\n\n```\nnpm install --save-dev mini-css-extract-plugin\n```\n\nä¿®æ”¹ã€webpack.common.config.jsã€‘\n\n```diff\n+ const MiniCssExtractPlugin = require('mini-css-extract-plugin');\n\n//...\nmodule:{\n    rules:[\n      {\n        test: /\\.css$/,\n        use: [ \n+          MiniCssExtractPlugin.loader,\n-          'style-loader',\n           'css-loader', \n        ]\n      },\n    ],\n  },\n+plugins: [\n+    new MiniCssExtractPlugin({\n+      filename: 'css/[name].[hash].css',\n+      chunkFilename: 'css/[id].[hash].css',\n+    }),\n  ]\n```\n\n\n\n### ä½¿ç”¨CSS Module\n\nå…¶å®å¾ˆç®€å•ï¼Œåªéœ€è¦ä¿®æ”¹ä¸€ä¸‹é…ç½®ã€wbpack.common.config.jsã€‘\n\n```diff\n{\n        test: /\\.css$/,\n        use: [ \n          MiniCssExtractPlugin.loader,\n-          'css-loader'\n+          {\n+            loader: 'css-loader',\n+            options: {\n+              // importLoaders: 1,\n+              modules: true,\n+            },\n+          },\n        ]\n      },\n```\n\n### ä½¿ç”¨PostCSS\n\n> postcss ä¸€ç§å¯¹cssç¼–è¯‘çš„å·¥å…·ï¼Œç±»ä¼¼babelå¯¹jsçš„å¤„ç†ï¼Œå¸¸è§çš„åŠŸèƒ½å¦‚ï¼š 1 . ä½¿ç”¨ä¸‹ä¸€ä»£cssè¯­æ³• 2 . è‡ªåŠ¨è¡¥å…¨æµè§ˆå™¨å‰ç¼€ 3 . è‡ªåŠ¨æŠŠpxä»£ä¸ºè½¬æ¢æˆrem 4 . css ä»£ç å‹ç¼©ç­‰ç­‰ postcss åªæ˜¯ä¸€ä¸ªå·¥å…·ï¼Œæœ¬èº«ä¸ä¼šå¯¹cssä¸€é¡¿æ“ä½œï¼Œå®ƒé€šè¿‡æ’ä»¶å®ç°åŠŸèƒ½ï¼Œautoprefixer å°±æ˜¯å…¶ä¸€ã€‚\n\nå®‰è£…postcss\n\n```\nnpm install postcss postcss-loader --save-dev\n```\n\nå®‰è£…postcssæŸä¸ªæ’ä»¶ï¼Œä»¥Autoprefixerä¸¾ä¾‹\n\n```\nnpm install postcss-aspect-ratio-mini postcss-write-svg postcss-px-to-viewport postcss-viewport-units postcss-flexbugs-fixes postcss-preset-env cssnano --save-dev\n```\n\nåœ¨æ ¹ç›®æ ‡æ–°å»ºæ–‡ä»¶ã€postcss.config.jsã€‘\n\n```js\n/* eslint-disable import/no-extraneous-dependencies */\n/* eslint-disable @typescript-eslint/no-var-requires */\nconst postcssAspectRatioMini = require('postcss-aspect-ratio-mini');\nconst postcssPxToViewport = require('postcss-px-to-viewport');\nconst postcssWriteSvg = require('postcss-write-svg');\nconst postcssViewportUnits = require('postcss-viewport-units');\nconst cssnano = require('cssnano');\nconst postcssPresetEnv = require('postcss-preset-env')\n\nconst postcssFlexbugsFixes = require('postcss-flexbugs-fixes')\n\nmodule.exports = {\n  plugins: [\n    postcssFlexbugsFixes,\n    // åœ¨è¿™ä¸ªä½ç½®åŠ å…¥æˆ‘ä»¬éœ€è¦é…ç½®çš„ä»£ç \n    // åœ¨è¿™ä¸ªä½ç½®åŠ å…¥æˆ‘ä»¬éœ€è¦é…ç½®çš„ä»£ç \n    // åœ¨è¿™ä¸ªä½ç½®åŠ å…¥æˆ‘ä»¬éœ€è¦é…ç½®çš„ä»£ç \n    postcssAspectRatioMini({}),\n    postcssPxToViewport({\n      viewportWidth: 750, // åŸºå‡†å®½åº¦ï¼ˆä¸€èˆ¬çš„è®¾è®¡éƒ½æ˜¯è¿™ä¸ªåŸºå‡†\n      viewportHeight: 1334, // åŸºå‡†é«˜åº¦ï¼ˆä¸€èˆ¬çš„è®¾è®¡éƒ½æ˜¯è¿™ä¸ªåŸºå‡†\n      unitPrecision: 3, // (Number) The decimal numbers to allow the REM units to grow to.\n      viewportUnit: 'vw', // (String) å•ä½\n      selectorBlackList: ['.list-ignore', /notTransform/], // å¸¦ä¸Šè¿™ä¸ªå•è¯çš„å°±ä¸ä¼šfixä¸ºvwå•ä½\n      minPixelValue: 1, // (Number) æœ€å°åƒç´ \n      mediaQuery: false, // (Boolean) å…è®¸åœ¨åª’ä½“æŸ¥è¯¢ä¸­è½¬æ¢pxã€‚\n      exclude: /(\\/|\\\\)(node_modules)(\\/|\\\\)/,\n    }),\n    postcssWriteSvg({\n      utf8: false\n    }),\n    postcssPresetEnv({}),\n    postcssViewportUnits({\n      filterRule: rule => rule.selector.includes('::after')\n        && rule.selector.includes('::before')\n        && rule.selector.includes(':after')\n        && rule.selector.includes(':before')\n    }),\n    cssnano({\n      \"cssnano-preset-advanced\": {\n        zindex: false,\n        autoprefixer: false\n      },\n    })\n  ]\n};\n```\n\nä¿®æ”¹ã€webpack.common.config.jsã€‘\n\n```diff\n{\n        test: /\\.css$/,\n        use: [ \n          'style-loader',\n          'css-loader', \n+          'postcss-loader'\n        ]\n      },\n      {\n        test: /\\.less$/,\n        use: [ \n          'style-loader',\n          'css-loader', \n          'less-loader',\n+          'postcss-loader'\n        ]\n      }\n```\n\nç„¶åï¼Œä¿®æ”¹æˆ‘ä»¬çš„cssæ–‡ä»¶ï¼Œçœ‹çœ‹æˆ‘ä»¬å†™çš„å•ä½ä¸ºpxçš„æœ‰æ²¡æœ‰è¢«æ”¹ä¸ºvwçš„è‡ªé€‚åº”å•ä½ã€‚\n\né¡ºä¾¿è¯•ä¸€ä¸‹å¸¦æœ‰ã€notTransformã€‘çš„æ˜¯ä¸æ˜¯è¿˜æ˜¯pxä½œä¸ºå•ä½ã€‚\n\n## ç»“æŸ\n\nåˆ°æ­¤ï¼Œæˆ‘ä»¬çš„webpacké…ç½®ï¼Œå°±ç®—æ˜¯å…¥é—¨äº†ï¼Œå¯¹äºwebpackçš„é…ç½®æˆ‘ä»¬è¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ã€‚å¤§å®¶åŠ æ²¹ï¼\n\nå¦‚æœæœ‰å“ªé‡Œå†™çš„ä¸å¥½æˆ–è€…å†™é”™äº†ï¼Œæ¬¢è¿å¤§å®¶åœ¨è¯„è®ºåŒºè®¨è®ºã€‚","slug":"ä»é›¶é…ç½®ä½ çš„Webpack","published":1,"updated":"2021-06-24T14:00:06.854Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra8w002flwrd8dcy2bc7","content":"<h1 id=\"ä»é›¶é…ç½®ä½ çš„Webpack\"><a href=\"#ä»é›¶é…ç½®ä½ çš„Webpack\" class=\"headerlink\" title=\"ä»é›¶é…ç½®ä½ çš„Webpack\"></a>ä»é›¶é…ç½®ä½ çš„Webpack</h1><h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><p>ä¸Šç¯‡æ–‡ç« ç®€å•çš„ä»‹ç»äº†ä¸€ä¸‹ï¼Œå‰ç«¯è¿›é˜¶ä¹‹è„šæ‰‹æ¶çš„æ­å»ºã€‚å…¶å®æˆ‘ä¸ªäººè®¤ä¸ºé‡è¦çš„è¿˜æ˜¯Webpackçš„é…ç½®å‡ºæ¥çš„templateï¼Œè‡³äºè„šæ‰‹æ¶çš„äº¤äº’ä½“éªŒå¯ä»¥åæœŸå»ä¼˜åŒ–ï¼Œä¹Ÿå¯ä»¥æ›´åŠ çš„ä¸ªæ€§åŒ–ã€‚ä½†æ˜¯æˆ‘ä»¬çš„æ ¸å¿ƒè¿˜æ˜¯æ”¾åœ¨Webpackç­‰ä¸€ç³»åˆ—çš„é…ç½®ä¸Šã€‚</p>\n<p>è¿™ç¯‡æ–‡ç« çš„ç›®çš„</p>\n<ul>\n<li>å¯ä»¥ç»™è‡ªå·±ä¸€ä¸ªå›é¡¾çš„åœ°æ–¹</li>\n<li>åŠ å¼ºå¯¹Webpackçš„ç†è§£ï¼Œæ¯ä¸ªçŸ¥è¯†ç‚¹éƒ½ä¼šè®¤è®¤çœŸçœŸçš„å½»æŸ¥ï¼å°½é‡è®©æ¯ä¸€æ­¥éƒ½æ˜¯éå¸¸æ¸…æ™°æ˜äº†çš„ï¼</li>\n<li>å¦‚æœå¯ä»¥å¸®åŠ©åˆ°å¤§å®¶é‚£æ˜¯æ›´å¥½ä¸è¿‡äº†</li>\n</ul>\n<p>å¥½äº†ï¼Œæ”¶ï¼è¯ä¸å¤šè¯´å¼€å§‹ï¼</p>\n<h2 id=\"å‰æ\"><a href=\"#å‰æ\" class=\"headerlink\" title=\"å‰æ\"></a>å‰æ</h2><p>ç›¸ä¿¡æ¥åˆ°è¿™é‡Œçš„å°ä¼™ä¼´ï¼Œéƒ½æ˜¯æœ‰ä¸€äº›äº›å‰ç«¯çš„ç»éªŒäº†ï¼Œè‡³äºä»€ä¹ˆnodeå®‰è£…ç¯å¢ƒå˜é‡è¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚æœ¬äººä½¿ç”¨çš„æ˜¯mac osï¼Œå¦‚æœæ˜¯Windowsçš„å¹¶ä¸”ç¢°åˆ°é—®é¢˜çš„è¯ï¼Œå¯ä»¥ç•™è¨€ï¼Œæˆ–è€…ç›´æ¥Googleã€‚</p>\n<h2 id=\"å¼€å§‹\"><a href=\"#å¼€å§‹\" class=\"headerlink\" title=\"å¼€å§‹\"></a>å¼€å§‹</h2><h3 id=\"å»ºç«‹ä¸€ä¸ªç©ºçš„æ–‡ä»¶å¤¹ğŸ“\"><a href=\"#å»ºç«‹ä¸€ä¸ªç©ºçš„æ–‡ä»¶å¤¹ğŸ“\" class=\"headerlink\" title=\"å»ºç«‹ä¸€ä¸ªç©ºçš„æ–‡ä»¶å¤¹ğŸ“\"></a>å»ºç«‹ä¸€ä¸ªç©ºçš„æ–‡ä»¶å¤¹ğŸ“</h3><p>æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œåä¸ºã€webpackInitã€‘</p>\n<p>å¹¶ä¸”ä½¿ç”¨ä½ çš„ç¼–è¾‘å™¨æ‰“å¼€ä»–ï¼Œç„¶åæ‰“å¼€å‘½ä»¤è¡Œæ‰§è¡Œï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm init -y</span><br></pre></td></tr></table></figure>\n\n<p>è¿™ä¸ªå‘½ä»¤æ˜¯nodeå¸®ä½ åˆå§‹åŒ–ä¸€ä¸ªé¡¹ç›®ç”¨çš„ï¼Œå¸®ä½ æ–°å»ºä¸€ä¸ª<code>package.json</code>ã€‚</p>\n<p>è‡³äº<code>-y</code>æ˜¯ç”¨äºé»˜è®¤éƒ½ä»¥<strong>yes</strong>ç»§ç»­æ‰§è¡Œã€‚å¦‚æœæƒ³äº†è§£ä¸€ä¸‹é‡Œé¢åˆ°åº•æœ‰ä»€ä¹ˆçš„åŒå­¦å¯ä»¥ä¸ç”¨<em>-y</em>ç»§ç»­è·‘ä¸€éã€‚å…¶å®é‡Œé¢çš„ä¸œè¥¿åæœŸéƒ½å¯ä»¥è‡ªå·±ä¿®æ”¹<code>package.json</code>ã€‚æ‰€ä»¥ä¸éœ€è¦å¤ªåœ¨æ„ã€‚</p>\n<h3 id=\"å®‰è£…WebpackğŸ”§\"><a href=\"#å®‰è£…WebpackğŸ”§\" class=\"headerlink\" title=\"å®‰è£…WebpackğŸ”§\"></a>å®‰è£…WebpackğŸ”§</h3><p>ç°åœ¨æ˜¯åŒ—äº¬æ—¶é—´ï¼š2020/06/07 06:42:49ã€‚</p>\n<p>Webpack5æœ‰Betaç‰ˆï¼Œè¿™é‡Œå°±ä¸è€ƒè™‘äº†ï¼Œåç»­ä¸Šæ­£å¼ç‰ˆçš„è¯æˆ‘åº”è¯¥ä¼šå‡ºæ–°çš„æ–‡ç« ä»‹ç»ã€‚</p>\n<p>å› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ <code>webpack 4+</code> ç‰ˆæœ¬ï¼Œè¿˜éœ€è¦å®‰è£… <code>webpack-cli</code> ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save-dev webpack webpack-cli</span><br></pre></td></tr></table></figure>\n\n<p>å› ä¸ºWebpackä¸»è¦æ˜¯ç¼–è¯‘æ—¶ä½¿ç”¨æ‰€ä»¥æ”¾åˆ°â€œdevDependenciesâ€ã€‚</p>\n<p>ç¡®è®¤ä¸€ä¸‹ç°åœ¨çš„ç›®å½•ç»“æ„ï¼Œä»¥é˜²æœ‰åŒå­¦æ‰é˜Ÿï¼</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">webpackInit</span><br><span class=\"line\">  |- node_modules</span><br><span class=\"line\">  |- package-lock.json</span><br><span class=\"line\">  |- package.json</span><br></pre></td></tr></table></figure>\n\n<p>è¿™é‡Œè¯´ä¸‹é¢˜å¤–è¯ã€‚</p>\n<h5 id=\"package-jsonå’Œpackage-lock-jsonçš„åŒºåˆ«\"><a href=\"#package-jsonå’Œpackage-lock-jsonçš„åŒºåˆ«\" class=\"headerlink\" title=\"package.jsonå’Œpackage-lock.jsonçš„åŒºåˆ«\"></a>package.jsonå’Œpackage-lock.jsonçš„åŒºåˆ«</h5><p>package.json æ–‡ä»¶åªèƒ½é”å®šå¤§ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯ç‰ˆæœ¬å·çš„ç¬¬ä¸€ä½ï¼Œå¹¶ä¸èƒ½é”å®šåé¢çš„å°ç‰ˆæœ¬ï¼Œ<code>npm install</code> éƒ½æ˜¯æ‹‰å–çš„è¯¥å¤§ç‰ˆæœ¬ä¸‹çš„æœ€æ–°çš„ç‰ˆæœ¬ï¼Œä¸ºäº†ç¨³å®šæ€§è€ƒè™‘æˆ‘ä»¬å‡ ä¹æ˜¯ä¸æ•¢éšæ„å‡çº§ä¾èµ–åŒ…çš„ï¼Œè¿™å°†å¯¼è‡´å¤šå‡ºæ¥å¾ˆå¤šå·¥ä½œé‡ï¼Œæµ‹è¯•/é€‚é…ç­‰ï¼Œæ‰€ä»¥ package-lock.json æ–‡ä»¶å‡ºæ¥äº†ï¼Œå½“ä½ æ¯æ¬¡å®‰è£…ä¸€ä¸ªä¾èµ–çš„æ—¶å€™å°±é”å®šåœ¨ä½ å®‰è£…çš„è¿™ä¸ªç‰ˆæœ¬ã€‚</p>\n<p>é‚£å¦‚æœæˆ‘ä»¬å®‰è£…æ—¶çš„åŒ…æœ‰bugï¼Œåé¢éœ€è¦æ›´æ–°æ€ä¹ˆåŠï¼Ÿ</p>\n<p>åœ¨ä»¥å‰å¯èƒ½å°±æ˜¯ç›´æ¥æ”¹ package.json é‡Œé¢çš„ç‰ˆæœ¬ï¼Œç„¶åå† <code>npm install</code> äº†ï¼Œä½†æ˜¯ 5 ç‰ˆæœ¬åå°±ä¸æ”¯æŒè¿™æ ·åšäº†ï¼Œå› ä¸ºç‰ˆæœ¬å·²ç»é”å®šåœ¨ package-lock.json é‡Œäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½ <code>npm install xxx@x.x.x</code> è¿™æ ·å»æ›´æ–°æˆ‘ä»¬çš„ä¾èµ–ï¼Œç„¶å package-lock.json ä¹Ÿèƒ½éšä¹‹æ›´æ–°ã€‚</p>\n<h3 id=\"æ–°å»ºé…ç½®æ–‡ä»¶ğŸ“ƒ\"><a href=\"#æ–°å»ºé…ç½®æ–‡ä»¶ğŸ“ƒ\" class=\"headerlink\" title=\"æ–°å»ºé…ç½®æ–‡ä»¶ğŸ“ƒ\"></a>æ–°å»ºé…ç½®æ–‡ä»¶ğŸ“ƒ</h3><p>æˆ‘ä»¬åœ¨æ ¹ç›®å½•æ–°å»ºæ–‡ä»¶å¤¹ã€configã€‘ç”¨äºå­˜å‚¨ä¸€äº›ç›¸å…³çš„é…ç½®æ–‡ä»¶ï¼Œç„¶ååœ¨ã€configã€‘é‡Œé¢æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ã€webpackã€‘è¡¨ç¤ºï¼Œä¸“é—¨ç”¨äºå­˜å‚¨webpackçš„é…ç½®æ–‡ä»¶ã€‚ç„¶ååœ¨ã€webpackã€‘è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹é¢æ–°å»ºæ–‡ä»¶ã€webpack.common.config.jsã€‘</p>\n<p>å¹¶æ•²å…¥ä»¥ä¸‹ä»£ç </p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  <span class=\"comment\">// é…ç½®å…¥å£æ–‡ä»¶</span></span><br><span class=\"line\">  entry: &#123;</span><br><span class=\"line\">    app: <span class=\"string\">'./src/index.js'</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">// æ‰“åŒ…ğŸ“¦ä¹‹åçš„å‡ºå£</span></span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœä¸åŠ å“ˆå¸Œå€¼ï¼Œæµè§ˆå™¨ä¼šæœ‰ç¼“å­˜ï¼Œå¯èƒ½ä½ éƒ¨ç½²äº†ï¼Œä½†æ˜¯ç”¨æˆ·çœ‹åˆ°çš„è¿˜æ˜¯è€é¡µé¢</span></span><br><span class=\"line\">    <span class=\"comment\">// 8æ˜¯hashçš„é•¿åº¦ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œwebpackä¼šè®¾ç½®é»˜è®¤å€¼ä¸º20ã€‚</span></span><br><span class=\"line\">    filename: <span class=\"string\">'js/[name].[chunkhash:8].bundle.js'</span>,</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Node.js ä¸­ï¼Œ__dirname æ€»æ˜¯æŒ‡å‘è¢«æ‰§è¡Œ js æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œ</span></span><br><span class=\"line\"><span class=\"comment\">     * æ‰€ä»¥å½“ä½ åœ¨ /d1/d2/myscript.js æ–‡ä»¶ä¸­å†™äº† __dirnameï¼Œ å®ƒçš„å€¼å°±æ˜¯ /d1/d2 ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">     * path.resolve</span></span><br><span class=\"line\"><span class=\"comment\">     * 1.path.resolve()æ–¹æ³•å¯ä»¥å°†è·¯å¾„æˆ–è€…è·¯å¾„ç‰‡æ®µè§£ææˆç»å¯¹è·¯å¾„</span></span><br><span class=\"line\"><span class=\"comment\">     * 2.ä¼ å…¥è·¯å¾„ä»å³è‡³å·¦è§£æï¼Œé‡åˆ°ç¬¬ä¸€ä¸ªç»å¯¹è·¯å¾„æ˜¯å®Œæˆè§£æï¼Œä¾‹å¦‚path.resolve('/foo', '/bar', 'baz') å°†è¿”å› /bar/baz</span></span><br><span class=\"line\"><span class=\"comment\">     * 3.å¦‚æœä¼ å…¥çš„ç»å¯¹è·¯å¾„ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå½“å‰ç›®å½•å°†è¢«ä½¿ç”¨</span></span><br><span class=\"line\"><span class=\"comment\">     * 4.å½“ä¼ å…¥çš„å‚æ•°æ²¡æœ‰/æ—¶ï¼Œå°†è¢«ä¼ å…¥è§£æåˆ°å½“å‰æ ¹ç›®å½•</span></span><br><span class=\"line\"><span class=\"comment\">     * 5.é›¶é•¿åº¦çš„è·¯å¾„å°†è¢«å¿½ç•¥</span></span><br><span class=\"line\"><span class=\"comment\">     * 6.å¦‚æœæ²¡æœ‰ä¼ å…¥å‚æ•°ï¼Œå°†è¿”å›å½“å‰æ ¹ç›®å½•</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * _dirnameè¡¨ç¤ºç»å¯¹è·¯å¾„</span></span><br><span class=\"line\"><span class=\"comment\">     * æˆ‘ä»¬ç¢°åˆ°çš„./xxå°±æ˜¯ç›¸å¯¹è·¯å¾„</span></span><br><span class=\"line\"><span class=\"comment\">     * 1.åªä¼ å…¥__dirnameä¹Ÿå¯ä»¥è‡ªåŠ¨è°ƒç”¨path.resolveæ–¹æ³•</span></span><br><span class=\"line\"><span class=\"comment\">     * 2.å¯ä»¥æ‹¼æ¥è·¯å¾„å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ä¸è°ƒç”¨path.resolve()æ–¹æ³•æ‹¼æ¥å¤±è´¥</span></span><br><span class=\"line\"><span class=\"comment\">     * 3.__dirnameä»£è¡¨çš„æ˜¯å½“å‰æ–‡ä»¶ï¼ˆa.jsï¼‰çš„ç»å¯¹è·¯å¾„</span></span><br><span class=\"line\"><span class=\"comment\">     * 4.ä»å³è‡³å·¦è§£æï¼Œé‡åˆ°äº†ç»å¯¹è·¯å¾„/srcï¼Œå› æ­¤ç›´æ¥è¿”</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    path: path.resolve(__dirname, <span class=\"string\">'../../dist'</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>webpack é…ç½®æ˜¯æ ‡å‡†çš„ Node.jsçš„CommonJS æ¨¡å—ï¼Œå®ƒé€šè¿‡requireæ¥å¼•å…¥å…¶ä»–æ¨¡å—ï¼Œé€šè¿‡module.exportså¯¼å‡ºæ¨¡å—ï¼Œç”± webpack æ ¹æ®å¯¹è±¡å®šä¹‰çš„å±æ€§è¿›è¡Œè§£æã€‚</p>\n</blockquote>\n<p>åœ¨æ ¹ç›®å½•æ–°å»ºã€srcã€‘æ–‡ä»¶å¤¹ğŸ“</p>\n<p>åœ¨ã€srcã€‘æ–‡ä»¶å¤¹ä¸‹æ–°å»ºæ–‡ä»¶index.js</p>\n<p>okğŸ‘Œï¼Œç¡®è®¤ä¸€ä¸‹ç›®å½•ç»“æ„</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">webpackInit</span><br><span class=\"line\"><span class=\"addition\">+ |- config</span></span><br><span class=\"line\"><span class=\"addition\">+ \t|- webpack</span></span><br><span class=\"line\"><span class=\"addition\">+     |- webpack.common.config.js</span></span><br><span class=\"line\">  |- node_modules</span><br><span class=\"line\"><span class=\"addition\">+ |- src</span></span><br><span class=\"line\"><span class=\"addition\">+     |- index.js</span></span><br><span class=\"line\">  |- package.json</span><br><span class=\"line\">  |- package-lock.json</span><br></pre></td></tr></table></figure>\n\n<p>é‚£æˆ‘ä»¬æ€ä¹ˆæ‰“åŒ…å‘¢ï¼Ÿåœ¨ <code>package.json</code> ä¸­é…ç½®å¦‚ä¸‹å±æ€§ï¼š</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\"scripts\": &#123;</span><br><span class=\"line\"><span class=\"deletion\">- \"test\": \"echo \\\"Error: no test specified\\\" &amp;&amp; exit 1\",</span></span><br><span class=\"line\"><span class=\"addition\">+ \"start\": \"webpack --config ./config/webpack/webpack.common.config.js\"</span></span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n\n<p>å¥½äº†ï¼Œæˆ‘ä»¬è¯•è¯•æ€ä¹ˆæ‰“åŒ…å§ï¼Œè™½ç„¶ä½ çš„ <code>index.js</code> ä¸­ä»€ä¹ˆä»£ç ä¹Ÿæ²¡æœ‰ã€‚<br>åœ¨æ§åˆ¶å°ä¸­è¾“å…¥ä»¥ä¸‹ä»£ç ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run start</span><br></pre></td></tr></table></figure>\n\n<p>npm run xxxx ä¼šå»æ‰§è¡Œå½“å‰ç›®å½•ä¸‹package.jsoné‡Œé¢çš„scriptåŒåè„šæœ¬</p>\n<p>æˆ‘ä»¬çš„ã€npm run startã€‘ç›¸å½“äºç›´æ¥æ‰§è¡Œäº†æˆ‘ä»¬å†™åœ¨ã€startã€‘é‡Œé¢çš„ä»£ç ã€‚</p>\n<p>æ‰§è¡Œä¹‹åï¼Œä½ ä¼šå‘ç°æ ¹ç›®å½•å¤šå‡ºäº†ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼š <code>dist/js</code> ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªjsæ–‡ä»¶ï¼š <code>bundle.js</code> ï¼Œé‚£ä¹ˆè‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸç¼–è¯‘æ‰“åŒ…äº†ä¸€ä¸ªjsæ–‡ä»¶ï¼Œå³å…¥å£æ–‡ä»¶ï¼š <code>index.js</code> ã€‚</p>\n<h3 id=\"å®‰è£…React\"><a href=\"#å®‰è£…React\" class=\"headerlink\" title=\"å®‰è£…React\"></a>å®‰è£…React</h3><p>åœ¨æ§åˆ¶å°è¾“å…¥ä»¥ä¸‹ä»£ç ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save react react-dom</span><br></pre></td></tr></table></figure>\n\n<p>â€“saveå°±æ˜¯è¿è¡Œæ—¶ä¼šç”¨åˆ°çš„ä»£ç </p>\n<p>å…·ä½“å’Œâ€“dev-saveçš„åŒºåˆ«å¯ä»¥è‡ªå·±Googleä¸€ä¸‹</p>\n<p>åœ¨ã€src/index.jsã€‘é‡Œé¢åŠ å…¥ä»¥ä¸‹ä»£ç </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> ReactDOM <span class=\"keyword\">from</span> <span class=\"string\">'react-dom'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> App = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> (</span><br><span class=\"line\">  &lt;&gt;</span><br><span class=\"line\">    Hello Worldï¼</span><br><span class=\"line\">  &lt;<span class=\"regexp\">/&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">)</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">ReactDOM.render(&lt;App /</span>&gt;, <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'root'</span>));</span><br></pre></td></tr></table></figure>\n\n<p>åœ¨æ ¹ç›®å½•åŠ å…¥æ–‡ä»¶å¤¹ã€publicã€‘ï¼Œç„¶ååœ¨ã€publicã€‘é‡Œé¢åŠ å…¥ã€index.htmlã€‘</p>\n<p>ç›®å½•å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">webpackInit</span><br><span class=\"line\"><span class=\"addition\">+ |- public</span></span><br><span class=\"line\"><span class=\"addition\">+ \t|- index.html</span></span><br><span class=\"line\">  |- config</span><br><span class=\"line\">  \t|- webpack</span><br><span class=\"line\">      |- webpack.common.config.js</span><br><span class=\"line\">  |- node_modules</span><br><span class=\"line\">  |- src</span><br><span class=\"line\">      |- index.js</span><br><span class=\"line\">  |- package.json</span><br><span class=\"line\">  |- package-lock.json</span><br></pre></td></tr></table></figure>\n\n<p>ç„¶ååœ¨ã€index.htmlã€‘åŠ å…¥ä»¥ä¸‹ä»£ç ï¼š</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">\"X-UA-Compatible\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">\"viewport\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"initial-scale=1.0, user-scalable=no, width=device-width\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>ä»é›¶é…ç½®Webpack<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"root\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>OK</p>\n<p>ä¸‡äº‹ä¿±å¤‡ï¼Œæˆ‘ä»¬è¿è¡Œï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run start</span><br></pre></td></tr></table></figure>\n\n<p>æ‰“åŒ…å¤±è´¥äº†ã€‚ã€‚ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>\n<h3 id=\"ä½¿ç”¨babel\"><a href=\"#ä½¿ç”¨babel\" class=\"headerlink\" title=\"ä½¿ç”¨babel\"></a>ä½¿ç”¨babel</h3><p>ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸Šé¢å†™jsxä¼šæ‰“åŒ…ä¸äº†å‘¢ï¼Œå› ä¸ºwebpackæ ¹æœ¬è¯†åˆ«ä¸äº†jsxè¯­æ³•ï¼Œé‚£æ€ä¹ˆåŠï¼Ÿä½¿ç”¨loaderå¯¹æ–‡ä»¶è¿›è¡Œé¢„å¤„ç†ã€‚<br>å…¶ä¸­ï¼Œbabel-loaderï¼Œå°±æ˜¯è¿™æ ·ä¸€ä¸ªé¢„å¤„ç†æ’ä»¶ï¼Œå®ƒåŠ è½½ ES2015+ ä»£ç ï¼Œç„¶åä½¿ç”¨ Babel è½¬è¯‘ä¸º ES5ã€‚é‚£å¼€å§‹é…ç½®å®ƒå§ï¼</p>\n<p>é¦–å…ˆå®‰è£…babelç›¸å…³çš„æ¨¡å—ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save-dev babel-loader @babel&#x2F;preset-react @babel&#x2F;preset-env @babel&#x2F;core babel-plugin-import</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>babel-loaderï¼š</strong>ä½¿ç”¨Babelå’Œwebpackæ¥è½¬è¯‘JavaScriptæ–‡ä»¶ã€‚</li>\n<li><strong>@babel/preset-reactï¼š</strong>è½¬è¯‘reactçš„JSX</li>\n<li><strong>@babel/preset-envï¼š</strong>è½¬è¯‘ES2015+çš„è¯­æ³•</li>\n<li><strong>@babel/coreï¼š</strong>babelçš„æ ¸å¿ƒæ¨¡å—</li>\n<li><strong>babel-plugin-import</strong>ï¼šæŒ‰éœ€åŠ è½½æ‰€éœ€è¦çš„babelè§£æ</li>\n</ul>\n<p>ç†è®ºä¸Šæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ <code>webpack.common.config.js</code> ä¸­é…ç½®â€optionsâ€ï¼Œä½†æœ€å¥½åœ¨å½“å‰æ ¹ç›®å½•ï¼Œæ³¨æ„ï¼Œä¸€å®šè¦æ˜¯æ ¹ç›®å½•ï¼ï¼ï¼ æ–°å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ <code>.babelrc</code> é…ç½®ç›¸å…³çš„â€presetsâ€ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"presets\"</span>: [</span><br><span class=\"line\">    [</span><br><span class=\"line\">      <span class=\"string\">\"@babel/preset-env\"</span>,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"string\">\"targets\"</span>: &#123;</span><br><span class=\"line\">          <span class=\"comment\">// å¤§äºç›¸å…³æµè§ˆå™¨ç‰ˆæœ¬æ— éœ€ç”¨åˆ° preset-env</span></span><br><span class=\"line\">          <span class=\"string\">\"edge\"</span>: <span class=\"number\">17</span>,</span><br><span class=\"line\">          <span class=\"string\">\"firefox\"</span>: <span class=\"number\">60</span>,</span><br><span class=\"line\">          <span class=\"string\">\"chrome\"</span>: <span class=\"number\">67</span>,</span><br><span class=\"line\">          <span class=\"string\">\"safari\"</span>: <span class=\"number\">11</span>,</span><br><span class=\"line\">          <span class=\"comment\">// å…¼å®¹åˆ°android4 ios6</span></span><br><span class=\"line\">          <span class=\"string\">\"browsers\"</span>: [<span class=\"string\">\"Android &gt;= 4.0\"</span>, <span class=\"string\">\"ios &gt;= 6\"</span>]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"string\">\"@babel/preset-react\"</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"string\">\"plugins\"</span>: [</span><br><span class=\"line\">    [<span class=\"string\">\"import\"</span>, &#123; <span class=\"string\">\"libraryName\"</span>: <span class=\"string\">\"antd-mobile\"</span>, <span class=\"string\">\"style\"</span>: <span class=\"string\">\"css\"</span> &#125;] <span class=\"comment\">// `style: true` ä¼šåŠ è½½ less æ–‡ä»¶</span></span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>è¿™é‡Œæœ‰å…³<a href=\"https://www.babeljs.cn/docs/babel-preset-env\" target=\"_blank\" rel=\"noopener\">bebelçš„é…ç½®</a>å¯ä¸Šå®˜ç½‘æŸ¥è¯¢æ–‡æ¡£ã€‚</p>\n<p>å†ä¿®æ”¹ <code>webpack.common.config.js</code> ï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  <span class=\"comment\">// é…ç½®å…¥å£æ–‡ä»¶</span></span><br><span class=\"line\">  entry: &#123;</span><br><span class=\"line\">    app: <span class=\"string\">'./src/index.js'</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">// æ‰“åŒ…ğŸ“¦ä¹‹åçš„å‡ºå£</span></span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœä¸åŠ å“ˆå¸Œå€¼ï¼Œæµè§ˆå™¨ä¼šæœ‰ç¼“å­˜ï¼Œå¯èƒ½ä½ éƒ¨ç½²äº†ï¼Œä½†æ˜¯ç”¨æˆ·çœ‹åˆ°çš„è¿˜æ˜¯è€é¡µé¢</span></span><br><span class=\"line\">    <span class=\"comment\">// 8æ˜¯hashçš„é•¿åº¦ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œwebpackä¼šè®¾ç½®é»˜è®¤å€¼ä¸º20ã€‚</span></span><br><span class=\"line\">    filename: <span class=\"string\">'js/[name].[chunkhash:8].bundle.js'</span>,</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Node.js ä¸­ï¼Œ__dirname æ€»æ˜¯æŒ‡å‘è¢«æ‰§è¡Œ js æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œ</span></span><br><span class=\"line\"><span class=\"comment\">     * æ‰€ä»¥å½“ä½ åœ¨ /d1/d2/myscript.js æ–‡ä»¶ä¸­å†™äº† __dirnameï¼Œ å®ƒçš„å€¼å°±æ˜¯ /d1/d2 ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">     * path.resolve</span></span><br><span class=\"line\"><span class=\"comment\">     * 1.path.resolve()æ–¹æ³•å¯ä»¥å°†è·¯å¾„æˆ–è€…è·¯å¾„ç‰‡æ®µè§£ææˆç»å¯¹è·¯å¾„</span></span><br><span class=\"line\"><span class=\"comment\">     * 2.ä¼ å…¥è·¯å¾„ä»å³è‡³å·¦è§£æï¼Œé‡åˆ°ç¬¬ä¸€ä¸ªç»å¯¹è·¯å¾„æ˜¯å®Œæˆè§£æï¼Œä¾‹å¦‚path.resolve('/foo', '/bar', 'baz') å°†è¿”å› /bar/baz</span></span><br><span class=\"line\"><span class=\"comment\">     * 3.å¦‚æœä¼ å…¥çš„ç»å¯¹è·¯å¾„ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå½“å‰ç›®å½•å°†è¢«ä½¿ç”¨</span></span><br><span class=\"line\"><span class=\"comment\">     * 4.å½“ä¼ å…¥çš„å‚æ•°æ²¡æœ‰/æ—¶ï¼Œå°†è¢«ä¼ å…¥è§£æåˆ°å½“å‰æ ¹ç›®å½•</span></span><br><span class=\"line\"><span class=\"comment\">     * 5.é›¶é•¿åº¦çš„è·¯å¾„å°†è¢«å¿½ç•¥</span></span><br><span class=\"line\"><span class=\"comment\">     * 6.å¦‚æœæ²¡æœ‰ä¼ å…¥å‚æ•°ï¼Œå°†è¿”å›å½“å‰æ ¹ç›®å½•</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * _dirnameè¡¨ç¤ºç»å¯¹è·¯å¾„</span></span><br><span class=\"line\"><span class=\"comment\">     * æˆ‘ä»¬ç¢°åˆ°çš„./xxå°±æ˜¯ç›¸å¯¹è·¯å¾„</span></span><br><span class=\"line\"><span class=\"comment\">     * 1.åªä¼ å…¥__dirnameä¹Ÿå¯ä»¥è‡ªåŠ¨è°ƒç”¨path.resolveæ–¹æ³•</span></span><br><span class=\"line\"><span class=\"comment\">     * 2.å¯ä»¥æ‹¼æ¥è·¯å¾„å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ä¸è°ƒç”¨path.resolve()æ–¹æ³•æ‹¼æ¥å¤±è´¥</span></span><br><span class=\"line\"><span class=\"comment\">     * 3.__dirnameä»£è¡¨çš„æ˜¯å½“å‰æ–‡ä»¶ï¼ˆa.jsï¼‰çš„ç»å¯¹è·¯å¾„</span></span><br><span class=\"line\"><span class=\"comment\">     * 4.ä»å³è‡³å·¦è§£æï¼Œé‡åˆ°äº†ç»å¯¹è·¯å¾„/srcï¼Œå› æ­¤ç›´æ¥è¿”</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    path: path.resolve(__dirname, <span class=\"string\">'../../dist'</span>)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * test è§„å®šäº†ä½œç”¨äºä»¥è§„åˆ™ä¸­åŒ¹é…åˆ°çš„åç¼€ç»“å°¾çš„æ–‡ä»¶ï¼Œ </span></span><br><span class=\"line\"><span class=\"comment\">     * use å³æ˜¯ä½¿ç”¨ babel-loader å¿…é¡»çš„å±æ€§ï¼Œ </span></span><br><span class=\"line\"><span class=\"comment\">     * exclude å‘Šè¯‰æˆ‘ä»¬ä¸éœ€è¦å»è½¬è¯‘\"node_modules\"è¿™é‡Œé¢çš„æ–‡ä»¶ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    rules:[</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.(js|jsx)?$/</span>,</span><br><span class=\"line\">        <span class=\"comment\">// å¼€å¯ç¼“å­˜</span></span><br><span class=\"line\">        options: &#123; <span class=\"attr\">cacheDirectory</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">        loader: <span class=\"string\">'babel-loader'</span>,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æ¥ä¸‹æ¥æ¿€åŠ¨äººå¿ƒçš„æ—¶åˆ»ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run start</span><br></pre></td></tr></table></figure>\n\n<p>æ˜¯ä¸æ˜¯èƒ½æ‰“åŒ…æˆåŠŸäº†å‘¢ï¼Ÿ</p>\n<p>æ‰“å¼€ã€dist/ã€‘ä½ çš„htmlé¡µé¢ï¼Œçœ‹ä¸€ä¸‹æ˜¯å¦æ˜¯â€œHello Worldï¼â€å§ï¼</p>\n<h3 id=\"ä½¿ç”¨webpack-mergeğŸˆ´ï¸\"><a href=\"#ä½¿ç”¨webpack-mergeğŸˆ´ï¸\" class=\"headerlink\" title=\"ä½¿ç”¨webpack-mergeğŸˆ´ï¸\"></a>ä½¿ç”¨webpack-mergeğŸˆ´ï¸</h3><p>æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªåä¸º <a href=\"https://github.com/survivejs/webpack-merge\" target=\"_blank\" rel=\"noopener\">webpack-merge</a> çš„å·¥å…·ã€‚é€šè¿‡â€œé€šç”¨â€é…ç½®ï¼Œæˆ‘ä»¬ä¸å¿…åœ¨ç¯å¢ƒç‰¹å®š(environment-specific)çš„é…ç½®ä¸­é‡å¤ä»£ç ã€‚ç®€å•æ¥è¯´å°±æ˜¯ç”Ÿäº§ç¯å¢ƒä¸åŒï¼Œæˆ‘ä»¬è¦ç»™çš„é…ç½®ä¹Ÿæœ‰æ‰€ä¸åŒï¼Œä½†æ˜¯å¯ä»¥å…±ç”¨ä¸€ä¸ªå…±æœ‰çš„é…ç½®ã€‚</p>\n<p>æˆ‘ä»¬å…ˆä»å®‰è£… <a href=\"https://github.com/survivejs/webpack-merge\" target=\"_blank\" rel=\"noopener\">webpack-merge</a> å¼€å§‹ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save-dev webpack-merge</span><br></pre></td></tr></table></figure>\n\n<p>å®‰è£…ç»“æŸä¹‹åï¼Œæˆ‘ä»¬åœ¨ <code>config</code> è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸¤ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«ä¸º <code>webpack.prod.config.js</code> å’Œ <code>webpack.dev.config.js</code> ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶åˆ†åˆ«å¯¹åº”ç”Ÿäº§å’Œå¼€å‘ä¸¤ä¸ªç¯å¢ƒçš„é…ç½®ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥æ·»åŠ testç¯å¢ƒã€‚åå­—ä¹Ÿå¯ä»¥è‡ªå·±å–ï¼Œå°½é‡ä¿æŒä¸€è‡´ã€‚</p>\n<p>ç°åœ¨çš„ç›®å½•ç»“æ„ï¼š</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  webpackInit</span><br><span class=\"line\">\t|- config</span><br><span class=\"line\">\t\t|- webpack</span><br><span class=\"line\">\t    |- webpack.common.config.js</span><br><span class=\"line\"><span class=\"addition\">+     |- webpack.prod.config.js</span></span><br><span class=\"line\">  çœç•¥</span><br></pre></td></tr></table></figure>\n\n<p>åœ¨ã€webpack.prod.config.jsã€‘åŠ å…¥</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> merge = <span class=\"built_in\">require</span>(<span class=\"string\">'webpack-merge'</span>); <span class=\"comment\">// ç‰ˆæœ¬ä¸º4.x</span></span><br><span class=\"line\"><span class=\"comment\">// webpack-merge 5.xç‰ˆæœ¬åº”è¯¥æ”¹ä¸º const &#123; merge &#125; = require('webpack-merge');</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> common = <span class=\"built_in\">require</span>(<span class=\"string\">'./webpack.common.config.js'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = merge(common, &#123;</span><br><span class=\"line\">  mode: <span class=\"string\">'production'</span>,</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>ç„¶åä¿®æ”¹ã€package.jsonã€‘</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  \"name\": \"webpackInit\",</span><br><span class=\"line\">  \"version\": \"1.0.0\",</span><br><span class=\"line\">  \"description\": \"\",</span><br><span class=\"line\">  \"main\": \"index.js\",</span><br><span class=\"line\">  \"scripts\": &#123;</span><br><span class=\"line\">    \"start\": \"webpack --config ./config/webpack/webpack.common.config.js\",</span><br><span class=\"line\"><span class=\"addition\">+   \"build\": \"webpack --config ./config/webpack/webpack.prod.config.js\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  \"keywords\": [],</span><br><span class=\"line\">  \"author\": \"\",</span><br><span class=\"line\">  \"license\": \"ISC\",</span><br><span class=\"line\">  \"devDependencies\": &#123;</span><br><span class=\"line\">    \"@babel/core\": \"^7.10.2\",</span><br><span class=\"line\">    \"@babel/preset-env\": \"^7.10.2\",</span><br><span class=\"line\">    \"@babel/preset-react\": \"^7.10.1\",</span><br><span class=\"line\">    \"babel-loader\": \"^8.1.0\",</span><br><span class=\"line\">    \"babel-plugin-import\": \"^1.13.0\",</span><br><span class=\"line\">    \"webpack\": \"^4.43.0\",</span><br><span class=\"line\">    \"webpack-cli\": \"^3.3.11\",</span><br><span class=\"line\">    \"webpack-merge\": \"^4.2.2\"</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  \"dependencies\": &#123;</span><br><span class=\"line\">    \"react\": \"^16.13.1\",</span><br><span class=\"line\">    \"react-dom\": \"^16.13.1\"</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ç„¶å</p>\n<p>åˆ é™¤ã€distæ–‡ä»¶å¤¹ã€‘</p>\n<p>ä¹‹å</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run build</span><br></pre></td></tr></table></figure>\n\n<p>æ˜¯ä¸æ˜¯ä¹Ÿbuildä¹Ÿæ‰“åŒ…æˆåŠŸäº†ï¼</p>\n<p>htmlæ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥æ­£å¸¸è®¿é—®ï¼</p>\n<p>ä½†æ˜¯æ²¡æœ‰æ˜¾ç¤ºHello Worldï¼Œä»”ç»†ä¸€çœ‹è¿˜æŠ¥é”™äº†ã€‚ã€‚ã€‚ä¸ºä»€ä¹ˆå‘¢ã€‚ã€‚å› ä¸º</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; å¦‚æœä¸åŠ å“ˆå¸Œå€¼ï¼Œæµè§ˆå™¨ä¼šæœ‰ç¼“å­˜ï¼Œå¯èƒ½ä½ éƒ¨ç½²äº†ï¼Œä½†æ˜¯ç”¨æˆ·çœ‹åˆ°çš„è¿˜æ˜¯è€é¡µé¢</span><br><span class=\"line\">    &#x2F;&#x2F; 8æ˜¯hashçš„é•¿åº¦ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œwebpackä¼šè®¾ç½®é»˜è®¤å€¼ä¸º20ã€‚</span><br><span class=\"line\">    filename: &#39;js&#x2F;[name].[chunkhash:8].bundle.js&#39;,</span><br></pre></td></tr></table></figure>\n\n<p>æˆ‘ä»¬ç»™jsæ–‡ä»¶è®¾ç½®äº†hashå€¼ã€‚ä¸èƒ½å¤Ÿç›´æ¥åœ¨htmlé‡Œé¢åŠ ä¸Šã€<script src=\"../dist/js/bundle.js\"></script>ã€‘è¿™ä¹ˆä¸€å¥ï¼Œè€Œä¸”æ¯æ¬¡ç”Ÿæˆçš„hashå€¼éƒ½ä¼šå˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦æ€ä¹ˆå¤„ç†è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</p>\n<h3 id=\"ä½¿ç”¨HtmlWebpackPlugin\"><a href=\"#ä½¿ç”¨HtmlWebpackPlugin\" class=\"headerlink\" title=\"ä½¿ç”¨HtmlWebpackPlugin\"></a>ä½¿ç”¨<a href=\"https://www.webpackjs.com/plugins/html-webpack-plugin/\" target=\"_blank\" rel=\"noopener\">HtmlWebpackPlugin</a></h3><p>å®‰è£…<a href=\"https://www.webpackjs.com/plugins/html-webpack-plugin/\" target=\"_blank\" rel=\"noopener\">HtmlWebpackPlugin</a></p>\n<p>åœ¨æ§åˆ¶å°æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save-dev html-webpack-plugin</span><br></pre></td></tr></table></figure>\n\n<p>ä¿®æ”¹ã€webpack.prod.config.jsã€‘</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> merge = <span class=\"built_in\">require</span>(<span class=\"string\">'webpack-merge'</span>); <span class=\"comment\">// ç‰ˆæœ¬ä¸º4.x</span></span><br><span class=\"line\"><span class=\"comment\">// webpack-merge 5.xç‰ˆæœ¬åº”è¯¥æ”¹ä¸º const &#123; merge &#125; = require('webpack-merge');</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> common = <span class=\"built_in\">require</span>(<span class=\"string\">'./webpack.common.config.js'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'html-webpack-plugin'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = merge(common, &#123;</span><br><span class=\"line\">  mode: <span class=\"string\">'production'</span>,</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>, <span class=\"comment\">// æ‰“åŒ…ä¹‹åçš„htmlæ–‡ä»¶åå­—</span></span><br><span class=\"line\">      <span class=\"comment\">// è¿™é‡Œæœ‰å°ä¼™ä¼´å¯èƒ½ä¼šç–‘æƒ‘ä¸ºä»€ä¹ˆä¸æ˜¯ '../public/index.html'</span></span><br><span class=\"line\">      <span class=\"comment\">// æˆ‘çš„ç†è§£æ˜¯æ— è®ºä¸è¦ç”¨çš„templateæ˜¯ä¸æ˜¯åœ¨ä¸€ä¸ªç›®å½•ï¼Œéƒ½æ˜¯ä»æ ¹è·¯å¾„å¼€å§‹æŸ¥æ‰¾</span></span><br><span class=\"line\">      template: <span class=\"string\">'public/index.html'</span>, <span class=\"comment\">// ä»¥æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„htmlä¸ºæ¨¡æ¿ç”Ÿæˆï¼Œä¸ç„¶æˆ‘ä»¬è¿˜è¦åˆ°æ‰“åŒ…ä¹‹åçš„htmlæ–‡ä»¶ä¸­å†™script</span></span><br><span class=\"line\">      inject: <span class=\"string\">'body'</span>,<span class=\"comment\">// åœ¨bodyæœ€åº•éƒ¨å¼•å…¥jsæ–‡ä»¶ï¼Œå¦‚æœæ˜¯headï¼Œå°±æ˜¯åœ¨headä¸­å¼•å…¥js</span></span><br><span class=\"line\">      minify: &#123; <span class=\"comment\">// å‹ç¼©htmlæ–‡ä»¶</span></span><br><span class=\"line\">        removeComments: <span class=\"literal\">true</span>, <span class=\"comment\">// å»é™¤æ³¨é‡Š</span></span><br><span class=\"line\">        collapseWhitespace: <span class=\"literal\">true</span>, <span class=\"comment\">// å»é™¤ç©ºæ ¼</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n\n\n<p>ç°åœ¨æˆ‘ä»¬å†æ¥æ‰“åŒ…è¯•è¯•</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run build</span><br></pre></td></tr></table></figure>\n\n<p>çœ‹çœ‹distä¸­æ˜¯ä¸æ˜¯å¤šå‡ºäº†htmlæ–‡ä»¶ï¼Œå¹¶ä¸”è‡ªåŠ¨å¼•å…¥äº†scriptï¼Œç”¨æµè§ˆå™¨æ‰“å¼€å®ƒè¯•è¯•çœ‹æ˜¯ä¸æ˜¯èƒ½æ­£ç¡®è¾“å‡ºå†…å®¹äº†ï¼</p>\n<p>èµ·é£ï¼ï¼ğŸ›«ï¸</p>\n<h3 id=\"ä½¿ç”¨clean-webpack-plugin\"><a href=\"#ä½¿ç”¨clean-webpack-plugin\" class=\"headerlink\" title=\"ä½¿ç”¨clean-webpack-plugin\"></a>ä½¿ç”¨clean-webpack-plugin</h3><p>æœ‰äº›åŒå­¦å·²ç»åŒå€¦äº†æ¯æ¬¡éƒ½éœ€è¦åˆ é™¤distæ–‡ä»¶å¤¹æ¥éªŒè¯æ˜¯å¦æˆåŠŸã€‚</p>\n<p>å…¶å®å‡å¦‚æˆ‘ä»¬ä¸åˆ é™¤çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹jsæ–‡ä»¶ï¼Œè¿™æ ·è®©webpackçŸ¥é“æˆ‘ä»¬æ”¹äº†ä¸œè¥¿ï¼Œä»–å°±ä¼šé‡æ–°æ‰“åŒ…ï¼Œä½†æ˜¯æˆ‘ä»¬æ¯æ¬¡æµ‹è¯•éƒ½æ²¡æœ‰å»ä¿®æ”¹ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åˆ é™¤ã€‚</p>\n<p>ä½†æ˜¯ï¼Œå¦‚æœè¯´æˆ‘ä»¬ä¸å»åˆ é™¤distæ–‡ä»¶å¤¹çš„è¯ï¼Œæˆ‘ä»¬ä¿®æ”¹äº†ã€src/index.jsã€‘ã€‚ç„¶åå†é‡æ–°buildï¼Œå°±ä¼šå‘ç°ã€dist/jsã€‘ä¸‹é¢ä¼šåˆå¤šå‡ºä¸€ä¸ªjsæ–‡ä»¶ï¼Œè¿™æ ·çš„è¯æˆ‘ä»¬å°±éœ€è¦è§‚å¯Ÿæ—¥å¿—ï¼ŒæŸ¥çœ‹æ–°é²œâ€œå‡ºç‚‰â€çš„æ˜¯å“ªä¸€ä¸ªï¼Œç„¶ååˆ æ‰åˆ«çš„ã€‚è¿™æ ·éå¸¸éº»çƒ¦ã€‚</p>\n<p>OKï¼Œæˆ‘ä»¬ç°åœ¨å°±æ¥è§£å†³ä¸€ä¸‹è¿™ä¸ªé—®é¢˜</p>\n<p>å®‰è£…clean-webpack-plugin</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save-dev clean-webpack-plugin</span><br></pre></td></tr></table></figure>\n\n<p>ä¿®æ”¹ã€webpck.prod.config.jsã€‘</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const merge = require('webpack-merge'); // ç‰ˆæœ¬ä¸º4.x</span><br><span class=\"line\">// webpack-merge 5.xç‰ˆæœ¬åº”è¯¥æ”¹ä¸º const &#123; merge &#125; = require('webpack-merge');</span><br><span class=\"line\">const common = require('./webpack.common.config.js');</span><br><span class=\"line\"></span><br><span class=\"line\">const HtmlWebpackPlugin = require('html-webpack-plugin');</span><br><span class=\"line\"><span class=\"addition\">+ const &#123; CleanWebpackPlugin &#125; = require('clean-webpack-plugin');</span></span><br><span class=\"line\"></span><br><span class=\"line\">module.exports = merge(common, &#123;</span><br><span class=\"line\">  mode: 'production',</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    new HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: 'index.html', // æ‰“åŒ…ä¹‹åçš„htmlæ–‡ä»¶åå­—</span><br><span class=\"line\">      // è¿™é‡Œæœ‰å°ä¼™ä¼´å¯èƒ½ä¼šç–‘æƒ‘ä¸ºä»€ä¹ˆä¸æ˜¯ '../public/index.html'</span><br><span class=\"line\">      // æˆ‘çš„ç†è§£æ˜¯æ— è®ºä¸è¦ç”¨çš„templateæ˜¯ä¸æ˜¯åœ¨ä¸€ä¸ªç›®å½•ï¼Œéƒ½æ˜¯ä»æ ¹è·¯å¾„å¼€å§‹æŸ¥æ‰¾</span><br><span class=\"line\">      template: 'public/index.html', // ä»¥æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„htmlä¸ºæ¨¡æ¿ç”Ÿæˆï¼Œä¸ç„¶æˆ‘ä»¬è¿˜è¦åˆ°æ‰“åŒ…ä¹‹åçš„htmlæ–‡ä»¶ä¸­å†™script</span><br><span class=\"line\">      inject: 'body',// åœ¨bodyæœ€åº•éƒ¨å¼•å…¥jsæ–‡ä»¶ï¼Œå¦‚æœæ˜¯headï¼Œå°±æ˜¯åœ¨headä¸­å¼•å…¥js</span><br><span class=\"line\">      minify: &#123; // å‹ç¼©htmlæ–‡ä»¶</span><br><span class=\"line\">        removeComments: true, // å»é™¤æ³¨é‡Š</span><br><span class=\"line\">        collapseWhitespace: true, // å»é™¤ç©ºæ ¼</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\"><span class=\"addition\">+   new CleanWebpackPlugin()</span></span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>æˆ‘ä»¬å…ˆæŸ¥çœ‹ç°åœ¨çš„jsæ–‡ä»¶å‰é¢çš„hashå€¼ã€‚ç„¶åæˆ‘ä»¬ä¿®æ”¹ã€src/index.jsã€‘ï¼Œéšä¾¿æ”¹æˆä»€ä¹ˆï¼Œå†é‡æ–°</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run build</span><br></pre></td></tr></table></figure>\n\n<p>å°±ä¼šå‘ç°æ–‡ä»¶å¹¶æ²¡æœ‰æ–°å¢ï¼Œè€Œä¸”æ¢äº†æ–°é²œçš„å“ˆå¸Œå€¼ã€‚</p>\n<p>å½“ç„¶äº†ï¼Œæˆ‘ä¹‹å‰è¯´çš„é‚£äº›è¯ï¼ŒåŒå­¦ä¸ç›¸ä¿¡çš„è¯ï¼Œå¯ä»¥æŠŠã€new CleanWebpackPlugin()ã€‘è¿™ä¸€è¡Œæ³¨é‡Šæ‰ï¼Œç„¶åå†ä¿®æ”¹ã€src/index.jsã€‘ï¼Œä¼šå‘ç°ã€dist/jsã€‘ä¸‹é¢çš„jsæ–‡ä»¶ä¼šå¢å¤šä¸€æ¡ã€‚</p>\n<h3 id=\"ä½¿ç”¨webpack-dev-server\"><a href=\"#ä½¿ç”¨webpack-dev-server\" class=\"headerlink\" title=\"ä½¿ç”¨webpack-dev-server\"></a>ä½¿ç”¨webpack-dev-server</h3><p>æ—¢ç„¶åˆšåˆšéƒ½æåˆ°ä¼˜åŒ–äº†ï¼Œæˆ‘ä»¬æ¯æ¬¡éƒ½éœ€è¦buildä¸€ä¸‹ï¼Œæ„Ÿè§‰å¾ˆå‘†ã€‚è€Œwebpackå®˜æ–¹ä¹Ÿæä¾›çƒ­éƒ¨ç½²ï¼Œé‚£æˆ‘ä»¬ç°åœ¨å°±ä½¿ç”¨èµ·æ¥</p>\n<p>å®‰è£…webpack-dev-server</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install webpack-dev-server --save-dev</span><br></pre></td></tr></table></figure>\n\n<p>æ–°å»ºæ–‡ä»¶ã€webpack.dev.config.jsã€‘ğŸ“ƒ</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  webpackInit</span><br><span class=\"line\">\t|- config</span><br><span class=\"line\">\t\t|- webpack</span><br><span class=\"line\">\t    |- webpack.common.config.js</span><br><span class=\"line\">      |- webpack.prod.config.js</span><br><span class=\"line\"><span class=\"addition\">+     |- webpack.dev.config.js</span></span><br><span class=\"line\">  çœç•¥</span><br></pre></td></tr></table></figure>\n\n<p>ç„¶ååŠ å…¥å¦‚ä¸‹ä»£ç </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> merge = <span class=\"built_in\">require</span>(<span class=\"string\">'webpack-merge'</span>); <span class=\"comment\">// ç‰ˆæœ¬ä¸º4.x</span></span><br><span class=\"line\"><span class=\"comment\">// webpack-merge 5.xç‰ˆæœ¬åº”è¯¥æ”¹ä¸º const &#123; merge &#125; = require('webpack-merge');</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> common = <span class=\"built_in\">require</span>(<span class=\"string\">'./webpack.common.config.js'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> webpack = <span class=\"built_in\">require</span>(<span class=\"string\">'webpack'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'html-webpack-plugin'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = merge(common, &#123;</span><br><span class=\"line\">  mode: <span class=\"string\">'development'</span>,</span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    filename: <span class=\"string\">'js/[name].[hash:8].bundle.js'</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  devServer: &#123;</span><br><span class=\"line\">    contentBase: path.resolve(__dirname, <span class=\"string\">'../dist'</span>),</span><br><span class=\"line\">    open: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    port: <span class=\"number\">9000</span>,</span><br><span class=\"line\">    compress: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    hot: <span class=\"literal\">true</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      template: <span class=\"string\">'public/index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"string\">'body'</span>,</span><br><span class=\"line\">      hash: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>ä¿®æ”¹æ–‡ä»¶ã€package.jsonã€‘ğŸ“ƒ</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\"scripts\": &#123;</span><br><span class=\"line\"><span class=\"deletion\">-   \"start\": \"webpack --config ./config/webpack/webpack.common.config.js\",</span></span><br><span class=\"line\"><span class=\"addition\">+   \"start\": \"webpack-dev-server --inline --config ./config/webpack/webpack.dev.config.js\",</span></span><br><span class=\"line\">    \"build\": \"webpack --config ./config/webpack/webpack.prod.config.js\",</span><br><span class=\"line\">  &#125;,</span><br></pre></td></tr></table></figure>\n\n<p>ç„¶åæˆ‘ä»¬</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run start</span><br></pre></td></tr></table></figure>\n\n<p>æ˜¯ä¸æ˜¯è‡ªåŠ¨å¼€äº†ä¸€ä¸ªç«¯å£ä¸º9000çš„ç½‘é¡µï¼Œä¸Šé¢æ˜¯æˆ‘ä»¬å†™çš„é¡µé¢å†…å®¹ï¼Œè¿™å’Œæˆ‘ä»¬çš„é…ç½®éƒ½æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚<br>ç°åœ¨ä½ éšæ„ä¿®æ”¹index.jsä¸­çš„ä»£ç ï¼Œå†å›åˆ°é¡µé¢çœ‹ä¸‹æ˜¯ä¸æ˜¯ä¹Ÿè·Ÿç€å˜äº†ï¼Œé‚£æˆ‘ä»¬å°±æ•´åˆwebpack-dev-serveræˆåŠŸï¼</p>\n<h3 id=\"ä½¿ç”¨source-map\"><a href=\"#ä½¿ç”¨source-map\" class=\"headerlink\" title=\"ä½¿ç”¨source-map\"></a>ä½¿ç”¨source-map</h3><p>source-mapå¯ä»¥å±•ç¤ºæˆ‘ä»¬ä»£ç çš„é”™è¯¯ä½ç½®ï¼Œå› ä¸ºæˆ‘ä»¬çš„ä»£ç éƒ½æ˜¯è¢«webpackæ‰“åŒ…è¿‡çš„ï¼Œåªæœ‰æœºå™¨çœ‹å¾—æ‡‚ï¼Œæˆ‘ä»¬äººç±»æ— æ³•æ­£å¸¸è¯†åˆ«ã€‚æ‰€ä»¥éœ€è¦ä»–ã€‚</p>\n<p>æƒ³è¯•ä¸€ä¸‹æœªå¼€å¯æ˜¯ä»€ä¹ˆçŠ¶æ€çš„åŒå­¦å¯ä»¥è‡ªå·±æ•…æ„æŠŠä»£ç å†™é”™ï¼Œç„¶åçœ‹çœ‹æ§åˆ¶å°çš„æŠ¥é”™ã€‚</p>\n<p>å¼€å¯ä¹Ÿååˆ†ç®€å•ã€‚</p>\n<p>å®ƒçš„é…ç½®éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨ ã€webpack.dev.config.jsã€‘ ä¸­å¢åŠ ä¸€ä¸ª <code>devtool</code> å±æ€§å³å¯ï¼</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">module.exports = &#123;</span><br><span class=\"line\"><span class=\"addition\">+  devtool: 'cheap-module-eval-source-map',</span></span><br><span class=\"line\">\t//...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å› ä¸ºæˆ‘ä»¬åªæœ‰è‡ªå·±å†™ä»£ç çš„æ—¶å€™æ‰éœ€è¦æŸ¥çœ‹ï¼Œåˆ°ç”Ÿäº§ç¯å¢ƒå°±è¦å…³é—­å•¦ï¼Œä¸ç„¶æˆ‘ä»¬çš„æ™ºæ…§ç»“æ™¶å°±è¦è¢«ã€çªƒå–ã€‘å•¦ï¼æ‰€ä»¥æˆ‘æ”¾åœ¨äº†</p>\n<h2 id=\"ä¸­åœºä¼‘æ¯\"><a href=\"#ä¸­åœºä¼‘æ¯\" class=\"headerlink\" title=\"ä¸­åœºä¼‘æ¯\"></a>ä¸­åœºä¼‘æ¯</h2><p>è¿™é‡Œå›é¡¾ä¸€ä¸‹çŸ¥è¯†ç‚¹ã€‚</p>\n<ol>\n<li>æˆ‘ä»¬å…ˆnpm init æ–°å»ºä¸€ä¸ªç©ºç™½é¡¹ç›®ã€‚</li>\n<li>ç„¶åå®‰è£…webpackï¼Œreactã€‚</li>\n<li>å‘ç°æ— æ³•ç¼–è¯‘jsxã€‚</li>\n<li>æ‰€ä»¥æˆ‘ä»¬å¯»æ±‚äº†babelçš„å¸®åŠ©ï¼Œå¹¶é…ç½®äº†æ‰€éœ€è¦è§£æçš„å†…å®¹ã€‚</li>\n<li>è§‰å¾—åœ¨htmlé‡Œé¢åŠ å…¥jså¾ˆå‘†ï¼Œæ‰€ä»¥å¼•å…¥äº†HtmlWebpackPlugin</li>\n<li>å› ä¸ºè§‰å¾—æ¯æ¬¡åˆ é™¤æ‰“åŒ…å‡ºæ¥çš„ä¸œè¥¿å¾ˆå‘†ï¼Œæ‰€ä»¥å¼•å…¥äº†clean-webpack-plugin</li>\n<li>å› ä¸ºæ¯æ¬¡éƒ½éœ€è¦é‡æ–°æ‰“åŒ…ï¼Œæ‰€ä»¥ä½¿ç”¨webpack-dev</li>\n<li>è‡³äºwebpack-mergeæ˜¯ä¸ºäº†æ‰“åŒ…å’Œç¼–è¯‘ä¸¤ä¸ªæˆ–è€…è¯´å¤šä¸ªçŠ¶æ€åšé¢„å¤‡çš„ï¼Œåœ¨ä¸Šè¿°çš„ä¾‹å­åªæœ‰æœ¬åœ°çš„devå’Œbuildä¸¤ä¸ªç¯å¢ƒã€‚</li>\n</ol>\n<p>åŸºæœ¬ä¸Šä¸Šè¿°çš„æ“ä½œè¿‡ç¨‹æˆ‘éƒ½æœ‰è§£é‡Šï¼Œæˆ–è€…æ˜¯æ³¨é‡Šï¼Œæˆ–è€…æ˜¯åœ¨æ–‡ç« ä¸­è¯´æ˜ã€‚å¤§å®¶å¯ä»¥è·Ÿç€èŠ‚å¥ä¸€æ­¥ä¸€æ­¥æ¥ï¼Œå› ä¸ºæˆ‘ä¹Ÿæ˜¯ä¸€è¾¹å†™blogä¸€è¾¹è·‘ä»£ç ä¸€è¾¹å›é¡¾çŸ¥è¯†ç‚¹ã€‚</p>\n<p>è‡³æ­¤ï¼Œwebpackç®—æ˜¯å‘Šä¸€â€¦â€¦</p>\n<p>è¯¶è¯¶è¯¶è¯¶ï¼jsæ˜¯å¯ä»¥è§£æäº†ï¼Œé‚£csså‘¢ï¼</p>\n<p>å“¦å“¦ï¼Œå¥½çš„ï¼Œé‚£æˆ‘ä»¬ç»§ç»­å¯ç¨‹</p>\n<h2 id=\"é‡æ–°èµ·èˆª\"><a href=\"#é‡æ–°èµ·èˆª\" class=\"headerlink\" title=\"é‡æ–°èµ·èˆª\"></a>é‡æ–°èµ·èˆª</h2><h3 id=\"ä½¿ç”¨css-loaderå’Œstyle-loaderä¸¤å…„å¼Ÿ\"><a href=\"#ä½¿ç”¨css-loaderå’Œstyle-loaderä¸¤å…„å¼Ÿ\" class=\"headerlink\" title=\"ä½¿ç”¨css-loaderå’Œstyle-loaderä¸¤å…„å¼Ÿ\"></a>ä½¿ç”¨css-loaderå’Œstyle-loaderä¸¤å…„å¼Ÿ</h3><p>å‡å¦‚æˆ‘ä»¬ç›´æ¥å¼•ç”¨cssçš„è¯ï¼Œä¼šæŠ¥é”™äº†ã€‚è¿™é‡Œå°±ä¸æ¼”ç¤ºäº†ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è‡ªå·±è¯•è¯•ã€‚</p>\n<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å…ˆèµ°å‘½ä»¤è¡Œæ•²å‡»</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save-dev style-loader css-loader</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"ä¸¤å…„å¼Ÿçš„å…³ç³»\"><a href=\"#ä¸¤å…„å¼Ÿçš„å…³ç³»\" class=\"headerlink\" title=\"ä¸¤å…„å¼Ÿçš„å…³ç³»\"></a>ä¸¤å…„å¼Ÿçš„å…³ç³»</h4><p>æ¥è¯´è¯´css-loaderå’Œstyle-loaderä»–ä»¬è¿™å¯¹é¸³é¸¯çš„å…³ç³»ã€‚</p>\n<p>é¦–å…ˆcss-loaderä¼šæŠŠä½ çš„CSSæ–‡ä»¶è¿›è¡Œè§£æï¼Œå› ä¸ºwebpackæ˜¯ç”¨JSå†™çš„ï¼Œè¿è¡Œåœ¨nodeç¯å¢ƒï¼Œæ‰€ä»¥é»˜è®¤webpackæ‰“åŒ…çš„æ—¶å€™åªä¼šå¤„ç†JSä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼</p>\n<p>æ‰€ä»¥æˆ‘ä»¬ä¹‹å‰çš„reacté‡Œé¢çš„jsxéœ€è¦babelçš„å¸®åŠ©ï¼Œæˆ–è€…è¯´éœ€è¦ã€babel-loaderã€‘çš„å¸®åŠ©ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„cssåŒæ ·éœ€è¦ã€css-loaderã€‘çš„å¸®åŠ©ï¼Œé‚£ä¹ˆåˆå…³ã€style-loaderã€‘ä»€ä¹ˆäº‹ï¼Ÿå¯ä¸å¯ä»¥ä¸è£…ä»–å‘¢ï¼Ÿ</p>\n<p>ç­”æ¡ˆæ˜¯ï¼šå¯ä»¥çš„ï¼Œä½†æ˜¯ä½ ä½¿ç”¨èµ·æ¥ä¼šéå¸¸çš„éº»çƒ¦ã€‚æ€ä¹ˆä¸ªéº»çƒ¦æ³•å‘¢ï¼Ÿ</p>\n<p>å¦‚æœåªç”¨äº†ã€css-loaderã€‘è§£æå‡ºæ¥çš„æ˜¯è¿™æ ·çš„</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[&quot;.&#x2F;src&#x2F;index.css&quot;, &quot;.test&#123;â†µ  color: red;â†µ&#125;&quot;, &quot;&quot;]</span><br></pre></td></tr></table></figure>\n\n<p>è¿™æ ·å’‹ç”¨å˜›ï¼Œä½ æ˜¯è§£æäº†ï¼Œå¯æ˜¯ä½ è§£æçš„æ˜¯ä¸ªXXã€‚</p>\n<p>è¿™ä¸ªæ—¶å€™å°±éœ€è¦æˆ‘ä»¬çš„å¤©é™çŒ›ç”·ã€style-loaderã€‘</p>\n<p>style-loader æ˜¯é€šè¿‡ä¸€ä¸ªJSè„šæœ¬åˆ›å»ºä¸€ä¸ªstyleæ ‡ç­¾ï¼Œé‡Œé¢åŒ…å«ä¸€äº›æ ·å¼ã€‚style-loaderæ˜¯ä¸èƒ½å•ç‹¬ä½¿ç”¨çš„ï¼Œåº”ä¸ºå®ƒå¹¶ä¸è´Ÿè´£è§£æ css ä¹‹å‰çš„ä¾èµ–å…³ç³»ï¼Œæ¯ä¸ªloaderçš„åŠŸèƒ½éƒ½æ˜¯å•ä¸€çš„ï¼Œå„è‡ªæ‹†åˆ†ç‹¬ç«‹ã€‚</p>\n<h4 id=\"ä¸Šæ‰‹ï¼\"><a href=\"#ä¸Šæ‰‹ï¼\" class=\"headerlink\" title=\"ä¸Šæ‰‹ï¼\"></a>ä¸Šæ‰‹ï¼</h4><p>åŠ å…¥index.css</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">src</span><br><span class=\"line\"><span class=\"addition\">+  |- index.css</span></span><br><span class=\"line\">   |- indexjs</span><br></pre></td></tr></table></figure>\n\n<p>index.cssæ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.test</span>&#123;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>: red;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä¿®æ”¹index.js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> ReactDOM <span class=\"keyword\">from</span> <span class=\"string\">'react-dom'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'./index.css'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> App = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> (</span><br><span class=\"line\">  &lt;div className=<span class=\"string\">\"test\"</span>&gt;</span><br><span class=\"line\">    Hello Worldï¼!</span><br><span class=\"line\">  &lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">)</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">ReactDOM.render(&lt;App /</span>&gt;, <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'root'</span>));</span><br></pre></td></tr></table></figure>\n\n<p>ä¿®æ”¹ã€webpack.common.config.jsã€‘ğŸ“ƒ</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//...</span><br><span class=\"line\">rules:[</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: /\\.(js|jsx)?$/,</span><br><span class=\"line\">        // å¼€å¯ç¼“å­˜</span><br><span class=\"line\">        options: &#123; cacheDirectory: true &#125;,</span><br><span class=\"line\">        loader: 'babel-loader',</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\"><span class=\"addition\">+      &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+        test: /\\.css$/,</span></span><br><span class=\"line\"><span class=\"addition\">+        use: [ </span></span><br><span class=\"line\"><span class=\"addition\">+          'css-loader', </span></span><br><span class=\"line\"><span class=\"addition\">+          'style-loader',</span></span><br><span class=\"line\"><span class=\"addition\">+        ]</span></span><br><span class=\"line\"><span class=\"addition\">+      &#125;</span></span><br><span class=\"line\">    ]</span><br><span class=\"line\">    //....</span><br></pre></td></tr></table></figure>\n\n<p>è®°å¾—é‡æ–°è¿è¡Œï¼Œå› ä¸ºwebpackçš„é…ç½®ä»–è¯»å–ä¸€æ¬¡ï¼Œæ‰€ä»¥å¦‚æœä½ ä¿®æ”¹äº†é…ç½®ï¼Œéœ€è¦ã€ctrl+cã€‘å…³é—­é‡æ–°è¿è¡Œã€‚</p>\n<p>å˜¿å˜¿â€¦â€¦æ˜¯ä¸æ˜¯è¿è¡Œä¸äº†å•Šã€‚</p>\n<p>å…¶å®æˆ‘æ˜¯æ•…æ„çš„ï¼Œæˆ‘æƒ³å‘Šè¯‰å¤§å®¶ä¸€ä¸ªçŸ¥è¯†ç‚¹ã€‚</p>\n<blockquote>\n<p>loaderçš„åŠ è½½é¡ºåºæ˜¯ä»å³å¾€å·¦ã€‚è¿™é‡Œçš„ç¼–è¯‘é¡ºåºæ˜¯å…ˆç”¨css-loaderå°†cssä»£ç ç¼–è¯‘ï¼Œå†äº¤ç»™style-loaderæ’å…¥åˆ°ç½‘é¡µé‡Œé¢å»ã€‚æ‰€ä»¥css-loaderåœ¨å³ï¼Œstyle-loaderåœ¨å·¦ã€‚</p>\n</blockquote>\n<p>è™½ç„¶æˆ‘ä»¬çš„æ•°ç»„æ¢è¡Œäº†ï¼Œä½†æ˜¯ä»”ç»†çœ‹ä¸éš¾çœ‹å‡ºé¡ºåºã€‚</p>\n<p>æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å°†ä»–ä»¬æ¢ä¸ªä½ç½®å°±å¯ä»¥äº†ã€‚ä»£ç æˆ‘å°±ä¸è´´äº†ã€‚</p>\n<p>ç°åœ¨å¤§å®¶åº”è¯¥è®°å¿†å¾ˆæ·±åˆ»äº†å§ï¼</p>\n<p>å¤§å®¶é‡æ–°ã€ctrl+cã€‘å…³é—­é‡æ–°è¿è¡Œå°±è¡Œäº†ã€‚æˆ‘ä»¬çš„hello worldæ˜¯ä¸æ˜¯å˜çº¢å•¦ï½</p>\n<h3 id=\"å®‰è£…less-loader\"><a href=\"#å®‰è£…less-loader\" class=\"headerlink\" title=\"å®‰è£…less-loader\"></a>å®‰è£…less-loader</h3><p>è¯´åˆ°cssï¼Œè¯´å¥å®åœ¨è¯ï¼Œæ²¡å‡ äººçœŸçš„æ˜¯åœ¨å†™çº¯cssçš„å§ï¼Ÿç°åœ¨è°ä¸æ˜¯lessï¼Œsassæˆ–è€…å…¶ä»–cssé¢„å¤„ç†å‘¢ï¼Ÿè€Œä¸”è¿™äº›é¢„å¤„ç†çš„å¥½å¤„æˆ‘å°±ä¸ç»†è¯´äº†ï¼Œæ„Ÿå…´è¶£çš„è‡ªå·±Googleå§ï¼Œæœ¬æ–‡ç”¨çš„æ˜¯lessï¼ˆå› ä¸ºant designç”¨çš„ä¹Ÿæ˜¯lessï¼Œå“ˆå“ˆï¼Œå‡è£…æ˜¯èš‚èšçš„ä¸€å‘˜ï¼‰</p>\n<p>åœ¨å‘½ä»¤è¡Œè¾“å…¥</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save-dev less less-loader</span><br></pre></td></tr></table></figure>\n\n<p>lessæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œç”¨ä»–è‚¯å®šè¦è£…ï¼Œless-loaderï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯lessçš„è§£æè€…ã€‚</p>\n<p>åœ¨ã€webpack.common.config.jsã€‘å¢åŠ </p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">        test: /\\.css$/,</span><br><span class=\"line\">        use: [ </span><br><span class=\"line\">          'style-loader',</span><br><span class=\"line\">          'css-loader', </span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\"><span class=\"addition\">+      &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+        test: /\\.less$/,</span></span><br><span class=\"line\"><span class=\"addition\">+        use: [ </span></span><br><span class=\"line\"><span class=\"addition\">+          'style-loader',</span></span><br><span class=\"line\"><span class=\"addition\">+          'css-loader', </span></span><br><span class=\"line\"><span class=\"addition\">+          'less-loader',</span></span><br><span class=\"line\"><span class=\"addition\">+        ]</span></span><br><span class=\"line\"><span class=\"addition\">+      &#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>ä¾æ—§æ˜¯é¡ºåºé—®é¢˜ï¼Œå…ˆè§£ælessï¼ŒæŠŠlessè§£ææˆå¸¸è§„çš„cssï¼Œç„¶åå†è§£æcssï¼Œæœ€åæ’å…¥åˆ°ç½‘é¡µä¸­å»ã€‚</p>\n<p>ä¿®æ”¹ã€index.jsã€‘å¼•å…¥è‡ªå·±å†™çš„ã€.lessã€‘æ–‡ä»¶</p>\n<p>å¤§å®¶é‡æ–°ã€ctrl+cã€‘å…³é—­é‡æ–°è¿è¡Œå°±è¡Œäº†ã€‚è‡³äºä½ å†™äº†ä»€ä¹ˆlessç‰¹æ€§ï¼Œåªè¦æœ‰æ•ˆæœå°±è¡Œäº†ã€‚</p>\n<h3 id=\"å®‰è£…url-loaderå’Œfile-loader\"><a href=\"#å®‰è£…url-loaderå’Œfile-loader\" class=\"headerlink\" title=\"å®‰è£…url-loaderå’Œfile-loader\"></a>å®‰è£…url-loaderå’Œfile-loader</h3><p>è¯´å®ŒCSSï¼Œç¾ä¸½çš„ç½‘é¡µå½“ç„¶ç¦»ä¸å¼€æˆ‘ä»¬åŠ¨äººçš„å›¾ç‰‡å•¦ã€‚</p>\n<p>ã€file-loaderã€‘çš„ä½œç”¨æ˜¯ï¼ŒæŠŠä½ çš„æ–‡ä»¶æ‰“åŒ…èµ·æ¥ï¼Œå’Œjsæ–‡ä»¶æ”¾åœ¨ä¸€èµ·ï¼Œè¿™æ ·ç”¨æˆ·è®¿é—®æˆ‘ä»¬çš„ç½‘é¡µçš„æ—¶å€™ï¼Œå…¶å®ä¹Ÿéœ€è¦è®¿é—®æˆ‘ä»¬çš„urlï¼Œæ—¢å¢åŠ äº†æœåŠ¡å™¨çš„å‹åŠ›ï¼Œä¹Ÿå¢åŠ äº†ç”¨æˆ·å‡çº§æµé‡çš„å‹åŠ›ï¼Œéœ€è¦å»ä¸‹è½½è¿™ä¸ªæ–‡ä»¶ã€‚</p>\n<p>ã€url-loaderã€‘</p>\n<p>å¦‚æœé¡µé¢å›¾ç‰‡è¾ƒå¤šï¼Œå‘å¾ˆå¤šhttpè¯·æ±‚ï¼Œä¼šé™ä½é¡µé¢æ€§èƒ½ã€‚è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡url-loaderè§£å†³ã€‚url-loaderä¼šå°†å¼•å…¥çš„å›¾ç‰‡ç¼–ç ï¼Œç”ŸæˆdataURlå¹¶å°†å…¶æ‰“åŒ…åˆ°æ–‡ä»¶ä¸­ï¼Œæœ€ç»ˆåªéœ€è¦å¼•å…¥è¿™ä¸ªdataURLå°±èƒ½è®¿é—®å›¾ç‰‡äº†ã€‚</p>\n<p>url-loaderå’Œfile-loaderä¸¤å…„å¼Ÿçš„æ­é…å¯ä»¥æœ‰æ•ˆçš„å‡å°‘ä¸å¿…è¦çš„urlè¯·æ±‚ï¼Œå› ä¸ºæœ‰çš„å›¾ç‰‡ä½ è¦å»è¯·æ±‚urlè·å–ï¼Œå¦‚æœå°çš„è¯å®Œå…¨å¯ä»¥ç”¨base64æ›¿ä»£ã€‚å¦‚æœå›¾ç‰‡å¾ˆå¤§çš„è¯å°±ç”¨file-loaderï¼Œè¿™æ ·å¯ä»¥å‡å°‘ç¼–ç çš„å‹åŠ›ã€‚</p>\n<p>åœ¨å‘½ä»¤è¡Œè¾“å…¥</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install file-loader url-loader --save-dev</span><br></pre></td></tr></table></figure>\n\n<p>ä¿®æ”¹ã€webpack.common.config.jsã€‘ğŸ“ƒ</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">module: &#123;</span><br><span class=\"line\">  rules: [</span><br><span class=\"line\">    //...</span><br><span class=\"line\"><span class=\"addition\">+    &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+      test: /\\.(jpg|png|gif)$/,</span></span><br><span class=\"line\"><span class=\"addition\">+      use: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+        loader: 'url-loader',</span></span><br><span class=\"line\"><span class=\"addition\">+        options: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+          name: '[name].[ext]', //è¾“å‡ºçš„æ–‡ä»¶å</span></span><br><span class=\"line\"><span class=\"addition\">+          outputPath: 'images/', // è¾“å‡ºåˆ°distç›®å½•ä¸‹çš„è·¯å¾„ï¼ˆdist/images/ï¼‰</span></span><br><span class=\"line\">\t\t\t\t\t\t/**</span><br><span class=\"line\">             * å¦‚æœä½ è¿™ä¸ªå›¾ç‰‡æ–‡ä»¶å¤§äº8192bï¼Œå³8kbï¼Œé‚£æˆ‘url-loaderå°±ä¸ç”¨ï¼Œè½¬è€Œå»ä½¿ç”¨file-loaderï¼Œ</span><br><span class=\"line\">             * æŠŠå›¾ç‰‡æ­£å¸¸æ‰“åŒ…æˆä¸€ä¸ªå•ç‹¬çš„å›¾ç‰‡æ–‡ä»¶åˆ°è®¾ç½®çš„ç›®å½•ä¸‹ï¼Œè‹¥æ˜¯å°äºäº†8kbï¼Œ</span><br><span class=\"line\">             * é‚£å¥½ï¼Œæˆ‘å°±å°†å›¾ç‰‡æ‰“åŒ…æˆbase64çš„å›¾ç‰‡æ ¼å¼æ’å…¥åˆ°bundle.jsæ–‡ä»¶ä¸­ï¼Œ</span><br><span class=\"line\">             * è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå‡å°‘äº†httpè¯·æ±‚ï¼Œä½†æ˜¯å¦‚æœæ–‡ä»¶è¿‡å¤§ï¼Œjsæ–‡ä»¶ä¹Ÿä¼šè¿‡å¤§ï¼Œ</span><br><span class=\"line\">             * å¾—ä¸å¿å¤±ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆæœ‰limitçš„åŸå› ï¼</span><br><span class=\"line\">             */</span><br><span class=\"line\"><span class=\"addition\">+          limit: 8192,</span></span><br><span class=\"line\"><span class=\"addition\">+        &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+      &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+    &#125;</span></span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"è¿›é˜¶\"><a href=\"#è¿›é˜¶\" class=\"headerlink\" title=\"è¿›é˜¶\"></a>è¿›é˜¶</h2><p>åŸºæœ¬ä¸Šæˆ‘ä»¬çš„webpackå¯ä»¥æ­£å¸¸è¿è¡Œäº†ï¼Œcssï¼Œjsï¼Œjsxéƒ½å¯ä»¥è§£æäº†ã€‚ä½†æ˜¯æˆ‘ä»¬éœ€è¦è€ƒè™‘ä¸€äº›è¿›é˜¶çš„ä¸œè¥¿ï¼Œä¼˜åŒ–ã€‚</p>\n<h3 id=\"ä½¿ç”¨uglifyjs-webpack-plugin\"><a href=\"#ä½¿ç”¨uglifyjs-webpack-plugin\" class=\"headerlink\" title=\"ä½¿ç”¨uglifyjs-webpack-plugin\"></a>ä½¿ç”¨uglifyjs-webpack-plugin</h3><p>åœ¨æ§åˆ¶å°æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install uglifyjs-webpack-plugin --save-dev</span><br></pre></td></tr></table></figure>\n\n<p>åœ¨ã€webpack.prod.config.jsã€‘æ·»åŠ ä»£ç </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> UglifyJsPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'uglifyjs-webpack-plugin'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\"><span class=\"comment\">//...</span></span><br><span class=\"line\">  optimization: &#123;</span><br><span class=\"line\">    minimizer: [</span><br><span class=\"line\">      <span class=\"keyword\">new</span> UglifyJsPlugin(&#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.js(\\?.*)?$/i</span>,  <span class=\"comment\">//æµ‹è¯•åŒ¹é…æ–‡ä»¶,</span></span><br><span class=\"line\">        include: <span class=\"regexp\">/\\/includes/</span>, <span class=\"comment\">//åŒ…å«å“ªäº›æ–‡ä»¶</span></span><br><span class=\"line\">        excluce: <span class=\"regexp\">/\\/excludes/</span>, <span class=\"comment\">//ä¸åŒ…å«å“ªäº›æ–‡ä»¶</span></span><br><span class=\"line\"></span><br><span class=\"line\">        cache: <span class=\"literal\">false</span>,   <span class=\"comment\">//æ˜¯å¦å¯ç”¨æ–‡ä»¶ç¼“å­˜ï¼Œé»˜è®¤ç¼“å­˜åœ¨node_modules/.cache/uglifyjs-webpack-plugin.ç›®å½•</span></span><br><span class=\"line\">        parallel: <span class=\"literal\">true</span>,  <span class=\"comment\">//ä½¿ç”¨å¤šè¿›ç¨‹å¹¶è¡Œè¿è¡Œæ¥æé«˜æ„å»ºé€Ÿåº¦</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//å…è®¸è¿‡æ»¤å“ªäº›å—åº”è¯¥è¢«uglifiedï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰å—éƒ½æ˜¯uglifiedï¼‰ã€‚ </span></span><br><span class=\"line\">        <span class=\"comment\">//è¿”å›trueä»¥uglifyå—ï¼Œå¦åˆ™è¿”å›falseã€‚</span></span><br><span class=\"line\">        chunkFilter: <span class=\"function\">(<span class=\"params\">chunk</span>) =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// `vendor` æ¨¡å—ä¸å‹ç¼©</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (chunk.name === <span class=\"string\">'vendor'</span>) &#123;</span><br><span class=\"line\">              <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">  </span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">//..</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ä½¿ç”¨splitChunks\"><a href=\"#ä½¿ç”¨splitChunks\" class=\"headerlink\" title=\"ä½¿ç”¨splitChunks\"></a>ä½¿ç”¨splitChunks</h3><p>å…¶å®æˆ‘ä»¬å†™çš„ä»£ç ï¼Œæœ‰äº›åº“çš„ä»£ç æ˜¯ä¸éœ€è¦æ¯æ¬¡éƒ½ç¼–è¯‘çš„ï¼Œæœ€ç®€å•çš„ä¾‹å­å°±æ˜¯Reactï¼Œè¿™ä¸ªæˆ‘ä»¬å‡ ä¹æ¯ä¸ªjsæ–‡ä»¶éƒ½ä¼šç”¨åˆ°ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬å•ç‹¬æ‰“åŒ…ï¼Œè¿™æ ·åªéœ€è¦æ‰“åŒ…ä¸€æ¬¡ã€‚</p>\n<p>ä¿®æ”¹ã€webpack.common.config.jsã€‘</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">entry: &#123;</span><br><span class=\"line\">     index: './src/index.js',</span><br><span class=\"line\"><span class=\"addition\">+    common: ['react', 'react-dom']</span></span><br><span class=\"line\">  &#125;,</span><br></pre></td></tr></table></figure>\n\n<p>ä¿®æ”¹ã€webpack.prod.config.jsã€‘</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> merge = <span class=\"built_in\">require</span>(<span class=\"string\">'webpack-merge'</span>); <span class=\"comment\">// ç‰ˆæœ¬ä¸º4.x</span></span><br><span class=\"line\"><span class=\"comment\">// webpack-merge 5.xç‰ˆæœ¬åº”è¯¥æ”¹ä¸º const &#123; merge &#125; = require('webpack-merge');</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> common = <span class=\"built_in\">require</span>(<span class=\"string\">'./webpack.common.config.js'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'html-webpack-plugin'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; CleanWebpackPlugin &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">'clean-webpack-plugin'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> UglifyJsPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'uglifyjs-webpack-plugin'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = merge(common, &#123;</span><br><span class=\"line\">  mode: <span class=\"string\">'production'</span>,</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>, <span class=\"comment\">// æ‰“åŒ…ä¹‹åçš„htmlæ–‡ä»¶åå­—</span></span><br><span class=\"line\">      <span class=\"comment\">// è¿™é‡Œæœ‰å°ä¼™ä¼´å¯èƒ½ä¼šç–‘æƒ‘ä¸ºä»€ä¹ˆä¸æ˜¯ '../public/index.html'</span></span><br><span class=\"line\">      <span class=\"comment\">// æˆ‘çš„ç†è§£æ˜¯æ— è®ºä¸è¦ç”¨çš„templateæ˜¯ä¸æ˜¯åœ¨ä¸€ä¸ªç›®å½•ï¼Œéƒ½æ˜¯ä»æ ¹è·¯å¾„å¼€å§‹æŸ¥æ‰¾</span></span><br><span class=\"line\">      template: <span class=\"string\">'public/index.html'</span>, <span class=\"comment\">// ä»¥æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„htmlä¸ºæ¨¡æ¿ç”Ÿæˆï¼Œä¸ç„¶æˆ‘ä»¬è¿˜è¦åˆ°æ‰“åŒ…ä¹‹åçš„htmlæ–‡ä»¶ä¸­å†™script</span></span><br><span class=\"line\">      inject: <span class=\"string\">'body'</span>,<span class=\"comment\">// åœ¨bodyæœ€åº•éƒ¨å¼•å…¥jsæ–‡ä»¶ï¼Œå¦‚æœæ˜¯headï¼Œå°±æ˜¯åœ¨headä¸­å¼•å…¥js</span></span><br><span class=\"line\">      minify: &#123; <span class=\"comment\">// å‹ç¼©htmlæ–‡ä»¶</span></span><br><span class=\"line\">        removeComments: <span class=\"literal\">true</span>, <span class=\"comment\">// å»é™¤æ³¨é‡Š</span></span><br><span class=\"line\">        collapseWhitespace: <span class=\"literal\">true</span>, <span class=\"comment\">// å»é™¤ç©ºæ ¼</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> CleanWebpackPlugin()</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  optimization: &#123;</span><br><span class=\"line\">    minimizer: [</span><br><span class=\"line\">      <span class=\"keyword\">new</span> UglifyJsPlugin(&#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.js(\\?.*)?$/i</span>,  <span class=\"comment\">//æµ‹è¯•åŒ¹é…æ–‡ä»¶,</span></span><br><span class=\"line\">        <span class=\"comment\">// include: /\\/includes/, //åŒ…å«å“ªäº›æ–‡ä»¶</span></span><br><span class=\"line\">        <span class=\"comment\">// excluce: /\\/excludes/, //ä¸åŒ…å«å“ªäº›æ–‡ä»¶</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//å…è®¸è¿‡æ»¤å“ªäº›å—åº”è¯¥è¢«uglifiedï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰å—éƒ½æ˜¯uglifiedï¼‰ã€‚ </span></span><br><span class=\"line\">        <span class=\"comment\">//è¿”å›trueä»¥uglifyå—ï¼Œå¦åˆ™è¿”å›falseã€‚</span></span><br><span class=\"line\">        chunkFilter: <span class=\"function\">(<span class=\"params\">chunk</span>) =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// `vendor` æ¨¡å—ä¸å‹ç¼©</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (chunk.name === <span class=\"string\">'vendor'</span>) &#123;</span><br><span class=\"line\">              <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">  </span><br><span class=\"line\">        cache: <span class=\"literal\">false</span>,   <span class=\"comment\">//æ˜¯å¦å¯ç”¨æ–‡ä»¶ç¼“å­˜ï¼Œé»˜è®¤ç¼“å­˜åœ¨node_modules/.cache/uglifyjs-webpack-plugin.ç›®å½•</span></span><br><span class=\"line\">        parallel: <span class=\"literal\">true</span>,  <span class=\"comment\">//ä½¿ç”¨å¤šè¿›ç¨‹å¹¶è¡Œè¿è¡Œæ¥æé«˜æ„å»ºé€Ÿåº¦</span></span><br><span class=\"line\">    ],</span><br><span class=\"line\">    splitChunks: &#123;</span><br><span class=\"line\">      <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">       * é»˜è®¤å€¼æ˜¯async</span></span><br><span class=\"line\"><span class=\"comment\">       * æ‹†åˆ†æ¨¡å—çš„èŒƒå›´ï¼Œå®ƒæœ‰ä¸‰ä¸ªå€¼asyncã€initialå’Œallã€‚</span></span><br><span class=\"line\"><span class=\"comment\">       * asyncè¡¨ç¤ºåªä»å¼‚æ­¥åŠ è½½å¾—æ¨¡å—ï¼ˆåŠ¨æ€åŠ è½½import()ï¼‰é‡Œé¢è¿›è¡Œæ‹†åˆ†</span></span><br><span class=\"line\"><span class=\"comment\">       * initialè¡¨ç¤ºåªä»å…¥å£æ¨¡å—è¿›è¡Œæ‹†åˆ†</span></span><br><span class=\"line\"><span class=\"comment\">       * allè¡¨ç¤ºä»¥ä¸Šä¸¤è€…éƒ½åŒ…æ‹¬</span></span><br><span class=\"line\"><span class=\"comment\">       */</span></span><br><span class=\"line\">      chunks: <span class=\"string\">'all'</span>,</span><br><span class=\"line\">      <span class=\"comment\">// minSize: 30000, // ç”Ÿæˆchunkçš„æœ€å°å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚åªæœ‰å¤§äºè¿™ä¸ªæ•°å­—æ‰å¯ä»¥æˆä¸€ä¸ªchunk </span></span><br><span class=\"line\">      <span class=\"comment\">// minRemainingSize: 0, // åªæœ‰å‰©ä¸‹ä¸€ä¸ªchunkçš„æ—¶å€™æ‰ä¼šç”Ÿæ•ˆï¼Œé»˜è®¤æ˜¯å’ŒminSizeä¸€æ ·çš„ï¼Œå¼€å‘çš„æ—¶å€™é»˜è®¤æ˜¯0</span></span><br><span class=\"line\">      <span class=\"comment\">// maxSize: 0, // å‘Šè¯‰webpackå°è¯•å°†å¤§äºmaxSizeå­—èŠ‚çš„å—æ‹†åˆ†ä¸ºè¾ƒå°çš„éƒ¨åˆ†ã€‚</span></span><br><span class=\"line\">      <span class=\"comment\">// minChunks: 1, // æ‹†åˆ†å‰å¿…é¡»å…±äº«æ¨¡å—çš„æœ€å°å—æ•°ã€‚</span></span><br><span class=\"line\">      <span class=\"comment\">// maxAsyncRequests: 6, // æŒ‰éœ€åŠ è½½æ—¶æœ€å¤§å¹¶è¡Œè¯·æ±‚æ•°ã€‚</span></span><br><span class=\"line\">      <span class=\"comment\">// maxInitialRequests: 4, // å…¥å£ç‚¹çš„æœ€å¤§å¹¶è¡Œè¯·æ±‚æ•°ã€‚å…¥å£æ–‡ä»¶</span></span><br><span class=\"line\">      <span class=\"comment\">// automaticNameDelimiter: '~', // é»˜è®¤æƒ…å†µä¸‹ï¼Œwebpackå°†ä½¿ç”¨å—çš„æ¥æºå’Œåç§°ç”Ÿæˆåç§°ï¼ˆä¾‹å¦‚vendors~main.jsï¼‰ã€‚æ­¤é€‰é¡¹ä½¿æ‚¨å¯ä»¥æŒ‡å®šç”¨äºç”Ÿæˆåç§°çš„å®šç•Œç¬¦ã€‚</span></span><br><span class=\"line\">      cacheGroups: &#123;</span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * å½“webpackå¤„ç†æ–‡ä»¶è·¯å¾„æ—¶ï¼Œå®ƒä»¬å§‹ç»ˆåŒ…å«/åœ¨Unixç³»ç»Ÿå’Œ\\Windowsä¸Šã€‚</span></span><br><span class=\"line\"><span class=\"comment\">         * è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ[\\\\/]åœ¨&#123;cacheGroup&#125;.testå­—æ®µä¸­ä½¿ç”¨in æ¥è¡¨ç¤ºè·¯å¾„åˆ†éš”ç¬¦çš„åŸå› ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">         * /æˆ–\\in &#123;cacheGroup&#125;.testä¼šåœ¨è·¨å¹³å°ä½¿ç”¨æ—¶å¼•èµ·é—®é¢˜ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        <span class=\"comment\">// defaultVendors: &#123;</span></span><br><span class=\"line\">        <span class=\"comment\">//   test: /[\\\\/]node_modules[\\\\/]/, // åˆ†å—ç›®æ ‡</span></span><br><span class=\"line\">        <span class=\"comment\">//   priority: -10 // æƒé‡</span></span><br><span class=\"line\">        <span class=\"comment\">// &#125;,</span></span><br><span class=\"line\">        <span class=\"comment\">// default: &#123;</span></span><br><span class=\"line\">        <span class=\"comment\">//   minChunks: 2, // æœ€å°å¼•ç”¨</span></span><br><span class=\"line\">        <span class=\"comment\">//   priority: -20, // æƒé‡</span></span><br><span class=\"line\">        <span class=\"comment\">//   // å¦‚æœå½“å‰å—åŒ…å«å·²ä»ä¸»æ†ç»‘åŒ…ä¸­æ‹†åˆ†å‡ºçš„æ¨¡å—ï¼Œåˆ™å°†é‡ç”¨è¯¥æ¨¡å—ï¼Œè€Œä¸æ˜¯ç”Ÿæˆæ–°çš„æ¨¡å—ã€‚è¿™å¯èƒ½ä¼šå½±å“å—çš„ç»“æœæ–‡ä»¶åã€‚</span></span><br><span class=\"line\">        <span class=\"comment\">//   reuseExistingChunk: true</span></span><br><span class=\"line\">        <span class=\"comment\">// &#125;,</span></span><br><span class=\"line\">        <span class=\"comment\">// ä¸Šè¿°çš„splitChunkså…¨æ˜¯webpack4æœªè®¾ç½®æƒ…å†µä¸‹çš„é»˜è®¤å€¼ï¼Œé™¤äº†chunksä»ã€asyncã€‘-&gt;ã€allã€‘å…¶ä»–éƒ½æ²¡æœ‰æ”¹</span></span><br><span class=\"line\">        <span class=\"comment\">// okï¼Œæˆ‘ä»¬ç°åœ¨åŠ å…¥æˆ‘ä»¬è‡ªå·±æƒ³è¦çš„ä»£ç åˆ†å‰²</span></span><br><span class=\"line\">        <span class=\"comment\">// å› ä¸ºæˆ‘å‡†å¤‡åŠ å…¥reactç­‰ä¸šåŠ¡åƒå˜ä¸‡åŒ–è€Œä¸ä¼šå˜çš„åº“</span></span><br><span class=\"line\">        common: &#123;</span><br><span class=\"line\">          test: <span class=\"string\">\"common\"</span>, <span class=\"comment\">// webpackæ‰«é¢çš„å…³é”®å­—</span></span><br><span class=\"line\">          name: <span class=\"string\">\"common\"</span>, <span class=\"comment\">// ç”Ÿæˆçš„åå­—</span></span><br><span class=\"line\">          enforce: <span class=\"literal\">true</span> <span class=\"comment\">// æ˜¯å¦ç¼“å­˜</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>ä¸æƒ³å†™diffå•¦ï¼Œç›´æ¥CVå•¦ã€‚ã€‚ã€‚</p>\n<p>ä¸ºä»€ä¹ˆæˆ‘éœ€è¦æŠŠreactæå–å‡ºæ¥ï¼Œå› ä¸ºå“ªé‡Œéƒ½éœ€è¦ç”¨ï¼Œè€Œä¸”ä»–å‡ ä¹ä¸å¯èƒ½ä¼šå˜ï¼Œæ‰€ä»¥æˆ‘ç‰¹åˆ«æå‡ºæ¥åšäº†ç¼“å­˜ï¼Œå…¶ä½™çš„è¿˜æ˜¯ä½¿ç”¨çš„é»˜è®¤é…ç½®ï¼ˆé™¤äº†chunkæ”¹ä¸ºäº†â€˜allâ€™ï¼‰ã€‚</p>\n<blockquote>\n<p>Tobias Koppers@Wsokraï¼šoptimization. splitchunks. chunks: althe only option you need for vendor and commons splitting in webpackBest combine it with html-webpack-plugin or equivalent html generation18120</p>\n</blockquote>\n<p>ä½œè€…éƒ½å‘æ¨ç‰¹è¯´äº†ï¼Œé‚£æˆ‘ä»¬ä¹Ÿå°±æ¥å—å§ï½å°±æ”¹ä¸ªallï¼Œç„¶åè¡¥ä¸€ä¸‹reactï½</p>\n<p>å†é‡æ–°æ‰“åŒ…ï¼Œä½ ä¼šå‘ç°index.bundle.jsï¼ˆä¸è¢«ç¼“å­˜ï¼‰çš„hashå€¼å˜äº†ï¼Œä½†æ˜¯common.bundle.jsï¼ˆèƒ½è¢«ç¼“å­˜ï¼‰çš„hashå€¼æ²¡å˜ã€‚</p>\n<h3 id=\"ä½¿ç”¨mini-css-extract-plugin\"><a href=\"#ä½¿ç”¨mini-css-extract-plugin\" class=\"headerlink\" title=\"ä½¿ç”¨mini-css-extract-plugin\"></a>ä½¿ç”¨mini-css-extract-plugin</h3><p>jséƒ½ç‹¬ç«‹ğŸ“¦ï¼Œé‚£æˆ‘cssä¹Ÿè¦ï¼</p>\n<p>å…¶å®å¦‚æœæŠŠCSSæ‰“åŒ…æˆä¸€ä¸ªæ–‡ä»¶ç„¶åè®©htmlå¼•ç”¨çš„è¯å¯ä»¥å‡å°htmlæ–‡ä»¶çš„å¤§å°ï¼Œæš—åˆäº†HTTP2çš„å¤šè·¯å¤ç”¨ï¼Œå¤šæ–‡ä»¶å°æ•°é‡ã€‚åŒ…æ‹¬ä¹‹å‰çš„splitChunksé‡Œé¢æˆ‘ä»¬é…ç½®çš„reactä¹Ÿæ˜¯ä¸ºäº†HTTP2ã€‚</p>\n<p>åœ¨å‘½ä»¤è¡Œè¾“å…¥ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save-dev mini-css-extract-plugin</span><br></pre></td></tr></table></figure>\n\n<p>ä¿®æ”¹ã€webpack.common.config.jsã€‘</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"addition\">+ const MiniCssExtractPlugin = require('mini-css-extract-plugin');</span></span><br><span class=\"line\"></span><br><span class=\"line\">//...</span><br><span class=\"line\">module:&#123;</span><br><span class=\"line\">    rules:[</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: /\\.css$/,</span><br><span class=\"line\">        use: [ </span><br><span class=\"line\"><span class=\"addition\">+          MiniCssExtractPlugin.loader,</span></span><br><span class=\"line\"><span class=\"deletion\">-          'style-loader',</span></span><br><span class=\"line\">           'css-loader', </span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"><span class=\"addition\">+plugins: [</span></span><br><span class=\"line\"><span class=\"addition\">+    new MiniCssExtractPlugin(&#123;</span></span><br><span class=\"line\"><span class=\"addition\">+      filename: 'css/[name].[hash].css',</span></span><br><span class=\"line\"><span class=\"addition\">+      chunkFilename: 'css/[id].[hash].css',</span></span><br><span class=\"line\"><span class=\"addition\">+    &#125;),</span></span><br><span class=\"line\">  ]</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"ä½¿ç”¨CSS-Module\"><a href=\"#ä½¿ç”¨CSS-Module\" class=\"headerlink\" title=\"ä½¿ç”¨CSS Module\"></a>ä½¿ç”¨CSS Module</h3><p>å…¶å®å¾ˆç®€å•ï¼Œåªéœ€è¦ä¿®æ”¹ä¸€ä¸‹é…ç½®ã€wbpack.common.config.jsã€‘</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">        test: /\\.css$/,</span><br><span class=\"line\">        use: [ </span><br><span class=\"line\">          MiniCssExtractPlugin.loader,</span><br><span class=\"line\"><span class=\"deletion\">-          'css-loader'</span></span><br><span class=\"line\"><span class=\"addition\">+          &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+            loader: 'css-loader',</span></span><br><span class=\"line\"><span class=\"addition\">+            options: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+              // importLoaders: 1,</span></span><br><span class=\"line\"><span class=\"addition\">+              modules: true,</span></span><br><span class=\"line\"><span class=\"addition\">+            &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+          &#125;,</span></span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;,</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ä½¿ç”¨PostCSS\"><a href=\"#ä½¿ç”¨PostCSS\" class=\"headerlink\" title=\"ä½¿ç”¨PostCSS\"></a>ä½¿ç”¨PostCSS</h3><blockquote>\n<p>postcss ä¸€ç§å¯¹cssç¼–è¯‘çš„å·¥å…·ï¼Œç±»ä¼¼babelå¯¹jsçš„å¤„ç†ï¼Œå¸¸è§çš„åŠŸèƒ½å¦‚ï¼š 1 . ä½¿ç”¨ä¸‹ä¸€ä»£cssè¯­æ³• 2 . è‡ªåŠ¨è¡¥å…¨æµè§ˆå™¨å‰ç¼€ 3 . è‡ªåŠ¨æŠŠpxä»£ä¸ºè½¬æ¢æˆrem 4 . css ä»£ç å‹ç¼©ç­‰ç­‰ postcss åªæ˜¯ä¸€ä¸ªå·¥å…·ï¼Œæœ¬èº«ä¸ä¼šå¯¹cssä¸€é¡¿æ“ä½œï¼Œå®ƒé€šè¿‡æ’ä»¶å®ç°åŠŸèƒ½ï¼Œautoprefixer å°±æ˜¯å…¶ä¸€ã€‚</p>\n</blockquote>\n<p>å®‰è£…postcss</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install postcss postcss-loader --save-dev</span><br></pre></td></tr></table></figure>\n\n<p>å®‰è£…postcssæŸä¸ªæ’ä»¶ï¼Œä»¥Autoprefixerä¸¾ä¾‹</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install postcss-aspect-ratio-mini postcss-write-svg postcss-px-to-viewport postcss-viewport-units postcss-flexbugs-fixes postcss-preset-env cssnano --save-dev</span><br></pre></td></tr></table></figure>\n\n<p>åœ¨æ ¹ç›®æ ‡æ–°å»ºæ–‡ä»¶ã€postcss.config.jsã€‘</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* eslint-disable import/no-extraneous-dependencies */</span></span><br><span class=\"line\"><span class=\"comment\">/* eslint-disable @typescript-eslint/no-var-requires */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> postcssAspectRatioMini = <span class=\"built_in\">require</span>(<span class=\"string\">'postcss-aspect-ratio-mini'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> postcssPxToViewport = <span class=\"built_in\">require</span>(<span class=\"string\">'postcss-px-to-viewport'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> postcssWriteSvg = <span class=\"built_in\">require</span>(<span class=\"string\">'postcss-write-svg'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> postcssViewportUnits = <span class=\"built_in\">require</span>(<span class=\"string\">'postcss-viewport-units'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> cssnano = <span class=\"built_in\">require</span>(<span class=\"string\">'cssnano'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> postcssPresetEnv = <span class=\"built_in\">require</span>(<span class=\"string\">'postcss-preset-env'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> postcssFlexbugsFixes = <span class=\"built_in\">require</span>(<span class=\"string\">'postcss-flexbugs-fixes'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    postcssFlexbugsFixes,</span><br><span class=\"line\">    <span class=\"comment\">// åœ¨è¿™ä¸ªä½ç½®åŠ å…¥æˆ‘ä»¬éœ€è¦é…ç½®çš„ä»£ç </span></span><br><span class=\"line\">    <span class=\"comment\">// åœ¨è¿™ä¸ªä½ç½®åŠ å…¥æˆ‘ä»¬éœ€è¦é…ç½®çš„ä»£ç </span></span><br><span class=\"line\">    <span class=\"comment\">// åœ¨è¿™ä¸ªä½ç½®åŠ å…¥æˆ‘ä»¬éœ€è¦é…ç½®çš„ä»£ç </span></span><br><span class=\"line\">    postcssAspectRatioMini(&#123;&#125;),</span><br><span class=\"line\">    postcssPxToViewport(&#123;</span><br><span class=\"line\">      viewportWidth: <span class=\"number\">750</span>, <span class=\"comment\">// åŸºå‡†å®½åº¦ï¼ˆä¸€èˆ¬çš„è®¾è®¡éƒ½æ˜¯è¿™ä¸ªåŸºå‡†</span></span><br><span class=\"line\">      viewportHeight: <span class=\"number\">1334</span>, <span class=\"comment\">// åŸºå‡†é«˜åº¦ï¼ˆä¸€èˆ¬çš„è®¾è®¡éƒ½æ˜¯è¿™ä¸ªåŸºå‡†</span></span><br><span class=\"line\">      unitPrecision: <span class=\"number\">3</span>, <span class=\"comment\">// (Number) The decimal numbers to allow the REM units to grow to.</span></span><br><span class=\"line\">      viewportUnit: <span class=\"string\">'vw'</span>, <span class=\"comment\">// (String) å•ä½</span></span><br><span class=\"line\">      selectorBlackList: [<span class=\"string\">'.list-ignore'</span>, /notTransform/], <span class=\"comment\">// å¸¦ä¸Šè¿™ä¸ªå•è¯çš„å°±ä¸ä¼šfixä¸ºvwå•ä½</span></span><br><span class=\"line\">      minPixelValue: <span class=\"number\">1</span>, <span class=\"comment\">// (Number) æœ€å°åƒç´ </span></span><br><span class=\"line\">      mediaQuery: <span class=\"literal\">false</span>, <span class=\"comment\">// (Boolean) å…è®¸åœ¨åª’ä½“æŸ¥è¯¢ä¸­è½¬æ¢pxã€‚</span></span><br><span class=\"line\">      exclude: <span class=\"regexp\">/(\\/|\\\\)(node_modules)(\\/|\\\\)/</span>,</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    postcssWriteSvg(&#123;</span><br><span class=\"line\">      utf8: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    postcssPresetEnv(&#123;&#125;),</span><br><span class=\"line\">    postcssViewportUnits(&#123;</span><br><span class=\"line\">      filterRule: <span class=\"function\"><span class=\"params\">rule</span> =&gt;</span> rule.selector.includes(<span class=\"string\">'::after'</span>)</span><br><span class=\"line\">        &amp;&amp; rule.selector.includes(<span class=\"string\">'::before'</span>)</span><br><span class=\"line\">        &amp;&amp; rule.selector.includes(<span class=\"string\">':after'</span>)</span><br><span class=\"line\">        &amp;&amp; rule.selector.includes(<span class=\"string\">':before'</span>)</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    cssnano(&#123;</span><br><span class=\"line\">      <span class=\"string\">\"cssnano-preset-advanced\"</span>: &#123;</span><br><span class=\"line\">        zindex: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        autoprefixer: <span class=\"literal\">false</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>ä¿®æ”¹ã€webpack.common.config.jsã€‘</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">        test: /\\.css$/,</span><br><span class=\"line\">        use: [ </span><br><span class=\"line\">          'style-loader',</span><br><span class=\"line\">          'css-loader', </span><br><span class=\"line\"><span class=\"addition\">+          'postcss-loader'</span></span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: /\\.less$/,</span><br><span class=\"line\">        use: [ </span><br><span class=\"line\">          'style-loader',</span><br><span class=\"line\">          'css-loader', </span><br><span class=\"line\">          'less-loader',</span><br><span class=\"line\"><span class=\"addition\">+          'postcss-loader'</span></span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br></pre></td></tr></table></figure>\n\n<p>ç„¶åï¼Œä¿®æ”¹æˆ‘ä»¬çš„cssæ–‡ä»¶ï¼Œçœ‹çœ‹æˆ‘ä»¬å†™çš„å•ä½ä¸ºpxçš„æœ‰æ²¡æœ‰è¢«æ”¹ä¸ºvwçš„è‡ªé€‚åº”å•ä½ã€‚</p>\n<p>é¡ºä¾¿è¯•ä¸€ä¸‹å¸¦æœ‰ã€notTransformã€‘çš„æ˜¯ä¸æ˜¯è¿˜æ˜¯pxä½œä¸ºå•ä½ã€‚</p>\n<h2 id=\"ç»“æŸ\"><a href=\"#ç»“æŸ\" class=\"headerlink\" title=\"ç»“æŸ\"></a>ç»“æŸ</h2><p>åˆ°æ­¤ï¼Œæˆ‘ä»¬çš„webpacké…ç½®ï¼Œå°±ç®—æ˜¯å…¥é—¨äº†ï¼Œå¯¹äºwebpackçš„é…ç½®æˆ‘ä»¬è¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ã€‚å¤§å®¶åŠ æ²¹ï¼</p>\n<p>å¦‚æœæœ‰å“ªé‡Œå†™çš„ä¸å¥½æˆ–è€…å†™é”™äº†ï¼Œæ¬¢è¿å¤§å®¶åœ¨è¯„è®ºåŒºè®¨è®ºã€‚</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"ä»é›¶é…ç½®ä½ çš„Webpack\"><a href=\"#ä»é›¶é…ç½®ä½ çš„Webpack\" class=\"headerlink\" title=\"ä»é›¶é…ç½®ä½ çš„Webpack\"></a>ä»é›¶é…ç½®ä½ çš„Webpack</h1><h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><p>ä¸Šç¯‡æ–‡ç« ç®€å•çš„ä»‹ç»äº†ä¸€ä¸‹ï¼Œå‰ç«¯è¿›é˜¶ä¹‹è„šæ‰‹æ¶çš„æ­å»ºã€‚å…¶å®æˆ‘ä¸ªäººè®¤ä¸ºé‡è¦çš„è¿˜æ˜¯Webpackçš„é…ç½®å‡ºæ¥çš„templateï¼Œè‡³äºè„šæ‰‹æ¶çš„äº¤äº’ä½“éªŒå¯ä»¥åæœŸå»ä¼˜åŒ–ï¼Œä¹Ÿå¯ä»¥æ›´åŠ çš„ä¸ªæ€§åŒ–ã€‚ä½†æ˜¯æˆ‘ä»¬çš„æ ¸å¿ƒè¿˜æ˜¯æ”¾åœ¨Webpackç­‰ä¸€ç³»åˆ—çš„é…ç½®ä¸Šã€‚</p>\n<p>è¿™ç¯‡æ–‡ç« çš„ç›®çš„</p>\n<ul>\n<li>å¯ä»¥ç»™è‡ªå·±ä¸€ä¸ªå›é¡¾çš„åœ°æ–¹</li>\n<li>åŠ å¼ºå¯¹Webpackçš„ç†è§£ï¼Œæ¯ä¸ªçŸ¥è¯†ç‚¹éƒ½ä¼šè®¤è®¤çœŸçœŸçš„å½»æŸ¥ï¼å°½é‡è®©æ¯ä¸€æ­¥éƒ½æ˜¯éå¸¸æ¸…æ™°æ˜äº†çš„ï¼</li>\n<li>å¦‚æœå¯ä»¥å¸®åŠ©åˆ°å¤§å®¶é‚£æ˜¯æ›´å¥½ä¸è¿‡äº†</li>\n</ul>\n<p>å¥½äº†ï¼Œæ”¶ï¼è¯ä¸å¤šè¯´å¼€å§‹ï¼</p>\n<h2 id=\"å‰æ\"><a href=\"#å‰æ\" class=\"headerlink\" title=\"å‰æ\"></a>å‰æ</h2><p>ç›¸ä¿¡æ¥åˆ°è¿™é‡Œçš„å°ä¼™ä¼´ï¼Œéƒ½æ˜¯æœ‰ä¸€äº›äº›å‰ç«¯çš„ç»éªŒäº†ï¼Œè‡³äºä»€ä¹ˆnodeå®‰è£…ç¯å¢ƒå˜é‡è¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚æœ¬äººä½¿ç”¨çš„æ˜¯mac osï¼Œå¦‚æœæ˜¯Windowsçš„å¹¶ä¸”ç¢°åˆ°é—®é¢˜çš„è¯ï¼Œå¯ä»¥ç•™è¨€ï¼Œæˆ–è€…ç›´æ¥Googleã€‚</p>\n<h2 id=\"å¼€å§‹\"><a href=\"#å¼€å§‹\" class=\"headerlink\" title=\"å¼€å§‹\"></a>å¼€å§‹</h2><h3 id=\"å»ºç«‹ä¸€ä¸ªç©ºçš„æ–‡ä»¶å¤¹ğŸ“\"><a href=\"#å»ºç«‹ä¸€ä¸ªç©ºçš„æ–‡ä»¶å¤¹ğŸ“\" class=\"headerlink\" title=\"å»ºç«‹ä¸€ä¸ªç©ºçš„æ–‡ä»¶å¤¹ğŸ“\"></a>å»ºç«‹ä¸€ä¸ªç©ºçš„æ–‡ä»¶å¤¹ğŸ“</h3><p>æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œåä¸ºã€webpackInitã€‘</p>\n<p>å¹¶ä¸”ä½¿ç”¨ä½ çš„ç¼–è¾‘å™¨æ‰“å¼€ä»–ï¼Œç„¶åæ‰“å¼€å‘½ä»¤è¡Œæ‰§è¡Œï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm init -y</span><br></pre></td></tr></table></figure>\n\n<p>è¿™ä¸ªå‘½ä»¤æ˜¯nodeå¸®ä½ åˆå§‹åŒ–ä¸€ä¸ªé¡¹ç›®ç”¨çš„ï¼Œå¸®ä½ æ–°å»ºä¸€ä¸ª<code>package.json</code>ã€‚</p>\n<p>è‡³äº<code>-y</code>æ˜¯ç”¨äºé»˜è®¤éƒ½ä»¥<strong>yes</strong>ç»§ç»­æ‰§è¡Œã€‚å¦‚æœæƒ³äº†è§£ä¸€ä¸‹é‡Œé¢åˆ°åº•æœ‰ä»€ä¹ˆçš„åŒå­¦å¯ä»¥ä¸ç”¨<em>-y</em>ç»§ç»­è·‘ä¸€éã€‚å…¶å®é‡Œé¢çš„ä¸œè¥¿åæœŸéƒ½å¯ä»¥è‡ªå·±ä¿®æ”¹<code>package.json</code>ã€‚æ‰€ä»¥ä¸éœ€è¦å¤ªåœ¨æ„ã€‚</p>\n<h3 id=\"å®‰è£…WebpackğŸ”§\"><a href=\"#å®‰è£…WebpackğŸ”§\" class=\"headerlink\" title=\"å®‰è£…WebpackğŸ”§\"></a>å®‰è£…WebpackğŸ”§</h3><p>ç°åœ¨æ˜¯åŒ—äº¬æ—¶é—´ï¼š2020/06/07 06:42:49ã€‚</p>\n<p>Webpack5æœ‰Betaç‰ˆï¼Œè¿™é‡Œå°±ä¸è€ƒè™‘äº†ï¼Œåç»­ä¸Šæ­£å¼ç‰ˆçš„è¯æˆ‘åº”è¯¥ä¼šå‡ºæ–°çš„æ–‡ç« ä»‹ç»ã€‚</p>\n<p>å› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ <code>webpack 4+</code> ç‰ˆæœ¬ï¼Œè¿˜éœ€è¦å®‰è£… <code>webpack-cli</code> ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save-dev webpack webpack-cli</span><br></pre></td></tr></table></figure>\n\n<p>å› ä¸ºWebpackä¸»è¦æ˜¯ç¼–è¯‘æ—¶ä½¿ç”¨æ‰€ä»¥æ”¾åˆ°â€œdevDependenciesâ€ã€‚</p>\n<p>ç¡®è®¤ä¸€ä¸‹ç°åœ¨çš„ç›®å½•ç»“æ„ï¼Œä»¥é˜²æœ‰åŒå­¦æ‰é˜Ÿï¼</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">webpackInit</span><br><span class=\"line\">  |- node_modules</span><br><span class=\"line\">  |- package-lock.json</span><br><span class=\"line\">  |- package.json</span><br></pre></td></tr></table></figure>\n\n<p>è¿™é‡Œè¯´ä¸‹é¢˜å¤–è¯ã€‚</p>\n<h5 id=\"package-jsonå’Œpackage-lock-jsonçš„åŒºåˆ«\"><a href=\"#package-jsonå’Œpackage-lock-jsonçš„åŒºåˆ«\" class=\"headerlink\" title=\"package.jsonå’Œpackage-lock.jsonçš„åŒºåˆ«\"></a>package.jsonå’Œpackage-lock.jsonçš„åŒºåˆ«</h5><p>package.json æ–‡ä»¶åªèƒ½é”å®šå¤§ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯ç‰ˆæœ¬å·çš„ç¬¬ä¸€ä½ï¼Œå¹¶ä¸èƒ½é”å®šåé¢çš„å°ç‰ˆæœ¬ï¼Œ<code>npm install</code> éƒ½æ˜¯æ‹‰å–çš„è¯¥å¤§ç‰ˆæœ¬ä¸‹çš„æœ€æ–°çš„ç‰ˆæœ¬ï¼Œä¸ºäº†ç¨³å®šæ€§è€ƒè™‘æˆ‘ä»¬å‡ ä¹æ˜¯ä¸æ•¢éšæ„å‡çº§ä¾èµ–åŒ…çš„ï¼Œè¿™å°†å¯¼è‡´å¤šå‡ºæ¥å¾ˆå¤šå·¥ä½œé‡ï¼Œæµ‹è¯•/é€‚é…ç­‰ï¼Œæ‰€ä»¥ package-lock.json æ–‡ä»¶å‡ºæ¥äº†ï¼Œå½“ä½ æ¯æ¬¡å®‰è£…ä¸€ä¸ªä¾èµ–çš„æ—¶å€™å°±é”å®šåœ¨ä½ å®‰è£…çš„è¿™ä¸ªç‰ˆæœ¬ã€‚</p>\n<p>é‚£å¦‚æœæˆ‘ä»¬å®‰è£…æ—¶çš„åŒ…æœ‰bugï¼Œåé¢éœ€è¦æ›´æ–°æ€ä¹ˆåŠï¼Ÿ</p>\n<p>åœ¨ä»¥å‰å¯èƒ½å°±æ˜¯ç›´æ¥æ”¹ package.json é‡Œé¢çš„ç‰ˆæœ¬ï¼Œç„¶åå† <code>npm install</code> äº†ï¼Œä½†æ˜¯ 5 ç‰ˆæœ¬åå°±ä¸æ”¯æŒè¿™æ ·åšäº†ï¼Œå› ä¸ºç‰ˆæœ¬å·²ç»é”å®šåœ¨ package-lock.json é‡Œäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½ <code>npm install xxx@x.x.x</code> è¿™æ ·å»æ›´æ–°æˆ‘ä»¬çš„ä¾èµ–ï¼Œç„¶å package-lock.json ä¹Ÿèƒ½éšä¹‹æ›´æ–°ã€‚</p>\n<h3 id=\"æ–°å»ºé…ç½®æ–‡ä»¶ğŸ“ƒ\"><a href=\"#æ–°å»ºé…ç½®æ–‡ä»¶ğŸ“ƒ\" class=\"headerlink\" title=\"æ–°å»ºé…ç½®æ–‡ä»¶ğŸ“ƒ\"></a>æ–°å»ºé…ç½®æ–‡ä»¶ğŸ“ƒ</h3><p>æˆ‘ä»¬åœ¨æ ¹ç›®å½•æ–°å»ºæ–‡ä»¶å¤¹ã€configã€‘ç”¨äºå­˜å‚¨ä¸€äº›ç›¸å…³çš„é…ç½®æ–‡ä»¶ï¼Œç„¶ååœ¨ã€configã€‘é‡Œé¢æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ã€webpackã€‘è¡¨ç¤ºï¼Œä¸“é—¨ç”¨äºå­˜å‚¨webpackçš„é…ç½®æ–‡ä»¶ã€‚ç„¶ååœ¨ã€webpackã€‘è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹é¢æ–°å»ºæ–‡ä»¶ã€webpack.common.config.jsã€‘</p>\n<p>å¹¶æ•²å…¥ä»¥ä¸‹ä»£ç </p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  <span class=\"comment\">// é…ç½®å…¥å£æ–‡ä»¶</span></span><br><span class=\"line\">  entry: &#123;</span><br><span class=\"line\">    app: <span class=\"string\">'./src/index.js'</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">// æ‰“åŒ…ğŸ“¦ä¹‹åçš„å‡ºå£</span></span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœä¸åŠ å“ˆå¸Œå€¼ï¼Œæµè§ˆå™¨ä¼šæœ‰ç¼“å­˜ï¼Œå¯èƒ½ä½ éƒ¨ç½²äº†ï¼Œä½†æ˜¯ç”¨æˆ·çœ‹åˆ°çš„è¿˜æ˜¯è€é¡µé¢</span></span><br><span class=\"line\">    <span class=\"comment\">// 8æ˜¯hashçš„é•¿åº¦ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œwebpackä¼šè®¾ç½®é»˜è®¤å€¼ä¸º20ã€‚</span></span><br><span class=\"line\">    filename: <span class=\"string\">'js/[name].[chunkhash:8].bundle.js'</span>,</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Node.js ä¸­ï¼Œ__dirname æ€»æ˜¯æŒ‡å‘è¢«æ‰§è¡Œ js æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œ</span></span><br><span class=\"line\"><span class=\"comment\">     * æ‰€ä»¥å½“ä½ åœ¨ /d1/d2/myscript.js æ–‡ä»¶ä¸­å†™äº† __dirnameï¼Œ å®ƒçš„å€¼å°±æ˜¯ /d1/d2 ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">     * path.resolve</span></span><br><span class=\"line\"><span class=\"comment\">     * 1.path.resolve()æ–¹æ³•å¯ä»¥å°†è·¯å¾„æˆ–è€…è·¯å¾„ç‰‡æ®µè§£ææˆç»å¯¹è·¯å¾„</span></span><br><span class=\"line\"><span class=\"comment\">     * 2.ä¼ å…¥è·¯å¾„ä»å³è‡³å·¦è§£æï¼Œé‡åˆ°ç¬¬ä¸€ä¸ªç»å¯¹è·¯å¾„æ˜¯å®Œæˆè§£æï¼Œä¾‹å¦‚path.resolve('/foo', '/bar', 'baz') å°†è¿”å› /bar/baz</span></span><br><span class=\"line\"><span class=\"comment\">     * 3.å¦‚æœä¼ å…¥çš„ç»å¯¹è·¯å¾„ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå½“å‰ç›®å½•å°†è¢«ä½¿ç”¨</span></span><br><span class=\"line\"><span class=\"comment\">     * 4.å½“ä¼ å…¥çš„å‚æ•°æ²¡æœ‰/æ—¶ï¼Œå°†è¢«ä¼ å…¥è§£æåˆ°å½“å‰æ ¹ç›®å½•</span></span><br><span class=\"line\"><span class=\"comment\">     * 5.é›¶é•¿åº¦çš„è·¯å¾„å°†è¢«å¿½ç•¥</span></span><br><span class=\"line\"><span class=\"comment\">     * 6.å¦‚æœæ²¡æœ‰ä¼ å…¥å‚æ•°ï¼Œå°†è¿”å›å½“å‰æ ¹ç›®å½•</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * _dirnameè¡¨ç¤ºç»å¯¹è·¯å¾„</span></span><br><span class=\"line\"><span class=\"comment\">     * æˆ‘ä»¬ç¢°åˆ°çš„./xxå°±æ˜¯ç›¸å¯¹è·¯å¾„</span></span><br><span class=\"line\"><span class=\"comment\">     * 1.åªä¼ å…¥__dirnameä¹Ÿå¯ä»¥è‡ªåŠ¨è°ƒç”¨path.resolveæ–¹æ³•</span></span><br><span class=\"line\"><span class=\"comment\">     * 2.å¯ä»¥æ‹¼æ¥è·¯å¾„å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ä¸è°ƒç”¨path.resolve()æ–¹æ³•æ‹¼æ¥å¤±è´¥</span></span><br><span class=\"line\"><span class=\"comment\">     * 3.__dirnameä»£è¡¨çš„æ˜¯å½“å‰æ–‡ä»¶ï¼ˆa.jsï¼‰çš„ç»å¯¹è·¯å¾„</span></span><br><span class=\"line\"><span class=\"comment\">     * 4.ä»å³è‡³å·¦è§£æï¼Œé‡åˆ°äº†ç»å¯¹è·¯å¾„/srcï¼Œå› æ­¤ç›´æ¥è¿”</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    path: path.resolve(__dirname, <span class=\"string\">'../../dist'</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>webpack é…ç½®æ˜¯æ ‡å‡†çš„ Node.jsçš„CommonJS æ¨¡å—ï¼Œå®ƒé€šè¿‡requireæ¥å¼•å…¥å…¶ä»–æ¨¡å—ï¼Œé€šè¿‡module.exportså¯¼å‡ºæ¨¡å—ï¼Œç”± webpack æ ¹æ®å¯¹è±¡å®šä¹‰çš„å±æ€§è¿›è¡Œè§£æã€‚</p>\n</blockquote>\n<p>åœ¨æ ¹ç›®å½•æ–°å»ºã€srcã€‘æ–‡ä»¶å¤¹ğŸ“</p>\n<p>åœ¨ã€srcã€‘æ–‡ä»¶å¤¹ä¸‹æ–°å»ºæ–‡ä»¶index.js</p>\n<p>okğŸ‘Œï¼Œç¡®è®¤ä¸€ä¸‹ç›®å½•ç»“æ„</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">webpackInit</span><br><span class=\"line\"><span class=\"addition\">+ |- config</span></span><br><span class=\"line\"><span class=\"addition\">+ \t|- webpack</span></span><br><span class=\"line\"><span class=\"addition\">+     |- webpack.common.config.js</span></span><br><span class=\"line\">  |- node_modules</span><br><span class=\"line\"><span class=\"addition\">+ |- src</span></span><br><span class=\"line\"><span class=\"addition\">+     |- index.js</span></span><br><span class=\"line\">  |- package.json</span><br><span class=\"line\">  |- package-lock.json</span><br></pre></td></tr></table></figure>\n\n<p>é‚£æˆ‘ä»¬æ€ä¹ˆæ‰“åŒ…å‘¢ï¼Ÿåœ¨ <code>package.json</code> ä¸­é…ç½®å¦‚ä¸‹å±æ€§ï¼š</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\"scripts\": &#123;</span><br><span class=\"line\"><span class=\"deletion\">- \"test\": \"echo \\\"Error: no test specified\\\" &amp;&amp; exit 1\",</span></span><br><span class=\"line\"><span class=\"addition\">+ \"start\": \"webpack --config ./config/webpack/webpack.common.config.js\"</span></span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n\n<p>å¥½äº†ï¼Œæˆ‘ä»¬è¯•è¯•æ€ä¹ˆæ‰“åŒ…å§ï¼Œè™½ç„¶ä½ çš„ <code>index.js</code> ä¸­ä»€ä¹ˆä»£ç ä¹Ÿæ²¡æœ‰ã€‚<br>åœ¨æ§åˆ¶å°ä¸­è¾“å…¥ä»¥ä¸‹ä»£ç ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run start</span><br></pre></td></tr></table></figure>\n\n<p>npm run xxxx ä¼šå»æ‰§è¡Œå½“å‰ç›®å½•ä¸‹package.jsoné‡Œé¢çš„scriptåŒåè„šæœ¬</p>\n<p>æˆ‘ä»¬çš„ã€npm run startã€‘ç›¸å½“äºç›´æ¥æ‰§è¡Œäº†æˆ‘ä»¬å†™åœ¨ã€startã€‘é‡Œé¢çš„ä»£ç ã€‚</p>\n<p>æ‰§è¡Œä¹‹åï¼Œä½ ä¼šå‘ç°æ ¹ç›®å½•å¤šå‡ºäº†ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼š <code>dist/js</code> ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªjsæ–‡ä»¶ï¼š <code>bundle.js</code> ï¼Œé‚£ä¹ˆè‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸç¼–è¯‘æ‰“åŒ…äº†ä¸€ä¸ªjsæ–‡ä»¶ï¼Œå³å…¥å£æ–‡ä»¶ï¼š <code>index.js</code> ã€‚</p>\n<h3 id=\"å®‰è£…React\"><a href=\"#å®‰è£…React\" class=\"headerlink\" title=\"å®‰è£…React\"></a>å®‰è£…React</h3><p>åœ¨æ§åˆ¶å°è¾“å…¥ä»¥ä¸‹ä»£ç ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save react react-dom</span><br></pre></td></tr></table></figure>\n\n<p>â€“saveå°±æ˜¯è¿è¡Œæ—¶ä¼šç”¨åˆ°çš„ä»£ç </p>\n<p>å…·ä½“å’Œâ€“dev-saveçš„åŒºåˆ«å¯ä»¥è‡ªå·±Googleä¸€ä¸‹</p>\n<p>åœ¨ã€src/index.jsã€‘é‡Œé¢åŠ å…¥ä»¥ä¸‹ä»£ç </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> ReactDOM <span class=\"keyword\">from</span> <span class=\"string\">'react-dom'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> App = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> (</span><br><span class=\"line\">  &lt;&gt;</span><br><span class=\"line\">    Hello Worldï¼</span><br><span class=\"line\">  &lt;<span class=\"regexp\">/&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">)</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">ReactDOM.render(&lt;App /</span>&gt;, <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'root'</span>));</span><br></pre></td></tr></table></figure>\n\n<p>åœ¨æ ¹ç›®å½•åŠ å…¥æ–‡ä»¶å¤¹ã€publicã€‘ï¼Œç„¶ååœ¨ã€publicã€‘é‡Œé¢åŠ å…¥ã€index.htmlã€‘</p>\n<p>ç›®å½•å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">webpackInit</span><br><span class=\"line\"><span class=\"addition\">+ |- public</span></span><br><span class=\"line\"><span class=\"addition\">+ \t|- index.html</span></span><br><span class=\"line\">  |- config</span><br><span class=\"line\">  \t|- webpack</span><br><span class=\"line\">      |- webpack.common.config.js</span><br><span class=\"line\">  |- node_modules</span><br><span class=\"line\">  |- src</span><br><span class=\"line\">      |- index.js</span><br><span class=\"line\">  |- package.json</span><br><span class=\"line\">  |- package-lock.json</span><br></pre></td></tr></table></figure>\n\n<p>ç„¶ååœ¨ã€index.htmlã€‘åŠ å…¥ä»¥ä¸‹ä»£ç ï¼š</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"UTF-8\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">\"X-UA-Compatible\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">\"viewport\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"initial-scale=1.0, user-scalable=no, width=device-width\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>ä»é›¶é…ç½®Webpack<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"root\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>OK</p>\n<p>ä¸‡äº‹ä¿±å¤‡ï¼Œæˆ‘ä»¬è¿è¡Œï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run start</span><br></pre></td></tr></table></figure>\n\n<p>æ‰“åŒ…å¤±è´¥äº†ã€‚ã€‚ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>\n<h3 id=\"ä½¿ç”¨babel\"><a href=\"#ä½¿ç”¨babel\" class=\"headerlink\" title=\"ä½¿ç”¨babel\"></a>ä½¿ç”¨babel</h3><p>ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸Šé¢å†™jsxä¼šæ‰“åŒ…ä¸äº†å‘¢ï¼Œå› ä¸ºwebpackæ ¹æœ¬è¯†åˆ«ä¸äº†jsxè¯­æ³•ï¼Œé‚£æ€ä¹ˆåŠï¼Ÿä½¿ç”¨loaderå¯¹æ–‡ä»¶è¿›è¡Œé¢„å¤„ç†ã€‚<br>å…¶ä¸­ï¼Œbabel-loaderï¼Œå°±æ˜¯è¿™æ ·ä¸€ä¸ªé¢„å¤„ç†æ’ä»¶ï¼Œå®ƒåŠ è½½ ES2015+ ä»£ç ï¼Œç„¶åä½¿ç”¨ Babel è½¬è¯‘ä¸º ES5ã€‚é‚£å¼€å§‹é…ç½®å®ƒå§ï¼</p>\n<p>é¦–å…ˆå®‰è£…babelç›¸å…³çš„æ¨¡å—ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save-dev babel-loader @babel&#x2F;preset-react @babel&#x2F;preset-env @babel&#x2F;core babel-plugin-import</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>babel-loaderï¼š</strong>ä½¿ç”¨Babelå’Œwebpackæ¥è½¬è¯‘JavaScriptæ–‡ä»¶ã€‚</li>\n<li><strong>@babel/preset-reactï¼š</strong>è½¬è¯‘reactçš„JSX</li>\n<li><strong>@babel/preset-envï¼š</strong>è½¬è¯‘ES2015+çš„è¯­æ³•</li>\n<li><strong>@babel/coreï¼š</strong>babelçš„æ ¸å¿ƒæ¨¡å—</li>\n<li><strong>babel-plugin-import</strong>ï¼šæŒ‰éœ€åŠ è½½æ‰€éœ€è¦çš„babelè§£æ</li>\n</ul>\n<p>ç†è®ºä¸Šæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ <code>webpack.common.config.js</code> ä¸­é…ç½®â€optionsâ€ï¼Œä½†æœ€å¥½åœ¨å½“å‰æ ¹ç›®å½•ï¼Œæ³¨æ„ï¼Œä¸€å®šè¦æ˜¯æ ¹ç›®å½•ï¼ï¼ï¼ æ–°å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ <code>.babelrc</code> é…ç½®ç›¸å…³çš„â€presetsâ€ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"presets\"</span>: [</span><br><span class=\"line\">    [</span><br><span class=\"line\">      <span class=\"string\">\"@babel/preset-env\"</span>,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"string\">\"targets\"</span>: &#123;</span><br><span class=\"line\">          <span class=\"comment\">// å¤§äºç›¸å…³æµè§ˆå™¨ç‰ˆæœ¬æ— éœ€ç”¨åˆ° preset-env</span></span><br><span class=\"line\">          <span class=\"string\">\"edge\"</span>: <span class=\"number\">17</span>,</span><br><span class=\"line\">          <span class=\"string\">\"firefox\"</span>: <span class=\"number\">60</span>,</span><br><span class=\"line\">          <span class=\"string\">\"chrome\"</span>: <span class=\"number\">67</span>,</span><br><span class=\"line\">          <span class=\"string\">\"safari\"</span>: <span class=\"number\">11</span>,</span><br><span class=\"line\">          <span class=\"comment\">// å…¼å®¹åˆ°android4 ios6</span></span><br><span class=\"line\">          <span class=\"string\">\"browsers\"</span>: [<span class=\"string\">\"Android &gt;= 4.0\"</span>, <span class=\"string\">\"ios &gt;= 6\"</span>]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"string\">\"@babel/preset-react\"</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"string\">\"plugins\"</span>: [</span><br><span class=\"line\">    [<span class=\"string\">\"import\"</span>, &#123; <span class=\"string\">\"libraryName\"</span>: <span class=\"string\">\"antd-mobile\"</span>, <span class=\"string\">\"style\"</span>: <span class=\"string\">\"css\"</span> &#125;] <span class=\"comment\">// `style: true` ä¼šåŠ è½½ less æ–‡ä»¶</span></span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>è¿™é‡Œæœ‰å…³<a href=\"https://www.babeljs.cn/docs/babel-preset-env\" target=\"_blank\" rel=\"noopener\">bebelçš„é…ç½®</a>å¯ä¸Šå®˜ç½‘æŸ¥è¯¢æ–‡æ¡£ã€‚</p>\n<p>å†ä¿®æ”¹ <code>webpack.common.config.js</code> ï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  <span class=\"comment\">// é…ç½®å…¥å£æ–‡ä»¶</span></span><br><span class=\"line\">  entry: &#123;</span><br><span class=\"line\">    app: <span class=\"string\">'./src/index.js'</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">// æ‰“åŒ…ğŸ“¦ä¹‹åçš„å‡ºå£</span></span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    <span class=\"comment\">// å¦‚æœä¸åŠ å“ˆå¸Œå€¼ï¼Œæµè§ˆå™¨ä¼šæœ‰ç¼“å­˜ï¼Œå¯èƒ½ä½ éƒ¨ç½²äº†ï¼Œä½†æ˜¯ç”¨æˆ·çœ‹åˆ°çš„è¿˜æ˜¯è€é¡µé¢</span></span><br><span class=\"line\">    <span class=\"comment\">// 8æ˜¯hashçš„é•¿åº¦ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œwebpackä¼šè®¾ç½®é»˜è®¤å€¼ä¸º20ã€‚</span></span><br><span class=\"line\">    filename: <span class=\"string\">'js/[name].[chunkhash:8].bundle.js'</span>,</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Node.js ä¸­ï¼Œ__dirname æ€»æ˜¯æŒ‡å‘è¢«æ‰§è¡Œ js æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œ</span></span><br><span class=\"line\"><span class=\"comment\">     * æ‰€ä»¥å½“ä½ åœ¨ /d1/d2/myscript.js æ–‡ä»¶ä¸­å†™äº† __dirnameï¼Œ å®ƒçš„å€¼å°±æ˜¯ /d1/d2 ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">     * path.resolve</span></span><br><span class=\"line\"><span class=\"comment\">     * 1.path.resolve()æ–¹æ³•å¯ä»¥å°†è·¯å¾„æˆ–è€…è·¯å¾„ç‰‡æ®µè§£ææˆç»å¯¹è·¯å¾„</span></span><br><span class=\"line\"><span class=\"comment\">     * 2.ä¼ å…¥è·¯å¾„ä»å³è‡³å·¦è§£æï¼Œé‡åˆ°ç¬¬ä¸€ä¸ªç»å¯¹è·¯å¾„æ˜¯å®Œæˆè§£æï¼Œä¾‹å¦‚path.resolve('/foo', '/bar', 'baz') å°†è¿”å› /bar/baz</span></span><br><span class=\"line\"><span class=\"comment\">     * 3.å¦‚æœä¼ å…¥çš„ç»å¯¹è·¯å¾„ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå½“å‰ç›®å½•å°†è¢«ä½¿ç”¨</span></span><br><span class=\"line\"><span class=\"comment\">     * 4.å½“ä¼ å…¥çš„å‚æ•°æ²¡æœ‰/æ—¶ï¼Œå°†è¢«ä¼ å…¥è§£æåˆ°å½“å‰æ ¹ç›®å½•</span></span><br><span class=\"line\"><span class=\"comment\">     * 5.é›¶é•¿åº¦çš„è·¯å¾„å°†è¢«å¿½ç•¥</span></span><br><span class=\"line\"><span class=\"comment\">     * 6.å¦‚æœæ²¡æœ‰ä¼ å…¥å‚æ•°ï¼Œå°†è¿”å›å½“å‰æ ¹ç›®å½•</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * _dirnameè¡¨ç¤ºç»å¯¹è·¯å¾„</span></span><br><span class=\"line\"><span class=\"comment\">     * æˆ‘ä»¬ç¢°åˆ°çš„./xxå°±æ˜¯ç›¸å¯¹è·¯å¾„</span></span><br><span class=\"line\"><span class=\"comment\">     * 1.åªä¼ å…¥__dirnameä¹Ÿå¯ä»¥è‡ªåŠ¨è°ƒç”¨path.resolveæ–¹æ³•</span></span><br><span class=\"line\"><span class=\"comment\">     * 2.å¯ä»¥æ‹¼æ¥è·¯å¾„å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ä¸è°ƒç”¨path.resolve()æ–¹æ³•æ‹¼æ¥å¤±è´¥</span></span><br><span class=\"line\"><span class=\"comment\">     * 3.__dirnameä»£è¡¨çš„æ˜¯å½“å‰æ–‡ä»¶ï¼ˆa.jsï¼‰çš„ç»å¯¹è·¯å¾„</span></span><br><span class=\"line\"><span class=\"comment\">     * 4.ä»å³è‡³å·¦è§£æï¼Œé‡åˆ°äº†ç»å¯¹è·¯å¾„/srcï¼Œå› æ­¤ç›´æ¥è¿”</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    path: path.resolve(__dirname, <span class=\"string\">'../../dist'</span>)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"built_in\">module</span>: &#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * test è§„å®šäº†ä½œç”¨äºä»¥è§„åˆ™ä¸­åŒ¹é…åˆ°çš„åç¼€ç»“å°¾çš„æ–‡ä»¶ï¼Œ </span></span><br><span class=\"line\"><span class=\"comment\">     * use å³æ˜¯ä½¿ç”¨ babel-loader å¿…é¡»çš„å±æ€§ï¼Œ </span></span><br><span class=\"line\"><span class=\"comment\">     * exclude å‘Šè¯‰æˆ‘ä»¬ä¸éœ€è¦å»è½¬è¯‘\"node_modules\"è¿™é‡Œé¢çš„æ–‡ä»¶ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    rules:[</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.(js|jsx)?$/</span>,</span><br><span class=\"line\">        <span class=\"comment\">// å¼€å¯ç¼“å­˜</span></span><br><span class=\"line\">        options: &#123; <span class=\"attr\">cacheDirectory</span>: <span class=\"literal\">true</span> &#125;,</span><br><span class=\"line\">        loader: <span class=\"string\">'babel-loader'</span>,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æ¥ä¸‹æ¥æ¿€åŠ¨äººå¿ƒçš„æ—¶åˆ»ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run start</span><br></pre></td></tr></table></figure>\n\n<p>æ˜¯ä¸æ˜¯èƒ½æ‰“åŒ…æˆåŠŸäº†å‘¢ï¼Ÿ</p>\n<p>æ‰“å¼€ã€dist/ã€‘ä½ çš„htmlé¡µé¢ï¼Œçœ‹ä¸€ä¸‹æ˜¯å¦æ˜¯â€œHello Worldï¼â€å§ï¼</p>\n<h3 id=\"ä½¿ç”¨webpack-mergeğŸˆ´ï¸\"><a href=\"#ä½¿ç”¨webpack-mergeğŸˆ´ï¸\" class=\"headerlink\" title=\"ä½¿ç”¨webpack-mergeğŸˆ´ï¸\"></a>ä½¿ç”¨webpack-mergeğŸˆ´ï¸</h3><p>æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªåä¸º <a href=\"https://github.com/survivejs/webpack-merge\" target=\"_blank\" rel=\"noopener\">webpack-merge</a> çš„å·¥å…·ã€‚é€šè¿‡â€œé€šç”¨â€é…ç½®ï¼Œæˆ‘ä»¬ä¸å¿…åœ¨ç¯å¢ƒç‰¹å®š(environment-specific)çš„é…ç½®ä¸­é‡å¤ä»£ç ã€‚ç®€å•æ¥è¯´å°±æ˜¯ç”Ÿäº§ç¯å¢ƒä¸åŒï¼Œæˆ‘ä»¬è¦ç»™çš„é…ç½®ä¹Ÿæœ‰æ‰€ä¸åŒï¼Œä½†æ˜¯å¯ä»¥å…±ç”¨ä¸€ä¸ªå…±æœ‰çš„é…ç½®ã€‚</p>\n<p>æˆ‘ä»¬å…ˆä»å®‰è£… <a href=\"https://github.com/survivejs/webpack-merge\" target=\"_blank\" rel=\"noopener\">webpack-merge</a> å¼€å§‹ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save-dev webpack-merge</span><br></pre></td></tr></table></figure>\n\n<p>å®‰è£…ç»“æŸä¹‹åï¼Œæˆ‘ä»¬åœ¨ <code>config</code> è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸¤ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«ä¸º <code>webpack.prod.config.js</code> å’Œ <code>webpack.dev.config.js</code> ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶åˆ†åˆ«å¯¹åº”ç”Ÿäº§å’Œå¼€å‘ä¸¤ä¸ªç¯å¢ƒçš„é…ç½®ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥æ·»åŠ testç¯å¢ƒã€‚åå­—ä¹Ÿå¯ä»¥è‡ªå·±å–ï¼Œå°½é‡ä¿æŒä¸€è‡´ã€‚</p>\n<p>ç°åœ¨çš„ç›®å½•ç»“æ„ï¼š</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  webpackInit</span><br><span class=\"line\">\t|- config</span><br><span class=\"line\">\t\t|- webpack</span><br><span class=\"line\">\t    |- webpack.common.config.js</span><br><span class=\"line\"><span class=\"addition\">+     |- webpack.prod.config.js</span></span><br><span class=\"line\">  çœç•¥</span><br></pre></td></tr></table></figure>\n\n<p>åœ¨ã€webpack.prod.config.jsã€‘åŠ å…¥</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> merge = <span class=\"built_in\">require</span>(<span class=\"string\">'webpack-merge'</span>); <span class=\"comment\">// ç‰ˆæœ¬ä¸º4.x</span></span><br><span class=\"line\"><span class=\"comment\">// webpack-merge 5.xç‰ˆæœ¬åº”è¯¥æ”¹ä¸º const &#123; merge &#125; = require('webpack-merge');</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> common = <span class=\"built_in\">require</span>(<span class=\"string\">'./webpack.common.config.js'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = merge(common, &#123;</span><br><span class=\"line\">  mode: <span class=\"string\">'production'</span>,</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>ç„¶åä¿®æ”¹ã€package.jsonã€‘</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  \"name\": \"webpackInit\",</span><br><span class=\"line\">  \"version\": \"1.0.0\",</span><br><span class=\"line\">  \"description\": \"\",</span><br><span class=\"line\">  \"main\": \"index.js\",</span><br><span class=\"line\">  \"scripts\": &#123;</span><br><span class=\"line\">    \"start\": \"webpack --config ./config/webpack/webpack.common.config.js\",</span><br><span class=\"line\"><span class=\"addition\">+   \"build\": \"webpack --config ./config/webpack/webpack.prod.config.js\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  \"keywords\": [],</span><br><span class=\"line\">  \"author\": \"\",</span><br><span class=\"line\">  \"license\": \"ISC\",</span><br><span class=\"line\">  \"devDependencies\": &#123;</span><br><span class=\"line\">    \"@babel/core\": \"^7.10.2\",</span><br><span class=\"line\">    \"@babel/preset-env\": \"^7.10.2\",</span><br><span class=\"line\">    \"@babel/preset-react\": \"^7.10.1\",</span><br><span class=\"line\">    \"babel-loader\": \"^8.1.0\",</span><br><span class=\"line\">    \"babel-plugin-import\": \"^1.13.0\",</span><br><span class=\"line\">    \"webpack\": \"^4.43.0\",</span><br><span class=\"line\">    \"webpack-cli\": \"^3.3.11\",</span><br><span class=\"line\">    \"webpack-merge\": \"^4.2.2\"</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  \"dependencies\": &#123;</span><br><span class=\"line\">    \"react\": \"^16.13.1\",</span><br><span class=\"line\">    \"react-dom\": \"^16.13.1\"</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ç„¶å</p>\n<p>åˆ é™¤ã€distæ–‡ä»¶å¤¹ã€‘</p>\n<p>ä¹‹å</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run build</span><br></pre></td></tr></table></figure>\n\n<p>æ˜¯ä¸æ˜¯ä¹Ÿbuildä¹Ÿæ‰“åŒ…æˆåŠŸäº†ï¼</p>\n<p>htmlæ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥æ­£å¸¸è®¿é—®ï¼</p>\n<p>ä½†æ˜¯æ²¡æœ‰æ˜¾ç¤ºHello Worldï¼Œä»”ç»†ä¸€çœ‹è¿˜æŠ¥é”™äº†ã€‚ã€‚ã€‚ä¸ºä»€ä¹ˆå‘¢ã€‚ã€‚å› ä¸º</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; å¦‚æœä¸åŠ å“ˆå¸Œå€¼ï¼Œæµè§ˆå™¨ä¼šæœ‰ç¼“å­˜ï¼Œå¯èƒ½ä½ éƒ¨ç½²äº†ï¼Œä½†æ˜¯ç”¨æˆ·çœ‹åˆ°çš„è¿˜æ˜¯è€é¡µé¢</span><br><span class=\"line\">    &#x2F;&#x2F; 8æ˜¯hashçš„é•¿åº¦ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œwebpackä¼šè®¾ç½®é»˜è®¤å€¼ä¸º20ã€‚</span><br><span class=\"line\">    filename: &#39;js&#x2F;[name].[chunkhash:8].bundle.js&#39;,</span><br></pre></td></tr></table></figure>\n\n<p>æˆ‘ä»¬ç»™jsæ–‡ä»¶è®¾ç½®äº†hashå€¼ã€‚ä¸èƒ½å¤Ÿç›´æ¥åœ¨htmlé‡Œé¢åŠ ä¸Šã€<script src=\"../dist/js/bundle.js\"></script>ã€‘è¿™ä¹ˆä¸€å¥ï¼Œè€Œä¸”æ¯æ¬¡ç”Ÿæˆçš„hashå€¼éƒ½ä¼šå˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦æ€ä¹ˆå¤„ç†è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</p>\n<h3 id=\"ä½¿ç”¨HtmlWebpackPlugin\"><a href=\"#ä½¿ç”¨HtmlWebpackPlugin\" class=\"headerlink\" title=\"ä½¿ç”¨HtmlWebpackPlugin\"></a>ä½¿ç”¨<a href=\"https://www.webpackjs.com/plugins/html-webpack-plugin/\" target=\"_blank\" rel=\"noopener\">HtmlWebpackPlugin</a></h3><p>å®‰è£…<a href=\"https://www.webpackjs.com/plugins/html-webpack-plugin/\" target=\"_blank\" rel=\"noopener\">HtmlWebpackPlugin</a></p>\n<p>åœ¨æ§åˆ¶å°æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save-dev html-webpack-plugin</span><br></pre></td></tr></table></figure>\n\n<p>ä¿®æ”¹ã€webpack.prod.config.jsã€‘</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> merge = <span class=\"built_in\">require</span>(<span class=\"string\">'webpack-merge'</span>); <span class=\"comment\">// ç‰ˆæœ¬ä¸º4.x</span></span><br><span class=\"line\"><span class=\"comment\">// webpack-merge 5.xç‰ˆæœ¬åº”è¯¥æ”¹ä¸º const &#123; merge &#125; = require('webpack-merge');</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> common = <span class=\"built_in\">require</span>(<span class=\"string\">'./webpack.common.config.js'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'html-webpack-plugin'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = merge(common, &#123;</span><br><span class=\"line\">  mode: <span class=\"string\">'production'</span>,</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>, <span class=\"comment\">// æ‰“åŒ…ä¹‹åçš„htmlæ–‡ä»¶åå­—</span></span><br><span class=\"line\">      <span class=\"comment\">// è¿™é‡Œæœ‰å°ä¼™ä¼´å¯èƒ½ä¼šç–‘æƒ‘ä¸ºä»€ä¹ˆä¸æ˜¯ '../public/index.html'</span></span><br><span class=\"line\">      <span class=\"comment\">// æˆ‘çš„ç†è§£æ˜¯æ— è®ºä¸è¦ç”¨çš„templateæ˜¯ä¸æ˜¯åœ¨ä¸€ä¸ªç›®å½•ï¼Œéƒ½æ˜¯ä»æ ¹è·¯å¾„å¼€å§‹æŸ¥æ‰¾</span></span><br><span class=\"line\">      template: <span class=\"string\">'public/index.html'</span>, <span class=\"comment\">// ä»¥æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„htmlä¸ºæ¨¡æ¿ç”Ÿæˆï¼Œä¸ç„¶æˆ‘ä»¬è¿˜è¦åˆ°æ‰“åŒ…ä¹‹åçš„htmlæ–‡ä»¶ä¸­å†™script</span></span><br><span class=\"line\">      inject: <span class=\"string\">'body'</span>,<span class=\"comment\">// åœ¨bodyæœ€åº•éƒ¨å¼•å…¥jsæ–‡ä»¶ï¼Œå¦‚æœæ˜¯headï¼Œå°±æ˜¯åœ¨headä¸­å¼•å…¥js</span></span><br><span class=\"line\">      minify: &#123; <span class=\"comment\">// å‹ç¼©htmlæ–‡ä»¶</span></span><br><span class=\"line\">        removeComments: <span class=\"literal\">true</span>, <span class=\"comment\">// å»é™¤æ³¨é‡Š</span></span><br><span class=\"line\">        collapseWhitespace: <span class=\"literal\">true</span>, <span class=\"comment\">// å»é™¤ç©ºæ ¼</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n\n\n<p>ç°åœ¨æˆ‘ä»¬å†æ¥æ‰“åŒ…è¯•è¯•</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run build</span><br></pre></td></tr></table></figure>\n\n<p>çœ‹çœ‹distä¸­æ˜¯ä¸æ˜¯å¤šå‡ºäº†htmlæ–‡ä»¶ï¼Œå¹¶ä¸”è‡ªåŠ¨å¼•å…¥äº†scriptï¼Œç”¨æµè§ˆå™¨æ‰“å¼€å®ƒè¯•è¯•çœ‹æ˜¯ä¸æ˜¯èƒ½æ­£ç¡®è¾“å‡ºå†…å®¹äº†ï¼</p>\n<p>èµ·é£ï¼ï¼ğŸ›«ï¸</p>\n<h3 id=\"ä½¿ç”¨clean-webpack-plugin\"><a href=\"#ä½¿ç”¨clean-webpack-plugin\" class=\"headerlink\" title=\"ä½¿ç”¨clean-webpack-plugin\"></a>ä½¿ç”¨clean-webpack-plugin</h3><p>æœ‰äº›åŒå­¦å·²ç»åŒå€¦äº†æ¯æ¬¡éƒ½éœ€è¦åˆ é™¤distæ–‡ä»¶å¤¹æ¥éªŒè¯æ˜¯å¦æˆåŠŸã€‚</p>\n<p>å…¶å®å‡å¦‚æˆ‘ä»¬ä¸åˆ é™¤çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹jsæ–‡ä»¶ï¼Œè¿™æ ·è®©webpackçŸ¥é“æˆ‘ä»¬æ”¹äº†ä¸œè¥¿ï¼Œä»–å°±ä¼šé‡æ–°æ‰“åŒ…ï¼Œä½†æ˜¯æˆ‘ä»¬æ¯æ¬¡æµ‹è¯•éƒ½æ²¡æœ‰å»ä¿®æ”¹ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åˆ é™¤ã€‚</p>\n<p>ä½†æ˜¯ï¼Œå¦‚æœè¯´æˆ‘ä»¬ä¸å»åˆ é™¤distæ–‡ä»¶å¤¹çš„è¯ï¼Œæˆ‘ä»¬ä¿®æ”¹äº†ã€src/index.jsã€‘ã€‚ç„¶åå†é‡æ–°buildï¼Œå°±ä¼šå‘ç°ã€dist/jsã€‘ä¸‹é¢ä¼šåˆå¤šå‡ºä¸€ä¸ªjsæ–‡ä»¶ï¼Œè¿™æ ·çš„è¯æˆ‘ä»¬å°±éœ€è¦è§‚å¯Ÿæ—¥å¿—ï¼ŒæŸ¥çœ‹æ–°é²œâ€œå‡ºç‚‰â€çš„æ˜¯å“ªä¸€ä¸ªï¼Œç„¶ååˆ æ‰åˆ«çš„ã€‚è¿™æ ·éå¸¸éº»çƒ¦ã€‚</p>\n<p>OKï¼Œæˆ‘ä»¬ç°åœ¨å°±æ¥è§£å†³ä¸€ä¸‹è¿™ä¸ªé—®é¢˜</p>\n<p>å®‰è£…clean-webpack-plugin</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save-dev clean-webpack-plugin</span><br></pre></td></tr></table></figure>\n\n<p>ä¿®æ”¹ã€webpck.prod.config.jsã€‘</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const merge = require('webpack-merge'); // ç‰ˆæœ¬ä¸º4.x</span><br><span class=\"line\">// webpack-merge 5.xç‰ˆæœ¬åº”è¯¥æ”¹ä¸º const &#123; merge &#125; = require('webpack-merge');</span><br><span class=\"line\">const common = require('./webpack.common.config.js');</span><br><span class=\"line\"></span><br><span class=\"line\">const HtmlWebpackPlugin = require('html-webpack-plugin');</span><br><span class=\"line\"><span class=\"addition\">+ const &#123; CleanWebpackPlugin &#125; = require('clean-webpack-plugin');</span></span><br><span class=\"line\"></span><br><span class=\"line\">module.exports = merge(common, &#123;</span><br><span class=\"line\">  mode: 'production',</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    new HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: 'index.html', // æ‰“åŒ…ä¹‹åçš„htmlæ–‡ä»¶åå­—</span><br><span class=\"line\">      // è¿™é‡Œæœ‰å°ä¼™ä¼´å¯èƒ½ä¼šç–‘æƒ‘ä¸ºä»€ä¹ˆä¸æ˜¯ '../public/index.html'</span><br><span class=\"line\">      // æˆ‘çš„ç†è§£æ˜¯æ— è®ºä¸è¦ç”¨çš„templateæ˜¯ä¸æ˜¯åœ¨ä¸€ä¸ªç›®å½•ï¼Œéƒ½æ˜¯ä»æ ¹è·¯å¾„å¼€å§‹æŸ¥æ‰¾</span><br><span class=\"line\">      template: 'public/index.html', // ä»¥æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„htmlä¸ºæ¨¡æ¿ç”Ÿæˆï¼Œä¸ç„¶æˆ‘ä»¬è¿˜è¦åˆ°æ‰“åŒ…ä¹‹åçš„htmlæ–‡ä»¶ä¸­å†™script</span><br><span class=\"line\">      inject: 'body',// åœ¨bodyæœ€åº•éƒ¨å¼•å…¥jsæ–‡ä»¶ï¼Œå¦‚æœæ˜¯headï¼Œå°±æ˜¯åœ¨headä¸­å¼•å…¥js</span><br><span class=\"line\">      minify: &#123; // å‹ç¼©htmlæ–‡ä»¶</span><br><span class=\"line\">        removeComments: true, // å»é™¤æ³¨é‡Š</span><br><span class=\"line\">        collapseWhitespace: true, // å»é™¤ç©ºæ ¼</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\"><span class=\"addition\">+   new CleanWebpackPlugin()</span></span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>æˆ‘ä»¬å…ˆæŸ¥çœ‹ç°åœ¨çš„jsæ–‡ä»¶å‰é¢çš„hashå€¼ã€‚ç„¶åæˆ‘ä»¬ä¿®æ”¹ã€src/index.jsã€‘ï¼Œéšä¾¿æ”¹æˆä»€ä¹ˆï¼Œå†é‡æ–°</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run build</span><br></pre></td></tr></table></figure>\n\n<p>å°±ä¼šå‘ç°æ–‡ä»¶å¹¶æ²¡æœ‰æ–°å¢ï¼Œè€Œä¸”æ¢äº†æ–°é²œçš„å“ˆå¸Œå€¼ã€‚</p>\n<p>å½“ç„¶äº†ï¼Œæˆ‘ä¹‹å‰è¯´çš„é‚£äº›è¯ï¼ŒåŒå­¦ä¸ç›¸ä¿¡çš„è¯ï¼Œå¯ä»¥æŠŠã€new CleanWebpackPlugin()ã€‘è¿™ä¸€è¡Œæ³¨é‡Šæ‰ï¼Œç„¶åå†ä¿®æ”¹ã€src/index.jsã€‘ï¼Œä¼šå‘ç°ã€dist/jsã€‘ä¸‹é¢çš„jsæ–‡ä»¶ä¼šå¢å¤šä¸€æ¡ã€‚</p>\n<h3 id=\"ä½¿ç”¨webpack-dev-server\"><a href=\"#ä½¿ç”¨webpack-dev-server\" class=\"headerlink\" title=\"ä½¿ç”¨webpack-dev-server\"></a>ä½¿ç”¨webpack-dev-server</h3><p>æ—¢ç„¶åˆšåˆšéƒ½æåˆ°ä¼˜åŒ–äº†ï¼Œæˆ‘ä»¬æ¯æ¬¡éƒ½éœ€è¦buildä¸€ä¸‹ï¼Œæ„Ÿè§‰å¾ˆå‘†ã€‚è€Œwebpackå®˜æ–¹ä¹Ÿæä¾›çƒ­éƒ¨ç½²ï¼Œé‚£æˆ‘ä»¬ç°åœ¨å°±ä½¿ç”¨èµ·æ¥</p>\n<p>å®‰è£…webpack-dev-server</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install webpack-dev-server --save-dev</span><br></pre></td></tr></table></figure>\n\n<p>æ–°å»ºæ–‡ä»¶ã€webpack.dev.config.jsã€‘ğŸ“ƒ</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  webpackInit</span><br><span class=\"line\">\t|- config</span><br><span class=\"line\">\t\t|- webpack</span><br><span class=\"line\">\t    |- webpack.common.config.js</span><br><span class=\"line\">      |- webpack.prod.config.js</span><br><span class=\"line\"><span class=\"addition\">+     |- webpack.dev.config.js</span></span><br><span class=\"line\">  çœç•¥</span><br></pre></td></tr></table></figure>\n\n<p>ç„¶ååŠ å…¥å¦‚ä¸‹ä»£ç </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> merge = <span class=\"built_in\">require</span>(<span class=\"string\">'webpack-merge'</span>); <span class=\"comment\">// ç‰ˆæœ¬ä¸º4.x</span></span><br><span class=\"line\"><span class=\"comment\">// webpack-merge 5.xç‰ˆæœ¬åº”è¯¥æ”¹ä¸º const &#123; merge &#125; = require('webpack-merge');</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> common = <span class=\"built_in\">require</span>(<span class=\"string\">'./webpack.common.config.js'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> webpack = <span class=\"built_in\">require</span>(<span class=\"string\">'webpack'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'html-webpack-plugin'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = merge(common, &#123;</span><br><span class=\"line\">  mode: <span class=\"string\">'development'</span>,</span><br><span class=\"line\">  output: &#123;</span><br><span class=\"line\">    filename: <span class=\"string\">'js/[name].[hash:8].bundle.js'</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  devServer: &#123;</span><br><span class=\"line\">    contentBase: path.resolve(__dirname, <span class=\"string\">'../dist'</span>),</span><br><span class=\"line\">    open: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    port: <span class=\"number\">9000</span>,</span><br><span class=\"line\">    compress: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    hot: <span class=\"literal\">true</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      template: <span class=\"string\">'public/index.html'</span>,</span><br><span class=\"line\">      inject: <span class=\"string\">'body'</span>,</span><br><span class=\"line\">      hash: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>ä¿®æ”¹æ–‡ä»¶ã€package.jsonã€‘ğŸ“ƒ</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\"scripts\": &#123;</span><br><span class=\"line\"><span class=\"deletion\">-   \"start\": \"webpack --config ./config/webpack/webpack.common.config.js\",</span></span><br><span class=\"line\"><span class=\"addition\">+   \"start\": \"webpack-dev-server --inline --config ./config/webpack/webpack.dev.config.js\",</span></span><br><span class=\"line\">    \"build\": \"webpack --config ./config/webpack/webpack.prod.config.js\",</span><br><span class=\"line\">  &#125;,</span><br></pre></td></tr></table></figure>\n\n<p>ç„¶åæˆ‘ä»¬</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run start</span><br></pre></td></tr></table></figure>\n\n<p>æ˜¯ä¸æ˜¯è‡ªåŠ¨å¼€äº†ä¸€ä¸ªç«¯å£ä¸º9000çš„ç½‘é¡µï¼Œä¸Šé¢æ˜¯æˆ‘ä»¬å†™çš„é¡µé¢å†…å®¹ï¼Œè¿™å’Œæˆ‘ä»¬çš„é…ç½®éƒ½æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚<br>ç°åœ¨ä½ éšæ„ä¿®æ”¹index.jsä¸­çš„ä»£ç ï¼Œå†å›åˆ°é¡µé¢çœ‹ä¸‹æ˜¯ä¸æ˜¯ä¹Ÿè·Ÿç€å˜äº†ï¼Œé‚£æˆ‘ä»¬å°±æ•´åˆwebpack-dev-serveræˆåŠŸï¼</p>\n<h3 id=\"ä½¿ç”¨source-map\"><a href=\"#ä½¿ç”¨source-map\" class=\"headerlink\" title=\"ä½¿ç”¨source-map\"></a>ä½¿ç”¨source-map</h3><p>source-mapå¯ä»¥å±•ç¤ºæˆ‘ä»¬ä»£ç çš„é”™è¯¯ä½ç½®ï¼Œå› ä¸ºæˆ‘ä»¬çš„ä»£ç éƒ½æ˜¯è¢«webpackæ‰“åŒ…è¿‡çš„ï¼Œåªæœ‰æœºå™¨çœ‹å¾—æ‡‚ï¼Œæˆ‘ä»¬äººç±»æ— æ³•æ­£å¸¸è¯†åˆ«ã€‚æ‰€ä»¥éœ€è¦ä»–ã€‚</p>\n<p>æƒ³è¯•ä¸€ä¸‹æœªå¼€å¯æ˜¯ä»€ä¹ˆçŠ¶æ€çš„åŒå­¦å¯ä»¥è‡ªå·±æ•…æ„æŠŠä»£ç å†™é”™ï¼Œç„¶åçœ‹çœ‹æ§åˆ¶å°çš„æŠ¥é”™ã€‚</p>\n<p>å¼€å¯ä¹Ÿååˆ†ç®€å•ã€‚</p>\n<p>å®ƒçš„é…ç½®éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨ ã€webpack.dev.config.jsã€‘ ä¸­å¢åŠ ä¸€ä¸ª <code>devtool</code> å±æ€§å³å¯ï¼</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">module.exports = &#123;</span><br><span class=\"line\"><span class=\"addition\">+  devtool: 'cheap-module-eval-source-map',</span></span><br><span class=\"line\">\t//...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å› ä¸ºæˆ‘ä»¬åªæœ‰è‡ªå·±å†™ä»£ç çš„æ—¶å€™æ‰éœ€è¦æŸ¥çœ‹ï¼Œåˆ°ç”Ÿäº§ç¯å¢ƒå°±è¦å…³é—­å•¦ï¼Œä¸ç„¶æˆ‘ä»¬çš„æ™ºæ…§ç»“æ™¶å°±è¦è¢«ã€çªƒå–ã€‘å•¦ï¼æ‰€ä»¥æˆ‘æ”¾åœ¨äº†</p>\n<h2 id=\"ä¸­åœºä¼‘æ¯\"><a href=\"#ä¸­åœºä¼‘æ¯\" class=\"headerlink\" title=\"ä¸­åœºä¼‘æ¯\"></a>ä¸­åœºä¼‘æ¯</h2><p>è¿™é‡Œå›é¡¾ä¸€ä¸‹çŸ¥è¯†ç‚¹ã€‚</p>\n<ol>\n<li>æˆ‘ä»¬å…ˆnpm init æ–°å»ºä¸€ä¸ªç©ºç™½é¡¹ç›®ã€‚</li>\n<li>ç„¶åå®‰è£…webpackï¼Œreactã€‚</li>\n<li>å‘ç°æ— æ³•ç¼–è¯‘jsxã€‚</li>\n<li>æ‰€ä»¥æˆ‘ä»¬å¯»æ±‚äº†babelçš„å¸®åŠ©ï¼Œå¹¶é…ç½®äº†æ‰€éœ€è¦è§£æçš„å†…å®¹ã€‚</li>\n<li>è§‰å¾—åœ¨htmlé‡Œé¢åŠ å…¥jså¾ˆå‘†ï¼Œæ‰€ä»¥å¼•å…¥äº†HtmlWebpackPlugin</li>\n<li>å› ä¸ºè§‰å¾—æ¯æ¬¡åˆ é™¤æ‰“åŒ…å‡ºæ¥çš„ä¸œè¥¿å¾ˆå‘†ï¼Œæ‰€ä»¥å¼•å…¥äº†clean-webpack-plugin</li>\n<li>å› ä¸ºæ¯æ¬¡éƒ½éœ€è¦é‡æ–°æ‰“åŒ…ï¼Œæ‰€ä»¥ä½¿ç”¨webpack-dev</li>\n<li>è‡³äºwebpack-mergeæ˜¯ä¸ºäº†æ‰“åŒ…å’Œç¼–è¯‘ä¸¤ä¸ªæˆ–è€…è¯´å¤šä¸ªçŠ¶æ€åšé¢„å¤‡çš„ï¼Œåœ¨ä¸Šè¿°çš„ä¾‹å­åªæœ‰æœ¬åœ°çš„devå’Œbuildä¸¤ä¸ªç¯å¢ƒã€‚</li>\n</ol>\n<p>åŸºæœ¬ä¸Šä¸Šè¿°çš„æ“ä½œè¿‡ç¨‹æˆ‘éƒ½æœ‰è§£é‡Šï¼Œæˆ–è€…æ˜¯æ³¨é‡Šï¼Œæˆ–è€…æ˜¯åœ¨æ–‡ç« ä¸­è¯´æ˜ã€‚å¤§å®¶å¯ä»¥è·Ÿç€èŠ‚å¥ä¸€æ­¥ä¸€æ­¥æ¥ï¼Œå› ä¸ºæˆ‘ä¹Ÿæ˜¯ä¸€è¾¹å†™blogä¸€è¾¹è·‘ä»£ç ä¸€è¾¹å›é¡¾çŸ¥è¯†ç‚¹ã€‚</p>\n<p>è‡³æ­¤ï¼Œwebpackç®—æ˜¯å‘Šä¸€â€¦â€¦</p>\n<p>è¯¶è¯¶è¯¶è¯¶ï¼jsæ˜¯å¯ä»¥è§£æäº†ï¼Œé‚£csså‘¢ï¼</p>\n<p>å“¦å“¦ï¼Œå¥½çš„ï¼Œé‚£æˆ‘ä»¬ç»§ç»­å¯ç¨‹</p>\n<h2 id=\"é‡æ–°èµ·èˆª\"><a href=\"#é‡æ–°èµ·èˆª\" class=\"headerlink\" title=\"é‡æ–°èµ·èˆª\"></a>é‡æ–°èµ·èˆª</h2><h3 id=\"ä½¿ç”¨css-loaderå’Œstyle-loaderä¸¤å…„å¼Ÿ\"><a href=\"#ä½¿ç”¨css-loaderå’Œstyle-loaderä¸¤å…„å¼Ÿ\" class=\"headerlink\" title=\"ä½¿ç”¨css-loaderå’Œstyle-loaderä¸¤å…„å¼Ÿ\"></a>ä½¿ç”¨css-loaderå’Œstyle-loaderä¸¤å…„å¼Ÿ</h3><p>å‡å¦‚æˆ‘ä»¬ç›´æ¥å¼•ç”¨cssçš„è¯ï¼Œä¼šæŠ¥é”™äº†ã€‚è¿™é‡Œå°±ä¸æ¼”ç¤ºäº†ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è‡ªå·±è¯•è¯•ã€‚</p>\n<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å…ˆèµ°å‘½ä»¤è¡Œæ•²å‡»</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save-dev style-loader css-loader</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"ä¸¤å…„å¼Ÿçš„å…³ç³»\"><a href=\"#ä¸¤å…„å¼Ÿçš„å…³ç³»\" class=\"headerlink\" title=\"ä¸¤å…„å¼Ÿçš„å…³ç³»\"></a>ä¸¤å…„å¼Ÿçš„å…³ç³»</h4><p>æ¥è¯´è¯´css-loaderå’Œstyle-loaderä»–ä»¬è¿™å¯¹é¸³é¸¯çš„å…³ç³»ã€‚</p>\n<p>é¦–å…ˆcss-loaderä¼šæŠŠä½ çš„CSSæ–‡ä»¶è¿›è¡Œè§£æï¼Œå› ä¸ºwebpackæ˜¯ç”¨JSå†™çš„ï¼Œè¿è¡Œåœ¨nodeç¯å¢ƒï¼Œæ‰€ä»¥é»˜è®¤webpackæ‰“åŒ…çš„æ—¶å€™åªä¼šå¤„ç†JSä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼</p>\n<p>æ‰€ä»¥æˆ‘ä»¬ä¹‹å‰çš„reacté‡Œé¢çš„jsxéœ€è¦babelçš„å¸®åŠ©ï¼Œæˆ–è€…è¯´éœ€è¦ã€babel-loaderã€‘çš„å¸®åŠ©ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„cssåŒæ ·éœ€è¦ã€css-loaderã€‘çš„å¸®åŠ©ï¼Œé‚£ä¹ˆåˆå…³ã€style-loaderã€‘ä»€ä¹ˆäº‹ï¼Ÿå¯ä¸å¯ä»¥ä¸è£…ä»–å‘¢ï¼Ÿ</p>\n<p>ç­”æ¡ˆæ˜¯ï¼šå¯ä»¥çš„ï¼Œä½†æ˜¯ä½ ä½¿ç”¨èµ·æ¥ä¼šéå¸¸çš„éº»çƒ¦ã€‚æ€ä¹ˆä¸ªéº»çƒ¦æ³•å‘¢ï¼Ÿ</p>\n<p>å¦‚æœåªç”¨äº†ã€css-loaderã€‘è§£æå‡ºæ¥çš„æ˜¯è¿™æ ·çš„</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[&quot;.&#x2F;src&#x2F;index.css&quot;, &quot;.test&#123;â†µ  color: red;â†µ&#125;&quot;, &quot;&quot;]</span><br></pre></td></tr></table></figure>\n\n<p>è¿™æ ·å’‹ç”¨å˜›ï¼Œä½ æ˜¯è§£æäº†ï¼Œå¯æ˜¯ä½ è§£æçš„æ˜¯ä¸ªXXã€‚</p>\n<p>è¿™ä¸ªæ—¶å€™å°±éœ€è¦æˆ‘ä»¬çš„å¤©é™çŒ›ç”·ã€style-loaderã€‘</p>\n<p>style-loader æ˜¯é€šè¿‡ä¸€ä¸ªJSè„šæœ¬åˆ›å»ºä¸€ä¸ªstyleæ ‡ç­¾ï¼Œé‡Œé¢åŒ…å«ä¸€äº›æ ·å¼ã€‚style-loaderæ˜¯ä¸èƒ½å•ç‹¬ä½¿ç”¨çš„ï¼Œåº”ä¸ºå®ƒå¹¶ä¸è´Ÿè´£è§£æ css ä¹‹å‰çš„ä¾èµ–å…³ç³»ï¼Œæ¯ä¸ªloaderçš„åŠŸèƒ½éƒ½æ˜¯å•ä¸€çš„ï¼Œå„è‡ªæ‹†åˆ†ç‹¬ç«‹ã€‚</p>\n<h4 id=\"ä¸Šæ‰‹ï¼\"><a href=\"#ä¸Šæ‰‹ï¼\" class=\"headerlink\" title=\"ä¸Šæ‰‹ï¼\"></a>ä¸Šæ‰‹ï¼</h4><p>åŠ å…¥index.css</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">src</span><br><span class=\"line\"><span class=\"addition\">+  |- index.css</span></span><br><span class=\"line\">   |- indexjs</span><br></pre></td></tr></table></figure>\n\n<p>index.cssæ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.test</span>&#123;</span><br><span class=\"line\">  <span class=\"attribute\">color</span>: red;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä¿®æ”¹index.js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React <span class=\"keyword\">from</span> <span class=\"string\">'react'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> ReactDOM <span class=\"keyword\">from</span> <span class=\"string\">'react-dom'</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">'./index.css'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> App = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> (</span><br><span class=\"line\">  &lt;div className=<span class=\"string\">\"test\"</span>&gt;</span><br><span class=\"line\">    Hello Worldï¼!</span><br><span class=\"line\">  &lt;<span class=\"regexp\">/div&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">)</span></span><br><span class=\"line\"><span class=\"regexp\"></span></span><br><span class=\"line\"><span class=\"regexp\">ReactDOM.render(&lt;App /</span>&gt;, <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'root'</span>));</span><br></pre></td></tr></table></figure>\n\n<p>ä¿®æ”¹ã€webpack.common.config.jsã€‘ğŸ“ƒ</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//...</span><br><span class=\"line\">rules:[</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: /\\.(js|jsx)?$/,</span><br><span class=\"line\">        // å¼€å¯ç¼“å­˜</span><br><span class=\"line\">        options: &#123; cacheDirectory: true &#125;,</span><br><span class=\"line\">        loader: 'babel-loader',</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\"><span class=\"addition\">+      &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+        test: /\\.css$/,</span></span><br><span class=\"line\"><span class=\"addition\">+        use: [ </span></span><br><span class=\"line\"><span class=\"addition\">+          'css-loader', </span></span><br><span class=\"line\"><span class=\"addition\">+          'style-loader',</span></span><br><span class=\"line\"><span class=\"addition\">+        ]</span></span><br><span class=\"line\"><span class=\"addition\">+      &#125;</span></span><br><span class=\"line\">    ]</span><br><span class=\"line\">    //....</span><br></pre></td></tr></table></figure>\n\n<p>è®°å¾—é‡æ–°è¿è¡Œï¼Œå› ä¸ºwebpackçš„é…ç½®ä»–è¯»å–ä¸€æ¬¡ï¼Œæ‰€ä»¥å¦‚æœä½ ä¿®æ”¹äº†é…ç½®ï¼Œéœ€è¦ã€ctrl+cã€‘å…³é—­é‡æ–°è¿è¡Œã€‚</p>\n<p>å˜¿å˜¿â€¦â€¦æ˜¯ä¸æ˜¯è¿è¡Œä¸äº†å•Šã€‚</p>\n<p>å…¶å®æˆ‘æ˜¯æ•…æ„çš„ï¼Œæˆ‘æƒ³å‘Šè¯‰å¤§å®¶ä¸€ä¸ªçŸ¥è¯†ç‚¹ã€‚</p>\n<blockquote>\n<p>loaderçš„åŠ è½½é¡ºåºæ˜¯ä»å³å¾€å·¦ã€‚è¿™é‡Œçš„ç¼–è¯‘é¡ºåºæ˜¯å…ˆç”¨css-loaderå°†cssä»£ç ç¼–è¯‘ï¼Œå†äº¤ç»™style-loaderæ’å…¥åˆ°ç½‘é¡µé‡Œé¢å»ã€‚æ‰€ä»¥css-loaderåœ¨å³ï¼Œstyle-loaderåœ¨å·¦ã€‚</p>\n</blockquote>\n<p>è™½ç„¶æˆ‘ä»¬çš„æ•°ç»„æ¢è¡Œäº†ï¼Œä½†æ˜¯ä»”ç»†çœ‹ä¸éš¾çœ‹å‡ºé¡ºåºã€‚</p>\n<p>æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å°†ä»–ä»¬æ¢ä¸ªä½ç½®å°±å¯ä»¥äº†ã€‚ä»£ç æˆ‘å°±ä¸è´´äº†ã€‚</p>\n<p>ç°åœ¨å¤§å®¶åº”è¯¥è®°å¿†å¾ˆæ·±åˆ»äº†å§ï¼</p>\n<p>å¤§å®¶é‡æ–°ã€ctrl+cã€‘å…³é—­é‡æ–°è¿è¡Œå°±è¡Œäº†ã€‚æˆ‘ä»¬çš„hello worldæ˜¯ä¸æ˜¯å˜çº¢å•¦ï½</p>\n<h3 id=\"å®‰è£…less-loader\"><a href=\"#å®‰è£…less-loader\" class=\"headerlink\" title=\"å®‰è£…less-loader\"></a>å®‰è£…less-loader</h3><p>è¯´åˆ°cssï¼Œè¯´å¥å®åœ¨è¯ï¼Œæ²¡å‡ äººçœŸçš„æ˜¯åœ¨å†™çº¯cssçš„å§ï¼Ÿç°åœ¨è°ä¸æ˜¯lessï¼Œsassæˆ–è€…å…¶ä»–cssé¢„å¤„ç†å‘¢ï¼Ÿè€Œä¸”è¿™äº›é¢„å¤„ç†çš„å¥½å¤„æˆ‘å°±ä¸ç»†è¯´äº†ï¼Œæ„Ÿå…´è¶£çš„è‡ªå·±Googleå§ï¼Œæœ¬æ–‡ç”¨çš„æ˜¯lessï¼ˆå› ä¸ºant designç”¨çš„ä¹Ÿæ˜¯lessï¼Œå“ˆå“ˆï¼Œå‡è£…æ˜¯èš‚èšçš„ä¸€å‘˜ï¼‰</p>\n<p>åœ¨å‘½ä»¤è¡Œè¾“å…¥</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save-dev less less-loader</span><br></pre></td></tr></table></figure>\n\n<p>lessæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œç”¨ä»–è‚¯å®šè¦è£…ï¼Œless-loaderï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯lessçš„è§£æè€…ã€‚</p>\n<p>åœ¨ã€webpack.common.config.jsã€‘å¢åŠ </p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">        test: /\\.css$/,</span><br><span class=\"line\">        use: [ </span><br><span class=\"line\">          'style-loader',</span><br><span class=\"line\">          'css-loader', </span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\"><span class=\"addition\">+      &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+        test: /\\.less$/,</span></span><br><span class=\"line\"><span class=\"addition\">+        use: [ </span></span><br><span class=\"line\"><span class=\"addition\">+          'style-loader',</span></span><br><span class=\"line\"><span class=\"addition\">+          'css-loader', </span></span><br><span class=\"line\"><span class=\"addition\">+          'less-loader',</span></span><br><span class=\"line\"><span class=\"addition\">+        ]</span></span><br><span class=\"line\"><span class=\"addition\">+      &#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>ä¾æ—§æ˜¯é¡ºåºé—®é¢˜ï¼Œå…ˆè§£ælessï¼ŒæŠŠlessè§£ææˆå¸¸è§„çš„cssï¼Œç„¶åå†è§£æcssï¼Œæœ€åæ’å…¥åˆ°ç½‘é¡µä¸­å»ã€‚</p>\n<p>ä¿®æ”¹ã€index.jsã€‘å¼•å…¥è‡ªå·±å†™çš„ã€.lessã€‘æ–‡ä»¶</p>\n<p>å¤§å®¶é‡æ–°ã€ctrl+cã€‘å…³é—­é‡æ–°è¿è¡Œå°±è¡Œäº†ã€‚è‡³äºä½ å†™äº†ä»€ä¹ˆlessç‰¹æ€§ï¼Œåªè¦æœ‰æ•ˆæœå°±è¡Œäº†ã€‚</p>\n<h3 id=\"å®‰è£…url-loaderå’Œfile-loader\"><a href=\"#å®‰è£…url-loaderå’Œfile-loader\" class=\"headerlink\" title=\"å®‰è£…url-loaderå’Œfile-loader\"></a>å®‰è£…url-loaderå’Œfile-loader</h3><p>è¯´å®ŒCSSï¼Œç¾ä¸½çš„ç½‘é¡µå½“ç„¶ç¦»ä¸å¼€æˆ‘ä»¬åŠ¨äººçš„å›¾ç‰‡å•¦ã€‚</p>\n<p>ã€file-loaderã€‘çš„ä½œç”¨æ˜¯ï¼ŒæŠŠä½ çš„æ–‡ä»¶æ‰“åŒ…èµ·æ¥ï¼Œå’Œjsæ–‡ä»¶æ”¾åœ¨ä¸€èµ·ï¼Œè¿™æ ·ç”¨æˆ·è®¿é—®æˆ‘ä»¬çš„ç½‘é¡µçš„æ—¶å€™ï¼Œå…¶å®ä¹Ÿéœ€è¦è®¿é—®æˆ‘ä»¬çš„urlï¼Œæ—¢å¢åŠ äº†æœåŠ¡å™¨çš„å‹åŠ›ï¼Œä¹Ÿå¢åŠ äº†ç”¨æˆ·å‡çº§æµé‡çš„å‹åŠ›ï¼Œéœ€è¦å»ä¸‹è½½è¿™ä¸ªæ–‡ä»¶ã€‚</p>\n<p>ã€url-loaderã€‘</p>\n<p>å¦‚æœé¡µé¢å›¾ç‰‡è¾ƒå¤šï¼Œå‘å¾ˆå¤šhttpè¯·æ±‚ï¼Œä¼šé™ä½é¡µé¢æ€§èƒ½ã€‚è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡url-loaderè§£å†³ã€‚url-loaderä¼šå°†å¼•å…¥çš„å›¾ç‰‡ç¼–ç ï¼Œç”ŸæˆdataURlå¹¶å°†å…¶æ‰“åŒ…åˆ°æ–‡ä»¶ä¸­ï¼Œæœ€ç»ˆåªéœ€è¦å¼•å…¥è¿™ä¸ªdataURLå°±èƒ½è®¿é—®å›¾ç‰‡äº†ã€‚</p>\n<p>url-loaderå’Œfile-loaderä¸¤å…„å¼Ÿçš„æ­é…å¯ä»¥æœ‰æ•ˆçš„å‡å°‘ä¸å¿…è¦çš„urlè¯·æ±‚ï¼Œå› ä¸ºæœ‰çš„å›¾ç‰‡ä½ è¦å»è¯·æ±‚urlè·å–ï¼Œå¦‚æœå°çš„è¯å®Œå…¨å¯ä»¥ç”¨base64æ›¿ä»£ã€‚å¦‚æœå›¾ç‰‡å¾ˆå¤§çš„è¯å°±ç”¨file-loaderï¼Œè¿™æ ·å¯ä»¥å‡å°‘ç¼–ç çš„å‹åŠ›ã€‚</p>\n<p>åœ¨å‘½ä»¤è¡Œè¾“å…¥</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install file-loader url-loader --save-dev</span><br></pre></td></tr></table></figure>\n\n<p>ä¿®æ”¹ã€webpack.common.config.jsã€‘ğŸ“ƒ</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">module: &#123;</span><br><span class=\"line\">  rules: [</span><br><span class=\"line\">    //...</span><br><span class=\"line\"><span class=\"addition\">+    &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+      test: /\\.(jpg|png|gif)$/,</span></span><br><span class=\"line\"><span class=\"addition\">+      use: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+        loader: 'url-loader',</span></span><br><span class=\"line\"><span class=\"addition\">+        options: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+          name: '[name].[ext]', //è¾“å‡ºçš„æ–‡ä»¶å</span></span><br><span class=\"line\"><span class=\"addition\">+          outputPath: 'images/', // è¾“å‡ºåˆ°distç›®å½•ä¸‹çš„è·¯å¾„ï¼ˆdist/images/ï¼‰</span></span><br><span class=\"line\">\t\t\t\t\t\t/**</span><br><span class=\"line\">             * å¦‚æœä½ è¿™ä¸ªå›¾ç‰‡æ–‡ä»¶å¤§äº8192bï¼Œå³8kbï¼Œé‚£æˆ‘url-loaderå°±ä¸ç”¨ï¼Œè½¬è€Œå»ä½¿ç”¨file-loaderï¼Œ</span><br><span class=\"line\">             * æŠŠå›¾ç‰‡æ­£å¸¸æ‰“åŒ…æˆä¸€ä¸ªå•ç‹¬çš„å›¾ç‰‡æ–‡ä»¶åˆ°è®¾ç½®çš„ç›®å½•ä¸‹ï¼Œè‹¥æ˜¯å°äºäº†8kbï¼Œ</span><br><span class=\"line\">             * é‚£å¥½ï¼Œæˆ‘å°±å°†å›¾ç‰‡æ‰“åŒ…æˆbase64çš„å›¾ç‰‡æ ¼å¼æ’å…¥åˆ°bundle.jsæ–‡ä»¶ä¸­ï¼Œ</span><br><span class=\"line\">             * è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå‡å°‘äº†httpè¯·æ±‚ï¼Œä½†æ˜¯å¦‚æœæ–‡ä»¶è¿‡å¤§ï¼Œjsæ–‡ä»¶ä¹Ÿä¼šè¿‡å¤§ï¼Œ</span><br><span class=\"line\">             * å¾—ä¸å¿å¤±ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆæœ‰limitçš„åŸå› ï¼</span><br><span class=\"line\">             */</span><br><span class=\"line\"><span class=\"addition\">+          limit: 8192,</span></span><br><span class=\"line\"><span class=\"addition\">+        &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+      &#125;</span></span><br><span class=\"line\"><span class=\"addition\">+    &#125;</span></span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"è¿›é˜¶\"><a href=\"#è¿›é˜¶\" class=\"headerlink\" title=\"è¿›é˜¶\"></a>è¿›é˜¶</h2><p>åŸºæœ¬ä¸Šæˆ‘ä»¬çš„webpackå¯ä»¥æ­£å¸¸è¿è¡Œäº†ï¼Œcssï¼Œjsï¼Œjsxéƒ½å¯ä»¥è§£æäº†ã€‚ä½†æ˜¯æˆ‘ä»¬éœ€è¦è€ƒè™‘ä¸€äº›è¿›é˜¶çš„ä¸œè¥¿ï¼Œä¼˜åŒ–ã€‚</p>\n<h3 id=\"ä½¿ç”¨uglifyjs-webpack-plugin\"><a href=\"#ä½¿ç”¨uglifyjs-webpack-plugin\" class=\"headerlink\" title=\"ä½¿ç”¨uglifyjs-webpack-plugin\"></a>ä½¿ç”¨uglifyjs-webpack-plugin</h3><p>åœ¨æ§åˆ¶å°æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install uglifyjs-webpack-plugin --save-dev</span><br></pre></td></tr></table></figure>\n\n<p>åœ¨ã€webpack.prod.config.jsã€‘æ·»åŠ ä»£ç </p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> UglifyJsPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'uglifyjs-webpack-plugin'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\"><span class=\"comment\">//...</span></span><br><span class=\"line\">  optimization: &#123;</span><br><span class=\"line\">    minimizer: [</span><br><span class=\"line\">      <span class=\"keyword\">new</span> UglifyJsPlugin(&#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.js(\\?.*)?$/i</span>,  <span class=\"comment\">//æµ‹è¯•åŒ¹é…æ–‡ä»¶,</span></span><br><span class=\"line\">        include: <span class=\"regexp\">/\\/includes/</span>, <span class=\"comment\">//åŒ…å«å“ªäº›æ–‡ä»¶</span></span><br><span class=\"line\">        excluce: <span class=\"regexp\">/\\/excludes/</span>, <span class=\"comment\">//ä¸åŒ…å«å“ªäº›æ–‡ä»¶</span></span><br><span class=\"line\"></span><br><span class=\"line\">        cache: <span class=\"literal\">false</span>,   <span class=\"comment\">//æ˜¯å¦å¯ç”¨æ–‡ä»¶ç¼“å­˜ï¼Œé»˜è®¤ç¼“å­˜åœ¨node_modules/.cache/uglifyjs-webpack-plugin.ç›®å½•</span></span><br><span class=\"line\">        parallel: <span class=\"literal\">true</span>,  <span class=\"comment\">//ä½¿ç”¨å¤šè¿›ç¨‹å¹¶è¡Œè¿è¡Œæ¥æé«˜æ„å»ºé€Ÿåº¦</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//å…è®¸è¿‡æ»¤å“ªäº›å—åº”è¯¥è¢«uglifiedï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰å—éƒ½æ˜¯uglifiedï¼‰ã€‚ </span></span><br><span class=\"line\">        <span class=\"comment\">//è¿”å›trueä»¥uglifyå—ï¼Œå¦åˆ™è¿”å›falseã€‚</span></span><br><span class=\"line\">        chunkFilter: <span class=\"function\">(<span class=\"params\">chunk</span>) =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// `vendor` æ¨¡å—ä¸å‹ç¼©</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (chunk.name === <span class=\"string\">'vendor'</span>) &#123;</span><br><span class=\"line\">              <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">  </span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">//..</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ä½¿ç”¨splitChunks\"><a href=\"#ä½¿ç”¨splitChunks\" class=\"headerlink\" title=\"ä½¿ç”¨splitChunks\"></a>ä½¿ç”¨splitChunks</h3><p>å…¶å®æˆ‘ä»¬å†™çš„ä»£ç ï¼Œæœ‰äº›åº“çš„ä»£ç æ˜¯ä¸éœ€è¦æ¯æ¬¡éƒ½ç¼–è¯‘çš„ï¼Œæœ€ç®€å•çš„ä¾‹å­å°±æ˜¯Reactï¼Œè¿™ä¸ªæˆ‘ä»¬å‡ ä¹æ¯ä¸ªjsæ–‡ä»¶éƒ½ä¼šç”¨åˆ°ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬å•ç‹¬æ‰“åŒ…ï¼Œè¿™æ ·åªéœ€è¦æ‰“åŒ…ä¸€æ¬¡ã€‚</p>\n<p>ä¿®æ”¹ã€webpack.common.config.jsã€‘</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">entry: &#123;</span><br><span class=\"line\">     index: './src/index.js',</span><br><span class=\"line\"><span class=\"addition\">+    common: ['react', 'react-dom']</span></span><br><span class=\"line\">  &#125;,</span><br></pre></td></tr></table></figure>\n\n<p>ä¿®æ”¹ã€webpack.prod.config.jsã€‘</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> merge = <span class=\"built_in\">require</span>(<span class=\"string\">'webpack-merge'</span>); <span class=\"comment\">// ç‰ˆæœ¬ä¸º4.x</span></span><br><span class=\"line\"><span class=\"comment\">// webpack-merge 5.xç‰ˆæœ¬åº”è¯¥æ”¹ä¸º const &#123; merge &#125; = require('webpack-merge');</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> common = <span class=\"built_in\">require</span>(<span class=\"string\">'./webpack.common.config.js'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'html-webpack-plugin'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; CleanWebpackPlugin &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">'clean-webpack-plugin'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> UglifyJsPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">'uglifyjs-webpack-plugin'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = merge(common, &#123;</span><br><span class=\"line\">  mode: <span class=\"string\">'production'</span>,</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      filename: <span class=\"string\">'index.html'</span>, <span class=\"comment\">// æ‰“åŒ…ä¹‹åçš„htmlæ–‡ä»¶åå­—</span></span><br><span class=\"line\">      <span class=\"comment\">// è¿™é‡Œæœ‰å°ä¼™ä¼´å¯èƒ½ä¼šç–‘æƒ‘ä¸ºä»€ä¹ˆä¸æ˜¯ '../public/index.html'</span></span><br><span class=\"line\">      <span class=\"comment\">// æˆ‘çš„ç†è§£æ˜¯æ— è®ºä¸è¦ç”¨çš„templateæ˜¯ä¸æ˜¯åœ¨ä¸€ä¸ªç›®å½•ï¼Œéƒ½æ˜¯ä»æ ¹è·¯å¾„å¼€å§‹æŸ¥æ‰¾</span></span><br><span class=\"line\">      template: <span class=\"string\">'public/index.html'</span>, <span class=\"comment\">// ä»¥æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„htmlä¸ºæ¨¡æ¿ç”Ÿæˆï¼Œä¸ç„¶æˆ‘ä»¬è¿˜è¦åˆ°æ‰“åŒ…ä¹‹åçš„htmlæ–‡ä»¶ä¸­å†™script</span></span><br><span class=\"line\">      inject: <span class=\"string\">'body'</span>,<span class=\"comment\">// åœ¨bodyæœ€åº•éƒ¨å¼•å…¥jsæ–‡ä»¶ï¼Œå¦‚æœæ˜¯headï¼Œå°±æ˜¯åœ¨headä¸­å¼•å…¥js</span></span><br><span class=\"line\">      minify: &#123; <span class=\"comment\">// å‹ç¼©htmlæ–‡ä»¶</span></span><br><span class=\"line\">        removeComments: <span class=\"literal\">true</span>, <span class=\"comment\">// å»é™¤æ³¨é‡Š</span></span><br><span class=\"line\">        collapseWhitespace: <span class=\"literal\">true</span>, <span class=\"comment\">// å»é™¤ç©ºæ ¼</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> CleanWebpackPlugin()</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  optimization: &#123;</span><br><span class=\"line\">    minimizer: [</span><br><span class=\"line\">      <span class=\"keyword\">new</span> UglifyJsPlugin(&#123;</span><br><span class=\"line\">        test: <span class=\"regexp\">/\\.js(\\?.*)?$/i</span>,  <span class=\"comment\">//æµ‹è¯•åŒ¹é…æ–‡ä»¶,</span></span><br><span class=\"line\">        <span class=\"comment\">// include: /\\/includes/, //åŒ…å«å“ªäº›æ–‡ä»¶</span></span><br><span class=\"line\">        <span class=\"comment\">// excluce: /\\/excludes/, //ä¸åŒ…å«å“ªäº›æ–‡ä»¶</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//å…è®¸è¿‡æ»¤å“ªäº›å—åº”è¯¥è¢«uglifiedï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰å—éƒ½æ˜¯uglifiedï¼‰ã€‚ </span></span><br><span class=\"line\">        <span class=\"comment\">//è¿”å›trueä»¥uglifyå—ï¼Œå¦åˆ™è¿”å›falseã€‚</span></span><br><span class=\"line\">        chunkFilter: <span class=\"function\">(<span class=\"params\">chunk</span>) =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// `vendor` æ¨¡å—ä¸å‹ç¼©</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (chunk.name === <span class=\"string\">'vendor'</span>) &#123;</span><br><span class=\"line\">              <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">  </span><br><span class=\"line\">        cache: <span class=\"literal\">false</span>,   <span class=\"comment\">//æ˜¯å¦å¯ç”¨æ–‡ä»¶ç¼“å­˜ï¼Œé»˜è®¤ç¼“å­˜åœ¨node_modules/.cache/uglifyjs-webpack-plugin.ç›®å½•</span></span><br><span class=\"line\">        parallel: <span class=\"literal\">true</span>,  <span class=\"comment\">//ä½¿ç”¨å¤šè¿›ç¨‹å¹¶è¡Œè¿è¡Œæ¥æé«˜æ„å»ºé€Ÿåº¦</span></span><br><span class=\"line\">    ],</span><br><span class=\"line\">    splitChunks: &#123;</span><br><span class=\"line\">      <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">       * é»˜è®¤å€¼æ˜¯async</span></span><br><span class=\"line\"><span class=\"comment\">       * æ‹†åˆ†æ¨¡å—çš„èŒƒå›´ï¼Œå®ƒæœ‰ä¸‰ä¸ªå€¼asyncã€initialå’Œallã€‚</span></span><br><span class=\"line\"><span class=\"comment\">       * asyncè¡¨ç¤ºåªä»å¼‚æ­¥åŠ è½½å¾—æ¨¡å—ï¼ˆåŠ¨æ€åŠ è½½import()ï¼‰é‡Œé¢è¿›è¡Œæ‹†åˆ†</span></span><br><span class=\"line\"><span class=\"comment\">       * initialè¡¨ç¤ºåªä»å…¥å£æ¨¡å—è¿›è¡Œæ‹†åˆ†</span></span><br><span class=\"line\"><span class=\"comment\">       * allè¡¨ç¤ºä»¥ä¸Šä¸¤è€…éƒ½åŒ…æ‹¬</span></span><br><span class=\"line\"><span class=\"comment\">       */</span></span><br><span class=\"line\">      chunks: <span class=\"string\">'all'</span>,</span><br><span class=\"line\">      <span class=\"comment\">// minSize: 30000, // ç”Ÿæˆchunkçš„æœ€å°å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚åªæœ‰å¤§äºè¿™ä¸ªæ•°å­—æ‰å¯ä»¥æˆä¸€ä¸ªchunk </span></span><br><span class=\"line\">      <span class=\"comment\">// minRemainingSize: 0, // åªæœ‰å‰©ä¸‹ä¸€ä¸ªchunkçš„æ—¶å€™æ‰ä¼šç”Ÿæ•ˆï¼Œé»˜è®¤æ˜¯å’ŒminSizeä¸€æ ·çš„ï¼Œå¼€å‘çš„æ—¶å€™é»˜è®¤æ˜¯0</span></span><br><span class=\"line\">      <span class=\"comment\">// maxSize: 0, // å‘Šè¯‰webpackå°è¯•å°†å¤§äºmaxSizeå­—èŠ‚çš„å—æ‹†åˆ†ä¸ºè¾ƒå°çš„éƒ¨åˆ†ã€‚</span></span><br><span class=\"line\">      <span class=\"comment\">// minChunks: 1, // æ‹†åˆ†å‰å¿…é¡»å…±äº«æ¨¡å—çš„æœ€å°å—æ•°ã€‚</span></span><br><span class=\"line\">      <span class=\"comment\">// maxAsyncRequests: 6, // æŒ‰éœ€åŠ è½½æ—¶æœ€å¤§å¹¶è¡Œè¯·æ±‚æ•°ã€‚</span></span><br><span class=\"line\">      <span class=\"comment\">// maxInitialRequests: 4, // å…¥å£ç‚¹çš„æœ€å¤§å¹¶è¡Œè¯·æ±‚æ•°ã€‚å…¥å£æ–‡ä»¶</span></span><br><span class=\"line\">      <span class=\"comment\">// automaticNameDelimiter: '~', // é»˜è®¤æƒ…å†µä¸‹ï¼Œwebpackå°†ä½¿ç”¨å—çš„æ¥æºå’Œåç§°ç”Ÿæˆåç§°ï¼ˆä¾‹å¦‚vendors~main.jsï¼‰ã€‚æ­¤é€‰é¡¹ä½¿æ‚¨å¯ä»¥æŒ‡å®šç”¨äºç”Ÿæˆåç§°çš„å®šç•Œç¬¦ã€‚</span></span><br><span class=\"line\">      cacheGroups: &#123;</span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * å½“webpackå¤„ç†æ–‡ä»¶è·¯å¾„æ—¶ï¼Œå®ƒä»¬å§‹ç»ˆåŒ…å«/åœ¨Unixç³»ç»Ÿå’Œ\\Windowsä¸Šã€‚</span></span><br><span class=\"line\"><span class=\"comment\">         * è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ[\\\\/]åœ¨&#123;cacheGroup&#125;.testå­—æ®µä¸­ä½¿ç”¨in æ¥è¡¨ç¤ºè·¯å¾„åˆ†éš”ç¬¦çš„åŸå› ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">         * /æˆ–\\in &#123;cacheGroup&#125;.testä¼šåœ¨è·¨å¹³å°ä½¿ç”¨æ—¶å¼•èµ·é—®é¢˜ã€‚</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        <span class=\"comment\">// defaultVendors: &#123;</span></span><br><span class=\"line\">        <span class=\"comment\">//   test: /[\\\\/]node_modules[\\\\/]/, // åˆ†å—ç›®æ ‡</span></span><br><span class=\"line\">        <span class=\"comment\">//   priority: -10 // æƒé‡</span></span><br><span class=\"line\">        <span class=\"comment\">// &#125;,</span></span><br><span class=\"line\">        <span class=\"comment\">// default: &#123;</span></span><br><span class=\"line\">        <span class=\"comment\">//   minChunks: 2, // æœ€å°å¼•ç”¨</span></span><br><span class=\"line\">        <span class=\"comment\">//   priority: -20, // æƒé‡</span></span><br><span class=\"line\">        <span class=\"comment\">//   // å¦‚æœå½“å‰å—åŒ…å«å·²ä»ä¸»æ†ç»‘åŒ…ä¸­æ‹†åˆ†å‡ºçš„æ¨¡å—ï¼Œåˆ™å°†é‡ç”¨è¯¥æ¨¡å—ï¼Œè€Œä¸æ˜¯ç”Ÿæˆæ–°çš„æ¨¡å—ã€‚è¿™å¯èƒ½ä¼šå½±å“å—çš„ç»“æœæ–‡ä»¶åã€‚</span></span><br><span class=\"line\">        <span class=\"comment\">//   reuseExistingChunk: true</span></span><br><span class=\"line\">        <span class=\"comment\">// &#125;,</span></span><br><span class=\"line\">        <span class=\"comment\">// ä¸Šè¿°çš„splitChunkså…¨æ˜¯webpack4æœªè®¾ç½®æƒ…å†µä¸‹çš„é»˜è®¤å€¼ï¼Œé™¤äº†chunksä»ã€asyncã€‘-&gt;ã€allã€‘å…¶ä»–éƒ½æ²¡æœ‰æ”¹</span></span><br><span class=\"line\">        <span class=\"comment\">// okï¼Œæˆ‘ä»¬ç°åœ¨åŠ å…¥æˆ‘ä»¬è‡ªå·±æƒ³è¦çš„ä»£ç åˆ†å‰²</span></span><br><span class=\"line\">        <span class=\"comment\">// å› ä¸ºæˆ‘å‡†å¤‡åŠ å…¥reactç­‰ä¸šåŠ¡åƒå˜ä¸‡åŒ–è€Œä¸ä¼šå˜çš„åº“</span></span><br><span class=\"line\">        common: &#123;</span><br><span class=\"line\">          test: <span class=\"string\">\"common\"</span>, <span class=\"comment\">// webpackæ‰«é¢çš„å…³é”®å­—</span></span><br><span class=\"line\">          name: <span class=\"string\">\"common\"</span>, <span class=\"comment\">// ç”Ÿæˆçš„åå­—</span></span><br><span class=\"line\">          enforce: <span class=\"literal\">true</span> <span class=\"comment\">// æ˜¯å¦ç¼“å­˜</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>ä¸æƒ³å†™diffå•¦ï¼Œç›´æ¥CVå•¦ã€‚ã€‚ã€‚</p>\n<p>ä¸ºä»€ä¹ˆæˆ‘éœ€è¦æŠŠreactæå–å‡ºæ¥ï¼Œå› ä¸ºå“ªé‡Œéƒ½éœ€è¦ç”¨ï¼Œè€Œä¸”ä»–å‡ ä¹ä¸å¯èƒ½ä¼šå˜ï¼Œæ‰€ä»¥æˆ‘ç‰¹åˆ«æå‡ºæ¥åšäº†ç¼“å­˜ï¼Œå…¶ä½™çš„è¿˜æ˜¯ä½¿ç”¨çš„é»˜è®¤é…ç½®ï¼ˆé™¤äº†chunkæ”¹ä¸ºäº†â€˜allâ€™ï¼‰ã€‚</p>\n<blockquote>\n<p>Tobias Koppers@Wsokraï¼šoptimization. splitchunks. chunks: althe only option you need for vendor and commons splitting in webpackBest combine it with html-webpack-plugin or equivalent html generation18120</p>\n</blockquote>\n<p>ä½œè€…éƒ½å‘æ¨ç‰¹è¯´äº†ï¼Œé‚£æˆ‘ä»¬ä¹Ÿå°±æ¥å—å§ï½å°±æ”¹ä¸ªallï¼Œç„¶åè¡¥ä¸€ä¸‹reactï½</p>\n<p>å†é‡æ–°æ‰“åŒ…ï¼Œä½ ä¼šå‘ç°index.bundle.jsï¼ˆä¸è¢«ç¼“å­˜ï¼‰çš„hashå€¼å˜äº†ï¼Œä½†æ˜¯common.bundle.jsï¼ˆèƒ½è¢«ç¼“å­˜ï¼‰çš„hashå€¼æ²¡å˜ã€‚</p>\n<h3 id=\"ä½¿ç”¨mini-css-extract-plugin\"><a href=\"#ä½¿ç”¨mini-css-extract-plugin\" class=\"headerlink\" title=\"ä½¿ç”¨mini-css-extract-plugin\"></a>ä½¿ç”¨mini-css-extract-plugin</h3><p>jséƒ½ç‹¬ç«‹ğŸ“¦ï¼Œé‚£æˆ‘cssä¹Ÿè¦ï¼</p>\n<p>å…¶å®å¦‚æœæŠŠCSSæ‰“åŒ…æˆä¸€ä¸ªæ–‡ä»¶ç„¶åè®©htmlå¼•ç”¨çš„è¯å¯ä»¥å‡å°htmlæ–‡ä»¶çš„å¤§å°ï¼Œæš—åˆäº†HTTP2çš„å¤šè·¯å¤ç”¨ï¼Œå¤šæ–‡ä»¶å°æ•°é‡ã€‚åŒ…æ‹¬ä¹‹å‰çš„splitChunksé‡Œé¢æˆ‘ä»¬é…ç½®çš„reactä¹Ÿæ˜¯ä¸ºäº†HTTP2ã€‚</p>\n<p>åœ¨å‘½ä»¤è¡Œè¾“å…¥ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save-dev mini-css-extract-plugin</span><br></pre></td></tr></table></figure>\n\n<p>ä¿®æ”¹ã€webpack.common.config.jsã€‘</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"addition\">+ const MiniCssExtractPlugin = require('mini-css-extract-plugin');</span></span><br><span class=\"line\"></span><br><span class=\"line\">//...</span><br><span class=\"line\">module:&#123;</span><br><span class=\"line\">    rules:[</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: /\\.css$/,</span><br><span class=\"line\">        use: [ </span><br><span class=\"line\"><span class=\"addition\">+          MiniCssExtractPlugin.loader,</span></span><br><span class=\"line\"><span class=\"deletion\">-          'style-loader',</span></span><br><span class=\"line\">           'css-loader', </span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"><span class=\"addition\">+plugins: [</span></span><br><span class=\"line\"><span class=\"addition\">+    new MiniCssExtractPlugin(&#123;</span></span><br><span class=\"line\"><span class=\"addition\">+      filename: 'css/[name].[hash].css',</span></span><br><span class=\"line\"><span class=\"addition\">+      chunkFilename: 'css/[id].[hash].css',</span></span><br><span class=\"line\"><span class=\"addition\">+    &#125;),</span></span><br><span class=\"line\">  ]</span><br></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"ä½¿ç”¨CSS-Module\"><a href=\"#ä½¿ç”¨CSS-Module\" class=\"headerlink\" title=\"ä½¿ç”¨CSS Module\"></a>ä½¿ç”¨CSS Module</h3><p>å…¶å®å¾ˆç®€å•ï¼Œåªéœ€è¦ä¿®æ”¹ä¸€ä¸‹é…ç½®ã€wbpack.common.config.jsã€‘</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">        test: /\\.css$/,</span><br><span class=\"line\">        use: [ </span><br><span class=\"line\">          MiniCssExtractPlugin.loader,</span><br><span class=\"line\"><span class=\"deletion\">-          'css-loader'</span></span><br><span class=\"line\"><span class=\"addition\">+          &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+            loader: 'css-loader',</span></span><br><span class=\"line\"><span class=\"addition\">+            options: &#123;</span></span><br><span class=\"line\"><span class=\"addition\">+              // importLoaders: 1,</span></span><br><span class=\"line\"><span class=\"addition\">+              modules: true,</span></span><br><span class=\"line\"><span class=\"addition\">+            &#125;,</span></span><br><span class=\"line\"><span class=\"addition\">+          &#125;,</span></span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;,</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ä½¿ç”¨PostCSS\"><a href=\"#ä½¿ç”¨PostCSS\" class=\"headerlink\" title=\"ä½¿ç”¨PostCSS\"></a>ä½¿ç”¨PostCSS</h3><blockquote>\n<p>postcss ä¸€ç§å¯¹cssç¼–è¯‘çš„å·¥å…·ï¼Œç±»ä¼¼babelå¯¹jsçš„å¤„ç†ï¼Œå¸¸è§çš„åŠŸèƒ½å¦‚ï¼š 1 . ä½¿ç”¨ä¸‹ä¸€ä»£cssè¯­æ³• 2 . è‡ªåŠ¨è¡¥å…¨æµè§ˆå™¨å‰ç¼€ 3 . è‡ªåŠ¨æŠŠpxä»£ä¸ºè½¬æ¢æˆrem 4 . css ä»£ç å‹ç¼©ç­‰ç­‰ postcss åªæ˜¯ä¸€ä¸ªå·¥å…·ï¼Œæœ¬èº«ä¸ä¼šå¯¹cssä¸€é¡¿æ“ä½œï¼Œå®ƒé€šè¿‡æ’ä»¶å®ç°åŠŸèƒ½ï¼Œautoprefixer å°±æ˜¯å…¶ä¸€ã€‚</p>\n</blockquote>\n<p>å®‰è£…postcss</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install postcss postcss-loader --save-dev</span><br></pre></td></tr></table></figure>\n\n<p>å®‰è£…postcssæŸä¸ªæ’ä»¶ï¼Œä»¥Autoprefixerä¸¾ä¾‹</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install postcss-aspect-ratio-mini postcss-write-svg postcss-px-to-viewport postcss-viewport-units postcss-flexbugs-fixes postcss-preset-env cssnano --save-dev</span><br></pre></td></tr></table></figure>\n\n<p>åœ¨æ ¹ç›®æ ‡æ–°å»ºæ–‡ä»¶ã€postcss.config.jsã€‘</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* eslint-disable import/no-extraneous-dependencies */</span></span><br><span class=\"line\"><span class=\"comment\">/* eslint-disable @typescript-eslint/no-var-requires */</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> postcssAspectRatioMini = <span class=\"built_in\">require</span>(<span class=\"string\">'postcss-aspect-ratio-mini'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> postcssPxToViewport = <span class=\"built_in\">require</span>(<span class=\"string\">'postcss-px-to-viewport'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> postcssWriteSvg = <span class=\"built_in\">require</span>(<span class=\"string\">'postcss-write-svg'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> postcssViewportUnits = <span class=\"built_in\">require</span>(<span class=\"string\">'postcss-viewport-units'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> cssnano = <span class=\"built_in\">require</span>(<span class=\"string\">'cssnano'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> postcssPresetEnv = <span class=\"built_in\">require</span>(<span class=\"string\">'postcss-preset-env'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> postcssFlexbugsFixes = <span class=\"built_in\">require</span>(<span class=\"string\">'postcss-flexbugs-fixes'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  plugins: [</span><br><span class=\"line\">    postcssFlexbugsFixes,</span><br><span class=\"line\">    <span class=\"comment\">// åœ¨è¿™ä¸ªä½ç½®åŠ å…¥æˆ‘ä»¬éœ€è¦é…ç½®çš„ä»£ç </span></span><br><span class=\"line\">    <span class=\"comment\">// åœ¨è¿™ä¸ªä½ç½®åŠ å…¥æˆ‘ä»¬éœ€è¦é…ç½®çš„ä»£ç </span></span><br><span class=\"line\">    <span class=\"comment\">// åœ¨è¿™ä¸ªä½ç½®åŠ å…¥æˆ‘ä»¬éœ€è¦é…ç½®çš„ä»£ç </span></span><br><span class=\"line\">    postcssAspectRatioMini(&#123;&#125;),</span><br><span class=\"line\">    postcssPxToViewport(&#123;</span><br><span class=\"line\">      viewportWidth: <span class=\"number\">750</span>, <span class=\"comment\">// åŸºå‡†å®½åº¦ï¼ˆä¸€èˆ¬çš„è®¾è®¡éƒ½æ˜¯è¿™ä¸ªåŸºå‡†</span></span><br><span class=\"line\">      viewportHeight: <span class=\"number\">1334</span>, <span class=\"comment\">// åŸºå‡†é«˜åº¦ï¼ˆä¸€èˆ¬çš„è®¾è®¡éƒ½æ˜¯è¿™ä¸ªåŸºå‡†</span></span><br><span class=\"line\">      unitPrecision: <span class=\"number\">3</span>, <span class=\"comment\">// (Number) The decimal numbers to allow the REM units to grow to.</span></span><br><span class=\"line\">      viewportUnit: <span class=\"string\">'vw'</span>, <span class=\"comment\">// (String) å•ä½</span></span><br><span class=\"line\">      selectorBlackList: [<span class=\"string\">'.list-ignore'</span>, /notTransform/], <span class=\"comment\">// å¸¦ä¸Šè¿™ä¸ªå•è¯çš„å°±ä¸ä¼šfixä¸ºvwå•ä½</span></span><br><span class=\"line\">      minPixelValue: <span class=\"number\">1</span>, <span class=\"comment\">// (Number) æœ€å°åƒç´ </span></span><br><span class=\"line\">      mediaQuery: <span class=\"literal\">false</span>, <span class=\"comment\">// (Boolean) å…è®¸åœ¨åª’ä½“æŸ¥è¯¢ä¸­è½¬æ¢pxã€‚</span></span><br><span class=\"line\">      exclude: <span class=\"regexp\">/(\\/|\\\\)(node_modules)(\\/|\\\\)/</span>,</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    postcssWriteSvg(&#123;</span><br><span class=\"line\">      utf8: <span class=\"literal\">false</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    postcssPresetEnv(&#123;&#125;),</span><br><span class=\"line\">    postcssViewportUnits(&#123;</span><br><span class=\"line\">      filterRule: <span class=\"function\"><span class=\"params\">rule</span> =&gt;</span> rule.selector.includes(<span class=\"string\">'::after'</span>)</span><br><span class=\"line\">        &amp;&amp; rule.selector.includes(<span class=\"string\">'::before'</span>)</span><br><span class=\"line\">        &amp;&amp; rule.selector.includes(<span class=\"string\">':after'</span>)</span><br><span class=\"line\">        &amp;&amp; rule.selector.includes(<span class=\"string\">':before'</span>)</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    cssnano(&#123;</span><br><span class=\"line\">      <span class=\"string\">\"cssnano-preset-advanced\"</span>: &#123;</span><br><span class=\"line\">        zindex: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        autoprefixer: <span class=\"literal\">false</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>ä¿®æ”¹ã€webpack.common.config.jsã€‘</p>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">        test: /\\.css$/,</span><br><span class=\"line\">        use: [ </span><br><span class=\"line\">          'style-loader',</span><br><span class=\"line\">          'css-loader', </span><br><span class=\"line\"><span class=\"addition\">+          'postcss-loader'</span></span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        test: /\\.less$/,</span><br><span class=\"line\">        use: [ </span><br><span class=\"line\">          'style-loader',</span><br><span class=\"line\">          'css-loader', </span><br><span class=\"line\">          'less-loader',</span><br><span class=\"line\"><span class=\"addition\">+          'postcss-loader'</span></span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br></pre></td></tr></table></figure>\n\n<p>ç„¶åï¼Œä¿®æ”¹æˆ‘ä»¬çš„cssæ–‡ä»¶ï¼Œçœ‹çœ‹æˆ‘ä»¬å†™çš„å•ä½ä¸ºpxçš„æœ‰æ²¡æœ‰è¢«æ”¹ä¸ºvwçš„è‡ªé€‚åº”å•ä½ã€‚</p>\n<p>é¡ºä¾¿è¯•ä¸€ä¸‹å¸¦æœ‰ã€notTransformã€‘çš„æ˜¯ä¸æ˜¯è¿˜æ˜¯pxä½œä¸ºå•ä½ã€‚</p>\n<h2 id=\"ç»“æŸ\"><a href=\"#ç»“æŸ\" class=\"headerlink\" title=\"ç»“æŸ\"></a>ç»“æŸ</h2><p>åˆ°æ­¤ï¼Œæˆ‘ä»¬çš„webpacké…ç½®ï¼Œå°±ç®—æ˜¯å…¥é—¨äº†ï¼Œå¯¹äºwebpackçš„é…ç½®æˆ‘ä»¬è¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ã€‚å¤§å®¶åŠ æ²¹ï¼</p>\n<p>å¦‚æœæœ‰å“ªé‡Œå†™çš„ä¸å¥½æˆ–è€…å†™é”™äº†ï¼Œæ¬¢è¿å¤§å®¶åœ¨è¯„è®ºåŒºè®¨è®ºã€‚</p>\n"},{"title":"å…¨ç½‘æœ€å…¨Reactæºç è°ƒè¯•å‚»ç“œå¼æ•™ç¨‹","date":"2021-06-17T13:41:06.000Z","cover":"/image/cover/react.png","_content":"# å‰è¨€\n\nä¹‹å‰åœ¨é˜…è¯»Reactæºç çš„æ—¶å€™ï¼Œæƒ³è°ƒè¯•ä¸€ä¸‹ï¼Œç„¶ådebuggerçœ‹çœ‹å˜é‡å·²ç»æ•°æ®æ˜¯æ€ä¹ˆä¼ é€’çš„ï¼Œæ— å¥ˆã€‚è¿˜è¦è£…è¿™ä¹ˆå¤šä¸œè¥¿ã€‚è¸©äº†ä¸å°‘å‘ï¼Œè®°å½•ä¸€ä¸‹ã€‚å¸®åŠ©å¤§å®¶å°‘è¸©å‘ï¼Œä¹Ÿä¸ºè‡ªå·±åšä¸€ä¸ªç¬”è®°ã€‚\n\n# å‡†å¤‡å·¥ä½œ\n\n- [Node](https://nodejs.org/) v8.0.0+ã€[Yarn](https://yarnpkg.com/en/) v1.2.0+ã€‚\n- å·²å®‰è£… [JDK](https://www.oracle.com/technetwork/java/javase/downloads/index.html)ã€‚\n- ä½ å·²å®‰è£… `gcc`ï¼ˆæˆ–è€…ä½ åœ¨æœ‰å¿…è¦å®‰è£…ç¼–è¯‘å™¨çš„æƒ…å†µä¸‹ä¹Ÿä¸è§‰å¾—éº»çƒ¦ï¼‰ï¼Œå› ä¸ºä¸€äº›ä¾èµ–å¯èƒ½å¾—ç»è¿‡ç¼–è¯‘ï¼Œè€Œåœ¨ OS Xï¼ŒXcode å‘½ä»¤è¡Œå·¥å…·ä¼šå¸®ä½ å¤„ç†ï¼›åœ¨ Ubuntuï¼Œ`apt-get install build-essential` ä¼šå®‰è£…æ‰€éœ€çš„ packageï¼ˆå…¶å®ƒ Linux å‘è¡Œç‰ˆçš„ç±»ä¼¼å‘½ä»¤ä¹Ÿæœ‰æ•ˆï¼‰ï¼›åœ¨ Windows ä¸Šå¾—åšäº›é¢å¤–æ­¥éª¤ï¼Œè¯·å‚è€ƒ [`node-gyp` å®‰è£…æ­¥éª¤](https://github.com/nodejs/node-gyp#installation)ã€‚\n- ç†Ÿæ‚‰ Gitã€‚\n\n- ä¸€ä¸ªå¯ä»¥è¿è¡ŒReacté¡¹ç›®ï¼ˆæœ¬æ–‡é‡‡ç”¨create-react-appï¼‰\n\n# å¼€å§‹\n\n## 1.è·å–æºä»£ç \n\n1. æ‰“å¼€æºç åœ°å€ï¼šhttps://github.com/facebook/react\n2. å…‹éš†åˆ°è‡ªå·±çš„æœ¬åœ°\n   1. å¯ä»¥ä¸‹è½½zipè§£å‹\n   2. ä¹Ÿå¯ä»¥Forkåˆ°è‡ªå·±çš„GitHubç„¶åClone\n      1. ä¸ªäººå»ºè®®æ˜¯Forkï¼Œç„¶åå¯ä»¥ä¿®æ”¹ï¼Œæ·»åŠ æ³¨é‡Šç­‰ç­‰ã€‚å¯ä»¥è®°å½•ä¸€ä¸‹è‡ªå·±å­¦ä¹ å†ç¨‹\n   3. ä¹Ÿå¯ä»¥ç›´æ¥Clone\n\n## 2. å»ºç«‹ä¾èµ–è¿æ¥\n\n1. æ‰“å¼€é¡¹ç›®\n2. è¿è¡Œyarnå®‰è£…ä¾èµ–\n3. è¿è¡Œ`yarn build react/index,react/jsx,react-dom/index,scheduler --type=NODE`é‡æ–°æ‰“åŒ…\n4. `cd build/node_modules/react`è¿›å…¥Reactè¿™ä¸ªåŒ…å†…éƒ¨\n5. `yarn link`å»ºç«‹è¿æ¥\n6. `cd åˆ°åŸæ¥çš„é¡¹ç›®è·¯å¾„`è¿”å›ï¼Œä¸ºäº†ä¸‹ä¸€æ¬¡è¿›å…¥react-domåšå‡†å¤‡\n7. `cd build/node_modules/react-dom`\n8. `yarn link`\n\n## 3.æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥è°ƒè¯•çš„Reacté¡¹ç›®\n\nè¿™é‡Œæˆ‘é‡‡ç”¨çš„æ˜¯`create-react-app`\n\n1. `npx create-react-app my-app`\n2. `cd my-app`\n\n## 4. è¿æ¥é¡¹ç›®å’ŒReactåº“\n\n1. åˆ é™¤åˆšåˆšå»ºç«‹çš„é¡¹ç›®çš„`node_modules`ä¸­çš„`react`å’Œ`react-dom`\n2. æ‰“å¼€Reacté¡¹ç›®\n3. `yarn link react react-dom`\n\n## 5. å¼€å§‹è°ƒè¯•\n\n1. æ‰“å¼€æˆ‘ä»¬cloneçš„é¡¹ç›®\n\n2. æ‰¾åˆ°æƒ³è¦è°ƒè¯•çš„åœ°æ–¹\n\n   1. è¿™é‡Œæ”¹çš„åœ°æ–¹æ˜¯`packages/react-dom/src/client/ReactDOMLegacy.js`\n   2. å†…å®¹å¦‚ä¸‹\n\n   ```diff\n   export function render(\n     element: React$Element<any>,\n     container: Container,\n     callback: ?Function,\n   ) {\n   +  console.log(222);\n     if (__DEV__) {\n       console.error(\n         'ReactDOM.render is no longer supported in React 18. Use createRoot ' +\n           'instead. Until you switch to the new API, your app will behave as ' +\n           \"if it's running React 17. Learn \" +\n           'more: https://reactjs.org/link/switch-to-createroot',\n       );\n     }\n   \n     invariant(\n       isValidContainerLegacy(container),\n       'Target container is not a DOM element.',\n     );\n     if (__DEV__) {\n       const isModernRoot =\n         isContainerMarkedAsRoot(container) &&\n         container._reactRootContainer === undefined;\n       if (isModernRoot) {\n         console.error(\n           'You are calling ReactDOM.render() on a container that was previously ' +\n             'passed to ReactDOM.createRoot(). This is not supported. ' +\n             'Did you mean to call root.render(element)?',\n         );\n       }\n     }\n     return legacyRenderSubtreeIntoContainer(\n       null,\n       element,\n       container,\n       false,\n       callback,\n     );\n   }\n   ```\n\n3. æ‰“å¼€Reactæºç çš„é¡¹ç›®\n4. è¿è¡Œ`yarn build react/index,react/jsx,react-dom/index,scheduler --type=NODE`é‡æ–°æ‰“åŒ…\n5. æ‰“å¼€æˆ‘ä»¬åˆ›å»ºçš„Reacté¡¹ç›®\n6. `yarn start`\n7. æ‰“å¼€æ§åˆ¶å°\n\n![console](/image/reactDebugger/console.png)\n\n## 6. åç»­\n\næ¯æ¬¡ä¿®æ”¹æºä»£ç éƒ½éœ€è¦\n\n1. è¿è¡Œ`yarn build react/index,react/jsx,react-dom/index,scheduler --type=NODE`é‡æ–°æ‰“åŒ…\n2. åˆ·æ–°ä¸€ä¸‹æˆ‘ä»¬çš„é¡µé¢\n3. ç¡®å®å¾ˆéº»çƒ¦ç›®å‰æ²¡æœ‰å¥½çš„ä¸»æ„\n   1. å¯èƒ½è¿™å°±æ˜¯ä¿®è¡Œå§ï¼\n\n# ç»“è¯­\n\næœ‰é—®é¢˜å¯ä»¥åœ¨ä¸‹æ–¹ç•™è¨€ï¼Œæ„Ÿè§‰æœ‰å¸®åŠ©ã€‚å¸®å¿™ç‚¹ä¸ªèµ","source":"_posts/å…¨ç½‘æœ€å…¨Reactæºç è°ƒè¯•æ•™ç¨‹.md","raw":"---\ntitle: å…¨ç½‘æœ€å…¨Reactæºç è°ƒè¯•å‚»ç“œå¼æ•™ç¨‹\ndate: 2021-06-17 21:41:06\ntags: [react]\ncategory: [react]\ncover: /image/cover/react.png\n---\n# å‰è¨€\n\nä¹‹å‰åœ¨é˜…è¯»Reactæºç çš„æ—¶å€™ï¼Œæƒ³è°ƒè¯•ä¸€ä¸‹ï¼Œç„¶ådebuggerçœ‹çœ‹å˜é‡å·²ç»æ•°æ®æ˜¯æ€ä¹ˆä¼ é€’çš„ï¼Œæ— å¥ˆã€‚è¿˜è¦è£…è¿™ä¹ˆå¤šä¸œè¥¿ã€‚è¸©äº†ä¸å°‘å‘ï¼Œè®°å½•ä¸€ä¸‹ã€‚å¸®åŠ©å¤§å®¶å°‘è¸©å‘ï¼Œä¹Ÿä¸ºè‡ªå·±åšä¸€ä¸ªç¬”è®°ã€‚\n\n# å‡†å¤‡å·¥ä½œ\n\n- [Node](https://nodejs.org/) v8.0.0+ã€[Yarn](https://yarnpkg.com/en/) v1.2.0+ã€‚\n- å·²å®‰è£… [JDK](https://www.oracle.com/technetwork/java/javase/downloads/index.html)ã€‚\n- ä½ å·²å®‰è£… `gcc`ï¼ˆæˆ–è€…ä½ åœ¨æœ‰å¿…è¦å®‰è£…ç¼–è¯‘å™¨çš„æƒ…å†µä¸‹ä¹Ÿä¸è§‰å¾—éº»çƒ¦ï¼‰ï¼Œå› ä¸ºä¸€äº›ä¾èµ–å¯èƒ½å¾—ç»è¿‡ç¼–è¯‘ï¼Œè€Œåœ¨ OS Xï¼ŒXcode å‘½ä»¤è¡Œå·¥å…·ä¼šå¸®ä½ å¤„ç†ï¼›åœ¨ Ubuntuï¼Œ`apt-get install build-essential` ä¼šå®‰è£…æ‰€éœ€çš„ packageï¼ˆå…¶å®ƒ Linux å‘è¡Œç‰ˆçš„ç±»ä¼¼å‘½ä»¤ä¹Ÿæœ‰æ•ˆï¼‰ï¼›åœ¨ Windows ä¸Šå¾—åšäº›é¢å¤–æ­¥éª¤ï¼Œè¯·å‚è€ƒ [`node-gyp` å®‰è£…æ­¥éª¤](https://github.com/nodejs/node-gyp#installation)ã€‚\n- ç†Ÿæ‚‰ Gitã€‚\n\n- ä¸€ä¸ªå¯ä»¥è¿è¡ŒReacté¡¹ç›®ï¼ˆæœ¬æ–‡é‡‡ç”¨create-react-appï¼‰\n\n# å¼€å§‹\n\n## 1.è·å–æºä»£ç \n\n1. æ‰“å¼€æºç åœ°å€ï¼šhttps://github.com/facebook/react\n2. å…‹éš†åˆ°è‡ªå·±çš„æœ¬åœ°\n   1. å¯ä»¥ä¸‹è½½zipè§£å‹\n   2. ä¹Ÿå¯ä»¥Forkåˆ°è‡ªå·±çš„GitHubç„¶åClone\n      1. ä¸ªäººå»ºè®®æ˜¯Forkï¼Œç„¶åå¯ä»¥ä¿®æ”¹ï¼Œæ·»åŠ æ³¨é‡Šç­‰ç­‰ã€‚å¯ä»¥è®°å½•ä¸€ä¸‹è‡ªå·±å­¦ä¹ å†ç¨‹\n   3. ä¹Ÿå¯ä»¥ç›´æ¥Clone\n\n## 2. å»ºç«‹ä¾èµ–è¿æ¥\n\n1. æ‰“å¼€é¡¹ç›®\n2. è¿è¡Œyarnå®‰è£…ä¾èµ–\n3. è¿è¡Œ`yarn build react/index,react/jsx,react-dom/index,scheduler --type=NODE`é‡æ–°æ‰“åŒ…\n4. `cd build/node_modules/react`è¿›å…¥Reactè¿™ä¸ªåŒ…å†…éƒ¨\n5. `yarn link`å»ºç«‹è¿æ¥\n6. `cd åˆ°åŸæ¥çš„é¡¹ç›®è·¯å¾„`è¿”å›ï¼Œä¸ºäº†ä¸‹ä¸€æ¬¡è¿›å…¥react-domåšå‡†å¤‡\n7. `cd build/node_modules/react-dom`\n8. `yarn link`\n\n## 3.æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥è°ƒè¯•çš„Reacté¡¹ç›®\n\nè¿™é‡Œæˆ‘é‡‡ç”¨çš„æ˜¯`create-react-app`\n\n1. `npx create-react-app my-app`\n2. `cd my-app`\n\n## 4. è¿æ¥é¡¹ç›®å’ŒReactåº“\n\n1. åˆ é™¤åˆšåˆšå»ºç«‹çš„é¡¹ç›®çš„`node_modules`ä¸­çš„`react`å’Œ`react-dom`\n2. æ‰“å¼€Reacté¡¹ç›®\n3. `yarn link react react-dom`\n\n## 5. å¼€å§‹è°ƒè¯•\n\n1. æ‰“å¼€æˆ‘ä»¬cloneçš„é¡¹ç›®\n\n2. æ‰¾åˆ°æƒ³è¦è°ƒè¯•çš„åœ°æ–¹\n\n   1. è¿™é‡Œæ”¹çš„åœ°æ–¹æ˜¯`packages/react-dom/src/client/ReactDOMLegacy.js`\n   2. å†…å®¹å¦‚ä¸‹\n\n   ```diff\n   export function render(\n     element: React$Element<any>,\n     container: Container,\n     callback: ?Function,\n   ) {\n   +  console.log(222);\n     if (__DEV__) {\n       console.error(\n         'ReactDOM.render is no longer supported in React 18. Use createRoot ' +\n           'instead. Until you switch to the new API, your app will behave as ' +\n           \"if it's running React 17. Learn \" +\n           'more: https://reactjs.org/link/switch-to-createroot',\n       );\n     }\n   \n     invariant(\n       isValidContainerLegacy(container),\n       'Target container is not a DOM element.',\n     );\n     if (__DEV__) {\n       const isModernRoot =\n         isContainerMarkedAsRoot(container) &&\n         container._reactRootContainer === undefined;\n       if (isModernRoot) {\n         console.error(\n           'You are calling ReactDOM.render() on a container that was previously ' +\n             'passed to ReactDOM.createRoot(). This is not supported. ' +\n             'Did you mean to call root.render(element)?',\n         );\n       }\n     }\n     return legacyRenderSubtreeIntoContainer(\n       null,\n       element,\n       container,\n       false,\n       callback,\n     );\n   }\n   ```\n\n3. æ‰“å¼€Reactæºç çš„é¡¹ç›®\n4. è¿è¡Œ`yarn build react/index,react/jsx,react-dom/index,scheduler --type=NODE`é‡æ–°æ‰“åŒ…\n5. æ‰“å¼€æˆ‘ä»¬åˆ›å»ºçš„Reacté¡¹ç›®\n6. `yarn start`\n7. æ‰“å¼€æ§åˆ¶å°\n\n![console](/image/reactDebugger/console.png)\n\n## 6. åç»­\n\næ¯æ¬¡ä¿®æ”¹æºä»£ç éƒ½éœ€è¦\n\n1. è¿è¡Œ`yarn build react/index,react/jsx,react-dom/index,scheduler --type=NODE`é‡æ–°æ‰“åŒ…\n2. åˆ·æ–°ä¸€ä¸‹æˆ‘ä»¬çš„é¡µé¢\n3. ç¡®å®å¾ˆéº»çƒ¦ç›®å‰æ²¡æœ‰å¥½çš„ä¸»æ„\n   1. å¯èƒ½è¿™å°±æ˜¯ä¿®è¡Œå§ï¼\n\n# ç»“è¯­\n\næœ‰é—®é¢˜å¯ä»¥åœ¨ä¸‹æ–¹ç•™è¨€ï¼Œæ„Ÿè§‰æœ‰å¸®åŠ©ã€‚å¸®å¿™ç‚¹ä¸ªèµ","slug":"å…¨ç½‘æœ€å…¨Reactæºç è°ƒè¯•æ•™ç¨‹","published":1,"updated":"2021-06-24T14:00:06.855Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra8x002ilwrdd9h5976c","content":"<h1 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h1><p>ä¹‹å‰åœ¨é˜…è¯»Reactæºç çš„æ—¶å€™ï¼Œæƒ³è°ƒè¯•ä¸€ä¸‹ï¼Œç„¶ådebuggerçœ‹çœ‹å˜é‡å·²ç»æ•°æ®æ˜¯æ€ä¹ˆä¼ é€’çš„ï¼Œæ— å¥ˆã€‚è¿˜è¦è£…è¿™ä¹ˆå¤šä¸œè¥¿ã€‚è¸©äº†ä¸å°‘å‘ï¼Œè®°å½•ä¸€ä¸‹ã€‚å¸®åŠ©å¤§å®¶å°‘è¸©å‘ï¼Œä¹Ÿä¸ºè‡ªå·±åšä¸€ä¸ªç¬”è®°ã€‚</p>\n<h1 id=\"å‡†å¤‡å·¥ä½œ\"><a href=\"#å‡†å¤‡å·¥ä½œ\" class=\"headerlink\" title=\"å‡†å¤‡å·¥ä½œ\"></a>å‡†å¤‡å·¥ä½œ</h1><ul>\n<li><p><a href=\"https://nodejs.org/\" target=\"_blank\" rel=\"noopener\">Node</a> v8.0.0+ã€<a href=\"https://yarnpkg.com/en/\" target=\"_blank\" rel=\"noopener\">Yarn</a> v1.2.0+ã€‚</p>\n</li>\n<li><p>å·²å®‰è£… <a href=\"https://www.oracle.com/technetwork/java/javase/downloads/index.html\" target=\"_blank\" rel=\"noopener\">JDK</a>ã€‚</p>\n</li>\n<li><p>ä½ å·²å®‰è£… <code>gcc</code>ï¼ˆæˆ–è€…ä½ åœ¨æœ‰å¿…è¦å®‰è£…ç¼–è¯‘å™¨çš„æƒ…å†µä¸‹ä¹Ÿä¸è§‰å¾—éº»çƒ¦ï¼‰ï¼Œå› ä¸ºä¸€äº›ä¾èµ–å¯èƒ½å¾—ç»è¿‡ç¼–è¯‘ï¼Œè€Œåœ¨ OS Xï¼ŒXcode å‘½ä»¤è¡Œå·¥å…·ä¼šå¸®ä½ å¤„ç†ï¼›åœ¨ Ubuntuï¼Œ<code>apt-get install build-essential</code> ä¼šå®‰è£…æ‰€éœ€çš„ packageï¼ˆå…¶å®ƒ Linux å‘è¡Œç‰ˆçš„ç±»ä¼¼å‘½ä»¤ä¹Ÿæœ‰æ•ˆï¼‰ï¼›åœ¨ Windows ä¸Šå¾—åšäº›é¢å¤–æ­¥éª¤ï¼Œè¯·å‚è€ƒ <a href=\"https://github.com/nodejs/node-gyp#installation\" target=\"_blank\" rel=\"noopener\"><code>node-gyp</code> å®‰è£…æ­¥éª¤</a>ã€‚</p>\n</li>\n<li><p>ç†Ÿæ‚‰ Gitã€‚</p>\n</li>\n<li><p>ä¸€ä¸ªå¯ä»¥è¿è¡ŒReacté¡¹ç›®ï¼ˆæœ¬æ–‡é‡‡ç”¨create-react-appï¼‰</p>\n</li>\n</ul>\n<h1 id=\"å¼€å§‹\"><a href=\"#å¼€å§‹\" class=\"headerlink\" title=\"å¼€å§‹\"></a>å¼€å§‹</h1><h2 id=\"1-è·å–æºä»£ç \"><a href=\"#1-è·å–æºä»£ç \" class=\"headerlink\" title=\"1.è·å–æºä»£ç \"></a>1.è·å–æºä»£ç </h2><ol>\n<li>æ‰“å¼€æºç åœ°å€ï¼š<a href=\"https://github.com/facebook/react\" target=\"_blank\" rel=\"noopener\">https://github.com/facebook/react</a></li>\n<li>å…‹éš†åˆ°è‡ªå·±çš„æœ¬åœ°<ol>\n<li>å¯ä»¥ä¸‹è½½zipè§£å‹</li>\n<li>ä¹Ÿå¯ä»¥Forkåˆ°è‡ªå·±çš„GitHubç„¶åClone<ol>\n<li>ä¸ªäººå»ºè®®æ˜¯Forkï¼Œç„¶åå¯ä»¥ä¿®æ”¹ï¼Œæ·»åŠ æ³¨é‡Šç­‰ç­‰ã€‚å¯ä»¥è®°å½•ä¸€ä¸‹è‡ªå·±å­¦ä¹ å†ç¨‹</li>\n</ol>\n</li>\n<li>ä¹Ÿå¯ä»¥ç›´æ¥Clone</li>\n</ol>\n</li>\n</ol>\n<h2 id=\"2-å»ºç«‹ä¾èµ–è¿æ¥\"><a href=\"#2-å»ºç«‹ä¾èµ–è¿æ¥\" class=\"headerlink\" title=\"2. å»ºç«‹ä¾èµ–è¿æ¥\"></a>2. å»ºç«‹ä¾èµ–è¿æ¥</h2><ol>\n<li>æ‰“å¼€é¡¹ç›®</li>\n<li>è¿è¡Œyarnå®‰è£…ä¾èµ–</li>\n<li>è¿è¡Œ<code>yarn build react/index,react/jsx,react-dom/index,scheduler --type=NODE</code>é‡æ–°æ‰“åŒ…</li>\n<li><code>cd build/node_modules/react</code>è¿›å…¥Reactè¿™ä¸ªåŒ…å†…éƒ¨</li>\n<li><code>yarn link</code>å»ºç«‹è¿æ¥</li>\n<li><code>cd åˆ°åŸæ¥çš„é¡¹ç›®è·¯å¾„</code>è¿”å›ï¼Œä¸ºäº†ä¸‹ä¸€æ¬¡è¿›å…¥react-domåšå‡†å¤‡</li>\n<li><code>cd build/node_modules/react-dom</code></li>\n<li><code>yarn link</code></li>\n</ol>\n<h2 id=\"3-æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥è°ƒè¯•çš„Reacté¡¹ç›®\"><a href=\"#3-æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥è°ƒè¯•çš„Reacté¡¹ç›®\" class=\"headerlink\" title=\"3.æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥è°ƒè¯•çš„Reacté¡¹ç›®\"></a>3.æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥è°ƒè¯•çš„Reacté¡¹ç›®</h2><p>è¿™é‡Œæˆ‘é‡‡ç”¨çš„æ˜¯<code>create-react-app</code></p>\n<ol>\n<li><code>npx create-react-app my-app</code></li>\n<li><code>cd my-app</code></li>\n</ol>\n<h2 id=\"4-è¿æ¥é¡¹ç›®å’ŒReactåº“\"><a href=\"#4-è¿æ¥é¡¹ç›®å’ŒReactåº“\" class=\"headerlink\" title=\"4. è¿æ¥é¡¹ç›®å’ŒReactåº“\"></a>4. è¿æ¥é¡¹ç›®å’ŒReactåº“</h2><ol>\n<li>åˆ é™¤åˆšåˆšå»ºç«‹çš„é¡¹ç›®çš„<code>node_modules</code>ä¸­çš„<code>react</code>å’Œ<code>react-dom</code></li>\n<li>æ‰“å¼€Reacté¡¹ç›®</li>\n<li><code>yarn link react react-dom</code></li>\n</ol>\n<h2 id=\"5-å¼€å§‹è°ƒè¯•\"><a href=\"#5-å¼€å§‹è°ƒè¯•\" class=\"headerlink\" title=\"5. å¼€å§‹è°ƒè¯•\"></a>5. å¼€å§‹è°ƒè¯•</h2><ol>\n<li><p>æ‰“å¼€æˆ‘ä»¬cloneçš„é¡¹ç›®</p>\n</li>\n<li><p>æ‰¾åˆ°æƒ³è¦è°ƒè¯•çš„åœ°æ–¹</p>\n<ol>\n<li>è¿™é‡Œæ”¹çš„åœ°æ–¹æ˜¯<code>packages/react-dom/src/client/ReactDOMLegacy.js</code></li>\n<li>å†…å®¹å¦‚ä¸‹</li>\n</ol>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export function render(</span><br><span class=\"line\">  element: React$Element&lt;any&gt;,</span><br><span class=\"line\">  container: Container,</span><br><span class=\"line\">  callback: ?Function,</span><br><span class=\"line\">) &#123;</span><br><span class=\"line\"><span class=\"addition\">+  console.log(222);</span></span><br><span class=\"line\">  if (__DEV__) &#123;</span><br><span class=\"line\">    console.error(</span><br><span class=\"line\">      'ReactDOM.render is no longer supported in React 18. Use createRoot ' +</span><br><span class=\"line\">        'instead. Until you switch to the new API, your app will behave as ' +</span><br><span class=\"line\">        \"if it's running React 17. Learn \" +</span><br><span class=\"line\">        'more: https://reactjs.org/link/switch-to-createroot',</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  invariant(</span><br><span class=\"line\">    isValidContainerLegacy(container),</span><br><span class=\"line\">    'Target container is not a DOM element.',</span><br><span class=\"line\">  );</span><br><span class=\"line\">  if (__DEV__) &#123;</span><br><span class=\"line\">    const isModernRoot =</span><br><span class=\"line\">      isContainerMarkedAsRoot(container) &amp;&amp;</span><br><span class=\"line\">      container._reactRootContainer <span class=\"comment\">=== undefined;</span></span><br><span class=\"line\">    if (isModernRoot) &#123;</span><br><span class=\"line\">      console.error(</span><br><span class=\"line\">        'You are calling ReactDOM.render() on a container that was previously ' +</span><br><span class=\"line\">          'passed to ReactDOM.createRoot(). This is not supported. ' +</span><br><span class=\"line\">          'Did you mean to call root.render(element)?',</span><br><span class=\"line\">      );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  return legacyRenderSubtreeIntoContainer(</span><br><span class=\"line\">    null,</span><br><span class=\"line\">    element,</span><br><span class=\"line\">    container,</span><br><span class=\"line\">    false,</span><br><span class=\"line\">    callback,</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>æ‰“å¼€Reactæºç çš„é¡¹ç›®</p>\n</li>\n<li><p>è¿è¡Œ<code>yarn build react/index,react/jsx,react-dom/index,scheduler --type=NODE</code>é‡æ–°æ‰“åŒ…</p>\n</li>\n<li><p>æ‰“å¼€æˆ‘ä»¬åˆ›å»ºçš„Reacté¡¹ç›®</p>\n</li>\n<li><p><code>yarn start</code></p>\n</li>\n<li><p>æ‰“å¼€æ§åˆ¶å°</p>\n</li>\n</ol>\n<p><img src=\"/\" class=\"lazyload\" data-src=\"/image/reactDebugger/console.png\"  alt=\"console\"></p>\n<h2 id=\"6-åç»­\"><a href=\"#6-åç»­\" class=\"headerlink\" title=\"6. åç»­\"></a>6. åç»­</h2><p>æ¯æ¬¡ä¿®æ”¹æºä»£ç éƒ½éœ€è¦</p>\n<ol>\n<li>è¿è¡Œ<code>yarn build react/index,react/jsx,react-dom/index,scheduler --type=NODE</code>é‡æ–°æ‰“åŒ…</li>\n<li>åˆ·æ–°ä¸€ä¸‹æˆ‘ä»¬çš„é¡µé¢</li>\n<li>ç¡®å®å¾ˆéº»çƒ¦ç›®å‰æ²¡æœ‰å¥½çš„ä¸»æ„<ol>\n<li>å¯èƒ½è¿™å°±æ˜¯ä¿®è¡Œå§ï¼</li>\n</ol>\n</li>\n</ol>\n<h1 id=\"ç»“è¯­\"><a href=\"#ç»“è¯­\" class=\"headerlink\" title=\"ç»“è¯­\"></a>ç»“è¯­</h1><p>æœ‰é—®é¢˜å¯ä»¥åœ¨ä¸‹æ–¹ç•™è¨€ï¼Œæ„Ÿè§‰æœ‰å¸®åŠ©ã€‚å¸®å¿™ç‚¹ä¸ªèµ</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h1><p>ä¹‹å‰åœ¨é˜…è¯»Reactæºç çš„æ—¶å€™ï¼Œæƒ³è°ƒè¯•ä¸€ä¸‹ï¼Œç„¶ådebuggerçœ‹çœ‹å˜é‡å·²ç»æ•°æ®æ˜¯æ€ä¹ˆä¼ é€’çš„ï¼Œæ— å¥ˆã€‚è¿˜è¦è£…è¿™ä¹ˆå¤šä¸œè¥¿ã€‚è¸©äº†ä¸å°‘å‘ï¼Œè®°å½•ä¸€ä¸‹ã€‚å¸®åŠ©å¤§å®¶å°‘è¸©å‘ï¼Œä¹Ÿä¸ºè‡ªå·±åšä¸€ä¸ªç¬”è®°ã€‚</p>\n<h1 id=\"å‡†å¤‡å·¥ä½œ\"><a href=\"#å‡†å¤‡å·¥ä½œ\" class=\"headerlink\" title=\"å‡†å¤‡å·¥ä½œ\"></a>å‡†å¤‡å·¥ä½œ</h1><ul>\n<li><p><a href=\"https://nodejs.org/\" target=\"_blank\" rel=\"noopener\">Node</a> v8.0.0+ã€<a href=\"https://yarnpkg.com/en/\" target=\"_blank\" rel=\"noopener\">Yarn</a> v1.2.0+ã€‚</p>\n</li>\n<li><p>å·²å®‰è£… <a href=\"https://www.oracle.com/technetwork/java/javase/downloads/index.html\" target=\"_blank\" rel=\"noopener\">JDK</a>ã€‚</p>\n</li>\n<li><p>ä½ å·²å®‰è£… <code>gcc</code>ï¼ˆæˆ–è€…ä½ åœ¨æœ‰å¿…è¦å®‰è£…ç¼–è¯‘å™¨çš„æƒ…å†µä¸‹ä¹Ÿä¸è§‰å¾—éº»çƒ¦ï¼‰ï¼Œå› ä¸ºä¸€äº›ä¾èµ–å¯èƒ½å¾—ç»è¿‡ç¼–è¯‘ï¼Œè€Œåœ¨ OS Xï¼ŒXcode å‘½ä»¤è¡Œå·¥å…·ä¼šå¸®ä½ å¤„ç†ï¼›åœ¨ Ubuntuï¼Œ<code>apt-get install build-essential</code> ä¼šå®‰è£…æ‰€éœ€çš„ packageï¼ˆå…¶å®ƒ Linux å‘è¡Œç‰ˆçš„ç±»ä¼¼å‘½ä»¤ä¹Ÿæœ‰æ•ˆï¼‰ï¼›åœ¨ Windows ä¸Šå¾—åšäº›é¢å¤–æ­¥éª¤ï¼Œè¯·å‚è€ƒ <a href=\"https://github.com/nodejs/node-gyp#installation\" target=\"_blank\" rel=\"noopener\"><code>node-gyp</code> å®‰è£…æ­¥éª¤</a>ã€‚</p>\n</li>\n<li><p>ç†Ÿæ‚‰ Gitã€‚</p>\n</li>\n<li><p>ä¸€ä¸ªå¯ä»¥è¿è¡ŒReacté¡¹ç›®ï¼ˆæœ¬æ–‡é‡‡ç”¨create-react-appï¼‰</p>\n</li>\n</ul>\n<h1 id=\"å¼€å§‹\"><a href=\"#å¼€å§‹\" class=\"headerlink\" title=\"å¼€å§‹\"></a>å¼€å§‹</h1><h2 id=\"1-è·å–æºä»£ç \"><a href=\"#1-è·å–æºä»£ç \" class=\"headerlink\" title=\"1.è·å–æºä»£ç \"></a>1.è·å–æºä»£ç </h2><ol>\n<li>æ‰“å¼€æºç åœ°å€ï¼š<a href=\"https://github.com/facebook/react\" target=\"_blank\" rel=\"noopener\">https://github.com/facebook/react</a></li>\n<li>å…‹éš†åˆ°è‡ªå·±çš„æœ¬åœ°<ol>\n<li>å¯ä»¥ä¸‹è½½zipè§£å‹</li>\n<li>ä¹Ÿå¯ä»¥Forkåˆ°è‡ªå·±çš„GitHubç„¶åClone<ol>\n<li>ä¸ªäººå»ºè®®æ˜¯Forkï¼Œç„¶åå¯ä»¥ä¿®æ”¹ï¼Œæ·»åŠ æ³¨é‡Šç­‰ç­‰ã€‚å¯ä»¥è®°å½•ä¸€ä¸‹è‡ªå·±å­¦ä¹ å†ç¨‹</li>\n</ol>\n</li>\n<li>ä¹Ÿå¯ä»¥ç›´æ¥Clone</li>\n</ol>\n</li>\n</ol>\n<h2 id=\"2-å»ºç«‹ä¾èµ–è¿æ¥\"><a href=\"#2-å»ºç«‹ä¾èµ–è¿æ¥\" class=\"headerlink\" title=\"2. å»ºç«‹ä¾èµ–è¿æ¥\"></a>2. å»ºç«‹ä¾èµ–è¿æ¥</h2><ol>\n<li>æ‰“å¼€é¡¹ç›®</li>\n<li>è¿è¡Œyarnå®‰è£…ä¾èµ–</li>\n<li>è¿è¡Œ<code>yarn build react/index,react/jsx,react-dom/index,scheduler --type=NODE</code>é‡æ–°æ‰“åŒ…</li>\n<li><code>cd build/node_modules/react</code>è¿›å…¥Reactè¿™ä¸ªåŒ…å†…éƒ¨</li>\n<li><code>yarn link</code>å»ºç«‹è¿æ¥</li>\n<li><code>cd åˆ°åŸæ¥çš„é¡¹ç›®è·¯å¾„</code>è¿”å›ï¼Œä¸ºäº†ä¸‹ä¸€æ¬¡è¿›å…¥react-domåšå‡†å¤‡</li>\n<li><code>cd build/node_modules/react-dom</code></li>\n<li><code>yarn link</code></li>\n</ol>\n<h2 id=\"3-æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥è°ƒè¯•çš„Reacté¡¹ç›®\"><a href=\"#3-æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥è°ƒè¯•çš„Reacté¡¹ç›®\" class=\"headerlink\" title=\"3.æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥è°ƒè¯•çš„Reacté¡¹ç›®\"></a>3.æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥è°ƒè¯•çš„Reacté¡¹ç›®</h2><p>è¿™é‡Œæˆ‘é‡‡ç”¨çš„æ˜¯<code>create-react-app</code></p>\n<ol>\n<li><code>npx create-react-app my-app</code></li>\n<li><code>cd my-app</code></li>\n</ol>\n<h2 id=\"4-è¿æ¥é¡¹ç›®å’ŒReactåº“\"><a href=\"#4-è¿æ¥é¡¹ç›®å’ŒReactåº“\" class=\"headerlink\" title=\"4. è¿æ¥é¡¹ç›®å’ŒReactåº“\"></a>4. è¿æ¥é¡¹ç›®å’ŒReactåº“</h2><ol>\n<li>åˆ é™¤åˆšåˆšå»ºç«‹çš„é¡¹ç›®çš„<code>node_modules</code>ä¸­çš„<code>react</code>å’Œ<code>react-dom</code></li>\n<li>æ‰“å¼€Reacté¡¹ç›®</li>\n<li><code>yarn link react react-dom</code></li>\n</ol>\n<h2 id=\"5-å¼€å§‹è°ƒè¯•\"><a href=\"#5-å¼€å§‹è°ƒè¯•\" class=\"headerlink\" title=\"5. å¼€å§‹è°ƒè¯•\"></a>5. å¼€å§‹è°ƒè¯•</h2><ol>\n<li><p>æ‰“å¼€æˆ‘ä»¬cloneçš„é¡¹ç›®</p>\n</li>\n<li><p>æ‰¾åˆ°æƒ³è¦è°ƒè¯•çš„åœ°æ–¹</p>\n<ol>\n<li>è¿™é‡Œæ”¹çš„åœ°æ–¹æ˜¯<code>packages/react-dom/src/client/ReactDOMLegacy.js</code></li>\n<li>å†…å®¹å¦‚ä¸‹</li>\n</ol>\n<figure class=\"highlight diff\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export function render(</span><br><span class=\"line\">  element: React$Element&lt;any&gt;,</span><br><span class=\"line\">  container: Container,</span><br><span class=\"line\">  callback: ?Function,</span><br><span class=\"line\">) &#123;</span><br><span class=\"line\"><span class=\"addition\">+  console.log(222);</span></span><br><span class=\"line\">  if (__DEV__) &#123;</span><br><span class=\"line\">    console.error(</span><br><span class=\"line\">      'ReactDOM.render is no longer supported in React 18. Use createRoot ' +</span><br><span class=\"line\">        'instead. Until you switch to the new API, your app will behave as ' +</span><br><span class=\"line\">        \"if it's running React 17. Learn \" +</span><br><span class=\"line\">        'more: https://reactjs.org/link/switch-to-createroot',</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  invariant(</span><br><span class=\"line\">    isValidContainerLegacy(container),</span><br><span class=\"line\">    'Target container is not a DOM element.',</span><br><span class=\"line\">  );</span><br><span class=\"line\">  if (__DEV__) &#123;</span><br><span class=\"line\">    const isModernRoot =</span><br><span class=\"line\">      isContainerMarkedAsRoot(container) &amp;&amp;</span><br><span class=\"line\">      container._reactRootContainer <span class=\"comment\">=== undefined;</span></span><br><span class=\"line\">    if (isModernRoot) &#123;</span><br><span class=\"line\">      console.error(</span><br><span class=\"line\">        'You are calling ReactDOM.render() on a container that was previously ' +</span><br><span class=\"line\">          'passed to ReactDOM.createRoot(). This is not supported. ' +</span><br><span class=\"line\">          'Did you mean to call root.render(element)?',</span><br><span class=\"line\">      );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  return legacyRenderSubtreeIntoContainer(</span><br><span class=\"line\">    null,</span><br><span class=\"line\">    element,</span><br><span class=\"line\">    container,</span><br><span class=\"line\">    false,</span><br><span class=\"line\">    callback,</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>æ‰“å¼€Reactæºç çš„é¡¹ç›®</p>\n</li>\n<li><p>è¿è¡Œ<code>yarn build react/index,react/jsx,react-dom/index,scheduler --type=NODE</code>é‡æ–°æ‰“åŒ…</p>\n</li>\n<li><p>æ‰“å¼€æˆ‘ä»¬åˆ›å»ºçš„Reacté¡¹ç›®</p>\n</li>\n<li><p><code>yarn start</code></p>\n</li>\n<li><p>æ‰“å¼€æ§åˆ¶å°</p>\n</li>\n</ol>\n<p><img src=\"/image/reactDebugger/console.png\" alt=\"console\"></p>\n<h2 id=\"6-åç»­\"><a href=\"#6-åç»­\" class=\"headerlink\" title=\"6. åç»­\"></a>6. åç»­</h2><p>æ¯æ¬¡ä¿®æ”¹æºä»£ç éƒ½éœ€è¦</p>\n<ol>\n<li>è¿è¡Œ<code>yarn build react/index,react/jsx,react-dom/index,scheduler --type=NODE</code>é‡æ–°æ‰“åŒ…</li>\n<li>åˆ·æ–°ä¸€ä¸‹æˆ‘ä»¬çš„é¡µé¢</li>\n<li>ç¡®å®å¾ˆéº»çƒ¦ç›®å‰æ²¡æœ‰å¥½çš„ä¸»æ„<ol>\n<li>å¯èƒ½è¿™å°±æ˜¯ä¿®è¡Œå§ï¼</li>\n</ol>\n</li>\n</ol>\n<h1 id=\"ç»“è¯­\"><a href=\"#ç»“è¯­\" class=\"headerlink\" title=\"ç»“è¯­\"></a>ç»“è¯­</h1><p>æœ‰é—®é¢˜å¯ä»¥åœ¨ä¸‹æ–¹ç•™è¨€ï¼Œæ„Ÿè§‰æœ‰å¸®åŠ©ã€‚å¸®å¿™ç‚¹ä¸ªèµ</p>\n"},{"title":"ã€å‰ç«¯è¿›é˜¶ã€‘ä»é›¶æ­å»ºå±äºä½ çš„è„šæ‰‹æ¶","date":"2020-06-06T13:41:06.000Z","_content":"# ç»™è‡ªå·±æ­å»ºä¸€ä¸ªè„šæ‰‹æ¶\n## èƒŒæ™¯\n\n### ä¸€ä¸¶è·³å‡ºèˆ’é€‚åŒº\n\nå¤§éƒ¨åˆ†å‰ç«¯é€‰æ‰‹ï¼Œä¹ŸåŒ…æ‹¬æˆ‘è‡ªå·±ï¼Œç»å¸¸éƒ½æ˜¯vue-cliï¼Œæˆ–è€…create-react-appä¸€æŠŠæ¢­ã€‚ä¸å¾—ä¸æ‰¿è®¤è¿™äº›è‘—åçš„è„šæ‰‹æ¶å†™çš„ç¡®å®å¥½ï¼Œèƒ½å¤Ÿç»™æˆ‘ä»¬åšé¡¹ç›®æé€Ÿã€‚ä½†æ˜¯ä¹…è€Œä¹…ä¹‹å¾ˆå®¹æ˜“è¿›å…¥è‡ªå·±çš„èˆ’é€‚åŒºï¼Œæœ€è¿‘ä¸æ˜¯å¾ˆæµè¡Œâ€œè·³å‡ºèˆ’é€‚åŒºâ€å—ï¼Ÿè€Œä¸”å„å¤§åŸ¹è®­æœºæ„éƒ½åšè´©å–ç„¦è™‘ï¼Œå°±ä¸ºäº†å¯ä»¥è®©æ›´å¤šçš„äººå¯ä»¥å»ä¹°è¯¾ã€‚\n\nè¿™é‡Œæˆ‘å°±ä¸è´©å–ç„¦è™‘äº†ã€‚å¤§å®¶æœ‰è‡ªå·±çš„é€‰æ‹©ï¼Œåªè¦è‡ªå·±ä¸åæ‚”å°±å¥½ã€‚\n\n### äºŒä¸¶å¸‚é¢ä¸Šè„šæ‰‹æ¶çš„ç¼ºé™·\n\nè™½ç„¶vue-cliç­‰è„šæ‰‹æ¶å·²ç»å¸ƒç½®å¥½äº†å¾ˆå¤šä¸œè¥¿ï¼ŒåŒ…æ‹¬routerï¼Œcssçš„è§£æç­‰ç­‰ã€‚\n\nä½†æ˜¯ï¼\n\nä½†æ˜¯å•Šï¼Œä½†æ˜¯è¿™äº›è„šæ‰‹æ¶å¹¶ä¸çŸ¥é“æˆ‘ä»¬å…¬å¸çš„æˆ–è€…è¯´æˆ‘ä»¬ä¸ªäººé¡¹ç›®çš„ç½‘ç»œè¯·æ±‚ï¼Œè€Œä¸”ç½‘ç»œè¯·æ±‚å†…éƒ¨æ€ä¹ˆå°è£…çš„ä¹Ÿæ²¡æœ‰ç»Ÿä¸€çš„å¤„ç†ã€‚ä¹Ÿä¸çŸ¥é“æˆ‘ä»¬çš„ä¸€äº›é€šç”¨çš„ç™»é™†é¡µç­‰ç­‰ã€‚è¿™äº›éƒ½éœ€è¦æˆ‘ä»¬é‡æ–°çš„CVä¸€ä¸‹ï¼Œæˆ–è€…è‡ªå·±é‡æ–°åšã€‚\n\n### ä¸‰ä¸¶è¿‡åˆ†ä½¿ç”¨åˆ«äººæ­å»ºçš„è„šæ‰‹æ¶å¯èƒ½ä¼šå¸¦æ¥ä»¥ä¸‹é—®é¢˜\n\n- å¿˜è®°ï¼Œæˆ–è€…ä¸çŸ¥é“webpackæˆ–è€…è·¯ç”±çš„é…ç½®ï¼Œç»å¸¸ä¼šåœ¨é¢è¯•çš„ä¸´æ—¶æŠ±ä½›è„šï¼Œä¸èƒ½å¤ŸçœŸæ­£çš„æŒæ¡ï¼Œç»ˆç©¶æ˜¯çº¸ä¸Šè°ˆå…µ\n- ä¸€äº›å¸¸è§çš„å‘ç‚¹éƒ½è¢«åˆ«äººè¸©è¿‡å¹¶é“ºå¥½è·¯äº†ï¼Œåœ¨ä¸äº†è§£åŸç†åˆæ²¡æœ‰è¸©è¿‡å‘çš„æƒ…å†µä¸‹å¦‚æœç¢°åˆ°é—®é¢˜å¾ˆå®¹æ˜“è€½è¯¯å¤§é‡çš„æ—¶é—´\n- ä¸€äº›æ–°æ¡†æ¶çš„å‡çº§ï¼Œåªèƒ½ç­‰åˆ«äººçš„cliç‰ˆæœ¬å‡çº§ä¹‹åæ‰å¯ä»¥äº«å—ã€‚æ…¢äººä¸€æ­¥ï¼\n- é…ç½®ä¸€äº›é¡¹ç›®ç›¸å…³çš„ä¸œè¥¿ï¼Œç»å¸¸éœ€è¦ç¿»çœ‹æ–‡æ¡£ã€‚\n- â€¦â€¦\n\n### å››ä¸¶åŸå› \n\næˆ‘ä»¬åšè„šæ‰‹æ¶æœ‰ä»¥ä¸‹å‡ ä¸ªåŸå› \n\n- å­¦ä¹ è„šæ‰‹æ¶çš„æ€æƒ³\n- äº†è§£è„šæ‰‹æ¶çš„æ„æˆ\n- çœç•¥ä¸€ä¸‹CVçš„æ“ä½œï¼Œæ›´å¿«æ›´çµæ´»çš„å¼€å§‹è‡ªå·±å…¬å¸æˆ–è€…è‡ªå·±ä¸ªäººé¡¹ç›®\n- å¯ä»¥æ·±å…¥çš„é…ç½®è‡ªå·±çš„é¡¹ç›®\n\n\n\n## å¼€å§‹\n\n### å‡†å¤‡å·¥ä½œ\n\n#### commander\n\nç”¨äºnode.jså‘½ä»¤è¡Œç•Œé¢çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚åŸºæœ¬ä¸Šæ˜¯å‰ç«¯è„šæ‰‹æ¶å¿…å¤‡çš„ã€‚\n\nè¿™é‡Œåªä»‹ç»\n\n- version\n- command\n- description\n- action\n\nç®€å•ä½¿ç”¨ï¼Œæ¯•ç«Ÿåªæ˜¯å…¥é—¨ï¼Œåç»­ä¸€äº›å¤æ‚çš„å®šåˆ¶åŒ–çš„å°±éœ€è¦å¤§å®¶è‡ªå·±å»æ¢ç´¢äº†ã€‚\n\nå¥½äº†ï¼Œæ”¶ï¼\n\næ€ä¹ˆç”¨ï¼Ÿ\n\n```js\nconst { program } = require('commander')\nprogram\n  .version(`react-cli-mobile ${packages.version}`)\n  .command('create <name>')\n  .description('åˆå§‹åŒ–æ¨¡æ¿')\n  .action((projectName, cmd) => {\n    const options = cleanArgs(cmd)\n    creator(projectName, options)\n  })\n```\n\n\n\n#### fs-extra\n\n**fs-extraæ¨¡å—æ˜¯ç³»ç»Ÿfsæ¨¡å—çš„æ‰©å±•ï¼Œæä¾›äº†æ›´å¤šä¾¿åˆ©çš„ APIï¼Œå¹¶ç»§æ‰¿äº†fsæ¨¡å—çš„ API**\n\nè¿™é‡Œåªä»‹ç»\n\n- ### copy å¤åˆ¶æ–‡ä»¶\n\n- existsSync\n\ncopyç”¨äºå¤åˆ¶ã€‚ç½‘ä¸Šçš„ä¸€äº›è„šæ‰‹æ¶æ•™ç¨‹ç”¨çš„æ˜¯[download-git-repo]åº“ã€‚æˆ‘å‘ç°è¿™ä¸ªåªèƒ½ä¸‹è½½æŸä¸ªä»“åº“çš„æ–‡ä»¶ï¼Œè¿™æ ·çš„è¯ä¼šå¯¼è‡´æˆ‘çš„é¡¹ç›®ä¼šæœ‰ä¸¤ä¸ªã€‚ä¸€ä¸ªç”¨äºè„šæ‰‹æ¶çš„ä»£ç ï¼Œå¦ä¸€ä¸ªæ˜¯templateçš„ä»“åº“ã€‚è¿™æ ·æˆ‘è§‰å¾—ä¸å¤ªé€‚åˆæˆ‘ï¼Œå› ä¸ºæˆ‘ä¸æ˜¯å¾ˆæƒ³æ‰¾è„šæ‰‹æ¶ä¸Šé¢ä¸‹å¤ªå¤šçš„åŠŸå¤«æäº¤äº’ï¼Œæˆ‘åªæ˜¯æƒ³å¯ä»¥æ›´æ–¹ä¾¿æ›´å¿«çš„æ–°å»ºæˆ‘çš„é¡¹ç›®ï¼Œè€Œä¸”æˆ‘ä¹Ÿä¸æƒ³å¼„ä¸¤ä¸ªä»“åº“ï¼Œæˆ‘è§‰å¾—æœ‰ç‚¹å¤šä½™ã€‚\n\nå½“ç„¶äº†ï¼Œè¿™åªä»£è¡¨æˆ‘çš„ä¸ªäººæƒ³æ³•ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œé€‰æ‹©ã€‚\n\n\n\næ€ä¹ˆç”¨ï¼Ÿ\n\n```js\nconst fs = require('fs-extra')\nif(fs.existsSync(targetDir)) {\n    console.error('ç›®å½•å·²ç»å­˜åœ¨')\n    return\n}\n\n// å¤åˆ¶æ¨¡æ¿æ–‡ä»¶\n  await fs.copy(src, dest)\n```\n\n\n\n#### path\n\nå¾ˆç®€å•ï¼Œå­—é¢æ„æ€ï¼Œä¸»è¦æ˜¯ç”¨äºé…åˆã€fs-extraã€‘è¿™ä¸ªåº“æ¥ä½¿ç”¨çš„ï¼Œä¸»è¦è¿˜æ˜¯ç»™copyæä¾›è·¯å¾„ï¼Œå°±ä¸å¤šä»‹ç»äº†\n\n\n\næ€ä¹ˆç”¨ï¼Ÿ\n\n```js\nconst path = require('path')\nconst src = path.resolve(__dirname, dir);\n\nconst dest = path.resolve(process.cwd(), projectName);\n\n// å¤åˆ¶æ¨¡æ¿æ–‡ä»¶\nawait fs.copy(src, dest)\n```\n\n\n\n\n\nokï¼Œè‡³æ­¤å·®ä¸å¤šæˆ‘ä»¬çš„ä¸€ä¸ªè„šæ‰‹æ¶å°±å¯ä»¥å‡ºæ¥äº†ï¼Œå…¶ä»–çš„ä¸€äº›logé¢œè‰²ï¼Œè·¯å¾„åˆ¤æ–­ï¼Œå•è¯å·®å¼‚ä¼˜åŒ–éƒ½ä¸åœ¨æœ¬æ¬¡ä»‹ç»çš„èŒƒå›´å†…ï¼Œæœ¬æ–‡ä¸»è¦æ˜¯å®Œæˆä¸€ä¸ªè„šæ‰‹æ¶ï¼Œç„¶åé‡å¤´æˆè¿˜æ˜¯è‡ªå·±çš„templateã€‚\n\n\n\n### æ­¥éª¤\n\n- æ–°å»ºä¸€ä¸ªè‡ªå·±çš„æ–‡ä»¶å¤¹\n- npm inité…ç½®\n- è·å–ç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯\n- æŠŠè‡ªå·±çš„åˆå§‹åŒ–é¡¹ç›®æ”¾åˆ°templateæ–‡ä»¶å¤¹ä¸‹é¢\n- cpoy è·¯å¾„å’Œè‡ªå·±templateçš„è·¯å¾„ï¼Œç„¶åå¤åˆ¶\n\n#### ä»£ç \n\nä»£ç çš„è¯è¿™é‡Œå°±ä¸è´´äº†\n\nå¤§å®¶å¯ä»¥ç›´æ¥åˆ° [react-cli-mobile]([https://github.com/DerrickTel/react-cli-mobile](react-cli-mobile))ä¸Šé¢çœ‹ï¼Œé‡Œé¢æœ‰ä¸€äº›æ›´åŠ ç»†å¾®çš„æ“ä½œã€‚\n\n\n\n## ç»“è¯­\n\næœ¬æ¥è‡ªå·±ä»webpacké…ç½®å¼€å§‹ï¼Œä»é›¶æ­å»ºä¸€ä¸ªç”±\n\n- fetch\n- webpack\n- lessï¼ˆé…ç½®äº†css module\n- react\n- react-routerï¼ˆå®ç°reactåŸç”Ÿæ‡’åŠ è½½ï¼‰\n- typescript\n- ç§»åŠ¨ç«¯é€‚é…ï¼ˆä½¿ç”¨VWé€‚é…ï¼‰\n- babelå…¼å®¹ä½ç‰ˆæœ¬\n\nå¤§å®¶å¯ä»¥\n\n- npm install react-cli-mobile -g\n- react-cli-mobile create xx\n- cd xx\n- npm install\n- npm start\n- æ‰“å¼€http://localhost:9000\n\næˆ–è€…ç›´æ¥æŸ¥çœ‹æºç \n\nå¤§å®¶å¯ä»¥ç›´æ¥åˆ° [react-cli-mobile]([https://github.com/DerrickTel/react-cli-mobile](react-cli-mobile))ä¸Šé¢çœ‹\n\n\n\n## æœ€åçš„æœ€å\n\nå“ªé‡Œå†™é”™äº†ï¼Œæˆ–è€…å†™çš„ä¸å¥½ï¼Œæˆ–è€…æœ‰ä¸æ‡‚çš„æ¬¢è¿å¤§å®¶åœ¨è¯„è®ºåŒºäº¤æµ\n\n> åç»­ä¼šç»§ç»­æ¨å‡ºä»é›¶é…ç½®ç§»åŠ¨ç«¯çš„webpackç­‰é…ç½®çš„æ–‡ç« ï¼æ¬¢è¿å¤§å®¶å…³æ³¨ç‚¹èµï¼è°¢è°¢ï¼\n\n","source":"_posts/å‰ç«¯è¿›é˜¶-é…ç½®ä½ è‡ªå·±çš„è„šæ‰‹æ¶.md","raw":"---\ntitle: ã€å‰ç«¯è¿›é˜¶ã€‘ä»é›¶æ­å»ºå±äºä½ çš„è„šæ‰‹æ¶\ndate: 2020-06-06 21:41:06\ntags: [è„šæ‰‹æ¶]\ncategory: [å‰ç«¯]\n---\n# ç»™è‡ªå·±æ­å»ºä¸€ä¸ªè„šæ‰‹æ¶\n## èƒŒæ™¯\n\n### ä¸€ä¸¶è·³å‡ºèˆ’é€‚åŒº\n\nå¤§éƒ¨åˆ†å‰ç«¯é€‰æ‰‹ï¼Œä¹ŸåŒ…æ‹¬æˆ‘è‡ªå·±ï¼Œç»å¸¸éƒ½æ˜¯vue-cliï¼Œæˆ–è€…create-react-appä¸€æŠŠæ¢­ã€‚ä¸å¾—ä¸æ‰¿è®¤è¿™äº›è‘—åçš„è„šæ‰‹æ¶å†™çš„ç¡®å®å¥½ï¼Œèƒ½å¤Ÿç»™æˆ‘ä»¬åšé¡¹ç›®æé€Ÿã€‚ä½†æ˜¯ä¹…è€Œä¹…ä¹‹å¾ˆå®¹æ˜“è¿›å…¥è‡ªå·±çš„èˆ’é€‚åŒºï¼Œæœ€è¿‘ä¸æ˜¯å¾ˆæµè¡Œâ€œè·³å‡ºèˆ’é€‚åŒºâ€å—ï¼Ÿè€Œä¸”å„å¤§åŸ¹è®­æœºæ„éƒ½åšè´©å–ç„¦è™‘ï¼Œå°±ä¸ºäº†å¯ä»¥è®©æ›´å¤šçš„äººå¯ä»¥å»ä¹°è¯¾ã€‚\n\nè¿™é‡Œæˆ‘å°±ä¸è´©å–ç„¦è™‘äº†ã€‚å¤§å®¶æœ‰è‡ªå·±çš„é€‰æ‹©ï¼Œåªè¦è‡ªå·±ä¸åæ‚”å°±å¥½ã€‚\n\n### äºŒä¸¶å¸‚é¢ä¸Šè„šæ‰‹æ¶çš„ç¼ºé™·\n\nè™½ç„¶vue-cliç­‰è„šæ‰‹æ¶å·²ç»å¸ƒç½®å¥½äº†å¾ˆå¤šä¸œè¥¿ï¼ŒåŒ…æ‹¬routerï¼Œcssçš„è§£æç­‰ç­‰ã€‚\n\nä½†æ˜¯ï¼\n\nä½†æ˜¯å•Šï¼Œä½†æ˜¯è¿™äº›è„šæ‰‹æ¶å¹¶ä¸çŸ¥é“æˆ‘ä»¬å…¬å¸çš„æˆ–è€…è¯´æˆ‘ä»¬ä¸ªäººé¡¹ç›®çš„ç½‘ç»œè¯·æ±‚ï¼Œè€Œä¸”ç½‘ç»œè¯·æ±‚å†…éƒ¨æ€ä¹ˆå°è£…çš„ä¹Ÿæ²¡æœ‰ç»Ÿä¸€çš„å¤„ç†ã€‚ä¹Ÿä¸çŸ¥é“æˆ‘ä»¬çš„ä¸€äº›é€šç”¨çš„ç™»é™†é¡µç­‰ç­‰ã€‚è¿™äº›éƒ½éœ€è¦æˆ‘ä»¬é‡æ–°çš„CVä¸€ä¸‹ï¼Œæˆ–è€…è‡ªå·±é‡æ–°åšã€‚\n\n### ä¸‰ä¸¶è¿‡åˆ†ä½¿ç”¨åˆ«äººæ­å»ºçš„è„šæ‰‹æ¶å¯èƒ½ä¼šå¸¦æ¥ä»¥ä¸‹é—®é¢˜\n\n- å¿˜è®°ï¼Œæˆ–è€…ä¸çŸ¥é“webpackæˆ–è€…è·¯ç”±çš„é…ç½®ï¼Œç»å¸¸ä¼šåœ¨é¢è¯•çš„ä¸´æ—¶æŠ±ä½›è„šï¼Œä¸èƒ½å¤ŸçœŸæ­£çš„æŒæ¡ï¼Œç»ˆç©¶æ˜¯çº¸ä¸Šè°ˆå…µ\n- ä¸€äº›å¸¸è§çš„å‘ç‚¹éƒ½è¢«åˆ«äººè¸©è¿‡å¹¶é“ºå¥½è·¯äº†ï¼Œåœ¨ä¸äº†è§£åŸç†åˆæ²¡æœ‰è¸©è¿‡å‘çš„æƒ…å†µä¸‹å¦‚æœç¢°åˆ°é—®é¢˜å¾ˆå®¹æ˜“è€½è¯¯å¤§é‡çš„æ—¶é—´\n- ä¸€äº›æ–°æ¡†æ¶çš„å‡çº§ï¼Œåªèƒ½ç­‰åˆ«äººçš„cliç‰ˆæœ¬å‡çº§ä¹‹åæ‰å¯ä»¥äº«å—ã€‚æ…¢äººä¸€æ­¥ï¼\n- é…ç½®ä¸€äº›é¡¹ç›®ç›¸å…³çš„ä¸œè¥¿ï¼Œç»å¸¸éœ€è¦ç¿»çœ‹æ–‡æ¡£ã€‚\n- â€¦â€¦\n\n### å››ä¸¶åŸå› \n\næˆ‘ä»¬åšè„šæ‰‹æ¶æœ‰ä»¥ä¸‹å‡ ä¸ªåŸå› \n\n- å­¦ä¹ è„šæ‰‹æ¶çš„æ€æƒ³\n- äº†è§£è„šæ‰‹æ¶çš„æ„æˆ\n- çœç•¥ä¸€ä¸‹CVçš„æ“ä½œï¼Œæ›´å¿«æ›´çµæ´»çš„å¼€å§‹è‡ªå·±å…¬å¸æˆ–è€…è‡ªå·±ä¸ªäººé¡¹ç›®\n- å¯ä»¥æ·±å…¥çš„é…ç½®è‡ªå·±çš„é¡¹ç›®\n\n\n\n## å¼€å§‹\n\n### å‡†å¤‡å·¥ä½œ\n\n#### commander\n\nç”¨äºnode.jså‘½ä»¤è¡Œç•Œé¢çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚åŸºæœ¬ä¸Šæ˜¯å‰ç«¯è„šæ‰‹æ¶å¿…å¤‡çš„ã€‚\n\nè¿™é‡Œåªä»‹ç»\n\n- version\n- command\n- description\n- action\n\nç®€å•ä½¿ç”¨ï¼Œæ¯•ç«Ÿåªæ˜¯å…¥é—¨ï¼Œåç»­ä¸€äº›å¤æ‚çš„å®šåˆ¶åŒ–çš„å°±éœ€è¦å¤§å®¶è‡ªå·±å»æ¢ç´¢äº†ã€‚\n\nå¥½äº†ï¼Œæ”¶ï¼\n\næ€ä¹ˆç”¨ï¼Ÿ\n\n```js\nconst { program } = require('commander')\nprogram\n  .version(`react-cli-mobile ${packages.version}`)\n  .command('create <name>')\n  .description('åˆå§‹åŒ–æ¨¡æ¿')\n  .action((projectName, cmd) => {\n    const options = cleanArgs(cmd)\n    creator(projectName, options)\n  })\n```\n\n\n\n#### fs-extra\n\n**fs-extraæ¨¡å—æ˜¯ç³»ç»Ÿfsæ¨¡å—çš„æ‰©å±•ï¼Œæä¾›äº†æ›´å¤šä¾¿åˆ©çš„ APIï¼Œå¹¶ç»§æ‰¿äº†fsæ¨¡å—çš„ API**\n\nè¿™é‡Œåªä»‹ç»\n\n- ### copy å¤åˆ¶æ–‡ä»¶\n\n- existsSync\n\ncopyç”¨äºå¤åˆ¶ã€‚ç½‘ä¸Šçš„ä¸€äº›è„šæ‰‹æ¶æ•™ç¨‹ç”¨çš„æ˜¯[download-git-repo]åº“ã€‚æˆ‘å‘ç°è¿™ä¸ªåªèƒ½ä¸‹è½½æŸä¸ªä»“åº“çš„æ–‡ä»¶ï¼Œè¿™æ ·çš„è¯ä¼šå¯¼è‡´æˆ‘çš„é¡¹ç›®ä¼šæœ‰ä¸¤ä¸ªã€‚ä¸€ä¸ªç”¨äºè„šæ‰‹æ¶çš„ä»£ç ï¼Œå¦ä¸€ä¸ªæ˜¯templateçš„ä»“åº“ã€‚è¿™æ ·æˆ‘è§‰å¾—ä¸å¤ªé€‚åˆæˆ‘ï¼Œå› ä¸ºæˆ‘ä¸æ˜¯å¾ˆæƒ³æ‰¾è„šæ‰‹æ¶ä¸Šé¢ä¸‹å¤ªå¤šçš„åŠŸå¤«æäº¤äº’ï¼Œæˆ‘åªæ˜¯æƒ³å¯ä»¥æ›´æ–¹ä¾¿æ›´å¿«çš„æ–°å»ºæˆ‘çš„é¡¹ç›®ï¼Œè€Œä¸”æˆ‘ä¹Ÿä¸æƒ³å¼„ä¸¤ä¸ªä»“åº“ï¼Œæˆ‘è§‰å¾—æœ‰ç‚¹å¤šä½™ã€‚\n\nå½“ç„¶äº†ï¼Œè¿™åªä»£è¡¨æˆ‘çš„ä¸ªäººæƒ³æ³•ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œé€‰æ‹©ã€‚\n\n\n\næ€ä¹ˆç”¨ï¼Ÿ\n\n```js\nconst fs = require('fs-extra')\nif(fs.existsSync(targetDir)) {\n    console.error('ç›®å½•å·²ç»å­˜åœ¨')\n    return\n}\n\n// å¤åˆ¶æ¨¡æ¿æ–‡ä»¶\n  await fs.copy(src, dest)\n```\n\n\n\n#### path\n\nå¾ˆç®€å•ï¼Œå­—é¢æ„æ€ï¼Œä¸»è¦æ˜¯ç”¨äºé…åˆã€fs-extraã€‘è¿™ä¸ªåº“æ¥ä½¿ç”¨çš„ï¼Œä¸»è¦è¿˜æ˜¯ç»™copyæä¾›è·¯å¾„ï¼Œå°±ä¸å¤šä»‹ç»äº†\n\n\n\næ€ä¹ˆç”¨ï¼Ÿ\n\n```js\nconst path = require('path')\nconst src = path.resolve(__dirname, dir);\n\nconst dest = path.resolve(process.cwd(), projectName);\n\n// å¤åˆ¶æ¨¡æ¿æ–‡ä»¶\nawait fs.copy(src, dest)\n```\n\n\n\n\n\nokï¼Œè‡³æ­¤å·®ä¸å¤šæˆ‘ä»¬çš„ä¸€ä¸ªè„šæ‰‹æ¶å°±å¯ä»¥å‡ºæ¥äº†ï¼Œå…¶ä»–çš„ä¸€äº›logé¢œè‰²ï¼Œè·¯å¾„åˆ¤æ–­ï¼Œå•è¯å·®å¼‚ä¼˜åŒ–éƒ½ä¸åœ¨æœ¬æ¬¡ä»‹ç»çš„èŒƒå›´å†…ï¼Œæœ¬æ–‡ä¸»è¦æ˜¯å®Œæˆä¸€ä¸ªè„šæ‰‹æ¶ï¼Œç„¶åé‡å¤´æˆè¿˜æ˜¯è‡ªå·±çš„templateã€‚\n\n\n\n### æ­¥éª¤\n\n- æ–°å»ºä¸€ä¸ªè‡ªå·±çš„æ–‡ä»¶å¤¹\n- npm inité…ç½®\n- è·å–ç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯\n- æŠŠè‡ªå·±çš„åˆå§‹åŒ–é¡¹ç›®æ”¾åˆ°templateæ–‡ä»¶å¤¹ä¸‹é¢\n- cpoy è·¯å¾„å’Œè‡ªå·±templateçš„è·¯å¾„ï¼Œç„¶åå¤åˆ¶\n\n#### ä»£ç \n\nä»£ç çš„è¯è¿™é‡Œå°±ä¸è´´äº†\n\nå¤§å®¶å¯ä»¥ç›´æ¥åˆ° [react-cli-mobile]([https://github.com/DerrickTel/react-cli-mobile](react-cli-mobile))ä¸Šé¢çœ‹ï¼Œé‡Œé¢æœ‰ä¸€äº›æ›´åŠ ç»†å¾®çš„æ“ä½œã€‚\n\n\n\n## ç»“è¯­\n\næœ¬æ¥è‡ªå·±ä»webpacké…ç½®å¼€å§‹ï¼Œä»é›¶æ­å»ºä¸€ä¸ªç”±\n\n- fetch\n- webpack\n- lessï¼ˆé…ç½®äº†css module\n- react\n- react-routerï¼ˆå®ç°reactåŸç”Ÿæ‡’åŠ è½½ï¼‰\n- typescript\n- ç§»åŠ¨ç«¯é€‚é…ï¼ˆä½¿ç”¨VWé€‚é…ï¼‰\n- babelå…¼å®¹ä½ç‰ˆæœ¬\n\nå¤§å®¶å¯ä»¥\n\n- npm install react-cli-mobile -g\n- react-cli-mobile create xx\n- cd xx\n- npm install\n- npm start\n- æ‰“å¼€http://localhost:9000\n\næˆ–è€…ç›´æ¥æŸ¥çœ‹æºç \n\nå¤§å®¶å¯ä»¥ç›´æ¥åˆ° [react-cli-mobile]([https://github.com/DerrickTel/react-cli-mobile](react-cli-mobile))ä¸Šé¢çœ‹\n\n\n\n## æœ€åçš„æœ€å\n\nå“ªé‡Œå†™é”™äº†ï¼Œæˆ–è€…å†™çš„ä¸å¥½ï¼Œæˆ–è€…æœ‰ä¸æ‡‚çš„æ¬¢è¿å¤§å®¶åœ¨è¯„è®ºåŒºäº¤æµ\n\n> åç»­ä¼šç»§ç»­æ¨å‡ºä»é›¶é…ç½®ç§»åŠ¨ç«¯çš„webpackç­‰é…ç½®çš„æ–‡ç« ï¼æ¬¢è¿å¤§å®¶å…³æ³¨ç‚¹èµï¼è°¢è°¢ï¼\n\n","slug":"å‰ç«¯è¿›é˜¶-é…ç½®ä½ è‡ªå·±çš„è„šæ‰‹æ¶","published":1,"updated":"2021-06-24T14:00:06.855Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra8y002nlwrd7yrvg3ix","content":"<h1 id=\"ç»™è‡ªå·±æ­å»ºä¸€ä¸ªè„šæ‰‹æ¶\"><a href=\"#ç»™è‡ªå·±æ­å»ºä¸€ä¸ªè„šæ‰‹æ¶\" class=\"headerlink\" title=\"ç»™è‡ªå·±æ­å»ºä¸€ä¸ªè„šæ‰‹æ¶\"></a>ç»™è‡ªå·±æ­å»ºä¸€ä¸ªè„šæ‰‹æ¶</h1><h2 id=\"èƒŒæ™¯\"><a href=\"#èƒŒæ™¯\" class=\"headerlink\" title=\"èƒŒæ™¯\"></a>èƒŒæ™¯</h2><h3 id=\"ä¸€ä¸¶è·³å‡ºèˆ’é€‚åŒº\"><a href=\"#ä¸€ä¸¶è·³å‡ºèˆ’é€‚åŒº\" class=\"headerlink\" title=\"ä¸€ä¸¶è·³å‡ºèˆ’é€‚åŒº\"></a>ä¸€ä¸¶è·³å‡ºèˆ’é€‚åŒº</h3><p>å¤§éƒ¨åˆ†å‰ç«¯é€‰æ‰‹ï¼Œä¹ŸåŒ…æ‹¬æˆ‘è‡ªå·±ï¼Œç»å¸¸éƒ½æ˜¯vue-cliï¼Œæˆ–è€…create-react-appä¸€æŠŠæ¢­ã€‚ä¸å¾—ä¸æ‰¿è®¤è¿™äº›è‘—åçš„è„šæ‰‹æ¶å†™çš„ç¡®å®å¥½ï¼Œèƒ½å¤Ÿç»™æˆ‘ä»¬åšé¡¹ç›®æé€Ÿã€‚ä½†æ˜¯ä¹…è€Œä¹…ä¹‹å¾ˆå®¹æ˜“è¿›å…¥è‡ªå·±çš„èˆ’é€‚åŒºï¼Œæœ€è¿‘ä¸æ˜¯å¾ˆæµè¡Œâ€œè·³å‡ºèˆ’é€‚åŒºâ€å—ï¼Ÿè€Œä¸”å„å¤§åŸ¹è®­æœºæ„éƒ½åšè´©å–ç„¦è™‘ï¼Œå°±ä¸ºäº†å¯ä»¥è®©æ›´å¤šçš„äººå¯ä»¥å»ä¹°è¯¾ã€‚</p>\n<p>è¿™é‡Œæˆ‘å°±ä¸è´©å–ç„¦è™‘äº†ã€‚å¤§å®¶æœ‰è‡ªå·±çš„é€‰æ‹©ï¼Œåªè¦è‡ªå·±ä¸åæ‚”å°±å¥½ã€‚</p>\n<h3 id=\"äºŒä¸¶å¸‚é¢ä¸Šè„šæ‰‹æ¶çš„ç¼ºé™·\"><a href=\"#äºŒä¸¶å¸‚é¢ä¸Šè„šæ‰‹æ¶çš„ç¼ºé™·\" class=\"headerlink\" title=\"äºŒä¸¶å¸‚é¢ä¸Šè„šæ‰‹æ¶çš„ç¼ºé™·\"></a>äºŒä¸¶å¸‚é¢ä¸Šè„šæ‰‹æ¶çš„ç¼ºé™·</h3><p>è™½ç„¶vue-cliç­‰è„šæ‰‹æ¶å·²ç»å¸ƒç½®å¥½äº†å¾ˆå¤šä¸œè¥¿ï¼ŒåŒ…æ‹¬routerï¼Œcssçš„è§£æç­‰ç­‰ã€‚</p>\n<p>ä½†æ˜¯ï¼</p>\n<p>ä½†æ˜¯å•Šï¼Œä½†æ˜¯è¿™äº›è„šæ‰‹æ¶å¹¶ä¸çŸ¥é“æˆ‘ä»¬å…¬å¸çš„æˆ–è€…è¯´æˆ‘ä»¬ä¸ªäººé¡¹ç›®çš„ç½‘ç»œè¯·æ±‚ï¼Œè€Œä¸”ç½‘ç»œè¯·æ±‚å†…éƒ¨æ€ä¹ˆå°è£…çš„ä¹Ÿæ²¡æœ‰ç»Ÿä¸€çš„å¤„ç†ã€‚ä¹Ÿä¸çŸ¥é“æˆ‘ä»¬çš„ä¸€äº›é€šç”¨çš„ç™»é™†é¡µç­‰ç­‰ã€‚è¿™äº›éƒ½éœ€è¦æˆ‘ä»¬é‡æ–°çš„CVä¸€ä¸‹ï¼Œæˆ–è€…è‡ªå·±é‡æ–°åšã€‚</p>\n<h3 id=\"ä¸‰ä¸¶è¿‡åˆ†ä½¿ç”¨åˆ«äººæ­å»ºçš„è„šæ‰‹æ¶å¯èƒ½ä¼šå¸¦æ¥ä»¥ä¸‹é—®é¢˜\"><a href=\"#ä¸‰ä¸¶è¿‡åˆ†ä½¿ç”¨åˆ«äººæ­å»ºçš„è„šæ‰‹æ¶å¯èƒ½ä¼šå¸¦æ¥ä»¥ä¸‹é—®é¢˜\" class=\"headerlink\" title=\"ä¸‰ä¸¶è¿‡åˆ†ä½¿ç”¨åˆ«äººæ­å»ºçš„è„šæ‰‹æ¶å¯èƒ½ä¼šå¸¦æ¥ä»¥ä¸‹é—®é¢˜\"></a>ä¸‰ä¸¶è¿‡åˆ†ä½¿ç”¨åˆ«äººæ­å»ºçš„è„šæ‰‹æ¶å¯èƒ½ä¼šå¸¦æ¥ä»¥ä¸‹é—®é¢˜</h3><ul>\n<li>å¿˜è®°ï¼Œæˆ–è€…ä¸çŸ¥é“webpackæˆ–è€…è·¯ç”±çš„é…ç½®ï¼Œç»å¸¸ä¼šåœ¨é¢è¯•çš„ä¸´æ—¶æŠ±ä½›è„šï¼Œä¸èƒ½å¤ŸçœŸæ­£çš„æŒæ¡ï¼Œç»ˆç©¶æ˜¯çº¸ä¸Šè°ˆå…µ</li>\n<li>ä¸€äº›å¸¸è§çš„å‘ç‚¹éƒ½è¢«åˆ«äººè¸©è¿‡å¹¶é“ºå¥½è·¯äº†ï¼Œåœ¨ä¸äº†è§£åŸç†åˆæ²¡æœ‰è¸©è¿‡å‘çš„æƒ…å†µä¸‹å¦‚æœç¢°åˆ°é—®é¢˜å¾ˆå®¹æ˜“è€½è¯¯å¤§é‡çš„æ—¶é—´</li>\n<li>ä¸€äº›æ–°æ¡†æ¶çš„å‡çº§ï¼Œåªèƒ½ç­‰åˆ«äººçš„cliç‰ˆæœ¬å‡çº§ä¹‹åæ‰å¯ä»¥äº«å—ã€‚æ…¢äººä¸€æ­¥ï¼</li>\n<li>é…ç½®ä¸€äº›é¡¹ç›®ç›¸å…³çš„ä¸œè¥¿ï¼Œç»å¸¸éœ€è¦ç¿»çœ‹æ–‡æ¡£ã€‚</li>\n<li>â€¦â€¦</li>\n</ul>\n<h3 id=\"å››ä¸¶åŸå› \"><a href=\"#å››ä¸¶åŸå› \" class=\"headerlink\" title=\"å››ä¸¶åŸå› \"></a>å››ä¸¶åŸå› </h3><p>æˆ‘ä»¬åšè„šæ‰‹æ¶æœ‰ä»¥ä¸‹å‡ ä¸ªåŸå› </p>\n<ul>\n<li>å­¦ä¹ è„šæ‰‹æ¶çš„æ€æƒ³</li>\n<li>äº†è§£è„šæ‰‹æ¶çš„æ„æˆ</li>\n<li>çœç•¥ä¸€ä¸‹CVçš„æ“ä½œï¼Œæ›´å¿«æ›´çµæ´»çš„å¼€å§‹è‡ªå·±å…¬å¸æˆ–è€…è‡ªå·±ä¸ªäººé¡¹ç›®</li>\n<li>å¯ä»¥æ·±å…¥çš„é…ç½®è‡ªå·±çš„é¡¹ç›®</li>\n</ul>\n<h2 id=\"å¼€å§‹\"><a href=\"#å¼€å§‹\" class=\"headerlink\" title=\"å¼€å§‹\"></a>å¼€å§‹</h2><h3 id=\"å‡†å¤‡å·¥ä½œ\"><a href=\"#å‡†å¤‡å·¥ä½œ\" class=\"headerlink\" title=\"å‡†å¤‡å·¥ä½œ\"></a>å‡†å¤‡å·¥ä½œ</h3><h4 id=\"commander\"><a href=\"#commander\" class=\"headerlink\" title=\"commander\"></a>commander</h4><p>ç”¨äºnode.jså‘½ä»¤è¡Œç•Œé¢çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚åŸºæœ¬ä¸Šæ˜¯å‰ç«¯è„šæ‰‹æ¶å¿…å¤‡çš„ã€‚</p>\n<p>è¿™é‡Œåªä»‹ç»</p>\n<ul>\n<li>version</li>\n<li>command</li>\n<li>description</li>\n<li>action</li>\n</ul>\n<p>ç®€å•ä½¿ç”¨ï¼Œæ¯•ç«Ÿåªæ˜¯å…¥é—¨ï¼Œåç»­ä¸€äº›å¤æ‚çš„å®šåˆ¶åŒ–çš„å°±éœ€è¦å¤§å®¶è‡ªå·±å»æ¢ç´¢äº†ã€‚</p>\n<p>å¥½äº†ï¼Œæ”¶ï¼</p>\n<p>æ€ä¹ˆç”¨ï¼Ÿ</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; program &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">'commander'</span>)</span><br><span class=\"line\">program</span><br><span class=\"line\">  .version(<span class=\"string\">`react-cli-mobile <span class=\"subst\">$&#123;packages.version&#125;</span>`</span>)</span><br><span class=\"line\">  .command(<span class=\"string\">'create &lt;name&gt;'</span>)</span><br><span class=\"line\">  .description(<span class=\"string\">'åˆå§‹åŒ–æ¨¡æ¿'</span>)</span><br><span class=\"line\">  .action(<span class=\"function\">(<span class=\"params\">projectName, cmd</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> options = cleanArgs(cmd)</span><br><span class=\"line\">    creator(projectName, options)</span><br><span class=\"line\">  &#125;)</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"fs-extra\"><a href=\"#fs-extra\" class=\"headerlink\" title=\"fs-extra\"></a>fs-extra</h4><p><strong>fs-extraæ¨¡å—æ˜¯ç³»ç»Ÿfsæ¨¡å—çš„æ‰©å±•ï¼Œæä¾›äº†æ›´å¤šä¾¿åˆ©çš„ APIï¼Œå¹¶ç»§æ‰¿äº†fsæ¨¡å—çš„ API</strong></p>\n<p>è¿™é‡Œåªä»‹ç»</p>\n<ul>\n<li><h3 id=\"copy-å¤åˆ¶æ–‡ä»¶\"><a href=\"#copy-å¤åˆ¶æ–‡ä»¶\" class=\"headerlink\" title=\"copy å¤åˆ¶æ–‡ä»¶\"></a>copy å¤åˆ¶æ–‡ä»¶</h3></li>\n<li><p>existsSync</p>\n</li>\n</ul>\n<p>copyç”¨äºå¤åˆ¶ã€‚ç½‘ä¸Šçš„ä¸€äº›è„šæ‰‹æ¶æ•™ç¨‹ç”¨çš„æ˜¯[download-git-repo]åº“ã€‚æˆ‘å‘ç°è¿™ä¸ªåªèƒ½ä¸‹è½½æŸä¸ªä»“åº“çš„æ–‡ä»¶ï¼Œè¿™æ ·çš„è¯ä¼šå¯¼è‡´æˆ‘çš„é¡¹ç›®ä¼šæœ‰ä¸¤ä¸ªã€‚ä¸€ä¸ªç”¨äºè„šæ‰‹æ¶çš„ä»£ç ï¼Œå¦ä¸€ä¸ªæ˜¯templateçš„ä»“åº“ã€‚è¿™æ ·æˆ‘è§‰å¾—ä¸å¤ªé€‚åˆæˆ‘ï¼Œå› ä¸ºæˆ‘ä¸æ˜¯å¾ˆæƒ³æ‰¾è„šæ‰‹æ¶ä¸Šé¢ä¸‹å¤ªå¤šçš„åŠŸå¤«æäº¤äº’ï¼Œæˆ‘åªæ˜¯æƒ³å¯ä»¥æ›´æ–¹ä¾¿æ›´å¿«çš„æ–°å»ºæˆ‘çš„é¡¹ç›®ï¼Œè€Œä¸”æˆ‘ä¹Ÿä¸æƒ³å¼„ä¸¤ä¸ªä»“åº“ï¼Œæˆ‘è§‰å¾—æœ‰ç‚¹å¤šä½™ã€‚</p>\n<p>å½“ç„¶äº†ï¼Œè¿™åªä»£è¡¨æˆ‘çš„ä¸ªäººæƒ³æ³•ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œé€‰æ‹©ã€‚</p>\n<p>æ€ä¹ˆç”¨ï¼Ÿ</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">'fs-extra'</span>)</span><br><span class=\"line\"><span class=\"keyword\">if</span>(fs.existsSync(targetDir)) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.error(<span class=\"string\">'ç›®å½•å·²ç»å­˜åœ¨'</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// å¤åˆ¶æ¨¡æ¿æ–‡ä»¶</span></span><br><span class=\"line\">  <span class=\"keyword\">await</span> fs.copy(src, dest)</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"path\"><a href=\"#path\" class=\"headerlink\" title=\"path\"></a>path</h4><p>å¾ˆç®€å•ï¼Œå­—é¢æ„æ€ï¼Œä¸»è¦æ˜¯ç”¨äºé…åˆã€fs-extraã€‘è¿™ä¸ªåº“æ¥ä½¿ç”¨çš„ï¼Œä¸»è¦è¿˜æ˜¯ç»™copyæä¾›è·¯å¾„ï¼Œå°±ä¸å¤šä»‹ç»äº†</p>\n<p>æ€ä¹ˆç”¨ï¼Ÿ</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> src = path.resolve(__dirname, dir);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> dest = path.resolve(process.cwd(), projectName);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// å¤åˆ¶æ¨¡æ¿æ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"keyword\">await</span> fs.copy(src, dest)</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>okï¼Œè‡³æ­¤å·®ä¸å¤šæˆ‘ä»¬çš„ä¸€ä¸ªè„šæ‰‹æ¶å°±å¯ä»¥å‡ºæ¥äº†ï¼Œå…¶ä»–çš„ä¸€äº›logé¢œè‰²ï¼Œè·¯å¾„åˆ¤æ–­ï¼Œå•è¯å·®å¼‚ä¼˜åŒ–éƒ½ä¸åœ¨æœ¬æ¬¡ä»‹ç»çš„èŒƒå›´å†…ï¼Œæœ¬æ–‡ä¸»è¦æ˜¯å®Œæˆä¸€ä¸ªè„šæ‰‹æ¶ï¼Œç„¶åé‡å¤´æˆè¿˜æ˜¯è‡ªå·±çš„templateã€‚</p>\n<h3 id=\"æ­¥éª¤\"><a href=\"#æ­¥éª¤\" class=\"headerlink\" title=\"æ­¥éª¤\"></a>æ­¥éª¤</h3><ul>\n<li>æ–°å»ºä¸€ä¸ªè‡ªå·±çš„æ–‡ä»¶å¤¹</li>\n<li>npm inité…ç½®</li>\n<li>è·å–ç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯</li>\n<li>æŠŠè‡ªå·±çš„åˆå§‹åŒ–é¡¹ç›®æ”¾åˆ°templateæ–‡ä»¶å¤¹ä¸‹é¢</li>\n<li>cpoy è·¯å¾„å’Œè‡ªå·±templateçš„è·¯å¾„ï¼Œç„¶åå¤åˆ¶</li>\n</ul>\n<h4 id=\"ä»£ç \"><a href=\"#ä»£ç \" class=\"headerlink\" title=\"ä»£ç \"></a>ä»£ç </h4><p>ä»£ç çš„è¯è¿™é‡Œå°±ä¸è´´äº†</p>\n<p>å¤§å®¶å¯ä»¥ç›´æ¥åˆ° <a href=\"[https://github.com/DerrickTel/react-cli-mobile](react-cli-mobile)\">react-cli-mobile</a>ä¸Šé¢çœ‹ï¼Œé‡Œé¢æœ‰ä¸€äº›æ›´åŠ ç»†å¾®çš„æ“ä½œã€‚</p>\n<h2 id=\"ç»“è¯­\"><a href=\"#ç»“è¯­\" class=\"headerlink\" title=\"ç»“è¯­\"></a>ç»“è¯­</h2><p>æœ¬æ¥è‡ªå·±ä»webpacké…ç½®å¼€å§‹ï¼Œä»é›¶æ­å»ºä¸€ä¸ªç”±</p>\n<ul>\n<li>fetch</li>\n<li>webpack</li>\n<li>lessï¼ˆé…ç½®äº†css module</li>\n<li>react</li>\n<li>react-routerï¼ˆå®ç°reactåŸç”Ÿæ‡’åŠ è½½ï¼‰</li>\n<li>typescript</li>\n<li>ç§»åŠ¨ç«¯é€‚é…ï¼ˆä½¿ç”¨VWé€‚é…ï¼‰</li>\n<li>babelå…¼å®¹ä½ç‰ˆæœ¬</li>\n</ul>\n<p>å¤§å®¶å¯ä»¥</p>\n<ul>\n<li>npm install react-cli-mobile -g</li>\n<li>react-cli-mobile create xx</li>\n<li>cd xx</li>\n<li>npm install</li>\n<li>npm start</li>\n<li>æ‰“å¼€<a href=\"http://localhost:9000\" target=\"_blank\" rel=\"noopener\">http://localhost:9000</a></li>\n</ul>\n<p>æˆ–è€…ç›´æ¥æŸ¥çœ‹æºç </p>\n<p>å¤§å®¶å¯ä»¥ç›´æ¥åˆ° <a href=\"[https://github.com/DerrickTel/react-cli-mobile](react-cli-mobile)\">react-cli-mobile</a>ä¸Šé¢çœ‹</p>\n<h2 id=\"æœ€åçš„æœ€å\"><a href=\"#æœ€åçš„æœ€å\" class=\"headerlink\" title=\"æœ€åçš„æœ€å\"></a>æœ€åçš„æœ€å</h2><p>å“ªé‡Œå†™é”™äº†ï¼Œæˆ–è€…å†™çš„ä¸å¥½ï¼Œæˆ–è€…æœ‰ä¸æ‡‚çš„æ¬¢è¿å¤§å®¶åœ¨è¯„è®ºåŒºäº¤æµ</p>\n<blockquote>\n<p>åç»­ä¼šç»§ç»­æ¨å‡ºä»é›¶é…ç½®ç§»åŠ¨ç«¯çš„webpackç­‰é…ç½®çš„æ–‡ç« ï¼æ¬¢è¿å¤§å®¶å…³æ³¨ç‚¹èµï¼è°¢è°¢ï¼</p>\n</blockquote>\n","site":{"data":{}},"cover":"/img/post.jpg","excerpt":"","more":"<h1 id=\"ç»™è‡ªå·±æ­å»ºä¸€ä¸ªè„šæ‰‹æ¶\"><a href=\"#ç»™è‡ªå·±æ­å»ºä¸€ä¸ªè„šæ‰‹æ¶\" class=\"headerlink\" title=\"ç»™è‡ªå·±æ­å»ºä¸€ä¸ªè„šæ‰‹æ¶\"></a>ç»™è‡ªå·±æ­å»ºä¸€ä¸ªè„šæ‰‹æ¶</h1><h2 id=\"èƒŒæ™¯\"><a href=\"#èƒŒæ™¯\" class=\"headerlink\" title=\"èƒŒæ™¯\"></a>èƒŒæ™¯</h2><h3 id=\"ä¸€ä¸¶è·³å‡ºèˆ’é€‚åŒº\"><a href=\"#ä¸€ä¸¶è·³å‡ºèˆ’é€‚åŒº\" class=\"headerlink\" title=\"ä¸€ä¸¶è·³å‡ºèˆ’é€‚åŒº\"></a>ä¸€ä¸¶è·³å‡ºèˆ’é€‚åŒº</h3><p>å¤§éƒ¨åˆ†å‰ç«¯é€‰æ‰‹ï¼Œä¹ŸåŒ…æ‹¬æˆ‘è‡ªå·±ï¼Œç»å¸¸éƒ½æ˜¯vue-cliï¼Œæˆ–è€…create-react-appä¸€æŠŠæ¢­ã€‚ä¸å¾—ä¸æ‰¿è®¤è¿™äº›è‘—åçš„è„šæ‰‹æ¶å†™çš„ç¡®å®å¥½ï¼Œèƒ½å¤Ÿç»™æˆ‘ä»¬åšé¡¹ç›®æé€Ÿã€‚ä½†æ˜¯ä¹…è€Œä¹…ä¹‹å¾ˆå®¹æ˜“è¿›å…¥è‡ªå·±çš„èˆ’é€‚åŒºï¼Œæœ€è¿‘ä¸æ˜¯å¾ˆæµè¡Œâ€œè·³å‡ºèˆ’é€‚åŒºâ€å—ï¼Ÿè€Œä¸”å„å¤§åŸ¹è®­æœºæ„éƒ½åšè´©å–ç„¦è™‘ï¼Œå°±ä¸ºäº†å¯ä»¥è®©æ›´å¤šçš„äººå¯ä»¥å»ä¹°è¯¾ã€‚</p>\n<p>è¿™é‡Œæˆ‘å°±ä¸è´©å–ç„¦è™‘äº†ã€‚å¤§å®¶æœ‰è‡ªå·±çš„é€‰æ‹©ï¼Œåªè¦è‡ªå·±ä¸åæ‚”å°±å¥½ã€‚</p>\n<h3 id=\"äºŒä¸¶å¸‚é¢ä¸Šè„šæ‰‹æ¶çš„ç¼ºé™·\"><a href=\"#äºŒä¸¶å¸‚é¢ä¸Šè„šæ‰‹æ¶çš„ç¼ºé™·\" class=\"headerlink\" title=\"äºŒä¸¶å¸‚é¢ä¸Šè„šæ‰‹æ¶çš„ç¼ºé™·\"></a>äºŒä¸¶å¸‚é¢ä¸Šè„šæ‰‹æ¶çš„ç¼ºé™·</h3><p>è™½ç„¶vue-cliç­‰è„šæ‰‹æ¶å·²ç»å¸ƒç½®å¥½äº†å¾ˆå¤šä¸œè¥¿ï¼ŒåŒ…æ‹¬routerï¼Œcssçš„è§£æç­‰ç­‰ã€‚</p>\n<p>ä½†æ˜¯ï¼</p>\n<p>ä½†æ˜¯å•Šï¼Œä½†æ˜¯è¿™äº›è„šæ‰‹æ¶å¹¶ä¸çŸ¥é“æˆ‘ä»¬å…¬å¸çš„æˆ–è€…è¯´æˆ‘ä»¬ä¸ªäººé¡¹ç›®çš„ç½‘ç»œè¯·æ±‚ï¼Œè€Œä¸”ç½‘ç»œè¯·æ±‚å†…éƒ¨æ€ä¹ˆå°è£…çš„ä¹Ÿæ²¡æœ‰ç»Ÿä¸€çš„å¤„ç†ã€‚ä¹Ÿä¸çŸ¥é“æˆ‘ä»¬çš„ä¸€äº›é€šç”¨çš„ç™»é™†é¡µç­‰ç­‰ã€‚è¿™äº›éƒ½éœ€è¦æˆ‘ä»¬é‡æ–°çš„CVä¸€ä¸‹ï¼Œæˆ–è€…è‡ªå·±é‡æ–°åšã€‚</p>\n<h3 id=\"ä¸‰ä¸¶è¿‡åˆ†ä½¿ç”¨åˆ«äººæ­å»ºçš„è„šæ‰‹æ¶å¯èƒ½ä¼šå¸¦æ¥ä»¥ä¸‹é—®é¢˜\"><a href=\"#ä¸‰ä¸¶è¿‡åˆ†ä½¿ç”¨åˆ«äººæ­å»ºçš„è„šæ‰‹æ¶å¯èƒ½ä¼šå¸¦æ¥ä»¥ä¸‹é—®é¢˜\" class=\"headerlink\" title=\"ä¸‰ä¸¶è¿‡åˆ†ä½¿ç”¨åˆ«äººæ­å»ºçš„è„šæ‰‹æ¶å¯èƒ½ä¼šå¸¦æ¥ä»¥ä¸‹é—®é¢˜\"></a>ä¸‰ä¸¶è¿‡åˆ†ä½¿ç”¨åˆ«äººæ­å»ºçš„è„šæ‰‹æ¶å¯èƒ½ä¼šå¸¦æ¥ä»¥ä¸‹é—®é¢˜</h3><ul>\n<li>å¿˜è®°ï¼Œæˆ–è€…ä¸çŸ¥é“webpackæˆ–è€…è·¯ç”±çš„é…ç½®ï¼Œç»å¸¸ä¼šåœ¨é¢è¯•çš„ä¸´æ—¶æŠ±ä½›è„šï¼Œä¸èƒ½å¤ŸçœŸæ­£çš„æŒæ¡ï¼Œç»ˆç©¶æ˜¯çº¸ä¸Šè°ˆå…µ</li>\n<li>ä¸€äº›å¸¸è§çš„å‘ç‚¹éƒ½è¢«åˆ«äººè¸©è¿‡å¹¶é“ºå¥½è·¯äº†ï¼Œåœ¨ä¸äº†è§£åŸç†åˆæ²¡æœ‰è¸©è¿‡å‘çš„æƒ…å†µä¸‹å¦‚æœç¢°åˆ°é—®é¢˜å¾ˆå®¹æ˜“è€½è¯¯å¤§é‡çš„æ—¶é—´</li>\n<li>ä¸€äº›æ–°æ¡†æ¶çš„å‡çº§ï¼Œåªèƒ½ç­‰åˆ«äººçš„cliç‰ˆæœ¬å‡çº§ä¹‹åæ‰å¯ä»¥äº«å—ã€‚æ…¢äººä¸€æ­¥ï¼</li>\n<li>é…ç½®ä¸€äº›é¡¹ç›®ç›¸å…³çš„ä¸œè¥¿ï¼Œç»å¸¸éœ€è¦ç¿»çœ‹æ–‡æ¡£ã€‚</li>\n<li>â€¦â€¦</li>\n</ul>\n<h3 id=\"å››ä¸¶åŸå› \"><a href=\"#å››ä¸¶åŸå› \" class=\"headerlink\" title=\"å››ä¸¶åŸå› \"></a>å››ä¸¶åŸå› </h3><p>æˆ‘ä»¬åšè„šæ‰‹æ¶æœ‰ä»¥ä¸‹å‡ ä¸ªåŸå› </p>\n<ul>\n<li>å­¦ä¹ è„šæ‰‹æ¶çš„æ€æƒ³</li>\n<li>äº†è§£è„šæ‰‹æ¶çš„æ„æˆ</li>\n<li>çœç•¥ä¸€ä¸‹CVçš„æ“ä½œï¼Œæ›´å¿«æ›´çµæ´»çš„å¼€å§‹è‡ªå·±å…¬å¸æˆ–è€…è‡ªå·±ä¸ªäººé¡¹ç›®</li>\n<li>å¯ä»¥æ·±å…¥çš„é…ç½®è‡ªå·±çš„é¡¹ç›®</li>\n</ul>\n<h2 id=\"å¼€å§‹\"><a href=\"#å¼€å§‹\" class=\"headerlink\" title=\"å¼€å§‹\"></a>å¼€å§‹</h2><h3 id=\"å‡†å¤‡å·¥ä½œ\"><a href=\"#å‡†å¤‡å·¥ä½œ\" class=\"headerlink\" title=\"å‡†å¤‡å·¥ä½œ\"></a>å‡†å¤‡å·¥ä½œ</h3><h4 id=\"commander\"><a href=\"#commander\" class=\"headerlink\" title=\"commander\"></a>commander</h4><p>ç”¨äºnode.jså‘½ä»¤è¡Œç•Œé¢çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚åŸºæœ¬ä¸Šæ˜¯å‰ç«¯è„šæ‰‹æ¶å¿…å¤‡çš„ã€‚</p>\n<p>è¿™é‡Œåªä»‹ç»</p>\n<ul>\n<li>version</li>\n<li>command</li>\n<li>description</li>\n<li>action</li>\n</ul>\n<p>ç®€å•ä½¿ç”¨ï¼Œæ¯•ç«Ÿåªæ˜¯å…¥é—¨ï¼Œåç»­ä¸€äº›å¤æ‚çš„å®šåˆ¶åŒ–çš„å°±éœ€è¦å¤§å®¶è‡ªå·±å»æ¢ç´¢äº†ã€‚</p>\n<p>å¥½äº†ï¼Œæ”¶ï¼</p>\n<p>æ€ä¹ˆç”¨ï¼Ÿ</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; program &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">'commander'</span>)</span><br><span class=\"line\">program</span><br><span class=\"line\">  .version(<span class=\"string\">`react-cli-mobile <span class=\"subst\">$&#123;packages.version&#125;</span>`</span>)</span><br><span class=\"line\">  .command(<span class=\"string\">'create &lt;name&gt;'</span>)</span><br><span class=\"line\">  .description(<span class=\"string\">'åˆå§‹åŒ–æ¨¡æ¿'</span>)</span><br><span class=\"line\">  .action(<span class=\"function\">(<span class=\"params\">projectName, cmd</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> options = cleanArgs(cmd)</span><br><span class=\"line\">    creator(projectName, options)</span><br><span class=\"line\">  &#125;)</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"fs-extra\"><a href=\"#fs-extra\" class=\"headerlink\" title=\"fs-extra\"></a>fs-extra</h4><p><strong>fs-extraæ¨¡å—æ˜¯ç³»ç»Ÿfsæ¨¡å—çš„æ‰©å±•ï¼Œæä¾›äº†æ›´å¤šä¾¿åˆ©çš„ APIï¼Œå¹¶ç»§æ‰¿äº†fsæ¨¡å—çš„ API</strong></p>\n<p>è¿™é‡Œåªä»‹ç»</p>\n<ul>\n<li><h3 id=\"copy-å¤åˆ¶æ–‡ä»¶\"><a href=\"#copy-å¤åˆ¶æ–‡ä»¶\" class=\"headerlink\" title=\"copy å¤åˆ¶æ–‡ä»¶\"></a>copy å¤åˆ¶æ–‡ä»¶</h3></li>\n<li><p>existsSync</p>\n</li>\n</ul>\n<p>copyç”¨äºå¤åˆ¶ã€‚ç½‘ä¸Šçš„ä¸€äº›è„šæ‰‹æ¶æ•™ç¨‹ç”¨çš„æ˜¯[download-git-repo]åº“ã€‚æˆ‘å‘ç°è¿™ä¸ªåªèƒ½ä¸‹è½½æŸä¸ªä»“åº“çš„æ–‡ä»¶ï¼Œè¿™æ ·çš„è¯ä¼šå¯¼è‡´æˆ‘çš„é¡¹ç›®ä¼šæœ‰ä¸¤ä¸ªã€‚ä¸€ä¸ªç”¨äºè„šæ‰‹æ¶çš„ä»£ç ï¼Œå¦ä¸€ä¸ªæ˜¯templateçš„ä»“åº“ã€‚è¿™æ ·æˆ‘è§‰å¾—ä¸å¤ªé€‚åˆæˆ‘ï¼Œå› ä¸ºæˆ‘ä¸æ˜¯å¾ˆæƒ³æ‰¾è„šæ‰‹æ¶ä¸Šé¢ä¸‹å¤ªå¤šçš„åŠŸå¤«æäº¤äº’ï¼Œæˆ‘åªæ˜¯æƒ³å¯ä»¥æ›´æ–¹ä¾¿æ›´å¿«çš„æ–°å»ºæˆ‘çš„é¡¹ç›®ï¼Œè€Œä¸”æˆ‘ä¹Ÿä¸æƒ³å¼„ä¸¤ä¸ªä»“åº“ï¼Œæˆ‘è§‰å¾—æœ‰ç‚¹å¤šä½™ã€‚</p>\n<p>å½“ç„¶äº†ï¼Œè¿™åªä»£è¡¨æˆ‘çš„ä¸ªäººæƒ³æ³•ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œé€‰æ‹©ã€‚</p>\n<p>æ€ä¹ˆç”¨ï¼Ÿ</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">'fs-extra'</span>)</span><br><span class=\"line\"><span class=\"keyword\">if</span>(fs.existsSync(targetDir)) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.error(<span class=\"string\">'ç›®å½•å·²ç»å­˜åœ¨'</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// å¤åˆ¶æ¨¡æ¿æ–‡ä»¶</span></span><br><span class=\"line\">  <span class=\"keyword\">await</span> fs.copy(src, dest)</span><br></pre></td></tr></table></figure>\n\n\n\n<h4 id=\"path\"><a href=\"#path\" class=\"headerlink\" title=\"path\"></a>path</h4><p>å¾ˆç®€å•ï¼Œå­—é¢æ„æ€ï¼Œä¸»è¦æ˜¯ç”¨äºé…åˆã€fs-extraã€‘è¿™ä¸ªåº“æ¥ä½¿ç”¨çš„ï¼Œä¸»è¦è¿˜æ˜¯ç»™copyæä¾›è·¯å¾„ï¼Œå°±ä¸å¤šä»‹ç»äº†</p>\n<p>æ€ä¹ˆç”¨ï¼Ÿ</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">'path'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> src = path.resolve(__dirname, dir);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> dest = path.resolve(process.cwd(), projectName);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// å¤åˆ¶æ¨¡æ¿æ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"keyword\">await</span> fs.copy(src, dest)</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n<p>okï¼Œè‡³æ­¤å·®ä¸å¤šæˆ‘ä»¬çš„ä¸€ä¸ªè„šæ‰‹æ¶å°±å¯ä»¥å‡ºæ¥äº†ï¼Œå…¶ä»–çš„ä¸€äº›logé¢œè‰²ï¼Œè·¯å¾„åˆ¤æ–­ï¼Œå•è¯å·®å¼‚ä¼˜åŒ–éƒ½ä¸åœ¨æœ¬æ¬¡ä»‹ç»çš„èŒƒå›´å†…ï¼Œæœ¬æ–‡ä¸»è¦æ˜¯å®Œæˆä¸€ä¸ªè„šæ‰‹æ¶ï¼Œç„¶åé‡å¤´æˆè¿˜æ˜¯è‡ªå·±çš„templateã€‚</p>\n<h3 id=\"æ­¥éª¤\"><a href=\"#æ­¥éª¤\" class=\"headerlink\" title=\"æ­¥éª¤\"></a>æ­¥éª¤</h3><ul>\n<li>æ–°å»ºä¸€ä¸ªè‡ªå·±çš„æ–‡ä»¶å¤¹</li>\n<li>npm inité…ç½®</li>\n<li>è·å–ç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯</li>\n<li>æŠŠè‡ªå·±çš„åˆå§‹åŒ–é¡¹ç›®æ”¾åˆ°templateæ–‡ä»¶å¤¹ä¸‹é¢</li>\n<li>cpoy è·¯å¾„å’Œè‡ªå·±templateçš„è·¯å¾„ï¼Œç„¶åå¤åˆ¶</li>\n</ul>\n<h4 id=\"ä»£ç \"><a href=\"#ä»£ç \" class=\"headerlink\" title=\"ä»£ç \"></a>ä»£ç </h4><p>ä»£ç çš„è¯è¿™é‡Œå°±ä¸è´´äº†</p>\n<p>å¤§å®¶å¯ä»¥ç›´æ¥åˆ° <a href=\"[https://github.com/DerrickTel/react-cli-mobile](react-cli-mobile)\">react-cli-mobile</a>ä¸Šé¢çœ‹ï¼Œé‡Œé¢æœ‰ä¸€äº›æ›´åŠ ç»†å¾®çš„æ“ä½œã€‚</p>\n<h2 id=\"ç»“è¯­\"><a href=\"#ç»“è¯­\" class=\"headerlink\" title=\"ç»“è¯­\"></a>ç»“è¯­</h2><p>æœ¬æ¥è‡ªå·±ä»webpacké…ç½®å¼€å§‹ï¼Œä»é›¶æ­å»ºä¸€ä¸ªç”±</p>\n<ul>\n<li>fetch</li>\n<li>webpack</li>\n<li>lessï¼ˆé…ç½®äº†css module</li>\n<li>react</li>\n<li>react-routerï¼ˆå®ç°reactåŸç”Ÿæ‡’åŠ è½½ï¼‰</li>\n<li>typescript</li>\n<li>ç§»åŠ¨ç«¯é€‚é…ï¼ˆä½¿ç”¨VWé€‚é…ï¼‰</li>\n<li>babelå…¼å®¹ä½ç‰ˆæœ¬</li>\n</ul>\n<p>å¤§å®¶å¯ä»¥</p>\n<ul>\n<li>npm install react-cli-mobile -g</li>\n<li>react-cli-mobile create xx</li>\n<li>cd xx</li>\n<li>npm install</li>\n<li>npm start</li>\n<li>æ‰“å¼€<a href=\"http://localhost:9000\" target=\"_blank\" rel=\"noopener\">http://localhost:9000</a></li>\n</ul>\n<p>æˆ–è€…ç›´æ¥æŸ¥çœ‹æºç </p>\n<p>å¤§å®¶å¯ä»¥ç›´æ¥åˆ° <a href=\"[https://github.com/DerrickTel/react-cli-mobile](react-cli-mobile)\">react-cli-mobile</a>ä¸Šé¢çœ‹</p>\n<h2 id=\"æœ€åçš„æœ€å\"><a href=\"#æœ€åçš„æœ€å\" class=\"headerlink\" title=\"æœ€åçš„æœ€å\"></a>æœ€åçš„æœ€å</h2><p>å“ªé‡Œå†™é”™äº†ï¼Œæˆ–è€…å†™çš„ä¸å¥½ï¼Œæˆ–è€…æœ‰ä¸æ‡‚çš„æ¬¢è¿å¤§å®¶åœ¨è¯„è®ºåŒºäº¤æµ</p>\n<blockquote>\n<p>åç»­ä¼šç»§ç»­æ¨å‡ºä»é›¶é…ç½®ç§»åŠ¨ç«¯çš„webpackç­‰é…ç½®çš„æ–‡ç« ï¼æ¬¢è¿å¤§å®¶å…³æ³¨ç‚¹èµï¼è°¢è°¢ï¼</p>\n</blockquote>\n"},{"title":"è£…é¥°å™¨(Decorator)å’ŒReacté«˜é˜¶ç»„ä»¶(HOC)","date":"2019-09-15T13:59:48.000Z","cover":"/image/cover/decorator.png","_content":"## ä»€ä¹ˆæ˜¯è£…é¥°å™¨(Decorator)\nè£…é¥°å™¨ï¼ˆDecoratorï¼‰æ˜¯ä¸€ç§`ä¸ç±»ï¼ˆclassï¼‰ç›¸å…³`çš„è¯­æ³•ï¼Œç”¨æ¥æ³¨é‡Šæˆ–ä¿®æ”¹ç±»å’Œç±»æ–¹æ³•ã€‚\nè£…é¥°å™¨æ˜¯ä¸€ç§å‡½æ•°ï¼Œå†™æˆ`@ + å‡½æ•°å`ã€‚å®ƒå¯ä»¥æ”¾åœ¨ç±»å’Œç±»æ–¹æ³•çš„å®šä¹‰å‰é¢ã€‚\nå…¶å®åªæ˜¯ä¸€ä¸ªè¯­æ³•ç³–. è¿˜æ²¡æœ‰æ­£å¼å‘å¸ƒ, è¿˜éœ€è¦æ’ä»¶`babel-plugin-transform-decorators-legacy`ä½¿ç”¨\n## è£…é¥°å™¨(Decorator)ä½¿ç”¨\n\n### ç±»çš„è£…é¥°å™¨\n\n```javascript\n@testable\nclass MyTestableClass {\n  // ...\n}\n\nfunction testable(target) {\n  target.isTestable = true;\n}\n\nMyTestableClass.isTestable // true\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œ`@testable`å°±æ˜¯ä¸€ä¸ªè£…é¥°å™¨ã€‚å®ƒä¿®æ”¹äº†`MyTestableClass`è¿™ä¸ªç±»çš„è¡Œä¸ºï¼Œä¸ºå®ƒåŠ ä¸Šäº†é™æ€å±æ€§`isTestable`ã€‚`testable`å‡½æ•°çš„å‚æ•°`target`æ˜¯`MyTestableClass`ç±»æœ¬èº«ã€‚\n\nä¹Ÿå°±æ˜¯è¯´ï¼Œè£…é¥°å™¨æ˜¯ä¸€ä¸ªå¯¹ç±»è¿›è¡Œå¤„ç†çš„å‡½æ•°ã€‚è£…é¥°å™¨å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå°±æ˜¯æ‰€è¦è£…é¥°çš„ç›®æ ‡ç±»ã€‚\n\n```javascript\nfunction testable(target) {\n  // ...\n}\n```\nå¦‚æœæƒ³ä¼ å‚ï¼Œå¯ä»¥åœ¨è£…é¥°å™¨å¤–é¢å†å°è£…ä¸€å±‚å‡½æ•°ã€‚\n\n```javascript\nfunction testable(isTestable) {\n  return function(target) {\n    target.isTestable = isTestable;\n  }\n}\n\n@testable(true)\nclass MyTestableClass {}\nMyTestableClass.isTestable // true\n\n@testable(false)\nclass MyClass {}\nMyClass.isTestable // false\n```\nä¸Šé¢ä»£ç ä¸­ï¼Œè£…é¥°å™¨`testable`å¯ä»¥æ¥å—å‚æ•°ï¼Œè¿™å°±ç­‰äºå¯ä»¥ä¿®æ”¹è£…é¥°å™¨çš„è¡Œä¸ºã€‚\n\næ³¨æ„ï¼Œè£…é¥°å™¨å¯¹ç±»çš„è¡Œä¸ºçš„æ”¹å˜ï¼Œæ˜¯ä»£ç ç¼–è¯‘æ—¶å‘ç”Ÿçš„ï¼Œè€Œä¸æ˜¯åœ¨è¿è¡Œæ—¶ã€‚è¿™æ„å‘³ç€ï¼Œè£…é¥°å™¨èƒ½åœ¨ç¼–è¯‘é˜¶æ®µè¿è¡Œä»£ç ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè£…é¥°å™¨æœ¬è´¨å°±æ˜¯ç¼–è¯‘æ—¶æ‰§è¡Œçš„å‡½æ•°ã€‚\n\nå‰é¢çš„ä¾‹å­æ˜¯ä¸ºç±»æ·»åŠ ä¸€ä¸ªé™æ€å±æ€§ï¼Œå¦‚æœæƒ³æ·»åŠ å®ä¾‹å±æ€§ï¼Œå¯ä»¥é€šè¿‡ç›®æ ‡ç±»çš„`prototype`å¯¹è±¡æ“ä½œã€‚\n\n```javascript\nfunction testable(target) {\n  target.prototype.isTestable = true;\n}\n\n@testable\nclass MyTestableClass {}\n\nlet obj = new MyTestableClass();\nobj.isTestable // true\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œè£…é¥°å™¨å‡½æ•°`testable`æ˜¯åœ¨ç›®æ ‡ç±»çš„`prototype`å¯¹è±¡ä¸Šæ·»åŠ å±æ€§ï¼Œå› æ­¤å°±å¯ä»¥åœ¨å®ä¾‹ä¸Šè°ƒç”¨ã€‚\n\n\n\n```javascript\nfunction testable(target) {\n  target.prototype.isTestable = true;\n}\n\n@testable\nclass MyTestableClass {}\n\nlet obj = new MyTestableClass();\nobj.isTestable // true\n```\n\n\n - å®é™…å¼€å‘ä¸­ï¼ŒReact ä¸ Redux åº“ç»“åˆä½¿ç”¨æ—¶\n\nå¸¸å¸¸éœ€è¦å†™æˆä¸‹é¢è¿™æ ·\n\n```javascript\nclass MyReactComponent extends React.Component {}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(MyReactComponent);\n```\n\næœ‰äº†è£…é¥°å™¨ï¼Œå°±å¯ä»¥æ”¹å†™ä¸Šé¢çš„ä»£ç ã€‚\n\n```javascript\n@connect(mapStateToProps, mapDispatchToProps)\nexport default class MyReactComponent extends React.Component {}\n```\n### ç±»çš„æ–¹æ³•çš„è£…é¥°å™¨\n\n```javascript\nfunction readonly(target, name, descriptor){\n  // descriptorå¯¹è±¡åŸæ¥çš„å€¼å¦‚ä¸‹\n  // {\n  //   value: specifiedFunction,\n  //   enumerable: false,\n  //   configurable: true,\n  //   writable: true\n  // };\n  descriptor.writable = false;\n  return descriptor;\n}\n\nreadonly(Person.prototype, 'name', descriptor);\n// ç±»ä¼¼äº\nObject.defineProperty(Person.prototype, 'name', descriptor);\n```\nè£…é¥°å™¨ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»çš„åŸå‹å¯¹è±¡ï¼Œä¸Šä¾‹æ˜¯`Person.prototype`ï¼Œè£…é¥°å™¨çš„æœ¬æ„æ˜¯è¦â€œè£…é¥°â€ç±»çš„å®ä¾‹ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™å®ä¾‹è¿˜æ²¡ç”Ÿæˆï¼Œæ‰€ä»¥åªèƒ½å»è£…é¥°åŸå‹ï¼ˆè¿™ä¸åŒäºç±»çš„è£…é¥°ï¼Œé‚£ç§æƒ…å†µæ—¶`target`å‚æ•°æŒ‡çš„æ˜¯ç±»æœ¬èº«ï¼‰ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ‰€è¦è£…é¥°çš„å±æ€§åï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è¯¥å±æ€§çš„æè¿°å¯¹è±¡ã€‚\n\n> å…¶ä½™ä½¿ç”¨æ–¹æ³•ä¸ç±»çš„è£…é¥°å™¨ç›¸åŒ(å‚æ•°å˜ä¸º3ä¸ªäº†~)\n\n### å¤šä¸ªè£…é¥°å™¨\nå¦‚æœåŒä¸€ä¸ªæ–¹æ³•æœ‰å¤šä¸ªè£…é¥°å™¨ï¼Œä¼šåƒå‰¥æ´‹è‘±ä¸€æ ·ï¼Œå…ˆä»å¤–åˆ°å†…è¿›å…¥ï¼Œç„¶åç”±å†…å‘å¤–æ‰§è¡Œã€‚\n\n```javascript\nfunction dec(id){\n  console.log('evaluated', id);\n  return (target, property, descriptor) => console.log('executed', id);\n}\n\nclass Example {\n    @dec(1)\n    @dec(2)\n    method(){}\n}\n// evaluated 1\n// evaluated 2\n// executed 2\n// executed 1\n```\n### è£…é¥°å™¨ä¸èƒ½ä½œç”¨äºå‡½æ•°\n\nè£…é¥°å™¨åªèƒ½ç”¨äºç±»å’Œç±»çš„æ–¹æ³•ï¼Œä¸èƒ½ç”¨äºå‡½æ•°ï¼Œå› ä¸ºå­˜åœ¨å‡½æ•°æå‡ã€‚\n\n## Reacté«˜é˜¶ç»„ä»¶(HOC)\n\n```react\nimport React from 'react';\n\nexport default Component => class extends React.Component {\n  render() {\n    return <div style={{cursor: 'pointer', display: 'inline-block'}}>\n      <Component/>\n    </div>\n  }\n}\n```\nè¿™ä¸ªè£…é¥°å™¨ï¼ˆé«˜é˜¶ç»„ä»¶ï¼‰æ¥å—ä¸€ä¸ª React ç»„ä»¶ä½œä¸ºå‚æ•°ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ–°çš„ React ç»„ä»¶ã€‚å®ç°å¾ˆç®€å•ï¼Œå°±æ˜¯åŒ…è£¹äº†ä¸€å±‚ divï¼Œæ·»åŠ äº†ä¸€ä¸ª styleï¼Œå°±è¿™ä¹ˆç®€å•ã€‚ä»¥åæ‰€æœ‰è¢«å®ƒè£…é¥°çš„ç»„ä»¶éƒ½ä¼šå…·æœ‰è¿™ä¸ªç‰¹å¾ã€‚\né™¤äº†styleè¿˜å¯ä»¥ä¼ å‚æ•°\n```react\nimport React from 'react';\n\nexport default Component => class extends React.Component {\n  render() {\n    return <div test={'qwe'}>\n      <Component/>\n    </div>\n  }\n}\n```\nä»¥åæ‰€æœ‰è¢«å®ƒè£…é¥°çš„ç»„ä»¶éƒ½å¯ä»¥ä»`props`é‡Œé¢è·å–åˆ°`test`. ä»–çš„å€¼æ˜¯`'qwe'`ã€‚\n\n## æ‰©å±•\nå‘æŒ¥ä½ çš„æƒ³è±¡, ä½ å¯ä»¥å†™æ— æ•°ä¸ªå¾ˆæ–¹ä¾¿çš„é«˜é˜¶ç»„ä»¶, é€šè¿‡è£…é¥°å™¨çš„æ–¹å¼, è®©ä½ çš„ä»£ç æ›´ç®€æ´, æ›´å¸…\n\nç´¢å¼•\n\n> http://es6.ruanyifeng.com/#docs/decorator","source":"_posts/è£…é¥°å™¨(Decorator)å’ŒReacté«˜é˜¶ç»„ä»¶(HOC).md","raw":"---\ntitle: è£…é¥°å™¨(Decorator)å’ŒReacté«˜é˜¶ç»„ä»¶(HOC)\ndate: 2019-09-15 21:59:48\ntags: [React, ES6]\ncategory: [ES6]\ncover: /image/cover/decorator.png\n---\n## ä»€ä¹ˆæ˜¯è£…é¥°å™¨(Decorator)\nè£…é¥°å™¨ï¼ˆDecoratorï¼‰æ˜¯ä¸€ç§`ä¸ç±»ï¼ˆclassï¼‰ç›¸å…³`çš„è¯­æ³•ï¼Œç”¨æ¥æ³¨é‡Šæˆ–ä¿®æ”¹ç±»å’Œç±»æ–¹æ³•ã€‚\nè£…é¥°å™¨æ˜¯ä¸€ç§å‡½æ•°ï¼Œå†™æˆ`@ + å‡½æ•°å`ã€‚å®ƒå¯ä»¥æ”¾åœ¨ç±»å’Œç±»æ–¹æ³•çš„å®šä¹‰å‰é¢ã€‚\nå…¶å®åªæ˜¯ä¸€ä¸ªè¯­æ³•ç³–. è¿˜æ²¡æœ‰æ­£å¼å‘å¸ƒ, è¿˜éœ€è¦æ’ä»¶`babel-plugin-transform-decorators-legacy`ä½¿ç”¨\n## è£…é¥°å™¨(Decorator)ä½¿ç”¨\n\n### ç±»çš„è£…é¥°å™¨\n\n```javascript\n@testable\nclass MyTestableClass {\n  // ...\n}\n\nfunction testable(target) {\n  target.isTestable = true;\n}\n\nMyTestableClass.isTestable // true\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œ`@testable`å°±æ˜¯ä¸€ä¸ªè£…é¥°å™¨ã€‚å®ƒä¿®æ”¹äº†`MyTestableClass`è¿™ä¸ªç±»çš„è¡Œä¸ºï¼Œä¸ºå®ƒåŠ ä¸Šäº†é™æ€å±æ€§`isTestable`ã€‚`testable`å‡½æ•°çš„å‚æ•°`target`æ˜¯`MyTestableClass`ç±»æœ¬èº«ã€‚\n\nä¹Ÿå°±æ˜¯è¯´ï¼Œè£…é¥°å™¨æ˜¯ä¸€ä¸ªå¯¹ç±»è¿›è¡Œå¤„ç†çš„å‡½æ•°ã€‚è£…é¥°å™¨å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå°±æ˜¯æ‰€è¦è£…é¥°çš„ç›®æ ‡ç±»ã€‚\n\n```javascript\nfunction testable(target) {\n  // ...\n}\n```\nå¦‚æœæƒ³ä¼ å‚ï¼Œå¯ä»¥åœ¨è£…é¥°å™¨å¤–é¢å†å°è£…ä¸€å±‚å‡½æ•°ã€‚\n\n```javascript\nfunction testable(isTestable) {\n  return function(target) {\n    target.isTestable = isTestable;\n  }\n}\n\n@testable(true)\nclass MyTestableClass {}\nMyTestableClass.isTestable // true\n\n@testable(false)\nclass MyClass {}\nMyClass.isTestable // false\n```\nä¸Šé¢ä»£ç ä¸­ï¼Œè£…é¥°å™¨`testable`å¯ä»¥æ¥å—å‚æ•°ï¼Œè¿™å°±ç­‰äºå¯ä»¥ä¿®æ”¹è£…é¥°å™¨çš„è¡Œä¸ºã€‚\n\næ³¨æ„ï¼Œè£…é¥°å™¨å¯¹ç±»çš„è¡Œä¸ºçš„æ”¹å˜ï¼Œæ˜¯ä»£ç ç¼–è¯‘æ—¶å‘ç”Ÿçš„ï¼Œè€Œä¸æ˜¯åœ¨è¿è¡Œæ—¶ã€‚è¿™æ„å‘³ç€ï¼Œè£…é¥°å™¨èƒ½åœ¨ç¼–è¯‘é˜¶æ®µè¿è¡Œä»£ç ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè£…é¥°å™¨æœ¬è´¨å°±æ˜¯ç¼–è¯‘æ—¶æ‰§è¡Œçš„å‡½æ•°ã€‚\n\nå‰é¢çš„ä¾‹å­æ˜¯ä¸ºç±»æ·»åŠ ä¸€ä¸ªé™æ€å±æ€§ï¼Œå¦‚æœæƒ³æ·»åŠ å®ä¾‹å±æ€§ï¼Œå¯ä»¥é€šè¿‡ç›®æ ‡ç±»çš„`prototype`å¯¹è±¡æ“ä½œã€‚\n\n```javascript\nfunction testable(target) {\n  target.prototype.isTestable = true;\n}\n\n@testable\nclass MyTestableClass {}\n\nlet obj = new MyTestableClass();\nobj.isTestable // true\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œè£…é¥°å™¨å‡½æ•°`testable`æ˜¯åœ¨ç›®æ ‡ç±»çš„`prototype`å¯¹è±¡ä¸Šæ·»åŠ å±æ€§ï¼Œå› æ­¤å°±å¯ä»¥åœ¨å®ä¾‹ä¸Šè°ƒç”¨ã€‚\n\n\n\n```javascript\nfunction testable(target) {\n  target.prototype.isTestable = true;\n}\n\n@testable\nclass MyTestableClass {}\n\nlet obj = new MyTestableClass();\nobj.isTestable // true\n```\n\n\n - å®é™…å¼€å‘ä¸­ï¼ŒReact ä¸ Redux åº“ç»“åˆä½¿ç”¨æ—¶\n\nå¸¸å¸¸éœ€è¦å†™æˆä¸‹é¢è¿™æ ·\n\n```javascript\nclass MyReactComponent extends React.Component {}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(MyReactComponent);\n```\n\næœ‰äº†è£…é¥°å™¨ï¼Œå°±å¯ä»¥æ”¹å†™ä¸Šé¢çš„ä»£ç ã€‚\n\n```javascript\n@connect(mapStateToProps, mapDispatchToProps)\nexport default class MyReactComponent extends React.Component {}\n```\n### ç±»çš„æ–¹æ³•çš„è£…é¥°å™¨\n\n```javascript\nfunction readonly(target, name, descriptor){\n  // descriptorå¯¹è±¡åŸæ¥çš„å€¼å¦‚ä¸‹\n  // {\n  //   value: specifiedFunction,\n  //   enumerable: false,\n  //   configurable: true,\n  //   writable: true\n  // };\n  descriptor.writable = false;\n  return descriptor;\n}\n\nreadonly(Person.prototype, 'name', descriptor);\n// ç±»ä¼¼äº\nObject.defineProperty(Person.prototype, 'name', descriptor);\n```\nè£…é¥°å™¨ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»çš„åŸå‹å¯¹è±¡ï¼Œä¸Šä¾‹æ˜¯`Person.prototype`ï¼Œè£…é¥°å™¨çš„æœ¬æ„æ˜¯è¦â€œè£…é¥°â€ç±»çš„å®ä¾‹ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™å®ä¾‹è¿˜æ²¡ç”Ÿæˆï¼Œæ‰€ä»¥åªèƒ½å»è£…é¥°åŸå‹ï¼ˆè¿™ä¸åŒäºç±»çš„è£…é¥°ï¼Œé‚£ç§æƒ…å†µæ—¶`target`å‚æ•°æŒ‡çš„æ˜¯ç±»æœ¬èº«ï¼‰ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ‰€è¦è£…é¥°çš„å±æ€§åï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è¯¥å±æ€§çš„æè¿°å¯¹è±¡ã€‚\n\n> å…¶ä½™ä½¿ç”¨æ–¹æ³•ä¸ç±»çš„è£…é¥°å™¨ç›¸åŒ(å‚æ•°å˜ä¸º3ä¸ªäº†~)\n\n### å¤šä¸ªè£…é¥°å™¨\nå¦‚æœåŒä¸€ä¸ªæ–¹æ³•æœ‰å¤šä¸ªè£…é¥°å™¨ï¼Œä¼šåƒå‰¥æ´‹è‘±ä¸€æ ·ï¼Œå…ˆä»å¤–åˆ°å†…è¿›å…¥ï¼Œç„¶åç”±å†…å‘å¤–æ‰§è¡Œã€‚\n\n```javascript\nfunction dec(id){\n  console.log('evaluated', id);\n  return (target, property, descriptor) => console.log('executed', id);\n}\n\nclass Example {\n    @dec(1)\n    @dec(2)\n    method(){}\n}\n// evaluated 1\n// evaluated 2\n// executed 2\n// executed 1\n```\n### è£…é¥°å™¨ä¸èƒ½ä½œç”¨äºå‡½æ•°\n\nè£…é¥°å™¨åªèƒ½ç”¨äºç±»å’Œç±»çš„æ–¹æ³•ï¼Œä¸èƒ½ç”¨äºå‡½æ•°ï¼Œå› ä¸ºå­˜åœ¨å‡½æ•°æå‡ã€‚\n\n## Reacté«˜é˜¶ç»„ä»¶(HOC)\n\n```react\nimport React from 'react';\n\nexport default Component => class extends React.Component {\n  render() {\n    return <div style={{cursor: 'pointer', display: 'inline-block'}}>\n      <Component/>\n    </div>\n  }\n}\n```\nè¿™ä¸ªè£…é¥°å™¨ï¼ˆé«˜é˜¶ç»„ä»¶ï¼‰æ¥å—ä¸€ä¸ª React ç»„ä»¶ä½œä¸ºå‚æ•°ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ–°çš„ React ç»„ä»¶ã€‚å®ç°å¾ˆç®€å•ï¼Œå°±æ˜¯åŒ…è£¹äº†ä¸€å±‚ divï¼Œæ·»åŠ äº†ä¸€ä¸ª styleï¼Œå°±è¿™ä¹ˆç®€å•ã€‚ä»¥åæ‰€æœ‰è¢«å®ƒè£…é¥°çš„ç»„ä»¶éƒ½ä¼šå…·æœ‰è¿™ä¸ªç‰¹å¾ã€‚\né™¤äº†styleè¿˜å¯ä»¥ä¼ å‚æ•°\n```react\nimport React from 'react';\n\nexport default Component => class extends React.Component {\n  render() {\n    return <div test={'qwe'}>\n      <Component/>\n    </div>\n  }\n}\n```\nä»¥åæ‰€æœ‰è¢«å®ƒè£…é¥°çš„ç»„ä»¶éƒ½å¯ä»¥ä»`props`é‡Œé¢è·å–åˆ°`test`. ä»–çš„å€¼æ˜¯`'qwe'`ã€‚\n\n## æ‰©å±•\nå‘æŒ¥ä½ çš„æƒ³è±¡, ä½ å¯ä»¥å†™æ— æ•°ä¸ªå¾ˆæ–¹ä¾¿çš„é«˜é˜¶ç»„ä»¶, é€šè¿‡è£…é¥°å™¨çš„æ–¹å¼, è®©ä½ çš„ä»£ç æ›´ç®€æ´, æ›´å¸…\n\nç´¢å¼•\n\n> http://es6.ruanyifeng.com/#docs/decorator","slug":"è£…é¥°å™¨(Decorator)å’ŒReacté«˜é˜¶ç»„ä»¶(HOC)","published":1,"updated":"2021-06-24T14:00:06.855Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra8z002qlwrdd7uo9oyk","content":"<h2 id=\"ä»€ä¹ˆæ˜¯è£…é¥°å™¨-Decorator\"><a href=\"#ä»€ä¹ˆæ˜¯è£…é¥°å™¨-Decorator\" class=\"headerlink\" title=\"ä»€ä¹ˆæ˜¯è£…é¥°å™¨(Decorator)\"></a>ä»€ä¹ˆæ˜¯è£…é¥°å™¨(Decorator)</h2><p>è£…é¥°å™¨ï¼ˆDecoratorï¼‰æ˜¯ä¸€ç§<code>ä¸ç±»ï¼ˆclassï¼‰ç›¸å…³</code>çš„è¯­æ³•ï¼Œç”¨æ¥æ³¨é‡Šæˆ–ä¿®æ”¹ç±»å’Œç±»æ–¹æ³•ã€‚<br>è£…é¥°å™¨æ˜¯ä¸€ç§å‡½æ•°ï¼Œå†™æˆ<code>@ + å‡½æ•°å</code>ã€‚å®ƒå¯ä»¥æ”¾åœ¨ç±»å’Œç±»æ–¹æ³•çš„å®šä¹‰å‰é¢ã€‚<br>å…¶å®åªæ˜¯ä¸€ä¸ªè¯­æ³•ç³–. è¿˜æ²¡æœ‰æ­£å¼å‘å¸ƒ, è¿˜éœ€è¦æ’ä»¶<code>babel-plugin-transform-decorators-legacy</code>ä½¿ç”¨</p>\n<h2 id=\"è£…é¥°å™¨-Decorator-ä½¿ç”¨\"><a href=\"#è£…é¥°å™¨-Decorator-ä½¿ç”¨\" class=\"headerlink\" title=\"è£…é¥°å™¨(Decorator)ä½¿ç”¨\"></a>è£…é¥°å™¨(Decorator)ä½¿ç”¨</h2><h3 id=\"ç±»çš„è£…é¥°å™¨\"><a href=\"#ç±»çš„è£…é¥°å™¨\" class=\"headerlink\" title=\"ç±»çš„è£…é¥°å™¨\"></a>ç±»çš„è£…é¥°å™¨</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@testable</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyTestableClass</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">testable</span>(<span class=\"params\">target</span>) </span>&#123;</span><br><span class=\"line\">  target.isTestable = <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">MyTestableClass.isTestable <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n\n<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>@testable</code>å°±æ˜¯ä¸€ä¸ªè£…é¥°å™¨ã€‚å®ƒä¿®æ”¹äº†<code>MyTestableClass</code>è¿™ä¸ªç±»çš„è¡Œä¸ºï¼Œä¸ºå®ƒåŠ ä¸Šäº†é™æ€å±æ€§<code>isTestable</code>ã€‚<code>testable</code>å‡½æ•°çš„å‚æ•°<code>target</code>æ˜¯<code>MyTestableClass</code>ç±»æœ¬èº«ã€‚</p>\n<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè£…é¥°å™¨æ˜¯ä¸€ä¸ªå¯¹ç±»è¿›è¡Œå¤„ç†çš„å‡½æ•°ã€‚è£…é¥°å™¨å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå°±æ˜¯æ‰€è¦è£…é¥°çš„ç›®æ ‡ç±»ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">testable</span>(<span class=\"params\">target</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å¦‚æœæƒ³ä¼ å‚ï¼Œå¯ä»¥åœ¨è£…é¥°å™¨å¤–é¢å†å°è£…ä¸€å±‚å‡½æ•°ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">testable</span>(<span class=\"params\">isTestable</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">target</span>) </span>&#123;</span><br><span class=\"line\">    target.isTestable = isTestable;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@testable(<span class=\"literal\">true</span>)</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyTestableClass</span> </span>&#123;&#125;</span><br><span class=\"line\">MyTestableClass.isTestable <span class=\"comment\">// true</span></span><br><span class=\"line\"></span><br><span class=\"line\">@testable(<span class=\"literal\">false</span>)</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyClass</span> </span>&#123;&#125;</span><br><span class=\"line\">MyClass.isTestable <span class=\"comment\">// false</span></span><br></pre></td></tr></table></figure>\n<p>ä¸Šé¢ä»£ç ä¸­ï¼Œè£…é¥°å™¨<code>testable</code>å¯ä»¥æ¥å—å‚æ•°ï¼Œè¿™å°±ç­‰äºå¯ä»¥ä¿®æ”¹è£…é¥°å™¨çš„è¡Œä¸ºã€‚</p>\n<p>æ³¨æ„ï¼Œè£…é¥°å™¨å¯¹ç±»çš„è¡Œä¸ºçš„æ”¹å˜ï¼Œæ˜¯ä»£ç ç¼–è¯‘æ—¶å‘ç”Ÿçš„ï¼Œè€Œä¸æ˜¯åœ¨è¿è¡Œæ—¶ã€‚è¿™æ„å‘³ç€ï¼Œè£…é¥°å™¨èƒ½åœ¨ç¼–è¯‘é˜¶æ®µè¿è¡Œä»£ç ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè£…é¥°å™¨æœ¬è´¨å°±æ˜¯ç¼–è¯‘æ—¶æ‰§è¡Œçš„å‡½æ•°ã€‚</p>\n<p>å‰é¢çš„ä¾‹å­æ˜¯ä¸ºç±»æ·»åŠ ä¸€ä¸ªé™æ€å±æ€§ï¼Œå¦‚æœæƒ³æ·»åŠ å®ä¾‹å±æ€§ï¼Œå¯ä»¥é€šè¿‡ç›®æ ‡ç±»çš„<code>prototype</code>å¯¹è±¡æ“ä½œã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">testable</span>(<span class=\"params\">target</span>) </span>&#123;</span><br><span class=\"line\">  target.prototype.isTestable = <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@testable</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyTestableClass</span> </span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> obj = <span class=\"keyword\">new</span> MyTestableClass();</span><br><span class=\"line\">obj.isTestable <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n\n<p>ä¸Šé¢ä»£ç ä¸­ï¼Œè£…é¥°å™¨å‡½æ•°<code>testable</code>æ˜¯åœ¨ç›®æ ‡ç±»çš„<code>prototype</code>å¯¹è±¡ä¸Šæ·»åŠ å±æ€§ï¼Œå› æ­¤å°±å¯ä»¥åœ¨å®ä¾‹ä¸Šè°ƒç”¨ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">testable</span>(<span class=\"params\">target</span>) </span>&#123;</span><br><span class=\"line\">  target.prototype.isTestable = <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@testable</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyTestableClass</span> </span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> obj = <span class=\"keyword\">new</span> MyTestableClass();</span><br><span class=\"line\">obj.isTestable <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n\n\n<ul>\n<li>å®é™…å¼€å‘ä¸­ï¼ŒReact ä¸ Redux åº“ç»“åˆä½¿ç”¨æ—¶</li>\n</ul>\n<p>å¸¸å¸¸éœ€è¦å†™æˆä¸‹é¢è¿™æ ·</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyReactComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> connect(mapStateToProps, mapDispatchToProps)(MyReactComponent);</span><br></pre></td></tr></table></figure>\n\n<p>æœ‰äº†è£…é¥°å™¨ï¼Œå°±å¯ä»¥æ”¹å†™ä¸Šé¢çš„ä»£ç ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@connect(mapStateToProps, mapDispatchToProps)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyReactComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"ç±»çš„æ–¹æ³•çš„è£…é¥°å™¨\"><a href=\"#ç±»çš„æ–¹æ³•çš„è£…é¥°å™¨\" class=\"headerlink\" title=\"ç±»çš„æ–¹æ³•çš„è£…é¥°å™¨\"></a>ç±»çš„æ–¹æ³•çš„è£…é¥°å™¨</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">readonly</span>(<span class=\"params\">target, name, descriptor</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// descriptorå¯¹è±¡åŸæ¥çš„å€¼å¦‚ä¸‹</span></span><br><span class=\"line\">  <span class=\"comment\">// &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">//   value: specifiedFunction,</span></span><br><span class=\"line\">  <span class=\"comment\">//   enumerable: false,</span></span><br><span class=\"line\">  <span class=\"comment\">//   configurable: true,</span></span><br><span class=\"line\">  <span class=\"comment\">//   writable: true</span></span><br><span class=\"line\">  <span class=\"comment\">// &#125;;</span></span><br><span class=\"line\">  descriptor.writable = <span class=\"literal\">false</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> descriptor;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">readonly(Person.prototype, <span class=\"string\">'name'</span>, descriptor);</span><br><span class=\"line\"><span class=\"comment\">// ç±»ä¼¼äº</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(Person.prototype, <span class=\"string\">'name'</span>, descriptor);</span><br></pre></td></tr></table></figure>\n<p>è£…é¥°å™¨ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»çš„åŸå‹å¯¹è±¡ï¼Œä¸Šä¾‹æ˜¯<code>Person.prototype</code>ï¼Œè£…é¥°å™¨çš„æœ¬æ„æ˜¯è¦â€œè£…é¥°â€ç±»çš„å®ä¾‹ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™å®ä¾‹è¿˜æ²¡ç”Ÿæˆï¼Œæ‰€ä»¥åªèƒ½å»è£…é¥°åŸå‹ï¼ˆè¿™ä¸åŒäºç±»çš„è£…é¥°ï¼Œé‚£ç§æƒ…å†µæ—¶<code>target</code>å‚æ•°æŒ‡çš„æ˜¯ç±»æœ¬èº«ï¼‰ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ‰€è¦è£…é¥°çš„å±æ€§åï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è¯¥å±æ€§çš„æè¿°å¯¹è±¡ã€‚</p>\n<blockquote>\n<p>å…¶ä½™ä½¿ç”¨æ–¹æ³•ä¸ç±»çš„è£…é¥°å™¨ç›¸åŒ(å‚æ•°å˜ä¸º3ä¸ªäº†~)</p>\n</blockquote>\n<h3 id=\"å¤šä¸ªè£…é¥°å™¨\"><a href=\"#å¤šä¸ªè£…é¥°å™¨\" class=\"headerlink\" title=\"å¤šä¸ªè£…é¥°å™¨\"></a>å¤šä¸ªè£…é¥°å™¨</h3><p>å¦‚æœåŒä¸€ä¸ªæ–¹æ³•æœ‰å¤šä¸ªè£…é¥°å™¨ï¼Œä¼šåƒå‰¥æ´‹è‘±ä¸€æ ·ï¼Œå…ˆä»å¤–åˆ°å†…è¿›å…¥ï¼Œç„¶åç”±å†…å‘å¤–æ‰§è¡Œã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">dec</span>(<span class=\"params\">id</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'evaluated'</span>, id);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\">(<span class=\"params\">target, property, descriptor</span>) =&gt;</span> <span class=\"built_in\">console</span>.log(<span class=\"string\">'executed'</span>, id);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Example</span> </span>&#123;</span><br><span class=\"line\">    @dec(<span class=\"number\">1</span>)</span><br><span class=\"line\">    @dec(<span class=\"number\">2</span>)</span><br><span class=\"line\">    method()&#123;&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// evaluated 1</span></span><br><span class=\"line\"><span class=\"comment\">// evaluated 2</span></span><br><span class=\"line\"><span class=\"comment\">// executed 2</span></span><br><span class=\"line\"><span class=\"comment\">// executed 1</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"è£…é¥°å™¨ä¸èƒ½ä½œç”¨äºå‡½æ•°\"><a href=\"#è£…é¥°å™¨ä¸èƒ½ä½œç”¨äºå‡½æ•°\" class=\"headerlink\" title=\"è£…é¥°å™¨ä¸èƒ½ä½œç”¨äºå‡½æ•°\"></a>è£…é¥°å™¨ä¸èƒ½ä½œç”¨äºå‡½æ•°</h3><p>è£…é¥°å™¨åªèƒ½ç”¨äºç±»å’Œç±»çš„æ–¹æ³•ï¼Œä¸èƒ½ç”¨äºå‡½æ•°ï¼Œå› ä¸ºå­˜åœ¨å‡½æ•°æå‡ã€‚</p>\n<h2 id=\"Reacté«˜é˜¶ç»„ä»¶-HOC\"><a href=\"#Reacté«˜é˜¶ç»„ä»¶-HOC\" class=\"headerlink\" title=\"Reacté«˜é˜¶ç»„ä»¶(HOC)\"></a>Reacté«˜é˜¶ç»„ä»¶(HOC)</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import React from &#39;react&#39;;</span><br><span class=\"line\"></span><br><span class=\"line\">export default Component &#x3D;&gt; class extends React.Component &#123;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    return &lt;div style&#x3D;&#123;&#123;cursor: &#39;pointer&#39;, display: &#39;inline-block&#39;&#125;&#125;&gt;</span><br><span class=\"line\">      &lt;Component&#x2F;&gt;</span><br><span class=\"line\">    &lt;&#x2F;div&gt;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è¿™ä¸ªè£…é¥°å™¨ï¼ˆé«˜é˜¶ç»„ä»¶ï¼‰æ¥å—ä¸€ä¸ª React ç»„ä»¶ä½œä¸ºå‚æ•°ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ–°çš„ React ç»„ä»¶ã€‚å®ç°å¾ˆç®€å•ï¼Œå°±æ˜¯åŒ…è£¹äº†ä¸€å±‚ divï¼Œæ·»åŠ äº†ä¸€ä¸ª styleï¼Œå°±è¿™ä¹ˆç®€å•ã€‚ä»¥åæ‰€æœ‰è¢«å®ƒè£…é¥°çš„ç»„ä»¶éƒ½ä¼šå…·æœ‰è¿™ä¸ªç‰¹å¾ã€‚<br>é™¤äº†styleè¿˜å¯ä»¥ä¼ å‚æ•°</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import React from &#39;react&#39;;</span><br><span class=\"line\"></span><br><span class=\"line\">export default Component &#x3D;&gt; class extends React.Component &#123;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    return &lt;div test&#x3D;&#123;&#39;qwe&#39;&#125;&gt;</span><br><span class=\"line\">      &lt;Component&#x2F;&gt;</span><br><span class=\"line\">    &lt;&#x2F;div&gt;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä»¥åæ‰€æœ‰è¢«å®ƒè£…é¥°çš„ç»„ä»¶éƒ½å¯ä»¥ä»<code>props</code>é‡Œé¢è·å–åˆ°<code>test</code>. ä»–çš„å€¼æ˜¯<code>&#39;qwe&#39;</code>ã€‚</p>\n<h2 id=\"æ‰©å±•\"><a href=\"#æ‰©å±•\" class=\"headerlink\" title=\"æ‰©å±•\"></a>æ‰©å±•</h2><p>å‘æŒ¥ä½ çš„æƒ³è±¡, ä½ å¯ä»¥å†™æ— æ•°ä¸ªå¾ˆæ–¹ä¾¿çš„é«˜é˜¶ç»„ä»¶, é€šè¿‡è£…é¥°å™¨çš„æ–¹å¼, è®©ä½ çš„ä»£ç æ›´ç®€æ´, æ›´å¸…</p>\n<p>ç´¢å¼•</p>\n<blockquote>\n<p><a href=\"http://es6.ruanyifeng.com/#docs/decorator\" target=\"_blank\" rel=\"noopener\">http://es6.ruanyifeng.com/#docs/decorator</a></p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"ä»€ä¹ˆæ˜¯è£…é¥°å™¨-Decorator\"><a href=\"#ä»€ä¹ˆæ˜¯è£…é¥°å™¨-Decorator\" class=\"headerlink\" title=\"ä»€ä¹ˆæ˜¯è£…é¥°å™¨(Decorator)\"></a>ä»€ä¹ˆæ˜¯è£…é¥°å™¨(Decorator)</h2><p>è£…é¥°å™¨ï¼ˆDecoratorï¼‰æ˜¯ä¸€ç§<code>ä¸ç±»ï¼ˆclassï¼‰ç›¸å…³</code>çš„è¯­æ³•ï¼Œç”¨æ¥æ³¨é‡Šæˆ–ä¿®æ”¹ç±»å’Œç±»æ–¹æ³•ã€‚<br>è£…é¥°å™¨æ˜¯ä¸€ç§å‡½æ•°ï¼Œå†™æˆ<code>@ + å‡½æ•°å</code>ã€‚å®ƒå¯ä»¥æ”¾åœ¨ç±»å’Œç±»æ–¹æ³•çš„å®šä¹‰å‰é¢ã€‚<br>å…¶å®åªæ˜¯ä¸€ä¸ªè¯­æ³•ç³–. è¿˜æ²¡æœ‰æ­£å¼å‘å¸ƒ, è¿˜éœ€è¦æ’ä»¶<code>babel-plugin-transform-decorators-legacy</code>ä½¿ç”¨</p>\n<h2 id=\"è£…é¥°å™¨-Decorator-ä½¿ç”¨\"><a href=\"#è£…é¥°å™¨-Decorator-ä½¿ç”¨\" class=\"headerlink\" title=\"è£…é¥°å™¨(Decorator)ä½¿ç”¨\"></a>è£…é¥°å™¨(Decorator)ä½¿ç”¨</h2><h3 id=\"ç±»çš„è£…é¥°å™¨\"><a href=\"#ç±»çš„è£…é¥°å™¨\" class=\"headerlink\" title=\"ç±»çš„è£…é¥°å™¨\"></a>ç±»çš„è£…é¥°å™¨</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@testable</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyTestableClass</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">testable</span>(<span class=\"params\">target</span>) </span>&#123;</span><br><span class=\"line\">  target.isTestable = <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">MyTestableClass.isTestable <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n\n<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>@testable</code>å°±æ˜¯ä¸€ä¸ªè£…é¥°å™¨ã€‚å®ƒä¿®æ”¹äº†<code>MyTestableClass</code>è¿™ä¸ªç±»çš„è¡Œä¸ºï¼Œä¸ºå®ƒåŠ ä¸Šäº†é™æ€å±æ€§<code>isTestable</code>ã€‚<code>testable</code>å‡½æ•°çš„å‚æ•°<code>target</code>æ˜¯<code>MyTestableClass</code>ç±»æœ¬èº«ã€‚</p>\n<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè£…é¥°å™¨æ˜¯ä¸€ä¸ªå¯¹ç±»è¿›è¡Œå¤„ç†çš„å‡½æ•°ã€‚è£…é¥°å™¨å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå°±æ˜¯æ‰€è¦è£…é¥°çš„ç›®æ ‡ç±»ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">testable</span>(<span class=\"params\">target</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>å¦‚æœæƒ³ä¼ å‚ï¼Œå¯ä»¥åœ¨è£…é¥°å™¨å¤–é¢å†å°è£…ä¸€å±‚å‡½æ•°ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">testable</span>(<span class=\"params\">isTestable</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">target</span>) </span>&#123;</span><br><span class=\"line\">    target.isTestable = isTestable;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@testable(<span class=\"literal\">true</span>)</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyTestableClass</span> </span>&#123;&#125;</span><br><span class=\"line\">MyTestableClass.isTestable <span class=\"comment\">// true</span></span><br><span class=\"line\"></span><br><span class=\"line\">@testable(<span class=\"literal\">false</span>)</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyClass</span> </span>&#123;&#125;</span><br><span class=\"line\">MyClass.isTestable <span class=\"comment\">// false</span></span><br></pre></td></tr></table></figure>\n<p>ä¸Šé¢ä»£ç ä¸­ï¼Œè£…é¥°å™¨<code>testable</code>å¯ä»¥æ¥å—å‚æ•°ï¼Œè¿™å°±ç­‰äºå¯ä»¥ä¿®æ”¹è£…é¥°å™¨çš„è¡Œä¸ºã€‚</p>\n<p>æ³¨æ„ï¼Œè£…é¥°å™¨å¯¹ç±»çš„è¡Œä¸ºçš„æ”¹å˜ï¼Œæ˜¯ä»£ç ç¼–è¯‘æ—¶å‘ç”Ÿçš„ï¼Œè€Œä¸æ˜¯åœ¨è¿è¡Œæ—¶ã€‚è¿™æ„å‘³ç€ï¼Œè£…é¥°å™¨èƒ½åœ¨ç¼–è¯‘é˜¶æ®µè¿è¡Œä»£ç ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè£…é¥°å™¨æœ¬è´¨å°±æ˜¯ç¼–è¯‘æ—¶æ‰§è¡Œçš„å‡½æ•°ã€‚</p>\n<p>å‰é¢çš„ä¾‹å­æ˜¯ä¸ºç±»æ·»åŠ ä¸€ä¸ªé™æ€å±æ€§ï¼Œå¦‚æœæƒ³æ·»åŠ å®ä¾‹å±æ€§ï¼Œå¯ä»¥é€šè¿‡ç›®æ ‡ç±»çš„<code>prototype</code>å¯¹è±¡æ“ä½œã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">testable</span>(<span class=\"params\">target</span>) </span>&#123;</span><br><span class=\"line\">  target.prototype.isTestable = <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@testable</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyTestableClass</span> </span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> obj = <span class=\"keyword\">new</span> MyTestableClass();</span><br><span class=\"line\">obj.isTestable <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n\n<p>ä¸Šé¢ä»£ç ä¸­ï¼Œè£…é¥°å™¨å‡½æ•°<code>testable</code>æ˜¯åœ¨ç›®æ ‡ç±»çš„<code>prototype</code>å¯¹è±¡ä¸Šæ·»åŠ å±æ€§ï¼Œå› æ­¤å°±å¯ä»¥åœ¨å®ä¾‹ä¸Šè°ƒç”¨ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">testable</span>(<span class=\"params\">target</span>) </span>&#123;</span><br><span class=\"line\">  target.prototype.isTestable = <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@testable</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyTestableClass</span> </span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> obj = <span class=\"keyword\">new</span> MyTestableClass();</span><br><span class=\"line\">obj.isTestable <span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure>\n\n\n<ul>\n<li>å®é™…å¼€å‘ä¸­ï¼ŒReact ä¸ Redux åº“ç»“åˆä½¿ç”¨æ—¶</li>\n</ul>\n<p>å¸¸å¸¸éœ€è¦å†™æˆä¸‹é¢è¿™æ ·</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyReactComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> connect(mapStateToProps, mapDispatchToProps)(MyReactComponent);</span><br></pre></td></tr></table></figure>\n\n<p>æœ‰äº†è£…é¥°å™¨ï¼Œå°±å¯ä»¥æ”¹å†™ä¸Šé¢çš„ä»£ç ã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@connect(mapStateToProps, mapDispatchToProps)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyReactComponent</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"ç±»çš„æ–¹æ³•çš„è£…é¥°å™¨\"><a href=\"#ç±»çš„æ–¹æ³•çš„è£…é¥°å™¨\" class=\"headerlink\" title=\"ç±»çš„æ–¹æ³•çš„è£…é¥°å™¨\"></a>ç±»çš„æ–¹æ³•çš„è£…é¥°å™¨</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">readonly</span>(<span class=\"params\">target, name, descriptor</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// descriptorå¯¹è±¡åŸæ¥çš„å€¼å¦‚ä¸‹</span></span><br><span class=\"line\">  <span class=\"comment\">// &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">//   value: specifiedFunction,</span></span><br><span class=\"line\">  <span class=\"comment\">//   enumerable: false,</span></span><br><span class=\"line\">  <span class=\"comment\">//   configurable: true,</span></span><br><span class=\"line\">  <span class=\"comment\">//   writable: true</span></span><br><span class=\"line\">  <span class=\"comment\">// &#125;;</span></span><br><span class=\"line\">  descriptor.writable = <span class=\"literal\">false</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> descriptor;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">readonly(Person.prototype, <span class=\"string\">'name'</span>, descriptor);</span><br><span class=\"line\"><span class=\"comment\">// ç±»ä¼¼äº</span></span><br><span class=\"line\"><span class=\"built_in\">Object</span>.defineProperty(Person.prototype, <span class=\"string\">'name'</span>, descriptor);</span><br></pre></td></tr></table></figure>\n<p>è£…é¥°å™¨ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»çš„åŸå‹å¯¹è±¡ï¼Œä¸Šä¾‹æ˜¯<code>Person.prototype</code>ï¼Œè£…é¥°å™¨çš„æœ¬æ„æ˜¯è¦â€œè£…é¥°â€ç±»çš„å®ä¾‹ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™å®ä¾‹è¿˜æ²¡ç”Ÿæˆï¼Œæ‰€ä»¥åªèƒ½å»è£…é¥°åŸå‹ï¼ˆè¿™ä¸åŒäºç±»çš„è£…é¥°ï¼Œé‚£ç§æƒ…å†µæ—¶<code>target</code>å‚æ•°æŒ‡çš„æ˜¯ç±»æœ¬èº«ï¼‰ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ‰€è¦è£…é¥°çš„å±æ€§åï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è¯¥å±æ€§çš„æè¿°å¯¹è±¡ã€‚</p>\n<blockquote>\n<p>å…¶ä½™ä½¿ç”¨æ–¹æ³•ä¸ç±»çš„è£…é¥°å™¨ç›¸åŒ(å‚æ•°å˜ä¸º3ä¸ªäº†~)</p>\n</blockquote>\n<h3 id=\"å¤šä¸ªè£…é¥°å™¨\"><a href=\"#å¤šä¸ªè£…é¥°å™¨\" class=\"headerlink\" title=\"å¤šä¸ªè£…é¥°å™¨\"></a>å¤šä¸ªè£…é¥°å™¨</h3><p>å¦‚æœåŒä¸€ä¸ªæ–¹æ³•æœ‰å¤šä¸ªè£…é¥°å™¨ï¼Œä¼šåƒå‰¥æ´‹è‘±ä¸€æ ·ï¼Œå…ˆä»å¤–åˆ°å†…è¿›å…¥ï¼Œç„¶åç”±å†…å‘å¤–æ‰§è¡Œã€‚</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">dec</span>(<span class=\"params\">id</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'evaluated'</span>, id);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"function\">(<span class=\"params\">target, property, descriptor</span>) =&gt;</span> <span class=\"built_in\">console</span>.log(<span class=\"string\">'executed'</span>, id);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Example</span> </span>&#123;</span><br><span class=\"line\">    @dec(<span class=\"number\">1</span>)</span><br><span class=\"line\">    @dec(<span class=\"number\">2</span>)</span><br><span class=\"line\">    method()&#123;&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// evaluated 1</span></span><br><span class=\"line\"><span class=\"comment\">// evaluated 2</span></span><br><span class=\"line\"><span class=\"comment\">// executed 2</span></span><br><span class=\"line\"><span class=\"comment\">// executed 1</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"è£…é¥°å™¨ä¸èƒ½ä½œç”¨äºå‡½æ•°\"><a href=\"#è£…é¥°å™¨ä¸èƒ½ä½œç”¨äºå‡½æ•°\" class=\"headerlink\" title=\"è£…é¥°å™¨ä¸èƒ½ä½œç”¨äºå‡½æ•°\"></a>è£…é¥°å™¨ä¸èƒ½ä½œç”¨äºå‡½æ•°</h3><p>è£…é¥°å™¨åªèƒ½ç”¨äºç±»å’Œç±»çš„æ–¹æ³•ï¼Œä¸èƒ½ç”¨äºå‡½æ•°ï¼Œå› ä¸ºå­˜åœ¨å‡½æ•°æå‡ã€‚</p>\n<h2 id=\"Reacté«˜é˜¶ç»„ä»¶-HOC\"><a href=\"#Reacté«˜é˜¶ç»„ä»¶-HOC\" class=\"headerlink\" title=\"Reacté«˜é˜¶ç»„ä»¶(HOC)\"></a>Reacté«˜é˜¶ç»„ä»¶(HOC)</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import React from &#39;react&#39;;</span><br><span class=\"line\"></span><br><span class=\"line\">export default Component &#x3D;&gt; class extends React.Component &#123;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    return &lt;div style&#x3D;&#123;&#123;cursor: &#39;pointer&#39;, display: &#39;inline-block&#39;&#125;&#125;&gt;</span><br><span class=\"line\">      &lt;Component&#x2F;&gt;</span><br><span class=\"line\">    &lt;&#x2F;div&gt;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>è¿™ä¸ªè£…é¥°å™¨ï¼ˆé«˜é˜¶ç»„ä»¶ï¼‰æ¥å—ä¸€ä¸ª React ç»„ä»¶ä½œä¸ºå‚æ•°ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ–°çš„ React ç»„ä»¶ã€‚å®ç°å¾ˆç®€å•ï¼Œå°±æ˜¯åŒ…è£¹äº†ä¸€å±‚ divï¼Œæ·»åŠ äº†ä¸€ä¸ª styleï¼Œå°±è¿™ä¹ˆç®€å•ã€‚ä»¥åæ‰€æœ‰è¢«å®ƒè£…é¥°çš„ç»„ä»¶éƒ½ä¼šå…·æœ‰è¿™ä¸ªç‰¹å¾ã€‚<br>é™¤äº†styleè¿˜å¯ä»¥ä¼ å‚æ•°</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import React from &#39;react&#39;;</span><br><span class=\"line\"></span><br><span class=\"line\">export default Component &#x3D;&gt; class extends React.Component &#123;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    return &lt;div test&#x3D;&#123;&#39;qwe&#39;&#125;&gt;</span><br><span class=\"line\">      &lt;Component&#x2F;&gt;</span><br><span class=\"line\">    &lt;&#x2F;div&gt;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ä»¥åæ‰€æœ‰è¢«å®ƒè£…é¥°çš„ç»„ä»¶éƒ½å¯ä»¥ä»<code>props</code>é‡Œé¢è·å–åˆ°<code>test</code>. ä»–çš„å€¼æ˜¯<code>&#39;qwe&#39;</code>ã€‚</p>\n<h2 id=\"æ‰©å±•\"><a href=\"#æ‰©å±•\" class=\"headerlink\" title=\"æ‰©å±•\"></a>æ‰©å±•</h2><p>å‘æŒ¥ä½ çš„æƒ³è±¡, ä½ å¯ä»¥å†™æ— æ•°ä¸ªå¾ˆæ–¹ä¾¿çš„é«˜é˜¶ç»„ä»¶, é€šè¿‡è£…é¥°å™¨çš„æ–¹å¼, è®©ä½ çš„ä»£ç æ›´ç®€æ´, æ›´å¸…</p>\n<p>ç´¢å¼•</p>\n<blockquote>\n<p><a href=\"http://es6.ruanyifeng.com/#docs/decorator\" target=\"_blank\" rel=\"noopener\">http://es6.ruanyifeng.com/#docs/decorator</a></p>\n</blockquote>\n"},{"title":"é¢è¯•å®˜ï¼šå¬è¯´ä½ å¯¹package.jsonå¾ˆç†Ÿï¼Ÿ","date":"2021-06-22T12:11:07.000Z","_content":"\n","source":"_posts/é¢è¯•å®˜ï¼šå¬è¯´ä½ å¯¹package-jsonå¾ˆç†Ÿï¼Ÿ.md","raw":"---\ntitle: é¢è¯•å®˜ï¼šå¬è¯´ä½ å¯¹package.jsonå¾ˆç†Ÿï¼Ÿ\ndate: 2021-06-22 20:11:07\ntags: [JavaScript]\ncategory: [é‡æ‹¾å‰ç«¯]\n\n---\n\n","slug":"é¢è¯•å®˜ï¼šå¬è¯´ä½ å¯¹package-jsonå¾ˆç†Ÿï¼Ÿ","published":1,"updated":"2021-06-24T14:00:06.855Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckqevra91002vlwrd5hmedysq","content":"","site":{"data":{}},"cover":"/img/post.jpg","excerpt":"","more":""}],"PostAsset":[],"PostCategory":[{"post_id":"ckqevra7e0000lwrdf9vb6x2s","category_id":"ckqevra7m0004lwrd4z7p40hq","_id":"ckqevra7t000dlwrdh1vg9ooj"},{"post_id":"ckqevra7k0002lwrd4m6jawuv","category_id":"ckqevra7q0009lwrdh0asfxf0","_id":"ckqevra7v000klwrd92w8g30k"},{"post_id":"ckqevra7n0006lwrd9h667myh","category_id":"ckqevra7t000elwrd5ew61qzx","_id":"ckqevra7y000qlwrd88zx7y3r"},{"post_id":"ckqevra7p0007lwrdgy43c737","category_id":"ckqevra7w000llwrd8dde8pef","_id":"ckqevra81000vlwrdb2ps9iut"},{"post_id":"ckqevra80000ulwrd3uaf7bk4","category_id":"ckqevra7q0009lwrdh0asfxf0","_id":"ckqevra850013lwrd3p1e6cos"},{"post_id":"ckqevra7r000blwrd9ucsbdrj","category_id":"ckqevra7w000llwrd8dde8pef","_id":"ckqevra870019lwrdeng61h05"},{"post_id":"ckqevra7s000clwrdh53d8rtq","category_id":"ckqevra850014lwrdhxf18gmk","_id":"ckqevra8f001flwrdbkx5e19n"},{"post_id":"ckqevra7u000glwrd6ddk4m07","category_id":"ckqevra87001alwrd7fjtfq0q","_id":"ckqevra8h001llwrdaklh8u07"},{"post_id":"ckqevra7v000ilwrd3xfv52el","category_id":"ckqevra8f001hlwrd7igc71fx","_id":"ckqevra8l001qlwrdd4w3hqil"},{"post_id":"ckqevra7w000nlwrd3s5pdwt1","category_id":"ckqevra7m0004lwrd4z7p40hq","_id":"ckqevra8q001xlwrd8gmi51wx"},{"post_id":"ckqevra7w000nlwrd3s5pdwt1","category_id":"ckqevra8i001mlwrdg43lfecp","_id":"ckqevra8r0022lwrd44qvbfao"},{"post_id":"ckqevra7y000plwrd3tbg7sno","category_id":"ckqevra8m001slwrdaen1ft73","_id":"ckqevra8t0025lwrd367zb58p"},{"post_id":"ckqevra7z000tlwrd4qd2htwb","category_id":"ckqevra8q001zlwrd6rke3ay6","_id":"ckqevra8v002alwrd8o5u3kmz"},{"post_id":"ckqevra7p0008lwrd58in9g5h","category_id":"ckqevra7z000rlwrd77hu6tem","_id":"ckqevra8x002hlwrdgo1772an"},{"post_id":"ckqevra7p0008lwrd58in9g5h","category_id":"ckqevra8t0026lwrdhoxh17vv","_id":"ckqevra8y002mlwrdffhyde8i"},{"post_id":"ckqevra8w002dlwrdgcig9ihz","category_id":"ckqevra7w000llwrd8dde8pef","_id":"ckqevra8z002plwrdaosq6ynz"},{"post_id":"ckqevra81000wlwrdbwstad04","category_id":"ckqevra8v002blwrd31nmdmg0","_id":"ckqevra90002ulwrd4l2x1hy9"},{"post_id":"ckqevra830010lwrd3lxe3i50","category_id":"ckqevra7z000rlwrd77hu6tem","_id":"ckqevra91002xlwrdah62023x"},{"post_id":"ckqevra830010lwrd3lxe3i50","category_id":"ckqevra8t0026lwrdhoxh17vv","_id":"ckqevra920031lwrd09xp4xov"},{"post_id":"ckqevra91002vlwrd5hmedysq","category_id":"ckqevra90002rlwrdh877dsjl","_id":"ckqevra920032lwrd9jrzclwu"},{"post_id":"ckqevra840012lwrd97u032an","category_id":"ckqevra90002rlwrdh877dsjl","_id":"ckqevra930035lwrdhi2h6uab"},{"post_id":"ckqevra860017lwrd1rs03p22","category_id":"ckqevra8f001hlwrd7igc71fx","_id":"ckqevra940038lwrd04mc61o3"},{"post_id":"ckqevra860018lwrdeqypcfqk","category_id":"ckqevra90002rlwrdh877dsjl","_id":"ckqevra94003clwrd9b8n2skk"},{"post_id":"ckqevra88001clwrd2xc0bzy5","category_id":"ckqevra90002rlwrdh877dsjl","_id":"ckqevra95003flwrd1vboc1u7"},{"post_id":"ckqevra8c001elwrd296whmen","category_id":"ckqevra90002rlwrdh877dsjl","_id":"ckqevra97003ilwrd0ksp8edp"},{"post_id":"ckqevra8g001jlwrde1xq9gj8","category_id":"ckqevra90002rlwrdh877dsjl","_id":"ckqevra98003llwrdccmyew87"},{"post_id":"ckqevra8h001klwrdbmdu5adq","category_id":"ckqevra90002rlwrdh877dsjl","_id":"ckqevra99003qlwrd984g004t"},{"post_id":"ckqevra8i001nlwrdds0t9daa","category_id":"ckqevra90002rlwrdh877dsjl","_id":"ckqevra9a003ulwrd6ilu727e"},{"post_id":"ckqevra8k001plwrd6bur87hd","category_id":"ckqevra90002rlwrdh877dsjl","_id":"ckqevra9b003zlwrd50r95q5q"},{"post_id":"ckqevra8l001rlwrd3343aisg","category_id":"ckqevra90002rlwrdh877dsjl","_id":"ckqevra9c0042lwrd3d968vbl"},{"post_id":"ckqevra8n001ulwrd5dv7hesr","category_id":"ckqevra90002rlwrdh877dsjl","_id":"ckqevra9d0046lwrd7uzh0mdm"},{"post_id":"ckqevra8p001wlwrdh7m9appx","category_id":"ckqevra90002rlwrdh877dsjl","_id":"ckqevra9e004blwrd7ovqhaoj"},{"post_id":"ckqevra8r0021lwrd3eocghnu","category_id":"ckqevra90002rlwrdh877dsjl","_id":"ckqevra9f004glwrd2ap60apc"},{"post_id":"ckqevra8s0024lwrdh8gvdkxa","category_id":"ckqevra90002rlwrdh877dsjl","_id":"ckqevra9g004jlwrd7ut73ev3"},{"post_id":"ckqevra8t0028lwrd3exr9n33","category_id":"ckqevra90002rlwrdh877dsjl","_id":"ckqevra9h004llwrddpwi4rcv"},{"post_id":"ckqevra8u0029lwrd6zz2auvz","category_id":"ckqevra9g004ilwrd8ygh3lue","_id":"ckqevra9i004olwrdfv0bej8t"},{"post_id":"ckqevra8w002flwrd8dcy2bc7","category_id":"ckqevra9h004mlwrda22k7e2y","_id":"ckqevra9j004ulwrd4qpfcoqx"},{"post_id":"ckqevra8x002ilwrdd9h5976c","category_id":"ckqevra9i004qlwrdbc9r4088","_id":"ckqevra9k004ylwrd0whn8cii"},{"post_id":"ckqevra8y002nlwrd7yrvg3ix","category_id":"ckqevra9j004vlwrdhrv06f50","_id":"ckqevra9k0051lwrd4keqd0h5"},{"post_id":"ckqevra8z002qlwrdd7uo9oyk","category_id":"ckqevra9k004zlwrd4hxi70vh","_id":"ckqevra9l0055lwrdeioi1mna"}],"PostTag":[{"post_id":"ckqevra7e0000lwrdf9vb6x2s","tag_id":"ckqevra7n0005lwrd3icdc830","_id":"ckqevra7u000hlwrdhadsbgiu"},{"post_id":"ckqevra7e0000lwrdf9vb6x2s","tag_id":"ckqevra7q000alwrd3dhn6e7n","_id":"ckqevra7v000jlwrdhdzc8bxg"},{"post_id":"ckqevra7k0002lwrd4m6jawuv","tag_id":"ckqevra7t000flwrdc4fp5887","_id":"ckqevra7x000olwrd5ig25gnr"},{"post_id":"ckqevra80000ulwrd3uaf7bk4","tag_id":"ckqevra7t000flwrdc4fp5887","_id":"ckqevra83000zlwrdca0a4c9m"},{"post_id":"ckqevra7n0006lwrd9h667myh","tag_id":"ckqevra7w000mlwrdf5rygd9o","_id":"ckqevra840011lwrd4nof2qp5"},{"post_id":"ckqevra7n0006lwrd9h667myh","tag_id":"ckqevra7z000slwrdglvxglnw","_id":"ckqevra850016lwrd0m06etsw"},{"post_id":"ckqevra7p0007lwrdgy43c737","tag_id":"ckqevra81000ylwrddd823v6p","_id":"ckqevra8c001dlwrdci7ocmrz"},{"post_id":"ckqevra7p0007lwrdgy43c737","tag_id":"ckqevra850015lwrdd5d53bhi","_id":"ckqevra8f001glwrd2m2c34m1"},{"post_id":"ckqevra7p0008lwrd58in9g5h","tag_id":"ckqevra87001blwrdhs2z989h","_id":"ckqevra8o001vlwrd3zsxdue8"},{"post_id":"ckqevra7p0008lwrd58in9g5h","tag_id":"ckqevra8g001ilwrdgp7y94x1","_id":"ckqevra8q001ylwrd6mzqb3yf"},{"post_id":"ckqevra7p0008lwrd58in9g5h","tag_id":"ckqevra8i001olwrd25lj7p23","_id":"ckqevra8r0023lwrd8l8o86yj"},{"post_id":"ckqevra7r000blwrd9ucsbdrj","tag_id":"ckqevra8m001tlwrdegs57vgc","_id":"ckqevra8w002elwrdfrlwhlon"},{"post_id":"ckqevra7r000blwrd9ucsbdrj","tag_id":"ckqevra81000ylwrddd823v6p","_id":"ckqevra8x002glwrd8jbu4f0f"},{"post_id":"ckqevra7r000blwrd9ucsbdrj","tag_id":"ckqevra8t0027lwrdhyyjeyup","_id":"ckqevra8y002llwrd9tw7b2vk"},{"post_id":"ckqevra8w002dlwrdgcig9ihz","tag_id":"ckqevra81000ylwrddd823v6p","_id":"ckqevra8z002olwrd6rx61cie"},{"post_id":"ckqevra8w002dlwrdgcig9ihz","tag_id":"ckqevra8m001tlwrdegs57vgc","_id":"ckqevra90002tlwrd49nthvcz"},{"post_id":"ckqevra7s000clwrdh53d8rtq","tag_id":"ckqevra8v002clwrda12tgmoc","_id":"ckqevra91002wlwrd48cf2sf7"},{"post_id":"ckqevra7s000clwrdh53d8rtq","tag_id":"ckqevra8y002klwrdadd5c03m","_id":"ckqevra920030lwrd8vy22jl3"},{"post_id":"ckqevra7u000glwrd6ddk4m07","tag_id":"ckqevra90002slwrd5penfr48","_id":"ckqevra930036lwrd2xr4c6es"},{"post_id":"ckqevra7u000glwrd6ddk4m07","tag_id":"ckqevra92002zlwrd6s1q3qec","_id":"ckqevra940039lwrd2eql3huv"},{"post_id":"ckqevra7v000ilwrd3xfv52el","tag_id":"ckqevra930034lwrd781uchi2","_id":"ckqevra98003mlwrdddpe3ugq"},{"post_id":"ckqevra7v000ilwrd3xfv52el","tag_id":"ckqevra94003alwrd532d4wz3","_id":"ckqevra98003nlwrd24a27g7y"},{"post_id":"ckqevra7v000ilwrd3xfv52el","tag_id":"ckqevra95003dlwrd44ymfxll","_id":"ckqevra99003rlwrdbq6t8t2v"},{"post_id":"ckqevra7v000ilwrd3xfv52el","tag_id":"ckqevra96003glwrdehiaheg4","_id":"ckqevra99003slwrdet8ea6ob"},{"post_id":"ckqevra7w000nlwrd3s5pdwt1","tag_id":"ckqevra7n0005lwrd3icdc830","_id":"ckqevra9a003wlwrderzx8fnr"},{"post_id":"ckqevra7w000nlwrd3s5pdwt1","tag_id":"ckqevra97003jlwrdefere3hu","_id":"ckqevra9a003xlwrdbyyzdii1"},{"post_id":"ckqevra7y000plwrd3tbg7sno","tag_id":"ckqevra98003olwrd4sid5t43","_id":"ckqevra9d0044lwrd6jod4iw0"},{"post_id":"ckqevra7y000plwrd3tbg7sno","tag_id":"ckqevra9a003vlwrd0qhnbotr","_id":"ckqevra9e0047lwrddxzrdldl"},{"post_id":"ckqevra7y000plwrd3tbg7sno","tag_id":"ckqevra9b0040lwrd3zq5e3if","_id":"ckqevra9e0049lwrdg2l8fi8f"},{"post_id":"ckqevra7z000tlwrd4qd2htwb","tag_id":"ckqevra9c0043lwrdecib2w5v","_id":"ckqevra9f004clwrdf24f6o7x"},{"post_id":"ckqevra81000wlwrdbwstad04","tag_id":"ckqevra9e0048lwrd45h84uma","_id":"ckqevra9f004elwrd7of2ao62"},{"post_id":"ckqevra830010lwrd3lxe3i50","tag_id":"ckqevra9f004dlwrdgij00ct5","_id":"ckqevra9i004plwrdatrq1twt"},{"post_id":"ckqevra830010lwrd3lxe3i50","tag_id":"ckqevra9g004hlwrd398cba9b","_id":"ckqevra9i004rlwrd5i8o6fnh"},{"post_id":"ckqevra830010lwrd3lxe3i50","tag_id":"ckqevra8g001ilwrdgp7y94x1","_id":"ckqevra9j004tlwrd2lmb64et"},{"post_id":"ckqevra840012lwrd97u032an","tag_id":"ckqevra9h004nlwrd6vzh1v2g","_id":"ckqevra9j004wlwrd5qq3cac9"},{"post_id":"ckqevra860017lwrd1rs03p22","tag_id":"ckqevra9i004slwrd13vnbd6m","_id":"ckqevra9k0052lwrda6ozdh91"},{"post_id":"ckqevra860017lwrd1rs03p22","tag_id":"ckqevra9j004xlwrde0ee3146","_id":"ckqevra9l0053lwrd4nskb78c"},{"post_id":"ckqevra860018lwrdeqypcfqk","tag_id":"ckqevra9k0050lwrdaljy9x6t","_id":"ckqevra9l0056lwrd0uthep10"},{"post_id":"ckqevra860018lwrdeqypcfqk","tag_id":"ckqevra81000ylwrddd823v6p","_id":"ckqevra9l0057lwrdautm92rf"},{"post_id":"ckqevra88001clwrd2xc0bzy5","tag_id":"ckqevra9h004nlwrd6vzh1v2g","_id":"ckqevra9m0059lwrd1w9a59j5"},{"post_id":"ckqevra8c001elwrd296whmen","tag_id":"ckqevra9h004nlwrd6vzh1v2g","_id":"ckqevra9n005blwrd6ql0f5av"},{"post_id":"ckqevra8g001jlwrde1xq9gj8","tag_id":"ckqevra9k0050lwrdaljy9x6t","_id":"ckqevra9o005dlwrd939wchga"},{"post_id":"ckqevra8g001jlwrde1xq9gj8","tag_id":"ckqevra81000ylwrddd823v6p","_id":"ckqevra9o005elwrdcvpqgzu1"},{"post_id":"ckqevra8h001klwrdbmdu5adq","tag_id":"ckqevra9h004nlwrd6vzh1v2g","_id":"ckqevra9o005glwrd4xdn4lwt"},{"post_id":"ckqevra8i001nlwrdds0t9daa","tag_id":"ckqevra9j004xlwrde0ee3146","_id":"ckqevra9p005ilwrd0iwy53mu"},{"post_id":"ckqevra8k001plwrd6bur87hd","tag_id":"ckqevra9o005hlwrd3zq2c4xq","_id":"ckqevra9p005mlwrd92k936px"},{"post_id":"ckqevra8k001plwrd6bur87hd","tag_id":"ckqevra9j004xlwrde0ee3146","_id":"ckqevra9p005nlwrd8r2nb1hs"},{"post_id":"ckqevra8k001plwrd6bur87hd","tag_id":"ckqevra9p005klwrd6ylhd628","_id":"ckqevra9q005plwrd5hye9k3e"},{"post_id":"ckqevra8l001rlwrd3343aisg","tag_id":"ckqevra9p005llwrdhmhz9odo","_id":"ckqevra9q005rlwrdhzushhvd"},{"post_id":"ckqevra8l001rlwrd3343aisg","tag_id":"ckqevra9j004xlwrde0ee3146","_id":"ckqevra9q005slwrdb01b4m0n"},{"post_id":"ckqevra8n001ulwrd5dv7hesr","tag_id":"ckqevra9q005qlwrd2qh67sig","_id":"ckqevra9q005ulwrd6s9r8r8p"},{"post_id":"ckqevra8p001wlwrdh7m9appx","tag_id":"ckqevra9q005tlwrd8ron63vv","_id":"ckqevra9s005ylwrd96z35ynx"},{"post_id":"ckqevra8p001wlwrdh7m9appx","tag_id":"ckqevra9j004xlwrde0ee3146","_id":"ckqevra9s005zlwrde00qd4rd"},{"post_id":"ckqevra8p001wlwrdh7m9appx","tag_id":"ckqevra9r005wlwrd3wojebe2","_id":"ckqevra9s0061lwrd1qsh6bc1"},{"post_id":"ckqevra8r0021lwrd3eocghnu","tag_id":"ckqevra9r005xlwrdg02514j6","_id":"ckqevra9s0062lwrdctrmbeuu"},{"post_id":"ckqevra8s0024lwrdh8gvdkxa","tag_id":"ckqevra9j004xlwrde0ee3146","_id":"ckqevra9s0064lwrd1vkv484l"},{"post_id":"ckqevra8t0028lwrd3exr9n33","tag_id":"ckqevra9j004xlwrde0ee3146","_id":"ckqevra9t0066lwrd18va21vd"},{"post_id":"ckqevra8u0029lwrd6zz2auvz","tag_id":"ckqevra9t0065lwrd9s7u5ch2","_id":"ckqevra9t0068lwrd35n9f6m9"},{"post_id":"ckqevra8w002flwrd8dcy2bc7","tag_id":"ckqevra9t0067lwrdbkp6b3jq","_id":"ckqevra9v006alwrdhrc77ppl"},{"post_id":"ckqevra8x002ilwrdd9h5976c","tag_id":"ckqevra9h004nlwrd6vzh1v2g","_id":"ckqevra9v006clwrd0ud21f50"},{"post_id":"ckqevra8y002nlwrd7yrvg3ix","tag_id":"ckqevra9v006blwrdaao2fi73","_id":"ckqevra9w006elwrdclopfh7s"},{"post_id":"ckqevra8z002qlwrdd7uo9oyk","tag_id":"ckqevra81000ylwrddd823v6p","_id":"ckqevra9x006glwrd4nej3fog"},{"post_id":"ckqevra8z002qlwrdd7uo9oyk","tag_id":"ckqevra9v006dlwrd58njbrk4","_id":"ckqevra9x006hlwrd5tk2djzi"},{"post_id":"ckqevra91002vlwrd5hmedysq","tag_id":"ckqevra9j004xlwrde0ee3146","_id":"ckqevra9x006ilwrdhsl60iwk"}],"Tag":[{"name":"Ant-Design-Form","_id":"ckqevra7n0005lwrd3icdc830"},{"name":"Ant-Design","_id":"ckqevra7q000alwrd3dhn6e7n"},{"name":"HTTP","_id":"ckqevra7t000flwrdc4fp5887"},{"name":"Hexo","_id":"ckqevra7w000mlwrdf5rygd9o"},{"name":"GitHub","_id":"ckqevra7z000slwrdglvxglnw"},{"name":"React","_id":"ckqevra81000ylwrddd823v6p"},{"name":"State","_id":"ckqevra850015lwrdd5d53bhi"},{"name":"Spring-Boot-2.0","_id":"ckqevra87001blwrdhs2z989h"},{"name":"Java","_id":"ckqevra8g001ilwrdgp7y94x1"},{"name":"JWT","_id":"ckqevra8i001olwrd25lj7p23"},{"name":"ReactHook","_id":"ckqevra8m001tlwrdegs57vgc"},{"name":"å€’è®¡æ—¶","_id":"ckqevra8t0027lwrdhyyjeyup"},{"name":"WebPack","_id":"ckqevra8v002clwrda12tgmoc"},{"name":"clean-webpack-plugin","_id":"ckqevra8y002klwrdadd5c03m"},{"name":"æ·±æ‹·è´","_id":"ckqevra90002slwrd5penfr48"},{"name":"æµ…æ‹·è´","_id":"ckqevra92002zlwrd6s1q3qec"},{"name":"ç³»ç»Ÿæ€§çš„å­¦ä¹ ","_id":"ckqevra930034lwrd781uchi2"},{"name":"å­¦ä¹ ç›®å½•","_id":"ckqevra94003alwrd532d4wz3"},{"name":"Webå‰ç«¯","_id":"ckqevra95003dlwrd44ymfxll"},{"name":"å­¦ä¹ æ¡†æ¶","_id":"ckqevra96003glwrdehiaheg4"},{"name":"Ant-Designç»„ä»¶åˆé›†","_id":"ckqevra97003jlwrdefere3hu"},{"name":"React-Router","_id":"ckqevra98003olwrd4sid5t43"},{"name":"UMI","_id":"ckqevra9a003vlwrd0qhnbotr"},{"name":"Ant-Design-Pro","_id":"ckqevra9b0040lwrd3zq5e3if"},{"name":"CSS-Module","_id":"ckqevra9c0043lwrdecib2w5v"},{"name":"github","_id":"ckqevra9e0048lwrd45h84uma"},{"name":"Spring-Boot","_id":"ckqevra9f004dlwrdgij00ct5"},{"name":"è·¨åŸŸ","_id":"ckqevra9g004hlwrd398cba9b"},{"name":"react","_id":"ckqevra9h004nlwrd6vzh1v2g"},{"name":"HTML","_id":"ckqevra9i004slwrd13vnbd6m"},{"name":"JavaScript","_id":"ckqevra9j004xlwrde0ee3146"},{"name":"æºç é˜…è¯»","_id":"ckqevra9k0050lwrdaljy9x6t"},{"name":"åŸå‹/åŸå‹é“¾","_id":"ckqevra9o005hlwrd3zq2c4xq"},{"name":"ç»§æ‰¿","_id":"ckqevra9p005klwrd6ylhd628"},{"name":"this","_id":"ckqevra9p005llwrdhmhz9odo"},{"name":"CSS","_id":"ckqevra9q005qlwrd2qh67sig"},{"name":"é—­åŒ…","_id":"ckqevra9q005tlwrd8ron63vv"},{"name":"æ¨¡å—","_id":"ckqevra9r005wlwrd3wojebe2"},{"name":"æµè§ˆå™¨","_id":"ckqevra9r005xlwrdg02514j6"},{"name":"é¢ç»","_id":"ckqevra9t0065lwrd9s7u5ch2"},{"name":"Webpack","_id":"ckqevra9t0067lwrdbkp6b3jq"},{"name":"è„šæ‰‹æ¶","_id":"ckqevra9v006blwrdaao2fi73"},{"name":"ES6","_id":"ckqevra9v006dlwrd58njbrk4"}]}}